<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#fff">


  <meta name="baidu-site-verification" content="d5sacIPNJl">



<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">










  <meta name="baidu-site-verification" content="true">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/wenwu.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/wenwu.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/wenwu.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/wenwu.jpg?v=5.1.4" color="#fff">





  <meta name="keywords" content="Linux,Shell,">





  <link rel="alternate" href="/atom.xml" title="偷得浮生半日闲" type="application/atom+xml">






<meta name="keywords" content="Linux,Shell">
<meta property="og:type" content="article">
<meta property="og:title" content="shell脚本基本知识">
<meta property="og:url" content="http://www.xpshuai.cn/shell脚本基本知识/index.html">
<meta property="og:site_name" content="偷得浮生半日闲">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://www.xpshuai.cn/shell脚本基本知识/title.jpg">
<meta property="og:image" content="http://www.xpshuai.cn/shell脚本基本知识/带括号与不带括号.png">
<meta property="og:image" content="http://www.xpshuai.cn/shell脚本基本知识/awk工作原理.png">
<meta property="og:updated_time" content="2020-04-16T17:07:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shell脚本基本知识">
<meta name="twitter:image" content="http://www.xpshuai.cn/shell脚本基本知识/title.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.xpshuai.cn/shell脚本基本知识/">





  <title>shell脚本基本知识 | 偷得浮生半日闲</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">偷得浮生半日闲</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">再偷浮生两吊钱</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            我的主页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            文章标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            文章分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档时光
          </a>
        </li>
      
        
        <li class="menu-item menu-item-life">
          <a href="/life/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-camera-retro"></i> <br>
            
            记录美好生活
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-pencil"></i> <br>
            
            留言板
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于作者
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索本站
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>

<!-- tq -->
<script type="text/javascript">WIDGET = {FID: 'a5qxJi5vKF'}</script>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.xpshuai.cn/shell脚本基本知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="浮生">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="偷得浮生半日闲">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">shell脚本基本知识</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-16T17:01:17+08:00">
                2020-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/shell脚本基本知识/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/shell脚本基本知识/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>  阅读数
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  13.5k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  60  分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/shell脚本基本知识/title.jpg"></p>
<a id="more"></a>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li><p>自动批量系统初始化（update，软件安装，时区设置，安全策略…）</p>
</li>
<li><p>自动化批量软件部署程序（LAMP/LNMP/Apache/LVS/Nginx)</p>
</li>
<li><p>管理应用程序（KVM，集群管理扩容，MySQL， DELLR720批量RAID）</p>
</li>
<li><p>日志分析处理日志（PV,UV, 200,!200, top 100/ grep, awk）</p>
</li>
<li><p>自动化备份恢复程序(MySQL完全/增量备份 + Crond)</p>
</li>
<li><p>自动化管理程序(批量远程修改密码，软件升级，配置更新)</p>
</li>
<li><p>自动化信息采集及监控程序（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net…）</p>
</li>
<li><p>配合zabbix信息采集（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net…）</p>
</li>
<li><p>自动化扩容（增加云主机-&gt;部署应用）</p>
</li>
<li><p>Zabbix监控CPU 80% + 调用Python的api 对AWS/EC2，ESC(增加 /删除云主机)+ Shell 脚本（业务上线）</p>
</li>
</ul>
<blockquote>
<p>程序的组成： 逻辑 + 数据</p>
</blockquote>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h4 id="一-常识"><a href="#一-常识" class="headerlink" title="一.常识"></a>一.常识</h4><p><strong>1.输入输出重定向</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 文件描述符：0，1,2    (对应：进程输入的文件，进程输入的文件，进程打开错误的文件)</span></span><br><span class="line">0表示标准输入</span><br><span class="line">1表示标准输出</span><br><span class="line">2表示标准错误输出</span><br><span class="line"></span><br><span class="line"><span class="comment">## 输入输出重定向</span></span><br><span class="line"><span class="comment"># &gt;, &gt;&gt;</span></span><br><span class="line">&gt; 默认为标准输出重定向，与 1&gt; 相同</span><br><span class="line">2&gt;&amp;1 把标准错误输出 重定向到 标准输出.</span><br><span class="line">&amp;&gt;a.txt 把标准输出 和 标准错误输出 都重定向到文件中</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2&gt;, 2&gt;&gt;   错误输出最佳</span></span><br><span class="line"><span class="comment"># 2&gt;&gt;&amp;1, &amp;&gt;   描述符为2的内容输入到描述符为1的内容(&amp;&gt; 是混合输出)</span></span><br><span class="line">cat &lt; /etc/hosts  <span class="comment">#（没加任何参数） 和不加&lt;的机制不一样</span></span><br><span class="line">cat &lt; /etc/hosts &gt; <span class="built_in">test</span>/aaa.txt  <span class="comment"># 相当于copy文件内容</span></span><br><span class="line">cat &lt;&lt; EOF   <span class="comment"># 输入内容让cat来执行</span></span><br><span class="line">cat &lt;&lt;EOF &gt; file1   <span class="comment"># 把一会输入的文件放到文件里面去 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 混合重定向  输出到/dev/null就是什么都不显示到终端</span></span><br><span class="line">&amp;&gt; /dev/null</span><br></pre></td></tr></table></figure>
<p><strong>2.一些快捷键</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ^R   搜索历史命令</span></span><br><span class="line"><span class="comment"># ![number]      执行历史命令中编号为`number`的命令</span></span><br><span class="line"><span class="comment"># ! string       找到最近一个以指定str开头的命令, 如：!da  </span></span><br><span class="line"><span class="comment"># !!  上一个命令（在脚本中是不能手动按方向键的）</span></span><br><span class="line"><span class="comment"># !$  shell上一个命令的最后一个参数，</span></span><br><span class="line">比如：ls aaa/bb /etc/passwd,   再执行： head !$, 看到是的passwd的内容</span><br><span class="line"></span><br><span class="line"><span class="comment"># ^D   退出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ^A   跳到最前</span></span><br><span class="line"><span class="comment"># ^E   跳到最后</span></span><br><span class="line"><span class="comment"># ^K   向后删除</span></span><br><span class="line"><span class="comment"># ^U   向前 删除</span></span><br><span class="line"><span class="comment"># ^Y   撤销</span></span><br><span class="line"><span class="comment"># ^L</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ^S   锁屏暂停</span></span><br><span class="line"><span class="comment"># ^Q   恢复</span></span><br></pre></td></tr></table></figure>
<p><strong>3.在bash程序中嵌入一个python代码</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 第一行不是注释， 声明用哪个解释器 #!</span></span><br><span class="line"></span><br><span class="line">ping -c1 114.114.114.114 &amp;&amp; <span class="built_in">echo</span> <span class="string">"114.114.114.114 is up"</span> || <span class="built_in">echo</span> <span class="string">"114.114.114.114 id down"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;&lt;-DOF：EOF是开始结束的标识（小横杠代表以下按tab,下面的py代码可以不tab缩进), EOF是不成文的规范</span></span><br><span class="line"><span class="comment"># 整个程序还是使用bash解释器，只不过是中间"请来一个人 - python"</span></span><br><span class="line"><span class="comment"># 如下：</span></span><br><span class="line">/usr/bin/python3 &lt;&lt;-EOF</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"hello py"</span>)</span><br><span class="line">EOF</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hello bash"</span></span><br><span class="line"><span class="comment"># 在bash中调用 python： expect</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果在python中使用bash， 要调用os.system('系统命令')</span></span><br></pre></td></tr></table></figure>
<p>没有<code>-</code>的话，EOF作为结束符，前面不能有任何tab制表符。<br>有<code>-</code>的话，EOF作为结束符，前面可以有tab制表符,<code>容错</code>率更高一点。</p>
<p><strong>4.配合figlet打印菜单:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">cat &lt;&lt;EOF</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">|                                         _          |</span><br><span class="line">|        _ __ ___   __ _ _ __ _   _  __ _| |         |</span><br><span class="line">|       | <span class="string">'_ \` _ \ / _\` | '</span>_ \| | ||/ _\` | |              |</span><br><span class="line">|       | | | | | | (_| | | | | |_| |(_| | |         |</span><br><span class="line">|       |_| |_| |_|\__,_|_||_|\__,_|\__,_|_|         |</span><br><span class="line">|                                                    |</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p><strong>5.子shell</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/Desktop</span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这种做法，在终端执行完毕之后，当前目录还是没有变，因为他是在subshell （子shell中执行的）</span></span><br><span class="line"><span class="comment"># 要想使得subshell中的生效，就要使用`.` 或者 `source`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####### 执行脚本</span></span><br><span class="line">./01.sh      <span class="comment"># 需要执行权限，在子shell中执行</span></span><br><span class="line">bash 01.sh   <span class="comment"># 不需要执行权限，在子shell中执行</span></span><br><span class="line"></span><br><span class="line">01.sh          <span class="comment"># 需要执行权限，在当前shell中执行</span></span><br><span class="line"><span class="built_in">source</span> 01.sh   <span class="comment"># 不需要执行权限，在当前shell中执行</span></span><br></pre></td></tr></table></figure>
<p><strong>6.shell元字符</strong></p>
<p>通配符, 注意<code>区分</code>与<code>正则</code>中的元字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#！/bin/bash  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># * 任意多个字符     </span></span><br><span class="line">ls /etc/net*</span><br><span class="line"></span><br><span class="line"><span class="comment"># ? 任意一个字符     </span></span><br><span class="line">ls home/xp?</span><br><span class="line"></span><br><span class="line"><span class="comment"># [] 匹配括号内任意一个字符   </span></span><br><span class="line">[abc]</span><br><span class="line">[a-z]    </span><br><span class="line">[^a-zA-Z0-9]     <span class="comment"># ^取反    </span></span><br><span class="line">l[io]ve         </span><br><span class="line">l[^a-z]ve          </span><br><span class="line"></span><br><span class="line"><span class="comment"># ()  命令在子shell中执行     </span></span><br><span class="line">(<span class="built_in">umask</span> 077; touch test.txt)    <span class="comment"># 不影响创建文件的权限，当前shell的umask也没有改变   </span></span><br><span class="line"><span class="comment"># ----- 回顾，子shell： .test.sh,     source x.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&#125;  集合     </span></span><br><span class="line">touch &#123;1..9&#125;   </span><br><span class="line">mkdir /home/&#123;111,222&#125;              </span><br><span class="line">mkdir -pv /home/&#123;333,&#123;aaa,bbb&#125;, 444&#125;</span><br><span class="line">cp -rv /etc/&#123;passwd, passwd.old&#125;    <span class="comment"># 前面的相同的路径可以写在一块，后面不同的&#123;&#125;起来</span></span><br><span class="line">cp -rv /etc/passwd&#123;,.old&#125;       <span class="comment"># 前面的相同的路径可以写在一块，后面不同的&#123;&#125;起来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># \     转义符    让元字符回归本意      </span></span><br><span class="line"><span class="built_in">echo</span> \*     </span><br><span class="line"><span class="built_in">echo</span> \\     </span><br><span class="line"><span class="built_in">echo</span> \    <span class="comment">#后面紧跟回车，也就转义了回车</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -e 常规字符转变为特殊意义的：</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"a\tb\nc"</span></span><br></pre></td></tr></table></figure>
<p><strong>7.前台后台</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## &amp;  (关闭xshell，对应的任务也跟着停止)</span></span><br><span class="line">sh test.sh &amp;  </span><br><span class="line"></span><br><span class="line"><span class="comment">## nohub  </span></span><br><span class="line"><span class="comment">#任务放到后台，关闭标准输入，终端不再能够接收任何输入（标准输入）,重定向标准输出和标准错误到nohup.out中</span></span><br><span class="line">nohup sh test.sh  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 区分`nohub`与`&amp;`:</span></span><br><span class="line">1.&amp; 是指在后台运行，但当用户推出(挂起)的时候，命令自动也跟着退出</span><br><span class="line">2.nohub 退出终端之后该进程还是有的</span><br><span class="line"></span><br><span class="line"><span class="comment">## nohub与&amp;合体</span></span><br><span class="line"><span class="comment">#将sh test.sh任务放到后台，但是依然可以使用标准输入，终端能够接收任何输入，重定向标准输出和标准错误到当前目录下的nohup.out文件，即使关闭xshell退出当前session依然继续运行。</span></span><br><span class="line">nohup sh test.sh  &amp; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## screen   </span></span><br><span class="line">apt install screen   <span class="comment"># 安装</span></span><br><span class="line">`sleep 100000` <span class="comment"># 先执行,然后退出终端，</span></span><br><span class="line">`screen -list` <span class="comment"># 再次打开终端,指定这个命令，看到id</span></span><br><span class="line">`screen -r yourID` <span class="comment"># 然后输入这个命令,一切就回来了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## shell的会话作业机制</span></span><br><span class="line">ctrl +c <span class="comment"># 杀掉的是前台进程</span></span><br><span class="line"><span class="comment"># ^Z  放到后台， fg  调回来</span></span><br><span class="line"><span class="built_in">kill</span> %3  <span class="comment"># 给当前终端作业号为3的发信号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## jobs 查看作业</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 管道  |</span></span><br><span class="line"><span class="comment"># tee 管道, -a 最佳</span></span><br><span class="line">date | tee -a date.txt   <span class="comment"># 输出到文件，同时截流（能在终端直观地看到）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 技巧: vim里面写脚本，可以按^Z暂停，到终端敲命令，让fg返回继续</span></span><br></pre></td></tr></table></figure>
<p><strong>8.命令排序</strong></p>
<ol>
<li><p><code>;</code>   不具备逻辑排序  （前面执行完毕就执行后面的，不管前面成功失败与否）</p>
</li>
<li><p><code>&amp;&amp;</code>  前面执行<code>成功</code>(即返回值$?为0)就执行后面的</p>
</li>
<li><p><code>||</code>   前面执行<code>失败</code>(即返回值$?为不为0)就执行后面的</p>
<p>相当于 if  else</p>
</li>
</ol>
<p><strong>9.echo颜色输出</strong></p>
<p>使用场景：给用户醒目提示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -e 才可以</span></span><br><span class="line"><span class="comment"># \e[1;3x </span></span><br><span class="line"><span class="comment"># \e[1;3x   前景色(30-37),m后面是文字       </span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;31mThis is a red"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;33mThis is a yellow"</span></span><br><span class="line"><span class="comment"># 0m 恢复颜色</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"no color"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 常用： 前面变色之后，  后面紧跟：\e[0m 不变色(后面的内容就正常了)</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;31mThis is a red text. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"no color again"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 背景色(40-47)</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;41mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;42mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;43mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;44mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;45mThis is a red text background coloe. \e[0m"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># printf     也是，不过是加了输出格式</span></span><br></pre></td></tr></table></figure>
<p><strong>10.切换用户</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换用户尽量加  -</span></span><br><span class="line">su - xxx   <span class="comment"># 加横线， shell的环境也跟随改变 （login shell） ； 执行的是前四个: bashrc和profile</span></span><br><span class="line">su xxx     <span class="comment"># 不加横线，当前环境还是当前的    ()             ； 执行的是两个bashrc文件</span></span><br></pre></td></tr></table></figure>
<p><strong>11.关于bash的文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关于bash的文件：</span></span><br><span class="line"><span class="comment"># 系统级别    来到shell时候执行</span></span><br><span class="line">/etc/profile</span><br><span class="line">/etc/bashrc</span><br><span class="line"><span class="comment"># 用户级别    来到shell时候执行</span></span><br><span class="line">~/.bashrc</span><br><span class="line">~/.profile</span><br><span class="line"><span class="comment"># 离开shell时候执行</span></span><br><span class="line">~/.bash_logout</span><br><span class="line">~/.bash_history</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户的shell</span></span><br><span class="line">usermod -s /bin/bash xps    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面两个</span></span><br><span class="line"><span class="comment"># login shell</span></span><br><span class="line"><span class="comment"># nologin shell</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /bin/bash</span></span><br><span class="line"><span class="comment"># /sbin/nologin</span></span><br></pre></td></tr></table></figure>
<p><strong>12.其他</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shift			使位置参数向左移动，默认移动1位，可以使用shift2</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$#</span> -ne 0 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line">	<span class="built_in">shift</span></span><br><span class="line">	<span class="comment"># shift 2</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$sum</span>"</span></span><br></pre></td></tr></table></figure>
<h4 id="二-变量"><a href="#二-变量" class="headerlink" title="二.变量"></a>二.变量</h4><h5 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a>位置变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">脚本执行时，后面的第几个参数   <span class="variable">$1</span> 后面第一个参数      <span class="variable">$2</span>  <span class="variable">$3</span>    <span class="variable">$&#123;10&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 比如下面的例子;</span></span><br><span class="line"><span class="comment"># bash test.sh 111 222 333</span></span><br><span class="line">ping -c1 <span class="variable">$1</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]           <span class="comment"># 如果`上一条命令`返回值等于0(正常执行)   -eq</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is up"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is down"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h5 id="预定义变量"><a href="#预定义变量" class="headerlink" title="预定义变量"></a>预定义变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0</span>    <span class="comment"># 脚本名</span></span><br><span class="line">$*    <span class="comment"># 所有的参数</span></span><br><span class="line"><span class="variable">$@</span>    <span class="comment"># 所有的参数</span></span><br><span class="line"><span class="variable">$#</span>    <span class="comment"># 参数的个数</span></span><br><span class="line">$$    <span class="comment"># 当前进程的PID         echo $$</span></span><br><span class="line">$!    <span class="comment"># 上一个`后台`进程的PID</span></span><br><span class="line">$?    <span class="comment"># 上一个命令的返回值（0为成功）</span></span><br></pre></td></tr></table></figure>
<p>ping 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果用户没有加参数</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"usage: file `basename <span class="variable">$0</span>`  need parmter"</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>如果是文件  -f</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  第一个参数如果不是文件</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"not a file"</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># 第一个参数是文件，从中读取ip然后ping</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> `cat <span class="variable">$1</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ping -c1 ip $&gt;/dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span>          </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># basename    始终显示路径最后一个文件</span></span><br><span class="line"><span class="comment"># dirname    始终显示路径前面目录的名字</span></span><br></pre></td></tr></table></figure>
<h5 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h5><p>export</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 在系统配置中用的多</span></span><br><span class="line"><span class="comment"># 例如：自己添加环境变量：到/etc/profile</span></span><br><span class="line">PATH=<span class="variable">$PATH</span>:/new/bin</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"><span class="comment"># 然后sourcess</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">echo</span> UID</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$USER</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$HISTORY</span>      <span class="comment">#历史记录命令默认记录1000条</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有的环境变量：   </span></span><br><span class="line">env</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消环境变量：   </span></span><br><span class="line"><span class="built_in">unset</span> 变量名</span><br></pre></td></tr></table></figure>
<h5 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h5><p>作用范围：<code>当前shell中</code>生效(<code>a.sh</code>或<code>bash a.sh</code>)， 子shell中不行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## 转为环境变量 export  (在一个脚本文件中export， 在另一个脚本中就可以获取了)</span></span><br><span class="line"><span class="built_in">export</span> ip1</span><br><span class="line"></span><br><span class="line"><span class="comment">## ps: 自己没必要定义环境变量</span></span><br><span class="line">F1: 先 .test.sh    再<span class="built_in">echo</span> <span class="variable">$ip1</span></span><br><span class="line">F2: 或者在一个脚本中引用加载另外一个脚本(./test.sh)，后面就可以用了（没必要在每个文件中都定义一遍变量）</span><br></pre></td></tr></table></figure>
<h5 id="变量的赋值"><a href="#变量的赋值" class="headerlink" title="变量的赋值"></a>变量的赋值</h5><p>1.显式赋值 （变量要以字母或者下划线开头，数字不可以开头）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 常规赋值</span></span><br><span class="line"><span class="comment"># shell中没有数据类型，都是字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 命令替换, 先把这个命令执行一遍再赋值: 反引号 ` `,   $()</span></span><br><span class="line">today = `date + %F`</span><br></pre></td></tr></table></figure>
<p>2.read读取赋值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">## -p提示信息。-t等待时间。-n只要前面几个字符</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># read -p "提示信息： "  变量名</span></span><br><span class="line"><span class="comment"># read -t 5 -p "提示信息： "  变量名</span></span><br><span class="line"><span class="comment"># read -n 2  变量名</span></span><br><span class="line"><span class="comment"># read 可以同时跟多个变量。空格隔开，直接一次性赋值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"输入姓名，年龄，性别[e.g zhangsan 20 m]： "</span> name age gender</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"your name: <span class="variable">$name</span>, your age <span class="variable">$age</span>, your gender <span class="variable">$gender</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 注意事项：</span></span><br><span class="line"><span class="string">""</span>   <span class="comment"># 弱引用(里面可以放变量$ip)</span></span><br><span class="line"><span class="string">''</span>   <span class="comment"># 强引用（里面不能引用变量,会原样输出）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 命令替换：  `` 等价于 $(), 里面的命令会先执行</span></span><br></pre></td></tr></table></figure>
<h5 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h5><blockquote>
<p>变量赋值，等号两边不能有空格</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping -c1 <span class="variable">$ip</span> &amp;&gt;/dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up"</span> || <span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down"</span></span><br></pre></td></tr></table></figure>
<h5 id="变量引用"><a href="#变量引用" class="headerlink" title="变量引用"></a>变量引用</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 引用</span></span><br><span class="line">1. $变量</span><br><span class="line">2. <span class="variable">$&#123;变量&#125;</span>   <span class="comment"># 大括号简单理解为：防止歧义</span></span><br></pre></td></tr></table></figure>
<h5 id="变量的运算"><a href="#变量的运算" class="headerlink" title="变量的运算"></a>变量的运算</h5><blockquote>
<p>使用场景：内存使用, ping次数等 … … </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1.整数运算    90%以上</span></span><br><span class="line"><span class="comment"># 方法1：  expr        +   -    \*   /   %</span></span><br><span class="line">expr 1+2</span><br><span class="line">expr <span class="variable">$num1</span> + <span class="variable">$num2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2：  $(())       +   -   *   /     %          </span></span><br><span class="line"><span class="built_in">echo</span> $((<span class="variable">$num1</span>+<span class="variable">$num2</span>))</span><br><span class="line"><span class="built_in">echo</span> $((num1+num2))</span><br><span class="line"><span class="built_in">echo</span> $((5-3*2))</span><br><span class="line"><span class="built_in">echo</span> $(((5-3)*2))</span><br><span class="line"><span class="built_in">echo</span> $(((2**3))</span><br><span class="line"><span class="built_in">echo</span> $(((1+2));<span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法3：  $[]         +  -  *  /  %</span></span><br><span class="line"><span class="built_in">echo</span> $[5+2]                  </span><br><span class="line"><span class="built_in">echo</span> $[5**2]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法4：  let       使用最多</span></span><br><span class="line"><span class="built_in">let</span> sum=2+3;<span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line"><span class="built_in">let</span> i++;<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.小数运算</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"2*4"</span>|bc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"2^4"</span>|bc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"scale=2;6/4"</span>|bc</span><br><span class="line">awk <span class="string">'BEGIN&#123;print 1/2&#125;'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"print 5.0/2"</span>|python</span><br></pre></td></tr></table></figure>
<h5 id="变量的删除-替换"><a href="#变量的删除-替换" class="headerlink" title="变量的删除/替换"></a>变量的删除/替换</h5><blockquote>
<p>使用场景：让你输入值但是你没输入，我就给你一个默认值</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 删除</span></span><br><span class="line">url=<span class="string">"www.baidu.com"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#url&#125;</span>   <span class="comment"># 从前往后，井号，输出长度， 最短匹配</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#www.&#125;</span>   <span class="comment">#  把前面部分删除</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*baidu.&#125;</span>    <span class="comment">#  把前面部分删除   * </span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url##*.&#125;</span>       <span class="comment"># 从前往后，贪婪匹配，最长匹配</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%.&#125;</span>         <span class="comment"># 从后往前, 最短匹配</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%%.&#125;</span>        <span class="comment"># 从后往前，贪婪匹配</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 切片</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url：0:5&#125;</span>   <span class="comment"># </span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url：5:5&#125;</span>   <span class="comment"># 从5开始，拿5个</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url：5:&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 变量内容的替换</span></span><br><span class="line">url=<span class="string">"www.baidu.com"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url/baidu/sina&#125;</span>   <span class="comment"># 百度换成新浪</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url/n/N&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url//n/N&#125;</span>  <span class="comment"># 贪婪匹配</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## $&#123;变量名-新变量值&#125;</span></span><br><span class="line"><span class="comment"># 替代(没赋值；如果变量之前有值即便是空值就不能替代)   </span></span><br><span class="line"><span class="built_in">unset</span> var1</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var1-aaa&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## $&#123;变量名:-新变量值&#125;</span></span><br><span class="line"><span class="comment"># 没赋值或者为空，就可以替代；如果变量之前有值就不能替代</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 拓展：</span></span><br><span class="line"><span class="variable">$&#123;变量名+新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名:+新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名=新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名:=新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名?新变量值&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名:?新变量值&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 自增自减</span></span><br><span class="line"><span class="comment"># i++</span></span><br><span class="line"><span class="comment"># ++i</span></span><br><span class="line"><span class="comment">## 对变量值的影响： 没啥区别</span></span><br><span class="line"><span class="comment">## 对表达式值的影响： ++i 先自增再赋值，  i++ 先赋值在自增</span></span><br></pre></td></tr></table></figure>
<h4 id="三-条件判断"><a href="#三-条件判断" class="headerlink" title="三.条件判断"></a>三.条件判断</h4><h5 id="if"><a href="#if" class="headerlink" title="if"></a>if</h5><blockquote>
<p>shell中最核心的</p>
</blockquote>
<p><strong>1.文件测试 [操作符 + 文件或目录]</strong>   </p>
<p>命令格式1：<code>test</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比如判断文件是否存在，如果存在就备份(概念版)</span></span><br><span class="line">back_dir=/var/mysql_bak</span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">test</span> -d <span class="variable">$back_dir</span>;<span class="keyword">then</span>     <span class="comment"># 条件测试语句test， 如果不是目录或者这个目录不存在</span></span><br><span class="line">	mkdir -p <span class="variable">$back_dir</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"开始备份..."</span></span><br><span class="line"><span class="comment"># 执行 bash -vx test.sh        -vx可以看详细执行过程</span></span><br></pre></td></tr></table></figure>
<p>命令格式2： <code>[ -d /home ]</code>    方括号取代了test(注意有空格)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># man test， 帮助文档相同。 前半边是命令[,  后半边]只是一个符号</span></span><br><span class="line">back_dir=/var/mysql_bak</span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$back_dir</span> ];<span class="keyword">then</span>     <span class="comment"># 如果不是目录或者这个目录不存在</span></span><br><span class="line">	mkdir -p <span class="variable">$back_dir</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"开始备份..."</span></span><br></pre></td></tr></table></figure>
<p>命令格式3：  <code>[[ -d /home ]]</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># [ -e dir|file ]</span></span><br><span class="line">-d 是否是目录</span><br><span class="line">-f 是否为文件</span><br><span class="line">-r `当前用户`是否对该文件有读权限</span><br><span class="line">-w</span><br><span class="line">-l  是否是链接</span><br><span class="line">-b  是否为设备文件</span><br><span class="line">-c  是否为字符设备</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[ ! -d /cc ] &amp;&amp; mkdir /cc   <span class="comment"># 当前不是一个目录或者目录如果不存在，就创建</span></span><br><span class="line">[ -d /ccc ] || mkdir /ccc   <span class="comment"># 当前是一个目录或者目录如果存在，就不创建</span></span><br></pre></td></tr></table></figure>
<p><strong>2.数值比较</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># [ 1 -gt 10 ]  大于</span></span><br><span class="line">-lt  小于</span><br><span class="line">-eq  等于</span><br><span class="line">-ne  不等于</span><br><span class="line">-ge  &gt;=</span><br><span class="line">-le  &lt;=</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装软件，先判断是否为root用户</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$UID</span> -ne 0 ];<span class="keyword">then</span>         <span class="comment"># $UID不等于0，代表不是root用户(数值比较)</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"你没有权限!"</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">apt install apache2</span><br></pre></td></tr></table></figure>
<p>例子：用户输入(read)用户名，创建这个用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">"input the user name:  "</span> user</span><br><span class="line">id <span class="variable">$user</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span>     <span class="comment"># 如果用户存在</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	useradd <span class="variable">$user</span></span><br><span class="line">	<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>例子2： 如果磁盘是使用量超过90%， 就报警</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep'/$' 是提取根分区， $(NF) 是倒数第一列， awk是以什么分割</span></span><br><span class="line"></span><br><span class="line">dick_use=`df -Th |grep<span class="string">'/$'</span>|awk <span class="string">'&#123;print $(NF-1)&#125;'</span>|awk -F<span class="string">"%"</span> <span class="string">'&#123;print $1&#125;'</span>`</span><br><span class="line">mail_user=alice</span><br><span class="line">warn_file=/tmp/disk_warn.txt</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$dick_use</span> -gt 90 ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"`date +%F:%H` disk: <span class="variable">$&#123;dick_use&#125;</span>%"</span> &gt;warn_file</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$disk_warn</span> ];<span class="keyword">then</span>      <span class="comment"># 将报错文件发送给邮件用户</span></span><br><span class="line">	mail -s <span class="string">"disk  warning..."</span> <span class="variable">$mail_user</span> &lt; <span class="variable">$dick_use</span>     <span class="comment"># |mail -s 邮件主题</span></span><br><span class="line">	rm -rf <span class="variable">$disk_warn</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以用crontab，定时执行（crontab -e会把所有的任务清除）</span></span><br><span class="line"><span class="comment"># 换行是 \</span></span><br></pre></td></tr></table></figure>
<p><strong>3.字符串比较</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">=</span><br><span class="line">==</span><br><span class="line">!=</span><br><span class="line">[ -n <span class="string">"hhh"</span> ]  <span class="comment"># 长度不是0</span></span><br><span class="line">[ -z <span class="string">"<span class="variable">$user</span>"</span> ]  <span class="comment"># 长度为0  (变量为空/未定义 =&gt; 都是0)</span></span><br><span class="line">-a     <span class="comment"># 并且    [1 -lt 1 -a 5 -gt 10]</span></span><br><span class="line">-r     <span class="comment"># 或者</span></span><br><span class="line">&amp;&amp;</span><br><span class="line">||</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="variable">$USER</span> != <span class="string">'root'</span> ];<span class="keyword">then</span>         <span class="comment"># $USER不等于root(字符串比较)</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"你没有权限!"</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">apt install apache2</span><br></pre></td></tr></table></figure>
<p>例子：批量创建用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#尽量使用双引号引起来</span></span><br><span class="line"><span class="comment">#[ "$USER" = "root" ]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">##################################</span></span><br><span class="line"><span class="comment">#脚本规范						 #</span></span><br><span class="line"><span class="comment">#useradd					     #</span></span><br><span class="line"><span class="comment">#V1.0 by xps 01/03/2020		     #</span></span><br><span class="line"><span class="comment">##################################</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Please input number: "</span> num</span><br><span class="line"><span class="comment"># read -p "Please input 前缀: " prefix</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 对用户输入进行过滤（数字） ^[0-9]+$  正则 =~ (模式串不能带双引号)</span></span><br><span class="line">	<span class="comment">#if [[ ! "$num" =~ ^[0-9]+$ || "$num" =~ ^0+$ ]];then   # []单个方括号不支持正则，用[[ 变量 =~ 模式 ]]</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">"<span class="variable">$num</span>"</span> =~ ^[0-9]+$ ]];<span class="keyword">then</span>  </span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">read</span> -p <span class="string">"不是数字，Please input number again: "</span> num</span><br><span class="line">	<span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Please input 前缀: "</span> prefix</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$prefix</span>"</span> ];<span class="keyword">then</span>   <span class="comment"># 如果长度为非0</span></span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">read</span> -p <span class="string">"Please input 前缀: "</span> prefix</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># man seq   打印序列： seq 1 2 10 (区间，步长)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `sql <span class="variable">$num</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	user=<span class="variable">$prefix</span><span class="variable">$i</span></span><br><span class="line">	useradd <span class="variable">$user</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"123"</span> |passwd --stdin <span class="variable">$user</span>   <span class="comment"># --stdin 前面输出的当做标准输入</span></span><br><span class="line">	<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># declare 可以定义数据类型。但是一般不用，因为都是字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 语法不难，主要是对Linux系统以及命令的熟悉。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if后门紧跟的不一定是方括号，只要是能返回true/false的就行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="comment">#statements</span></span><br><span class="line"><span class="keyword">elif</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="comment">#statements</span></span><br><span class="line"><span class="keyword">elif</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="comment">#statements</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h5 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h5><p>语法结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 变量 <span class="keyword">in</span></span><br><span class="line">模式1)				<span class="comment"># 都是字符串， 可以用通配符 (尽量使用双引号)</span></span><br><span class="line">	命令序列1</span><br><span class="line">	;;</span><br><span class="line">模式2)</span><br><span class="line">	命令序列2</span><br><span class="line">	;;</span><br><span class="line">模式3)</span><br><span class="line">	命令序列3</span><br><span class="line">	;;</span><br><span class="line">*)</span><br><span class="line">	无匹配后命令序列</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<p>例子1：删除用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">"请输入要删除的用户名： "</span> user</span><br><span class="line">id <span class="variable">$user</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ &amp;? -ne 0 ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"no suc user: <span class="variable">$user</span>"</span></span><br><span class="line">	<span class="built_in">exit</span> 1	<span class="comment"># 返回1（意思是错误退出）</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"你确定要删除用户: <span class="variable">$user</span> 吗 ?[y/n]: "</span> action</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$action</span>"</span> <span class="keyword">in</span></span><br><span class="line">y|Y|yes|YES)</span><br><span class="line">	userdel -r <span class="variable">$user</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"deleted user: <span class="variable">$user</span> success!"</span></span><br><span class="line">	;;</span><br><span class="line">*)</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"error"</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<p>例子2： 判断一个东西是不是命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># command -v xxx</span></span><br><span class="line"><span class="comment"># echo $? 返回为0就是</span></span><br><span class="line"><span class="built_in">command</span> -v ls</span><br><span class="line"></span><br><span class="line">cmd1=/bin/date</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v <span class="variable">$cmd1</span> &amp;&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">	<span class="comment"># 神马都不做： 只加一个冒号</span></span><br><span class="line">	:</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$cmd1</span> 是一个命令"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>例子3：通过登录堡垒机/跳板机 jumpserver ，然后登录内网的服务器 （简易版）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1.先登录到跳板机(普通账号)</span></span><br><span class="line"><span class="comment"># 2.跳板机登录到other server（）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录两次，有点麻烦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子： 先登录到跳板机，再通过选项选择要登录到哪台服务器（1.密码认证 2.秘钥认证:以用户xps身份做 ssh-keygen, ssh-copy-id web1）</span></span><br><span class="line"><span class="comment"># 以xps身份登录上来， 秘钥登录服务器</span></span><br><span class="line"><span class="comment"># 脚本放到/home/xps/jumpserver.sh, 放到bashrc，登录这台机器就执行，并且禁止用户(^C)退出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">""</span> HUP INT OUIT TSTP   <span class="comment"># 捕捉键盘信号，然后啥也不做(^C也退出不了) ,让他登录跳板机不能干别的</span></span><br><span class="line">web1=192.168.0.111</span><br><span class="line">web2=192.168.0.112</span><br><span class="line">web3=192.168.0.113</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;-EOF</span><br><span class="line">+---------------------------+</span><br><span class="line">|       1. web1   		    |</span><br><span class="line">|       2. web2             |</span><br><span class="line">|       3. mysql1           |</span><br><span class="line">+---------------------------+</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">"\e[1;32minput number:  \e[0m"</span>  <span class="comment"># 显示颜色, -n不换行</span></span><br><span class="line"><span class="built_in">read</span> num</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">case</span> <span class="string">"<span class="variable">$num</span>"</span> <span class="keyword">in</span></span><br><span class="line">	1)</span><br><span class="line">		ssh xps@<span class="variable">$web1</span></span><br><span class="line">		;;</span><br><span class="line">	2)	</span><br><span class="line">		ssh xps@<span class="variable">$web2</span></span><br><span class="line">		;;</span><br><span class="line">	3)</span><br><span class="line">		ssh xps@<span class="variable">$mysql1</span></span><br><span class="line">		;;</span><br><span class="line"></span><br><span class="line">	<span class="string">""</span>)</span><br><span class="line">		<span class="comment"># 用户啥也没输入</span></span><br><span class="line">		<span class="literal">true</span></span><br><span class="line">	*）	</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"error"</span></span><br><span class="line">	<span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 生产环境</span></span><br><span class="line"><span class="comment">#1. 业务服务器不允许直接连接，允许通过跳板机连接</span></span><br><span class="line"><span class="comment">#2. 业务服务器不允许root用户直接登录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 复杂版jumpserver(对用户行为进行行为/记录)  ---&gt; 使用Python脚本</span></span><br></pre></td></tr></table></figure>
<p>例子4：实现系统管理工具箱</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 实现系统管理工具箱</span></span><br><span class="line"><span class="comment"># 定义一个函数</span></span><br><span class="line">menu&#123;</span><br><span class="line">	cat &lt;&lt;-EOF</span><br><span class="line">	<span class="comment">##########################################</span></span><br><span class="line">	<span class="comment">#		h. help						     #</span></span><br><span class="line">	<span class="comment">#		f. disk partion				     #</span></span><br><span class="line">	<span class="comment">#		d. filesystem mount				 #</span></span><br><span class="line">	<span class="comment">#		m. memory						 #</span></span><br><span class="line">	<span class="comment">#		u. system load					 #</span></span><br><span class="line">	<span class="comment">#		q .exit							 #</span></span><br><span class="line">	<span class="comment">##########################################</span></span><br><span class="line">	EOF</span><br><span class="line">&#125;</span><br><span class="line">menu</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">"Please input[h for help]: "</span> action</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"<span class="variable">$action</span>"</span> <span class="keyword">in</span></span><br><span class="line">	h)		clear; menu;;</span><br><span class="line">	f)		fdisk -l;;</span><br><span class="line">	d)		df -Th;;</span><br><span class="line">	m)		free -m;;</span><br><span class="line">	u)		uptime;;</span><br><span class="line">	q)		<span class="built_in">break</span>;;</span><br><span class="line">	<span class="string">""</span>) 	;;</span><br><span class="line">	*)		<span class="built_in">echo</span> <span class="string">"error"</span>;;</span><br><span class="line">	<span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish..."</span></span><br></pre></td></tr></table></figure>
<h5 id="各种符号"><a href="#各种符号" class="headerlink" title="各种符号"></a>各种符号</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">()    <span class="comment"># 在子shell中执行</span></span><br><span class="line">((1&lt;2))   <span class="comment"># C语言风格的比较</span></span><br><span class="line">$(date)           <span class="comment"># touch $(date +%F)_file.txt      先执行里面的命令再执行外面的</span></span><br><span class="line">$(())   <span class="comment"># 运算</span></span><br><span class="line"></span><br><span class="line">&#123;&#125;     <span class="comment"># 集合&#123;1..5&#125;</span></span><br><span class="line"><span class="variable">$&#123;&#125;</span>    <span class="comment"># 变量的引用</span></span><br><span class="line"></span><br><span class="line">[]     <span class="comment"># 条件测试           逻辑符号 [ a -a b  ]</span></span><br><span class="line">[[]]   <span class="comment"># 升级版的。  支持正则匹配 [[ =~ ]]， 逻辑符号 [[ a &amp;&amp; b ]]</span></span><br><span class="line"></span><br><span class="line">$[] <span class="comment"># 整数运算</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####### 执行脚本</span></span><br><span class="line">./01.sh      <span class="comment"># 需要执行权限，在子shell中执行</span></span><br><span class="line">bash 01.sh   <span class="comment"># 不需要执行权限，在子shell中执行</span></span><br><span class="line"></span><br><span class="line">01.sh          <span class="comment"># 需要执行权限，在当前shell中执行</span></span><br><span class="line"><span class="built_in">source</span> 01.sh   <span class="comment"># 不需要执行权限，在当前shell中执行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###### 调试脚本</span></span><br><span class="line">sh -n 02.sh    <span class="comment"># 仅调试syntax error</span></span><br><span class="line">sh -vx 02.sh   <span class="comment"># 仅调试的方式执行，查询整个执行过程</span></span><br></pre></td></tr></table></figure>
<h4 id="四-循环"><a href="#四-循环" class="headerlink" title="四.循环"></a>四.循环</h4><h5 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h5><blockquote>
<p>处理固定循环的时候，for有优势</p>
</blockquote>
<p>形式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 变量名 [ <span class="keyword">in</span> 列表 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>拓展： 查看脚本运行时间:  <code>time ./a.sh</code></p>
<p>例子1： for循环ping机器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重定向</span></span><br><span class="line">&gt;ip.txt</span><br><span class="line"><span class="comment"># &#123;2..254&#125;  集合，  另一个序列: seq `2 254`</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">	<span class="variable">$ip</span> = 192.168.111.<span class="variable">$i</span></span><br><span class="line">	ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null   <span class="comment"># -W等待多少时间</span></span><br><span class="line">	<span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> | tee -a ping.txt</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	&#125;&amp;    <span class="comment"># 用大括号和&amp;, 把整个循环【放到后台】</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span>    <span class="comment"># 等待前面的所有【后台】进程结束，再执行后面的</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish !"</span></span><br></pre></td></tr></table></figure>
<p>例子2：从文件中读取主机，然后ping</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;2..254&#125;  集合，  另一个序列: seq `2 254`</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> `cat ips.txt`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null   <span class="comment"># -W等待多少时间</span></span><br><span class="line">	<span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up!"</span> </span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down!"</span> </span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span>    <span class="comment"># 等待前面的所有【后台】进程结束，再执行后门的</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish !"</span></span><br></pre></td></tr></table></figure>
<p>例子3：批量创建账号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">"input your prefix  &amp; passwd &amp; number : "</span> prefix passwd number</span><br><span class="line">	<span class="built_in">printf</span> <span class="string">"user information:</span></span><br><span class="line"><span class="string">	---------------------------</span></span><br><span class="line"><span class="string">	username: <span class="variable">$passwd</span></span></span><br><span class="line"><span class="string">	prefix: <span class="variable">$prefix</span></span></span><br><span class="line"><span class="string">	number: <span class="variable">$number</span></span></span><br><span class="line"><span class="string">	---------------------------</span></span><br><span class="line"><span class="string">	"</span></span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">"Are you sure?[y/n]"</span> action</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">"<span class="variable">$action</span>"</span> = <span class="string">"y"</span> ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"continue ..."</span></span><br><span class="line"><span class="comment"># 然后是接下来的功能</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq -w  <span class="variable">$number</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	user = <span class="variable">$prefix</span>%i</span><br><span class="line">	id <span class="variable">$user</span> &amp;&gt;/dv/null</span><br><span class="line">	<span class="keyword">if</span> [ $? -eq ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		useradd <span class="variable">$user</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$passwd</span>"</span> | --stdin <span class="variable">$user</span>    <span class="comment"># 将密码作为标准输入</span></span><br><span class="line">		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bash -n .sh     检查脚本错误</span></span><br></pre></td></tr></table></figure>
<p>例子4：批量创建账号（从文件中）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">passwd = 123</span><br><span class="line"><span class="comment"># 必须要输入文件</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"usage: `basename <span class="variable">$0</span>` file"</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 判断输入的是否是文件</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"error file"</span></span><br><span class="line">	<span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 开始(两列 -- &gt; 把密码和用户名分开)</span></span><br><span class="line"><span class="comment"># 应该：重新定义分隔符</span></span><br><span class="line"><span class="comment"># IFS内部字段分隔符,比如下面的回车</span></span><br><span class="line"><span class="comment"># IFS = $'\n'  </span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> `cat <span class="variable">$1</span>`  <span class="comment"># 位置变量 ,   for对空行不感冒</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 长度为0就跳过</span></span><br><span class="line">	<span class="keyword">if</span> $[ <span class="variable">$&#123;#line&#125;</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"Nothing to do."</span></span><br><span class="line">		<span class="built_in">continue</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	user = `<span class="built_in">echo</span> <span class="string">"<span class="variable">$line</span>"</span> |awk <span class="string">'print &amp;1'</span>`</span><br><span class="line">	pass = `<span class="built_in">echo</span> <span class="string">"<span class="variable">$line</span>"</span> |awk <span class="string">'print &amp;2'</span>`</span><br><span class="line">	id <span class="variable">$user</span> &amp;&gt;/dv/null</span><br><span class="line">	<span class="keyword">if</span> [ $? -eq ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		useradd <span class="variable">$user</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$pass</span>"</span> | --stdin <span class="variable">$user</span> &amp;&gt;/dev/null    <span class="comment"># 将密码作为标准输入</span></span><br><span class="line">		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>例子5：批量修改密码(剩下的功能自己完善)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目前：通的放一个文件，不通的放一个文件</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> $(cat ip.txt)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">			ssh <span class="variable">$ip</span> <span class="built_in">echo</span> <span class="string">"123"</span> |passwd --stdin <span class="variable">$user</span>   <span class="comment"># 采用的公钥认证</span></span><br><span class="line">			<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">				<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt;success_`date + %F`.txt</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt;failed_`date + %F`.txt</span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt;failed_`date + %F`.txt</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		</span><br><span class="line">	&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"end!"</span></span><br></pre></td></tr></table></figure>
<p>例子6：批量修改主机ssh设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh <span class="variable">$ip</span> <span class="string">"sed -ri '/~#UseDNS/cUseDNS0 no' /etc/ssd/sshd_config"</span>   <span class="comment"># 搜索并替换(c)</span></span><br></pre></td></tr></table></figure>
<h5 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h5><blockquote>
<p>逐行读取文件的时候，while有优势</p>
<p>不用像for循环那样担心每一行的空格空行</p>
<p>所以：读取一个文件中逐行处理，while比for好用</p>
</blockquote>
<p>例子1：创建用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以后，读取一个文件中逐行处理，while比for好用</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line:</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 判断用户数是否输入参数</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$&#123;#line&#125;</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">continue</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	user = `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">'&#123;printf $1&#125;'</span>`</span><br><span class="line">	pass = `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">'&#123;printf $2&#125;'</span>`</span><br><span class="line">	id <span class="variable">$user</span> &amp;&gt;/dev/null</span><br><span class="line">	<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"user <span class="variable">$user</span> already exists"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		useradd <span class="variable">$user</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$pass</span>"</span> | --stdin <span class="variable">$user</span> &amp;&gt;/dev/null    <span class="comment"># 将密码作为标准输入</span></span><br><span class="line">		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is created."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$1</span> <span class="comment"># 可以换成位置变量,   从文件里面读取用户名(read不用-p了)</span></span><br><span class="line"><span class="comment"># done &lt; user.tx  #</span></span><br></pre></td></tr></table></figure>
<p>例子2：while实现连接测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只要ping通就一直ping（【条件为true时候一直执行循环】）</span></span><br><span class="line">ip=192.168.0.5</span><br><span class="line"><span class="keyword">while</span> ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null; <span class="keyword">do</span></span><br><span class="line">	sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down!"</span></span><br></pre></td></tr></table></figure>
<p>例子3：until 实现连接测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ip=192.168.0.5</span><br><span class="line">until ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null; <span class="keyword">do</span></span><br><span class="line">	sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up!"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>while 适合写主机下线</li>
<li>until 适合写主机上线</li>
</ul>
<h5 id="until循环"><a href="#until循环" class="headerlink" title="until循环"></a>until循环</h5><p>形式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当条件测试为false时候执行循环体</span></span><br><span class="line">until 条件测试</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>例子1：until实现数值运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># i=1</span></span><br><span class="line">until [ <span class="variable">$i</span> -gt 100 ]    <span class="comment"># &gt;100</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line">	<span class="built_in">let</span> i++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"sum: <span class="variable">$sum</span>"</span></span><br></pre></td></tr></table></figure>
<p>例子2：while实现数值运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数值运算：let</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 100 ]   <span class="comment"># &lt;=100</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"sum: <span class="variable">$sum</span>"</span></span><br></pre></td></tr></table></figure>
<h5 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h5><p> 并发  —&gt; 多进程  </p>
<p>之前写的传统并发的方式，多进程（返回是时间是乱序的）  </p>
<p> <strong>缺点：</strong>有些并发数量太多，会报错</p>
<p><strong>格式:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		ip=192.168.0.<span class="variable">$i</span></span><br><span class="line">		ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up."</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"执行结束..."</span></span><br></pre></td></tr></table></figure>
<p><strong>控制并发的数量</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 1). FD(File Descriptors)文件描述符 或 文件句柄 </span></span><br><span class="line"><span class="comment"># 进程使用文件描述符来管理打开的文件（位置： /proc/进程id/fd/）</span></span><br><span class="line"><span class="comment"># $$是当前进程</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&gt; /file1    <span class="comment"># 1.手动指定描述符来 打开文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"111"</span> &gt;&gt; /proc/$$/fd/6    <span class="comment"># 2.写入到了file1</span></span><br><span class="line"><span class="comment"># 3.删除file1</span></span><br><span class="line"><span class="comment"># 4.然后查看文件句柄:</span></span><br><span class="line">ll /proc/$$/fd</span><br><span class="line"><span class="comment"># 会发现6显示删除状态</span></span><br><span class="line"><span class="comment">## 5.把6这个文件拷贝出来变成file1,就又回来了（如果文件句柄没有删除或关闭。就算原文件被删除了，句柄依然在）</span></span><br><span class="line">ls of <span class="comment"># 6.列出打开的文件</span></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&amp;-    <span class="comment"># 7.释放文件的句柄 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2). 管道</span></span><br><span class="line"><span class="comment">## 匿名管道(一个终端内使用) |</span></span><br><span class="line"><span class="comment">## 跨终端使用   mkfifo</span></span><br><span class="line">mkfifo  /tmp/fifo1   <span class="comment"># 创建</span></span><br><span class="line">ll /dev &gt; /tmp/fifo1 <span class="comment"># 把dev重定向到管道中，另一个终端就可以用了</span></span><br><span class="line"><span class="comment"># 另一个终端使用： </span></span><br><span class="line">grep <span class="string">'sda'</span> /tmp/fifo1</span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">thread=5</span><br><span class="line">tmp_fifofile=/tmp/$$.fifo</span><br><span class="line"></span><br><span class="line">mkfifo <span class="variable">$tmp_fifofile</span></span><br><span class="line"><span class="built_in">exec</span> 8&lt;&gt; <span class="variable">$tmp_fifofile</span></span><br><span class="line">rm <span class="variable">$tmp_fifofile</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq <span class="variable">$thread</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> &gt;&amp;8   <span class="comment"># 操作的是文件描述符（）</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">read</span> -u 8    <span class="comment"># -u 是读取文件描述符内容（逐行）</span></span><br><span class="line">	&#123;</span><br><span class="line">		ip=192.168.0.<span class="variable">$i</span></span><br><span class="line">		ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is up."</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is down."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		<span class="built_in">echo</span> &gt;&amp;8  <span class="comment"># 有借有还（借一个还一个，不能让文件描述符里面空）</span></span><br><span class="line">	&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"执行结束.  .."</span></span><br><span class="line"><span class="comment"># 执行结果是5个5个出来的（因为定义的进程是5个）</span></span><br></pre></td></tr></table></figure>
<h5 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h5><p> expect —-&gt; 不是shell，是一个新的语言</p>
<p>解决交互的繁琐操作</p>
<p>安装：<code>apt install expect</code></p>
<p>expect实现批量远程命令执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果for while，需要一步步的交互(比较麻烦)，但是可以使用公钥认证(ssh-keygen,ssh-copy-id)</span></span><br><span class="line"><span class="comment">#第一步，实现了公钥认证</span></span><br><span class="line"><span class="comment"># ps:如果登录的新的机器与之前的指纹不一样，先删除本地保存的信息</span></span><br><span class="line"><span class="comment"># expect打前站，先把公钥推过去，后面再用别的实现</span></span><br></pre></td></tr></table></figure>
<p>ssh初级例子1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip 192.168.0.1</span><br><span class="line"><span class="built_in">set</span> user root</span><br><span class="line"><span class="built_in">set</span> passwd 123456</span><br><span class="line"><span class="built_in">set</span> timeout 5</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;   <span class="comment">#就是把接下来要出现的字符串等提前写好</span></span><br><span class="line">	<span class="string">"yes/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;  <span class="comment"># 当出现什么，怎么处理(没出现就继续)</span></span><br><span class="line">	<span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line">interact  <span class="comment">#交互停在对方那边不退出来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行脚本: expect test.sh</span></span><br></pre></td></tr></table></figure>
<p>ssh初级例子2(升级版)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 0]   <span class="comment"># 第一个位置参数(与shell的不通)</span></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> passwd 123456</span><br><span class="line"><span class="built_in">set</span> timeout 5</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;   <span class="comment">#就是把接下来要出现的字符串等提前写好</span></span><br><span class="line">	<span class="string">"yes/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;  <span class="comment"># 当出现什么，怎么处理(没出现就继续)</span></span><br><span class="line">	<span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#interact  # 交互停在对方那边不退出来</span></span><br><span class="line"><span class="comment"># 干点别的事情</span></span><br><span class="line">expect <span class="string">"#"</span>            <span class="comment"># 不用大括号也可以</span></span><br><span class="line"><span class="comment">#send "useradd xps\r"</span></span><br><span class="line">send <span class="string">"pwd\r"</span></span><br><span class="line">send <span class="string">"exit\r"</span></span><br><span class="line">expect eof  <span class="comment"># 结束expect</span></span><br></pre></td></tr></table></figure>
<p>例子3：scp传递文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######## 升级版</span></span><br><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 0]   <span class="comment"># 第一个位置参数(与shell的不通)</span></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> passwd 123456</span><br><span class="line"><span class="built_in">set</span> timeout 5</span><br><span class="line"></span><br><span class="line">spawn scp -r /etc/xxx <span class="variable">$user</span>@<span class="variable">$ip</span>:/tmp</span><br><span class="line"></span><br><span class="line">expect &#123;   <span class="comment">#就是把接下来要出现的字符串等提前写好</span></span><br><span class="line">	<span class="string">"yes/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;  <span class="comment"># 当出现什么，怎么处理(没出现就继续)</span></span><br><span class="line">	<span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line">expect eof  <span class="comment"># 结束expect</span></span><br></pre></td></tr></table></figure>
<p>例子4： 推公钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shell与expect一起用</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">&gt;ip.txt</span><br><span class="line">passwd=123</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试expect有没有装(以centos为例)</span></span><br><span class="line">rpm -q expect &amp;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0  ];<span class="keyword">then</span></span><br><span class="line">	yum -y install expect</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否有公钥</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f ~/.ssh/id_rsa ];<span class="keyword">then</span></span><br><span class="line">	ssh-keygen -P <span class="string">"123"</span> -f ~/.ssh/id_rsa <span class="comment"># 指定公钥的密码和位置</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		ip=192.168.0.<span class="variable">$i</span></span><br><span class="line">		pign -c1 -W1 <span class="variable">$ip</span> &amp;/dev/null</span><br><span class="line">		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> &gt;&gt; ip.txt</span><br><span class="line">			<span class="comment"># 开始expect</span></span><br><span class="line">			/usr/bin/expect &lt;&lt;-EOF</span><br><span class="line">			<span class="built_in">set</span> timeout 10</span><br><span class="line">			spawn ssh-copy-id <span class="variable">$ip</span>      <span class="comment"># 推送公钥。 前面必须都是tab，不能有空格（:set list 查看是tab还是空格）</span></span><br><span class="line">			expect &#123;</span><br><span class="line">				<span class="string">"yse/no"</span> &#123; send <span class="string">"yes\r"</span>; exp_continue &#125;</span><br><span class="line">				<span class="string">"password:"</span> &#123; send <span class="string">"<span class="variable">$passwd</span>\r"</span> &#125;</span><br><span class="line">			&#125;</span><br><span class="line">			expect eof</span><br><span class="line">			EOF</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish..."</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上一个例子, 已经实现了公钥认证，后面的操作就可以使用shell了，基本不用expect了</span></span><br><span class="line"><span class="comment"># 重启之后查看机器的ip，直接用get_ip.sh脚本（就不用了一个一个去看了）</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">&gt;ping.txt</span><br><span class="line"><span class="comment"># &#123;2..254&#125;  集合，  另一个序列: seq `2 254`</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">	<span class="variable">$ip</span> = 192.168.111.<span class="variable">$i</span></span><br><span class="line">	ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null  </span><br><span class="line">	<span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span>"</span> | tee -a ping.txt</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	&#125;&amp;    】</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span>    </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finish !!!"</span></span><br></pre></td></tr></table></figure>
<h4 id="五-数组"><a href="#五-数组" class="headerlink" title="五.数组"></a>五.数组</h4><p>没有多维数组这个概念</p>
<p><strong>定义</strong></p>
<p>1.普通数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 普通数组：只能使用整数作为数组索引</span></span><br><span class="line">books=(linux shell awk docker)</span><br><span class="line">books=(linux shell awk [20]=docker)  <span class="comment"># 索引20为docker</span></span><br><span class="line"><span class="comment"># 从文件赋值</span></span><br><span class="line">books2=(`cat /etc/passwd`)</span><br><span class="line">books=(`ls /etc/`)</span><br><span class="line"><span class="comment"># 中间值可以跳过</span></span><br></pre></td></tr></table></figure>
<p>2.关联数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关联数组：可以使用字符串作为数组索引（相当于字典）</span></span><br><span class="line"><span class="built_in">declare</span> -A info <span class="comment"># 先声明是关联数组</span></span><br><span class="line">info ([name]=xps [sex]=male [age]=20 [skill]=security)  <span class="comment"># 赋值</span></span><br></pre></td></tr></table></figure>
<p><strong>使用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;books[3]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[name]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有的数组</span></span><br><span class="line"><span class="built_in">declare</span> -a</span><br><span class="line"><span class="comment"># 查看所有的关联数组</span></span><br><span class="line"><span class="built_in">declare</span> -A</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数组元素的索引号</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[@:1]&#125;</span>   <span class="comment"># 从数组下标1开始</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[@:1:2]&#125;</span>   <span class="comment"># 从数组下标1开始，访问两个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有的索引key</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!info[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计元素个数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#info[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组中所有元数（等同于： $&#123;info[*]&#125;     ）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;info[@]&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>遍历</strong></p>
<p>1.按照个数遍历</p>
<p>2.按照索引遍历</p>
<p>例子:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#while方式</span></span><br><span class="line">i=0</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	hosts[++i]=<span class="variable">$line</span>    <span class="comment">#hosts是个数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span> &lt;/etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="variable">$&#123;!hosts[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;hosts[i]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################3</span></span><br><span class="line"><span class="comment"># for方式   不是以换行分割（按照空格,tab等分割）</span></span><br><span class="line">OLD_IFS=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">'\n'</span>  <span class="comment"># 解决</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!hosts[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;hosts[i]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="variable">$&#123;!hosts[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;hosts[i]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">IFS=<span class="variable">$OLD_IFS</span>   <span class="comment"># 不是全文都要，如果后门想用回车作为分隔符号</span></span><br></pre></td></tr></table></figure>
<p><strong>实例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 1. 性别次数统计</span></span><br><span class="line"><span class="comment">## 其实用awk一行搞定</span></span><br><span class="line">awk <span class="string">'&#123;print $2&#125;'</span> sex.txt |sort |uniq -c</span><br><span class="line"></span><br><span class="line"><span class="comment">## 这里还是先学基础的（`把要统计的对象作为数组的索引` ，首先是关联数组）</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A sex</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 里面的第二列（m/f）</span></span><br><span class="line">	<span class="built_in">type</span>=`<span class="built_in">echo</span> <span class="variable">$line</span> |awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">	<span class="built_in">let</span> sex[<span class="variable">$type</span>]++    <span class="comment"># sex[m]++ 性别的数量增加 </span></span><br><span class="line"><span class="keyword">done</span> &lt; sex.txt</span><br><span class="line"><span class="comment"># 遍历(通过索引)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!sex[@]&#125;</span>       <span class="comment"># 获取所有的索引key</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;sex[$i]&#125;</span>"</span>   <span class="comment">#变量尽量加$</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2. 统计不同类型shell的数量</span></span><br><span class="line"><span class="comment"># /etc/passwd中</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A shells   <span class="comment"># 先定义关联数组</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 里面的第二列</span></span><br><span class="line">	<span class="built_in">type</span>=`<span class="built_in">echo</span> <span class="variable">$line</span> |awk -F<span class="string">":"</span> <span class="string">'&#123;print $7&#125;'</span>`  <span class="comment">#按照冒号分割   &#123;print $NF&#125;最后一列</span></span><br><span class="line">	<span class="built_in">let</span> shells[<span class="variable">$type</span>]++    <span class="comment"># sex[m]++ 性别的数量增加 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span> &lt; /etc/passwd</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!shells[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;shells[$i]&#125;</span>"</span>   <span class="comment"># /bin/bash :  5</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 这是awk的强项</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print $NF&#125;'</span> /etc/passwd |sort |uniq -c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. 统计tcp连接状态数量</span></span><br><span class="line"><span class="comment">#ss -an |grep 80</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">unset</span> status  <span class="comment"># 取消， 重新声明</span></span><br><span class="line">	<span class="built_in">declare</span> -A status   <span class="comment"># 先定义关联数组	</span></span><br><span class="line">	<span class="built_in">type</span>=`ss -an |grep :80 |aek <span class="string">'&#123;print $2&#125;'</span>`  <span class="comment"># 要统计的(是一个arr)</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$type</span></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		<span class="built_in">let</span> status[<span class="variable">$i</span>]++    </span><br><span class="line">	<span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line">	<span class="comment">#输出</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!status[@]&#125;</span></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>: <span class="variable">$&#123;status[$i]&#125;</span>"</span>    <span class="comment"># SYN-SENT: 5</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">	sleep 1</span><br><span class="line">	clear</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 思想: 把要统计的对象最为索引，一直累加</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 拓展：</span></span><br><span class="line"><span class="comment">## 一.如果想一直看</span></span><br><span class="line"><span class="comment"># 1. watch -n2 test.sh   # 每几秒看一次</span></span><br><span class="line"><span class="comment"># 2. 脚本里面while循环(更麻烦)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 二.vim部分复制粘贴：  </span></span><br><span class="line"><span class="comment"># ^V 块选择，然后按y复制， 最后找到地方p粘贴</span></span><br></pre></td></tr></table></figure>
<h4 id="六-函数"><a href="#六-函数" class="headerlink" title="六.函数"></a>六.函数</h4><p><strong>定义</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F1:</span></span><br><span class="line">函数名()&#123;</span><br><span class="line">	功能</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># F2:</span></span><br><span class="line">funcion 函数名&#123;</span><br><span class="line">	功能</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>调用</strong></p>
<p>调用1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#例子：阶乘</span></span><br><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">factorial</span></span>()&#123;</span><br><span class="line">fat=1</span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=50;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	fac=$[<span class="variable">$fac</span>*<span class="variable">$i</span>]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"5的阶乘:<span class="variable">$fac</span>"</span></span><br><span class="line">&#125;</span><br><span class="line">factorial   <span class="comment"># 调用</span></span><br></pre></td></tr></table></figure>
<p>调用2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">factorial</span></span>()&#123;</span><br><span class="line">fat=1</span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=<span class="variable">$num</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	fac=$[<span class="variable">$fac</span>*<span class="variable">$i</span>]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$num</span>的阶乘:<span class="variable">$fac</span>"</span></span><br><span class="line">&#125;</span><br><span class="line">num=5 <span class="comment"># 调用之前先定义变量</span></span><br><span class="line">factorial</span><br></pre></td></tr></table></figure>
<p>调用3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">factorial</span></span>()&#123;</span><br><span class="line">fat=1</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq <span class="variable">$1</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">let</span> fac*=<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>的阶乘:<span class="variable">$fac</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">factorial <span class="variable">$1</span>  <span class="comment"># 位置变量，调用</span></span><br></pre></td></tr></table></figure>
<p>调用4</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果函数再另一个文件里面，先执行一下，后面再调用</span></span><br><span class="line">./f1.sh</span><br></pre></td></tr></table></figure>
<p><strong>返回值</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">fun2</span></span>()&#123;</span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">"enter a number:"</span> num</span><br><span class="line">	<span class="built_in">let</span> 2*<span class="variable">$num</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> $[2*<span class="variable">$num</span>]</span><br><span class="line">&#125;</span><br><span class="line">fun2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"funcion return value: %?"</span> <span class="comment"># 上一个命令的返回值（函数值最后一条命令的返回的状态码）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"funcion return: $?"</span>  <span class="comment"># 函数的返回值(也可以自定义，但是默认shell返回码,最大不能超过255)</span></span><br></pre></td></tr></table></figure>
<p>如果想返回字符串等:   函数的输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"><span class="function"><span class="title">fun2</span></span>()&#123;</span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">"enter a number:"</span> num</span><br><span class="line">	<span class="built_in">echo</span> $[2*<span class="variable">$num</span>]   <span class="comment"># echo</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">result=`fun2`     <span class="comment"># 使用函数的输出</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"return_out value: <span class="variable">$result</span>"</span></span><br></pre></td></tr></table></figure>
<p><strong>参数的传递</strong></p>
<p>1.位置参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 3 ];<span class="keyword">then</span>   <span class="comment"># 如果参数不是三个</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Usage: `basename <span class="variable">$0</span>`par1 par2 par3 "</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">parm_func</span></span>()&#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$(($1 * $2 * s3)</span>)"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=`parm_func <span class="variable">$1</span> <span class="variable">$2</span> <span class="variable">$3</span>`  <span class="comment"># 分清：程序的位置参数，函数的位置参数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"result is: <span class="variable">$result</span>"</span></span><br></pre></td></tr></table></figure>
<p>2.数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line">num=(1,2,3,4,5)</span><br><span class="line"><span class="comment">#echo "$&#123;num[@]&#125;"  #打印所有元素</span></span><br><span class="line"><span class="function"><span class="title">arr_parm</span></span>() &#123;</span><br><span class="line">	<span class="built_in">local</span> fa=1   <span class="comment">## 局部变量，只在函数内部生效</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line">	<span class="comment">#for i in $*</span></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		<span class="built_in">let</span> fa*=<span class="variable">$i</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$fa</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#arr_parm $&#123;num[@]&#125;</span></span><br><span class="line">arr_parm <span class="variable">$&#123;num[*]&#125;</span>   <span class="comment"># 数组所有 元素值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拓展：</span></span><br><span class="line"><span class="comment"># for i in $*     # 所有参数</span></span><br><span class="line"><span class="comment"># for i</span></span><br></pre></td></tr></table></figure>
<p>传数组到函数中 –&gt; 运算 –&gt; 输出数组形式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line">num=(1,2,3,4,5)</span><br><span class="line"><span class="function"><span class="title">array</span></span>() &#123;</span><br><span class="line">	<span class="comment">#echo "所有参数: $*"</span></span><br><span class="line">	<span class="built_in">local</span> new_arr=(`<span class="built_in">echo</span> $*`)</span><br><span class="line">	<span class="comment">#local new_arr=($*)</span></span><br><span class="line">	<span class="built_in">local</span> i</span><br><span class="line">	<span class="keyword">for</span> ((i=0;i&lt;<span class="variable">$#</span>;i++))</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		out_arr[<span class="variable">$i</span>]=$[ <span class="variable">$&#123;[$i]&#125;</span>*5 ]</span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;out_arr[*]&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=`array<span class="variable">$&#123;num[*]&#125;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;result[*]&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line">num=(1,2,3,4,5)</span><br><span class="line"><span class="function"><span class="title">array</span></span>() &#123;</span><br><span class="line">	<span class="built_in">local</span> i</span><br><span class="line">	<span class="built_in">local</span> new_arr=()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> $*</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		new_arr[j++]=$[<span class="variable">$i</span>*5]</span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;new_arr[*]&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=`array<span class="variable">$&#123;num[*]&#125;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;result[*]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数接收位置参数 $1   $2    $3</span></span><br><span class="line"><span class="comment"># 函数接收数组参数 $*   或  $@</span></span><br><span class="line"><span class="comment">#函数将接收到的所有参数赋值给数组   new_arr=($*)</span></span><br></pre></td></tr></table></figure>
<h4 id="七-正则"><a href="#七-正则" class="headerlink" title="七.正则"></a>七.正则</h4><p>大多数程序中，正则表达式被放在两个正斜杠之间, 比如：<code>/L[oO]ve/</code></p>
<p><strong>入门小例子</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单实例（不严谨的例子，我们写shell脚本没必要写那么复杂，我们的脚本是给自己用的多）</span></span><br><span class="line">匹配数字：    ^[0-9]+$</span><br><span class="line">匹配Email：	 [a-z0-9_]+@[a-z0-9]+\.</span><br><span class="line">匹配IP：	 [0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;</span><br><span class="line">		或者  [[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]&#123;1,3&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">egrep <span class="string">'[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;'</span> /etc/sysconfig/network-scripts/ifcfg-eth0</span><br></pre></td></tr></table></figure>
<p><strong>正则 元字符</strong></p>
<p>注意和shell的元字符是不太一样的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由执行模式匹配的操作的程序来解析，比如vi，grep，sed，awk，python</span></span><br><span class="line"><span class="comment"># 只要不是shell，就是正则的元字符</span></span><br><span class="line"></span><br><span class="line">rm -rf *.pdf  <span class="comment"># shell中的*， 匹配任意</span></span><br><span class="line">grep <span class="string">'c*'</span> /etc/passwd   <span class="comment"># c出现0次或者多次</span></span><br><span class="line">egrep <span class="string">'c+'</span> /etc/passwd   <span class="comment"># +要使用egrep或反斜杠</span></span><br><span class="line"></span><br><span class="line">vim中替换： `:%s/\&lt;[tT]om\&gt;/TOM/g`    <span class="comment"># 尖括号括起来的是单词</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 例子：</span></span><br><span class="line">grep <span class="string">"sh$"</span> /etc/passwd</span><br><span class="line">grep <span class="string">"ro*t"</span> /etc/passwd</span><br><span class="line">grep <span class="string">"^[rot]"</span> /etc/passwd   <span class="comment"># 以r或o或t开头的</span></span><br></pre></td></tr></table></figure>
<p>1.基本元字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">^		行首定位符					^love</span><br><span class="line">$		行位定位符					love$</span><br><span class="line">.		匹配单个字符					l..e</span><br><span class="line">*		匹配前导符0到多次				ab*love</span><br><span class="line">.*		任意多个字符	</span><br><span class="line">[]		匹配指定范围内的一个字符		[lL]ove</span><br><span class="line">[-]		匹配指定范围内的一个字符		[a-z0-9]ove</span><br><span class="line">[^]		匹配不再指定组内的一个字符     [^a-z0-9]ove</span><br><span class="line">\		用来转义元字符				love\.</span><br><span class="line">\&lt;		词首定位符					\&lt;love</span><br><span class="line">\&gt;		词尾定位符					love\&gt;</span><br><span class="line">\(..\)  匹配稍后使用的字符的标签		 :%s/172.16.130.1/172.16.130.5/</span><br><span class="line">									 :%s/\(172.16.130.\)1/\15/</span><br><span class="line">									 :%s/\(172.\)\(16.\)\(130.\)1/\1\2\35/</span><br><span class="line">									 :3,9s/\(.*\)/<span class="comment">#\1/   # 把第3-9行整行注释掉</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 大括号每一半前面要加斜线记得</span></span><br><span class="line">x\&#123;m\&#125;	     字符x重复出现m次				 o\&#123;5\&#125;</span><br><span class="line">x\&#123;m,\&#125;   	 字符x重复出现m次以上			 o\&#123;5,\&#125;</span><br><span class="line">x\&#123;m,n\&#125;	 字符x重复出现m次				 o\&#123;5,10\&#125;</span><br></pre></td></tr></table></figure>
<p> 2.拓展正则表达式元字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+				匹配一个或多个前导字符		[a-z]+ove</span><br><span class="line">?				匹配零个或一个前导字符		lo?ve   <span class="comment"># o出现0次或1次    ss -an |egrep ':80:22\&gt;'</span></span><br><span class="line">a|b  			匹配a或b						love|hate</span><br><span class="line">()				组 字符 						loveablle|rs    love(able|rs)ov+  (ov)+   ov+   <span class="comment"># 里面内容作为一个整体</span></span><br><span class="line">(..)(..)\1\2	标签匹配字符					(love)able\1er      <span class="comment"># 不带斜线</span></span><br><span class="line"></span><br><span class="line">x&#123;m&#125;			字符x重复出现m次  			o&#123;5&#125;</span><br><span class="line">x&#123;m,&#125;			字符x重复至少m次				o&#123;5,&#125;</span><br><span class="line">x&#123;m,n&#125;			字符x重复m到n次				o&#123;5,10&#125;</span><br></pre></td></tr></table></figure>
<p> 3.POSIX字符类 （类似于shell中环境变量，已经定义好的）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[:alnum:]		字母与数字字符						[[:alnum:]]+        <span class="comment"># 外面的方括号是包里面的</span></span><br><span class="line">[:alpha:]		字母字符（包括大小写字母）				[[:alpha:]]&#123;4&#125;</span><br><span class="line">[:blank:]		空格与制表符							[[:blank:]]*</span><br><span class="line">[:digit:]		数字									[[:digit:]]?</span><br><span class="line">[:lower:]		小写字母								[[:lower:]]&#123;5,&#125;</span><br><span class="line">[:upper:]		大写字母								[[:upper:]]+</span><br><span class="line">[:punct:]		标点符号								[[:punct:]]</span><br><span class="line">[:space:]		包括换行符、回撤等在内的所有空白		[[:space:]]+</span><br></pre></td></tr></table></figure>
<p>带括号与不带括号：</p>
<p><img src="/shell脚本基本知识/带括号与不带括号.png"></p>
<p>正则匹配实例：vim中查找替换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 空行：</span></span><br><span class="line">/^$/</span><br><span class="line">/^[\t]*$/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释行：</span></span><br><span class="line">/^<span class="comment">#/</span></span><br><span class="line">/^[\t]*<span class="comment">#/</span></span><br></pre></td></tr></table></figure>
<p><strong>grep</strong></p>
<ul>
<li>grep       文件中查找指定的正则表达式</li>
<li>egrep     拓展的egrep，支持更多的正则表达式元字符</li>
<li>fgrep      固定grep(fixed grep),有时也被称作快速(fast grep), 它按字面解释所有的字符</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#过滤（尽量加引号）</span></span><br><span class="line">grep [选项] PATTERN 文件 文件 文件</span><br><span class="line"></span><br><span class="line">grep -q <span class="string">"root"</span> /etc/passwd : <span class="built_in">echo</span> $?</span><br><span class="line"><span class="comment"># 返回值：</span></span><br><span class="line"><span class="comment"># 0  找到</span></span><br><span class="line"><span class="comment"># 1  没找到</span></span><br><span class="line"><span class="comment"># 2  找不到指定文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep的输入可以来自：文件、标准输入、管道</span></span><br><span class="line">ss -an |grep <span class="string">":22$"</span></span><br><span class="line">ll |grep <span class="string">'^d'</span>   <span class="comment"># 找出目录</span></span><br></pre></td></tr></table></figure>
<p>使用的元字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">grep：     使用基本元字符集  ^, $, ., *, [], [^], \&lt;\&gt;, \(\),  \&#123;\&#125;, \+, </span><br><span class="line">egrep：	   使用扩展元字符集  ?, +, &#123;&#125;, |, ()</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">Note: grep也可以使用扩展元字符集，仅需再这些元字符前置一个反斜线(尖号不行)</span><br><span class="line"></span><br><span class="line">\w    所有字母与数字，称之为字符，即 [a-zA-Z0-9]</span><br><span class="line">\W    与上面相反，非字符     [^a-zA-Z0-9]</span><br><span class="line">\b    词边界</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep -E 或 egrep</span></span><br></pre></td></tr></table></figure>
<p>grep选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-v		取反，只显示不匹配的</span><br><span class="line">-i  	忽略大小写</span><br><span class="line">-l      只列出匹配行所在的文件名(哪些文件里面有这些匹配)</span><br><span class="line">-n      再每一行前面加上他所在文件中的相对行号</span><br><span class="line">-c      显示成功匹配的行数</span><br><span class="line">-s      禁止显示文件不存在或文件不可读的错误信息</span><br><span class="line">-q      静默</span><br><span class="line">--color 颜色</span><br><span class="line">-R, -r  递归针对目录</span><br><span class="line">-o      只显示匹配的内容</span><br><span class="line">-B      前几行  grep -C2 <span class="string">'root'</span> /etc/passwd </span><br><span class="line">-A      后几行</span><br><span class="line">-C      上下几行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nmap --<span class="built_in">help</span> |grep <span class="string">'\-u'</span>  <span class="comment"># 查看帮助文档里的-u</span></span><br></pre></td></tr></table></figure>
<h4 id="八-sed"><a href="#八-sed" class="headerlink" title="八.sed"></a>八.sed</h4><p>sed: 流编辑器，在线的、非交互式的编辑器（而vi是交互式的）</p>
<p><strong>sed工作流程</strong></p>
<p>文本文件  -&gt; sed的模式空间(缓冲区)  –&gt; 输出</p>
<p><strong>命令格式</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sed [options] 'cmd' file(s)</span></span><br><span class="line">sed [options] -f scriptfile file(s)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sed不管是够找到指定的模式，他的退出状态都是0。 只有当命令<code>语法存在错误</code>时候，才是非0</p>
</blockquote>
<p><strong>可以在命令行，也可以在脚本里面使用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># d 删除</span></span><br><span class="line">sed <span class="string">'4d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 4d 删除第四行</span></span><br><span class="line"><span class="comment"># i 修改文件(不是输出到屏幕上)</span></span><br></pre></td></tr></table></figure>
<p><strong>支持正则表达式</strong></p>
<p>支持的元字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本元字符集: ^, $, ., *, [], [^], \&lt;\&gt;, \(\), \&#123;\&#125; </span></span><br><span class="line"><span class="comment"># 扩展元字符集: ?, +, &#123;&#125;, |, ()</span></span><br></pre></td></tr></table></figure>
<p>使用扩展元字符的方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed  --<span class="built_in">help</span>|grep <span class="string">'\-r'</span></span><br><span class="line"> <span class="comment"># </span></span><br><span class="line"> \+</span><br><span class="line"> sed -r</span><br></pre></td></tr></table></figure>
<p>基本用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sed -r <span class="string">''</span> /etc/<span class="built_in">test</span>    <span class="comment"># '' 没任何动作</span></span><br><span class="line">sed -r <span class="string">'d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'p'</span> /etc/<span class="built_in">test</span>    <span class="comment"># p 打印</span></span><br><span class="line">sed -r -n <span class="string">'p'</span> /etc/<span class="built_in">test</span>    </span><br><span class="line">sed -r -n <span class="string">'/root/p'</span> /etc/<span class="built_in">test</span>    <span class="comment"># -n  静默方式</span></span><br><span class="line"><span class="comment"># 上面四种不建议用(打印这种事情用不着sed，有别的打印就行)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 下面的功能才重点学</span></span><br><span class="line">sed -r <span class="string">'s/root/xps'</span> /etc/<span class="built_in">test</span>    <span class="comment"># 所有行查找替换,root换成大小写（只替换一次）</span></span><br><span class="line">sed -r <span class="string">'s/root/xps/g'</span> /etc/<span class="built_in">test</span>  <span class="comment"># g 全局</span></span><br><span class="line">sed -r <span class="string">'s/root/xps/gi'</span> /etc/<span class="built_in">test</span>  <span class="comment"># i  忽略大小写</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'/root/d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 没有s就是查找， 查找带root的行，然后删除</span></span><br><span class="line">sed -r <span class="string">'\#root#d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 查找：可以使用#等符号--&gt;不一定要斜线，但是前面要加\转义；查找替换:不用转义</span></span><br></pre></td></tr></table></figure>
<p><strong>地址(定址)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于决定对哪些行进行编辑。地址形式可以是数字、正则或二者的结合(如果没有指定,sed将处理输入文件中的所有行)</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'3d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'1,3d'</span> /etc/<span class="built_in">test</span> </span><br><span class="line">sed -r <span class="string">'/root/d'</span> /etc/<span class="built_in">test</span>    <span class="comment"># 删除root的行</span></span><br><span class="line">sed -r <span class="string">'root/,5d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 从root行开始，到第5行删除</span></span><br><span class="line">sed -r <span class="string">'s/root/xps/g'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 替换</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'/^adm/,20d'</span> /etc/<span class="built_in">test</span>  <span class="comment"># 从adm开头的那一行，删除到第20行</span></span><br><span class="line">sed -r <span class="string">'/^adm/,+20d'</span> /etc/<span class="built_in">test</span> <span class="comment"># 从adm开头的那一行，再往后删除20行</span></span><br><span class="line">sed -r <span class="string">'/2,5d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 第二行到第五行 </span></span><br><span class="line">sed -r <span class="string">'/root/d'</span> /etc/<span class="built_in">test</span>    <span class="comment"># 带root的行删除</span></span><br><span class="line">sed -r <span class="string">'/root/!d'</span> /etc/<span class="built_in">test</span>  <span class="comment"># 除了root行以外都删除</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'1~2d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 删除所有奇数行(从1开始，每隔两行删)</span></span><br><span class="line">sed -r <span class="string">'0~2d'</span> /etc/<span class="built_in">test</span>   <span class="comment"># 删除所有偶数行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拓展：</span></span><br><span class="line">vim中： 使用 `:r /etc/passwd` 来读取文件内容</span><br></pre></td></tr></table></figure>
<p><strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 告诉sed对指定行进行何种操作</span></span><br><span class="line">a  		在当前行后添加一行或多行</span><br><span class="line">c 	    用新文本修改(替换)当前行中的文本</span><br><span class="line">d 		删除行</span><br><span class="line">i 		在当前行前插入文本</span><br><span class="line">l	    列出非打印字符</span><br><span class="line">p 		打印行 </span><br><span class="line">n		读入下一输入行，并从下一条命令而不是第一条命令开始对其的处理</span><br><span class="line">q		结束或退出sed</span><br><span class="line">!		取反(对所选行以外的所有行应用)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s 		用一个字符串替换另一个</span><br><span class="line">		s 替换标志</span><br><span class="line">		g 在行内进行全局替换</span><br><span class="line">		i 忽略大小写</span><br><span class="line">r 		从文件中读</span><br><span class="line">w 		将行写入文件</span><br><span class="line">y		将字符转换为另一个字符（不支持正则）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h 		把模式空间里的内容复制到暂存缓冲区(覆盖)</span><br><span class="line">H 		把模式空间里的内容支架到暂存缓冲区中</span><br><span class="line">g 		取出暂存缓冲区中的内容，将其复制到模式空间，覆盖该处原有内容</span><br><span class="line">G 		取出暂存缓冲区中的内容，将其复制到模式空间，追加在原有内容后门</span><br><span class="line">x 		交换暂存缓冲区域模式空间的内容</span><br></pre></td></tr></table></figure>
<p><strong>例子</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 例子</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># d 删除</span></span><br><span class="line">sed -r <span class="string">'3d'</span> datefile   <span class="comment"># 删除第三行</span></span><br><span class="line">sed -r <span class="string">'3d'</span> datefile</span><br><span class="line">sed -r <span class="string">'3&#123;d;&#125;'</span> datefile</span><br><span class="line">sed -r <span class="string">'3d&#123;h:d&#125;'</span> datefile  <span class="comment"># 先保存，再删除</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'3,$d'</span> datefile   <span class="comment"># 删除3到最后一行</span></span><br><span class="line">sed -r <span class="string">'$d'</span> datefile     <span class="comment"># 删除最后一行</span></span><br><span class="line">sed -r <span class="string">'/nrth/d'</span> datefile  <span class="comment"># 删除满足这个匹配的行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># s 替换 </span></span><br><span class="line">sed -r <span class="string">'s/west/north/g'</span> datefile</span><br><span class="line">sed -r <span class="string">'s/^west/north/'</span> datefile      </span><br><span class="line">sed -r <span class="string">'s[0-9][0-9]$/&amp;.5'</span> datefile   <span class="comment"># &amp;代表在查找串中匹配到的内容       # 拓展vim中在某行的后门加上xxx：  :3,5s/.*/&amp;XXX/g</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#vim拓展1:    :%s/.*/#&amp;/g   在所有行前面加注释</span></span><br><span class="line"><span class="comment">#vim拓展1:    :3,5s/~/#&amp;/        和sed是一样的</span></span><br><span class="line">sed -r <span class="string">'%s/(.)(.)(.*)/\1xxx\2\3/'</span> passwd            <span class="comment"># 把每行第二个字符前面加xxx</span></span><br><span class="line">sed -r <span class="string">'s/(Mar)got/\1inane/g'</span> datefile</span><br><span class="line"></span><br><span class="line"><span class="comment"># r 读文件</span></span><br><span class="line">sed -r <span class="string">'s/Suan/r /etc/newfile'</span> datefile  <span class="comment"># 到Suan这一行的时候，读入一个新文件</span></span><br><span class="line">sed -r <span class="string">'2r /etc/hosts'</span> a.txt   <span class="comment"># 处理到第二行的时候，读入一个新文件</span></span><br><span class="line">sed -r <span class="string">'/2r /etc/hosts'</span> a.txt   <span class="comment"># /2   带有2的时候，读入...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># w 写文件</span></span><br><span class="line">sed -r <span class="string">'/north/w newfile'</span> datafile   <span class="comment"># 把north的行保存到新文件中去</span></span><br><span class="line">sed -r <span class="string">'3,$w /new.txt'</span> datafile      <span class="comment"># 第三行到最后一行，保存...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a 追加</span></span><br><span class="line">sed -r <span class="string">'/root/a 1111111'</span> datafile   <span class="comment"># 有root的行，就在后面添加11111</span></span><br><span class="line">sed -r <span class="string">'2a/ 1111111'</span> datafile       <span class="comment"># 第二行，添加 111111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># i 在前面插入</span></span><br><span class="line">sed -r <span class="string">'/root/i 1111111'</span> datafile    <span class="comment"># 有root的行，就在前面添加11111</span></span><br><span class="line">sed -r <span class="string">'2i/ 1111111'</span> datafile        <span class="comment"># 第二行，在前面添加 111111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c  修改替换</span></span><br><span class="line">sed -r <span class="string">'2c/ 1111111'</span> datafile        <span class="comment">#   第二行，替换为 111111111</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># n 获取下一行命令</span></span><br><span class="line">sed -r <span class="string">'/eastern/&#123;n; d&#125;'</span> datafile  <span class="comment"># 这行没有明显标志，用上面明显的隔山打牛</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># G g H h 暂存和取用命令</span></span><br><span class="line">sed -r  <span class="string">'1h;$G'</span> /etc/hosts   <span class="comment"># 处理到第一行时候，暂存；到最后一行，取过来  （第一行复制到最后一行）</span></span><br><span class="line">sed -r  <span class="string">'1&#123;h;d&#125;;$G'</span> /etc/hosts    <span class="comment"># 第一行移动到最后一行</span></span><br><span class="line">sed -r  <span class="string">'1h;2,$G'</span> /etc/hosts   <span class="comment"># 处理到第一行时候，暂存;到第二行和最后一行，取过来</span></span><br></pre></td></tr></table></figure>
<p><strong>模式空间/暂存空间</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 小写是覆盖，大写是追加</span></span><br><span class="line">模式空间   h  H --&gt;    暂存空间</span><br><span class="line">模式空间   &lt;--- g  G   暂存空间	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed -r  <span class="string">'G;G'</span> /etc/hosts   <span class="comment"># 所有行</span></span><br><span class="line">sed -r  <span class="string">'g;g'</span> /etc/hosts   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂存空间个模式空间互相转换命令   x</span></span><br><span class="line">sed -r <span class="string">'4h; 5x; 6G'</span> /etc/hosts   <span class="comment"># 处理到第四行覆盖到暂存空间，到第五行:。。。</span></span><br></pre></td></tr></table></figure>
<p> <strong>反向选择</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -r <span class="string">'3d'</span> /etc/hosts</span><br><span class="line">sed -r <span class="string">'3!d'</span> /etc/hosts</span><br></pre></td></tr></table></figure>
<p><strong>多重编辑选项</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -e</span></span><br><span class="line">sed -r -e <span class="string">'1,3d'</span> -e <span class="string">'s/java/python/'</span> datafile   <span class="comment"># 第一行到第三行删除，后面的替换覆盖</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'2&#123;s/java/python/g; s/php/go/g&#125;'</span> datafile   <span class="comment"># 一行里面替换两次</span></span><br></pre></td></tr></table></figure>
<p><strong>常见操作</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############ 常见操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除#注释行</span></span><br><span class="line">sed -ri <span class="string">'/^#/d'</span> file.conf   <span class="comment"># 这种情况必须是第一个就是注释符</span></span><br><span class="line">sed -ri <span class="string">'/^[\t]*#/d'</span> file.conf   <span class="comment"># 如果是前面有空格或tab然后才是注释符</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除//注释行</span></span><br><span class="line">sed -ri <span class="string">'\Y/^[\t]*//Yd'</span> file.conf </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除无内容空行</span></span><br><span class="line">sed -ri <span class="string">'/^[\t]*$/d'</span> file.conf </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除注释行及空行</span></span><br><span class="line">sed -ri <span class="string">'/^[\t]*#|^[\t]*$/d'</span> file.conf </span><br><span class="line">sed -ri <span class="string">'/^[\t]*(#|$)/d'</span> file.conf </span><br><span class="line"></span><br><span class="line"><span class="comment"># #加注释（vim是一样是）</span></span><br><span class="line">:%s/.*/<span class="comment">#&amp;/g   在所有行前面加注释</span></span><br><span class="line">:3,5s/^/<span class="comment">#&amp;/        和sed是一样的</span></span><br><span class="line"></span><br><span class="line">sed -r <span class="string">'1,5s/^/#/'</span> c.txt</span><br><span class="line">sed -r <span class="string">'3,$ s/^#*/#/'</span> c.txt  <span class="comment"># 将行首0到多个井换成一个井</span></span><br><span class="line"><span class="comment"># 如果井前有空格或tab等</span></span><br><span class="line">sed -r <span class="string">'3,$ s/^[\t]*#*/#/'</span> c.txt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sed使用外部变量(使用双引号)</span></span><br><span class="line">var1=111</span><br><span class="line">sed -ri <span class="string">"3a<span class="variable">$val1</span>"</span> /etd/hosts</span><br><span class="line"></span><br><span class="line">sed -ri <span class="string">'$a'</span><span class="string">"<span class="variable">$val1</span>"</span> /etd/hosts  <span class="comment"># 第一个单引号是`最后一行`，第二个里面是变量</span></span><br><span class="line"></span><br><span class="line">sed -ri <span class="string">"\$a<span class="variable">$val1</span>"</span> /etd/hosts   <span class="comment"># 把$a转义一下也行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat a.txt</span><br><span class="line">tac a.txt   <span class="comment"># 从后往前倒序（ sed -r '1!G; $!d' a.txt  推导一下弄明白  ）</span></span><br></pre></td></tr></table></figure>
<h4 id="九-awk"><a href="#九-awk" class="headerlink" title="九.awk"></a>九.awk</h4><p>   awk本身也是一种编程语言（ps:我们使用的不是纯粹的awk，而是gawk）</p>
<ul>
<li>sed是修改文件</li>
<li>awk是用来统计</li>
</ul>
<p><strong>语法格式</strong></p>
<p><code>awk [options] &#39;cmd&#39; filenames</code></p>
<p> options 选项</p>
<p><code>-F   指定分隔符，默认是空格或tab</code></p>
<p><strong>command</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># BEGIN&#123;&#125;			行处理前</span></span><br><span class="line"><span class="comment"># &#123;&#125;				行处理（有几行就处理几次）</span></span><br><span class="line"><span class="comment"># END				行处理后</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">'BEGIN&#123;print 1/2&#125; &#123;print "ok"&#125;END&#123;print "------"&#125;'</span> /etc/hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># BEGIN&#123;&#125;    通常用于定义一些变量，比如: BEGIN&#123;FS=":";OFS="---"&#125;  # OFS 输出时候的字段分隔符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":"&#125; &#123;print $1&#125;'</span> passwd   <span class="comment"># 在处理之前，(FS)就指定了分隔符</span></span><br></pre></td></tr></table></figure>
<p><strong>awk命令格式</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># awk 'pattern' filename 			</span></span><br><span class="line">awk <span class="string">'/root/'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># awk '&#123;action&#125;' filename 			</span></span><br><span class="line">awk -F: <span class="string">'&#123;print $3&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># awk 'pattern &#123;action&#125;' filename     </span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'/root/&#123;print $3&#125;'</span> /etc/passwd								</span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":"&#125; /root/&#123;print $3&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># command |awk 'pattern &#123;action&#125;' </span></span><br><span class="line">df -P |grep <span class="string">'/'</span> |awk <span class="string">'$4'</span>&gt;25000 &#123;<span class="built_in">print</span> <span class="variable">$4</span>&#125;    <span class="comment"># 除去第一行，如果大于25000就打印第四列</span></span><br></pre></td></tr></table></figure>
<p><strong>awk工作原理</strong></p>
<p><img src="/shell脚本基本知识/awk工作原理.png"></p>
<p><strong>记录与字段相关的<code>内部变量</code></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 可以通过 man awk 查看</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $0  awk变量保存当前记录的内容</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print $0&#125;'</span> /etc/passwd	</span><br><span class="line"></span><br><span class="line"><span class="comment"># NR  输入记录总的编号，显示行号</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print NR,$0&#125;'</span> /etc/passwd	 </span><br><span class="line"><span class="comment"># FNR  当前记录文件的编号(处理多个文件，每个文件重新开始编号)</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print FNR,$0&#125;'</span> /etc/passwd /etc/passwd  </span><br><span class="line"><span class="comment"># NF: 保存记录的字段数(这一行一共有多少字段),  $NF代表最后一个字段</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;print $0,NF,$NF&#125;'</span> /etc/passwd					</span><br><span class="line"></span><br><span class="line"><span class="comment"># FS 输入字段分隔符，默认空格或tab</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":"&#125; &#123;print $0&#125;'</span> /etc/passwd	              </span><br><span class="line">awk -F<span class="string">'[:\t]'</span> <span class="string">'&#123;print $0,NF,$NF&#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment"># OFS 输入字段分隔符，默认空格, OFS:输出分隔符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;FS=":";OFS="+++"&#125; &#123;print $0&#125;'</span> /etc/passwd	   </span><br><span class="line"></span><br><span class="line"><span class="comment"># RS --记录分隔符(区分与FS字段分隔符) 默认换行符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;RS=":"&#125; &#123;print $0&#125;'</span> /etc/passwd	</span><br><span class="line"><span class="comment"># ORS </span></span><br><span class="line">awk <span class="string">'BEGIN&#123;ORS=":"&#125; &#123;print $0&#125;'</span> /etc/passwd				</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将文件每一行合并为一行（ORS 输出记录分隔符）</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;ORS=""&#125; &#123;print $0&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p><strong>格式化输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.print</span></span><br><span class="line"><span class="comment"># 2.printf  可以格式化（默认没有换行，手动加\n）</span></span><br><span class="line">date |awk <span class="string">'&#123;print "Month:" $2"\nYear: " $NF&#125;'</span>  <span class="comment"># 只要不是变量，就要放到双引号里面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %s 字符串（-15s  15个字符，左对齐）  %f 浮点型， %d数值类型</span></span><br><span class="line">awk -F: <span class="string">'&#123;printf "%-15s %-10s %-15s\n", $1,$2,$3&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p><strong>awk模式和动作</strong></p>
<p>模式：条件语句，复合语句，正则表达式。 包括两个特殊字典：BEGIN和END</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 模式可以是</span></span><br><span class="line">=======   正则表达式</span><br><span class="line"><span class="comment"># 匹配记录（整行）</span></span><br><span class="line">awk <span class="string">'/^xps/'</span> /etc/passwd   <span class="comment"># awk '$0 ~ /^xps/' /etc/passwd   # ~  匹配</span></span><br><span class="line">awk <span class="string">'!/xps/'</span> /etc/passwd   <span class="comment"># awk '$0 !~ /^xps/' /etc/passwd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配字段：匹配操作符(~!~)</span></span><br><span class="line">awk -F: <span class="string">'$1 ~ /^xps/'</span> /etc/passwd   <span class="comment"># </span></span><br><span class="line">awk -F: <span class="string">'$NF !~ /^bash$/'</span> /etc/passwd  <span class="comment"># 最后一列不是以bash结尾的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   比较表达式</span><br><span class="line"><span class="comment"># 用于比较 数字 与 字符串</span></span><br><span class="line"><span class="comment"># &gt;     &lt;    == </span></span><br><span class="line">awk -F: <span class="string">'$3 == 0'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'$3 == "/xps/"'</span> /etc/passwd  <span class="comment"># == 全部等于</span></span><br><span class="line">awk -F: <span class="string">'$3 ~ /xps/'</span> /etc/passwd  <span class="comment"># 正则匹配</span></span><br><span class="line">awk -F: <span class="string">'$NF ~ /xps/'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   条件表达式</span><br><span class="line">awk -F: <span class="string">'$3&gt;200&#123;print $0&#125;'</span> /etc/passwd  <span class="comment"># $3大于200的，$0</span></span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">'&#123; if($3&gt;200) &#123;print $0&#125; &#125;'</span> /etc/passwd  <span class="comment"># 推荐这么写 &#123; if()&#123;cmd1;cmd2&#125; else&#123;&#125; &#125;</span></span><br><span class="line">awk -F: <span class="string">'&#123; if($3&gt;200) &#123;print $0&#125; else&#123;print $1&#125; &#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   算数运算</span><br><span class="line"><span class="comment">#awk都按浮点数方式执行算数运算</span></span><br><span class="line">awk -F: <span class="string">'$3 * 10 &gt; 500'</span> /etc/passwd    </span><br><span class="line">awk -F: <span class="string">'&#123; if($3*10&gt;500)&#123;print $0&#125; &#125;'</span> /etc/passwd    <span class="comment"># 如果$3*10&gt;500，就...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   逻辑操作符和复合模式</span><br><span class="line">&amp;&amp; 	逻辑与	</span><br><span class="line">||  逻辑或</span><br><span class="line">！  逻辑非</span><br><span class="line">awk -F: <span class="string">'$1~/root/ &amp;&amp; $3&lt;=15'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'$1~/root/ || $3&lt;=15'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'!($1~/root/ &amp;&amp; $3&lt;=15)'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======   范围模式</span><br><span class="line">awk <span class="string">'/Tom,/Susan/'</span> filename</span><br></pre></td></tr></table></figure>
<p><strong>awk脚本编程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### awk脚本编程</span></span><br><span class="line"></span><br><span class="line">====== 条件编程</span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if()&#123;&#125; else if()&#123;&#125; else&#123;&#125;&#125;'</span> passwd</span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if($3&gt;0 &amp;&amp; $3&lt;1000)&#123;count++&#125;&#125; END&#123;print count&#125;'</span> /etc/passwd   <span class="comment"># 统计系统用户数</span></span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if($3==0)&#123;count++&#125;&#125; else&#123;i++&#125; END&#123;print "管理员个数："count; print "系统用户个数:"i&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;if($3==0)&#123;i++&#125;&#125; else if($3&lt;999)&#123;j++&#125; else&#123;k++&#125; END&#123;print "管理员个数："i; print "普通用户个数:"j; print "系统用户个数:"k&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">====== 循环</span><br><span class="line"><span class="comment"># 1.while    依此打印每一列</span></span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;i=1;while(i&lt;7)&#123;print $i;i++&#125;&#125;'</span> /etc/passwd </span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'/^root/&#123;i=1;while(i&lt;7)&#123;print $i;i++&#125;&#125;'</span> /etc/passwd </span><br><span class="line">awk -F<span class="string">":"</span> <span class="string">'&#123;i=1;while(i&lt;=NF)&#123;print $i;i++&#125;&#125;'</span> /etc/passwd </span><br><span class="line">awk <span class="string">'&#123;i=1;while(i&lt;=NF)&#123;print $i;i++&#125;&#125;'</span> a.txt   <span class="comment"># 打印文件所有内容(默认是空格和tab分割)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.for</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;for(i=1;i&lt;=5;i++)&#123;prin i&#125;&#125;'</span>     <span class="comment"># c风格的</span></span><br><span class="line">awk -F: <span class="string">'&#123;for(i=1;i&lt;=NF;i++)&#123;prin $i&#125;&#125;'</span> passwd</span><br><span class="line">awk -F: <span class="string">'&#123;for(i=1;i&lt;=NF;i++)&#123;prin $0&#125;&#125;'</span> passwd     <span class="comment"># 将每行打印10次</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">====== 数组  (用来统计)</span><br><span class="line">awk -F: <span class="string">'&#123;username[++i]=$1&#125; END&#123;print username[1]&#125;'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'&#123;username[i++]=$1&#125; END&#123;print username[1]&#125;'</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">'&#123;username[i++]=$1&#125; END&#123;print username[0]&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">## 数组遍历(主要用按索引遍历)</span></span><br><span class="line"><span class="comment"># username数组名， 先保存到数组中，再进行遍历</span></span><br><span class="line">awk -F: <span class="string">'&#123;username[i++]=$1&#125; END&#123;for(i in username) &#123;print i,username[i]&#125;&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">'&#123;username[++i]=$1&#125; END&#123;for(i in username) &#123;print i,username[i]&#125;&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p><strong>基本练习</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### 基本练习</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 1. 统计/etc/passwd 中各种shell的数量</span></span><br><span class="line"><span class="comment"># # 把要统计的对象作为数组的索引(这里是最后一个$NF,也就是shell的类型)</span></span><br><span class="line">awk -F: <span class="string">'&#123;shells[$NF]++&#125; END&#123;for(i in shells)&#123;print i,shells[i]&#125;&#125;'</span> /etc/passwd  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2.网站访问状态统计</span></span><br><span class="line">netstat -ant |grep :80 |awk <span class="string">'&#123;access_stat[$NF]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;'</span> </span><br><span class="line"></span><br><span class="line">netstat -ant |grep :80 |awk <span class="string">'&#123;access_stat[$NF]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;'</span> |sort -k2 -n |head</span><br><span class="line"></span><br><span class="line">ss -ant |grep :80 |awk <span class="string">'&#123;access_stat[$2]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;'</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 3.统计当前访问的每个IP的数量 &lt;当前实时状态 netstat, ss&gt;</span></span><br><span class="line">netstat -ant |grep :80 |awk -F: <span class="string">'&#123;ip_count[$8]++&#125; END&#123;for(i in ip_count)&#123;print i,ip_count[i]&#125;&#125;'</span> </span><br><span class="line"><span class="comment"># 下面这个有点复杂了，不推荐用</span></span><br><span class="line">ss -ant |grep :80 |awk -F: <span class="string">'!/LISTEN/&#123;ip_count[$(NF-1)]++&#125; END&#123;for(i in ip_count)&#123;print i,ip_count[i]&#125;&#125;'</span> |sort 0k2 -rn |head 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 4.统计Apache/Nginx日志中某一天的PV量 &lt;统计日志&gt;</span></span><br><span class="line">grep <span class="string">'07/Aug/2019'</span> access.log |wc -l    <span class="comment"># wc -l  统计行数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 4.统计Apache/Nginx日志中某一天不通IP的PV量 &lt;统计日志&gt;</span></span><br><span class="line">grep <span class="string">'07/Aug/2019'</span> access.log |awk <span class="string">'&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;'</span> |sort -k2 -rn | head</span><br><span class="line"></span><br><span class="line">awk <span class="string">'/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt;100的才打印（此方法有点low，可用下面的几种方法）</span></span><br><span class="line">awk <span class="string">'/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;'</span> | awk <span class="string">'$2&gt;100'</span> |sort -k2 -rn | head  </span><br><span class="line"></span><br><span class="line">awk <span class="string">'/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;if(ips[i]&gt;100)&#123;print i, ips[i]&#125;&#125;&#125;'</span> | </span><br><span class="line"><span class="comment"># &gt;100的才打印</span></span><br><span class="line">awk <span class="string">'$2&gt;100'</span> |sort -k2 -rn | head  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#【思路】 将要统计的字段作为数组的索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### awk函数</span></span><br><span class="line"><span class="comment"># 统计用户名为4个字符的用户</span></span><br><span class="line">awk -F: <span class="string">'$1~/^....$/&#123;count++;print $1&#125; END&#123;print "count is:" count&#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment"># length</span></span><br><span class="line">awk -F: <span class="string">'length($1)==4&#123;count++;print $1&#125; END&#123;print "count is:" count&#125;'</span> /etc/passwd </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### awk自定义变量(外部变量)</span></span><br><span class="line"><span class="comment"># 1.再双引号里面</span></span><br><span class="line">var=bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"unix script"</span> |awk <span class="string">"gsub(/unix/, \"<span class="variable">$var</span>\")"</span>   <span class="comment"># 转义双引号，里面是$变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.两个双引号里面套个单引号</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"unix script"</span> |awk <span class="string">'gsub(/unix/, "'</span><span class="string">"<span class="variable">$var</span>\"'"</span>)<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string">df -h |awk '</span>&#123; <span class="keyword">if</span>(int(<span class="variable">$5</span>)&gt;10)&#123;<span class="built_in">print</span> <span class="variable">$6</span><span class="string">":"</span><span class="variable">$5</span>&#125; &#125;<span class="string">'</span></span><br><span class="line"><span class="string"># 再函数外面单引号情况下</span></span><br><span class="line"><span class="string">i=10</span></span><br><span class="line"><span class="string">df -h |awk '</span>&#123; <span class="keyword">if</span>(int(<span class="variable">$5</span>)&gt;<span class="string">''</span><span class="string">'$i'</span><span class="string">''</span>)&#123;<span class="built_in">print</span> <span class="variable">$6</span><span class="string">":"</span><span class="variable">$5</span>&#125; &#125;<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 3.建议： -v</span></span><br><span class="line"><span class="string">awk -v user=root -F:'</span><span class="variable">$1</span> == user<span class="string">' /etc/passwd  # 在-v的时候定义变量user=root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var=bash</span></span><br><span class="line"><span class="string">echo "unix script" |awk "gsub(/unix/, var)" </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 前面造一条命令，传给bash执行</span></span><br><span class="line"><span class="string">arp -n |awk '</span>/^[0-9]/&#123;<span class="built_in">print</span> <span class="string">"arp -d <span class="variable">$1</span>"</span>&#125;<span class="string">' |bash</span></span><br></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>实践中再写…..</p>
<h2 id="附"><a href="#附" class="headerlink" title="附"></a>附</h2><p>其他参考文章：</p>
<p><a href="https://blog.csdn.net/u011436427/article/details/103815680" target="_blank" rel="noopener">https://blog.csdn.net/u011436427/article/details/103815680</a></p>
<p><a href="https://mp.weixin.qq.com/s/dXLlFgQS_3KHm8YRyDC7ZQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/dXLlFgQS_3KHm8YRyDC7ZQ</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果你觉得这篇文章还满意的话，请我喝杯咖啡喝吧^_^</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="浮生 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="浮生 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    浮生
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://www.xpshuai.cn/shell脚本基本知识/" title="shell脚本基本知识">http://www.xpshuai.cn/shell脚本基本知识/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"> <i class="fa fa-tag"></i> Linux</a>
          
            <a href="/tags/Shell/" rel="tag"> <i class="fa fa-tag"></i> Shell</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/工具-tcpdump使用&过程文档记录/" rel="next" title="工具 - tcpdump使用&过程文档记录">
                <i class="fa fa-chevron-left"></i> 工具 - tcpdump使用&过程文档记录
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/ubuntu server-账号管理/" rel="prev" title="ubuntu server-账号管理">
                ubuntu server-账号管理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/tx.jpg" alt="浮生">
            
              <p class="site-author-name" itemprop="name">浮生</p>
              <p class="site-description motion-element" itemprop="description">侠之大者，为国为民</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">107</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          



          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/shuai06" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/qq_37622608" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-copyright"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          <div id="music163player">
              <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="298" height="52" src="//music.163.com/outchain/player?type=2&id=247172&auto=0&height=32"></iframe>
          </div>

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://muyuuuu.github.io/" title="兰铃" target="_blank">兰铃</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.aigisss.com/" title="aigisss" target="_blank">aigisss</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.blts.xyz/" title="帅气小学弟" target="_blank">帅气小学弟</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://zlh.giserhub.com" title="GIS大神阿昊哥" target="_blank">GIS大神阿昊哥</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.xbeichen.cn/" title="X北辰北" target="_blank">X北辰北</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.farmsec.cn/" title="农夫安全博客" target="_blank">农夫安全博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.xiaodi8.com/" title="小迪渗透吧" target="_blank">小迪渗透吧</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#应用场景"><span class="nav-number">1.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本用法"><span class="nav-number">2.</span> <span class="nav-text">基本用法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一-常识"><span class="nav-number">2.0.1.</span> <span class="nav-text">一.常识</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二-变量"><span class="nav-number">2.0.2.</span> <span class="nav-text">二.变量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#位置变量"><span class="nav-number">2.0.2.1.</span> <span class="nav-text">位置变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#预定义变量"><span class="nav-number">2.0.2.2.</span> <span class="nav-text">预定义变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#环境变量"><span class="nav-number">2.0.2.3.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义变量"><span class="nav-number">2.0.2.4.</span> <span class="nav-text">自定义变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#变量的赋值"><span class="nav-number">2.0.2.5.</span> <span class="nav-text">变量的赋值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用变量"><span class="nav-number">2.0.2.6.</span> <span class="nav-text">使用变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#变量引用"><span class="nav-number">2.0.2.7.</span> <span class="nav-text">变量引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#变量的运算"><span class="nav-number">2.0.2.8.</span> <span class="nav-text">变量的运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#变量的删除-替换"><span class="nav-number">2.0.2.9.</span> <span class="nav-text">变量的删除/替换</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三-条件判断"><span class="nav-number">2.0.3.</span> <span class="nav-text">三.条件判断</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#if"><span class="nav-number">2.0.3.1.</span> <span class="nav-text">if</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#switch"><span class="nav-number">2.0.3.2.</span> <span class="nav-text">switch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#各种符号"><span class="nav-number">2.0.3.3.</span> <span class="nav-text">各种符号</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#四-循环"><span class="nav-number">2.0.4.</span> <span class="nav-text">四.循环</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#for循环"><span class="nav-number">2.0.4.1.</span> <span class="nav-text">for循环</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#while循环"><span class="nav-number">2.0.4.2.</span> <span class="nav-text">while循环</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#until循环"><span class="nav-number">2.0.4.3.</span> <span class="nav-text">until循环</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#并发"><span class="nav-number">2.0.4.4.</span> <span class="nav-text">并发</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#expect"><span class="nav-number">2.0.4.5.</span> <span class="nav-text">expect</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#五-数组"><span class="nav-number">2.0.5.</span> <span class="nav-text">五.数组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#六-函数"><span class="nav-number">2.0.6.</span> <span class="nav-text">六.函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#七-正则"><span class="nav-number">2.0.7.</span> <span class="nav-text">七.正则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#八-sed"><span class="nav-number">2.0.8.</span> <span class="nav-text">八.sed</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#九-awk"><span class="nav-number">2.0.9.</span> <span class="nav-text">九.awk</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#实例"><span class="nav-number">3.</span> <span class="nav-text">实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附"><span class="nav-number">4.</span> <span class="nav-text">附</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">  <i class="fa fa-heart"></i>   </span>
  <span class="author" itemprop="copyrightHolder">浮生</span> |

  <div class="powered-by">
    由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
  </div>

</div>



<script language="javascript">
  function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000;
    var minutes = seconds * 60;
    var hours = minutes * 60;
    var days = hours * 24;
    var years = days * 365;
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
    year - 作为date对象的年份，为4位年份值
    month - 0-11之间的整数，做为date对象的月份
    day - 1-31之间的整数，做为date对象的天数
    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
    minutes - 0-59之间的整数，做为date对象的分钟数
    seconds - 0-59之间的整数，做为date对象的秒数
    microseconds - 0-999之间的整数，做为date对象的毫秒数 */
    var t1 = Date.UTC(2019,04,20,15,00,00); //北京时间2018-2-13 00:00:00
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = t2-t1;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
    document.getElementById("sitetime").innerHTML=" 博客已健康运行"+ diffYears+" 年 "+ diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
  }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
  siteTime();
</script>

<span id="sitetime"></span>

<div class="BbeiAn-info">
    冀ICP备 -
    <a target="_blank" href="http://www.miitbeian.gov.cn/" style="color:#f0d784" rel="nofollow">18027796-1</a> <!--a标签中增加nofollow属性，避免爬虫出站。-->
</div>


        
<div class="busuanzi-count">
  <script async src https: busuanzi.ibruce.info busuanzi 2.3 busuanzi.pure.mini.js""></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'zlxLDm8dLo0s1Vz10PEvfuNh-gzGzoHsz',
        appKey: 'UAKrQBSOGPavRUKC9ztdFBLK',
        placeholder: '欢迎发表意见',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  

  


  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>

<!-- canvas曲线 -->

<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>



<!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>

</body>
</html>
