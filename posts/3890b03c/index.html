<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="upload-labs通关记录, 技术博客, 网络安全, 信息安全, IT, 计算机, 学习">
    <meta name="description" content="技术博客, 网络安全, 信息安全, IT, 计算机, 学习">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>upload-labs通关记录 | 剑胆琴心</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">剑胆琴心</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">剑胆琴心</div>
        <div class="logo-desc">
            
            技术博客, 网络安全, 信息安全, IT, 计算机, 学习
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/shuai06" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/shuai06" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/8.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">upload-labs通关记录</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    .toc-fixed .toc-link::before{
        position: fixed!important;/*当toc的位置改为fixed时，.toc-link::before也要改为fixed*/
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/渗透测试/">
                                <span class="chip bg-color">渗透测试</span>
                            </a>
                        
                            <a href="/tags/文件上传/">
                                <span class="chip bg-color">文件上传</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/渗透测试/" class="post-category">
                                渗透测试
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-17
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    4.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    19 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>本文主要记录一下<code>upload-labs</code>最新21关卡的过程，作为自己的一个笔记。</p>
<blockquote>
<p>靶场地址：<a href="https://github.com/c0ny1/upload-labs/" target="_blank" rel="noopener">https://github.com/c0ny1/upload-labs/</a></p>
</blockquote>
<p><strong>ps：</strong></p>
<p>- 为了快速验证效果，此处上传的webshell代码为<code>&lt;php? phpinfo(); ?&gt;</code></p>
<p>- 解题思路五花八门，我这里想起了啥就用啥。</p>
<p>- 因为比较菜，所以做题直接看代码了就(谁料有的题目看了代码都看不懂)，哈哈哈。</p>
<p><img src="http://image.xpshuai.cn/20200218195326654_1642698147.png"></p>
<h2 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h2><pre><code>trim()  去除空格


strrchr()查找字符串在另一个字符串中`最后一次`出现的位置，并返回从该位置到字符串结尾的所有字符。

strrchr("被查找的字符串", "出现的字符串")

strstr() - 查找字符串的首次出现

strrpos() - 计算指定字符串在目标字符串中最后一次出现的位置

str_ireplace('要替换的对象','替换为','字符串')


deldot($file_name);//删除文件名末尾的点


::$DATA ---&gt; win上，会把`::$DATA`之后的数据当成文件流处理，不会检测后缀名，而且保持`::$DATA`之前的文件名（目的是不检查后缀名）


pathinfo(path,options)返回一个关联数组包含有 path 的信息。

包括以下的数组元素：

[dirname]

[basename]

[extension]


第二个参数可能的值：

PATHINFO_DIRNAME - 只返回 dirname

PATHINFO_BASENAME - 只返回 basename

PATHINFO_EXTENSION - 只返回 extension

注释：如果不是要求取得所有单元，则 pathinfo() 函数返回字符串。


intval() 函数用于获取变量的整数值。


@uppack




`rename()` 函数 ：重命名文件或目录。如果成功，该函数返回 TRUE。如果失败，则返回 FALSE。rename(oldname,newname,context)


</code></pre><h2 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h2><blockquote>
<p>js验证</p>
</blockquote>
<p>点击上传文件之后，burp没有拦截到数据包，并且验证反应速度快</p>
<p>F12查看代码后确认</p>
<h6 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h6><p><strong>F1: </strong></p>
<p>禁用js，直接上传php</p>
<p><img src="http://image.xpshuai.cn/20200217215459803_1606358356.png"></p>
<p>成功：</p>
<p><img src="http://image.xpshuai.cn/20200217215605878_1982942629.png"></p>
<p><strong>F2：</strong></p>
<p>在本地创建html，action为服务器请求地址，（去掉相应js部分）</p>
<p><strong>F3:</strong></p>
<p>先把shell改为允许的类型,再bup中再改回来</p>
<p>效果都是一样的</p>
<h2 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h2><blockquote>
<p>服务端验证 – 文件MIME类型</p>
</blockquote>
<p>只检测文件自带的类型</p>
<p><img src="http://image.xpshuai.cn/20200217215941532_643347454.png"></p>
<h5 id="绕过："><a href="#绕过：" class="headerlink" title="绕过："></a>绕过：</h5><p>burp修改数据包中修改MIME类型（Content-Type）为允许的类型</p>
<p><img src="http://image.xpshuai.cn/20200217220124560_567357512.png"></p>
<h1 id="Pass03-Pass10-黑名单校验"><a href="#Pass03-Pass10-黑名单校验" class="headerlink" title="Pass03-Pass10:      黑名单校验"></a>Pass03-Pass10:      黑名单校验</h1><h2 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h2><blockquote>
<p>服务端验证(黑名单方式) – 多种格式后缀解析</p>
</blockquote>
<p>对上传的文件先过滤，后判断文件后缀，再随机命名</p>
<p><img src="http://image.xpshuai.cn/20200217220446232_1542284348.png"></p>
<p><strong>比如：</strong>         a.php</p>
<p>先删掉文件名前后的空格</p>
<p>删除末尾的点：  a.php</p>
<p>strrchr之后：      .php</p>
<p>转换为小写：     .php</p>
<p>去除字符串::$DATA</p>
<p>再收尾去空格</p>
<p>最后加上日期重命名</p>
<h6 id="绕过-1"><a href="#绕过-1" class="headerlink" title="绕过"></a>绕过</h6><blockquote>
<p>前提:  <code>httpd-conf</code>文件中<code>AddType application/x-httpd-php</code> 没有被注释，而且有规定类型的文件</p>
</blockquote>
<p>对 phtml，php3，php4，php5，pht，htaccess没有进行过滤，那么利用这两种方法进行绕过。</p>
<p><strong>补充:</strong></p>
<p>asp:   asa, cer, cdx 等</p>
<p>jsp:   jspx, jspf</p>
<p>aspx:   ashx,asmx,ascx</p>
<p><strong>准备工作：</strong></p>
<p>修改httpd-conf配置文件,这里可以把php3等想要的文件后缀加上，再把注释符#去掉</p>
<p>此类的正则表达式，文件名字满足即可在apache当做php解析。比如以下格式的文件：</p>
<p>php3，php4, php5, phtml，phps</p>
<p>修改为： <code>AddType application/x-httpd-php .php .phtml .php3 .php4 .php5 .phps</code></p>
<p><strong>F1:  修改后缀名</strong></p>
<p>burp拦截数据包，修改filename为<code>php3</code>,上传成功</p>
<p>右键图片查看地址, 从这里可以得知上传的文件被重命名了,  打开图片地址，OK</p>
<p><strong>F2:  上传图片马</strong></p>
<p>上传图片马，然后利用BP拦截，将后缀名 <code>改为phtml,php3,php4,php5,pht</code></p>
<p><img src="http://image.xpshuai.cn/20200218144512768_1843220897.png"></p>
<p>​    </p>
<p>​    </p>
<h2 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h2><blockquote>
<p>服务端（php5之类的也进行了过滤）</p>
</blockquote>
<p><img src="http://image.xpshuai.cn/20200217222608134_260661208.png"></p>
<p>但是没有过滤<code>.htaccess</code>，可以考虑重写文件解析规则绕过</p>
<p>info.php.jpg.</p>
<h6 id="绕过-2"><a href="#绕过-2" class="headerlink" title="绕过"></a>绕过</h6><blockquote>
<p>前提: apache搭建，  没有对上传文件重命名</p>
</blockquote>
<p><strong>.htaccess文件</strong></p>
<p>1.先上传一个<code>.htaccess</code>文件，内容如下：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FilesMatch</span> <span class="token attr-name">"jpg"</span><span class="token punctuation">></span></span>

SetHandler application/x-httpd-php

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FilesMatch</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.然后再上传一个info.php, burp拦截数据包修改filename为<code>info.jpg</code>   / 或者直接上图片马， url访问图片路径，正常解析</p>
<h2 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h2><p><img src="http://image.xpshuai.cn/20200217223711503_294591319.png"></p>
<p>连.htaccess都放黑名单了</p>
<p><strong>缺陷：</strong></p>
<p><code>strrchr函数</code>：  搜索参数在字符串中的位置，并返回从该位置到字符串结尾的所有字符</p>
<p>如果有多个，匹配的是<code>最后一个</code>（这里并没有进行递归检测，前面的就会漏掉）</p>
<p>如果是<code>a.php. jpg.</code>是不能正常解析的，但是<code>a.php.  .</code>就行</p>
<h6 id="绕过：-1"><a href="#绕过：-1" class="headerlink" title="绕过："></a>绕过：</h6><p>多写一个空格和点：上传文件 <code>info.php</code>， burp修改file为<code>info.php. .</code></p>
<p><strong>比如：</strong></p>
<pre><code>a.php.  .
</code></pre><p>去空：<code>a.php.  .</code></p>
<p>删除末尾点：<code>a.php.</code>        最后一个点被deldot删除</p>
<p>返回最后一个点的内容<code>.</code>       第二个strrchr匹配了第一个点和后面的空格</p>
<p>前后去空：后缀为<code>.</code>, 不在黑名单范围，成功绕过</p>
<p>最后上传文件名为：<code>a.php.</code>, 在windows保存文件的之后的<code>.</code>会消失</p>
<p>如下图，win服务器保存的文件：</p>
<p><img src="http://image.xpshuai.cn/20200217224221081_348766282.png"></p>
<p>正常解析：</p>
<p><img src="http://image.xpshuai.cn/20200217224244474_173158029.png"></p>
<h2 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h2><p><img src="http://image.xpshuai.cn/20200218145809732_1096167348.png"></p>
<p>没有进行后缀名大小写转换</p>
<h6 id="绕过-3"><a href="#绕过-3" class="headerlink" title="绕过"></a>绕过</h6><p>burp修改filename后缀名为<code>.phP</code>，绕过检测，上传OK</p>
<p>正常解析</p>
<p><img src="http://image.xpshuai.cn/20200218150044751_461792168.png"></p>
<h2 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h2><p><img src="http://image.xpshuai.cn/20200218150316897_1558000982.png"></p>
<p>最后没有将后缀首尾去空</p>
<p>可以利用win文件名字保存格式的特性: 比如最后一个为空格<code>info.php</code>, </p>
<p><code>.php</code>不在黑名单<code>.php</code>等中，成功绕过，</p>
<p>并且windows保存的时候会把最后的空格去除</p>
<h6 id="绕过-4"><a href="#绕过-4" class="headerlink" title="绕过"></a>绕过</h6><p>burp修改filename为<code>info.php</code>，后面加一个空格，上传</p>
<h2 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h2><p><img src="http://image.xpshuai.cn/20200218151055198_961499757.png"></p>
<p>少了提前删除文件名末尾的点 的功能(deldot)；</p>
<p><code>strrchr</code>过滤匹配的是最后一个点；</p>
<p>没有对上传的文件重命名</p>
<h6 id="绕过-5"><a href="#绕过-5" class="headerlink" title="绕过:"></a>绕过:</h6><p><strong>F1： 后缀名加点绕过</strong></p>
<p>burp修改文件名，</p>
<pre><code>a.php.
</code></pre><p><code>a.php.</code>可以带空格</p>
<p>上传。</p>
<p><strong>F2：利用Windows解析漏洞（后缀修改为1.php:1.jpg）</strong></p>
<pre><code>1.php:1.jpg
</code></pre><p>没成功： 上传的是<code>1.php</code>，但是文件内容是空的了</p>
<p>​    </p>
<p>​    </p>
<h2 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h2><blockquote>
<p>Windows文件流绕过</p>
</blockquote>
<p><img src="http://image.xpshuai.cn/20200218152924608_961861669.png"></p>
<p>少了 <code>$file_ext = str_ireplace('::$DATA', '', $file_ext);//去除字符串::$DATA</code>    –&gt; 含义：把后缀中是 ::DATA替换为空  </p>
<p><code>str_ireplace('要替换的对象','替换为','字符串')</code>函数</p>
<p>由上可知，文件<code>没有对后缀名进行去”::DATA”处理</code>。</p>
<p>php在window的时候如果文件名+”::DATA”处理。php在window的时候如果文件名+”::DATA”处理。php在window的时候如果文件名+”::DATA”会把::DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::DATA”之前的文件名 他的目的就是不检查后缀名。</p>
<blockquote>
<p>ps:只能是Windows系统，并且只能时php文件</p>
</blockquote>
<h6 id="绕过-6"><a href="#绕过-6" class="headerlink" title="绕过"></a>绕过</h6><pre><code>info.php::$DATA
</code></pre><p>1.如图 ，在BP中修改图片马的 jpg 的后缀名，将其改为 php ，并且在后面加上 ::$DATA ;</p>
<p><img src="http://image.xpshuai.cn/20200218161807873_1645216989.png"></p>
<p>2.在网页上检查图片马的执行情况时，将图片马的后缀名中 ::$DATA ，删去，便可浏览。</p>
<p>如图，这个是没有去掉后缀时，会发生报错。（因为我们实际上传的是PHP文件，即upload文件夹中只有php文件，而不存在带有后缀 ::$DATA的文件）</p>
<p><img src="http://image.xpshuai.cn/20200218162201913_251841335.png"></p>
<h1 id="Pass-10-11-（将filename拼接路径会带来极大风险）"><a href="#Pass-10-11-（将filename拼接路径会带来极大风险）" class="headerlink" title="Pass 10 - 11 （将filename拼接路径会带来极大风险）"></a>Pass 10 - 11 （将filename拼接路径会带来极大风险）</h1><h2 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h2><p><img src="http://image.xpshuai.cn/20200218163307924_285954321.png"></p>
<h6 id="绕过-7"><a href="#绕过-7" class="headerlink" title="绕过"></a>绕过</h6><p><strong>构造后缀名点空绕过</strong></p>
<p><code>strrchr</code>函数 搜索参数在字符串中的位置，并返回从该位置到字符串结尾的所有字符</p>
<p>如果有多个，匹配的是最后一个（前面的就会漏掉</p>
<p>由上可知，该关进行的是现在文件末尾先去点，再去空便没有再做任何处理，因此我们可以利用这个漏洞，构造后缀名为php+点+空+点</p>
<p>burp修改文件名<code>info.php. .</code></p>
<p><img src="http://image.xpshuai.cn/20200218163126238_1032488863.png"></p>
<h2 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h2><blockquote>
<p>双写绕过</p>
</blockquote>
<p>没有strrchr</p>
<p><img src="http://image.xpshuai.cn/20200218163843491_1975433720.png"></p>
<p>str_ireplace函数：</p>
<p><code>str_ireplace('要替换的对象','替换为','字符串')</code>,   他把我们的php后缀替换为空</p>
<p><strong>函数缺陷：</strong></p>
<p>只是执行一次/或者没采用递归过滤</p>
<h6 id="绕过-8"><a href="#绕过-8" class="headerlink" title="绕过"></a>绕过</h6><p>扰乱，删除里面后，外面还能组合成功后缀</p>
<p>burp修改filename=<code>info.pphphp</code></p>
<p>info.pphphp — &gt; ‘info.php’</p>
<p><img src="http://image.xpshuai.cn/20200218163953790_921378631.png"></p>
<h1 id="Pass-12-13-将filename当做变量加入最终路径会带来极大风险"><a href="#Pass-12-13-将filename当做变量加入最终路径会带来极大风险" class="headerlink" title="Pass 12 - 13 将filename当做变量加入最终路径会带来极大风险"></a>Pass 12 - 13 将filename当做变量加入最终路径会带来极大风险</h1><h2 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass - 12"></a>Pass - 12</h2><blockquote>
<p>GET请求，URL网页上00截断</p>
</blockquote>
<blockquote>
<p>前提条件：php5.34以下， magic_quotes_gpc为off状态</p>
</blockquote>
<p><strong>魔术引号 magic_quotes_gpc 作用</strong>： 对（反斜杠？，单引号，双引号，none）产生影响, 自动加上/</p>
<p><strong>白名单绕过</strong></p>
<p>)<img src="http://image.xpshuai.cn/20200218165050537_741059186.png"></p>
<p>save_path可控， <code>$_GET['save_path']</code> 通过get获取，可以把get中url参数带上00截断</p>
<p>%00 截断（类似注释符号，后面的不再执行）</p>
<blockquote>
<p>Note： %00 是URL编码后的结果， 选中，解码转换（url decode）为小方块，才是真正的%00, Hex下是00</p>
</blockquote>
<p>数据包中 <code>save_path=../upload/shell.php%00</code> （注意 url_decode）后面的就没用了，filename=”shell.jpg”</p>
<p>由源码可知，图片的save_path通过get传递，然后和后缀ima_path直接拼接而成的，所以我们可以直接使用 %00 截断，将后缀名 .jpg 截断，从而以 php 运行</p>
<h6 id="绕过-9"><a href="#绕过-9" class="headerlink" title="绕过"></a>绕过</h6><p>URI中00截断</p>
<p><strong>方法一：拦包00截断</strong></p>
<p>由于是在get的url中，<code>%00</code>就不进行decode了，</p>
<p><img src="http://image.xpshuai.cn/20200218170335768_2032329037.png"></p>
<p>上传成功：</p>
<p>查看图片路径：</p>
<p><img src="http://image.xpshuai.cn/20200218170644694_1142415094.png"></p>
<p>查看服务器保存文件：</p>
<p><img src="http://image.xpshuai.cn/20200218170437679_903547409.png"></p>
<p>访问的时候，去掉后面的jpg，只访问php，OK：</p>
<p><img src="http://image.xpshuai.cn/20200218170513646_522012281.png"></p>
<p><strong>方法二：前端直接修改为 “php+00截断”格式</strong></p>
<p>如下可得，直接将参数save_path修改为php+00截断的格式，因此它会将之后上传的所有文件以PHP的格式进行解析。</p>
<p>ps:图片是盗取的</p>
<p><img src="http://image.xpshuai.cn/20200218170957259_1424254637.png"></p>
<p>burp只修改下面的filename为<code>x.jpg</code>即可</p>
<h2 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass - 13"></a>Pass - 13</h2><blockquote>
<p>POST请求，00截断</p>
</blockquote>
<p><strong>白名单绕过</strong></p>
<p><img src="http://image.xpshuai.cn/20200218165118835_726563878.png"></p>
<p><strong>F1:</strong></p>
<p>同12关，只是修改的地方不同</p>
<p><strong>1.</strong>burp拦截。在post后面加上<code>info.php%00</code> (%00是url decode之后的)，再发送即可</p>
<p><img src="http://image.xpshuai.cn/20200218172018042_1656668337.png"></p>
<p><strong>2.</strong>burp拦截，然后在上面的upload 的后面加上 <code>123.php+</code>（这里的123可以为任何名字，他只是一个代号。并且 php后面的 <code>+</code>好也是一个标记，他的二进制代码为 <code>2b</code>）</p>
<p>由上可知，将二进制中的 + 改为 00 截断，即将 + 的二进制码 2b 改为 <code>00</code> .</p>
<p><img src="http://image.xpshuai.cn/20200218171415601_503298826.png"></p>
<p>同样，访问的时候访问php文件：</p>
<p><img src="http://image.xpshuai.cn/20200218171807564_1778234073.png"></p>
<p><strong>F2 意外发现：文件覆盖</strong></p>
<p><img src="http://image.xpshuai.cn/20200218172227317_2113414909.png"></p>
<p>由于名字可以不相同，即我们可以任意定义uploads旁边的 PHP 文件名，如果将文件名改为uploads中本身存在的文件，那么新的文件将会覆盖原来的文件。</p>
<p><img src="http://image.xpshuai.cn/20200218172321670_308115506.png"></p>
<h2 id="Pass-20-（也是类似的，便于比较就放这里了）"><a href="#Pass-20-（也是类似的，便于比较就放这里了）" class="headerlink" title="Pass - 20 （也是类似的，便于比较就放这里了）"></a>Pass - 20 （也是类似的，便于比较就放这里了）</h2><p><img src="http://image.xpshuai.cn/20200218172852998_939565232.png"></p>
<p><img src="http://image.xpshuai.cn/20200218172525227_655899960.png"></p>
<p>这里进行过滤的是他的那个文件名，而不是我们上传文件最开始的文件名，所以要在他的文件名上做手脚</p>
<p><code>$file_ext = pathinfo($file_name,PATHINFO_EXTENSION)</code>   返回拓展后缀</p>
<p>这里的文件名<code>filename</code>是可控的：  <code>$_POST['save_name']</code></p>
<h6 id="绕过-10"><a href="#绕过-10" class="headerlink" title="绕过"></a>绕过</h6><p> 我们可以在save_path中加入php+00截断，由于是POST发送方式，因此我们需进行00截断。<code>111.php%00upload-19.jpg</code> （注意url decode）</p>
<p><img src="http://image.xpshuai.cn/20200218174147577_857047164.png"></p>
<p>上传OK：</p>
<p><img src="http://image.xpshuai.cn/20200218174246606_1092693624.png"></p>
<p>去掉00后面内容，访问php，正常解析</p>
<p><img src="http://image.xpshuai.cn/20200218174323338_682125752.png"></p>
<h1 id="Pass14-17-（文件包含漏洞）"><a href="#Pass14-17-（文件包含漏洞）" class="headerlink" title="Pass14 - 17 （文件包含漏洞）"></a>Pass14 - 17 （文件包含漏洞）</h1><h2 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass - 14"></a>Pass - 14</h2><blockquote>
<p>获取文件头进行了验证</p>
</blockquote>
<p><strong>图片马制作：</strong></p>
<p>win下：copy a.jpg /b + b.php /a shell.jpg</p>
<p>Linux下：cat a.jpg b.php &gt; shell.jpg</p>
<p>文件包含漏洞（xx.php?file=uploads/x.jpg） 文件不限格式后缀</p>
<p><strong>意义</strong>：如果存在包含漏洞，需要上传一张图片(图片马)，就可以getshell</p>
<p><img src="http://image.xpshuai.cn/20200218175651617_999905544.png"></p>
<p><code>$strInfo = @unpack("C2chars", $bin);</code>// C为无符号整数，网上搜到的都是c，为有符号整数，这样会产生负数判断不正常</p>
<p><code>$bin = fread($file, 2);</code> //只读2字节进行验证</p>
<p>表示只是对文件头做了检测</p>
<p> <code>$strInfo = @unpack("C2chars", $bin);</code> 标示前两个字符按照，c格式，数组索引chars1,chars2                @unpack</p>
<p> <code>$typeCode = intval($strInfo['chars1'].$strInfo['chars2']);</code></p>
<p><strong>文件头：</strong> 不同后缀类型文件头部代码中有GIF89a,NG,PK,7Z， 部分验证会验证文件头</p>
<blockquote>
<p>常见文件头：<a href="https://blog.csdn.net/xiangshangbashaonian/article/details/80156865" target="_blank" rel="noopener">https://blog.csdn.net/xiangshangbashaonian/article/details/80156865</a></p>
</blockquote>
<p><strong>突破：</strong> 伪造可行的文件头</p>
<h6 id="绕过-11"><a href="#绕过-11" class="headerlink" title="绕过"></a>绕过</h6><p>上传图片马，上传。打开测试页面，引用刚才的图片马</p>
<h2 id="Pass-15-getimagesize"><a href="#Pass-15-getimagesize" class="headerlink" title="Pass - 15    getimagesize"></a>Pass - 15    getimagesize</h2><p><img src="http://image.xpshuai.cn/20200218185841047_937742626.png"></p>
<p>函数拓展：<code>getimagesize（）</code>   判断是否为一个完整的图像</p>
<p>索引2<code>$info[2]</code> 是图像的类型</p>
<p><img src="http://image.xpshuai.cn/20200218185758469_1439877358.png"></p>
<p>image_type_to_extension 获取的是MIME类型</p>
<pre class="line-numbers language-ph"><code class="language-ph">$info = getimagesize($filename);

$ext = image_type_to_extension($info[2]);  # 获取后缀jpeg  ,   $info[2] 是文件类型


if(stripos($types,$ext)>=0)  # 是否在白名单中
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h6 id="绕过-12"><a href="#绕过-12" class="headerlink" title="绕过"></a>绕过</h6><p>上传图片马，</p>
<p>打开测试页面，直接包含<code>include</code>file=’文件.jpg’, 就是当成php解析</p>
<h2 id="Pass-16-php-exif模块"><a href="#Pass-16-php-exif模块" class="headerlink" title="Pass - 16   php_exif模块"></a>Pass - 16   php_exif模块</h2><p><img src="http://image.xpshuai.cn/20200218185919196_54375063.png"></p>
<p>函数拓展：<code>exif_imagetype（）</code></p>
<p><img src="http://image.xpshuai.cn/20200218190317887_1240325255.png"></p>
<p>php_exif模块来判断文件类型</p>
<p>版本：PHP&gt;=4.3.0,  PHP5, PHP7</p>
<h6 id="绕过-13"><a href="#绕过-13" class="headerlink" title="绕过"></a>绕过</h6><p>需要开启<code>php_exif</code>模块：</p>
<p>1.打开配置文件，php拓展，<code>php_exif</code>打开；</p>
<p>2.配置文件在<code>php.ini</code>,分号是注释，可以直接解除注释启用,并将此行移动到extension=php_exif.dll之前，使之首先加载*。</p>
<p><img src="http://image.xpshuai.cn/20200218220405641_1769279545.png"></p>
<p>上传图片马（注意MIME与后缀和文件头要一直，然后打开测试页面，包含gif，OK</p>
<h2 id="Pass-17-（图片二次编码）"><a href="#Pass-17-（图片二次编码）" class="headerlink" title="Pass - 17   （图片二次编码）"></a>Pass - 17   （图片二次编码）</h2><p>其实就是检测两次</p>
<p><strong>本质：</strong> 检测 MIME和后缀是否对应</p>
<p><strong>原理：</strong> 将一个正常显示的图片，上传到服务器。寻找图片被渲染后与原始图片部分对比仍然相同的数据块部分，将Webshell代码插在该部分，然后上传。</p>
<p>具体实现需要<code>自己编写Python程序</code>，人工尝试基本是不可能构造出能绕过渲染函数的图片webshell的。</p>
<pre><code>//使用上传的图片生成新的图片

 $im = imagecreatefromjpeg($target_path);
</code></pre><h6 id="绕过-14"><a href="#绕过-14" class="headerlink" title="绕过"></a>绕过</h6><p>好了，还是太菜，还是看大佬的解决方案学习学习把吧:<a href="https://xz.aliyun.com/t/2657" target="_blank" rel="noopener">点击这里</a></p>
<p><strong>1.GIF</strong></p>
<p>关于绕过gif的二次渲染,我们只需要找到渲染前后没有变化的位置,然后将php代码写进去,就可以成功上传带有php代码的图片了.</p>
<p><strong>2.PNG</strong></p>
<p>png的二次渲染的绕过并不能像gif那样简单.</p>
<p><strong>3.JPG</strong></p>
<blockquote>
<p>ps: 这一关是二次渲染的，还是多学习学习吧</p>
</blockquote>
<h1 id="18-19-条件竞争-（多线程发包）"><a href="#18-19-条件竞争-（多线程发包）" class="headerlink" title="18 -19 条件竞争 （多线程发包）"></a>18 -19 条件竞争 （多线程发包）</h1><h2 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass - 18"></a>Pass - 18</h2><p><img src="http://image.xpshuai.cn/20200218222155590_1020797820.png"></p>
<p><code>unlink</code>函数：   数删除文件。若成功，则返回 true，失败则返回 false</p>
<p><strong>执行步骤：</strong></p>
<p>1.取出上传文件的后缀名</p>
<p>2.临时文件移动（<code>move_uploaded_file</code>）到一个路径下面，</p>
<p>3.如果后缀名在白名单，进行最后移动，保存</p>
<p>4.如果后缀名不在白名单，<code>unlink</code>删除临时文件</p>
<h6 id="绕过-15"><a href="#绕过-15" class="headerlink" title="绕过"></a>绕过</h6><blockquote>
<p>趁他不注意（多线程），在临时文件里面写一个创建后门文件的功能，这样虽然临时文件不满足被删除，但是自己自动创建的文件已经存在服务器目录了</p>
</blockquote>
<p><strong>F1：</strong></p>
<p>其中，诱饵上传文件代码</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>

<span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"shell.php"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Unable to open file!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token string">"&lt;?php  phpinfo();   ?>\n"</span><span class="token punctuation">;</span>

<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token delimiter">?></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后，如果已知新建文件的路径，可以直接访问</p>
<p>​            如果不知道，可以抓取数据包查看</p>
<p><strong>方法：</strong></p>
<p>1.利用burp的Intruder使用多线程发包(如下图)，</p>
<p>2.然后不断在浏览器访问我们的webshell，会有一瞬间的访问成功。（即当线程足够的时候 ，将可能会跳过某个步骤，而直接访问到我们的 webshell，新文件也会创建成功 )</p>
<p><img src="http://image.xpshuai.cn/20200218222719652_1510553817.png"></p>
<p><strong>F2:</strong>   Python</p>
<pre class="line-numbers language-python"><code class="language-python">\#!<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env python3

\# coding<span class="token punctuation">:</span>utf<span class="token number">-8</span>



<span class="token keyword">import</span> hackhttp

<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>dummy <span class="token keyword">import</span> Pool <span class="token keyword">as</span> ThreadPool





<span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span>lists<span class="token punctuation">)</span><span class="token punctuation">:</span>

​    hh <span class="token operator">=</span> hackhttp<span class="token punctuation">.</span>hackhttp<span class="token punctuation">(</span><span class="token punctuation">)</span>

​    raw <span class="token operator">=</span> <span class="token triple-quoted-string string">"""POST /upload-labs/Pass-17/index.php HTTP/1.1

Host: 127.0.0.1

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3

Accept-Encoding: gzip, deflate

Referer: http://127.0.0.1/upload-labs/Pass-18/index.php

Cookie: pass=18

Connection: close

Upgrade-Insecure-Requests: 1

Content-Type: multipart/form-data; boundary=---------------------------6696274297634

Content-Length: 341



-----------------------------6696274297634

Content-Disposition: form-data; name="upload_file"; filename="18.php"

Content-Type: application/octet-stream



&lt;?php

$myfile = fopen("shell.php", "w") or die("Unable to open file!");

$txt = "&lt;?php  phpinfo();   ?>\n";

fwrite($myfile, $txt);

fclose($myfile);

?>

-----------------------------6696274297634

Content-Disposition: form-data; name="submit"



上传

-----------------------------6696274297634--

"""</span>

​    code<span class="token punctuation">,</span> head<span class="token punctuation">,</span> html<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> log <span class="token operator">=</span> hh<span class="token punctuation">.</span>http<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1/upload-labs/Pass-17/index.php'</span><span class="token punctuation">,</span> raw<span class="token operator">=</span>raw<span class="token punctuation">)</span>

​    <span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\r"</span><span class="token punctuation">)</span>


pool <span class="token operator">=</span> ThreadPool<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

pool<span class="token punctuation">.</span>map<span class="token punctuation">(</span>upload<span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

pool<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

pool<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>只是把burp换成了python，其他操作方法是一样的</p>
<h6 id="修复问题"><a href="#修复问题" class="headerlink" title="修复问题"></a>修复问题</h6><p>应该先判断文件类型，再移动</p>
<h2 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass - 19"></a>Pass - 19</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cls_rename_file</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//是否用$im_path成功给$upload_file重命名</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>和第18关有点类似，都对关键进行了重命名，由于我们是利用burp不断的发送相同的包，那么一旦有两个包同时传到这边是，那么系统对一个重命名时，另一个刚好“逃脱”了，那么上传成功。</p>
<h6 id="绕过-16"><a href="#绕过-16" class="headerlink" title="绕过"></a>绕过</h6><p>在这关是一个<code>白名单</code>，<code>利用了appche的一个解析漏洞</code>，它会将 “<code>.php.7z</code> 当作<code>.php</code>来解析，而刚好 “ .php.7z ”又属于白名单，</p>
<p>所以上传一个 “ .php.7z ” 的文件，然后 再利用条件竞争漏洞进行多线程不断的发送 “ .php.7z”的文件，</p>
<p>由于版本问题，这次的文件没有上传到upload的文件夹下面，而是上传到 WWW 的文件夹下面，但是不影响，并且这次的文件上传后就<code>不会被删掉</code>，就会保存在 该文件夹下面，这样的话我们将可以<code>稳定的访问到</code>。</p>
<p>可以看到，burp进行多线程发包后，在浏览器一致访问上传文件的地址，一定会有那么一瞬间会访问到（这时，文件里新建webshell的代码执行了，新的后门建立成功了，我们就可以访问后门了）</p>
<p><img src="http://image.xpshuai.cn/20200218224226603_822814111.png"></p>
<h1 id="00截断和move-uploaded-file（）函数"><a href="#00截断和move-uploaded-file（）函数" class="headerlink" title="00截断和move_uploaded_file（）函数"></a>00截断和move_uploaded_file（）函数</h1><h2 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass - 20"></a>Pass - 20</h2><p><code>pathinfo(）函数</code>：以数组的形式返回关于文件路径的信息。</p>
<p>pathinfo(path,options)</p>
<p><code>move_uploaded_file(A,B</code>)函数：此函数将会检查文件A是否是合法的上传文件，如果是，将把文件A移动到B的目录下；否则将会返回false，并且不执行任何操作。</p>
<h6 id="绕过-17"><a href="#绕过-17" class="headerlink" title="绕过"></a>绕过</h6><p><strong>方法一：</strong>  %00截断 （前面已经写了）</p>
<p><code>111.php%00upload-19.jpg</code>  其中，%00是url-decode之后的</p>
<p><strong>方法二：</strong> </p>
<p>利用<code>move_uploaded_file（）函数和黑名单结合</code>存在的漏洞：</p>
<p>move_uploaded_file（A,B）函数：此函数将会检查文件A是否是合法的上传文件，如果是，将把文件A移动到B的目录下；<code>否则将会返回false，并且不执行任何操作</code>。</p>
<p>由于这里利用了黑名单，则move_uploaded_file（）函数在判断时只会判断是否为黑名单，如果不是，那么他将会直接将文件保存在指定目录下。所以在这里我们利用 <code>/.</code>(斜杠点)和 <code>空格</code>（空格）进行绕过。</p>
<p>（1） “/.”(斜杠点)</p>
<p>​    <code>upload-19.php/.</code></p>
<p>（2）“ ”（空格）</p>
<p>​    <code>upload-19.php</code></p>
<p>​    </p>
<p>（3）“ .”（空格）</p>
<p> <code>upload-19.php.</code></p>
<p>  <code>upload-19.php.</code>   点+空格</p>
<p>   等等…</p>
<p><strong>方法三：</strong> </p>
<p>Windows冒号截断</p>
<pre><code>upload-19.php:.jpg
</code></pre><p>(我做的实验，php上传成功，但是内容清空了)</p>
<h2 id="Pass-21"><a href="#Pass-21" class="headerlink" title="Pass - 21"></a>Pass - 21</h2><blockquote>
<p>参考: <a href="https://blog.csdn.net/kekefen01/article/details/90346413" target="_blank" rel="noopener">https://blog.csdn.net/kekefen01/article/details/90346413</a></p>
</blockquote>
<p>通过传递数组绕过。属于逻辑漏洞，没有考虑数组第二个元素不存在的情况。</p>
<h6 id="绕过-18"><a href="#绕过-18" class="headerlink" title="绕过"></a>绕过</h6><p>使用多个数组</p>
<pre><code>------WebKitFormBoundaryDTdqZdRoon2GpWOE

Content-Disposition: form-data; name="upload_file"; filename="info.php"

Content-Type: image/jpeg



&lt;?php phpinfo();?&gt;



------WebKitFormBoundaryDTdqZdRoon2GpWOE

Content-Disposition: form-data; name="save_name[0]"



info.php/

------WebKitFormBoundaryDTdqZdRoon2GpWOE

Content-Disposition: form-data; name="save_name[2]"



jpg

------WebKitFormBoundaryDTdqZdRoon2GpWOE

Content-Disposition: form-data; name="submit"



上传

------WebKitFormBoundaryDTdqZdRoon2GpWOE--
</code></pre><p>最终文件名为“info.php/.” 因为move_uploaded_file底层会调用tsrm_realpath函数导致，递归删除文件名最后的/.</p>
<blockquote>
<p>参考文章：<a href="https://blog.csdn.net/weixin_43901038/article/details/94890631" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43901038/article/details/94890631</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.cnblogs.com/shellr00t/p/6426945.html" target="_blank" rel="noopener">https://www.cnblogs.com/shellr00t/p/6426945.html</a></p>
</blockquote>
<blockquote>
<p><a href="https://thief.one/2016/09/22/%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC%E5%A7%BF%E5%8A%BF%E6%B1%87%E6%80%BB-%E6%AC%A2%E8%BF%8E%E8%A1%A5%E5%85%85/" target="_blank" rel="noopener">https://thief.one/2016/09/22/%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC%E5%A7%BF%E5%8A%BF%E6%B1%87%E6%80%BB-%E6%AC%A2%E8%BF%8E%E8%A1%A5%E5%85%85/</a></p>
</blockquote>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://www.xpshuai.cn" rel="external nofollow noreferrer">剑胆琴心</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://www.xpshuai.cn/posts/3890b03c/">http://www.xpshuai.cn/posts/3890b03c/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="http://www.xpshuai.cn" target="_blank">剑胆琴心</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/渗透测试/">
                                    <span class="chip bg-color">渗透测试</span>
                                </a>
                            
                                <a href="/tags/文件上传/">
                                    <span class="chip bg-color">文件上传</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">如果感觉对您有帮助，请我吃包辣条吧</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'd75ec1a5864747376f6f',
        clientSecret: 'b4751152ca815e8e538c64da23e2a371fa1fb2db',
        repo: 'hexo-gitalk',
        owner: 'shuai06',
        admin: "shuai06",
        id: '2020-02-17T18-08-02',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/5366e554/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="wpscan更新超时报错">
                        
                        <span class="card-title">wpscan更新超时报错</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
https://blog.csdn.net/zhang644720213/article/details/92849717

参考自：https://blog.csdn.net/zhang644720213/article/details
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-02-17
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/渗透测试/" class="post-category">
                                    渗透测试
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/渗透测试/">
                        <span class="chip bg-color">渗透测试</span>
                    </a>
                    
                    <a href="/tags/WPscan/">
                        <span class="chip bg-color">WPscan</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/659559f6/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="python之requests库">
                        
                        <span class="card-title">python之requests库</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Requests是基于urllib3来改写的，采用Apache2 Licensed 来源协议的HTTP库。
它比urllib更加方便，可以节约我们大量的工作，完全满足HTTP测试需求。
安装pip install requests
使用测试
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                    <a href="/tags/requests/">
                        <span class="chip bg-color">requests</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 剑胆琴心<br />'
            + '文章作者: 剑胆琴心<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h1, h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="http://www.xpshuai.cn" target="_blank">剑胆琴心</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">465.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "4";
                    var startDate = "20";
                    var startHour = "15";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="http://www.beianbeian.com/beianxinxi/816345dfd53e0153acde20c5bb1dd1b0.html" target="_blank">冀ICP备18027796号-1</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/shuai06" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2944282625@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2944282625" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2944282625" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/xfg3rji2iq4povfdtfxiwk4smqduoso6.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
